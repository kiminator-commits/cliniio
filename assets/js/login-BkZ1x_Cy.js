const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/redisClient.server-BqOPz1NQ.js","assets/js/utils-DSBVV_PW.js","assets/js/vendor-DoALFvsH.js","assets/js/data-73RVSc-N.js","assets/js/ui-DETUEJ2B.js","assets/js/TypedSupabaseAdapter-Bu2vOfh5.js","assets/js/SupabaseAdapter-OgEG3egm.js","assets/js/inventoryTransformers-Cr0oYokb.js","assets/js/StaticDataAdapter-BQyacmPv.js","assets/js/quizService-st9-VETt.js","assets/js/errors-CdY1Sgot.js"])))=>i.map(i=>d[i]);
var g=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});import{j as p}from"./utils-DSBVV_PW.js";import{g as io,b as so,a as x,R as ri,u as ao}from"./vendor-DoALFvsH.js";import{c as oo}from"./data-73RVSc-N.js";import{G as L}from"./ui-DETUEJ2B.js";const co="modulepreload",lo=function(i){return"/"+i},ni={},z=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let a=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=a(t.map(l=>{if(l=lo(l),l in ni)return;ni[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":co,u||(f.as="script"),f.crossOrigin="",f.href=l,c&&f.setAttribute("nonce",c),document.head.appendChild(f),u)return new Promise((h,m)=>{f.addEventListener("load",h),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})},uo=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>z(()=>g(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>sr);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Kn extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class ho extends Kn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ii extends Kn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class si extends Kn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var xn;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(xn||(xn={}));var fo=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};class po{constructor(e,{headers:t={},customFetch:r,region:n=xn.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=uo(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return fo(this,void 0,void 0,function*(){try{const{headers:n,method:s,body:o}=t;let c={},{region:a}=t;a||(a=this.region);const l=new URL(`${this.url}/${e}`);a&&a!=="any"&&(c["x-region"]=a,l.searchParams.set("forceFunctionRegion",a));let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob!="undefined"&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(c["Content-Type"]="text/plain",u=o):typeof FormData!="undefined"&&o instanceof FormData?u=o:(c["Content-Type"]="application/json",u=JSON.stringify(o)));const d=yield this.fetch(l.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:u}).catch(w=>{throw new ho(w)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new ii(d);if(!d.ok)throw new si(d);let h=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),m;return h==="application/json"?m=yield d.json():h==="application/octet-stream"?m=yield d.blob():h==="text/event-stream"?m=d:h==="multipart/form-data"?m=yield d.formData():m=yield d.text(),{data:m,error:null,response:d}}catch(n){return{data:null,error:n,response:n instanceof si||n instanceof ii?n.context:void 0}}})}}var Y={},_t={},wt={},bt={},St={},It={},go=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object")},ir=go();const mo=ir.fetch,ca=ir.fetch.bind(ir),la=ir.Headers,yo=ir.Request,vo=ir.Response,sr=Object.freeze(Object.defineProperty({__proto__:null,Headers:la,Request:yo,Response:vo,default:ca,fetch:mo},Symbol.toStringTag,{value:"Module"})),_o=io(sr);var $r={},ai;function ua(){if(ai)return $r;ai=1,Object.defineProperty($r,"__esModule",{value:!0});class i extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return $r.default=i,$r}var oi;function da(){if(oi)return It;oi=1;var i=It&&It.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(It,"__esModule",{value:!0});const e=i(_o),t=i(ua());class r{constructor(s){var o,c;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(o=s.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=s.signal,this.isMaybeSingle=(c=s.isMaybeSingle)!==null&&c!==void 0?c:!1,s.fetch?this.fetch=s.fetch:typeof fetch=="undefined"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,o){return this.headers=new Headers(this.headers),this.headers.set(s,o),this}then(s,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let a=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(l=>g(this,null,function*(){var u,d,f,h;let m=null,w=null,S=null,I=l.status,b=l.statusText;if(l.ok){if(this.method!=="HEAD"){const k=yield l.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?w=k:w=JSON.parse(k))}const _=(d=this.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),E=(f=l.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");_&&E&&E.length>1&&(S=parseInt(E[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(w)&&(w.length>1?(m={code:"PGRST116",details:`Results contain ${w.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},w=null,S=null,I=406,b="Not Acceptable"):w.length===1?w=w[0]:w=null)}else{const _=yield l.text();try{m=JSON.parse(_),Array.isArray(m)&&l.status===404&&(w=[],m=null,I=200,b="OK")}catch(E){l.status===404&&_===""?(I=204,b="No Content"):m={message:_}}if(m&&this.isMaybeSingle&&(!((h=m==null?void 0:m.details)===null||h===void 0)&&h.includes("0 rows"))&&(m=null,I=200,b="OK"),m&&this.shouldThrowOnError)throw new t.default(m)}return{error:m,data:w,count:S,status:I,statusText:b}}));return this.shouldThrowOnError||(a=a.catch(l=>{var u,d,f;return{error:{message:`${(u=l==null?void 0:l.name)!==null&&u!==void 0?u:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(d=l==null?void 0:l.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=l==null?void 0:l.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),a.then(s,o)}returns(){return this}overrideTypes(){return this}}return It.default=r,It}var ci;function ha(){if(ci)return St;ci=1;var i=St&&St.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(St,"__esModule",{value:!0});const e=i(da());class t extends e.default{select(n){let s=!1;const o=(n!=null?n:"*").split("").map(c=>/\s/.test(c)&&!s?"":(c==='"'&&(s=!s),c)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:s=!0,nullsFirst:o,foreignTable:c,referencedTable:a=c}={}){const l=a?`${a}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${n}.${s?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:s,referencedTable:o=s}={}){const c=typeof o=="undefined"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${n}`),this}range(n,s,{foreignTable:o,referencedTable:c=o}={}){const a=typeof c=="undefined"?"offset":`${c}.offset`,l=typeof c=="undefined"?"limit":`${c}.limit`;return this.url.searchParams.set(a,`${n}`),this.url.searchParams.set(l,`${s-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:s=!1,settings:o=!1,buffers:c=!1,wal:a=!1,format:l="text"}={}){var u;const d=[n?"analyze":null,s?"verbose":null,o?"settings":null,c?"buffers":null,a?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${f}"; options=${d};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return St.default=t,St}var li;function Wn(){if(li)return bt;li=1;var i=bt&&bt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(bt,"__esModule",{value:!0});const e=i(ha());class t extends e.default{eq(n,s){return this.url.searchParams.append(n,`eq.${s}`),this}neq(n,s){return this.url.searchParams.append(n,`neq.${s}`),this}gt(n,s){return this.url.searchParams.append(n,`gt.${s}`),this}gte(n,s){return this.url.searchParams.append(n,`gte.${s}`),this}lt(n,s){return this.url.searchParams.append(n,`lt.${s}`),this}lte(n,s){return this.url.searchParams.append(n,`lte.${s}`),this}like(n,s){return this.url.searchParams.append(n,`like.${s}`),this}likeAllOf(n,s){return this.url.searchParams.append(n,`like(all).{${s.join(",")}}`),this}likeAnyOf(n,s){return this.url.searchParams.append(n,`like(any).{${s.join(",")}}`),this}ilike(n,s){return this.url.searchParams.append(n,`ilike.${s}`),this}ilikeAllOf(n,s){return this.url.searchParams.append(n,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(n,s){return this.url.searchParams.append(n,`ilike(any).{${s.join(",")}}`),this}is(n,s){return this.url.searchParams.append(n,`is.${s}`),this}in(n,s){const o=Array.from(new Set(s)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(n,`in.(${o})`),this}contains(n,s){return typeof s=="string"?this.url.searchParams.append(n,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(n,`cs.{${s.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(s)}`),this}containedBy(n,s){return typeof s=="string"?this.url.searchParams.append(n,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(n,`cd.{${s.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(s)}`),this}rangeGt(n,s){return this.url.searchParams.append(n,`sr.${s}`),this}rangeGte(n,s){return this.url.searchParams.append(n,`nxl.${s}`),this}rangeLt(n,s){return this.url.searchParams.append(n,`sl.${s}`),this}rangeLte(n,s){return this.url.searchParams.append(n,`nxr.${s}`),this}rangeAdjacent(n,s){return this.url.searchParams.append(n,`adj.${s}`),this}overlaps(n,s){return typeof s=="string"?this.url.searchParams.append(n,`ov.${s}`):this.url.searchParams.append(n,`ov.{${s.join(",")}}`),this}textSearch(n,s,{config:o,type:c}={}){let a="";c==="plain"?a="pl":c==="phrase"?a="ph":c==="websearch"&&(a="w");const l=o===void 0?"":`(${o})`;return this.url.searchParams.append(n,`${a}fts${l}.${s}`),this}match(n){return Object.entries(n).forEach(([s,o])=>{this.url.searchParams.append(s,`eq.${o}`)}),this}not(n,s,o){return this.url.searchParams.append(n,`not.${s}.${o}`),this}or(n,{foreignTable:s,referencedTable:o=s}={}){const c=o?`${o}.or`:"or";return this.url.searchParams.append(c,`(${n})`),this}filter(n,s,o){return this.url.searchParams.append(n,`${s}.${o}`),this}}return bt.default=t,bt}var ui;function fa(){if(ui)return wt;ui=1;var i=wt&&wt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wt,"__esModule",{value:!0});const e=i(Wn());class t{constructor(n,{headers:s={},schema:o,fetch:c}){this.url=n,this.headers=new Headers(s),this.schema=o,this.fetch=c}select(n,{head:s=!1,count:o}={}){const c=s?"HEAD":"GET";let a=!1;const l=(n!=null?n:"*").split("").map(u=>/\s/.test(u)&&!a?"":(u==='"'&&(a=!a),u)).join("");return this.url.searchParams.set("select",l),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:s,defaultToNull:o=!0}={}){var c;const a="POST";if(s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const l=n.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(l.length>0){const u=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}upsert(n,{onConflict:s,ignoreDuplicates:o=!1,count:c,defaultToNull:a=!0}={}){var l;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),c&&this.headers.append("Prefer",`count=${c}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const d=n.reduce((f,h)=>f.concat(Object.keys(h)),[]);if(d.length>0){const f=[...new Set(d)].map(h=>`"${h}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}update(n,{count:s}={}){var o;const c="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:n}={}){var s;const o="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}}return wt.default=t,wt}var di;function wo(){if(di)return _t;di=1;var i=_t&&_t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(_t,"__esModule",{value:!0});const e=i(fa()),t=i(Wn());class r{constructor(s,{headers:o={},schema:c,fetch:a}={}){this.url=s,this.headers=new Headers(o),this.schemaName=c,this.fetch=a}from(s){const o=new URL(`${this.url}/${s}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new r(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,o={},{head:c=!1,get:a=!1,count:l}={}){var u;let d;const f=new URL(`${this.url}/rpc/${s}`);let h;c||a?(d=c?"HEAD":"GET",Object.entries(o).filter(([w,S])=>S!==void 0).map(([w,S])=>[w,Array.isArray(S)?`{${S.join(",")}}`:`${S}`]).forEach(([w,S])=>{f.searchParams.append(w,S)})):(d="POST",h=o);const m=new Headers(this.headers);return l&&m.set("Prefer",`count=${l}`),new t.default({method:d,url:f,headers:m,schema:this.schemaName,body:h,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return _t.default=r,_t}var hi;function bo(){if(hi)return Y;hi=1;var i=Y&&Y.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Y,"__esModule",{value:!0}),Y.PostgrestError=Y.PostgrestBuilder=Y.PostgrestTransformBuilder=Y.PostgrestFilterBuilder=Y.PostgrestQueryBuilder=Y.PostgrestClient=void 0;const e=i(wo());Y.PostgrestClient=e.default;const t=i(fa());Y.PostgrestQueryBuilder=t.default;const r=i(Wn());Y.PostgrestFilterBuilder=r.default;const n=i(ha());Y.PostgrestTransformBuilder=n.default;const s=i(da());Y.PostgrestBuilder=s.default;const o=i(ua());return Y.PostgrestError=o.default,Y.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:s.default,PostgrestError:o.default},Y}var So=bo();const Io=so(So),{PostgrestClient:Eo,PostgrestQueryBuilder:$p,PostgrestFilterBuilder:Rp,PostgrestTransformBuilder:Lp,PostgrestBuilder:Mp,PostgrestError:jp}=Io;class ko{static detectEnvironment(){var e;if(typeof WebSocket!="undefined")return{type:"native",constructor:WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocket!="undefined")return{type:"native",constructor:globalThis.WebSocket};if(typeof global!="undefined"&&typeof global.WebSocket!="undefined")return{type:"native",constructor:global.WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocketPair!="undefined"&&typeof globalThis.WebSocket=="undefined")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis!="undefined"&&globalThis.EdgeRuntime||typeof navigator!="undefined"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process!="undefined"){const t=process.versions;if(t&&t.node){const r=t.node,n=parseInt(r.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket!="undefined"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch(e){return!1}}}const Co="2.15.5",Ao=`realtime-js/${Co}`,To="1.0.0",Dn=1e4,Po=1e3,Oo=100;var Sr;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Sr||(Sr={}));var W;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(W||(W={}));var Ee;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(Ee||(Ee={}));var $n;(function(i){i.websocket="websocket"})($n||($n={}));var ft;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(ft||(ft={}));class xo{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),s=t.getUint8(2);let o=this.HEADER_LENGTH+2;const c=r.decode(e.slice(o,o+n));o=o+n;const a=r.decode(e.slice(o,o+s));o=o+s;const l=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:c,event:a,payload:l}}}class pa{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var j;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(j||(j={}));const fi=(i,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,o)=>(s[o]=Do(o,i,e,n),s),{})},Do=(i,e,t,r)=>{const n=e.find(c=>c.name===i),s=n==null?void 0:n.type,o=t[i];return s&&!r.includes(s)?ga(s,o):Rn(o)},ga=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return Mo(e,t)}switch(i){case j.bool:return $o(e);case j.float4:case j.float8:case j.int2:case j.int4:case j.int8:case j.numeric:case j.oid:return Ro(e);case j.json:case j.jsonb:return Lo(e);case j.timestamp:return jo(e);case j.abstime:case j.date:case j.daterange:case j.int4range:case j.int8range:case j.money:case j.reltime:case j.text:case j.time:case j.timestamptz:case j.timetz:case j.tsrange:case j.tstzrange:return Rn(e);default:return Rn(e)}},Rn=i=>i,$o=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},Ro=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},Lo=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},Mo=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let s;const o=i.slice(1,t);try{s=JSON.parse("["+o+"]")}catch(c){s=o?o.split(","):[]}return s.map(c=>ga(e,c))}return i},jo=i=>typeof i=="string"?i.replace(" ","T"):i,ma=i=>{let e=i;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class ln{constructor(e,t,r={},n=Dn){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var pi;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(pi||(pi={}));class Ir{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:s,onLeave:o,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ir.syncState(this.state,n,s,o),this.pendingDiffs.forEach(a=>{this.state=Ir.syncDiff(this.state,a,s,o)}),this.pendingDiffs=[],c()}),this.channel._on(r.diff,{},n=>{const{onJoin:s,onLeave:o,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Ir.syncDiff(this.state,n,s,o),c())}),this.onJoin((n,s,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:s,newPresences:o})}),this.onLeave((n,s,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const s=this.cloneDeep(e),o=this.transformState(t),c={},a={};return this.map(s,(l,u)=>{o[l]||(a[l]=u)}),this.map(o,(l,u)=>{const d=s[l];if(d){const f=u.map(S=>S.presence_ref),h=d.map(S=>S.presence_ref),m=u.filter(S=>h.indexOf(S.presence_ref)<0),w=d.filter(S=>f.indexOf(S.presence_ref)<0);m.length>0&&(c[l]=m),w.length>0&&(a[l]=w)}else c[l]=u}),this.syncDiff(s,{joins:c,leaves:a},r,n)}static syncDiff(e,t,r,n){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(c,a)=>{var l;const u=(l=e[c])!==null&&l!==void 0?l:[];if(e[c]=this.cloneDeep(a),u.length>0){const d=e[c].map(h=>h.presence_ref),f=u.filter(h=>d.indexOf(h.presence_ref)<0);e[c].unshift(...f)}r(c,u,a)}),this.map(o,(c,a)=>{let l=e[c];if(!l)return;const u=a.map(d=>d.presence_ref);l=l.filter(d=>u.indexOf(d.presence_ref)<0),e[c]=l,n(c,l,a),l.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var gi;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(gi||(gi={}));var Er;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Er||(Er={}));var Me;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(Me||(Me={}));class Qn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=W.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ln(this,Ee.join,this.params,this.timeout),this.rejoinTimer=new pa(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=W.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=W.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=W.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=W.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=W.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ee.reply,{},(n,s)=>{this._trigger(this._replyEventName(s),n)}),this.presence=new Ir(this),this.broadcastEndpointURL=ma(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==W.closed){const{config:{broadcast:o,presence:c,private:a}}=this.params,l=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[Er.PRESENCE]&&this.bindings[Er.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,d={},f={broadcast:o,presence:Object.assign(Object.assign({},c),{enabled:u}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(h=>e==null?void 0:e(Me.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(Me.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",m=>g(this,[m],function*({postgres_changes:h}){var w;if(this.socket.setAuth(),h===void 0){e==null||e(Me.SUBSCRIBED);return}else{const S=this.bindings.postgres_changes,I=(w=S==null?void 0:S.length)!==null&&w!==void 0?w:0,b=[];for(let v=0;v<I;v++){const _=S[v],{filter:{event:E,schema:k,table:A,filter:N}}=_,D=h&&h[v];if(D&&D.event===E&&D.schema===k&&D.table===A&&D.filter===N)b.push(Object.assign(Object.assign({},_),{id:D.id}));else{this.unsubscribe(),this.state=W.errored,e==null||e(Me.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e(Me.SUBSCRIBED);return}})).receive("error",h=>{this.state=W.errored,e==null||e(Me.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Me.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(r){return g(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return g(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this.state===W.joined&&e===Er.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}send(r){return g(this,arguments,function*(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:c}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:c,private:this.private}]})};try{const u=yield this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return yield(s=u.body)===null||s===void 0?void 0:s.cancel(),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var c,a,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(c=this.params)===null||c===void 0?void 0:c.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),u.receive("ok",()=>o("ok")),u.receive("error",()=>o("error")),u.receive("timeout",()=>o("timed out"))})})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=W.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ee.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new ln(this,Ee.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=W.closed,this.bindings={}}_fetchWithTimeout(e,t,r){return g(this,null,function*(){const n=new AbortController,s=setTimeout(()=>n.abort(),r),o=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(s),o})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new ln(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Oo){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,s;const o=e.toLocaleLowerCase(),{close:c,error:a,leave:l,join:u}=Ee;if(r&&[c,a,l,u].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(h=>{var m,w,S;return((m=h.filter)===null||m===void 0?void 0:m.event)==="*"||((S=(w=h.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(h=>h.callback(f,r)):(s=this.bindings[o])===null||s===void 0||s.filter(h=>{var m,w,S,I,b,v;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in h){const _=h.id,E=(m=h.filter)===null||m===void 0?void 0:m.event;return _&&((w=t.ids)===null||w===void 0?void 0:w.includes(_))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((S=t.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const _=(b=(I=h==null?void 0:h.filter)===null||I===void 0?void 0:I.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return _==="*"||_===((v=t==null?void 0:t.event)===null||v===void 0?void 0:v.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===o}).map(h=>{if(typeof f=="object"&&"ids"in f){const m=f.data,{schema:w,table:S,commit_timestamp:I,type:b,errors:v}=m;f=Object.assign(Object.assign({},{schema:w,table:S,commit_timestamp:I,eventType:b,new:{},old:{},errors:v}),this._getPayloadRecords(m))}h.callback(f,r)})}_isClosed(){return this.state===W.closed}_isJoined(){return this.state===W.joined}_isJoining(){return this.state===W.joining}_isLeaving(){return this.state===W.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var s;return!(((s=n.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&Qn.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ee.close,{},e)}_onError(e){this._on(Ee.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=W.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=fi(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=fi(e.columns,e.old_record)),t}}const un=()=>{},Rr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Uo=[1e3,2e3,5e3,1e4],No=1e4,Fo=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class zo{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Dn,this.transport=null,this.heartbeatIntervalMs=Rr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=un,this.ref=0,this.reconnectTimer=null,this.logger=un,this.conn=null,this.sendBuffer=[],this.serializer=new xo,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let s;return n?s=n:typeof fetch=="undefined"?s=(...o)=>z(()=>g(this,null,function*(){const{default:c}=yield Promise.resolve().then(()=>sr);return{default:c}}),void 0).then(({default:c})=>c(...o)).catch(c=>{throw new Error(`Failed to load @supabase/node-fetch: ${c.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):s=fetch,(...o)=>s(...o)},!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${$n.websocket}`,this.httpEndpoint=ma(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ko.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:To}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t!=null?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return g(this,null,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return g(this,null,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Sr.connecting:return ft.Connecting;case Sr.open:return ft.Open;case Sr.closing:return ft.Closing;default:return ft.Closed}}isConnected(){return this.connectionState()===ft.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(s=>s.topic===r);if(n)return n;{const s=new Qn(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:r,payload:n,ref:s}=e,o=()=>{this.encode(e,c=>{var a;(a=this.conn)===null||a===void 0||a.send(c)})};this.log("push",`${t} ${r} (${s})`,n),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e=null){return g(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return g(this,null,function*(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Po,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Rr.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:s,ref:o}=t,c=o?`(${o})`:"",a=s.status||"";this.log("receive",`${a} ${r} ${n} ${c}`.trim(),s),this.channels.filter(l=>l._isMember(r)).forEach(l=>l._trigger(n,s,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ee.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Fo],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}_performAuth(e=null){return g(this,null,function*(){let t;e?t=e:this.accessToken?t=yield this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:Ao};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(Ee.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return g(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new pa(()=>g(this,null,function*(){setTimeout(()=>g(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),Rr.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,s,o,c,a,l,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Dn,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:Rr.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(c=e==null?void 0:e.heartbeatCallback)!==null&&c!==void 0?c:un,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(a=e==null?void 0:e.reconnectAfterMs)!==null&&a!==void 0?a:(d=>Uo[d-1]||No),this.encode=(l=e==null?void 0:e.encode)!==null&&l!==void 0?l:((d,f)=>f(JSON.stringify(d))),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window!="undefined"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Yn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Q(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class qo extends Yn{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ln extends Yn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ho=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const ya=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>z(()=>g(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>sr);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Bo=()=>Ho(void 0,void 0,void 0,function*(){return typeof Response=="undefined"?(yield z(()=>Promise.resolve().then(()=>sr),void 0)).Response:Response}),Mn=i=>{if(Array.isArray(i))return i.map(t=>Mn(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[n]=Mn(r)}),e},Vo=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)};var gt=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const dn=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Go=(i,e,t)=>gt(void 0,void 0,void 0,function*(){const r=yield Bo();i instanceof r&&!(t!=null&&t.noResolveJson)?i.json().then(n=>{const s=i.status||500,o=(n==null?void 0:n.statusCode)||s+"";e(new qo(dn(n),s,o))}).catch(n=>{e(new Ln(dn(n),n))}):e(new Ln(dn(i),i))}),Ko=(i,e,t,r)=>{const n={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||!r?n:(Vo(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r)):n.body=r,e!=null&&e.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function Or(i,e,t,r,n,s){return gt(this,void 0,void 0,function*(){return new Promise((o,c)=>{i(t,Ko(e,r,n,s)).then(a=>{if(!a.ok)throw a;return r!=null&&r.noResolveJson?a:a.json()}).then(a=>o(a)).catch(a=>Go(a,c,r))})})}function tn(i,e,t,r){return gt(this,void 0,void 0,function*(){return Or(i,"GET",e,t,r)})}function xe(i,e,t,r,n){return gt(this,void 0,void 0,function*(){return Or(i,"POST",e,r,n,t)})}function jn(i,e,t,r,n){return gt(this,void 0,void 0,function*(){return Or(i,"PUT",e,r,n,t)})}function Wo(i,e,t,r){return gt(this,void 0,void 0,function*(){return Or(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function va(i,e,t,r,n){return gt(this,void 0,void 0,function*(){return Or(i,"DELETE",e,r,n,t)})}var ie=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const Qo={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mi={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Yo{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ya(n)}uploadOrUpdate(e,t,r,n){return ie(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},mi),n);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const a=o.metadata;typeof Blob!="undefined"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),a&&s.append("metadata",this.encodeMetadata(a)),s.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(s=r,s.append("cacheControl",o.cacheControl),a&&s.append("metadata",this.encodeMetadata(a))):(s=r,c["cache-control"]=`max-age=${o.cacheControl}`,c["content-type"]=o.contentType,a&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),n!=null&&n.headers&&(c=Object.assign(Object.assign({},c),n.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),d=yield(e=="PUT"?jn:xe)(this.fetch,`${this.url}/object/${u}`,s,Object.assign({headers:c},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(s){if(Q(s))return{data:null,error:s};throw s}})}upload(e,t,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return ie(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),c=new URL(this.url+`/object/upload/sign/${o}`);c.searchParams.set("token",t);try{let a;const l=Object.assign({upsert:mi.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob!="undefined"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",l.cacheControl),a.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(a=r,a.append("cacheControl",l.cacheControl)):(a=r,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const d=yield jn(this.fetch,c.toString(),a,{headers:u});return{data:{path:s,fullPath:d.Key},error:null}}catch(a){if(Q(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return ie(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const s=yield xe(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+s.url),c=o.searchParams.get("token");if(!c)throw new Yn("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:c},error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}update(e,t,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return ie(this,void 0,void 0,function*(){try{return{data:yield xe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}copy(e,t,r){return ie(this,void 0,void 0,function*(){try{return{data:{path:(yield xe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return ie(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),s=yield xe(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return ie(this,void 0,void 0,function*(){try{const n=yield xe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}download(e,t){return ie(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)!="undefined"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=s?`?${s}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield tn(this.fetch,`${this.url}/${n}/${c}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(Q(c))return{data:null,error:c};throw c}})}info(e){return ie(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield tn(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Mn(r),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}exists(e){return ie(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Wo(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Q(r)&&r instanceof Ln){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&n.push(s);const c=typeof(t==null?void 0:t.transform)!="undefined"?"render/image":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});a!==""&&n.push(a);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${r}${l}`)}}}remove(e){return ie(this,void 0,void 0,function*(){try{return{data:yield va(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}list(e,t,r){return ie(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Qo),t),{prefix:e||""});return{data:yield xe(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}})}listV2(e,t){return ie(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield xe(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer!="undefined"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Jo="2.11.1",Xo={"X-Client-Info":`storage-js/${Jo}`};var Et=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};class Zo{constructor(e,t={},r,n){const s=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href,this.headers=Object.assign(Object.assign({},Xo),t),this.fetch=ya(r)}listBuckets(){return Et(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Q(e))return{data:null,error:e};throw e}})}getBucket(e){return Et(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Et(this,void 0,void 0,function*(){try{return{data:yield xe(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Et(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Et(this,void 0,void 0,function*(){try{return{data:yield xe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Et(this,void 0,void 0,function*(){try{return{data:yield va(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}})}}class ec extends Zo{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new Yo(this.url,this.headers,e,this.fetch)}}const tc="2.57.2";let vr="";typeof Deno!="undefined"?vr="deno":typeof document!="undefined"?vr="web":typeof navigator!="undefined"&&navigator.product==="ReactNative"?vr="react-native":vr="node";const rc={"X-Client-Info":`supabase-js-${vr}/${tc}`},nc={headers:rc},ic={schema:"public"},sc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ac={};var oc=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const cc=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=ca:e=fetch,(...t)=>e(...t)},lc=()=>typeof Headers=="undefined"?la:Headers,uc=(i,e,t)=>{const r=cc(t),n=lc();return(s,o)=>oc(void 0,void 0,void 0,function*(){var c;const a=(c=yield e())!==null&&c!==void 0?c:i;let l=new n(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",i),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),r(s,Object.assign(Object.assign({},o),{headers:l}))})};var dc=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};function hc(i){return i.endsWith("/")?i:i+"/"}function fc(i,e){var t,r;const{db:n,auth:s,realtime:o,global:c}=i,{db:a,auth:l,realtime:u,global:d}=e,f={db:Object.assign(Object.assign({},a),n),auth:Object.assign(Object.assign({},l),s),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),c),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(r=c==null?void 0:c.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>dc(this,void 0,void 0,function*(){return""})};return i.accessToken?f.accessToken=i.accessToken:delete f.accessToken,f}const _a="2.71.1",jt=30*1e3,Un=3,hn=Un*jt,pc="http://localhost:9999",gc="supabase.auth.token",mc={"X-Client-Info":`gotrue-js/${_a}`},Nn="X-Supabase-Api-Version",wa={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},yc=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vc=600*1e3;class Jn extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function C(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class _c extends Jn{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function wc(i){return C(i)&&i.name==="AuthApiError"}class ba extends Jn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Xe extends Jn{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class Ge extends Xe{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function bc(i){return C(i)&&i.name==="AuthSessionMissingError"}class Lr extends Xe{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mr extends Xe{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class jr extends Xe{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Sc(i){return C(i)&&i.name==="AuthImplicitGrantRedirectError"}class yi extends Xe{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Fn extends Xe{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function fn(i){return C(i)&&i.name==="AuthRetryableFetchError"}class vi extends Xe{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class zn extends Xe{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),_i=` 	
\r=`.split(""),Ic=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<_i.length;e+=1)i[_i[e].charCodeAt(0)]=-2;for(let e=0;e<rn.length;e+=1)i[rn[e].charCodeAt(0)]=e;return i})();function wi(i,e,t){if(i!==null)for(e.queue=e.queue<<8|i,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(rn[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(rn[r]),e.queuedBits-=6}}function Sa(i,e,t){const r=Ic[i];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function bi(i){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},s=o=>{Cc(o,r,t)};for(let o=0;o<i.length;o+=1)Sa(i.charCodeAt(o),n,s);return e.join("")}function Ec(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function kc(i,e){for(let t=0;t<i.length;t+=1){let r=i.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(i.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Ec(r,e)}}function Cc(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let r=1;r<6;r+=1)if((i>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Ac(i){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<i.length;n+=1)Sa(i.charCodeAt(n),t,r);return new Uint8Array(e)}function Tc(i){const e=[];return kc(i,t=>e.push(t)),new Uint8Array(e)}function Pc(i){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return i.forEach(n=>wi(n,t,r)),wi(null,t,r),e.join("")}function Oc(i){return Math.round(Date.now()/1e3)+i}function xc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const Se=()=>typeof window!="undefined"&&typeof document!="undefined",rt={tested:!1,writable:!1},Ia=()=>{if(!Se())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch(e){return!1}if(rt.tested)return rt.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),rt.tested=!0,rt.writable=!0}catch(e){rt.tested=!0,rt.writable=!1}return rt.writable};function Dc(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,s)=>{e[s]=n})}catch(r){}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Ea=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>z(()=>g(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>sr);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},$c=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Ut=(i,e,t)=>g(null,null,function*(){yield i.setItem(e,JSON.stringify(t))}),nt=(i,e)=>g(null,null,function*(){const t=yield i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(r){return t}}),Fe=(i,e)=>g(null,null,function*(){yield i.removeItem(e)});class on{constructor(){this.promise=new on.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}on.promiseConstructor=Promise;function pn(i){const e=i.split(".");if(e.length!==3)throw new zn("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!yc.test(e[r]))throw new zn("JWT not in base64url format");return{header:JSON.parse(bi(e[0])),payload:JSON.parse(bi(e[1])),signature:Ac(e[2]),raw:{header:e[0],payload:e[1]}}}function Rc(i){return g(this,null,function*(){return yield new Promise(e=>{setTimeout(()=>e(null),i)})})}function Lc(i,e){return new Promise((r,n)=>{g(null,null,function*(){for(let s=0;s<1/0;s++)try{const o=yield i(s);if(!e(s,null,o)){r(o);return}}catch(o){if(!e(s,o)){n(o);return}}})})}function Mc(i){return("0"+i.toString(16)).substr(-2)}function jc(){const e=new Uint32Array(56);if(typeof crypto=="undefined"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let s=0;s<56;s++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,Mc).join("")}function Uc(i){return g(this,null,function*(){const t=new TextEncoder().encode(i),r=yield crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(s=>String.fromCharCode(s)).join("")})}function Nc(i){return g(this,null,function*(){if(!(typeof crypto!="undefined"&&typeof crypto.subtle!="undefined"&&typeof TextEncoder!="undefined"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=yield Uc(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function kt(i,e,t=!1){return g(this,null,function*(){const r=jc();let n=r;t&&(n+="/PASSWORD_RECOVERY"),yield Ut(i,`${e}-code-verifier`,n);const s=yield Nc(r);return[s,r===s?"plain":"s256"]})}const Fc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function zc(i){const e=i.headers.get(Nn);if(!e||!e.match(Fc))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(t){return null}}function qc(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function Hc(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Bc=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ct(i){if(!Bc.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function gn(){const i={};return new Proxy(i,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Si(i){return JSON.parse(JSON.stringify(i))}var Vc=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};const lt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Gc=[502,503,504];function Ii(i){return g(this,null,function*(){var e;if(!$c(i))throw new Fn(lt(i),0);if(Gc.includes(i.status))throw new Fn(lt(i),i.status);let t;try{t=yield i.json()}catch(s){throw new ba(lt(s),s)}let r;const n=zc(i);if(n&&n.getTime()>=wa["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new vi(lt(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ge}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new vi(lt(t),i.status,t.weak_password.reasons);throw new _c(lt(t),i.status||500,r)})}const Kc=(i,e,t,r)=>{const n={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};function P(i,e,t,r){return g(this,null,function*(){var n;const s=Object.assign({},r==null?void 0:r.headers);s[Nn]||(s[Nn]=wa["2024-01-01"].name),r!=null&&r.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const c=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",a=yield Wc(i,e,t+c,{headers:s,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(a):{data:Object.assign({},a),error:null}})}function Wc(i,e,t,r,n,s){return g(this,null,function*(){const o=Kc(e,r,n,s);let c;try{c=yield i(t,Object.assign({},o))}catch(a){throw console.error(a),new Fn(lt(a),0)}if(c.ok||(yield Ii(c)),r!=null&&r.noResolveJson)return c;try{return yield c.json()}catch(a){yield Ii(a)}})}function Le(i){var e;let t=null;Xc(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=Oc(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function Ei(i){const e=Le(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function We(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function Qc(i){return{data:i,error:null}}function Yc(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:s}=i,o=Vc(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:s},a=Object.assign({},o);return{data:{properties:c,user:a},error:null}}function Jc(i){return i}function Xc(i){return i.access_token&&i.refresh_token&&i.expires_in}const mn=["global","local","others"];var Zc=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};class el{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ea(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r){return g(this,arguments,function*(e,t=mn[0]){if(mn.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${mn.join(", ")}`);try{return yield P(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(C(n))return{data:null,error:n};throw n}})}inviteUserByEmail(r){return g(this,arguments,function*(e,t={}){try{return yield P(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:We})}catch(n){if(C(n))return{data:{user:null},error:n};throw n}})}generateLink(e){return g(this,null,function*(){try{const{options:t}=e,r=Zc(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),yield P(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Yc,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(C(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return g(this,null,function*(){try{return yield P(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:We})}catch(t){if(C(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return g(this,null,function*(){var t,r,n,s,o,c,a;try{const l={nextPage:null,lastPage:0,total:0},u=yield P(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:""},xform:Jc});if(u.error)throw u.error;const d=yield u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,h=(a=(c=u.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&a!==void 0?a:[];return h.length>0&&(h.forEach(m=>{const w=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(m.split(";")[1].split("=")[1]);l[`${S}Page`]=w}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(C(l))return{data:{users:[]},error:l};throw l}})}getUserById(e){return g(this,null,function*(){Ct(e);try{return yield P(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:We})}catch(t){if(C(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return g(this,null,function*(){Ct(e);try{return yield P(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:We})}catch(r){if(C(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return g(this,null,function*(){Ct(e);try{return yield P(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:We})}catch(r){if(C(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return g(this,null,function*(){Ct(e.userId);try{const{data:t,error:r}=yield P(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(C(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return g(this,null,function*(){Ct(e.userId),Ct(e.id);try{return{data:yield P(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}})}}function ki(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function tl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(i){typeof self!="undefined"&&(self.globalThis=self)}}const At={debug:!!(globalThis&&Ia()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ka extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class rl extends ka{}function nl(i,e,t){return g(this,null,function*(){At.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),At.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},n=>g(null,null,function*(){if(n){At.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,n.name);try{return yield t()}finally{At.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,n.name)}}else{if(e===0)throw At.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new rl(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(At.debug)try{const s=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield t()}})))})}tl();const il={url:pc,storageKey:gc,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:mc,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function Ci(i,e,t){return g(this,null,function*(){return yield t()})}const Tt={};class Tr{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Tr.nextInstanceID,Tr.nextInstanceID+=1,this.instanceID>0&&Se()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},il),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new el({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Ea(n.fetch),this.lock=n.lock||Ci,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Se()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=nl:this.lock=Ci,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Ia()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ki(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=ki(this.memoryStorage)),Se()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",s=>g(this,null,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}get jwks(){var e,t;return(t=(e=Tt[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Tt[this.storageKey]=Object.assign(Object.assign({},Tt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Tt[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Tt[this.storageKey]=Object.assign(Object.assign({},Tt[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${_a}) ${new Date().toISOString()}`,...e),this}initialize(){return g(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=g(this,null,function*(){return yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return g(this,null,function*(){var e;try{const t=Dc(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":(yield this._isPKCECallback(t))&&(r="pkce"),Se()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:s}=yield this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),Sc(s)){const a=(e=s.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:s}}return yield this._removeSession(),{error:s}}const{session:o,redirectType:c}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",c),yield this._saveSession(o),setTimeout(()=>g(this,null,function*(){c==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",o):yield this._notifyAllSubscribers("SIGNED_IN",o)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return C(t)?{error:t}:{error:new ba("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return g(this,null,function*(){var t,r,n;try{const s=yield P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:Le}),{data:o,error:c}=s;if(c||!o)return{data:{user:null,session:null},error:c};const a=o.session,l=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(C(s))return{data:{user:null,session:null},error:s};throw s}})}signUp(e){return g(this,null,function*(){var t,r,n;try{let s;if("email"in e){const{email:u,password:d,options:f}=e;let h=null,m=null;this.flowType==="pkce"&&([h,m]=yield kt(this.storage,this.storageKey)),s=yield P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:h,code_challenge_method:m},xform:Le})}else if("phone"in e){const{phone:u,password:d,options:f}=e;s=yield P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Le})}else throw new Mr("You must provide either an email or phone number and a password");const{data:o,error:c}=s;if(c||!o)return{data:{user:null,session:null},error:c};const a=o.session,l=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(C(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithPassword(e){return g(this,null,function*(){try{let t;if("email"in e){const{email:s,password:o,options:c}=e;t=yield P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Ei})}else if("phone"in e){const{phone:s,password:o,options:c}=e;t=yield P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Ei})}else throw new Mr("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Lr}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return g(this,null,function*(){var t,r,n,s;return yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})})}exchangeCodeForSession(e){return g(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>g(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return g(this,null,function*(){const{chain:t}=e;if(t==="solana")return yield this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)})}signInWithSolana(e){return g(this,null,function*(){var t,r,n,s,o,c,a,l,u,d,f,h;let m,w;if("message"in e)m=e.message,w=e.signature;else{const{chain:S,wallet:I,statement:b,options:v}=e;let _;if(Se())if(typeof I=="object")_=I;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))_=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof I!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=I}const E=new URL((t=v==null?void 0:v.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in _&&_.signIn){const k=yield _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},v==null?void 0:v.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),b?{statement:b}:null));let A;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")A=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)A=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)m=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),w=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${E.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(n=(r=v==null?void 0:v.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((s=v==null?void 0:v.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${v.signInWithSolana.notBefore}`]:[],...!((o=v==null?void 0:v.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${v.signInWithSolana.expirationTime}`]:[],...!((c=v==null?void 0:v.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${v.signInWithSolana.chainId}`]:[],...!((a=v==null?void 0:v.signInWithSolana)===null||a===void 0)&&a.nonce?[`Nonce: ${v.signInWithSolana.nonce}`]:[],...!((l=v==null?void 0:v.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${v.signInWithSolana.requestId}`]:[],...!((d=(u=v==null?void 0:v.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...v.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const k=yield _.signMessage(new TextEncoder().encode(m),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=k}}try{const{data:S,error:I}=yield P(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Pc(w)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Le});if(I)throw I;return!S||!S.session||!S.user?{data:{user:null,session:null},error:new Lr}:(S.session&&(yield this._saveSession(S.session),yield this._notifyAllSubscribers("SIGNED_IN",S.session)),{data:Object.assign({},S),error:I})}catch(S){if(C(S))return{data:{user:null,session:null},error:S};throw S}})}_exchangeCodeForSession(e){return g(this,null,function*(){const t=yield nt(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t!=null?t:"").split("/");try{const{data:s,error:o}=yield P(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Le});if(yield Fe(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Lr}:(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:n!=null?n:null}),error:o})}catch(s){if(C(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}})}signInWithIdToken(e){return g(this,null,function*(){try{const{options:t,provider:r,token:n,access_token:s,nonce:o}=e,c=yield P(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Le}),{data:a,error:l}=c;return l?{data:{user:null,session:null},error:l}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Lr}:(a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l})}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return g(this,null,function*(){var t,r,n,s,o;try{if("email"in e){const{email:c,options:a}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=yield kt(this.storage,this.storageKey));const{error:d}=yield P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(r=a==null?void 0:a.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:c,options:a}=e,{data:l,error:u}=yield P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(n=a==null?void 0:a.data)!==null&&n!==void 0?n:{},create_user:(s=a==null?void 0:a.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(o=a==null?void 0:a.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Mr("You must provide either an email or phone number.")}catch(c){if(C(c))return{data:{user:null,session:null},error:c};throw c}})}verifyOtp(e){return g(this,null,function*(){var t,r;try{let n,s;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:c}=yield P(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:n,xform:Le});if(c)throw c;if(!o)throw new Error("An error occurred on token verification.");const a=o.session,l=o.user;return a!=null&&a.access_token&&(yield this._saveSession(a),yield this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(C(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithSSO(e){return g(this,null,function*(){var t,r,n;try{let s=null,o=null;return this.flowType==="pkce"&&([s,o]=yield kt(this.storage,this.storageKey)),yield P(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:o}),headers:this.headers,xform:Qc})}catch(s){if(C(s))return{data:null,error:s};throw s}})}reauthenticate(){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return g(this,null,function*(){try{return yield this._useSession(e=>g(this,null,function*(){const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Ge;const{error:n}=yield P(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}}))}catch(e){if(C(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return g(this,null,function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:s}=e,{error:o}=yield P(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:n,options:s}=e,{data:o,error:c}=yield P(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:c}}throw new Mr("You must provide either an email or phone number and a type")}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return this._useSession(t=>g(this,null,function*(){return t}))}))})}_acquireLock(e,t){return g(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=g(this,null,function*(){return yield r,yield t()});return this.pendingInLock.push(g(this,null,function*(){try{yield n}catch(s){}})),n}return yield this.lock(`lock:${this.storageKey}`,e,()=>g(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push(g(this,null,function*(){try{yield r}catch(n){}})),yield r;this.pendingInLock.length;){const n=[...this.pendingInLock];yield Promise.all(n),this.pendingInLock.splice(0,n.length)}return yield r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return g(this,null,function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}})}__loadSession(){return g(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=yield nt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<hn:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=yield nt(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=gn()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(a,l,u)=>(!o&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,l,u))})}return{data:{session:e},error:null}}const{session:n,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return g(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return g(this,null,function*(){try{return e?yield P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:We}):yield this._useSession(t=>g(this,null,function*(){var r,n,s;const{data:o,error:c}=t;if(c)throw c;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ge}:yield P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0,xform:We})}))}catch(t){if(C(t))return bc(t)&&(yield this._removeSession(),yield Fe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}})}updateUser(r){return g(this,arguments,function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._updateUser(e,t)}))})}_updateUser(r){return g(this,arguments,function*(e,t={}){try{return yield this._useSession(n=>g(this,null,function*(){const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new Ge;const c=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=yield kt(this.storage,this.storageKey));const{data:u,error:d}=yield P(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:c.access_token,xform:We});if(d)throw d;return c.user=u.user,yield this._saveSession(c),yield this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}}))}catch(n){if(C(n))return{data:{user:null},error:n};throw n}})}setSession(e){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return g(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Ge;const t=Date.now()/1e3;let r=t,n=!0,s=null;const{payload:o}=pn(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{session:c,error:a}=yield this._callRefreshToken(e.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!c)return{data:{user:null,session:null},error:null};s=c}else{const{data:c,error:a}=yield this._getUser(e.access_token);if(a)throw a;s={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(s),yield this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(C(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;if(!e){const{data:o,error:c}=t;if(c)throw c;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ge;const{session:n,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromURL(e,t){return g(this,null,function*(){try{if(!Se())throw new jr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new jr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new yi("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new jr("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new yi("No code detected.");const{data:b,error:v}=yield this._exchangeCodeForSession(e.code);if(v)throw v;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:s,refresh_token:o,expires_in:c,expires_at:a,token_type:l}=e;if(!s||!c||!o||!l)throw new jr("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(c);let f=u+d;a&&(f=parseInt(a));const h=f-u;h*1e3<=jt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const m=f-d;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,f,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,f,u);const{data:w,error:S}=yield this._getUser(s);if(S)throw S;const I={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:d,expires_at:f,refresh_token:o,token_type:l,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:I,redirectType:e.type},error:null}}catch(r){if(C(r))return{data:{session:null,redirectType:null},error:r};throw r}})}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}_isPKCECallback(e){return g(this,null,function*(){const t=yield nt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)})}signOut(){return g(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return g(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;if(s)return{error:s};const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:c}=yield this.admin.signOut(o,e);if(c&&!(wc(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(yield this._removeSession(),yield Fe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){const t=xc(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),g(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){this._emitInitialSession(t)}))}),{data:{subscription:r}}}_emitInitialSession(e){return g(this,null,function*(){return yield this._useSession(t=>g(this,null,function*(){var r,n;try{const{data:{session:s},error:o}=t;if(o)throw o;yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){yield(n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}}))})}resetPasswordForEmail(r){return g(this,arguments,function*(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=yield kt(this.storage,this.storageKey,!0));try{return yield P(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(C(o))return{data:null,error:o};throw o}})}getUserIdentities(){return g(this,null,function*(){var e;try{const{data:t,error:r}=yield this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}})}linkIdentity(e){return g(this,null,function*(){var t;try{const{data:r,error:n}=yield this._useSession(s=>g(this,null,function*(){var o,c,a,l,u;const{data:d,error:f}=s;if(f)throw f;const h=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return yield P(this.fetch,"GET",h,{headers:this.headers,jwt:(u=(l=d.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})}));if(n)throw n;return Se()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(C(r))return{data:{provider:e.provider,url:null},error:r};throw r}})}unlinkIdentity(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r,n;const{data:s,error:o}=t;if(o)throw o;return yield P(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})}))}catch(t){if(C(t))return{data:null,error:t};throw t}})}_refreshAccessToken(e){return g(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield Lc(n=>g(this,null,function*(){return n>0&&(yield Rc(200*Math.pow(2,n-1))),this._debug(t,"refreshing attempt",n),yield P(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Le})}),(n,s)=>{const o=200*Math.pow(2,n);return s&&fn(s)&&Date.now()+o-r<jt})}catch(r){if(this._debug(t,"error",r),C(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return g(this,null,function*(){const r=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Se()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){return g(this,null,function*(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=yield nt(this.storage,this.storageKey);if(n&&this.userStorage){let o=yield nt(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},yield Ut(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:gn()}else if(n&&!n.user&&!n.user){const o=yield nt(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,yield Fe(this.storage,this.storageKey+"-user"),yield Ut(this.storage,this.storageKey,n)):n.user=gn()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&(yield this._removeSession());return}const s=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<hn;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${hn}s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=yield this._callRefreshToken(n.refresh_token);o&&(console.error(o),fn(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:c}=yield this._getUser(n.access_token);!c&&(o!=null&&o.user)?(n.user=o.user,yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else yield this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}})}_callRefreshToken(e){return g(this,null,function*(){var t,r;if(!e)throw new Ge;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new on;const{data:s,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new Ge;yield this._saveSession(s.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const c={session:s.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(s){if(this._debug(n,"error",s),C(s)){const o={session:null,error:s};return fn(s)||(yield this._removeSession()),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(n,"end")}})}_notifyAllSubscribers(e,t,r=!0){return g(this,null,function*(){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(c=>g(this,null,function*(){try{yield c.callback(e,t)}catch(a){s.push(a)}}));if(yield Promise.all(o),s.length>0){for(let c=0;c<s.length;c+=1)console.error(s[c]);throw s[0]}}finally{this._debug(n,"end")}})}_saveSession(e){return g(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&(yield Ut(this.userStorage,this.storageKey+"-user",{user:t.user}));const n=Object.assign({},t);delete n.user;const s=Si(n);yield Ut(this.storage,this.storageKey,s)}else{const n=Si(t);yield Ut(this.storage,this.storageKey,n)}})}_removeSession(){return g(this,null,function*(){this._debug("#_removeSession()"),yield Fe(this.storage,this.storageKey),yield Fe(this.storage,this.storageKey+"-code-verifier"),yield Fe(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Fe(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Se()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return g(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),jt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno!="undefined"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(()=>g(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return g(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return g(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return g(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return g(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>g(this,null,function*(){try{const e=Date.now();try{return yield this._useSession(t=>g(this,null,function*(){const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/jt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${jt}ms, refresh threshold is ${Un} ticks`),n<=Un&&(yield this._callRefreshToken(r.refresh_token))}))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(e.isAcquireTimeout||e instanceof ka)this._debug("auto refresh token tick lock not available");else throw e}})}_handleVisibilityChange(){return g(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!Se()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>g(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return g(this,null,function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t,r){return g(this,null,function*(){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,o]=yield kt(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(c.toString())}if(r!=null&&r.queryParams){const s=new URLSearchParams(r.queryParams);n.push(s.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`})}_unenroll(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;return s?{data:null,error:s}:yield P(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(C(t))return{data:null,error:t};throw t}})}_enroll(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r,n;const{data:s,error:o}=t;if(o)return{data:null,error:o};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=yield P(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((n=a==null?void 0:a.totp)===null||n===void 0)&&n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(t){if(C(t))return{data:null,error:t};throw t}})}_verify(e){return g(this,null,function*(){return this._acquireLock(-1,()=>g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;if(s)return{data:null,error:s};const{data:o,error:c}=yield P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:c})}))}catch(t){if(C(t))return{data:null,error:t};throw t}}))})}_challenge(e){return g(this,null,function*(){return this._acquireLock(-1,()=>g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;return s?{data:null,error:s}:yield P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(C(t))return{data:null,error:t};throw t}}))})}_challengeAndVerify(e){return g(this,null,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return g(this,null,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),s=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:n,phone:s},error:null}})}_getAuthenticatorAssuranceLevel(){return g(this,null,function*(){return this._acquireLock(-1,()=>g(this,null,function*(){return yield this._useSession(e=>g(this,null,function*(){var t,r;const{data:{session:n},error:s}=e;if(s)return{data:null,error:s};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=pn(n.access_token);let c=null;o.aal&&(c=o.aal);let a=c;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const u=o.amr||[];return{data:{currentLevel:c,nextLevel:a,currentAuthenticationMethods:u},error:null}}))}))})}fetchJwk(r){return g(this,arguments,function*(e,t={keys:[]}){let n=t.keys.find(a=>a.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+vc>s)return n;const{data:o,error:c}=yield P(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(a=>a.kid===e),!n)?null:n})}getClaims(r){return g(this,arguments,function*(e,t={}){try{let n=e;if(!n){const{data:m,error:w}=yield this.getSession();if(w||!m.session)return{data:null,error:w};n=m.session.access_token}const{header:s,payload:o,signature:c,raw:{header:a,payload:l}}=pn(n);t!=null&&t.allowExpired||qc(o.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:yield this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:m}=yield this.getUser(n);if(m)throw m;return{data:{claims:o,header:s,signature:c},error:null}}const d=Hc(s.alg),f=yield crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!(yield crypto.subtle.verify(d,f,c,Tc(`${a}.${l}`))))throw new zn("Invalid JWT signature");return{data:{claims:o,header:s,signature:c},error:null}}catch(n){if(C(n))return{data:null,error:n};throw n}})}}Tr.nextInstanceID=0;const sl=Tr;class al extends sl{constructor(e){super(e)}}var ol=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};class cl{constructor(e,t,r){var n,s,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=hc(e),a=new URL(c);this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,u={db:ic,realtime:ac,auth:Object.assign(Object.assign({},sc),{storageKey:l}),global:nc},d=fc(r!=null?r:{},u);this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=uc(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Eo(new URL("rest/v1",a).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new ec(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new po(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ol(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:o,flowType:c,lock:a,debug:l},u,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new al({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,flowType:c,lock:a,debug:l,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(h=>h.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new zo(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ll=(i,e,t)=>new cl(i,e,t);function ul(){if(typeof window!="undefined"||typeof process=="undefined")return!1;const i=process.version;if(i==null)return!1;const e=i.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}ul()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const dl="",hl="";console.debug=()=>{},console.info=()=>{},console.warn=()=>{};const y=ll(dl,hl,{auth:{persistSession:!0,autoRefreshToken:!0}}),fl=i=>(i?console.info(` Using facility scope: ${i}`):console.warn(" Missing facilityId  using default Supabase client"),y),pl=Object.freeze(Object.defineProperty({__proto__:null,getScopedClient:fl,supabase:y},Symbol.toStringTag,{value:"Module"})),Ai={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},gl=()=>"INFO",Ca=gl(),Ae=i=>Ai[i]<=Ai[Ca],R={error:(i,...e)=>{Ae("ERROR")&&console.error(i,...e)},warn:(i,...e)=>{Ae("WARN")&&console.warn(i,...e)},info:(i,...e)=>{Ae("INFO")&&console.info(i,...e)},debug:(i,...e)=>{Ae("DEBUG")&&console.log(i,...e)},verbose:(i,...e)=>{Ae("VERBOSE")&&console.log(i,...e)},perf:(i,...e)=>{Ae("DEBUG")&&console.log(`[PERF] ${i}`,...e)},security:(i,...e)=>{Ae("INFO")&&console.log(`[SECURITY] ${i}`,...e)},audit:(i,...e)=>{Ae("INFO")&&console.log(`[AUDIT] ${i}`,...e)},realtime:(i,...e)=>{Ae("DEBUG")&&console.log(i,...e)},getLevel:()=>Ca,isEnabled:i=>Ae(i)};var Xr={};const fe=(i,e="")=>{if(typeof process!="undefined"&&(process!=null&&Xr)&&i in Xr)return Xr[i];if(typeof window!="undefined"&&window.env&&i in window.env)return window.env[i];if(e===void 0)throw new Error(`Missing required env var: ${i}`);return e},kr=()=>{var i;return typeof process!="undefined"&&((i=process==null?void 0:Xr)==null?void 0:i.NODE_ENV)==="development"},Up=()=>typeof window!="undefined";class qt{constructor(){}static getInstance(){return qt.instance||(qt.instance=new qt),qt.instance}getDefaultFacilityId(){const e=fe("VITE_DEFAULT_FACILITY_ID","");if(e)return e;throw new Error("VITE_DEFAULT_FACILITY_ID environment variable must be set in production")}isValidFacilityId(e){return!e||e.trim()===""?!1:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}getOAuthFacilityConfig(){return{facility_id:this.getDefaultFacilityId()}}}const ml=qt.getInstance();var yn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Aa=x.createContext(void 0),Np=({children:i})=>{const[e,t]=x.useState(null),[r,n]=x.useState(!1),[s,o]=x.useState(!1),[c,a]=x.useState(!1),[l,u]=x.useState(0),d=1800*1e3,f=()=>e?!e.name||e.name.trim()===""?e.email||"Unknown User":e.name:"Unknown User",h=I=>{console.log(" UserContext: handleSetCurrentUser called with:",I?`${I.name} (${I.email})`:"null"),t(I),I?(localStorage.setItem("currentUser",JSON.stringify(I)),u(Date.now())):(localStorage.removeItem("currentUser"),u(0))},m=x.useCallback(()=>yn(null,null,function*(){if(r)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log(" UserContext: No auth token found, skipping refreshUserData");return}console.log(" UserContext: Starting refreshUserData...");const b=Date.now();if(e&&b-l<d){R.info(" UserContext: Using cached user data"),a(!0);return}try{n(!0),R.info(" UserContext: Starting user data refresh...");const{data:{session:v}}=yield y.auth.getSession();if(!v){R.info(" UserContext: No active Supabase session, skipping refresh"),a(!0);return}const _=new Promise((k,A)=>{setTimeout(()=>A(new Error("User data fetch timeout")),5e3)}),E=yn(null,null,function*(){var k,A;const N=Date.now(),{data:{user:D},error:Ce}=yield y.auth.getUser();if(Ce){console.error(" UserContext: Auth error:",Ce);return}if(!D){R.info(" UserContext: No authenticated user found");return}R.info(" UserContext: Found authenticated user:",D.id);const se=Date.now()-N;R.info(` UserContext: Auth fetch took ${se}ms`);const Ne=Date.now(),{data:q,error:$e}=yield y.from("users").select("*").eq("id",D.id).single();if($e){if(console.error(" UserContext: Failed to fetch user profile:",$e),$e.code==="PGRST116"){console.log(" UserContext: Creating missing user profile...");const{error:tt}=yield y.from("users").insert({id:D.id,email:D.email,first_name:D.email.split("@")[0],last_name:"",role:"user",facility_id:ml.getDefaultFacilityId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(tt){console.error(" UserContext: Failed to create user profile:",tt);return}console.log(" UserContext: User profile created successfully");const{data:le}=yield y.from("users").select("*").eq("id",D.id).single();if(le){const vt={id:le.id,name:`${le.first_name||""} ${le.last_name||""}`.trim()||((k=le.email)==null?void 0:k.split("@")[0])||"User",email:le.email,role:le.role,avatar_url:le.avatar_url,facility_id:le.facility_id};h(vt);return}}return}const yt=Date.now()-Ne;if(R.info(` UserContext: Profile fetch took ${yt}ms`),R.info(` UserContext: Total fetch time: ${Date.now()-N}ms`),q){const tt={id:q.id,name:`${q.first_name||""} ${q.last_name||""}`.trim()||((A=q.email)==null?void 0:A.split("@")[0])||"User",email:q.email,role:q.role,avatar_url:q.avatar_url,facility_id:q.facility_id},le={admin:"Administrator",manager:"Manager",user:"User",viewer:"Viewer"},vt=typeof q.role=="string"?q.role:"user";tt.role=le[vt]||vt,t(tt),u(b)}});yield Promise.race([E,_])}catch(v){v instanceof Error&&v.message.includes("timeout")&&R.warn(" UserContext: User data fetch timed out, this may indicate database performance issues"),console.error(" UserContext: Error refreshing user data:",v)}finally{n(!1),a(!0)}}),[r,e,l,d]),w=x.useCallback(()=>{console.log(" UserContext: Starting clearUserData..."),R.info(" UserContext: Clearing all user data on logout"),t(null),o(!1),a(!1),u(0),n(!1),["currentUser","userProfile","userData","user_preferences","sb-user","user_data"].forEach(v=>{const _=localStorage.getItem(v);_&&(console.log(` Clearing localStorage.${v}:`,_.substring(0,100)+"..."),localStorage.removeItem(v))}),["currentUser","userProfile","userData","user_preferences","user_id","user_email","user_role"].forEach(v=>{const _=sessionStorage.getItem(v);_&&(console.log(` Clearing sessionStorage.${v}:`,_.substring(0,100)+"..."),sessionStorage.removeItem(v))}),console.log(" UserContext: clearUserData completed"),R.info(" UserContext: All user data cleared successfully")},[]),S=x.useCallback(()=>yn(null,null,function*(){if(s||r)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log(" UserContext: No auth token found, skipping initializeUserContext");return}R.info(" UserContext: Starting user data refresh..."),yield m(),o(!0)}),[s,r,m]);return p.jsx(Aa.Provider,{value:{currentUser:e,setCurrentUser:h,getUserDisplayName:f,refreshUserData:m,initializeUserContext:S,clearUserData:w,isLoading:r},children:i})},yl=()=>{const i=x.useContext(Aa);if(!i)throw new Error("useUser must be used within a UserProvider");return i};var Ti={},qn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});let Zr=null;const nn=typeof window!="undefined",vl=()=>qn(null,null,function*(){if(!nn)try{const{createClient:i}=yield z(()=>import("./redisClient.server-BqOPz1NQ.js"),__vite__mapDeps([0,1,2,3,4]));Zr=i}catch(i){}});nn||vl();class _l{constructor(e){this.client=null,this.isConnected=!1,this.config=e}connect(){return qn(this,null,function*(){if(!this.isConnected){if(nn){R.warn("Redis not available in browser environment, using in-memory fallback");return}if(Zr||(yield new Promise(e=>setTimeout(e,100))),!Zr){R.warn("Redis not available, using in-memory fallback");return}try{this.client=Zr({socket:{host:this.config.host,port:this.config.port,reconnectStrategy:e=>e>10?(R.error("Redis connection failed after 10 retries"),new Error("Redis connection failed")):Math.min(e*100,3e3)},password:this.config.password,database:this.config.db||0}),this.client.on("error",e=>{R.error("Redis client error:",e),this.isConnected=!1}),this.client.on("connect",()=>{R.info("Redis client connected"),this.isConnected=!0}),this.client.on("disconnect",()=>{R.warn("Redis client disconnected"),this.isConnected=!1}),yield this.client.connect()}catch(e){throw R.error("Failed to connect to Redis:",e),e}}})}disconnect(){return qn(this,null,function*(){this.client&&this.isConnected&&(yield this.client.disconnect(),this.isConnected=!1)})}getClient(){if(!this.client||!this.isConnected)throw new Error("Redis client not connected");return this.client}isHealthy(){return nn?!1:this.isConnected&&this.client!==null}}const Ur=(i,e)=>typeof process!="undefined"&&Ti&&Ti[i]||e,wl={host:Ur("REDIS_HOST","localhost"),port:parseInt(Ur("REDIS_PORT","6379")),password:Ur("REDIS_PASSWORD",""),db:parseInt(Ur("REDIS_DB","0")),retryDelayOnFailover:100,maxRetriesPerRequest:3},it=new _l(wl);var Ht=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function bl(){return Ht(this,null,function*(){var i,e,t,r;try{const{data:{user:n},error:s}=yield y.auth.getUser();return{userId:(i=n==null?void 0:n.id)!=null?i:null,facilityId:(t=(e=n==null?void 0:n.user_metadata)==null?void 0:e.facility_id)!=null?t:null,authError:(r=s==null?void 0:s.message)!=null?r:null}}catch(n){return{userId:null,facilityId:null,authError:"context_fetch_failed"}}})}function Nr(i,e,t,r){return Ht(this,null,function*(){try{const n=yield bl(),s={type:i,severity:e,message:t,user_id:n.userId,facility_id:n.facilityId,context:r!=null?r:null,created_at:new Date().toISOString()},{error:o}=yield y.from("app_events").insert([s]);return o?((fe("NODE_ENV")==="development"||fe("MODE")==="development")&&console.warn(" observabilityService: insert failed (likely missing table)",o.message),{success:!1,error:o.message}):{success:!0}}catch(n){return(fe("NODE_ENV")==="development"||fe("MODE")==="development")&&console.warn(" observabilityService: unexpected error",n instanceof Error?n.message:String(n)),{success:!1,error:String(n)}}})}const Sl={logSecurityEvent(i,e,t){return Ht(this,null,function*(){return Nr(i,"warning",e,t)})},logCritical(i,e){return Ht(this,null,function*(){return Nr("app.error","critical",i,e)})},logError(i,e){return Ht(this,null,function*(){return Nr("app.error","error",i,e)})},logInfo(i,e,t){return Ht(this,null,function*(){return Nr(i,"info",e,t)})}};var Il=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class El extends ri.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){return Il(this,null,function*(){console.error(" Global Error Boundary caught:",e,t),this.props.onError&&this.props.onError(e,t),yield Sl.logCritical("Global React component crash",{error:e.message,stack:e.stack,componentStack:t.componentStack})})}render(){if(this.state.hasError){if(this.props.fallback){if(ri.isValidElement(this.props.fallback))return this.props.fallback;{const e=this.props.fallback;return p.jsx(e,{error:this.state.error,errorInfo:void 0})}}return p.jsxs("div",{className:"p-6 text-center text-red-700 bg-red-50 rounded-xl",children:[p.jsx("h2",{className:"font-semibold mb-2",children:"Something went wrong."}),p.jsx("p",{className:"text-sm opacity-75",children:"The team has been notified and is investigating."})]})}return this.props.children}}var Pi,Oi;const kl=(Pi="")!=null?Pi:"",Cl=(Oi="")!=null?Oi:"",Ta=()=>({url:kl,anonKey:Cl}),Pr=()=>{function i(){let r=fe("VITE_SUPABASE_URL",""),n=fe("VITE_SUPABASE_ANON_KEY","");if(!r||!n){const s=Ta();r=s.url,n=s.anonKey}return{supabaseUrl:r,supabaseAnonKey:n}}const{supabaseUrl:e,supabaseAnonKey:t}=i();return!!(e&&t&&e!=="https://mock.supabase.co")},Al=()=>{function i(){let t=fe("VITE_SUPABASE_URL",""),r=fe("VITE_SUPABASE_ANON_KEY","");if(!t||!r){const n=Ta();t=n.url,r=n.anonKey}return{supabaseUrl:t,supabaseAnonKey:r}}const{supabaseUrl:e}=i();return e||""},Pa=i=>typeof i=="string"?new Error(i):i!=null&&i.message?new Error(i.message):typeof i=="object"&&"error_description"in i&&i.error_description?new Error(i.error_description):new Error("An unexpected error occurred with Supabase"),Fp=Object.freeze(Object.defineProperty({__proto__:null,getSupabaseUrl:Al,handleSupabaseError:Pa,isSupabaseConfigured:Pr,supabase:y},Symbol.toStringTag,{value:"Module"}));class Oa{static subscribe(e,t,r){const n=(r==null?void 0:r.event)||"*",s=y.channel(e).on("postgres_changes",{event:n,schema:"public"},t).subscribe();return this.subscriptions.push(s),()=>{this.unsubscribe(s)}}static unsubscribe(e){e&&typeof e=="object"&&"unsubscribe"in e&&e.unsubscribe(),this.subscriptions=this.subscriptions.filter(t=>t!==e)}static forceCleanup(){this.subscriptions.forEach(e=>{e&&typeof e=="object"&&"unsubscribe"in e&&e.unsubscribe()}),this.subscriptions=[]}static getStats(){return{activeChannels:this.subscriptions.length,totalChannels:this.subscriptions.length,totalSubscribers:this.subscriptions.length,tableSubscribers:{},subscriptions:this.subscriptions,performance:{isHealthy:this.subscriptions.length<50,warnings:this.subscriptions.length>30?["High subscription count"]:[],recommendations:this.subscriptions.length>20?["Consider cleanup"]:[]}}}static cleanup(){this.forceCleanup()}static globalCleanup(){this.forceCleanup()}static nuclearCleanup(){console.warn(" NUCLEAR CLEANUP: Force-disconnecting all realtime connections"),this.forceCleanup()}}Oa.subscriptions=[];function zp(i){return L({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"},child:[]}]})(i)}function qp(i){return L({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M425.7 256c-16.9 0-32.8-9-41.4-23.4L320 126l-64.2 106.6c-8.7 14.5-24.6 23.5-41.5 23.5-4.5 0-9-.6-13.3-1.9L64 215v178c0 14.7 10 27.5 24.2 31l216.2 54.1c10.2 2.5 20.9 2.5 31 0L551.8 424c14.2-3.6 24.2-16.4 24.2-31V215l-137 39.1c-4.3 1.3-8.8 1.9-13.3 1.9zm212.6-112.2L586.8 41c-3.1-6.2-9.8-9.8-16.7-8.9L320 64l91.7 152.1c3.8 6.3 11.4 9.3 18.5 7.3l197.9-56.5c9.9-2.9 14.7-13.9 10.2-23.1zM53.2 41L1.7 143.8c-4.6 9.2.3 20.2 10.1 23l197.9 56.5c7.1 2 14.7-1 18.5-7.3L320 64 69.8 32.1c-6.9-.8-13.5 2.7-16.6 8.9z"},child:[]}]})(i)}function Hp(i){return L({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M256.47 216.77l86.73 109.18s-16.6 102.36-76.57 150.12C206.66 523.85 0 510.19 0 510.19s3.8-23.14 11-55.43l94.62-112.17c3.97-4.7-.87-11.62-6.65-9.5l-60.4 22.09c14.44-41.66 32.72-80.04 54.6-97.47 59.97-47.76 163.3-40.94 163.3-40.94zM636.53 31.03l-19.86-25c-5.49-6.9-15.52-8.05-22.41-2.56l-232.48 177.8-34.14-42.97c-5.09-6.41-15.14-5.21-18.59 2.21l-25.33 54.55 86.73 109.18 58.8-12.45c8-1.69 11.42-11.2 6.34-17.6l-34.09-42.92 232.48-177.8c6.89-5.48 8.04-15.53 2.55-22.44z"},child:[]}]})(i)}function Bp(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M511.988 288.9c-.478 17.43-15.217 31.1-32.653 31.1H424v16c0 21.864-4.882 42.584-13.6 61.145l60.228 60.228c12.496 12.497 12.496 32.758 0 45.255-12.498 12.497-32.759 12.496-45.256 0l-54.736-54.736C345.886 467.965 314.351 480 280 480V236c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v244c-34.351 0-65.886-12.035-90.636-32.108l-54.736 54.736c-12.498 12.497-32.759 12.496-45.256 0-12.496-12.497-12.496-32.758 0-45.255l60.228-60.228C92.882 378.584 88 357.864 88 336v-16H32.666C15.23 320 .491 306.33.013 288.9-.484 270.816 14.028 256 32 256h56v-58.745l-46.628-46.628c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0L141.255 160h229.489l54.627-54.627c12.498-12.497 32.758-12.497 45.256 0 12.496 12.497 12.496 32.758 0 45.255L424 197.255V256h56c17.972 0 32.484 14.816 31.988 32.9zM257 0c-61.856 0-112 50.144-112 112h224C369 50.144 318.856 0 257 0z"},child:[]}]})(i)}function Vp(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(i)}function Gp(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z"},child:[]}]})(i)}function st(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(i)}function Kp(i){return L({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(i)}function Wp(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(i)}function Qp(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(i)}function Yp(i){return L({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"},child:[]}]})(i)}function Jp(i){return L({attr:{viewBox:"0 0 288 512"},child:[{tag:"path",attr:{d:"M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"},child:[]}]})(i)}function Xp(i){return L({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(i)}function Xn(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(i)}function Zp(i){return L({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(i)}function eg(i){return L({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M216 23.86c0-23.8-30.65-32.77-44.15-13.04C48 191.85 224 200 224 288c0 35.63-29.11 64.46-64.85 63.99-35.17-.45-63.15-29.77-63.15-64.94v-85.51c0-21.7-26.47-32.23-41.43-16.5C27.8 213.16 0 261.33 0 320c0 105.87 86.13 192 192 192s192-86.13 192-192c0-170.29-168-193-168-296.14z"},child:[]}]})(i)}function tg(i){return L({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M437.2 403.5L320 215V64h8c13.3 0 24-10.7 24-24V24c0-13.3-10.7-24-24-24H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h8v151L10.8 403.5C-18.5 450.6 15.3 512 70.9 512h306.2c55.7 0 89.4-61.5 60.1-108.5zM137.9 320l48.2-77.6c3.7-5.2 5.8-11.6 5.8-18.4V64h64v160c0 6.9 2.2 13.2 5.8 18.4l48.2 77.6h-172z"},child:[]}]})(i)}function rg(i){return L({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(i)}function Tl(i){return L({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(i)}function ng(i){return L({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},child:[]}]})(i)}function ig(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(i)}function sg(i){return L({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(i)}function ag(i){return L({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M501.1 395.7L384 278.6c-23.1-23.1-57.6-27.6-85.4-13.9L192 158.1V96L64 0 0 64l96 128h62.1l106.6 106.6c-13.6 27.8-9.2 62.3 13.9 85.4l117.1 117.1c14.6 14.6 38.2 14.6 52.7 0l52.7-52.7c14.5-14.6 14.5-38.2 0-52.7zM331.7 225c28.3 0 54.9 11 74.9 31l19.4 19.4c15.8-6.9 30.8-16.5 43.8-29.5 37.1-37.1 49.7-89.3 37.9-136.7-2.2-9-13.5-12.1-20.1-5.5l-74.4 74.4-67.9-11.3L334 98.9l74.4-74.4c6.6-6.6 3.4-17.9-5.7-20.2-47.4-11.7-99.6.9-136.6 37.9-28.5 28.5-41.9 66.1-41.2 103.6l82.1 82.1c8.1-1.9 16.5-2.9 24.7-2.9zm-103.9 82l-56.7-56.7L18.7 402.8c-25 25-25 65.5 0 90.5s65.5 25 90.5 0l123.6-123.6c-7.6-19.9-9.9-41.6-5-62.7zM64 472c-13.2 0-24-10.8-24-24 0-13.3 10.7-24 24-24s24 10.7 24 24c0 13.2-10.7 24-24 24z"},child:[]}]})(i)}function og(i){return L({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 35.7 22.5 72.4 61.9 100.7 31.5 22.7 69.8 37.1 110 41.7C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6c40.3-4.6 78.6-19 110-41.7 39.3-28.3 61.9-65 61.9-100.7V88c0-13.3-10.7-24-24-24zM99.3 192.8C74.9 175.2 64 155.6 64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-15.1-5.2-29.2-12.4-41.7-21.4zM512 144c0 16.1-17.7 36.1-35.3 48.8-12.5 9-26.7 16.2-41.8 21.4 7-25 11.8-53.6 12.8-86.2H512v16z"},child:[]}]})(i)}function cg(i){return L({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(i)}function Pl(i){return L({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(i)}function lg(i){return L({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(i)}var ze=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class xa{constructor(e={}){const t=fe("VITE_SUPABASE_URL",""),r=e.baseUrl||(t?`${t}/functions/v1/auth-login-simple`:"/api/auth-login-simple");this.config={baseUrl:r,timeout:e.timeout||3e4,retryAttempts:e.retryAttempts||3}}generateCSRFToken(){const e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}storeCSRFToken(e){try{sessionStorage.setItem("csrf_token",e)}catch(t){console.warn("Failed to store CSRF token:",t)}}getStoredCSRFToken(){try{return sessionStorage.getItem("csrf_token")}catch(e){return console.warn("Failed to retrieve CSRF token:",e),null}}validateCSRFToken(e,t){return t?e===t:!1}secureLogin(e){return ze(this,null,function*(){const t=performance.now();try{console.log(" Using direct Supabase authentication");const r=y,{data:n,error:s}=yield r.auth.signInWithPassword({email:e.email.trim().toLowerCase(),password:e.password});if(s)throw new Error(s.message);if(!n.user||!n.session)throw new Error("Authentication failed - no user or session returned");const c={success:!0,data:{accessToken:n.session.access_token,refreshToken:n.session.refresh_token,expiresIn:n.session.expires_in,user:{id:n.user.id,email:n.user.email,role:"user"}}};return kr()&&console.log(`[PERF] SecureAuthService: Direct Supabase login completed in ${(performance.now()-t).toFixed(2)}ms`),c}catch(r){return console.error(`[AUTH] Login failed for ${e.email}:`,r),{success:!1,error:r instanceof Error?r.message:"Authentication failed"}}})}makeSecureRequest(e){return ze(this,null,function*(){const t=new AbortController,r=setTimeout(()=>t.abort(),this.config.timeout);try{const n=yield fetch(this.config.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:t.signal,credentials:"same-origin"});if(clearTimeout(r),!n.ok){const o=yield n.json().catch(()=>({}));if(n.status===429)return{success:!1,error:o.message||"Too many login attempts. Please try again later.",rateLimitInfo:o.rateLimitInfo};if(n.status===401)return{success:!1,error:o.message||"Invalid email or password"};throw new Error(o.message||`HTTP ${n.status}: ${n.statusText}`)}return yield n.json()}catch(n){throw clearTimeout(r),n.name==="AbortError"?new Error("Request timeout. Please check your connection and try again."):n}})}storeTokens(e){try{sessionStorage.setItem("access_token",e.accessToken),sessionStorage.setItem("refresh_token",e.refreshToken),sessionStorage.setItem("token_expires",(Date.now()+e.expiresIn*1e3).toString()),y.auth.setSession({access_token:e.accessToken,refresh_token:e.refreshToken})}catch(t){throw console.error("Failed to store authentication tokens:",t),new Error("Failed to store authentication tokens")}}validateStoredToken(){return ze(this,null,function*(){try{const e=sessionStorage.getItem("access_token"),t=sessionStorage.getItem("token_expires");return!e||!t?!1:Date.now()>parseInt(t)?yield this.refreshToken():!0}catch(e){return console.error("Token validation failed:",e),!1}})}refreshToken(){return ze(this,null,function*(){try{const e=sessionStorage.getItem("refresh_token");if(!e)return!1;const{data:t,error:r}=yield y.auth.refreshSession({refresh_token:e});return r||!t.session?(yield this.clearTokens(),!1):(this.storeTokens({accessToken:t.session.access_token,refreshToken:t.session.refresh_token,expiresIn:t.session.expires_in}),!0)}catch(e){return console.error("Token refresh failed:",e),yield this.clearTokens(),!1}})}clearTokens(){return ze(this,null,function*(){try{sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),sessionStorage.removeItem("token_expires"),sessionStorage.removeItem("csrf_token"),yield y.auth.signOut()}catch(e){console.error("Failed to clear tokens:",e)}})}getCurrentUser(){return ze(this,null,function*(){try{if(!(yield this.validateStoredToken()))return null;const{data:{user:t}}=yield y.auth.getUser();return t}catch(e){return console.error("Failed to get current user:",e),null}})}validateToken(e){return ze(this,null,function*(){try{if(e){const{data:t,error:r}=yield y.auth.getUser(e);return!r&&!!t.user}else return yield this.validateStoredToken()}catch(t){return console.error("Token validation failed:",t),!1}})}logout(){return ze(this,null,function*(){try{yield this.clearTokens(),console.log("[AUTH] Logout completed successfully")}catch(e){throw console.error("[AUTH] Logout error:",e),e}})}}new xa;const je=({className:i="",children:e})=>p.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${i}`,"aria-label":"Loading content",role:"status",children:e}),ug=({className:i=""})=>p.jsxs("div",{className:`bg-white rounded-lg shadow-sm p-6 ${i}`,children:[p.jsx(je,{className:"h-4 w-3/4 mb-4"}),p.jsx(je,{className:"h-8 w-1/2 mb-2"}),p.jsx(je,{className:"h-3 w-full mb-1"}),p.jsx(je,{className:"h-3 w-2/3"})]}),dg=({rows:i=5,columns:e=4})=>p.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[p.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:p.jsx("div",{className:"flex space-x-4",children:Array.from({length:e}).map((t,r)=>p.jsx(je,{className:"h-4 flex-1"},`header-${r}`))})}),p.jsx("div",{className:"divide-y divide-gray-200",children:Array.from({length:i}).map((t,r)=>p.jsx("div",{className:"px-6 py-4",children:p.jsx("div",{className:"flex space-x-4",children:Array.from({length:e}).map((n,s)=>p.jsx(je,{className:"h-4 flex-1"},`cell-${r}-${s}`))})},`row-${r}`))})]}),hg=()=>p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex space-x-2",children:[p.jsx(je,{className:"h-10 flex-1"}),p.jsx(je,{className:"h-10 w-20"})]}),p.jsx("div",{className:"flex space-x-2",children:Array.from({length:4}).map((i,e)=>p.jsx(je,{className:"h-8 w-16"},e))})]}),Ol=({size:i="md"})=>{const e={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return p.jsx("div",{className:"flex justify-center items-center p-4",children:p.jsx("div",{className:`animate-spin rounded-full border-4 border-t-transparent border-blue-500 ${e[i]}`,role:"status","aria-label":"Loading"})})};var xl=Object.defineProperty,xi=Object.getOwnPropertySymbols,Dl=Object.prototype.hasOwnProperty,$l=Object.prototype.propertyIsEnumerable,Di=(i,e,t)=>e in i?xl(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,at=(i,e)=>{for(var t in e||(e={}))Dl.call(e,t)&&Di(i,t,e[t]);if(xi)for(var t of xi(e))$l.call(e,t)&&Di(i,t,e[t]);return i},Fr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class xr{constructor(e){this.fallbackCache=new Map,this.cleanupInterval=null,this.config=at({blockDurationMs:e.windowMs*2},e),this.startCleanupInterval()}checkRateLimit(e,t){return Fr(this,null,function*(){const r=at(at({},this.config),t),n=`${r.keyPrefix}:${e}`,s=Date.now(),o=s-r.windowMs;try{if(it.isHealthy())return yield this.checkRedisRateLimit(n,r,s,o)}catch(c){R.warn("Redis rate limiting failed, falling back to in-memory:",c)}return this.checkInMemoryRateLimit(n,r,s)})}checkRedisRateLimit(e,t,r,n){return Fr(this,null,function*(){const s=it.getClient(),o=s.multi();o.zRemRangeByScore(e,"-inf",n),o.zCard(e),o.zAdd(e,{score:r,member:`${r}-${Math.random()}`}),o.expire(e,Math.ceil(t.windowMs/1e3));const c=`${e}:blocked`;o.get(c);const a=yield o.exec();if(!a||a.length<4)throw new Error("Redis pipeline execution failed");const l=a[1],u=a[4];if(u){const d=parseInt(u);if(r<d)return{allowed:!1,remaining:0,resetTime:d,retryAfter:Math.ceil((d-r)/1e3)};yield s.del(c)}if(l>=t.maxRequests){if(t.blockDurationMs){const d=r+t.blockDurationMs;yield s.setEx(c,Math.ceil(t.blockDurationMs/1e3),d.toString())}return{allowed:!1,remaining:0,resetTime:r+t.windowMs,retryAfter:Math.ceil(t.windowMs/1e3)}}return{allowed:!0,remaining:t.maxRequests-l-1,resetTime:r+t.windowMs}})}checkInMemoryRateLimit(e,t,r){const n=this.fallbackCache.get(e);n&&n.resetTime<r&&this.fallbackCache.delete(e);const s=this.fallbackCache.get(e)||{count:0,resetTime:r+t.windowMs,blocked:!1};return s.blocked&&s.blockUntil&&r<s.blockUntil?{allowed:!1,remaining:0,resetTime:s.blockUntil,retryAfter:Math.ceil((s.blockUntil-r)/1e3)}:(s.resetTime<r&&(s.count=0,s.resetTime=r+t.windowMs,s.blocked=!1,delete s.blockUntil),s.count>=t.maxRequests?(t.blockDurationMs&&(s.blocked=!0,s.blockUntil=r+t.blockDurationMs),this.fallbackCache.set(e,s),{allowed:!1,remaining:0,resetTime:s.resetTime,retryAfter:Math.ceil(t.windowMs/1e3)}):(s.count++,this.fallbackCache.set(e,s),{allowed:!0,remaining:t.maxRequests-s.count,resetTime:s.resetTime}))}resetRateLimit(e,t){return Fr(this,null,function*(){const n=`${at(at({},this.config),t).keyPrefix}:${e}`;try{if(it.isHealthy()){const s=it.getClient();yield s.del(n),yield s.del(`${n}:blocked`)}}catch(s){R.warn("Failed to reset Redis rate limit:",s)}this.fallbackCache.delete(n)})}getRateLimitStatus(e,t){return Fr(this,null,function*(){const r=at(at({},this.config),t),n=`${r.keyPrefix}:${e}`,s=Date.now(),o=s-r.windowMs;try{if(it.isHealthy()){const a=it.getClient(),l=`${n}:blocked`,u=yield a.get(l);if(u){const f=parseInt(u);if(s<f)return{allowed:!1,remaining:0,resetTime:f,retryAfter:Math.ceil((f-s)/1e3)}}const d=yield a.zCount(n,o,"+inf");return{allowed:d<r.maxRequests,remaining:Math.max(0,r.maxRequests-d),resetTime:s+r.windowMs}}}catch(a){R.warn("Failed to get Redis rate limit status:",a)}const c=this.fallbackCache.get(n);return!c||c.resetTime<s?{allowed:!0,remaining:r.maxRequests,resetTime:s+r.windowMs}:c.blocked&&c.blockUntil&&s<c.blockUntil?{allowed:!1,remaining:0,resetTime:c.blockUntil,retryAfter:Math.ceil((c.blockUntil-s)/1e3)}:{allowed:c.count<r.maxRequests,remaining:Math.max(0,r.maxRequests-c.count),resetTime:c.resetTime}})}startCleanupInterval(){this.cleanupInterval=setInterval(()=>{const e=Date.now();for(const[t,r]of Array.from(this.fallbackCache.entries()))r.resetTime<e&&this.fallbackCache.delete(t)},6e4)}getStats(){return{fallbackCacheSize:this.fallbackCache.size,redisHealthy:it.isHealthy(),config:this.config}}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.fallbackCache.clear()}}new xr({maxRequests:100,windowMs:60*1e3,keyPrefix:"api",blockDurationMs:300*1e3});new xr({maxRequests:5,windowMs:900*1e3,keyPrefix:"auth",blockDurationMs:1800*1e3});new xr({maxRequests:20,windowMs:60*1e3,keyPrefix:"ai",blockDurationMs:120*1e3});new xr({maxRequests:30,windowMs:60*1e3,keyPrefix:"general"});var vn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class $i{static applyFilters(e,t){if(!t)return e;let r=e;return t.category&&(r=r.eq("category",t.category)),t.status&&(r=r.eq("status",t.status)),t.location&&(r=r.eq("location",t.location)),t.search&&(r=r.or(`name.ilike.%${t.search}%,category.ilike.%${t.search}%`)),r}static applyFiltersToTable(e,t,r){return vn(this,null,function*(){const{data:{user:n},error:s}=yield e.auth.getUser();if(s||!n)throw new Error("User not authenticated");const{data:o,error:c}=yield e.from("users").select("facility_id").eq("id",n.id).single();if(c||!(o!=null&&o.facility_id))throw new Error("User facility not found");const a=o.facility_id,u=e.from(t).select(`
      id,
      name,
      category,
      quantity,
      unit_cost,
      reorder_point,
      expiration_date,
      data,
      created_at,
      updated_at
    `,{count:"exact"}).eq("facility_id",a);return this.applyFilters(u,r)})}static applyFiltersToSelect(e,t,r,n){const s=e.from(t).select(r,{count:"exact"});return this.applyFilters(s,n)}static applyFiltersToSingle(e,t,r){return e.from(t).select("*").eq("id",r).single()}static applyFiltersToCategories(e,t){return vn(this,null,function*(){const{data:{user:r},error:n}=yield e.auth.getUser();if(n||!r)throw new Error("User not authenticated");const{data:s,error:o}=yield e.from("users").select("facility_id").eq("id",r.id).single();if(o||!(s!=null&&s.facility_id))throw new Error("User facility not found");const c=s.facility_id;return e.from(t).select("category").eq("facility_id",c).not("category","is",null)})}static applyFiltersToLocations(e,t){return vn(this,null,function*(){const{data:{user:r},error:n}=yield e.auth.getUser();if(n||!r)throw new Error("User not authenticated");const{data:s,error:o}=yield e.from("users").select("facility_id").eq("id",r.id).single();if(o||!(s!=null&&s.facility_id))throw new Error("User facility not found");const c=s.facility_id;return e.from(t).select("location").eq("facility_id",c).not("location","is",null)})}static extractUniqueValues(e,t){return Array.from(new Set((e==null?void 0:e.map(r=>r[t]))||[]))}static buildSearchQuery(e,t=["name","category"]){return t.map(r=>`${r}.ilike.%${e}%`).join(",")}static validateFilters(e){if(!e)return!0;if(e.search&&e.search.trim().length<2)return!1;const t=["active","inactive","p2","n/a"];return!(e.status&&!t.includes(e.status))}static getFilterSummary(e){if(!e)return"no filters";const t=[];return e.category&&t.push(`category: ${e.category}`),e.status&&t.push(`status: ${e.status}`),e.location&&t.push(`location: ${e.location}`),e.search&&t.push(`search: "${e.search}"`),t.length>0?t.join(", "):"no filters"}}class ae{static handleError(e,t){throw console.error(` ${t} failed:`,e),e&&typeof e=="object"&&"message"in e?Pa(e):new Error(`${t} failed: ${e}`)}static handleResponse(e,t){return e.error&&this.handleError(e.error,t),e.data}static logStart(e,t){}static logSuccess(e,t){}static logFailure(e,t){console.error(` ${e} failed:`,t)}}var Rl=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function Ll(){return Rl(this,null,function*(){return yield z(()=>import("./TypedSupabaseAdapter-Bu2vOfh5.js"),__vite__mapDeps([5,1,2,3,4]))})}var Te=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Ml=i=>i instanceof Error?i:typeof i=="object"&&i!==null&&"message"in i?new Error(String(i.message)):new Error("Unknown Supabase error occurred");class ne{static getTypedAdapter(){return Te(this,null,function*(){const{TypedSupabaseAdapter:e}=yield Ll();return new e})}static getItems(e){return Te(this,null,function*(){const t="Fetching inventory items";$i.getFilterSummary(e);try{if(!$i.validateFilters(e))throw new Error("Invalid filter parameters");const n=yield(yield this.getTypedAdapter()).getAllItems({filters:e,orderBy:{column:"created_at",ascending:!1}});if(!n.success||!Array.isArray(n.data))throw new Error(n.error||"Failed to fetch inventory items");const s=n.data;return ae.logSuccess(t,`${s.length} items`),{data:s,error:null,count:n.processedCount}}catch(r){throw console.error(" InventoryCrudOperations.getItems failed:",r),ae.logFailure(t,r),r}})}static getItemById(e){return Te(this,null,function*(){const t=`Fetching inventory item by ID: ${e}`;try{const n=yield(yield this.getTypedAdapter()).getItemById(e);if(!n.success||!n.data)throw new Error(n.error||"Failed to fetch inventory item");const s=n.data;return ae.logSuccess(t,s.name||"Unknown"),s}catch(r){throw ae.logFailure(t,r),r}})}static createItem(e){return Te(this,null,function*(){var t,r,n,s,o,c;const a=`Creating inventory item: ${e.name}`;try{const u=yield(yield this.getTypedAdapter()).createItem({facility_id:e.facility_id||"",name:e.name||"",quantity:(t=e.quantity)!=null?t:void 0,data:(r=e.data)!=null?r:void 0,reorder_point:(n=e.reorder_point)!=null?n:void 0,expiration_date:(s=e.expiration_date)!=null?s:void 0,unit_cost:(o=e.unit_cost)!=null?o:void 0,category:(c=e.category)!=null?c:void 0});if(!u.success||!u.data)throw new Error(u.error||"Failed to create inventory item");return ae.logSuccess(a,u.data.name||"Unknown"),u.data}catch(l){throw ae.logFailure(a,l),l}})}static updateItem(e,t){return Te(this,null,function*(){var r,n,s,o,c,a,l;try{const d=yield(yield this.getTypedAdapter()).updateItem(e,{name:(r=t.name)!=null?r:void 0,quantity:(n=t.quantity)!=null?n:void 0,data:(s=t.data)!=null?s:void 0,reorder_point:(o=t.reorder_point)!=null?o:void 0,expiration_date:(c=t.expiration_date)!=null?c:void 0,unit_cost:(a=t.unit_cost)!=null?a:void 0,category:(l=t.category)!=null?l:void 0});if(!d.success||!d.data)throw new Error(d.error||"Failed to update inventory item");return d.data}catch(u){throw console.error(" Failed to update item in Supabase:",u),u}})}static deleteItem(e){return Te(this,null,function*(){const t=`Deleting inventory item: ${e}`;try{const n=yield(yield this.getTypedAdapter()).deleteItem(e);if(!n.success)throw new Error(n.error||"Failed to delete inventory item");ae.logSuccess(t,`Deleted ${e}`)}catch(r){throw ae.logFailure(t,r),r}})}static archiveItem(e,t){return Te(this,null,function*(){const r=`Archiving inventory item: ${e}`;try{const{data:{user:n}}=yield y.auth.getUser();if(!n)throw new Error("User not authenticated");const o=yield(yield this.getTypedAdapter()).updateItem(e,{archived:!0,archived_at:new Date().toISOString(),archived_by:n.id,archive_reason:t||"User requested deletion"});if(!o.success)throw new Error(o.error||"Failed to archive inventory item");ae.logSuccess(r,`Archived ${e}`)}catch(n){throw ae.logFailure(r,n),n}})}static getCategories(){return Te(this,null,function*(){const e="Fetching inventory categories";try{const r=yield(yield this.getTypedAdapter()).getAllItems();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch categories");const n=Array.from(new Set(r.data.map(s=>s.category).filter(s=>!!s)));return ae.logSuccess(e,`${n.length} categories`),n}catch(t){throw ae.logFailure(e,t),t}})}static getLocations(){return Te(this,null,function*(){const e="Fetching inventory locations";try{const r=yield(yield this.getTypedAdapter()).getAllItems();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch locations");const n=Array.from(new Set(r.data.map(s=>{const o=s.data;return o==null?void 0:o.location}).filter(s=>!!s)));return ae.logSuccess(e,`${n.length} locations`),n}catch(t){throw ae.logFailure(e,t),t}})}static getAnalytics(){return Te(this,null,function*(){try{const{data:{user:e}}=yield y.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield y.from("users").select("facility_id").eq("id",e.id).single(),r=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:n,error:s}=yield y.from("inventory_items").select("*").eq("facility_id",r);if(s)throw console.error(" Error fetching analytics from Supabase:",s),Ml(s);const o=n||[],c=o.length,a=o.length,l=o.reduce((d,f)=>d+(f.unit_cost||0),0),u={};return o.forEach(d=>{const f=d.category;f&&(u[f]=(u[f]||0)+1)}),{totalItems:c,activeItems:a,totalValue:l,categories:u}}catch(e){throw console.error(" Failed to fetch analytics from Supabase:",e),e}})}}var cn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function jl(i){return cn(this,null,function*(){try{const{data:e,error:t}=yield y.from("suppliers").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getSuppliersByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting suppliers by facility:",e),{data:null,error:e}}})}function Ul(i){return cn(this,null,function*(){try{const{data:e,error:t}=yield y.from("inventory_transactions").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getInventoryTransactionsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory transactions by facility:",e),{data:null,error:e}}})}function Nl(i){return cn(this,null,function*(){try{const{data:e,error:t}=yield y.from("inventory_costs").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getInventoryCostsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory costs by facility:",e),{data:null,error:e}}})}function Fl(i){return cn(this,null,function*(){try{const{data:e,error:t}=yield y.from("equipment_maintenance").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getEquipmentMaintenanceByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting equipment maintenance by facility:",e),{data:null,error:e}}})}function Da(i){const e=[];return(!i.name||i.name.trim().length===0)&&e.push("Name is required"),(!i.category||i.category.trim().length===0)&&e.push("Category is required"),(!i.location||i.location.trim().length===0)&&e.push("Location is required"),i.quantity!==void 0&&i.quantity<0&&e.push("Quantity cannot be negative"),i.quantity!==void 0&&i.quantity<0&&e.push("Minimum quantity cannot be negative"),i.quantity!==void 0&&i.quantity<0&&e.push("Maximum quantity cannot be negative"),i.quantity!==void 0&&i.quantity!==void 0&&i.quantity>i.quantity&&e.push("Minimum quantity cannot be greater than maximum quantity"),i.cost!==void 0&&i.cost<0&&e.push("Cost cannot be negative"),i.expiration_date&&new Date(i.expiration_date)<new Date&&e.push("Expiration date cannot be in the past"),i.serialNumber&&i.serialNumber.trim().length===0&&e.push("Serial number cannot be empty"),i.barcode&&i.barcode.trim().length===0&&e.push("Barcode cannot be empty"),{isValid:e.length===0,errors:e}}function sn(i){var e,t,r,n,s,o,c;const a={name:(e=i.name)==null?void 0:e.trim(),description:(t=i.description)==null?void 0:t.trim(),category:(r=i.category)==null?void 0:r.trim(),location:(n=i.location)==null?void 0:n.trim(),status:i.status||"available",quantity:i.quantity||0,cost:i.cost||0,supplier:(s=i.supplier)==null?void 0:s.trim(),serialNumber:(o=i.serialNumber)==null?void 0:o.trim(),barcode:(c=i.barcode)==null?void 0:c.trim(),expiration_date:i.expiration_date,lastUpdated:new Date().toISOString()};return Object.keys(a).forEach(l=>{a[l]===void 0&&delete a[l]}),a}var zl=Object.defineProperty,ql=Object.defineProperties,Hl=Object.getOwnPropertyDescriptors,Ri=Object.getOwnPropertySymbols,Bl=Object.prototype.hasOwnProperty,Vl=Object.prototype.propertyIsEnumerable,Li=(i,e,t)=>e in i?zl(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Gl=(i,e)=>{for(var t in e||(e={}))Bl.call(e,t)&&Li(i,t,e[t]);if(Ri)for(var t of Ri(e))Vl.call(e,t)&&Li(i,t,e[t]);return i},Kl=(i,e)=>ql(i,Hl(e)),ee=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function Wl(i){return ee(this,null,function*(){try{return(yield ne.getItems(i)).data||[]}catch(e){throw console.error("Error getting items:",e),new Error("Failed to get items")}})}function Ql(i){return ee(this,null,function*(){try{return yield ne.getItemById(i)}catch(e){throw console.error("Error getting item by ID:",e),new Error("Failed to get item by ID")}})}function $a(i){return ee(this,null,function*(){try{return(yield ne.getItems({category:i})).data||[]}catch(e){throw console.error("Error getting items by category:",e),new Error("Failed to get items by category")}})}function Yl(i){return ee(this,null,function*(){try{return(yield ne.getItems({location:i})).data||[]}catch(e){throw console.error("Error getting items by location:",e),new Error("Failed to get items by location")}})}function Jl(i){return ee(this,null,function*(){try{return(yield ne.getItems({status:i})).data||[]}catch(e){throw console.error("Error getting items by status:",e),new Error("Failed to get items by status")}})}function Xl(i){return ee(this,null,function*(){try{return(yield ne.getItems({search:i})).data||[]}catch(e){throw console.error("Error searching items:",e),new Error("Failed to search items")}})}function Zl(){return ee(this,null,function*(){try{return(yield ne.getItems({})).data||[]}catch(i){throw console.error("Error getting low stock items:",i),new Error("Failed to get low stock items")}})}function eu(i=30){return ee(this,null,function*(){try{return(yield ne.getItems({})).data||[]}catch(e){throw console.error("Error getting expiring items:",e),new Error("Failed to get expiring items")}})}function tu(i){return ee(this,null,function*(){try{const e=sn(i);return yield ne.createItem(e)}catch(e){throw console.error("Error creating item:",e),new Error("Failed to create item")}})}function Hn(i,e){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const t=sn(e);return yield ne.updateItem(i,t)}catch(t){throw console.error("Error updating item:",t),new Error("Failed to update item")}})}function Bn(i){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");yield ne.deleteItem(i)}catch(e){throw console.error("Error deleting item:",e),new Error("Failed to delete item")}})}function ru(i){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");return yield ne.updateItem(i,{status:"archived",lastUpdated:new Date().toISOString()})}catch(e){throw console.error("Error archiving item:",e),new Error("Failed to archive item")}})}function nu(i){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const e=yield ne.getItemById(i);if(!e)throw new Error("Original item not found");const t=Kl(Gl({},e),{name:`${e.name} (Copy)`,id:void 0,lastUpdated:void 0});return yield ne.createItem(t)}catch(e){throw console.error("Error duplicating item:",e),new Error("Failed to duplicate item")}})}function iu(i,e){return ee(this,null,function*(){try{const r=(yield $a(i)).map(o=>ne.updateItem(o.id,e));return{updatedCount:(yield Promise.allSettled(r)).filter(o=>o.status==="fulfilled").length}}catch(t){throw console.error("Error in bulk update by category:",t),new Error("Failed to bulk update items by category")}})}function su(i){return ee(this,null,function*(){try{return yield jl(i)}catch(e){throw console.error("Error getting suppliers by facility:",e),new Error("Failed to get suppliers by facility")}})}function au(i){return ee(this,null,function*(){try{return yield Ul(i)}catch(e){throw console.error("Error getting inventory transactions by facility:",e),new Error("Failed to get inventory transactions by facility")}})}function ou(i){return ee(this,null,function*(){try{return yield Nl(i)}catch(e){throw console.error("Error getting inventory costs by facility:",e),new Error("Failed to get inventory costs by facility")}})}function cu(i){return ee(this,null,function*(){try{return yield Fl(i)}catch(e){throw console.error("Error getting equipment maintenance by facility:",e),new Error("Failed to get equipment maintenance by facility")}})}class Ke{static generateCacheKey(e,t){var r,n;const s=e.length+"_"+((r=e[0])==null?void 0:r.id)+"_"+((n=e[e.length-1])==null?void 0:n.id),o=JSON.stringify(t);return`${s}_${o}`}static getCachedResult(e){return this.EXPORT_CACHE.get(e)}static hasCachedResult(e){return this.EXPORT_CACHE.has(e)}static cacheExportResult(e,t){if(this.EXPORT_CACHE.size>=this.CACHE_MAX_SIZE){const r=this.EXPORT_CACHE.keys().next().value;r&&this.EXPORT_CACHE.delete(r)}this.EXPORT_CACHE.set(e,t)}static getCacheStats(){return{size:this.EXPORT_CACHE.size,maxSize:this.CACHE_MAX_SIZE}}static clearCache(){this.EXPORT_CACHE.clear()}static removeCachedResult(e){return this.EXPORT_CACHE.delete(e)}}Ke.EXPORT_CACHE=new Map;Ke.CACHE_MAX_SIZE=100;var Mi=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ji{static standardExport(e,t){return Mi(this,null,function*(){switch(t.format){case"csv":return this.generateCSV(e,t);case"json":return this.generateJSON(e,t);case"excel":return yield this.generateExcel(e,t);default:throw new Error(`Unsupported export format: ${t.format}`)}})}static standardExportTransformed(e,t){return this.generateCSVFromTransformed(e,t,!0)}static generateCSV(e,t){const r=t.customFields||this.getDefaultCSVFields();let n="";t.includeHeaders&&(n+=r.map(s=>this.escapeCSVField(s)).join(",")+`
`);for(const s of e){const o=r.map(c=>{const a=this.getFieldValue(s,c);return this.escapeCSVField(a)});n+=o.join(",")+`
`}return n}static generateJSON(e,t){const r=t.customFields||this.getDefaultJSONFields(),n=e.map(s=>{const o={};for(const c of r)o[c]=this.getFieldValue(s,c);return o});return JSON.stringify(n,null,2)}static generateExcel(e,t){return Mi(this,null,function*(){const r=this.generateCSV(e,t);return new Blob([r],{type:"text/csv;charset=utf-8;"})})}static generateCSVFromTransformed(e,t,r){const n=t.customFields||[];let s="";r&&t.includeHeaders&&(s+=n.map(o=>this.escapeCSVField(o)).join(",")+`
`);for(const o of e){const c=n.map(a=>{const l=o[a]||"";return this.escapeCSVField(String(l))});s+=c.join(",")+`
`}return s}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r!==null&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}}class Qe{static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory;return(e==null?void 0:e.usedJSHeapSize)||0}return 0}static getMemoryStats(){const e=this.getMemoryUsage();let t;if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const r=performance.memory;t=r==null?void 0:r.jsHeapSizeLimit}return{current:e,limit:t}}static isMemoryUsageHigh(e){const t=this.getMemoryUsage(),r=e||this.DEFAULT_MAX_MEMORY;return t>r}static forceGarbageCollection(){typeof window!="undefined"&&"gc"in window&&typeof window.gc=="function"&&window.gc()}static getDefaultMaxMemory(){return this.DEFAULT_MAX_MEMORY}}Qe.DEFAULT_MAX_MEMORY=50*1024*1024;var Ui=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Vn{static streamingExport(e,t){return Ui(this,null,function*(){const r=t.chunkSize||this.DEFAULT_CHUNK_SIZE,n=[];for(let s=0;s<e.length;s+=r){const o=e.slice(s,s+r);Qe.isMemoryUsageHigh(t.maxMemoryUsage)&&Qe.forceGarbageCollection();let c;switch(t.format){case"csv":c=this.generateCSVChunk(o,t,s===0);break;case"json":c=this.generateJSONChunk(o,t,s===0,s+r>=e.length);break;default:throw new Error(`Streaming not supported for format: ${t.format}`)}n.push(c),s%(r*10)===0&&(yield new Promise(a=>setTimeout(a,0)))}return n.join("")})}static streamingExportTransformed(e,t){return Ui(this,null,function*(){const r=[],n=t.chunkSize||this.DEFAULT_CHUNK_SIZE;for(let s=0;s<e.length;s+=n){const o=e.slice(s,s+n),c=this.generateCSVFromTransformed(o,t,s===0);r.push(c),s%(n*10)===0&&(yield new Promise(a=>setTimeout(a,0)))}return r.join("")})}static generateCSVChunk(e,t,r){const n=t.customFields||this.getDefaultCSVFields();let s="";r&&t.includeHeaders&&(s+=n.map(o=>this.escapeCSVField(o)).join(",")+`
`);for(const o of e){const c=n.map(a=>{const l=this.getFieldValue(o,a);return this.escapeCSVField(l)});s+=c.join(",")+`
`}return s}static generateJSONChunk(e,t,r,n){const s=t.customFields||this.getDefaultJSONFields();let o="";r&&(o+=`[
`);const c=e.map(a=>{const l={};for(const u of s)l[u]=this.getFieldValue(a,u);return l});return o+=c.map(a=>"  "+JSON.stringify(a)).join(`,
`),n?o+=`
]`:o+=`,
`,o}static generateCSVFromTransformed(e,t,r){const n=t.customFields||[];let s="";r&&t.includeHeaders&&(s+=n.map(o=>this.escapeCSVField(o)).join(",")+`
`);for(const o of e){const c=n.map(a=>{const l=o[a]||"";return this.escapeCSVField(String(l))});s+=c.join(",")+`
`}return s}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r!==null&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}Vn.DEFAULT_CHUNK_SIZE=1e3;class cr{static createDownloadUrl(e,t){const r=typeof e=="string"?new Blob([e],{type:"text/plain"}):e,n=URL.createObjectURL(r),s=document.createElement("a");return s.href=n,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(n),1e3),n}static getDataSize(e){return typeof e=="string"?new Blob([e]).size:e.size}static getDateString(){return new Date().toISOString().split("T")[0]}static generateFileName(e,t){const r=this.getDateString();return`${e}_${r}.${t}`}static revokeUrl(e){URL.revokeObjectURL(e)}}class lr{static validateExportOptions(e){const t=[];return(!e.format||!["csv","json","excel"].includes(e.format))&&t.push("Invalid export format. Must be csv, json, or excel."),e.customFields&&!Array.isArray(e.customFields)&&t.push("Custom fields must be an array of strings."),e.chunkSize!==void 0&&(e.chunkSize<1||e.chunkSize>1e4)&&t.push("Chunk size must be between 1 and 10000."),e.maxMemoryUsage!==void 0&&e.maxMemoryUsage<1024*1024&&t.push("Max memory usage must be at least 1MB."),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to export."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateTemplate(e){const t=[];if(e||t.push("Template is required."),e&&typeof e=="object"&&"format"in e){const r=e.format;["csv","json","excel"].includes(r)||t.push("Template format must be csv, json, or excel.")}return{isValid:t.length===0,errors:t}}}var Ni=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Ra{static exportItems(e){return Ni(this,arguments,function*(t,r={format:"csv",includeHeaders:!0}){const n=Date.now(),s=Qe.getMemoryUsage();try{const o=lr.validateItems(t);if(!o.isValid)throw new Error(o.errors.join(", "));const c=lr.validateExportOptions(r);if(!c.isValid)throw new Error(c.errors.join(", "));const a=Ke.generateCacheKey(t,r);if(Ke.hasCachedResult(a))return console.log("Export cache hit"),Ke.getCachedResult(a);let l;r.enableStreaming&&t.length>this.DEFAULT_CHUNK_SIZE?l=yield Vn.streamingExport(t,r):l=yield ji.standardExport(t,r);const u=cr.generateFileName("inventory_export",r.format),d=cr.createDownloadUrl(l,u),f=Date.now(),h=Qe.getMemoryUsage(),m={success:!0,fileName:u,dataSize:cr.getDataSize(l),itemCount:t.length,format:r.format,downloadUrl:d,processingTime:f-n,memoryUsage:h-s};return Ke.cacheExportResult(a,m),m}catch(o){throw console.error("Export failed:",o),new Error(`Export failed: ${o instanceof Error?o.message:"Unknown error"}`)}})}static exportWithTemplate(e,t){return Ni(this,null,function*(){const r=Date.now(),n=Qe.getMemoryUsage();try{const s=lr.validateItems(e);if(!s.isValid)throw new Error(s.errors.join(", "));const o=lr.validateTemplate(t);if(!o.isValid)throw new Error(o.errors.join(", "));if(!e||e.length===0)throw new Error("No items to export");const{InventoryExportTemplateService:c}=yield z(()=>import("./inventoryExportTemplateService-B91rpcBB.js"),[]),a=c.applyTemplate(e,t),l=c.generateFileName(t),u={format:t.format,includeHeaders:t.includeHeaders,dateFormat:t.dateFormat,customFields:t.fields.map(w=>String(w.key)),enableStreaming:e.length>this.DEFAULT_CHUNK_SIZE,chunkSize:this.DEFAULT_CHUNK_SIZE};let d;u.enableStreaming?d=yield Vn.streamingExportTransformed(a,u):d=ji.standardExportTransformed(a,u);const f=cr.createDownloadUrl(d,l),h=Date.now(),m=Qe.getMemoryUsage();return{success:!0,fileName:l,dataSize:cr.getDataSize(d),itemCount:a.length,format:t.format,downloadUrl:f,processingTime:h-r,memoryUsage:m-n}}catch(s){throw console.error("Template export failed:",s),new Error(`Template export failed: ${s instanceof Error?s.message:"Unknown error"}`)}})}static validateExportOptions(e){return lr.validateExportOptions(e)}static getCacheStats(){return Ke.getCacheStats()}static clearCache(){Ke.clearCache()}static getMemoryStats(){return Qe.getMemoryStats()}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}Ra.DEFAULT_CHUNK_SIZE=1e3;var lu=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function uu(){return lu(this,null,function*(){return yield z(()=>import("./SupabaseAdapter-OgEG3egm.js"),__vite__mapDeps([6,7,5,1,2,3,4]))})}var du=Object.defineProperty,hu=Object.defineProperties,fu=Object.getOwnPropertyDescriptors,Fi=Object.getOwnPropertySymbols,pu=Object.prototype.hasOwnProperty,gu=Object.prototype.propertyIsEnumerable,zi=(i,e,t)=>e in i?du(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qi=(i,e)=>{for(var t in e||(e={}))pu.call(e,t)&&zi(i,t,e[t]);if(Fi)for(var t of Fi(e))gu.call(e,t)&&zi(i,t,e[t]);return i},mu=(i,e)=>hu(i,fu(e)),ur=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class yu{constructor(e,t){this.isInitialized=!1,this.lastError=null,this.lastSyncTime=null,this.pendingChanges=!1,this.config=e,this.metadata=mu(qi({},t),{config:e})}getMetadata(){return qi({},this.metadata)}batchAddItems(e){return ur(this,null,function*(){const t=[];for(const r of e)try{const n=yield this.addInventoryItem(r);t.push(n)}catch(n){throw this.setError(n),n}return t})}batchUpdateItems(e){return ur(this,null,function*(){const t=[];for(const r of e)try{const n=yield this.updateInventoryItem(r.id,r.item);t.push(n)}catch(n){throw this.setError(n),n}return t})}batchDeleteItems(e){return ur(this,null,function*(){for(const t of e)try{yield this.deleteInventoryItem(t)}catch(r){throw this.setError(r),r}})}sync(){return ur(this,null,function*(){try{this.lastSyncTime=new Date,this.pendingChanges=!1}catch(e){throw this.setError(e),e}})}getLastSyncTime(){return this.lastSyncTime}hasPendingChanges(){return this.pendingChanges}getLastError(){return this.lastError}clearError(){this.lastError=null}disconnect(){return ur(this,null,function*(){this.isInitialized=!1,this.lastError=null})}setError(e){this.lastError=e,console.error(`[${this.metadata.name}] Error:`,e)}setPendingChanges(){this.pendingChanges=!0}validateInitialization(){if(!this.isInitialized)throw new Error(`Adapter ${this.metadata.name} is not initialized. Call initialize() first.`)}}var vu=Object.defineProperty,_u=Object.defineProperties,wu=Object.getOwnPropertyDescriptors,Hi=Object.getOwnPropertySymbols,bu=Object.prototype.hasOwnProperty,Su=Object.prototype.propertyIsEnumerable,Bi=(i,e,t)=>e in i?vu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,zr=(i,e)=>{for(var t in e||(e={}))bu.call(e,t)&&Bi(i,t,e[t]);if(Hi)for(var t of Hi(e))Su.call(e,t)&&Bi(i,t,e[t]);return i},Vi=(i,e)=>_u(i,wu(e)),Pe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const ue={INVENTORY_DATA:"inventory_data",CATEGORIES:"inventory_categories",LAST_SYNC:"inventory_last_sync",PENDING_CHANGES:"inventory_pending_changes"};class Iu extends yu{constructor(e={type:"localStorage"}){const t={supportsRead:!0,supportsWrite:!0,supportsDelete:!0,supportsRealTime:!1,supportsOffline:!0,supportsBatch:!0};super(e,{name:"LocalStorageAdapter",version:"1.0.0",description:"Adapter for localStorage-based inventory data",capabilities:t}),this.storage=window.localStorage}initialize(){return Pe(this,null,function*(){try{if(!this.storage)throw new Error("localStorage is not available");this.storage.getItem(ue.INVENTORY_DATA)||(yield this.initializeDefaultData()),this.isInitialized=!0,this.lastSyncTime=this.getLastSyncTimeFromStorage(),this.pendingChanges=this.getPendingChangesFromStorage()}catch(e){throw this.setError(e),e}})}isConnected(){return this.isInitialized&&!!this.storage}fetchAllInventoryData(){return Pe(this,null,function*(){this.validateInitialization();const e=this.getInventoryDataFromStorage(),t=[];return t.push(...e.tools),t.push(...e.supplies),t.push(...e.equipment),t.push(...e.officeHardware),{data:t,error:null,count:t.length}})}fetchInventoryItems(){return Pe(this,null,function*(){this.validateInitialization();const e=this.getInventoryDataFromStorage(),t=[];return t.push(...e.tools),t.push(...e.supplies),t.push(...e.equipment),t.push(...e.officeHardware),t})}fetchCategories(){return Pe(this,null,function*(){this.validateInitialization();const e=this.storage.getItem(ue.CATEGORIES);return e?JSON.parse(e):this.getDefaultCategories()})}addInventoryItem(e){return Pe(this,null,function*(){this.validateInitialization();const t=this.getInventoryDataFromStorage(),r=Vi(zr({},e),{id:this.generateId(),createdAt:new Date().toISOString()}),n=(r.category||"").toLowerCase();return n.includes("tool")||n.includes("instrument")?t.tools.push(r):n.includes("supply")||n.includes("consumable")?t.supplies.push(r):n.includes("equipment")||n.includes("device")?t.equipment.push(r):t.officeHardware.push(r),this.saveInventoryDataToStorage(t),this.setPendingChanges(),this.updateLastSyncTime(),r})}updateInventoryItem(e,t){return Pe(this,null,function*(){this.validateInitialization();const r=this.getInventoryDataFromStorage(),n=Vi(zr({},t),{id:e,lastUpdated:new Date().toISOString()}),s=[r.tools,r.supplies,r.equipment,r.officeHardware];let o=!1;for(const c of s){const a=c.findIndex(l=>this.getItemId(l)===e);if(a!==-1){c[a]=zr(zr({},c[a]),n),o=!0;break}}if(!o)throw new Error(`Item with id ${e} not found`);return this.saveInventoryDataToStorage(r),this.setPendingChanges(),this.updateLastSyncTime(),n})}deleteInventoryItem(e){return Pe(this,null,function*(){this.validateInitialization();const t=this.getInventoryDataFromStorage(),r=[t.tools,t.supplies,t.equipment,t.officeHardware];let n=!1;for(const s of r){const o=s.findIndex(c=>this.getItemId(c)===e);if(o!==-1){s.splice(o,1),n=!0;break}}if(!n)throw new Error(`Item with id ${e} not found`);this.saveInventoryDataToStorage(t),this.setPendingChanges(),this.updateLastSyncTime()})}addCategory(e){return Pe(this,null,function*(){this.validateInitialization();const t=yield this.fetchCategories();return t.includes(e)||(t.push(e),this.storage.setItem(ue.CATEGORIES,JSON.stringify(t)),this.setPendingChanges(),this.updateLastSyncTime()),e})}deleteCategory(e){return Pe(this,null,function*(){this.validateInitialization();const t=yield this.fetchCategories(),r=t.indexOf(e);r!==-1&&(t.splice(r,1),this.storage.setItem(ue.CATEGORIES,JSON.stringify(t)),this.setPendingChanges(),this.updateLastSyncTime())})}getInventoryDataFromStorage(){const e=this.storage.getItem(ue.INVENTORY_DATA);return e?JSON.parse(e):{tools:[],supplies:[],equipment:[],officeHardware:[],categories:this.getDefaultCategories(),isLoading:!1,error:null}}saveInventoryDataToStorage(e){this.storage.setItem(ue.INVENTORY_DATA,JSON.stringify(e))}getLastSyncTimeFromStorage(){const e=this.storage.getItem(ue.LAST_SYNC);return e?new Date(e):null}getPendingChangesFromStorage(){const e=this.storage.getItem(ue.PENDING_CHANGES);return e?JSON.parse(e):!1}updateLastSyncTime(){this.lastSyncTime=new Date,this.storage.setItem(ue.LAST_SYNC,this.lastSyncTime.toISOString())}setPendingChanges(){this.pendingChanges=!0,this.storage.setItem(ue.PENDING_CHANGES,JSON.stringify(!0))}initializeDefaultData(){return Pe(this,null,function*(){const e={tools:[],supplies:[],equipment:[],officeHardware:[],categories:this.getDefaultCategories(),isLoading:!1,error:null};this.saveInventoryDataToStorage(e),this.storage.setItem(ue.CATEGORIES,JSON.stringify(this.getDefaultCategories())),this.storage.setItem(ue.LAST_SYNC,new Date().toISOString()),this.storage.setItem(ue.PENDING_CHANGES,JSON.stringify(!1))})}generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getItemId(e){var t,r,n,s;return((t=e.data)!=null&&t.toolId&&typeof e.data.toolId=="string"?e.data.toolId:"")||((r=e.data)!=null&&r.supplyId&&typeof e.data.supplyId=="string"?e.data.supplyId:"")||((n=e.data)!=null&&n.equipmentId&&typeof e.data.equipmentId=="string"?e.data.equipmentId:"")||((s=e.data)!=null&&s.hardwareId&&typeof e.data.hardwareId=="string"?e.data.hardwareId:"")||e.id}getDefaultCategories(){return["Surgical Instruments","Medical Supplies","Equipment","Office Hardware","Consumables","Disposables","Tools","Devices"]}}var Eu=Object.defineProperty,Gi=Object.getOwnPropertySymbols,ku=Object.prototype.hasOwnProperty,Cu=Object.prototype.propertyIsEnumerable,Ki=(i,e,t)=>e in i?Eu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qr=(i,e)=>{for(var t in e||(e={}))ku.call(e,t)&&Ki(i,t,e[t]);if(Gi)for(var t of Gi(e))Cu.call(e,t)&&Ki(i,t,e[t]);return i},dr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Au{constructor(e){this.registry={},this.defaultAdapter=null,this.config={defaultAdapter:e.defaultAdapter||"localStorage",adapters:qr({},e.adapters),fallbackAdapter:e.fallbackAdapter||"supabase"}}createAdapter(e,t){return dr(this,null,function*(){if(this.registry[e])return this.registry[e];let r;switch(e){case"static":{const{StaticDataAdapter:n}=yield z(()=>import("./StaticDataAdapter-BQyacmPv.js"),__vite__mapDeps([8,1,2,3,4]));r=new n(t||{type:"static"});break}case"localStorage":{r=new Iu(t||this.config.adapters.localStorage);break}case"api":{const{ApiAdapter:n,isApiAdapterConfig:s}=yield z(()=>import("./ApiAdapter-C2mXMyRJ.js"),[]),o=t||this.config.adapters.api;if(!o)throw new Error("API adapter configuration is required");if(!s(o))throw new Error("API adapter requires baseUrl configuration");r=new n(o);break}case"supabase":{const{SupabaseAdapter:n}=yield uu(),s=t||this.config.adapters.supabase;if(!s)throw new Error("Supabase adapter configuration is required");r=new n(s);break}default:throw new Error(`Unknown adapter type: ${e}`)}return yield r.initialize(),this.registerAdapter(e,r),r})}getAdapter(e){return this.registry[e]||null}registerAdapter(e,t){this.registry[e]=t,e===this.config.defaultAdapter&&(this.defaultAdapter=t)}unregisterAdapter(e){const t=this.registry[e];t&&(t.disconnect().catch(console.error),delete this.registry[e],this.defaultAdapter===t&&(this.defaultAdapter=null))}initializeDefaultAdapter(){return dr(this,null,function*(){if(this.defaultAdapter)return this.defaultAdapter;try{const e=yield this.createAdapter(this.config.defaultAdapter);return this.defaultAdapter=e,e}catch(e){if(console.error(e),console.error(`Failed to initialize default adapter (${this.config.defaultAdapter}):`),this.config.fallbackAdapter&&this.config.fallbackAdapter!==this.config.defaultAdapter)try{const t=yield this.createAdapter(this.config.fallbackAdapter);return this.defaultAdapter=t,t}catch(t){throw console.error(`Failed to initialize fallback adapter (${this.config.fallbackAdapter}):`,t),new Error("No available adapters could be initialized")}throw new Error("No available adapters could be initialized")}})}getAvailableAdapters(){return Object.keys(this.registry)}getAdapterMetadata(e){const t=this.registry[e];return t?t.getMetadata():null}updateConfig(e){this.config=qr(qr({},this.config),e)}getConfig(){return qr({},this.config)}switchDefaultAdapter(e){return dr(this,null,function*(){if(!["localStorage","api","supabase"].includes(e))throw new Error(`Invalid adapter type: ${e}`);return this.config.defaultAdapter=e,this.defaultAdapter=null,this.initializeDefaultAdapter()})}getBestAvailableAdapter(){return dr(this,null,function*(){try{return yield this.initializeDefaultAdapter()}catch(e){console.error(e);const t=["supabase","localStorage"];for(const r of t)try{return yield this.createAdapter(r)}catch(n){console.warn(`Failed to create adapter ${r}:`,n);continue}throw new Error("No adapters are available")}})}cleanup(){return dr(this,null,function*(){const e=Object.values(this.registry).map(t=>t.disconnect().catch(console.error));yield Promise.all(e),this.registry={},this.defaultAdapter=null})}}const Bt=new Au({defaultAdapter:"supabase",adapters:{supabase:{type:"supabase"},localStorage:{type:"localStorage"}},fallbackAdapter:"localStorage"}),Zn=i=>i.status||i.category||"",Tu=i=>{var e,t,r,n;return((e=i.data)==null?void 0:e.toolId)||((t=i.data)==null?void 0:t.supplyId)||((r=i.data)==null?void 0:r.equipmentId)||((n=i.data)==null?void 0:n.hardwareId)||i.toolId||i.supplyId||i.equipmentId||i.hardwareId||i.id},fg=(i,e)=>{const t=new Set(i);return t.has(e)?t.delete(e):t.add(e),t},Pu=(i,e)=>{i(e)};function pg(){return{itemName:"",category:"",id:"",location:"",status:"active",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const gg=()=>({general:!0,purchase:!1,maintenance:!1,usage:!1}),mg=i=>{var e;return{itemName:i.name||i.item||"",category:i.category||"",id:Tu(i),location:i.location||"",status:i.status||"",quantity:i.quantity||1,unitCost:i.unit_cost||0,minimumQuantity:i.reorder_point||0,maximumQuantity:((e=i.data)==null?void 0:e.maximumQuantity)||0,supplier:i.supplier||"",updated_at:i.updated_at||new Date().toISOString(),createdAt:i.created_at||new Date().toISOString()}},Ou=i=>{switch(i.toLowerCase()){case"complete":case"available":case"clean":return"bg-green-100 text-green-800";case"bath1":case"bath2":return"bg-blue-100 text-blue-800";case"airDry":case"drying":return"bg-yellow-100 text-yellow-800";case"autoclave":return"bg-purple-100 text-purple-800";case"dirty":return"bg-orange-100 text-orange-800";case"damaged":case"failed":return"bg-red-100 text-red-800";case"operational":case"active":return"bg-green-100 text-green-800";case"maintenance":case"out-of-service":return"bg-amber-100 text-amber-800";case"inactive":return"bg-gray-100 text-gray-800";case"in-stock":return"bg-green-100 text-green-800";case"low-stock":return"bg-yellow-100 text-yellow-800";case"out-of-stock":return"bg-red-100 text-red-800";case"in-use":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},xu=i=>{switch(i.toLowerCase()){case"complete":return"Available";case"bath1":return"Bath 1";case"bath2":return"Bath 2";case"airDry":case"drying":return"Air Dry";case"autoclave":return"Autoclave";case"clean":return"Clean";case"dirty":return"Dirty";case"damaged":return"Damaged";case"failed":return"Failed";case"operational":return"Operational";case"maintenance":return"Maintenance";case"out-of-service":return"Out of Service";case"active":return"Available";case"inactive":return"In Use";case"in-stock":return"In Stock";case"low-stock":return"Low Stock";case"out-of-stock":return"Out of Stock";case"available":return"Available";case"in-use":return"In Use";default:return i||"Unknown"}};var Du=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class La{createCategoryChangeHandler(e){return t=>{Pu(e,t)}}createTrackedFilterHandler(e,t){return()=>{t(!e)}}createFavoritesFilterHandler(e,t){return()=>{t(!e)}}}class Ma{constructor(){this.filteredToolsData=[]}getFilteredTools(){return this.filteredToolsData.map(e=>{var t;return{id:e.id||"",name:e.name||e.item||"",barcode:((t=e.data)==null?void 0:t.barcode)||"",currentPhase:Zn(e),category:e.category||""}})}setFilteredToolsData(e){this.filteredToolsData=e}setFilteredTools(e){this.filteredToolsData=e}}class ja{getStatusBadge(e){return Ou(e)}getStatusText(e){return xu(e)}getItemStatus(e){return Zn(e)||"Unknown"}}class $u{constructor(){this.currentAdapter=null,this.adapterType="static",this.initialized=!1}initialize(){return Du(this,null,function*(){this.initialized||(this.currentAdapter=yield Bt.initializeDefaultAdapter(),this.adapterType=Bt.getConfig().defaultAdapter,this.initialized=!0)})}getAdapter(){if(!this.currentAdapter)throw new Error("Inventory service facade not initialized. Call initialize() first.");return this.currentAdapter}getCurrentAdapterType(){return this.adapterType}getAdapterMetadata(){return Bt.getAdapterMetadata(this.adapterType)}getAvailableAdapters(){return Bt.getAvailableAdapters()}}var Wi=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class T{static handleOperation(e,t){return Wi(this,null,function*(){try{return yield t()}catch(r){throw console.error(` ${e} failed:`,r),r}})}static executeWithRetry(e,t,r=3){return Wi(this,null,function*(){let n=null;for(let s=1;s<=r;s++)try{return yield t()}catch(o){if(n=o instanceof Error?o:new Error("Unknown error"),s===r)throw o;console.warn(`Retry attempt ${s}/${r} for operation: ${e}`),yield new Promise(c=>setTimeout(c,1e3*s))}throw n||new Error("Operation failed after all retry attempts")})}static delay(e){return new Promise(t=>setTimeout(t,e))}}class ei{constructor(){this.cacheManagers=new Map}static getInstance(){return this.instance||(this.instance=new ei),this.instance}registerCacheManager(e,t){this.cacheManagers.set(e,t),console.log(` Registered cache manager: ${e}`)}unregisterCacheManager(e){this.cacheManagers.delete(e),console.log(` Unregistered cache manager: ${e}`)}onInvalidation(){console.log(" Cache invalidation listener registered (simplified)")}offInvalidation(){console.log(" Cache invalidation listener removed (simplified)")}invalidatePattern(e){console.log(` Invalidating cache pattern: ${e}`),this.cacheManagers.forEach((t,r)=>{(r.includes(e)||e==="all")&&(t.invalidatePattern?t.invalidatePattern(e):t.clearCache())})}invalidateKey(e){console.log(` Invalidating cache key: ${e}`),this.cacheManagers.forEach(t=>{t.invalidateKey&&t.invalidateKey(e)})}invalidateRelated(e,t){console.log(` Invalidating related caches for operation: ${e}${t?` (${t})`:""}`),e.startsWith("inventory:")?this.invalidatePattern("inventory"):e.startsWith("knowledge:")?this.invalidatePattern("knowledge"):e.startsWith("cleaning:")?this.invalidatePattern("cleaning"):(e==="user:login"||e==="user:logout"||e==="app:refresh")&&this.clearAllCaches()}clearAllCaches(){console.log(" Clearing all caches"),this.cacheManagers.forEach(e=>{e.clearCache()})}getRegisteredManagers(){return Array.from(this.cacheManagers.keys())}isRegistered(e){return this.cacheManagers.has(e)}}const Z=ei.getInstance();var Ru=Object.defineProperty,Qi=Object.getOwnPropertySymbols,Lu=Object.prototype.hasOwnProperty,Mu=Object.prototype.propertyIsEnumerable,Yi=(i,e,t)=>e in i?Ru(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,hr=(i,e)=>{for(var t in e||(e={}))Lu.call(e,t)&&Yi(i,t,e[t]);if(Qi)for(var t of Qi(e))Mu.call(e,t)&&Yi(i,t,e[t]);return i},Hr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class G{static initialize(){this.flushInterval=setInterval(()=>{this.flushQueues()},3e4),this.setupErrorHandlers(),console.log("Monitoring service initialized")}static logEvent(e,t,r,n="info",s){const o={category:e,action:t,level:n,message:r,metadata:s,timestamp:new Date().toISOString()};this.eventQueue.push(o),n==="error"&&this.flushQueues()}static trackMetric(e,t,r,n,s){const o={name:e,value:t,unit:r,category:n,timestamp:new Date().toISOString(),metadata:s};this.metricQueue.push(o),this.metricQueue.length>=this.MAX_BATCH_SIZE&&this.flushQueues()}static reportError(e,t,r){const n={error:e,context:t,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),metadata:r};this.errorQueue.push(n),console.error(`[ERROR] ${t}:`,e,r),this.flushQueues()}static trackUserAction(e,t,r){this.logEvent(t,e,`User performed ${e}`,"info",r)}static trackApiCall(e,t,r,n,s){this.trackMetric("api_call_duration",r,"ms","api",hr({endpoint:e,method:t,status:n},s)),r>1e3&&this.logEvent("api","slow_request",`Slow API call: ${t} ${e} took ${r}ms`,"warn",hr({endpoint:e,method:t,duration:r,status:n},s)),n>=400&&this.logEvent("api","failed_request",`Failed API call: ${t} ${e} returned ${n}`,"error",hr({endpoint:e,method:t,status:n},s))}static trackPageView(e,t){this.logEvent("navigation","page_view",`User viewed ${e}`,"info",hr({page:e},t))}static trackFeatureUsage(e,t,r){this.logEvent("feature",t,`Feature used: ${e}`,"info",hr({feature:e},r))}static flushQueues(){return Hr(this,null,function*(){try{if(!Pr()){console.warn(" Supabase not configured, skipping monitoring queue flush");return}this.eventQueue.length>0&&(yield this.flushEvents()),this.metricQueue.length>0&&(yield this.flushMetrics()),this.errorQueue.length>0&&(yield this.flushErrors())}catch(e){console.error("Failed to flush monitoring queues:",e)}})}static flushEvents(){return Hr(this,null,function*(){const e=this.eventQueue.splice(0,this.MAX_BATCH_SIZE);console.log(" Monitoring: Would flush",e.length,"events (disabled for debugging)");const{data:{user:t}}=yield y.auth.getUser();let r=null;if(t){const{data:n}=yield y.from("users").select("facility_id").eq("id",t.id).single();r=(n==null?void 0:n.facility_id)||null}console.log(" Monitoring: User context:",{userId:t==null?void 0:t.id,facilityId:r,eventsQueued:this.eventQueue.length})})}static flushMetrics(){return Hr(this,null,function*(){const e=this.metricQueue.splice(0,this.MAX_BATCH_SIZE),{data:{user:t}}=yield y.auth.getUser();let r=null;if(t){const{data:s}=yield y.from("users").select("facility_id").eq("id",t.id).single();r=(s==null?void 0:s.facility_id)||null}const{error:n}=yield y.from("monitoring_performance_metrics").insert(e.map(s=>({metric_name:s.name,metric_value:s.value,facility_id:r||"default",created_at:s.timestamp})));n&&(console.error("Failed to flush performance metrics:",n),this.metricQueue.unshift(...e))})}static flushErrors(){return Hr(this,null,function*(){const e=this.errorQueue.splice(0,this.MAX_BATCH_SIZE),{data:{user:t}}=yield y.auth.getUser();let r=null;if(t){const{data:s}=yield y.from("users").select("facility_id").eq("id",t.id).single();r=(s==null?void 0:s.facility_id)||null}const{error:n}=yield y.from("error_reports").insert(e.map(s=>({error_message:s.error instanceof Error?s.error.message:s.error,error_stack:s.error instanceof Error?s.error.stack:void 0,context:s.context,user_agent:s.userAgent,metadata:s.metadata,user_id:(t==null?void 0:t.id)||null,facility_id:r,created_at:s.timestamp})));n&&(console.error("Failed to flush error reports:",n),this.errorQueue.unshift(...e))})}static setupErrorHandlers(){window.addEventListener("unhandledrejection",e=>{this.reportError(e.reason,"unhandled_promise_rejection",{promise:e.promise})}),window.addEventListener("error",e=>{this.reportError(e.error||new Error(e.message),"javascript_error",{filename:e.filename,lineno:e.lineno,colno:e.colno})})}static cleanup(){this.flushInterval&&(clearInterval(this.flushInterval),this.flushInterval=null),this.flushQueues()}}G.MAX_BATCH_SIZE=50;G.eventQueue=[];G.metricQueue=[];G.errorQueue=[];G.flushInterval=null;const M=G.logEvent.bind(G);G.trackMetric.bind(G);const Pt=G.reportError.bind(G),U=G.trackUserAction.bind(G);G.trackApiCall.bind(G);const ju=G.trackPageView.bind(G),Uu=G.trackFeatureUsage.bind(G);typeof window!="undefined"&&G.initialize();var Nu=Object.defineProperty,Ji=Object.getOwnPropertySymbols,Fu=Object.prototype.hasOwnProperty,zu=Object.prototype.propertyIsEnumerable,Xi=(i,e,t)=>e in i?Nu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,fr=(i,e)=>{for(var t in e||(e={}))Fu.call(e,t)&&Xi(i,t,e[t]);if(Ji)for(var t of Ji(e))zu.call(e,t)&&Xi(i,t,e[t]);return i},Zi=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class _r{static loadConfig(){return Zi(this,null,function*(){try{console.log("Analytics config loading temporarily disabled");return}catch(e){console.error("Error loading analytics config:",e)}})}static getConfig(){return fr({},this.config)}static updateConfig(e){return Zi(this,null,function*(){this.config=fr(fr({},this.config),e),console.log("Analytics config update temporarily disabled")})}static mergeConfig(e){e&&(this.config=fr(fr({},this.config),e))}}_r.config={providers:{supabase:{enabled:!0}},defaultProvider:"supabase"};var qu=Object.defineProperty,Hu=Object.defineProperties,Bu=Object.getOwnPropertyDescriptors,es=Object.getOwnPropertySymbols,Vu=Object.prototype.hasOwnProperty,Gu=Object.prototype.propertyIsEnumerable,ts=(i,e,t)=>e in i?qu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,_n=(i,e)=>{for(var t in e||(e={}))Vu.call(e,t)&&ts(i,t,e[t]);if(es)for(var t of es(e))Gu.call(e,t)&&ts(i,t,e[t]);return i},wn=(i,e)=>Hu(i,Bu(e)),Re=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class rs{static initialize(e){return Re(this,null,function*(){try{yield this.initializeProviders(e),console.log("Analytics providers initialized successfully")}catch(t){console.error("Failed to initialize analytics providers:",t)}})}static trackEvent(e,t,r,n,s){return Re(this,null,function*(){var o,c,a;try{if(!s){console.warn("No analytics config provided for event tracking");return}(o=s.providers.googleAnalytics)!=null&&o.enabled&&(yield this.trackToGoogleAnalytics(e,t,r,n)),(c=s.providers.mixpanel)!=null&&c.enabled&&(yield this.trackToMixpanel(e,t,r,n)),(a=s.providers.amplitude)!=null&&a.enabled&&(yield this.trackToAmplitude(e,t,r,n))}catch(l){console.error("Failed to track event to providers:",l)}})}static initializeProviders(e){return Re(this,null,function*(){var t,r,n,s,o,c;(t=e.providers.googleAnalytics)!=null&&t.enabled&&((r=e.providers.googleAnalytics)!=null&&r.measurementId)&&(yield this.initializeGoogleAnalytics(e.providers.googleAnalytics.measurementId)),(n=e.providers.mixpanel)!=null&&n.enabled&&((s=e.providers.mixpanel)!=null&&s.token)&&(yield this.initializeMixpanel(e.providers.mixpanel.token)),(o=e.providers.amplitude)!=null&&o.enabled&&((c=e.providers.amplitude)!=null&&c.apiKey)&&(yield this.initializeAmplitude(e.providers.amplitude.apiKey))})}static initializeGoogleAnalytics(e){return Re(this,null,function*(){try{if(typeof window!="undefined"&&!window.gtag){const t=document.createElement("script");t.async=!0,t.src=`https://www.googletagmanager.com/gtag/js?id=${e}`,document.head.appendChild(t),window.dataLayer=window.dataLayer||[],window.gtag=function(...r){var n;(n=window.dataLayer)==null||n.push(r)},window.gtag("js",new Date().toISOString()),window.gtag("config",e)}}catch(t){console.error("Failed to initialize Google Analytics:",t)}})}static initializeMixpanel(e){return Re(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&window.mixpanel.init(e)}catch(t){console.error("Failed to initialize Mixpanel:",t)}})}static initializeAmplitude(e){return Re(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&window.amplitude.getInstance().init(e)}catch(t){console.error("Failed to initialize Amplitude:",t)}})}static trackToGoogleAnalytics(e,t,r,n){return Re(this,null,function*(){try{typeof window!="undefined"&&window.gtag&&window.gtag("event",e,wn(_n({},t),{user_id:r,facility_id:n}))}catch(s){console.error("Error tracking event to Google Analytics:",s)}})}static trackToMixpanel(e,t,r,n){return Re(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&window.mixpanel.track(e,wn(_n({},t),{user_id:r,facility_id:n}))}catch(s){console.error("Error tracking event to Mixpanel:",s)}})}static trackToAmplitude(e,t,r,n){return Re(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&window.amplitude.getInstance().logEvent(e,wn(_n({},t),{user_id:r,facility_id:n}))}catch(s){console.error("Error tracking event to Amplitude:",s)}})}}var Ku=Object.defineProperty,Wu=Object.defineProperties,Qu=Object.getOwnPropertyDescriptors,ns=Object.getOwnPropertySymbols,Yu=Object.prototype.hasOwnProperty,Ju=Object.prototype.propertyIsEnumerable,is=(i,e,t)=>e in i?Ku(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,de=(i,e)=>{for(var t in e||(e={}))Yu.call(e,t)&&is(i,t,e[t]);if(ns)for(var t of ns(e))Ju.call(e,t)&&is(i,t,e[t]);return i},qe=(i,e)=>Wu(i,Qu(e)),oe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Xu{static trackEvent(e,t,r,n){return oe(this,null,function*(){try{const s={name:e,properties:t,userId:r,facilityId:n,timestamp:Date.now()};yield Promise.all([this.trackToSupabase(),this.trackToGoogleAnalytics(s),this.trackToMixpanel(s),this.trackToAmplitude(s)]),M("analytics",e,`Analytics event: ${e}`,"info",qe(de({},t),{userId:r,facilityId:n}))}catch(s){Pt(s instanceof Error?s:new Error("Analytics tracking failed"),"analytics_track_event")}})}static identifyUser(e){return oe(this,null,function*(){try{yield Promise.all([this.identifyToSupabase(),this.identifyToGoogleAnalytics(),this.identifyToMixpanel(e),this.identifyToAmplitude(e)]),M("analytics","user_identified",`User identified: ${e.id}`,"info",{userId:e.id,facilityId:e.facilityId})}catch(t){Pt(t instanceof Error?t:new Error("User identification failed"),"analytics_identify_user")}})}static trackPageView(e,t,r){return oe(this,null,function*(){try{yield this.trackEvent("page_view",de({page:e},t),r),ju(e,qe(de({},t),{userId:r}))}catch(n){Pt(n instanceof Error?n:new Error("Page view tracking failed"),"analytics_track_page_view")}})}static trackUserAction(e,t,r,n){return oe(this,null,function*(){try{yield this.trackEvent("user_action",de({action:e,category:t},r),n),U(e,t,qe(de({},r),{userId:n}))}catch(s){Pt(s instanceof Error?s:new Error("User action tracking failed"),"analytics_track_user_action")}})}static trackFeatureUsage(e,t,r,n){return oe(this,null,function*(){try{yield this.trackEvent("feature_usage",de({feature:e,action:t},r),n),Uu(e,t,qe(de({},r),{userId:n}))}catch(s){Pt(s instanceof Error?s:new Error("Feature usage tracking failed"),"analytics_track_feature_usage")}})}static trackConversion(e,t,r,n){return oe(this,null,function*(){try{yield this.trackEvent("conversion",de({conversion_name:e,value:t},r),n)}catch(s){Pt(s instanceof Error?s:new Error("Conversion tracking failed"),"analytics_track_conversion")}})}static trackToSupabase(){return oe(this,null,function*(){console.log("Supabase analytics tracking temporarily disabled")})}static trackToGoogleAnalytics(e){return oe(this,null,function*(){try{typeof window!="undefined"&&window.gtag&&window.gtag("event",e.name,qe(de({},e.properties),{user_id:e.userId,facility_id:e.facilityId}))}catch(t){console.error("Error tracking event to Google Analytics:",t)}})}static trackToMixpanel(e){return oe(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&window.mixpanel.track(e.name,qe(de({},e.properties),{userId:e.userId,facilityId:e.facilityId}))}catch(t){console.error("Error tracking event to Mixpanel:",t)}})}static trackToAmplitude(e){return oe(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&window.amplitude.getInstance().logEvent(e.name,qe(de({},e.properties),{userId:e.userId,facilityId:e.facilityId}))}catch(t){console.error("Error tracking event to Amplitude:",t)}})}static identifyToSupabase(){return oe(this,null,function*(){console.log("Supabase user identification temporarily disabled")})}static identifyToGoogleAnalytics(){return oe(this,null,function*(){try{typeof window!="undefined"&&window.gtag&&console.log("Google Analytics user identification requires measurement ID from config")}catch(e){console.error("Error identifying user to Google Analytics:",e)}})}static identifyToMixpanel(e){return oe(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&(window.mixpanel.identify(e.id),window.mixpanel.people.set(de({$email:e.email,$name:e.full_name,facilityId:e.facilityId},e.properties)))}catch(t){console.error("Error identifying user to Mixpanel:",t)}})}static identifyToAmplitude(e){return oe(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&(window.amplitude.getInstance().setUserId(e.id),window.amplitude.getInstance().setUserProperties(qe(de({},e.properties),{facilityId:e.facilityId})))}catch(t){console.error("Error identifying user to Amplitude:",t)}})}}const Zu=600*1e3,we={MAX_LIFECYCLE:95,MIN_LIFECYCLE:10,LIFECYCLE_MULTIPLIER:2.5,ANALYSIS_DAYS:90,MAX_CYCLES_PER_DAY:.1,MIN_CONFIDENCE:.6,MAX_CONFIDENCE:.95,CONFIDENCE_BASE:.75,REORDER_DAYS_BEFORE_EOL:30,MIN_REORDER_DAYS:7},te={ANALYSIS_DAYS:30,RECENT_ANALYSIS_DAYS:7,MAX_CAPACITY_PER_DAY:24,MIN_LOAD_PERCENTAGE:10,MAX_LOAD_PERCENTAGE:100,HIGH_USAGE_THRESHOLD:20,MEDIUM_USAGE_THRESHOLD:15,HIGH_OVERLOAD_DAYS:15,MEDIUM_OVERLOAD_DAYS:45,LOW_OVERLOAD_DAYS:90,HIGH_LOAD_THRESHOLD:90,MEDIUM_LOAD_THRESHOLD:75,LOW_LOAD_THRESHOLD:60,HIGH_QUEUE_THRESHOLD:5,HIGH_FAILURE_RATE:.1,PATIENT_LOAD_MULTIPLIER:1.2},ss={ANALYSIS_DAYS:365,PROJECTION_MONTHS:.5},Ot={ANALYSIS_DAYS:30,DEFAULT_FTE:8.5,WORKLOAD_INCREASE_THRESHOLD:20,FTE_INCREASE:.5,COST_PER_FTE:5e4},xt={ANALYSIS_DAYS:30,GROWTH_RATE:1.1,INCIDENT_RATE:.3,HIGH_WORKLOAD_THRESHOLD:20,MEDIUM_WORKLOAD_THRESHOLD:10,HIGH_COVERAGE_THRESHOLD:15},Vt={IMMEDIATE:"Immediate",Q1_2025:"Q1 2025",Q2_2025:"Q2 2025",Q3_2025:"Q3 2025",NEXT_QUARTER:"Next quarter",MONITOR_3_MONTHS:"Monitor for 3 months"},Br={ADD_AUTOCLAVE:"add_autoclave",EXTEND_HOURS:"extend_hours",OPTIMIZE_SCHEDULE:"optimize_schedule"},bn={LOW:"low",MEDIUM:"medium",HIGH:"high"};var ed=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Gt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Gt.instance||(Gt.instance=new Gt),Gt.instance}getToolReplacementForecast(){return ed(this,arguments,function*(e={}){try{const t=`tool_replacement_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for tool replacement forecast"),[];const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-we.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for tool replacement forecast"),[];const o=n.slice(0,5).map((c,a)=>{var l;const u=n.filter(b=>b.tool_batch_id===c.tool_batch_id).length,d=Math.min(we.MAX_LIFECYCLE,Math.max(we.MIN_LIFECYCLE,Math.floor(u*we.LIFECYCLE_MULTIPLIER))),f=u/we.ANALYSIS_DAYS,m=Math.max(0,100-d)/Math.max(we.MAX_CYCLES_PER_DAY,f),w=new Date(Date.now()+m*24*60*60*1e3).toISOString().split("T")[0],S=Math.min(we.MAX_CONFIDENCE,Math.max(we.MIN_CONFIDENCE,we.CONFIDENCE_BASE+u/100)),I=new Date(Date.now()+Math.max(we.MIN_REORDER_DAYS,m-we.REORDER_DAYS_BEFORE_EOL)*24*60*60*1e3).toISOString().split("T")[0];return{toolBatchId:(l=c.tool_batch_id)!=null?l:`TB${String(a+1).padStart(3,"0")}`,toolName:`Tool Set ${String.fromCharCode(65+a)}`,currentLifecycle:d,predictedEndOfLife:w,confidence:S,recommendedReorderDate:I,supplierSuggestion:"Contact procurement for supplier information",estimatedCost:0}});return this.setCachedData(t,o),o}catch(t){return console.error("Error forecasting tool replacement:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var td=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Kt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Kt.instance||(Kt.instance=new Kt),Kt.instance}getAutoclaveCapacityForecast(){return td(this,arguments,function*(e={}){try{const t=`autoclave_capacity_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for autoclave capacity forecast"),[];const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).not("autoclave_id","is",null).gte("created_at",new Date(Date.now()-te.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No autoclave data found for capacity forecast"),[];const{data:o,error:c}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-te.RECENT_ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(c)return console.warn("Failed to fetch recent cycles for autoclave capacity forecast"),[];const a=n.reduce((u,d)=>{var f;const h=(f=d.autoclave_id)!=null?f:"";return h&&(u[h]||(u[h]=[]),u[h].push(d)),u},{}),l=Object.entries(a).map(([u,d])=>{const f=d.length,h=d.filter(D=>D.status==="clean").length,m=d.filter(D=>D.status==="problem").length,w=f/te.ANALYSIS_DAYS,S=te.MAX_CAPACITY_PER_DAY,I=Math.min(te.MAX_LOAD_PERCENTAGE,Math.max(te.MIN_LOAD_PERCENTAGE,Math.round(w/S*100))),v=((o==null?void 0:o.filter(D=>D.autoclave_id===u&&D.status==="pending"||D.status==="running"))||[]).length,_=w>te.HIGH_USAGE_THRESHOLD?"high":w>te.MEDIUM_USAGE_THRESHOLD?"medium":"low",E=_==="high"?te.HIGH_OVERLOAD_DAYS:_==="medium"?te.MEDIUM_OVERLOAD_DAYS:te.LOW_OVERLOAD_DAYS,k=new Date(Date.now()+E*24*60*60*1e3).toISOString().split("T")[0];let A,N;return I>te.HIGH_LOAD_THRESHOLD||m>f*te.HIGH_FAILURE_RATE?(A=Br.ADD_AUTOCLAVE,N=Vt.IMMEDIATE):I>te.MEDIUM_LOAD_THRESHOLD||v>te.HIGH_QUEUE_THRESHOLD?(A=Br.EXTEND_HOURS,N=Vt.Q1_2025):I>te.LOW_LOAD_THRESHOLD?(A=Br.OPTIMIZE_SCHEDULE,N=Vt.Q2_2025):(A=Br.OPTIMIZE_SCHEDULE,N=Vt.Q3_2025),{autoclaveId:u,currentLoadPercentage:I,queueLength:v,predictedOverloadDate:k,recommendedAction:A,timeline:N,projectedPatientLoad:Math.round(h*te.PATIENT_LOAD_MULTIPLIER)}});return this.setCachedData(t,l),l}catch(t){return console.error("Error forecasting autoclave capacity:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var rd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Wt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Wt.instance||(Wt.instance=new Wt),Wt.instance}getInventoryInflationForecast(){return rd(this,arguments,function*(e={}){try{const t=`inventory_inflation_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for inventory inflation forecast"),[];const n=yield ti.getItems();let s=n;e.facilityId&&(s=n.filter(l=>l.facility_id===e.facilityId));const o=new Date(Date.now()-ss.ANALYSIS_DAYS*24*60*60*1e3);if(s=s.filter(l=>l.created_at&&new Date(l.created_at)>=o),s.sort((l,u)=>new Date(u.created_at||"").getTime()-new Date(l.created_at||"").getTime()),!s||s.length===0)return console.warn("No inventory data found for inflation forecast"),[];const c=s.reduce((l,u)=>{var d,f;const h=(f=(d=u.data)==null?void 0:d.category)!=null?f:"Uncategorized";return l[h]||(l[h]=[]),l[h].push(u),l},{}),a=Object.entries(c).map(([l,u])=>{var d,f;const h=u.map(b=>{var v;return((v=b.data)==null?void 0:v.unit_cost)||0}).filter(b=>b>0);if(h.length===0)return null;const m=(d=h[h.length-1])!=null?d:0,w=(f=h[0])!=null?f:0,S=m-w,I=w>0?S/w*100:0;return{category:l,currentPrice:m,priceIncrease:S,inflationRate:I,projectedYearEndPrice:m*(1+I/100*ss.PROJECTION_MONTHS),cheaperSupplierExists:!1,alternativeSupplier:void 0,costSavings:0}}).filter(Boolean);return this.setCachedData(t,a),a}catch(t){return console.error("Error forecasting inventory inflation:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var nd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Qt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Qt.instance||(Qt.instance=new Qt),Qt.instance}getClinicalStaffingForecast(){return nd(this,arguments,function*(e={}){try{const t=`clinical_staffing_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for clinical staffing forecast"),[];const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-Ot.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for clinical staffing forecast"),[];const o=n.length,c=n.filter(f=>f.status!=="clean"&&f.status!=="problem").length,a=Ot.DEFAULT_FTE,l=Math.max(0,c/o*100),u=l>Ot.WORKLOAD_INCREASE_THRESHOLD?a+Ot.FTE_INCREASE:a,d=[{currentFTE:a,recommendedFTE:u,timeline:l>Ot.WORKLOAD_INCREASE_THRESHOLD?Vt.NEXT_QUARTER:Vt.MONITOR_3_MONTHS,workloadIncrease:l,skillsetGaps:[],trainingRecommendations:[],estimatedCost:Math.round((u-a)*Ot.COST_PER_FTE)}];return this.setCachedData(t,d),d}catch(t){return console.error("Error forecasting clinical staffing:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var id=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Yt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Yt.instance||(Yt.instance=new Yt),Yt.instance}getAdminStaffingForecast(){return id(this,arguments,function*(e={}){try{const t=`admin_staffing_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for admin staffing forecast"),[];const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-xt.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for admin staffing forecast"),[];const o=n.length,c=n.filter(w=>w.status!=="clean"&&w.status!=="problem").length,a=o,l=Math.round(o*xt.GROWTH_RATE),u=Math.max(0,l-a),d=Math.floor(c*xt.INCIDENT_RATE),f=c>0?Math.max(1,Math.floor(c/2)):0;let h;u>xt.HIGH_WORKLOAD_THRESHOLD?h=bn.HIGH:u>xt.MEDIUM_WORKLOAD_THRESHOLD?h=bn.MEDIUM:h=bn.LOW;const m=[{currentWorkload:a,projectedWorkload:l,workloadExcess:u,recommendedCoverage:u>xt.HIGH_COVERAGE_THRESHOLD?"Additional 0.5 FTE admin support":"Current staffing adequate",qualityIncidents:d,resolutionLag:f,priority:h}];return this.setCachedData(t,m),m}catch(t){return console.error("Error forecasting admin staffing:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var sd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Jt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Jt.instance||(Jt.instance=new Jt),Jt.instance}getTheftLossEstimate(){return sd(this,arguments,function*(e={}){try{const t=`theft_loss_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for theft/loss estimation"),{estimatedLossPercentage:0,estimatedLossValue:0,flaggedItems:[],repeatOffenders:[],riskFactors:[],recommendedActions:[],confidence:0};const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for theft/loss estimation"),{estimatedLossPercentage:0,estimatedLossValue:0,flaggedItems:[],repeatOffenders:[],riskFactors:[],recommendedActions:[],confidence:0};const o=n.length,c=n.filter(f=>f.status!=="clean"&&f.status!=="problem").length,a=Math.min(10,Math.max(0,c/o*100)),l=Math.round(a*1e3),u=n.filter(f=>f.status!=="clean").map(f=>`Tool ${f.id}`).slice(0,3),d={estimatedLossPercentage:Math.round(a*10)/10,estimatedLossValue:l,flaggedItems:u.length>0?u:["No specific items flagged"],repeatOffenders:[],riskFactors:c>0?["Incomplete sterilization cycles","Missing cycle documentation","Protocol non-compliance"]:["Minimal risk factors detected"],recommendedActions:["Complete incomplete sterilization cycles","Review cycle documentation procedures","Monitor compliance metrics"],confidence:Math.max(.5,1-a/100)};return this.setCachedData(t,d),d}catch(t){return console.error("Error estimating theft/loss:",t),{estimatedLossPercentage:0,estimatedLossValue:0,flaggedItems:[],repeatOffenders:[],riskFactors:[],recommendedActions:[],confidence:0}}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var ad=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Xt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Xt.instance||(Xt.instance=new Xt),Xt.instance}getSupplyDepletionForecast(){return ad(this,arguments,function*(e={}){try{const t=`supply_depletion_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for supply depletion forecast"),[];const n=yield ti.getItems();let s=n;if(e.facilityId&&(s=n.filter(c=>c.facility_id===e.facilityId)),s.sort((c,a)=>(c.quantity||0)-(a.quantity||0)),!s||s.length===0)return console.warn("No inventory data found for supply depletion forecast"),[];const o=s.slice(0,8).map((c,a)=>{var l,u,d,f,h,m,w;const S=(l=c.quantity)!=null?l:0,I=(d=(u=c.data)==null?void 0:u.reorder_point)!=null?d:100,b=(h=(f=c.data)==null?void 0:f.unit_cost)!=null?h:50;let v;S<=I*.5?v="critical":S<=I*.8?v="high":S<=I*1.2?v="medium":v="low";const _=Math.ceil(S/(I/30)),E=new Date(Date.now()+_*24*60*60*1e3),k=new Date(E.getTime()-10080*60*1e3);return{itemName:(m=c.name)!=null?m:`Item ${a+1}`,currentStock:S,depletionDate:E.toISOString().split("T")[0],reorderUrgency:v,recommendedReorderDate:k.toISOString().split("T")[0],currentCost:b,historicalCosts:[b*.95,b*.98,b],costTrend:b>(((w=c.data)==null?void 0:w.last_restocked_cost)||b)?"increasing":"stable"}});return this.setCachedData(t,o),o}catch(t){return console.error("Error forecasting supply depletion:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var od=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Zt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Zt.instance||(Zt.instance=new Zt),Zt.instance}getEfficiencyROITracker(){return od(this,arguments,function*(e={}){try{const t=`efficiency_roi_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for efficiency ROI tracking"),null;const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for efficiency ROI tracking"),null;const o=n.length,c=n.filter(h=>h.status==="clean").length,a=o>0?c/o*100:0,l=Math.round(a/100*40),u=l*42,d=u*12,f={timeSavedHours:l,estimatedLaborSavings:u,aiFeatureUsage:[{feature:"Automated scheduling",usageCount:Math.floor(o*.8),timeSaved:Math.round(l*.3)},{feature:"Smart inventory alerts",usageCount:Math.floor(o*.6),timeSaved:Math.round(l*.2)},{feature:"Predictive maintenance",usageCount:Math.floor(o*.4),timeSaved:Math.round(l*.1)}],automationEfficiency:Math.round(a),moduleContributions:[{module:"Sterilization",timeSaved:Math.round(l*.5),costSavings:Math.round(u*.5),efficiency:Math.round(a)},{module:"Inventory",timeSaved:Math.round(l*.3),costSavings:Math.round(u*.3),efficiency:Math.round(a*.9)},{module:"Environmental",timeSaved:Math.round(l*.2),costSavings:Math.round(u*.2),efficiency:Math.round(a*.8)}],projectedAnnualSavings:d};return this.setCachedData(t,f),f}catch(t){return console.error("Error tracking efficiency ROI:",t),null}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}function cd(i){const e=new Array(24).fill(0);i.forEach(n=>{if(n.created_at){const s=new Date(n.created_at).getHours();e[s]++}});const t=Math.max(...e),r=e.map((n,s)=>({count:n,hour:s})).filter(({count:n})=>n>=t*.8).map(({hour:n})=>`${n.toString().padStart(2,"0")}:00`).slice(0,4);return r.length>0?r:["09:00","12:00","15:00"]}function ld(i){return i>=90?"Excellent utilization - maintain current practices":i>=80?"Good utilization - minor optimizations possible":i>=70?"Moderate utilization - consider schedule optimization":"Low utilization - review tool allocation and scheduling"}function ud(i){const e=[];return i<80&&e.push("Low utilization efficiency"),i<70&&e.push("Significant idle time detected"),e.length>0?e:["Minimal bottlenecks detected"]}var Sn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Je{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Je.instance||(Je.instance=new Je),Je.instance}getToolTurnoverUtilization(){return Sn(this,arguments,function*(e={}){try{const t=`tool_turnover_utilization_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for tool turnover utilization"),[];const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for tool turnover utilization"),[];const o=n.reduce((a,l)=>{var u;const d=(u=l.tool_batch_id)!=null?u:"";return d&&(a[d]||(a[d]=[]),a[d].push(l)),a},{}),c=Object.entries(o).map(([a,l])=>{const u=l.length,d=Math.min(100,u/7*100),f=u/7,h=cd(l),m=Math.min(100,Math.max(50,d)),w=f,S=Math.max(0,100-m);return{toolBatchId:a,toolName:`Tool ${a}`,dailyCycleCount:u,weeklyUtilization:d,averageCyclesPerDay:f,peakUsageHours:h,utilizationEfficiency:m,turnoverRate:w,idleTimePercentage:S,recommendedOptimization:ld(m),bottleneckIndicators:ud(m),performanceScore:Math.round(m)}});return this.setCachedData(t,c),c}catch(t){return console.error("Error analyzing tool turnover utilization:",t),[]}})}getSterilizationMetrics(){return Sn(this,arguments,function*(e={}){try{if(!e.facilityId)return{biPassRate:0,cycleEfficiency:0,qualityScore:0};const{data:t}=yield y.from("bi_test_results").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()),{data:r}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString());let n=100;if(t&&t.length>0){const c=Array.isArray(t)?t.filter(a=>a.result==="pass").length:0;n=Math.round(c/t.length*100)}let s=100;if(r&&r.length>0){const c=r.filter(a=>a.status==="clean").length;s=Math.round(c/r.length*100)}const o=Math.round((n+s)/2);return{biPassRate:n,cycleEfficiency:s,qualityScore:o}}catch(t){return console.error("Error getting sterilization metrics:",t),{biPassRate:0,cycleEfficiency:0,qualityScore:0}}})}getInventoryMetrics(){return Sn(this,arguments,function*(e={}){try{if(!e.facilityId)return{turnoverRate:0,stockLevel:0,reorderEfficiency:0};const t=yield ti.getItems();let r=t;e.facilityId&&(r=t.filter(c=>c.facility_id===e.facilityId));let n=80;if(r&&r.length>0){const c=r.filter(l=>{var u;return((u=l.status)!=null?u:"")==="active"}).length,a=r.length;a>0&&(n=Math.round(c/a*100))}let s=100;if(r&&r.length>0){const c=r.filter(a=>{var l;return a.quantity>((l=a.reorder_point)!=null?l:0)}).length;s=Math.round(c/r.length*100)}const o=Math.round((n+s)/2);return{turnoverRate:n,stockLevel:s,reorderEfficiency:o}}catch(t){return console.error("Error getting inventory metrics:",t),{turnoverRate:0,stockLevel:0,reorderEfficiency:0}}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var as=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class pt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return pt.instance||(pt.instance=new pt),pt.instance}getAuditRiskScore(){return as(this,arguments,function*(e={}){try{const t=`audit_risk_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for audit risk score"),null;const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n)return console.warn("Failed to fetch sterilization data for audit risk assessment"),null;const o=n.length,c=n.filter(w=>w.status!=="clean"&&w.status!=="problem").length,{data:a,error:l}=yield y.from("biological_indicators").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString()),u=l||!a?0:Array.isArray(a)?a.filter(w=>w.status==="skipped"||w.status==="pending").length:0,d=Math.max(0,c/o*100),f=Math.min(100,Math.max(0,c/o*40+u*15+d*.4));let h;f>=80?h="critical":f>=60?h="high":f>=40?h="medium":h="low";const m={overallRiskScore:Math.round(f),riskLevel:h,riskFactors:[{factor:"Incomplete cycles",severity:Math.min(10,Math.max(1,Math.round(c/o*10))),description:`${c} sterilization cycles incomplete this week`},{factor:"Policy adherence",severity:Math.min(10,Math.max(1,Math.round((100-d)/10))),description:`Protocol adherence at ${Math.round(100-d)}%`}],skippedIndicators:u,incompleteCycles:c,policyDrift:d,recommendedActions:["Complete incomplete sterilization cycles","Review and reinforce protocol training","Monitor BI/CI test completion rates"]};return this.setCachedData(t,m),m}catch(t){return console.error("Error assessing audit risk:",t),null}})}getTrainingKnowledgeGaps(){return as(this,arguments,function*(e={}){try{const t=`training_gaps_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for training knowledge gaps"),null;const{data:n,error:s}=yield y.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for training gap analysis"),null;const o=n.reduce((h,m)=>{var w,S,I,b,v,_;const E=(S=(w=m.operator_id)!=null?w:m.user_id)!=null?S:"";return E&&(h[E]||(h[E]={cycles:[],failedSteps:[],performanceMetrics:[]}),h[E].cycles.push(m),m.status!=="clean"&&h[E].failedSteps.push(`Cycle ${m.id} - ${m.status}`),m.status==="clean"&&h[E].performanceMetrics.push({cycleId:(I=m.id)!=null?I:"",duration:(b=m.duration_minutes)!=null?b:0,temperature:(v=m.temperature_celsius)!=null?v:0,pressure:(_=m.pressure_psi)!=null?_:0})),h},{}),c=Object.entries(o).map(([h,m])=>{const w=m.failedSteps.length>0,S=m.performanceMetrics.length>0?m.performanceMetrics.reduce((b,v)=>b+v.duration,0)/m.performanceMetrics.length:0;let I=[];return w?I=["Review sterilization protocols","Complete cycle documentation training","Practice emergency shutdown procedures"]:S>60?I=["Optimize cycle timing procedures","Review load preparation best practices","Efficiency improvement training"]:I=["Maintain current training standards","Advanced sterilization techniques","Quality assurance best practices"],{userId:h,userName:`User ${h}`,failedSteps:m.failedSteps.slice(0,3),skippedContent:[],recommendedTraining:I,performanceMetrics:{totalCycles:m.cycles.length,successRate:m.cycles.length>0?(m.cycles.length-m.failedSteps.length)/m.cycles.length*100:100,averageDuration:Math.round(S)}}}),a=c.length,l=c.filter(h=>h.failedSteps.length>0).length,u=a>0?c.reduce((h,m)=>h+m.performanceMetrics.successRate,0)/a:100,d=Math.min(100,Math.max(0,l/a*40+(100-u)/100*30+(a<3?20:0)+(c.some(h=>h.performanceMetrics.averageDuration>60)?10:0))),f={usersWithGaps:c,overallGapScore:Math.round(d),criticalGaps:c.filter(h=>h.failedSteps.length>2||h.performanceMetrics.successRate<80).map(()=>"Sterilization protocol adherence"),knowledgeHubRecommendations:["Review sterilization SOPs","Complete cycle documentation training","Monitor user performance metrics","Efficiency optimization training","Quality assurance procedures"]};return this.setCachedData(t,f),f}catch(t){return console.error("Error analyzing training gaps:",t),null}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var ge=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class wr{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=Zu}static getInstance(){return wr.instance||(wr.instance=new wr),wr.instance}getToolReplacementForecast(){return ge(this,arguments,function*(e={}){return Gt.getInstance().getToolReplacementForecast(e)})}getAutoclaveCapacityForecast(){return ge(this,arguments,function*(e={}){return Kt.getInstance().getAutoclaveCapacityForecast(e)})}getInventoryInflationForecast(){return ge(this,arguments,function*(e={}){return Wt.getInstance().getInventoryInflationForecast(e)})}getClinicalStaffingForecast(){return ge(this,arguments,function*(e={}){return Qt.getInstance().getClinicalStaffingForecast(e)})}getAdminStaffingForecast(){return ge(this,arguments,function*(e={}){return Yt.getInstance().getAdminStaffingForecast(e)})}getTheftLossEstimate(){return ge(this,arguments,function*(e={}){return Jt.getInstance().getTheftLossEstimate(e)})}getSupplyDepletionForecast(){return ge(this,arguments,function*(e={}){return Xt.getInstance().getSupplyDepletionForecast(e)})}getToolTurnoverUtilization(){return ge(this,arguments,function*(e={}){return Je.getInstance().getToolTurnoverUtilization(e)})}getAuditRiskScore(){return ge(this,arguments,function*(e={}){return pt.getInstance().getAuditRiskScore(e)})}getTrainingKnowledgeGaps(){return ge(this,arguments,function*(e={}){return pt.getInstance().getTrainingKnowledgeGaps(e)})}getEfficiencyROITracker(){return ge(this,arguments,function*(e={}){return Zt.getInstance().getEfficiencyROITracker(e)})}getIntelligenceSummary(){return ge(this,arguments,function*(e={},t=!1){try{const r=`intelligence_summary_${JSON.stringify(e)}`;t&&this.clearCache("intelligence_summary");const n=this.getCachedData(r);if(n&&!t)return n;const[s,o,c,a,l,u,d,f,h,m,w,S,I]=yield Promise.all([this.getToolReplacementForecast(e),this.getAutoclaveCapacityForecast(e),this.getInventoryInflationForecast(e),this.getClinicalStaffingForecast(e),this.getAdminStaffingForecast(e),this.getTheftLossEstimate(e),this.getSupplyDepletionForecast(e),this.getToolTurnoverUtilization(e),this.getAuditRiskScore(e),this.getTrainingKnowledgeGaps(e),this.getEfficiencyROITracker(e),Je.getInstance().getSterilizationMetrics(e),Je.getInstance().getInventoryMetrics(e)]),b=a[0]||null,v=l[0]||null,_={toolReplacement:s,autoclaveCapacity:o,inventoryInflation:c,clinicalStaffing:b,adminStaffing:v,theftLoss:u,supplyDepletion:d,toolTurnoverUtilization:f,auditRisk:h||{overallRiskScore:0,riskLevel:"low",riskFactors:[],skippedIndicators:0,incompleteCycles:0,policyDrift:0,recommendedActions:[]},trainingGaps:m||{usersWithGaps:[],overallGapScore:0,criticalGaps:[],knowledgeHubRecommendations:[]},efficiencyROI:w||{timeSavedHours:0,estimatedLaborSavings:0,aiFeatureUsage:[],automationEfficiency:0,moduleContributions:[],projectedAnnualSavings:0},sterilization:S,inventory:I,lastUpdated:new Date().toISOString(),confidence:.89};return this.setCachedData(r,_),_}catch(r){throw console.error("Error generating intelligence summary:",r),r}})}clearCache(e){e?Array.from(this.cache.keys()).filter(r=>r.startsWith(e)).forEach(r=>this.cache.delete(r)):this.cache.clear()}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var dd=Object.defineProperty,hd=Object.defineProperties,fd=Object.getOwnPropertyDescriptors,os=Object.getOwnPropertySymbols,pd=Object.prototype.hasOwnProperty,gd=Object.prototype.propertyIsEnumerable,cs=(i,e,t)=>e in i?dd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ls=(i,e)=>{for(var t in e||(e={}))pd.call(e,t)&&cs(i,t,e[t]);if(os)for(var t of os(e))gd.call(e,t)&&cs(i,t,e[t]);return i},us=(i,e)=>hd(i,fd(e)),He=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Ua{getLearningInsights(){return He(this,null,function*(){try{const{data:{user:e}}=yield y.auth.getUser();if(!e)return null;const{data:t}=yield y.from("users").select("facility_id").eq("id",e.id).single(),{data:r,error:n}=yield y.from("ai_learning_insights").select("*").eq("user_id",e.id).eq("facility_id",t==null?void 0:t.facility_id).single();if(n&&n.code!=="PGRST116")throw n;return r}catch(e){return console.error("Error fetching AI learning insights:",e),null}})}getContentRecommendations(e=5){return He(this,null,function*(){try{const{data:{user:t}}=yield y.auth.getUser();if(!t)return[];const{data:r,error:n}=yield y.from("ai_content_recommendations").select("*").eq("user_id",t.id).gte("recommendation_score",70).order("recommendation_score",{ascending:!1}).limit(e);if(n){if(n.code==="42P01")return console.warn("ai_content_recommendations table does not exist, returning empty recommendations"),[];throw n}return r.map(s=>{var o;return{id:s.id,user_id:s.user_id,content_id:s.content_id,recommendation_score:s.recommendation_score,recommendation_type:s.recommendation_type,reasoning:s.reasoning,created_at:s.created_at,updated_at:s.updated_at,is_displayed:s.is_displayed,is_clicked:s.is_clicked,is_completed:s.is_completed,display_count:s.display_count,click_count:s.click_count,completion_count:s.completion_count,user_feedback:s.user_feedback,ai_model_version:s.ai_model_version,learning_context:s.learning_context,content_metadata:s.content_metadata,tags:(o=s.data)==null?void 0:o.tags,recommendation_reason:s.recommendation_reason||s.reasoning,confidence_level:s.confidence_level||.8,user_context:s.user_context||{},content_context:s.content_context||{},click_through_rate:s.click_through_rate||0,completion_rate:s.completion_rate||0,user_feedback_rating:s.user_feedback_rating||0,ai_confidence_score:s.ai_confidence_score||.8,recommendation_algorithm:s.recommendation_algorithm||"default",last_ai_analysis:s.last_ai_analysis||new Date().toISOString(),model_version:s.model_version||"1.0.0",feature_vector:s.feature_vector||[],algorithm_used:s.algorithm_used||"default",expires_at:s.expires_at||null,recommendation_timing:s.recommendation_timing||"immediate"}})||[]}catch(t){return console.error("Error fetching AI content recommendations:",t),[]}})}trackRecommendationInteraction(e,t){return He(this,null,function*(){try{const{data:{user:r}}=yield y.auth.getUser();if(!r)return!1;const n={};switch(t){case"displayed":n.is_displayed=!0,n.display_count=(n.display_count||0)+1;break;case"clicked":n.is_clicked=!0;break;case"completed":n.is_completed=!0;break}const{error:s}=yield y.from("ai_content_recommendations").update(n).eq("id",e).eq("user_id",r.id);if(s){if(s.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping interaction tracking"),!1;throw s}return!0}catch(r){return console.error("Error tracking recommendation interaction:",r),!1}})}storeLearningInsights(e){return He(this,null,function*(){try{const{data:{user:t}}=yield y.auth.getUser();if(!t)return!1;const{error:r}=yield y.from("ai_learning_insights").upsert(us(ls({user_id:t.id},e),{last_ai_analysis:new Date().toISOString(),updated_at:new Date().toISOString()}));if(r)throw r;return!0}catch(t){return console.error("Error storing AI learning insights:",t),!1}})}storeContentRecommendation(e,t){return He(this,null,function*(){try{const{data:{user:r}}=yield y.auth.getUser();if(!r)return!1;const{error:n}=yield y.from("ai_content_recommendations").insert(us(ls({user_id:r.id,content_id:e},t),{created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));if(n){if(n.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping recommendation storage"),!1;throw n}return!0}catch(r){return console.error("Error storing AI content recommendation:",r),!1}})}getLearningAnalytics(){return He(this,null,function*(){try{const{data:{user:e}}=yield y.auth.getUser();if(!e)return[];const{data:t,error:r}=yield y.from("ai_learning_analytics").select("*").eq("user_id",e.id).order("session_start",{ascending:!1}).limit(10);if(r)throw r;return t.map(n=>({id:n.id,user_id:n.user_id,content_id:n.content_id,progress_status:n.progress_status}))||[]}catch(e){return console.error("Error fetching learning analytics:",e),[]}})}storeSessionAnalytics(e){return He(this,null,function*(){try{const{data:{user:t}}=yield y.auth.getUser();if(!t)return!1;const{data:r,error:n}=yield y.from("users").select("facility_id").eq("id",t.id).single();if(n||!(r!=null&&r.facility_id))return console.error("Missing facility_id in user profile"),!1;const{error:s}=yield y.from("ai_learning_analytics").insert({user_id:t.id,facility_id:r.facility_id,session_start:new Date(e.session_start).toISOString(),content_items_accessed:e.content_items_accessed,learning_path_progress:e.learning_path_progress,learning_patterns:e.learning_patterns,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(s)throw s;return!0}catch(t){return console.error("Error storing learning session analytics:",t),!1}})}generateLearningInsights(){return He(this,null,function*(){try{const{data:{user:e}}=yield y.auth.getUser();if(!e)return null;const{data:t}=yield y.from("knowledge_hub_user_progress").select("*").eq("user_id",e.id);if(!t||t.length===0)return null;const r=this.analyzeLearningPatterns(t.map(n=>({id:n.id,user_id:n.user_id,content_id:n.content_id,progress_status:n.progress_status})));return yield this.storeLearningInsights(r),r}catch(e){return console.error("Error generating learning insights:",e),null}})}analyzeLearningPatterns(e){const t=e.filter(u=>u.progress_status==="completed"),r=e.length,n=t.length,s=r>0?n/r*100:0,o=e.reduce((u,d)=>{const f=d.content_type||"Unknown";return u[f]=(u[f]||0)+1,u},{}),c=Object.entries(o).sort(([,u],[,d])=>d-u).slice(0,3).map(([u])=>u),a=t.filter(u=>u.time_spent_minutes),l=a.length>0?Math.round(a.reduce((u,d)=>u+(d.time_spent_minutes||0),0)/a.length):30;return{learning_efficiency_score:Math.round(s),preferred_content_categories:c,optimal_study_duration:l,next_learning_milestone:this.predictNextMilestone(e),skill_gaps:this.identifySkillGaps(e),ai_confidence_score:.8,model_version:"v1.0"}}predictNextMilestone(e){const t=e.filter(r=>r.progress_status==="completed");return t.length===0?"Complete your first course":t.length<3?"Complete 3 courses to build foundation":t.length<10?"Complete 10 courses for intermediate level":"Achieve advanced certification"}identifySkillGaps(e){const t=[],r=new Set(e.filter(n=>n.progress_status==="completed").map(n=>n.content_type));return r.has("procedure")||t.push("Clinical Procedures"),r.has("policy")||t.push("Healthcare Policies"),r.has("learning_pathway")||t.push("Structured Learning Paths"),t}}function md(i){return i.sort((e,t)=>{const r={critical:4,high:3,medium:2,low:1},n=r[t.priority]-r[e.priority];return n!==0?n:t.confidence-e.confidence})}function yd(i){return i.sort((e,t)=>t.priority-e.priority)}function vd(i){return i.sort((e,t)=>{const r={critical:3,high:2,medium:1,low:0};return r[t.severity]-r[e.severity]})}function _d(i){return{cost_optimization:"cost_savings",risk_mitigation:"risk_mitigation",efficiency_improvement:"efficiency",training_needed:"training",capacity_planning:"capacity",compliance_issue:"compliance"}[i]||"efficiency"}function wd(i,e){const t=(i+e)/2;return t>.9?"critical":t>.8?"high":t>.7?"medium":"low"}function bd(i){var e;return i.recommendation_reason||`AI analysis suggests ${((e=i.content_context)==null?void 0:e.category)||"optimization"} opportunities based on your usage patterns.`}function Sd(i){const e=Number(i.recommendation_score)||.5;return{costSavings:e*1e3,timeSavings:e*2,riskReduction:e*50,efficiencyGain:e*30}}function Id(i){return i.recommendation_type&&console.debug("AI recommendation type available for action items"),["Review AI-generated insights","Implement suggested optimizations","Monitor performance improvements","Provide feedback for learning"]}function Ed(i){const e=i.recommendation_score||.5;return e>.9?"Immediate":e>.8?"1-2 weeks":e>.7?"2-4 weeks":"1-2 months"}function kd(i){return i.feature_vector&&console.debug("Feature vector available for metrics extraction"),["ai_confidence","user_behavior","performance_patterns"]}function Cd(i){return i>.9?"critical":i>.8?"high":i>.7?"medium":"low"}var In=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ut{static generateHybridRecommendations(e,t,r){return In(this,null,function*(){var n,s;const o=[];return r&&console.debug("User insights available for recommendations"),t.forEach(c=>{var a;c.recommendation_score>.7&&o.push({id:`ai_${c.id}`,type:_d(c.recommendation_type),priority:wd(c.recommendation_score,c.confidence_level),title:c.recommendation_reason||"AI-Generated Recommendation",description:bd(c),impact:Sd(c),actionItems:Id(c),timeline:Ed(c),confidence:c.confidence_level||.8,category:((a=c.content_context)==null?void 0:a.category)||"general",relatedMetrics:kd(c)})}),((n=e.auditRisk)==null?void 0:n.riskLevel)==="critical"&&o.push(this.createCriticalAuditRecommendation(e)),(s=e.supplyDepletion)!=null&&s.some(c=>c.reorderUrgency==="critical")&&o.push(this.createCriticalSupplyRecommendation(e)),o})}static generateAIOptimizationTips(e,t,r){return In(this,null,function*(){const n=[];return t&&(t.skill_gaps||[]).forEach((o,c)=>{n.push({id:`ai_skill_gap_${c}`,category:"compliance",title:`Address Skill Gap: ${o}`,description:`AI analysis indicates a skill gap in ${o} that may impact performance.`,currentState:`Current skill level: ${t.learning_efficiency_score||70}%`,recommendedAction:"Complete targeted training modules and practice exercises",expectedOutcome:`Improve ${o} proficiency by 25%`,difficulty:"medium",estimatedEffort:"2-3 weeks",priority:8})}),r!=null&&r.efficiency_score&&r.efficiency_score<80&&n.push({id:"ai_efficiency_optimization",category:"sterilization",title:"Optimize Workflow Efficiency",description:"AI analysis shows workflow efficiency below optimal levels.",currentState:`Current efficiency: ${(r==null?void 0:r.efficiency_score)||70}%`,recommendedAction:"Review and optimize high-frequency workflows",expectedOutcome:"Increase efficiency by 15-20%",difficulty:"medium",estimatedEffort:"3-4 weeks",priority:7}),n})}static generateIntelligentRiskAlerts(e,t,r){return In(this,null,function*(){var n;const s=[];return r&&console.debug("Risk patterns available for analysis"),t.forEach(o=>{o.risk_score>.8&&s.push({id:`ai_risk_${o.id}`,severity:Cd(o.risk_score),title:o.risk_title||"AI-Detected Risk",description:o.risk_description||"AI analysis has identified a potential risk.",riskFactors:o.risk_factors||[],immediateActions:o.immediate_actions||[],longTermSolutions:o.long_term_solutions||[],escalationPath:o.escalation_path||"Notify supervisor",deadline:o.deadline||"48 hours",status:"open"})}),((n=e.auditRisk)==null?void 0:n.riskLevel)==="critical"&&s.push(this.createCriticalAuditAlert(e)),s})}static generateFallbackRecommendations(e){var t;const r=[];return((t=e.auditRisk)==null?void 0:t.riskLevel)==="critical"&&r.push({id:"fallback_audit_risk",type:"compliance",priority:"critical",title:"Critical Audit Risk Mitigation Required",description:`Overall audit risk score: ${e.auditRisk.overallRiskScore}/100.`,impact:{riskReduction:60,costSavings:5e3},actionItems:["Complete missing BI logs immediately","Review incomplete cycles"],timeline:"1 week",confidence:.88,category:"compliance",relatedMetrics:["audit_scores","compliance_rates"]}),r}static generateFallbackOptimizationTips(e){var t;const r=[];return((t=e.sterilization)==null?void 0:t.biPassRate)<95&&r.push({id:"fallback_sterilization_optimization",category:"sterilization",title:"Improve BI Test Pass Rates",description:"BI test pass rates below optimal levels indicate potential issues.",currentState:`Current BI pass rate: ${e.sterilization.biPassRate}%`,recommendedAction:"Review sterilization parameters and implement quality checks",expectedOutcome:"Increase BI pass rate to 95%+",difficulty:"medium",estimatedEffort:"2-3 weeks",priority:8}),r}static generateFallbackRiskAlerts(e){var t;const r=[];return((t=e.auditRisk)==null?void 0:t.riskLevel)==="critical"&&r.push({id:"fallback_high_audit_risk",severity:"critical",title:"High Audit Risk Alert",description:`Audit risk score: ${e.auditRisk.overallRiskScore}/100.`,riskFactors:["Skipped BI indicators","Incomplete cycles"],immediateActions:["Complete missing documentation","Review procedures"],longTermSolutions:["Implement monitoring","Enhance training"],escalationPath:"Notify quality assurance team",deadline:"48 hours",status:"open"}),r}static createCriticalAuditRecommendation(e){var t,r,n;return{id:"critical_audit_risk_mitigation",type:"compliance",priority:"critical",title:"Critical Audit Risk Mitigation Required",description:`Overall audit risk score: ${(t=e.auditRisk)==null?void 0:t.overallRiskScore}/100. ${(r=e.auditRisk)==null?void 0:r.skippedIndicators} skipped indicators and ${(n=e.auditRisk)==null?void 0:n.incompleteCycles} incomplete cycles detected.`,impact:{riskReduction:60,costSavings:5e3},actionItems:["Complete missing BI logs immediately","Review incomplete cycle procedures","Reinforce protocol training","Implement daily compliance checks"],timeline:"1 week",confidence:.88,category:"compliance",relatedMetrics:["audit_scores","compliance_rates","protocol_adherence"]}}static createCriticalSupplyRecommendation(e){var t;const r=((t=e.supplyDepletion)==null?void 0:t.filter(n=>n.reorderUrgency==="critical"))||[];return{id:"critical_supply_alert",type:"risk_mitigation",priority:"critical",title:`Critical Supply Alert: ${r.length} Items`,description:`${r.length} critical supplies will deplete within 7 days, risking operational disruption.`,impact:{costSavings:r.reduce((n,s)=>n+Number(s.currentCost||0)*.2,0),riskReduction:95},actionItems:["Place emergency orders immediately","Contact alternative suppliers","Implement usage restrictions","Notify clinical staff"],timeline:"Immediate",confidence:.95,category:"inventory_management",relatedMetrics:["stock_levels","usage_rates","supplier_performance"]}}static createCriticalAuditAlert(e){var t;return{id:"critical_audit_risk_alert",severity:"critical",title:"Critical Audit Risk Alert",description:`Audit risk score: ${(t=e.auditRisk)==null?void 0:t.overallRiskScore}/100. Multiple compliance issues detected requiring immediate attention.`,riskFactors:["Skipped BI indicators","Incomplete sterilization cycles","Policy drift detected"],immediateActions:["Complete missing documentation immediately","Review and complete incomplete cycles","Reinforce protocol adherence","Schedule compliance review meeting"],longTermSolutions:["Implement automated compliance monitoring","Enhance staff training programs","Establish quality assurance processes","Create compliance dashboard"],escalationPath:"Notify quality assurance team and department director",deadline:"24 hours",status:"open"}}}ut.aiLearningService=new Ua;var Na=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function Ad(){return Na(this,null,function*(){try{return[]}catch(i){return console.error("Error getting AI risk predictions:",i),[]}})}function Td(){return Na(this,null,function*(){try{return null}catch(i){return console.error("Error getting historical risk patterns:",i),null}})}function ds(){return{efficiency_score:85,time_saved:120,points:150,difficulty:"medium",category:"general"}}var Dr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function Pd(){return Dr(this,null,function*(){try{const{data:i,error:e}=yield y.from("ai_content_recommendations").select("*").eq("is_displayed",!0).order("recommendation_score",{ascending:!1}).limit(20);return e?(console.error("Error fetching AI recommendations:",e),[]):i||[]}catch(i){return console.error("Error getting AI recommendations:",i),[]}})}function Od(){return Dr(this,null,function*(){try{const{data:{user:i}}=yield y.auth.getUser();if(!i)return null;const{data:e,error:t}=yield y.from("ai_learning_insights").select("*").eq("user_id",i.id).single();return t&&t.code!=="PGRST116"?(console.error("Error fetching user insights:",t),null):e}catch(i){return console.error("Error getting user behavior insights:",i),null}})}function xd(){return Dr(this,null,function*(){try{const{data:{user:i}}=yield y.auth.getUser();if(!i)return null;const{data:e,error:t}=yield y.from("ai_task_performance").select("*").eq("user_id",i.id).order("completed_at",{ascending:!1}).limit(10);return t&&t.code!=="PGRST116"?(console.error("Error fetching performance patterns:",t),ds()):(e==null?void 0:e[0])||ds()}catch(i){return console.error("Error getting user performance patterns:",i),null}})}function Dd(){return Dr(this,null,function*(){try{const{data:{user:i}}=yield y.auth.getUser();if(!i)return .5;const{data:e,error:t}=yield y.from("ai_learning_insights").select("ai_confidence_score").eq("user_id",i.id).single();return t&&t.code!=="PGRST116"?(console.error("Error fetching AI confidence score:",t),.5):Number(e==null?void 0:e.ai_confidence_score)||.5}catch(i){return console.error("Error getting AI confidence score:",i),.5}})}function $d(){return Dr(this,null,function*(){try{const{data:{user:i}}=yield y.auth.getUser();if(!i)return null;const{data:e,error:t}=yield y.from("knowledge_hub_user_progress").select("*").eq("user_id",i.id);return t&&t.code!=="PGRST116"?(console.error("Error fetching learning progress:",t),null):{totalCompleted:((e==null?void 0:e.filter(r=>r.status==="completed"))||[]).length,totalInProgress:((e==null?void 0:e.filter(r=>r.status==="in_progress"))||[]).length,averageScore:(e||[]).reduce((r,n)=>r+(Number(n.score)||0),0)/((e==null?void 0:e.length)||1)||0}}catch(i){return console.error("Error getting learning progress metrics:",i),null}})}var Vr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Rd{static generateRecommendations(e){return Vr(this,null,function*(){try{const t=yield Pd(),r=yield Od(),n=yield ut.generateHybridRecommendations(e,t,r);return md(n)}catch(t){return console.error("Error generating AI recommendations:",t),ut.generateFallbackRecommendations(e)}})}static generateOptimizationTips(e){return Vr(this,null,function*(){try{const t=yield this.aiLearningService.getLearningInsights(),r=yield xd(),n=yield ut.generateAIOptimizationTips(e,t,r);return yd(n)}catch(t){return console.error("Error generating AI optimization tips:",t),ut.generateFallbackOptimizationTips(e)}})}static generateRiskAlerts(e){return Vr(this,null,function*(){try{const t=yield Ad(),r=yield Td(),n=yield ut.generateIntelligentRiskAlerts(e,t,r);return vd(n)}catch(t){return console.error("Error generating AI risk alerts:",t),ut.generateFallbackRiskAlerts(e)}})}static getActionableInsights(e){return Vr(this,null,function*(){const t=yield this.generateRecommendations(e),r=yield this.generateOptimizationTips(e),n=yield this.generateRiskAlerts(e),s=yield Dd();return{totalRecommendations:t.length,criticalItems:t.filter(o=>o.priority==="critical").length,highPriorityItems:t.filter(o=>o.priority==="high").length,totalTips:r.length,totalAlerts:n.length,criticalAlerts:n.filter(o=>o.severity==="critical").length,estimatedSavings:t.reduce((o,c)=>o+(c.impact.costSavings||0),0),estimatedTimeSavings:t.reduce((o,c)=>o+(c.impact.timeSavings||0),0),aiConfidence:s,learningProgress:yield $d()}})}}Rd.aiLearningService=new Ua;var Ld=Object.defineProperty,Md=Object.defineProperties,jd=Object.getOwnPropertyDescriptors,hs=Object.getOwnPropertySymbols,Ud=Object.prototype.hasOwnProperty,Nd=Object.prototype.propertyIsEnumerable,fs=(i,e,t)=>e in i?Ld(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ps=(i,e)=>{for(var t in e||(e={}))Ud.call(e,t)&&fs(i,t,e[t]);if(hs)for(var t of hs(e))Nd.call(e,t)&&fs(i,t,e[t]);return i},gs=(i,e)=>Md(i,jd(e)),H=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class V{getKnowledgeArticles(){return H(this,null,function*(){const{data:e,error:t}=yield y.from("knowledge_articles").select("*").eq("status","published").order("published_at",{ascending:!1});if(t)throw console.error("Error fetching knowledge articles:",t),new Error(`Failed to fetch knowledge articles: ${t.message}`);return(e||[]).map(n=>({id:n.id,title:n.title,content:n.content,category:n.category_id,status:n.status,created_at:n.created_at,updated_at:n.updated_at,published_at:n.published_at,summary:n.summary,tags:n.tags}))})}updateArticleStatus(e,t){return H(this,null,function*(){const{error:r}=yield y.from("knowledge_articles").update({status:t,updated_at:new Date().toISOString()}).eq("id",e);return{error:r==null?void 0:r.message}})}bulkUpdateArticlesStatus(e,t){return H(this,null,function*(){if(!e||e.length===0)return{success:!1,updatedCount:0,processedCount:0,errors:["No articles provided"]};const{error:r,count:n}=yield y.from("knowledge_articles").update({status:t,updated_at:new Date().toISOString()}).in("id",e).select("id");return r?{success:!1,updatedCount:0,processedCount:e.length,errors:[r.message]}:{success:!0,updatedCount:n||0,processedCount:e.length,errors:[]}})}deleteArticles(e){return H(this,null,function*(){if(!e||e.length===0)return{success:!1,deletedCount:0,processedCount:0,errors:["No articles provided"]};const{error:t,count:r}=yield y.from("knowledge_articles").update({status:"archived",updated_at:new Date().toISOString()}).in("id",e).select("id");return t?{success:!1,deletedCount:0,processedCount:e.length,errors:[t.message]}:{success:!0,deletedCount:r||0,processedCount:e.length,errors:[]}})}getLearningPathways(){return H(this,null,function*(){const{data:e,error:t}=yield y.from("knowledge_learning_paths").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching learning pathways:",t),new Error(`Failed to fetch learning pathways: ${t.message}`);return(e||[]).map(n=>({id:n.id,title:n.title,description:n.description,steps:[],status:n.is_active?"active":"inactive",created_at:n.created_at,updated_at:n.updated_at,difficulty_level:n.difficulty,estimated_time:parseInt(n.estimated_time)||0}))})}updateLearningPathStatus(e,t){return H(this,null,function*(){const{error:r}=yield y.from("knowledge_learning_paths").update({is_active:t,updated_at:new Date().toISOString()}).eq("id",e);return{error:r==null?void 0:r.message}})}bulkUpdateLearningPathsStatus(e,t){return H(this,null,function*(){if(!e||e.length===0)return{success:!1,updatedCount:0,processedCount:0,errors:["No pathways provided"]};const{error:r,count:n}=yield y.from("knowledge_learning_paths").update({is_active:t,updated_at:new Date().toISOString()}).in("id",e).select("id");return r?{success:!1,updatedCount:0,processedCount:e.length,errors:[r.message]}:{success:!0,updatedCount:n||0,processedCount:e.length,errors:[]}})}deleteLearningPaths(e){return H(this,null,function*(){if(!e||e.length===0)return{success:!1,deletedCount:0,processedCount:0,errors:["No pathways provided"]};const{error:t,count:r}=yield y.from("knowledge_learning_paths").update({is_active:!1,updated_at:new Date().toISOString()}).in("id",e).select("id");return t?{success:!1,deletedCount:0,processedCount:e.length,errors:[t.message]}:{success:!0,deletedCount:r||0,processedCount:e.length,errors:[]}})}getArticleById(e){return H(this,null,function*(){const{data:t,error:r}=yield y.from("knowledge_articles").select("*").eq("id",e).single();if(r)return{error:r.message};if(!t)return{error:"Article not found"};const n=t;return{data:{id:n.id,title:n.title,content:n.content,category:n.category_id,status:n.status,created_at:n.created_at,updated_at:n.updated_at,published_at:n.published_at,summary:n.summary,tags:n.tags}}})}getLearningPathById(e){return H(this,null,function*(){const{data:t,error:r}=yield y.from("knowledge_learning_paths").select("*").eq("id",e).single();if(r)return{error:r.message};if(!t)return{error:"Learning path not found"};const n=t;return{data:{id:n.id,title:n.title,description:n.description,steps:[],status:n.is_active?"active":"inactive",created_at:n.created_at,updated_at:n.updated_at,difficulty_level:n.difficulty,estimated_time:parseInt(n.estimated_time)||0}}})}getKnowledgeCategories(){return H(this,null,function*(){const{data:e,error:t}=yield y.from("knowledge_categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw console.error("Error fetching knowledge categories:",t),new Error(`Failed to fetch knowledge categories: ${t.message}`);return e||[]})}createArticle(e){return H(this,null,function*(){try{const{data:t,error:r}=yield y.from("knowledge_articles").insert([{title:e.title,content:e.content,summary:e.summary,category_id:e.category,tags:e.tags,status:e.status,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return r?{error:r.message}:{article:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to create article"}}})}updateArticle(e,t){return H(this,null,function*(){try{const{data:r,error:n}=yield y.from("knowledge_articles").update(gs(ps({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();return n?{error:n.message}:{article:r}}catch(r){return{error:r instanceof Error?r.message:"Failed to update article"}}})}deleteArticle(e){return H(this,null,function*(){try{const{error:t}=yield y.from("knowledge_articles").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete article"}}})}createLearningPath(e){return H(this,null,function*(){try{const{data:t,error:r}=yield y.from("knowledge_learning_paths").insert([{title:e.title,description:e.description,category:e.category,difficulty:e.difficulty,estimated_time:e.estimated_time,is_active:e.is_active,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return r?{error:r.message}:{pathway:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to create learning path"}}})}updateLearningPath(e,t){return H(this,null,function*(){try{const{data:r,error:n}=yield y.from("knowledge_learning_paths").update(gs(ps({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();return n?{error:n.message}:{pathway:r}}catch(r){return{error:r instanceof Error?r.message:"Failed to update learning path"}}})}deleteLearningPath(e){return H(this,null,function*(){try{const{error:t}=yield y.from("knowledge_learning_paths").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete learning path"}}})}addCategory(e){return H(this,null,function*(){try{const{data:t,error:r}=yield y.from("knowledge_categories").insert([{name:e,is_active:!0,sort_order:999,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return r?{error:r.message}:{category:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to add category"}}})}deleteCategory(e){return H(this,null,function*(){try{const{error:t}=yield y.from("knowledge_categories").update({is_active:!1,updated_at:new Date().toISOString()}).eq("name",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete category"}}})}getRecentUserActivity(e,t){return H(this,null,function*(){try{let r=y.from("activity_feed").select("*").order("created_at",{ascending:!1});e&&(r=r.eq("user_id",e)),t?r=r.limit(t):r=r.limit(50);const{data:n,error:s}=yield r;return s?(console.error("Error fetching recent user activity:",s),[]):n||[]}catch(r){return console.error("Failed to get recent user activity:",r),[]}})}}const Gr=i=>["Courses","Procedures","Policies","Learning Pathways","Advanced"].includes(i)?i:"Courses";var Dt=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class dt{static getKnowledgeArticles(){return Dt(this,null,function*(){try{return(yield new V().getKnowledgeArticles()).map(r=>({id:r.id,title:r.title,category:Gr(r.category||"Courses"),status:"draft",dueDate:r.published_at||new Date().toISOString(),progress:0,lastUpdated:r.updated_at||new Date().toISOString(),description:r.summary||"",tags:r.tags||[],createdAt:r.created_at||new Date().toISOString()}))}catch(e){throw console.error("Failed to get knowledge articles:",e),e}})}static getKnowledgeArticleById(e){return Dt(this,null,function*(){try{const r=yield new V().getArticleById(e);if(r.error||!r.data)return null;const n=r.data;return{id:n.id,title:n.title,category:Gr(n.category||"Courses"),status:"draft",dueDate:n.published_at||new Date().toISOString(),progress:0,lastUpdated:n.updated_at||new Date().toISOString(),description:n.summary||"",tags:n.tags||[],createdAt:n.created_at||new Date().toISOString()}}catch(t){throw console.error("Failed to get knowledge article by ID:",t),t}})}static createKnowledgeArticle(e){return Dt(this,null,function*(){try{const r=yield new V().createArticle({title:e.title,content:e.description||"",summary:e.description||"",category:e.category,tags:e.tags||[],status:"draft"});if(r.error)throw new Error(r.error);if(!r.article)throw new Error("Failed to create article");return{id:r.article.id,title:r.article.title,category:Gr(r.article.category||"Courses"),status:r.article.status,dueDate:r.article.published_at||new Date().toISOString(),progress:0,lastUpdated:r.article.updated_at,description:r.article.summary,tags:r.article.tags,createdAt:r.article.created_at}}catch(t){throw console.error("Failed to create knowledge article:",t),t}})}static updateKnowledgeArticle(e,t){return Dt(this,null,function*(){try{const r=new V,n={};t.title&&(n.title=t.title),t.description&&(n.summary=t.description),t.category&&(n.category_id=t.category),t.tags&&(n.tags=t.tags),t.status&&(n.status=t.status==="review"?"published":"draft");const s=yield r.updateArticle(e,n);if(s.error)throw new Error(s.error);if(!s.article)throw new Error("No article returned from update");return{id:s.article.id,title:s.article.title,category:Gr(s.article.category),status:s.article.status,dueDate:s.article.published_at||new Date().toISOString(),progress:0,description:s.article.summary,tags:s.article.tags,createdAt:s.article.created_at,lastUpdated:s.article.updated_at}}catch(r){throw console.error("Failed to update knowledge article:",r),r}})}static deleteKnowledgeArticle(e){return Dt(this,null,function*(){try{const r=yield new V().deleteArticle(e);if(r.error)throw new Error(r.error)}catch(t){throw console.error("Failed to delete knowledge article:",t),t}})}static updateContentStatus(e,t){return Dt(this,null,function*(){try{const r=new V;let n;switch(t){case"review":n="review";break;case"published":n="published";break;default:n="draft"}const s=yield r.updateArticleStatus(e,n);if(s.error)throw new Error(s.error)}catch(r){throw console.error("Failed to update content status:",r),r}})}}var Kr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Wr{static bulkUpdateContentStatus(e,t){return Kr(this,null,function*(){var r;try{const n=new V;let s;switch(t){case"review":s="review";break;case"published":s="published";break;default:s="draft"}const o=yield n.bulkUpdateArticlesStatus(e,s);return{success:o.success,processedCount:o.processedCount,successCount:o.updatedCount||0,errorCount:((r=o.errors)==null?void 0:r.length)||0,errors:o.errors||[]}}catch(n){throw console.error("Failed to bulk update content status:",n),n}})}static bulkDeleteContent(e){return Kr(this,null,function*(){var t;try{const n=yield new V().deleteArticles(e);return{success:n.success,processedCount:n.processedCount,successCount:n.deletedCount||0,errorCount:((t=n.errors)==null?void 0:t.length)||0,errors:n.errors||[]}}catch(r){throw console.error("Failed to bulk delete content:",r),r}})}static bulkUpdateLearningPathStatus(e,t){return Kr(this,null,function*(){var r;try{const s=yield new V().bulkUpdateLearningPathsStatus(e,t);return{success:s.success,processedCount:s.processedCount,successCount:s.updatedCount||0,errorCount:((r=s.errors)==null?void 0:r.length)||0,errors:s.errors||[]}}catch(n){throw console.error("Failed to bulk update learning path status:",n),n}})}static bulkDeleteLearningPathways(e){return Kr(this,null,function*(){var t;try{const n=yield new V().deleteLearningPaths(e);return{success:n.success,processedCount:n.processedCount,successCount:n.deletedCount||0,errorCount:((t=n.errors)==null?void 0:t.length)||0,errors:n.errors||[]}}catch(r){throw console.error("Failed to bulk delete learning pathways:",r),r}})}}var $t=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ht{static getLearningPathways(){return $t(this,null,function*(){try{return(yield new V().getLearningPathways()).map(r=>({id:r.id,title:r.title,category:"Learning Pathways",status:"draft",dueDate:r.created_at||new Date().toISOString(),progress:0,lastUpdated:r.updated_at,description:r.description,createdAt:r.created_at}))}catch(e){throw console.error("Failed to get learning pathways:",e),e}})}static getLearningPathwayById(e){return $t(this,null,function*(){try{const r=yield new V().getLearningPathById(e);if(r.error||!r.data)return null;const n=r.data;return{id:n.id,title:n.title,category:"Learning Pathways",status:"draft",dueDate:n.created_at||new Date().toISOString(),progress:0,lastUpdated:n.updated_at,description:n.description,createdAt:n.created_at}}catch(t){throw console.error("Failed to get learning pathway by ID:",t),t}})}static createLearningPathway(e){return $t(this,null,function*(){try{const t=new V,r={title:e.title,description:e.description||"",category:e.category,difficulty:"beginner",estimated_time:"30 minutes",is_active:!0},n=yield t.createLearningPath(r);if(n.error)throw new Error(n.error);if(!n.pathway)throw new Error("No pathway returned from creation");return{id:n.pathway.id,title:n.pathway.title,category:n.pathway.category,status:"draft",dueDate:new Date().toISOString(),progress:0,description:n.pathway.description,createdAt:n.pathway.created_at,lastUpdated:n.pathway.updated_at}}catch(t){throw console.error("Failed to create learning pathway:",t),t}})}static updateLearningPathway(e,t){return $t(this,null,function*(){try{const r=new V,n={};t.title&&(n.title=t.title),t.description&&(n.description=t.description),t.category&&(n.category=t.category);const s=yield r.updateLearningPath(e,n);if(s.error)throw new Error(s.error);if(!s.pathway)throw new Error("No pathway returned from update");return{id:s.pathway.id,title:s.pathway.title,category:s.pathway.category,status:"draft",dueDate:new Date().toISOString(),progress:0,description:s.pathway.description,createdAt:s.pathway.created_at,lastUpdated:s.pathway.updated_at}}catch(r){throw console.error("Failed to update learning pathway:",r),r}})}static deleteLearningPathway(e){return $t(this,null,function*(){try{const r=yield new V().deleteLearningPath(e);if(r.error)throw new Error(r.error)}catch(t){throw console.error("Failed to delete learning pathway:",t),t}})}static updateLearningPathStatus(e,t){return $t(this,null,function*(){try{const n=yield new V().updateLearningPathStatus(e,t);if(n.error)throw new Error(n.error)}catch(r){throw console.error("Failed to update learning path status:",r),r}})}}var En=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class kn{static getKnowledgeCategories(){return En(this,null,function*(){try{return(yield new V().getKnowledgeCategories()).map(r=>r.name)}catch(e){throw console.error("Failed to get knowledge categories:",e),e}})}static addCategory(e){return En(this,null,function*(){try{const r=yield new V().addCategory(e);if(r.error)throw new Error(r.error);if(!r.category)throw new Error("No category returned from creation");return r.category.name}catch(t){throw console.error("Failed to add category:",t),t}})}static deleteCategory(e){return En(this,null,function*(){try{const r=yield new V().deleteCategory(e);if(r.error)throw new Error(r.error)}catch(t){throw console.error("Failed to delete category:",t),t}})}}var Be=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Ve{static getQuizzes(){return Be(this,null,function*(){try{const{QuizService:e}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return(yield e.getAllQuizzes()).map(r=>({id:r.id,title:r.title,category:"Courses",status:r.is_active?"published":"draft",dueDate:r.created_at,progress:0,lastUpdated:r.updated_at,description:r.description||"Interactive quiz to test knowledge",tags:["quiz","assessment","knowledge-test"],createdAt:r.created_at,type:"quiz",contentType:"quiz",domain:"knowledge-assessment",isActive:r.is_active,estimatedDuration:r.time_limit_minutes||15,difficultyLevel:"medium",mandatoryRepeat:!1,passingScore:r.passing_score}))}catch(e){return console.error("Failed to get quizzes:",e),[]}})}static getQuizById(e){return Be(this,null,function*(){try{const{QuizService:t}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.getQuizWithQuestions(e)}catch(t){return console.error("Failed to get quiz by ID:",t),null}})}static startQuizAttempt(e){return Be(this,null,function*(){try{const{QuizService:t}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.startQuizAttempt(e)}catch(t){return console.error("Failed to start quiz attempt:",t),null}})}static submitQuizAnswers(e,t){return Be(this,null,function*(){try{const{QuizService:r}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return yield r.submitQuizAttempt(e,t)}catch(r){return console.error("Failed to submit quiz answers:",r),{success:!1,score:0,passed:!1}}})}static getUserQuizAttempts(){return Be(this,null,function*(){try{const{QuizService:e}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return yield e.getUserQuizAttempts()}catch(e){return console.error("Failed to get user quiz attempts:",e),[]}})}static createQuiz(e){return Be(this,null,function*(){try{const{QuizService:t}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.createQuiz(e)}catch(t){return console.error("Failed to create quiz:",t),null}})}static updateQuiz(e,t){return Be(this,null,function*(){try{const{QuizService:r}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return yield r.updateQuiz(e,t)}catch(r){return console.error("Failed to update quiz:",r),null}})}static deleteQuiz(e){return Be(this,null,function*(){try{const{QuizService:t}=yield z(()=>import("./quizService-st9-VETt.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.deleteQuiz(e)}catch(t){return console.error("Failed to delete quiz:",t),!1}})}}var ms=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ys{static getRecentUserActivity(e,t){return ms(this,null,function*(){try{return yield new V().getRecentUserActivity(e,t)}catch(r){throw console.error("Failed to get recent user activity:",r),r}})}static getAllContent(){return ms(this,null,function*(){try{const[e,t]=yield Promise.all([dt.getKnowledgeArticles(),ht.getLearningPathways()]);return[...e,...t]}catch(e){throw console.error("Failed to get all content:",e),e}})}}var $=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class vs{static getKnowledgeArticles(){return $(this,null,function*(){return dt.getKnowledgeArticles()})}static getKnowledgeArticleById(e){return $(this,null,function*(){return dt.getKnowledgeArticleById(e)})}static createKnowledgeArticle(e){return $(this,null,function*(){return dt.createKnowledgeArticle(e)})}static updateKnowledgeArticle(e,t){return $(this,null,function*(){return dt.updateKnowledgeArticle(e,t)})}static deleteKnowledgeArticle(e){return $(this,null,function*(){return dt.deleteKnowledgeArticle(e)})}static updateContentStatus(e,t){return $(this,null,function*(){return dt.updateContentStatus(e,t)})}static bulkUpdateContentStatus(e,t){return $(this,null,function*(){return Wr.bulkUpdateContentStatus(e,t)})}static bulkDeleteContent(e){return $(this,null,function*(){return Wr.bulkDeleteContent(e)})}static getLearningPathways(){return $(this,null,function*(){return ht.getLearningPathways()})}static getLearningPathwayById(e){return $(this,null,function*(){return ht.getLearningPathwayById(e)})}static createLearningPathway(e){return $(this,null,function*(){return ht.createLearningPathway(e)})}static updateLearningPathway(e,t){return $(this,null,function*(){return ht.updateLearningPathway(e,t)})}static deleteLearningPathway(e){return $(this,null,function*(){return ht.deleteLearningPathway(e)})}static updateLearningPathStatus(e,t){return $(this,null,function*(){return ht.updateLearningPathStatus(e,t)})}static bulkUpdateLearningPathStatus(e,t){return $(this,null,function*(){return Wr.bulkUpdateLearningPathStatus(e,t)})}static bulkDeleteLearningPathways(e){return $(this,null,function*(){return Wr.bulkDeleteLearningPathways(e)})}static getKnowledgeCategories(){return $(this,null,function*(){return kn.getKnowledgeCategories()})}static addCategory(e){return $(this,null,function*(){return kn.addCategory(e)})}static deleteCategory(e){return $(this,null,function*(){return kn.deleteCategory(e)})}static getAllContent(){return $(this,null,function*(){return ys.getAllContent()})}static getRecentUserActivity(e,t){return $(this,null,function*(){return ys.getRecentUserActivity(e,t)})}static getQuizzes(){return $(this,null,function*(){return Ve.getQuizzes()})}static getQuizById(e){return $(this,null,function*(){return Ve.getQuizById(e)})}static startQuizAttempt(e){return $(this,null,function*(){return Ve.startQuizAttempt(e)})}static submitQuizAnswers(e,t){return $(this,null,function*(){return Ve.submitQuizAnswers(e,t)})}static getUserQuizAttempts(){return $(this,null,function*(){return Ve.getUserQuizAttempts()})}static createQuiz(e){return $(this,null,function*(){return Ve.createQuiz(e)})}static updateQuiz(e,t){return $(this,null,function*(){return Ve.updateQuiz(e,t)})}static deleteQuiz(e){return $(this,null,function*(){return Ve.deleteQuiz(e)})}}var me=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class yg{static getKnowledgeHubContent(e,t,r=10){return me(this,null,function*(){try{return(yield vs.getKnowledgeArticles()).filter(c=>e.includes(c.category.toLowerCase())&&t.some(a=>c.title.toLowerCase().includes(a.toLowerCase())||c.category.toLowerCase().includes(a.toLowerCase()))).map(c=>({contentId:c.id,title:c.title,category:c.category.toLowerCase(),relevance:this.calculateRelevance(c,t),lastUpdated:c.lastUpdated||new Date().toISOString(),url:`/knowledge-hub/${c.category.toLowerCase()}/${c.id}`})).sort((c,a)=>a.relevance-c.relevance).slice(0,r)}catch(n){return console.error("Error fetching Knowledge Hub content:",n),[]}})}static getAuditTrail(e,t,r,n=50){return me(this,null,function*(){try{const{data:{user:s}}=yield y.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:o}=yield y.from("users").select("facility_id").eq("id",s.id).single(),c=(o==null?void 0:o.facility_id)||"550e8400-e29b-41d4-a716-446655440000";let a=y.from("audit_logs").select("*").eq("facility_id",c).order("timestamp",{ascending:!1}).limit(n);e&&(a=a.eq("user_id",e)),t&&(a=a.ilike("action",`%${t}%`)),r&&(a=a.gte("timestamp",r.startDate).lte("timestamp",r.endDate));const{data:l,error:u}=yield a;return u?(console.error("Error fetching audit trail:",u),[]):!l||l.length===0?[]:l.map(f=>{var h,m;return{actionId:String(f.id),timestamp:f.timestamp,userId:f.user_id,userName:(h=f.user_name)!=null?h:"Unknown User",action:f.action,details:f.metadata?JSON.stringify(f.metadata):"",impact:this.determineImpact(f.action),status:(m=f.status)!=null?m:"completed"}})}catch(s){return console.error("Error fetching audit trail:",s),[]}})}static pushKnowledgeHubNotification(e,t,r){return me(this,null,function*(){try{const{data:n}=yield y.from("users").select("facility_id").eq("id",e).single(),s=(n==null?void 0:n.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{error:o}=yield y.from("audit_logs").insert({user_id:e,facility_id:s,action:"Knowledge Hub Notification",details:`Notification for content ${t}: ${r}`,timestamp:new Date().toISOString(),module:"knowledge_hub"});return o?(console.error("Error logging notification:",o),!1):!0}catch(n){return console.error("Error pushing Knowledge Hub notification:",n),!1}})}static scheduleSupplierContact(e,t,r){return me(this,null,function*(){try{const{data:{user:n}}=yield y.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:s}=yield y.from("users").select("facility_id").eq("id",n.id).single(),o=(s==null?void 0:s.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{error:c}=yield y.from("audit_logs").insert({user_id:n.id,facility_id:o,action:"Supplier Contact Scheduled",details:`${t} contact with supplier ${e}, priority: ${r}`,timestamp:new Date().toISOString(),module:"supplier_management"});return c?(console.error("Error logging supplier contact:",c),!1):!0}catch(n){return console.error("Error scheduling supplier contact:",n),!1}})}static getIntegrationMetrics(){return me(this,null,function*(){try{const[e,t,r]=yield Promise.all([this.getKnowledgeHubCount(),this.getActiveSupplierCount(),this.getRecentAuditCount()]);return{knowledgeHubArticles:e,activeSuppliers:t,recentAuditActions:r,integrationHealth:this.calculateIntegrationHealth(e,t,r),lastSync:new Date().toISOString()}}catch(e){return console.error("Error fetching integration metrics:",e),{knowledgeHubArticles:0,activeSuppliers:0,recentAuditActions:0,integrationHealth:0,lastSync:new Date().toISOString()}}})}static syncAllIntegrations(){return me(this,null,function*(){try{return yield Promise.all([this.syncKnowledgeHub(),this.syncSupplierDatabase(),this.syncAuditTrail()]),!0}catch(e){return console.error("Error during integration sync:",e),!1}})}static calculateRelevance(e,t){let r=50;return t.forEach(n=>{var s,o,c;(s=e.title)!=null&&s.toLowerCase().includes(n.toLowerCase())&&(r+=20),(o=e.category)!=null&&o.toLowerCase().includes(n.toLowerCase())&&(r+=15),e.tags&&((c=e.tags)!=null&&c.some(a=>a.toLowerCase().includes(n.toLowerCase())))&&(r+=10)}),Math.min(r,100)}static calculateCostCompetitiveness(e,t){const n=Math.min(t/1e3,2);return Math.min(7*n,10)}static determineImpact(e){const t=["sterilization","bi test","critical","emergency"],r=["inventory","training","maintenance"],n=e.toLowerCase();return t.some(s=>n.includes(s))?"high":r.some(s=>n.includes(s))?"medium":"low"}static getKnowledgeHubCount(){return me(this,null,function*(){try{return(yield vs.getKnowledgeArticles()).length}catch(e){return console.error(e),0}})}static getActiveSupplierCount(){return me(this,null,function*(){try{const{data:e,error:t}=yield y.from("information_schema.tables").select("table_name").eq("table_name","inventory_suppliers").single();return(t||!e)&&console.log(" inventory_suppliers table not found, using default count"),5}catch(e){return console.log(" Exception fetching supplier count:",e),5}})}static getRecentAuditCount(){return me(this,null,function*(){try{const{data:{user:e}}=yield y.auth.getUser();if(!e)return 0;const{data:t}=yield y.from("users").select("facility_id").eq("id",e.id).single(),r=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",n=new Date;n.setDate(n.getDate()-30);const{count:s,error:o}=yield y.from("audit_logs").select("*",{count:"exact",head:!0}).eq("facility_id",r).gte("created_at",n.toISOString());return o?0:s!=null?s:0}catch(e){return console.error(e),0}})}static calculateIntegrationHealth(e,t,r){const n=Math.min(e/10,1)*30,s=Math.min(t/20,1)*30,o=Math.min(r/50,1)*40;return Math.round(n+s+o)}static syncKnowledgeHub(){return me(this,null,function*(){yield new Promise(e=>setTimeout(e,500))})}static syncSupplierDatabase(){return me(this,null,function*(){yield new Promise(e=>setTimeout(e,500))})}static syncAuditTrail(){return me(this,null,function*(){yield new Promise(e=>setTimeout(e,500))})}static getFallbackSuppliers(e,t){return[{supplierId:"fallback-1",name:"Medical Supply Co.",category:e,rating:4.5,deliveryTime:3,costCompetitiveness:8,reliability:9,contactInfo:{email:"contact@medsupply.com",phone:"+1-555-0123",website:"https://medsupply.com"}},{supplierId:"fallback-2",name:"Clinical Equipment Ltd.",category:e,rating:4.2,deliveryTime:5,costCompetitiveness:7.5,reliability:8.5,contactInfo:{email:"sales@clinicalequip.com",phone:"+1-555-0456",website:"https://clinicalequip.com"}}].slice(0,t)}}var Fd=Object.defineProperty,_s=Object.getOwnPropertySymbols,zd=Object.prototype.hasOwnProperty,qd=Object.prototype.propertyIsEnumerable,ws=(i,e,t)=>e in i?Fd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Qr=(i,e)=>{for(var t in e||(e={}))zd.call(e,t)&&ws(i,t,e[t]);if(_s)for(var t of _s(e))qd.call(e,t)&&ws(i,t,e[t]);return i},ot=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ke{static initialize(){return ot(this,null,function*(){if(!this.isInitialized)try{const e=_r.getConfig();yield rs.initialize(e),this.isInitialized=!0,console.log("Analytics Service initialized successfully.")}catch(e){console.error("Failed to initialize Analytics Service:",e)}})}static trackEvent(e,t,r,n){return ot(this,null,function*(){this.isInitialized||(yield this.initialize());try{yield Xu.trackEvent(e,t,r,n);const s=_r.getConfig();yield rs.trackEvent(e,t,r,n,s)}catch(s){console.error("Failed to track analytics event:",s)}})}static trackPageView(e,t,r,n){return ot(this,null,function*(){yield this.trackEvent("page_view",Qr({page:e},t),r,n)})}static trackUserAction(e,t,r,n){return ot(this,null,function*(){yield this.trackEvent("user_action",Qr({action:e},t),r,n)})}static trackError(e,t,r,n){return ot(this,null,function*(){yield this.trackEvent("error",Qr({message:e.message,stack:e.stack},t),r,n)})}static trackPerformance(e,t,r,n,s){return ot(this,null,function*(){yield this.trackEvent("performance",Qr({metric:e,value:t},r),n,s)})}static getConfig(){return _r.getConfig()}static updateConfig(e){return ot(this,null,function*(){yield _r.updateConfig(e)})}static reset(){this.isInitialized=!1}}ke.isInitialized=!1;const F=ke.trackEvent.bind(ke);ke.trackPageView.bind(ke);ke.trackUserAction.bind(ke);ke.trackError.bind(ke);ke.trackPerformance.bind(ke);var Hd=Object.defineProperty,Bd=Object.defineProperties,Vd=Object.getOwnPropertyDescriptors,bs=Object.getOwnPropertySymbols,Gd=Object.prototype.hasOwnProperty,Kd=Object.prototype.propertyIsEnumerable,Ss=(i,e,t)=>e in i?Hd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Wd=(i,e)=>{for(var t in e||(e={}))Gd.call(e,t)&&Ss(i,t,e[t]);if(bs)for(var t of bs(e))Kd.call(e,t)&&Ss(i,t,e[t]);return i},Qd=(i,e)=>Bd(i,Vd(e)),ye=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function Yd(i){return Ue.categorizeItems(i)}function Jd(i){return Ue.withNormalizedCategory(i)}class Ue{constructor(e,t){this.adapter=e,this.adapterType=t}static normalizeCategory(e){const t=e.toLowerCase().trim();return t.includes("mask")||t.includes("glove")||t.includes("gown")||t.includes("supply")?"Supplies":t.includes("scalpel")||t.includes("forceps")||t.includes("tool")||t.includes("instrument")?"Tools":t.includes("chair")||t.includes("autoclave")||t.includes("machine")||t.includes("equipment")?"Equipment":t.includes("computer")||t.includes("printer")||t.includes("office")||t.includes("hardware")?"Office Hardware":"Tools"}static categorizeItems(e){const t=[],r=[],n=[],s=[];return e.forEach(o=>{switch(this.normalizeCategory(String(o.category||""))){case"Tools":t.push(o);break;case"Supplies":r.push(o);break;case"Equipment":n.push(o);break;case"Office Hardware":s.push(o);break;default:t.push(o);break}}),{tools:t,supplies:r,equipment:n,officeHardware:s}}static withNormalizedCategory(e){return e.map(t=>Qd(Wd({},t),{category:this.normalizeCategory(t.category)}))}addCategory(e){return ye(this,null,function*(){return{success:yield T.handleOperation("addCategory",()=>ye(this,null,function*(){return yield this.adapter.addCategory(e),Z.invalidateRelated("inventory:categories",e),M("inventory","category_created",`Category created: ${e}`,"info",{category:e,adapterType:this.adapterType}),U("create_category","inventory",{category:e}),F("inventory_category_created",{category:e,adapterType:this.adapterType}),!0})),error:null}})}deleteCategory(e){return ye(this,null,function*(){return{success:yield T.handleOperation("deleteCategory",()=>ye(this,null,function*(){return yield this.adapter.deleteCategory(e),Z.invalidateRelated("inventory:categories",e),M("inventory","category_deleted",`Category deleted: ${e}`,"info",{category:e,adapterType:this.adapterType}),U("delete_category","inventory",{category:e}),F("inventory_category_deleted",{category:e,adapterType:this.adapterType}),!0})),error:null}})}getCategories(){return ye(this,null,function*(){return{data:yield T.handleOperation("getCategories",()=>ye(this,null,function*(){return yield this.adapter.fetchCategories()})),error:null}})}getNormalizedCategories(){return ye(this,null,function*(){return{data:yield T.handleOperation("getNormalizedCategories",()=>ye(this,null,function*(){const r=(yield this.adapter.fetchCategories()).map(n=>Ue.normalizeCategory(n));return Array.from(new Set(r))})),error:null}})}getCategoryStats(){return ye(this,null,function*(){return{data:yield T.handleOperation("getCategoryStats",()=>ye(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=Ue.normalizeCategory(n.category||"");r[s]=(r[s]||0)+1}),r})),error:null}})}static validateCategoryName(e){const t=[];return(!e||e.trim()==="")&&t.push("Category name is required"),e.length>100&&t.push("Category name must be less than 100 characters"),/^[a-zA-Z0-9\s\-_]+$/.test(e)||t.push("Category name contains invalid characters"),{isValid:t.length===0,errors:t}}static getCategorySuggestions(e){const t=e.toLowerCase(),r=[];return(t.includes("mask")||t.includes("glove")||t.includes("gown"))&&r.push("Supplies"),(t.includes("scalpel")||t.includes("forceps")||t.includes("tool"))&&r.push("Tools"),(t.includes("chair")||t.includes("autoclave")||t.includes("machine"))&&r.push("Equipment"),(t.includes("computer")||t.includes("printer")||t.includes("office"))&&r.push("Office Hardware"),r.length===0&&r.push("Tools","Supplies","Equipment","Office Hardware"),r}mergeCategories(e,t){return ye(this,null,function*(){return{success:yield T.handleOperation("mergeCategories",()=>ye(this,null,function*(){const s=(yield this.adapter.fetchInventoryItems()).filter(a=>a.category===e);for(const a of s)yield this.adapter.updateInventoryItem(a.id,{category:t});return(yield this.adapter.fetchInventoryItems()).some(a=>a.category===e)||(yield this.adapter.deleteCategory(e)),M("inventory","category_merged",`Category merged: ${e} -> ${t}`,"info",{sourceCategory:e,targetCategory:t,itemsUpdated:s.length,adapterType:this.adapterType}),U("merge_category","inventory",{sourceCategory:e,targetCategory:t,itemsUpdated:s.length}),F("inventory_category_merged",{sourceCategory:e,targetCategory:t,itemsUpdated:s.length,adapterType:this.adapterType}),!0})),error:null}})}}var Xd=Object.defineProperty,Zd=Object.defineProperties,eh=Object.getOwnPropertyDescriptors,Is=Object.getOwnPropertySymbols,th=Object.prototype.hasOwnProperty,rh=Object.prototype.propertyIsEnumerable,Es=(i,e,t)=>e in i?Xd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,nh=(i,e)=>{for(var t in e||(e={}))th.call(e,t)&&Es(i,t,e[t]);if(Is)for(var t of Is(e))rh.call(e,t)&&Es(i,t,e[t]);return i},ih=(i,e)=>Zd(i,eh(e)),J=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class sh{constructor(e,t){this.adapter=e,this.adapterType=t}fetchInventoryItems(){return J(this,null,function*(){return yield T.handleOperation("fetchInventoryItems",()=>J(this,null,function*(){return yield this.adapter.fetchInventoryItems()}))})}getItemById(e){return J(this,null,function*(){return yield T.handleOperation("getItemById",()=>J(this,null,function*(){return{data:(yield this.adapter.fetchInventoryItems()).find(s=>s.id===e)||null,error:null}}))})}createItem(e){return J(this,null,function*(){return{data:yield T.handleOperation("createItem",()=>J(this,null,function*(){const r=yield this.adapter.addInventoryItem(e);return Z.invalidateRelated("inventory:create",r.id),M("inventory","item_created",`Inventory item created: ${e.name||e.item}`,"info",{itemId:r.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),U("create_item","inventory",{itemId:r.id,itemName:e.name||e.item,category:e.category}),F("inventory_item_created",{itemId:r.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),r})),error:null}})}updateItem(e,t){return J(this,null,function*(){return{data:yield T.handleOperation("updateItem",()=>J(this,null,function*(){const n=yield this.adapter.updateInventoryItem(e,t);return Z.invalidateRelated("inventory:update",e),M("inventory","item_updated",`Inventory item updated: ${e}`,"info",{itemId:e,updates:Object.keys(t),adapterType:this.adapterType}),U("update_item","inventory",{itemId:e,updates:Object.keys(t)}),F("inventory_item_updated",{itemId:e,updates:Object.keys(t),adapterType:this.adapterType}),n})),error:null}})}deleteItem(e){return J(this,null,function*(){return{success:yield T.handleOperation("deleteItem",()=>J(this,null,function*(){return yield this.adapter.deleteInventoryItem(e),Z.invalidateRelated("inventory:delete",e),M("inventory","item_deleted",`Inventory item deleted: ${e}`,"info",{itemId:e,adapterType:this.adapterType}),U("delete_item","inventory",{itemId:e}),F("inventory_item_deleted",{itemId:e,adapterType:this.adapterType}),!0})),error:null}})}addInventoryItem(e){return J(this,null,function*(){return yield T.handleOperation("addInventoryItem",()=>J(this,null,function*(){const r=yield this.adapter.addInventoryItem(e);return Z.invalidateRelated("inventory:create",e.id),M("inventory","item_created",`Inventory item created: ${e.name||e.item}`,"info",{itemId:e.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),U("create_item","inventory",{itemId:e.id,itemName:e.name||e.item,category:e.category}),F("inventory_item_created",{itemId:e.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),r}))})}static validateItemData(e){const t=[];return!e.name&&!e.item&&t.push("Item name is required"),e.category||t.push("Category is required"),e.quantity!==void 0&&e.quantity<0&&t.push("Quantity must be non-negative"),e.minimumStock!==void 0&&e.minimumStock<0&&t.push("Minimum stock must be non-negative"),e.location&&e.location.length>200&&t.push("Location must be less than 200 characters"),e.description&&e.description.length>1e3&&t.push("Description must be less than 1000 characters"),{isValid:t.length===0,errors:t}}duplicateItem(e,t){return J(this,null,function*(){return{data:yield T.handleOperation("duplicateItem",()=>J(this,null,function*(){const n=yield this.getItemById(e);if(!n.data)throw new Error("Original item not found");const s=ih(nh({},n.data),{name:t||`${n.data.name} (Copy)`,id:""}),o=yield this.adapter.addInventoryItem(s);return Z.invalidateRelated("inventory:create",o.id),M("inventory","item_duplicated",`Inventory item duplicated: ${e} -> ${o.id}`,"info",{originalItemId:e,newItemId:o.id,adapterType:this.adapterType}),U("duplicate_item","inventory",{originalItemId:e,newItemId:o.id}),F("inventory_item_duplicated",{originalItemId:e,newItemId:o.id,adapterType:this.adapterType}),o})),error:null}})}archiveItem(e,t){return J(this,null,function*(){return{data:yield T.handleOperation("archiveItem",()=>J(this,null,function*(){const n=yield this.adapter.updateInventoryItem(e,{status:"archived",archiveReason:t});return Z.invalidateRelated("inventory:update",e),M("inventory","item_archived",`Inventory item archived: ${e}`,"info",{itemId:e,reason:t,adapterType:this.adapterType}),U("archive_item","inventory",{itemId:e,reason:t}),F("inventory_item_archived",{itemId:e,reason:t,adapterType:this.adapterType}),n})),error:null}})}restoreItem(e){return J(this,null,function*(){return{data:yield T.handleOperation("restoreItem",()=>J(this,null,function*(){const r=yield this.adapter.updateInventoryItem(e,{status:"active",archiveReason:null});return Z.invalidateRelated("inventory:update",e),M("inventory","item_restored",`Inventory item restored: ${e}`,"info",{itemId:e,adapterType:this.adapterType}),U("restore_item","inventory",{itemId:e}),F("inventory_item_restored",{itemId:e,adapterType:this.adapterType}),r})),error:null}})}}var ce=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ah{constructor(e,t){this.adapter=e,this.adapterType=t}bulkCreateItems(e){return ce(this,null,function*(){return yield T.handleOperation("bulkCreateItems",()=>ce(this,null,function*(){const r=[],n=[];let s=0,o=0;for(const c of e)try{const a=yield this.adapter.addInventoryItem(c);r.push(a),Z.invalidateRelated("inventory:create",a.id),s++}catch(a){n.push(`Failed to create item ${c.name||c.item}: ${a instanceof Error?a.message:"Unknown error"}`),o++}return M("inventory","bulk_items_created",`Bulk created ${s} items, ${o} failed`,"info",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),U("bulk_create_items","inventory",{totalItems:e.length,successCount:s,errorCount:o}),F("inventory_bulk_items_created",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),{success:o===0,processedCount:e.length,successCount:s,errorCount:o,errors:n,data:r}}))})}bulkUpdateItems(e){return ce(this,null,function*(){return yield T.handleOperation("bulkUpdateItems",()=>ce(this,null,function*(){const r=[],n=[];let s=0,o=0;for(const c of e)try{const a=yield this.adapter.updateInventoryItem(c.id,c.updates);r.push(a),Z.invalidateRelated("inventory:update",c.id),s++}catch(a){n.push(`Failed to update item ${c.id}: ${a instanceof Error?a.message:"Unknown error"}`),o++}return M("inventory","bulk_items_updated",`Bulk updated ${s} items, ${o} failed`,"info",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),U("bulk_update_items","inventory",{totalItems:e.length,successCount:s,errorCount:o}),F("inventory_bulk_items_updated",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),{success:o===0,processedCount:e.length,successCount:s,errorCount:o,errors:n,data:r}}))})}bulkDeleteItems(e){return ce(this,null,function*(){return yield T.handleOperation("bulkDeleteItems",()=>ce(this,null,function*(){const r=[];let n=0,s=0;for(const o of e)try{yield this.adapter.deleteInventoryItem(o),Z.invalidateRelated("inventory:delete",o),n++}catch(c){r.push(`Failed to delete item ${o}: ${c instanceof Error?c.message:"Unknown error"}`),s++}return M("inventory","bulk_items_deleted",`Bulk deleted ${n} items, ${s} failed`,"info",{totalItems:e.length,successCount:n,errorCount:s,adapterType:this.adapterType}),U("bulk_delete_items","inventory",{totalItems:e.length,successCount:n,errorCount:s}),F("inventory_bulk_items_deleted",{totalItems:e.length,successCount:n,errorCount:s,adapterType:this.adapterType}),{success:s===0,processedCount:e.length,successCount:n,errorCount:s,errors:r,data:[]}}))})}bulkArchiveItems(e,t){return ce(this,null,function*(){return yield T.handleOperation("bulkArchiveItems",()=>ce(this,null,function*(){const n=[],s=[];let o=0,c=0;for(const a of e)try{const l=yield this.adapter.updateInventoryItem(a,{status:"archived",archiveReason:t});n.push(l),Z.invalidateRelated("inventory:update",a),o++}catch(l){s.push(`Failed to archive item ${a}: ${l instanceof Error?l.message:"Unknown error"}`),c++}return M("inventory","bulk_items_archived",`Bulk archived ${o} items, ${c} failed`,"info",{totalItems:e.length,successCount:o,errorCount:c,reason:t,adapterType:this.adapterType}),U("bulk_archive_items","inventory",{totalItems:e.length,successCount:o,errorCount:c,reason:t}),F("inventory_bulk_items_archived",{totalItems:e.length,successCount:o,errorCount:c,reason:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:o,errorCount:c,errors:s,data:n}}))})}bulkRestoreItems(e){return ce(this,null,function*(){return yield T.handleOperation("bulkRestoreItems",()=>ce(this,null,function*(){const r=[],n=[];let s=0,o=0;for(const c of e)try{const a=yield this.adapter.updateInventoryItem(c,{status:"active",archiveReason:null});r.push(a),Z.invalidateRelated("inventory:update",c),s++}catch(a){n.push(`Failed to restore item ${c}: ${a instanceof Error?a.message:"Unknown error"}`),o++}return M("inventory","bulk_items_restored",`Bulk restored ${s} items, ${o} failed`,"info",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),U("bulk_restore_items","inventory",{totalItems:e.length,successCount:s,errorCount:o}),F("inventory_bulk_items_restored",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),{success:o===0,processedCount:e.length,successCount:s,errorCount:o,errors:n,data:r}}))})}bulkChangeCategory(e,t){return ce(this,null,function*(){return yield T.handleOperation("bulkChangeCategory",()=>ce(this,null,function*(){const n=[],s=[];let o=0,c=0;for(const a of e)try{const l=yield this.adapter.updateInventoryItem(a,{category:t});n.push(l),Z.invalidateRelated("inventory:update",a),o++}catch(l){s.push(`Failed to change category for item ${a}: ${l instanceof Error?l.message:"Unknown error"}`),c++}return M("inventory","bulk_category_changed",`Bulk changed category for ${o} items, ${c} failed`,"info",{totalItems:e.length,successCount:o,errorCount:c,newCategory:t,adapterType:this.adapterType}),U("bulk_change_category","inventory",{totalItems:e.length,successCount:o,errorCount:c,newCategory:t}),F("inventory_bulk_category_changed",{totalItems:e.length,successCount:o,errorCount:c,newCategory:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:o,errorCount:c,errors:s,data:n}}))})}bulkChangeLocation(e,t){return ce(this,null,function*(){return yield T.handleOperation("bulkChangeLocation",()=>ce(this,null,function*(){const n=[],s=[];let o=0,c=0;for(const a of e)try{const l=yield this.adapter.updateInventoryItem(a,{location:t});n.push(l),Z.invalidateRelated("inventory:update",a),o++}catch(l){s.push(`Failed to change location for item ${a}: ${l instanceof Error?l.message:"Unknown error"}`),c++}return M("inventory","bulk_location_changed",`Bulk changed location for ${o} items, ${c} failed`,"info",{totalItems:e.length,successCount:o,errorCount:c,newLocation:t,adapterType:this.adapterType}),U("bulk_change_location","inventory",{totalItems:e.length,successCount:o,errorCount:c,newLocation:t}),F("inventory_bulk_location_changed",{totalItems:e.length,successCount:o,errorCount:c,newLocation:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:o,errorCount:c,errors:s,data:n}}))})}static validateBulkOperationData(e,t){const r=[];switch((!t||t.length===0)&&r.push("No data provided for bulk operation"),t.length>1e3&&r.push("Bulk operation limited to 1000 items maximum"),e){case"create":t.forEach((n,s)=>{if(!n||typeof n!="object"){r.push(`Item ${s+1}: Invalid item data`);return}const o=n;!o.name&&!o.item&&r.push(`Item ${s+1}: Name is required`),o.category||r.push(`Item ${s+1}: Category is required`)});break;case"update":t.forEach((n,s)=>{if(!n||typeof n!="object"){r.push(`Update ${s+1}: Invalid update data`);return}const o=n;o.id||r.push(`Update ${s+1}: ID is required`),o.updates||r.push(`Update ${s+1}: Updates object is required`)});break;case"delete":case"archive":case"restore":t.forEach((n,s)=>{(typeof n!="string"||!n.trim())&&r.push(`ID ${s+1}: Valid ID is required`)});break}return{isValid:r.length===0,errors:r}}}var ve=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class oh{constructor(e){this.adapter=e}searchItems(e){return ve(this,null,function*(){return yield T.handleOperation("searchItems",()=>ve(this,null,function*(){return{data:(yield this.adapter.fetchInventoryItems()).filter(s=>{var o,c,a,l;return((o=s.name)==null?void 0:o.toLowerCase().includes(e.toLowerCase()))||((a=(c=s.data)==null?void 0:c.description)==null?void 0:a.toString().toLowerCase().includes(e.toLowerCase()))||((l=s.category)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))}),error:null}}))})}getFilteredItems(e){return ve(this,null,function*(){return yield T.handleOperation("getFilteredItems",()=>ve(this,null,function*(){let n=yield this.adapter.fetchInventoryItems();if(e.category&&(n=n.filter(s=>s.category===e.category)),e.status&&(n=n.filter(s=>s.status===e.status)),e.location&&(n=n.filter(s=>s.location===e.location)),e.searchQuery){const s=e.searchQuery.toLowerCase();n=n.filter(o=>{var c,a,l;return((c=o.name)==null?void 0:c.toLowerCase().includes(s))||((l=(a=o.data)==null?void 0:a.description)==null?void 0:l.toString().toLowerCase().includes(s))})}return e.minQuantity!==void 0&&(n=n.filter(s=>(s.quantity||0)>=e.minQuantity)),e.maxQuantity!==void 0&&(n=n.filter(s=>(s.quantity||0)<=e.maxQuantity)),e.dateRange&&(n=n.filter(s=>{const o=new Date(s.lastUpdated||s.created_at);return o>=e.dateRange.start&&o<=e.dateRange.end})),e.tags&&e.tags.length>0&&(n=n.filter(s=>{var o;const c=((o=s.data)==null?void 0:o.tags)||[];return e.tags.some(a=>c.includes(a))})),{data:n,error:null}}))})}advancedSearch(e){return ve(this,arguments,function*(t,r={}){return yield T.handleOperation("advancedSearch",()=>ve(this,null,function*(){let o=yield this.adapter.fetchInventoryItems();if(t.category&&(o=o.filter(a=>a.category===t.category)),t.status&&(o=o.filter(a=>a.status===t.status)),t.location&&(o=o.filter(a=>a.location===t.location)),t.searchQuery){const a=t.searchQuery.toLowerCase();o=o.filter(l=>{var u,d,f,h;return((u=l.name)==null?void 0:u.toLowerCase().includes(a))||((f=(d=l.data)==null?void 0:d.description)==null?void 0:f.toString().toLowerCase().includes(a))||((h=l.category)==null?void 0:h.toLowerCase().includes(a))})}t.minQuantity!==void 0&&(o=o.filter(a=>(a.quantity||0)>=t.minQuantity)),t.maxQuantity!==void 0&&(o=o.filter(a=>(a.quantity||0)<=t.maxQuantity)),t.dateRange&&(o=o.filter(a=>{const l=new Date(a.lastUpdated||a.created_at);return l>=t.dateRange.start&&l<=t.dateRange.end})),t.tags&&t.tags.length>0&&(o=o.filter(a=>{var l;const u=((l=a.data)==null?void 0:l.tags)||[];return t.tags.some(d=>u.includes(d))})),r.includeArchived||(o=o.filter(a=>a.status!=="archived")),r.sortBy&&(o=this.sortItems(o,r.sortBy,r.sortOrder||"asc"));const c=o.length;if(r.limit||r.offset){const a=r.offset||0,l=r.limit?a+r.limit:o.length;o=o.slice(a,l)}return{data:o,total:c,filters:t,options:r,error:null}}))})}searchByNormalizedCategory(e){return ve(this,arguments,function*(t,r={}){return yield T.handleOperation("searchByNormalizedCategory",()=>ve(this,null,function*(){let c=(yield this.adapter.fetchInventoryItems()).filter(l=>Ue.normalizeCategory(l.category||"")===t);r.includeArchived||(c=c.filter(l=>l.status!=="archived")),r.sortBy&&(c=this.sortItems(c,r.sortBy,r.sortOrder||"asc"));const a=c.length;if(r.limit||r.offset){const l=r.offset||0,u=r.limit?l+r.limit:c.length;c=c.slice(l,u)}return{data:c,total:a,filters:{category:t},options:r,error:null}}))})}getSearchSuggestions(e,t=10){return ve(this,null,function*(){return(yield T.handleOperation("getSearchSuggestions",()=>ve(this,null,function*(){const n=yield this.adapter.fetchInventoryItems(),s=new Set;if(!e||e.trim()==="")return[];const o=e.toLowerCase();return n.forEach(c=>{var a;c.name&&c.name.toLowerCase().includes(o)&&s.add(c.name),c.category&&c.category.toLowerCase().includes(o)&&s.add(c.category),c.location&&c.location.toLowerCase().includes(o)&&s.add(c.location);const l=(a=c.data)==null?void 0:a.description;l&&l.toLowerCase().includes(o)&&l.split(/\s+/).filter(d=>d.toLowerCase().includes(o)&&d.length>2).forEach(d=>s.add(d))}),Array.from(s).slice(0,t)})))||[]})}getLocations(){return ve(this,null,function*(){return{data:yield T.handleOperation("getLocations",()=>ve(this,null,function*(){const t=yield this.adapter.fetchInventoryItems();return Array.from(new Set(t.map(n=>n.location).filter(Boolean)))})),error:null}})}sortItems(e,t,r){return e.sort((n,s)=>{let o,c;switch(t){case"name":o=n.name||"",c=s.name||"";break;case"category":o=n.category||"",c=s.category||"";break;case"location":o=n.location||"",c=s.location||"";break;case"quantity":o=n.quantity||0,c=s.quantity||0;break;case"lastUpdated":o=new Date(n.lastUpdated||n.created_at),c=new Date(s.lastUpdated||s.created_at);break;default:o=n.name||"",c=s.name||""}return o<c?r==="asc"?-1:1:o>c?r==="asc"?1:-1:0})}static validateSearchFilters(e){const t=[];return e.minQuantity!==void 0&&e.maxQuantity!==void 0&&e.minQuantity>e.maxQuantity&&t.push("Minimum quantity cannot be greater than maximum quantity"),e.dateRange&&e.dateRange.start>e.dateRange.end&&t.push("Start date cannot be after end date"),e.searchQuery&&e.searchQuery.length>100&&t.push("Search query must be less than 100 characters"),{isValid:t.length===0,errors:t}}static validateSearchOptions(e){const t=[];e.limit!==void 0&&e.limit<1&&t.push("Limit must be greater than 0"),e.limit!==void 0&&e.limit>1e3&&t.push("Limit cannot exceed 1000"),e.offset!==void 0&&e.offset<0&&t.push("Offset must be non-negative");const r=["name","category","location","quantity","lastUpdated"];e.sortBy&&!r.includes(e.sortBy)&&t.push(`Invalid sort field. Must be one of: ${r.join(", ")}`);const n=["asc","desc"];return e.sortOrder&&!n.includes(e.sortOrder)&&t.push(`Invalid sort order. Must be one of: ${n.join(", ")}`),{isValid:t.length===0,errors:t}}}var ch=Object.defineProperty,lh=Object.defineProperties,uh=Object.getOwnPropertyDescriptors,ks=Object.getOwnPropertySymbols,dh=Object.prototype.hasOwnProperty,hh=Object.prototype.propertyIsEnumerable,Cs=(i,e,t)=>e in i?ch(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pr=(i,e)=>{for(var t in e||(e={}))dh.call(e,t)&&Cs(i,t,e[t]);if(ks)for(var t of ks(e))hh.call(e,t)&&Cs(i,t,e[t]);return i},fh=(i,e)=>lh(i,uh(e));class ph{constructor(e){this.adapterType=e}trackItemCreated(e,t,r){const n={properties:{itemId:e,itemName:t,category:r,adapterType:this.adapterType}};this.logEvent("inventory","item_created",`Inventory item created: ${t}`,"info",n.properties),this.trackUserAction("create_item","inventory",{itemId:e,itemName:t,category:r}),this.trackAnalyticsEvent("inventory_item_created",n.properties)}trackItemUpdated(e,t){const r={properties:{itemId:e,updates:t,adapterType:this.adapterType}};this.logEvent("inventory","item_updated",`Inventory item updated: ${e}`,"info",r.properties),this.trackUserAction("update_item","inventory",{itemId:e,updates:t}),this.trackAnalyticsEvent("inventory_item_updated",r.properties)}trackItemDeleted(e){const t={properties:{itemId:e,adapterType:this.adapterType}};this.logEvent("inventory","item_deleted",`Inventory item deleted: ${e}`,"info",t.properties),this.trackUserAction("delete_item","inventory",{itemId:e}),this.trackAnalyticsEvent("inventory_item_deleted",t.properties)}trackCategoryCreated(e){const t={properties:{category:e,adapterType:this.adapterType}};this.logEvent("inventory","category_created",`Category created: ${e}`,"info",t.properties),this.trackUserAction("create_category","inventory",{category:e}),this.trackAnalyticsEvent("inventory_category_created",t.properties)}trackCategoryDeleted(e){const t={properties:{category:e,adapterType:this.adapterType}};this.logEvent("inventory","category_deleted",`Category deleted: ${e}`,"info",t.properties),this.trackUserAction("delete_category","inventory",{category:e}),this.trackAnalyticsEvent("inventory_category_deleted",t.properties)}trackBulkOperation(e,t,r,n,s){const o={properties:pr({totalItems:t,successCount:r,errorCount:n,adapterType:this.adapterType},s)};this.logEvent("inventory",`bulk_${e}`,`Bulk ${e}: ${r} successful, ${n} failed`,"info",o.properties),this.trackUserAction(`bulk_${e}`,"inventory",pr({totalItems:t,successCount:r,errorCount:n},s)),this.trackAnalyticsEvent(`inventory_bulk_${e}`,o.properties)}trackSearch(e,t,r){const n={properties:{query:e,resultCount:t,filters:r,adapterType:this.adapterType}};this.logEvent("inventory","search_performed",`Search: "${e}" returned ${t} results`,"info",n.properties),this.trackUserAction("search_items","inventory",{query:e,resultCount:t,filters:r}),this.trackAnalyticsEvent("inventory_search",n.properties)}trackFilter(e,t){const r={properties:{filters:e,resultCount:t,adapterType:this.adapterType}};this.logEvent("inventory","filter_applied",`Filter applied, returned ${t} results`,"info",r.properties),this.trackUserAction("filter_items","inventory",{filters:e,resultCount:t}),this.trackAnalyticsEvent("inventory_filter",r.properties)}trackItemDuplicated(e,t){const r={properties:{originalItemId:e,newItemId:t,adapterType:this.adapterType}};this.logEvent("inventory","item_duplicated",`Item duplicated: ${e} -> ${t}`,"info",r.properties),this.trackUserAction("duplicate_item","inventory",{originalItemId:e,newItemId:t}),this.trackAnalyticsEvent("inventory_item_duplicated",r.properties)}trackItemArchived(e,t){const r={properties:{itemId:e,reason:t,adapterType:this.adapterType}};this.logEvent("inventory","item_archived",`Item archived: ${e}`,"info",r.properties),this.trackUserAction("archive_item","inventory",{itemId:e,reason:t}),this.trackAnalyticsEvent("inventory_item_archived",r.properties)}trackItemRestored(e){const t={properties:{itemId:e,adapterType:this.adapterType}};this.logEvent("inventory","item_restored",`Item restored: ${e}`,"info",t.properties),this.trackUserAction("restore_item","inventory",{itemId:e}),this.trackAnalyticsEvent("inventory_item_restored",t.properties)}trackCategoryMerged(e,t,r){const n={properties:{sourceCategory:e,targetCategory:t,itemsUpdated:r,adapterType:this.adapterType}};this.logEvent("inventory","category_merged",`Category merged: ${e} -> ${t}`,"info",n.properties),this.trackUserAction("merge_category","inventory",{sourceCategory:e,targetCategory:t,itemsUpdated:r}),this.trackAnalyticsEvent("inventory_category_merged",n.properties)}trackAdapterInitialized(e){const t={properties:{adapterType:e}};this.logEvent("inventory","adapter_initialized",`Adapter initialized: ${e}`,"info",t.properties),this.trackUserAction("initialize_adapter","inventory",{adapterType:e}),this.trackAnalyticsEvent("inventory_adapter_initialized",t.properties)}trackError(e,t,r){const n={properties:pr({operation:e,errorMessage:t.message,errorStack:t.stack,adapterType:this.adapterType},r)};this.logEvent("inventory","error_occurred",`Error in ${e}: ${t.message}`,"error",n.properties),this.trackUserAction("error_occurred","inventory",pr({operation:e,errorMessage:t.message},r)),this.trackAnalyticsEvent("inventory_error",n.properties)}trackPerformance(e,t,r){const n={properties:{operation:e,duration:t,itemCount:r,adapterType:this.adapterType}};this.logEvent("inventory","performance_metric",`${e} took ${t}ms`,"info",n.properties),this.trackUserAction("performance_metric","inventory",{operation:e,duration:t,itemCount:r}),this.trackAnalyticsEvent("inventory_performance",n.properties)}logEvent(e,t,r,n,s){M(e,t,r,n,s)}trackUserAction(e,t,r){U(e,t,r)}trackAnalyticsEvent(e,t){F(e,t)}createCustomEvent(e,t,r,n,s,o){return{eventType:e,category:t,action:r,label:n,value:s,properties:fh(pr({},o),{adapterType:this.adapterType})}}trackCustomEvent(e){this.logEvent(e.category,e.action,e.label||e.action,"info",e.properties),this.trackUserAction(e.action,e.category,e.properties),this.trackAnalyticsEvent(e.eventType,e.properties)}}var X=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class gh{constructor(e,t){this.adapter=e,this.adapterType=t}getInventoryStats(){return X(this,null,function*(){return{data:yield T.handleOperation("getInventoryStats",()=>X(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={totalItems:t.length,categories:Array.from(new Set(t.map(s=>s.category))).length,locations:Array.from(new Set(t.map(s=>s.location))).length,activeItems:t.filter(s=>s.status==="active").length,maintenanceItems:t.filter(s=>s.status==="maintenance").length,inactiveItems:t.filter(s=>s.status==="inactive").length,retiredItems:t.filter(s=>s.status==="retired").length,archivedItems:t.filter(s=>s.status==="archived").length,lowStockItems:t.filter(s=>{const o=s.quantity||0,c=s.minimumStock||0;return o>0&&o<=c}).length,outOfStockItems:t.filter(s=>(s.quantity||0)===0).length,normalizedCategories:{tools:0,supplies:0,equipment:0,officeHardware:0},statusDistribution:{},categoryDistribution:{},locationDistribution:{},averageQuantity:0};t.forEach(s=>{const o=Ue.normalizeCategory(s.category||"");r.normalizedCategories[o.toLowerCase().replace(" ","")]++}),t.forEach(s=>{const o=s.status||"unknown";r.statusDistribution[o]=(r.statusDistribution[o]||0)+1}),t.forEach(s=>{const o=s.category||"unknown";r.categoryDistribution[o]=(r.categoryDistribution[o]||0)+1}),t.forEach(s=>{const o=s.location||"unknown";r.locationDistribution[o]=(r.locationDistribution[o]||0)+1});const n=t.reduce((s,o)=>s+(o.quantity||0),0);return r.averageQuantity=t.length>0?n/t.length:0,r})),error:null}})}getCategoryStats(){return X(this,null,function*(){return{data:yield T.handleOperation("getCategoryStats",()=>X(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=Ue.normalizeCategory(n.category||"");r[s]=(r[s]||0)+1}),r})),error:null}})}getStatusStats(){return X(this,null,function*(){return{data:yield T.handleOperation("getStatusStats",()=>X(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=n.status||"unknown";r[s]=(r[s]||0)+1}),r})),error:null}})}getLocationStats(){return X(this,null,function*(){return{data:yield T.handleOperation("getLocationStats",()=>X(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=n.location||"unknown";r[s]=(r[s]||0)+1}),r})),error:null}})}getStockLevelStats(){return X(this,null,function*(){return{data:yield T.handleOperation("getStockLevelStats",()=>X(this,null,function*(){const t=yield this.adapter.fetchInventoryItems();let r=0,n=0,s=0,o=0;return t.forEach(c=>{const a=c.quantity||0,l=c.minimumStock||0,u=c.maximumStock||1/0;a===0?s++:a<=l?n++:a>=u?o++:r++}),{inStock:r,lowStock:n,outOfStock:s,overStock:o}})),error:null}})}getTrendingItems(e=10){return X(this,null,function*(){return{data:yield T.handleOperation("getTrendingItems",()=>X(this,null,function*(){const r=yield this.adapter.fetchInventoryItems(),n={};return r.forEach(o=>{n[o.id]=(n[o.id]||0)+1}),r.sort((o,c)=>new Date(c.lastUpdated||c.created_at).getTime()-new Date(o.lastUpdated||o.created_at).getTime()).slice(0,e).map(o=>({id:o.id,name:o.name||o.item||"Unknown",category:o.category||"Unknown",lastUpdated:o.lastUpdated||o.created_at,updateCount:n[o.id]||1}))})),error:null}})}getCurrentAdapterType(){return this.adapterType}getAdapterMetadata(){return Bt.getAdapterMetadata(this.adapterType)||null}getAvailableAdapters(){return Bt.getAvailableAdapters()}getAdapterCapabilities(){const e=this.getAdapterMetadata();return(e==null?void 0:e.capabilities)||[]}supportsOperation(e){const t=this.getAdapterMetadata();return(t==null?void 0:t.supportedOperations.includes(e))||!1}getPerformanceMetrics(){return X(this,null,function*(){return{data:yield T.handleOperation("getPerformanceMetrics",()=>X(null,null,function*(){return{averageResponseTime:150,totalOperations:1e3,errorRate:.02,cacheHitRate:.85}})),error:null}})}getDataQualityMetrics(){return X(this,null,function*(){return{data:yield T.handleOperation("getDataQualityMetrics",()=>X(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r=[];let n=0,s=0;t.forEach(l=>{["name","category","status"].forEach(d=>{s++,l[d]?n++:r.push(`Missing ${d} for item ${l.id}`)}),l.quantity!==void 0&&l.minimumStock!==void 0&&(l.quantity<0&&r.push(`Negative quantity for item ${l.id}`),l.minimumStock<0&&r.push(`Negative minimum stock for item ${l.id}`))});const o=s>0?n/s:0,c=1-r.length/t.length,a=1-r.filter(l=>l.includes("consistency")).length/t.length;return{completeness:o,accuracy:Math.max(0,c),consistency:Math.max(0,a),issues:r}})),error:null}})}generateInventoryReport(){return X(this,null,function*(){return{data:yield T.handleOperation("generateInventoryReport",()=>X(this,null,function*(){const[t,r,n,s,o]=yield Promise.all([this.getInventoryStats(),this.getCategoryStats(),this.getStatusStats(),this.getLocationStats(),this.getStockLevelStats()]),c=[];return t.data&&(t.data.lowStockItems>0&&c.push(`Consider restocking ${t.data.lowStockItems} low stock items`),t.data.outOfStockItems>0&&c.push(`Urgent: ${t.data.outOfStockItems} items are out of stock`),t.data.archivedItems>t.data.totalItems*.1&&c.push("Consider cleaning up archived items")),{summary:t.data,categoryBreakdown:r.data||{},statusBreakdown:n.data||{},locationBreakdown:s.data||{},stockLevels:o.data||{inStock:0,lowStock:0,outOfStock:0,overStock:0},recommendations:c,generatedAt:new Date().toISOString()}})),error:null}})}}var K=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class mh{constructor(){this.currentAdapter=null,this.adapterType="static",this.initialized=!1,this.categoryProvider=null,this.itemCrudProvider=null,this.bulkOperationsProvider=null,this.searchFilterProvider=null,this.analyticsProvider=null,this.statsProvider=null}get isInitialized(){return this.initialized}initialize(e,t){return K(this,null,function*(){this.initialized||(this.currentAdapter=e,this.adapterType=t,typeof this.currentAdapter.initialize=="function"&&(yield this.currentAdapter.initialize()),this.categoryProvider=new Ue(e,t),this.itemCrudProvider=new sh(e,t),this.bulkOperationsProvider=new ah(e,t),this.searchFilterProvider=new oh(e),this.analyticsProvider=new ph(t),this.statsProvider=new gh(e,t),this.initialized=!0,console.info("[InventoryRepository] Initialized successfully."))})}getAdapter(){if(!this.initialized||!this.currentAdapter)throw new Error("Inventory repository not initialized. Must call initialize() first.");return this.currentAdapter}fetchInventoryItems(){return K(this,null,function*(){return this.itemCrudProvider.fetchInventoryItems()})}fetchAllInventoryData(){return K(this,null,function*(){const e=yield T.handleOperation("fetchAllInventoryData",()=>K(this,null,function*(){const r=yield this.getAdapter().fetchAllInventoryData(),n=r.data||[],s=Jd(n),o=Yd(s),c=new Set,a=new Set;[o.tools,o.supplies,o.equipment,o.officeHardware].forEach(u=>{u.forEach(d=>{c.has(d.id)&&a.add(d.id),c.add(d.id)})}),a.size>0&&console.warn(`Found ${a.size} duplicate item IDs:`,Array.from(a));const l=Array.from(new Set(s.map(u=>u.category).filter(Boolean)));return{tools:o.tools,supplies:o.supplies,equipment:o.equipment,officeHardware:o.officeHardware,categories:l,isLoading:!1,error:r.error}}));return{tools:e.tools||[],supplies:e.supplies||[],equipment:e.equipment||[],officeHardware:e.officeHardware||[],categories:e.categories,isLoading:e.isLoading,error:e.error}})}getItemById(e){return K(this,null,function*(){return this.itemCrudProvider.getItemById(e)})}createItem(e){return K(this,null,function*(){return this.itemCrudProvider.createItem(e)})}updateItem(e,t){return K(this,null,function*(){return this.itemCrudProvider.updateItem(e,t)})}deleteItem(e){return K(this,null,function*(){return this.itemCrudProvider.deleteItem(e)})}addInventoryItem(e){return K(this,null,function*(){return this.itemCrudProvider.addInventoryItem(e)})}addCategory(e){return K(this,null,function*(){return this.categoryProvider.addCategory(e)})}deleteCategory(e){return K(this,null,function*(){return this.categoryProvider.deleteCategory(e)})}bulkCreateItems(e){return K(this,null,function*(){return this.bulkOperationsProvider.bulkCreateItems(e)})}bulkUpdateItems(e){return K(this,null,function*(){return this.bulkOperationsProvider.bulkUpdateItems(e)})}bulkDeleteItems(e){return K(this,null,function*(){return this.bulkOperationsProvider.bulkDeleteItems(e)})}searchItems(e){return K(this,null,function*(){return this.searchFilterProvider.searchItems(e)})}getFilteredItems(e){return K(this,null,function*(){return this.searchFilterProvider.getFilteredItems(e)})}getCategories(){return K(this,null,function*(){return this.categoryProvider.getCategories()})}getLocations(){return K(this,null,function*(){return this.searchFilterProvider.getLocations()})}getInventoryStats(){return K(this,null,function*(){const e=yield this.statsProvider.getInventoryStats();return{data:e.data,error:e.error}})}getCurrentAdapterType(){return this.statsProvider.getCurrentAdapterType()}getAdapterMetadata(){return this.statsProvider.getAdapterMetadata()}getAvailableAdapters(){return this.statsProvider.getAvailableAdapters()}}class yh{constructor(){this.cache={data:null,timestamp:0,ttl:300*1e3,hits:0,misses:0,evictions:0}}get(){return this.cache.data&&Date.now()-this.cache.timestamp<this.cache.ttl?(this.cache.hits++,this.cache.data):(this.cache.misses++,null)}set(e){this.cache.data=e,this.cache.timestamp=Date.now()}clear(){this.cache.data&&this.cache.evictions++,this.cache.data=null,this.cache.timestamp=0}getStats(){return{hits:this.cache.hits,misses:this.cache.misses,size:this.cache.data?JSON.stringify(this.cache.data).length:0,lastUpdated:new Date(this.cache.timestamp).toISOString(),updated_at:new Date(this.cache.timestamp).toISOString()}}isValid(){return!!(this.cache.data&&Date.now()-this.cache.timestamp<this.cache.ttl)}}const vh={realtime:{get enabled(){return Pr()}}};var _h=Object.defineProperty,wh=Object.defineProperties,bh=Object.getOwnPropertyDescriptors,As=Object.getOwnPropertySymbols,Sh=Object.prototype.hasOwnProperty,Ih=Object.prototype.propertyIsEnumerable,Ts=(i,e,t)=>e in i?_h(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ps=(i,e)=>{for(var t in e||(e={}))Sh.call(e,t)&&Ts(i,t,e[t]);if(As)for(var t of As(e))Ih.call(e,t)&&Ts(i,t,e[t]);return i},Os=(i,e)=>wh(i,bh(e)),Oe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class er{constructor(){this.isConnected=!1,this.connectionTestPromise=null}static getInstance(){return er.instance||(er.instance=new er),er.instance}testConnection(){return Oe(this,null,function*(){return this.connectionTestPromise?this.connectionTestPromise:(this.connectionTestPromise=this.performConnectionTest(),this.connectionTestPromise)})}performConnectionTest(){return Oe(this,null,function*(){if(!Pr())return console.warn("Supabase not configured, connection test skipped"),!1;try{const{error:e}=yield y.from("inventory_items").select("count").limit(1);return e?(console.error(" Supabase connection test failed:",e),this.isConnected=!1,!1):(this.isConnected=!0,!0)}catch(e){return console.error(" Supabase connection test error:",e),this.isConnected=!1,!1}})}getAnalytics(){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");return ne.getAnalytics()})}getCategories(){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{data:t,error:r}=yield y.from("inventory_items").select("category").not("category","is",null);if(r)throw new Error(`Failed to fetch categories: ${r.message}`);return Array.from(new Set((t==null?void 0:t.map(s=>s.category).filter(Boolean))||[]))}catch(t){throw console.error(" Error fetching categories:",t),t}})}getLocations(){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{error:t}=yield y.from("inventory_items").select("location").not("location","is",null);if(t)throw new Error(`Failed to fetch locations: ${t.message}`);return[]}catch(t){throw console.error(" Error fetching locations:",t),t}})}getItems(e){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{let r=y.from("inventory_items").select("*",{count:"exact"});e!=null&&e.category&&(r=r.eq("category",e.category)),e!=null&&e.limit&&(r=r.limit(e.limit)),e!=null&&e.offset&&(r=r.range(e.offset,e.offset+(e.limit||10)-1));const{data:n,error:s,count:o}=yield r;if(s)throw new Error(`Failed to fetch items: ${s.message}`);return{data:n||[],count:o||0,error:null}}catch(r){return console.error(" Error fetching items:",r),{data:[],count:0,error:r instanceof Error?r.message:"Unknown error"}}})}subscribeToChanges(e){if(!vh.realtime.enabled)return()=>{};try{return Oa.subscribe("inventory_items",e,{event:"*"})}catch(t){return console.error(" Failed to set up real-time subscription:",t),()=>{}}}resetConnectionTest(){this.connectionTestPromise=null,this.isConnected=!1}getConnectionStatus(){return{isConnected:this.isConnected,isConfigured:Pr()}}getItemById(e){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{data:r,error:n}=yield y.from("inventory_items").select("*").eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw new Error(`Failed to fetch item: ${n.message}`)}return r}catch(r){throw console.error(" Error fetching item by ID:",r),r}})}createItem(e){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const r=Os(Ps({},e),{data:e.data}),{data:n,error:s}=yield y.from("inventory_items").insert(r).select().single();if(s)throw new Error(`Failed to create item: ${s.message}`);return n}catch(r){throw console.error(" Error creating item:",r),r}})}updateItem(e,t){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const n=Os(Ps({},t),{data:t.data}),{data:s,error:o}=yield y.from("inventory_items").update(n).eq("id",e).select().single();if(o)throw new Error(`Failed to update item: ${o.message}`);return s}catch(n){throw console.error(" Error updating item:",n),n}})}deleteItem(e){return Oe(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{error:r}=yield y.from("inventory_items").delete().eq("id",e);if(r)throw new Error(`Failed to delete item: ${r.message}`)}catch(r){throw console.error(" Error deleting item:",r),r}})}}const Eh=er.getInstance();function kh(i,e=3e5){const t=new Date(Date.now()-e),r=i.filter(o=>o.timestamp>t);if(r.length===0)return{avg:0,min:0,max:0,count:0,p95:0,p99:0};const n=r.map(o=>o.value).sort((o,c)=>o-c);return{avg:n.reduce((o,c)=>o+c,0)/n.length,min:n[0],max:n[n.length-1],count:n.length,p95:n[Math.floor(n.length*.95)],p99:n[Math.floor(n.length*.99)]}}function Ch(i,e){let t=!1,r="warning";switch(e.operator){case"gt":t=i.value>e.warning,r=i.value>e.critical?"critical":"warning";break;case"lt":t=i.value<e.warning,r=i.value<e.critical?"critical":"warning";break;case"gte":t=i.value>=e.warning,r=i.value>=e.critical?"critical":"warning";break;case"lte":t=i.value<=e.warning,r=i.value<=e.critical?"critical":"warning";break;case"eq":t=i.value===e.warning,r=i.value===e.critical?"critical":"warning";break}return{shouldAlert:t,severity:r}}function Ah(i,e=3e5){const t=[],r=new Date(Date.now()-e),n=i.filter(f=>f.timestamp>r);if(n.length<2)return t;const s=n.map(f=>f.value),o=s.slice(0,Math.floor(s.length/2)),c=s.slice(Math.floor(s.length/2)),a=o.reduce((f,h)=>f+h,0)/o.length,u=(c.reduce((f,h)=>f+h,0)/c.length-a)/a*100;let d="stable";return Math.abs(u)>10&&(d=u<0?"improving":"degrading"),t.push({metric:n[0].name,trend:d,changePercent:Math.round(u*100)/100,period:`${Math.round(e/6e4)} minutes`}),t}function Th(i,e,t){let r=100;i>1e3&&(r-=20),e>5&&(r-=30),t>500*1024*1024&&(r-=20);let n="healthy";return r<50?n="critical":r<80&&(n="degraded"),{score:Math.max(0,r),status:n}}function Ph(i){const e=i.filter(o=>o.status==="fail").length,t=i.filter(o=>o.status==="warn").length,r=i.length;let n="healthy";e>0?n=e>r/2?"critical":"degraded":t>0&&(n="degraded");const s=Math.max(0,100-e*50-t*25);return{status:n,score:s}}function Oh(){return`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function xh(i,e,t,r){return`${i} ${e} ${t} (current: ${r})`}function Dh(i){return Date.now()-i.getTime()<3e5}function $h(i,e=60){return i/e}function xs(i,e=50){return i.substring(0,e)}function Rh(i){return Math.round(i/1024/1024)}function Lh(i,e=200){return i<e*1024*1024}class Mh{constructor(){this.alerts=[],this.alertSubscribers=[]}createAlert(e,t,r){const s={id:Oh(),metric:e.name,value:e.value,threshold:t.warning,severity:r,message:xh(e.name,t.operator,t.warning,e.value),timestamp:new Date,resolved:!1};this.alerts.find(c=>c.metric===s.metric&&c.severity===s.severity&&!c.resolved&&Dh(c.timestamp))||(this.alerts.push(s),R.warn(`Performance alert: ${s.message}`,s),this.notifyAlertSubscribers(s))}getActiveAlerts(){return this.alerts.filter(e=>!e.resolved)}resolveAlert(e){const t=this.alerts.find(r=>r.id===e);t&&(t.resolved=!0,t.resolvedAt=new Date,R.info(`Alert resolved: ${e}`,t))}subscribeToAlerts(e){return this.alertSubscribers.push(e),()=>{const t=this.alertSubscribers.indexOf(e);t>-1&&this.alertSubscribers.splice(t,1)}}notifyAlertSubscribers(e){this.alertSubscribers.forEach(t=>{try{t(e)}catch(r){R.error("Error in alert subscriber:",r)}})}logMetricRecorded(e,t,r,n,s){R.debug(`Performance metric recorded: ${e}=${t}${r}`,{tags:n,metadata:s})}logThresholdsUpdated(e){R.info("Performance thresholds updated",{thresholds:e})}logSnapshotCaptured(e,t,r){R.debug("Performance snapshot captured",{timestamp:e,metricsCount:t,alertsCount:r})}logSnapshotError(e){R.error("Failed to capture performance snapshot:",e)}logMonitoringDisabled(){console.log("Performance monitoring disabled in development mode")}logDatabaseCheckError(e){console.error(e)}logMemoryCheckError(e){console.error(e)}}const Ie=new Mh;var Fa=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function jh(i,e){const t=e.filter(r=>r.metric===i.name);for(const r of t){const{shouldAlert:n,severity:s}=Ch(i,r);n&&Ie.createAlert(i,r,s)}}function Uh(){return[{metric:"response_time",warning:1e3,critical:5e3,operator:"gt"},{metric:"component_mount_time",warning:1e3,critical:3e3,operator:"gt"},{metric:"authentication_time",warning:2e3,critical:5e3,operator:"gt"},{metric:"data_fetch_time",warning:2e3,critical:5e3,operator:"gt"},{metric:"navigation_time",warning:1e3,critical:3e3,operator:"gt"},{metric:"error_rate",warning:5,critical:10,operator:"gt"},{metric:"memory_usage",warning:200*1024*1024,critical:500*1024*1024,operator:"gt"}]}function Nh(){return()=>Fa(null,null,function*(){try{const i=Date.now();return{name:"database",status:"pass",message:"Database connection healthy",duration:Date.now()-i}}catch(i){return Ie.logDatabaseCheckError(i),{name:"database",status:"fail",message:"Database connection failed",duration:0}}})}function Fh(i){return()=>Fa(null,null,function*(){try{const e=i("memory_usage");return{name:"memory",status:Lh(e.avg)?"pass":"warn",message:`Memory usage: ${Rh(e.avg)}MB`,duration:0}}catch(e){return Ie.logMemoryCheckError(e),{name:"memory",status:"fail",message:"Memory check failed",duration:0}}})}function zh(i,e,t){const r={timestamp:new Date,metrics:new Map,health:i,alerts:e};for(const[n,s]of Array.from(t.entries()))if(s.length>0){const o=s[s.length-1];r.metrics.set(n,o.value)}return r}function qh(i){const e=i("response_time").avg,t=i("error_rate").avg,r=i("memory_usage").avg,{score:n,status:s}=Th(e,t,r);return{status:s,score:n,checks:[],metrics:{cpu:0,memory:r,responseTime:e,errorRate:t,throughput:i("throughput").avg},lastUpdated:new Date}}function Hh(i,e,t){const r=[];i.status==="critical"&&r.push({type:"critical",title:"System Critical",description:"System is in critical state with multiple failures",impact:"high",recommendations:["Check system resources immediately","Review error logs for root cause","Consider scaling resources"]});const n=e("response_time")[0];n&&n.trend==="degrading"&&r.push({type:"warning",title:"Response Time Degradation",description:`Response time has increased by ${n.changePercent}%`,impact:"medium",recommendations:["Optimize database queries","Check for memory leaks","Review caching strategies"]});const s=e("memory_usage")[0];s&&s.trend==="degrading"&&r.push({type:"warning",title:"Memory Usage Increasing",description:`Memory usage has increased by ${s.changePercent}%`,impact:"medium",recommendations:["Check for memory leaks","Optimize data structures","Consider garbage collection tuning"]});const o=t("response_time").avg;return o>1e3&&r.push({type:"optimization",title:"Response Time Optimization",description:`Average response time is ${o.toFixed(2)}ms`,impact:"low",recommendations:["Implement response caching","Optimize API endpoints","Consider CDN implementation"]}),r}var Bh=Object.defineProperty,Vh=Object.defineProperties,Gh=Object.getOwnPropertyDescriptors,Ds=Object.getOwnPropertySymbols,Kh=Object.prototype.hasOwnProperty,Wh=Object.prototype.propertyIsEnumerable,$s=(i,e,t)=>e in i?Bh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,be=(i,e)=>{for(var t in e||(e={}))Kh.call(e,t)&&$s(i,t,e[t]);if(Ds)for(var t of Ds(e))Wh.call(e,t)&&$s(i,t,e[t]);return i},Qh=(i,e)=>Vh(i,Gh(e)),Cn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class tr{constructor(){this.metrics=new Map,this.thresholds=[],this.healthChecks=[],this.MAX_METRICS_PER_TYPE=1e3,this.performanceHistory=new Map,this.monitoringInterval=null,this.isMonitoring=!1,this.initializeDefaultThresholds(),this.initializeHealthChecks(),this.startContinuousMonitoring()}static getInstance(){return tr.instance||(tr.instance=new tr),tr.instance}recordMetric(e,t,r,n={},s){const o={name:e,value:t,unit:r,timestamp:new Date,tags:n,metadata:s};this.metrics.has(e)||this.metrics.set(e,[]);const c=this.metrics.get(e);c.push(o),c.length>this.MAX_METRICS_PER_TYPE&&c.splice(0,c.length-this.MAX_METRICS_PER_TYPE),jh(o,this.thresholds),Ie.logMetricRecorded(e,t,r,n,s)}recordResponseTime(e,t,r={}){this.recordMetric("response_time",t,"ms",be({operation:e},r))}recordErrorRate(e,t,r={}){this.recordMetric("error_rate",t,"percent",be({service:e},r))}recordThroughput(e,t,r=60,n={}){const s=$h(t,r);this.recordMetric("throughput",s,"ops/sec",be({operation:e,period:r.toString()},n))}recordMemoryUsage(e,t,r={}){this.recordMetric("memory_usage",t,"bytes",be({type:e},r))}recordDatabaseQuery(e,t,r,n={}){this.recordMetric("db_query_duration",t,"ms",be({query:xs(e)},n)),this.recordMetric("db_query_rows",r,"count",be({query:xs(e)},n))}recordComponentMount(e,t,r={}){this.recordMetric("component_mount_time",t,"ms",be({component:e},r))}recordAuthentication(e,t,r={}){this.recordMetric("authentication_time",e,"ms",be({success:t.toString()},r))}recordDataFetch(e,t,r,n={}){this.recordMetric("data_fetch_time",t,"ms",be({operation:e,success:r.toString()},n))}recordNavigation(e,t,r,n={}){this.recordMetric("navigation_time",r,"ms",be({from:e,to:t},n))}getMetrics(e,t=100){return(this.metrics.get(e)||[]).slice(-t)}getAllMetrics(){return new Map(this.metrics)}getAggregatedMetrics(e,t=3e5){const r=this.metrics.get(e)||[];return kh(r,t)}getSystemHealth(){return Cn(this,null,function*(){const e=yield Promise.all(this.healthChecks.map(c=>Cn(this,null,function*(){const a=Date.now();try{const l=yield c();return Qh(be({},l),{duration:Date.now()-a})}catch(l){return{name:"unknown",status:"fail",message:l instanceof Error?l.message:"Unknown error",duration:Date.now()-a}}}))),{status:t,score:r}=Ph(e),n=this.getAggregatedMetrics("response_time").avg,s=this.getAggregatedMetrics("error_rate").avg,o=this.getAggregatedMetrics("throughput").avg;return{status:t,score:r,checks:e,metrics:{cpu:0,memory:this.getAggregatedMetrics("memory_usage").avg,responseTime:n,errorRate:s,throughput:o},lastUpdated:new Date}})}getActiveAlerts(){return Ie.getActiveAlerts()}resolveAlert(e){Ie.resolveAlert(e)}addHealthCheck(e){this.healthChecks.push(e)}setThresholds(e){this.thresholds=e,Ie.logThresholdsUpdated(e)}initializeDefaultThresholds(){this.thresholds=Uh()}initializeHealthChecks(){this.addHealthCheck(Nh()),this.addHealthCheck(Fh(e=>this.getAggregatedMetrics(e)))}startContinuousMonitoring(){if(this.isMonitoring)return;const e=fe("NODE_ENV")==="development"||fe("MODE")==="development",t=fe("VITE_ENABLE_PERFORMANCE_MONITORING")==="true";if(e&&!t){Ie.logMonitoringDisabled();return}this.isMonitoring=!0,this.monitoringInterval=setInterval(()=>{this.capturePerformanceSnapshot()},3e4)}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null),this.isMonitoring=!1}capturePerformanceSnapshot(){return Cn(this,null,function*(){try{const e=yield this.getSystemHealth(),t=this.getActiveAlerts(),r=zh(e,t,this.metrics),n="performance_snapshot";this.performanceHistory.has(n)||this.performanceHistory.set(n,[]);const s=this.performanceHistory.get(n);s.push(r),s.length>100&&s.splice(0,s.length-100),Ie.logSnapshotCaptured(r.timestamp,r.metrics.size,t.length)}catch(e){Ie.logSnapshotError(e)}})}getPerformanceTrends(e,t=3e5){const r=this.metrics.get(e)||[];return Ah(r,t)}getPerformanceInsights(){const e=this.getSystemHealthSync();return Hh(e,t=>this.getPerformanceTrends(t),t=>this.getAggregatedMetrics(t))}subscribeToAlerts(e){return Ie.subscribeToAlerts(e)}getPerformanceHistory(e){return e?this.performanceHistory.get(e)||[]:this.performanceHistory.get("performance_snapshot")||[]}getSystemHealthSync(){return qh(e=>this.getAggregatedMetrics(e))}}const an=tr.getInstance();var Yh=Object.defineProperty,Rs=Object.getOwnPropertySymbols,Jh=Object.prototype.hasOwnProperty,Xh=Object.prototype.propertyIsEnumerable,Ls=(i,e,t)=>e in i?Yh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Zh=(i,e)=>{for(var t in e||(e={}))Jh.call(e,t)&&Ls(i,t,e[t]);if(Rs)for(var t of Rs(e))Xh.call(e,t)&&Ls(i,t,e[t]);return i},O=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const za=class he{constructor(){this.cacheManager=new yh,this.repository=new mh,this.adapterManager=new $u,this.isInitialized=!1,this.initializationPromise=null,this.categoryService=new La,this.filterService=new Ma,this.statusService=new ja,Z.isRegistered("inventory_service")||Z.registerCacheManager("inventory_service",this)}transformDataForModal(e){return e.map(t=>Zh({},t))}static getInstance(){return he.instance||(he.instance=new he),he.instance}getInstanceId(){return`instance_${this===he.instance?"SINGLETON":"NEW"}`}initialize(){return O(this,null,function*(){const e=performance.now();if(!this.isInitialized){if(this.initializationPromise){yield this.initializationPromise;return}this.initializationPromise=O(this,null,function*(){try{yield this.adapterManager.initialize(),yield this.repository.initialize(this.adapterManager.getAdapter(),this.adapterManager.getCurrentAdapterType()),this.isInitialized=!0;const t=performance.now()-e;an.recordResponseTime("inventory_service_initialization",t,{service:"InventoryServiceFacade",operation:"initialize"})}finally{this.initializationPromise=null}}),yield this.initializationPromise}})}isReady(){return this.isInitialized}fetchInventoryItems(){return O(this,null,function*(){return yield this.repository.fetchInventoryItems()})}fetchAllInventoryData(){return O(this,null,function*(){var e,t,r,n;const s=performance.now(),o=this.cacheManager.get();if(o)return o;this.repository.isInitialized||(console.warn(`[InventoryServiceFacade] Repository not initialized (facade.isInitialized: ${this.isInitialized})  auto-initializing now.`),yield this.initialize());const c=yield this.repository.fetchAllInventoryData(),a=performance.now()-s;return an.recordDataFetch("fetchAllInventoryData",a,!c.error,{service:"InventoryServiceFacade",operation:"fetchAllInventoryData",toolsCount:String(((e=c.tools)==null?void 0:e.length)||0),suppliesCount:String(((t=c.supplies)==null?void 0:t.length)||0),equipmentCount:String(((r=c.equipment)==null?void 0:r.length)||0),officeHardwareCount:String(((n=c.officeHardware)==null?void 0:n.length)||0)}),this.cacheManager.set(c),c})}getAllItems(){return O(this,null,function*(){this.repository.isInitialized||(console.warn(`[InventoryServiceFacade] Repository not initialized (facade.isInitialized: ${this.isInitialized})  auto-initializing now.`),yield this.initialize());const e=yield this.fetchAllInventoryData(),t=[...e.tools,...e.supplies,...e.equipment,...e.officeHardware];return{data:t,count:t.length,error:e.error}})}getItemById(e){return O(this,null,function*(){return yield this.repository.getItemById(e)})}createItem(e){return O(this,null,function*(){return yield this.repository.createItem(e)})}updateItem(e,t){return O(this,null,function*(){return yield this.repository.updateItem(e,t)})}deleteItem(e){return O(this,null,function*(){return yield this.repository.deleteItem(e)})}addInventoryItem(e){return O(this,null,function*(){return yield this.repository.addInventoryItem(e)})}addCategory(e){return O(this,null,function*(){return yield this.repository.addCategory(e)})}deleteCategory(e){return O(this,null,function*(){return yield this.repository.deleteCategory(e)})}bulkCreateItems(e){return O(this,null,function*(){return yield this.repository.bulkCreateItems(e)})}bulkUpdateItems(e){return O(this,null,function*(){return yield this.repository.bulkUpdateItems(e)})}bulkDeleteItems(e){return O(this,null,function*(){return yield this.repository.bulkDeleteItems(e)})}searchItems(e){return O(this,null,function*(){return yield this.repository.searchItems(e)})}getFilteredItems(e){return O(this,null,function*(){return yield this.repository.getFilteredItems(e)})}getCategories(){return O(this,null,function*(){return yield this.repository.getCategories()})}getLocations(){return O(this,null,function*(){return yield this.repository.getLocations()})}getInventoryStats(){return O(this,null,function*(){return yield this.repository.getInventoryStats()})}refresh(){return O(this,null,function*(){try{return yield this.refreshData(),{success:!0,error:null}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}})}validateItem(e){return O(this,null,function*(){const t=[];return e.name||t.push("Item name is required"),e.category||t.push("Category is required"),e.location||t.push("Location is required"),e.quantity!==void 0&&e.quantity!==null&&e.quantity<0&&t.push("Quantity cannot be negative"),e.unit_cost!==void 0&&e.unit_cost!==null&&e.unit_cost<0&&t.push("Cost cannot be negative"),{isValid:t.length===0,errors:t}})}getItemHistory(){return O(this,null,function*(){return[]})}subscribeToChanges(){try{return Eh.subscribeToChanges(e=>{this.clearCache(),F("inventory_realtime_update",{source:"facade",payload_type:typeof e,adapter_type:this.adapterManager.getCurrentAdapterType()})})}catch(e){return console.error(" Failed to set up real-time subscription in InventoryServiceFacade:",e),()=>{}}}updateInventoryItem(e,t){return O(this,null,function*(){const r=yield this.updateItem(e,t);if(!r.data)throw new Error("Failed to update inventory item");return r.data})}deleteInventoryItem(e){return O(this,null,function*(){yield this.deleteItem(e)})}getFilteredData(e,t,r,n,s){let o=e;if(t.query.trim()){const c=t.caseSensitive?t.query:t.query.toLowerCase(),a=t.fields||["name","category","location","description"];o=o.filter(l=>a.some(u=>{const d=l[u];return d?(t.caseSensitive?d.toString():d.toString().toLowerCase()).includes(c):!1}))}if(r&&(o=o.filter(c=>{var a;return!(r.category&&c.category!==r.category||r.status&&c.status!==r.status||r.location&&c.location!==r.location||r.minQuantity!==void 0&&(c.quantity||0)<r.minQuantity||r.maxQuantity!==void 0&&(c.quantity||0)>r.maxQuantity||r.isActive!==void 0&&((a=c.data)==null?void 0:a.isActive)!==r.isActive)})),s&&o.sort((c,a)=>{const l=c[s.field],u=a[s.field];return s.direction==="asc"?String(l)<String(u)?-1:String(l)>String(u)?1:0:String(l)>String(u)?-1:String(l)<String(u)?1:0}),n){const c=(n.page-1)*n.limit,a=c+n.limit;o=o.slice(c,a)}return o}clearCache(){this.cacheManager.clear()}refreshData(){return O(this,null,function*(){this.clearCache();const e=yield this.fetchAllInventoryData();return{data:[...e.tools,...e.supplies,...e.equipment,...e.officeHardware],error:e.error}})}getCurrentAdapterType(){return this.adapterManager.getCurrentAdapterType()}getAdapterMetadata(){return this.adapterManager.getAdapterMetadata()}getAvailableAdapters(){return this.adapterManager.getAvailableAdapters()}getCacheStats(){return this.cacheManager.getStats()}getErrorStats(){return{totalErrors:0,lastError:null,errorRate:0}}switchAdapter(e){return O(this,null,function*(){try{return yield this.initialize(),{success:!0,data:e}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}})}getItemId(e){var t;return e.id||((t=e.data)!=null&&t.barcode&&typeof e.data.barcode=="string"?e.data.barcode:"")||""}getItemStatus(e){return Zn(e)||"Unknown"}static initialize(){return O(this,null,function*(){return he.getInstance().initialize()})}static getItemById(e){return O(this,null,function*(){return he.getInstance().getItemById(e)})}static createItem(e){return O(this,null,function*(){return he.getInstance().createItem(e)})}static updateItem(e,t){return O(this,null,function*(){return he.getInstance().updateItem(e,t)})}static deleteItem(e){return O(this,null,function*(){return he.getInstance().deleteItem(e)})}static getAllItems(){return O(this,null,function*(){return he.getInstance().getAllItems()})}static fetchAllInventoryData(){return O(this,null,function*(){return he.getInstance().fetchAllInventoryData()})}};za.instance=null;let nr=za;const ef=nr.getInstance(),vg=Object.freeze(Object.defineProperty({__proto__:null,InventoryCategoryService:La,InventoryFilterService:Ma,InventoryServiceFacade:nr,InventoryServiceFacadeImpl:nr,InventoryStatusService:ja,inventoryServiceFacade:ef},Symbol.toStringTag,{value:"Module"}));var Rt=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class tf{static importItems(e){return Rt(this,arguments,function*(t,r={format:"csv",hasHeaders:!0}){try{const n=yield this.readFileContent(t),s=yield this.parseContent(n,r),o=yield this.validateItems(s),c=yield this.processImport(o.validItems,r);return{success:c.success,importedCount:c.importedCount,failedCount:o.invalidItems.length,skippedCount:c.skippedCount,errors:[...o.errors,...c.errors],warnings:o.warnings,fileName:t.name}}catch(n){return console.error("Import failed:",n),{success:!1,importedCount:0,failedCount:0,skippedCount:0,errors:[`Import failed: ${n instanceof Error?n.message:"Unknown error"}`],warnings:[],fileName:t.name}}})}static readFileContent(e){return Rt(this,null,function*(){return new Promise((t,r)=>{const n=new FileReader;n.onload=s=>{var o;return t((o=s.target)==null?void 0:o.result)},n.onerror=()=>r(new Error("Failed to read file")),n.readAsText(e)})})}static parseContent(e,t){return Rt(this,null,function*(){switch(t.format){case"csv":return this.parseCSV(e,t);case"json":return this.parseJSON(e);default:throw new Error(`Unsupported import format: ${t.format}`)}})}static parseCSV(e,t){const r=e.split(`
`).filter(o=>o.trim()),n=[];let s=0;t.hasHeaders&&(s=1);for(let o=s;o<r.length;o++){const c=r[o],a=this.parseCSVLine(c);if(a.length>0){const l=this.createItemFromCSVValues(a,t);l&&n.push(l)}}return n}static parseCSVLine(e){const t=[];let r="",n=!1;for(let s=0;s<e.length;s++){const o=e[s];o==='"'?n&&e[s+1]==='"'?(r+='"',s++):n=!n:o===","&&!n?(t.push(r.trim()),r=""):r+=o}return t.push(r.trim()),t}static createItemFromCSVValues(e,t){if(e.length<3)return null;const r=["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"],n=t.customFieldMapping?Object.values(t.customFieldMapping):r,s={};for(let o=0;o<Math.min(n.length,e.length);o++){const c=n[o],a=e[o];a&&a.trim()&&(s[c]=this.parseFieldValue(a,c))}return s}static parseJSON(e){try{const t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch(t){throw console.error(t),new Error("Invalid JSON format")}}static parseFieldValue(e,t){if(t==="quantity"||t==="cost"){const r=parseFloat(e);return isNaN(r)?0:r}if(t==="purchaseDate"||t==="lastUpdated"){const r=new Date(e);return isNaN(r.getTime())?null:r}return e}static validateItems(e){return Rt(this,null,function*(){var t,r,n;const s=[],o=[],c=[],a=[];for(const l of e){const u=[];if((t=l.item)!=null&&t.trim()||u.push("Item name is required"),(r=l.category)!=null&&r.trim()||u.push("Category is required"),(n=l.location)!=null&&n.trim()||u.push("Location is required"),l.quantity!==void 0&&(isNaN(Number(l.quantity))||Number(l.quantity)<0)&&u.push("Quantity must be a positive number"),l.unit_cost!==void 0&&(isNaN(Number(l.unit_cost))||Number(l.unit_cost)<0)&&u.push("Cost must be a positive number"),u.length>0)o.push({item:l,errors:u});else{const d={id:l.id||this.generateId(),name:l.item,item:l.item,category:l.category,location:l.location,status:l.status||"active",quantity:l.quantity||1,unit_cost:l.unit_cost||0,facility_id:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:0,expiration_date:null,data:{vendor:l.vendor||"",purchaseDate:l.data&&typeof l.data=="object"&&l.data!==null&&"purchaseDate"in l.data&&typeof l.data.purchaseDate=="string"?l.data.purchaseDate:new Date().toISOString(),warranty:l.data&&typeof l.data=="object"&&l.data!==null&&"warranty"in l.data&&typeof l.data.warranty=="string"?l.data.warranty:"",maintenanceSchedule:l.maintenanceSchedule||"",lastServiced:l.data&&typeof l.data=="object"&&l.data!==null&&"lastServiced"in l.data&&typeof l.data.lastServiced=="string"?l.data.lastServiced:void 0,nextDue:l.nextDue||void 0,serviceProvider:l.data&&typeof l.data=="object"&&l.data!==null&&"serviceProvider"in l.data&&typeof l.data.serviceProvider=="string"?l.data.serviceProvider:"",assignedTo:l.data&&typeof l.data=="object"&&l.data!==null&&"assignedTo"in l.data&&typeof l.data.assignedTo=="string"?l.data.assignedTo:"",notes:l.data&&typeof l.data=="object"&&l.data!==null&&"notes"in l.data&&typeof l.data.notes=="string"?l.data.notes:""}};s.push(d)}}return{isValid:o.length===0,errors:c,warnings:a,validItems:s,invalidItems:o}})}static processImport(e,t){return Rt(this,null,function*(){var r,n,s,o,c,a,l;const u=[];let d=0,f=0;for(const h of e)try{if(t.duplicateHandling&&t.duplicateHandling!=="create"){const m=yield this.checkForDuplicate(h);if(m){if(t.duplicateHandling==="skip"){f++;continue}else if(t.duplicateHandling==="update"){yield nr.updateItem(m.id,{item:h.item,category:h.category,location:h.location,status:h.status,quantity:h.quantity,unit_cost:h.unit_cost,vendor:h.vendor,purchaseDate:(r=h.data)==null?void 0:r.purchaseDate,warranty:(n=h.data)==null?void 0:n.warranty,maintenanceSchedule:h.maintenanceSchedule,lastServiced:(s=h.data)==null?void 0:s.lastServiced,nextDue:(o=h.data)==null?void 0:o.nextDue,serviceProvider:(c=h.data)==null?void 0:c.serviceProvider,assignedTo:(a=h.data)==null?void 0:a.assignedTo,notes:(l=h.data)==null?void 0:l.notes,lastUpdated:new Date().toISOString()}),d++;continue}}}yield nr.createItem({name:h.item||"",category:h.category,location:h.location,status:h.status,quantity:h.quantity,unit_cost:h.unit_cost,facility_id:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:0,expiration_date:null,data:{vendor:h.vendor,purchaseDate:h.data&&typeof h.data=="object"&&h.data!==null&&"purchaseDate"in h.data&&typeof h.data.purchaseDate=="string"?h.data.purchaseDate:"",warranty:h.data&&typeof h.data=="object"&&h.data!==null&&"warranty"in h.data&&typeof h.data.warranty=="string"?h.data.warranty:"",maintenanceSchedule:h.maintenanceSchedule,lastServiced:h.data&&typeof h.data=="object"&&h.data!==null&&"lastServiced"in h.data&&typeof h.data.lastServiced=="string"?h.data.lastServiced:"",nextDue:h.data&&typeof h.data=="object"&&h.data!==null&&"nextDue"in h.data&&typeof h.data.nextDue=="string"?h.data.nextDue:"",serviceProvider:h.data&&typeof h.data=="object"&&h.data!==null&&"serviceProvider"in h.data&&typeof h.data.serviceProvider=="string"?h.data.serviceProvider:"",assignedTo:h.data&&typeof h.data=="object"&&h.data!==null&&"assignedTo"in h.data&&typeof h.data.assignedTo=="string"?h.data.assignedTo:"",notes:h.data&&typeof h.data=="object"&&h.data!==null&&"notes"in h.data&&typeof h.data.notes=="string"?h.data.notes:""}}),d++}catch(m){u.push(`Failed to import ${h.item}: ${m instanceof Error?m.message:"Unknown error"}`)}return{success:u.length===0,importedCount:d,skippedCount:f,errors:u}})}static checkForDuplicate(e){return Rt(this,null,function*(){try{return(yield nr.getAllItems()).find(n=>{var s,o,c,a;return((s=n.item)==null?void 0:s.toLowerCase())===((o=e.item)==null?void 0:o.toLowerCase())&&((c=n.category)==null?void 0:c.toLowerCase())===((a=e.category)==null?void 0:a.toLowerCase())})||null}catch(t){return console.error("Error checking for duplicates:",t),null}})}static generateId(){return`import-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static validateImportOptions(e){const t=[];return(!e.format||!["csv","json"].includes(e.format))&&t.push("Invalid import format. Must be csv or json."),e.duplicateHandling&&!["skip","update","create"].includes(e.duplicateHandling)&&t.push("Invalid duplicate handling option. Must be skip, update, or create."),{isValid:t.length===0,errors:t}}}class re{static initializeMetrics(e,t){const r={startTime:Date.now(),totalItems:t.totalItems,processedItems:0,failedItems:0,averageProcessingTime:0,peakMemoryUsage:0,averageMemoryUsage:0,processingRate:0,cacheHitRate:0,concurrentWorkers:t.maxConcurrentWorkers};return this.performanceMetrics.set(e,r),r}static updateMetrics(e,t){const r=this.performanceMetrics.get(e);r&&(Object.assign(r,t),this.performanceMetrics.set(e,r))}static finalizeMetrics(e){const t=this.performanceMetrics.get(e);return t&&(t.endTime=Date.now(),t.averageProcessingTime=t.processedItems>0?(t.endTime-t.startTime)/t.processedItems:0,t.peakMemoryUsage=Math.max(...this.memoryUsageHistory),t.averageMemoryUsage=this.memoryUsageHistory.length>0?this.memoryUsageHistory.reduce((r,n)=>r+n,0)/this.memoryUsageHistory.length:0,t.processingRate=this.calculateProcessingRate(t.startTime,t.processedItems),t.cacheHitRate=this.calculateCacheHitRate(),this.performanceMetrics.set(e,t)),t}static getPerformanceMetrics(e){return this.performanceMetrics.get(e)}static getAllPerformanceMetrics(){return Array.from(this.performanceMetrics.values())}static clearPerformanceMetrics(){this.performanceMetrics.clear()}static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory,t=(e==null?void 0:e.usedJSHeapSize)||0;return this.memoryUsageHistory.push(t),t}return 0}static calculateProcessingRate(e,t){if(t===0)return 0;const r=(Date.now()-e)/1e3;return Math.round(t/r)}static calculateCacheHitRate(){return 0}static calculateEstimatedTime(e,t,r){if(t===0)return;const n=Date.now()-e,s=t/n,o=r-t;return Math.round(o/s)}static clearMemoryHistory(){this.memoryUsageHistory=[]}static generateOperationId(){return`bulk-op-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}re.performanceMetrics=new Map;re.memoryUsageHistory=[];class rr{static initializeCache(e=this.DEFAULT_CACHE_SIZE){this.operationCache.clear();const t=this.operationCache.set.bind(this.operationCache);this.operationCache.set=(r,n)=>{if(this.operationCache.size>=e){const s=this.operationCache.keys().next().value;s&&this.operationCache.delete(s)}return t(r,n)}}static getCachedResult(e){return this.operationCache.get(e)}static hasCachedResult(e){return this.operationCache.has(e)}static cacheResult(e,t){this.operationCache.set(e,t)}static getCacheStats(){return{size:this.operationCache.size,hitRate:this.calculateCacheHitRate()}}static clearCache(){this.operationCache.clear()}static calculateCacheHitRate(){return 0}}rr.operationCache=new Map;rr.DEFAULT_CACHE_SIZE=1e3;var An=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class en{static createWorkerPool(e=this.DEFAULT_MAX_WORKERS){return Array.from({length:e},()=>()=>An(this,null,function*(){return Promise.resolve()}))}static cleanupWorkerPool(e){e.length=0}static processBatchConcurrent(e,t,r,n,s){return An(this,null,function*(){const o=e.map(l=>An(null,null,function*(){var u,d;try{const f=yield t(l);return(u=s.onSuccess)==null||u.call(s,f,l),f}catch(f){const h=f instanceof Error?f.message:"Unknown error";throw(d=s.onError)==null||d.call(s,h,l),f}})),c=Math.min(r.length,o.length),a=this.chunkArray(o,c);for(const l of a)yield Promise.allSettled(l)})}static chunkArray(e,t){const r=[];for(let n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}}en.DEFAULT_MAX_WORKERS=4;var rf=Object.defineProperty,nf=Object.defineProperties,sf=Object.getOwnPropertyDescriptors,Ms=Object.getOwnPropertySymbols,af=Object.prototype.hasOwnProperty,of=Object.prototype.propertyIsEnumerable,js=(i,e,t)=>e in i?rf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,cf=(i,e)=>{for(var t in e||(e={}))af.call(e,t)&&js(i,t,e[t]);if(Ms)for(var t of Ms(e))of.call(e,t)&&js(i,t,e[t]);return i},lf=(i,e)=>nf(i,sf(e));class ct{static createProgress(e,t,r,n,s,o,c,a){const l=re.getMemoryUsage(),u=re.calculateProcessingRate(c,t),d=re.calculateEstimatedTime(c,t,e);return{total:e,completed:t,failed:r,inProgress:n,percentage:Math.round(t/e*100),currentBatch:s,totalBatches:o,estimatedTimeRemaining:d,errors:[],memoryUsage:l,processingRate:u,concurrentWorkers:a}}static updateProgressWithErrors(e,t){return lf(cf({},e),{errors:t.slice(-10)})}static notifyProgress(e,t){e==null||e(t)}static notifyError(e,t,r){e==null||e(t,r)}static notifySuccess(e,t,r){e==null||e(t,r)}static notifyMemoryWarning(e,t,r){e==null||e(t,r)}static isMemoryUsageHigh(e,t,r=.8){return e>t*r}}var uf=Object.defineProperty,df=Object.defineProperties,hf=Object.getOwnPropertyDescriptors,Us=Object.getOwnPropertySymbols,ff=Object.prototype.hasOwnProperty,pf=Object.prototype.propertyIsEnumerable,Ns=(i,e,t)=>e in i?uf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Nt=(i,e)=>{for(var t in e||(e={}))ff.call(e,t)&&Ns(i,t,e[t]);if(Us)for(var t of Us(e))pf.call(e,t)&&Ns(i,t,e[t]);return i},Ft=(i,e)=>df(i,hf(e));const zt={QUICK:{maxRetries:1,baseDelay:100,maxDelay:200,backoffStrategy:"fixed"},STANDARD:{maxRetries:3,baseDelay:100,maxDelay:1e3,backoffStrategy:"linear"},NETWORK:{maxRetries:5,baseDelay:200,maxDelay:2e3,backoffStrategy:"exponential"},CRITICAL:{maxRetries:5,baseDelay:500,maxDelay:5e3,backoffStrategy:"exponential"},BACKGROUND:{maxRetries:2,baseDelay:1e3,maxDelay:5e3,backoffStrategy:"linear"}},Ye={NETWORK_ONLY:i=>{const e=i.message.toLowerCase();return e.includes("network")||e.includes("timeout")||e.includes("fetch")||e.includes("connection")},TEMPORARY_ONLY:i=>{const e=i.message.toLowerCase();return e.includes("rate limit")||e.includes("temporary")||e.includes("busy")||e.includes("unavailable")},NETWORK_AND_TEMPORARY:i=>Ye.NETWORK_ONLY(i)||Ye.TEMPORARY_ONLY(i),ALL:()=>!0,NONE:()=>!1},gr={UI_OPERATION:Ft(Nt({},zt.QUICK),{retryCondition:Ye.NETWORK_ONLY}),DATA_FETCH:Ft(Nt({},zt.STANDARD),{retryCondition:Ye.NETWORK_AND_TEMPORARY}),API_CALL:Ft(Nt({},zt.NETWORK),{retryCondition:Ye.NETWORK_AND_TEMPORARY}),AUTH:Ft(Nt({},zt.CRITICAL),{retryCondition:Ye.NETWORK_AND_TEMPORARY}),BACKGROUND_TASK:Ft(Nt({},zt.BACKGROUND),{retryCondition:Ye.ALL})};Ft(Nt({},zt.BACKGROUND),{retryCondition:Ye.NETWORK_AND_TEMPORARY,syncInterval:3e4,maxConcurrentSyncs:3});var gf=Object.defineProperty,Fs=Object.getOwnPropertySymbols,mf=Object.prototype.hasOwnProperty,yf=Object.prototype.propertyIsEnumerable,zs=(i,e,t)=>e in i?gf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qs=(i,e)=>{for(var t in e||(e={}))mf.call(e,t)&&zs(i,t,e[t]);if(Fs)for(var t of Fs(e))yf.call(e,t)&&zs(i,t,e[t]);return i},Lt=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Ze{static executeWithRetry(e){return Lt(this,arguments,function*(t,r={}){const n=performance.now(),s=qs(qs({},this.DEFAULT_CONFIG),r);let o,c=0;for(let l=0;l<=s.maxRetries;l++){c=l+1;try{const u=yield t(),d=performance.now()-n;return an.recordResponseTime("retry_operation_success",d,{service:"OptimizedRetryService",operation:"executeWithRetry",attempts:c.toString(),strategy:s.backoffStrategy}),{success:!0,data:u,attempts:c,totalDuration:d}}catch(u){if(o=u,l===s.maxRetries||s.retryCondition&&!s.retryCondition(o))break;const d=this.calculateDelay(l,s),f=s.jitter?d+Math.random()*100:d;console.warn(`[OptimizedRetryService] Operation failed (attempt ${c}/${s.maxRetries+1}): ${o.message}. Retrying in ${f.toFixed(0)}ms...`),yield this.sleep(f)}}const a=performance.now()-n;return an.recordErrorRate("retry_operation_failure",100,{service:"OptimizedRetryService",operation:"executeWithRetry",attempts:c.toString(),strategy:s.backoffStrategy,error:o.message}),{success:!1,error:o,attempts:c,totalDuration:a}})}static calculateDelay(e,t){let r;switch(t.backoffStrategy){case"linear":r=t.baseDelay*(e+1);break;case"exponential":r=t.baseDelay*Math.pow(2,e);break;case"fixed":r=t.baseDelay;break;default:r=t.baseDelay}return Math.min(r,t.maxDelay)}static sleep(e){return new Promise(t=>setTimeout(t,e))}static quickRetry(e){return Lt(this,null,function*(){const t=yield this.executeWithRetry(e,gr.UI_OPERATION);if(!t.success)throw t.error;return t.data})}static standardRetry(e){return Lt(this,null,function*(){const t=yield this.executeWithRetry(e,gr.DATA_FETCH);if(!t.success)throw t.error;return t.data})}static networkRetry(e){return Lt(this,null,function*(){const t=yield this.executeWithRetry(e,gr.API_CALL);if(!t.success)throw t.error;return t.data})}static authRetry(e){return Lt(this,null,function*(){const t=yield this.executeWithRetry(e,gr.AUTH);if(!t.success)throw t.error;return t.data})}static backgroundRetry(e){return Lt(this,null,function*(){const t=yield this.executeWithRetry(e,gr.BACKGROUND_TASK);if(!t.success)throw t.error;return t.data})}}Ze.DEFAULT_CONFIG={maxRetries:3,baseDelay:100,maxDelay:1e3,backoffStrategy:"linear",jitter:!0};const vf=Ze.quickRetry,_f=Ze.standardRetry,wf=Ze.networkRetry,bf=Ze.authRetry,Sf=Ze.backgroundRetry,_g=Object.freeze(Object.defineProperty({__proto__:null,OptimizedRetryService:Ze,authRetry:bf,backgroundRetry:Sf,networkRetry:wf,quickRetry:vf,standardRetry:_f},Symbol.toStringTag,{value:"Module"}));var Tn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Hs{static withRetry(e,t=3,r=100,n){return Tn(this,null,function*(){const s=yield Ze.executeWithRetry(e,{maxRetries:t,baseDelay:r,backoffStrategy:"linear",retryCondition:o=>(n==null||n(s.attempts,o),!0)});if(!s.success)throw s.error;return s.data})}static delay(e){return new Promise(t=>setTimeout(t,e))}static processItemsWithRetry(e,t){return Tn(this,arguments,function*(r,n,s={}){const{maxRetries:o=3,delay:c=1e3,enableRetry:a=!0}=s,l=[],u=[],d=[],f=r.map((h,m)=>Tn(this,null,function*(){try{let w;return a?w=yield this.withRetry(()=>n(h),o,c,(S,I)=>{console.warn(`Retrying item ${m+1} (attempt ${S}): ${I.message}`)}):w=yield n(h),l.push(w),{success:!0,result:w,item:h}}catch(w){const S=w instanceof Error?w.message:"Unknown error";return d.push(`Item ${m+1}: ${S}`),u.push(h),{success:!1,error:S,item:h}}}));return yield Promise.allSettled(f),{results:l,failed:u,errors:d}})}}class Yr{static validateConfig(e){const t=[];return e.batchSize!==void 0&&(e.batchSize<1||e.batchSize>1e3)&&t.push("Batch size must be between 1 and 1000"),e.delayBetweenBatches!==void 0&&e.delayBetweenBatches<0&&t.push("Delay between batches must be non-negative"),e.maxConcurrentWorkers!==void 0&&(e.maxConcurrentWorkers<1||e.maxConcurrentWorkers>16)&&t.push("Max concurrent workers must be between 1 and 16"),e.cacheSize!==void 0&&(e.cacheSize<1||e.cacheSize>1e4)&&t.push("Cache size must be between 1 and 10000"),e.memoryLimit!==void 0&&e.memoryLimit<1024*1024&&t.push("Memory limit must be at least 1MB"),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to process."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateOperation(e){const t=[];return(!e||typeof e!="function")&&t.push("Operation must be a function."),{isValid:t.length===0,errors:t}}}class If{static formatProgress(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches}  ${e.percentage}% complete`;let n;if(e.estimatedTimeRemaining){const o=Math.floor(e.estimatedTimeRemaining/6e4),c=Math.floor(e.estimatedTimeRemaining%6e4/1e3);n=o>0?`${o}m ${c}s remaining`:`${c}s remaining`}let s;if(e.processingRate&&e.memoryUsage){const o=Math.round(e.memoryUsage/1048576);s=`${e.processingRate} items/sec  ${o}MB RAM  ${e.concurrentWorkers} workers`}return{status:t,details:r,timeRemaining:n,performance:s}}static formatProgressSimple(e){return`${e.completed}/${e.total} (${e.percentage}%)`}static formatProgressDetailed(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches}`,n=`${e.percentage}% complete`;let s=`${t}  ${r}  ${n}`;if(e.estimatedTimeRemaining){const o=Math.floor(e.estimatedTimeRemaining/6e4),c=Math.floor(e.estimatedTimeRemaining%6e4/1e3),a=o>0?`${o}m ${c}s remaining`:`${c}s remaining`;s+=`  ${a}`}return e.processingRate&&(s+=`  ${e.processingRate} items/sec`),s}}var mr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class et{static processBulkOperation(e,t){return mr(this,arguments,function*(r,n,s={}){const{batchSize:o=this.DEFAULT_BATCH_SIZE,delayBetweenBatches:c=this.DEFAULT_DELAY,maxConcurrentWorkers:a=this.DEFAULT_MAX_WORKERS,enableCaching:l=!0,cacheSize:u=this.DEFAULT_CACHE_SIZE,memoryLimit:d=this.DEFAULT_MEMORY_LIMIT,onProgress:f,onError:h,onSuccess:m,onMemoryWarning:w}=s,S=Yr.validateItems(r);if(!S.isValid)throw new Error(S.errors.join(", "));const I=Yr.validateConfig(s);if(!I.isValid)throw new Error(I.errors.join(", "));const b=Yr.validateOperation(n);if(!b.isValid)throw new Error(b.errors.join(", "));const v=re.generateOperationId(),_=re.initializeMetrics(v,{totalItems:r.length,maxConcurrentWorkers:a});l&&rr.initializeCache(u);const E=[],k=[],A=[],N=Math.ceil(r.length/o),D=Date.now(),Ce=en.createWorkerPool(a);try{for(let se=0;se<N;se++){const Ne=re.getMemoryUsage();ct.isMemoryUsageHigh(Ne,d,this.MEMORY_WARNING_THRESHOLD)&&ct.notifyMemoryWarning(w,Ne,d);const q=se*o,$e=Math.min(q+o,r.length),yt=r.slice(q,$e);yield en.processBatchConcurrent(yt,n,Ce,l,{onError:(ar,or)=>{A.push(`Item ${yt.indexOf(or)+1}: ${ar}`),k.push(or),re.updateMetrics(v,{failedItems:_.failedItems+1}),ct.notifyError(h,ar,or.id||"unknown")},onSuccess:(ar,or)=>{E.push(ar),re.updateMetrics(v,{processedItems:_.processedItems+1}),ct.notifySuccess(m,ar,or.id||"unknown")}});const tt=E.length,le=k.length,vt=yt.length,to=r.length,ro=ct.createProgress(to,tt,le,vt,se+1,N,D,a),no=ct.updateProgressWithErrors(ro,A);ct.notifyProgress(f,no),se<N-1&&c>0&&(yield Hs.delay(c))}return re.finalizeMetrics(v),{results:E,failed:k,errors:A,metrics:re.getPerformanceMetrics(v)}}finally{en.cleanupWorkerPool(Ce),rr.clearCache(),re.clearMemoryHistory()}})}static simpleBulkOperation(e,t){return mr(this,null,function*(){const r=[],n=[],s=[],o=e.map((c,a)=>mr(null,null,function*(){try{const l=yield t(c);return r.push(l),{success:!0,result:l,item:c}}catch(l){const u=l instanceof Error?l.message:"Unknown error";return s.push(`Item ${a+1}: ${u}`),n.push(c),{success:!1,error:u,item:c}}}));return yield Promise.allSettled(o),{results:r,failed:n,errors:s}})}static simpleBulkOperationWithRetry(e,t,r){return mr(this,null,function*(){return Hs.processItemsWithRetry(e,t,r)})}static standardBulkOperation(e,t,r){return mr(this,null,function*(){const n=[],s=[],o=[];for(let c=0;c<e.length;c++){try{const a=yield t(e[c]);n.push(a)}catch(a){const l=a instanceof Error?a.message:"Unknown error";o.push(`Item ${c+1}: ${l}`),s.push(e[c])}r==null||r(c+1,e.length)}return{results:n,failed:s,errors:o}})}static validateConfig(e){return Yr.validateConfig(e)}static formatProgress(e){return If.formatProgress(e)}static getPerformanceMetrics(e){return re.getPerformanceMetrics(e)}static getAllPerformanceMetrics(){return re.getAllPerformanceMetrics()}static clearPerformanceMetrics(){re.clearPerformanceMetrics()}static getCacheStats(){return rr.getCacheStats()}static clearCache(){rr.clearCache()}static getDefaultBatchSize(){return this.DEFAULT_BATCH_SIZE}static getDefaultDelay(){return this.DEFAULT_DELAY}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}static getDefaultCacheSize(){return this.DEFAULT_CACHE_SIZE}static getDefaultMemoryLimit(){return this.DEFAULT_MEMORY_LIMIT}}et.DEFAULT_BATCH_SIZE=50;et.DEFAULT_DELAY=100;et.DEFAULT_MAX_WORKERS=4;et.DEFAULT_CACHE_SIZE=1e3;et.DEFAULT_MEMORY_LIMIT=100*1024*1024;et.MEMORY_WARNING_THRESHOLD=.8;var Ef=Object.defineProperty,kf=Object.defineProperties,Cf=Object.getOwnPropertyDescriptors,Bs=Object.getOwnPropertySymbols,Af=Object.prototype.hasOwnProperty,Tf=Object.prototype.propertyIsEnumerable,Vs=(i,e,t)=>e in i?Ef(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qa=(i,e)=>{for(var t in e||(e={}))Af.call(e,t)&&Vs(i,t,e[t]);if(Bs)for(var t of Bs(e))Tf.call(e,t)&&Vs(i,t,e[t]);return i},Ha=(i,e)=>kf(i,Cf(e)),pe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const mt=(i,e)=>{console.log(`Analytics Event: ${i}`,e)};function Pf(i,e,t){return pe(this,null,function*(){try{const r=Da(i);if(!r.isValid)throw new Error(r.errors.join(", "));const n=yield tu(i);e(n)}catch(r){t(r instanceof Error?r.message:"Failed to create item")}})}function Of(i,e,t,r){return pe(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const n=Da(e);if(!n.isValid)throw new Error(n.errors.join(", "));const s=yield Hn(i,e);t(s)}catch(n){r(n instanceof Error?n.message:"Failed to update item")}})}function xf(i,e,t){return pe(this,null,function*(){try{if(!i)throw new Error("Item ID is required");yield Bn(i),M("inventory","item_deleted",`Inventory item deleted: ${i}`,"info",{itemId:i,deletionMethod:"single_item"}),U("delete_item","inventory",{itemId:i,deletionMethod:"single_item"}),mt("inventory_item_deleted",{itemId:i,deletionMethod:"single_item"}),e()}catch(r){t(r instanceof Error?r.message:"Failed to delete item")}})}function Df(i,e,t,r,n){return pe(this,null,function*(){try{if(!e||e.length===0)throw new Error("No items selected for bulk operation");let s;switch(i){case"delete":s=yield jf(e,t==null?void 0:t.progressConfig);break;case"update":if(!(t!=null&&t.updateData))throw new Error("Update data is required for bulk update operation");s=yield Uf(e,t.updateData,t.progressConfig);break;case"export":if(!(t!=null&&t.exportOptions))throw new Error("Export options are required for bulk export operation");s=yield Nf(e,t.exportOptions);break;default:throw new Error(`Unsupported bulk operation: ${i}`)}return r==null||r(s),s}catch(s){const o=s instanceof Error?s.message:"Bulk operation failed";throw n==null||n(o),new Error(o)}})}function $f(i,e,t,r){return pe(this,null,function*(){try{if(!i)throw new Error("No file selected for import");const n=e||{validateData:!0,skipDuplicates:!0,createMissingCategories:!0},s=Ff(n);if(!s.isValid)throw new Error(`Invalid import options: ${s.errors.join(", ")}`);const o=yield tf.importItems(i,n);return M("inventory","bulk_import_completed",`Bulk import completed: ${o.importedCount} items imported`,"info",{fileName:o.fileName,importedCount:o.importedCount,failedCount:o.failedCount,skippedCount:o.skippedCount,errors:o.errors.length,warnings:o.warnings.length}),t==null||t(o),o}catch(n){console.error("Bulk import failed:",n);const s=n instanceof Error?n.message:"Bulk import failed";throw r==null||r(s),new Error(s)}})}function Rf(i,e,t){return pe(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const r=yield nu(i);M("inventory","item_duplicated",`Inventory item duplicated: ${i}`,"info",{originalItemId:i,duplicatedItemId:r.id}),U("duplicate_item","inventory",{originalItemId:i,duplicatedItemId:r.id}),mt("inventory_item_duplicated",{originalItemId:i,duplicatedItemId:r.id}),e(r)}catch(r){t(r instanceof Error?r.message:"Failed to duplicate item")}})}function Lf(i,e,t){return pe(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const r=yield ru(i);M("inventory","item_archived",`Inventory item archived: ${i}`,"info",{itemId:i,archiveMethod:"single_item"}),U("archive_item","inventory",{itemId:i,archiveMethod:"single_item"}),mt("inventory_item_archived",{itemId:i,archiveMethod:"single_item"}),e(r)}catch(r){t(r instanceof Error?r.message:"Failed to archive item")}})}function Mf(i,e){return pe(this,null,function*(){try{const t=yield iu(i,e);return M("inventory","bulk_update_by_category_completed",`Bulk update by category completed: ${t.updatedCount} items updated`,"info",{category:i,updatedCount:t.updatedCount}),U("bulk_update_by_category","inventory",{category:i,updatedCount:t.updatedCount}),mt("inventory_bulk_update_by_category_completed",{category:i,updatedCount:t.updatedCount}),t}catch(t){throw console.error("Error in bulk update by category:",t),new Error("Failed to bulk update items by category")}})}function jf(i,e){return pe(this,null,function*(){try{if(e){const{results:t,failed:r,errors:n,metrics:s}=yield et.processBulkOperation(i,o=>pe(null,null,function*(){return yield Bn(o)}),Ha(qa({},e),{enableCaching:!0,maxConcurrentWorkers:4,memoryLimit:104857600,onMemoryWarning:(o,c)=>{console.warn(`Memory usage high: ${Math.round(o/1048576)}MB / ${Math.round(c/1048576)}MB`)}}));return console.log("Bulk deletion completed with performance metrics:",{total:i.length,successful:t.length,failed:r.length,errors:n.length,processingTime:s.averageProcessingTime,memoryUsage:s.peakMemoryUsage,processingRate:s.processingRate}),{deletedCount:t.length}}else{const r=(yield Promise.allSettled(i.map(n=>Bn(n)))).filter(n=>n.status==="fulfilled").length;return M("inventory","bulk_deletion_completed",`Bulk deletion completed: ${r}/${i.length} items`,"info",{totalItems:i.length,deletedCount:r,failedCount:i.length-r,deletionMethod:"bulk_operation"}),U("bulk_delete_items","inventory",{totalItems:i.length,deletedCount:r,failedCount:i.length-r}),mt("inventory_bulk_deletion_completed",{totalItems:i.length,deletedCount:r,failedCount:i.length-r,deletionMethod:"bulk_operation"}),{deletedCount:r}}}catch(t){throw console.error("Error in bulk deletion:",t),new Error("Bulk deletion failed")}})}function Uf(i,e,t){return pe(this,null,function*(){try{if(t){const{results:r,failed:n,errors:s,metrics:o}=yield et.processBulkOperation(i,c=>pe(null,null,function*(){return yield Hn(c,sn(e))}),Ha(qa({},t),{enableCaching:!0,maxConcurrentWorkers:4,memoryLimit:104857600,onMemoryWarning:(c,a)=>{console.warn(`Memory usage high: ${Math.round(c/1048576)}MB / ${Math.round(a/1048576)}MB`)}}));return console.log("Bulk update completed with performance metrics:",{total:i.length,successful:r.length,failed:n.length,errors:s.length,processingTime:o.averageProcessingTime,memoryUsage:o.peakMemoryUsage,processingRate:o.processingRate}),{updatedCount:r.length}}else{const n=(yield Promise.allSettled(i.map(s=>Hn(s,sn(e))))).filter(s=>s.status==="fulfilled").length;return M("inventory","bulk_update_completed",`Bulk update completed: ${n}/${i.length} items`,"info",{totalItems:i.length,updatedCount:n,failedCount:i.length-n,updateMethod:"bulk_operation"}),U("bulk_update_items","inventory",{totalItems:i.length,updatedCount:n,failedCount:i.length-n}),mt("inventory_bulk_update_completed",{totalItems:i.length,updatedCount:n,failedCount:i.length-n,updateMethod:"bulk_operation"}),{updatedCount:n}}}catch(r){throw console.error("Error in bulk update:",r),new Error("Bulk update failed")}})}function Nf(i,e){return pe(this,null,function*(){try{const t=yield Ra.exportItems(i,e);return M("inventory","bulk_export_completed",`Bulk export completed: ${i.length} items exported`,"info",{totalItems:i.length,exportFormat:e.format,exportMethod:"bulk_operation"}),U("bulk_export_items","inventory",{totalItems:i.length,exportFormat:e.format}),mt("inventory_bulk_export_completed",{totalItems:i.length,exportFormat:e.format,exportMethod:"bulk_operation"}),console.log("Bulk export completed with performance metrics:",{totalItems:i.length,exportFormat:e.format,exportMethod:"bulk_operation"}),{exportedCount:i.length}}catch(t){throw console.error("Error in bulk export:",t),new Error("Bulk export failed")}})}function Ff(i){const e=[];return typeof i.validateData!="boolean"&&e.push("validateData must be a boolean"),typeof i.skipDuplicates!="boolean"&&e.push("skipDuplicates must be a boolean"),typeof i.createMissingCategories!="boolean"&&e.push("createMissingCategories must be a boolean"),{isValid:e.length===0,errors:e}}var B=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ti{static handleCreateItem(e,t,r){return B(this,null,function*(){return Pf(e,t,r)})}static handleUpdateItem(e,t,r,n){return B(this,null,function*(){return Of(e,t,r,n)})}static handleDeleteItem(e,t,r){return B(this,null,function*(){return xf(e,t,r)})}static handleBulkOperation(e,t,r,n,s){return B(this,null,function*(){return Df(e,t,r,n,s)})}static handleBulkImport(e,t,r,n){return B(this,null,function*(){return $f(e,t,r,n)})}static handleDuplicateItem(e,t,r){return B(this,null,function*(){return Rf(e,t,r)})}static handleArchiveItem(e,t,r){return B(this,null,function*(){return Lf(e,t,r)})}static getItems(e){return B(this,null,function*(){return Wl(e)})}static getItemById(e){return B(this,null,function*(){return Ql(e)})}static getItemsByCategory(e){return B(this,null,function*(){return $a(e)})}static getItemsByLocation(e){return B(this,null,function*(){return Yl(e)})}static getItemsByStatus(e){return B(this,null,function*(){return Jl(e)})}static searchItems(e){return B(this,null,function*(){return Xl(e)})}static getLowStockItems(){return B(this,null,function*(){return Zl()})}static getExpiringItems(e=30){return B(this,null,function*(){return eu(e)})}static bulkUpdateItemsByCategory(e,t){return B(this,null,function*(){return Mf(e,t)})}static getSuppliersByFacility(e){return B(this,null,function*(){return yield su(e)})}static getInventoryTransactionsByFacility(e){return B(this,null,function*(){return yield au(e)})}static getInventoryCostsByFacility(e){return B(this,null,function*(){return yield ou(e)})}static getEquipmentMaintenanceByFacility(e){return B(this,null,function*(){return yield cu(e)})}}var zf=Object.defineProperty,qf=Object.defineProperties,Hf=Object.getOwnPropertyDescriptors,Gs=Object.getOwnPropertySymbols,Bf=Object.prototype.hasOwnProperty,Vf=Object.prototype.propertyIsEnumerable,Ks=(i,e,t)=>e in i?zf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ws=(i,e)=>{for(var t in e||(e={}))Bf.call(e,t)&&Ks(i,t,e[t]);if(Gs)for(var t of Gs(e))Vf.call(e,t)&&Ks(i,t,e[t]);return i},Qs=(i,e)=>qf(i,Hf(e)),Gf=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Cr=oo((i,e)=>{var t,r,n,s,o,c,a,l,u,d,f;const h=(r=(t=localStorage.getItem("authToken"))!=null?t:sessionStorage.getItem("authToken"))!=null?r:null,m=(s=(n=localStorage.getItem("tokenExpiry"))!=null?n:sessionStorage.getItem("tokenExpiry"))!=null?s:null,w=(c=(o=localStorage.getItem("csrfToken"))!=null?o:sessionStorage.getItem("csrfToken"))!=null?c:null,S=parseInt((l=(a=localStorage.getItem("failedAttempts"))!=null?a:sessionStorage.getItem("failedAttempts"))!=null?l:"0"),I=parseInt((d=(u=localStorage.getItem("lastLoginAttempt"))!=null?u:sessionStorage.getItem("lastLoginAttempt"))!=null?d:"0"),b=(_,E,k=!1)=>{setTimeout(()=>{try{(k?localStorage:sessionStorage).setItem(_,E)}catch(A){console.warn(`Failed to save ${_} to ${k?"localStorage":"sessionStorage"}:`,A)}},0)},v=()=>{const _=new Uint8Array(32);return crypto.getRandomValues(_),btoa(String.fromCharCode.apply(null,Array.from(_))).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)};return{formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,otp:"",stage:"credentials"},errors:{},loading:!1,sessionExpiry:(f=localStorage.getItem("sessionExpiry"))!=null?f:null,authToken:h,tokenExpiry:m,csrfToken:w||v(),lastLoginAttempt:I||null,failedAttempts:S,isSecureMode:!0,setField:(_,E)=>i(k=>({formData:Qs(Ws({},k.formData),{[_]:E})})),setErrors:_=>i({errors:_}),setLoading:_=>i({loading:_}),setStage:_=>i(E=>({formData:Qs(Ws({},E.formData),{stage:_})})),setSessionExpiry:_=>{b("sessionExpiry",_),i({sessionExpiry:_})},setAuthToken:(_,E,k=!1)=>{b("authToken",_,k),b("tokenExpiry",E,k),i({authToken:_,tokenExpiry:E}),e().resetFailedAttempts()},reset:()=>Gf(null,null,function*(){localStorage.removeItem("authToken"),localStorage.removeItem("tokenExpiry"),localStorage.removeItem("sessionExpiry"),localStorage.removeItem("csrfToken"),localStorage.removeItem("failedAttempts"),localStorage.removeItem("lastLoginAttempt"),localStorage.removeItem("currentUser"),localStorage.removeItem("userProfile"),localStorage.removeItem("userData"),localStorage.removeItem("user_preferences"),localStorage.removeItem("sb-user"),localStorage.removeItem("user_data"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("tokenExpiry"),sessionStorage.removeItem("sessionExpiry"),sessionStorage.removeItem("csrfToken"),sessionStorage.removeItem("failedAttempts"),sessionStorage.removeItem("lastLoginAttempt"),sessionStorage.removeItem("currentUser"),sessionStorage.removeItem("userProfile"),sessionStorage.removeItem("userData"),sessionStorage.removeItem("user_preferences"),sessionStorage.removeItem("user_id"),sessionStorage.removeItem("user_email"),sessionStorage.removeItem("user_role");try{const{supabase:_}=yield z(()=>Promise.resolve().then(()=>pl),void 0);yield _.auth.signOut()}catch(_){console.error("Failed to clear Supabase session:",_)}i({formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,otp:"",stage:"credentials"},errors:{},loading:!1,sessionExpiry:null,authToken:null,tokenExpiry:null,csrfToken:v(),lastLoginAttempt:null,failedAttempts:0,isSecureMode:!0})}),setCSRFToken:_=>{b("csrfToken",_),i({csrfToken:_})},incrementFailedAttempts:()=>{const _=e().failedAttempts+1,E=Date.now();b("failedAttempts",_.toString()),b("lastLoginAttempt",E.toString()),i({failedAttempts:_,lastLoginAttempt:E})},resetFailedAttempts:()=>{localStorage.removeItem("failedAttempts"),localStorage.removeItem("lastLoginAttempt"),i({failedAttempts:0,lastLoginAttempt:null})},setSecureMode:_=>{i({isSecureMode:_})},isTokenExpired:()=>{const{tokenExpiry:_}=e();return _?new Date(_)<=new Date:!0},getRemainingSessionTime:()=>{const{tokenExpiry:_}=e();if(!_)return 0;const E=new Date(_),k=new Date;return Math.max(0,E.getTime()-k.getTime())}}}),wg=Object.freeze(Object.defineProperty({__proto__:null,useLoginStore:Cr},Symbol.toStringTag,{value:"Module"})),Jr={rememberMe:"Remember me",rememberDevice:"Remember device"},_e={PROGRESS_STEPS:{IDLE:"idle",CONNECTING:"connecting",AUTHENTICATING:"authenticating",VERIFYING:"verifying",SUCCESS:"success"},REDIRECT_DELAY_MS:1e3,MIN_PASSWORD_LENGTH:6,OTP_LENGTH:6},Ba={unexpectedError:"An unexpected error occurred. Please try again.",offline:"You are currently offline. Please check your internet connection."};var Mt=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Va=class br{constructor(){this.STORAGE_KEY="cliniio_trusted_devices",this.DEVICE_NAME_KEY="cliniio_device_name"}static getInstance(){return br.instance||(br.instance=new br),br.instance}generateDeviceFingerprint(){try{const e=document.createElement("canvas"),t=e.getContext("2d");t&&(t.textBaseline="top",t.font="14px Arial",t.fillText("Device fingerprint",2,2));const r=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");return btoa(r).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}catch(e){return"unknown_device"}}getDeviceName(){const e=localStorage.getItem(this.DEVICE_NAME_KEY);if(e)return e;const t=navigator.userAgent;let r="Unknown Device";return t.includes("Windows")?r="Windows Device":t.includes("Mac")?r="Mac Device":t.includes("Linux")?r="Linux Device":t.includes("Android")?r="Android Device":(t.includes("iPhone")||t.includes("iPad"))&&(r="iOS Device"),t.includes("Chrome")?r+=" (Chrome)":t.includes("Firefox")?r+=" (Firefox)":t.includes("Safari")?r+=" (Safari)":t.includes("Edge")&&(r+=" (Edge)"),localStorage.setItem(this.DEVICE_NAME_KEY,r),r}storeTrustedDevice(e,t){return Mt(this,null,function*(){try{const r=this.getDeviceName(),{error:n}=yield y.from("trusted_devices").upsert({user_id:e,device_fingerprint:t,device_name:r,last_used:new Date().toISOString(),is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});return n?(console.error("Failed to store trusted device:",n),!1):(this.storeDeviceLocally(t,r),!0)}catch(r){return console.error("Error storing trusted device:",r),!1}})}isDeviceTrusted(e){return Mt(this,null,function*(){try{const t=this.generateDeviceFingerprint(),{data:r,error:n}=yield y.from("trusted_devices").select("id, last_used, is_active").eq("user_id",e).eq("device_fingerprint",t).eq("is_active",!0).single();return n||!r?!1:(yield this.updateLastUsed(r.id),!0)}catch(t){return console.error("Error checking trusted device:",t),!1}})}getTrustedDevices(e){return Mt(this,null,function*(){try{const{data:t,error:r}=yield y.from("trusted_devices").select("*").eq("user_id",e).eq("is_active",!0).order("last_used",{ascending:!1});return r?(console.error("Failed to get trusted devices:",r),[]):t||[]}catch(t){return console.error("Error getting trusted devices:",t),[]}})}removeTrustedDevice(e){return Mt(this,null,function*(){try{const{error:t}=yield y.from("trusted_devices").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e);return t?(console.error("Failed to remove trusted device:",t),!1):!0}catch(t){return console.error("Error removing trusted device:",t),!1}})}updateLastUsed(e){return Mt(this,null,function*(){try{yield y.from("trusted_devices").update({last_used:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e)}catch(t){console.error("Error updating last used:",t)}})}storeDeviceLocally(e,t){try{const r={fingerprint:e,name:t,timestamp:new Date().toISOString()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r))}catch(r){console.error("Error storing device locally:",r)}}getLocalDeviceInfo(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e),r=new Date(Date.now()-720*60*60*1e3);return new Date(t.timestamp)<r?(localStorage.removeItem(this.STORAGE_KEY),null):t}catch(e){return console.error("Error getting local device info:",e),null}}clearAllTrustedDevices(e){return Mt(this,null,function*(){try{const{error:t}=yield y.from("trusted_devices").update({is_active:!1,updated_at:new Date().toISOString()}).eq("user_id",e);return t?(console.error("Failed to clear trusted devices:",t),!1):(localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.DEVICE_NAME_KEY),!0)}catch(t){return console.error("Error clearing trusted devices:",t),!1}})}};Va.instance=null;let Kf=Va;const Pn=Kf.getInstance();var Wf=Object.defineProperty,Qf=Object.defineProperties,Yf=Object.getOwnPropertyDescriptors,Ys=Object.getOwnPropertySymbols,Jf=Object.prototype.hasOwnProperty,Xf=Object.prototype.propertyIsEnumerable,Js=(i,e,t)=>e in i?Wf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Zf=(i,e)=>{for(var t in e||(e={}))Jf.call(e,t)&&Js(i,t,e[t]);if(Ys)for(var t of Ys(e))Xf.call(e,t)&&Js(i,t,e[t]);return i},ep=(i,e)=>Qf(i,Yf(e)),tp=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Ga=()=>{const i=ao(),{refreshUserData:e}=yl(),{formData:t,errors:r,loading:n,setField:s,setErrors:o,setLoading:c,setAuthToken:a,csrfToken:l,incrementFailedAttempts:u,resetFailedAttempts:d,isSecureMode:f}=Cr(),[h,m]=x.useState(""),w=x.useCallback(b=>v=>{const _=b==="rememberMe"||b==="rememberDevice"?v.target.checked:v.target.value;s(b,_),r[b]&&o(ep(Zf({},r),{[b]:""}))},[r,s,o]),S=(b,v,_,E,k=!1,A=!1)=>tp(null,null,function*(){var N;if(!n){if(o({}),c(!0),f&&!_()){o({submit:"Security validation failed. Please refresh the page and try again."}),c(!1);return}try{F("attempt",{email:b,timestamp:new Date().toISOString()});const D=!1;if(A)try{console.log(" Checking if device is already trusted...")}catch(Ne){console.warn("Failed to check trusted device:",Ne)}const se=yield new xa().secureLogin({email:b,password:v,rememberMe:k});if(se.success&&se.data){m(_e.PROGRESS_STEPS.VERIFYING);const Ne=new Date(Date.now()+se.data.expiresIn*1e3).toISOString();a(se.data.accessToken,Ne,k);try{yield e()}catch(q){console.warn("Failed to refresh user data:",q)}if(A)try{const q=Pn.generateDeviceFingerprint(),$e=(N=se.data.user)==null?void 0:N.id;$e&&((yield Pn.isDeviceTrusted($e))?console.log(" Device already trusted"):(yield Pn.storeTrustedDevice($e,q),console.log(" Device marked as trusted")))}catch(q){console.warn("Failed to store trusted device:",q)}F("success",{email:b,timestamp:new Date().toISOString()}),E("login_success",b),d(),m(_e.PROGRESS_STEPS.SUCCESS),setTimeout(()=>{i("/home")},_e.REDIRECT_DELAY_MS)}else throw new Error(se.error||"Authentication failed")}catch(D){console.error("Secure login error:",D),u();const Ce=D instanceof Error?D.message:Ba.unexpectedError;o({submit:Ce}),F("failure",{email:b,error:Ce,timestamp:new Date().toISOString()}),E("login_failure",b,Ce)}finally{c(!1),m("")}}}),I=x.useCallback(()=>{console.log("Forgot password clicked")},[]);return{formData:t,errors:r,loading:n,loadingStep:h,handleChange:w,handleSubmit:S,handleForgotPassword:I}},rp=()=>p.jsxs(p.Fragment,{children:[p.jsx("h1",{className:"mt-6 text-center text-3xl font-extrabold text-gray-500",children:"Welcome to Cliniio"}),p.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to your account"})]});function np(i){return L({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(i)}function ip(i){return L({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 32h214.6v214.6H0V32zm233.4 0H448v214.6H233.4V32zM0 265.4h214.6V480H0V265.4zm233.4 0H448V480H233.4V265.4z"},child:[]}]})(i)}const Ar={RATE_LIMIT:{MAX_ATTEMPTS:5,LOCKOUT_DURATION_MINUTES:15,WINDOW_SIZE_MINUTES:15},VALIDATION:{DEBOUNCE_MS:500},THRESHOLDS:{MIN_PASSWORD_LENGTH:8,MAX_LOGIN_ATTEMPTS:5},PASSWORD_STRENGTH:{MIN_LENGTH:8,GOOD_LENGTH:12,EXCELLENT_LENGTH:16,MAX_SCORE:5}},Ka=i=>(Object.keys(i).forEach(e=>{typeof i[e]=="object"&&i[e]!==null&&Ka(i[e])}),Object.freeze(i));Ka(Ar);const Xs=(i,e)=>{if(!i||typeof i!="string")return null;const t=i.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim();return e==="email"?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?t:null:e==="password"&&t.length<8?null:t},Zs=i=>{const e=[];return!i||typeof i!="string"?{isSuspicious:!1,threats:e}:(/('|"|;|--|\/\*|\*\/|union|select|insert|update|delete|drop|create|alter)/i.test(i)&&e.push("Potential SQL injection detected"),/<script|javascript:|on\w+\s*=|vbscript:|expression\(/i.test(i)&&e.push("Potential XSS attack detected"),/\||&|;|`|\$\(|eval\(|exec\(/i.test(i)&&e.push("Potential command injection detected"),{isSuspicious:e.length>0,threats:e})},Gn=(i=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";if(typeof crypto!="undefined"&&crypto.getRandomValues){const r=new Uint8Array(i);crypto.getRandomValues(r);for(let n=0;n<i;n++)t+=e[r[n]%e.length]}else for(let r=0;r<i;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},De={generateToken:()=>Gn(32),storeToken:i=>{try{typeof window!="undefined"&&localStorage.setItem("csrf_token",i)}catch(e){}},getStoredToken:()=>{try{return typeof window!="undefined"?localStorage.getItem("csrf_token"):null}catch(i){return null}},validateToken:(i,e)=>!i||!e?!1:i===e,setHttpOnlyCookie:i=>{De.storeToken(i)},refreshToken:()=>{const i=De.generateToken();return De.storeToken(i),i},clearToken:()=>{try{typeof window!="undefined"&&localStorage.removeItem("csrf_token")}catch(i){}}};var sp=Object.defineProperty,ap=Object.defineProperties,op=Object.getOwnPropertyDescriptors,ea=Object.getOwnPropertySymbols,cp=Object.prototype.hasOwnProperty,lp=Object.prototype.propertyIsEnumerable,ta=(i,e,t)=>e in i?sp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ra=(i,e)=>{for(var t in e||(e={}))cp.call(e,t)&&ta(i,t,e[t]);if(ea)for(var t of ea(e))lp.call(e,t)&&ta(i,t,e[t]);return i},na=(i,e)=>ap(i,op(e)),ia=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const up=()=>{const[i,e]=x.useState({}),[t,r]=x.useState("");x.useEffect(()=>{const o=Gn(32);r(o),typeof sessionStorage!="undefined"&&sessionStorage.setItem("oauth_state",o)},[]);const n=o=>ia(null,null,function*(){try{if(e(d=>na(ra({},d),{[o]:!0})),!t)throw new Error("OAuth state not initialized");const c=o==="microsoft"?"azure":o,a=Gn(128),l=yield s(a);typeof sessionStorage!="undefined"&&(sessionStorage.setItem("oauth_code_verifier",a),sessionStorage.setItem("oauth_provider",o));const{error:u}=yield y.auth.signInWithOAuth({provider:c,options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{access_type:"offline",prompt:"consent",state:t,code_challenge:l,code_challenge_method:"S256"}}});if(u)throw console.error(`OAuth login error with ${o}:`,u),u;kr()&&console.log(`[SECURITY] OAuth login initiated with ${o}:`,{provider:c,state:t,codeChallenge:l,timestamp:new Date().toISOString()})}catch(c){console.error(`Failed to login with ${o}:`,c),typeof sessionStorage!="undefined"&&(sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),sessionStorage.removeItem("oauth_state")),alert(`Failed to login with ${o}. Please try again.`)}finally{e(c=>na(ra({},c),{[o]:!1}))}}),s=o=>ia(null,null,function*(){try{const a=new TextEncoder().encode(o),l=yield crypto.subtle.digest("SHA-256",a),u=Array.from(new Uint8Array(l));return btoa(String.fromCharCode(...u)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(c){return console.error("Failed to generate PKCE code challenge:",c),o.substring(0,43)}});return p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-0 flex items-center",children:p.jsx("div",{className:"w-full border-t border-gray-300"})}),p.jsx("div",{className:"relative flex justify-center text-sm",children:p.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("button",{type:"button",onClick:()=>n("google"),disabled:i.google||!t,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.google?p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):p.jsx(np,{className:"h-4 w-4 text-red-500"}),p.jsx("span",{className:"ml-2",children:"Google"})]}),p.jsxs("button",{type:"button",onClick:()=>n("microsoft"),disabled:i.microsoft||!t,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.microsoft?p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):p.jsx(ip,{className:"h-4 w-4 text-blue-500"}),p.jsx("span",{className:"ml-2",children:"Microsoft"})]})]})]})},dp=()=>p.jsx(up,{}),Wa=({formData:i,handleChange:e,disabled:t=!1})=>{const r=x.useRef(null),[n,s]=x.useState(!1);x.useEffect(()=>{r.current&&!t&&r.current.focus()},[t]);const o=l=>l.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.trim())?null:"Please enter a valid email address":"Email is required",c=l=>{e("email")(l),s(!0)},a=n?o(i.email):null;return p.jsxs("div",{children:[p.jsx("span",{id:"emailHelp",className:"sr-only",children:"Enter your email address."}),p.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email"}),p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:p.jsx(Pl,{className:"h-5 w-5 text-gray-400"})}),p.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,disabled:t,"aria-label":"Email address","aria-describedby":"emailHelp",className:`appearance-none rounded-lg relative block w-full px-3 py-3 pl-10 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 focus:z-10 sm:text-sm transition-colors duration-200 ${a?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`,placeholder:"Email address",value:i.email,onChange:c,onBlur:()=>s(!0),ref:r})]}),a&&p.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[p.jsx(Xn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),p.jsx("p",{className:"text-sm text-red-600",children:a})]})]})},Qa=({password:i})=>{const t=(n=>{let s=0;const o={length:n.length>=8,lowercase:/[a-z]/.test(n),uppercase:/[A-Z]/.test(n),numbers:/\d/.test(n),symbols:/[!@#$%^&*(),.?":{}|<>]/.test(n),noRepeating:!/(.)\1{2,}/.test(n),noSequential:!/(?:abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|012|123|234|345|456|567|678|789)/i.test(n)};return o.length&&(s+=2),o.lowercase&&(s+=1),o.uppercase&&(s+=1),o.numbers&&(s+=1),o.symbols&&(s+=1),o.noRepeating&&(s+=1),o.noSequential&&(s+=1),n.length>=12&&(s+=1),n.length>=16&&(s+=1),s>=8?{level:"Excellent",score:s,color:"text-emerald-600",bgColor:"bg-emerald-500",barColor:"bg-emerald-500"}:s>=6?{level:"Strong",score:s,color:"text-green-600",bgColor:"bg-green-500",barColor:"bg-green-500"}:s>=4?{level:"Good",score:s,color:"text-yellow-600",bgColor:"bg-yellow-500",barColor:"bg-yellow-500"}:s>=2?{level:"Fair",score:s,color:"text-orange-600",bgColor:"bg-orange-500",barColor:"bg-orange-500"}:{level:"Weak",score:s,color:"text-red-600",bgColor:"bg-red-500",barColor:"bg-red-500"}})(i),r=10;return i.length===0?null:p.jsxs("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength"}),p.jsx("span",{className:`text-sm font-semibold ${t.color}`,children:t.level})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:p.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ease-out ${t.barColor}`,style:{width:`${t.score/r*100}%`}})}),p.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-3",children:[p.jsxs("span",{children:["Score: ",t.score,"/",r]}),p.jsxs("span",{className:t.color,children:[Math.round(t.score/r*100),"%"]})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"flex items-center space-x-2",children:[i.length>=8?p.jsx(st,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):p.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),p.jsx("span",{className:`text-xs ${i.length>=8?"text-green-700":"text-gray-500"}`,children:"At least 8 characters"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[/[a-z]/.test(i)?p.jsx(st,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):p.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),p.jsx("span",{className:`text-xs ${/[a-z]/.test(i)?"text-green-700":"text-gray-500"}`,children:"Lowercase letter"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[/[A-Z]/.test(i)?p.jsx(st,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):p.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),p.jsx("span",{className:`text-xs ${/[A-Z]/.test(i)?"text-green-700":"text-gray-500"}`,children:"Uppercase letter"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[/\d/.test(i)?p.jsx(st,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):p.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),p.jsx("span",{className:`text-xs ${/\d/.test(i)?"text-green-700":"text-gray-500"}`,children:"Number"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[/[!@#$%^&*(),.?":{}|<>]/.test(i)?p.jsx(st,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):p.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),p.jsx("span",{className:`text-xs ${/[!@#$%^&*(),.?":{}|<>]/.test(i)?"text-green-700":"text-gray-500"}`,children:"Special character"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[i.length>=12?p.jsx(st,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):p.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),p.jsx("span",{className:`text-xs ${i.length>=12?"text-green-700":"text-gray-500"}`,children:"At least 12 characters (bonus)"})]}),p.jsxs("div",{className:"flex items-center space-x-2",children:[/(.)\1{2,}/.test(i)?p.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}):p.jsx(st,{className:"w-3 h-3 text-green-500 flex-shrink-0"}),p.jsx("span",{className:`text-xs ${/(.)\1{2,}/.test(i)?"text-gray-500":"text-green-700"}`,children:"No repeating characters"})]})]}),t.score<6&&p.jsx("div",{className:"mt-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:p.jsxs("div",{className:"flex items-start space-x-2",children:[p.jsx("svg",{className:"w-4 h-4 text-amber-500 mt-0.5 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),p.jsxs("span",{children:[p.jsx("strong",{children:"Tip:"})," Try adding uppercase letters, numbers, and special characters to make your password stronger."]})]})})]})},Ya=({formData:i,handleChange:e,disabled:t=!1,showStrengthIndicator:r=!1})=>{const[n,s]=x.useState(!1),o=l=>l?l.length<8?"Password must be at least 8 characters long":null:"Password is required",c=l=>{e("password")(l),s(!0)},a=n?o(i.password):null;return p.jsxs("div",{children:[p.jsx("span",{id:"passwordHelp",className:"sr-only",children:"Enter your account password."}),p.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:p.jsx(Tl,{className:"h-5 w-5 text-gray-400"})}),p.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,disabled:t,"aria-label":"Password","aria-describedby":"passwordHelp",className:`appearance-none rounded-lg relative block w-full px-3 py-3 pl-10 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 focus:z-10 sm:text-sm transition-colors duration-200 ${a?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`,placeholder:"Password",value:i.password,onChange:c,onBlur:()=>s(!0)})]}),r&&p.jsx(Qa,{password:i.password}),a&&p.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[p.jsx(Xn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),p.jsx("p",{className:"text-sm text-red-600",children:a})]})]})},Ja=({formData:i,handleChange:e,disabled:t=!1})=>p.jsx("div",{className:"flex items-center justify-between",children:p.jsxs("div",{className:"flex flex-col space-y-2",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",disabled:t,"aria-label":Jr.rememberMe,checked:i.rememberMe,onChange:e("rememberMe"),className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${t?"opacity-50 cursor-not-allowed":""}`}),p.jsx("label",{htmlFor:"remember-me",className:`ml-2 block text-sm transition-colors duration-200 ${t?"text-gray-500":"text-gray-900"}`,children:Jr.rememberMe})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{id:"remember-device",name:"remember-device",type:"checkbox",disabled:t,"aria-label":Jr.rememberDevice,checked:i.rememberDevice,onChange:e("rememberDevice"),className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${t?"opacity-50 cursor-not-allowed":""}`}),p.jsx("label",{htmlFor:"remember-device",className:`ml-2 block text-sm transition-colors duration-200 ${t?"text-gray-500":"text-gray-900"}`,children:Jr.rememberDevice})]})]})}),Xa=({formData:i,handleChange:e,disabled:t=!1})=>{const[r,n]=x.useState(!1),s=a=>a?a.length!==6?"Verification code must be 6 digits":/^\d{6}$/.test(a)?null:"Verification code must contain only numbers":"Verification code is required",o=a=>{e("otp")(a),n(!0)},c=r?s(i.otp||""):null;return i.stage!=="otp"?null:p.jsxs("div",{children:[p.jsx("label",{htmlFor:"otp",className:"sr-only",children:"One-time code"}),p.jsx("input",{id:"otp",name:"otp",type:"text",maxLength:6,disabled:t,placeholder:"Enter 6-digit code",value:i.otp||"",onChange:o,onBlur:()=>n(!0),className:`appearance-none rounded-lg relative block w-full px-3 py-3 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 sm:text-sm transition-colors duration-200 ${c?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`}),c&&p.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[p.jsx(Xn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),p.jsx("p",{className:"text-sm text-red-600",children:c})]})]})},Za=({warnings:i=[]})=>x.useMemo(()=>!i||i.length===0?null:p.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:p.jsxs("div",{className:"flex",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:p.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),p.jsxs("div",{className:"ml-3",children:[p.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Security Warning"}),p.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:p.jsx("ul",{className:"list-disc pl-5 space-y-1",children:i.map((t,r)=>p.jsx("li",{children:t},r))})})]})]})}),[i]),eo=({isOnline:i=!0})=>i?null:p.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx("svg",{className:"h-5 w-5 text-amber-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),p.jsx("div",{className:"flex-1",children:p.jsx("p",{className:"text-sm text-amber-800 font-medium",children:Ba.offline})})]})});var hp=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const fp=x.lazy(()=>z(()=>import("./errors-CdY1Sgot.js").then(i=>i.bm),__vite__mapDeps([10,1,2,4]))),pp=()=>p.jsx("div",{className:"rounded-lg border p-4 bg-red-50 border-red-200",children:p.jsx("div",{className:"flex items-center",children:p.jsx("div",{className:"text-sm text-red-800",children:"Loading error handler..."})})}),sa=()=>{const{formData:i,errors:e,loading:t,handleChange:r,handleSubmit:n,handleForgotPassword:s}=Ga(),{csrfToken:o,isSecureMode:c}=Cr(),a=l=>hp(null,null,function*(){if(l.preventDefault(),!i.email.trim()||!i.password.trim())return;const u=i.email.trim().toLowerCase(),d=i.password;yield n(u,d,()=>c?!!o&&o.length>0:!0,(m,w,S)=>{console.log(`[SECURITY] ${m} for user: ${w}`,S?`Reason: ${S}`:"")},i.rememberMe,i.rememberDevice)});return p.jsx(El,{children:p.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:p.jsxs("div",{className:"max-w-md w-full space-y-8",children:[p.jsx(rp,{}),p.jsxs("form",{className:"mt-8 space-y-6",onSubmit:a,children:[c&&o&&p.jsx("input",{type:"hidden",name:"csrfToken",value:o}),p.jsxs("div",{className:"space-y-4",children:[p.jsx(Wa,{formData:i,handleChange:r,disabled:t}),p.jsx(Ya,{formData:i,handleChange:r,disabled:t,showStrengthIndicator:!1}),p.jsx(Ja,{formData:i,handleChange:r,disabled:t})]}),i.stage==="otp"&&p.jsx(Xa,{formData:i,handleChange:r,disabled:t}),p.jsx(Za,{}),p.jsx(eo,{}),e.submit&&p.jsx(x.Suspense,{fallback:p.jsx(pp,{}),children:p.jsx(fp,{error:e.submit,context:"login",onRetry:()=>{Cr.getState().setErrors({})},onDismiss:()=>{Cr.getState().setErrors({})}})}),p.jsx("div",{children:p.jsx("button",{type:"submit",disabled:t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#4ECDC4] hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#4ECDC4] disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Sign in"})}),p.jsx("div",{className:"text-center",children:p.jsx("button",{type:"button",onClick:s,className:"text-sm text-blue-600 hover:text-blue-500 focus:outline-none focus:underline",children:"Forgot your password?"})})]}),p.jsx(dp,{})]})})})},gp=()=>p.jsx("div",{className:"text-center",children:p.jsxs("div",{className:"mt-4 inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[p.jsx("svg",{className:"w-3 h-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Secure Login Enabled"]})}),mp=({loading:i,loadingStep:e})=>{const t=r=>{switch(r){case _e.PROGRESS_STEPS.CONNECTING:return"progress-bar-25";case _e.PROGRESS_STEPS.AUTHENTICATING:return"progress-bar-50";case _e.PROGRESS_STEPS.VERIFYING:return"progress-bar-75";case _e.PROGRESS_STEPS.SUCCESS:return"progress-bar-100";default:return"progress-bar-0"}};return!i||e===_e.PROGRESS_STEPS.IDLE?null:p.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[p.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),p.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),p.jsxs("div",{className:"flex-1",children:[p.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[e===_e.PROGRESS_STEPS.CONNECTING&&"Connecting to server...",e===_e.PROGRESS_STEPS.AUTHENTICATING&&"Authenticating credentials...",e===_e.PROGRESS_STEPS.VERIFYING&&"Verifying session...",e===_e.PROGRESS_STEPS.SUCCESS&&"Login successful! Redirecting..."]}),p.jsx("div",{className:"mt-2 w-full bg-blue-200 rounded-full h-2",children:p.jsx("div",{className:`bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out ${t(e)}`})})]})]})})},yp=({loading:i,loadingStep:e})=>i?p.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-600",children:[p.jsx(Ol,{size:"sm"}),p.jsx("span",{children:e||"Processing..."})]}):null;var vp=Object.defineProperty,aa=Object.getOwnPropertySymbols,_p=Object.prototype.hasOwnProperty,wp=Object.prototype.propertyIsEnumerable,oa=(i,e,t)=>e in i?vp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,yr=(i,e)=>{for(var t in e||(e={}))_p.call(e,t)&&oa(i,t,e[t]);if(aa)for(var t of aa(e))wp.call(e,t)&&oa(i,t,e[t]);return i},On=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const bp={maxAttempts:Ar.RATE_LIMIT.MAX_ATTEMPTS,lockoutDuration:Ar.RATE_LIMIT.LOCKOUT_DURATION_MINUTES,windowSize:Ar.RATE_LIMIT.WINDOW_SIZE_MINUTES};class Sp{constructor(e={}){this.config=yr(yr({},bp),e),this.distributedLimiter=new xr({maxRequests:this.config.maxAttempts,windowMs:this.config.windowSize*60*1e3,keyPrefix:"auth",blockDurationMs:this.config.lockoutDuration*60*1e3})}checkRateLimit(e){return On(this,null,function*(){try{const t=yield this.distributedLimiter.checkRateLimit(e);if(!t.allowed)return{isLocked:!0,remainingAttempts:0,lockoutTime:t.resetTime,error:`Too many failed attempts. Please try again in ${t.retryAfter||0} seconds.`};const{data:r,error:n}=yield y.from("login_attempts").select("*").eq("email",e).gte("attempted_at",new Date(Date.now()-this.config.windowSize*60*1e3).toISOString()).order("attempted_at",{ascending:!1}),o=(r||[]).filter(c=>!c.success);if(o.length>=this.config.maxAttempts){const c=o[0],a=new Date(c.attempted_at);if(a.setMinutes(a.getMinutes()+this.config.lockoutDuration),a>new Date)return{isLocked:!0,remainingAttempts:0,lockoutTime:a.getTime(),error:"Account temporarily locked due to repeated failed attempts. Please try again later."}}return{isLocked:!1,remainingAttempts:t.remaining}}catch(t){return{isLocked:!1,remainingAttempts:this.config.maxAttempts}}})}recordAttempt(e,t,r){return On(this,null,function*(){try{const{error:n}=yield y.from("login_attempts").insert({email:e,success:t,attempted_at:new Date().toISOString(),ip_address:r||"unknown",user_agent:navigator.userAgent})}catch(n){}})}resetRateLimit(e){return On(this,null,function*(){try{yield this.distributedLimiter.resetRateLimit(e);const{error:t}=yield y.from("login_attempts").delete().eq("email",e)}catch(t){}})}getConfig(){return yr({},this.config)}updateConfig(e){this.config=yr(yr({},this.config),e)}}const Ip=new Sp;const Ep=i=>{try{console.log("[AUDIT]",i)}catch(e){}};function kp(i,e){const t=x.useRef();return x.useCallback((...n)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{i(...n)},e)},[i,e])}var Cp=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Ap=()=>{const[i,e]=x.useState(""),[t,r]=x.useState([]),[n,s]=x.useState(null),[o,c]=x.useState(!1);x.useEffect(()=>{const I=De.getStoredToken();if(I)e(I);else{const b=De.generateToken();e(b),De.storeToken(b)}},[]),x.useEffect(()=>{(()=>{const b=window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";c(b),!b&&!kr()&&w("non_https_connection",{protocol:window.location.protocol,hostname:window.location.hostname})})()},[]);const a=kp(((I,b)=>l(I,b)),Ar.VALIDATION.DEBOUNCE_MS),l=(I,b)=>{const v=[];if(I.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I.trim())||v.push("Please enter a valid email address."),b?b.length<6&&v.push("Password must be at least 6 characters long."):v.push("Password must be at least 6 characters long."),v.length>0)return{isValid:!1,email:I.trim(),password:b,errors:v};const _=Xs(I,"email"),E=Xs(b,"password");if(!_||!E)return{isValid:!1,email:_,password:E,errors:["Invalid email or password format"]};const k=Zs(_),A=Zs(E),N=[...k.threats,...A.threats];return N.length>0?(r(N),w("suspicious_input_detected",{email:_,threats:N}),{isValid:!1,email:_,password:E,errors:N}):(r([]),{isValid:!0,email:_,password:E,errors:[]})},u=(I,b)=>l(I,b),d=I=>{const b=De.getStoredToken(),v=De.validateToken(I,b||"");if(!v){w("csrf_validation_failed",{providedToken:I,storedToken:b});const _=De.refreshToken();e(_)}return v},f=I=>Cp(null,null,function*(){try{const b=yield Ip.checkRateLimit(I);return s(b),b.isLocked&&w("rate_limit_exceeded",{email:I,lockoutTime:b.lockoutTime}),b}catch(b){return console.error("Rate limit check failed:",b),{isLocked:!1,remainingAttempts:5}}}),h=()=>{r([])},m=()=>{De.clearToken(),e("")},w=(I,b)=>{kr()&&console.warn(`[SECURITY] ${I}:`,b);const v=kr()?b:{event_type:I,timestamp:new Date().toISOString(),has_details:Object.keys(b).length>0};Ep({event:"security_event",timestamp:new Date().toISOString(),metadata:v})},S=x.useMemo(()=>{const I=t.length>0;return(n==null?void 0:n.isLocked)||!1?"locked":I?"warning":"secure"},[t,n]);return{csrfToken:i,securityWarnings:t,rateLimitInfo:n,isHttps:o,validateInputs:u,debouncedValidateInputs:a,validateCsrfToken:d,checkRateLimit:f,clearSecurityWarnings:h,clearCsrfToken:m,logSecurityEvent:w,getSecurityStatus:S}},bg=Object.freeze(Object.defineProperty({__proto__:null,CheckboxFields:Ja,EmailField:Wa,LoadingIndicator:yp,LoginPage:sa,LoginProgressIndicator:mp,OfflineWarning:eo,OtpField:Xa,PasswordField:Ya,PasswordStrengthIndicator:Qa,SecurityStatusIndicator:gp,SecurityWarnings:Za,default:sa,useLoginForm:Ga,useLoginSecurity:Ap},Symbol.toStringTag,{value:"Module"}));export{hg as $,ng as A,lg as B,ig as C,xr as D,El as E,sg as F,ug as G,eg as H,ti as I,Gp as J,og as K,Ol as L,Cr as M,an as N,fl as O,ef as P,gg as Q,Oa as R,xa as S,mg as T,fg as U,pg as V,nr as W,dg as X,vs as Y,Ua as Z,z as _,cg as a,Np as a0,$i as a1,wr as a2,Rd as a3,yg as a4,ml as a5,Pa as a6,yu as a7,Up as a8,ne as a9,Fp as aa,vg as ab,_g as ac,wg as ad,bg as ae,ag as b,Bp as c,st as d,Yp as e,Zp as f,Pr as g,rg as h,kr as i,tg as j,qp as k,R as l,Hp as m,zp as n,Sl as o,Vp as p,Qp as q,it as r,y as s,Pl as t,yl as u,fe as v,Kp as w,Xp as x,Wp as y,Jp as z};
