const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/services-Bq-O5kvJ.js","assets/js/components-CrSzLpHe.js","assets/js/react-vendor-CAfHStow.js","assets/js/data-vendor-B3X5ReaK.js","assets/js/vendor-BtFhHG5P.js","assets/js/ui-vendor-mgcSnJSc.js","assets/css/ui-vendor-DJSy8M6b.css","assets/js/utils-vendor-CfclMkuN.js","assets/css/components-B4OH_j2L.css","assets/js/inventory-pages-aeTDMVHI.js","assets/js/knowledgehub-pages-i9cBLZCy.js","assets/js/sterilization-pages-BFdKkV0k.js","assets/js/page-fA93bmXl.js","assets/js/statusMappingUtils-BdgEHvqE.js","assets/js/page-BkIG0Efd.js","assets/js/ScannerPage-DA6PRj8s.js","assets/js/settings-pages-BQfVRU0Y.js","assets/js/index-DTMaSV1j.js","assets/js/index-FYtWIkWw.js","assets/js/login-page-CKx03Z0b.js","assets/js/index-DrmAmit4.js","assets/js/HelpArticlePage-joF3Ode9.js","assets/css/HelpArticlePage-04dAlKem.css"])))=>i.map(i=>d[i]);
var W=(e,t,s)=>new Promise((d,n)=>{var o=r=>{try{u(s.next(r))}catch(c){n(c)}},l=r=>{try{u(s.throw(r))}catch(c){n(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(o,l);u((s=s.apply(e,t)).next())});import{c as ke,r as i,j as a,R as E,N as de,a3 as Ee,a4 as Me,a5 as Oe,a6 as S,a7 as Le}from"./react-vendor-CAfHStow.js";import{k as Ne,a0 as Te,a1 as De,E as z,a2 as Ie,a3 as Ae,a4 as Re,C as ze,a5 as Fe,a6 as $e,a7 as L,a8 as Ue,a9 as Ve,_ as x,aa as Ge,S as He,ab as Be,ac as qe,x as Ke,g as We,h as Q,ad as Y,ae as Qe,af as Ye,ag as Je,ah as w,ai as Xe,aj as Ze,ak as et,q as tt}from"./components-CrSzLpHe.js";import{Q as at}from"./data-vendor-B3X5ReaK.js";import{ar as H,as as ue,s as st}from"./services-Bq-O5kvJ.js";import{c as B}from"./utils-vendor-CfclMkuN.js";import"./ui-vendor-mgcSnJSc.js";import"./vendor-BtFhHG5P.js";import"./inventory-pages-aeTDMVHI.js";import"./knowledgehub-pages-i9cBLZCy.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const rt={info:(...e)=>console.info("[Cliniio]",...e),error:(...e)=>console.error("[Cliniio]",...e),warn:(...e)=>console.warn("[Cliniio]",...e)};var ot=Object.defineProperty,J=Object.getOwnPropertySymbols,nt=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,X=(e,t,s)=>t in e?ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Z=(e,t)=>{for(var s in t||(t={}))nt.call(t,s)&&X(e,s,t[s]);if(J)for(var s of J(t))it.call(t,s)&&X(e,s,t[s]);return e};const q=ke(e=>({totalScore:0,availablePoints:0,showFilters:!1,showLeaderboardModal:!1,showStatsModal:!1,showChallengeModal:!1,leaderboardUsers:[],tasks:[],gamificationData:{totalScore:0,level:1,totalPoints:0,streak:0,rank:100,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}},drawerOpen:!0,loading:!1,taskError:null,setTotalScore:t=>e({totalScore:t}),setAvailablePoints:t=>e({availablePoints:t}),setShowFilters:t=>e({showFilters:t}),setShowLeaderboardModal:t=>e({showLeaderboardModal:t}),setShowStatsModal:t=>e({showStatsModal:t}),setShowChallengeModal:t=>e({showChallengeModal:t}),setLeaderboardUsers:t=>e({leaderboardUsers:t}),setTasks:t=>e({tasks:t}),setGamificationData:t=>e({gamificationData:t}),updateGamificationData:t=>{Ne()&&(typeof t!="object"||t===null)&&rt.warn("[DEV] updateGamificationData called with invalid input:",t),e(s=>({gamificationData:Z(Z({},s.gamificationData),t)}))},setDrawerOpen:t=>e({drawerOpen:t}),setLoading:t=>e({loading:t}),setTaskError:t=>e({taskError:t})}));function lt({leaderboardData:e}){const{showStatsModal:t,setShowStatsModal:s,showLeaderboardModal:d,setShowLeaderboardModal:n,showChallengeModal:o,setShowChallengeModal:l,gamificationData:u}=q(),r=i.useMemo(()=>e.users||[],[e.users]),c=i.useMemo(()=>!r||r.length===0?[]:r.slice().sort((m,_)=>_.score-m.score).slice(0,3),[r]),g=i.useMemo(()=>e.userRank||1,[e.userRank]),p=i.useMemo(()=>!e.users||e.users.length===0?[]:c.map(m=>({id:m.id,name:m.full_name||"Anonymous",score:m.score||0,rank:m.rank,avatar:m.avatar||"👤"})),[c,e.users]);return a.jsx(Te,{isStatsOpen:t,onStatsClose:()=>s(!1),isLeaderboardOpen:d,onLeaderboardClose:()=>n(!1),isChallengeOpen:o,onChallengeClose:()=>l(!1),gamificationData:u,leaderboardRank:g,leaderboardTopUsers:p,leaderboardLoading:!1,leaderboardError:null})}function ct({loading:e,tasks:t,taskError:s}){return e?null:s?a.jsx(De,{message:"Some tasks may not be available due to a loading error."}):(!t||t.length===0,null)}const me=E.memo(({tasks:e,loading:t,taskError:s,storeAvailablePoints:d,storeShowFilters:n,setStoreShowFilters:o,selectedCategory:l,selectedType:u,onCategoryChange:r,onTypeChange:c,onTaskToggle:g,onTaskUpdate:p})=>a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx(ct,{loading:t,tasks:e,taskError:s}),a.jsx(z,{children:a.jsx("div",{className:"flex-1",children:a.jsx(Ie,{tasks:e,onTaskComplete:g,onTaskUpdate:p,availablePoints:d,showFilters:n,onToggleFilters:()=>o(!n),selectedCategory:l,selectedType:u,onCategoryChange:r,onTypeChange:c})})})]}));me.displayName="HomeTasksSection";var dt=(e,t,s)=>new Promise((d,n)=>{var o=r=>{try{u(s.next(r))}catch(c){n(c)}},l=r=>{try{u(s.throw(r))}catch(c){n(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(o,l);u((s=s.apply(e,t)).next())});const ut=E.memo(function({loading:t=!1,aiMetrics:s,sterilizationMetrics:d,integrationMetrics:n,aiImpactMetrics:o}){const l=()=>dt(null,null,function*(){try{H.clearCache(),yield H.fetchAndCacheMetricsOnLogin(),window.location.reload()}catch(c){throw console.error("Failed to refresh metrics:",c),c}}),u=i.useMemo(()=>{var c,g,p;return{timeSaved:(s==null?void 0:s.timeSaved)||{daily:0,monthly:0},aiTimeSaved:(s==null?void 0:s.aiTimeSaved)||{daily:0,monthly:0},costSavings:(s==null?void 0:s.costSavings)||{monthly:0,annual:0},aiEfficiency:(s==null?void 0:s.aiEfficiency)||{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:((c=s==null?void 0:s.teamPerformance)==null?void 0:c.skills)||0,inventory:((g=s==null?void 0:s.teamPerformance)==null?void 0:g.inventory)||0,sterilization:((p=s==null?void 0:s.teamPerformance)==null?void 0:p.sterilization)||0}}},[s]);return t&&!(s||d||n)?a.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})}):a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute top-4 right-4 z-10",children:a.jsx(Ae,{onRefresh:l,size:"sm",className:"shadow-md"})}),a.jsx(i.Suspense,{fallback:a.jsx(ze,{}),children:a.jsx(z,{children:a.jsx(Re,{biData:void 0,ciData:void 0,performanceMetrics:u,aiImpactMetrics:o})})})]})}),U={DEFAULT_RANK:100,DEFAULT_LEVEL:1,DEFAULT_SCORE:0},fe=E.memo(({gamificationData:e})=>{const{stats:t,loading:s}=Fe(),{updateGamificationData:d}=q(),o=!(e&&typeof e.streak=="number"&&typeof e.level=="number"&&typeof e.rank=="number"&&typeof e.totalScore=="number"&&e.streak>=0&&e.level>=1&&e.rank>=1&&e.totalScore>=0)||s,l=i.useMemo(()=>{const u=Math.max(0,(e==null?void 0:e.streak)||0),r=Math.max(1,(e==null?void 0:e.level)||U.DEFAULT_LEVEL),c=Math.max(1,(e==null?void 0:e.rank)||U.DEFAULT_RANK),g=Math.max(0,(e==null?void 0:e.totalScore)||U.DEFAULT_SCORE);return{streak:u,level:r,rank:c,totalScore:g,stats:{toolsSterilized:t.toolsSterilized||0,inventoryChecks:t.inventoryChecks||0,perfectDays:t.perfectDays||0,totalTasks:t.totalTasks||0,completedTasks:t.completedTasks||0,currentStreak:t.currentStreak||u,bestStreak:t.bestStreak||0}}},[e==null?void 0:e.streak,e==null?void 0:e.level,e==null?void 0:e.rank,e==null?void 0:e.totalScore,t]);return i.useEffect(()=>{!o&&l&&d(l)},[l,o,d]),o?a.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2",children:a.jsx("div",{className:"animate-pulse",children:a.jsxs("div",{className:"flex items-center justify-between p-1",children:[a.jsxs("div",{className:"flex items-center p-1",children:[a.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 mb-1"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]}),a.jsxs("div",{className:"flex items-center p-1",children:[a.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-8 mr-2"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]})]}),a.jsxs("div",{className:"flex items-center p-1 pl-8",children:[a.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),a.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]})]})]})})}):a.jsx($e,{gamificationData:l})});fe.displayName="HomeGamificationSection";const pe=E.memo(({gamificationData:e,tasks:t,loading:s,taskError:d,storeAvailablePoints:n,storeShowFilters:o,setStoreShowFilters:l,selectedCategory:u,selectedType:r,onCategoryChange:c,onTypeChange:g,onTaskToggle:p,onTaskUpdate:m,aiMetrics:_,sterilizationMetrics:y,integrationMetrics:j,aiImpactMetrics:k})=>{const O=i.useMemo(()=>B("flex flex-col lg:flex-row gap-6",`mt-${L.SPACING.MARGIN_TOP}`),[]),h=i.useMemo(()=>B(`p-${L.SPACING.PADDING}`),[]);return a.jsx("div",{className:h,children:a.jsxs("div",{className:"space-y-6",children:[a.jsx(fe,{gamificationData:e}),a.jsxs("div",{className:O,children:[a.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:a.jsx(me,{tasks:t,loading:s,taskError:d,storeAvailablePoints:n,storeShowFilters:o,setStoreShowFilters:l,selectedCategory:u,selectedType:r,onCategoryChange:c,onTypeChange:g,onTaskToggle:p,onTaskUpdate:m})}),a.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:a.jsx(ut,{loading:s,aiMetrics:_,sterilizationMetrics:y,integrationMetrics:j,aiImpactMetrics:k})})]})]})})});pe.displayName="HomeContentLayout";var R=(e,t,s)=>new Promise((d,n)=>{var o=r=>{try{u(s.next(r))}catch(c){n(c)}},l=r=>{try{u(s.throw(r))}catch(c){n(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(o,l);u((s=s.apply(e,t)).next())});const he=E.memo(({homeData:e})=>{const[t,s]=i.useState(!1),[d,n]=i.useState(!1),[o,l]=i.useState(""),[u,r]=i.useState(""),c=i.useMemo(()=>e.tasks||[],[e.tasks]),g=c.length,[p,m]=i.useState(1),y=Math.ceil(g/10),j=p<y,k=i.useCallback(()=>{j&&m(f=>f+1)},[j]),O=i.useCallback(()=>{p>1&&m(f=>f-1)},[p]),h=i.useCallback(f=>{f>=1&&f<=y&&m(f)},[y]),N=i.useCallback(f=>R(null,null,function*(){console.log("Completing task:",f)}),[]),I=i.useCallback(()=>R(null,null,function*(){console.log("Refreshing tasks...")}),[]),T=!1,A=null,{aiMetrics:F={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:C={},integrationMetrics:M={},aiImpactMetrics:_e=null}=e||{},xe=i.useMemo(()=>c.map(f=>({id:f.id,title:f.title,description:f.description||"",completed:f.isCompleted,points:f.points,type:f.category,category:f.category,priority:"medium",dueDate:f.createdAt,status:f.isCompleted?"completed":"pending"})),[c]),$=i.useMemo(()=>c.reduce((f,b)=>f+(b.points||0),0),[c]),Se=i.useMemo(()=>(v=>v&&typeof v=="object"&&v!==null&&"streak"in v&&typeof v.streak=="number"&&Number(v.streak)>=0&&"level"in v&&typeof v.level=="number"&&Number(v.level)>=1&&"rank"in v&&typeof v.rank=="number"&&Number(v.rank)>=1&&"totalScore"in v&&typeof v.totalScore=="number"&&Number(v.totalScore)>=0)(e.gamificationData)?e.gamificationData:{streak:0,level:5,rank:1,totalScore:Math.max(0,$||0)},[e.gamificationData,$]),K=i.useCallback(f=>{s(f)},[]);i.useCallback(()=>{},[]);const we=i.useCallback(f=>{l(f)},[]),be=i.useCallback(f=>{r(f)},[]),je=i.useCallback((f,b)=>R(null,null,function*(){try{const{FacilityService:v}=yield x(()=>import("./services-Bq-O5kvJ.js").then(Ce=>Ce.aB),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));if(!(yield v.getCurrentFacilityId()))throw new Error("No authenticated facility for task toggle");yield N(f),b&&b>0&&console.log(`Task completed! Awarded ${b} points.`)}catch(v){console.error("Error toggling task:",v)}}),[N]),Pe=i.useCallback((f,b)=>R(null,null,function*(){try{const v={title:b.title,description:b.description,category:b.category,points:b.points||0,isCompleted:b.status==="completed"};yield ue.updateDailyTask(f,v),yield I(),console.log("Task updated successfully:",f)}catch(v){throw console.error("Failed to update task:",v),v}}),[I]);return a.jsxs("div",{className:"home-content","data-testid":"home-content",children:[a.jsx(pe,{gamificationData:Se,tasks:xe,loading:T,taskError:A,storeAvailablePoints:$,storeShowFilters:d,setStoreShowFilters:n,selectedCategory:o,selectedType:u,onCategoryChange:we,onTypeChange:be,onTaskToggle:je,onTaskUpdate:Pe,aiMetrics:F||void 0,sterilizationMetrics:C||void 0,integrationMetrics:M||void 0,aiImpactMetrics:_e||void 0}),y>1&&a.jsxs("div",{className:"mt-8 mb-4",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"paginationStyle",checked:!t,onChange:()=>K(!1),className:"mr-2"}),"Pagination"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"paginationStyle",checked:t,onChange:()=>K(!0),className:"mr-2"}),"Load More"]})]})}),t?a.jsx(Ue,{onLoadMore:k,hasMore:j,isLoading:T,className:"mb-4"}):a.jsx(Ve,{currentPage:p,totalPages:y,onPageChange:h,onNextPage:k,onPreviousPage:O,hasNextPage:j,hasPreviousPage:p>1,isLoading:T,className:"mb-4"})]})]})});he.displayName="HomeContent";var mt=Object.defineProperty,ft=Object.defineProperties,pt=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,ht=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable,te=(e,t,s)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,vt=(e,t)=>{for(var s in t||(t={}))ht.call(t,s)&&te(e,s,t[s]);if(ee)for(var s of ee(t))gt.call(t,s)&&te(e,s,t[s]);return e},yt=(e,t)=>ft(e,pt(t));function _t({homeData:e}){const{setShowStatsModal:t,setShowLeaderboardModal:s,setShowChallengeModal:d}=q(),{isDrawerOpen:n}=Ge(),{navBarMarginLeft:o,navBarMarginTop:l}=Be(n),u=i.useRef(null),r=i.useCallback(()=>t(!0),[t]),c=i.useCallback(()=>s(!0),[s]),g=i.useCallback(()=>d(!0),[d]);return a.jsx(z,{children:a.jsxs(He,{children:[a.jsxs("div",{className:B("h-screen bg-gradient-to-br hide-scrollbar overflow-hidden",`from-${L.COLORS.BG_GRADIENT.FROM}`,`to-${L.COLORS.BG_GRADIENT.TO}`),"aria-label":"Cliniio Home Dashboard","data-testid":"home-layout",children:[a.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white text-black p-2 z-50 rounded shadow-lg","aria-label":"Skip to main content",children:"Skip to main content"}),a.jsxs("main",{className:`flex-1 border-l-${L.BORDER.LEFT_WIDTH} border-${L.COLORS.BORDER} pt-6 overflow-hidden`,role:"main",id:"main-content",ref:u,tabIndex:-1,"aria-label":"Main content area",children:[a.jsx("div",{style:{marginLeft:o,marginTop:l},className:"flex-shrink-0","aria-label":"Dashboard header container",children:a.jsx(qe,{onStatsClick:r,onLeaderboardClick:c,onChallengeClick:g})}),a.jsx("div",{style:{marginLeft:o},className:"flex-1 overflow-y-auto hide-scrollbar",role:"region","aria-label":"Dashboard content",children:a.jsx(he,{homeData:e})})]})]}),a.jsx(lt,{leaderboardData:yt(vt({},e.leaderboardData),{users:[],userRank:1})})]})})}var xt=Object.defineProperty,St=Object.defineProperties,wt=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertySymbols,bt=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable,se=(e,t,s)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,re=(e,t)=>{for(var s in t||(t={}))bt.call(t,s)&&se(e,s,t[s]);if(ae)for(var s of ae(t))jt.call(t,s)&&se(e,s,t[s]);return e},oe=(e,t)=>St(e,wt(t)),Pt=(e,t,s)=>new Promise((d,n)=>{var o=r=>{try{u(s.next(r))}catch(c){n(c)}},l=r=>{try{u(s.throw(r))}catch(c){n(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(o,l);u((s=s.apply(e,t)).next())});const V=[{id:"demo-1",title:"Complete Daily Safety Checklist",description:"Review and complete the facility safety checklist",category:"Safety",difficulty:"Easy",points:50,timeEstimate:"15 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-2",title:"Update Inventory Records",description:"Verify and update current inventory levels",category:"Inventory",difficulty:"Medium",points:75,timeEstimate:"30 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-3",title:"Review Sterilization Protocols",description:"Ensure all sterilization equipment is properly maintained",category:"Sterilization",difficulty:"Hard",points:100,timeEstimate:"45 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],D={aiMetrics:{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:{cyclesCompleted:0,successRate:"0%",equipmentStatus:"No Data"},integrationMetrics:{systemHealth:"No Data",uptime:"0%",lastSync:"Never"}},Ct=()=>{const{currentFacility:e,isLoading:t}=Ke(),[s,d]=i.useState({tasks:[],aiMetrics:null,aiImpactMetrics:null,sterilizationMetrics:null,integrationMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!0,error:null}),n=i.useCallback(()=>Pt(null,null,function*(){try{d(h=>oe(re({},h),{loading:!0,error:null}));let o;if(e!=null&&e.id)o=e.id;else{if(t)return;o="550e8400-e29b-41d4-a716-446655440000"}const[l,u,r]=yield Promise.allSettled([ue.getFacilityDailyTasks(o),H.fetchAndCacheMetricsOnLogin(),st.fetchCumulativeStats()]),c=yield Promise.resolve([]);console.log("🔍 useHomeDataLoader: Promise.allSettled results:",{allDailyTasks:l.status,freshMetrics:u.status,gamificationStats:r.status,leaderboardData:"skipped"});const g=l.status==="fulfilled"?l.value:V,p=u.status==="fulfilled"&&u.value?u.value:null,m=(p==null?void 0:p.aiMetrics)||{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},_=(p==null?void 0:p.sterilizationMetrics)||D.sterilizationMetrics,y=(p==null?void 0:p.integrationMetrics)||D.integrationMetrics,j={id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},k=r.status==="fulfilled"&&r.value?(()=>{const h=r.value,N=c.status==="fulfilled"&&c.values?c.values:{userRank:1,totalUsers:1},I=Math.max(0,h.currentStreak||0),T=Math.max(0,h.totalPoints||0),A=Math.max(1,N.userRank||1),F=Math.max(1,N.totalUsers||1),C=A/F;let M;return C<=.1?M=Math.max(10,Math.floor(10+(.1-C)*50)):C<=.25?M=Math.max(7,Math.floor(7+(.25-C)*20)):C<=.5?M=Math.max(5,Math.floor(5+(.5-C)*8)):M=Math.max(1,Math.floor(1+(1-C)*4)),{streak:I,level:M,rank:A,totalScore:T}})():null,O=g.length>0?g.map(h=>"difficulty"in h&&"timeEstimate"in h?h:{id:h.id,title:h.title,description:h.description||"",category:h.category,difficulty:h.priority||"medium",points:h.points,timeEstimate:`${h.estimated_duration||30} min`,isCompleted:h.completed||!1,completedAt:h.completed_at||null,pointsEarned:h.completed?h.points:0,createdAt:h.created_at||h.due_date||new Date().toISOString(),updatedAt:h.updated_at||new Date().toISOString()}):V;d({tasks:O,aiMetrics:m,sterilizationMetrics:_,integrationMetrics:y,aiImpactMetrics:(p==null?void 0:p.aiImpactMetrics)||null,leaderboardData:j,gamificationData:k,loading:!1,error:null}),console.log("🚀 Home data loaded (with fallbacks if needed):",{tasks:O.length,aiMetrics:!!m,sterilizationMetrics:!!_,integrationMetrics:!!y})}catch(o){console.error("Critical error loading home data, using all fallbacks:",o),d({tasks:V,aiMetrics:oe(re({},D.aiMetrics),{costSavings:{monthly:0,annual:0},teamPerformance:{skills:0,inventory:0,sterilization:0}}),sterilizationMetrics:D.sterilizationMetrics,integrationMetrics:D.integrationMetrics,aiImpactMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!1,error:null})}}),[e,t]);return i.useEffect(()=>{if(!t){const o=setTimeout(()=>{n()},0);return()=>clearTimeout(o)}},[t,n]),s};function kt(){const{currentUser:e,isLoading:t}=We(),s=Q(l=>l.authToken),d=Q(l=>l.isTokenExpired),n=Ct();return!!!(e&&s&&!d())&&!t?a.jsx(de,{to:"/login",replace:!0}):t||!e?a.jsx(Y,{size:"lg",message:"Verifying Authentication..."}):n.loading?a.jsx(Y,{size:"lg",message:"Data Compilation In Progress..."}):a.jsx(_t,{homeData:n})}var ge=(e,t,s)=>new Promise((d,n)=>{var o=r=>{try{u(s.next(r))}catch(c){n(c)}},l=r=>{try{u(s.throw(r))}catch(c){n(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(o,l);u((s=s.apply(e,t)).next())});const Et=i.lazy(()=>x(()=>import("./sterilization-pages-BFdKkV0k.js").then(e=>e.S),__vite__mapDeps([11,2,3,1,0,9,5,6,7,4,10,8]))),Mt=i.lazy(()=>x(()=>import("./inventory-pages-aeTDMVHI.js").then(e=>e.i),__vite__mapDeps([9,1,2,3,4,0,10,5,6,7,8]))),Ot=i.lazy(()=>x(()=>import("./page-fA93bmXl.js"),__vite__mapDeps([12,2,3,1,0,9,5,6,7,4,10,8,13]))),Lt=i.lazy(()=>x(()=>import("./knowledgehub-pages-i9cBLZCy.js").then(e=>e.i),__vite__mapDeps([10,2,3,1,0,9,5,6,7,4,8]))),Nt=i.lazy(()=>x(()=>import("./page-BkIG0Efd.js"),__vite__mapDeps([14,2,3,1,0,9,5,6,7,4,10,8]))),Tt=i.lazy(()=>x(()=>import("./sterilization-pages-BFdKkV0k.js").then(e=>e.a),__vite__mapDeps([11,2,3,1,0,9,5,6,7,4,10,8]))),Dt=i.lazy(()=>x(()=>import("./inventory-pages-aeTDMVHI.js").then(e=>e.S),__vite__mapDeps([9,1,2,3,4,0,10,5,6,7,8]))),It=i.lazy(()=>x(()=>import("./ScannerPage-DA6PRj8s.js"),__vite__mapDeps([15,2,3,1,0,9,5,6,7,4,10,8,13]))),At=i.lazy(()=>x(()=>import("./settings-pages-BQfVRU0Y.js"),__vite__mapDeps([16,2,3,1,0,9,5,6,7,4,10,8]))),Rt=i.lazy(()=>x(()=>import("./index-DTMaSV1j.js").then(e=>e.i),__vite__mapDeps([17,2,3,1,0,9,5,6,7,4,10,8]))),zt=i.lazy(()=>x(()=>import("./index-FYtWIkWw.js"),__vite__mapDeps([18,2,3,1,0,9,5,6,7,4,10,8]))),Ft=i.lazy(()=>x(()=>import("./login-page-CKx03Z0b.js"),__vite__mapDeps([19,2,3,1,0,9,5,6,7,4,10,8]))),$t=i.lazy(()=>x(()=>import("./index-DrmAmit4.js"),__vite__mapDeps([20,2,3,1,0,9,5,6,7,4,10,8]))),Ut=i.lazy(()=>x(()=>import("./components-CrSzLpHe.js").then(e=>e.av),__vite__mapDeps([1,2,3,4,0,9,5,6,7,10,8]))),Vt=i.lazy(()=>x(()=>import("./HelpArticlePage-joF3Ode9.js"),__vite__mapDeps([21,2,3,1,0,9,5,6,7,4,10,8,22])));let P=null;const Gt=300*1e3;function ve(){return ge(this,null,function*(){if(!(typeof window!="undefined"&&window.location.pathname==="/login"))try{const{FacilityService:e}=yield x(()=>import("./services-Bq-O5kvJ.js").then(s=>s.aB),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),t=yield e.getCurrentFacilityId();if(!t){console.warn("No facility ID available - using development fallback"),P={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()};return}P={id:t,timestamp:Date.now()}}catch(e){console.warn("Failed to update facility ID cache:",e),P||(P={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()})}})}function ne(){const e=Date.now();if(P&&e-P.timestamp<Gt)return P.id;if(P)return ve(),P.id;throw P?new Error("Unexpected state in getCurrentFacilityId"):new Error("Facility ID lookup failed — no fallback allowed in production.")}function Ht(){const e=window;if(typeof window=="undefined"||e.__postgrestGuardInstalled||typeof window.fetch=="undefined")return;e.__postgrestGuardInstalled=!0;const t=".supabase.co/rest/v1/",s=window.fetch.bind(window);window.fetch=(d,n)=>ge(null,null,function*(){try{let o=typeof d=="string"?d:d.toString();if(o.includes(t)){const l=new URL(o),u=m=>m.endsWith(":1")?m.slice(0,-2):m,r=[],c=[];for(const[m,_]of l.searchParams.entries()){const y=_.trim();if(y==="eq."||y==="eq"||y==="eq:"||y==="eq:."||y==="."){r.push(m);continue}if(m==="facility_id"&&(y==="eq.:1"||y==="eq:1"||y===":1"||y==="eq.:")){const k=ne();c.push(["facility_id",`eq.${k}`]);continue}const j=u(y);if(j!==y){c.push([m,j]);continue}if(m==="quantity"&&y==="lt.reorder_point"){r.push(m);continue}}if(r.forEach(m=>l.searchParams.delete(m)),c.forEach(([m,_])=>{l.searchParams.set(m,_)}),l.search.includes("facility_id=eq.:1")){const m=ne();l.search=l.search.replace("facility_id=eq.:1",`facility_id=eq.${m}`)}l.search=l.search.replace(/(^|&)([^=&]+)=eq\.(?=(&|$))/g,(m,_)=>_?_.slice(0,-1):""),l.search=l.search.replace(/(:1)(?=(&|$))/g,""),l.search=l.search.replace(/(^|&)quantity=lt\.reorder_point(?=(&|$))/g,(m,_)=>_?_.slice(0,-1):"");const g=new URL(l.toString()),p=new Map;for(const[m,_]of g.searchParams.entries())p.set(m,_);g.search="";for(const[m,_]of p.entries())g.searchParams.append(m,_);g.toString()!==o&&(e.__postgrestGuardLogged||(e.__postgrestGuardLogged=!0,console.info("🛡️ PostgREST guard rewrote URL:",{from:o,to:g.toString()})),o=g.toString(),d=o)}}catch(o){throw console.error(o),o}return s(d,n)})}const Bt=new at;function qt(){const[e,t]=E.useState(!1);return E.useEffect(()=>{ve(),Ht(),x(()=>W(null,null,function*(){const{realTimeStatusMonitor:d}=yield import("./services-Bq-O5kvJ.js").then(n=>n.aE);return{realTimeStatusMonitor:d}}),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(({realTimeStatusMonitor:d})=>{d.startMonitoring()});const s=d=>{d.ctrlKey&&d.shiftKey&&d.key==="P"&&(d.preventDefault(),t(n=>!n))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),a.jsxs(Ee,{client:Bt,children:[a.jsx(z,{children:a.jsx(Qe,{children:a.jsx(Ye,{children:a.jsxs(Me,{children:[a.jsxs(Je,{children:[a.jsx(i.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}),children:a.jsxs(Oe,{children:[a.jsx(S,{path:"/login",element:a.jsx(Ft,{})}),a.jsx(S,{path:"/auth/callback",element:a.jsx(Ut,{})}),a.jsx(S,{path:"/home",element:a.jsx(w,{children:a.jsx(kt,{})})}),a.jsx(S,{path:"/sterilization",element:a.jsx(w,{children:a.jsx(Et,{})})}),a.jsx(S,{path:"/sterilization/scanner",element:a.jsx(w,{children:a.jsx(Tt,{})})}),a.jsx(S,{path:"/inventory",element:a.jsx(w,{children:a.jsx(Mt,{})})}),a.jsx(S,{path:"/inventory/scanner",element:a.jsx(w,{children:a.jsx(Dt,{})})}),a.jsx(S,{path:"/environmental-clean",element:a.jsx(w,{children:a.jsx(Ot,{})})}),a.jsx(S,{path:"/environmental-clean/scanner",element:a.jsx(w,{children:a.jsx(It,{})})}),a.jsx(S,{path:"/knowledge-hub",element:a.jsx(w,{children:a.jsx(Lt,{})})}),a.jsx(S,{path:"/library",element:a.jsx(w,{children:a.jsx(Nt,{})})}),a.jsx(S,{path:"/intelligence",element:a.jsx(w,{children:a.jsx($t,{})})}),a.jsx(S,{path:"/settings",element:a.jsx(w,{children:a.jsx(At,{})})}),a.jsx(S,{path:"/content-builder",element:a.jsx(w,{children:a.jsx(Rt,{})})}),a.jsx(S,{path:"/course/:courseId",element:a.jsx(w,{children:a.jsx(zt,{})})}),a.jsx(S,{path:"/help/article/:slug",element:a.jsx(Vt,{})}),a.jsx(S,{path:"/",element:a.jsx(de,{to:"/home",replace:!0})})]})}),a.jsx(Xe,{})]}),a.jsx(Ze,{})]})})})}),a.jsx(et,{isVisible:e,onClose:()=>t(!1)})]})}var Kt=Object.defineProperty,ie=Object.getOwnPropertySymbols,Wt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable,le=(e,t,s)=>t in e?Kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Yt=(e,t)=>{for(var s in t||(t={}))Wt.call(t,s)&&le(e,s,t[s]);if(ie)for(var s of ie(t))Qt.call(t,s)&&le(e,s,t[s]);return e};const Jt={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},G=e=>{typeof window!="undefined"&&(localStorage.setItem("cliniio_log_level",e),window.cliniioLogger&&window.cliniioLogger.setLevel(e),console.log(`🔧 Console log level set to: ${e}`))},Xt=()=>{if(typeof window!="undefined"){const e=localStorage.getItem("cliniio_log_level");if(e&&Jt[e]!==void 0)return e}return"WARN"},ce={quiet:()=>G("WARN"),normal:()=>G("INFO"),verbose:()=>G("DEBUG"),silent:()=>{const e=Yt({},console);return Object.keys(console).forEach(t=>{typeof console[t]=="function"&&(console[t]=()=>{})}),console.log("🔇 Console logging disabled. Use consoleControl.restore() to re-enable."),e},restore:e=>{e&&(Object.assign(console,e),console.log("🔊 Console logging restored."))},status:()=>{const e=Xt();return console.log(`📊 Current log level: ${e}`),e}},ye=()=>{typeof window!="undefined"&&(window.consoleControl=ce,console.log("🎛️ Console control initialized. Use consoleControl.quiet(), consoleControl.normal(), or consoleControl.verbose() to adjust logging."),ce.status())};typeof window!="undefined"&&ye();ye();typeof window!="undefined"&&(window.cliniioLogger=tt);"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistrations().then(function(e){for(const t of e)t.unregister(),console.log("Service worker unregistered")}),navigator.serviceWorker.ready.then(e=>{e.unregister(),console.log("Main service worker unregistered")}));Le.createRoot(document.getElementById("root")).render(a.jsx(E.StrictMode,{children:a.jsx(qt,{})}));
