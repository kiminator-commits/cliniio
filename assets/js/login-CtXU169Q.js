const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/redisClient.server-PQwg0JJE.js","assets/js/utils-DSBVV_PW.js","assets/js/vendor-DoALFvsH.js","assets/js/data-73RVSc-N.js","assets/js/ui-DETUEJ2B.js","assets/js/TypedSupabaseAdapter-Bn-38cBa.js","assets/js/SupabaseAdapter-Dm3EqNBh.js","assets/js/inventoryTransformers-BSO01pnq.js","assets/js/StaticDataAdapter-Ce5u2tbc.js","assets/js/quizService-BfeOvcOT.js","assets/js/errors-CCC622el.js"])))=>i.map(i=>d[i]);
var g=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});import{j as f}from"./utils-DSBVV_PW.js";import{g as ao,b as oa,a as P,u as oo}from"./vendor-DoALFvsH.js";import{c as co}from"./data-73RVSc-N.js";import{r as lo,G as R}from"./ui-DETUEJ2B.js";const uo="modulepreload",ho=function(i){return"/"+i},ri={},N=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let a=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=a(t.map(l=>{if(l=ho(l),l in ri)return;ri[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":uo,u||(h.as="script"),h.crossOrigin="",h.href=l,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((p,m)=>{h.addEventListener("load",p),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})},fo=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>N(()=>g(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>nr);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Kn extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class po extends Kn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ni extends Kn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ii extends Kn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var On;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(On||(On={}));var go=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};class mo{constructor(e,{headers:t={},customFetch:r,region:n=On.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=fo(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return go(this,void 0,void 0,function*(){try{const{headers:n,method:s,body:o}=t;let c={},{region:a}=t;a||(a=this.region);const l=new URL(`${this.url}/${e}`);a&&a!=="any"&&(c["x-region"]=a,l.searchParams.set("forceFunctionRegion",a));let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob!="undefined"&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(c["Content-Type"]="text/plain",u=o):typeof FormData!="undefined"&&o instanceof FormData?u=o:(c["Content-Type"]="application/json",u=JSON.stringify(o)));const d=yield this.fetch(l.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:u}).catch(v=>{throw new po(v)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new ni(d);if(!d.ok)throw new ii(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),m;return p==="application/json"?m=yield d.json():p==="application/octet-stream"?m=yield d.blob():p==="text/event-stream"?m=d:p==="multipart/form-data"?m=yield d.formData():m=yield d.text(),{data:m,error:null,response:d}}catch(n){return{data:null,error:n,response:n instanceof ii||n instanceof ni?n.context:void 0}}})}}var Q={},vt={},_t={},wt={},bt={},Ct={},yo=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object")},rr=yo();const vo=rr.fetch,ca=rr.fetch.bind(rr),la=rr.Headers,_o=rr.Request,wo=rr.Response,nr=Object.freeze(Object.defineProperty({__proto__:null,Headers:la,Request:_o,Response:wo,default:ca,fetch:vo},Symbol.toStringTag,{value:"Module"})),bo=ao(nr);var Or={},si;function ua(){if(si)return Or;si=1,Object.defineProperty(Or,"__esModule",{value:!0});class i extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Or.default=i,Or}var ai;function da(){if(ai)return Ct;ai=1;var i=Ct&&Ct.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ct,"__esModule",{value:!0});const e=i(bo),t=i(ua());class r{constructor(s){var o,c;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(o=s.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=s.signal,this.isMaybeSingle=(c=s.isMaybeSingle)!==null&&c!==void 0?c:!1,s.fetch?this.fetch=s.fetch:typeof fetch=="undefined"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,o){return this.headers=new Headers(this.headers),this.headers.set(s,o),this}then(s,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let a=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(l=>g(this,null,function*(){var u,d,h,p;let m=null,v=null,b=null,S=l.status,C=l.statusText;if(l.ok){if(this.method!=="HEAD"){const I=yield l.text();I===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?v=I:v=JSON.parse(I))}const y=(d=this.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),A=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&A&&A.length>1&&(b=parseInt(A[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(v)&&(v.length>1?(m={code:"PGRST116",details:`Results contain ${v.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},v=null,b=null,S=406,C="Not Acceptable"):v.length===1?v=v[0]:v=null)}else{const y=yield l.text();try{m=JSON.parse(y),Array.isArray(m)&&l.status===404&&(v=[],m=null,S=200,C="OK")}catch(A){l.status===404&&y===""?(S=204,C="No Content"):m={message:y}}if(m&&this.isMaybeSingle&&(!((p=m==null?void 0:m.details)===null||p===void 0)&&p.includes("0 rows"))&&(m=null,S=200,C="OK"),m&&this.shouldThrowOnError)throw new t.default(m)}return{error:m,data:v,count:b,status:S,statusText:C}}));return this.shouldThrowOnError||(a=a.catch(l=>{var u,d,h;return{error:{message:`${(u=l==null?void 0:l.name)!==null&&u!==void 0?u:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(d=l==null?void 0:l.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=l==null?void 0:l.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),a.then(s,o)}returns(){return this}overrideTypes(){return this}}return Ct.default=r,Ct}var oi;function ha(){if(oi)return bt;oi=1;var i=bt&&bt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(bt,"__esModule",{value:!0});const e=i(da());class t extends e.default{select(n){let s=!1;const o=(n!=null?n:"*").split("").map(c=>/\s/.test(c)&&!s?"":(c==='"'&&(s=!s),c)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:s=!0,nullsFirst:o,foreignTable:c,referencedTable:a=c}={}){const l=a?`${a}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${n}.${s?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:s,referencedTable:o=s}={}){const c=typeof o=="undefined"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${n}`),this}range(n,s,{foreignTable:o,referencedTable:c=o}={}){const a=typeof c=="undefined"?"offset":`${c}.offset`,l=typeof c=="undefined"?"limit":`${c}.limit`;return this.url.searchParams.set(a,`${n}`),this.url.searchParams.set(l,`${s-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:s=!1,settings:o=!1,buffers:c=!1,wal:a=!1,format:l="text"}={}){var u;const d=[n?"analyze":null,s?"verbose":null,o?"settings":null,c?"buffers":null,a?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${h}"; options=${d};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return bt.default=t,bt}var ci;function Wn(){if(ci)return wt;ci=1;var i=wt&&wt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wt,"__esModule",{value:!0});const e=i(ha());class t extends e.default{eq(n,s){return this.url.searchParams.append(n,`eq.${s}`),this}neq(n,s){return this.url.searchParams.append(n,`neq.${s}`),this}gt(n,s){return this.url.searchParams.append(n,`gt.${s}`),this}gte(n,s){return this.url.searchParams.append(n,`gte.${s}`),this}lt(n,s){return this.url.searchParams.append(n,`lt.${s}`),this}lte(n,s){return this.url.searchParams.append(n,`lte.${s}`),this}like(n,s){return this.url.searchParams.append(n,`like.${s}`),this}likeAllOf(n,s){return this.url.searchParams.append(n,`like(all).{${s.join(",")}}`),this}likeAnyOf(n,s){return this.url.searchParams.append(n,`like(any).{${s.join(",")}}`),this}ilike(n,s){return this.url.searchParams.append(n,`ilike.${s}`),this}ilikeAllOf(n,s){return this.url.searchParams.append(n,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(n,s){return this.url.searchParams.append(n,`ilike(any).{${s.join(",")}}`),this}is(n,s){return this.url.searchParams.append(n,`is.${s}`),this}in(n,s){const o=Array.from(new Set(s)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(n,`in.(${o})`),this}contains(n,s){return typeof s=="string"?this.url.searchParams.append(n,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(n,`cs.{${s.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(s)}`),this}containedBy(n,s){return typeof s=="string"?this.url.searchParams.append(n,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(n,`cd.{${s.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(s)}`),this}rangeGt(n,s){return this.url.searchParams.append(n,`sr.${s}`),this}rangeGte(n,s){return this.url.searchParams.append(n,`nxl.${s}`),this}rangeLt(n,s){return this.url.searchParams.append(n,`sl.${s}`),this}rangeLte(n,s){return this.url.searchParams.append(n,`nxr.${s}`),this}rangeAdjacent(n,s){return this.url.searchParams.append(n,`adj.${s}`),this}overlaps(n,s){return typeof s=="string"?this.url.searchParams.append(n,`ov.${s}`):this.url.searchParams.append(n,`ov.{${s.join(",")}}`),this}textSearch(n,s,{config:o,type:c}={}){let a="";c==="plain"?a="pl":c==="phrase"?a="ph":c==="websearch"&&(a="w");const l=o===void 0?"":`(${o})`;return this.url.searchParams.append(n,`${a}fts${l}.${s}`),this}match(n){return Object.entries(n).forEach(([s,o])=>{this.url.searchParams.append(s,`eq.${o}`)}),this}not(n,s,o){return this.url.searchParams.append(n,`not.${s}.${o}`),this}or(n,{foreignTable:s,referencedTable:o=s}={}){const c=o?`${o}.or`:"or";return this.url.searchParams.append(c,`(${n})`),this}filter(n,s,o){return this.url.searchParams.append(n,`${s}.${o}`),this}}return wt.default=t,wt}var li;function fa(){if(li)return _t;li=1;var i=_t&&_t.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(_t,"__esModule",{value:!0});const e=i(Wn());class t{constructor(n,{headers:s={},schema:o,fetch:c}){this.url=n,this.headers=new Headers(s),this.schema=o,this.fetch=c}select(n,{head:s=!1,count:o}={}){const c=s?"HEAD":"GET";let a=!1;const l=(n!=null?n:"*").split("").map(u=>/\s/.test(u)&&!a?"":(u==='"'&&(a=!a),u)).join("");return this.url.searchParams.set("select",l),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:s,defaultToNull:o=!0}={}){var c;const a="POST";if(s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const l=n.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(l.length>0){const u=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}upsert(n,{onConflict:s,ignoreDuplicates:o=!1,count:c,defaultToNull:a=!0}={}){var l;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),c&&this.headers.append("Prefer",`count=${c}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const d=n.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(d.length>0){const h=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}update(n,{count:s}={}){var o;const c="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:n}={}){var s;const o="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}}return _t.default=t,_t}var ui;function Co(){if(ui)return vt;ui=1;var i=vt&&vt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(vt,"__esModule",{value:!0});const e=i(fa()),t=i(Wn());class r{constructor(s,{headers:o={},schema:c,fetch:a}={}){this.url=s,this.headers=new Headers(o),this.schemaName=c,this.fetch=a}from(s){const o=new URL(`${this.url}/${s}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new r(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,o={},{head:c=!1,get:a=!1,count:l}={}){var u;let d;const h=new URL(`${this.url}/rpc/${s}`);let p;c||a?(d=c?"HEAD":"GET",Object.entries(o).filter(([v,b])=>b!==void 0).map(([v,b])=>[v,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([v,b])=>{h.searchParams.append(v,b)})):(d="POST",p=o);const m=new Headers(this.headers);return l&&m.set("Prefer",`count=${l}`),new t.default({method:d,url:h,headers:m,schema:this.schemaName,body:p,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return vt.default=r,vt}var di;function So(){if(di)return Q;di=1;var i=Q&&Q.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Q,"__esModule",{value:!0}),Q.PostgrestError=Q.PostgrestBuilder=Q.PostgrestTransformBuilder=Q.PostgrestFilterBuilder=Q.PostgrestQueryBuilder=Q.PostgrestClient=void 0;const e=i(Co());Q.PostgrestClient=e.default;const t=i(fa());Q.PostgrestQueryBuilder=t.default;const r=i(Wn());Q.PostgrestFilterBuilder=r.default;const n=i(ha());Q.PostgrestTransformBuilder=n.default;const s=i(da());Q.PostgrestBuilder=s.default;const o=i(ua());return Q.PostgrestError=o.default,Q.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:s.default,PostgrestError:o.default},Q}var Ao=So();const Io=oa(Ao),{PostgrestClient:Eo,PostgrestQueryBuilder:Of,PostgrestFilterBuilder:Mf,PostgrestTransformBuilder:xf,PostgrestBuilder:Hf,PostgrestError:Df}=Io;class ko{static detectEnvironment(){var e;if(typeof WebSocket!="undefined")return{type:"native",constructor:WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocket!="undefined")return{type:"native",constructor:globalThis.WebSocket};if(typeof global!="undefined"&&typeof global.WebSocket!="undefined")return{type:"native",constructor:global.WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocketPair!="undefined"&&typeof globalThis.WebSocket=="undefined")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis!="undefined"&&globalThis.EdgeRuntime||typeof navigator!="undefined"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process!="undefined"){const t=process.versions;if(t&&t.node){const r=t.node,n=parseInt(r.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket!="undefined"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch(e){return!1}}}const Lo="2.15.5",To=`realtime-js/${Lo}`,Po="1.0.0",Mn=1e4,Oo=1e3,Mo=100;var wr;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(wr||(wr={}));var W;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(W||(W={}));var Ce;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(Ce||(Ce={}));var xn;(function(i){i.websocket="websocket"})(xn||(xn={}));var ft;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(ft||(ft={}));class xo{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),s=t.getUint8(2);let o=this.HEADER_LENGTH+2;const c=r.decode(e.slice(o,o+n));o=o+n;const a=r.decode(e.slice(o,o+s));o=o+s;const l=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:c,event:a,payload:l}}}class pa{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var $;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})($||($={}));const hi=(i,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,o)=>(s[o]=Ho(o,i,e,n),s),{})},Ho=(i,e,t,r)=>{const n=e.find(c=>c.name===i),s=n==null?void 0:n.type,o=t[i];return s&&!r.includes(s)?ga(s,o):Hn(o)},ga=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return $o(e,t)}switch(i){case $.bool:return Do(e);case $.float4:case $.float8:case $.int2:case $.int4:case $.int8:case $.numeric:case $.oid:return Ro(e);case $.json:case $.jsonb:return Vo(e);case $.timestamp:return jo(e);case $.abstime:case $.date:case $.daterange:case $.int4range:case $.int8range:case $.money:case $.reltime:case $.text:case $.time:case $.timestamptz:case $.timetz:case $.tsrange:case $.tstzrange:return Hn(e);default:return Hn(e)}},Hn=i=>i,Do=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},Ro=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},Vo=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},$o=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let s;const o=i.slice(1,t);try{s=JSON.parse("["+o+"]")}catch(c){s=o?o.split(","):[]}return s.map(c=>ga(e,c))}return i},jo=i=>typeof i=="string"?i.replace(" ","T"):i,ma=i=>{let e=i;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class on{constructor(e,t,r={},n=Mn){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var fi;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(fi||(fi={}));class br{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:s,onLeave:o,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=br.syncState(this.state,n,s,o),this.pendingDiffs.forEach(a=>{this.state=br.syncDiff(this.state,a,s,o)}),this.pendingDiffs=[],c()}),this.channel._on(r.diff,{},n=>{const{onJoin:s,onLeave:o,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=br.syncDiff(this.state,n,s,o),c())}),this.onJoin((n,s,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:s,newPresences:o})}),this.onLeave((n,s,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const s=this.cloneDeep(e),o=this.transformState(t),c={},a={};return this.map(s,(l,u)=>{o[l]||(a[l]=u)}),this.map(o,(l,u)=>{const d=s[l];if(d){const h=u.map(b=>b.presence_ref),p=d.map(b=>b.presence_ref),m=u.filter(b=>p.indexOf(b.presence_ref)<0),v=d.filter(b=>h.indexOf(b.presence_ref)<0);m.length>0&&(c[l]=m),v.length>0&&(a[l]=v)}else c[l]=u}),this.syncDiff(s,{joins:c,leaves:a},r,n)}static syncDiff(e,t,r,n){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(c,a)=>{var l;const u=(l=e[c])!==null&&l!==void 0?l:[];if(e[c]=this.cloneDeep(a),u.length>0){const d=e[c].map(p=>p.presence_ref),h=u.filter(p=>d.indexOf(p.presence_ref)<0);e[c].unshift(...h)}r(c,u,a)}),this.map(o,(c,a)=>{let l=e[c];if(!l)return;const u=a.map(d=>d.presence_ref);l=l.filter(d=>u.indexOf(d.presence_ref)<0),e[c]=l,n(c,l,a),l.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var pi;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(pi||(pi={}));var Cr;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Cr||(Cr={}));var De;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(De||(De={}));class Zn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=W.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new on(this,Ce.join,this.params,this.timeout),this.rejoinTimer=new pa(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=W.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=W.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=W.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=W.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=W.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ce.reply,{},(n,s)=>{this._trigger(this._replyEventName(s),n)}),this.presence=new br(this),this.broadcastEndpointURL=ma(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==W.closed){const{config:{broadcast:o,presence:c,private:a}}=this.params,l=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[Cr.PRESENCE]&&this.bindings[Cr.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,d={},h={broadcast:o,presence:Object.assign(Object.assign({},c),{enabled:u}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(De.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(De.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",m=>g(this,[m],function*({postgres_changes:p}){var v;if(this.socket.setAuth(),p===void 0){e==null||e(De.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,S=(v=b==null?void 0:b.length)!==null&&v!==void 0?v:0,C=[];for(let w=0;w<S;w++){const y=b[w],{filter:{event:A,schema:I,table:k,filter:U}}=y,M=p&&p[w];if(M&&M.event===A&&M.schema===I&&M.table===k&&M.filter===U)C.push(Object.assign(Object.assign({},y),{id:M.id}));else{this.unsubscribe(),this.state=W.errored,e==null||e(De.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=C,e&&e(De.SUBSCRIBED);return}})).receive("error",p=>{this.state=W.errored,e==null||e(De.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(De.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(r){return g(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return g(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this.state===W.joined&&e===Cr.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}send(r){return g(this,arguments,function*(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:c}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:c,private:this.private}]})};try{const u=yield this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return yield(s=u.body)===null||s===void 0?void 0:s.cancel(),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var c,a,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(c=this.params)===null||c===void 0?void 0:c.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),u.receive("ok",()=>o("ok")),u.receive("error",()=>o("error")),u.receive("timeout",()=>o("timed out"))})})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=W.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ce.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new on(this,Ce.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=W.closed,this.bindings={}}_fetchWithTimeout(e,t,r){return g(this,null,function*(){const n=new AbortController,s=setTimeout(()=>n.abort(),r),o=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(s),o})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new on(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Mo){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,s;const o=e.toLocaleLowerCase(),{close:c,error:a,leave:l,join:u}=Ce;if(r&&[c,a,l,u].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,t,r);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(p=>{var m,v,b;return((m=p.filter)===null||m===void 0?void 0:m.event)==="*"||((b=(v=p.filter)===null||v===void 0?void 0:v.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===o}).map(p=>p.callback(h,r)):(s=this.bindings[o])===null||s===void 0||s.filter(p=>{var m,v,b,S,C,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const y=p.id,A=(m=p.filter)===null||m===void 0?void 0:m.event;return y&&((v=t.ids)===null||v===void 0?void 0:v.includes(y))&&(A==="*"||(A==null?void 0:A.toLocaleLowerCase())===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const y=(C=(S=p==null?void 0:p.filter)===null||S===void 0?void 0:S.event)===null||C===void 0?void 0:C.toLocaleLowerCase();return y==="*"||y===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:v,table:b,commit_timestamp:S,type:C,errors:w}=m;h=Object.assign(Object.assign({},{schema:v,table:b,commit_timestamp:S,eventType:C,new:{},old:{},errors:w}),this._getPayloadRecords(m))}p.callback(h,r)})}_isClosed(){return this.state===W.closed}_isJoined(){return this.state===W.joined}_isJoining(){return this.state===W.joining}_isLeaving(){return this.state===W.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var s;return!(((s=n.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&Zn.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ce.close,{},e)}_onError(e){this._on(Ce.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=W.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=hi(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=hi(e.columns,e.old_record)),t}}const cn=()=>{},Mr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Uo=[1e3,2e3,5e3,1e4],No=1e4,Fo=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class zo{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Mn,this.transport=null,this.heartbeatIntervalMs=Mr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=cn,this.ref=0,this.reconnectTimer=null,this.logger=cn,this.conn=null,this.sendBuffer=[],this.serializer=new xo,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let s;return n?s=n:typeof fetch=="undefined"?s=(...o)=>N(()=>g(this,null,function*(){const{default:c}=yield Promise.resolve().then(()=>nr);return{default:c}}),void 0).then(({default:c})=>c(...o)).catch(c=>{throw new Error(`Failed to load @supabase/node-fetch: ${c.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):s=fetch,(...o)=>s(...o)},!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${xn.websocket}`,this.httpEndpoint=ma(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ko.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Po}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t!=null?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return g(this,null,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return g(this,null,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case wr.connecting:return ft.Connecting;case wr.open:return ft.Open;case wr.closing:return ft.Closing;default:return ft.Closed}}isConnected(){return this.connectionState()===ft.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(s=>s.topic===r);if(n)return n;{const s=new Zn(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:r,payload:n,ref:s}=e,o=()=>{this.encode(e,c=>{var a;(a=this.conn)===null||a===void 0||a.send(c)})};this.log("push",`${t} ${r} (${s})`,n),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e=null){return g(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return g(this,null,function*(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Oo,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Mr.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:s,ref:o}=t,c=o?`(${o})`:"",a=s.status||"";this.log("receive",`${a} ${r} ${n} ${c}`.trim(),s),this.channels.filter(l=>l._isMember(r)).forEach(l=>l._trigger(n,s,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ce.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Fo],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}_performAuth(e=null){return g(this,null,function*(){let t;e?t=e:this.accessToken?t=yield this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:To};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(Ce.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return g(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new pa(()=>g(this,null,function*(){setTimeout(()=>g(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),Mr.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,s,o,c,a,l,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Mn,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:Mr.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(c=e==null?void 0:e.heartbeatCallback)!==null&&c!==void 0?c:cn,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(a=e==null?void 0:e.reconnectAfterMs)!==null&&a!==void 0?a:(d=>Uo[d-1]||No),this.encode=(l=e==null?void 0:e.encode)!==null&&l!==void 0?l:((d,h)=>h(JSON.stringify(d))),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window!="undefined"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Qn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Z(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Bo extends Qn{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Dn extends Qn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var qo=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const ya=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>N(()=>g(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>nr);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Go=()=>qo(void 0,void 0,void 0,function*(){return typeof Response=="undefined"?(yield N(()=>Promise.resolve().then(()=>nr),void 0)).Response:Response}),Rn=i=>{if(Array.isArray(i))return i.map(t=>Rn(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[n]=Rn(r)}),e},Ko=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)};var gt=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const ln=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Wo=(i,e,t)=>gt(void 0,void 0,void 0,function*(){const r=yield Go();i instanceof r&&!(t!=null&&t.noResolveJson)?i.json().then(n=>{const s=i.status||500,o=(n==null?void 0:n.statusCode)||s+"";e(new Bo(ln(n),s,o))}).catch(n=>{e(new Dn(ln(n),n))}):e(new Dn(ln(i),i))}),Zo=(i,e,t,r)=>{const n={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||!r?n:(Ko(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r)):n.body=r,e!=null&&e.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function Lr(i,e,t,r,n,s){return gt(this,void 0,void 0,function*(){return new Promise((o,c)=>{i(t,Zo(e,r,n,s)).then(a=>{if(!a.ok)throw a;return r!=null&&r.noResolveJson?a:a.json()}).then(a=>o(a)).catch(a=>Wo(a,c,r))})})}function Xr(i,e,t,r){return gt(this,void 0,void 0,function*(){return Lr(i,"GET",e,t,r)})}function Le(i,e,t,r,n){return gt(this,void 0,void 0,function*(){return Lr(i,"POST",e,r,n,t)})}function Vn(i,e,t,r,n){return gt(this,void 0,void 0,function*(){return Lr(i,"PUT",e,r,n,t)})}function Qo(i,e,t,r){return gt(this,void 0,void 0,function*(){return Lr(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function va(i,e,t,r,n){return gt(this,void 0,void 0,function*(){return Lr(i,"DELETE",e,r,n,t)})}var ie=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const Yo={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},gi={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Jo{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ya(n)}uploadOrUpdate(e,t,r,n){return ie(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},gi),n);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const a=o.metadata;typeof Blob!="undefined"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),a&&s.append("metadata",this.encodeMetadata(a)),s.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(s=r,s.append("cacheControl",o.cacheControl),a&&s.append("metadata",this.encodeMetadata(a))):(s=r,c["cache-control"]=`max-age=${o.cacheControl}`,c["content-type"]=o.contentType,a&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),n!=null&&n.headers&&(c=Object.assign(Object.assign({},c),n.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),d=yield(e=="PUT"?Vn:Le)(this.fetch,`${this.url}/object/${u}`,s,Object.assign({headers:c},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(s){if(Z(s))return{data:null,error:s};throw s}})}upload(e,t,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return ie(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),c=new URL(this.url+`/object/upload/sign/${o}`);c.searchParams.set("token",t);try{let a;const l=Object.assign({upsert:gi.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob!="undefined"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",l.cacheControl),a.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(a=r,a.append("cacheControl",l.cacheControl)):(a=r,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const d=yield Vn(this.fetch,c.toString(),a,{headers:u});return{data:{path:s,fullPath:d.Key},error:null}}catch(a){if(Z(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return ie(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const s=yield Le(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+s.url),c=o.searchParams.get("token");if(!c)throw new Qn("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:c},error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}update(e,t,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return ie(this,void 0,void 0,function*(){try{return{data:yield Le(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}copy(e,t,r){return ie(this,void 0,void 0,function*(){try{return{data:{path:(yield Le(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return ie(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),s=yield Le(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return ie(this,void 0,void 0,function*(){try{const n=yield Le(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}download(e,t){return ie(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)!="undefined"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=s?`?${s}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield Xr(this.fetch,`${this.url}/${n}/${c}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(Z(c))return{data:null,error:c};throw c}})}info(e){return ie(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Xr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Rn(r),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}exists(e){return ie(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Qo(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Z(r)&&r instanceof Dn){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&n.push(s);const c=typeof(t==null?void 0:t.transform)!="undefined"?"render/image":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});a!==""&&n.push(a);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${r}${l}`)}}}remove(e){return ie(this,void 0,void 0,function*(){try{return{data:yield va(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}list(e,t,r){return ie(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Yo),t),{prefix:e||""});return{data:yield Le(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}})}listV2(e,t){return ie(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Le(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer!="undefined"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Xo="2.11.1",ec={"X-Client-Info":`storage-js/${Xo}`};var St=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};class tc{constructor(e,t={},r,n){const s=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href,this.headers=Object.assign(Object.assign({},ec),t),this.fetch=ya(r)}listBuckets(){return St(this,void 0,void 0,function*(){try{return{data:yield Xr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Z(e))return{data:null,error:e};throw e}})}getBucket(e){return St(this,void 0,void 0,function*(){try{return{data:yield Xr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return St(this,void 0,void 0,function*(){try{return{data:yield Le(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return St(this,void 0,void 0,function*(){try{return{data:yield Vn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}})}emptyBucket(e){return St(this,void 0,void 0,function*(){try{return{data:yield Le(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}deleteBucket(e){return St(this,void 0,void 0,function*(){try{return{data:yield va(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}})}}class rc extends tc{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new Jo(this.url,this.headers,e,this.fetch)}}const nc="2.57.2";let mr="";typeof Deno!="undefined"?mr="deno":typeof document!="undefined"?mr="web":typeof navigator!="undefined"&&navigator.product==="ReactNative"?mr="react-native":mr="node";const ic={"X-Client-Info":`supabase-js-${mr}/${nc}`},sc={headers:ic},ac={schema:"public"},oc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},cc={};var lc=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};const uc=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=ca:e=fetch,(...t)=>e(...t)},dc=()=>typeof Headers=="undefined"?la:Headers,hc=(i,e,t)=>{const r=uc(t),n=dc();return(s,o)=>lc(void 0,void 0,void 0,function*(){var c;const a=(c=yield e())!==null&&c!==void 0?c:i;let l=new n(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",i),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),r(s,Object.assign(Object.assign({},o),{headers:l}))})};var fc=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};function pc(i){return i.endsWith("/")?i:i+"/"}function gc(i,e){var t,r;const{db:n,auth:s,realtime:o,global:c}=i,{db:a,auth:l,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},a),n),auth:Object.assign(Object.assign({},l),s),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),c),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(r=c==null?void 0:c.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>fc(this,void 0,void 0,function*(){return""})};return i.accessToken?h.accessToken=i.accessToken:delete h.accessToken,h}const _a="2.71.1",Rt=30*1e3,$n=3,un=$n*Rt,mc="http://localhost:9999",yc="supabase.auth.token",vc={"X-Client-Info":`gotrue-js/${_a}`},jn="X-Supabase-Api-Version",wa={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},_c=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,wc=600*1e3;class Yn extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function E(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class bc extends Yn{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Cc(i){return E(i)&&i.name==="AuthApiError"}class ba extends Yn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ye extends Yn{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class qe extends Ye{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Sc(i){return E(i)&&i.name==="AuthSessionMissingError"}class xr extends Ye{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Hr extends Ye{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Dr extends Ye{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ac(i){return E(i)&&i.name==="AuthImplicitGrantRedirectError"}class mi extends Ye{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Un extends Ye{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function dn(i){return E(i)&&i.name==="AuthRetryableFetchError"}class yi extends Ye{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Nn extends Ye{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const en="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),vi=` 	
\r=`.split(""),Ic=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<vi.length;e+=1)i[vi[e].charCodeAt(0)]=-2;for(let e=0;e<en.length;e+=1)i[en[e].charCodeAt(0)]=e;return i})();function _i(i,e,t){if(i!==null)for(e.queue=e.queue<<8|i,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(en[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(en[r]),e.queuedBits-=6}}function Ca(i,e,t){const r=Ic[i];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function wi(i){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},s=o=>{Lc(o,r,t)};for(let o=0;o<i.length;o+=1)Ca(i.charCodeAt(o),n,s);return e.join("")}function Ec(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function kc(i,e){for(let t=0;t<i.length;t+=1){let r=i.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(i.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Ec(r,e)}}function Lc(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let r=1;r<6;r+=1)if((i>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Tc(i){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<i.length;n+=1)Ca(i.charCodeAt(n),t,r);return new Uint8Array(e)}function Pc(i){const e=[];return kc(i,t=>e.push(t)),new Uint8Array(e)}function Oc(i){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return i.forEach(n=>_i(n,t,r)),_i(null,t,r),e.join("")}function Mc(i){return Math.round(Date.now()/1e3)+i}function xc(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const be=()=>typeof window!="undefined"&&typeof document!="undefined",tt={tested:!1,writable:!1},Sa=()=>{if(!be())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch(e){return!1}if(tt.tested)return tt.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),tt.tested=!0,tt.writable=!0}catch(e){tt.tested=!0,tt.writable=!1}return tt.writable};function Hc(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,s)=>{e[s]=n})}catch(r){}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Aa=i=>{let e;return i?e=i:typeof fetch=="undefined"?e=(...t)=>N(()=>g(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>nr);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Dc=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Vt=(i,e,t)=>g(null,null,function*(){yield i.setItem(e,JSON.stringify(t))}),rt=(i,e)=>g(null,null,function*(){const t=yield i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(r){return t}}),Ue=(i,e)=>g(null,null,function*(){yield i.removeItem(e)});class sn{constructor(){this.promise=new sn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}sn.promiseConstructor=Promise;function hn(i){const e=i.split(".");if(e.length!==3)throw new Nn("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!_c.test(e[r]))throw new Nn("JWT not in base64url format");return{header:JSON.parse(wi(e[0])),payload:JSON.parse(wi(e[1])),signature:Tc(e[2]),raw:{header:e[0],payload:e[1]}}}function Rc(i){return g(this,null,function*(){return yield new Promise(e=>{setTimeout(()=>e(null),i)})})}function Vc(i,e){return new Promise((r,n)=>{g(null,null,function*(){for(let s=0;s<1/0;s++)try{const o=yield i(s);if(!e(s,null,o)){r(o);return}}catch(o){if(!e(s,o)){n(o);return}}})})}function $c(i){return("0"+i.toString(16)).substr(-2)}function jc(){const e=new Uint32Array(56);if(typeof crypto=="undefined"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let s=0;s<56;s++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,$c).join("")}function Uc(i){return g(this,null,function*(){const t=new TextEncoder().encode(i),r=yield crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(s=>String.fromCharCode(s)).join("")})}function Nc(i){return g(this,null,function*(){if(!(typeof crypto!="undefined"&&typeof crypto.subtle!="undefined"&&typeof TextEncoder!="undefined"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=yield Uc(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function At(i,e,t=!1){return g(this,null,function*(){const r=jc();let n=r;t&&(n+="/PASSWORD_RECOVERY"),yield Vt(i,`${e}-code-verifier`,n);const s=yield Nc(r);return[s,r===s?"plain":"s256"]})}const Fc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function zc(i){const e=i.headers.get(jn);if(!e||!e.match(Fc))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(t){return null}}function Bc(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function qc(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Gc=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function It(i){if(!Gc.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function fn(){const i={};return new Proxy(i,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function bi(i){return JSON.parse(JSON.stringify(i))}var Kc=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};const lt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Wc=[502,503,504];function Ci(i){return g(this,null,function*(){var e;if(!Dc(i))throw new Un(lt(i),0);if(Wc.includes(i.status))throw new Un(lt(i),i.status);let t;try{t=yield i.json()}catch(s){throw new ba(lt(s),s)}let r;const n=zc(i);if(n&&n.getTime()>=wa["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new yi(lt(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new qe}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new yi(lt(t),i.status,t.weak_password.reasons);throw new bc(lt(t),i.status||500,r)})}const Zc=(i,e,t,r)=>{const n={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};function T(i,e,t,r){return g(this,null,function*(){var n;const s=Object.assign({},r==null?void 0:r.headers);s[jn]||(s[jn]=wa["2024-01-01"].name),r!=null&&r.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const c=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",a=yield Qc(i,e,t+c,{headers:s,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(a):{data:Object.assign({},a),error:null}})}function Qc(i,e,t,r,n,s){return g(this,null,function*(){const o=Zc(e,r,n,s);let c;try{c=yield i(t,Object.assign({},o))}catch(a){throw console.error(a),new Un(lt(a),0)}if(c.ok||(yield Ci(c)),r!=null&&r.noResolveJson)return c;try{return yield c.json()}catch(a){yield Ci(a)}})}function He(i){var e;let t=null;el(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=Mc(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function Si(i){const e=He(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function Ke(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function Yc(i){return{data:i,error:null}}function Jc(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:s}=i,o=Kc(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:s},a=Object.assign({},o);return{data:{properties:c,user:a},error:null}}function Xc(i){return i}function el(i){return i.access_token&&i.refresh_token&&i.expires_in}const pn=["global","local","others"];var tl=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};class rl{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Aa(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r){return g(this,arguments,function*(e,t=pn[0]){if(pn.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${pn.join(", ")}`);try{return yield T(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(E(n))return{data:null,error:n};throw n}})}inviteUserByEmail(r){return g(this,arguments,function*(e,t={}){try{return yield T(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ke})}catch(n){if(E(n))return{data:{user:null},error:n};throw n}})}generateLink(e){return g(this,null,function*(){try{const{options:t}=e,r=tl(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),yield T(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Jc,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(E(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return g(this,null,function*(){try{return yield T(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ke})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return g(this,null,function*(){var t,r,n,s,o,c,a;try{const l={nextPage:null,lastPage:0,total:0},u=yield T(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:""},xform:Xc});if(u.error)throw u.error;const d=yield u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(a=(c=u.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&a!==void 0?a:[];return p.length>0&&(p.forEach(m=>{const v=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(m.split(";")[1].split("=")[1]);l[`${b}Page`]=v}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(E(l))return{data:{users:[]},error:l};throw l}})}getUserById(e){return g(this,null,function*(){It(e);try{return yield T(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ke})}catch(t){if(E(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return g(this,null,function*(){It(e);try{return yield T(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ke})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return g(this,null,function*(){It(e);try{return yield T(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ke})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return g(this,null,function*(){It(e.userId);try{const{data:t,error:r}=yield T(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(E(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return g(this,null,function*(){It(e.userId),It(e.id);try{return{data:yield T(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}})}}function Ai(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function nl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(i){typeof self!="undefined"&&(self.globalThis=self)}}const Et={debug:!!(globalThis&&Sa()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ia extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class il extends Ia{}function sl(i,e,t){return g(this,null,function*(){Et.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Et.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},n=>g(null,null,function*(){if(n){Et.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,n.name);try{return yield t()}finally{Et.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,n.name)}}else{if(e===0)throw Et.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new il(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Et.debug)try{const s=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield t()}})))})}nl();const al={url:mc,storageKey:yc,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:vc,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function Ii(i,e,t){return g(this,null,function*(){return yield t()})}const kt={};class Er{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Er.nextInstanceID,Er.nextInstanceID+=1,this.instanceID>0&&be()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},al),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new rl({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Aa(n.fetch),this.lock=n.lock||Ii,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:be()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=sl:this.lock=Ii,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Sa()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ai(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Ai(this.memoryStorage)),be()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",s=>g(this,null,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}get jwks(){var e,t;return(t=(e=kt[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){kt[this.storageKey]=Object.assign(Object.assign({},kt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=kt[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){kt[this.storageKey]=Object.assign(Object.assign({},kt[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${_a}) ${new Date().toISOString()}`,...e),this}initialize(){return g(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=g(this,null,function*(){return yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return g(this,null,function*(){var e;try{const t=Hc(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":(yield this._isPKCECallback(t))&&(r="pkce"),be()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:s}=yield this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),Ac(s)){const a=(e=s.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:s}}return yield this._removeSession(),{error:s}}const{session:o,redirectType:c}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",c),yield this._saveSession(o),setTimeout(()=>g(this,null,function*(){c==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",o):yield this._notifyAllSubscribers("SIGNED_IN",o)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return E(t)?{error:t}:{error:new ba("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return g(this,null,function*(){var t,r,n;try{const s=yield T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:He}),{data:o,error:c}=s;if(c||!o)return{data:{user:null,session:null},error:c};const a=o.session,l=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(E(s))return{data:{user:null,session:null},error:s};throw s}})}signUp(e){return g(this,null,function*(){var t,r,n;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=yield At(this.storage,this.storageKey)),s=yield T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:d,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:p,code_challenge_method:m},xform:He})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=yield T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(n=h==null?void 0:h.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:He})}else throw new Hr("You must provide either an email or phone number and a password");const{data:o,error:c}=s;if(c||!o)return{data:{user:null,session:null},error:c};const a=o.session,l=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(E(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithPassword(e){return g(this,null,function*(){try{let t;if("email"in e){const{email:s,password:o,options:c}=e;t=yield T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Si})}else if("phone"in e){const{phone:s,password:o,options:c}=e;t=yield T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Si})}else throw new Hr("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new xr}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return g(this,null,function*(){var t,r,n,s;return yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})})}exchangeCodeForSession(e){return g(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>g(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return g(this,null,function*(){const{chain:t}=e;if(t==="solana")return yield this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)})}signInWithSolana(e){return g(this,null,function*(){var t,r,n,s,o,c,a,l,u,d,h,p;let m,v;if("message"in e)m=e.message,v=e.signature;else{const{chain:b,wallet:S,statement:C,options:w}=e;let y;if(be())if(typeof S=="object")y=S;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))y=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=S}const A=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in y&&y.signIn){const I=yield y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:A.host,uri:A.href}),C?{statement:C}:null));let k;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")k=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)k=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)m=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),v=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in y)||typeof y.signMessage!="function"||!("publicKey"in y)||typeof y!="object"||!y.publicKey||!("toBase58"in y.publicKey)||typeof y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${A.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...C?["",C,""]:[""],"Version: 1",`URI: ${A.href}`,`Issued At: ${(n=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((s=w==null?void 0:w.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(u=w==null?void 0:w.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const I=yield y.signMessage(new TextEncoder().encode(m),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=I}}try{const{data:b,error:S}=yield T(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Oc(v)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:He});if(S)throw S;return!b||!b.session||!b.user?{data:{user:null,session:null},error:new xr}:(b.session&&(yield this._saveSession(b.session),yield this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:S})}catch(b){if(E(b))return{data:{user:null,session:null},error:b};throw b}})}_exchangeCodeForSession(e){return g(this,null,function*(){const t=yield rt(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t!=null?t:"").split("/");try{const{data:s,error:o}=yield T(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:He});if(yield Ue(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new xr}:(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:n!=null?n:null}),error:o})}catch(s){if(E(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}})}signInWithIdToken(e){return g(this,null,function*(){try{const{options:t,provider:r,token:n,access_token:s,nonce:o}=e,c=yield T(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:He}),{data:a,error:l}=c;return l?{data:{user:null,session:null},error:l}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new xr}:(a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l})}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return g(this,null,function*(){var t,r,n,s,o;try{if("email"in e){const{email:c,options:a}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=yield At(this.storage,this.storageKey));const{error:d}=yield T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(r=a==null?void 0:a.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:c,options:a}=e,{data:l,error:u}=yield T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(n=a==null?void 0:a.data)!==null&&n!==void 0?n:{},create_user:(s=a==null?void 0:a.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(o=a==null?void 0:a.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Hr("You must provide either an email or phone number.")}catch(c){if(E(c))return{data:{user:null,session:null},error:c};throw c}})}verifyOtp(e){return g(this,null,function*(){var t,r;try{let n,s;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:c}=yield T(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:n,xform:He});if(c)throw c;if(!o)throw new Error("An error occurred on token verification.");const a=o.session,l=o.user;return a!=null&&a.access_token&&(yield this._saveSession(a),yield this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(E(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithSSO(e){return g(this,null,function*(){var t,r,n;try{let s=null,o=null;return this.flowType==="pkce"&&([s,o]=yield At(this.storage,this.storageKey)),yield T(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:o}),headers:this.headers,xform:Yc})}catch(s){if(E(s))return{data:null,error:s};throw s}})}reauthenticate(){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return g(this,null,function*(){try{return yield this._useSession(e=>g(this,null,function*(){const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new qe;const{error:n}=yield T(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}}))}catch(e){if(E(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return g(this,null,function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:s}=e,{error:o}=yield T(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:n,options:s}=e,{data:o,error:c}=yield T(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:c}}throw new Hr("You must provide either an email or phone number and a type")}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return this._useSession(t=>g(this,null,function*(){return t}))}))})}_acquireLock(e,t){return g(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=g(this,null,function*(){return yield r,yield t()});return this.pendingInLock.push(g(this,null,function*(){try{yield n}catch(s){}})),n}return yield this.lock(`lock:${this.storageKey}`,e,()=>g(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push(g(this,null,function*(){try{yield r}catch(n){}})),yield r;this.pendingInLock.length;){const n=[...this.pendingInLock];yield Promise.all(n),this.pendingInLock.splice(0,n.length)}return yield r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return g(this,null,function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}})}__loadSession(){return g(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=yield rt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<un:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=yield rt(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=fn()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(a,l,u)=>(!o&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,l,u))})}return{data:{session:e},error:null}}const{session:n,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return g(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return g(this,null,function*(){try{return e?yield T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ke}):yield this._useSession(t=>g(this,null,function*(){var r,n,s;const{data:o,error:c}=t;if(c)throw c;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new qe}:yield T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0,xform:Ke})}))}catch(t){if(E(t))return Sc(t)&&(yield this._removeSession(),yield Ue(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}})}updateUser(r){return g(this,arguments,function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._updateUser(e,t)}))})}_updateUser(r){return g(this,arguments,function*(e,t={}){try{return yield this._useSession(n=>g(this,null,function*(){const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new qe;const c=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=yield At(this.storage,this.storageKey));const{data:u,error:d}=yield T(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:c.access_token,xform:Ke});if(d)throw d;return c.user=u.user,yield this._saveSession(c),yield this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}}))}catch(n){if(E(n))return{data:{user:null},error:n};throw n}})}setSession(e){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return g(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new qe;const t=Date.now()/1e3;let r=t,n=!0,s=null;const{payload:o}=hn(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{session:c,error:a}=yield this._callRefreshToken(e.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!c)return{data:{user:null,session:null},error:null};s=c}else{const{data:c,error:a}=yield this._getUser(e.access_token);if(a)throw a;s={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(s),yield this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(E(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return g(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;if(!e){const{data:o,error:c}=t;if(c)throw c;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new qe;const{session:n,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(E(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromURL(e,t){return g(this,null,function*(){try{if(!be())throw new Dr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Dr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new mi("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Dr("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new mi("No code detected.");const{data:C,error:w}=yield this._exchangeCodeForSession(e.code);if(w)throw w;const y=new URL(window.location.href);return y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",y.toString()),{data:{session:C.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:s,refresh_token:o,expires_in:c,expires_at:a,token_type:l}=e;if(!s||!c||!o||!l)throw new Dr("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(c);let h=u+d;a&&(h=parseInt(a));const p=h-u;p*1e3<=Rt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const m=h-d;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,u);const{data:v,error:b}=yield this._getUser(s);if(b)throw b;const S={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:d,expires_at:h,refresh_token:o,token_type:l,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:e.type},error:null}}catch(r){if(E(r))return{data:{session:null,redirectType:null},error:r};throw r}})}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}_isPKCECallback(e){return g(this,null,function*(){const t=yield rt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)})}signOut(){return g(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return g(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;if(s)return{error:s};const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:c}=yield this.admin.signOut(o,e);if(c&&!(Cc(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(yield this._removeSession(),yield Ue(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){const t=xc(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),g(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){this._emitInitialSession(t)}))}),{data:{subscription:r}}}_emitInitialSession(e){return g(this,null,function*(){return yield this._useSession(t=>g(this,null,function*(){var r,n;try{const{data:{session:s},error:o}=t;if(o)throw o;yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){yield(n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}}))})}resetPasswordForEmail(r){return g(this,arguments,function*(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=yield At(this.storage,this.storageKey,!0));try{return yield T(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(E(o))return{data:null,error:o};throw o}})}getUserIdentities(){return g(this,null,function*(){var e;try{const{data:t,error:r}=yield this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(E(t))return{data:null,error:t};throw t}})}linkIdentity(e){return g(this,null,function*(){var t;try{const{data:r,error:n}=yield this._useSession(s=>g(this,null,function*(){var o,c,a,l,u;const{data:d,error:h}=s;if(h)throw h;const p=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return yield T(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(l=d.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})}));if(n)throw n;return be()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(E(r))return{data:{provider:e.provider,url:null},error:r};throw r}})}unlinkIdentity(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r,n;const{data:s,error:o}=t;if(o)throw o;return yield T(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})}))}catch(t){if(E(t))return{data:null,error:t};throw t}})}_refreshAccessToken(e){return g(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield Vc(n=>g(this,null,function*(){return n>0&&(yield Rc(200*Math.pow(2,n-1))),this._debug(t,"refreshing attempt",n),yield T(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:He})}),(n,s)=>{const o=200*Math.pow(2,n);return s&&dn(s)&&Date.now()+o-r<Rt})}catch(r){if(this._debug(t,"error",r),E(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return g(this,null,function*(){const r=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),be()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){return g(this,null,function*(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=yield rt(this.storage,this.storageKey);if(n&&this.userStorage){let o=yield rt(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},yield Vt(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:fn()}else if(n&&!n.user&&!n.user){const o=yield rt(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,yield Ue(this.storage,this.storageKey+"-user"),yield Vt(this.storage,this.storageKey,n)):n.user=fn()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&(yield this._removeSession());return}const s=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<un;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${un}s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=yield this._callRefreshToken(n.refresh_token);o&&(console.error(o),dn(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:c}=yield this._getUser(n.access_token);!c&&(o!=null&&o.user)?(n.user=o.user,yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else yield this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}})}_callRefreshToken(e){return g(this,null,function*(){var t,r;if(!e)throw new qe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new sn;const{data:s,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new qe;yield this._saveSession(s.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const c={session:s.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(s){if(this._debug(n,"error",s),E(s)){const o={session:null,error:s};return dn(s)||(yield this._removeSession()),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(n,"end")}})}_notifyAllSubscribers(e,t,r=!0){return g(this,null,function*(){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(c=>g(this,null,function*(){try{yield c.callback(e,t)}catch(a){s.push(a)}}));if(yield Promise.all(o),s.length>0){for(let c=0;c<s.length;c+=1)console.error(s[c]);throw s[0]}}finally{this._debug(n,"end")}})}_saveSession(e){return g(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&(yield Vt(this.userStorage,this.storageKey+"-user",{user:t.user}));const n=Object.assign({},t);delete n.user;const s=bi(n);yield Vt(this.storage,this.storageKey,s)}else{const n=bi(t);yield Vt(this.storage,this.storageKey,n)}})}_removeSession(){return g(this,null,function*(){this._debug("#_removeSession()"),yield Ue(this.storage,this.storageKey),yield Ue(this.storage,this.storageKey+"-code-verifier"),yield Ue(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Ue(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&be()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return g(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Rt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno!="undefined"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(()=>g(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return g(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return g(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return g(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return g(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>g(this,null,function*(){try{const e=Date.now();try{return yield this._useSession(t=>g(this,null,function*(){const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/Rt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Rt}ms, refresh threshold is ${$n} ticks`),n<=$n&&(yield this._callRefreshToken(r.refresh_token))}))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(e.isAcquireTimeout||e instanceof Ia)this._debug("auto refresh token tick lock not available");else throw e}})}_handleVisibilityChange(){return g(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!be()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>g(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return g(this,null,function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>g(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t,r){return g(this,null,function*(){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,o]=yield At(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(c.toString())}if(r!=null&&r.queryParams){const s=new URLSearchParams(r.queryParams);n.push(s.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`})}_unenroll(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;return s?{data:null,error:s}:yield T(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(E(t))return{data:null,error:t};throw t}})}_enroll(e){return g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r,n;const{data:s,error:o}=t;if(o)return{data:null,error:o};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=yield T(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((n=a==null?void 0:a.totp)===null||n===void 0)&&n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(t){if(E(t))return{data:null,error:t};throw t}})}_verify(e){return g(this,null,function*(){return this._acquireLock(-1,()=>g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;if(s)return{data:null,error:s};const{data:o,error:c}=yield T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:c})}))}catch(t){if(E(t))return{data:null,error:t};throw t}}))})}_challenge(e){return g(this,null,function*(){return this._acquireLock(-1,()=>g(this,null,function*(){try{return yield this._useSession(t=>g(this,null,function*(){var r;const{data:n,error:s}=t;return s?{data:null,error:s}:yield T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(E(t))return{data:null,error:t};throw t}}))})}_challengeAndVerify(e){return g(this,null,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return g(this,null,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),s=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:n,phone:s},error:null}})}_getAuthenticatorAssuranceLevel(){return g(this,null,function*(){return this._acquireLock(-1,()=>g(this,null,function*(){return yield this._useSession(e=>g(this,null,function*(){var t,r;const{data:{session:n},error:s}=e;if(s)return{data:null,error:s};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=hn(n.access_token);let c=null;o.aal&&(c=o.aal);let a=c;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const u=o.amr||[];return{data:{currentLevel:c,nextLevel:a,currentAuthenticationMethods:u},error:null}}))}))})}fetchJwk(r){return g(this,arguments,function*(e,t={keys:[]}){let n=t.keys.find(a=>a.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+wc>s)return n;const{data:o,error:c}=yield T(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(a=>a.kid===e),!n)?null:n})}getClaims(r){return g(this,arguments,function*(e,t={}){try{let n=e;if(!n){const{data:m,error:v}=yield this.getSession();if(v||!m.session)return{data:null,error:v};n=m.session.access_token}const{header:s,payload:o,signature:c,raw:{header:a,payload:l}}=hn(n);t!=null&&t.allowExpired||Bc(o.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:yield this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:m}=yield this.getUser(n);if(m)throw m;return{data:{claims:o,header:s,signature:c},error:null}}const d=qc(s.alg),h=yield crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!(yield crypto.subtle.verify(d,h,c,Pc(`${a}.${l}`))))throw new Nn("Invalid JWT signature");return{data:{claims:o,header:s,signature:c},error:null}}catch(n){if(E(n))return{data:null,error:n};throw n}})}}Er.nextInstanceID=0;const ol=Er;class cl extends ol{constructor(e){super(e)}}var ll=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(u){try{l(r.next(u))}catch(d){o(d)}}function a(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):n(u.value).then(c,a)}l((r=r.apply(i,e||[])).next())})};class ul{constructor(e,t,r){var n,s,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=pc(e),a=new URL(c);this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,u={db:ac,realtime:cc,auth:Object.assign(Object.assign({},oc),{storageKey:l}),global:sc},d=gc(r!=null?r:{},u);this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=hc(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Eo(new URL("rest/v1",a).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new rc(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new mo(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ll(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:o,flowType:c,lock:a,debug:l},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new cl({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,flowType:c,lock:a,debug:l,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new zo(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const dl=(i,e,t)=>new ul(i,e,t);function hl(){if(typeof window!="undefined"||typeof process=="undefined")return!1;const i=process.version;if(i==null)return!1;const e=i.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}hl()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Zr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"",VITE_SUPABASE_URL:""};var Qr={};const Ve=(i,e="")=>{if(typeof import.meta!="undefined"&&Zr&&i in Zr)return Zr[i];if(typeof process!="undefined"&&(process!=null&&Qr)&&i in Qr)return Qr[i];if(e===void 0)throw new Error(`Missing required env var: ${i}`);return e},Sr=()=>{var i,e;return typeof import.meta!="undefined"&&((i=Zr)==null?void 0:i.DEV)===!0||typeof process!="undefined"&&((e=process==null?void 0:Qr)==null?void 0:e.NODE_ENV)==="development"},Rf=()=>typeof window!="undefined";var Ei={},ki,Li;const fl=Ve("VITE_SUPABASE_URL","https://mock.supabase.co"),pl=Ve("VITE_SUPABASE_ANON_KEY","mock-anon-key"),gl=typeof process!="undefined"&&((ki=process==null?void 0:Ei)==null?void 0:ki.NODE_ENV)==="test"||typeof process!="undefined"&&((Li=process==null?void 0:Ei)==null?void 0:Li.CI)==="true",Ti=Ve("SUPABASE_SERVICE_ROLE_KEY",""),ml=gl&&Ti?Ti:pl,_=dl(fl,ml),yl=Object.freeze(Object.defineProperty({__proto__:null,supabase:_},Symbol.toStringTag,{value:"Module"})),Pi={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},vl=()=>"INFO",Ea=vl(),Ie=i=>Pi[i]<=Pi[Ea],H={error:(i,...e)=>{Ie("ERROR")&&console.error(i,...e)},warn:(i,...e)=>{Ie("WARN")&&console.warn(i,...e)},info:(i,...e)=>{Ie("INFO")&&console.info(i,...e)},debug:(i,...e)=>{Ie("DEBUG")&&console.log(i,...e)},verbose:(i,...e)=>{Ie("VERBOSE")&&console.log(i,...e)},perf:(i,...e)=>{Ie("DEBUG")&&console.log(`[PERF] ${i}`,...e)},security:(i,...e)=>{Ie("INFO")&&console.log(`[SECURITY] ${i}`,...e)},audit:(i,...e)=>{Ie("INFO")&&console.log(`[AUDIT] ${i}`,...e)},realtime:(i,...e)=>{Ie("DEBUG")&&console.log(i,...e)},getLevel:()=>Ea,isEnabled:i=>Ie(i)};class Nt{constructor(){}static getInstance(){return Nt.instance||(Nt.instance=new Nt),Nt.instance}getDefaultFacilityId(){const e=Ve("VITE_DEFAULT_FACILITY_ID","");if(e)return e;throw new Error("VITE_DEFAULT_FACILITY_ID environment variable must be set in production")}isValidFacilityId(e){return!e||e.trim()===""?!1:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}getOAuthFacilityConfig(){return{facility_id:this.getDefaultFacilityId()}}}const _l=Nt.getInstance();var gn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const ka=P.createContext(void 0),Vf=({children:i})=>{const[e,t]=P.useState(null),[r,n]=P.useState(!1),[s,o]=P.useState(!1),[c,a]=P.useState(!1),[l,u]=P.useState(0),d=1800*1e3,h=()=>e?!e.name||e.name.trim()===""?e.email||"Unknown User":e.name:"Unknown User",p=S=>{console.log(" UserContext: handleSetCurrentUser called with:",S?`${S.name} (${S.email})`:"null"),t(S),S?(localStorage.setItem("currentUser",JSON.stringify(S)),u(Date.now())):(localStorage.removeItem("currentUser"),u(0))},m=P.useCallback(()=>gn(null,null,function*(){if(r)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log(" UserContext: No auth token found, skipping refreshUserData");return}console.log(" UserContext: Starting refreshUserData...");const C=Date.now();if(e&&C-l<d){H.info(" UserContext: Using cached user data"),a(!0);return}try{n(!0),H.info(" UserContext: Starting user data refresh...");const{data:{session:w}}=yield _.auth.getSession();if(!w){H.info(" UserContext: No active Supabase session, skipping refresh"),a(!0);return}const y=new Promise((I,k)=>{setTimeout(()=>k(new Error("User data fetch timeout")),5e3)}),A=gn(null,null,function*(){var I,k;const U=Date.now(),{data:{user:M},error:Ae}=yield _.auth.getUser();if(Ae){console.error(" UserContext: Auth error:",Ae);return}if(!M){H.info(" UserContext: No authenticated user found");return}H.info(" UserContext: Found authenticated user:",M.id);const se=Date.now()-U;H.info(` UserContext: Auth fetch took ${se}ms`);const je=Date.now(),{data:F,error:Oe}=yield _.from("users").select("*").eq("id",M.id).single();if(Oe){if(console.error(" UserContext: Failed to fetch user profile:",Oe),Oe.code==="PGRST116"){console.log(" UserContext: Creating missing user profile...");const{error:et}=yield _.from("users").insert({id:M.id,email:M.email,first_name:M.email.split("@")[0],last_name:"",role:"user",facility_id:_l.getDefaultFacilityId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(et){console.error(" UserContext: Failed to create user profile:",et);return}console.log(" UserContext: User profile created successfully");const{data:ce}=yield _.from("users").select("*").eq("id",M.id).single();if(ce){const yt={id:ce.id,name:`${ce.first_name||""} ${ce.last_name||""}`.trim()||((I=ce.email)==null?void 0:I.split("@")[0])||"User",email:ce.email,role:ce.role,avatar_url:ce.avatar_url,facility_id:ce.facility_id};p(yt);return}}return}const mt=Date.now()-je;if(H.info(` UserContext: Profile fetch took ${mt}ms`),H.info(` UserContext: Total fetch time: ${Date.now()-U}ms`),F){const et={id:F.id,name:`${F.first_name||""} ${F.last_name||""}`.trim()||((k=F.email)==null?void 0:k.split("@")[0])||"User",email:F.email,role:F.role,avatar_url:F.avatar_url,facility_id:F.facility_id},ce={admin:"Administrator",manager:"Manager",user:"User",viewer:"Viewer"},yt=typeof F.role=="string"?F.role:"user";et.role=ce[yt]||yt,t(et),u(C)}});yield Promise.race([A,y])}catch(w){w instanceof Error&&w.message.includes("timeout")&&H.warn(" UserContext: User data fetch timed out, this may indicate database performance issues"),console.error(" UserContext: Error refreshing user data:",w)}finally{n(!1),a(!0)}}),[r,e,l,d]),v=P.useCallback(()=>{console.log(" UserContext: Starting clearUserData..."),H.info(" UserContext: Clearing all user data on logout"),t(null),o(!1),a(!1),u(0),n(!1),["currentUser","userProfile","userData","user_preferences","sb-user","user_data"].forEach(w=>{const y=localStorage.getItem(w);y&&(console.log(` Clearing localStorage.${w}:`,y.substring(0,100)+"..."),localStorage.removeItem(w))}),["currentUser","userProfile","userData","user_preferences","user_id","user_email","user_role"].forEach(w=>{const y=sessionStorage.getItem(w);y&&(console.log(` Clearing sessionStorage.${w}:`,y.substring(0,100)+"..."),sessionStorage.removeItem(w))}),console.log(" UserContext: clearUserData completed"),H.info(" UserContext: All user data cleared successfully")},[]),b=P.useCallback(()=>gn(null,null,function*(){if(s||r)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log(" UserContext: No auth token found, skipping initializeUserContext");return}H.info(" UserContext: Starting user data refresh..."),yield m(),o(!0)}),[s,r,m]);return f.jsx(ka.Provider,{value:{currentUser:e,setCurrentUser:p,getUserDisplayName:h,refreshUserData:m,initializeUserContext:b,clearUserData:v,isLoading:r},children:i})},wl=()=>{const i=P.useContext(ka);if(!i)throw new Error("useUser must be used within a UserProvider");return i};var Oi={},Fn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});let Yr=null;const tn=typeof window!="undefined",bl=()=>Fn(null,null,function*(){if(!tn)try{const{createClient:i}=yield N(()=>import("./redisClient.server-PQwg0JJE.js"),__vite__mapDeps([0,1,2,3,4]));Yr=i}catch(i){}});tn||bl();class Cl{constructor(e){this.client=null,this.isConnected=!1,this.config=e}connect(){return Fn(this,null,function*(){if(!this.isConnected){if(tn){H.warn("Redis not available in browser environment, using in-memory fallback");return}if(Yr||(yield new Promise(e=>setTimeout(e,100))),!Yr){H.warn("Redis not available, using in-memory fallback");return}try{this.client=Yr({socket:{host:this.config.host,port:this.config.port,reconnectStrategy:e=>e>10?(H.error("Redis connection failed after 10 retries"),new Error("Redis connection failed")):Math.min(e*100,3e3)},password:this.config.password,database:this.config.db||0}),this.client.on("error",e=>{H.error("Redis client error:",e),this.isConnected=!1}),this.client.on("connect",()=>{H.info("Redis client connected"),this.isConnected=!0}),this.client.on("disconnect",()=>{H.warn("Redis client disconnected"),this.isConnected=!1}),yield this.client.connect()}catch(e){throw H.error("Failed to connect to Redis:",e),e}}})}disconnect(){return Fn(this,null,function*(){this.client&&this.isConnected&&(yield this.client.disconnect(),this.isConnected=!1)})}getClient(){if(!this.client||!this.isConnected)throw new Error("Redis client not connected");return this.client}isHealthy(){return tn?!1:this.isConnected&&this.client!==null}}const Rr=(i,e)=>typeof process!="undefined"&&Oi&&Oi[i]||e,Sl={host:Rr("REDIS_HOST","localhost"),port:parseInt(Rr("REDIS_PORT","6379")),password:Rr("REDIS_PASSWORD",""),db:parseInt(Rr("REDIS_DB","0")),retryDelayOnFailover:100,maxRetriesPerRequest:3},nt=new Cl(Sl);var $f="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z",jf="M10 4A4 4 0 0 0 6 8A4 4 0 0 0 10 12A4 4 0 0 0 14 8A4 4 0 0 0 10 4M17 12C16.87 12 16.76 12.09 16.74 12.21L16.55 13.53C16.25 13.66 15.96 13.82 15.7 14L14.46 13.5C14.35 13.5 14.22 13.5 14.15 13.63L13.15 15.36C13.09 15.47 13.11 15.6 13.21 15.68L14.27 16.5C14.25 16.67 14.24 16.83 14.24 17C14.24 17.17 14.25 17.33 14.27 17.5L13.21 18.32C13.12 18.4 13.09 18.53 13.15 18.64L14.15 20.37C14.21 20.5 14.34 20.5 14.46 20.5L15.7 20C15.96 20.18 16.24 20.35 16.55 20.47L16.74 21.79C16.76 21.91 16.86 22 17 22H19C19.11 22 19.22 21.91 19.24 21.79L19.43 20.47C19.73 20.34 20 20.18 20.27 20L21.5 20.5C21.63 20.5 21.76 20.5 21.83 20.37L22.83 18.64C22.89 18.53 22.86 18.4 22.77 18.32L21.7 17.5C21.72 17.33 21.74 17.17 21.74 17C21.74 16.83 21.73 16.67 21.7 16.5L22.76 15.68C22.85 15.6 22.88 15.47 22.82 15.36L21.82 13.63C21.76 13.5 21.63 13.5 21.5 13.5L20.27 14C20 13.82 19.73 13.65 19.42 13.53L19.23 12.21C19.22 12.09 19.11 12 19 12H17M10 14C5.58 14 2 15.79 2 18V20H11.68A7 7 0 0 1 11 17A7 7 0 0 1 11.64 14.09C11.11 14.03 10.56 14 10 14M18 15.5C18.83 15.5 19.5 16.17 19.5 17C19.5 17.83 18.83 18.5 18 18.5C17.16 18.5 16.5 17.83 16.5 17C16.5 16.17 17.17 15.5 18 15.5Z",Uf="M12,5.5A3.5,3.5 0 0,1 15.5,9A3.5,3.5 0 0,1 12,12.5A3.5,3.5 0 0,1 8.5,9A3.5,3.5 0 0,1 12,5.5M5,8C5.56,8 6.08,8.15 6.53,8.42C6.38,9.85 6.8,11.27 7.66,12.38C7.16,13.34 6.16,14 5,14A3,3 0 0,1 2,11A3,3 0 0,1 5,8M19,8A3,3 0 0,1 22,11A3,3 0 0,1 19,14C17.84,14 16.84,13.34 16.34,12.38C17.2,11.27 17.62,9.85 17.47,8.42C17.92,8.15 18.44,8 19,8M5.5,18.25C5.5,16.18 8.41,14.5 12,14.5C15.59,14.5 18.5,16.18 18.5,18.25V20H5.5V18.25M0,20V18.5C0,17.11 1.89,15.94 4.45,15.6C3.86,16.28 3.5,17.22 3.5,18.25V20H0M24,20H20.5V18.25C20.5,17.22 20.14,16.28 19.55,15.6C22.11,15.94 24,17.11 24,18.5V20Z",Nf="M12,5A3.5,3.5 0 0,0 8.5,8.5A3.5,3.5 0 0,0 12,12A3.5,3.5 0 0,0 15.5,8.5A3.5,3.5 0 0,0 12,5M12,7A1.5,1.5 0 0,1 13.5,8.5A1.5,1.5 0 0,1 12,10A1.5,1.5 0 0,1 10.5,8.5A1.5,1.5 0 0,1 12,7M5.5,8A2.5,2.5 0 0,0 3,10.5C3,11.44 3.53,12.25 4.29,12.68C4.65,12.88 5.06,13 5.5,13C5.94,13 6.35,12.88 6.71,12.68C7.08,12.47 7.39,12.17 7.62,11.81C6.89,10.86 6.5,9.7 6.5,8.5C6.5,8.41 6.5,8.31 6.5,8.22C6.2,8.08 5.86,8 5.5,8M18.5,8C18.14,8 17.8,8.08 17.5,8.22C17.5,8.31 17.5,8.41 17.5,8.5C17.5,9.7 17.11,10.86 16.38,11.81C16.5,12 16.63,12.15 16.78,12.3C16.94,12.45 17.1,12.58 17.29,12.68C17.65,12.88 18.06,13 18.5,13C18.94,13 19.35,12.88 19.71,12.68C20.47,12.25 21,11.44 21,10.5A2.5,2.5 0 0,0 18.5,8M12,14C9.66,14 5,15.17 5,17.5V19H19V17.5C19,15.17 14.34,14 12,14M4.71,14.55C2.78,14.78 0,15.76 0,17.5V19H3V17.07C3,16.06 3.69,15.22 4.71,14.55M19.29,14.55C20.31,15.22 21,16.06 21,17.07V19H24V17.5C24,15.76 21.22,14.78 19.29,14.55M12,16C13.53,16 15.24,16.5 16.23,17H7.77C8.76,16.5 10.47,16 12,16Z",Ff="M16 17V19H2V17S2 13 9 13 16 17 16 17M12.5 7.5A3.5 3.5 0 1 0 9 11A3.5 3.5 0 0 0 12.5 7.5M15.94 13A5.32 5.32 0 0 1 18 17V19H22V17S22 13.37 15.94 13M15 4A3.39 3.39 0 0 0 13.07 4.59A5 5 0 0 1 13.07 10.41A3.39 3.39 0 0 0 15 11A3.5 3.5 0 0 0 15 4Z",zf="M16 8C16 10.21 14.21 12 12 12C9.79 12 8 10.21 8 8L8.11 7.06L5 5.5L12 2L19 5.5V10.5H18V6L15.89 7.06L16 8M12 14C16.42 14 20 15.79 20 18V20H4V18C4 15.79 7.58 14 12 14Z",Bf="M13 14H11V9H13M13 18H11V16H13M1 21H23L12 2L1 21Z",Al="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",qf="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z",Gf="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z",Kf="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z",Wf="M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z",Zf="M12,6V9L16,5L12,1V4A8,8 0 0,0 4,12C4,13.57 4.46,15.03 5.24,16.26L6.7,14.8C6.25,13.97 6,13 6,12A6,6 0 0,1 12,6M18.76,7.74L17.3,9.2C17.74,10.04 18,11 18,12A6,6 0 0,1 12,18V15L8,19L12,23V20A8,8 0 0,0 20,12C20,10.43 19.54,8.97 18.76,7.74Z",Qf="M2,6H4V18H2V6M5,6H6V18H5V6M7,6H10V18H7V6M11,6H12V18H11V6M14,6H16V18H14V6M17,6H20V18H17V6M21,6H22V18H21V6Z",Yf="M4,6H6V18H4V6M7,6H8V18H7V6M9,6H12V18H9V6M13,6H14V18H13V6M16,6H18V18H16V6M19,6H20V18H19V6M2,4V8H0V4A2,2 0 0,1 2,2H6V4H2M22,2A2,2 0 0,1 24,4V8H22V4H18V2H22M2,16V20H6V22H2A2,2 0 0,1 0,20V16H2M22,20V16H24V20A2,2 0 0,1 22,22H18V20H22Z",Jf="M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M14,21A2,2 0 0,1 12,23A2,2 0 0,1 10,21",Xf="M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M14,21A2,2 0 0,1 12,23A2,2 0 0,1 10,21M19.75,3.19L18.33,4.61C20.04,6.3 21,8.6 21,11H23C23,8.07 21.84,5.25 19.75,3.19M1,11H3C3,8.6 3.96,6.3 5.67,4.61L4.25,3.19C2.16,5.25 1,8.07 1,11Z",ep="M23,16.06C23,16.29 23,16.5 22.96,16.7C22.78,14.14 20.64,12.11 18,12.11C17.63,12.11 17.27,12.16 16.92,12.23C16.96,12.5 17,12.73 17,13C17,15.35 15.31,17.32 13.07,17.81C13.42,20.05 15.31,21.79 17.65,21.96C17.43,22 17.22,22 17,22C14.92,22 13.07,20.94 12,19.34C10.93,20.94 9.09,22 7,22C6.78,22 6.57,22 6.35,21.96C8.69,21.79 10.57,20.06 10.93,17.81C8.68,17.32 7,15.35 7,13C7,12.73 7.04,12.5 7.07,12.23C6.73,12.16 6.37,12.11 6,12.11C3.36,12.11 1.22,14.14 1.03,16.7C1,16.5 1,16.29 1,16.06C1,12.85 3.59,10.24 6.81,10.14C6.3,9.27 6,8.25 6,7.17C6,4.94 7.23,3 9.06,2C7.81,2.9 7,4.34 7,6C7,7.35 7.56,8.59 8.47,9.5C9.38,8.59 10.62,8.04 12,8.04C13.37,8.04 14.62,8.59 15.5,9.5C16.43,8.59 17,7.35 17,6C17,4.34 16.18,2.9 14.94,2C16.77,3 18,4.94 18,7.17C18,8.25 17.7,9.27 17.19,10.14C20.42,10.24 23,12.85 23,16.06M9.27,10.11C10.05,10.62 11,10.92 12,10.92C13,10.92 13.95,10.62 14.73,10.11C14,9.45 13.06,9.03 12,9.03C10.94,9.03 10,9.45 9.27,10.11M12,14.47C12.82,14.47 13.5,13.8 13.5,13A1.5,1.5 0 0,0 12,11.5A1.5,1.5 0 0,0 10.5,13C10.5,13.8 11.17,14.47 12,14.47M10.97,16.79C10.87,14.9 9.71,13.29 8.05,12.55C8.03,12.7 8,12.84 8,13C8,14.82 9.27,16.34 10.97,16.79M15.96,12.55C14.29,13.29 13.12,14.9 13,16.79C14.73,16.34 16,14.82 16,13C16,12.84 15.97,12.7 15.96,12.55Z",tp="M8.82 17L13 19.28V22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H7V9L9.5 7.5L12 9V2H18C19.1 2 20 2.89 20 4V12.54L18.5 11.72L8.82 17M24 17L18.5 14L13 17L18.5 20L24 17M15 19.09V21.09L18.5 23L22 21.09V19.09L18.5 21L15 19.09Z",rp="M13,12H20V13.5H13M13,9.5H20V11H13M13,14.5H20V16H13M21,4H3A2,2 0 0,0 1,6V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V6A2,2 0 0,0 21,4M21,19H12V6H21",np="M21.33,12.91C21.42,14.46 20.71,15.95 19.44,16.86L20.21,18.35C20.44,18.8 20.47,19.33 20.27,19.8C20.08,20.27 19.69,20.64 19.21,20.8L18.42,21.05C18.25,21.11 18.06,21.14 17.88,21.14C17.37,21.14 16.89,20.91 16.56,20.5L14.44,18C13.55,17.85 12.71,17.47 12,16.9C11.5,17.05 11,17.13 10.5,17.13C9.62,17.13 8.74,16.86 8,16.34C7.47,16.5 6.93,16.57 6.38,16.56C5.59,16.57 4.81,16.41 4.08,16.11C2.65,15.47 1.7,14.07 1.65,12.5C1.57,11.78 1.69,11.05 2,10.39C1.71,9.64 1.68,8.82 1.93,8.06C2.3,7.11 3,6.32 3.87,5.82C4.45,4.13 6.08,3 7.87,3.12C9.47,1.62 11.92,1.46 13.7,2.75C14.12,2.64 14.56,2.58 15,2.58C16.36,2.55 17.65,3.15 18.5,4.22C20.54,4.75 22,6.57 22.08,8.69C22.13,9.8 21.83,10.89 21.22,11.82C21.29,12.18 21.33,12.54 21.33,12.91M16.33,11.5C16.9,11.57 17.35,12 17.35,12.57A1,1 0 0,1 16.35,13.57H15.72C15.4,14.47 14.84,15.26 14.1,15.86C14.35,15.95 14.61,16 14.87,16.07C20,16 19.4,12.87 19.4,12.82C19.34,11.39 18.14,10.27 16.71,10.33A1,1 0 0,1 15.71,9.33A1,1 0 0,1 16.71,8.33C17.94,8.36 19.12,8.82 20.04,9.63C20.09,9.34 20.12,9.04 20.12,8.74C20.06,7.5 19.5,6.42 17.25,6.21C16,3.25 12.85,4.89 12.85,5.81V5.81C12.82,6.04 13.06,6.53 13.1,6.56A1,1 0 0,1 14.1,7.56C14.1,8.11 13.65,8.56 13.1,8.56V8.56C12.57,8.54 12.07,8.34 11.67,8C11.19,8.31 10.64,8.5 10.07,8.56V8.56C9.5,8.61 9.03,8.21 9,7.66C8.92,7.1 9.33,6.61 9.88,6.56C10.04,6.54 10.82,6.42 10.82,5.79V5.79C10.82,5.13 11.07,4.5 11.5,4C10.58,3.75 9.59,4.08 8.59,5.29C6.75,5 6,5.25 5.45,7.2C4.5,7.67 4,8 3.78,9C4.86,8.78 5.97,8.87 7,9.25C7.5,9.44 7.78,10 7.59,10.54C7.4,11.06 6.82,11.32 6.3,11.13C5.57,10.81 4.75,10.79 4,11.07C3.68,11.34 3.68,11.9 3.68,12.34C3.68,13.08 4.05,13.77 4.68,14.17C5.21,14.44 5.8,14.58 6.39,14.57C6.24,14.31 6.11,14.04 6,13.76C5.81,13.22 6.1,12.63 6.64,12.44C7.18,12.25 7.77,12.54 7.96,13.08C8.36,14.22 9.38,15 10.58,15.13C11.95,15.06 13.17,14.25 13.77,13C14,11.62 15.11,11.5 16.33,11.5M18.33,18.97L17.71,17.67L17,17.83L18,19.08L18.33,18.97M13.68,10.36C13.7,9.83 13.3,9.38 12.77,9.33C12.06,9.29 11.37,9.53 10.84,10C10.27,10.58 9.97,11.38 10,12.19A1,1 0 0,0 11,13.19C11.57,13.19 12,12.74 12,12.19C12,11.92 12.07,11.65 12.23,11.43C12.35,11.33 12.5,11.28 12.66,11.28C13.21,11.31 13.68,10.9 13.68,10.36Z",ip="M19.36,2.72L20.78,4.14L15.06,9.85C16.13,11.39 16.28,13.24 15.38,14.44L9.06,8.12C10.26,7.22 12.11,7.37 13.65,8.44L19.36,2.72M5.93,17.57C3.92,15.56 2.69,13.16 2.35,10.92L7.23,8.83L14.67,16.27L12.58,21.15C10.34,20.81 7.94,19.58 5.93,17.57Z",Il="M14,12H10V10H14M14,16H10V14H14M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.5,5 12,5C11.5,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z",sp="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z",ap="M6 1V3H5C3.89 3 3 3.89 3 5V19C3 20.11 3.9 21 5 21H19C20.11 21 21 20.11 21 19V5C21 3.9 20.11 3 19 3H18V1H16V3H8V1H6M5 8H19V19H5V8M11 9V14H13V9H11M11 16V18H13V16H11Z",op="M15,13H16.5V15.82L18.94,17.23L18.19,18.53L15,16.69V13M19,8H5V19H9.67C9.24,18.09 9,17.07 9,16A7,7 0 0,1 16,9C17.07,9 18.09,9.24 19,9.67V8M5,21C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3H6V1H8V3H16V1H18V3H19A2,2 0 0,1 21,5V11.1C22.24,12.36 23,14.09 23,16A7,7 0 0,1 16,23C14.09,23 12.36,22.24 11.1,21H5M16,11.15A4.85,4.85 0 0,0 11.15,16C11.15,18.68 13.32,20.85 16,20.85A4.85,4.85 0 0,0 20.85,16C20.85,13.32 18.68,11.15 16,11.15Z",cp="M6 1H8V3H16V1H18V3H19C20.11 3 21 3.9 21 5V19C21 20.11 20.11 21 19 21H5C3.89 21 3 20.1 3 19V5C3 3.89 3.89 3 5 3H6V1M5 8V19H19V8H5M7 10H17V12H7V10Z",lp="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z",up="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z",dp="M4,3C2.89,3 2,3.89 2,5V15A2,2 0 0,0 4,17H12V22L15,19L18,22V17H20A2,2 0 0,0 22,15V8L22,6V5A2,2 0 0,0 20,3H16V3H4M12,5L15,7L18,5V8.5L21,10L18,11.5V15L15,13L12,15V11.5L9,10L12,8.5V5M4,5H9V7H4V5M4,9H7V11H4V9M4,13H9V15H4V13Z",hp="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z",fp="M16,11.78L20.24,4.45L21.97,5.45L16.74,14.5L10.23,10.75L5.46,19H22V21H2V3H4V17.54L9.5,8L16,11.78Z",pp="M11,2V22C5.9,21.5 2,17.2 2,12C2,6.8 5.9,2.5 11,2M13,2V11H22C21.5,6.2 17.8,2.5 13,2M13,13V22C17.7,21.5 21.5,17.8 22,13H13Z",gp="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z",mp="M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z",yp="M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M12 20C7.59 20 4 16.41 4 12S7.59 4 12 4 20 7.59 20 12 16.41 20 12 20M16.59 7.58L10 14.17L7.41 11.59L6 13L10 17L18 9L16.59 7.58Z",vp="M18.41,7.41L17,6L11,12L17,18L18.41,16.59L13.83,12L18.41,7.41M12.41,7.41L11,6L5,12L11,18L12.41,16.59L7.83,12L12.41,7.41Z",_p="M5.59,7.41L7,6L13,12L7,18L5.59,16.59L10.17,12L5.59,7.41M11.59,7.41L13,6L19,12L13,18L11.59,16.59L16.17,12L11.59,7.41Z",wp="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z",bp="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z",Cp="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z",Sp="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z",Ap="M19 3H14.82C14.4 1.84 13.3 1 12 1S9.6 1.84 9.18 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M7 8H9V12H8V9H7V8M10 17V18H7V17.08L9 15H7V14H9.25C9.66 14 10 14.34 10 14.75C10 14.95 9.92 15.14 9.79 15.27L8.12 17H10M11 4C11 3.45 11.45 3 12 3S13 3.45 13 4 12.55 5 12 5 11 4.55 11 4M17 17H12V15H17V17M17 11H12V9H17V11Z",Ip="M17,9H7V7H17M17,13H7V11H17M14,17H7V15H14M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3M19,3H14.82C14.4,1.84 13.3,1 12,1C10.7,1 9.6,1.84 9.18,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3Z",Ep="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z",kp="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z",Lp="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",Tp="M11 20H6.5Q4.22 20 2.61 18.43 1 16.85 1 14.58 1 12.63 2.17 11.1 3.35 9.57 5.25 9.15 5.88 6.85 7.75 5.43 9.63 4 12 4 14.93 4 16.96 6.04 19 8.07 19 11 20.73 11.2 21.86 12.5 23 13.78 23 15.5 23 17.38 21.69 18.69 20.38 20 18.5 20H13V12.85L14.6 14.4L16 13L12 9L8 13L9.4 14.4L11 12.85Z",Pp="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",Op="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z",Mp="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z",xp="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",Hp="M7,15H9C9,16.08 10.37,17 12,17C13.63,17 15,16.08 15,15C15,13.9 13.96,13.5 11.76,12.97C9.64,12.44 7,11.78 7,9C7,7.21 8.47,5.69 10.5,5.18V3H13.5V5.18C15.53,5.69 17,7.21 17,9H15C15,7.92 13.63,7 12,7C10.37,7 9,7.92 9,9C9,10.1 10.04,10.5 12.24,11.03C14.36,11.56 17,12.22 17,15C17,16.79 15.53,18.31 13.5,18.82V21H10.5V18.82C8.47,18.31 7,16.79 7,15Z",Dp="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",Rp="M6,2C4.89,2 4,2.89 4,4V12C4,13.11 4.89,14 6,14H18C19.11,14 20,13.11 20,12V4C20,2.89 19.11,2 18,2H6M6,4H18V12H6V4M4,15C2.89,15 2,15.89 2,17V20C2,21.11 2.89,22 4,22H20C21.11,22 22,21.11 22,20V17C22,15.89 21.11,15 20,15H4M8,17H20V20H8V17M9,17.75V19.25H13V17.75H9M15,17.75V19.25H19V17.75H15Z",Vp="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z",$p="M7,19V17H9V19H7M11,19V17H13V19H11M15,19V17H17V19H15M7,15V13H9V15H7M11,15V13H13V15H11M15,15V13H17V15H15M7,11V9H9V11H7M11,11V9H13V11H11M15,11V9H17V11H15M7,7V5H9V7H7M11,7V5H13V7H11M15,7V5H17V7H15Z",jp="M 11,4L 13,4L 13,15L 11,15L 11,4 Z M 13,18L 13,20L 11,20L 11,18L 13,18 Z",Up="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z",Np="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z",Fp="M4,18V20H8V18H4M4,14V16H14V14H4M10,18V20H14V18H10M16,14V16H20V14H16M16,18V20H20V18H16M2,22V8L7,12V8L12,12V8L17,12L18,2H21L22,12V22H2Z",zp="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z",Bp="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M6,20H15L18,20V12L14,16L12,14L6,20M8,9A2,2 0 0,0 6,11A2,2 0 0,0 8,13A2,2 0 0,0 10,11A2,2 0 0,0 8,9Z",qp="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M9.5 11.5C9.5 12.3 8.8 13 8 13H7V15H5.5V9H8C8.8 9 9.5 9.7 9.5 10.5V11.5M14.5 13.5C14.5 14.3 13.8 15 13 15H10.5V9H13C13.8 9 14.5 9.7 14.5 10.5V13.5M18.5 10.5H17V11.5H18.5V13H17V15H15.5V9H18.5V10.5M12 10.5H13V13.5H12V10.5M7 10.5H8V11.5H7V10.5Z",Gp="M14,12V19.88C14.04,20.18 13.94,20.5 13.71,20.71C13.32,21.1 12.69,21.1 12.3,20.71L10.29,18.7C10.06,18.47 9.96,18.16 10,17.87V12H9.97L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L14.03,12H14Z",Kp="M6,13H18V11H6M3,6V8H21V6M10,18H14V16H10V18Z",Wp="M6,22A3,3 0 0,1 3,19C3,18.4 3.18,17.84 3.5,17.37L9,7.81V6A1,1 0 0,1 8,5V4A2,2 0 0,1 10,2H14A2,2 0 0,1 16,4V5A1,1 0 0,1 15,6V7.81L20.5,17.37C20.82,17.84 21,18.4 21,19A3,3 0 0,1 18,22H6M5,19A1,1 0 0,0 6,20H18A1,1 0 0,0 19,19C19,18.79 18.93,18.59 18.82,18.43L16.53,14.47L14,17L8.93,11.93L5.18,18.43C5.07,18.59 5,18.79 5,19M13,10A1,1 0 0,0 12,11A1,1 0 0,0 13,12A1,1 0 0,0 14,11A1,1 0 0,0 13,10Z",Zp="M18.5,4L19.66,8.35L18.7,8.61C18.25,7.74 17.79,6.87 17.26,6.43C16.73,6 16.11,6 15.5,6H13V16.5C13,17 13,17.5 13.33,17.75C13.67,18 14.33,18 15,18V19H9V18C9.67,18 10.33,18 10.67,17.75C11,17.5 11,17 11,16.5V6H8.5C7.89,6 7.27,6 6.74,6.43C6.21,6.87 5.75,7.74 5.3,8.61L4.34,8.35L5.5,4H18.5Z",Qp="M2 19.63L13.43 8.2L12.72 7.5L14.14 6.07L12 3.89C13.2 2.7 15.09 2.7 16.27 3.89L19.87 7.5L18.45 8.91H21.29L22 9.62L18.45 13.21L17.74 12.5V9.62L16.27 11.04L15.56 10.33L4.13 21.76L2 19.63Z",Yp="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z",Jp="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z",Xp="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z",e0="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",t0="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",r0="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z",n0="M12,2A7,7 0 0,0 5,9C5,11.38 6.19,13.47 8,14.74V17A1,1 0 0,0 9,18H15A1,1 0 0,0 16,17V14.74C17.81,13.47 19,11.38 19,9A7,7 0 0,0 12,2M9,21A1,1 0 0,0 10,22H14A1,1 0 0,0 15,21V20H9V21Z",i0="M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63Z",s0="M12,2A7,7 0 0,1 19,9C19,11.38 17.81,13.47 16,14.74V17A1,1 0 0,1 15,18H9A1,1 0 0,1 8,17V14.74C6.19,13.47 5,11.38 5,9A7,7 0 0,1 12,2M9,21V20H15V21A1,1 0 0,1 14,22H10A1,1 0 0,1 9,21M12,4A5,5 0 0,0 7,9C7,11.05 8.23,12.81 10,13.58V16H14V13.58C15.77,12.81 17,11.05 17,9A5,5 0 0,0 12,4Z",a0="M11 15H6L13 1V9H18L11 23V15Z",o0="M3.9,12C3.9,10.29 5.29,8.9 7,8.9H11V7H7A5,5 0 0,0 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12M8,13H16V11H8V13M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.71 18.71,15.1 17,15.1H13V17H17A5,5 0 0,0 22,12A5,5 0 0,0 17,7Z",c0="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z",l0="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z",u0="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z",d0="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z",h0="M18,15A3,3 0 0,1 21,18A3,3 0 0,1 18,21C16.69,21 15.58,20.17 15.17,19H14V17H15.17C15.58,15.83 16.69,15 18,15M18,17A1,1 0 0,0 17,18A1,1 0 0,0 18,19A1,1 0 0,0 19,18A1,1 0 0,0 18,17M18,8A1.43,1.43 0 0,0 19.43,6.57C19.43,5.78 18.79,5.14 18,5.14C17.21,5.14 16.57,5.78 16.57,6.57A1.43,1.43 0 0,0 18,8M18,2.57A4,4 0 0,1 22,6.57C22,9.56 18,14 18,14C18,14 14,9.56 14,6.57A4,4 0 0,1 18,2.57M8.83,17H10V19H8.83C8.42,20.17 7.31,21 6,21A3,3 0 0,1 3,18C3,16.69 3.83,15.58 5,15.17V14H7V15.17C7.85,15.47 8.53,16.15 8.83,17M6,17A1,1 0 0,0 5,18A1,1 0 0,0 6,19A1,1 0 0,0 7,18A1,1 0 0,0 6,17M6,3A3,3 0 0,1 9,6C9,7.31 8.17,8.42 7,8.83V10H5V8.83C3.83,8.42 3,7.31 3,6A3,3 0 0,1 6,3M6,5A1,1 0 0,0 5,6A1,1 0 0,0 6,7A1,1 0 0,0 7,6A1,1 0 0,0 6,5M11,19V17H13V19H11M7,13H5V11H7V13Z",f0="M12,2C15.31,2 18,4.66 18,7.95C18,12.41 12,19 12,19C12,19 6,12.41 6,7.95C6,4.66 8.69,2 12,2M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6M20,19C20,21.21 16.42,23 12,23C7.58,23 4,21.21 4,19C4,17.71 5.22,16.56 7.11,15.83L7.75,16.74C6.67,17.19 6,17.81 6,18.5C6,19.88 8.69,21 12,21C15.31,21 18,19.88 18,18.5C18,17.81 17.33,17.19 16.25,16.74L16.89,15.83C18.78,16.56 20,17.71 20,19Z",p0="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z",g0="M19,11C19,12.19 18.66,13.3 18.1,14.28L16.87,13.05C17.14,12.43 17.3,11.74 17.3,11H19M15,11.16L9,5.18V5A3,3 0 0,1 12,2A3,3 0 0,1 15,5V11L15,11.16M4.27,3L21,19.73L19.73,21L15.54,16.81C14.77,17.27 13.91,17.58 13,17.72V21H11V17.72C7.72,17.23 5,14.41 5,11H6.7C6.7,14 9.24,16.1 12,16.1C12.81,16.1 13.6,15.91 14.31,15.58L12.65,13.92L12,14A3,3 0 0,1 9,11V10.28L3,4.27L4.27,3Z",m0="M19,13H5V11H19V13Z",y0="M5,3V21H11V17.5H13V21H19V3H5M7,5H9V7H7V5M11,5H13V7H11V5M15,5H17V7H15V5M7,9H9V11H7V9M11,9H13V11H11V9M15,9H17V11H15V9M7,13H9V15H7V13M11,13H13V15H11V13M15,13H17V15H15V13M7,17H9V19H7V17M15,17H17V19H15V17Z",v0="M5.12,5H18.87L17.93,4H5.93L5.12,5M20.54,5.23C20.83,5.57 21,6 21,6.5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V6.5C3,6 3.17,5.57 3.46,5.23L4.84,3.55C5.12,3.21 5.53,3 6,3H18C18.47,3 18.88,3.21 19.15,3.55L20.54,5.23M6,18H12V15H6V18Z",_0="M2,10.96C1.5,10.68 1.35,10.07 1.63,9.59L3.13,7C3.24,6.8 3.41,6.66 3.6,6.58L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.66,6.72 20.82,6.88 20.91,7.08L22.36,9.6C22.64,10.08 22.47,10.69 22,10.96L21,11.54V16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V10.96C2.7,11.13 2.32,11.14 2,10.96M12,4.15V4.15L12,10.85V10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V12.69L14,15.59C13.67,15.77 13.3,15.76 13,15.6V19.29L19,15.91M13.85,13.36L20.13,9.73L19.55,8.72L13.27,12.35L13.85,13.36Z",w0="M14,19H18V5H14M6,19H10V5H6V19Z",b0="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z",C0="M8,5.14V19.14L19,12.14L8,5.14Z",S0="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",A0="M18,3H6V7H18M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12M16,19H8V14H16M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8Z",I0="M19,6A1,1 0 0,0 20,5A1,1 0 0,0 19,4A1,1 0 0,0 18,5A1,1 0 0,0 19,6M19,2A3,3 0 0,1 22,5V11H18V7H6V11H2V5A3,3 0 0,1 5,2H19M18,18.25C18,18.63 17.79,18.96 17.47,19.13L12.57,21.82C12.4,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L6.53,19.13C6.21,18.96 6,18.63 6,18.25V13C6,12.62 6.21,12.29 6.53,12.12L11.43,9.68C11.59,9.56 11.79,9.5 12,9.5C12.21,9.5 12.4,9.56 12.57,9.68L17.47,12.12C17.79,12.29 18,12.62 18,13V18.25M12,11.65L9.04,13L12,14.6L14.96,13L12,11.65M8,17.66L11,19.29V16.33L8,14.71V17.66M16,17.66V14.71L13,16.33V19.29L16,17.66Z",E0="M13,2.03V2.05L13,4.05C17.39,4.59 20.5,8.58 19.96,12.97C19.5,16.61 16.64,19.5 13,19.93V21.93C18.5,21.38 22.5,16.5 21.95,11C21.5,6.25 17.73,2.5 13,2.03M11,2.06C9.05,2.25 7.19,3 5.67,4.26L7.1,5.74C8.22,4.84 9.57,4.26 11,4.06V2.06M4.26,5.67C3,7.19 2.25,9.04 2.05,11H4.05C4.24,9.58 4.8,8.23 5.69,7.1L4.26,5.67M2.06,13C2.26,14.96 3.03,16.81 4.27,18.33L5.69,16.9C4.81,15.77 4.24,14.42 4.06,13H2.06M7.1,18.37L5.67,19.74C7.18,21 9.04,21.79 11,22V20C9.58,19.82 8.23,19.25 7.1,18.37M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z",k0="M5,4V6H19V4H5M5,14H9V20H15V14H19L12,7L5,14Z",L0="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z",El="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",T0="M2 12C2 16.97 6.03 21 11 21C13.39 21 15.68 20.06 17.4 18.4L15.9 16.9C14.63 18.25 12.86 19 11 19C4.76 19 1.64 11.46 6.05 7.05C10.46 2.64 18 5.77 18 12H15L19 16H19.1L23 12H20C20 7.03 15.97 3 11 3C6.03 3 2 7.03 2 12Z",P0="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z",O0="M20 22L16.14 20.45C16.84 18.92 17.34 17.34 17.65 15.73L20 22M7.86 20.45L4 22L6.35 15.73C6.66 17.34 7.16 18.92 7.86 20.45M12 2C12 2 17 4 17 12C17 15.1 16.25 17.75 15.33 19.83C15 20.55 14.29 21 13.5 21H10.5C9.71 21 9 20.55 8.67 19.83C7.76 17.75 7 15.1 7 12C7 4 12 2 12 2M12 12C13.1 12 14 11.1 14 10C14 8.9 13.1 8 12 8C10.9 8 10 8.9 10 10C10 11.1 10.9 12 12 12Z",M0="M0 2A2 2 0 0 1 2 0H6V2H2V6H0V2M24 22A2 2 0 0 1 22 24H18V22H22V18H24V22M2 24A2 2 0 0 1 0 22V18H2V22H6V24H2M22 0A2 2 0 0 1 24 2V6H22V2H18V0H22Z",x0="M12,3L1,9L12,15L21,10.09V17H23V9M5,13.18V17.18L12,21L19,17.18V13.18L12,17L5,13.18Z",H0="M11,13.5V21.5H3V13.5H11M12,2L17.5,11H6.5L12,2M17.5,13C20,13 22,15 22,17.5C22,20 20,22 17.5,22C15,22 13,20 13,17.5C13,15 15,13 17.5,13Z",D0="M11,13.5V21.5H3V13.5H11M9,15.5H5V19.5H9V15.5M12,2L17.5,11H6.5L12,2M12,5.86L10.08,9H13.92L12,5.86M17.5,13C20,13 22,15 22,17.5C22,20 20,22 17.5,22C15,22 13,20 13,17.5C13,15 15,13 17.5,13M17.5,15A2.5,2.5 0 0,0 15,17.5A2.5,2.5 0 0,0 17.5,20A2.5,2.5 0 0,0 20,17.5A2.5,2.5 0 0,0 17.5,15Z",R0="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z",V0="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5M11,7H13V13H11M11,15H13V17H11",$0="M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z",j0="M21,11C21,16.55 17.16,21.74 12,23C6.84,21.74 3,16.55 3,11V5L12,1L21,5V11M12,21C15.75,20 19,15.54 19,11.22V6.3L12,3.18L5,6.3V11.22C5,15.54 8.25,20 12,21M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9",U0="M18 21L14 17H17V7H14L18 3L22 7H19V17H22M2 19V17H12V19M2 13V11H9V13M2 7V5H6V7H2Z",N0="M12,16A3,3 0 0,1 9,13C9,11.88 9.61,10.9 10.5,10.39L20.21,4.77L14.68,14.35C14.18,15.33 13.17,16 12,16M12,3C13.81,3 15.5,3.5 16.97,4.32L14.87,5.53C14,5.19 13,5 12,5A8,8 0 0,0 4,13C4,15.21 4.89,17.21 6.34,18.65H6.35C6.74,19.04 6.74,19.67 6.35,20.06C5.96,20.45 5.32,20.45 4.93,20.07V20.07C3.12,18.26 2,15.76 2,13A10,10 0 0,1 12,3M22,13C22,15.76 20.88,18.26 19.07,20.07V20.07C18.68,20.45 18.05,20.45 17.66,20.06C17.27,19.67 17.27,19.04 17.66,18.65V18.65C19.11,17.2 20,15.21 20,13C20,12 19.81,11 19.46,10.1L20.67,8C21.5,9.5 22,11.18 22,13Z",F0="M10,4H12V6H10V4M7,3H9V5H7V3M7,6H9V8H7V6M6,8V10H4V8H6M6,5V7H4V5H6M6,2V4H4V2H6M13,22A2,2 0 0,1 11,20V10A2,2 0 0,1 13,8V7H14V4H17V7H18V8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H13M13,10V20H18V10H13Z",z0="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z",B0="M18,18H6V6H18V18Z",q0="M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z",G0="M5,4H19A2,2 0 0,1 21,6V18A2,2 0 0,1 19,20H5A2,2 0 0,1 3,18V6A2,2 0 0,1 5,4M5,8V12H11V8H5M13,8V12H19V8H13M5,14V18H11V14H5M13,14V18H19V14H13Z",K0="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.78,14.05 22,13.55 22,13C22,12.44 21.77,11.94 21.41,11.58Z",W0="M11,2V4.07C7.38,4.53 4.53,7.38 4.07,11H2V13H4.07C4.53,16.62 7.38,19.47 11,19.93V22H13V19.93C16.62,19.47 19.47,16.62 19.93,13H22V11H19.93C19.47,7.38 16.62,4.53 13,4.07V2M11,6.08V8H13V6.09C15.5,6.5 17.5,8.5 17.92,11H16V13H17.91C17.5,15.5 15.5,17.5 13,17.92V16H11V17.91C8.5,17.5 6.5,15.5 6.08,13H8V11H6.09C6.5,8.5 8.5,6.5 11,6.08M12,11A1,1 0 0,0 11,12A1,1 0 0,0 12,13A1,1 0 0,0 13,12A1,1 0 0,0 12,11Z",Z0="M7,2V4H8V18A4,4 0 0,0 12,22A4,4 0 0,0 16,18V4H17V2H7M11,16C10.4,16 10,15.6 10,15C10,14.4 10.4,14 11,14C11.6,14 12,14.4 12,15C12,15.6 11.6,16 11,16M13,12C12.4,12 12,11.6 12,11C12,10.4 12.4,10 13,10C13.6,10 14,10.4 14,11C14,11.6 13.6,12 13,12M14,7H10V4H14V7Z",Q0="M15 13V5A3 3 0 0 0 9 5V13A5 5 0 1 0 15 13M12 4A1 1 0 0 1 13 5V8H11V5A1 1 0 0 1 12 4Z",Y0="M21.71 20.29L20.29 21.71A1 1 0 0 1 18.88 21.71L7 9.85A3.81 3.81 0 0 1 6 10A4 4 0 0 1 2.22 4.7L4.76 7.24L5.29 6.71L6.71 5.29L7.24 4.76L4.7 2.22A4 4 0 0 1 10 6A3.81 3.81 0 0 1 9.85 7L21.71 18.88A1 1 0 0 1 21.71 20.29M2.29 18.88A1 1 0 0 0 2.29 20.29L3.71 21.71A1 1 0 0 0 5.12 21.71L10.59 16.25L7.76 13.42M20 2L16 4V6L13.83 8.17L15.83 10.17L18 8H20L22 4Z",J0="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M9,8H11V17H9V8M13,8H15V17H13V8Z",X0="M16,18L18.29,15.71L13.41,10.83L9.41,14.83L2,7.41L3.41,6L9.41,12L13.41,8L19.71,14.29L22,12V18H16Z",eg="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z",tg="M18 2C17.1 2 16 3 16 4H8C8 3 6.9 2 6 2H2V11C2 12 3 13 4 13H6.2C6.6 15 7.9 16.7 11 17V19.08C8 19.54 8 22 8 22H16C16 22 16 19.54 13 19.08V17C16.1 16.7 17.4 15 17.8 13H20C21 13 22 12 22 11V2H18M6 11H4V4H6V11M20 11H18V4H20V11Z",rg="M18,18.5A1.5,1.5 0 0,1 16.5,17A1.5,1.5 0 0,1 18,15.5A1.5,1.5 0 0,1 19.5,17A1.5,1.5 0 0,1 18,18.5M19.5,9.5L21.46,12H17V9.5M6,18.5A1.5,1.5 0 0,1 4.5,17A1.5,1.5 0 0,1 6,15.5A1.5,1.5 0 0,1 7.5,17A1.5,1.5 0 0,1 6,18.5M20,8H17V4H3C1.89,4 1,4.89 1,6V17H3A3,3 0 0,0 6,20A3,3 0 0,0 9,17H15A3,3 0 0,0 18,20A3,3 0 0,0 21,17H23V12L20,8Z",ng="M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z",ig="M21,10.12H14.22L16.96,7.3C14.23,4.6 9.81,4.5 7.08,7.2C4.35,9.91 4.35,14.28 7.08,17C9.81,19.7 14.23,19.7 16.96,17C18.32,15.65 19,14.08 19,12.1H21C21,14.08 20.12,16.65 18.36,18.39C14.85,21.87 9.15,21.87 5.64,18.39C2.14,14.92 2.11,9.28 5.62,5.81C9.13,2.34 14.76,2.34 18.27,5.81L21,3V10.12M12.5,8V12.25L16,14.33L15.28,15.54L11,13V8H12.5Z",sg="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z",ag="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z",og="M9,5V9H21V5M9,19H21V15H9M9,14H21V10H9M4,9H8V5H4M4,19H8V15H4M4,14H8V10H4V14Z",cg="M14.83,11.17C16.39,12.73 16.39,15.27 14.83,16.83C13.27,18.39 10.73,18.39 9.17,16.83L14.83,11.17M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M7,4A1,1 0 0,0 6,5A1,1 0 0,0 7,6A1,1 0 0,0 8,5A1,1 0 0,0 7,4M10,4A1,1 0 0,0 9,5A1,1 0 0,0 10,6A1,1 0 0,0 11,5A1,1 0 0,0 10,4M12,8A6,6 0 0,0 6,14A6,6 0 0,0 12,20A6,6 0 0,0 18,14A6,6 0 0,0 12,8Z",lg="M12,20A6,6 0 0,1 6,14C6,10 12,3.25 12,3.25C12,3.25 18,10 18,14A6,6 0 0,1 12,20Z",ug="M22.7,19L13.6,9.9C14.5,7.6 14,4.9 12.1,3C10.1,1 7.1,0.6 4.7,1.7L9,6L6,9L1.6,4.7C0.4,7.1 0.9,10.1 2.9,12.1C4.8,14 7.5,14.5 9.8,13.6L18.9,22.7C19.3,23.1 19.9,23.1 20.3,22.7L22.6,20.4C23.1,20 23.1,19.3 22.7,19Z",La=lo();const dg=oa(La),mn=({path:i,size:e=24,color:t="currentColor",className:r})=>f.jsx(La.Icon,{path:i,size:e,color:t,className:r});class Ta extends P.Component{constructor(e){super(e),this.analyzeError=t=>{var r;const n=t.message.toLowerCase(),s=((r=t.stack)==null?void 0:r.toLowerCase())||"";return n.includes("is not defined")&&s.includes("useref")||s.includes("useeffect")||s.includes("usestate")?{type:"hook_import",message:"Missing React Hook Import",solution:'Add the missing hook to your React import statement. For example: import React, { useState, useEffect, useRef } from "react";',severity:"medium"}:n.includes("hooks")&&n.includes("rules")?{type:"hook_import",message:"React Hooks Rules Violation",solution:"Ensure hooks are called at the top level of your component, not inside loops, conditions, or nested functions.",severity:"high"}:t.name==="SyntaxError"||n.includes("syntax")?{type:"syntax",message:"Syntax Error",solution:"Check your code for missing brackets, semicolons, or other syntax issues. The error details below may help identify the problem.",severity:"high"}:t.name==="ReferenceError"?{type:"runtime",message:"Reference Error",solution:"A variable or function is being used before it's defined. Check your imports and variable declarations.",severity:"medium"}:n.includes("fetch")||n.includes("network")||n.includes("http")?{type:"network",message:"Network Error",solution:"Check your internet connection and try again. If the problem persists, the server may be temporarily unavailable.",severity:"medium"}:{type:"unknown",message:"Unexpected Error",solution:"An unexpected error occurred. Please try refreshing the page or contact support if the problem persists.",severity:"medium"}},this.getSeverityColor=t=>{switch(t){case"critical":return"#ef4444";case"high":return"#f97316";case"medium":return"#f59e0b";case"low":return"#3b82f6";default:return"#6b7280"}},this.handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.handleReportError=()=>{const{error:t,errorInfo:r}=this.state,{componentName:n}=this.props,s={component:n||"Unknown Component",error:t==null?void 0:t.message,stack:t==null?void 0:t.stack,errorInfo:r,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href};console.error("Error Report:",s),alert("Error report has been generated. Thank you for your feedback.")},this.renderErrorContent=()=>{const{error:t}=this.state,{componentName:r}=this.props;if(!t)return null;const n=this.analyzeError(t),s=this.getSeverityColor(n.severity);return f.jsx("div",{className:"min-h-screen flex items-center justify-center p-6 bg-gray-50",children:f.jsx("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-8 border border-gray-200",children:f.jsxs("div",{className:"flex items-start space-x-4",children:[f.jsx(mn,{path:Al,size:2,color:s,className:"flex-shrink-0 mt-1"}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"mb-4",children:[f.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:n.message}),r&&f.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Error occurred in:"," ",f.jsx("span",{className:"font-medium",children:r})]}),f.jsx("p",{className:"text-gray-700 mb-4",children:n.solution})]}),f.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[f.jsxs("button",{onClick:this.handleRetry,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[f.jsx(mn,{path:El,size:1}),"Try Again"]}),f.jsxs("button",{onClick:this.handleReportError,className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[f.jsx(mn,{path:Il,size:1}),"Report Error"]})]}),!1]})]})})})},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){var r,n;console.error("[ErrorBoundary]",{error:e,errorInfo:t}),this.setState({errorInfo:t}),(n=(r=this.props).onError)==null||n.call(r,e,t)}render(){if(this.state.hasError)return this.props.fallback||this.renderErrorContent();try{return this.props.children}catch(e){return this.setState({hasError:!0,error:e}),this.props.fallback||this.renderErrorContent()}}}Ta.defaultProps={fallback:f.jsx("div",{children:"Something went wrong."})};var kl=Object.defineProperty,Ll=Object.defineProperties,Tl=Object.getOwnPropertyDescriptors,Mi=Object.getOwnPropertySymbols,Pl=Object.prototype.hasOwnProperty,Ol=Object.prototype.propertyIsEnumerable,xi=(i,e,t)=>e in i?kl(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Hi=(i,e)=>{for(var t in e||(e={}))Pl.call(e,t)&&xi(i,t,e[t]);if(Mi)for(var t of Mi(e))Ol.call(e,t)&&xi(i,t,e[t]);return i},Di=(i,e)=>Ll(i,Tl(e)),Ml=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Ar=co((i,e)=>{var t,r,n,s,o,c,a,l,u,d,h;const p=(r=(t=localStorage.getItem("authToken"))!=null?t:sessionStorage.getItem("authToken"))!=null?r:null,m=(s=(n=localStorage.getItem("tokenExpiry"))!=null?n:sessionStorage.getItem("tokenExpiry"))!=null?s:null,v=(c=(o=localStorage.getItem("csrfToken"))!=null?o:sessionStorage.getItem("csrfToken"))!=null?c:null,b=parseInt((l=(a=localStorage.getItem("failedAttempts"))!=null?a:sessionStorage.getItem("failedAttempts"))!=null?l:"0"),S=parseInt((d=(u=localStorage.getItem("lastLoginAttempt"))!=null?u:sessionStorage.getItem("lastLoginAttempt"))!=null?d:"0"),C=(y,A,I=!1)=>{setTimeout(()=>{try{(I?localStorage:sessionStorage).setItem(y,A)}catch(k){console.warn(`Failed to save ${y} to ${I?"localStorage":"sessionStorage"}:`,k)}},0)},w=()=>{const y=new Uint8Array(32);return crypto.getRandomValues(y),btoa(String.fromCharCode.apply(null,Array.from(y))).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)};return{formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,otp:"",stage:"credentials"},errors:{},loading:!1,sessionExpiry:(h=localStorage.getItem("sessionExpiry"))!=null?h:null,authToken:p,tokenExpiry:m,csrfToken:v||w(),lastLoginAttempt:S||null,failedAttempts:b,isSecureMode:!0,setField:(y,A)=>i(I=>({formData:Di(Hi({},I.formData),{[y]:A})})),setErrors:y=>i({errors:y}),setLoading:y=>i({loading:y}),setStage:y=>i(A=>({formData:Di(Hi({},A.formData),{stage:y})})),setSessionExpiry:y=>{C("sessionExpiry",y),i({sessionExpiry:y})},setAuthToken:(y,A,I=!1)=>{C("authToken",y,I),C("tokenExpiry",A,I),i({authToken:y,tokenExpiry:A}),e().resetFailedAttempts()},reset:()=>Ml(null,null,function*(){localStorage.removeItem("authToken"),localStorage.removeItem("tokenExpiry"),localStorage.removeItem("sessionExpiry"),localStorage.removeItem("csrfToken"),localStorage.removeItem("failedAttempts"),localStorage.removeItem("lastLoginAttempt"),localStorage.removeItem("currentUser"),localStorage.removeItem("userProfile"),localStorage.removeItem("userData"),localStorage.removeItem("user_preferences"),localStorage.removeItem("sb-user"),localStorage.removeItem("user_data"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("tokenExpiry"),sessionStorage.removeItem("sessionExpiry"),sessionStorage.removeItem("csrfToken"),sessionStorage.removeItem("failedAttempts"),sessionStorage.removeItem("lastLoginAttempt"),sessionStorage.removeItem("currentUser"),sessionStorage.removeItem("userProfile"),sessionStorage.removeItem("userData"),sessionStorage.removeItem("user_preferences"),sessionStorage.removeItem("user_id"),sessionStorage.removeItem("user_email"),sessionStorage.removeItem("user_role");try{const{supabase:y}=yield N(()=>Promise.resolve().then(()=>yl),void 0);yield y.auth.signOut()}catch(y){console.error("Failed to clear Supabase session:",y)}i({formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,otp:"",stage:"credentials"},errors:{},loading:!1,sessionExpiry:null,authToken:null,tokenExpiry:null,csrfToken:w(),lastLoginAttempt:null,failedAttempts:0,isSecureMode:!0})}),setCSRFToken:y=>{C("csrfToken",y),i({csrfToken:y})},incrementFailedAttempts:()=>{const y=e().failedAttempts+1,A=Date.now();C("failedAttempts",y.toString()),C("lastLoginAttempt",A.toString()),i({failedAttempts:y,lastLoginAttempt:A})},resetFailedAttempts:()=>{localStorage.removeItem("failedAttempts"),localStorage.removeItem("lastLoginAttempt"),i({failedAttempts:0,lastLoginAttempt:null})},setSecureMode:y=>{i({isSecureMode:y})},isTokenExpired:()=>{const{tokenExpiry:y}=e();return y?new Date(y)<=new Date:!0},getRemainingSessionTime:()=>{const{tokenExpiry:y}=e();if(!y)return 0;const A=new Date(y),I=new Date;return Math.max(0,A.getTime()-I.getTime())}}}),hg=Object.freeze(Object.defineProperty({__proto__:null,useLoginStore:Ar},Symbol.toStringTag,{value:"Module"}));function xl(i,e=3e5){const t=new Date(Date.now()-e),r=i.filter(o=>o.timestamp>t);if(r.length===0)return{avg:0,min:0,max:0,count:0,p95:0,p99:0};const n=r.map(o=>o.value).sort((o,c)=>o-c);return{avg:n.reduce((o,c)=>o+c,0)/n.length,min:n[0],max:n[n.length-1],count:n.length,p95:n[Math.floor(n.length*.95)],p99:n[Math.floor(n.length*.99)]}}function Hl(i,e){let t=!1,r="warning";switch(e.operator){case"gt":t=i.value>e.warning,r=i.value>e.critical?"critical":"warning";break;case"lt":t=i.value<e.warning,r=i.value<e.critical?"critical":"warning";break;case"gte":t=i.value>=e.warning,r=i.value>=e.critical?"critical":"warning";break;case"lte":t=i.value<=e.warning,r=i.value<=e.critical?"critical":"warning";break;case"eq":t=i.value===e.warning,r=i.value===e.critical?"critical":"warning";break}return{shouldAlert:t,severity:r}}function Dl(i,e=3e5){const t=[],r=new Date(Date.now()-e),n=i.filter(h=>h.timestamp>r);if(n.length<2)return t;const s=n.map(h=>h.value),o=s.slice(0,Math.floor(s.length/2)),c=s.slice(Math.floor(s.length/2)),a=o.reduce((h,p)=>h+p,0)/o.length,u=(c.reduce((h,p)=>h+p,0)/c.length-a)/a*100;let d="stable";return Math.abs(u)>10&&(d=u<0?"improving":"degrading"),t.push({metric:n[0].name,trend:d,changePercent:Math.round(u*100)/100,period:`${Math.round(e/6e4)} minutes`}),t}function Rl(i,e,t){let r=100;i>1e3&&(r-=20),e>5&&(r-=30),t>500*1024*1024&&(r-=20);let n="healthy";return r<50?n="critical":r<80&&(n="degraded"),{score:Math.max(0,r),status:n}}function Vl(i){const e=i.filter(o=>o.status==="fail").length,t=i.filter(o=>o.status==="warn").length,r=i.length;let n="healthy";e>0?n=e>r/2?"critical":"degraded":t>0&&(n="degraded");const s=Math.max(0,100-e*50-t*25);return{status:n,score:s}}function $l(){return`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function jl(i,e,t,r){return`${i} ${e} ${t} (current: ${r})`}function Ul(i){return Date.now()-i.getTime()<3e5}function Nl(i,e=60){return i/e}function Ri(i,e=50){return i.substring(0,e)}function Fl(i){return Math.round(i/1024/1024)}function zl(i,e=200){return i<e*1024*1024}class Bl{constructor(){this.alerts=[],this.alertSubscribers=[]}createAlert(e,t,r){const s={id:$l(),metric:e.name,value:e.value,threshold:t.warning,severity:r,message:jl(e.name,t.operator,t.warning,e.value),timestamp:new Date,resolved:!1};this.alerts.find(c=>c.metric===s.metric&&c.severity===s.severity&&!c.resolved&&Ul(c.timestamp))||(this.alerts.push(s),H.warn(`Performance alert: ${s.message}`,s),this.notifyAlertSubscribers(s))}getActiveAlerts(){return this.alerts.filter(e=>!e.resolved)}resolveAlert(e){const t=this.alerts.find(r=>r.id===e);t&&(t.resolved=!0,t.resolvedAt=new Date,H.info(`Alert resolved: ${e}`,t))}subscribeToAlerts(e){return this.alertSubscribers.push(e),()=>{const t=this.alertSubscribers.indexOf(e);t>-1&&this.alertSubscribers.splice(t,1)}}notifyAlertSubscribers(e){this.alertSubscribers.forEach(t=>{try{t(e)}catch(r){H.error("Error in alert subscriber:",r)}})}logMetricRecorded(e,t,r,n,s){H.debug(`Performance metric recorded: ${e}=${t}${r}`,{tags:n,metadata:s})}logThresholdsUpdated(e){H.info("Performance thresholds updated",{thresholds:e})}logSnapshotCaptured(e,t,r){H.debug("Performance snapshot captured",{timestamp:e,metricsCount:t,alertsCount:r})}logSnapshotError(e){H.error("Failed to capture performance snapshot:",e)}logMonitoringDisabled(){console.log("Performance monitoring disabled in development mode")}logDatabaseCheckError(e){console.error(e)}logMemoryCheckError(e){console.error(e)}}const Te=new Bl;var Pa=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function ql(i,e){const t=e.filter(r=>r.metric===i.name);for(const r of t){const{shouldAlert:n,severity:s}=Hl(i,r);n&&Te.createAlert(i,r,s)}}function Gl(){return[{metric:"response_time",warning:1e3,critical:5e3,operator:"gt"},{metric:"component_mount_time",warning:1e3,critical:3e3,operator:"gt"},{metric:"authentication_time",warning:2e3,critical:5e3,operator:"gt"},{metric:"data_fetch_time",warning:2e3,critical:5e3,operator:"gt"},{metric:"navigation_time",warning:1e3,critical:3e3,operator:"gt"},{metric:"error_rate",warning:5,critical:10,operator:"gt"},{metric:"memory_usage",warning:200*1024*1024,critical:500*1024*1024,operator:"gt"}]}function Kl(){return()=>Pa(null,null,function*(){try{const i=Date.now();return{name:"database",status:"pass",message:"Database connection healthy",duration:Date.now()-i}}catch(i){return Te.logDatabaseCheckError(i),{name:"database",status:"fail",message:"Database connection failed",duration:0}}})}function Wl(i){return()=>Pa(null,null,function*(){try{const e=i("memory_usage");return{name:"memory",status:zl(e.avg)?"pass":"warn",message:`Memory usage: ${Fl(e.avg)}MB`,duration:0}}catch(e){return Te.logMemoryCheckError(e),{name:"memory",status:"fail",message:"Memory check failed",duration:0}}})}function Zl(i,e,t){const r={timestamp:new Date,metrics:new Map,health:i,alerts:e};for(const[n,s]of Array.from(t.entries()))if(s.length>0){const o=s[s.length-1];r.metrics.set(n,o.value)}return r}function Ql(i){const e=i("response_time").avg,t=i("error_rate").avg,r=i("memory_usage").avg,{score:n,status:s}=Rl(e,t,r);return{status:s,score:n,checks:[],metrics:{cpu:0,memory:r,responseTime:e,errorRate:t,throughput:i("throughput").avg},lastUpdated:new Date}}function Yl(i,e,t){const r=[];i.status==="critical"&&r.push({type:"critical",title:"System Critical",description:"System is in critical state with multiple failures",impact:"high",recommendations:["Check system resources immediately","Review error logs for root cause","Consider scaling resources"]});const n=e("response_time")[0];n&&n.trend==="degrading"&&r.push({type:"warning",title:"Response Time Degradation",description:`Response time has increased by ${n.changePercent}%`,impact:"medium",recommendations:["Optimize database queries","Check for memory leaks","Review caching strategies"]});const s=e("memory_usage")[0];s&&s.trend==="degrading"&&r.push({type:"warning",title:"Memory Usage Increasing",description:`Memory usage has increased by ${s.changePercent}%`,impact:"medium",recommendations:["Check for memory leaks","Optimize data structures","Consider garbage collection tuning"]});const o=t("response_time").avg;return o>1e3&&r.push({type:"optimization",title:"Response Time Optimization",description:`Average response time is ${o.toFixed(2)}ms`,impact:"low",recommendations:["Implement response caching","Optimize API endpoints","Consider CDN implementation"]}),r}var Jl=Object.defineProperty,Xl=Object.defineProperties,eu=Object.getOwnPropertyDescriptors,Vi=Object.getOwnPropertySymbols,tu=Object.prototype.hasOwnProperty,ru=Object.prototype.propertyIsEnumerable,$i=(i,e,t)=>e in i?Jl(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,_e=(i,e)=>{for(var t in e||(e={}))tu.call(e,t)&&$i(i,t,e[t]);if(Vi)for(var t of Vi(e))ru.call(e,t)&&$i(i,t,e[t]);return i},nu=(i,e)=>Xl(i,eu(e)),yn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Ft{constructor(){this.metrics=new Map,this.thresholds=[],this.healthChecks=[],this.MAX_METRICS_PER_TYPE=1e3,this.performanceHistory=new Map,this.monitoringInterval=null,this.isMonitoring=!1,this.initializeDefaultThresholds(),this.initializeHealthChecks(),this.startContinuousMonitoring()}static getInstance(){return Ft.instance||(Ft.instance=new Ft),Ft.instance}recordMetric(e,t,r,n={},s){const o={name:e,value:t,unit:r,timestamp:new Date,tags:n,metadata:s};this.metrics.has(e)||this.metrics.set(e,[]);const c=this.metrics.get(e);c.push(o),c.length>this.MAX_METRICS_PER_TYPE&&c.splice(0,c.length-this.MAX_METRICS_PER_TYPE),ql(o,this.thresholds),Te.logMetricRecorded(e,t,r,n,s)}recordResponseTime(e,t,r={}){this.recordMetric("response_time",t,"ms",_e({operation:e},r))}recordErrorRate(e,t,r={}){this.recordMetric("error_rate",t,"percent",_e({service:e},r))}recordThroughput(e,t,r=60,n={}){const s=Nl(t,r);this.recordMetric("throughput",s,"ops/sec",_e({operation:e,period:r.toString()},n))}recordMemoryUsage(e,t,r={}){this.recordMetric("memory_usage",t,"bytes",_e({type:e},r))}recordDatabaseQuery(e,t,r,n={}){this.recordMetric("db_query_duration",t,"ms",_e({query:Ri(e)},n)),this.recordMetric("db_query_rows",r,"count",_e({query:Ri(e)},n))}recordComponentMount(e,t,r={}){this.recordMetric("component_mount_time",t,"ms",_e({component:e},r))}recordAuthentication(e,t,r={}){this.recordMetric("authentication_time",e,"ms",_e({success:t.toString()},r))}recordDataFetch(e,t,r,n={}){this.recordMetric("data_fetch_time",t,"ms",_e({operation:e,success:r.toString()},n))}recordNavigation(e,t,r,n={}){this.recordMetric("navigation_time",r,"ms",_e({from:e,to:t},n))}getMetrics(e,t=100){return(this.metrics.get(e)||[]).slice(-t)}getAllMetrics(){return new Map(this.metrics)}getAggregatedMetrics(e,t=3e5){const r=this.metrics.get(e)||[];return xl(r,t)}getSystemHealth(){return yn(this,null,function*(){const e=yield Promise.all(this.healthChecks.map(c=>yn(this,null,function*(){const a=Date.now();try{const l=yield c();return nu(_e({},l),{duration:Date.now()-a})}catch(l){return{name:"unknown",status:"fail",message:l instanceof Error?l.message:"Unknown error",duration:Date.now()-a}}}))),{status:t,score:r}=Vl(e),n=this.getAggregatedMetrics("response_time").avg,s=this.getAggregatedMetrics("error_rate").avg,o=this.getAggregatedMetrics("throughput").avg;return{status:t,score:r,checks:e,metrics:{cpu:0,memory:this.getAggregatedMetrics("memory_usage").avg,responseTime:n,errorRate:s,throughput:o},lastUpdated:new Date}})}getActiveAlerts(){return Te.getActiveAlerts()}resolveAlert(e){Te.resolveAlert(e)}addHealthCheck(e){this.healthChecks.push(e)}setThresholds(e){this.thresholds=e,Te.logThresholdsUpdated(e)}initializeDefaultThresholds(){this.thresholds=Gl()}initializeHealthChecks(){this.addHealthCheck(Kl()),this.addHealthCheck(Wl(e=>this.getAggregatedMetrics(e)))}startContinuousMonitoring(){this.isMonitoring||(this.isMonitoring=!0,this.monitoringInterval=setInterval(()=>{this.capturePerformanceSnapshot()},3e4))}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null),this.isMonitoring=!1}capturePerformanceSnapshot(){return yn(this,null,function*(){try{const e=yield this.getSystemHealth(),t=this.getActiveAlerts(),r=Zl(e,t,this.metrics),n="performance_snapshot";this.performanceHistory.has(n)||this.performanceHistory.set(n,[]);const s=this.performanceHistory.get(n);s.push(r),s.length>100&&s.splice(0,s.length-100),Te.logSnapshotCaptured(r.timestamp,r.metrics.size,t.length)}catch(e){Te.logSnapshotError(e)}})}getPerformanceTrends(e,t=3e5){const r=this.metrics.get(e)||[];return Dl(r,t)}getPerformanceInsights(){const e=this.getSystemHealthSync();return Yl(e,t=>this.getPerformanceTrends(t),t=>this.getAggregatedMetrics(t))}subscribeToAlerts(e){return Te.subscribeToAlerts(e)}getPerformanceHistory(e){return e?this.performanceHistory.get(e)||[]:this.performanceHistory.get("performance_snapshot")||[]}getSystemHealthSync(){return Ql(e=>this.getAggregatedMetrics(e))}}const rn=Ft.getInstance();var ji,Ui;const iu=(ji="")!=null?ji:"",su=(Ui="")!=null?Ui:"",Oa=()=>({url:iu,anonKey:su}),kr=()=>{function i(){let r=Ve("VITE_SUPABASE_URL",""),n=Ve("VITE_SUPABASE_ANON_KEY","");if(!r||!n){const s=Oa();r=s.url,n=s.anonKey}return{supabaseUrl:r,supabaseAnonKey:n}}const{supabaseUrl:e,supabaseAnonKey:t}=i();return!!(e&&t&&e!=="https://mock.supabase.co")},au=()=>{function i(){let t=Ve("VITE_SUPABASE_URL",""),r=Ve("VITE_SUPABASE_ANON_KEY","");if(!t||!r){const n=Oa();t=n.url,r=n.anonKey}return{supabaseUrl:t,supabaseAnonKey:r}}const{supabaseUrl:e}=i();return e||""},Ma=i=>typeof i=="string"?new Error(i):i!=null&&i.message?new Error(i.message):typeof i=="object"&&"error_description"in i&&i.error_description?new Error(i.error_description):new Error("An unexpected error occurred with Supabase"),fg=Object.freeze(Object.defineProperty({__proto__:null,getSupabaseUrl:au,handleSupabaseError:Ma,isSupabaseConfigured:kr,supabase:_},Symbol.toStringTag,{value:"Module"}));class xa{static subscribe(e,t,r){const n=(r==null?void 0:r.event)||"*",s=_.channel(e).on("postgres_changes",{event:n,schema:"public"},t).subscribe();return this.subscriptions.push(s),()=>{this.unsubscribe(s)}}static unsubscribe(e){e&&typeof e=="object"&&"unsubscribe"in e&&e.unsubscribe(),this.subscriptions=this.subscriptions.filter(t=>t!==e)}static forceCleanup(){this.subscriptions.forEach(e=>{e&&typeof e=="object"&&"unsubscribe"in e&&e.unsubscribe()}),this.subscriptions=[]}static getStats(){return{activeChannels:this.subscriptions.length,totalChannels:this.subscriptions.length,totalSubscribers:this.subscriptions.length,tableSubscribers:{},subscriptions:this.subscriptions,performance:{isHealthy:this.subscriptions.length<50,warnings:this.subscriptions.length>30?["High subscription count"]:[],recommendations:this.subscriptions.length>20?["Consider cleanup"]:[]}}}static cleanup(){this.forceCleanup()}static globalCleanup(){this.forceCleanup()}static nuclearCleanup(){console.warn(" NUCLEAR CLEANUP: Force-disconnecting all realtime connections"),this.forceCleanup()}}xa.subscriptions=[];function pg(i){return R({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"},child:[]}]})(i)}function gg(i){return R({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M425.7 256c-16.9 0-32.8-9-41.4-23.4L320 126l-64.2 106.6c-8.7 14.5-24.6 23.5-41.5 23.5-4.5 0-9-.6-13.3-1.9L64 215v178c0 14.7 10 27.5 24.2 31l216.2 54.1c10.2 2.5 20.9 2.5 31 0L551.8 424c14.2-3.6 24.2-16.4 24.2-31V215l-137 39.1c-4.3 1.3-8.8 1.9-13.3 1.9zm212.6-112.2L586.8 41c-3.1-6.2-9.8-9.8-16.7-8.9L320 64l91.7 152.1c3.8 6.3 11.4 9.3 18.5 7.3l197.9-56.5c9.9-2.9 14.7-13.9 10.2-23.1zM53.2 41L1.7 143.8c-4.6 9.2.3 20.2 10.1 23l197.9 56.5c7.1 2 14.7-1 18.5-7.3L320 64 69.8 32.1c-6.9-.8-13.5 2.7-16.6 8.9z"},child:[]}]})(i)}function mg(i){return R({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M256.47 216.77l86.73 109.18s-16.6 102.36-76.57 150.12C206.66 523.85 0 510.19 0 510.19s3.8-23.14 11-55.43l94.62-112.17c3.97-4.7-.87-11.62-6.65-9.5l-60.4 22.09c14.44-41.66 32.72-80.04 54.6-97.47 59.97-47.76 163.3-40.94 163.3-40.94zM636.53 31.03l-19.86-25c-5.49-6.9-15.52-8.05-22.41-2.56l-232.48 177.8-34.14-42.97c-5.09-6.41-15.14-5.21-18.59 2.21l-25.33 54.55 86.73 109.18 58.8-12.45c8-1.69 11.42-11.2 6.34-17.6l-34.09-42.92 232.48-177.8c6.89-5.48 8.04-15.53 2.55-22.44z"},child:[]}]})(i)}function yg(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M511.988 288.9c-.478 17.43-15.217 31.1-32.653 31.1H424v16c0 21.864-4.882 42.584-13.6 61.145l60.228 60.228c12.496 12.497 12.496 32.758 0 45.255-12.498 12.497-32.759 12.496-45.256 0l-54.736-54.736C345.886 467.965 314.351 480 280 480V236c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v244c-34.351 0-65.886-12.035-90.636-32.108l-54.736 54.736c-12.498 12.497-32.759 12.496-45.256 0-12.496-12.497-12.496-32.758 0-45.255l60.228-60.228C92.882 378.584 88 357.864 88 336v-16H32.666C15.23 320 .491 306.33.013 288.9-.484 270.816 14.028 256 32 256h56v-58.745l-46.628-46.628c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0L141.255 160h229.489l54.627-54.627c12.498-12.497 32.758-12.497 45.256 0 12.496 12.497 12.496 32.758 0 45.255L424 197.255V256h56c17.972 0 32.484 14.816 31.988 32.9zM257 0c-61.856 0-112 50.144-112 112h224C369 50.144 318.856 0 257 0z"},child:[]}]})(i)}function vg(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(i)}function _g(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z"},child:[]}]})(i)}function it(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(i)}function wg(i){return R({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(i)}function bg(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(i)}function Cg(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(i)}function Sg(i){return R({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"},child:[]}]})(i)}function Ag(i){return R({attr:{viewBox:"0 0 288 512"},child:[{tag:"path",attr:{d:"M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"},child:[]}]})(i)}function Ig(i){return R({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(i)}function Jn(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(i)}function Eg(i){return R({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(i)}function kg(i){return R({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M216 23.86c0-23.8-30.65-32.77-44.15-13.04C48 191.85 224 200 224 288c0 35.63-29.11 64.46-64.85 63.99-35.17-.45-63.15-29.77-63.15-64.94v-85.51c0-21.7-26.47-32.23-41.43-16.5C27.8 213.16 0 261.33 0 320c0 105.87 86.13 192 192 192s192-86.13 192-192c0-170.29-168-193-168-296.14z"},child:[]}]})(i)}function Lg(i){return R({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M437.2 403.5L320 215V64h8c13.3 0 24-10.7 24-24V24c0-13.3-10.7-24-24-24H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h8v151L10.8 403.5C-18.5 450.6 15.3 512 70.9 512h306.2c55.7 0 89.4-61.5 60.1-108.5zM137.9 320l48.2-77.6c3.7-5.2 5.8-11.6 5.8-18.4V64h64v160c0 6.9 2.2 13.2 5.8 18.4l48.2 77.6h-172z"},child:[]}]})(i)}function Tg(i){return R({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(i)}function ou(i){return R({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(i)}function Pg(i){return R({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},child:[]}]})(i)}function Og(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(i)}function Mg(i){return R({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(i)}function xg(i){return R({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M501.1 395.7L384 278.6c-23.1-23.1-57.6-27.6-85.4-13.9L192 158.1V96L64 0 0 64l96 128h62.1l106.6 106.6c-13.6 27.8-9.2 62.3 13.9 85.4l117.1 117.1c14.6 14.6 38.2 14.6 52.7 0l52.7-52.7c14.5-14.6 14.5-38.2 0-52.7zM331.7 225c28.3 0 54.9 11 74.9 31l19.4 19.4c15.8-6.9 30.8-16.5 43.8-29.5 37.1-37.1 49.7-89.3 37.9-136.7-2.2-9-13.5-12.1-20.1-5.5l-74.4 74.4-67.9-11.3L334 98.9l74.4-74.4c6.6-6.6 3.4-17.9-5.7-20.2-47.4-11.7-99.6.9-136.6 37.9-28.5 28.5-41.9 66.1-41.2 103.6l82.1 82.1c8.1-1.9 16.5-2.9 24.7-2.9zm-103.9 82l-56.7-56.7L18.7 402.8c-25 25-25 65.5 0 90.5s65.5 25 90.5 0l123.6-123.6c-7.6-19.9-9.9-41.6-5-62.7zM64 472c-13.2 0-24-10.8-24-24 0-13.3 10.7-24 24-24s24 10.7 24 24c0 13.2-10.7 24-24 24z"},child:[]}]})(i)}function Hg(i){return R({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 35.7 22.5 72.4 61.9 100.7 31.5 22.7 69.8 37.1 110 41.7C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6c40.3-4.6 78.6-19 110-41.7 39.3-28.3 61.9-65 61.9-100.7V88c0-13.3-10.7-24-24-24zM99.3 192.8C74.9 175.2 64 155.6 64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-15.1-5.2-29.2-12.4-41.7-21.4zM512 144c0 16.1-17.7 36.1-35.3 48.8-12.5 9-26.7 16.2-41.8 21.4 7-25 11.8-53.6 12.8-86.2H512v16z"},child:[]}]})(i)}function Dg(i){return R({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(i)}function cu(i){return R({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(i)}function Rg(i){return R({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(i)}var Ne=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Ha{constructor(e={}){const t=Ve("VITE_SUPABASE_URL",""),r=e.baseUrl||(t?`${t}/functions/v1/auth-login-simple`:"/api/auth-login-simple");this.config={baseUrl:r,timeout:e.timeout||3e4,retryAttempts:e.retryAttempts||3}}generateCSRFToken(){const e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}storeCSRFToken(e){try{sessionStorage.setItem("csrf_token",e)}catch(t){console.warn("Failed to store CSRF token:",t)}}getStoredCSRFToken(){try{return sessionStorage.getItem("csrf_token")}catch(e){return console.warn("Failed to retrieve CSRF token:",e),null}}validateCSRFToken(e,t){return t?e===t:!1}secureLogin(e){return Ne(this,null,function*(){const t=performance.now();try{console.log(" Using direct Supabase authentication");const r=_,{data:n,error:s}=yield r.auth.signInWithPassword({email:e.email.trim().toLowerCase(),password:e.password});if(s)throw new Error(s.message);if(!n.user||!n.session)throw new Error("Authentication failed - no user or session returned");const c={success:!0,data:{accessToken:n.session.access_token,refreshToken:n.session.refresh_token,expiresIn:n.session.expires_in,user:{id:n.user.id,email:n.user.email,role:"user"}}};return Sr()&&console.log(`[PERF] SecureAuthService: Direct Supabase login completed in ${(performance.now()-t).toFixed(2)}ms`),c}catch(r){return console.error(`[AUTH] Login failed for ${e.email}:`,r),{success:!1,error:r instanceof Error?r.message:"Authentication failed"}}})}makeSecureRequest(e){return Ne(this,null,function*(){const t=new AbortController,r=setTimeout(()=>t.abort(),this.config.timeout);try{const n=yield fetch(this.config.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:t.signal,credentials:"same-origin"});if(clearTimeout(r),!n.ok){const o=yield n.json().catch(()=>({}));if(n.status===429)return{success:!1,error:o.message||"Too many login attempts. Please try again later.",rateLimitInfo:o.rateLimitInfo};if(n.status===401)return{success:!1,error:o.message||"Invalid email or password"};throw new Error(o.message||`HTTP ${n.status}: ${n.statusText}`)}return yield n.json()}catch(n){throw clearTimeout(r),n.name==="AbortError"?new Error("Request timeout. Please check your connection and try again."):n}})}storeTokens(e){try{sessionStorage.setItem("access_token",e.accessToken),sessionStorage.setItem("refresh_token",e.refreshToken),sessionStorage.setItem("token_expires",(Date.now()+e.expiresIn*1e3).toString()),_.auth.setSession({access_token:e.accessToken,refresh_token:e.refreshToken})}catch(t){throw console.error("Failed to store authentication tokens:",t),new Error("Failed to store authentication tokens")}}validateStoredToken(){return Ne(this,null,function*(){try{const e=sessionStorage.getItem("access_token"),t=sessionStorage.getItem("token_expires");return!e||!t?!1:Date.now()>parseInt(t)?yield this.refreshToken():!0}catch(e){return console.error("Token validation failed:",e),!1}})}refreshToken(){return Ne(this,null,function*(){try{const e=sessionStorage.getItem("refresh_token");if(!e)return!1;const{data:t,error:r}=yield _.auth.refreshSession({refresh_token:e});return r||!t.session?(yield this.clearTokens(),!1):(this.storeTokens({accessToken:t.session.access_token,refreshToken:t.session.refresh_token,expiresIn:t.session.expires_in}),!0)}catch(e){return console.error("Token refresh failed:",e),yield this.clearTokens(),!1}})}clearTokens(){return Ne(this,null,function*(){try{sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),sessionStorage.removeItem("token_expires"),sessionStorage.removeItem("csrf_token"),yield _.auth.signOut()}catch(e){console.error("Failed to clear tokens:",e)}})}getCurrentUser(){return Ne(this,null,function*(){try{if(!(yield this.validateStoredToken()))return null;const{data:{user:t}}=yield _.auth.getUser();return t}catch(e){return console.error("Failed to get current user:",e),null}})}validateToken(e){return Ne(this,null,function*(){try{if(e){const{data:t,error:r}=yield _.auth.getUser(e);return!r&&!!t.user}else return yield this.validateStoredToken()}catch(t){return console.error("Token validation failed:",t),!1}})}logout(){return Ne(this,null,function*(){try{yield this.clearTokens(),console.log("[AUTH] Logout completed successfully")}catch(e){throw console.error("[AUTH] Logout error:",e),e}})}}new Ha;const Re=({className:i="",children:e})=>f.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${i}`,"aria-label":"Loading content",role:"status",children:e}),Vg=({className:i=""})=>f.jsxs("div",{className:`bg-white rounded-lg shadow-sm p-6 ${i}`,children:[f.jsx(Re,{className:"h-4 w-3/4 mb-4"}),f.jsx(Re,{className:"h-8 w-1/2 mb-2"}),f.jsx(Re,{className:"h-3 w-full mb-1"}),f.jsx(Re,{className:"h-3 w-2/3"})]}),$g=({rows:i=5,columns:e=4})=>f.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[f.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:f.jsx("div",{className:"flex space-x-4",children:Array.from({length:e}).map((t,r)=>f.jsx(Re,{className:"h-4 flex-1"},`header-${r}`))})}),f.jsx("div",{className:"divide-y divide-gray-200",children:Array.from({length:i}).map((t,r)=>f.jsx("div",{className:"px-6 py-4",children:f.jsx("div",{className:"flex space-x-4",children:Array.from({length:e}).map((n,s)=>f.jsx(Re,{className:"h-4 flex-1"},`cell-${r}-${s}`))})},`row-${r}`))})]}),jg=()=>f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex space-x-2",children:[f.jsx(Re,{className:"h-10 flex-1"}),f.jsx(Re,{className:"h-10 w-20"})]}),f.jsx("div",{className:"flex space-x-2",children:Array.from({length:4}).map((i,e)=>f.jsx(Re,{className:"h-8 w-16"},e))})]}),lu=({size:i="md"})=>{const e={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return f.jsx("div",{className:"flex justify-center items-center p-4",children:f.jsx("div",{className:`animate-spin rounded-full border-4 border-t-transparent border-blue-500 ${e[i]}`,role:"status","aria-label":"Loading"})})};var uu=Object.defineProperty,Ni=Object.getOwnPropertySymbols,du=Object.prototype.hasOwnProperty,hu=Object.prototype.propertyIsEnumerable,Fi=(i,e,t)=>e in i?uu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,st=(i,e)=>{for(var t in e||(e={}))du.call(e,t)&&Fi(i,t,e[t]);if(Ni)for(var t of Ni(e))hu.call(e,t)&&Fi(i,t,e[t]);return i},Vr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Tr{constructor(e){this.fallbackCache=new Map,this.cleanupInterval=null,this.config=st({blockDurationMs:e.windowMs*2},e),this.startCleanupInterval()}checkRateLimit(e,t){return Vr(this,null,function*(){const r=st(st({},this.config),t),n=`${r.keyPrefix}:${e}`,s=Date.now(),o=s-r.windowMs;try{if(nt.isHealthy())return yield this.checkRedisRateLimit(n,r,s,o)}catch(c){H.warn("Redis rate limiting failed, falling back to in-memory:",c)}return this.checkInMemoryRateLimit(n,r,s,o)})}checkRedisRateLimit(e,t,r,n){return Vr(this,null,function*(){const s=nt.getClient(),o=s.multi();o.zRemRangeByScore(e,"-inf",n),o.zCard(e),o.zAdd(e,{score:r,member:`${r}-${Math.random()}`}),o.expire(e,Math.ceil(t.windowMs/1e3));const c=`${e}:blocked`;o.get(c);const a=yield o.exec();if(!a||a.length<4)throw new Error("Redis pipeline execution failed");const l=a[1],u=a[4];if(u){const d=parseInt(u);if(r<d)return{allowed:!1,remaining:0,resetTime:d,retryAfter:Math.ceil((d-r)/1e3)};yield s.del(c)}if(l>=t.maxRequests){if(t.blockDurationMs){const d=r+t.blockDurationMs;yield s.setEx(c,Math.ceil(t.blockDurationMs/1e3),d.toString())}return{allowed:!1,remaining:0,resetTime:r+t.windowMs,retryAfter:Math.ceil(t.windowMs/1e3)}}return{allowed:!0,remaining:t.maxRequests-l-1,resetTime:r+t.windowMs}})}checkInMemoryRateLimit(e,t,r){const n=this.fallbackCache.get(e);n&&n.resetTime<r&&this.fallbackCache.delete(e);const s=this.fallbackCache.get(e)||{count:0,resetTime:r+t.windowMs,blocked:!1};return s.blocked&&s.blockUntil&&r<s.blockUntil?{allowed:!1,remaining:0,resetTime:s.blockUntil,retryAfter:Math.ceil((s.blockUntil-r)/1e3)}:(s.resetTime<r&&(s.count=0,s.resetTime=r+t.windowMs,s.blocked=!1,delete s.blockUntil),s.count>=t.maxRequests?(t.blockDurationMs&&(s.blocked=!0,s.blockUntil=r+t.blockDurationMs),this.fallbackCache.set(e,s),{allowed:!1,remaining:0,resetTime:s.resetTime,retryAfter:Math.ceil(t.windowMs/1e3)}):(s.count++,this.fallbackCache.set(e,s),{allowed:!0,remaining:t.maxRequests-s.count,resetTime:s.resetTime}))}resetRateLimit(e,t){return Vr(this,null,function*(){const n=`${st(st({},this.config),t).keyPrefix}:${e}`;try{if(nt.isHealthy()){const s=nt.getClient();yield s.del(n),yield s.del(`${n}:blocked`)}}catch(s){H.warn("Failed to reset Redis rate limit:",s)}this.fallbackCache.delete(n)})}getRateLimitStatus(e,t){return Vr(this,null,function*(){const r=st(st({},this.config),t),n=`${r.keyPrefix}:${e}`,s=Date.now(),o=s-r.windowMs;try{if(nt.isHealthy()){const a=nt.getClient(),l=`${n}:blocked`,u=yield a.get(l);if(u){const h=parseInt(u);if(s<h)return{allowed:!1,remaining:0,resetTime:h,retryAfter:Math.ceil((h-s)/1e3)}}const d=yield a.zCount(n,o,"+inf");return{allowed:d<r.maxRequests,remaining:Math.max(0,r.maxRequests-d),resetTime:s+r.windowMs}}}catch(a){H.warn("Failed to get Redis rate limit status:",a)}const c=this.fallbackCache.get(n);return!c||c.resetTime<s?{allowed:!0,remaining:r.maxRequests,resetTime:s+r.windowMs}:c.blocked&&c.blockUntil&&s<c.blockUntil?{allowed:!1,remaining:0,resetTime:c.blockUntil,retryAfter:Math.ceil((c.blockUntil-s)/1e3)}:{allowed:c.count<r.maxRequests,remaining:Math.max(0,r.maxRequests-c.count),resetTime:c.resetTime}})}startCleanupInterval(){this.cleanupInterval=setInterval(()=>{const e=Date.now();for(const[t,r]of this.fallbackCache.entries())r.resetTime<e&&this.fallbackCache.delete(t)},6e4)}getStats(){return{fallbackCacheSize:this.fallbackCache.size,redisHealthy:nt.isHealthy(),config:this.config}}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.fallbackCache.clear()}}new Tr({maxRequests:100,windowMs:60*1e3,keyPrefix:"api",blockDurationMs:300*1e3});new Tr({maxRequests:5,windowMs:900*1e3,keyPrefix:"auth",blockDurationMs:1800*1e3});new Tr({maxRequests:20,windowMs:60*1e3,keyPrefix:"ai",blockDurationMs:120*1e3});new Tr({maxRequests:30,windowMs:60*1e3,keyPrefix:"general"});class zi{static applyFilters(e,t){if(!t)return e;let r=e;return t.category&&(r=r.eq("category",t.category)),t.status&&(r=r.eq("status",t.status)),t.location&&(r=r.eq("location",t.location)),t.search&&(r=r.or(`name.ilike.%${t.search}%,category.ilike.%${t.search}%`)),r}static applyFiltersToTable(e,t,r){const n=e.from(t).select(`
      id,
      name,
      category,
      quantity,
      unit_cost,
      reorder_point,
      expiration_date,
      data,
      created_at,
      updated_at
    `,{count:"exact"});return this.applyFilters(n,r)}static applyFiltersToSelect(e,t,r,n){const s=e.from(t).select(r,{count:"exact"});return this.applyFilters(s,n)}static applyFiltersToSingle(e,t,r){return e.from(t).select("*").eq("id",r).single()}static applyFiltersToCategories(e,t){return e.from(t).select("category").not("category","is",null)}static applyFiltersToLocations(e,t){return e.from(t).select("location").not("location","is",null)}static extractUniqueValues(e,t){return Array.from(new Set((e==null?void 0:e.map(r=>r[t]))||[]))}static buildSearchQuery(e,t=["name","category"]){return t.map(r=>`${r}.ilike.%${e}%`).join(",")}static validateFilters(e){if(!e)return!0;if(e.search&&e.search.trim().length<2)return!1;const t=["active","inactive","maintenance","retired"];return!(e.status&&!t.includes(e.status))}static getFilterSummary(e){if(!e)return"no filters";const t=[];return e.category&&t.push(`category: ${e.category}`),e.status&&t.push(`status: ${e.status}`),e.location&&t.push(`location: ${e.location}`),e.search&&t.push(`search: "${e.search}"`),t.length>0?t.join(", "):"no filters"}}class he{static handleError(e,t){throw console.error(` ${t} failed:`,e),e&&typeof e=="object"&&"message"in e?Ma(e):new Error(`${t} failed: ${e}`)}static handleResponse(e,t){return e.error&&this.handleError(e.error,t),e.data}static logStart(e,t){}static logSuccess(e,t){}static logFailure(e,t){console.error(` ${e} failed:`,t)}}var fu=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function pu(){return fu(this,null,function*(){return yield N(()=>import("./TypedSupabaseAdapter-Bn-38cBa.js"),__vite__mapDeps([5,1,2,3,4]))})}var Me=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const gu=i=>i instanceof Error?i:typeof i=="object"&&i!==null&&"message"in i?new Error(String(i.message)):new Error("Unknown Supabase error occurred");class ne{static getTypedAdapter(){return Me(this,null,function*(){const{TypedSupabaseAdapter:e}=yield pu();return new e})}static getItems(e){return Me(this,null,function*(){const t="Fetching inventory items";zi.getFilterSummary(e);try{if(!zi.validateFilters(e))throw new Error("Invalid filter parameters");const n=yield(yield this.getTypedAdapter()).getAllItems({filters:e,orderBy:{column:"created_at",ascending:!1}});if(!n.success||!Array.isArray(n.data))throw new Error(n.error||"Failed to fetch inventory items");const s=n.data;return he.logSuccess(t,`${s.length} items`),{data:s,error:null,count:n.processedCount}}catch(r){throw console.error(" InventoryCrudOperations.getItems failed:",r),he.logFailure(t,r),r}})}static getItemById(e){return Me(this,null,function*(){const t=`Fetching inventory item by ID: ${e}`;try{const n=yield(yield this.getTypedAdapter()).getItemById(e);if(!n.success||!n.data)throw new Error(n.error||"Failed to fetch inventory item");const s=n.data;return he.logSuccess(t,s.name||"Unknown"),s}catch(r){throw he.logFailure(t,r),r}})}static createItem(e){return Me(this,null,function*(){var t,r,n,s,o,c;const a=`Creating inventory item: ${e.name}`;try{const u=yield(yield this.getTypedAdapter()).createItem({facility_id:e.facility_id||"",name:e.name||"",quantity:(t=e.quantity)!=null?t:void 0,data:(r=e.data)!=null?r:void 0,reorder_point:(n=e.reorder_point)!=null?n:void 0,expiration_date:(s=e.expiration_date)!=null?s:void 0,unit_cost:(o=e.unit_cost)!=null?o:void 0,category:(c=e.category)!=null?c:void 0});if(!u.success||!u.data)throw new Error(u.error||"Failed to create inventory item");return he.logSuccess(a,u.data.name||"Unknown"),u.data}catch(l){throw he.logFailure(a,l),l}})}static updateItem(e,t){return Me(this,null,function*(){var r,n,s,o,c,a,l;try{const d=yield(yield this.getTypedAdapter()).updateItem(e,{name:(r=t.name)!=null?r:void 0,quantity:(n=t.quantity)!=null?n:void 0,data:(s=t.data)!=null?s:void 0,reorder_point:(o=t.reorder_point)!=null?o:void 0,expiration_date:(c=t.expiration_date)!=null?c:void 0,unit_cost:(a=t.unit_cost)!=null?a:void 0,category:(l=t.category)!=null?l:void 0});if(!d.success||!d.data)throw new Error(d.error||"Failed to update inventory item");return d.data}catch(u){throw console.error(" Failed to update item in Supabase:",u),u}})}static deleteItem(e){return Me(this,null,function*(){const t=`Deleting inventory item: ${e}`;try{const n=yield(yield this.getTypedAdapter()).deleteItem(e);if(!n.success)throw new Error(n.error||"Failed to delete inventory item");he.logSuccess(t,`Deleted ${e}`)}catch(r){throw he.logFailure(t,r),r}})}static getCategories(){return Me(this,null,function*(){const e="Fetching inventory categories";try{const r=yield(yield this.getTypedAdapter()).getAllItems();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch categories");const n=Array.from(new Set(r.data.map(s=>s.category).filter(s=>!!s)));return he.logSuccess(e,`${n.length} categories`),n}catch(t){throw he.logFailure(e,t),t}})}static getLocations(){return Me(this,null,function*(){const e="Fetching inventory locations";try{const r=yield(yield this.getTypedAdapter()).getAllItems();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch locations");const n=Array.from(new Set(r.data.map(s=>{const o=s.data;return o==null?void 0:o.location}).filter(s=>!!s)));return he.logSuccess(e,`${n.length} locations`),n}catch(t){throw he.logFailure(e,t),t}})}static getAnalytics(){return Me(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),r=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:n,error:s}=yield _.from("inventory_items").select("*").eq("facility_id",r);if(s)throw console.error(" Error fetching analytics from Supabase:",s),gu(s);const o=n||[],c=o.length,a=o.length,l=o.reduce((d,h)=>d+(h.unit_cost||0),0),u={};return o.forEach(d=>{const h=d.category;h&&(u[h]=(u[h]||0)+1)}),{totalItems:c,activeItems:a,totalValue:l,categories:u}}catch(e){throw console.error(" Failed to fetch analytics from Supabase:",e),e}})}}var an=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function mu(i){return an(this,null,function*(){try{const{data:e,error:t}=yield _.from("suppliers").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getSuppliersByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting suppliers by facility:",e),{data:null,error:e}}})}function yu(i){return an(this,null,function*(){try{const{data:e,error:t}=yield _.from("inventory_transactions").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getInventoryTransactionsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory transactions by facility:",e),{data:null,error:e}}})}function vu(i){return an(this,null,function*(){try{const{data:e,error:t}=yield _.from("inventory_costs").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getInventoryCostsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory costs by facility:",e),{data:null,error:e}}})}function _u(i){return an(this,null,function*(){try{const{data:e,error:t}=yield _.from("equipment_maintenance").select("*").eq("facility_id",i);return t?(console.error("InventoryActionService getEquipmentMaintenanceByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting equipment maintenance by facility:",e),{data:null,error:e}}})}function Da(i){const e=[];return(!i.name||i.name.trim().length===0)&&e.push("Name is required"),(!i.category||i.category.trim().length===0)&&e.push("Category is required"),(!i.location||i.location.trim().length===0)&&e.push("Location is required"),i.quantity!==void 0&&i.quantity<0&&e.push("Quantity cannot be negative"),i.minQuantity!==void 0&&i.minQuantity<0&&e.push("Minimum quantity cannot be negative"),i.maxQuantity!==void 0&&i.maxQuantity<0&&e.push("Maximum quantity cannot be negative"),i.minQuantity!==void 0&&i.maxQuantity!==void 0&&i.minQuantity>i.maxQuantity&&e.push("Minimum quantity cannot be greater than maximum quantity"),i.cost!==void 0&&i.cost<0&&e.push("Cost cannot be negative"),i.expirationDate&&new Date(i.expirationDate)<new Date&&e.push("Expiration date cannot be in the past"),i.serialNumber&&i.serialNumber.trim().length===0&&e.push("Serial number cannot be empty"),i.barcode&&i.barcode.trim().length===0&&e.push("Barcode cannot be empty"),{isValid:e.length===0,errors:e}}function nn(i){var e,t,r,n,s,o,c;const a={name:(e=i.name)==null?void 0:e.trim(),description:(t=i.description)==null?void 0:t.trim(),category:(r=i.category)==null?void 0:r.trim(),location:(n=i.location)==null?void 0:n.trim(),status:i.status||"available",quantity:i.quantity||0,minQuantity:i.minQuantity||0,maxQuantity:i.maxQuantity||0,cost:i.cost||0,supplier:(s=i.supplier)==null?void 0:s.trim(),serialNumber:(o=i.serialNumber)==null?void 0:o.trim(),barcode:(c=i.barcode)==null?void 0:c.trim(),expirationDate:i.expirationDate,lastUpdated:new Date().toISOString()};return Object.keys(a).forEach(l=>{a[l]===void 0&&delete a[l]}),a}var wu=Object.defineProperty,bu=Object.defineProperties,Cu=Object.getOwnPropertyDescriptors,Bi=Object.getOwnPropertySymbols,Su=Object.prototype.hasOwnProperty,Au=Object.prototype.propertyIsEnumerable,qi=(i,e,t)=>e in i?wu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Iu=(i,e)=>{for(var t in e||(e={}))Su.call(e,t)&&qi(i,t,e[t]);if(Bi)for(var t of Bi(e))Au.call(e,t)&&qi(i,t,e[t]);return i},Eu=(i,e)=>bu(i,Cu(e)),ee=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function ku(i){return ee(this,null,function*(){try{return(yield ne.getItems(i)).data||[]}catch(e){throw console.error("Error getting items:",e),new Error("Failed to get items")}})}function Lu(i){return ee(this,null,function*(){try{return yield ne.getItemById(i)}catch(e){throw console.error("Error getting item by ID:",e),new Error("Failed to get item by ID")}})}function Ra(i){return ee(this,null,function*(){try{return(yield ne.getItems({category:i})).data||[]}catch(e){throw console.error("Error getting items by category:",e),new Error("Failed to get items by category")}})}function Tu(i){return ee(this,null,function*(){try{return(yield ne.getItems({location:i})).data||[]}catch(e){throw console.error("Error getting items by location:",e),new Error("Failed to get items by location")}})}function Pu(i){return ee(this,null,function*(){try{return(yield ne.getItems({status:i})).data||[]}catch(e){throw console.error("Error getting items by status:",e),new Error("Failed to get items by status")}})}function Ou(i){return ee(this,null,function*(){try{return(yield ne.getItems({search:i})).data||[]}catch(e){throw console.error("Error searching items:",e),new Error("Failed to search items")}})}function Mu(){return ee(this,null,function*(){try{return(yield ne.getItems({lowStock:!0})).data||[]}catch(i){throw console.error("Error getting low stock items:",i),new Error("Failed to get low stock items")}})}function xu(i=30){return ee(this,null,function*(){try{return(yield ne.getItems({expiringWithinDays:i})).data||[]}catch(e){throw console.error("Error getting expiring items:",e),new Error("Failed to get expiring items")}})}function Hu(i){return ee(this,null,function*(){try{const e=nn(i);return yield ne.createItem(e)}catch(e){throw console.error("Error creating item:",e),new Error("Failed to create item")}})}function zn(i,e){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const t=nn(e);return yield ne.updateItem(i,t)}catch(t){throw console.error("Error updating item:",t),new Error("Failed to update item")}})}function Bn(i){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");yield ne.deleteItem(i)}catch(e){throw console.error("Error deleting item:",e),new Error("Failed to delete item")}})}function Du(i){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");return yield ne.updateItem(i,{status:"archived",lastUpdated:new Date().toISOString()})}catch(e){throw console.error("Error archiving item:",e),new Error("Failed to archive item")}})}function Ru(i){return ee(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const e=yield ne.getItemById(i);if(!e)throw new Error("Original item not found");const t=Eu(Iu({},e),{name:`${e.name} (Copy)`,id:void 0,lastUpdated:void 0});return yield ne.createItem(t)}catch(e){throw console.error("Error duplicating item:",e),new Error("Failed to duplicate item")}})}function Vu(i,e){return ee(this,null,function*(){try{const r=(yield Ra(i)).map(o=>ne.updateItem(o.id,e));return{updatedCount:(yield Promise.allSettled(r)).filter(o=>o.status==="fulfilled").length}}catch(t){throw console.error("Error in bulk update by category:",t),new Error("Failed to bulk update items by category")}})}function $u(i){return ee(this,null,function*(){try{return yield mu(i)}catch(e){throw console.error("Error getting suppliers by facility:",e),new Error("Failed to get suppliers by facility")}})}function ju(i){return ee(this,null,function*(){try{return yield yu(i)}catch(e){throw console.error("Error getting inventory transactions by facility:",e),new Error("Failed to get inventory transactions by facility")}})}function Uu(i){return ee(this,null,function*(){try{return yield vu(i)}catch(e){throw console.error("Error getting inventory costs by facility:",e),new Error("Failed to get inventory costs by facility")}})}function Nu(i){return ee(this,null,function*(){try{return yield _u(i)}catch(e){throw console.error("Error getting equipment maintenance by facility:",e),new Error("Failed to get equipment maintenance by facility")}})}class Ge{static generateCacheKey(e,t){var r,n;const s=e.length+"_"+((r=e[0])==null?void 0:r.id)+"_"+((n=e[e.length-1])==null?void 0:n.id),o=JSON.stringify(t);return`${s}_${o}`}static getCachedResult(e){return this.EXPORT_CACHE.get(e)}static hasCachedResult(e){return this.EXPORT_CACHE.has(e)}static cacheExportResult(e,t){if(this.EXPORT_CACHE.size>=this.CACHE_MAX_SIZE){const r=this.EXPORT_CACHE.keys().next().value;r&&this.EXPORT_CACHE.delete(r)}this.EXPORT_CACHE.set(e,t)}static getCacheStats(){return{size:this.EXPORT_CACHE.size,maxSize:this.CACHE_MAX_SIZE}}static clearCache(){this.EXPORT_CACHE.clear()}static removeCachedResult(e){return this.EXPORT_CACHE.delete(e)}}Ge.EXPORT_CACHE=new Map;Ge.CACHE_MAX_SIZE=100;var Gi=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Ki{static standardExport(e,t){return Gi(this,null,function*(){switch(t.format){case"csv":return this.generateCSV(e,t);case"json":return this.generateJSON(e,t);case"excel":return yield this.generateExcel(e,t);default:throw new Error(`Unsupported export format: ${t.format}`)}})}static standardExportTransformed(e,t){return this.generateCSVFromTransformed(e,t,!0)}static generateCSV(e,t){const r=t.customFields||this.getDefaultCSVFields();let n="";t.includeHeaders&&(n+=r.map(s=>this.escapeCSVField(s)).join(",")+`
`);for(const s of e){const o=r.map(c=>{const a=this.getFieldValue(s,c);return this.escapeCSVField(a)});n+=o.join(",")+`
`}return n}static generateJSON(e,t){const r=t.customFields||this.getDefaultJSONFields(),n=e.map(s=>{const o={};for(const c of r)o[c]=this.getFieldValue(s,c);return o});return JSON.stringify(n,null,2)}static generateExcel(e,t){return Gi(this,null,function*(){const r=this.generateCSV(e,t);return new Blob([r],{type:"text/csv;charset=utf-8;"})})}static generateCSVFromTransformed(e,t,r){const n=t.customFields||[];let s="";r&&t.includeHeaders&&(s+=n.map(o=>this.escapeCSVField(o)).join(",")+`
`);for(const o of e){const c=n.map(a=>{const l=o[a]||"";return this.escapeCSVField(String(l))});s+=c.join(",")+`
`}return s}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}}class We{static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory;return(e==null?void 0:e.usedJSHeapSize)||0}return 0}static getMemoryStats(){const e=this.getMemoryUsage();let t;if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const r=performance.memory;t=r==null?void 0:r.jsHeapSizeLimit}return{current:e,limit:t}}static isMemoryUsageHigh(e){const t=this.getMemoryUsage(),r=e||this.DEFAULT_MAX_MEMORY;return t>r}static forceGarbageCollection(){typeof window!="undefined"&&"gc"in window&&typeof window.gc=="function"&&window.gc()}static getDefaultMaxMemory(){return this.DEFAULT_MAX_MEMORY}}We.DEFAULT_MAX_MEMORY=50*1024*1024;var Wi=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class qn{static streamingExport(e,t){return Wi(this,null,function*(){const r=t.chunkSize||this.DEFAULT_CHUNK_SIZE,n=[];for(let s=0;s<e.length;s+=r){const o=e.slice(s,s+r);We.isMemoryUsageHigh(t.maxMemoryUsage)&&We.forceGarbageCollection();let c;switch(t.format){case"csv":c=this.generateCSVChunk(o,t,s===0);break;case"json":c=this.generateJSONChunk(o,t,s===0,s+r>=e.length);break;default:throw new Error(`Streaming not supported for format: ${t.format}`)}n.push(c),s%(r*10)===0&&(yield new Promise(a=>setTimeout(a,0)))}return n.join("")})}static streamingExportTransformed(e,t){return Wi(this,null,function*(){const r=[],n=t.chunkSize||this.DEFAULT_CHUNK_SIZE;for(let s=0;s<e.length;s+=n){const o=e.slice(s,s+n),c=this.generateCSVFromTransformed(o,t,s===0);r.push(c),s%(n*10)===0&&(yield new Promise(a=>setTimeout(a,0)))}return r.join("")})}static generateCSVChunk(e,t,r){const n=t.customFields||this.getDefaultCSVFields();let s="";r&&t.includeHeaders&&(s+=n.map(o=>this.escapeCSVField(o)).join(",")+`
`);for(const o of e){const c=n.map(a=>{const l=this.getFieldValue(o,a);return this.escapeCSVField(l)});s+=c.join(",")+`
`}return s}static generateJSONChunk(e,t,r,n){const s=t.customFields||this.getDefaultJSONFields();let o="";r&&(o+=`[
`);const c=e.map(a=>{const l={};for(const u of s)l[u]=this.getFieldValue(a,u);return l});return o+=c.map(a=>"  "+JSON.stringify(a)).join(`,
`),n?o+=`
]`:o+=`,
`,o}static generateCSVFromTransformed(e,t,r){const n=t.customFields||[];let s="";r&&t.includeHeaders&&(s+=n.map(o=>this.escapeCSVField(o)).join(",")+`
`);for(const o of e){const c=n.map(a=>{const l=o[a]||"";return this.escapeCSVField(String(l))});s+=c.join(",")+`
`}return s}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}qn.DEFAULT_CHUNK_SIZE=1e3;class ar{static createDownloadUrl(e,t){const r=typeof e=="string"?new Blob([e],{type:"text/plain"}):e,n=URL.createObjectURL(r),s=document.createElement("a");return s.href=n,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(n),1e3),n}static getDataSize(e){return typeof e=="string"?new Blob([e]).size:e.size}static getDateString(){return new Date().toISOString().split("T")[0]}static generateFileName(e,t){const r=this.getDateString();return`${e}_${r}.${t}`}static revokeUrl(e){URL.revokeObjectURL(e)}}class or{static validateExportOptions(e){const t=[];return(!e.format||!["csv","json","excel"].includes(e.format))&&t.push("Invalid export format. Must be csv, json, or excel."),e.customFields&&!Array.isArray(e.customFields)&&t.push("Custom fields must be an array of strings."),e.chunkSize!==void 0&&(e.chunkSize<1||e.chunkSize>1e4)&&t.push("Chunk size must be between 1 and 10000."),e.maxMemoryUsage!==void 0&&e.maxMemoryUsage<1024*1024&&t.push("Max memory usage must be at least 1MB."),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to export."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateTemplate(e){const t=[];if(e||t.push("Template is required."),e&&typeof e=="object"&&"format"in e){const r=e.format;["csv","json","excel"].includes(r)||t.push("Template format must be csv, json, or excel.")}return{isValid:t.length===0,errors:t}}}var Zi=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Va{static exportItems(e){return Zi(this,arguments,function*(t,r={format:"csv",includeHeaders:!0}){const n=Date.now(),s=We.getMemoryUsage();try{const o=or.validateItems(t);if(!o.isValid)throw new Error(o.errors.join(", "));const c=or.validateExportOptions(r);if(!c.isValid)throw new Error(c.errors.join(", "));const a=Ge.generateCacheKey(t,r);if(Ge.hasCachedResult(a))return console.log("Export cache hit"),Ge.getCachedResult(a);let l;r.enableStreaming&&t.length>this.DEFAULT_CHUNK_SIZE?l=yield qn.streamingExport(t,r):l=yield Ki.standardExport(t,r);const u=ar.generateFileName("inventory_export",r.format),d=ar.createDownloadUrl(l,u),h=Date.now(),p=We.getMemoryUsage(),m={success:!0,fileName:u,dataSize:ar.getDataSize(l),itemCount:t.length,format:r.format,downloadUrl:d,processingTime:h-n,memoryUsage:p-s};return Ge.cacheExportResult(a,m),m}catch(o){throw console.error("Export failed:",o),new Error(`Export failed: ${o instanceof Error?o.message:"Unknown error"}`)}})}static exportWithTemplate(e,t){return Zi(this,null,function*(){const r=Date.now(),n=We.getMemoryUsage();try{const s=or.validateItems(e);if(!s.isValid)throw new Error(s.errors.join(", "));const o=or.validateTemplate(t);if(!o.isValid)throw new Error(o.errors.join(", "));if(!e||e.length===0)throw new Error("No items to export");const{InventoryExportTemplateService:c}=yield N(()=>import("./inventoryExportTemplateService-B91rpcBB.js"),[]),a=c.applyTemplate(e,t),l=c.generateFileName(t),u={format:t.format,includeHeaders:t.includeHeaders,dateFormat:t.dateFormat,customFields:t.fields.map(v=>String(v.key)),enableStreaming:e.length>this.DEFAULT_CHUNK_SIZE,chunkSize:this.DEFAULT_CHUNK_SIZE};let d;u.enableStreaming?d=yield qn.streamingExportTransformed(a,u):d=Ki.standardExportTransformed(a,u);const h=ar.createDownloadUrl(d,l),p=Date.now(),m=We.getMemoryUsage();return{success:!0,fileName:l,dataSize:ar.getDataSize(d),itemCount:a.length,format:t.format,downloadUrl:h,processingTime:p-r,memoryUsage:m-n}}catch(s){throw console.error("Template export failed:",s),new Error(`Template export failed: ${s instanceof Error?s.message:"Unknown error"}`)}})}static validateExportOptions(e){return or.validateExportOptions(e)}static getCacheStats(){return Ge.getCacheStats()}static clearCache(){Ge.clearCache()}static getMemoryStats(){return We.getMemoryStats()}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}Va.DEFAULT_CHUNK_SIZE=1e3;var Fu=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function zu(){return Fu(this,null,function*(){return yield N(()=>import("./SupabaseAdapter-Dm3EqNBh.js"),__vite__mapDeps([6,7,5,1,2,3,4]))})}var Bu=Object.defineProperty,qu=Object.defineProperties,Gu=Object.getOwnPropertyDescriptors,Qi=Object.getOwnPropertySymbols,Ku=Object.prototype.hasOwnProperty,Wu=Object.prototype.propertyIsEnumerable,Yi=(i,e,t)=>e in i?Bu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ji=(i,e)=>{for(var t in e||(e={}))Ku.call(e,t)&&Yi(i,t,e[t]);if(Qi)for(var t of Qi(e))Wu.call(e,t)&&Yi(i,t,e[t]);return i},Zu=(i,e)=>qu(i,Gu(e)),cr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Qu{constructor(e,t){this.isInitialized=!1,this.lastError=null,this.lastSyncTime=null,this.pendingChanges=!1,this.config=e,this.metadata=Zu(Ji({},t),{config:e})}getMetadata(){return Ji({},this.metadata)}batchAddItems(e){return cr(this,null,function*(){const t=[];for(const r of e)try{const n=yield this.addInventoryItem(r);t.push(n)}catch(n){throw this.setError(n),n}return t})}batchUpdateItems(e){return cr(this,null,function*(){const t=[];for(const r of e)try{const n=yield this.updateInventoryItem(r.id,r.item);t.push(n)}catch(n){throw this.setError(n),n}return t})}batchDeleteItems(e){return cr(this,null,function*(){for(const t of e)try{yield this.deleteInventoryItem(t)}catch(r){throw this.setError(r),r}})}sync(){return cr(this,null,function*(){try{this.lastSyncTime=new Date,this.pendingChanges=!1}catch(e){throw this.setError(e),e}})}getLastSyncTime(){return this.lastSyncTime}hasPendingChanges(){return this.pendingChanges}getLastError(){return this.lastError}clearError(){this.lastError=null}disconnect(){return cr(this,null,function*(){this.isInitialized=!1,this.lastError=null})}setError(e){this.lastError=e,console.error(`[${this.metadata.name}] Error:`,e)}setPendingChanges(){this.pendingChanges=!0}validateInitialization(){if(!this.isInitialized)throw new Error(`Adapter ${this.metadata.name} is not initialized. Call initialize() first.`)}}var Yu=Object.defineProperty,Ju=Object.defineProperties,Xu=Object.getOwnPropertyDescriptors,Xi=Object.getOwnPropertySymbols,ed=Object.prototype.hasOwnProperty,td=Object.prototype.propertyIsEnumerable,es=(i,e,t)=>e in i?Yu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$r=(i,e)=>{for(var t in e||(e={}))ed.call(e,t)&&es(i,t,e[t]);if(Xi)for(var t of Xi(e))td.call(e,t)&&es(i,t,e[t]);return i},ts=(i,e)=>Ju(i,Xu(e)),Ee=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const le={INVENTORY_DATA:"inventory_data",CATEGORIES:"inventory_categories",LAST_SYNC:"inventory_last_sync",PENDING_CHANGES:"inventory_pending_changes"};class rd extends Qu{constructor(e={type:"localStorage"}){const t={supportsRead:!0,supportsWrite:!0,supportsDelete:!0,supportsRealTime:!1,supportsOffline:!0,supportsBatch:!0};super(e,{name:"LocalStorageAdapter",version:"1.0.0",description:"Adapter for localStorage-based inventory data",capabilities:t}),this.storage=window.localStorage}initialize(){return Ee(this,null,function*(){try{if(!this.storage)throw new Error("localStorage is not available");this.storage.getItem(le.INVENTORY_DATA)||(yield this.initializeDefaultData()),this.isInitialized=!0,this.lastSyncTime=this.getLastSyncTimeFromStorage(),this.pendingChanges=this.getPendingChangesFromStorage()}catch(e){throw this.setError(e),e}})}isConnected(){return this.isInitialized&&!!this.storage}fetchAllInventoryData(){return Ee(this,null,function*(){this.validateInitialization();const e=this.getInventoryDataFromStorage(),t=[];return t.push(...e.tools),t.push(...e.supplies),t.push(...e.equipment),t.push(...e.officeHardware),{data:t,error:null,count:t.length}})}fetchInventoryItems(){return Ee(this,null,function*(){this.validateInitialization();const e=this.getInventoryDataFromStorage(),t=[];return t.push(...e.tools),t.push(...e.supplies),t.push(...e.equipment),t.push(...e.officeHardware),t})}fetchCategories(){return Ee(this,null,function*(){this.validateInitialization();const e=this.storage.getItem(le.CATEGORIES);return e?JSON.parse(e):this.getDefaultCategories()})}addInventoryItem(e){return Ee(this,null,function*(){this.validateInitialization();const t=this.getInventoryDataFromStorage(),r=ts($r({},e),{id:this.generateId(),createdAt:new Date().toISOString()}),n=(r.category||"").toLowerCase();return n.includes("tool")||n.includes("instrument")?t.tools.push(r):n.includes("supply")||n.includes("consumable")?t.supplies.push(r):n.includes("equipment")||n.includes("device")?t.equipment.push(r):t.officeHardware.push(r),this.saveInventoryDataToStorage(t),this.setPendingChanges(),this.updateLastSyncTime(),r})}updateInventoryItem(e,t){return Ee(this,null,function*(){this.validateInitialization();const r=this.getInventoryDataFromStorage(),n=ts($r({},t),{id:e,lastUpdated:new Date().toISOString()}),s=[r.tools,r.supplies,r.equipment,r.officeHardware];let o=!1;for(const c of s){const a=c.findIndex(l=>this.getItemId(l)===e);if(a!==-1){c[a]=$r($r({},c[a]),n),o=!0;break}}if(!o)throw new Error(`Item with id ${e} not found`);return this.saveInventoryDataToStorage(r),this.setPendingChanges(),this.updateLastSyncTime(),n})}deleteInventoryItem(e){return Ee(this,null,function*(){this.validateInitialization();const t=this.getInventoryDataFromStorage(),r=[t.tools,t.supplies,t.equipment,t.officeHardware];let n=!1;for(const s of r){const o=s.findIndex(c=>this.getItemId(c)===e);if(o!==-1){s.splice(o,1),n=!0;break}}if(!n)throw new Error(`Item with id ${e} not found`);this.saveInventoryDataToStorage(t),this.setPendingChanges(),this.updateLastSyncTime()})}addCategory(e){return Ee(this,null,function*(){this.validateInitialization();const t=yield this.fetchCategories();return t.includes(e)||(t.push(e),this.storage.setItem(le.CATEGORIES,JSON.stringify(t)),this.setPendingChanges(),this.updateLastSyncTime()),e})}deleteCategory(e){return Ee(this,null,function*(){this.validateInitialization();const t=yield this.fetchCategories(),r=t.indexOf(e);r!==-1&&(t.splice(r,1),this.storage.setItem(le.CATEGORIES,JSON.stringify(t)),this.setPendingChanges(),this.updateLastSyncTime())})}getInventoryDataFromStorage(){const e=this.storage.getItem(le.INVENTORY_DATA);return e?JSON.parse(e):{tools:[],supplies:[],equipment:[],officeHardware:[],categories:this.getDefaultCategories(),isLoading:!1,error:null}}saveInventoryDataToStorage(e){this.storage.setItem(le.INVENTORY_DATA,JSON.stringify(e))}getLastSyncTimeFromStorage(){const e=this.storage.getItem(le.LAST_SYNC);return e?new Date(e):null}getPendingChangesFromStorage(){const e=this.storage.getItem(le.PENDING_CHANGES);return e?JSON.parse(e):!1}updateLastSyncTime(){this.lastSyncTime=new Date,this.storage.setItem(le.LAST_SYNC,this.lastSyncTime.toISOString())}setPendingChanges(){this.pendingChanges=!0,this.storage.setItem(le.PENDING_CHANGES,JSON.stringify(!0))}initializeDefaultData(){return Ee(this,null,function*(){const e={tools:[],supplies:[],equipment:[],officeHardware:[],categories:this.getDefaultCategories(),isLoading:!1,error:null};this.saveInventoryDataToStorage(e),this.storage.setItem(le.CATEGORIES,JSON.stringify(this.getDefaultCategories())),this.storage.setItem(le.LAST_SYNC,new Date().toISOString()),this.storage.setItem(le.PENDING_CHANGES,JSON.stringify(!1))})}generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getItemId(e){var t,r,n,s;return((t=e.data)!=null&&t.toolId&&typeof e.data.toolId=="string"?e.data.toolId:"")||((r=e.data)!=null&&r.supplyId&&typeof e.data.supplyId=="string"?e.data.supplyId:"")||((n=e.data)!=null&&n.equipmentId&&typeof e.data.equipmentId=="string"?e.data.equipmentId:"")||((s=e.data)!=null&&s.hardwareId&&typeof e.data.hardwareId=="string"?e.data.hardwareId:"")||e.id}getDefaultCategories(){return["Surgical Instruments","Medical Supplies","Equipment","Office Hardware","Consumables","Disposables","Tools","Devices"]}}var nd=Object.defineProperty,rs=Object.getOwnPropertySymbols,id=Object.prototype.hasOwnProperty,sd=Object.prototype.propertyIsEnumerable,ns=(i,e,t)=>e in i?nd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,jr=(i,e)=>{for(var t in e||(e={}))id.call(e,t)&&ns(i,t,e[t]);if(rs)for(var t of rs(e))sd.call(e,t)&&ns(i,t,e[t]);return i},lr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ad{constructor(e){this.registry={},this.defaultAdapter=null,this.config={defaultAdapter:e.defaultAdapter||"localStorage",adapters:jr({},e.adapters),fallbackAdapter:e.fallbackAdapter||"supabase"}}createAdapter(e,t){return lr(this,null,function*(){if(this.registry[e])return this.registry[e];let r;switch(e){case"static":{const{StaticDataAdapter:n}=yield N(()=>import("./StaticDataAdapter-Ce5u2tbc.js"),__vite__mapDeps([8,1,2,3,4]));r=new n(t||{type:"static"});break}case"localStorage":{r=new rd(t||this.config.adapters.localStorage);break}case"api":{const{ApiAdapter:n,isApiAdapterConfig:s}=yield N(()=>import("./ApiAdapter-C2mXMyRJ.js"),[]),o=t||this.config.adapters.api;if(!o)throw new Error("API adapter configuration is required");if(!s(o))throw new Error("API adapter requires baseUrl configuration");r=new n(o);break}case"supabase":{const{SupabaseAdapter:n}=yield zu(),s=t||this.config.adapters.supabase;if(!s)throw new Error("Supabase adapter configuration is required");r=new n(s);break}default:throw new Error(`Unknown adapter type: ${e}`)}return yield r.initialize(),this.registerAdapter(e,r),r})}getAdapter(e){return this.registry[e]||null}registerAdapter(e,t){this.registry[e]=t,e===this.config.defaultAdapter&&(this.defaultAdapter=t)}unregisterAdapter(e){const t=this.registry[e];t&&(t.disconnect().catch(console.error),delete this.registry[e],this.defaultAdapter===t&&(this.defaultAdapter=null))}initializeDefaultAdapter(){return lr(this,null,function*(){if(this.defaultAdapter)return this.defaultAdapter;try{const e=yield this.createAdapter(this.config.defaultAdapter);return this.defaultAdapter=e,e}catch(e){if(console.error(e),console.error(`Failed to initialize default adapter (${this.config.defaultAdapter}):`),this.config.fallbackAdapter&&this.config.fallbackAdapter!==this.config.defaultAdapter)try{const t=yield this.createAdapter(this.config.fallbackAdapter);return this.defaultAdapter=t,t}catch(t){throw console.error(`Failed to initialize fallback adapter (${this.config.fallbackAdapter}):`,t),new Error("No available adapters could be initialized")}throw new Error("No available adapters could be initialized")}})}getAvailableAdapters(){return Object.keys(this.registry)}getAdapterMetadata(e){const t=this.registry[e];return t?t.getMetadata():null}updateConfig(e){this.config=jr(jr({},this.config),e)}getConfig(){return jr({},this.config)}switchDefaultAdapter(e){return lr(this,null,function*(){if(!["localStorage","api","supabase"].includes(e))throw new Error(`Invalid adapter type: ${e}`);return this.config.defaultAdapter=e,this.defaultAdapter=null,this.initializeDefaultAdapter()})}getBestAvailableAdapter(){return lr(this,null,function*(){try{return yield this.initializeDefaultAdapter()}catch(e){console.error(e);const t=["supabase","localStorage"];for(const r of t)try{return yield this.createAdapter(r)}catch(n){console.warn(`Failed to create adapter ${r}:`,n);continue}throw new Error("No adapters are available")}})}cleanup(){return lr(this,null,function*(){const e=Object.values(this.registry).map(t=>t.disconnect().catch(console.error));yield Promise.all(e),this.registry={},this.defaultAdapter=null})}}const zt=new ad({defaultAdapter:"supabase",adapters:{supabase:{type:"supabase"},localStorage:{type:"localStorage"}},fallbackAdapter:"localStorage"}),Xn=i=>i.status||i.category||"",od=i=>{var e,t,r,n;return((e=i.data)==null?void 0:e.toolId)||((t=i.data)==null?void 0:t.supplyId)||((r=i.data)==null?void 0:r.equipmentId)||((n=i.data)==null?void 0:n.hardwareId)||i.toolId||i.supplyId||i.equipmentId||i.hardwareId||i.id},Ug=(i,e)=>{const t=new Set(i);return t.has(e)?t.delete(e):t.add(e),t},cd=(i,e)=>{i(e)};function Ng(){return{itemName:"",category:"",id:"",location:"",status:"Available",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const Fg=()=>({general:!0,purchase:!1,maintenance:!1,usage:!1}),zg=i=>{var e;return{itemName:i.name||i.item||"",category:i.category||"",id:od(i),location:i.location||"",status:i.status||"",quantity:i.quantity||1,unitCost:i.unit_cost||0,minimumQuantity:i.reorder_point||0,maximumQuantity:((e=i.data)==null?void 0:e.maximumQuantity)||0,supplier:i.supplier||"",updated_at:i.updated_at||new Date().toISOString(),createdAt:i.created_at||new Date().toISOString()}},ld=i=>{switch(i.toLowerCase()){case"complete":case"available":case"clean":return"bg-green-100 text-green-800";case"bath1":case"bath2":return"bg-blue-100 text-blue-800";case"airDry":case"drying":return"bg-yellow-100 text-yellow-800";case"autoclave":return"bg-purple-100 text-purple-800";case"dirty":return"bg-orange-100 text-orange-800";case"damaged":case"failed":return"bg-red-100 text-red-800";case"operational":case"active":return"bg-green-100 text-green-800";case"maintenance":case"out-of-service":return"bg-amber-100 text-amber-800";case"inactive":return"bg-gray-100 text-gray-800";case"in-stock":return"bg-green-100 text-green-800";case"low-stock":return"bg-yellow-100 text-yellow-800";case"out-of-stock":return"bg-red-100 text-red-800";case"in-use":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},ud=i=>{switch(i.toLowerCase()){case"complete":return"Available";case"bath1":return"Bath 1";case"bath2":return"Bath 2";case"airDry":case"drying":return"Air Dry";case"autoclave":return"Autoclave";case"clean":return"Clean";case"dirty":return"Dirty";case"damaged":return"Damaged";case"failed":return"Failed";case"operational":return"Operational";case"maintenance":return"Maintenance";case"out-of-service":return"Out of Service";case"active":return"Available";case"inactive":return"In Use";case"in-stock":return"In Stock";case"low-stock":return"Low Stock";case"out-of-stock":return"Out of Stock";case"available":return"Available";case"in-use":return"In Use";default:return i||"Unknown"}};var dd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class $a{createCategoryChangeHandler(e){return t=>{cd(e,t)}}createTrackedFilterHandler(e,t){return()=>{t(!e)}}createFavoritesFilterHandler(e,t){return()=>{t(!e)}}}class ja{constructor(){this.filteredToolsData=[]}getFilteredTools(){return this.filteredToolsData.map(e=>{var t;return{id:e.id||"",name:e.name||e.item||"",barcode:((t=e.data)==null?void 0:t.barcode)||"",currentPhase:Xn(e),category:e.category||""}})}setFilteredToolsData(e){this.filteredToolsData=e}setFilteredTools(e){this.filteredToolsData=e}}class Ua{getStatusBadge(e){return ld(e)}getStatusText(e){return ud(e)}getItemStatus(e){return Xn(e)||"Unknown"}}class hd{constructor(){this.currentAdapter=null,this.adapterType="static",this.initialized=!1}initialize(){return dd(this,null,function*(){this.initialized||(this.currentAdapter=yield zt.initializeDefaultAdapter(),this.adapterType=zt.getConfig().defaultAdapter,this.initialized=!0)})}getAdapter(){if(!this.currentAdapter)throw new Error("Inventory service facade not initialized. Call initialize() first.");return this.currentAdapter}getCurrentAdapterType(){return this.adapterType}getAdapterMetadata(){return zt.getAdapterMetadata(this.adapterType)}getAvailableAdapters(){return zt.getAvailableAdapters()}}var is=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class L{static handleOperation(e,t){return is(this,null,function*(){try{return yield t()}catch(r){throw console.error(` ${e} failed:`,r),r}})}static executeWithRetry(e,t,r=3){return is(this,null,function*(){let n=null;for(let s=1;s<=r;s++)try{return yield t()}catch(o){if(n=o instanceof Error?o:new Error("Unknown error"),s===r)throw o;console.warn(`Retry attempt ${s}/${r} for operation: ${e}`),yield new Promise(c=>setTimeout(c,1e3*s))}throw n||new Error("Operation failed after all retry attempts")})}static delay(e){return new Promise(t=>setTimeout(t,e))}}class ei{constructor(){this.cacheManagers=new Map}static getInstance(){return this.instance||(this.instance=new ei),this.instance}registerCacheManager(e,t){this.cacheManagers.set(e,t),console.log(` Registered cache manager: ${e}`)}unregisterCacheManager(e){this.cacheManagers.delete(e),console.log(` Unregistered cache manager: ${e}`)}onInvalidation(){console.log(" Cache invalidation listener registered (simplified)")}offInvalidation(){console.log(" Cache invalidation listener removed (simplified)")}invalidatePattern(e){console.log(` Invalidating cache pattern: ${e}`),this.cacheManagers.forEach((t,r)=>{(r.includes(e)||e==="all")&&(t.invalidatePattern?t.invalidatePattern(e):t.clearCache())})}invalidateKey(e){console.log(` Invalidating cache key: ${e}`),this.cacheManagers.forEach(t=>{t.invalidateKey&&t.invalidateKey(e)})}invalidateRelated(e,t){console.log(` Invalidating related caches for operation: ${e}${t?` (${t})`:""}`),e.startsWith("inventory:")?this.invalidatePattern("inventory"):e.startsWith("knowledge:")?this.invalidatePattern("knowledge"):e.startsWith("cleaning:")?this.invalidatePattern("cleaning"):(e==="user:login"||e==="user:logout"||e==="app:refresh")&&this.clearAllCaches()}clearAllCaches(){console.log(" Clearing all caches"),this.cacheManagers.forEach(e=>{e.clearCache()})}getRegisteredManagers(){return Array.from(this.cacheManagers.keys())}isRegistered(e){return this.cacheManagers.has(e)}}const X=ei.getInstance();var fd=Object.defineProperty,ss=Object.getOwnPropertySymbols,pd=Object.prototype.hasOwnProperty,gd=Object.prototype.propertyIsEnumerable,as=(i,e,t)=>e in i?fd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ur=(i,e)=>{for(var t in e||(e={}))pd.call(e,t)&&as(i,t,e[t]);if(ss)for(var t of ss(e))gd.call(e,t)&&as(i,t,e[t]);return i},Ur=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class G{static initialize(){this.flushInterval=setInterval(()=>{this.flushQueues()},3e4),this.setupErrorHandlers(),console.log("Monitoring service initialized")}static logEvent(e,t,r,n="info",s){const o={category:e,action:t,level:n,message:r,metadata:s,timestamp:new Date().toISOString()};this.eventQueue.push(o),n==="error"&&this.flushQueues()}static trackMetric(e,t,r,n,s){const o={name:e,value:t,unit:r,category:n,timestamp:new Date().toISOString(),metadata:s};this.metricQueue.push(o),this.metricQueue.length>=this.MAX_BATCH_SIZE&&this.flushQueues()}static reportError(e,t,r){const n={error:e,context:t,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),metadata:r};this.errorQueue.push(n),console.error(`[ERROR] ${t}:`,e,r),this.flushQueues()}static trackUserAction(e,t,r){this.logEvent(t,e,`User performed ${e}`,"info",r)}static trackApiCall(e,t,r,n,s){this.trackMetric("api_call_duration",r,"ms","api",ur({endpoint:e,method:t,status:n},s)),r>1e3&&this.logEvent("api","slow_request",`Slow API call: ${t} ${e} took ${r}ms`,"warn",ur({endpoint:e,method:t,duration:r,status:n},s)),n>=400&&this.logEvent("api","failed_request",`Failed API call: ${t} ${e} returned ${n}`,"error",ur({endpoint:e,method:t,status:n},s))}static trackPageView(e,t){this.logEvent("navigation","page_view",`User viewed ${e}`,"info",ur({page:e},t))}static trackFeatureUsage(e,t,r){this.logEvent("feature",t,`Feature used: ${e}`,"info",ur({feature:e},r))}static flushQueues(){return Ur(this,null,function*(){try{if(!kr()){console.warn(" Supabase not configured, skipping monitoring queue flush");return}this.eventQueue.length>0&&(yield this.flushEvents()),this.metricQueue.length>0&&(yield this.flushMetrics()),this.errorQueue.length>0&&(yield this.flushErrors())}catch(e){console.error("Failed to flush monitoring queues:",e)}})}static flushEvents(){return Ur(this,null,function*(){const e=this.eventQueue.splice(0,this.MAX_BATCH_SIZE);console.log(" Monitoring: Would flush",e.length,"events (disabled for debugging)");const{data:{user:t}}=yield _.auth.getUser();let r=null;if(t){const{data:n}=yield _.from("users").select("facility_id").eq("id",t.id).single();r=(n==null?void 0:n.facility_id)||null}console.log(" Monitoring: User context:",{userId:t==null?void 0:t.id,facilityId:r,eventsQueued:this.eventQueue.length})})}static flushMetrics(){return Ur(this,null,function*(){const e=this.metricQueue.splice(0,this.MAX_BATCH_SIZE),{data:{user:t}}=yield _.auth.getUser();let r=null;if(t){const{data:s}=yield _.from("users").select("facility_id").eq("id",t.id).single();r=(s==null?void 0:s.facility_id)||null}const{error:n}=yield _.from("monitoring_performance_metrics").insert(e.map(s=>({metric_name:s.name,metric_value:s.value,facility_id:r||"default",created_at:s.timestamp})));n&&(console.error("Failed to flush performance metrics:",n),this.metricQueue.unshift(...e))})}static flushErrors(){return Ur(this,null,function*(){const e=this.errorQueue.splice(0,this.MAX_BATCH_SIZE),{data:{user:t}}=yield _.auth.getUser();let r=null;if(t){const{data:s}=yield _.from("users").select("facility_id").eq("id",t.id).single();r=(s==null?void 0:s.facility_id)||null}const{error:n}=yield _.from("error_reports").insert(e.map(s=>({error_message:s.error instanceof Error?s.error.message:s.error,error_stack:s.error instanceof Error?s.error.stack:void 0,context:s.context,user_agent:s.userAgent,metadata:s.metadata,user_id:(t==null?void 0:t.id)||null,facility_id:r,created_at:s.timestamp})));n&&(console.error("Failed to flush error reports:",n),this.errorQueue.unshift(...e))})}static setupErrorHandlers(){window.addEventListener("unhandledrejection",e=>{this.reportError(e.reason,"unhandled_promise_rejection",{promise:e.promise})}),window.addEventListener("error",e=>{this.reportError(e.error||new Error(e.message),"javascript_error",{filename:e.filename,lineno:e.lineno,colno:e.colno})})}static cleanup(){this.flushInterval&&(clearInterval(this.flushInterval),this.flushInterval=null),this.flushQueues()}}G.MAX_BATCH_SIZE=50;G.eventQueue=[];G.metricQueue=[];G.errorQueue=[];G.flushInterval=null;const V=G.logEvent.bind(G);G.trackMetric.bind(G);const Lt=G.reportError.bind(G),j=G.trackUserAction.bind(G);G.trackApiCall.bind(G);const md=G.trackPageView.bind(G),yd=G.trackFeatureUsage.bind(G);typeof window!="undefined"&&G.initialize();var vd=Object.defineProperty,os=Object.getOwnPropertySymbols,_d=Object.prototype.hasOwnProperty,wd=Object.prototype.propertyIsEnumerable,cs=(i,e,t)=>e in i?vd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,dr=(i,e)=>{for(var t in e||(e={}))_d.call(e,t)&&cs(i,t,e[t]);if(os)for(var t of os(e))wd.call(e,t)&&cs(i,t,e[t]);return i},ls=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class yr{static loadConfig(){return ls(this,null,function*(){try{console.log("Analytics config loading temporarily disabled");return}catch(e){console.error("Error loading analytics config:",e)}})}static getConfig(){return dr({},this.config)}static updateConfig(e){return ls(this,null,function*(){this.config=dr(dr({},this.config),e),console.log("Analytics config update temporarily disabled")})}static mergeConfig(e){e&&(this.config=dr(dr({},this.config),e))}}yr.config={providers:{supabase:{enabled:!0}},defaultProvider:"supabase"};var bd=Object.defineProperty,Cd=Object.defineProperties,Sd=Object.getOwnPropertyDescriptors,us=Object.getOwnPropertySymbols,Ad=Object.prototype.hasOwnProperty,Id=Object.prototype.propertyIsEnumerable,ds=(i,e,t)=>e in i?bd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,vn=(i,e)=>{for(var t in e||(e={}))Ad.call(e,t)&&ds(i,t,e[t]);if(us)for(var t of us(e))Id.call(e,t)&&ds(i,t,e[t]);return i},_n=(i,e)=>Cd(i,Sd(e)),xe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class hs{static initialize(e){return xe(this,null,function*(){try{yield this.initializeProviders(e),console.log("Analytics providers initialized successfully")}catch(t){console.error("Failed to initialize analytics providers:",t)}})}static trackEvent(e,t,r,n,s){return xe(this,null,function*(){var o,c,a;try{if(!s){console.warn("No analytics config provided for event tracking");return}(o=s.providers.googleAnalytics)!=null&&o.enabled&&(yield this.trackToGoogleAnalytics(e,t,r,n)),(c=s.providers.mixpanel)!=null&&c.enabled&&(yield this.trackToMixpanel(e,t,r,n)),(a=s.providers.amplitude)!=null&&a.enabled&&(yield this.trackToAmplitude(e,t,r,n))}catch(l){console.error("Failed to track event to providers:",l)}})}static initializeProviders(e){return xe(this,null,function*(){var t,r,n,s,o,c;(t=e.providers.googleAnalytics)!=null&&t.enabled&&((r=e.providers.googleAnalytics)!=null&&r.measurementId)&&(yield this.initializeGoogleAnalytics(e.providers.googleAnalytics.measurementId)),(n=e.providers.mixpanel)!=null&&n.enabled&&((s=e.providers.mixpanel)!=null&&s.token)&&(yield this.initializeMixpanel(e.providers.mixpanel.token)),(o=e.providers.amplitude)!=null&&o.enabled&&((c=e.providers.amplitude)!=null&&c.apiKey)&&(yield this.initializeAmplitude(e.providers.amplitude.apiKey))})}static initializeGoogleAnalytics(e){return xe(this,null,function*(){try{if(typeof window!="undefined"&&!window.gtag){const t=document.createElement("script");t.async=!0,t.src=`https://www.googletagmanager.com/gtag/js?id=${e}`,document.head.appendChild(t),window.dataLayer=window.dataLayer||[],window.gtag=function(...r){var n;(n=window.dataLayer)==null||n.push(r)},window.gtag("js",new Date().toISOString()),window.gtag("config",e)}}catch(t){console.error("Failed to initialize Google Analytics:",t)}})}static initializeMixpanel(e){return xe(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&window.mixpanel.init(e)}catch(t){console.error("Failed to initialize Mixpanel:",t)}})}static initializeAmplitude(e){return xe(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&window.amplitude.getInstance().init(e)}catch(t){console.error("Failed to initialize Amplitude:",t)}})}static trackToGoogleAnalytics(e,t,r,n){return xe(this,null,function*(){try{typeof window!="undefined"&&window.gtag&&window.gtag("event",e,_n(vn({},t),{user_id:r,facility_id:n}))}catch(s){console.error("Error tracking event to Google Analytics:",s)}})}static trackToMixpanel(e,t,r,n){return xe(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&window.mixpanel.track(e,_n(vn({},t),{user_id:r,facility_id:n}))}catch(s){console.error("Error tracking event to Mixpanel:",s)}})}static trackToAmplitude(e,t,r,n){return xe(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&window.amplitude.getInstance().logEvent(e,_n(vn({},t),{user_id:r,facility_id:n}))}catch(s){console.error("Error tracking event to Amplitude:",s)}})}}var Ed=Object.defineProperty,kd=Object.defineProperties,Ld=Object.getOwnPropertyDescriptors,fs=Object.getOwnPropertySymbols,Td=Object.prototype.hasOwnProperty,Pd=Object.prototype.propertyIsEnumerable,ps=(i,e,t)=>e in i?Ed(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ue=(i,e)=>{for(var t in e||(e={}))Td.call(e,t)&&ps(i,t,e[t]);if(fs)for(var t of fs(e))Pd.call(e,t)&&ps(i,t,e[t]);return i},at=(i,e)=>kd(i,Ld(e)),ae=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Od{static trackEvent(e,t,r,n){return ae(this,null,function*(){try{const s={name:e,properties:t,userId:r,facilityId:n,timestamp:new Date().toISOString()};yield Promise.all([this.trackToSupabase(),this.trackToGoogleAnalytics(s),this.trackToMixpanel(s),this.trackToAmplitude(s)]),V("analytics",e,`Analytics event: ${e}`,"info",at(ue({},t),{userId:r,facilityId:n}))}catch(s){Lt(s instanceof Error?s:new Error("Analytics tracking failed"),"analytics_track_event")}})}static identifyUser(e){return ae(this,null,function*(){try{yield Promise.all([this.identifyToSupabase(),this.identifyToGoogleAnalytics(),this.identifyToMixpanel(e),this.identifyToAmplitude(e)]),V("analytics","user_identified",`User identified: ${e.id}`,"info",{userId:e.id,facilityId:e.facilityId})}catch(t){Lt(t instanceof Error?t:new Error("User identification failed"),"analytics_identify_user")}})}static trackPageView(e,t,r){return ae(this,null,function*(){try{yield this.trackEvent("page_view",ue({page:e},t),r),md(e,at(ue({},t),{userId:r}))}catch(n){Lt(n instanceof Error?n:new Error("Page view tracking failed"),"analytics_track_page_view")}})}static trackUserAction(e,t,r,n){return ae(this,null,function*(){try{yield this.trackEvent("user_action",ue({action:e,category:t},r),n),j(e,t,at(ue({},r),{userId:n}))}catch(s){Lt(s instanceof Error?s:new Error("User action tracking failed"),"analytics_track_user_action")}})}static trackFeatureUsage(e,t,r,n){return ae(this,null,function*(){try{yield this.trackEvent("feature_usage",ue({feature:e,action:t},r),n),yd(e,t,at(ue({},r),{userId:n}))}catch(s){Lt(s instanceof Error?s:new Error("Feature usage tracking failed"),"analytics_track_feature_usage")}})}static trackConversion(e,t,r,n){return ae(this,null,function*(){try{yield this.trackEvent("conversion",ue({conversion_name:e,value:t},r),n)}catch(s){Lt(s instanceof Error?s:new Error("Conversion tracking failed"),"analytics_track_conversion")}})}static trackToSupabase(){return ae(this,null,function*(){console.log("Supabase analytics tracking temporarily disabled")})}static trackToGoogleAnalytics(e){return ae(this,null,function*(){try{typeof window!="undefined"&&window.gtag&&window.gtag("event",e.name,at(ue({},e.properties),{user_id:e.userId,facility_id:e.facilityId}))}catch(t){console.error("Error tracking event to Google Analytics:",t)}})}static trackToMixpanel(e){return ae(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&window.mixpanel.track(e.name,at(ue({},e.properties),{userId:e.userId,facilityId:e.facilityId}))}catch(t){console.error("Error tracking event to Mixpanel:",t)}})}static trackToAmplitude(e){return ae(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&window.amplitude.getInstance().logEvent(e.name,at(ue({},e.properties),{userId:e.userId,facilityId:e.facilityId}))}catch(t){console.error("Error tracking event to Amplitude:",t)}})}static identifyToSupabase(){return ae(this,null,function*(){console.log("Supabase user identification temporarily disabled")})}static identifyToGoogleAnalytics(){return ae(this,null,function*(){try{typeof window!="undefined"&&window.gtag&&console.log("Google Analytics user identification requires measurement ID from config")}catch(e){console.error("Error identifying user to Google Analytics:",e)}})}static identifyToMixpanel(e){return ae(this,null,function*(){try{typeof window!="undefined"&&window.mixpanel&&(window.mixpanel.identify(e.id),window.mixpanel.people.set(ue({$email:e.email,$name:e.full_name,facilityId:e.facilityId},e.properties)))}catch(t){console.error("Error identifying user to Mixpanel:",t)}})}static identifyToAmplitude(e){return ae(this,null,function*(){try{typeof window!="undefined"&&window.amplitude&&(window.amplitude.getInstance().setUserId(e.id),window.amplitude.getInstance().setUserProperties(ue({email:e.email,name:e.full_name,facilityId:e.facilityId},e.properties)))}catch(t){console.error("Error identifying user to Amplitude:",t)}})}}const Md=600*1e3,we={MAX_LIFECYCLE:95,MIN_LIFECYCLE:10,LIFECYCLE_MULTIPLIER:2.5,ANALYSIS_DAYS:90,MAX_CYCLES_PER_DAY:.1,MIN_CONFIDENCE:.6,MAX_CONFIDENCE:.95,CONFIDENCE_BASE:.75,REORDER_DAYS_BEFORE_EOL:30,MIN_REORDER_DAYS:7},te={ANALYSIS_DAYS:30,RECENT_ANALYSIS_DAYS:7,MAX_CAPACITY_PER_DAY:24,MIN_LOAD_PERCENTAGE:10,MAX_LOAD_PERCENTAGE:100,HIGH_USAGE_THRESHOLD:20,MEDIUM_USAGE_THRESHOLD:15,HIGH_OVERLOAD_DAYS:15,MEDIUM_OVERLOAD_DAYS:45,LOW_OVERLOAD_DAYS:90,HIGH_LOAD_THRESHOLD:90,MEDIUM_LOAD_THRESHOLD:75,LOW_LOAD_THRESHOLD:60,HIGH_QUEUE_THRESHOLD:5,HIGH_FAILURE_RATE:.1,PATIENT_LOAD_MULTIPLIER:1.2},gs={ANALYSIS_DAYS:365,PROJECTION_MONTHS:.5},Tt={ANALYSIS_DAYS:30,DEFAULT_FTE:8.5,WORKLOAD_INCREASE_THRESHOLD:20,FTE_INCREASE:.5,COST_PER_FTE:5e4},Pt={ANALYSIS_DAYS:30,GROWTH_RATE:1.1,INCIDENT_RATE:.3,HIGH_WORKLOAD_THRESHOLD:20,MEDIUM_WORKLOAD_THRESHOLD:10,HIGH_COVERAGE_THRESHOLD:15},Bt={IMMEDIATE:"Immediate",Q1_2025:"Q1 2025",Q2_2025:"Q2 2025",Q3_2025:"Q3 2025",NEXT_QUARTER:"Next quarter",MONITOR_3_MONTHS:"Monitor for 3 months"},Nr={ADD_AUTOCLAVE:"add_autoclave",EXTEND_HOURS:"extend_hours",OPTIMIZE_SCHEDULE:"optimize_schedule"},wn={LOW:"low",MEDIUM:"medium",HIGH:"high"};var xd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class qt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return qt.instance||(qt.instance=new qt),qt.instance}getToolReplacementForecast(){return xd(this,arguments,function*(e={}){try{const t=`tool_replacement_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for tool replacement forecast"),[];const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-we.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for tool replacement forecast"),[];const o=n.slice(0,5).map((c,a)=>{var l;const u=n.filter(C=>C.tool_batch_id===c.tool_batch_id).length,d=Math.min(we.MAX_LIFECYCLE,Math.max(we.MIN_LIFECYCLE,Math.floor(u*we.LIFECYCLE_MULTIPLIER))),h=u/we.ANALYSIS_DAYS,m=Math.max(0,100-d)/Math.max(we.MAX_CYCLES_PER_DAY,h),v=new Date(Date.now()+m*24*60*60*1e3).toISOString().split("T")[0],b=Math.min(we.MAX_CONFIDENCE,Math.max(we.MIN_CONFIDENCE,we.CONFIDENCE_BASE+u/100)),S=new Date(Date.now()+Math.max(we.MIN_REORDER_DAYS,m-we.REORDER_DAYS_BEFORE_EOL)*24*60*60*1e3).toISOString().split("T")[0];return{toolBatchId:(l=c.tool_batch_id)!=null?l:`TB${String(a+1).padStart(3,"0")}`,toolName:`Tool Set ${String.fromCharCode(65+a)}`,currentLifecycle:d,predictedEndOfLife:v,confidence:b,recommendedReorderDate:S,supplierSuggestion:"Contact procurement for supplier information",estimatedCost:0}});return this.setCachedData(t,o),o}catch(t){return console.error("Error forecasting tool replacement:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var Hd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Gt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Gt.instance||(Gt.instance=new Gt),Gt.instance}getAutoclaveCapacityForecast(){return Hd(this,arguments,function*(e={}){try{const t=`autoclave_capacity_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for autoclave capacity forecast"),[];const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).not("autoclave_id","is",null).gte("created_at",new Date(Date.now()-te.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No autoclave data found for capacity forecast"),[];const{data:o,error:c}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-te.RECENT_ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(c)return console.warn("Failed to fetch recent cycles for autoclave capacity forecast"),[];const a=n.reduce((u,d)=>{var h;const p=(h=d.autoclave_id)!=null?h:"";return p&&(u[p]||(u[p]=[]),u[p].push(d)),u},{}),l=Object.entries(a).map(([u,d])=>{const h=d.length,p=d.filter(M=>M.status==="completed").length,m=d.filter(M=>M.status==="failed").length,v=h/te.ANALYSIS_DAYS,b=te.MAX_CAPACITY_PER_DAY,S=Math.min(te.MAX_LOAD_PERCENTAGE,Math.max(te.MIN_LOAD_PERCENTAGE,Math.round(v/b*100))),w=((o==null?void 0:o.filter(M=>M.autoclave_id===u&&M.status==="pending"||M.status==="running"))||[]).length,y=v>te.HIGH_USAGE_THRESHOLD?"high":v>te.MEDIUM_USAGE_THRESHOLD?"medium":"low",A=y==="high"?te.HIGH_OVERLOAD_DAYS:y==="medium"?te.MEDIUM_OVERLOAD_DAYS:te.LOW_OVERLOAD_DAYS,I=new Date(Date.now()+A*24*60*60*1e3).toISOString().split("T")[0];let k,U;return S>te.HIGH_LOAD_THRESHOLD||m>h*te.HIGH_FAILURE_RATE?(k=Nr.ADD_AUTOCLAVE,U=Bt.IMMEDIATE):S>te.MEDIUM_LOAD_THRESHOLD||w>te.HIGH_QUEUE_THRESHOLD?(k=Nr.EXTEND_HOURS,U=Bt.Q1_2025):S>te.LOW_LOAD_THRESHOLD?(k=Nr.OPTIMIZE_SCHEDULE,U=Bt.Q2_2025):(k=Nr.OPTIMIZE_SCHEDULE,U=Bt.Q3_2025),{autoclaveId:u,currentLoadPercentage:S,queueLength:w,predictedOverloadDate:I,recommendedAction:k,timeline:U,projectedPatientLoad:Math.round(p*te.PATIENT_LOAD_MULTIPLIER)}});return this.setCachedData(t,l),l}catch(t){return console.error("Error forecasting autoclave capacity:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var Dd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Kt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Kt.instance||(Kt.instance=new Kt),Kt.instance}getInventoryInflationForecast(){return Dd(this,arguments,function*(e={}){try{const t=`inventory_inflation_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for inventory inflation forecast"),[];const n=yield ti.getItems();let s=n;e.facilityId&&(s=n.filter(l=>l.facility_id===e.facilityId));const o=new Date(Date.now()-gs.ANALYSIS_DAYS*24*60*60*1e3);if(s=s.filter(l=>l.created_at&&new Date(l.created_at)>=o),s.sort((l,u)=>new Date(u.created_at||"").getTime()-new Date(l.created_at||"").getTime()),!s||s.length===0)return console.warn("No inventory data found for inflation forecast"),[];const c=s.reduce((l,u)=>{var d,h;const p=(h=(d=u.data)==null?void 0:d.category)!=null?h:"Uncategorized";return l[p]||(l[p]=[]),l[p].push(u),l},{}),a=Object.entries(c).map(([l,u])=>{var d,h;const p=u.map(C=>{var w;return((w=C.data)==null?void 0:w.unit_cost)||0}).filter(C=>C>0);if(p.length===0)return null;const m=(d=p[p.length-1])!=null?d:0,v=(h=p[0])!=null?h:0,b=m-v,S=v>0?b/v*100:0;return{category:l,currentPrice:m,priceIncrease:b,inflationRate:S,projectedYearEndPrice:m*(1+S/100*gs.PROJECTION_MONTHS),cheaperSupplierExists:!1,alternativeSupplier:void 0,costSavings:0}}).filter(Boolean);return this.setCachedData(t,a),a}catch(t){return console.error("Error forecasting inventory inflation:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var Rd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Wt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Wt.instance||(Wt.instance=new Wt),Wt.instance}getClinicalStaffingForecast(){return Rd(this,arguments,function*(e={}){try{const t=`clinical_staffing_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for clinical staffing forecast"),[];const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-Tt.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for clinical staffing forecast"),[];const o=n.length,c=n.filter(h=>h.status!=="completed"&&h.status!=="failed").length,a=Tt.DEFAULT_FTE,l=Math.max(0,c/o*100),u=l>Tt.WORKLOAD_INCREASE_THRESHOLD?a+Tt.FTE_INCREASE:a,d=[{currentFTE:a,recommendedFTE:u,timeline:l>Tt.WORKLOAD_INCREASE_THRESHOLD?Bt.NEXT_QUARTER:Bt.MONITOR_3_MONTHS,workloadIncrease:l,skillsetGaps:[],trainingRecommendations:[],estimatedCost:Math.round((u-a)*Tt.COST_PER_FTE)}];return this.setCachedData(t,d),d}catch(t){return console.error("Error forecasting clinical staffing:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var Vd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Zt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Zt.instance||(Zt.instance=new Zt),Zt.instance}getAdminStaffingForecast(){return Vd(this,arguments,function*(e={}){try{const t=`admin_staffing_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for admin staffing forecast"),[];const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-Pt.ANALYSIS_DAYS*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for admin staffing forecast"),[];const o=n.length,c=n.filter(v=>v.status!=="completed"&&v.status!=="failed").length,a=o,l=Math.round(o*Pt.GROWTH_RATE),u=Math.max(0,l-a),d=Math.floor(c*Pt.INCIDENT_RATE),h=c>0?Math.max(1,Math.floor(c/2)):0;let p;u>Pt.HIGH_WORKLOAD_THRESHOLD?p=wn.HIGH:u>Pt.MEDIUM_WORKLOAD_THRESHOLD?p=wn.MEDIUM:p=wn.LOW;const m=[{currentWorkload:a,projectedWorkload:l,workloadExcess:u,recommendedCoverage:u>Pt.HIGH_COVERAGE_THRESHOLD?"Additional 0.5 FTE admin support":"Current staffing adequate",qualityIncidents:d,resolutionLag:h,priority:p}];return this.setCachedData(t,m),m}catch(t){return console.error("Error forecasting admin staffing:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var $d=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Qt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Qt.instance||(Qt.instance=new Qt),Qt.instance}getTheftLossEstimate(){return $d(this,arguments,function*(e={}){try{const t=`theft_loss_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for theft/loss estimation"),{estimatedLossPercentage:0,estimatedLossValue:0,flaggedItems:[],repeatOffenders:[],riskFactors:[],recommendedActions:[],confidence:0};const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for theft/loss estimation"),{estimatedLossPercentage:0,estimatedLossValue:0,flaggedItems:[],repeatOffenders:[],riskFactors:[],recommendedActions:[],confidence:0};const o=n.length,c=n.filter(h=>h.status!=="completed"&&h.status!=="failed").length,a=Math.min(10,Math.max(0,c/o*100)),l=Math.round(a*1e3),u=n.filter(h=>h.status!=="completed").map(h=>`Tool ${h.id}`).slice(0,3),d={estimatedLossPercentage:Math.round(a*10)/10,estimatedLossValue:l,flaggedItems:u.length>0?u:["No specific items flagged"],repeatOffenders:[],riskFactors:c>0?["Incomplete sterilization cycles","Missing cycle documentation","Protocol non-compliance"]:["Minimal risk factors detected"],recommendedActions:["Complete incomplete sterilization cycles","Review cycle documentation procedures","Monitor compliance metrics"],confidence:Math.max(.5,1-a/100)};return this.setCachedData(t,d),d}catch(t){return console.error("Error estimating theft/loss:",t),{estimatedLossPercentage:0,estimatedLossValue:0,flaggedItems:[],repeatOffenders:[],riskFactors:[],recommendedActions:[],confidence:0}}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var jd=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Yt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Yt.instance||(Yt.instance=new Yt),Yt.instance}getSupplyDepletionForecast(){return jd(this,arguments,function*(e={}){try{const t=`supply_depletion_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for supply depletion forecast"),[];const n=yield ti.getItems();let s=n;if(e.facilityId&&(s=n.filter(c=>c.facility_id===e.facilityId)),s.sort((c,a)=>(c.quantity||0)-(a.quantity||0)),!s||s.length===0)return console.warn("No inventory data found for supply depletion forecast"),[];const o=s.slice(0,8).map((c,a)=>{var l,u,d,h,p,m,v;const b=(l=c.quantity)!=null?l:0,S=(d=(u=c.data)==null?void 0:u.reorder_point)!=null?d:100,C=(p=(h=c.data)==null?void 0:h.unit_cost)!=null?p:50;let w;b<=S*.5?w="critical":b<=S*.8?w="high":b<=S*1.2?w="medium":w="low";const y=Math.ceil(b/(S/30)),A=new Date(Date.now()+y*24*60*60*1e3),I=new Date(A.getTime()-10080*60*1e3);return{itemName:(m=c.name)!=null?m:`Item ${a+1}`,currentStock:b,depletionDate:A.toISOString().split("T")[0],reorderUrgency:w,recommendedReorderDate:I.toISOString().split("T")[0],currentCost:C,historicalCosts:[C*.95,C*.98,C],costTrend:C>(((v=c.data)==null?void 0:v.last_restocked_cost)||C)?"increasing":"stable"}});return this.setCachedData(t,o),o}catch(t){return console.error("Error forecasting supply depletion:",t),[]}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var Ud=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Jt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Jt.instance||(Jt.instance=new Jt),Jt.instance}getEfficiencyROITracker(){return Ud(this,arguments,function*(e={}){try{const t=`efficiency_roi_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for efficiency ROI tracking"),null;const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for efficiency ROI tracking"),null;const o=n.length,c=n.filter(p=>p.status==="completed").length,a=o>0?c/o*100:0,l=Math.round(a/100*40),u=l*42,d=u*12,h={timeSavedHours:l,estimatedLaborSavings:u,aiFeatureUsage:[{feature:"Automated scheduling",usageCount:Math.floor(o*.8),timeSaved:Math.round(l*.3)},{feature:"Smart inventory alerts",usageCount:Math.floor(o*.6),timeSaved:Math.round(l*.2)},{feature:"Predictive maintenance",usageCount:Math.floor(o*.4),timeSaved:Math.round(l*.1)}],automationEfficiency:Math.round(a),moduleContributions:[{module:"Sterilization",timeSaved:Math.round(l*.5),costSavings:Math.round(u*.5),efficiency:Math.round(a)},{module:"Inventory",timeSaved:Math.round(l*.3),costSavings:Math.round(u*.3),efficiency:Math.round(a*.9)},{module:"Environmental",timeSaved:Math.round(l*.2),costSavings:Math.round(u*.2),efficiency:Math.round(a*.8)}],projectedAnnualSavings:d};return this.setCachedData(t,h),h}catch(t){return console.error("Error tracking efficiency ROI:",t),null}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}function Nd(i){const e=new Array(24).fill(0);i.forEach(n=>{if(n.created_at){const s=new Date(n.created_at).getHours();e[s]++}});const t=Math.max(...e),r=e.map((n,s)=>({count:n,hour:s})).filter(({count:n})=>n>=t*.8).map(({hour:n})=>`${n.toString().padStart(2,"0")}:00`).slice(0,4);return r.length>0?r:["09:00","12:00","15:00"]}function Fd(i){return i>=90?"Excellent utilization - maintain current practices":i>=80?"Good utilization - minor optimizations possible":i>=70?"Moderate utilization - consider schedule optimization":"Low utilization - review tool allocation and scheduling"}function zd(i){const e=[];return i<80&&e.push("Low utilization efficiency"),i<70&&e.push("Significant idle time detected"),e.length>0?e:["Minimal bottlenecks detected"]}var bn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Qe{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return Qe.instance||(Qe.instance=new Qe),Qe.instance}getToolTurnoverUtilization(){return bn(this,arguments,function*(e={}){try{const t=`tool_turnover_utilization_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for tool turnover utilization"),[];const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for tool turnover utilization"),[];const o=n.reduce((a,l)=>{var u;const d=(u=l.tool_batch_id)!=null?u:"";return d&&(a[d]||(a[d]=[]),a[d].push(l)),a},{}),c=Object.entries(o).map(([a,l])=>{const u=l.length,d=Math.min(100,u/7*100),h=u/7,p=Nd(l),m=Math.min(100,Math.max(50,d)),v=h,b=Math.max(0,100-m);return{toolBatchId:a,toolName:`Tool ${a}`,dailyCycleCount:u,weeklyUtilization:d,averageCyclesPerDay:h,peakUsageHours:p,utilizationEfficiency:m,turnoverRate:v,idleTimePercentage:b,recommendedOptimization:Fd(m),bottleneckIndicators:zd(m),performanceScore:Math.round(m)}});return this.setCachedData(t,c),c}catch(t){return console.error("Error analyzing tool turnover utilization:",t),[]}})}getSterilizationMetrics(){return bn(this,arguments,function*(e={}){try{if(!e.facilityId)return{biPassRate:0,cycleEfficiency:0,qualityScore:0};const{data:t}=yield _.from("bi_test_results").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()),{data:r}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString());let n=100;if(t&&t.length>0){const c=Array.isArray(t)?t.filter(a=>a.result==="pass").length:0;n=Math.round(c/t.length*100)}let s=100;if(r&&r.length>0){const c=r.filter(a=>a.status==="completed").length;s=Math.round(c/r.length*100)}const o=Math.round((n+s)/2);return{biPassRate:n,cycleEfficiency:s,qualityScore:o}}catch(t){return console.error("Error getting sterilization metrics:",t),{biPassRate:0,cycleEfficiency:0,qualityScore:0}}})}getInventoryMetrics(){return bn(this,arguments,function*(e={}){try{if(!e.facilityId)return{turnoverRate:0,stockLevel:0,reorderEfficiency:0};const t=yield ti.getItems();let r=t;e.facilityId&&(r=t.filter(c=>c.facility_id===e.facilityId));let n=80;if(r&&r.length>0){const c=r.filter(l=>{var u;return((u=l.status)!=null?u:"")==="active"}).length,a=r.length;a>0&&(n=Math.round(c/a*100))}let s=100;if(r&&r.length>0){const c=r.filter(a=>{var l;return a.quantity>((l=a.reorder_point)!=null?l:0)}).length;s=Math.round(c/r.length*100)}const o=Math.round((n+s)/2);return{turnoverRate:n,stockLevel:s,reorderEfficiency:o}}catch(t){return console.error("Error getting inventory metrics:",t),{turnoverRate:0,stockLevel:0,reorderEfficiency:0}}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var ms=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class pt{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=3e5}static getInstance(){return pt.instance||(pt.instance=new pt),pt.instance}getAuditRiskScore(){return ms(this,arguments,function*(e={}){try{const t=`audit_risk_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for audit risk score"),null;const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n)return console.warn("Failed to fetch sterilization data for audit risk assessment"),null;const o=n.length,c=n.filter(v=>v.status!=="completed"&&v.status!=="failed").length,{data:a,error:l}=yield _.from("biological_indicators").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString()),u=l||!a?0:Array.isArray(a)?a.filter(v=>v.status==="skipped"||v.status==="pending").length:0,d=Math.max(0,c/o*100),h=Math.min(100,Math.max(0,c/o*40+u*15+d*.4));let p;h>=80?p="critical":h>=60?p="high":h>=40?p="medium":p="low";const m={overallRiskScore:Math.round(h),riskLevel:p,riskFactors:[{factor:"Incomplete cycles",severity:Math.min(10,Math.max(1,Math.round(c/o*10))),description:`${c} sterilization cycles incomplete this week`},{factor:"Policy adherence",severity:Math.min(10,Math.max(1,Math.round((100-d)/10))),description:`Protocol adherence at ${Math.round(100-d)}%`}],skippedIndicators:u,incompleteCycles:c,policyDrift:d,recommendedActions:["Complete incomplete sterilization cycles","Review and reinforce protocol training","Monitor BI/CI test completion rates"]};return this.setCachedData(t,m),m}catch(t){return console.error("Error assessing audit risk:",t),null}})}getTrainingKnowledgeGaps(){return ms(this,arguments,function*(e={}){try{const t=`training_gaps_${JSON.stringify(e)}`,r=this.getCachedData(t);if(r)return r;if(!e.facilityId)return console.warn("No facility ID provided for training knowledge gaps"),null;const{data:n,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e.facilityId).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(s||!n||n.length===0)return console.warn("No sterilization data found for training gap analysis"),null;const o=n.reduce((p,m)=>{var v,b,S,C,w,y;const A=(b=(v=m.operator_id)!=null?v:m.user_id)!=null?b:"";return A&&(p[A]||(p[A]={cycles:[],failedSteps:[],performanceMetrics:[]}),p[A].cycles.push(m),m.status!=="completed"&&p[A].failedSteps.push(`Cycle ${m.id} - ${m.status}`),m.status==="completed"&&p[A].performanceMetrics.push({cycleId:(S=m.id)!=null?S:"",duration:(C=m.duration_minutes)!=null?C:0,temperature:(w=m.temperature_celsius)!=null?w:0,pressure:(y=m.pressure_psi)!=null?y:0})),p},{}),c=Object.entries(o).map(([p,m])=>{const v=m.failedSteps.length>0,b=m.performanceMetrics.length>0?m.performanceMetrics.reduce((C,w)=>C+w.duration,0)/m.performanceMetrics.length:0;let S=[];return v?S=["Review sterilization protocols","Complete cycle documentation training","Practice emergency shutdown procedures"]:b>60?S=["Optimize cycle timing procedures","Review load preparation best practices","Efficiency improvement training"]:S=["Maintain current training standards","Advanced sterilization techniques","Quality assurance best practices"],{userId:p,userName:`User ${p}`,failedSteps:m.failedSteps.slice(0,3),skippedContent:[],recommendedTraining:S,performanceMetrics:{totalCycles:m.cycles.length,successRate:m.cycles.length>0?(m.cycles.length-m.failedSteps.length)/m.cycles.length*100:100,averageDuration:Math.round(b)}}}),a=c.length,l=c.filter(p=>p.failedSteps.length>0).length,u=a>0?c.reduce((p,m)=>p+m.performanceMetrics.successRate,0)/a:100,d=Math.min(100,Math.max(0,l/a*40+(100-u)/100*30+(a<3?20:0)+(c.some(p=>p.performanceMetrics.averageDuration>60)?10:0))),h={usersWithGaps:c,overallGapScore:Math.round(d),criticalGaps:c.filter(p=>p.failedSteps.length>2||p.performanceMetrics.successRate<80).map(()=>"Sterilization protocol adherence"),knowledgeHubRecommendations:["Review sterilization SOPs","Complete cycle documentation training","Monitor user performance metrics","Efficiency optimization training","Quality assurance procedures"]};return this.setCachedData(t,h),h}catch(t){return console.error("Error analyzing training gaps:",t),null}})}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var fe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class vr{constructor(){this.cache=new Map,this.DEFAULT_CACHE_TTL=Md}static getInstance(){return vr.instance||(vr.instance=new vr),vr.instance}getToolReplacementForecast(){return fe(this,arguments,function*(e={}){return qt.getInstance().getToolReplacementForecast(e)})}getAutoclaveCapacityForecast(){return fe(this,arguments,function*(e={}){return Gt.getInstance().getAutoclaveCapacityForecast(e)})}getInventoryInflationForecast(){return fe(this,arguments,function*(e={}){return Kt.getInstance().getInventoryInflationForecast(e)})}getClinicalStaffingForecast(){return fe(this,arguments,function*(e={}){return Wt.getInstance().getClinicalStaffingForecast(e)})}getAdminStaffingForecast(){return fe(this,arguments,function*(e={}){return Zt.getInstance().getAdminStaffingForecast(e)})}getTheftLossEstimate(){return fe(this,arguments,function*(e={}){return Qt.getInstance().getTheftLossEstimate(e)})}getSupplyDepletionForecast(){return fe(this,arguments,function*(e={}){return Yt.getInstance().getSupplyDepletionForecast(e)})}getToolTurnoverUtilization(){return fe(this,arguments,function*(e={}){return Qe.getInstance().getToolTurnoverUtilization(e)})}getAuditRiskScore(){return fe(this,arguments,function*(e={}){return pt.getInstance().getAuditRiskScore(e)})}getTrainingKnowledgeGaps(){return fe(this,arguments,function*(e={}){return pt.getInstance().getTrainingKnowledgeGaps(e)})}getEfficiencyROITracker(){return fe(this,arguments,function*(e={}){return Jt.getInstance().getEfficiencyROITracker(e)})}getIntelligenceSummary(){return fe(this,arguments,function*(e={},t=!1){try{const r=`intelligence_summary_${JSON.stringify(e)}`;t&&this.clearCache("intelligence_summary");const n=this.getCachedData(r);if(n&&!t)return n;const[s,o,c,a,l,u,d,h,p,m,v,b,S]=yield Promise.all([this.getToolReplacementForecast(e),this.getAutoclaveCapacityForecast(e),this.getInventoryInflationForecast(e),this.getClinicalStaffingForecast(e),this.getAdminStaffingForecast(e),this.getTheftLossEstimate(e),this.getSupplyDepletionForecast(e),this.getToolTurnoverUtilization(e),this.getAuditRiskScore(e),this.getTrainingKnowledgeGaps(e),this.getEfficiencyROITracker(e),Qe.getInstance().getSterilizationMetrics(e),Qe.getInstance().getInventoryMetrics(e)]),C=a[0]||null,w=l[0]||null,y={toolReplacement:s,autoclaveCapacity:o,inventoryInflation:c,clinicalStaffing:C,adminStaffing:w,theftLoss:u,supplyDepletion:d,toolTurnoverUtilization:h,auditRisk:p||{overallRiskScore:0,riskLevel:"low",riskFactors:[],skippedIndicators:0,incompleteCycles:0,policyDrift:0,recommendedActions:[]},trainingGaps:m||{usersWithGaps:[],overallGapScore:0,criticalGaps:[],knowledgeHubRecommendations:[]},efficiencyROI:v||{timeSavedHours:0,estimatedLaborSavings:0,aiFeatureUsage:[],automationEfficiency:0,moduleContributions:[],projectedAnnualSavings:0},sterilization:b,inventory:S,lastUpdated:new Date().toISOString(),confidence:.89};return this.setCachedData(r,y),y}catch(r){throw console.error("Error generating intelligence summary:",r),r}})}clearCache(e){e?Array.from(this.cache.keys()).filter(r=>r.startsWith(e)).forEach(r=>this.cache.delete(r)):this.cache.clear()}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(this.cache.delete(e),null)}setCachedData(e,t,r=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}}var Bd=Object.defineProperty,qd=Object.defineProperties,Gd=Object.getOwnPropertyDescriptors,ys=Object.getOwnPropertySymbols,Kd=Object.prototype.hasOwnProperty,Wd=Object.prototype.propertyIsEnumerable,vs=(i,e,t)=>e in i?Bd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Cn=(i,e)=>{for(var t in e||(e={}))Kd.call(e,t)&&vs(i,t,e[t]);if(ys)for(var t of ys(e))Wd.call(e,t)&&vs(i,t,e[t]);return i},Sn=(i,e)=>qd(i,Gd(e)),Fe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Na{getLearningInsights(){return Fe(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return null;const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),{data:r,error:n}=yield _.from("ai_learning_insights").select("*").eq("user_id",e.id).eq("facility_id",t==null?void 0:t.facility_id).single();if(n&&n.code!=="PGRST116")throw n;return r}catch(e){return console.error("Error fetching AI learning insights:",e),null}})}getContentRecommendations(e=5){return Fe(this,null,function*(){try{const{data:{user:t}}=yield _.auth.getUser();if(!t)return[];const{data:r,error:n}=yield _.from("ai_content_recommendations").select("*").eq("user_id",t.id).gte("recommendation_score",70).order("recommendation_score",{ascending:!1}).limit(e);if(n){if(n.code==="42P01")return console.warn("ai_content_recommendations table does not exist, returning empty recommendations"),[];throw n}return r.map(s=>{var o;return{id:s.id,user_id:s.user_id,content_id:s.content_id,recommendation_score:s.recommendation_score,recommendation_type:s.recommendation_type,reasoning:s.reasoning,created_at:s.created_at,updated_at:s.updated_at,is_displayed:s.is_displayed,is_clicked:s.is_clicked,is_completed:s.is_completed,display_count:s.display_count,click_count:s.click_count,completion_count:s.completion_count,user_feedback:s.user_feedback,ai_model_version:s.ai_model_version,learning_context:s.learning_context,content_metadata:s.content_metadata,tags:(o=s.data)==null?void 0:o.tags,recommendation_reason:s.recommendation_reason||s.reasoning,confidence_level:s.confidence_level||.8,user_context:s.user_context||{},content_context:s.content_context||{},click_through_rate:s.click_through_rate||0,completion_rate:s.completion_rate||0,user_feedback_rating:s.user_feedback_rating||0,ai_confidence_score:s.ai_confidence_score||.8,recommendation_algorithm:s.recommendation_algorithm||"default",last_ai_analysis:s.last_ai_analysis||new Date().toISOString(),model_version:s.model_version||"1.0.0",feature_vector:s.feature_vector||[],algorithm_used:s.algorithm_used||"default",expires_at:s.expires_at||null,recommendation_timing:s.recommendation_timing||"immediate"}})||[]}catch(t){return console.error("Error fetching AI content recommendations:",t),[]}})}trackRecommendationInteraction(e,t){return Fe(this,null,function*(){try{const{data:{user:r}}=yield _.auth.getUser();if(!r)return!1;const n={};switch(t){case"displayed":n.is_displayed=!0,n.display_count=(n.display_count||0)+1;break;case"clicked":n.is_clicked=!0;break;case"completed":n.is_completed=!0;break}const{error:s}=yield _.from("ai_content_recommendations").update(n).eq("id",e).eq("user_id",r.id);if(s){if(s.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping interaction tracking"),!1;throw s}return!0}catch(r){return console.error("Error tracking recommendation interaction:",r),!1}})}storeLearningInsights(e){return Fe(this,null,function*(){try{const{data:{user:t}}=yield _.auth.getUser();if(!t)return!1;const{error:r}=yield _.from("ai_learning_insights").upsert(Sn(Cn({user_id:t.id},e),{last_ai_analysis:new Date().toISOString(),updated_at:new Date().toISOString()}));if(r)throw r;return!0}catch(t){return console.error("Error storing AI learning insights:",t),!1}})}storeContentRecommendation(e,t){return Fe(this,null,function*(){try{const{data:{user:r}}=yield _.auth.getUser();if(!r)return!1;const{error:n}=yield _.from("ai_content_recommendations").insert(Sn(Cn({user_id:r.id,content_id:e},t),{created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));if(n){if(n.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping recommendation storage"),!1;throw n}return!0}catch(r){return console.error("Error storing AI content recommendation:",r),!1}})}getLearningAnalytics(){return Fe(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return[];const{data:t,error:r}=yield _.from("ai_learning_analytics").select("*").eq("user_id",e.id).order("session_start",{ascending:!1}).limit(10);if(r)throw r;return t.map(n=>({id:n.id,user_id:n.user_id,content_id:n.content_id,progress_status:n.progress_status}))||[]}catch(e){return console.error("Error fetching learning analytics:",e),[]}})}storeSessionAnalytics(e){return Fe(this,null,function*(){try{const{data:{user:t}}=yield _.auth.getUser();if(!t)return!1;const{error:r}=yield _.from("ai_learning_analytics").insert(Sn(Cn({user_id:t.id},e),{created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));if(r)throw r;return!0}catch(t){return console.error("Error storing learning session analytics:",t),!1}})}generateLearningInsights(){return Fe(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return null;const{data:t}=yield _.from("knowledge_hub_user_progress").select("*").eq("user_id",e.id);if(!t||t.length===0)return null;const r=this.analyzeLearningPatterns(t.map(n=>({id:n.id,user_id:n.user_id,content_id:n.content_id,progress_status:n.progress_status})));return yield this.storeLearningInsights(r),r}catch(e){return console.error("Error generating learning insights:",e),null}})}analyzeLearningPatterns(e){const t=e.filter(u=>u.progress_status==="completed"),r=e.length,n=t.length,s=r>0?n/r*100:0,o=e.reduce((u,d)=>{const h=d.content_type||"Unknown";return u[h]=(u[h]||0)+1,u},{}),c=Object.entries(o).sort(([,u],[,d])=>d-u).slice(0,3).map(([u])=>u),a=t.filter(u=>u.time_spent_minutes),l=a.length>0?Math.round(a.reduce((u,d)=>u+(d.time_spent_minutes||0),0)/a.length):30;return{learning_efficiency_score:Math.round(s),preferred_content_categories:c,optimal_study_duration:l,next_learning_milestone:this.predictNextMilestone(e),skill_gaps:this.identifySkillGaps(e),ai_confidence_score:.8,model_version:"v1.0"}}predictNextMilestone(e){const t=e.filter(r=>r.progress_status==="completed");return t.length===0?"Complete your first course":t.length<3?"Complete 3 courses to build foundation":t.length<10?"Complete 10 courses for intermediate level":"Achieve advanced certification"}identifySkillGaps(e){const t=[],r=new Set(e.filter(n=>n.progress_status==="completed").map(n=>n.content_type));return r.has("procedure")||t.push("Clinical Procedures"),r.has("policy")||t.push("Healthcare Policies"),r.has("learning_pathway")||t.push("Structured Learning Paths"),t}}function Zd(i){return i.sort((e,t)=>{const r={critical:4,high:3,medium:2,low:1},n=r[t.priority]-r[e.priority];return n!==0?n:t.confidence-e.confidence})}function Qd(i){return i.sort((e,t)=>t.priority-e.priority)}function Yd(i){return i.sort((e,t)=>{const r={critical:3,high:2,medium:1,low:0};return r[t.severity]-r[e.severity]})}function Jd(i){return{cost_optimization:"cost_savings",risk_mitigation:"risk_mitigation",efficiency_improvement:"efficiency",training_needed:"training",capacity_planning:"capacity",compliance_issue:"compliance"}[i]||"efficiency"}function Xd(i,e){const t=(i+e)/2;return t>.9?"critical":t>.8?"high":t>.7?"medium":"low"}function eh(i){var e;return i.recommendation_reason||`AI analysis suggests ${((e=i.content_context)==null?void 0:e.category)||"optimization"} opportunities based on your usage patterns.`}function th(i){const e=Number(i.recommendation_score)||.5;return{costSavings:e*1e3,timeSavings:e*2,riskReduction:e*50,efficiencyGain:e*30}}function rh(i){return i.recommendation_type&&console.debug("AI recommendation type available for action items"),["Review AI-generated insights","Implement suggested optimizations","Monitor performance improvements","Provide feedback for learning"]}function nh(i){const e=i.recommendation_score||.5;return e>.9?"Immediate":e>.8?"1-2 weeks":e>.7?"2-4 weeks":"1-2 months"}function ih(i){return i.feature_vector&&console.debug("Feature vector available for metrics extraction"),["ai_confidence","user_behavior","performance_patterns"]}function sh(i){return i>.9?"critical":i>.8?"high":i>.7?"medium":"low"}var An=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ut{static generateHybridRecommendations(e,t,r){return An(this,null,function*(){var n,s;const o=[];return r&&console.debug("User insights available for recommendations"),t.forEach(c=>{var a;c.recommendation_score>.7&&o.push({id:`ai_${c.id}`,type:Jd(c.recommendation_type),priority:Xd(c.recommendation_score,c.confidence_level),title:c.recommendation_reason||"AI-Generated Recommendation",description:eh(c),impact:th(c),actionItems:rh(c),timeline:nh(c),confidence:c.confidence_level||.8,category:((a=c.content_context)==null?void 0:a.category)||"general",relatedMetrics:ih(c)})}),((n=e.auditRisk)==null?void 0:n.riskLevel)==="critical"&&o.push(this.createCriticalAuditRecommendation(e)),(s=e.supplyDepletion)!=null&&s.some(c=>c.reorderUrgency==="critical")&&o.push(this.createCriticalSupplyRecommendation(e)),o})}static generateAIOptimizationTips(e,t,r){return An(this,null,function*(){const n=[];return t&&(t.skill_gaps||[]).forEach((o,c)=>{n.push({id:`ai_skill_gap_${c}`,category:"compliance",title:`Address Skill Gap: ${o}`,description:`AI analysis indicates a skill gap in ${o} that may impact performance.`,currentState:`Current skill level: ${t.learning_efficiency_score||70}%`,recommendedAction:"Complete targeted training modules and practice exercises",expectedOutcome:`Improve ${o} proficiency by 25%`,difficulty:"medium",estimatedEffort:"2-3 weeks",priority:8})}),r!=null&&r.efficiency_score&&r.efficiency_score<80&&n.push({id:"ai_efficiency_optimization",category:"sterilization",title:"Optimize Workflow Efficiency",description:"AI analysis shows workflow efficiency below optimal levels.",currentState:`Current efficiency: ${(r==null?void 0:r.efficiency_score)||70}%`,recommendedAction:"Review and optimize high-frequency workflows",expectedOutcome:"Increase efficiency by 15-20%",difficulty:"medium",estimatedEffort:"3-4 weeks",priority:7}),n})}static generateIntelligentRiskAlerts(e,t,r){return An(this,null,function*(){var n;const s=[];return r&&console.debug("Risk patterns available for analysis"),t.forEach(o=>{o.risk_score>.8&&s.push({id:`ai_risk_${o.id}`,severity:sh(o.risk_score),title:o.risk_title||"AI-Detected Risk",description:o.risk_description||"AI analysis has identified a potential risk.",riskFactors:o.risk_factors||[],immediateActions:o.immediate_actions||[],longTermSolutions:o.long_term_solutions||[],escalationPath:o.escalation_path||"Notify supervisor",deadline:o.deadline||"48 hours",status:"open"})}),((n=e.auditRisk)==null?void 0:n.riskLevel)==="critical"&&s.push(this.createCriticalAuditAlert(e)),s})}static generateFallbackRecommendations(e){var t;const r=[];return((t=e.auditRisk)==null?void 0:t.riskLevel)==="critical"&&r.push({id:"fallback_audit_risk",type:"compliance",priority:"critical",title:"Critical Audit Risk Mitigation Required",description:`Overall audit risk score: ${e.auditRisk.overallRiskScore}/100.`,impact:{riskReduction:60,costSavings:5e3},actionItems:["Complete missing BI logs immediately","Review incomplete cycles"],timeline:"1 week",confidence:.88,category:"compliance",relatedMetrics:["audit_scores","compliance_rates"]}),r}static generateFallbackOptimizationTips(e){var t;const r=[];return((t=e.sterilization)==null?void 0:t.biPassRate)<95&&r.push({id:"fallback_sterilization_optimization",category:"sterilization",title:"Improve BI Test Pass Rates",description:"BI test pass rates below optimal levels indicate potential issues.",currentState:`Current BI pass rate: ${e.sterilization.biPassRate}%`,recommendedAction:"Review sterilization parameters and implement quality checks",expectedOutcome:"Increase BI pass rate to 95%+",difficulty:"medium",estimatedEffort:"2-3 weeks",priority:8}),r}static generateFallbackRiskAlerts(e){var t;const r=[];return((t=e.auditRisk)==null?void 0:t.riskLevel)==="critical"&&r.push({id:"fallback_high_audit_risk",severity:"critical",title:"High Audit Risk Alert",description:`Audit risk score: ${e.auditRisk.overallRiskScore}/100.`,riskFactors:["Skipped BI indicators","Incomplete cycles"],immediateActions:["Complete missing documentation","Review procedures"],longTermSolutions:["Implement monitoring","Enhance training"],escalationPath:"Notify quality assurance team",deadline:"48 hours",status:"open"}),r}static createCriticalAuditRecommendation(e){var t,r,n;return{id:"critical_audit_risk_mitigation",type:"compliance",priority:"critical",title:"Critical Audit Risk Mitigation Required",description:`Overall audit risk score: ${(t=e.auditRisk)==null?void 0:t.overallRiskScore}/100. ${(r=e.auditRisk)==null?void 0:r.skippedIndicators} skipped indicators and ${(n=e.auditRisk)==null?void 0:n.incompleteCycles} incomplete cycles detected.`,impact:{riskReduction:60,costSavings:5e3},actionItems:["Complete missing BI logs immediately","Review incomplete cycle procedures","Reinforce protocol training","Implement daily compliance checks"],timeline:"1 week",confidence:.88,category:"compliance",relatedMetrics:["audit_scores","compliance_rates","protocol_adherence"]}}static createCriticalSupplyRecommendation(e){var t;const r=((t=e.supplyDepletion)==null?void 0:t.filter(n=>n.reorderUrgency==="critical"))||[];return{id:"critical_supply_alert",type:"risk_mitigation",priority:"critical",title:`Critical Supply Alert: ${r.length} Items`,description:`${r.length} critical supplies will deplete within 7 days, risking operational disruption.`,impact:{costSavings:r.reduce((n,s)=>n+Number(s.currentCost||0)*.2,0),riskReduction:95},actionItems:["Place emergency orders immediately","Contact alternative suppliers","Implement usage restrictions","Notify clinical staff"],timeline:"Immediate",confidence:.95,category:"inventory_management",relatedMetrics:["stock_levels","usage_rates","supplier_performance"]}}static createCriticalAuditAlert(e){var t;return{id:"critical_audit_risk_alert",severity:"critical",title:"Critical Audit Risk Alert",description:`Audit risk score: ${(t=e.auditRisk)==null?void 0:t.overallRiskScore}/100. Multiple compliance issues detected requiring immediate attention.`,riskFactors:["Skipped BI indicators","Incomplete sterilization cycles","Policy drift detected"],immediateActions:["Complete missing documentation immediately","Review and complete incomplete cycles","Reinforce protocol adherence","Schedule compliance review meeting"],longTermSolutions:["Implement automated compliance monitoring","Enhance staff training programs","Establish quality assurance processes","Create compliance dashboard"],escalationPath:"Notify quality assurance team and department director",deadline:"24 hours",status:"open"}}}ut.aiLearningService=new Na;var Fa=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function ah(){return Fa(this,null,function*(){try{return[]}catch(i){return console.error("Error getting AI risk predictions:",i),[]}})}function oh(){return Fa(this,null,function*(){try{return null}catch(i){return console.error("Error getting historical risk patterns:",i),null}})}function _s(){return{efficiency_score:85,time_saved:120,points:150,difficulty:"medium",category:"general"}}var Pr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function ch(){return Pr(this,null,function*(){try{const{data:i,error:e}=yield _.from("ai_content_recommendations").select("*").eq("is_displayed",!0).order("recommendation_score",{ascending:!1}).limit(20);return e?(console.error("Error fetching AI recommendations:",e),[]):i||[]}catch(i){return console.error("Error getting AI recommendations:",i),[]}})}function lh(){return Pr(this,null,function*(){try{const{data:{user:i}}=yield _.auth.getUser();if(!i)return null;const{data:e,error:t}=yield _.from("ai_learning_insights").select("*").eq("user_id",i.id).single();return t&&t.code!=="PGRST116"?(console.error("Error fetching user insights:",t),null):e}catch(i){return console.error("Error getting user behavior insights:",i),null}})}function uh(){return Pr(this,null,function*(){try{const{data:{user:i}}=yield _.auth.getUser();if(!i)return null;const{data:e,error:t}=yield _.from("ai_task_performance").select("*").eq("user_id",i.id).order("completed_at",{ascending:!1}).limit(10);return t&&t.code!=="PGRST116"?(console.error("Error fetching performance patterns:",t),_s()):(e==null?void 0:e[0])||_s()}catch(i){return console.error("Error getting user performance patterns:",i),null}})}function dh(){return Pr(this,null,function*(){try{const{data:{user:i}}=yield _.auth.getUser();if(!i)return .5;const{data:e,error:t}=yield _.from("ai_learning_insights").select("ai_confidence_score").eq("user_id",i.id).single();return t&&t.code!=="PGRST116"?(console.error("Error fetching AI confidence score:",t),.5):Number(e==null?void 0:e.ai_confidence_score)||.5}catch(i){return console.error("Error getting AI confidence score:",i),.5}})}function hh(){return Pr(this,null,function*(){try{const{data:{user:i}}=yield _.auth.getUser();if(!i)return null;const{data:e,error:t}=yield _.from("knowledge_hub_user_progress").select("*").eq("user_id",i.id);return t&&t.code!=="PGRST116"?(console.error("Error fetching learning progress:",t),null):{totalCompleted:((e==null?void 0:e.filter(r=>r.status==="completed"))||[]).length,totalInProgress:((e==null?void 0:e.filter(r=>r.status==="in_progress"))||[]).length,averageScore:(e||[]).reduce((r,n)=>r+(Number(n.score)||0),0)/((e==null?void 0:e.length)||1)||0}}catch(i){return console.error("Error getting learning progress metrics:",i),null}})}var Fr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class fh{static generateRecommendations(e){return Fr(this,null,function*(){try{const t=yield ch(),r=yield lh(),n=yield ut.generateHybridRecommendations(e,t,r);return Zd(n)}catch(t){return console.error("Error generating AI recommendations:",t),ut.generateFallbackRecommendations(e)}})}static generateOptimizationTips(e){return Fr(this,null,function*(){try{const t=yield this.aiLearningService.getLearningInsights(),r=yield uh(),n=yield ut.generateAIOptimizationTips(e,t,r);return Qd(n)}catch(t){return console.error("Error generating AI optimization tips:",t),ut.generateFallbackOptimizationTips(e)}})}static generateRiskAlerts(e){return Fr(this,null,function*(){try{const t=yield ah(),r=yield oh(),n=yield ut.generateIntelligentRiskAlerts(e,t,r);return Yd(n)}catch(t){return console.error("Error generating AI risk alerts:",t),ut.generateFallbackRiskAlerts(e)}})}static getActionableInsights(e){return Fr(this,null,function*(){const t=yield this.generateRecommendations(e),r=yield this.generateOptimizationTips(e),n=yield this.generateRiskAlerts(e),s=yield dh();return{totalRecommendations:t.length,criticalItems:t.filter(o=>o.priority==="critical").length,highPriorityItems:t.filter(o=>o.priority==="high").length,totalTips:r.length,totalAlerts:n.length,criticalAlerts:n.filter(o=>o.severity==="critical").length,estimatedSavings:t.reduce((o,c)=>o+(c.impact.costSavings||0),0),estimatedTimeSavings:t.reduce((o,c)=>o+(c.impact.timeSavings||0),0),aiConfidence:s,learningProgress:yield hh()}})}}fh.aiLearningService=new Na;var ph=Object.defineProperty,gh=Object.defineProperties,mh=Object.getOwnPropertyDescriptors,ws=Object.getOwnPropertySymbols,yh=Object.prototype.hasOwnProperty,vh=Object.prototype.propertyIsEnumerable,bs=(i,e,t)=>e in i?ph(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Cs=(i,e)=>{for(var t in e||(e={}))yh.call(e,t)&&bs(i,t,e[t]);if(ws)for(var t of ws(e))vh.call(e,t)&&bs(i,t,e[t]);return i},Ss=(i,e)=>gh(i,mh(e)),z=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class q{getKnowledgeArticles(){return z(this,null,function*(){const{data:e,error:t}=yield _.from("knowledge_articles").select("*").eq("status","published").order("published_at",{ascending:!1});if(t)throw console.error("Error fetching knowledge articles:",t),new Error(`Failed to fetch knowledge articles: ${t.message}`);return(e||[]).map(n=>({id:n.id,title:n.title,content:n.content,category:n.category_id,status:n.status,created_at:n.created_at,updated_at:n.updated_at,published_at:n.published_at,summary:n.summary,tags:n.tags}))})}updateArticleStatus(e,t){return z(this,null,function*(){const{error:r}=yield _.from("knowledge_articles").update({status:t,updated_at:new Date().toISOString()}).eq("id",e);return{error:r==null?void 0:r.message}})}bulkUpdateArticlesStatus(e,t){return z(this,null,function*(){if(!e||e.length===0)return{success:!1,updatedCount:0,processedCount:0,errors:["No articles provided"]};const{error:r,count:n}=yield _.from("knowledge_articles").update({status:t,updated_at:new Date().toISOString()}).in("id",e).select("id");return r?{success:!1,updatedCount:0,processedCount:e.length,errors:[r.message]}:{success:!0,updatedCount:n||0,processedCount:e.length,errors:[]}})}deleteArticles(e){return z(this,null,function*(){if(!e||e.length===0)return{success:!1,deletedCount:0,processedCount:0,errors:["No articles provided"]};const{error:t,count:r}=yield _.from("knowledge_articles").update({status:"archived",updated_at:new Date().toISOString()}).in("id",e).select("id");return t?{success:!1,deletedCount:0,processedCount:e.length,errors:[t.message]}:{success:!0,deletedCount:r||0,processedCount:e.length,errors:[]}})}getLearningPathways(){return z(this,null,function*(){const{data:e,error:t}=yield _.from("knowledge_learning_paths").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching learning pathways:",t),new Error(`Failed to fetch learning pathways: ${t.message}`);return(e||[]).map(n=>({id:n.id,title:n.title,description:n.description,steps:[],status:n.is_active?"active":"inactive",created_at:n.created_at,updated_at:n.updated_at,difficulty_level:n.difficulty,estimated_time:parseInt(n.estimated_time)||0}))})}updateLearningPathStatus(e,t){return z(this,null,function*(){const{error:r}=yield _.from("knowledge_learning_paths").update({is_active:t,updated_at:new Date().toISOString()}).eq("id",e);return{error:r==null?void 0:r.message}})}bulkUpdateLearningPathsStatus(e,t){return z(this,null,function*(){if(!e||e.length===0)return{success:!1,updatedCount:0,processedCount:0,errors:["No pathways provided"]};const{error:r,count:n}=yield _.from("knowledge_learning_paths").update({is_active:t,updated_at:new Date().toISOString()}).in("id",e).select("id");return r?{success:!1,updatedCount:0,processedCount:e.length,errors:[r.message]}:{success:!0,updatedCount:n||0,processedCount:e.length,errors:[]}})}deleteLearningPaths(e){return z(this,null,function*(){if(!e||e.length===0)return{success:!1,deletedCount:0,processedCount:0,errors:["No pathways provided"]};const{error:t,count:r}=yield _.from("knowledge_learning_paths").update({is_active:!1,updated_at:new Date().toISOString()}).in("id",e).select("id");return t?{success:!1,deletedCount:0,processedCount:e.length,errors:[t.message]}:{success:!0,deletedCount:r||0,processedCount:e.length,errors:[]}})}getArticleById(e){return z(this,null,function*(){const{data:t,error:r}=yield _.from("knowledge_articles").select("*").eq("id",e).single();if(r)return{error:r.message};if(!t)return{error:"Article not found"};const n=t;return{data:{id:n.id,title:n.title,content:n.content,category:n.category_id,status:n.status,created_at:n.created_at,updated_at:n.updated_at,published_at:n.published_at,summary:n.summary,tags:n.tags}}})}getLearningPathById(e){return z(this,null,function*(){const{data:t,error:r}=yield _.from("knowledge_learning_paths").select("*").eq("id",e).single();if(r)return{error:r.message};if(!t)return{error:"Learning path not found"};const n=t;return{data:{id:n.id,title:n.title,description:n.description,steps:[],status:n.is_active?"active":"inactive",created_at:n.created_at,updated_at:n.updated_at,difficulty_level:n.difficulty,estimated_time:parseInt(n.estimated_time)||0}}})}getKnowledgeCategories(){return z(this,null,function*(){const{data:e,error:t}=yield _.from("knowledge_categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw console.error("Error fetching knowledge categories:",t),new Error(`Failed to fetch knowledge categories: ${t.message}`);return e||[]})}createArticle(e){return z(this,null,function*(){try{const{data:t,error:r}=yield _.from("knowledge_articles").insert([{title:e.title,content:e.content,summary:e.summary,category_id:e.category,tags:e.tags,status:e.status,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return r?{error:r.message}:{article:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to create article"}}})}updateArticle(e,t){return z(this,null,function*(){try{const{data:r,error:n}=yield _.from("knowledge_articles").update(Ss(Cs({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();return n?{error:n.message}:{article:r}}catch(r){return{error:r instanceof Error?r.message:"Failed to update article"}}})}deleteArticle(e){return z(this,null,function*(){try{const{error:t}=yield _.from("knowledge_articles").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete article"}}})}createLearningPath(e){return z(this,null,function*(){try{const{data:t,error:r}=yield _.from("knowledge_learning_paths").insert([{title:e.title,description:e.description,category:e.category,difficulty:e.difficulty,estimated_time:e.estimated_time,is_active:e.is_active,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return r?{error:r.message}:{pathway:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to create learning path"}}})}updateLearningPath(e,t){return z(this,null,function*(){try{const{data:r,error:n}=yield _.from("knowledge_learning_paths").update(Ss(Cs({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();return n?{error:n.message}:{pathway:r}}catch(r){return{error:r instanceof Error?r.message:"Failed to update learning path"}}})}deleteLearningPath(e){return z(this,null,function*(){try{const{error:t}=yield _.from("knowledge_learning_paths").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete learning path"}}})}addCategory(e){return z(this,null,function*(){try{const{data:t,error:r}=yield _.from("knowledge_categories").insert([{name:e,is_active:!0,sort_order:999,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return r?{error:r.message}:{category:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to add category"}}})}deleteCategory(e){return z(this,null,function*(){try{const{error:t}=yield _.from("knowledge_categories").update({is_active:!1,updated_at:new Date().toISOString()}).eq("name",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete category"}}})}getRecentUserActivity(e,t){return z(this,null,function*(){try{let r=_.from("activity_feed").select("*").order("created_at",{ascending:!1});e&&(r=r.eq("user_id",e)),t?r=r.limit(t):r=r.limit(50);const{data:n,error:s}=yield r;return s?(console.error("Error fetching recent user activity:",s),[]):n||[]}catch(r){return console.error("Failed to get recent user activity:",r),[]}})}}const zr=i=>["Courses","Procedures","Policies","Learning Pathways","Advanced"].includes(i)?i:"Courses";var Ot=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class dt{static getKnowledgeArticles(){return Ot(this,null,function*(){try{return(yield new q().getKnowledgeArticles()).map(r=>({id:r.id,title:r.title,category:zr(r.category||"Courses"),status:"draft",dueDate:r.published_at||new Date().toISOString(),progress:0,lastUpdated:r.updated_at,description:r.summary,tags:r.tags,createdAt:r.created_at}))}catch(e){throw console.error("Failed to get knowledge articles:",e),e}})}static getKnowledgeArticleById(e){return Ot(this,null,function*(){try{const r=yield new q().getArticleById(e);if(r.error||!r.data)return null;const n=r.data;return{id:n.id,title:n.title,category:zr(n.category||"Courses"),status:"draft",dueDate:n.published_at||new Date().toISOString(),progress:0,lastUpdated:n.updated_at,description:n.summary,tags:n.tags,createdAt:n.created_at}}catch(t){throw console.error("Failed to get knowledge article by ID:",t),t}})}static createKnowledgeArticle(e){return Ot(this,null,function*(){try{const r=yield new q().createArticle({title:e.title,content:e.description||"",summary:e.description||"",category:e.category,tags:e.tags||[],status:"draft"});if(r.error)throw new Error(r.error);if(!r.article)throw new Error("Failed to create article");return{id:r.article.id,title:r.article.title,category:zr(r.article.category||"Courses"),status:r.article.status,dueDate:r.article.published_at||new Date().toISOString(),progress:0,lastUpdated:r.article.updated_at,description:r.article.summary,tags:r.article.tags,createdAt:r.article.created_at}}catch(t){throw console.error("Failed to create knowledge article:",t),t}})}static updateKnowledgeArticle(e,t){return Ot(this,null,function*(){try{const r=new q,n={};t.title&&(n.title=t.title),t.description&&(n.summary=t.description),t.category&&(n.category_id=t.category),t.tags&&(n.tags=t.tags),t.status&&(n.status=t.status==="review"?"published":"draft");const s=yield r.updateArticle(e,n);if(s.error)throw new Error(s.error);if(!s.article)throw new Error("No article returned from update");return{id:s.article.id,title:s.article.title,category:zr(s.article.category),status:s.article.status,dueDate:s.article.published_at||new Date().toISOString(),progress:0,description:s.article.summary,tags:s.article.tags,createdAt:s.article.created_at,lastUpdated:s.article.updated_at}}catch(r){throw console.error("Failed to update knowledge article:",r),r}})}static deleteKnowledgeArticle(e){return Ot(this,null,function*(){try{const r=yield new q().deleteArticle(e);if(r.error)throw new Error(r.error)}catch(t){throw console.error("Failed to delete knowledge article:",t),t}})}static updateContentStatus(e,t){return Ot(this,null,function*(){try{const r=new q;let n;switch(t){case"review":n="review";break;case"published":n="published";break;default:n="draft"}const s=yield r.updateArticleStatus(e,n);if(s.error)throw new Error(s.error)}catch(r){throw console.error("Failed to update content status:",r),r}})}}var Br=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class qr{static bulkUpdateContentStatus(e,t){return Br(this,null,function*(){var r;try{const n=new q;let s;switch(t){case"review":s="review";break;case"published":s="published";break;default:s="draft"}const o=yield n.bulkUpdateArticlesStatus(e,s);return{success:o.success,processedCount:o.processedCount,successCount:o.updatedCount||0,errorCount:((r=o.errors)==null?void 0:r.length)||0,errors:o.errors||[]}}catch(n){throw console.error("Failed to bulk update content status:",n),n}})}static bulkDeleteContent(e){return Br(this,null,function*(){var t;try{const n=yield new q().deleteArticles(e);return{success:n.success,processedCount:n.processedCount,successCount:n.deletedCount||0,errorCount:((t=n.errors)==null?void 0:t.length)||0,errors:n.errors||[]}}catch(r){throw console.error("Failed to bulk delete content:",r),r}})}static bulkUpdateLearningPathStatus(e,t){return Br(this,null,function*(){var r;try{const s=yield new q().bulkUpdateLearningPathsStatus(e,t);return{success:s.success,processedCount:s.processedCount,successCount:s.updatedCount||0,errorCount:((r=s.errors)==null?void 0:r.length)||0,errors:s.errors||[]}}catch(n){throw console.error("Failed to bulk update learning path status:",n),n}})}static bulkDeleteLearningPathways(e){return Br(this,null,function*(){var t;try{const n=yield new q().deleteLearningPaths(e);return{success:n.success,processedCount:n.processedCount,successCount:n.deletedCount||0,errorCount:((t=n.errors)==null?void 0:t.length)||0,errors:n.errors||[]}}catch(r){throw console.error("Failed to bulk delete learning pathways:",r),r}})}}var Mt=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ht{static getLearningPathways(){return Mt(this,null,function*(){try{return(yield new q().getLearningPathways()).map(r=>({id:r.id,title:r.title,category:"Learning Pathways",status:"draft",dueDate:r.created_at||new Date().toISOString(),progress:0,lastUpdated:r.updated_at,description:r.description,createdAt:r.created_at}))}catch(e){throw console.error("Failed to get learning pathways:",e),e}})}static getLearningPathwayById(e){return Mt(this,null,function*(){try{const r=yield new q().getLearningPathById(e);if(r.error||!r.data)return null;const n=r.data;return{id:n.id,title:n.title,category:"Learning Pathways",status:"draft",dueDate:n.created_at||new Date().toISOString(),progress:0,lastUpdated:n.updated_at,description:n.description,createdAt:n.created_at}}catch(t){throw console.error("Failed to get learning pathway by ID:",t),t}})}static createLearningPathway(e){return Mt(this,null,function*(){try{const t=new q,r={title:e.title,description:e.description||"",category:e.category,difficulty:"beginner",estimated_time:"30 minutes",is_active:!0},n=yield t.createLearningPath(r);if(n.error)throw new Error(n.error);if(!n.pathway)throw new Error("No pathway returned from creation");return{id:n.pathway.id,title:n.pathway.title,category:n.pathway.category,status:"draft",dueDate:new Date().toISOString(),progress:0,description:n.pathway.description,createdAt:n.pathway.created_at,lastUpdated:n.pathway.updated_at}}catch(t){throw console.error("Failed to create learning pathway:",t),t}})}static updateLearningPathway(e,t){return Mt(this,null,function*(){try{const r=new q,n={};t.title&&(n.title=t.title),t.description&&(n.description=t.description),t.category&&(n.category=t.category);const s=yield r.updateLearningPath(e,n);if(s.error)throw new Error(s.error);if(!s.pathway)throw new Error("No pathway returned from update");return{id:s.pathway.id,title:s.pathway.title,category:s.pathway.category,status:"draft",dueDate:new Date().toISOString(),progress:0,description:s.pathway.description,createdAt:s.pathway.created_at,lastUpdated:s.pathway.updated_at}}catch(r){throw console.error("Failed to update learning pathway:",r),r}})}static deleteLearningPathway(e){return Mt(this,null,function*(){try{const r=yield new q().deleteLearningPath(e);if(r.error)throw new Error(r.error)}catch(t){throw console.error("Failed to delete learning pathway:",t),t}})}static updateLearningPathStatus(e,t){return Mt(this,null,function*(){try{const n=yield new q().updateLearningPathStatus(e,t);if(n.error)throw new Error(n.error)}catch(r){throw console.error("Failed to update learning path status:",r),r}})}}var In=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class En{static getKnowledgeCategories(){return In(this,null,function*(){try{return(yield new q().getKnowledgeCategories()).map(r=>r.name)}catch(e){throw console.error("Failed to get knowledge categories:",e),e}})}static addCategory(e){return In(this,null,function*(){try{const r=yield new q().addCategory(e);if(r.error)throw new Error(r.error);if(!r.category)throw new Error("No category returned from creation");return r.category.name}catch(t){throw console.error("Failed to add category:",t),t}})}static deleteCategory(e){return In(this,null,function*(){try{const r=yield new q().deleteCategory(e);if(r.error)throw new Error(r.error)}catch(t){throw console.error("Failed to delete category:",t),t}})}}var ze=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Be{static getQuizzes(){return ze(this,null,function*(){try{const{QuizService:e}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return(yield e.getAllQuizzes()).map(r=>({id:r.id,title:r.title,category:"Courses",status:r.is_active?"published":"draft",dueDate:r.created_at,progress:0,lastUpdated:r.updated_at,description:r.description||"Interactive quiz to test knowledge",tags:["quiz","assessment","knowledge-test"],createdAt:r.created_at,type:"quiz",contentType:"quiz",domain:"knowledge-assessment",isActive:r.is_active,estimatedDuration:r.time_limit_minutes||15,difficultyLevel:"medium",mandatoryRepeat:!1,passingScore:r.passing_score}))}catch(e){return console.error("Failed to get quizzes:",e),[]}})}static getQuizById(e){return ze(this,null,function*(){try{const{QuizService:t}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.getQuizWithQuestions(e)}catch(t){return console.error("Failed to get quiz by ID:",t),null}})}static startQuizAttempt(e){return ze(this,null,function*(){try{const{QuizService:t}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.startQuizAttempt(e)}catch(t){return console.error("Failed to start quiz attempt:",t),null}})}static submitQuizAnswers(e,t){return ze(this,null,function*(){try{const{QuizService:r}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return yield r.submitQuizAttempt(e,t)}catch(r){return console.error("Failed to submit quiz answers:",r),{success:!1,score:0,passed:!1}}})}static getUserQuizAttempts(){return ze(this,null,function*(){try{const{QuizService:e}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return yield e.getUserQuizAttempts()}catch(e){return console.error("Failed to get user quiz attempts:",e),[]}})}static createQuiz(e){return ze(this,null,function*(){try{const{QuizService:t}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.createQuiz(e)}catch(t){return console.error("Failed to create quiz:",t),null}})}static updateQuiz(e,t){return ze(this,null,function*(){try{const{QuizService:r}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return yield r.updateQuiz(e,t)}catch(r){return console.error("Failed to update quiz:",r),null}})}static deleteQuiz(e){return ze(this,null,function*(){try{const{QuizService:t}=yield N(()=>import("./quizService-BfeOvcOT.js"),__vite__mapDeps([9,1,2,3,4]));return yield t.deleteQuiz(e)}catch(t){return console.error("Failed to delete quiz:",t),!1}})}}var As=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Is{static getRecentUserActivity(e,t){return As(this,null,function*(){try{return yield new q().getRecentUserActivity(e,t)}catch(r){throw console.error("Failed to get recent user activity:",r),r}})}static getAllContent(){return As(this,null,function*(){try{const[e,t]=yield Promise.all([dt.getKnowledgeArticles(),ht.getLearningPathways()]);return[...e,...t]}catch(e){throw console.error("Failed to get all content:",e),e}})}}var x=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Es{static getKnowledgeArticles(){return x(this,null,function*(){return dt.getKnowledgeArticles()})}static getKnowledgeArticleById(e){return x(this,null,function*(){return dt.getKnowledgeArticleById(e)})}static createKnowledgeArticle(e){return x(this,null,function*(){return dt.createKnowledgeArticle(e)})}static updateKnowledgeArticle(e,t){return x(this,null,function*(){return dt.updateKnowledgeArticle(e,t)})}static deleteKnowledgeArticle(e){return x(this,null,function*(){return dt.deleteKnowledgeArticle(e)})}static updateContentStatus(e,t){return x(this,null,function*(){return dt.updateContentStatus(e,t)})}static bulkUpdateContentStatus(e,t){return x(this,null,function*(){return qr.bulkUpdateContentStatus(e,t)})}static bulkDeleteContent(e){return x(this,null,function*(){return qr.bulkDeleteContent(e)})}static getLearningPathways(){return x(this,null,function*(){return ht.getLearningPathways()})}static getLearningPathwayById(e){return x(this,null,function*(){return ht.getLearningPathwayById(e)})}static createLearningPathway(e){return x(this,null,function*(){return ht.createLearningPathway(e)})}static updateLearningPathway(e,t){return x(this,null,function*(){return ht.updateLearningPathway(e,t)})}static deleteLearningPathway(e){return x(this,null,function*(){return ht.deleteLearningPathway(e)})}static updateLearningPathStatus(e,t){return x(this,null,function*(){return ht.updateLearningPathStatus(e,t)})}static bulkUpdateLearningPathStatus(e,t){return x(this,null,function*(){return qr.bulkUpdateLearningPathStatus(e,t)})}static bulkDeleteLearningPathways(e){return x(this,null,function*(){return qr.bulkDeleteLearningPathways(e)})}static getKnowledgeCategories(){return x(this,null,function*(){return En.getKnowledgeCategories()})}static addCategory(e){return x(this,null,function*(){return En.addCategory(e)})}static deleteCategory(e){return x(this,null,function*(){return En.deleteCategory(e)})}static getAllContent(){return x(this,null,function*(){return Is.getAllContent()})}static getRecentUserActivity(e,t){return x(this,null,function*(){return Is.getRecentUserActivity(e,t)})}static getQuizzes(){return x(this,null,function*(){return Be.getQuizzes()})}static getQuizById(e){return x(this,null,function*(){return Be.getQuizById(e)})}static startQuizAttempt(e){return x(this,null,function*(){return Be.startQuizAttempt(e)})}static submitQuizAnswers(e,t){return x(this,null,function*(){return Be.submitQuizAnswers(e,t)})}static getUserQuizAttempts(){return x(this,null,function*(){return Be.getUserQuizAttempts()})}static createQuiz(e){return x(this,null,function*(){return Be.createQuiz(e)})}static updateQuiz(e,t){return x(this,null,function*(){return Be.updateQuiz(e,t)})}static deleteQuiz(e){return x(this,null,function*(){return Be.deleteQuiz(e)})}}var pe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Bg{static getKnowledgeHubContent(e,t,r=10){return pe(this,null,function*(){try{return(yield Es.getKnowledgeArticles()).filter(c=>e.includes(c.category.toLowerCase())&&t.some(a=>c.title.toLowerCase().includes(a.toLowerCase())||c.category.toLowerCase().includes(a.toLowerCase()))).map(c=>({contentId:c.id,title:c.title,category:c.category.toLowerCase(),relevance:this.calculateRelevance(c,t),lastUpdated:c.lastUpdated||new Date().toISOString(),url:`/knowledge-hub/${c.category.toLowerCase()}/${c.id}`})).sort((c,a)=>a.relevance-c.relevance).slice(0,r)}catch(n){return console.error("Error fetching Knowledge Hub content:",n),[]}})}static getAuditTrail(e,t,r,n=50){return pe(this,null,function*(){try{const{data:{user:s}}=yield _.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:o}=yield _.from("users").select("facility_id").eq("id",s.id).single(),c=(o==null?void 0:o.facility_id)||"550e8400-e29b-41d4-a716-446655440000";let a=_.from("audit_logs").select("*").eq("facility_id",c).order("timestamp",{ascending:!1}).limit(n);e&&(a=a.eq("user_id",e)),t&&(a=a.ilike("action",`%${t}%`)),r&&(a=a.gte("timestamp",r.startDate).lte("timestamp",r.endDate));const{data:l,error:u}=yield a;return u?(console.error("Error fetching audit trail:",u),[]):!l||l.length===0?[]:l.map(h=>{var p,m;return{actionId:String(h.id),timestamp:h.timestamp,userId:h.user_id,userName:(p=h.user_name)!=null?p:"Unknown User",action:h.action,details:h.metadata?JSON.stringify(h.metadata):"",impact:this.determineImpact(h.action),status:(m=h.status)!=null?m:"completed"}})}catch(s){return console.error("Error fetching audit trail:",s),[]}})}static pushKnowledgeHubNotification(e,t,r){return pe(this,null,function*(){try{const{data:n}=yield _.from("users").select("facility_id").eq("id",e).single(),s=(n==null?void 0:n.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{error:o}=yield _.from("audit_logs").insert({user_id:e,facility_id:s,action:"Knowledge Hub Notification",details:`Notification for content ${t}: ${r}`,timestamp:new Date().toISOString(),module:"knowledge_hub"});return o?(console.error("Error logging notification:",o),!1):!0}catch(n){return console.error("Error pushing Knowledge Hub notification:",n),!1}})}static scheduleSupplierContact(e,t,r){return pe(this,null,function*(){try{const{data:{user:n}}=yield _.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:s}=yield _.from("users").select("facility_id").eq("id",n.id).single(),o=(s==null?void 0:s.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{error:c}=yield _.from("audit_logs").insert({user_id:n.id,facility_id:o,action:"Supplier Contact Scheduled",details:`${t} contact with supplier ${e}, priority: ${r}`,timestamp:new Date().toISOString(),module:"supplier_management"});return c?(console.error("Error logging supplier contact:",c),!1):!0}catch(n){return console.error("Error scheduling supplier contact:",n),!1}})}static getIntegrationMetrics(){return pe(this,null,function*(){try{const[e,t,r]=yield Promise.all([this.getKnowledgeHubCount(),this.getActiveSupplierCount(),this.getRecentAuditCount()]);return{knowledgeHubArticles:e,activeSuppliers:t,recentAuditActions:r,integrationHealth:this.calculateIntegrationHealth(e,t,r),lastSync:new Date().toISOString()}}catch(e){return console.error("Error fetching integration metrics:",e),{knowledgeHubArticles:0,activeSuppliers:0,recentAuditActions:0,integrationHealth:0,lastSync:new Date().toISOString()}}})}static syncAllIntegrations(){return pe(this,null,function*(){try{return yield Promise.all([this.syncKnowledgeHub(),this.syncSupplierDatabase(),this.syncAuditTrail()]),!0}catch(e){return console.error("Error during integration sync:",e),!1}})}static calculateRelevance(e,t){let r=50;return t.forEach(n=>{var s,o,c;(s=e.title)!=null&&s.toLowerCase().includes(n.toLowerCase())&&(r+=20),(o=e.category)!=null&&o.toLowerCase().includes(n.toLowerCase())&&(r+=15),e.tags&&((c=e.tags)!=null&&c.some(a=>a.toLowerCase().includes(n.toLowerCase())))&&(r+=10)}),Math.min(r,100)}static calculateCostCompetitiveness(e,t){const n=Math.min(t/1e3,2);return Math.min(7*n,10)}static determineImpact(e){const t=["sterilization","bi test","critical","emergency"],r=["inventory","training","maintenance"],n=e.toLowerCase();return t.some(s=>n.includes(s))?"high":r.some(s=>n.includes(s))?"medium":"low"}static getKnowledgeHubCount(){return pe(this,null,function*(){try{return(yield Es.getKnowledgeArticles()).length}catch(e){return console.error(e),0}})}static getActiveSupplierCount(){return pe(this,null,function*(){try{const{data:e,error:t}=yield _.from("information_schema.tables").select("table_name").eq("table_name","inventory_suppliers").single();return(t||!e)&&console.log(" inventory_suppliers table not found, using default count"),5}catch(e){return console.log(" Exception fetching supplier count:",e),5}})}static getRecentAuditCount(){return pe(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return 0;const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),r=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",n=new Date;n.setDate(n.getDate()-30);const{count:s,error:o}=yield _.from("audit_logs").select("*",{count:"exact",head:!0}).eq("facility_id",r).gte("created_at",n.toISOString());return o?0:s!=null?s:0}catch(e){return console.error(e),0}})}static calculateIntegrationHealth(e,t,r){const n=Math.min(e/10,1)*30,s=Math.min(t/20,1)*30,o=Math.min(r/50,1)*40;return Math.round(n+s+o)}static syncKnowledgeHub(){return pe(this,null,function*(){yield new Promise(e=>setTimeout(e,500))})}static syncSupplierDatabase(){return pe(this,null,function*(){yield new Promise(e=>setTimeout(e,500))})}static syncAuditTrail(){return pe(this,null,function*(){yield new Promise(e=>setTimeout(e,500))})}static getFallbackSuppliers(e,t){return[{supplierId:"fallback-1",name:"Medical Supply Co.",category:e,rating:4.5,deliveryTime:3,costCompetitiveness:8,reliability:9,contactInfo:{email:"contact@medsupply.com",phone:"+1-555-0123",website:"https://medsupply.com"}},{supplierId:"fallback-2",name:"Clinical Equipment Ltd.",category:e,rating:4.2,deliveryTime:5,costCompetitiveness:7.5,reliability:8.5,contactInfo:{email:"sales@clinicalequip.com",phone:"+1-555-0456",website:"https://clinicalequip.com"}}].slice(0,t)}}var _h=Object.defineProperty,ks=Object.getOwnPropertySymbols,wh=Object.prototype.hasOwnProperty,bh=Object.prototype.propertyIsEnumerable,Ls=(i,e,t)=>e in i?_h(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Gr=(i,e)=>{for(var t in e||(e={}))wh.call(e,t)&&Ls(i,t,e[t]);if(ks)for(var t of ks(e))bh.call(e,t)&&Ls(i,t,e[t]);return i},ot=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Se{static initialize(){return ot(this,null,function*(){if(!this.isInitialized)try{const e=yr.getConfig();yield hs.initialize(e),this.isInitialized=!0,console.log("Analytics Service initialized successfully.")}catch(e){console.error("Failed to initialize Analytics Service:",e)}})}static trackEvent(e,t,r,n){return ot(this,null,function*(){this.isInitialized||(yield this.initialize());try{yield Od.trackEvent(e,t,r,n);const s=yr.getConfig();yield hs.trackEvent(e,t,r,n,s)}catch(s){console.error("Failed to track analytics event:",s)}})}static trackPageView(e,t,r,n){return ot(this,null,function*(){yield this.trackEvent("page_view",Gr({page:e},t),r,n)})}static trackUserAction(e,t,r,n){return ot(this,null,function*(){yield this.trackEvent("user_action",Gr({action:e},t),r,n)})}static trackError(e,t,r,n){return ot(this,null,function*(){yield this.trackEvent("error",Gr({message:e.message,stack:e.stack},t),r,n)})}static trackPerformance(e,t,r,n,s){return ot(this,null,function*(){yield this.trackEvent("performance",Gr({metric:e,value:t},r),n,s)})}static getConfig(){return yr.getConfig()}static updateConfig(e){return ot(this,null,function*(){yield yr.updateConfig(e)})}static reset(){this.isInitialized=!1}}Se.isInitialized=!1;const D=Se.trackEvent.bind(Se);Se.trackPageView.bind(Se);Se.trackUserAction.bind(Se);Se.trackError.bind(Se);Se.trackPerformance.bind(Se);var Ch=Object.defineProperty,Sh=Object.defineProperties,Ah=Object.getOwnPropertyDescriptors,Ts=Object.getOwnPropertySymbols,Ih=Object.prototype.hasOwnProperty,Eh=Object.prototype.propertyIsEnumerable,Ps=(i,e,t)=>e in i?Ch(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,kh=(i,e)=>{for(var t in e||(e={}))Ih.call(e,t)&&Ps(i,t,e[t]);if(Ts)for(var t of Ts(e))Eh.call(e,t)&&Ps(i,t,e[t]);return i},Lh=(i,e)=>Sh(i,Ah(e)),ge=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function Th(i){return $e.categorizeItems(i)}function Ph(i){return $e.withNormalizedCategory(i)}class $e{constructor(e,t){this.adapter=e,this.adapterType=t}static normalizeCategory(e){const t=e.toLowerCase().trim();return t.includes("mask")||t.includes("glove")||t.includes("gown")||t.includes("supply")?"Supplies":t.includes("scalpel")||t.includes("forceps")||t.includes("tool")||t.includes("instrument")?"Tools":t.includes("chair")||t.includes("autoclave")||t.includes("machine")||t.includes("equipment")?"Equipment":t.includes("computer")||t.includes("printer")||t.includes("office")||t.includes("hardware")?"Office Hardware":"Tools"}static categorizeItems(e){const t=[],r=[],n=[],s=[];return e.forEach(o=>{switch(this.normalizeCategory(o.category||"")){case"Tools":t.push(o);break;case"Supplies":r.push(o);break;case"Equipment":n.push(o);break;case"Office Hardware":s.push(o);break;default:t.push(o);break}}),{tools:t,supplies:r,equipment:n,officeHardware:s}}static withNormalizedCategory(e){return e.map(t=>Lh(kh({},t),{category:this.normalizeCategory(t.category)}))}addCategory(e){return ge(this,null,function*(){return{success:yield L.handleOperation("addCategory",()=>ge(this,null,function*(){return yield this.adapter.addCategory(e),X.invalidateRelated("inventory:categories",e),V("inventory","category_created",`Category created: ${e}`,"info",{category:e,adapterType:this.adapterType}),j("create_category","inventory",{category:e}),D("inventory_category_created",{category:e,adapterType:this.adapterType}),!0})),error:null}})}deleteCategory(e){return ge(this,null,function*(){return{success:yield L.handleOperation("deleteCategory",()=>ge(this,null,function*(){return yield this.adapter.deleteCategory(e),X.invalidateRelated("inventory:categories",e),V("inventory","category_deleted",`Category deleted: ${e}`,"info",{category:e,adapterType:this.adapterType}),j("delete_category","inventory",{category:e}),D("inventory_category_deleted",{category:e,adapterType:this.adapterType}),!0})),error:null}})}getCategories(){return ge(this,null,function*(){return{data:yield L.handleOperation("getCategories",()=>ge(this,null,function*(){return yield this.adapter.fetchCategories()})),error:null}})}getNormalizedCategories(){return ge(this,null,function*(){return{data:yield L.handleOperation("getNormalizedCategories",()=>ge(this,null,function*(){const r=(yield this.adapter.fetchCategories()).map(n=>$e.normalizeCategory(n));return Array.from(new Set(r))})),error:null}})}getCategoryStats(){return ge(this,null,function*(){return{data:yield L.handleOperation("getCategoryStats",()=>ge(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=$e.normalizeCategory(n.category||"");r[s]=(r[s]||0)+1}),r})),error:null}})}static validateCategoryName(e){const t=[];return(!e||e.trim()==="")&&t.push("Category name is required"),e.length>100&&t.push("Category name must be less than 100 characters"),/^[a-zA-Z0-9\s\-_]+$/.test(e)||t.push("Category name contains invalid characters"),{isValid:t.length===0,errors:t}}static getCategorySuggestions(e){const t=e.toLowerCase(),r=[];return(t.includes("mask")||t.includes("glove")||t.includes("gown"))&&r.push("Supplies"),(t.includes("scalpel")||t.includes("forceps")||t.includes("tool"))&&r.push("Tools"),(t.includes("chair")||t.includes("autoclave")||t.includes("machine"))&&r.push("Equipment"),(t.includes("computer")||t.includes("printer")||t.includes("office"))&&r.push("Office Hardware"),r.length===0&&r.push("Tools","Supplies","Equipment","Office Hardware"),r}mergeCategories(e,t){return ge(this,null,function*(){return{success:yield L.handleOperation("mergeCategories",()=>ge(this,null,function*(){const s=(yield this.adapter.fetchInventoryItems()).filter(a=>a.category===e);for(const a of s)yield this.adapter.updateInventoryItem(a.id,{category:t});return(yield this.adapter.fetchInventoryItems()).some(a=>a.category===e)||(yield this.adapter.deleteCategory(e)),V("inventory","category_merged",`Category merged: ${e} -> ${t}`,"info",{sourceCategory:e,targetCategory:t,itemsUpdated:s.length,adapterType:this.adapterType}),j("merge_category","inventory",{sourceCategory:e,targetCategory:t,itemsUpdated:s.length}),D("inventory_category_merged",{sourceCategory:e,targetCategory:t,itemsUpdated:s.length,adapterType:this.adapterType}),!0})),error:null}})}}var Oh=Object.defineProperty,Mh=Object.defineProperties,xh=Object.getOwnPropertyDescriptors,Os=Object.getOwnPropertySymbols,Hh=Object.prototype.hasOwnProperty,Dh=Object.prototype.propertyIsEnumerable,Ms=(i,e,t)=>e in i?Oh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Rh=(i,e)=>{for(var t in e||(e={}))Hh.call(e,t)&&Ms(i,t,e[t]);if(Os)for(var t of Os(e))Dh.call(e,t)&&Ms(i,t,e[t]);return i},Vh=(i,e)=>Mh(i,xh(e)),Y=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class $h{constructor(e,t){this.adapter=e,this.adapterType=t}fetchInventoryItems(){return Y(this,null,function*(){return yield L.handleOperation("fetchInventoryItems",()=>Y(this,null,function*(){return yield this.adapter.fetchInventoryItems()}))})}getItemById(e){return Y(this,null,function*(){return yield L.handleOperation("getItemById",()=>Y(this,null,function*(){return{data:(yield this.adapter.fetchInventoryItems()).find(s=>s.id===e)||null,error:null}}))})}createItem(e){return Y(this,null,function*(){return{data:yield L.handleOperation("createItem",()=>Y(this,null,function*(){const r=yield this.adapter.addInventoryItem(e);return X.invalidateRelated("inventory:create",r.id),V("inventory","item_created",`Inventory item created: ${e.name||e.item}`,"info",{itemId:r.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),j("create_item","inventory",{itemId:r.id,itemName:e.name||e.item,category:e.category}),D("inventory_item_created",{itemId:r.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),r})),error:null}})}updateItem(e,t){return Y(this,null,function*(){return{data:yield L.handleOperation("updateItem",()=>Y(this,null,function*(){const n=yield this.adapter.updateInventoryItem(e,t);return X.invalidateRelated("inventory:update",e),V("inventory","item_updated",`Inventory item updated: ${e}`,"info",{itemId:e,updates:Object.keys(t),adapterType:this.adapterType}),j("update_item","inventory",{itemId:e,updates:Object.keys(t)}),D("inventory_item_updated",{itemId:e,updates:Object.keys(t),adapterType:this.adapterType}),n})),error:null}})}deleteItem(e){return Y(this,null,function*(){return{success:yield L.handleOperation("deleteItem",()=>Y(this,null,function*(){return yield this.adapter.deleteInventoryItem(e),X.invalidateRelated("inventory:delete",e),V("inventory","item_deleted",`Inventory item deleted: ${e}`,"info",{itemId:e,adapterType:this.adapterType}),j("delete_item","inventory",{itemId:e}),D("inventory_item_deleted",{itemId:e,adapterType:this.adapterType}),!0})),error:null}})}addInventoryItem(e){return Y(this,null,function*(){return yield L.handleOperation("addInventoryItem",()=>Y(this,null,function*(){const r=yield this.adapter.addInventoryItem(e);return X.invalidateRelated("inventory:create",e.id),V("inventory","item_created",`Inventory item created: ${e.name||e.item}`,"info",{itemId:e.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),j("create_item","inventory",{itemId:e.id,itemName:e.name||e.item,category:e.category}),D("inventory_item_created",{itemId:e.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),r}))})}static validateItemData(e){const t=[];return!e.name&&!e.item&&t.push("Item name is required"),e.category||t.push("Category is required"),e.quantity!==void 0&&e.quantity<0&&t.push("Quantity must be non-negative"),e.minimumStock!==void 0&&e.minimumStock<0&&t.push("Minimum stock must be non-negative"),e.location&&e.location.length>200&&t.push("Location must be less than 200 characters"),e.description&&e.description.length>1e3&&t.push("Description must be less than 1000 characters"),{isValid:t.length===0,errors:t}}duplicateItem(e,t){return Y(this,null,function*(){return{data:yield L.handleOperation("duplicateItem",()=>Y(this,null,function*(){const n=yield this.getItemById(e);if(!n.data)throw new Error("Original item not found");const s=Vh(Rh({},n.data),{name:t||`${n.data.name} (Copy)`,id:""}),o=yield this.adapter.addInventoryItem(s);return X.invalidateRelated("inventory:create",o.id),V("inventory","item_duplicated",`Inventory item duplicated: ${e} -> ${o.id}`,"info",{originalItemId:e,newItemId:o.id,adapterType:this.adapterType}),j("duplicate_item","inventory",{originalItemId:e,newItemId:o.id}),D("inventory_item_duplicated",{originalItemId:e,newItemId:o.id,adapterType:this.adapterType}),o})),error:null}})}archiveItem(e,t){return Y(this,null,function*(){return{data:yield L.handleOperation("archiveItem",()=>Y(this,null,function*(){const n=yield this.adapter.updateInventoryItem(e,{status:"archived",archivedAt:new Date().toISOString(),archiveReason:t});return X.invalidateRelated("inventory:update",e),V("inventory","item_archived",`Inventory item archived: ${e}`,"info",{itemId:e,reason:t,adapterType:this.adapterType}),j("archive_item","inventory",{itemId:e,reason:t}),D("inventory_item_archived",{itemId:e,reason:t,adapterType:this.adapterType}),n})),error:null}})}restoreItem(e){return Y(this,null,function*(){return{data:yield L.handleOperation("restoreItem",()=>Y(this,null,function*(){const r=yield this.adapter.updateInventoryItem(e,{status:"active",archivedAt:null,archiveReason:null});return X.invalidateRelated("inventory:update",e),V("inventory","item_restored",`Inventory item restored: ${e}`,"info",{itemId:e,adapterType:this.adapterType}),j("restore_item","inventory",{itemId:e}),D("inventory_item_restored",{itemId:e,adapterType:this.adapterType}),r})),error:null}})}}var oe=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class jh{constructor(e,t){this.adapter=e,this.adapterType=t}bulkCreateItems(e){return oe(this,null,function*(){return yield L.handleOperation("bulkCreateItems",()=>oe(this,null,function*(){const r=[],n=[];let s=0,o=0;for(const c of e)try{const a=yield this.adapter.addInventoryItem(c);r.push(a),X.invalidateRelated("inventory:create",a.id),s++}catch(a){n.push(`Failed to create item ${c.name||c.item}: ${a instanceof Error?a.message:"Unknown error"}`),o++}return V("inventory","bulk_items_created",`Bulk created ${s} items, ${o} failed`,"info",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),j("bulk_create_items","inventory",{totalItems:e.length,successCount:s,errorCount:o}),D("inventory_bulk_items_created",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),{success:o===0,processedCount:e.length,successCount:s,errorCount:o,errors:n,data:r}}))})}bulkUpdateItems(e){return oe(this,null,function*(){return yield L.handleOperation("bulkUpdateItems",()=>oe(this,null,function*(){const r=[],n=[];let s=0,o=0;for(const c of e)try{const a=yield this.adapter.updateInventoryItem(c.id,c.updates);r.push(a),X.invalidateRelated("inventory:update",c.id),s++}catch(a){n.push(`Failed to update item ${c.id}: ${a instanceof Error?a.message:"Unknown error"}`),o++}return V("inventory","bulk_items_updated",`Bulk updated ${s} items, ${o} failed`,"info",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),j("bulk_update_items","inventory",{totalItems:e.length,successCount:s,errorCount:o}),D("inventory_bulk_items_updated",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),{success:o===0,processedCount:e.length,successCount:s,errorCount:o,errors:n,data:r}}))})}bulkDeleteItems(e){return oe(this,null,function*(){return yield L.handleOperation("bulkDeleteItems",()=>oe(this,null,function*(){const r=[];let n=0,s=0;for(const o of e)try{yield this.adapter.deleteInventoryItem(o),X.invalidateRelated("inventory:delete",o),n++}catch(c){r.push(`Failed to delete item ${o}: ${c instanceof Error?c.message:"Unknown error"}`),s++}return V("inventory","bulk_items_deleted",`Bulk deleted ${n} items, ${s} failed`,"info",{totalItems:e.length,successCount:n,errorCount:s,adapterType:this.adapterType}),j("bulk_delete_items","inventory",{totalItems:e.length,successCount:n,errorCount:s}),D("inventory_bulk_items_deleted",{totalItems:e.length,successCount:n,errorCount:s,adapterType:this.adapterType}),{success:s===0,processedCount:e.length,successCount:n,errorCount:s,errors:r,data:[]}}))})}bulkArchiveItems(e,t){return oe(this,null,function*(){return yield L.handleOperation("bulkArchiveItems",()=>oe(this,null,function*(){const n=[],s=[];let o=0,c=0;for(const a of e)try{const l=yield this.adapter.updateInventoryItem(a,{status:"archived",archivedAt:new Date().toISOString(),archiveReason:t});n.push(l),X.invalidateRelated("inventory:update",a),o++}catch(l){s.push(`Failed to archive item ${a}: ${l instanceof Error?l.message:"Unknown error"}`),c++}return V("inventory","bulk_items_archived",`Bulk archived ${o} items, ${c} failed`,"info",{totalItems:e.length,successCount:o,errorCount:c,reason:t,adapterType:this.adapterType}),j("bulk_archive_items","inventory",{totalItems:e.length,successCount:o,errorCount:c,reason:t}),D("inventory_bulk_items_archived",{totalItems:e.length,successCount:o,errorCount:c,reason:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:o,errorCount:c,errors:s,data:n}}))})}bulkRestoreItems(e){return oe(this,null,function*(){return yield L.handleOperation("bulkRestoreItems",()=>oe(this,null,function*(){const r=[],n=[];let s=0,o=0;for(const c of e)try{const a=yield this.adapter.updateInventoryItem(c,{status:"active",archivedAt:null,archiveReason:null});r.push(a),X.invalidateRelated("inventory:update",c),s++}catch(a){n.push(`Failed to restore item ${c}: ${a instanceof Error?a.message:"Unknown error"}`),o++}return V("inventory","bulk_items_restored",`Bulk restored ${s} items, ${o} failed`,"info",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),j("bulk_restore_items","inventory",{totalItems:e.length,successCount:s,errorCount:o}),D("inventory_bulk_items_restored",{totalItems:e.length,successCount:s,errorCount:o,adapterType:this.adapterType}),{success:o===0,processedCount:e.length,successCount:s,errorCount:o,errors:n,data:r}}))})}bulkChangeCategory(e,t){return oe(this,null,function*(){return yield L.handleOperation("bulkChangeCategory",()=>oe(this,null,function*(){const n=[],s=[];let o=0,c=0;for(const a of e)try{const l=yield this.adapter.updateInventoryItem(a,{category:t});n.push(l),X.invalidateRelated("inventory:update",a),o++}catch(l){s.push(`Failed to change category for item ${a}: ${l instanceof Error?l.message:"Unknown error"}`),c++}return V("inventory","bulk_category_changed",`Bulk changed category for ${o} items, ${c} failed`,"info",{totalItems:e.length,successCount:o,errorCount:c,newCategory:t,adapterType:this.adapterType}),j("bulk_change_category","inventory",{totalItems:e.length,successCount:o,errorCount:c,newCategory:t}),D("inventory_bulk_category_changed",{totalItems:e.length,successCount:o,errorCount:c,newCategory:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:o,errorCount:c,errors:s,data:n}}))})}bulkChangeLocation(e,t){return oe(this,null,function*(){return yield L.handleOperation("bulkChangeLocation",()=>oe(this,null,function*(){const n=[],s=[];let o=0,c=0;for(const a of e)try{const l=yield this.adapter.updateInventoryItem(a,{location:t});n.push(l),X.invalidateRelated("inventory:update",a),o++}catch(l){s.push(`Failed to change location for item ${a}: ${l instanceof Error?l.message:"Unknown error"}`),c++}return V("inventory","bulk_location_changed",`Bulk changed location for ${o} items, ${c} failed`,"info",{totalItems:e.length,successCount:o,errorCount:c,newLocation:t,adapterType:this.adapterType}),j("bulk_change_location","inventory",{totalItems:e.length,successCount:o,errorCount:c,newLocation:t}),D("inventory_bulk_location_changed",{totalItems:e.length,successCount:o,errorCount:c,newLocation:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:o,errorCount:c,errors:s,data:n}}))})}static validateBulkOperationData(e,t){const r=[];switch((!t||t.length===0)&&r.push("No data provided for bulk operation"),t.length>1e3&&r.push("Bulk operation limited to 1000 items maximum"),e){case"create":t.forEach((n,s)=>{if(!n||typeof n!="object"){r.push(`Item ${s+1}: Invalid item data`);return}const o=n;!o.name&&!o.item&&r.push(`Item ${s+1}: Name is required`),o.category||r.push(`Item ${s+1}: Category is required`)});break;case"update":t.forEach((n,s)=>{if(!n||typeof n!="object"){r.push(`Update ${s+1}: Invalid update data`);return}const o=n;o.id||r.push(`Update ${s+1}: ID is required`),o.updates||r.push(`Update ${s+1}: Updates object is required`)});break;case"delete":case"archive":case"restore":t.forEach((n,s)=>{(typeof n!="string"||!n.trim())&&r.push(`ID ${s+1}: Valid ID is required`)});break}return{isValid:r.length===0,errors:r}}}var me=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Uh{constructor(e){this.adapter=e}searchItems(e){return me(this,null,function*(){return yield L.handleOperation("searchItems",()=>me(this,null,function*(){return{data:(yield this.adapter.fetchInventoryItems()).filter(s=>{var o,c,a,l;return((o=s.name)==null?void 0:o.toLowerCase().includes(e.toLowerCase()))||((a=(c=s.data)==null?void 0:c.description)==null?void 0:a.toString().toLowerCase().includes(e.toLowerCase()))||((l=s.category)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))}),error:null}}))})}getFilteredItems(e){return me(this,null,function*(){return yield L.handleOperation("getFilteredItems",()=>me(this,null,function*(){let n=yield this.adapter.fetchInventoryItems();if(e.category&&(n=n.filter(s=>s.category===e.category)),e.status&&(n=n.filter(s=>s.status===e.status)),e.location&&(n=n.filter(s=>s.location===e.location)),e.searchQuery){const s=e.searchQuery.toLowerCase();n=n.filter(o=>{var c,a,l;return((c=o.name)==null?void 0:c.toLowerCase().includes(s))||((l=(a=o.data)==null?void 0:a.description)==null?void 0:l.toString().toLowerCase().includes(s))})}return e.minQuantity!==void 0&&(n=n.filter(s=>(s.quantity||0)>=e.minQuantity)),e.maxQuantity!==void 0&&(n=n.filter(s=>(s.quantity||0)<=e.maxQuantity)),e.dateRange&&(n=n.filter(s=>{const o=new Date(s.lastUpdated||s.createdAt);return o>=e.dateRange.start&&o<=e.dateRange.end})),e.tags&&e.tags.length>0&&(n=n.filter(s=>{var o;const c=((o=s.data)==null?void 0:o.tags)||[];return e.tags.some(a=>c.includes(a))})),{data:n,error:null}}))})}advancedSearch(e){return me(this,arguments,function*(t,r={}){return yield L.handleOperation("advancedSearch",()=>me(this,null,function*(){let o=yield this.adapter.fetchInventoryItems();if(t.category&&(o=o.filter(a=>a.category===t.category)),t.status&&(o=o.filter(a=>a.status===t.status)),t.location&&(o=o.filter(a=>a.location===t.location)),t.searchQuery){const a=t.searchQuery.toLowerCase();o=o.filter(l=>{var u,d,h,p;return((u=l.name)==null?void 0:u.toLowerCase().includes(a))||((h=(d=l.data)==null?void 0:d.description)==null?void 0:h.toString().toLowerCase().includes(a))||((p=l.category)==null?void 0:p.toLowerCase().includes(a))})}t.minQuantity!==void 0&&(o=o.filter(a=>(a.quantity||0)>=t.minQuantity)),t.maxQuantity!==void 0&&(o=o.filter(a=>(a.quantity||0)<=t.maxQuantity)),t.dateRange&&(o=o.filter(a=>{const l=new Date(a.lastUpdated||a.createdAt);return l>=t.dateRange.start&&l<=t.dateRange.end})),t.tags&&t.tags.length>0&&(o=o.filter(a=>{var l;const u=((l=a.data)==null?void 0:l.tags)||[];return t.tags.some(d=>u.includes(d))})),r.includeArchived||(o=o.filter(a=>a.status!=="archived")),r.sortBy&&(o=this.sortItems(o,r.sortBy,r.sortOrder||"asc"));const c=o.length;if(r.limit||r.offset){const a=r.offset||0,l=r.limit?a+r.limit:o.length;o=o.slice(a,l)}return{data:o,total:c,filters:t,options:r,error:null}}))})}searchByNormalizedCategory(e){return me(this,arguments,function*(t,r={}){return yield L.handleOperation("searchByNormalizedCategory",()=>me(this,null,function*(){let c=(yield this.adapter.fetchInventoryItems()).filter(l=>$e.normalizeCategory(l.category||"")===t);r.includeArchived||(c=c.filter(l=>l.status!=="archived")),r.sortBy&&(c=this.sortItems(c,r.sortBy,r.sortOrder||"asc"));const a=c.length;if(r.limit||r.offset){const l=r.offset||0,u=r.limit?l+r.limit:c.length;c=c.slice(l,u)}return{data:c,total:a,filters:{category:t},options:r,error:null}}))})}getSearchSuggestions(e,t=10){return me(this,null,function*(){return(yield L.handleOperation("getSearchSuggestions",()=>me(this,null,function*(){const n=yield this.adapter.fetchInventoryItems(),s=new Set;if(!e||e.trim()==="")return[];const o=e.toLowerCase();return n.forEach(c=>{var a;c.name&&c.name.toLowerCase().includes(o)&&s.add(c.name),c.category&&c.category.toLowerCase().includes(o)&&s.add(c.category),c.location&&c.location.toLowerCase().includes(o)&&s.add(c.location);const l=(a=c.data)==null?void 0:a.description;l&&l.toLowerCase().includes(o)&&l.split(/\s+/).filter(d=>d.toLowerCase().includes(o)&&d.length>2).forEach(d=>s.add(d))}),Array.from(s).slice(0,t)})))||[]})}getLocations(){return me(this,null,function*(){return{data:yield L.handleOperation("getLocations",()=>me(this,null,function*(){const t=yield this.adapter.fetchInventoryItems();return Array.from(new Set(t.map(n=>n.location).filter(Boolean)))})),error:null}})}sortItems(e,t,r){return e.sort((n,s)=>{let o,c;switch(t){case"name":o=n.name||"",c=s.name||"";break;case"category":o=n.category||"",c=s.category||"";break;case"location":o=n.location||"",c=s.location||"";break;case"quantity":o=n.quantity||0,c=s.quantity||0;break;case"lastUpdated":o=new Date(n.lastUpdated||n.createdAt),c=new Date(s.lastUpdated||s.createdAt);break;default:o=n.name||"",c=s.name||""}return o<c?r==="asc"?-1:1:o>c?r==="asc"?1:-1:0})}static validateSearchFilters(e){const t=[];return e.minQuantity!==void 0&&e.maxQuantity!==void 0&&e.minQuantity>e.maxQuantity&&t.push("Minimum quantity cannot be greater than maximum quantity"),e.dateRange&&e.dateRange.start>e.dateRange.end&&t.push("Start date cannot be after end date"),e.searchQuery&&e.searchQuery.length>100&&t.push("Search query must be less than 100 characters"),{isValid:t.length===0,errors:t}}static validateSearchOptions(e){const t=[];e.limit!==void 0&&e.limit<1&&t.push("Limit must be greater than 0"),e.limit!==void 0&&e.limit>1e3&&t.push("Limit cannot exceed 1000"),e.offset!==void 0&&e.offset<0&&t.push("Offset must be non-negative");const r=["name","category","location","quantity","lastUpdated"];e.sortBy&&!r.includes(e.sortBy)&&t.push(`Invalid sort field. Must be one of: ${r.join(", ")}`);const n=["asc","desc"];return e.sortOrder&&!n.includes(e.sortOrder)&&t.push(`Invalid sort order. Must be one of: ${n.join(", ")}`),{isValid:t.length===0,errors:t}}}var Nh=Object.defineProperty,Fh=Object.defineProperties,zh=Object.getOwnPropertyDescriptors,xs=Object.getOwnPropertySymbols,Bh=Object.prototype.hasOwnProperty,qh=Object.prototype.propertyIsEnumerable,Hs=(i,e,t)=>e in i?Nh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,hr=(i,e)=>{for(var t in e||(e={}))Bh.call(e,t)&&Hs(i,t,e[t]);if(xs)for(var t of xs(e))qh.call(e,t)&&Hs(i,t,e[t]);return i},Gh=(i,e)=>Fh(i,zh(e));class Kh{constructor(e){this.adapterType=e}trackItemCreated(e,t,r){const n={properties:{itemId:e,itemName:t,category:r,adapterType:this.adapterType}};this.logEvent("inventory","item_created",`Inventory item created: ${t}`,"info",n.properties),this.trackUserAction("create_item","inventory",{itemId:e,itemName:t,category:r}),this.trackAnalyticsEvent("inventory_item_created",n.properties)}trackItemUpdated(e,t){const r={properties:{itemId:e,updates:t,adapterType:this.adapterType}};this.logEvent("inventory","item_updated",`Inventory item updated: ${e}`,"info",r.properties),this.trackUserAction("update_item","inventory",{itemId:e,updates:t}),this.trackAnalyticsEvent("inventory_item_updated",r.properties)}trackItemDeleted(e){const t={properties:{itemId:e,adapterType:this.adapterType}};this.logEvent("inventory","item_deleted",`Inventory item deleted: ${e}`,"info",t.properties),this.trackUserAction("delete_item","inventory",{itemId:e}),this.trackAnalyticsEvent("inventory_item_deleted",t.properties)}trackCategoryCreated(e){const t={properties:{category:e,adapterType:this.adapterType}};this.logEvent("inventory","category_created",`Category created: ${e}`,"info",t.properties),this.trackUserAction("create_category","inventory",{category:e}),this.trackAnalyticsEvent("inventory_category_created",t.properties)}trackCategoryDeleted(e){const t={properties:{category:e,adapterType:this.adapterType}};this.logEvent("inventory","category_deleted",`Category deleted: ${e}`,"info",t.properties),this.trackUserAction("delete_category","inventory",{category:e}),this.trackAnalyticsEvent("inventory_category_deleted",t.properties)}trackBulkOperation(e,t,r,n,s){const o={properties:hr({totalItems:t,successCount:r,errorCount:n,adapterType:this.adapterType},s)};this.logEvent("inventory",`bulk_${e}`,`Bulk ${e}: ${r} successful, ${n} failed`,"info",o.properties),this.trackUserAction(`bulk_${e}`,"inventory",hr({totalItems:t,successCount:r,errorCount:n},s)),this.trackAnalyticsEvent(`inventory_bulk_${e}`,o.properties)}trackSearch(e,t,r){const n={properties:{query:e,resultCount:t,filters:r,adapterType:this.adapterType}};this.logEvent("inventory","search_performed",`Search: "${e}" returned ${t} results`,"info",n.properties),this.trackUserAction("search_items","inventory",{query:e,resultCount:t,filters:r}),this.trackAnalyticsEvent("inventory_search",n.properties)}trackFilter(e,t){const r={properties:{filters:e,resultCount:t,adapterType:this.adapterType}};this.logEvent("inventory","filter_applied",`Filter applied, returned ${t} results`,"info",r.properties),this.trackUserAction("filter_items","inventory",{filters:e,resultCount:t}),this.trackAnalyticsEvent("inventory_filter",r.properties)}trackItemDuplicated(e,t){const r={properties:{originalItemId:e,newItemId:t,adapterType:this.adapterType}};this.logEvent("inventory","item_duplicated",`Item duplicated: ${e} -> ${t}`,"info",r.properties),this.trackUserAction("duplicate_item","inventory",{originalItemId:e,newItemId:t}),this.trackAnalyticsEvent("inventory_item_duplicated",r.properties)}trackItemArchived(e,t){const r={properties:{itemId:e,reason:t,adapterType:this.adapterType}};this.logEvent("inventory","item_archived",`Item archived: ${e}`,"info",r.properties),this.trackUserAction("archive_item","inventory",{itemId:e,reason:t}),this.trackAnalyticsEvent("inventory_item_archived",r.properties)}trackItemRestored(e){const t={properties:{itemId:e,adapterType:this.adapterType}};this.logEvent("inventory","item_restored",`Item restored: ${e}`,"info",t.properties),this.trackUserAction("restore_item","inventory",{itemId:e}),this.trackAnalyticsEvent("inventory_item_restored",t.properties)}trackCategoryMerged(e,t,r){const n={properties:{sourceCategory:e,targetCategory:t,itemsUpdated:r,adapterType:this.adapterType}};this.logEvent("inventory","category_merged",`Category merged: ${e} -> ${t}`,"info",n.properties),this.trackUserAction("merge_category","inventory",{sourceCategory:e,targetCategory:t,itemsUpdated:r}),this.trackAnalyticsEvent("inventory_category_merged",n.properties)}trackAdapterInitialized(e){const t={properties:{adapterType:e}};this.logEvent("inventory","adapter_initialized",`Adapter initialized: ${e}`,"info",t.properties),this.trackUserAction("initialize_adapter","inventory",{adapterType:e}),this.trackAnalyticsEvent("inventory_adapter_initialized",t.properties)}trackError(e,t,r){const n={properties:hr({operation:e,errorMessage:t.message,errorStack:t.stack,adapterType:this.adapterType},r)};this.logEvent("inventory","error_occurred",`Error in ${e}: ${t.message}`,"error",n.properties),this.trackUserAction("error_occurred","inventory",hr({operation:e,errorMessage:t.message},r)),this.trackAnalyticsEvent("inventory_error",n.properties)}trackPerformance(e,t,r){const n={properties:{operation:e,duration:t,itemCount:r,adapterType:this.adapterType}};this.logEvent("inventory","performance_metric",`${e} took ${t}ms`,"info",n.properties),this.trackUserAction("performance_metric","inventory",{operation:e,duration:t,itemCount:r}),this.trackAnalyticsEvent("inventory_performance",n.properties)}logEvent(e,t,r,n,s){V(e,t,r,n,s)}trackUserAction(e,t,r){j(e,t,r)}trackAnalyticsEvent(e,t){D(e,t)}createCustomEvent(e,t,r,n,s,o){return{eventType:e,category:t,action:r,label:n,value:s,properties:Gh(hr({},o),{adapterType:this.adapterType})}}trackCustomEvent(e){this.logEvent(e.category,e.action,e.label||e.action,"info",e.properties),this.trackUserAction(e.action,e.category,e.properties),this.trackAnalyticsEvent(e.eventType,e.properties)}}var J=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Wh{constructor(e,t){this.adapter=e,this.adapterType=t}getInventoryStats(){return J(this,null,function*(){return{data:yield L.handleOperation("getInventoryStats",()=>J(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={totalItems:t.length,categories:Array.from(new Set(t.map(s=>s.category))).length,locations:Array.from(new Set(t.map(s=>s.location))).length,activeItems:t.filter(s=>s.status==="active").length,maintenanceItems:t.filter(s=>s.status==="maintenance").length,inactiveItems:t.filter(s=>s.status==="inactive").length,retiredItems:t.filter(s=>s.status==="retired").length,archivedItems:t.filter(s=>s.status==="archived").length,lowStockItems:t.filter(s=>{const o=s.quantity||0,c=s.minimumStock||0;return o>0&&o<=c}).length,outOfStockItems:t.filter(s=>(s.quantity||0)===0).length,normalizedCategories:{tools:0,supplies:0,equipment:0,officeHardware:0},statusDistribution:{},categoryDistribution:{},locationDistribution:{},averageQuantity:0};t.forEach(s=>{const o=$e.normalizeCategory(s.category||"");r.normalizedCategories[o.toLowerCase().replace(" ","")]++}),t.forEach(s=>{const o=s.status||"unknown";r.statusDistribution[o]=(r.statusDistribution[o]||0)+1}),t.forEach(s=>{const o=s.category||"unknown";r.categoryDistribution[o]=(r.categoryDistribution[o]||0)+1}),t.forEach(s=>{const o=s.location||"unknown";r.locationDistribution[o]=(r.locationDistribution[o]||0)+1});const n=t.reduce((s,o)=>s+(o.quantity||0),0);return r.averageQuantity=t.length>0?n/t.length:0,r})),error:null}})}getCategoryStats(){return J(this,null,function*(){return{data:yield L.handleOperation("getCategoryStats",()=>J(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=$e.normalizeCategory(n.category||"");r[s]=(r[s]||0)+1}),r})),error:null}})}getStatusStats(){return J(this,null,function*(){return{data:yield L.handleOperation("getStatusStats",()=>J(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=n.status||"unknown";r[s]=(r[s]||0)+1}),r})),error:null}})}getLocationStats(){return J(this,null,function*(){return{data:yield L.handleOperation("getLocationStats",()=>J(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(n=>{const s=n.location||"unknown";r[s]=(r[s]||0)+1}),r})),error:null}})}getStockLevelStats(){return J(this,null,function*(){return{data:yield L.handleOperation("getStockLevelStats",()=>J(this,null,function*(){const t=yield this.adapter.fetchInventoryItems();let r=0,n=0,s=0,o=0;return t.forEach(c=>{const a=c.quantity||0,l=c.minimumStock||0,u=c.maximumStock||1/0;a===0?s++:a<=l?n++:a>=u?o++:r++}),{inStock:r,lowStock:n,outOfStock:s,overStock:o}})),error:null}})}getTrendingItems(e=10){return J(this,null,function*(){return{data:yield L.handleOperation("getTrendingItems",()=>J(this,null,function*(){const r=yield this.adapter.fetchInventoryItems(),n={};return r.forEach(o=>{n[o.id]=(n[o.id]||0)+1}),r.sort((o,c)=>new Date(c.lastUpdated||c.createdAt).getTime()-new Date(o.lastUpdated||o.createdAt).getTime()).slice(0,e).map(o=>({id:o.id,name:o.name||o.item||"Unknown",category:o.category||"Unknown",lastUpdated:o.lastUpdated||o.createdAt,updateCount:n[o.id]||1}))})),error:null}})}getCurrentAdapterType(){return this.adapterType}getAdapterMetadata(){return zt.getAdapterMetadata(this.adapterType)}getAvailableAdapters(){return zt.getAvailableAdapters()}getAdapterCapabilities(){const e=this.getAdapterMetadata();return(e==null?void 0:e.capabilities)||[]}supportsOperation(e){const t=this.getAdapterMetadata();return(t==null?void 0:t.supportedOperations.includes(e))||!1}getPerformanceMetrics(){return J(this,null,function*(){return{data:yield L.handleOperation("getPerformanceMetrics",()=>J(null,null,function*(){return{averageResponseTime:150,totalOperations:1e3,errorRate:.02,cacheHitRate:.85}})),error:null}})}getDataQualityMetrics(){return J(this,null,function*(){return{data:yield L.handleOperation("getDataQualityMetrics",()=>J(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r=[];let n=0,s=0;t.forEach(l=>{["name","category","status"].forEach(d=>{s++,l[d]?n++:r.push(`Missing ${d} for item ${l.id}`)}),l.quantity!==void 0&&l.minimumStock!==void 0&&(l.quantity<0&&r.push(`Negative quantity for item ${l.id}`),l.minimumStock<0&&r.push(`Negative minimum stock for item ${l.id}`))});const o=s>0?n/s:0,c=1-r.length/t.length,a=1-r.filter(l=>l.includes("consistency")).length/t.length;return{completeness:o,accuracy:Math.max(0,c),consistency:Math.max(0,a),issues:r}})),error:null}})}generateInventoryReport(){return J(this,null,function*(){return{data:yield L.handleOperation("generateInventoryReport",()=>J(this,null,function*(){const[t,r,n,s,o]=yield Promise.all([this.getInventoryStats(),this.getCategoryStats(),this.getStatusStats(),this.getLocationStats(),this.getStockLevelStats()]),c=[];return t.data&&(t.data.lowStockItems>0&&c.push(`Consider restocking ${t.data.lowStockItems} low stock items`),t.data.outOfStockItems>0&&c.push(`Urgent: ${t.data.outOfStockItems} items are out of stock`),t.data.archivedItems>t.data.totalItems*.1&&c.push("Consider cleaning up archived items")),{summary:t.data,categoryBreakdown:r.data||{},statusBreakdown:n.data||{},locationBreakdown:s.data||{},stockLevels:o.data||{inStock:0,lowStock:0,outOfStock:0,overStock:0},recommendations:c,generatedAt:new Date().toISOString()}})),error:null}})}}var K=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Zh{constructor(){this.currentAdapter=null,this.adapterType="static",this.initialized=!1,this.categoryProvider=null,this.itemCrudProvider=null,this.bulkOperationsProvider=null,this.searchFilterProvider=null,this.analyticsProvider=null,this.statsProvider=null}get isInitialized(){return this.initialized}initialize(e,t){return K(this,null,function*(){this.initialized||(this.currentAdapter=e,this.adapterType=t,typeof this.currentAdapter.initialize=="function"&&(yield this.currentAdapter.initialize()),this.categoryProvider=new $e(e,t),this.itemCrudProvider=new $h(e,t),this.bulkOperationsProvider=new jh(e,t),this.searchFilterProvider=new Uh(e),this.analyticsProvider=new Kh(t),this.statsProvider=new Wh(e,t),this.initialized=!0,console.info("[InventoryRepository] Initialized successfully."))})}getAdapter(){if(!this.initialized||!this.currentAdapter)throw new Error("Inventory repository not initialized. Must call initialize() first.");return this.currentAdapter}fetchInventoryItems(){return K(this,null,function*(){return this.itemCrudProvider.fetchInventoryItems()})}fetchAllInventoryData(){return K(this,null,function*(){return yield L.handleOperation("fetchAllInventoryData",()=>K(this,null,function*(){const r=yield this.getAdapter().fetchAllInventoryData(),n=r.data||[],s=Ph(n),o=Th(s),c=new Set,a=new Set;[o.tools,o.supplies,o.equipment,o.officeHardware].forEach(u=>{u.forEach(d=>{c.has(d.id)&&a.add(d.id),c.add(d.id)})}),a.size>0&&console.warn(`Found ${a.size} duplicate item IDs:`,Array.from(a));const l=Array.from(new Set(s.map(u=>u.category).filter(Boolean)));return{tools:o.tools,supplies:o.supplies,equipment:o.equipment,officeHardware:o.officeHardware,categories:l,isLoading:!1,error:r.error}}))})}getItemById(e){return K(this,null,function*(){return this.itemCrudProvider.getItemById(e)})}createItem(e){return K(this,null,function*(){return this.itemCrudProvider.createItem(e)})}updateItem(e,t){return K(this,null,function*(){return this.itemCrudProvider.updateItem(e,t)})}deleteItem(e){return K(this,null,function*(){return this.itemCrudProvider.deleteItem(e)})}addInventoryItem(e){return K(this,null,function*(){return this.itemCrudProvider.addInventoryItem(e)})}addCategory(e){return K(this,null,function*(){return this.categoryProvider.addCategory(e)})}deleteCategory(e){return K(this,null,function*(){return this.categoryProvider.deleteCategory(e)})}bulkCreateItems(e){return K(this,null,function*(){return this.bulkOperationsProvider.bulkCreateItems(e)})}bulkUpdateItems(e){return K(this,null,function*(){return this.bulkOperationsProvider.bulkUpdateItems(e)})}bulkDeleteItems(e){return K(this,null,function*(){return this.bulkOperationsProvider.bulkDeleteItems(e)})}searchItems(e){return K(this,null,function*(){return this.searchFilterProvider.searchItems(e)})}getFilteredItems(e){return K(this,null,function*(){return this.searchFilterProvider.getFilteredItems(e)})}getCategories(){return K(this,null,function*(){return this.categoryProvider.getCategories()})}getLocations(){return K(this,null,function*(){return this.searchFilterProvider.getLocations()})}getInventoryStats(){return K(this,null,function*(){return this.statsProvider.getInventoryStats()})}getCurrentAdapterType(){return this.statsProvider.getCurrentAdapterType()}getAdapterMetadata(){return this.statsProvider.getAdapterMetadata()}getAvailableAdapters(){return this.statsProvider.getAvailableAdapters()}}class Qh{constructor(){this.cache={data:null,timestamp:0,ttl:300*1e3,hits:0,misses:0,evictions:0}}get(){return this.cache.data&&Date.now()-this.cache.timestamp<this.cache.ttl?(this.cache.hits++,this.cache.data):(this.cache.misses++,null)}set(e){this.cache.data=e,this.cache.timestamp=Date.now()}clear(){this.cache.data&&this.cache.evictions++,this.cache.data=null,this.cache.timestamp=0}getStats(){return{hits:this.cache.hits,misses:this.cache.misses,size:this.cache.data?JSON.stringify(this.cache.data).length:0,lastUpdated:new Date(this.cache.timestamp).toISOString(),updated_at:new Date(this.cache.timestamp).toISOString()}}isValid(){return!!(this.cache.data&&Date.now()-this.cache.timestamp<this.cache.ttl)}}const Yh={realtime:{get enabled(){return kr()}}};var Jh=Object.defineProperty,Xh=Object.defineProperties,e1=Object.getOwnPropertyDescriptors,Ds=Object.getOwnPropertySymbols,t1=Object.prototype.hasOwnProperty,r1=Object.prototype.propertyIsEnumerable,Rs=(i,e,t)=>e in i?Jh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Vs=(i,e)=>{for(var t in e||(e={}))t1.call(e,t)&&Rs(i,t,e[t]);if(Ds)for(var t of Ds(e))r1.call(e,t)&&Rs(i,t,e[t]);return i},$s=(i,e)=>Xh(i,e1(e)),ke=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Xt{constructor(){this.isConnected=!1,this.connectionTestPromise=null}static getInstance(){return Xt.instance||(Xt.instance=new Xt),Xt.instance}testConnection(){return ke(this,null,function*(){return this.connectionTestPromise?this.connectionTestPromise:(this.connectionTestPromise=this.performConnectionTest(),this.connectionTestPromise)})}performConnectionTest(){return ke(this,null,function*(){if(!kr())return console.warn("Supabase not configured, connection test skipped"),!1;try{const{error:e}=yield _.from("inventory_items").select("count").limit(1);return e?(console.error(" Supabase connection test failed:",e),this.isConnected=!1,!1):(this.isConnected=!0,!0)}catch(e){return console.error(" Supabase connection test error:",e),this.isConnected=!1,!1}})}getAnalytics(){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");return ne.getAnalytics()})}getCategories(){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{data:t,error:r}=yield _.from("inventory_items").select("category").not("category","is",null);if(r)throw new Error(`Failed to fetch categories: ${r.message}`);return Array.from(new Set((t==null?void 0:t.map(s=>s.category).filter(Boolean))||[]))}catch(t){throw console.error(" Error fetching categories:",t),t}})}getLocations(){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{error:t}=yield _.from("inventory_items").select("location").not("location","is",null);if(t)throw new Error(`Failed to fetch locations: ${t.message}`);return[]}catch(t){throw console.error(" Error fetching locations:",t),t}})}getItems(e){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{let r=_.from("inventory_items").select("*",{count:"exact"});e!=null&&e.category&&(r=r.eq("category",e.category)),e!=null&&e.limit&&(r=r.limit(e.limit)),e!=null&&e.offset&&(r=r.range(e.offset,e.offset+(e.limit||10)-1));const{data:n,error:s,count:o}=yield r;if(s)throw new Error(`Failed to fetch items: ${s.message}`);return{data:n||[],count:o||0,error:null}}catch(r){return console.error(" Error fetching items:",r),{data:[],count:0,error:r instanceof Error?r.message:"Unknown error"}}})}subscribeToChanges(e){if(!Yh.realtime.enabled)return()=>{};try{return xa.subscribe("inventory_items",e,{event:"*"})}catch(t){return console.error(" Failed to set up real-time subscription:",t),()=>{}}}resetConnectionTest(){this.connectionTestPromise=null,this.isConnected=!1}getConnectionStatus(){return{isConnected:this.isConnected,isConfigured:kr()}}getItemById(e){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{data:r,error:n}=yield _.from("inventory_items").select("*").eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw new Error(`Failed to fetch item: ${n.message}`)}return r}catch(r){throw console.error(" Error fetching item by ID:",r),r}})}createItem(e){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const r=$s(Vs({},e),{data:e.data}),{data:n,error:s}=yield _.from("inventory_items").insert(r).select().single();if(s)throw new Error(`Failed to create item: ${s.message}`);return n}catch(r){throw console.error(" Error creating item:",r),r}})}updateItem(e,t){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const n=$s(Vs({},t),{data:t.data}),{data:s,error:o}=yield _.from("inventory_items").update(n).eq("id",e).select().single();if(o)throw new Error(`Failed to update item: ${o.message}`);return s}catch(n){throw console.error(" Error updating item:",n),n}})}deleteItem(e){return ke(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{error:r}=yield _.from("inventory_items").delete().eq("id",e);if(r)throw new Error(`Failed to delete item: ${r.message}`)}catch(r){throw console.error(" Error deleting item:",r),r}})}}const n1=Xt.getInstance();var O=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const za=class ye{constructor(){this.cacheManager=new Qh,this.repository=new Zh,this.adapterManager=new hd,this.isInitialized=!1,this.initializationPromise=null,this.categoryService=new $a,this.filterService=new ja,this.statusService=new Ua,X.isRegistered("inventory_service")||X.registerCacheManager("inventory_service",this)}static getInstance(){return ye.instance||(ye.instance=new ye),ye.instance}getInstanceId(){return`instance_${this===ye.instance?"SINGLETON":"NEW"}`}initialize(){return O(this,null,function*(){const e=performance.now();if(!this.isInitialized){if(this.initializationPromise){yield this.initializationPromise;return}this.initializationPromise=O(this,null,function*(){try{yield this.adapterManager.initialize(),yield this.repository.initialize(this.adapterManager.getAdapter(),this.adapterManager.getCurrentAdapterType()),this.isInitialized=!0;const t=performance.now()-e;rn.recordResponseTime("inventory_service_initialization",t,{service:"InventoryServiceFacade",operation:"initialize"})}finally{this.initializationPromise=null}}),yield this.initializationPromise}})}isReady(){return this.isInitialized}fetchInventoryItems(){return O(this,null,function*(){return yield this.repository.fetchInventoryItems()})}fetchAllInventoryData(){return O(this,null,function*(){var e,t,r,n;const s=performance.now(),o=this.cacheManager.get();if(o)return o;this.repository.isInitialized||(console.warn(`[InventoryServiceFacade] Repository not initialized (facade.isInitialized: ${this.isInitialized})  auto-initializing now.`),yield this.initialize());const c=yield this.repository.fetchAllInventoryData(),a=performance.now()-s;return rn.recordDataFetch("fetchAllInventoryData",a,!c.error,{service:"InventoryServiceFacade",operation:"fetchAllInventoryData",toolsCount:String(((e=c.tools)==null?void 0:e.length)||0),suppliesCount:String(((t=c.supplies)==null?void 0:t.length)||0),equipmentCount:String(((r=c.equipment)==null?void 0:r.length)||0),officeHardwareCount:String(((n=c.officeHardware)==null?void 0:n.length)||0)}),this.cacheManager.set(c),c})}getAllItems(){return O(this,null,function*(){this.repository.isInitialized||(console.warn(`[InventoryServiceFacade] Repository not initialized (facade.isInitialized: ${this.isInitialized})  auto-initializing now.`),yield this.initialize());const e=yield this.fetchAllInventoryData(),t=[...e.tools,...e.supplies,...e.equipment,...e.officeHardware];return{data:t,count:t.length,error:e.error}})}getItemById(e){return O(this,null,function*(){return yield this.repository.getItemById(e)})}createItem(e){return O(this,null,function*(){return yield this.repository.createItem(e)})}updateItem(e,t){return O(this,null,function*(){return yield this.repository.updateItem(e,t)})}deleteItem(e){return O(this,null,function*(){return yield this.repository.deleteItem(e)})}addInventoryItem(e){return O(this,null,function*(){return yield this.repository.addInventoryItem(e)})}addCategory(e){return O(this,null,function*(){return yield this.repository.addCategory(e)})}deleteCategory(e){return O(this,null,function*(){return yield this.repository.deleteCategory(e)})}bulkCreateItems(e){return O(this,null,function*(){return yield this.repository.bulkCreateItems(e)})}bulkUpdateItems(e){return O(this,null,function*(){return yield this.repository.bulkUpdateItems(e)})}bulkDeleteItems(e){return O(this,null,function*(){return yield this.repository.bulkDeleteItems(e)})}searchItems(e){return O(this,null,function*(){return yield this.repository.searchItems(e)})}getFilteredItems(e){return O(this,null,function*(){return yield this.repository.getFilteredItems(e)})}getCategories(){return O(this,null,function*(){return yield this.repository.getCategories()})}getLocations(){return O(this,null,function*(){return yield this.repository.getLocations()})}getInventoryStats(){return O(this,null,function*(){return yield this.repository.getInventoryStats()})}refresh(){return O(this,null,function*(){try{return yield this.refreshData(),{success:!0,error:null}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}})}validateItem(e){return O(this,null,function*(){const t=[];return e.name||t.push("Item name is required"),e.category||t.push("Category is required"),e.location||t.push("Location is required"),e.quantity!==void 0&&e.quantity!==null&&e.quantity<0&&t.push("Quantity cannot be negative"),e.unit_cost!==void 0&&e.unit_cost!==null&&e.unit_cost<0&&t.push("Cost cannot be negative"),{isValid:t.length===0,errors:t}})}getItemHistory(){return O(this,null,function*(){return[]})}subscribeToChanges(){try{return n1.subscribeToChanges(e=>{this.clearCache(),D("inventory_realtime_update",{source:"facade",payload_type:typeof e,adapter_type:this.adapterManager.getCurrentAdapterType()})})}catch(e){return console.error(" Failed to set up real-time subscription in InventoryServiceFacade:",e),()=>{}}}updateInventoryItem(e,t){return O(this,null,function*(){const r=yield this.updateItem(e,t);if(!r.data)throw new Error("Failed to update inventory item");return r.data})}deleteInventoryItem(e){return O(this,null,function*(){yield this.deleteItem(e)})}getFilteredData(e,t,r,n,s){let o=e;if(t.query.trim()){const c=t.caseSensitive?t.query:t.query.toLowerCase(),a=t.fields||["name","category","location","description"];o=o.filter(l=>a.some(u=>{const d=l[u];return d?(t.caseSensitive?d.toString():d.toString().toLowerCase()).includes(c):!1}))}if(r&&(o=o.filter(c=>{var a;return!(r.category&&c.category!==r.category||r.status&&c.status!==r.status||r.location&&c.location!==r.location||r.minQuantity!==void 0&&(c.quantity||0)<r.minQuantity||r.maxQuantity!==void 0&&(c.quantity||0)>r.maxQuantity||r.isActive!==void 0&&((a=c.data)==null?void 0:a.isActive)!==r.isActive)})),s&&o.sort((c,a)=>{const l=c[s.field],u=a[s.field];return s.direction==="asc"?String(l)<String(u)?-1:String(l)>String(u)?1:0:String(l)>String(u)?-1:String(l)<String(u)?1:0}),n){const c=(n.page-1)*n.limit,a=c+n.limit;o=o.slice(c,a)}return o}clearCache(){this.cacheManager.clear()}refreshData(){return O(this,null,function*(){this.clearCache();const e=yield this.fetchAllInventoryData();return{data:[...e.tools,...e.supplies,...e.equipment,...e.officeHardware],error:e.error}})}getCurrentAdapterType(){return this.adapterManager.getCurrentAdapterType()}getAdapterMetadata(){return this.adapterManager.getAdapterMetadata()}getAvailableAdapters(){return this.adapterManager.getAvailableAdapters()}getCacheStats(){return this.cacheManager.getStats()}getErrorStats(){return{totalErrors:0,lastError:null,errorRate:0}}switchAdapter(e){return O(this,null,function*(){try{return yield this.initialize(),{success:!0,data:e}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}})}getItemId(e){var t;return e.id||((t=e.data)!=null&&t.barcode&&typeof e.data.barcode=="string"?e.data.barcode:"")||""}getItemStatus(e){return Xn(e)||"Unknown"}static initialize(){return O(this,null,function*(){return ye.getInstance().initialize()})}static getItemById(e){return O(this,null,function*(){return ye.getInstance().getItemById(e)})}static createItem(e){return O(this,null,function*(){return ye.getInstance().createItem(e)})}static updateItem(e,t){return O(this,null,function*(){return ye.getInstance().updateItem(e,t)})}static deleteItem(e){return O(this,null,function*(){return ye.getInstance().deleteItem(e)})}static getAllItems(){return O(this,null,function*(){return ye.getInstance().getAllItems()})}};za.instance=null;let tr=za;const i1=tr.getInstance(),qg=Object.freeze(Object.defineProperty({__proto__:null,InventoryCategoryService:$a,InventoryFilterService:ja,InventoryServiceFacade:tr,InventoryServiceFacadeImpl:tr,InventoryStatusService:Ua,inventoryServiceFacade:i1},Symbol.toStringTag,{value:"Module"}));var xt=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class s1{static importItems(e){return xt(this,arguments,function*(t,r={format:"csv",hasHeaders:!0}){try{const n=yield this.readFileContent(t),s=yield this.parseContent(n,r),o=yield this.validateItems(s),c=yield this.processImport(o.validItems,r);return{success:c.success,importedCount:c.importedCount,failedCount:o.invalidItems.length,skippedCount:c.skippedCount,errors:[...o.errors,...c.errors],warnings:o.warnings,fileName:t.name}}catch(n){return console.error("Import failed:",n),{success:!1,importedCount:0,failedCount:0,skippedCount:0,errors:[`Import failed: ${n instanceof Error?n.message:"Unknown error"}`],warnings:[],fileName:t.name}}})}static readFileContent(e){return xt(this,null,function*(){return new Promise((t,r)=>{const n=new FileReader;n.onload=s=>{var o;return t((o=s.target)==null?void 0:o.result)},n.onerror=()=>r(new Error("Failed to read file")),n.readAsText(e)})})}static parseContent(e,t){return xt(this,null,function*(){switch(t.format){case"csv":return this.parseCSV(e,t);case"json":return this.parseJSON(e);default:throw new Error(`Unsupported import format: ${t.format}`)}})}static parseCSV(e,t){const r=e.split(`
`).filter(o=>o.trim()),n=[];let s=0;t.hasHeaders&&(s=1);for(let o=s;o<r.length;o++){const c=r[o],a=this.parseCSVLine(c);if(a.length>0){const l=this.createItemFromCSVValues(a,t);l&&n.push(l)}}return n}static parseCSVLine(e){const t=[];let r="",n=!1;for(let s=0;s<e.length;s++){const o=e[s];o==='"'?n&&e[s+1]==='"'?(r+='"',s++):n=!n:o===","&&!n?(t.push(r.trim()),r=""):r+=o}return t.push(r.trim()),t}static createItemFromCSVValues(e,t){if(e.length<3)return null;const r=["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"],n=t.customFieldMapping?Object.values(t.customFieldMapping):r,s={};for(let o=0;o<Math.min(n.length,e.length);o++){const c=n[o],a=e[o];a&&a.trim()&&(s[c]=this.parseFieldValue(a,c))}return s}static parseJSON(e){try{const t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch(t){throw console.error(t),new Error("Invalid JSON format")}}static parseFieldValue(e,t){if(t==="quantity"||t==="cost"){const r=parseFloat(e);return isNaN(r)?0:r}if(t==="purchaseDate"||t==="lastUpdated"){const r=new Date(e);return isNaN(r.getTime())?null:r}return e}static validateItems(e){return xt(this,null,function*(){var t,r,n,s,o,c,a,l,u;const d=[],h=[],p=[],m=[];for(const v of e){const b=[];if((t=v.item)!=null&&t.trim()||b.push("Item name is required"),(r=v.category)!=null&&r.trim()||b.push("Category is required"),(n=v.location)!=null&&n.trim()||b.push("Location is required"),v.quantity!==void 0&&(isNaN(Number(v.quantity))||Number(v.quantity)<0)&&b.push("Quantity must be a positive number"),v.unit_cost!==void 0&&(isNaN(Number(v.unit_cost))||Number(v.unit_cost)<0)&&b.push("Cost must be a positive number"),b.length>0)h.push({item:v,errors:b});else{const S={id:v.id||this.generateId(),name:v.item,item:v.item,category:v.category,location:v.location,status:v.status||"active",quantity:v.quantity||1,unit_cost:v.unit_cost||0,facility_id:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:0,expiration_date:null,data:{vendor:v.vendor||"",purchaseDate:((s=v.data)==null?void 0:s.purchaseDate)||new Date().toISOString(),warranty:((o=v.data)==null?void 0:o.warranty)||"",maintenanceSchedule:v.maintenanceSchedule||"",lastServiced:((c=v.data)==null?void 0:c.lastServiced)||void 0,nextDue:v.nextDue||void 0,serviceProvider:((a=v.data)==null?void 0:a.serviceProvider)||"",assignedTo:((l=v.data)==null?void 0:l.assignedTo)||"",notes:((u=v.data)==null?void 0:u.notes)||""}};d.push(S)}}return{isValid:h.length===0,errors:p,warnings:m,validItems:d,invalidItems:h}})}static processImport(e,t){return xt(this,null,function*(){var r,n,s,o,c,a,l,u,d,h,p,m,v,b;const S=[];let C=0,w=0;for(const y of e)try{if(t.duplicateHandling&&t.duplicateHandling!=="create"){const A=yield this.checkForDuplicate(y);if(A){if(t.duplicateHandling==="skip"){w++;continue}else if(t.duplicateHandling==="update"){yield tr.updateItem(A.id,{item:y.item,category:y.category,location:y.location,status:y.status,quantity:y.quantity,unit_cost:y.unit_cost,vendor:y.vendor,purchaseDate:(r=y.data)==null?void 0:r.purchaseDate,warranty:(n=y.data)==null?void 0:n.warranty,maintenanceSchedule:y.maintenanceSchedule,lastServiced:(s=y.data)==null?void 0:s.lastServiced,nextDue:(o=y.data)==null?void 0:o.nextDue,serviceProvider:(c=y.data)==null?void 0:c.serviceProvider,assignedTo:(a=y.data)==null?void 0:a.assignedTo,notes:(l=y.data)==null?void 0:l.notes,lastUpdated:new Date().toISOString()}),C++;continue}}}yield tr.createItem({name:y.item||"",category:y.category,location:y.location,status:y.status,quantity:y.quantity,unit_cost:y.unit_cost,facility_id:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:0,expiration_date:null,data:{vendor:y.vendor,purchaseDate:(u=y.data)==null?void 0:u.purchaseDate,warranty:(d=y.data)==null?void 0:d.warranty,maintenanceSchedule:y.maintenanceSchedule,lastServiced:(h=y.data)==null?void 0:h.lastServiced,nextDue:(p=y.data)==null?void 0:p.nextDue,serviceProvider:(m=y.data)==null?void 0:m.serviceProvider,assignedTo:(v=y.data)==null?void 0:v.assignedTo,notes:(b=y.data)==null?void 0:b.notes}}),C++}catch(A){S.push(`Failed to import ${y.item}: ${A instanceof Error?A.message:"Unknown error"}`)}return{success:S.length===0,importedCount:C,skippedCount:w,errors:S}})}static checkForDuplicate(e){return xt(this,null,function*(){try{return(yield tr.getAllItems()).find(n=>{var s,o,c,a;return((s=n.item)==null?void 0:s.toLowerCase())===((o=e.item)==null?void 0:o.toLowerCase())&&((c=n.category)==null?void 0:c.toLowerCase())===((a=e.category)==null?void 0:a.toLowerCase())})||null}catch(t){return console.error("Error checking for duplicates:",t),null}})}static generateId(){return`import-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static validateImportOptions(e){const t=[];return(!e.format||!["csv","json"].includes(e.format))&&t.push("Invalid import format. Must be csv or json."),e.duplicateHandling&&!["skip","update","create"].includes(e.duplicateHandling)&&t.push("Invalid duplicate handling option. Must be skip, update, or create."),{isValid:t.length===0,errors:t}}}class re{static initializeMetrics(e,t){const r={startTime:Date.now(),totalItems:t.totalItems,processedItems:0,failedItems:0,averageProcessingTime:0,peakMemoryUsage:0,averageMemoryUsage:0,processingRate:0,cacheHitRate:0,concurrentWorkers:t.maxConcurrentWorkers};return this.performanceMetrics.set(e,r),r}static updateMetrics(e,t){const r=this.performanceMetrics.get(e);r&&(Object.assign(r,t),this.performanceMetrics.set(e,r))}static finalizeMetrics(e){const t=this.performanceMetrics.get(e);return t&&(t.endTime=Date.now(),t.averageProcessingTime=t.processedItems>0?(t.endTime-t.startTime)/t.processedItems:0,t.peakMemoryUsage=Math.max(...this.memoryUsageHistory),t.averageMemoryUsage=this.memoryUsageHistory.length>0?this.memoryUsageHistory.reduce((r,n)=>r+n,0)/this.memoryUsageHistory.length:0,t.processingRate=this.calculateProcessingRate(t.startTime,t.processedItems),t.cacheHitRate=this.calculateCacheHitRate(),this.performanceMetrics.set(e,t)),t}static getPerformanceMetrics(e){return this.performanceMetrics.get(e)}static getAllPerformanceMetrics(){return Array.from(this.performanceMetrics.values())}static clearPerformanceMetrics(){this.performanceMetrics.clear()}static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory,t=(e==null?void 0:e.usedJSHeapSize)||0;return this.memoryUsageHistory.push(t),t}return 0}static calculateProcessingRate(e,t){if(t===0)return 0;const r=(Date.now()-e)/1e3;return Math.round(t/r)}static calculateCacheHitRate(){return 0}static calculateEstimatedTime(e,t,r){if(t===0)return;const n=Date.now()-e,s=t/n,o=r-t;return Math.round(o/s)}static clearMemoryHistory(){this.memoryUsageHistory=[]}static generateOperationId(){return`bulk-op-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}re.performanceMetrics=new Map;re.memoryUsageHistory=[];class er{static initializeCache(e=this.DEFAULT_CACHE_SIZE){this.operationCache.clear();const t=this.operationCache.set.bind(this.operationCache);this.operationCache.set=(r,n)=>{if(this.operationCache.size>=e){const s=this.operationCache.keys().next().value;s&&this.operationCache.delete(s)}return t(r,n)}}static getCachedResult(e){return this.operationCache.get(e)}static hasCachedResult(e){return this.operationCache.has(e)}static cacheResult(e,t){this.operationCache.set(e,t)}static getCacheStats(){return{size:this.operationCache.size,hitRate:this.calculateCacheHitRate()}}static clearCache(){this.operationCache.clear()}static calculateCacheHitRate(){return 0}}er.operationCache=new Map;er.DEFAULT_CACHE_SIZE=1e3;var kn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Jr{static createWorkerPool(e=this.DEFAULT_MAX_WORKERS){return Array.from({length:e},()=>()=>kn(this,null,function*(){return Promise.resolve()}))}static cleanupWorkerPool(e){e.length=0}static processBatchConcurrent(e,t,r,n,s){return kn(this,null,function*(){const o=e.map(l=>kn(null,null,function*(){var u,d;try{const h=yield t(l);return(u=s.onSuccess)==null||u.call(s,h,l),h}catch(h){const p=h instanceof Error?h.message:"Unknown error";throw(d=s.onError)==null||d.call(s,p,l),h}})),c=Math.min(r.length,o.length),a=this.chunkArray(o,c);for(const l of a)yield Promise.allSettled(l)})}static chunkArray(e,t){const r=[];for(let n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}}Jr.DEFAULT_MAX_WORKERS=4;var a1=Object.defineProperty,o1=Object.defineProperties,c1=Object.getOwnPropertyDescriptors,js=Object.getOwnPropertySymbols,l1=Object.prototype.hasOwnProperty,u1=Object.prototype.propertyIsEnumerable,Us=(i,e,t)=>e in i?a1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,d1=(i,e)=>{for(var t in e||(e={}))l1.call(e,t)&&Us(i,t,e[t]);if(js)for(var t of js(e))u1.call(e,t)&&Us(i,t,e[t]);return i},h1=(i,e)=>o1(i,c1(e));class ct{static createProgress(e,t,r,n,s,o,c,a){const l=re.getMemoryUsage(),u=re.calculateProcessingRate(c,t),d=re.calculateEstimatedTime(c,t,e);return{total:e,completed:t,failed:r,inProgress:n,percentage:Math.round(t/e*100),currentBatch:s,totalBatches:o,estimatedTimeRemaining:d,errors:[],memoryUsage:l,processingRate:u,concurrentWorkers:a}}static updateProgressWithErrors(e,t){return h1(d1({},e),{errors:t.slice(-10)})}static notifyProgress(e,t){e==null||e(t)}static notifyError(e,t,r){e==null||e(t,r)}static notifySuccess(e,t,r){e==null||e(t,r)}static notifyMemoryWarning(e,t,r){e==null||e(t,r)}static isMemoryUsageHigh(e,t,r=.8){return e>t*r}}var f1=Object.defineProperty,p1=Object.defineProperties,g1=Object.getOwnPropertyDescriptors,Ns=Object.getOwnPropertySymbols,m1=Object.prototype.hasOwnProperty,y1=Object.prototype.propertyIsEnumerable,Fs=(i,e,t)=>e in i?f1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$t=(i,e)=>{for(var t in e||(e={}))m1.call(e,t)&&Fs(i,t,e[t]);if(Ns)for(var t of Ns(e))y1.call(e,t)&&Fs(i,t,e[t]);return i},jt=(i,e)=>p1(i,g1(e));const Ut={QUICK:{maxRetries:1,baseDelay:100,maxDelay:200,backoffStrategy:"fixed"},STANDARD:{maxRetries:3,baseDelay:100,maxDelay:1e3,backoffStrategy:"linear"},NETWORK:{maxRetries:5,baseDelay:200,maxDelay:2e3,backoffStrategy:"exponential"},CRITICAL:{maxRetries:5,baseDelay:500,maxDelay:5e3,backoffStrategy:"exponential"},BACKGROUND:{maxRetries:2,baseDelay:1e3,maxDelay:5e3,backoffStrategy:"linear"}},Ze={NETWORK_ONLY:i=>{const e=i.message.toLowerCase();return e.includes("network")||e.includes("timeout")||e.includes("fetch")||e.includes("connection")},TEMPORARY_ONLY:i=>{const e=i.message.toLowerCase();return e.includes("rate limit")||e.includes("temporary")||e.includes("busy")||e.includes("unavailable")},NETWORK_AND_TEMPORARY:i=>Ze.NETWORK_ONLY(i)||Ze.TEMPORARY_ONLY(i),ALL:()=>!0,NONE:()=>!1},fr={UI_OPERATION:jt($t({},Ut.QUICK),{retryCondition:Ze.NETWORK_ONLY}),DATA_FETCH:jt($t({},Ut.STANDARD),{retryCondition:Ze.NETWORK_AND_TEMPORARY}),API_CALL:jt($t({},Ut.NETWORK),{retryCondition:Ze.NETWORK_AND_TEMPORARY}),AUTH:jt($t({},Ut.CRITICAL),{retryCondition:Ze.NETWORK_AND_TEMPORARY}),BACKGROUND_TASK:jt($t({},Ut.BACKGROUND),{retryCondition:Ze.ALL})};jt($t({},Ut.BACKGROUND),{retryCondition:Ze.NETWORK_AND_TEMPORARY,syncInterval:3e4,maxConcurrentSyncs:3});var v1=Object.defineProperty,zs=Object.getOwnPropertySymbols,_1=Object.prototype.hasOwnProperty,w1=Object.prototype.propertyIsEnumerable,Bs=(i,e,t)=>e in i?v1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qs=(i,e)=>{for(var t in e||(e={}))_1.call(e,t)&&Bs(i,t,e[t]);if(zs)for(var t of zs(e))w1.call(e,t)&&Bs(i,t,e[t]);return i},Ht=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Je{static executeWithRetry(e){return Ht(this,arguments,function*(t,r={}){const n=performance.now(),s=qs(qs({},this.DEFAULT_CONFIG),r);let o,c=0;for(let l=0;l<=s.maxRetries;l++){c=l+1;try{const u=yield t(),d=performance.now()-n;return rn.recordResponseTime("retry_operation_success",d,{service:"OptimizedRetryService",operation:"executeWithRetry",attempts:c.toString(),strategy:s.backoffStrategy}),{success:!0,data:u,attempts:c,totalDuration:d}}catch(u){if(o=u,l===s.maxRetries||s.retryCondition&&!s.retryCondition(o))break;const d=this.calculateDelay(l,s),h=s.jitter?d+Math.random()*100:d;console.warn(`[OptimizedRetryService] Operation failed (attempt ${c}/${s.maxRetries+1}): ${o.message}. Retrying in ${h.toFixed(0)}ms...`),yield this.sleep(h)}}const a=performance.now()-n;return rn.recordErrorRate("retry_operation_failure",100,{service:"OptimizedRetryService",operation:"executeWithRetry",attempts:c.toString(),strategy:s.backoffStrategy,error:o.message}),{success:!1,error:o,attempts:c,totalDuration:a}})}static calculateDelay(e,t){let r;switch(t.backoffStrategy){case"linear":r=t.baseDelay*(e+1);break;case"exponential":r=t.baseDelay*Math.pow(2,e);break;case"fixed":r=t.baseDelay;break;default:r=t.baseDelay}return Math.min(r,t.maxDelay)}static sleep(e){return new Promise(t=>setTimeout(t,e))}static quickRetry(e){return Ht(this,null,function*(){const t=yield this.executeWithRetry(e,fr.UI_OPERATION);if(!t.success)throw t.error;return t.data})}static standardRetry(e){return Ht(this,null,function*(){const t=yield this.executeWithRetry(e,fr.DATA_FETCH);if(!t.success)throw t.error;return t.data})}static networkRetry(e){return Ht(this,null,function*(){const t=yield this.executeWithRetry(e,fr.API_CALL);if(!t.success)throw t.error;return t.data})}static authRetry(e){return Ht(this,null,function*(){const t=yield this.executeWithRetry(e,fr.AUTH);if(!t.success)throw t.error;return t.data})}static backgroundRetry(e){return Ht(this,null,function*(){const t=yield this.executeWithRetry(e,fr.BACKGROUND_TASK);if(!t.success)throw t.error;return t.data})}}Je.DEFAULT_CONFIG={maxRetries:3,baseDelay:100,maxDelay:1e3,backoffStrategy:"linear",jitter:!0};const b1=Je.quickRetry,C1=Je.standardRetry,S1=Je.networkRetry,A1=Je.authRetry,I1=Je.backgroundRetry,Gg=Object.freeze(Object.defineProperty({__proto__:null,OptimizedRetryService:Je,authRetry:A1,backgroundRetry:I1,networkRetry:S1,quickRetry:b1,standardRetry:C1},Symbol.toStringTag,{value:"Module"}));var Ln=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Gs{static withRetry(e,t=3,r=100,n){return Ln(this,null,function*(){const s=yield Je.executeWithRetry(e,{maxRetries:t,baseDelay:r,backoffStrategy:"linear",retryCondition:o=>(n==null||n(s.attempts,o),!0)});if(!s.success)throw s.error;return s.data})}static delay(e){return new Promise(t=>setTimeout(t,e))}static processItemsWithRetry(e,t){return Ln(this,arguments,function*(r,n,s={}){const{maxRetries:o=3,delay:c=1e3,enableRetry:a=!0}=s,l=[],u=[],d=[],h=r.map((p,m)=>Ln(this,null,function*(){try{let v;return a?v=yield this.withRetry(()=>n(p),o,c,(b,S)=>{console.warn(`Retrying item ${m+1} (attempt ${b}): ${S.message}`)}):v=yield n(p),l.push(v),{success:!0,result:v,item:p}}catch(v){const b=v instanceof Error?v.message:"Unknown error";return d.push(`Item ${m+1}: ${b}`),u.push(p),{success:!1,error:b,item:p}}}));return yield Promise.allSettled(h),{results:l,failed:u,errors:d}})}}class Kr{static validateConfig(e){const t=[];return e.batchSize!==void 0&&(e.batchSize<1||e.batchSize>1e3)&&t.push("Batch size must be between 1 and 1000"),e.delayBetweenBatches!==void 0&&e.delayBetweenBatches<0&&t.push("Delay between batches must be non-negative"),e.maxConcurrentWorkers!==void 0&&(e.maxConcurrentWorkers<1||e.maxConcurrentWorkers>16)&&t.push("Max concurrent workers must be between 1 and 16"),e.cacheSize!==void 0&&(e.cacheSize<1||e.cacheSize>1e4)&&t.push("Cache size must be between 1 and 10000"),e.memoryLimit!==void 0&&e.memoryLimit<1024*1024&&t.push("Memory limit must be at least 1MB"),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to process."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateOperation(e){const t=[];return(!e||typeof e!="function")&&t.push("Operation must be a function."),{isValid:t.length===0,errors:t}}}class E1{static formatProgress(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches}  ${e.percentage}% complete`;let n;if(e.estimatedTimeRemaining){const o=Math.floor(e.estimatedTimeRemaining/6e4),c=Math.floor(e.estimatedTimeRemaining%6e4/1e3);n=o>0?`${o}m ${c}s remaining`:`${c}s remaining`}let s;if(e.processingRate&&e.memoryUsage){const o=Math.round(e.memoryUsage/1048576);s=`${e.processingRate} items/sec  ${o}MB RAM  ${e.concurrentWorkers} workers`}return{status:t,details:r,timeRemaining:n,performance:s}}static formatProgressSimple(e){return`${e.completed}/${e.total} (${e.percentage}%)`}static formatProgressDetailed(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches}`,n=`${e.percentage}% complete`;let s=`${t}  ${r}  ${n}`;if(e.estimatedTimeRemaining){const o=Math.floor(e.estimatedTimeRemaining/6e4),c=Math.floor(e.estimatedTimeRemaining%6e4/1e3),a=o>0?`${o}m ${c}s remaining`:`${c}s remaining`;s+=`  ${a}`}return e.processingRate&&(s+=`  ${e.processingRate} items/sec`),s}}var pr=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class Xe{static processBulkOperation(e,t){return pr(this,arguments,function*(r,n,s={}){const{batchSize:o=this.DEFAULT_BATCH_SIZE,delayBetweenBatches:c=this.DEFAULT_DELAY,maxConcurrentWorkers:a=this.DEFAULT_MAX_WORKERS,enableCaching:l=!0,cacheSize:u=this.DEFAULT_CACHE_SIZE,memoryLimit:d=this.DEFAULT_MEMORY_LIMIT,onProgress:h,onError:p,onSuccess:m,onMemoryWarning:v}=s,b=Kr.validateItems(r);if(!b.isValid)throw new Error(b.errors.join(", "));const S=Kr.validateConfig(s);if(!S.isValid)throw new Error(S.errors.join(", "));const C=Kr.validateOperation(n);if(!C.isValid)throw new Error(C.errors.join(", "));const w=re.generateOperationId(),y=re.initializeMetrics(w,{totalItems:r.length,maxConcurrentWorkers:a});l&&er.initializeCache(u);const A=[],I=[],k=[],U=Math.ceil(r.length/o),M=Date.now(),Ae=Jr.createWorkerPool(a);try{for(let se=0;se<U;se++){const je=re.getMemoryUsage();ct.isMemoryUsageHigh(je,d,this.MEMORY_WARNING_THRESHOLD)&&ct.notifyMemoryWarning(v,je,d);const F=se*o,Oe=Math.min(F+o,r.length),mt=r.slice(F,Oe);yield Jr.processBatchConcurrent(mt,n,Ae,l,{onError:(ir,sr)=>{k.push(`Item ${mt.indexOf(sr)+1}: ${ir}`),I.push(sr),re.updateMetrics(w,{failedItems:y.failedItems+1}),ct.notifyError(p,ir,sr.id||"unknown")},onSuccess:(ir,sr)=>{A.push(ir),re.updateMetrics(w,{processedItems:y.processedItems+1}),ct.notifySuccess(m,ir,sr.id||"unknown")}});const et=A.length,ce=I.length,yt=mt.length,no=r.length,io=ct.createProgress(no,et,ce,yt,se+1,U,M,a),so=ct.updateProgressWithErrors(io,k);ct.notifyProgress(h,so),se<U-1&&c>0&&(yield Gs.delay(c))}return re.finalizeMetrics(w),{results:A,failed:I,errors:k,metrics:re.getPerformanceMetrics(w)}}finally{Jr.cleanupWorkerPool(Ae),er.clearCache(),re.clearMemoryHistory()}})}static simpleBulkOperation(e,t){return pr(this,null,function*(){const r=[],n=[],s=[],o=e.map((c,a)=>pr(null,null,function*(){try{const l=yield t(c);return r.push(l),{success:!0,result:l,item:c}}catch(l){const u=l instanceof Error?l.message:"Unknown error";return s.push(`Item ${a+1}: ${u}`),n.push(c),{success:!1,error:u,item:c}}}));return yield Promise.allSettled(o),{results:r,failed:n,errors:s}})}static simpleBulkOperationWithRetry(e,t,r){return pr(this,null,function*(){return Gs.processItemsWithRetry(e,t,r)})}static standardBulkOperation(e,t,r){return pr(this,null,function*(){const n=[],s=[],o=[];for(let c=0;c<e.length;c++){try{const a=yield t(e[c]);n.push(a)}catch(a){const l=a instanceof Error?a.message:"Unknown error";o.push(`Item ${c+1}: ${l}`),s.push(e[c])}r==null||r(c+1,e.length)}return{results:n,failed:s,errors:o}})}static validateConfig(e){return Kr.validateConfig(e)}static formatProgress(e){return E1.formatProgress(e)}static getPerformanceMetrics(e){return re.getPerformanceMetrics(e)}static getAllPerformanceMetrics(){return re.getAllPerformanceMetrics()}static clearPerformanceMetrics(){re.clearPerformanceMetrics()}static getCacheStats(){return er.getCacheStats()}static clearCache(){er.clearCache()}static getDefaultBatchSize(){return this.DEFAULT_BATCH_SIZE}static getDefaultDelay(){return this.DEFAULT_DELAY}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}static getDefaultCacheSize(){return this.DEFAULT_CACHE_SIZE}static getDefaultMemoryLimit(){return this.DEFAULT_MEMORY_LIMIT}}Xe.DEFAULT_BATCH_SIZE=50;Xe.DEFAULT_DELAY=100;Xe.DEFAULT_MAX_WORKERS=4;Xe.DEFAULT_CACHE_SIZE=1e3;Xe.DEFAULT_MEMORY_LIMIT=100*1024*1024;Xe.MEMORY_WARNING_THRESHOLD=.8;var k1=Object.defineProperty,L1=Object.defineProperties,T1=Object.getOwnPropertyDescriptors,Ks=Object.getOwnPropertySymbols,P1=Object.prototype.hasOwnProperty,O1=Object.prototype.propertyIsEnumerable,Ws=(i,e,t)=>e in i?k1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ba=(i,e)=>{for(var t in e||(e={}))P1.call(e,t)&&Ws(i,t,e[t]);if(Ks)for(var t of Ks(e))O1.call(e,t)&&Ws(i,t,e[t]);return i},qa=(i,e)=>L1(i,T1(e)),de=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});function M1(i,e,t){return de(this,null,function*(){try{const r=Da(i);if(!r.isValid)throw new Error(r.errors.join(", "));const n=yield Hu(i);e(n)}catch(r){t(r instanceof Error?r.message:"Failed to create item")}})}function x1(i,e,t,r){return de(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const n=Da(e);if(!n.isValid)throw new Error(n.errors.join(", "));const s=yield zn(i,e);t(s)}catch(n){r(n instanceof Error?n.message:"Failed to update item")}})}function H1(i,e,t){return de(this,null,function*(){try{if(!i)throw new Error("Item ID is required");yield Bn(i),V("inventory","item_deleted",`Inventory item deleted: ${i}`,"info",{itemId:i,deletionMethod:"single_item"}),j("delete_item","inventory",{itemId:i,deletionMethod:"single_item"}),D("inventory_item_deleted",{itemId:i,deletionMethod:"single_item"}),e()}catch(r){t(r instanceof Error?r.message:"Failed to delete item")}})}function D1(i,e,t,r,n){return de(this,null,function*(){try{if(!e||e.length===0)throw new Error("No items selected for bulk operation");let s;switch(i){case"delete":s=yield U1(e,t==null?void 0:t.progressConfig);break;case"update":if(!(t!=null&&t.updateData))throw new Error("Update data is required for bulk update operation");s=yield N1(e,t.updateData,t.progressConfig);break;case"export":if(!(t!=null&&t.exportOptions))throw new Error("Export options are required for bulk export operation");s=yield F1(e,t.exportOptions);break;default:throw new Error(`Unsupported bulk operation: ${i}`)}return r==null||r(s),s}catch(s){const o=s instanceof Error?s.message:"Bulk operation failed";throw n==null||n(o),new Error(o)}})}function R1(i,e,t,r){return de(this,null,function*(){try{if(!i)throw new Error("No file selected for import");const n=e||{validateData:!0,skipDuplicates:!0,createMissingCategories:!0},s=z1(n);if(!s.isValid)throw new Error(`Invalid import options: ${s.errors.join(", ")}`);const o=yield s1.importItems(i,n);return V("inventory","bulk_import_completed",`Bulk import completed: ${o.importedCount} items imported`,"info",{fileName:o.fileName,importedCount:o.importedCount,failedCount:o.failedCount,skippedCount:o.skippedCount,errors:o.errors.length,warnings:o.warnings.length}),t==null||t(o),o}catch(n){console.error("Bulk import failed:",n);const s=n instanceof Error?n.message:"Bulk import failed";throw r==null||r(s),new Error(s)}})}function V1(i,e,t){return de(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const r=yield Ru(i);V("inventory","item_duplicated",`Inventory item duplicated: ${i}`,"info",{originalItemId:i,duplicatedItemId:r.id}),j("duplicate_item","inventory",{originalItemId:i,duplicatedItemId:r.id}),D("inventory_item_duplicated",{originalItemId:i,duplicatedItemId:r.id}),e(r)}catch(r){t(r instanceof Error?r.message:"Failed to duplicate item")}})}function $1(i,e,t){return de(this,null,function*(){try{if(!i)throw new Error("Item ID is required");const r=yield Du(i);V("inventory","item_archived",`Inventory item archived: ${i}`,"info",{itemId:i,archiveMethod:"single_item"}),j("archive_item","inventory",{itemId:i,archiveMethod:"single_item"}),D("inventory_item_archived",{itemId:i,archiveMethod:"single_item"}),e(r)}catch(r){t(r instanceof Error?r.message:"Failed to archive item")}})}function j1(i,e){return de(this,null,function*(){try{const t=yield Vu(i,e);return V("inventory","bulk_update_by_category_completed",`Bulk update by category completed: ${t.updatedCount} items updated`,"info",{category:i,updatedCount:t.updatedCount}),j("bulk_update_by_category","inventory",{category:i,updatedCount:t.updatedCount}),D("inventory_bulk_update_by_category_completed",{category:i,updatedCount:t.updatedCount}),t}catch(t){throw console.error("Error in bulk update by category:",t),new Error("Failed to bulk update items by category")}})}function U1(i,e){return de(this,null,function*(){try{if(e){const{results:t,failed:r,errors:n,metrics:s}=yield Xe.processBulkOperation(i,o=>de(null,null,function*(){return yield Bn(o)}),qa(Ba({},e),{enableCaching:!0,maxConcurrentWorkers:4,memoryLimit:104857600,onMemoryWarning:(o,c)=>{console.warn(`Memory usage high: ${Math.round(o/1048576)}MB / ${Math.round(c/1048576)}MB`)}}));return console.log("Bulk deletion completed with performance metrics:",{total:i.length,successful:t.length,failed:r.length,errors:n.length,processingTime:s.averageProcessingTime,memoryUsage:s.peakMemoryUsage,processingRate:s.processingRate}),{deletedCount:t.length}}else{const r=(yield Promise.allSettled(i.map(n=>Bn(n)))).filter(n=>n.status==="fulfilled").length;return V("inventory","bulk_deletion_completed",`Bulk deletion completed: ${r}/${i.length} items`,"info",{totalItems:i.length,deletedCount:r,failedCount:i.length-r,deletionMethod:"bulk_operation"}),j("bulk_delete_items","inventory",{totalItems:i.length,deletedCount:r,failedCount:i.length-r}),D("inventory_bulk_deletion_completed",{totalItems:i.length,deletedCount:r,failedCount:i.length-r,deletionMethod:"bulk_operation"}),{deletedCount:r}}}catch(t){throw console.error("Error in bulk deletion:",t),new Error("Bulk deletion failed")}})}function N1(i,e,t){return de(this,null,function*(){try{if(t){const{results:r,failed:n,errors:s,metrics:o}=yield Xe.processBulkOperation(i,c=>de(null,null,function*(){return yield zn(c,nn(e))}),qa(Ba({},t),{enableCaching:!0,maxConcurrentWorkers:4,memoryLimit:104857600,onMemoryWarning:(c,a)=>{console.warn(`Memory usage high: ${Math.round(c/1048576)}MB / ${Math.round(a/1048576)}MB`)}}));return console.log("Bulk update completed with performance metrics:",{total:i.length,successful:r.length,failed:n.length,errors:s.length,processingTime:o.averageProcessingTime,memoryUsage:o.peakMemoryUsage,processingRate:o.processingRate}),{updatedCount:r.length}}else{const n=(yield Promise.allSettled(i.map(s=>zn(s,nn(e))))).filter(s=>s.status==="fulfilled").length;return V("inventory","bulk_update_completed",`Bulk update completed: ${n}/${i.length} items`,"info",{totalItems:i.length,updatedCount:n,failedCount:i.length-n,updateMethod:"bulk_operation"}),j("bulk_update_items","inventory",{totalItems:i.length,updatedCount:n,failedCount:i.length-n}),D("inventory_bulk_update_completed",{totalItems:i.length,updatedCount:n,failedCount:i.length-n,updateMethod:"bulk_operation"}),{updatedCount:n}}}catch(r){throw console.error("Error in bulk update:",r),new Error("Bulk update failed")}})}function F1(i,e){return de(this,null,function*(){try{const t=yield Va.exportItems(i,e);return V("inventory","bulk_export_completed",`Bulk export completed: ${i.length} items exported`,"info",{totalItems:i.length,exportFormat:e.format,exportMethod:"bulk_operation"}),j("bulk_export_items","inventory",{totalItems:i.length,exportFormat:e.format}),D("inventory_bulk_export_completed",{totalItems:i.length,exportFormat:e.format,exportMethod:"bulk_operation"}),console.log("Bulk export completed with performance metrics:",{totalItems:i.length,exportFormat:e.format,exportMethod:"bulk_operation"}),{exportedCount:i.length}}catch(t){throw console.error("Error in bulk export:",t),new Error("Bulk export failed")}})}function z1(i){const e=[];return typeof i.validateData!="boolean"&&e.push("validateData must be a boolean"),typeof i.skipDuplicates!="boolean"&&e.push("skipDuplicates must be a boolean"),typeof i.createMissingCategories!="boolean"&&e.push("createMissingCategories must be a boolean"),{isValid:e.length===0,errors:e}}var B=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});class ti{static handleCreateItem(e,t,r){return B(this,null,function*(){return M1(e,t,r)})}static handleUpdateItem(e,t,r,n){return B(this,null,function*(){return x1(e,t,r,n)})}static handleDeleteItem(e,t,r){return B(this,null,function*(){return H1(e,t,r)})}static handleBulkOperation(e,t,r,n,s){return B(this,null,function*(){return D1(e,t,r,n,s)})}static handleBulkImport(e,t,r,n){return B(this,null,function*(){return R1(e,t,r,n)})}static handleDuplicateItem(e,t,r){return B(this,null,function*(){return V1(e,t,r)})}static handleArchiveItem(e,t,r){return B(this,null,function*(){return $1(e,t,r)})}static getItems(e){return B(this,null,function*(){return ku(e)})}static getItemById(e){return B(this,null,function*(){return Lu(e)})}static getItemsByCategory(e){return B(this,null,function*(){return Ra(e)})}static getItemsByLocation(e){return B(this,null,function*(){return Tu(e)})}static getItemsByStatus(e){return B(this,null,function*(){return Pu(e)})}static searchItems(e){return B(this,null,function*(){return Ou(e)})}static getLowStockItems(){return B(this,null,function*(){return Mu()})}static getExpiringItems(e=30){return B(this,null,function*(){return xu(e)})}static bulkUpdateItemsByCategory(e,t){return B(this,null,function*(){return j1(e,t)})}static getSuppliersByFacility(e){return B(this,null,function*(){return yield $u(e)})}static getInventoryTransactionsByFacility(e){return B(this,null,function*(){return yield ju(e)})}static getInventoryCostsByFacility(e){return B(this,null,function*(){return yield Uu(e)})}static getEquipmentMaintenanceByFacility(e){return B(this,null,function*(){return yield Nu(e)})}}const Wr={rememberMe:"Remember me",rememberDevice:"Remember device"},ve={PROGRESS_STEPS:{IDLE:"idle",CONNECTING:"connecting",AUTHENTICATING:"authenticating",VERIFYING:"verifying",SUCCESS:"success"},REDIRECT_DELAY_MS:1e3,MIN_PASSWORD_LENGTH:6,OTP_LENGTH:6},Ga={unexpectedError:"An unexpected error occurred. Please try again.",offline:"You are currently offline. Please check your internet connection."};var Dt=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Ka=class _r{constructor(){this.STORAGE_KEY="cliniio_trusted_devices",this.DEVICE_NAME_KEY="cliniio_device_name"}static getInstance(){return _r.instance||(_r.instance=new _r),_r.instance}generateDeviceFingerprint(){try{const e=document.createElement("canvas"),t=e.getContext("2d");t&&(t.textBaseline="top",t.font="14px Arial",t.fillText("Device fingerprint",2,2));const r=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");return btoa(r).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}catch(e){return"unknown_device"}}getDeviceName(){const e=localStorage.getItem(this.DEVICE_NAME_KEY);if(e)return e;const t=navigator.userAgent;let r="Unknown Device";return t.includes("Windows")?r="Windows Device":t.includes("Mac")?r="Mac Device":t.includes("Linux")?r="Linux Device":t.includes("Android")?r="Android Device":(t.includes("iPhone")||t.includes("iPad"))&&(r="iOS Device"),t.includes("Chrome")?r+=" (Chrome)":t.includes("Firefox")?r+=" (Firefox)":t.includes("Safari")?r+=" (Safari)":t.includes("Edge")&&(r+=" (Edge)"),localStorage.setItem(this.DEVICE_NAME_KEY,r),r}storeTrustedDevice(e,t){return Dt(this,null,function*(){try{const r=this.getDeviceName(),{error:n}=yield _.from("trusted_devices").upsert({user_id:e,device_fingerprint:t,device_name:r,last_used:new Date().toISOString(),is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});return n?(console.error("Failed to store trusted device:",n),!1):(this.storeDeviceLocally(t,r),!0)}catch(r){return console.error("Error storing trusted device:",r),!1}})}isDeviceTrusted(e){return Dt(this,null,function*(){try{const t=this.generateDeviceFingerprint(),{data:r,error:n}=yield _.from("trusted_devices").select("id, last_used, is_active").eq("user_id",e).eq("device_fingerprint",t).eq("is_active",!0).single();return n||!r?!1:(yield this.updateLastUsed(r.id),!0)}catch(t){return console.error("Error checking trusted device:",t),!1}})}getTrustedDevices(e){return Dt(this,null,function*(){try{const{data:t,error:r}=yield _.from("trusted_devices").select("*").eq("user_id",e).eq("is_active",!0).order("last_used",{ascending:!1});return r?(console.error("Failed to get trusted devices:",r),[]):t||[]}catch(t){return console.error("Error getting trusted devices:",t),[]}})}removeTrustedDevice(e){return Dt(this,null,function*(){try{const{error:t}=yield _.from("trusted_devices").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e);return t?(console.error("Failed to remove trusted device:",t),!1):!0}catch(t){return console.error("Error removing trusted device:",t),!1}})}updateLastUsed(e){return Dt(this,null,function*(){try{yield _.from("trusted_devices").update({last_used:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e)}catch(t){console.error("Error updating last used:",t)}})}storeDeviceLocally(e,t){try{const r={fingerprint:e,name:t,timestamp:new Date().toISOString()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r))}catch(r){console.error("Error storing device locally:",r)}}getLocalDeviceInfo(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e),r=new Date(Date.now()-720*60*60*1e3);return new Date(t.timestamp)<r?(localStorage.removeItem(this.STORAGE_KEY),null):t}catch(e){return console.error("Error getting local device info:",e),null}}clearAllTrustedDevices(e){return Dt(this,null,function*(){try{const{error:t}=yield _.from("trusted_devices").update({is_active:!1,updated_at:new Date().toISOString()}).eq("user_id",e);return t?(console.error("Failed to clear trusted devices:",t),!1):(localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.DEVICE_NAME_KEY),!0)}catch(t){return console.error("Error clearing trusted devices:",t),!1}})}};Ka.instance=null;let B1=Ka;const Tn=B1.getInstance();var q1=Object.defineProperty,G1=Object.defineProperties,K1=Object.getOwnPropertyDescriptors,Zs=Object.getOwnPropertySymbols,W1=Object.prototype.hasOwnProperty,Z1=Object.prototype.propertyIsEnumerable,Qs=(i,e,t)=>e in i?q1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Q1=(i,e)=>{for(var t in e||(e={}))W1.call(e,t)&&Qs(i,t,e[t]);if(Zs)for(var t of Zs(e))Z1.call(e,t)&&Qs(i,t,e[t]);return i},Y1=(i,e)=>G1(i,K1(e)),J1=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const Wa=()=>{const i=oo(),{refreshUserData:e}=wl(),{formData:t,errors:r,loading:n,setField:s,setErrors:o,setLoading:c,setAuthToken:a,_csrfToken:l,incrementFailedAttempts:u,resetFailedAttempts:d,isSecureMode:h}=Ar(),[p,m]=P.useState(""),v=P.useCallback(C=>w=>{const y=C==="rememberMe"||C==="rememberDevice"?w.target.checked:w.target.value;s(C,y),r[C]&&o(Y1(Q1({},r),{[C]:""}))},[r,s,o]),b=(C,w,y,A,I=!1,k=!1)=>J1(null,null,function*(){var U;if(!n){if(o({}),c(!0),h&&!y()){o({submit:"Security validation failed. Please refresh the page and try again."}),c(!1);return}try{D("attempt",{email:C,timestamp:new Date().toISOString()});const M=!1;if(k)try{console.log(" Checking if device is already trusted...")}catch(je){console.warn("Failed to check trusted device:",je)}const se=yield new Ha().secureLogin({email:C,password:w,rememberMe:I});if(se.success&&se.data){m(ve.PROGRESS_STEPS.VERIFYING);const je=new Date(Date.now()+se.data.expiresIn*1e3).toISOString();a(se.data.accessToken,je,I);try{yield e()}catch(F){console.warn("Failed to refresh user data:",F)}if(k)try{const F=Tn.generateDeviceFingerprint(),Oe=(U=se.data.user)==null?void 0:U.id;Oe&&((yield Tn.isDeviceTrusted(Oe))?console.log(" Device already trusted"):(yield Tn.storeTrustedDevice(Oe,F),console.log(" Device marked as trusted")))}catch(F){console.warn("Failed to store trusted device:",F)}D("success",{email:C,timestamp:new Date().toISOString()}),A("login_success",C),d(),m(ve.PROGRESS_STEPS.SUCCESS),setTimeout(()=>{i("/home")},ve.REDIRECT_DELAY_MS)}else throw new Error(se.error||"Authentication failed")}catch(M){console.error("Secure login error:",M),u();const Ae=M instanceof Error?M.message:Ga.unexpectedError;o({submit:Ae}),D("failure",{email:C,error:Ae,timestamp:new Date().toISOString()}),A("login_failure",C,Ae)}finally{c(!1),m("")}}}),S=P.useCallback(()=>{console.log("Forgot password clicked")},[]);return{formData:t,errors:r,loading:n,loadingStep:p,handleChange:v,handleSubmit:b,handleForgotPassword:S}},X1=()=>f.jsxs(f.Fragment,{children:[f.jsx("h1",{className:"mt-6 text-center text-3xl font-extrabold text-gray-500",children:"Welcome to Cliniio"}),f.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to your account"})]});function ef(i){return R({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(i)}function tf(i){return R({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 32h214.6v214.6H0V32zm233.4 0H448v214.6H233.4V32zM0 265.4h214.6V480H0V265.4zm233.4 0H448V480H233.4V265.4z"},child:[]}]})(i)}const Ir={RATE_LIMIT:{MAX_ATTEMPTS:5,LOCKOUT_DURATION_MINUTES:15,WINDOW_SIZE_MINUTES:15},VALIDATION:{DEBOUNCE_MS:500},THRESHOLDS:{MIN_PASSWORD_LENGTH:8,MAX_LOGIN_ATTEMPTS:5},PASSWORD_STRENGTH:{MIN_LENGTH:8,GOOD_LENGTH:12,EXCELLENT_LENGTH:16,MAX_SCORE:5}},Za=i=>(Object.keys(i).forEach(e=>{typeof i[e]=="object"&&i[e]!==null&&Za(i[e])}),Object.freeze(i));Za(Ir);const Ys=(i,e)=>{if(!i||typeof i!="string")return null;const t=i.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim();return e==="email"?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?t:null:e==="password"&&t.length<8?null:t},Js=i=>{const e=[];return!i||typeof i!="string"?{isSuspicious:!1,threats:e}:(/('|"|;|--|\/\*|\*\/|union|select|insert|update|delete|drop|create|alter)/i.test(i)&&e.push("Potential SQL injection detected"),/<script|javascript:|on\w+\s*=|vbscript:|expression\(/i.test(i)&&e.push("Potential XSS attack detected"),/\||&|;|`|\$\(|eval\(|exec\(/i.test(i)&&e.push("Potential command injection detected"),{isSuspicious:e.length>0,threats:e})},Gn=(i=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";if(typeof crypto!="undefined"&&crypto.getRandomValues){const r=new Uint8Array(i);crypto.getRandomValues(r);for(let n=0;n<i;n++)t+=e[r[n]%e.length]}else for(let r=0;r<i;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},Pe={generateToken:()=>Gn(32),storeToken:i=>{try{typeof window!="undefined"&&localStorage.setItem("csrf_token",i)}catch(e){}},getStoredToken:()=>{try{return typeof window!="undefined"?localStorage.getItem("csrf_token"):null}catch(i){return null}},validateToken:(i,e)=>!i||!e?!1:i===e,setHttpOnlyCookie:i=>{Pe.storeToken(i)},refreshToken:()=>{const i=Pe.generateToken();return Pe.storeToken(i),i},clearToken:()=>{try{typeof window!="undefined"&&localStorage.removeItem("csrf_token")}catch(i){}}};var rf=Object.defineProperty,nf=Object.defineProperties,sf=Object.getOwnPropertyDescriptors,Xs=Object.getOwnPropertySymbols,af=Object.prototype.hasOwnProperty,of=Object.prototype.propertyIsEnumerable,ea=(i,e,t)=>e in i?rf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ta=(i,e)=>{for(var t in e||(e={}))af.call(e,t)&&ea(i,t,e[t]);if(Xs)for(var t of Xs(e))of.call(e,t)&&ea(i,t,e[t]);return i},ra=(i,e)=>nf(i,sf(e)),na=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const cf=()=>{const[i,e]=P.useState({}),[t,r]=P.useState("");P.useEffect(()=>{const o=Gn(32);r(o),typeof sessionStorage!="undefined"&&sessionStorage.setItem("oauth_state",o)},[]);const n=o=>na(null,null,function*(){try{if(e(d=>ra(ta({},d),{[o]:!0})),!t)throw new Error("OAuth state not initialized");const c=o==="microsoft"?"azure":o,a=Gn(128),l=yield s(a);typeof sessionStorage!="undefined"&&(sessionStorage.setItem("oauth_code_verifier",a),sessionStorage.setItem("oauth_provider",o));const{error:u}=yield _.auth.signInWithOAuth({provider:c,options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{access_type:"offline",prompt:"consent",state:t,code_challenge:l,code_challenge_method:"S256"}}});if(u)throw console.error(`OAuth login error with ${o}:`,u),u;Sr()&&console.log(`[SECURITY] OAuth login initiated with ${o}:`,{provider:c,state:t,codeChallenge:l,timestamp:new Date().toISOString()})}catch(c){console.error(`Failed to login with ${o}:`,c),typeof sessionStorage!="undefined"&&(sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),sessionStorage.removeItem("oauth_state")),alert(`Failed to login with ${o}. Please try again.`)}finally{e(c=>ra(ta({},c),{[o]:!1}))}}),s=o=>na(null,null,function*(){try{const a=new TextEncoder().encode(o),l=yield crypto.subtle.digest("SHA-256",a),u=Array.from(new Uint8Array(l));return btoa(String.fromCharCode(...u)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(c){return console.error("Failed to generate PKCE code challenge:",c),o.substring(0,43)}});return f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"absolute inset-0 flex items-center",children:f.jsx("div",{className:"w-full border-t border-gray-300"})}),f.jsx("div",{className:"relative flex justify-center text-sm",children:f.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[f.jsxs("button",{type:"button",onClick:()=>n("google"),disabled:i.google||!t,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.google?f.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):f.jsx(ef,{className:"h-4 w-4 text-red-500"}),f.jsx("span",{className:"ml-2",children:"Google"})]}),f.jsxs("button",{type:"button",onClick:()=>n("microsoft"),disabled:i.microsoft||!t,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.microsoft?f.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):f.jsx(tf,{className:"h-4 w-4 text-blue-500"}),f.jsx("span",{className:"ml-2",children:"Microsoft"})]})]})]})},lf=()=>f.jsx(cf,{}),Qa=({formData:i,handleChange:e,disabled:t=!1})=>{const r=P.useRef(null),[n,s]=P.useState(!1);P.useEffect(()=>{r.current&&!t&&r.current.focus()},[t]);const o=l=>l.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.trim())?null:"Please enter a valid email address":"Email is required",c=l=>{e("email")(l),s(!0)},a=n?o(i.email):null;return f.jsxs("div",{children:[f.jsx("span",{id:"emailHelp",className:"sr-only",children:"Enter your email address."}),f.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email"}),f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:f.jsx(cu,{className:"h-5 w-5 text-gray-400"})}),f.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,disabled:t,"aria-label":"Email address","aria-describedby":"emailHelp",className:`appearance-none rounded-lg relative block w-full px-3 py-3 pl-10 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 focus:z-10 sm:text-sm transition-colors duration-200 ${a?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`,placeholder:"Email address",value:i.email,onChange:c,onBlur:()=>s(!0),ref:r})]}),a&&f.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[f.jsx(Jn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),f.jsx("p",{className:"text-sm text-red-600",children:a})]})]})},Ya=({password:i})=>{const t=(n=>{let s=0;const o={length:n.length>=8,lowercase:/[a-z]/.test(n),uppercase:/[A-Z]/.test(n),numbers:/\d/.test(n),symbols:/[!@#$%^&*(),.?":{}|<>]/.test(n),noRepeating:!/(.)\1{2,}/.test(n),noSequential:!/(?:abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|012|123|234|345|456|567|678|789)/i.test(n)};return o.length&&(s+=2),o.lowercase&&(s+=1),o.uppercase&&(s+=1),o.numbers&&(s+=1),o.symbols&&(s+=1),o.noRepeating&&(s+=1),o.noSequential&&(s+=1),n.length>=12&&(s+=1),n.length>=16&&(s+=1),s>=8?{level:"Excellent",score:s,color:"text-emerald-600",bgColor:"bg-emerald-500",barColor:"bg-emerald-500"}:s>=6?{level:"Strong",score:s,color:"text-green-600",bgColor:"bg-green-500",barColor:"bg-green-500"}:s>=4?{level:"Good",score:s,color:"text-yellow-600",bgColor:"bg-yellow-500",barColor:"bg-yellow-500"}:s>=2?{level:"Fair",score:s,color:"text-orange-600",bgColor:"bg-orange-500",barColor:"bg-orange-500"}:{level:"Weak",score:s,color:"text-red-600",bgColor:"bg-red-500",barColor:"bg-red-500"}})(i),r=10;return i.length===0?null:f.jsxs("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength"}),f.jsx("span",{className:`text-sm font-semibold ${t.color}`,children:t.level})]}),f.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:f.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ease-out ${t.barColor}`,style:{width:`${t.score/r*100}%`}})}),f.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-3",children:[f.jsxs("span",{children:["Score: ",t.score,"/",r]}),f.jsxs("span",{className:t.color,children:[Math.round(t.score/r*100),"%"]})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[i.length>=8?f.jsx(it,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):f.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),f.jsx("span",{className:`text-xs ${i.length>=8?"text-green-700":"text-gray-500"}`,children:"At least 8 characters"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[/[a-z]/.test(i)?f.jsx(it,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):f.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),f.jsx("span",{className:`text-xs ${/[a-z]/.test(i)?"text-green-700":"text-gray-500"}`,children:"Lowercase letter"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[/[A-Z]/.test(i)?f.jsx(it,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):f.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),f.jsx("span",{className:`text-xs ${/[A-Z]/.test(i)?"text-green-700":"text-gray-500"}`,children:"Uppercase letter"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[/\d/.test(i)?f.jsx(it,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):f.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),f.jsx("span",{className:`text-xs ${/\d/.test(i)?"text-green-700":"text-gray-500"}`,children:"Number"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[/[!@#$%^&*(),.?":{}|<>]/.test(i)?f.jsx(it,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):f.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),f.jsx("span",{className:`text-xs ${/[!@#$%^&*(),.?":{}|<>]/.test(i)?"text-green-700":"text-gray-500"}`,children:"Special character"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[i.length>=12?f.jsx(it,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):f.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),f.jsx("span",{className:`text-xs ${i.length>=12?"text-green-700":"text-gray-500"}`,children:"At least 12 characters (bonus)"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[/(.)\1{2,}/.test(i)?f.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}):f.jsx(it,{className:"w-3 h-3 text-green-500 flex-shrink-0"}),f.jsx("span",{className:`text-xs ${/(.)\1{2,}/.test(i)?"text-gray-500":"text-green-700"}`,children:"No repeating characters"})]})]}),t.score<6&&f.jsx("div",{className:"mt-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:f.jsxs("div",{className:"flex items-start space-x-2",children:[f.jsx("svg",{className:"w-4 h-4 text-amber-500 mt-0.5 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),f.jsxs("span",{children:[f.jsx("strong",{children:"Tip:"})," Try adding uppercase letters, numbers, and special characters to make your password stronger."]})]})})]})},Ja=({formData:i,handleChange:e,disabled:t=!1,showStrengthIndicator:r=!1})=>{const[n,s]=P.useState(!1),o=l=>l?l.length<8?"Password must be at least 8 characters long":null:"Password is required",c=l=>{e("password")(l),s(!0)},a=n?o(i.password):null;return f.jsxs("div",{children:[f.jsx("span",{id:"passwordHelp",className:"sr-only",children:"Enter your account password."}),f.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:f.jsx(ou,{className:"h-5 w-5 text-gray-400"})}),f.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,disabled:t,"aria-label":"Password","aria-describedby":"passwordHelp",className:`appearance-none rounded-lg relative block w-full px-3 py-3 pl-10 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 focus:z-10 sm:text-sm transition-colors duration-200 ${a?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`,placeholder:"Password",value:i.password,onChange:c,onBlur:()=>s(!0)})]}),r&&f.jsx(Ya,{password:i.password}),a&&f.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[f.jsx(Jn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),f.jsx("p",{className:"text-sm text-red-600",children:a})]})]})},Xa=({formData:i,handleChange:e,disabled:t=!1})=>f.jsx("div",{className:"flex items-center justify-between",children:f.jsxs("div",{className:"flex flex-col space-y-2",children:[f.jsxs("div",{className:"flex items-center",children:[f.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",disabled:t,"aria-label":Wr.rememberMe,checked:i.rememberMe,onChange:e("rememberMe"),className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${t?"opacity-50 cursor-not-allowed":""}`}),f.jsx("label",{htmlFor:"remember-me",className:`ml-2 block text-sm transition-colors duration-200 ${t?"text-gray-500":"text-gray-900"}`,children:Wr.rememberMe})]}),f.jsxs("div",{className:"flex items-center",children:[f.jsx("input",{id:"remember-device",name:"remember-device",type:"checkbox",disabled:t,"aria-label":Wr.rememberDevice,checked:i.rememberDevice,onChange:e("rememberDevice"),className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${t?"opacity-50 cursor-not-allowed":""}`}),f.jsx("label",{htmlFor:"remember-device",className:`ml-2 block text-sm transition-colors duration-200 ${t?"text-gray-500":"text-gray-900"}`,children:Wr.rememberDevice})]})]})}),eo=({formData:i,handleChange:e,disabled:t=!1})=>{const[r,n]=P.useState(!1),s=a=>a?a.length!==6?"Verification code must be 6 digits":/^\d{6}$/.test(a)?null:"Verification code must contain only numbers":"Verification code is required",o=a=>{e("otp")(a),n(!0)},c=r?s(i.otp||""):null;return i.stage!=="otp"?null:f.jsxs("div",{children:[f.jsx("label",{htmlFor:"otp",className:"sr-only",children:"One-time code"}),f.jsx("input",{id:"otp",name:"otp",type:"text",maxLength:6,disabled:t,placeholder:"Enter 6-digit code",value:i.otp||"",onChange:o,onBlur:()=>n(!0),className:`appearance-none rounded-lg relative block w-full px-3 py-3 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 sm:text-sm transition-colors duration-200 ${c?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`}),c&&f.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[f.jsx(Jn,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),f.jsx("p",{className:"text-sm text-red-600",children:c})]})]})},to=({warnings:i=[]})=>P.useMemo(()=>!i||i.length===0?null:f.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:f.jsxs("div",{className:"flex",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:f.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),f.jsxs("div",{className:"ml-3",children:[f.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Security Warning"}),f.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:f.jsx("ul",{className:"list-disc pl-5 space-y-1",children:i.map((t,r)=>f.jsx("li",{children:t},r))})})]})]})}),[i]),ro=({isOnline:i=!0})=>i?null:f.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx("svg",{className:"h-5 w-5 text-amber-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),f.jsx("div",{className:"flex-1",children:f.jsx("p",{className:"text-sm text-amber-800 font-medium",children:Ga.offline})})]})});var uf=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const df=P.lazy(()=>N(()=>import("./errors-CCC622el.js"),__vite__mapDeps([10,1,2,3,4]))),hf=()=>f.jsx("div",{className:"rounded-lg border p-4 bg-red-50 border-red-200",children:f.jsx("div",{className:"flex items-center",children:f.jsx("div",{className:"text-sm text-red-800",children:"Loading error handler..."})})}),ia=()=>{const{formData:i,errors:e,loading:t,handleChange:r,handleSubmit:n,handleForgotPassword:s}=Wa(),{csrfToken:o,isSecureMode:c}=Ar(),a=l=>uf(null,null,function*(){if(l.preventDefault(),!i.email.trim()||!i.password.trim())return;const u=i.email.trim().toLowerCase(),d=i.password;yield n(u,d,()=>c?!!o&&o.length>0:!0,(m,v,b)=>{console.log(`[SECURITY] ${m} for user: ${v}`,b?`Reason: ${b}`:"")},i.rememberMe,i.rememberDevice)});return f.jsx(Ta,{children:f.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:f.jsxs("div",{className:"max-w-md w-full space-y-8",children:[f.jsx(X1,{}),f.jsxs("form",{className:"mt-8 space-y-6",onSubmit:a,children:[c&&o&&f.jsx("input",{type:"hidden",name:"csrfToken",value:o}),f.jsxs("div",{className:"space-y-4",children:[f.jsx(Qa,{formData:i,handleChange:r,disabled:t}),f.jsx(Ja,{formData:i,handleChange:r,disabled:t}),f.jsx(Xa,{formData:i,handleChange:r,disabled:t})]}),i.stage==="otp"&&f.jsx(eo,{formData:i,handleChange:r,disabled:t}),f.jsx(to,{}),f.jsx(ro,{}),e.submit&&f.jsx(P.Suspense,{fallback:f.jsx(hf,{}),children:f.jsx(df,{error:e.submit,context:"login",onRetry:()=>{Ar.getState().setErrors({})},onDismiss:()=>{Ar.getState().setErrors({})}})}),f.jsx("div",{children:f.jsx("button",{type:"submit",disabled:t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#4ECDC4] hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#4ECDC4] disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Sign in"})}),f.jsx("div",{className:"text-center",children:f.jsx("button",{type:"button",onClick:s,className:"text-sm text-blue-600 hover:text-blue-500 focus:outline-none focus:underline",children:"Forgot your password?"})})]}),f.jsx(lf,{})]})})})},ff=()=>f.jsx("div",{className:"text-center",children:f.jsxs("div",{className:"mt-4 inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[f.jsx("svg",{className:"w-3 h-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Secure Login Enabled"]})}),pf=({loading:i,loadingStep:e})=>{const t=r=>{switch(r){case ve.PROGRESS_STEPS.CONNECTING:return"progress-bar-25";case ve.PROGRESS_STEPS.AUTHENTICATING:return"progress-bar-50";case ve.PROGRESS_STEPS.VERIFYING:return"progress-bar-75";case ve.PROGRESS_STEPS.SUCCESS:return"progress-bar-100";default:return"progress-bar-0"}};return!i||e===ve.PROGRESS_STEPS.IDLE?null:f.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[f.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),f.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[e===ve.PROGRESS_STEPS.CONNECTING&&"Connecting to server...",e===ve.PROGRESS_STEPS.AUTHENTICATING&&"Authenticating credentials...",e===ve.PROGRESS_STEPS.VERIFYING&&"Verifying session...",e===ve.PROGRESS_STEPS.SUCCESS&&"Login successful! Redirecting..."]}),f.jsx("div",{className:"mt-2 w-full bg-blue-200 rounded-full h-2",children:f.jsx("div",{className:`bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out ${t(e)}`})})]})]})})},gf=({loading:i,loadingStep:e})=>i?f.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-600",children:[f.jsx(lu,{size:"sm"}),f.jsx("span",{children:e||"Processing..."})]}):null;var mf=Object.defineProperty,sa=Object.getOwnPropertySymbols,yf=Object.prototype.hasOwnProperty,vf=Object.prototype.propertyIsEnumerable,aa=(i,e,t)=>e in i?mf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,gr=(i,e)=>{for(var t in e||(e={}))yf.call(e,t)&&aa(i,t,e[t]);if(sa)for(var t of sa(e))vf.call(e,t)&&aa(i,t,e[t]);return i},Pn=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const _f={maxAttempts:Ir.RATE_LIMIT.MAX_ATTEMPTS,lockoutDuration:Ir.RATE_LIMIT.LOCKOUT_DURATION_MINUTES,windowSize:Ir.RATE_LIMIT.WINDOW_SIZE_MINUTES};class wf{constructor(e={}){this.config=gr(gr({},_f),e),this.distributedLimiter=new Tr({maxRequests:this.config.maxAttempts,windowMs:this.config.windowSize*60*1e3,keyPrefix:"auth",blockDurationMs:this.config.lockoutDuration*60*1e3})}checkRateLimit(e){return Pn(this,null,function*(){try{const t=yield this.distributedLimiter.checkRateLimit(e);if(!t.allowed)return{isLocked:!0,remainingAttempts:0,lockoutTime:t.resetTime,error:`Too many failed attempts. Please try again in ${t.retryAfter||0} seconds.`};const{data:r,error:n}=yield _.from("login_attempts").select("*").eq("email",e).gte("attempted_at",new Date(Date.now()-this.config.windowSize*60*1e3).toISOString()).order("attempted_at",{ascending:!1}),o=(r||[]).filter(c=>!c.success);if(o.length>=this.config.maxAttempts){const c=o[0],a=new Date(c.attempted_at);if(a.setMinutes(a.getMinutes()+this.config.lockoutDuration),a>new Date)return{isLocked:!0,remainingAttempts:0,lockoutTime:a.getTime(),error:"Account temporarily locked due to repeated failed attempts. Please try again later."}}return{isLocked:!1,remainingAttempts:t.remaining}}catch(t){return{isLocked:!1,remainingAttempts:this.config.maxAttempts}}})}recordAttempt(e,t,r){return Pn(this,null,function*(){try{const{error:n}=yield _.from("login_attempts").insert({email:e,success:t,attempted_at:new Date().toISOString(),ip_address:r||"unknown",user_agent:navigator.userAgent})}catch(n){}})}resetRateLimit(e){return Pn(this,null,function*(){try{yield this.distributedLimiter.resetRateLimit(e);const{error:t}=yield _.from("login_attempts").delete().eq("email",e)}catch(t){}})}getConfig(){return gr({},this.config)}updateConfig(e){this.config=gr(gr({},this.config),e)}}const bf=new wf;const Cf=i=>{try{console.log("[AUDIT]",i)}catch(e){}};function Sf(i,e){const t=P.useRef();return P.useCallback((...n)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{i(...n)},e)},[i,e])}var Af=(i,e,t)=>new Promise((r,n)=>{var s=a=>{try{c(t.next(a))}catch(l){n(l)}},o=a=>{try{c(t.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(s,o);c((t=t.apply(i,e)).next())});const If=()=>{const[i,e]=P.useState(""),[t,r]=P.useState([]),[n,s]=P.useState(null),[o,c]=P.useState(!1);P.useEffect(()=>{const S=Pe.getStoredToken();if(S)e(S);else{const C=Pe.generateToken();e(C),Pe.storeToken(C)}},[]),P.useEffect(()=>{(()=>{const C=window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";c(C),!C&&!Sr()&&v("non_https_connection",{protocol:window.location.protocol,hostname:window.location.hostname})})()},[]);const a=Sf(((S,C)=>l(S,C)),Ir.VALIDATION.DEBOUNCE_MS),l=(S,C)=>{const w=[];if(S.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(S.trim())||w.push("Please enter a valid email address."),C?C.length<6&&w.push("Password must be at least 6 characters long."):w.push("Password must be at least 6 characters long."),w.length>0)return{isValid:!1,email:S.trim(),password:C,errors:w};const y=Ys(S,"email"),A=Ys(C,"password");if(!y||!A)return{isValid:!1,email:y,password:A,errors:["Invalid email or password format"]};const I=Js(y),k=Js(A),U=[...I.threats,...k.threats];return U.length>0?(r(U),v("suspicious_input_detected",{email:y,threats:U}),{isValid:!1,email:y,password:A,errors:U}):(r([]),{isValid:!0,email:y,password:A,errors:[]})},u=(S,C)=>l(S,C),d=S=>{const C=Pe.getStoredToken(),w=Pe.validateToken(S,C||"");if(!w){v("csrf_validation_failed",{providedToken:S,storedToken:C});const y=Pe.refreshToken();e(y)}return w},h=S=>Af(null,null,function*(){try{const C=yield bf.checkRateLimit(S);return s(C),C.isLocked&&v("rate_limit_exceeded",{email:S,lockoutTime:C.lockoutTime}),C}catch(C){return console.error("Rate limit check failed:",C),{isLocked:!1,remainingAttempts:5}}}),p=()=>{r([])},m=()=>{Pe.clearToken(),e("")},v=(S,C)=>{Sr()&&console.warn(`[SECURITY] ${S}:`,C);const w=Sr()?C:{event_type:S,timestamp:new Date().toISOString(),has_details:Object.keys(C).length>0};Cf({event:"security_event",timestamp:new Date().toISOString(),metadata:w})},b=P.useMemo(()=>{const S=t.length>0;return(n==null?void 0:n.isLocked)||!1?"locked":S?"warning":"secure"},[t,n]);return{csrfToken:i,securityWarnings:t,rateLimitInfo:n,isHttps:o,validateInputs:u,debouncedValidateInputs:a,validateCsrfToken:d,checkRateLimit:h,clearSecurityWarnings:p,clearCsrfToken:m,logSecurityEvent:v,getSecurityStatus:b}},Kg=Object.freeze(Object.defineProperty({__proto__:null,CheckboxFields:Xa,EmailField:Qa,LoadingIndicator:gf,LoginPage:ia,LoginProgressIndicator:pf,OfflineWarning:ro,OtpField:eo,PasswordField:Ja,PasswordStrengthIndicator:Ya,SecurityStatusIndicator:ff,SecurityWarnings:to,default:ia,useLoginForm:Wa,useLoginSecurity:If},Symbol.toStringTag,{value:"Module"}));export{fp as $,gp as A,Ff as B,El as C,Ve as D,e0 as E,Mg as F,A0 as G,Ap as H,dg as I,Tg as J,Lg as K,gg as L,mg as M,pg as N,vg as O,Cg as P,cu as Q,xa as R,Ha as S,Tr as T,ti as U,Ta as V,lu as W,pp as X,tg as Y,W0 as Z,N as _,Vp as a,_0 as a$,s0 as a0,Op as a1,j0 as a2,Nf as a3,kp as a4,yp as a5,mn as a6,bp as a7,Cp as a8,c0 as a9,Sp as aA,w0 as aB,L0 as aC,Mp as aD,F0 as aE,cg as aF,lp as aG,sg as aH,g0 as aI,p0 as aJ,Yf as aK,S0 as aL,Dp as aM,i1 as aN,Fg as aO,zg as aP,Ug as aQ,Ng as aR,d0 as aS,f0 as aT,tr as aU,La as aV,$g as aW,Yp as aX,Jp as aY,y0 as aZ,ug as a_,wp as aa,wg as ab,Ig as ac,Ip as ad,Gp as ae,bg as af,Ag as ag,Pg as ah,Rg as ai,Og as aj,Vg as ak,kg as al,_g as am,Hg as an,eg as ao,X0 as ap,Q0 as aq,mp as ar,Ep as as,Z0 as at,ap as au,V0 as av,C0 as aw,Qf as ax,Up as ay,$f as az,Lp as b,a0 as b$,ep as b0,E0 as b1,ip as b2,l0 as b3,hp as b4,Kf as b5,Uf as b6,cp as b7,u0 as b8,qf as b9,N0 as bA,o0 as bB,np as bC,xp as bD,ng as bE,k0 as bF,n0 as bG,Bp as bH,dp as bI,zi as bJ,Fp as bK,rg as bL,Wf as bM,Jf as bN,x0 as bO,Hp as bP,K0 as bQ,t0 as bR,Qp as bS,$p as bT,Tp as bU,ag as bV,Xp as bW,Zp as bX,Wp as bY,qp as bZ,G0 as b_,T0 as ba,ig as bb,Es as bc,H0 as bd,tp as be,h0 as bf,vp as bg,_p as bh,B0 as bi,Kp as bj,U0 as bk,Na as bl,z0 as bm,rp as bn,zf as bo,jg as bp,P0 as bq,Vf as br,Pp as bs,up as bt,jf as bu,R0 as bv,J0 as bw,Np as bx,b0 as by,i0 as bz,Dg as c,jp as c0,op as c1,Gf as c2,O0 as c3,q0 as c4,vr as c5,fh as c6,Bg as c7,_l as c8,Xf as c9,lg as ca,M0 as cb,r0 as cc,og as cd,I0 as ce,Rp as cf,D0 as cg,Ma as ch,Qu as ci,Rf as cj,ne as ck,hg as cl,fg as cm,qg as cn,Gg as co,Kg as cp,xg as d,yg as e,it as f,Sg as g,Eg as h,Sr as i,wl as j,kr as k,H as l,Il as m,Bf as n,m0 as o,rn as p,Al as q,nt as r,_ as s,sp as t,Ar as u,v0 as v,Y0 as w,Zf as x,$0 as y,zp as z};
