const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/components-CrSzLpHe.js","assets/js/react-vendor-CAfHStow.js","assets/js/data-vendor-B3X5ReaK.js","assets/js/vendor-BtFhHG5P.js","assets/js/services-Bq-O5kvJ.js","assets/js/knowledgehub-pages-i9cBLZCy.js","assets/js/ui-vendor-mgcSnJSc.js","assets/css/ui-vendor-DJSy8M6b.css","assets/js/utils-vendor-CfclMkuN.js","assets/css/components-B4OH_j2L.css"])))=>i.map(i=>d[i]);
import{s as $,_ as se,u as U,a as Ge,b as et,I as tt,c as ye,d as ge,e as rt,C as ve,T as nt,D as at,f as st,S as it}from"./components-CrSzLpHe.js";import{u as z,O as ot,D as lt,G as ct,H as ut,J as dt,K as mt,L as ht,M as pt,N as ft,Q as yt,R as gt,V as vt,W as bt,X as St,Y as _t,Z as xt,_ as wt,$ as Ct,a0 as It,a1 as Et,a2 as kt,a3 as be}from"./services-Bq-O5kvJ.js";import{j as u,r as y,P as T,l as ce,a as jt,Q as Le,R as Se,I as ee}from"./react-vendor-CAfHStow.js";import{Q as re,b as Mt,a5 as Be,a as He,Z as Dt,c as _e,r as Nt}from"./ui-vendor-mgcSnJSc.js";import{A as Tt,m as B}from"./utils-vendor-CfclMkuN.js";var ie=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});function Zr(n){return ie(this,null,function*(){try{const{data:e,error:t}=yield $.from("suppliers").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getSuppliersByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting suppliers by facility:",e),{data:null,error:e}}})}function Gr(n){return ie(this,null,function*(){try{const{data:e,error:t}=yield $.from("inventory_transactions").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getInventoryTransactionsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory transactions by facility:",e),{data:null,error:e}}})}function en(n){return ie(this,null,function*(){try{const{data:e,error:t}=yield $.from("inventory_costs").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getInventoryCostsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory costs by facility:",e),{data:null,error:e}}})}function tn(n){return ie(this,null,function*(){try{const{data:e,error:t}=yield $.from("equipment_maintenance").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getEquipmentMaintenanceByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting equipment maintenance by facility:",e),{data:null,error:e}}})}class D{static generateCacheKey(e,t){var r,s;const o=e.length+"_"+((r=e[0])==null?void 0:r.id)+"_"+((s=e[e.length-1])==null?void 0:s.id),c=JSON.stringify(t);return`${o}_${c}`}static getCachedResult(e){return this.EXPORT_CACHE.get(e)}static hasCachedResult(e){return this.EXPORT_CACHE.has(e)}static cacheExportResult(e,t){if(this.EXPORT_CACHE.size>=this.CACHE_MAX_SIZE){const r=this.EXPORT_CACHE.keys().next().value;r&&this.EXPORT_CACHE.delete(r)}this.EXPORT_CACHE.set(e,t)}static getCacheStats(){return{size:this.EXPORT_CACHE.size,maxSize:this.CACHE_MAX_SIZE}}static clearCache(){this.EXPORT_CACHE.clear()}static removeCachedResult(e){return this.EXPORT_CACHE.delete(e)}}D.EXPORT_CACHE=new Map;D.CACHE_MAX_SIZE=100;var xe=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class we{static standardExport(e,t){return xe(this,null,function*(){switch(t.format){case"csv":return this.generateCSV(e,t);case"json":return this.generateJSON(e,t);case"excel":return yield this.generateExcel(e,t);default:throw new Error(`Unsupported export format: ${t.format}`)}})}static standardExportTransformed(e,t){return this.generateCSVFromTransformed(e,t,!0)}static generateCSV(e,t){const r=t.customFields||this.getDefaultCSVFields();let s="";t.includeHeaders&&(s+=r.map(o=>this.escapeCSVField(o)).join(",")+`
`);for(const o of e){const c=r.map(i=>{const a=this.getFieldValue(o,i);return this.escapeCSVField(a)});s+=c.join(",")+`
`}return s}static generateJSON(e,t){const r=t.customFields||this.getDefaultJSONFields(),s=e.map(o=>{const c={};for(const i of r)c[i]=this.getFieldValue(o,i);return c});return JSON.stringify(s,null,2)}static generateExcel(e,t){return xe(this,null,function*(){const r=this.generateCSV(e,t);return new Blob([r],{type:"text/csv;charset=utf-8;"})})}static generateCSVFromTransformed(e,t,r){const s=t.customFields||[];let o="";r&&t.includeHeaders&&(o+=s.map(c=>this.escapeCSVField(c)).join(",")+`
`);for(const c of e){const i=s.map(a=>{const l=c[a]||"";return this.escapeCSVField(String(l))});o+=i.join(",")+`
`}return o}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r!==null&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}}class N{static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory;return(e==null?void 0:e.usedJSHeapSize)||0}return 0}static getMemoryStats(){const e=this.getMemoryUsage();let t;if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const r=performance.memory;t=r==null?void 0:r.jsHeapSizeLimit}return{current:e,limit:t}}static isMemoryUsageHigh(e){const t=this.getMemoryUsage(),r=e||this.DEFAULT_MAX_MEMORY;return t>r}static forceGarbageCollection(){typeof window!="undefined"&&"gc"in window&&typeof window.gc=="function"&&window.gc()}static getDefaultMaxMemory(){return this.DEFAULT_MAX_MEMORY}}N.DEFAULT_MAX_MEMORY=50*1024*1024;var Ce=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class fe{static streamingExport(e,t){return Ce(this,null,function*(){const r=t.chunkSize||this.DEFAULT_CHUNK_SIZE,s=[];for(let o=0;o<e.length;o+=r){const c=e.slice(o,o+r);N.isMemoryUsageHigh(t.maxMemoryUsage)&&N.forceGarbageCollection();let i;switch(t.format){case"csv":i=this.generateCSVChunk(c,t,o===0);break;case"json":i=this.generateJSONChunk(c,t,o===0,o+r>=e.length);break;default:throw new Error(`Streaming not supported for format: ${t.format}`)}s.push(i),o%(r*10)===0&&(yield new Promise(a=>setTimeout(a,0)))}return s.join("")})}static streamingExportTransformed(e,t){return Ce(this,null,function*(){const r=[],s=t.chunkSize||this.DEFAULT_CHUNK_SIZE;for(let o=0;o<e.length;o+=s){const c=e.slice(o,o+s),i=this.generateCSVFromTransformed(c,t,o===0);r.push(i),o%(s*10)===0&&(yield new Promise(a=>setTimeout(a,0)))}return r.join("")})}static generateCSVChunk(e,t,r){const s=t.customFields||this.getDefaultCSVFields();let o="";r&&t.includeHeaders&&(o+=s.map(c=>this.escapeCSVField(c)).join(",")+`
`);for(const c of e){const i=s.map(a=>{const l=this.getFieldValue(c,a);return this.escapeCSVField(l)});o+=i.join(",")+`
`}return o}static generateJSONChunk(e,t,r,s){const o=t.customFields||this.getDefaultJSONFields();let c="";r&&(c+=`[
`);const i=e.map(a=>{const l={};for(const m of o)l[m]=this.getFieldValue(a,m);return l});return c+=i.map(a=>"  "+JSON.stringify(a)).join(`,
`),s?c+=`
]`:c+=`,
`,c}static generateCSVFromTransformed(e,t,r){const s=t.customFields||[];let o="";r&&t.includeHeaders&&(o+=s.map(c=>this.escapeCSVField(c)).join(",")+`
`);for(const c of e){const i=s.map(a=>{const l=c[a]||"";return this.escapeCSVField(String(l))});o+=i.join(",")+`
`}return o}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r!==null&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}fe.DEFAULT_CHUNK_SIZE=1e3;class J{static createDownloadUrl(e,t){const r=typeof e=="string"?new Blob([e],{type:"text/plain"}):e,s=URL.createObjectURL(r),o=document.createElement("a");return o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(s),1e3),s}static getDataSize(e){return typeof e=="string"?new Blob([e]).size:e.size}static getDateString(){return new Date().toISOString().split("T")[0]}static generateFileName(e,t){const r=this.getDateString();return`${e}_${r}.${t}`}static revokeUrl(e){URL.revokeObjectURL(e)}}class X{static validateExportOptions(e){const t=[];return(!e.format||!["csv","json","excel"].includes(e.format))&&t.push("Invalid export format. Must be csv, json, or excel."),e.customFields&&!Array.isArray(e.customFields)&&t.push("Custom fields must be an array of strings."),e.chunkSize!==void 0&&(e.chunkSize<1||e.chunkSize>1e4)&&t.push("Chunk size must be between 1 and 10000."),e.maxMemoryUsage!==void 0&&e.maxMemoryUsage<1024*1024&&t.push("Max memory usage must be at least 1MB."),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to export."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateTemplate(e){const t=[];if(e||t.push("Template is required."),e&&typeof e=="object"&&"format"in e){const r=e.format;["csv","json","excel"].includes(r)||t.push("Template format must be csv, json, or excel.")}return{isValid:t.length===0,errors:t}}}var Ie=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class Pt{static exportItems(e){return Ie(this,arguments,function*(t,r={format:"csv",includeHeaders:!0}){const s=Date.now(),o=N.getMemoryUsage();try{const c=X.validateItems(t);if(!c.isValid)throw new Error(c.errors.join(", "));const i=X.validateExportOptions(r);if(!i.isValid)throw new Error(i.errors.join(", "));const a=D.generateCacheKey(t,r);if(D.hasCachedResult(a))return console.log("Export cache hit"),D.getCachedResult(a);let l;r.enableStreaming&&t.length>this.DEFAULT_CHUNK_SIZE?l=yield fe.streamingExport(t,r):l=yield we.standardExport(t,r);const m=J.generateFileName("inventory_export",r.format),h=J.createDownloadUrl(l,m),b=Date.now(),p=N.getMemoryUsage(),v={success:!0,fileName:m,dataSize:J.getDataSize(l),itemCount:t.length,format:r.format,downloadUrl:h,processingTime:b-s,memoryUsage:p-o};return D.cacheExportResult(a,v),v}catch(c){throw console.error("Export failed:",c),new Error(`Export failed: ${c instanceof Error?c.message:"Unknown error"}`)}})}static exportWithTemplate(e,t){return Ie(this,null,function*(){const r=Date.now(),s=N.getMemoryUsage();try{const o=X.validateItems(e);if(!o.isValid)throw new Error(o.errors.join(", "));const c=X.validateTemplate(t);if(!c.isValid)throw new Error(c.errors.join(", "));if(!e||e.length===0)throw new Error("No items to export");const{InventoryExportTemplateService:i}=yield se(()=>Promise.resolve().then(()=>hr),void 0),a=i.applyTemplate(e,t),l=i.generateFileName(t),m={format:t.format,includeHeaders:t.includeHeaders,dateFormat:t.dateFormat,customFields:t.fields.map(g=>String(g.key)),enableStreaming:e.length>this.DEFAULT_CHUNK_SIZE,chunkSize:this.DEFAULT_CHUNK_SIZE};let h;m.enableStreaming?h=yield fe.streamingExportTransformed(a,m):h=we.standardExportTransformed(a,m);const b=J.createDownloadUrl(h,l),p=Date.now(),v=N.getMemoryUsage();return{success:!0,fileName:l,dataSize:J.getDataSize(h),itemCount:a.length,format:t.format,downloadUrl:b,processingTime:p-r,memoryUsage:v-s}}catch(o){throw console.error("Template export failed:",o),new Error(`Template export failed: ${o instanceof Error?o.message:"Unknown error"}`)}})}static validateExportOptions(e){return X.validateExportOptions(e)}static getCacheStats(){return D.getCacheStats()}static clearCache(){D.clearCache()}static getMemoryStats(){return N.getMemoryStats()}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}Pt.DEFAULT_CHUNK_SIZE=1e3;const Ft=n=>{var e,t,r,s;return((e=n.data)==null?void 0:e.toolId)||((t=n.data)==null?void 0:t.supplyId)||((r=n.data)==null?void 0:r.equipmentId)||((s=n.data)==null?void 0:s.hardwareId)||n.toolId||n.supplyId||n.equipmentId||n.hardwareId||n.id},At=(n,e)=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t};function Ot(){return{itemName:"",category:"",id:"",location:"",status:"active",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const Ee=()=>({general:!0,purchase:!1,maintenance:!1,usage:!1}),$t=n=>{var e;return{itemName:n.name||n.item||"",category:n.category||"",id:Ft(n),location:n.location||"",status:n.status||"",quantity:n.quantity||1,unitCost:n.unit_cost||0,minimumQuantity:n.reorder_point||0,maximumQuantity:((e=n.data)==null?void 0:e.maximumQuantity)||0,supplier:n.supplier||"",updated_at:n.updated_at||new Date().toISOString(),createdAt:n.created_at||new Date().toISOString()}};var Ut=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class ue{static readFileContent(e){return Ut(this,null,function*(){return new Promise((t,r)=>{const s=new globalThis.FileReader;s.onload=o=>{var c;const i=(c=o.target)==null?void 0:c.result;typeof i=="string"?t(i):r(new Error("Failed to read file as text"))},s.onerror=()=>r(new Error("Failed to read file")),s.readAsText(e)})})}static validateFileFormat(e,t){var r;const s=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();switch(t){case"csv":return s==="csv";case"json":return s==="json";default:return!1}}static getFileSizeMB(e){return e.size/(1024*1024)}}var Rt=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class qt{static parseContent(e,t){return Rt(this,null,function*(){switch(t.format){case"csv":return this.parseCSV(e,t);case"json":return this.parseJSON(e);default:throw new Error(`Unsupported format: ${t.format}`)}})}static parseCSV(e,t){const r=e.split(`
`).filter(c=>c.trim());if(r.length===0)return[];const s=r[0].split(",").map(c=>c.trim().replace(/"/g,""));return(t.hasHeaders?r.slice(1):r).map(c=>{const i=c.split(",").map(l=>l.trim().replace(/"/g,"")),a={};return s.forEach((l,m)=>{const h=i[m];if(h){const b=this.mapFieldName(l,t.customFieldMapping);b&&(a[b]=this.convertValue(h,b))}}),a})}static parseJSON(e){try{const t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch(t){throw new Error("Invalid JSON format")}}static mapFieldName(e,t){return t&&t[e]?t[e]:{name:"itemName",item_name:"itemName","item name":"itemName",category:"category",location:"location",status:"status",quantity:"quantity",qty:"quantity",unit_cost:"unitCost","unit cost":"unitCost",cost:"unitCost",min_quantity:"minimumQuantity","min qty":"minimumQuantity",max_quantity:"maximumQuantity","max qty":"maximumQuantity",supplier:"supplier",barcode:"barcode",sku:"sku",description:"description",notes:"notes"}[e.toLowerCase()]||null}static convertValue(e,t){if(["quantity","unitCost","minimumQuantity","maximumQuantity"].includes(t)){const r=parseFloat(e);return isNaN(r)?0:r}return["isTracked","isFavorite"].includes(t)?e.toLowerCase()==="true"||e==="1":e}}var ke=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class ze{static validateItems(e,t=!1){return ke(this,null,function*(){if(t)return{isValid:!0,errors:[],warnings:[],validItems:e,invalidItems:[]};const r=[],s=[],o=[],c=[];for(const i of e){const a=[],l=[];(!i.name||i.name.trim()==="")&&a.push("Item name is required"),(!i.category||i.category.trim()==="")&&a.push("Category is required"),(!i.location||i.location.trim()==="")&&a.push("Location is required"),i.quantity!==void 0&&(isNaN(i.quantity)||i.quantity<0)&&a.push("Quantity must be a positive number"),i.unit_cost!==void 0&&(isNaN(i.unit_cost)||i.unit_cost<0)&&a.push("Unit cost must be a positive number"),i.reorder_point!==void 0&&(isNaN(i.reorder_point)||i.reorder_point<0)&&a.push("Reorder point must be a positive number"),i.quantity!==void 0&&i.reorder_point!==void 0&&i.quantity<i.reorder_point&&l.push("Quantity is below reorder point"),i.quantity!==void 0&&i.reorder_point!==void 0&&i.quantity<i.reorder_point&&l.push("Quantity is below reorder point"),i.name&&i.name.length>100&&l.push("Item name is very long"),a.length>0?(c.push({item:i,errors:a}),r.push(...a.map(m=>`${i.name||"Unknown item"}: ${m}`))):o.push(i),s.push(...l.map(m=>`${i.name||"Unknown item"}: ${m}`))}return{isValid:c.length===0,errors:r,warnings:s,validItems:o,invalidItems:c}})}static checkForDuplicate(e,t){return ke(this,null,function*(){if(e.barcode){const r=t.find(s=>s.barcode===e.barcode);if(r)return r}if(e.sku){const r=t.find(s=>s.sku===e.sku);if(r)return r}if(e.name&&e.location){const r=t.find(s=>{var o,c;return((o=s.name)==null?void 0:o.toLowerCase())===e.name.toLowerCase()&&((c=s.location)==null?void 0:c.toLowerCase())===e.location.toLowerCase()});if(r)return r}return null})}}var Lt=Object.defineProperty,je=Object.getOwnPropertySymbols,Bt=Object.prototype.hasOwnProperty,Ht=Object.prototype.propertyIsEnumerable,Me=(n,e,t)=>e in n?Lt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,De=(n,e)=>{for(var t in e||(e={}))Bt.call(e,t)&&Me(n,t,e[t]);if(je)for(var t of je(e))Ht.call(e,t)&&Me(n,t,e[t]);return n},zt=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class Vt{static processImport(e,t,r){return zt(this,null,function*(){let s=0,o=0,c=0;const i=[],a=[];for(const l of e)try{const m=yield ze.checkForDuplicate(l,r);if(m)switch(t.duplicateHandling){case"skip":c++,a.push(`Skipped duplicate item: ${l.name}`);continue;case"update":{const h=De(De({},m),l);yield z.updateItem(h.id,h),s++;break}case"create":default:yield z.createItem(l),s++;break}else yield z.createItem(l),s++}catch(m){o++,i.push(`Failed to import ${l.name}: ${m instanceof Error?m.message:"Unknown error"}`)}return{success:o===0,importedCount:s,failedCount:o,skippedCount:c,errors:i,warnings:a,fileName:""}})}}var Wt=Object.defineProperty,Qt=Object.defineProperties,Yt=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,Kt=Object.prototype.hasOwnProperty,Jt=Object.prototype.propertyIsEnumerable,Te=(n,e,t)=>e in n?Wt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xt=(n,e)=>{for(var t in e||(e={}))Kt.call(e,t)&&Te(n,t,e[t]);if(Ne)for(var t of Ne(e))Jt.call(e,t)&&Te(n,t,e[t]);return n},Zt=(n,e)=>Qt(n,Yt(e)),Gt=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class rn{static importItems(e){return Gt(this,arguments,function*(t,r={format:"csv",hasHeaders:!0}){try{if(!ue.validateFileFormat(t,r.format))throw new Error(`Invalid file format. Expected ${r.format} file.`);if(ue.getFileSizeMB(t)>10)throw new Error("File size exceeds 10MB limit");const o=yield ue.readFileContent(t),c=yield qt.parseContent(o,r);if(c.length===0)return{success:!0,importedCount:0,failedCount:0,skippedCount:0,errors:[],warnings:["No items found in file"],fileName:t.name};const i=yield ze.validateItems(c,r.skipValidation);if(!i.isValid)return{success:!1,importedCount:0,failedCount:i.invalidItems.length,skippedCount:0,errors:i.errors,warnings:i.warnings,fileName:t.name};const a=yield z.getAllItems(),l=yield Vt.processImport(i.validItems,r,a);return Zt(Xt({},l),{fileName:t.name,warnings:[...l.warnings,...i.warnings]})}catch(s){return{success:!1,importedCount:0,failedCount:0,skippedCount:0,errors:[s instanceof Error?s.message:"Unknown error occurred"],warnings:[],fileName:t.name}}})}static getSupportedFormats(){return["csv","json"]}static getMaxFileSizeMB(){return 10}}class C{static initializeMetrics(e,t){const r={startTime:Date.now(),totalItems:t.totalItems,processedItems:0,failedItems:0,averageProcessingTime:0,peakMemoryUsage:0,averageMemoryUsage:0,processingRate:0,cacheHitRate:0,concurrentWorkers:t.maxConcurrentWorkers};return this.performanceMetrics.set(e,r),r}static updateMetrics(e,t){const r=this.performanceMetrics.get(e);r&&(Object.assign(r,t),this.performanceMetrics.set(e,r))}static finalizeMetrics(e){const t=this.performanceMetrics.get(e);return t&&(t.endTime=Date.now(),t.averageProcessingTime=t.processedItems>0?(t.endTime-t.startTime)/t.processedItems:0,t.peakMemoryUsage=Math.max(...this.memoryUsageHistory),t.averageMemoryUsage=this.memoryUsageHistory.length>0?this.memoryUsageHistory.reduce((r,s)=>r+s,0)/this.memoryUsageHistory.length:0,t.processingRate=this.calculateProcessingRate(t.startTime,t.processedItems),t.cacheHitRate=this.calculateCacheHitRate(),this.performanceMetrics.set(e,t)),t}static getPerformanceMetrics(e){return this.performanceMetrics.get(e)}static getAllPerformanceMetrics(){return Array.from(this.performanceMetrics.values())}static clearPerformanceMetrics(){this.performanceMetrics.clear()}static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory,t=(e==null?void 0:e.usedJSHeapSize)||0;return this.memoryUsageHistory.push(t),t}return 0}static calculateProcessingRate(e,t){if(t===0)return 0;const r=(Date.now()-e)/1e3;return Math.round(t/r)}static calculateCacheHitRate(){return 0}static calculateEstimatedTime(e,t,r){if(t===0)return;const s=Date.now()-e,o=t/s,c=r-t;return Math.round(c/o)}static clearMemoryHistory(){this.memoryUsageHistory=[]}static generateOperationId(){return`bulk-op-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}C.performanceMetrics=new Map;C.memoryUsageHistory=[];class H{static initializeCache(e=this.DEFAULT_CACHE_SIZE){this.operationCache.clear();const t=this.operationCache.set.bind(this.operationCache);this.operationCache.set=(r,s)=>{if(this.operationCache.size>=e){const o=this.operationCache.keys().next().value;o&&this.operationCache.delete(o)}return t(r,s)}}static getCachedResult(e){return this.operationCache.get(e)}static hasCachedResult(e){return this.operationCache.has(e)}static cacheResult(e,t){this.operationCache.set(e,t)}static getCacheStats(){return{size:this.operationCache.size,hitRate:this.calculateCacheHitRate()}}static clearCache(){this.operationCache.clear()}static calculateCacheHitRate(){return 0}}H.operationCache=new Map;H.DEFAULT_CACHE_SIZE=1e3;var de=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class ne{static createWorkerPool(e=this.DEFAULT_MAX_WORKERS){return Array.from({length:e},()=>()=>de(this,null,function*(){return Promise.resolve()}))}static cleanupWorkerPool(e){e.length=0}static processBatchConcurrent(e,t,r,s,o){return de(this,null,function*(){const c=e.map(l=>de(null,null,function*(){var m,h;try{const b=yield t(l);return(m=o.onSuccess)==null||m.call(o,b,l),b}catch(b){const p=b instanceof Error?b.message:"Unknown error";throw(h=o.onError)==null||h.call(o,p,l),b}})),i=Math.min(r.length,c.length),a=this.chunkArray(c,i);for(const l of a)yield Promise.allSettled(l)})}static chunkArray(e,t){const r=[];for(let s=0;s<e.length;s+=t)r.push(e.slice(s,s+t));return r}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}}ne.DEFAULT_MAX_WORKERS=4;var er=Object.defineProperty,tr=Object.defineProperties,rr=Object.getOwnPropertyDescriptors,Pe=Object.getOwnPropertySymbols,nr=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable,Fe=(n,e,t)=>e in n?er(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,sr=(n,e)=>{for(var t in e||(e={}))nr.call(e,t)&&Fe(n,t,e[t]);if(Pe)for(var t of Pe(e))ar.call(e,t)&&Fe(n,t,e[t]);return n},ir=(n,e)=>tr(n,rr(e));class O{static createProgress(e,t,r,s,o,c,i,a){const l=C.getMemoryUsage(),m=C.calculateProcessingRate(i,t),h=C.calculateEstimatedTime(i,t,e);return{total:e,completed:t,failed:r,inProgress:s,percentage:Math.round(t/e*100),currentBatch:o,totalBatches:c,estimatedTimeRemaining:h,errors:[],memoryUsage:l,processingRate:m,concurrentWorkers:a}}static updateProgressWithErrors(e,t){return ir(sr({},e),{errors:t.slice(-10)})}static notifyProgress(e,t){e==null||e(t)}static notifyError(e,t,r){e==null||e(t,r)}static notifySuccess(e,t,r){e==null||e(t,r)}static notifyMemoryWarning(e,t,r){e==null||e(t,r)}static isMemoryUsageHigh(e,t,r=.8){return e>t*r}}var me=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class Ae{static withRetry(e,t=3,r=100,s){return me(this,null,function*(){const o=yield ot.executeWithRetry(e,{maxRetries:t,baseDelay:r,backoffStrategy:"linear",retryCondition:c=>(s==null||s(o.attempts,c),!0)});if(!o.success)throw o.error;return o.data})}static delay(e){return new Promise(t=>setTimeout(t,e))}static processItemsWithRetry(e,t){return me(this,arguments,function*(r,s,o={}){const{maxRetries:c=3,delay:i=1e3,enableRetry:a=!0}=o,l=[],m=[],h=[],b=r.map((p,v)=>me(this,null,function*(){try{let g;return a?g=yield this.withRetry(()=>s(p),c,i,(d,S)=>{console.warn(`Retrying item ${v+1} (attempt ${d}): ${S.message}`)}):g=yield s(p),l.push(g),{success:!0,result:g,item:p}}catch(g){const d=g instanceof Error?g.message:"Unknown error";return h.push(`Item ${v+1}: ${d}`),m.push(p),{success:!1,error:d,item:p}}}));return yield Promise.allSettled(b),{results:l,failed:m,errors:h}})}}class te{static validateConfig(e){const t=[];return e.batchSize!==void 0&&(e.batchSize<1||e.batchSize>1e3)&&t.push("Batch size must be between 1 and 1000"),e.delayBetweenBatches!==void 0&&e.delayBetweenBatches<0&&t.push("Delay between batches must be non-negative"),e.maxConcurrentWorkers!==void 0&&(e.maxConcurrentWorkers<1||e.maxConcurrentWorkers>16)&&t.push("Max concurrent workers must be between 1 and 16"),e.cacheSize!==void 0&&(e.cacheSize<1||e.cacheSize>1e4)&&t.push("Cache size must be between 1 and 10000"),e.memoryLimit!==void 0&&e.memoryLimit<1024*1024&&t.push("Memory limit must be at least 1MB"),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to process."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateOperation(e){const t=[];return(!e||typeof e!="function")&&t.push("Operation must be a function."),{isValid:t.length===0,errors:t}}}class or{static formatProgress(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches} • ${e.percentage}% complete`;let s;if(e.estimatedTimeRemaining){const c=Math.floor(e.estimatedTimeRemaining/6e4),i=Math.floor(e.estimatedTimeRemaining%6e4/1e3);s=c>0?`${c}m ${i}s remaining`:`${i}s remaining`}let o;if(e.processingRate&&e.memoryUsage){const c=Math.round(e.memoryUsage/1048576);o=`${e.processingRate} items/sec • ${c}MB RAM • ${e.concurrentWorkers} workers`}return{status:t,details:r,timeRemaining:s,performance:o}}static formatProgressSimple(e){return`${e.completed}/${e.total} (${e.percentage}%)`}static formatProgressDetailed(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches}`,s=`${e.percentage}% complete`;let o=`${t} • ${r} • ${s}`;if(e.estimatedTimeRemaining){const c=Math.floor(e.estimatedTimeRemaining/6e4),i=Math.floor(e.estimatedTimeRemaining%6e4/1e3),a=c>0?`${c}m ${i}s remaining`:`${i}s remaining`;o+=` • ${a}`}return e.processingRate&&(o+=` • ${e.processingRate} items/sec`),o}}var Z=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class V{static processBulkOperation(e,t){return Z(this,arguments,function*(r,s,o={}){const{batchSize:c=this.DEFAULT_BATCH_SIZE,delayBetweenBatches:i=this.DEFAULT_DELAY,maxConcurrentWorkers:a=this.DEFAULT_MAX_WORKERS,enableCaching:l=!0,cacheSize:m=this.DEFAULT_CACHE_SIZE,memoryLimit:h=this.DEFAULT_MEMORY_LIMIT,onProgress:b,onError:p,onSuccess:v,onMemoryWarning:g}=o,d=te.validateItems(r);if(!d.isValid)throw new Error(d.errors.join(", "));const S=te.validateConfig(o);if(!S.isValid)throw new Error(S.errors.join(", "));const w=te.validateOperation(s);if(!w.isValid)throw new Error(w.errors.join(", "));const I=C.generateOperationId(),R=C.initializeMetrics(I,{totalItems:r.length,maxConcurrentWorkers:a});l&&H.initializeCache(m);const P=[],F=[],M=[],E=Math.ceil(r.length/c),W=Date.now(),q=ne.createWorkerPool(a);try{for(let k=0;k<E;k++){const L=C.getMemoryUsage();O.isMemoryUsageHigh(L,h,this.MEMORY_WARNING_THRESHOLD)&&O.notifyMemoryWarning(g,L,h);const x=k*c,A=Math.min(x+c,r.length),Q=r.slice(x,A);yield ne.processBatchConcurrent(Q,s,q,l,{onError:(Y,K)=>{M.push(`Item ${Q.indexOf(K)+1}: ${Y}`),F.push(K),C.updateMetrics(I,{failedItems:R.failedItems+1}),O.notifyError(p,Y,K.id||"unknown")},onSuccess:(Y,K)=>{P.push(Y),C.updateMetrics(I,{processedItems:R.processedItems+1}),O.notifySuccess(v,Y,K.id||"unknown")}});const oe=P.length,le=F.length,f=Q.length,j=r.length,Xe=O.createProgress(j,oe,le,f,k+1,E,W,a),Ze=O.updateProgressWithErrors(Xe,M);O.notifyProgress(b,Ze),k<E-1&&i>0&&(yield Ae.delay(i))}return C.finalizeMetrics(I),{results:P,failed:F,errors:M,metrics:C.getPerformanceMetrics(I)}}finally{ne.cleanupWorkerPool(q),H.clearCache(),C.clearMemoryHistory()}})}static simpleBulkOperation(e,t){return Z(this,null,function*(){const r=[],s=[],o=[],c=e.map((i,a)=>Z(null,null,function*(){try{const l=yield t(i);return r.push(l),{success:!0,result:l,item:i}}catch(l){const m=l instanceof Error?l.message:"Unknown error";return o.push(`Item ${a+1}: ${m}`),s.push(i),{success:!1,error:m,item:i}}}));return yield Promise.allSettled(c),{results:r,failed:s,errors:o}})}static simpleBulkOperationWithRetry(e,t,r){return Z(this,null,function*(){return Ae.processItemsWithRetry(e,t,r)})}static standardBulkOperation(e,t,r){return Z(this,null,function*(){const s=[],o=[],c=[];for(let i=0;i<e.length;i++){try{const a=yield t(e[i]);s.push(a)}catch(a){const l=a instanceof Error?a.message:"Unknown error";c.push(`Item ${i+1}: ${l}`),o.push(e[i])}r==null||r(i+1,e.length)}return{results:s,failed:o,errors:c}})}static validateConfig(e){return te.validateConfig(e)}static formatProgress(e){return or.formatProgress(e)}static getPerformanceMetrics(e){return C.getPerformanceMetrics(e)}static getAllPerformanceMetrics(){return C.getAllPerformanceMetrics()}static clearPerformanceMetrics(){C.clearPerformanceMetrics()}static getCacheStats(){return H.getCacheStats()}static clearCache(){H.clearCache()}static getDefaultBatchSize(){return this.DEFAULT_BATCH_SIZE}static getDefaultDelay(){return this.DEFAULT_DELAY}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}static getDefaultCacheSize(){return this.DEFAULT_CACHE_SIZE}static getDefaultMemoryLimit(){return this.DEFAULT_MEMORY_LIMIT}}V.DEFAULT_BATCH_SIZE=50;V.DEFAULT_DELAY=100;V.DEFAULT_MAX_WORKERS=4;V.DEFAULT_CACHE_SIZE=1e3;V.DEFAULT_MEMORY_LIMIT=100*1024*1024;V.MEMORY_WARNING_THRESHOLD=.8;var _=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class ae{static handleCreateItem(e,t,r){return _(this,null,function*(){return lt(e,t,r)})}static handleUpdateItem(e,t,r,s){return _(this,null,function*(){return ct(e,t,r,s)})}static handleDeleteItem(e,t,r){return _(this,null,function*(){return ut(e,t,r)})}static handleBulkOperation(e,t,r,s,o){return _(this,null,function*(){return dt(e,t,r,s,o)})}static handleBulkImport(e,t,r,s){return _(this,null,function*(){return mt(e,t,r,s)})}static handleDuplicateItem(e,t,r){return _(this,null,function*(){return ht(e,t,r)})}static handleArchiveItem(e,t,r){return _(this,null,function*(){return pt(e,t,r)})}static getItems(e){return _(this,null,function*(){return ft(e)})}static getItemById(e){return _(this,null,function*(){return yt(e)})}static getItemsByCategory(e){return _(this,null,function*(){return gt(e)})}static getItemsByLocation(e){return _(this,null,function*(){return vt(e)})}static getItemsByStatus(e){return _(this,null,function*(){return bt(e)})}static searchItems(e){return _(this,null,function*(){return St(e)})}static getLowStockItems(){return _(this,null,function*(){return _t()})}static getExpiringItems(e=30){return _(this,null,function*(){return xt(e)})}static bulkUpdateItemsByCategory(e,t){return _(this,null,function*(){return wt(e,t)})}static getSuppliersByFacility(e){return _(this,null,function*(){return yield Ct(e)})}static getInventoryTransactionsByFacility(e){return _(this,null,function*(){return yield It(e)})}static getInventoryCostsByFacility(e){return _(this,null,function*(){return yield Et(e)})}static getEquipmentMaintenanceByFacility(e){return _(this,null,function*(){return yield kt(e)})}}var lr=Object.defineProperty,cr=Object.defineProperties,ur=Object.getOwnPropertyDescriptors,Oe=Object.getOwnPropertySymbols,dr=Object.prototype.hasOwnProperty,mr=Object.prototype.propertyIsEnumerable,$e=(n,e,t)=>e in n?lr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,he=(n,e)=>{for(var t in e||(e={}))dr.call(e,t)&&$e(n,t,e[t]);if(Oe)for(var t of Oe(e))mr.call(e,t)&&$e(n,t,e[t]);return n},Ue=(n,e)=>cr(n,ur(e)),G=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});class Ve{static getTemplates(){return G(this,null,function*(){return[...this.DEFAULT_TEMPLATES]})}static getTemplateById(e){return G(this,null,function*(){return(yield this.getTemplates()).find(r=>r.id===e)||null})}static createTemplate(e){return G(this,null,function*(){const t=Ue(he({},e),{id:`template-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date,updatedAt:new Date});return this.DEFAULT_TEMPLATES.push(t),t})}static updateTemplate(e,t){return G(this,null,function*(){const r=yield this.getTemplateById(e);if(!r)return null;const s=Ue(he(he({},r),t),{updatedAt:new Date}),o=this.DEFAULT_TEMPLATES.findIndex(c=>c.id===e);return o!==-1&&(this.DEFAULT_TEMPLATES[o]=s),s})}static deleteTemplate(e){return G(this,null,function*(){const t=this.DEFAULT_TEMPLATES.findIndex(r=>r.id===e);return t===-1?!1:(this.DEFAULT_TEMPLATES.splice(t,1),!0)})}static applyTemplate(e,t){const r=t.fields.sort((o,c)=>o.order-c.order);let s=e;return t.filters&&t.filters.length>0&&(s=this.applyFilters(e,t.filters)),s.map(o=>{const c={};for(const i of r){const a=o[i.key];i.transform?c[i.label]=i.transform(a):c[i.label]=this.formatValue(a,i.type,t.dateFormat)}return c})}static applyFilters(e,t){return e.filter(r=>t.every(s=>{const o=r[s.field];switch(s.operator){case"equals":return o===s.value;case"contains":return String(o).toLowerCase().includes(String(s.value).toLowerCase());case"startsWith":return String(o).toLowerCase().startsWith(String(s.value).toLowerCase());case"endsWith":return String(o).toLowerCase().endsWith(String(s.value).toLowerCase());case"greaterThan":return Number(o)>Number(s.value);case"lessThan":return Number(o)<Number(s.value);case"between":return Number(o)>=Number(s.value)&&Number(o)<=Number(s.value2);case"in":return Array.isArray(s.value)&&s.value.includes(o);case"notIn":return Array.isArray(s.value)&&!s.value.includes(o);default:return!0}}))}static formatValue(e,t,r){if(e==null)return"";switch(t){case"date":return e instanceof Date?this.formatDate(e,r):e;case"number":return Number(e);case"boolean":return!!e;case"object":return JSON.stringify(e);default:return String(e)}}static formatDate(e,t){const r=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0"),l=String(e.getMilliseconds()).padStart(3,"0");return t.replace("YYYY",String(r)).replace("MM",s).replace("DD",o).replace("HH",c).replace("mm",i).replace("ss",a).replace("SSS",l)}static generateFileName(e){const t=new Date,r=this.formatDate(t,"YYYY-MM-DD"),s=this.formatDate(t,"HH-mm-ss");return e.fileNamePattern.replace("{date}",r).replace("{time}",s).replace("{timestamp}",`${r}_${s}`)}static validateTemplate(e){var t,r;const s=[];if((t=e.name)!=null&&t.trim()||s.push("Template name is required"),(!e.format||!["csv","json","excel"].includes(e.format))&&s.push("Invalid format. Must be csv, json, or excel."),(!e.fields||e.fields.length===0)&&s.push("At least one field is required"),(r=e.fileNamePattern)!=null&&r.trim()||s.push("File name pattern is required"),e.fields){const o=e.fields.map(i=>i.key),c=o.filter((i,a)=>o.indexOf(i)!==a);c.length>0&&s.push(`Duplicate field keys: ${c.join(", ")}`),e.fields.forEach((i,a)=>{var l;i.key||s.push(`Field ${a+1}: Key is required`),(l=i.label)!=null&&l.trim()||s.push(`Field ${a+1}: Label is required`),(i.order===void 0||i.order<0)&&s.push(`Field ${a+1}: Order must be a non-negative number`)})}return{isValid:s.length===0,errors:s}}}Ve.DEFAULT_TEMPLATES=[{id:"basic-csv",name:"Basic CSV Export",description:"Standard CSV export with essential fields",format:"csv",fields:[{key:"id",label:"ID",type:"string",required:!0,order:1},{key:"name",label:"Item Name",type:"string",required:!0,order:2},{key:"category",label:"Category",type:"string",required:!0,order:3},{key:"location",label:"Location",type:"string",required:!0,order:4},{key:"status",label:"Status",type:"string",required:!0,order:5},{key:"quantity",label:"Quantity",type:"number",required:!0,order:6},{key:"cost",label:"Cost",type:"number",required:!0,order:7},{key:"vendor",label:"Vendor",type:"string",required:!1,order:8},{key:"purchaseDate",label:"Purchase Date",type:"date",required:!1,order:9},{key:"lastUpdated",label:"Last Updated",type:"date",required:!1,order:10}],includeHeaders:!0,dateFormat:"YYYY-MM-DD",fileNamePattern:"inventory_export_{date}.csv",isDefault:!0,createdAt:new Date,updatedAt:new Date},{id:"detailed-json",name:"Detailed JSON Export",description:"Complete inventory data in JSON format",format:"json",fields:[{key:"id",label:"ID",type:"string",required:!0,order:1},{key:"name",label:"Item Name",type:"string",required:!0,order:2},{key:"category",label:"Category",type:"string",required:!0,order:3},{key:"location",label:"Location",type:"string",required:!0,order:4},{key:"status",label:"Status",type:"string",required:!0,order:5},{key:"quantity",label:"Quantity",type:"number",required:!0,order:6},{key:"cost",label:"Cost",type:"number",required:!0,order:7},{key:"vendor",label:"Vendor",type:"string",required:!1,order:8},{key:"purchaseDate",label:"Purchase Date",type:"date",required:!1,order:9},{key:"warranty",label:"Warranty",type:"string",required:!1,order:10},{key:"maintenanceSchedule",label:"Maintenance Schedule",type:"string",required:!1,order:11},{key:"lastServiced",label:"Last Serviced",type:"date",required:!1,order:12},{key:"nextDue",label:"Next Due",type:"date",required:!1,order:13},{key:"serviceProvider",label:"Service Provider",type:"string",required:!1,order:14},{key:"assignedTo",label:"Assigned To",type:"string",required:!1,order:15},{key:"notes",label:"Notes",type:"string",required:!1,order:16},{key:"lastUpdated",label:"Last Updated",type:"date",required:!1,order:17}],includeHeaders:!1,dateFormat:"YYYY-MM-DDTHH:mm:ss.SSSZ",fileNamePattern:"inventory_detailed_{date}.json",createdAt:new Date,updatedAt:new Date},{id:"low-stock-alert",name:"Low Stock Alert",description:"Export items with low quantity for reordering",format:"csv",fields:[{key:"id",label:"ID",type:"string",required:!0,order:1},{key:"name",label:"Item Name",type:"string",required:!0,order:2},{key:"category",label:"Category",type:"string",required:!0,order:3},{key:"location",label:"Location",type:"string",required:!0,order:4},{key:"quantity",label:"Current Quantity",type:"number",required:!0,order:5},{key:"vendor",label:"Vendor",type:"string",required:!1,order:6},{key:"cost",label:"Unit Cost",type:"number",required:!0,order:7}],filters:[{field:"quantity",operator:"lessThan",value:10},{field:"status",operator:"equals",value:"active"}],includeHeaders:!0,dateFormat:"YYYY-MM-DD",fileNamePattern:"low_stock_alert_{date}.csv",createdAt:new Date,updatedAt:new Date}];const hr=Object.freeze(Object.defineProperty({__proto__:null,InventoryExportTemplateService:Ve},Symbol.toStringTag,{value:"Module"})),pr=({children:n})=>u.jsx("div",{className:"space-y-6",children:n}),fr=({children:n})=>u.jsx(u.Fragment,{children:n});function yr({scanMode:n,scannedItems:e,currentScannedItemIndex:t,setCurrentScannedItemIndex:r,resetScannedItems:s,handleCloseAddModal:o,handleOpenAddItemModalWithBarcode:c}){const i=y.useCallback(()=>{if(n==="add"&&e.length>0){const l=t+1;l<e.length?(r(l),c(e[l])):(r(0),s())}},[n,e,t,r,s,o,c]),a=y.useCallback(()=>{if(n==="add"&&e.length>0){const l=e[t],m=l.split("-"),h=m.length>=3?m.slice(2).join("-"):l;return{current:t+1,total:e.length,currentItemName:h}}},[n,e,t]);return{handleAddItemModalClosed:i,getProgressInfo:a}}const gr=n=>{var e;if(!n)return null;const t=n.split("-");if(t.length>=3){const r=((e=t[0])==null?void 0:e.toUpperCase())||"",s=t[1]||"",o=t.slice(2).join("-");let c="tools";if(r==="TOOL")c="tools";else if(r==="SUPPLY")c="supplies";else if(r==="EQUIP")c="equipment";else if(r==="HARDWARE")c="officeHardware";else if(r==="INV"){const i=o.toLowerCase();i.includes("scissors")||i.includes("forceps")||i.includes("scalpel")?c="tools":i.includes("bandage")||i.includes("gauze")||i.includes("tape")?c="supplies":i.includes("monitor")||i.includes("machine")||i.includes("device")?c="equipment":c="tools"}return{itemId:s,itemName:o,category:c}}return n.length>0?{itemId:n||"",itemName:n||"",category:"tools"}:null},We=n=>{if(!n)return{item:"",category:"",toolId:"",location:"",cost:0,p2Status:"clean",barcode:""};const e=gr(n);return e?{item:e.itemName,category:e.category,toolId:e.itemId,location:"",cost:0,p2Status:"clean",barcode:n}:{item:n,category:"tools",toolId:n,location:"",cost:0,p2Status:"clean",barcode:n}},Qe=n=>{const e=We(n);return{itemName:e.item,category:e.category,id:e.toolId,location:e.location,purchaseDate:"",vendor:"",cost:e.cost.toString(),warranty:"",maintenanceSchedule:"",lastServiced:"",nextDue:"",serviceProvider:"",assignedTo:"",status:e.p2Status,quantity:"1",notes:"",barcode:e.barcode}},Ye=n=>({id:n.id,itemName:n.itemName,category:n.category,location:n.location,status:n.status,quantity:parseInt(n.quantity)||1,unitCost:parseFloat(n.cost)||0,minimumQuantity:0,maximumQuantity:999,supplier:n.vendor,barcode:n.barcode,sku:"",description:"",notes:n.notes,updated_at:new Date().toISOString(),createdAt:n.purchaseDate||new Date().toISOString()}),vr=n=>({id:n.toolId,itemName:n.item,category:n.category,location:n.location,status:n.p2Status,quantity:1,unitCost:n.cost,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:n.barcode,sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}),br=()=>{const{scanMode:n,scannedItems:e,setScanMode:t,resetScannedItems:r,setShowScanModal:s,formData:o,setFormData:c,isEditMode:i}=U(),[a,l]=y.useState(0),m=y.useCallback((p,v)=>{const g=We(v),d=vr(g);c(d),p()},[c]),{getProgressInfo:h}=yr({scanMode:n,scannedItems:e,currentScannedItemIndex:a,setCurrentScannedItemIndex:l,resetScannedItems:r,handleCloseAddModal:()=>{},handleOpenAddItemModalWithBarcode:p=>m(()=>{},p)}),b=y.useCallback(()=>{t(null),r(),s(!0)},[t,r,s]);return{scanMode:n,scannedItems:e,currentScannedItemIndex:a,storeFormData:o,isEditMode:i,handleScanClick:b,handleOpenAddItemModalWithBarcode:m,getProgressInfo:h,setFormData:c,setScanMode:t,resetScannedItems:r,setShowScanModal:s}};function Sr(){const n=y.useRef(null),e=y.useRef(new Set),[t,r]=y.useState(!1),s=y.useRef(!1);y.useEffect(()=>{if(!s.current)try{console.log("🔔 Setting up real-time inventory subscription via useInventoryRealtimeUpdates");const a=z.subscribeToChanges(()=>{console.log("Inventory changes detected")});return n.current=a,s.current=!0,setTimeout(()=>{r(!0)},0),()=>{n.current&&typeof n.current=="function"&&(n.current(),n.current=null),r(!1),s.current=!1}}catch(a){console.error("❌ Failed to set up real-time subscription in useInventoryRealtimeUpdates:",a),setTimeout(()=>{r(!1)},0),s.current=!1;return}},[]);const o=y.useCallback(a=>(e.current.add(a),()=>{e.current.delete(a)}),[]),c=y.useCallback(a=>{e.current.delete(a)},[]),i=y.useCallback(()=>{e.current.forEach(a=>{try{a()}catch(l){console.error("Error in refresh callback:",l)}})},[]);return{registerRefreshCallback:o,unregisterRefreshCallback:c,triggerRefresh:i,isSubscribed:t}}function _r({openAddModal:n,closeAddModal:e,setEditMode:t,resetForm:r,setExpandedSections:s,setFormData:o}){const c=y.useCallback(()=>{n(),t(!1),s(Ee())},[n,t,s]),i=y.useCallback(()=>{e(),s(Ee())},[e,r,s]),a=y.useCallback(l=>{let m;const h=l.data;h!=null&&h.toolId?m={id:l.id||"",facility_id:"unknown",name:l.item,quantity:1,data:{toolId:h.toolId,p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:l.category,status:"active",location:l.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:h!=null&&h.supplyId?m={id:l.id||"",facility_id:"unknown",name:l.item,quantity:1,data:{supplyId:h.supplyId,expiration:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:l.category,status:"active",location:l.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:h!=null&&h.equipmentId?m={id:l.id||"",facility_id:"unknown",name:l.item,quantity:1,data:{equipmentId:h.equipmentId,lastServiced:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:l.category,status:"active",location:l.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:h!=null&&h.hardwareId?m={id:l.id||"",facility_id:"unknown",name:l.item,quantity:1,data:{hardwareId:h.hardwareId,warranty:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:l.category,status:"active",location:l.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:m={id:l.id||"",facility_id:"unknown",name:l.item,quantity:1,data:{toolId:"",p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:l.category,status:"active",location:l.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null},o($t(m)),t(!0),n()},[o,t,n]);return{handleShowAddModal:c,handleCloseAddModal:i,handleEditClick:a}}const xr=({expandedSections:n,setExpandedSections:e,mergeFormData:t})=>({handleFormChangeWrapper:(s,o)=>{if(console.log("🛠 handleFormChangeWrapper invoked. Field:",s,"Value:",o,"mergeFormData type:",typeof t),typeof t!="function"){console.error("❌ mergeFormData is not a function inside useInventoryFormHandlers!");return}t(s==="category"?{category:o}:{[s]:o})},handleToggleSection:s=>{e(n.includes(s)?n.filter(o=>o!==s):[...n,s])}});function wr(n,e){return{handleToggleFavorite:y.useCallback(r=>{const s=At(new Set(n),r);e(Array.from(s))},[n,e])}}const Cr=()=>{const n=Ge(),e=y.useMemo(()=>[...n.tools,...n.supplies,...n.equipment,...n.officeHardware],[n.tools,n.supplies,n.equipment,n.officeHardware]);return{getAllItems:()=>e,getItemsByCategory:t=>e.filter(s=>{var o;return((o=s.category)==null?void 0:o.toLowerCase())===t.toLowerCase()}),getFilteredItems:n.getFilteredData,getCategories:n.getCategories,fetchData:n.refreshData,inventoryData:e}};var Ir=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});const Ke=()=>{const n=U(),{formData:e,setFormData:t,isEditMode:r,setEditMode:s,favorites:o,setFavorites:c,expandedSections:i,setExpandedSections:a,openAddModal:l,closeAddModal:m,setActiveTab:h,showTrackedOnly:b,setShowTrackedOnly:p,showFavoritesOnly:v,setShowFavoritesOnly:g,searchQuery:d,setSearchQuery:S}=n,w=n.mergeFormData;typeof w!="function"&&console.error("❌ mergeFormData is NOT a function! Store might not be wired correctly."),Cr();const{handleToggleSection:I,handleFormChangeWrapper:R}=xr({expandedSections:i,setExpandedSections:a,mergeFormData:w}),{handleToggleFavorite:P}=wr(o,c),{handleCloneItem:F}=et(),{handleShowAddModal:M,handleCloseAddModal:E}=_r({openAddModal:l,closeAddModal:m,setEditMode:s,resetForm:()=>{},setExpandedSections:a,setFormData:t}),W=y.useCallback(f=>f,[]),q=y.useCallback(f=>f,[]),k=y.useCallback(f=>{h(f)},[h]),L=y.useCallback(()=>{p(!b)},[b,p]),x=y.useCallback(()=>{g(!v)},[v,g]),A=y.useCallback(f=>S(f),[S]),Q=y.useCallback(f=>{const j={itemName:f.name||f.item||"",category:f.category||"",id:f.id,location:f.location||"",createdAt:(f.data&&typeof f.data=="object"&&f.data!==null?f.data.purchaseDate:null)||new Date().toISOString(),supplier:f.supplier||"",unit_cost:f.unit_cost||0,unitCost:f.unit_cost||0,notes:(f.data&&typeof f.data=="object"&&f.data!==null?f.data.notes:null)||"",updated_at:(f.data&&typeof f.data=="object"&&f.data!==null?f.data.lastServiced:null)||new Date().toISOString(),status:f.status||"",quantity:f.quantity||1,reorder_point:f.reorder_point||0,minimumQuantity:0,maximumQuantity:999,barcode:(f.data&&typeof f.data=="object"&&f.data!==null?f.data.barcode:null)||"",sku:(f.data&&typeof f.data=="object"&&f.data!==null?f.data.sku:null)||"",description:(f.data&&typeof f.data=="object"&&f.data!==null?f.data.description:null)||""};t(j),s(!0),l()},[t,s,l]),oe=y.useCallback(()=>Ir(null,null,function*(){if(!e)return;const f={name:e.itemName||"",category:e.category||"",location:e.location||"",status:e.status||"active",quantity:e.quantity||0,unit_cost:e.unitCost||0,description:e.description||"",notes:e.notes||"",supplier:e.supplier||"",barcode:e.barcode||"",sku:e.sku||"",updated_at:new Date().toISOString()};try{r&&e.id?yield ae.handleUpdateItem(e.id,f,()=>console.log("Item updated successfully"),j=>console.error("Update failed:",j)):yield ae.handleCreateItem(f,()=>console.log("Item created successfully"),j=>console.error("Creation failed:",j)),E()}catch(j){console.error("❌ Inventory save failed",j)}}),[e,r,E]),le=y.useMemo(()=>[],[]);return{showTrackedOnly:b,showFavoritesOnly:v,searchQuery:d,expandedSections:i,favorites:o,filteredTools:le,isEditMode:r,handleShowAddModal:M,handleCloseAddModal:E,handleEditItem:Q,handleCloneItem:F,handleToggleTrackedFilter:L,handleToggleFavoritesFilter:x,onCategoryChange:k,setSearchTerm:A,handleSave:oe,handleToggleSection:I,handleFormChangeWrapper:R,handleToggleFavorite:P,getStatusBadge:W,getStatusText:q}},Er=y.createContext(void 0),kr=n=>{const e=Ot(),t="itemName"in n?n.itemName:n.name||n.item||"",r=n.category,s=n.id,o=n.location||"",c=n.unit_cost,i=typeof c=="number"?c.toString()||"0":c||"0",a=n.status||"";return{itemName:String(t||e.itemName||""),category:String(r||e.category||""),id:String(s||e.id||""),location:String(o||e.location||""),status:String(a||e.status),quantity:Number((n==null?void 0:n.quantity)||e.quantity),unitCost:Number(i),minimumQuantity:0,maximumQuantity:Number(e.maximumQuantity),supplier:String((n==null?void 0:n.supplier)||e.supplier||""),barcode:String((n==null?void 0:n.barcode)||e.barcode||""),sku:String((n==null?void 0:n.sku)||e.sku||""),description:String((n==null?void 0:n.description)||e.description||""),notes:String((n==null?void 0:n.notes)||e.notes||""),updated_at:String((n==null?void 0:n.updated_at)||e.updated_at||new Date().toISOString()),createdAt:String((n==null?void 0:n.createdAt)||e.createdAt||new Date().toISOString())}},jr=({isEditMode:n,formData:e,progressInfo:t})=>(Ke(),u.jsx(tt,{}));var Mr=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});const Dr=(n,e="success")=>{switch(e){case"success":T.success(n);break;case"warning":T(n,{icon:"⚠️",style:{background:"#fef3c7",color:"#92400e"}});break;case"error":T.error(n);break;default:T(n)}},Je=({scanMode:n,onScan:e})=>{const[t,r]=y.useState([]),{openAddModal:s,closeScanModal:o,setFormData:c,setEditMode:i,inventoryItems:a,refreshInventoryData:l}=U(),m=y.useCallback(p=>{const v=a.find(g=>{var d;return((d=g.data)==null?void 0:d.barcode)===p||g.id===p});if(v)console.log("Item already exists:",v),Dr(`Item "${v.name}" already exists in inventory.`,"warning");else{const g=Qe(p),d=Ye(g);c(d),i(!1),o(),s()}},[a,c,i,o,s]),h=y.useCallback(p=>Mr(null,null,function*(){var v;try{const{data:g,error:d}=yield $.from("inventory_items").select("*").eq("barcode",p).single();if(d||!g){T.error("Item not found in inventory.");return}const S=Math.max(((v=g.quantity)!=null?v:1)-1,0),{error:w}=yield $.from("inventory_items").update({quantity:S}).eq("id",g.id);if(w){T.error("Failed to update inventory.");return}yield $.from("inventory_usage").insert([{barcode:p,item_id:g.id,facility_id:g.facility_id,user_id:g.user_id||null,action:"use",timestamp:new Date().toISOString()}]),be.analyzeScan({barcode:p,mode:"use",timestamp:new Date().toISOString()}).catch(()=>{}),T.success(`${g.name||"Item"} used successfully.`)}catch(g){console.error("Error in handleUseInventoryWorkflow:",g),T.error("Unexpected error using item.")}}),[]),b=y.useCallback(p=>{if(r(v=>[...v,p]),e)try{e(p)}catch(v){console.error("Error in onScan callback:",v)}n==="use"?h(p):n==="add"&&m(p),be.analyzeScan({barcode:p,mode:n,timestamp:new Date().toISOString()}).catch(()=>{})},[n,m,h,e]);return{scannedBarcodes:t,handleBarcodeScan:b}},Nr=({scanMode:n,onClose:e})=>u.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[u.jsx("div",{className:"flex items-center gap-3",children:u.jsxs("h3",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[u.jsx(ye,{path:re,size:1.2,className:"text-[#4ECDC4] mr-3"}),n?"Inventory Scanner":"Scan Inventory"]})}),u.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:u.jsx(ye,{path:Mt,size:1.2})})]}),Tr=n=>n==="add"?"Add Inventory":"Use Inventory",Pr=n=>`${n} item${n!==1?"s":""}`,Fr=({scanMode:n,scannedItems:e,onSelectMode:t,onClearScannedItems:r,onRemoveScannedItem:s})=>n?u.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[u.jsx("h4",{className:"font-medium mb-2",children:"Scanner Active"}),u.jsx("div",{className:"bg-black h-32 rounded-lg flex items-center justify-center",children:u.jsx("div",{className:"text-white text-sm",children:"Camera Scanner"})})]}),e.length>0&&u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsxs("h4",{className:"font-medium",children:["Scanned Items (",Pr(e.length),")"]}),u.jsx("button",{onClick:()=>{r&&r()},className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Clear All"})]}),u.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 hide-scrollbar",children:e.map(o=>u.jsxs("div",{className:"bg-gray-50 p-2 rounded text-sm flex items-center justify-between",children:[u.jsx("span",{className:"flex-1",children:o}),u.jsx("button",{onClick:()=>{s&&s(o)},className:"ml-2 p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors duration-200",title:"Remove item",children:u.jsx(ce.Icon,{path:Dt,size:.8})})]},o))})]})]})}):u.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:u.jsxs("div",{className:"space-y-3",children:[u.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Select the type of inventory operation you want to perform:"}),u.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:u.jsxs("p",{className:"text-yellow-800 text-xs",children:["💡 ",u.jsx("strong",{children:"Tip:"}),' For items without barcodes, use the "Add Item" button in the appropriate category table.']})}),u.jsx("button",{onClick:()=>t("add"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:u.jsx(ce.Icon,{path:Be,size:1.2,className:"text-green-600"})}),u.jsxs("div",{className:"text-left",children:[u.jsx("h4",{className:"font-semibold text-green-800 text-sm",children:"Add Inventory"}),u.jsx("p",{className:"text-xs text-green-600",children:"Scan barcode to add new items. If no barcode exists, you can add one manually."})]})]})}),u.jsx("button",{onClick:()=>t("use"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:u.jsx(ce.Icon,{path:He,size:1.2,className:"text-blue-600"})}),u.jsxs("div",{className:"text-left",children:[u.jsx("h4",{className:"font-semibold text-blue-800 text-sm",children:"Use Inventory"}),u.jsx("p",{className:"text-xs text-blue-600",children:"Scan barcode to remove items from inventory when they are used."})]})]})})]})});var Re=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});const Ar=({scanMode:n,scannedItems:e,onSelectMode:t})=>{const{openAddModal:r,closeScanModal:s,setFormData:o,setEditMode:c,inventoryItems:i}=U(),a=()=>Re(null,null,function*(){if(n==="add"&&e.length>0){const l=e[0];if(i.find(p=>p.data&&typeof p.data=="object"&&p.data!==null&&"barcode"in p.data&&typeof p.data.barcode=="string"&&p.data.barcode===l||p.id===l)){alert(`Item with barcode ${l} already exists in inventory.`);return}const h=Qe(l),b=Ye(h);o(b),c(!1),s(),r()}else if(n==="use"&&e.length>0){const l=e.map(p=>Re(null,null,function*(){const v=i.find(g=>{var d;return((d=g.data)==null?void 0:d.barcode)===p||g.id===p});if(v)try{return yield z.deleteItem(v.id),console.log("Successfully removed item from inventory:",v.name),{success:!0,item:v}}catch(g){return console.error("Failed to remove item:",v.name,g),{success:!1,item:v,error:g}}else return console.log("Item not found in inventory:",p),{success:!1,item:null,error:"Item not found"}})),m=yield Promise.all(l),h=m.filter(p=>p.success).length,b=m.filter(p=>!p.success).length;h>0&&alert(`Successfully removed ${h} item(s) from inventory.`),b>0&&alert(`Failed to remove ${b} item(s). Please check the console for details.`),s()}});return n?u.jsx("div",{className:"p-6 border-t border-gray-200",children:u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>a().catch(console.error),className:"flex-1 bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#4ECDC4] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:Tr(n)}),u.jsx("button",{onClick:()=>t("add"),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200",children:"Back"})]})}):null},Or=({scanMode:n,scannedItems:e,onClose:t,onSelectMode:r,onScan:s,onProcess:o,onClearScannedItems:c,onOpenAddItemModal:i,onRemoveScannedItem:a})=>{Je({scanMode:n,onScan:s});const l=u.jsx(Tt,{children:u.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999] p-4",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},onClick:t,children:u.jsxs(B.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl overflow-hidden w-full max-w-md shadow-2xl max-h-[90vh] flex flex-col",onClick:m=>m.stopPropagation(),children:[u.jsx(Nr,{scanMode:n,onClose:t}),u.jsx(Fr,{scanMode:n,scannedItems:e,onSelectMode:r,onClearScannedItems:c,onRemoveScannedItem:a}),u.jsx(Ar,{scanMode:n,scannedItems:e,onSelectMode:r,onProcess:o,onClose:t,onOpenAddItemModal:i})]})})});return jt.createPortal(l,document.body)};function $r(){return u.jsx("div",{className:"text-red-600 text-sm p-4",children:"⚠️ Something went wrong loading the Scan Modal. Please refresh or try again later."})}const Ur=()=>{const{showScanModal:n,scanMode:e,scannedItems:t,resetScannedItems:r,setScanMode:s,setShowScanModal:o,addScannedItem:c,removeScannedItem:i}=U(),a=()=>{r(),s(null),o(!1)};return n?u.jsx(Or,{scanMode:e,scannedItems:t,onClose:a,onSelectMode:s,onScan:c,onProcess:()=>{},onClearScannedItems:r,onOpenAddItemModal:()=>{},onRemoveScannedItem:i}):null};function Rr(){return u.jsx(Le,{FallbackComponent:$r,children:u.jsx(Ur,{})})}var qe=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});const qr=y.lazy(()=>se(()=>import("./components-CrSzLpHe.js").then(n=>n.aw),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Lr=y.lazy(()=>se(()=>import("./components-CrSzLpHe.js").then(n=>n.ax),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Br=y.lazy(()=>se(()=>import("./components-CrSzLpHe.js").then(n=>n.ay),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Hr=()=>{const{refreshData:n}=ge(),{registerRefreshCallback:e}=Sr();Se.useEffect(()=>e(()=>{console.log("🔄 InventoryDashboard received real-time update, refreshing data..."),n()}),[n,e]);const{tools:t,supplies:r,equipment:s,officeHardware:o}=ge(),{getProgressInfo:c}=br(),{formData:i,activeTab:a,showDeleteModal:l,itemToDelete:m,closeDeleteModal:h,showTrackedOnly:b,setShowTrackedOnly:p}=U(),v=y.useMemo(()=>kr(i),[i]),{expandedSections:g,handleCloseAddModal:d,handleSave:S,handleToggleSection:w,handleFormChangeWrapper:I,handleEditItem:R,handleCloneItem:P,isEditMode:F}=Ke(),{setActiveTab:M}=U(),E=y.useMemo(()=>{switch(a){case"tools":return t||[];case"supplies":return r||[];case"equipment":return s||[];case"officeHardware":return o||[];default:return t||[]}},[a,t,r,s,o]),W={showTrackedOnly:b,showFavoritesOnly:!1,handleShowAddModal:()=>{},handleCloseAddModal:d,handleToggleTrackedFilter:()=>p(!b),handleToggleFavoritesFilter:()=>{},onCategoryChange:x=>M(x),searchTerm:"",expandedSections:g,favorites:[],filteredTools:[],setSearchTerm:()=>{},handleToggleFavorite:()=>{},handleSave:S,handleToggleSection:w,handleFormChangeWrapper:I,getStatusBadge:x=>x,getStatusText:x=>x},q=x=>qe(null,null,function*(){try{yield ae.handleDeleteItem(x.id,()=>{console.log("Item deleted successfully"),n()},A=>{console.error("Failed to delete item:",A)})}catch(A){console.error("Error in delete handler:",A)}}),k=()=>qe(null,null,function*(){if(m)try{yield ae.handleArchiveItem(m.id,()=>{console.log("Item archived successfully"),h(),n()},x=>{console.error("Failed to archive item:",x)})}catch(x){console.error("Error in archive handler:",x)}}),L={tools:t,supplies:r,equipment:s,officeHardware:o};return Se.useEffect(()=>{console.log("🏠 InventoryDashboard insights data:",{tools:(t==null?void 0:t.length)||0,supplies:(r==null?void 0:r.length)||0,equipment:(s==null?void 0:s.length)||0,officeHardware:(o==null?void 0:o.length)||0,total:((t==null?void 0:t.length)||0)+((r==null?void 0:r.length)||0)+((s==null?void 0:s.length)||0)+((o==null?void 0:o.length)||0)})},[t,r,s,o]),u.jsx(Er.Provider,{value:W,children:u.jsx(Le,{fallback:u.jsx(st,{}),children:u.jsxs("div",{className:"p-6 space-y-6",children:[u.jsx(rt,{}),u.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[u.jsxs("div",{className:"flex flex-col gap-4 lg:w-1/4 pl-4",children:[u.jsx(y.Suspense,{fallback:u.jsx(ve,{}),children:u.jsx(Lr,{data:L})}),u.jsx(y.Suspense,{fallback:u.jsx(ve,{}),children:u.jsx(Br,{onCategoryChange:x=>M(x),counts:{tools:(t==null?void 0:t.length)||0,supplies:(r==null?void 0:r.length)||0,equipment:(s==null?void 0:s.length)||0,officeHardware:(o==null?void 0:o.length)||0}})})]}),u.jsx("div",{className:"flex-1 pr-4",children:u.jsx(y.Suspense,{fallback:u.jsx(nt,{rows:8,columns:5}),children:u.jsx("div",{className:"bg-white rounded-lg shadow p-6 w-full max-w-full flex flex-col min-h-fit",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"inventory table and controls",children:u.jsx(qr,{onEdit:R,onDelete:q,onClone:P,items:E})})})})]}),u.jsx(jr,{isEditMode:F,formData:v,progressInfo:c()}),u.jsx(Rr,{}),u.jsx(at,{show:l,onClose:h,onConfirm:k,item:m,activeTab:a})]})})})};function zr(){function n({children:t}){return u.jsx(pr,{children:u.jsx(it,{children:u.jsx(fr,{children:t})})})}function e(){return u.jsx(Hr,{})}return{ProviderTree:n,PageContent:e}}function Vr(){const{ProviderTree:n,PageContent:e}=zr();return u.jsx(n,{children:u.jsx(e,{})})}const nn=Object.freeze(Object.defineProperty({__proto__:null,default:Vr},Symbol.toStringTag,{value:"Module"}));var pe=(n,e,t)=>new Promise((r,s)=>{var o=a=>{try{i(t.next(a))}catch(l){s(l)}},c=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,c);i((t=t.apply(n,e)).next())});const Wr=()=>{var n;const[e,t]=y.useState(null),[r,s]=y.useState([]),[o,c]=y.useState(!1),[i,a]=y.useState(null),{handleBarcodeScan:l}=Je({scanMode:e,onScan:d=>{s(S=>[...S,d])}}),m=()=>pe(null,null,function*(){e&&(c(!0),a(null),setTimeout(()=>pe(null,null,function*(){const d=["ITEM-001","ITEM-002","ITEM-003","ITEM-004","ITEM-005"],S=d[Math.floor(Math.random()*d.length)];try{l(S),e==="add"?r.includes(S)?a({type:"warning",message:`Item ${S} already scanned.`}):a({type:"success",message:`Item ${S} scanned successfully! Ready to add to inventory.`}):e==="use"&&(r.includes(S)?(a({type:"success",message:`Item ${S} used successfully! Removed from inventory.`}),s(w=>w.filter(I=>I!==S))):a({type:"error",message:`Item ${S} not found in inventory.`}))}catch(w){a({type:"error",message:w instanceof Error?w.message:"Scan failed"})}finally{c(!1)}}),1e3))}),h=d=>pe(null,null,function*(){if(d.trim()){c(!0),a(null);try{l(d),e==="add"?r.includes(d)?a({type:"warning",message:`Item ${d} already scanned.`}):a({type:"success",message:`Item ${d} scanned successfully! Ready to add to inventory.`}):e==="use"&&(r.includes(d)?(a({type:"success",message:`Item ${d} used successfully! Removed from inventory.`}),s(S=>S.filter(w=>w!==d))):a({type:"error",message:`Item ${d} not found in inventory.`}))}catch(S){a({type:"error",message:S instanceof Error?S.message:"Manual scan failed"})}finally{c(!1)}}}),b=[{id:"add",name:"Add Inventory",icon:Be,color:"green",description:"Add new items to inventory"},{id:"use",name:"Use Inventory",icon:He,color:"blue",description:"Remove items from inventory"}],p=d=>{switch(d){case"success":return Nt;case"error":return _e;case"warning":return _e;default:return re}},v=d=>{switch(d){case"success":return"text-green-600";case"error":return"text-red-600";case"warning":return"text-yellow-600";default:return"text-gray-600"}},g=d=>{switch(d){case"success":return"bg-green-100 border-green-200";case"error":return"bg-red-100 border-red-200";case"warning":return"bg-yellow-100 border-yellow-200";default:return"bg-gray-100 border-gray-200"}};return u.jsxs(u.Fragment,{children:[u.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:()=>window.location.href="/inventory"}),u.jsx(B.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:u.jsx("div",{className:"h-full flex flex-col",children:u.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[u.jsxs("div",{className:"p-4 border-b border-gray-200",children:[u.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Inventory Scanner"}),u.jsx("p",{className:"text-gray-600 text-sm",children:"Scan items for inventory management"})]}),u.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",children:e?u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:`border rounded-lg p-4 ${e==="add"?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"}`,children:[u.jsxs("h3",{className:`font-semibold mb-1 ${e==="add"?"text-green-800":"text-blue-800"}`,children:[e.charAt(0).toUpperCase()+e.slice(1)," ","Operation"]}),u.jsx("p",{className:`text-sm ${e==="add"?"text-green-600":"text-blue-600"}`,children:(n=b.find(d=>d.id===e))==null?void 0:n.description})]}),u.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[u.jsx("label",{htmlFor:"manual-barcode-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"Manual Barcode Entry"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{id:"manual-barcode-input",type:"text",placeholder:"Enter barcode manually...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyPress:d=>{if(d.key==="Enter"){const S=d.target;h(S.value),S.value=""}},disabled:o}),u.jsx("button",{onClick:()=>{const d=document.querySelector('input[placeholder="Enter barcode manually..."]');d&&(h(d.value),d.value="")},disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Scan"})]})]}),u.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[u.jsxs("div",{className:"text-center space-y-4",children:[u.jsxs("div",{className:"relative bg-black h-64 rounded-lg overflow-hidden",children:[u.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 to-black"}),u.jsx(B.div,{className:"absolute left-0 right-0 h-1 bg-[#4ECDC4]",animate:{top:["10%","90%","10%"],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),u.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-32 rounded-lg",children:[u.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),u.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),u.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),u.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),u.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[u.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),u.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),u.jsx("button",{onClick:m,disabled:o,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${o?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:u.jsx(ee,{path:re,size:1.5,className:`${o?"text-gray-400":"text-white"}`})})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:o?"Scanning...":"Click to Scan"}),u.jsx("p",{className:"text-gray-600 text-sm",children:o?"Position barcode in camera view":"Use camera to scan item barcode"})]})]}),i&&u.jsx(B.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg border ${g(i.type)}`,children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(ee,{path:p(i.type),size:1,className:v(i.type)}),u.jsx("span",{className:`font-medium ${v(i.type)}`,children:i.message})]})})]}),r.length>0&&u.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[u.jsxs("h4",{className:"font-medium text-gray-800 mb-2",children:["Scanned Items (",r.length,")"]}),u.jsx("div",{className:"space-y-1",children:r.map((d,S)=>u.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[u.jsx(ee,{path:re,size:.8,className:"text-gray-400"}),d]},S))})]}),u.jsx("div",{className:"flex justify-center",children:u.jsx("button",{onClick:()=>{t(null),s([]),a(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"← Back to Operation Selection"})})]}):u.jsxs("div",{className:"space-y-4",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Select Operation"}),u.jsx("div",{className:"space-y-3",children:b.map(d=>u.jsx("button",{onClick:()=>t(d.id),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${d.color==="green"?"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100":"border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100"}`,children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:`p-2 rounded-lg ${d.color==="green"?"bg-green-100":"bg-blue-100"}`,children:u.jsx(ee,{path:d.icon,size:1.2,className:d.color==="green"?"text-green-600":"text-blue-600"})}),u.jsxs("div",{children:[u.jsx("h4",{className:`font-semibold text-sm ${d.color==="green"?"text-green-800":"text-blue-800"}`,children:d.name}),u.jsx("p",{className:`text-xs ${d.color==="green"?"text-green-600":"text-blue-600"}`,children:d.description})]})]})},d.id))})]})})]})})})]})},an=Object.freeze(Object.defineProperty({__proto__:null,default:Wr},Symbol.toStringTag,{value:"Module"}));export{rn as I,an as S,Gr as a,en as b,tn as c,V as d,Pt as e,ae as f,Zr as g,nn as i};
