const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/authService-FlO8B3wl.js","assets/js/login-BkZ1x_Cy.js","assets/js/utils-DSBVV_PW.js","assets/js/vendor-DoALFvsH.js","assets/js/data-73RVSc-N.js","assets/js/ui-DETUEJ2B.js","assets/js/taskService-BiAedh4o.js","assets/js/InventoryServiceFactory-D2ojGv80.js","assets/js/errorHandlingService-_ewckZgi.js","assets/js/settingsService-B82XYdbV.js","assets/js/cleaningScheduleService-F-OKgSSu.js","assets/js/duplicatePreventionService-BEC6oIlE.js","assets/js/RecentActivity-BMQXcSNd.js","assets/js/errors-CdY1Sgot.js","assets/js/BITestResults-7aGgBMEs.js","assets/js/ToolStatus-DmWBGIo_.js","assets/js/InventoryTableSection-BYn7CC1E.js","assets/css/InventoryTableSection-DaaeI-Ht.css","assets/js/InventoryInsightsCard-C4ps1wdx.js","assets/js/CategoriesCard-DV98GOcN.js","assets/js/LibraryFilters-DPffRYxj.js","assets/js/LibraryHeader-n5k2zmOV.js","assets/js/aiSuggestionsService-Dwba7VEh.js","assets/js/index-DqyDB7Pr.js","assets/js/inventoryTransformers-Cr0oYokb.js","assets/js/index-Bt3NXZGL.js","assets/js/index-BYMcqti5.js","assets/js/AuthCallback-D-TiER5V.js","assets/js/HelpArticlePage-C2EX0DJC.js","assets/css/HelpArticlePage-04dAlKem.css"])))=>i.map(i=>d[i]);
var Ah=Object.defineProperty,$h=Object.defineProperties;var Mh=Object.getOwnPropertyDescriptors;var Us=Object.getOwnPropertySymbols;var eo=Object.prototype.hasOwnProperty,to=Object.prototype.propertyIsEnumerable;var Zi=(r,e,t)=>e in r?Ah(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,se=(r,e)=>{for(var t in e||(e={}))eo.call(e,t)&&Zi(r,t,e[t]);if(Us)for(var t of Us(e))to.call(e,t)&&Zi(r,t,e[t]);return r},_e=(r,e)=>$h(r,Mh(e));var Be=(r,e)=>{var t={};for(var n in r)eo.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Us)for(var n of Us(r))e.indexOf(n)<0&&to.call(r,n)&&(t[n]=r[n]);return t};var Hs=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});import{j as s,c as ur,A as Bn,m as ne,n as Bt}from"./utils-DSBVV_PW.js";import{c as Fh,b as ji,a as m,d as qn,N as Ci,e as Rs,u as Br,R as te,L as wu,f as Rr,B as Lh,h as zh,i as ve}from"./vendor-DoALFvsH.js";import{l as $,r as Xe,i as wt,s as _,o as ni,g as Es,R as ro,_ as H,u as hr,h as Bh,j as qh,k as Uh,m as Hh,n as Vh,p as Wh,q as Gh,t as Kh,S as Su,D as Vs,I as nt,v as Qh,E as As,L as Yh,w as Jh,x as Xh,y as Zh,z as ep,A as tp,B as rp,C as so,f as sp,d as np,G as ks,H as ap,J as ip,K as op,M as Rn,N as ra,O as Wr,P as ht,Q as no,T as lp,U as cp,V as dp,W as up,X as ju,Y as mp,Z as hp,$ as pp,a0 as fp}from"./login-BkZ1x_Cy.js";import{c as Nt,u as gp,Q as yp,a as vp}from"./data-73RVSc-N.js";import{I as N,m as $s,a as Un,b as Ae,c as ce,d as Ns,e as mr,f as ir,g as xp,h as Ds,i as Ye,j as Ni,k as Cu,l as pt,n as Ii,o as Ti,p as Nu,q as Iu,r as bp,s as ai,t as Tu,u as Fr,v as _p,w as wp,x as Sp,y as ao,z as An,A as jp,B as En,C as Eu,D as Ms,E as ku,F as Fs,G as ii,H as Du,J as Ei,K as Pu,L as Cp,M as It,N as Ou,O as $n,P as Ru,Q as tt,R as Lr,S as Qe,T as Np,U as Au,V as Ip,W as Mn,X as Tp,Y as $u,Z as Ep,_ as kp,$ as Dp,a0 as Fn,a1 as Mu,a2 as oi,a3 as Pp,a4 as ki,a5 as Hn,a6 as li,a7 as Op,a8 as Rp,a9 as Fu,aa as Lu,ab as Ap,ac as $p,ad as Mp,ae as Fp,af as zu,ag as Bu,ah as sa,ai as Lp,aj as zp,ak as Bp,al as Di,am as qu,an as qp,ao as Up,ap as Hp,aq as Ps,ar as Uu,as as Vp,at as Wp,au as Gp,av as Kp,aw as Qp,ax as io,ay as oo,az as Yp,aA as Jp}from"./errors-CdY1Sgot.js";import{G as Xp,a as Zp}from"./ui-DETUEJ2B.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var Ws={},lo;function ef(){if(lo)return Ws;lo=1;var r=Fh();return Ws.createRoot=r.createRoot,Ws.hydrateRoot=r.hydrateRoot,Ws}var tf=ef();const rf=ji(tf),Hu=m.createContext(void 0),co="cliniio_menu_expanded",sf=({children:r})=>{const[e,t]=m.useState(!0),n=m.useRef(e);m.useEffect(()=>{if(n.current!==e){n.current=e;const d=setTimeout(()=>{try{localStorage.setItem(co,JSON.stringify(e))}catch(u){console.warn("Failed to save menu state to localStorage:",u)}},0);return()=>clearTimeout(d)}},[e]);const a=m.useCallback(()=>{t(!0)},[]),i=m.useCallback(()=>{t(!1)},[]),c=m.useCallback(()=>{t(d=>!d)},[]),l=m.useCallback(()=>{t(!0);try{localStorage.removeItem(co)}catch(d){console.warn("Failed to clear menu state from localStorage:",d)}},[]),o={isDrawerOpen:e,openDrawer:a,closeDrawer:i,toggleDrawer:c,resetToExpanded:l};return s.jsx(Hu.Provider,{value:o,children:r})},Vu=()=>{const r=m.useContext(Hu);if(r===void 0)throw new Error("useNavigation must be used within a NavigationProvider");return r},nf=50;var Gr=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class af{constructor(e="cliniio"){this.cache=new Map,this.namespace=e}getKey(e){return`${this.namespace}:${e}`}get(e){return Gr(this,null,function*(){try{const t=this.cache.get(this.getKey(e));return t&&t.expires>Date.now()?t.value:(t&&this.cache.delete(this.getKey(e)),null)}catch(t){return $.error("In-memory cache get error:",t),null}})}set(e,t){return Gr(this,arguments,function*(n,a,i={}){try{const c=i.ttl||300,l=Date.now()+c*1e3;this.cache.set(this.getKey(n),{value:a,expires:l})}catch(c){$.error("In-memory cache set error:",c)}})}del(e){return Gr(this,null,function*(){try{this.cache.delete(this.getKey(e))}catch(t){$.error("In-memory cache delete error:",t)}})}exists(e){return Gr(this,null,function*(){try{const t=this.cache.get(this.getKey(e));return t?t.expires>Date.now():!1}catch(t){return $.error("In-memory cache exists error:",t),!1}})}clear(){return Gr(this,null,function*(){try{this.cache.clear()}catch(e){$.error("In-memory cache clear error:",e)}})}cleanup(){const e=Date.now();for(const[t,n]of Array.from(this.cache.entries()))n.expires<=e&&this.cache.delete(t)}getStats(){return{size:this.cache.size,isRedis:!1}}}var Kr=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Wu{constructor(e="cliniio"){this.namespace=e,this.fallbackCache=new af(e)}getKey(e){return`${this.namespace}:${e}`}get(e){return Kr(this,null,function*(){try{if(Xe.isHealthy()){const n=yield Xe.getClient().get(this.getKey(e));return n?JSON.parse(n):null}else return yield this.fallbackCache.get(e)}catch(t){return $.error("Cache get error:",t),yield this.fallbackCache.get(e)}})}set(e,t){return Kr(this,arguments,function*(n,a,i={}){try{if(Xe.isHealthy()){const c=Xe.getClient(),l=i.ttl||300;yield c.setEx(this.getKey(n),l,JSON.stringify(a))}else yield this.fallbackCache.set(n,a,i)}catch(c){$.error("Cache set error:",c),yield this.fallbackCache.set(n,a,i)}})}del(e){return Kr(this,null,function*(){try{Xe.isHealthy()?yield Xe.getClient().del(this.getKey(e)):yield this.fallbackCache.del(e)}catch(t){$.error("Cache delete error:",t),yield this.fallbackCache.del(e)}})}exists(e){return Kr(this,null,function*(){try{return Xe.isHealthy()?(yield Xe.getClient().exists(this.getKey(e)))===1:yield this.fallbackCache.exists(e)}catch(t){return $.error("Cache exists error:",t),yield this.fallbackCache.exists(e)}})}clear(){return Kr(this,null,function*(){try{if(Xe.isHealthy()){const e=Xe.getClient(),t=yield e.keys(this.getKey("*"));t.length>0&&(yield e.del(t))}else yield this.fallbackCache.clear()}catch(e){$.error("Cache clear error:",e),yield this.fallbackCache.clear()}})}cleanup(){this.fallbackCache.cleanup()}getStats(){return{size:this.fallbackCache.getStats().size,isRedis:Xe.isHealthy()}}}var Gs=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class of{constructor(){this.CACHE_DURATION=300,this.FACILITY_KEY_PREFIX="facility",this.cache=new Wu("facility")}getFacility(e){return Gs(this,null,function*(){try{const t=`${this.FACILITY_KEY_PREFIX}:${e}`,n=yield this.cache.get(t);return n&&this.isCacheValid(n)?(wt()&&Math.random()<.1&&$.debug(`Facility cache hit for ID: ${e}`),n.facility):(n&&(yield this.cache.del(t)),null)}catch(t){return $.error("Error getting facility from cache:",t),null}})}setFacility(e,t){return Gs(this,null,function*(){try{const n=`${this.FACILITY_KEY_PREFIX}:${e}`,a={facility:t,timestamp:Date.now()};yield this.cache.set(n,a,{ttl:this.CACHE_DURATION}),wt()&&Math.random()<.1&&$.debug(`Facility cached for ID: ${e}`)}catch(n){$.error("Error setting facility in cache:",n)}})}invalidateFacility(e){return Gs(this,null,function*(){try{const t=`${this.FACILITY_KEY_PREFIX}:${e}`;yield this.cache.del(t),$.debug(`Facility cache invalidated for ID: ${e}`)}catch(t){$.error("Error invalidating facility cache:",t)}})}clearAll(){return Gs(this,null,function*(){try{yield this.cache.clear(),$.info("All facility cache cleared")}catch(e){$.error("Error clearing facility cache:",e)}})}isCacheValid(e){return Date.now()-e.timestamp<this.CACHE_DURATION*1e3}getStats(){return this.cache.getStats()}cleanup(){this.cache.cleanup()}}const ot=new of;var Ut=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class at{static getCurrentFacilityId(){return Ut(this,null,function*(){var e;try{if(!_)throw new Error("Supabase client is not initialized");const t=yield _.auth.getUser(),n=(e=t==null?void 0:t.data)==null?void 0:e.user,a=t==null?void 0:t.error,c=`facility:${(n==null?void 0:n.id)||"anon"}`,l=yield ot.getFacility(c);if(l)return l.id;if(a||!n){if(wt()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const h={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield ot.setFacility(c,h);else throw new Error("Facility lookup failed in production â€” no fallback to dev facility allowed.");return h.id}return console.warn("User not authenticated - returning null facility ID"),null}const{data:o,error:d}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(d||!(o!=null&&o.facility_id)){if(wt()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const h={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield ot.setFacility(c,h);else throw new Error("Facility lookup failed in production â€” no fallback to dev facility allowed.");return h.id}throw new Error("User facility not found")}try{const u=yield this.getFacilityById(o.facility_id);return yield ot.setFacility(c,u),u.id}catch(u){if(wt()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const p={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield ot.setFacility(c,p);else throw new Error("Facility lookup failed in production â€” no fallback to dev facility allowed.");return p.id}throw u}}catch(t){if(console.error("Failed to get current facility ID:",t),wt()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const a={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield ot.setFacility("facility:anon",a);else throw new Error("Facility lookup failed in production â€” no fallback to dev facility allowed.");return a.id}throw t}})}static getFacilityById(e){return Ut(this,null,function*(){try{const t=yield ot.getFacility(e);if(t)return t;if(!_)throw new Error("Supabase client is not initialized");const n=yield _.from("facilities").select("id, name, type, is_active, created_at, updated_at").eq("id",e).single(),a=n==null?void 0:n.data;if((n==null?void 0:n.error)||!a)throw new Error("Facility not found");const c={id:a.id,name:a.name,type:a.type,isActive:a.is_active,createdAt:a.created_at,updatedAt:a.updated_at};return yield ot.setFacility(e,c),c}catch(t){throw console.error("Failed to get facility by ID:",t),t}})}static getCurrentUserId(){return Ut(this,null,function*(){var e;try{if(!_)throw new Error("Supabase client is not initialized");const t=yield _.auth.getUser(),n=(e=t==null?void 0:t.data)==null?void 0:e.user;return(t==null?void 0:t.error)||!n?wt()?"550e8400-e29b-41d4-a716-446655440001":(console.warn("User not authenticated - returning null user ID"),null):n.id}catch(t){if(console.error("Failed to get current user ID:",t),wt())return"550e8400-e29b-41d4-a716-446655440001";throw t}})}static getCurrentUserAndFacility(){return Ut(this,null,function*(){var e;try{if(!_)throw new Error("Supabase client is not initialized");const t=yield _.auth.getUser(),n=(e=t==null?void 0:t.data)==null?void 0:e.user;if((t==null?void 0:t.error)||!n)throw new Error("No authenticated user found");const i=yield _.from("users").select("facility_id").eq("id",n.id).single(),c=i==null?void 0:i.data;if((i==null?void 0:i.error)||!c)throw new Error("Facility ID not found for user");return{userId:n.id,facilityId:c.facility_id}}catch(t){throw console.error("FacilityService.getCurrentUserAndFacility error:",t),t}})}static getAllFacilities(){return Ut(this,arguments,function*(e={}){try{const{page:t=1,limit:n=nf,orderBy:a="name",orderDirection:i="asc"}=e,c=(t-1)*n,{data:l,error:o,count:d}=yield _.from("facilities").select("id, name, type, is_active, created_at, updated_at",{count:"exact"}).order(a,{ascending:i==="asc"}).range(c,c+n-1);if(o)throw o;const u=d||0,h=Math.ceil(u/n);return{data:(l||[]).map(f=>({id:f.id,name:f.name,type:f.type,isActive:f.is_active,createdAt:f.created_at,updatedAt:f.updated_at})),total:u,page:t,limit:n,totalPages:h,hasNext:t<h,hasPrev:t>1}}catch(t){throw console.error("Failed to get all facilities:",t),t}})}static clearCache(){return Ut(this,null,function*(){this.cachedFacility=null,yield ot.clearAll()})}static invalidateFacilityCache(e){return Ut(this,null,function*(){yield ot.invalidateFacility(e)})}static validateFacilityId(e){return!!(e&&e.length>0&&e!=="default-facility-id")}}at.cachedFacility=null;const Re=Object.freeze(Object.defineProperty({__proto__:null,FacilityService:at},Symbol.toStringTag,{value:"Module"}));var lf=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Gu=m.createContext(void 0),cf=({children:r})=>{const[e,t]=m.useState(null),[n,a]=m.useState(!0),[i,c]=m.useState(null),l=()=>(e==null?void 0:e.id)||null,o=()=>lf(null,null,function*(){var d;try{a(!0),c(null);const u=yield at.getCurrentFacilityId();if(!u)throw new Error("No facility ID available - user not authenticated");const h=yield at.getFacilityById(u);t(h),localStorage.setItem("currentFacility",JSON.stringify(h))}catch(u){if(console.warn("âš ï¸ Facility context error, using development fallback:",u),typeof window!="undefined"&&((d=window.location)==null?void 0:d.hostname)==="localhost"){console.warn("Using dev facility fallback in development/test mode");const p={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0};t(p),localStorage.setItem("currentFacility",JSON.stringify(p)),c(null)}else throw new Error("FacilityContext failed to resolve facility ID â€” no fallback allowed in production.")}finally{a(!1)}});return m.useEffect(()=>{if(typeof window!="undefined"&&window.location.pathname==="/login"){a(!1);return}o().catch(d=>{c(d.message)})},[]),s.jsx(Gu.Provider,{value:{currentFacility:e,setCurrentFacility:t,getCurrentFacilityId:l,isLoading:n,error:i,refreshFacility:o},children:r})},Ku=()=>{const r=m.useContext(Gu);if(!r)throw new Error("useFacility must be used within a FacilityProvider");return r};var df=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const qe=({children:r})=>{const e=qn(),[t,n]=m.useState(!0),[a,i]=m.useState(!1);return m.useEffect(()=>{let c=!1;return df(null,null,function*(){try{const{data:{user:o},error:d}=yield _.auth.getUser();c||(d||!o?(console.warn("âš ï¸ ProtectedRoute: blocked due to invalid session"),i(!1),n(!1),yield ni.logSecurityEvent("security.protected_route_blocked","Blocked unauthenticated access attempt",{error:d==null?void 0:d.message,hasUser:!!o})):(i(!0),n(!1)))}catch(o){console.error("âŒ ProtectedRoute session validation failed:",o),c||(i(!1),n(!1),yield ni.logSecurityEvent("security.protected_route_blocked","Protected route validation failed",{error:o instanceof Error?o.message:String(o)}))}}),()=>{c=!0}},[]),t?null:a?s.jsx(s.Fragment,{children:r}):s.jsx(Ci,{to:"/login",state:{from:e},replace:!0})};var lt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class na{static getAvailableKits(e){return lt(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("*").eq("facility_id",e).eq("status","active").gt("quantity",0).gt("expiry_date",new Date().toISOString().split("T")[0]).order("expiry_date",{ascending:!0});if(n)throw new Error(`Failed to get available BI test kits: ${n.message}`);return(t||[]).map(a=>({id:a.id,facility_id:a.facility_id,name:a.name,manufacturer:a.manufacturer,lot_number:a.lot_number,serial_number:a.serial_number||void 0,barcode:a.barcode||void 0,expiry_date:a.expiry_date,incubation_time_minutes:a.incubation_time_minutes,incubation_temperature_celsius:a.incubation_temperature_celsius,quantity:a.quantity,min_quantity:a.min_quantity,max_quantity:a.max_quantity,location:a.location||void 0,status:a.status,supplier:a.supplier||void 0,cost:a.cost||void 0,notes:a.notes||void 0,created_at:a.created_at,updated_at:a.updated_at,created_by:a.created_by||void 0,updated_by:a.updated_by||void 0}))})}static getKitById(e){return lt(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("*").eq("id",e).single();if(n)throw new Error(`Failed to get BI test kit: ${n.message}`);if(!t)throw new Error("BI test kit not found");const a=t;return{id:a.id,facility_id:a.facility_id,name:a.name,manufacturer:a.manufacturer,lot_number:a.lot_number,serial_number:a.serial_number||void 0,barcode:a.barcode||void 0,expiry_date:a.expiry_date,incubation_time_minutes:a.incubation_time_minutes,incubation_temperature_celsius:a.incubation_temperature_celsius,quantity:a.quantity,min_quantity:a.min_quantity,max_quantity:a.max_quantity,location:a.location||void 0,status:a.status,supplier:a.supplier||void 0,cost:a.cost||void 0,notes:a.notes||void 0,created_at:a.created_at,updated_at:a.updated_at,created_by:a.created_by||void 0,updated_by:a.updated_by||void 0}})}static createKit(e){return lt(this,null,function*(){const t={facility_id:e.facility_id,name:e.name,manufacturer:e.manufacturer,lot_number:e.lot_number,serial_number:e.serial_number,barcode:e.barcode,expiry_date:e.expiry_date,incubation_time_minutes:e.incubation_time_minutes,incubation_temperature_celsius:e.incubation_temperature_celsius,quantity:e.quantity,min_quantity:e.min_quantity,max_quantity:e.max_quantity,location:e.location,status:e.status,supplier:e.supplier,cost:e.cost,notes:e.notes,created_by:e.created_by,updated_by:e.updated_by},{data:n,error:a}=yield _.from("bi_test_kits").insert(t).select().single();if(a)throw new Error(`Failed to create BI test kit: ${a.message}`);if(!n)throw new Error("No data returned from BI test kit creation");const i=n;return{id:i.id,facility_id:i.facility_id,name:i.name,manufacturer:i.manufacturer,lot_number:i.lot_number,serial_number:i.serial_number||void 0,barcode:i.barcode||void 0,expiry_date:i.expiry_date,incubation_time_minutes:i.incubation_time_minutes,incubation_temperature_celsius:i.incubation_temperature_celsius,quantity:i.quantity,min_quantity:i.min_quantity,max_quantity:i.max_quantity,location:i.location||void 0,status:i.status,supplier:i.supplier||void 0,cost:i.cost||void 0,notes:i.notes||void 0,created_at:i.created_at,updated_at:i.updated_at,created_by:i.created_by||void 0,updated_by:i.updated_by||void 0}})}static useKit(e){return lt(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("quantity").eq("id",e).single();if(n||!t)throw new Error(`Failed to fetch BI test kit: ${(n==null?void 0:n.message)||"Kit not found"}`);const a=t;if(a.quantity<=0)throw new Error("BI test kit quantity is already 0");const{error:i}=yield _.from("bi_test_kits").update({quantity:a.quantity-1,updated_at:new Date().toISOString()}).eq("id",e);if(i)throw new Error(`Failed to update BI test kit quantity: ${i.message}`)})}static decrementKitQuantity(e){return lt(this,null,function*(){return this.useKit(e)})}static getCurrentTestConditions(){return lt(this,null,function*(){const{data:{user:e},error:t}=yield _.auth.getUser();if(t||!e)throw new Error("User not authenticated");const{data:n,error:a}=yield _.from("users").select("facility_id").eq("id",e.id).single();if(a||!n)throw new Error("User facility not found");const i=n;return{room_temperature_celsius:22,humidity_percent:45,equipment_used:"Standard Incubator",operator_id:e.id,facility_id:i.facility_id,test_date:new Date().toISOString(),environmental_notes:"Standard laboratory conditions"}})}static getFailureReason(){return lt(this,null,function*(){const e="Positive growth detected during incubation period";try{const t=yield this.getCurrentTestConditions();return`${e}. Test conducted at ${t.room_temperature_celsius}Â°C for standard incubation period.`}catch(t){return console.error(t),e}})}static getSkipReason(){return lt(this,null,function*(){return"Test skipped by operator - reason documented in compliance notes"})}static getComplianceNotes(){return lt(this,null,function*(){const e="BI test passed successfully - sterilization process validated";try{const t=yield this.getCurrentTestConditions();return`${e}. Test conditions: ${t.room_temperature_celsius}Â°C, standard incubation period.`}catch(t){return console.error(t),e}})}static checkKitInventory(e){return lt(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("quantity, expiry_date, status").eq("facility_id",e);if(n)throw new Error(`Failed to check kit inventory: ${n.message}`);const a=t||[],i=a.filter(d=>d.status==="active"&&d.quantity>0&&new Date(d.expiry_date)>new Date).reduce((d,u)=>d+u.quantity,0),c=a.filter(d=>new Date(d.expiry_date)<=new Date).length,l=i<5,o=[];return l&&o.push("Order additional BI test kits to maintain adequate inventory"),c>0&&o.push(`Dispose of ${c} expired BI test kit(s)`),{available:i,low_stock:l,expired_count:c,recommendations:o}})}}var uf=Object.defineProperty,mf=Object.defineProperties,hf=Object.getOwnPropertyDescriptors,uo=Object.getOwnPropertySymbols,pf=Object.prototype.hasOwnProperty,ff=Object.prototype.propertyIsEnumerable,mo=(r,e,t)=>e in r?uf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gf=(r,e)=>{for(var t in e||(e={}))pf.call(e,t)&&mo(r,t,e[t]);if(uo)for(var t of uo(e))ff.call(e,t)&&mo(r,t,e[t]);return r},yf=(r,e)=>mf(r,hf(e)),yr=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class qr{static createBITestResult(e){return yr(this,null,function*(){try{const n=new Date().toISOString().split("T")[0].replace(/-/g,""),a=Date.now().toString().slice(-6),i=`BI-${n}-${a}`,c={facility_id:e.facility_id,operator_id:e.operator_id,cycle_id:e.cycle_id||"00000000-0000-0000-0000-000000000000",test_number:i,test_date:e.test_date||new Date().toISOString(),result:e.result,bi_lot_number:e.bi_lot_number,bi_expiry_date:e.bi_expiry_date,incubation_time_minutes:e.incubation_time_minutes,incubation_temperature_celsius:e.incubation_temperature_celsius,test_conditions:e.test_conditions,failure_reason:e.failure_reason,skip_reason:e.skip_reason,compliance_notes:e.compliance_notes};console.log("ðŸ” Inserting BI test data:",JSON.stringify(c,null,2));const{data:l,error:o}=yield _.from("bi_test_results").insert(c).select().single();if(o)throw console.error("âŒ Database error details:",o),o;if(!l||typeof l!="object")throw new Error("Invalid test result data");const d=l;return{id:d.id,facility_id:d.facility_id,operator_id:d.operator_id||void 0,cycle_id:d.cycle_id||void 0,test_number:d.test_number,test_date:d.test_date,result:d.result,status:d.status,bi_lot_number:d.bi_lot_number||void 0,bi_expiry_date:d.bi_expiry_date||void 0,incubation_time_minutes:d.incubation_time_minutes||void 0,incubation_temperature_celsius:d.incubation_temperature_celsius||void 0,test_conditions:d.test_conditions||{},failure_reason:d.failure_reason||void 0,skip_reason:d.skip_reason||void 0,compliance_notes:d.compliance_notes||void 0,audit_signature:d.audit_signature||void 0,created_at:d.created_at,updated_at:d.updated_at}}catch(t){throw console.error("Failed to create BI test result:",t),t}})}static updateBITestResult(e,t){return yr(this,null,function*(){const{data:n,error:a}=yield _.from("bi_test_results").update(yf(gf({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();if(a)throw new Error(`Failed to update BI test result: ${a.message}`);if(!n)throw new Error("No data returned from BI test result update");const i=n;return{id:i.id,facility_id:i.facility_id,operator_id:i.operator_id||void 0,cycle_id:i.cycle_id||void 0,test_number:i.test_number,test_date:i.test_date,result:i.result,status:i.status,bi_lot_number:i.bi_lot_number||void 0,bi_expiry_date:i.bi_expiry_date||void 0,incubation_time_minutes:i.incubation_time_minutes||void 0,incubation_temperature_celsius:i.incubation_temperature_celsius||void 0,test_conditions:i.test_conditions||{},failure_reason:i.failure_reason||void 0,skip_reason:i.skip_reason||void 0,compliance_notes:i.compliance_notes||void 0,audit_signature:i.audit_signature||void 0,created_at:i.created_at,updated_at:i.updated_at}})}static getBITestResults(){return yr(this,arguments,function*(e={}){let t=_.from("bi_test_results").select(`
        *,
        facilities(name, facility_code),
        operators(name, role),
        sterilization_cycles(cycle_number, cycle_type)
      `).order("test_date",{ascending:!1});e.facility_id&&(t=t.eq("facility_id",e.facility_id)),e.operator_id&&(t=t.eq("operator_id",e.operator_id)),e.cycle_id&&(t=t.eq("cycle_id",e.cycle_id)),e.result&&(t=t.eq("result",e.result)),e.status&&(t=t.eq("status",e.status)),e.start_date&&(t=t.gte("test_date",e.start_date)),e.end_date&&(t=t.lte("test_date",e.end_date)),e.limit&&(t=t.limit(e.limit)),e.offset&&(t=t.range(e.offset,e.offset+(e.limit||10)-1));const{data:n,error:a}=yield t;if(a)throw new Error(`Failed to fetch BI test results: ${a.message}`);return(n||[]).map(i=>({id:i.id,facility_id:i.facility_id,operator_id:i.operator_id||void 0,cycle_id:i.cycle_id||void 0,test_number:i.test_number,test_date:i.test_date,result:i.result,status:i.status,bi_lot_number:i.bi_lot_number||void 0,bi_expiry_date:i.bi_expiry_date||void 0,incubation_time_minutes:i.incubation_time_minutes||void 0,incubation_temperature_celsius:i.incubation_temperature_celsius||void 0,test_conditions:i.test_conditions||{},failure_reason:i.failure_reason||void 0,skip_reason:i.skip_reason||void 0,compliance_notes:i.compliance_notes||void 0,audit_signature:i.audit_signature||void 0,created_at:i.created_at,updated_at:i.updated_at}))})}static getBITestResult(e){return yr(this,null,function*(){try{const{data:t,error:n}=yield _.from("bi_test_results").select("*").eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw n}if(!t||typeof t!="object")return null;const a=t;return{id:a.id,facility_id:a.facility_id,operator_id:a.operator_id||void 0,cycle_id:a.cycle_id||void 0,test_number:a.test_number,test_date:a.test_date,result:a.result,status:a.status,bi_lot_number:a.bi_lot_number||void 0,bi_expiry_date:a.bi_expiry_date||void 0,incubation_time_minutes:a.incubation_time_minutes||void 0,incubation_temperature_celsius:a.incubation_temperature_celsius||void 0,test_conditions:a.test_conditions||{},failure_reason:a.failure_reason||void 0,skip_reason:a.skip_reason||void 0,compliance_notes:a.compliance_notes||void 0,audit_signature:a.audit_signature||void 0,created_at:a.created_at,updated_at:a.updated_at}}catch(t){throw console.error("Failed to get BI test result:",t),t}})}static deleteBITestResult(e){return yr(this,null,function*(){const{error:t}=yield _.from("bi_test_results").delete().eq("id",e);if(t)throw new Error(`Failed to delete BI test result: ${t.message}`)})}static generateTestNumber(e){return yr(this,null,function*(){const t=new Date,n=t.toISOString().split("T")[0].replace(/-/g,""),{count:a,error:i}=yield _.from("bi_test_results").select("*",{count:"exact",head:!0}).eq("facility_id",e).gte("test_date",t.toISOString().split("T")[0]).lt("test_date",new Date(t.getTime()+1440*60*1e3).toISOString().split("T")[0]);if(i)throw new Error(`Failed to generate test number: ${i.message}`);return`BI-${n}-${String((a!=null?a:0)+1).padStart(3,"0")}`})}}var vr=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Ls={getBIPassRate(r){return vr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("id").eq("facility_id",r).eq("result","pass");return t?{data:null,error:t}:{data:e.length,error:null}})},getBIPassRateAnalytics(r){return vr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",r);if(t)return{data:null,error:t};const n=e.length,a=e.filter(c=>c.result==="pass").length,i=n>0?a/n*100:0;return{data:{totalTests:n,passedTests:a,passRate:i,facilityId:r},error:null}})},getOperatorPerformance(r,e){return vr(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_results").select("*").eq("facility_id",r).eq("operator_id",e);return n?{data:null,error:n}:{data:t,error:null}})},getBITestAnalytics(r){return vr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",r);return t?{data:null,error:t}:{data:{totalTests:e.length,passedTests:e.filter(a=>a.result==="pass").length,failedTests:e.filter(a=>a.result==="fail").length,facilityId:r},error:null}})},getAITrainingData(r){return vr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",r);return t?{data:null,error:t}:{data:e.map(a=>({id:a.id,facilityId:a.facility_id,operatorId:a.operator_id,result:a.result,timestamp:a.created_at,features:{incubationTemperature:a.incubation_temperature_celsius,incubationTime:a.incubation_time_minutes,testConditions:a.test_conditions,status:a.status}})),error:null}})},getPredictiveAnalyticsData(r){return vr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",r).order("created_at",{ascending:!1}).limit(100);if(t)return{data:null,error:t};const n=e.length,a=e.slice(0,30),i=a.length>0?a.filter(l=>l.result==="pass").length/a.length*100:0;return{data:{facilityId:r,totalTests:n,recentPassRate:i,trendAnalysis:{isImproving:i>80,riskLevel:i<70?"high":i<85?"medium":"low"},recommendations:i<70?["Review sterilization procedures","Check equipment calibration","Retrain operators"]:i<85?["Monitor trends closely","Consider preventive maintenance"]:["Maintain current procedures"]},error:null}})}};var Ht=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Tt{static getFacilities(){return Ht(this,null,function*(){return[{id:"default-facility",name:"Default Facility",facility_code:"DF001",address:void 0,contact_email:void 0,contact_phone:void 0,compliance_requirements:{},settings:{},is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]})}static getOperators(e){return Ht(this,null,function*(){const{data:t,error:n}=yield _.from("users").select("*").eq("facility_id",e).eq("is_active",!0).order("first_name");if(n)throw new Error(`Failed to fetch operators: ${n.message}`);return(t||[]).map(a=>{var i,c,l,o,d;return{id:a.id||"",facility_id:a.facility_id,user_id:a.id||void 0,name:a.full_name||`${a.first_name||""} ${a.last_name||""}`.trim(),email:a.email||void 0,role:((i=a.preferences)==null?void 0:i.role)||"operator",certification_number:((c=a.preferences)==null?void 0:c.certification_number)||void 0,certification_expiry:((l=a.preferences)==null?void 0:l.certification_expiry)||void 0,permissions:((o=a.preferences)==null?void 0:o.permissions)||{},performance_metrics:((d=a.preferences)==null?void 0:d.performance_metrics)||{},is_active:a.is_active||!1,created_at:a.created_at||"",updated_at:a.updated_at||""}})})}static getSterilizationCycles(e,t=50){return Ht(this,null,function*(){const n=`${e}-${t}`,a=this.cache.get(n);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;const{data:i,error:c}=yield _.from("sterilization_cycles").select("id, cycle_number, start_time, end_time, status, parameters, tools").eq("facility_id",e).order("start_time",{ascending:!1}).limit(t);if(c)throw new Error(`Failed to fetch sterilization cycles: ${c.message}`);const l=(i||[]).map(o=>({id:o.id,facility_id:o.facility_id||"",operator_id:o.operator_id||void 0,cycle_number:o.cycle_number||"",cycle_type:o.cycle_type||"standard",status:o.status||"pending",start_time:o.start_time||"",end_time:o.end_time||void 0,phases:o.parameters||[],tools:o.tools||[],cycle_parameters:o.parameters||{},environmental_factors:o.results||{},notes:o.notes||void 0,created_at:o.created_at||"",updated_at:o.updated_at||""}));return this.cache.set(n,{data:l,timestamp:Date.now()}),l})}static createSterilizationCycle(e){return Ht(this,null,function*(){const t=yield this.generateCycleNumber(e.facility_id),n={id:crypto.randomUUID(),facility_id:e.facility_id,operator_id:e.operator_id||"",cycle_type:e.cycle_type||"standard",cycle_number:t,start_time:new Date().toISOString(),status:e.status||"pending",parameters:e.cycle_parameters||{},results:e.environmental_factors||{},tools:e.tools||[],notes:e.notes,autoclave_id:"default-autoclave",tool_batch_id:"default-batch"},{data:a,error:i}=yield _.from("sterilization_cycles").insert(n).select().single();if(i)throw new Error(`Failed to create sterilization cycle: ${i.message}`);if(!a)throw new Error("No data returned from sterilization cycle creation");const c=a;return{id:c.id,facility_id:c.facility_id||"",operator_id:c.operator_id||void 0,cycle_number:c.cycle_number||"",cycle_type:c.cycle_type||"standard",status:c.status||"pending",start_time:c.start_time||"",end_time:c.end_time||void 0,phases:c.tools||[],tools:c.tools||[],cycle_parameters:c.parameters||{},environmental_factors:c.results||{},notes:c.notes||void 0,created_at:c.created_at||"",updated_at:c.updated_at||""}})}static getEquipment(e){return Ht(this,null,function*(){return[]})}static getComplianceAudits(e){return Ht(this,null,function*(){const{data:t,error:n}=yield _.from("audit_logs").select("*").eq("facility_id",e).order("created_at",{ascending:!1});if(n)throw new Error(`Failed to fetch compliance audits: ${n.message}`);return(t||[]).map(a=>{var i,c,l,o,d,u,h,p,f;return{id:a.id||"",facility_id:a.facility_id||"",audit_type:((i=a.metadata)==null?void 0:i.audit_type)||"daily",audit_date:a.created_at,auditor_id:(c=a.user_id)!=null?c:"system",audit_scope:((l=a.metadata)==null?void 0:l.audit_scope)||{},findings:((o=a.metadata)==null?void 0:o.findings)||[],compliance_score:((d=a.metadata)==null?void 0:d.compliance_score)||void 0,recommendations:((u=a.metadata)==null?void 0:u.recommendations)||void 0,corrective_actions:((h=a.metadata)==null?void 0:h.corrective_actions)||[],follow_up_date:((p=a.metadata)==null?void 0:p.follow_up_date)||void 0,status:((f=a.metadata)==null?void 0:f.status)||"pending",created_at:a.created_at,updated_at:a.updated_at||""}})})}static generateCycleNumber(e){return Ht(this,null,function*(){const t=new Date,n=t.toISOString().split("T")[0].replace(/-/g,""),{count:a,error:i}=yield _.from("sterilization_cycles").select("*",{count:"exact",head:!0}).eq("facility_id",e).gte("start_time",t.toISOString().split("T")[0]).lt("start_time",new Date(t.getTime()+1440*60*1e3).toISOString().split("T")[0]);if(i)throw new Error(`Failed to generate cycle number: ${i.message}`);return`CYCLE-${n}-${String((a!=null?a:0)+1).padStart(3,"0")}`})}}Tt.cache=new Map;Tt.CACHE_DURATION=300*1e3;class Qu{static subscribeToBITestChanges(e){if(!Es()){console.warn("âš ï¸ Supabase not configured, skipping BI test subscription");return}try{return ro.subscribe("bi_test_results",e,{event:"*"})}catch(t){return console.error("âŒ Failed to subscribe to BI test changes:",t),null}}static subscribeToCycleChanges(e){if(!Es()){console.warn("âš ï¸ Supabase not configured, skipping cycle subscription");return}try{return ro.subscribe("sterilization_cycles",e,{event:"*"})}catch(t){return console.error("âŒ Failed to subscribe to cycle changes:",t),null}}}class fe{}fe.createBITestResult=qr.createBITestResult;fe.updateBITestResult=qr.updateBITestResult;fe.getBITestResults=qr.getBITestResults;fe.getBITestResult=qr.getBITestResult;fe.deleteBITestResult=qr.deleteBITestResult;fe.getBIPassRateAnalytics=Ls.getBIPassRateAnalytics;fe.getOperatorPerformance=Ls.getOperatorPerformance;fe.getBITestAnalytics=Ls.getBITestAnalytics;fe.getAITrainingData=Ls.getAITrainingData;fe.getPredictiveAnalyticsData=Ls.getPredictiveAnalyticsData;fe.getFacilities=Tt.getFacilities;fe.getOperators=Tt.getOperators;fe.getSterilizationCycles=Tt.getSterilizationCycles;fe.createSterilizationCycle=Tt.createSterilizationCycle;fe.getEquipment=Tt.getEquipment;fe.getComplianceAudits=Tt.getComplianceAudits;fe.subscribeToBITestChanges=Qu.subscribeToBITestChanges;fe.subscribeToCycleChanges=Qu.subscribeToCycleChanges;const ho=r=>{if(!r)return null;const e=localStorage.getItem("officeHoursSettings");if(!e)return po(r,{workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},startHour:8,endHour:17});const t=JSON.parse(e);return po(r,t)},po=(r,e)=>{const t=new Date(r);return t.setHours(t.getHours()+24),vf(t,e)},vf=(r,e)=>{const t=new Date(r),n=t.getDay(),a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i=a[n];if(!e.workingDays[i]){let o=1;for(;o<=7;){const d=new Date(t);d.setDate(d.getDate()+o);const u=d.getDay(),h=a[u];if(e.workingDays[h])return t.setDate(t.getDate()+o),t.setHours(e.startHour,0,0,0),t;o++}}const l=t.getHours();if(l<e.startHour)t.setHours(e.startHour,0,0,0);else if(l>=e.endHour){let o=1;for(;o<=7;){const d=new Date(t);d.setDate(d.getDate()+o);const u=d.getDay(),h=a[u];if(e.workingDays[h])return t.setDate(t.getDate()+o),t.setHours(e.startHour,0,0,0),t;o++}}return t},oP=r=>{const e=new Date,t=r.getTime()-e.getTime(),n=Math.ceil(t/(1e3*60*60*24));return n===0?"Today":n===1?"Tomorrow":n<7?r.toLocaleDateString("en-US",{weekday:"long"}):r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};var xf=Object.defineProperty,bf=Object.defineProperties,_f=Object.getOwnPropertyDescriptors,fo=Object.getOwnPropertySymbols,wf=Object.prototype.hasOwnProperty,Sf=Object.prototype.propertyIsEnumerable,go=(r,e,t)=>e in r?xf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qr=(r,e)=>{for(var t in e||(e={}))wf.call(e,t)&&go(r,t,e[t]);if(fo)for(var t of fo(e))Sf.call(e,t)&&go(r,t,e[t]);return r},Yr=(r,e)=>bf(r,_f(e)),aa=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const jf=r=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null,setBiTestCompleted:e=>r({biTestCompleted:e}),setBiTestDate:e=>r({biTestDate:e}),recordBITestResult:e=>aa(null,null,function*(){console.log("ðŸ”¬ recordBITestResult called with:",e);try{const{data:{user:t},error:n}=yield _.auth.getUser();if(n||!t)throw new Error("User not authenticated");const a="550e8400-e29b-41d4-a716-446655440000",i={facility_id:a};let c=[],l=null,o=null;try{c=yield na.getAvailableKits(i.facility_id),c.length>0&&(l=c[0],o=yield na.getCurrentTestConditions())}catch(h){console.error(h),l={id:"default-kit",facility_id:i.facility_id,name:"Default BI Kit",manufacturer:"Default Manufacturer",lot_number:"DEFAULT-001",expiry_date:new Date(Date.now()+365*24*60*60*1e3).toISOString(),incubation_time_minutes:60,incubation_temperature_celsius:37,quantity:1,min_quantity:1,max_quantity:100,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},o={room_temperature_celsius:22,humidity_percent:45,equipment_used:"Default Equipment",operator:t.id,operator_id:t.id,facility_id:i.facility_id,test_date:new Date().toISOString()}}const d={facility_id:a,operator:t.id,test_date:new Date().toISOString(),result:e.status==="pending"?"pass":e.status,bi_lot_number:(l==null?void 0:l.lot_number)||"",bi_expiry_date:(l==null?void 0:l.expiry_date)||null,incubation_time_minutes:(l==null?void 0:l.incubation_time_minutes)||60,incubation_temperature_celsius:(l==null?void 0:l.incubation_temperature_celsius)||37,test_conditions:o||void 0,failure_reason:e.status==="fail"?"BI test failed":void 0,skip_reason:e.status==="skip"?"BI test skipped":void 0,compliance_notes:e.status==="pass"?"BI test passed":void 0},u=yield fe.createBITestResult(d);if(l&&l.id!=="default-kit")try{yield na.decrementKitQuantity(l.id)}catch(h){console.error(h)}return r(h=>{const p=ho(e.date),f={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:e.passed?"BI Test Passed":"BI Test Failed",time:e.date,toolCount:1,color:e.passed?"bg-green-500":"bg-red-500"},g=Yr(Qr({},e),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});return{biTestCompleted:e.passed,biTestDate:e.date.toISOString(),biTestResults:[...h.biTestResults,g],lastBITestDate:e.date.toISOString(),nextBITestDue:p,biTestPassed:e.passed,activityLog:[f,...h.activityLog].slice(0,20)}}),u}catch(t){throw console.error("Error recording BI test result:",t),r(n=>{const a=ho(e.date),i={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:e.passed?"BI Test Passed":"BI Test Failed",time:e.date,toolCount:1,color:e.passed?"bg-green-500":"bg-red-500"},c=Yr(Qr({},e),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});return{biTestCompleted:e.passed,biTestDate:e.date.toISOString(),biTestResults:[...n.biTestResults,c],lastBITestDate:e.date.toISOString(),nextBITestDue:a,biTestPassed:e.passed,activityLog:[i,...n.activityLog].slice(0,20)}}),t}}),setNextBITestDue:e=>r({nextBITestDue:e}),setLastBITestDate:e=>r({lastBITestDate:e}),setBiTestPassed:e=>r({biTestPassed:e}),setBiTestOptedOut:e=>r({biTestOptedOut:e}),addActivity:e=>r(t=>({activityLog:[Yr(Qr({},e),{id:e.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),...t.activityLog].slice(0,20)})),activateBIFailure:e=>r(()=>({biFailureActive:!0,biFailureDetails:{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:new Date,affectedToolsCount:e.affectedToolsCount,affectedBatchIds:e.affectedBatchIds,operator:e.operator}})),deactivateBIFailure:()=>r(()=>({biFailureActive:!1,biFailureDetails:null})),loadBIFailureIncidents:e=>aa(null,null,function*(){try{const{data:t,error:n}=yield _.from("bi_failure_incidents").select("*").eq("facility_id",e).eq("status","resolved").gte("resolved_at",new Date(Date.now()-2592e6).toISOString()).order("resolved_at",{ascending:!1}).limit(20);if(n){console.error("Failed to load BI failure incidents:",n);return}r(a=>{const i=new Set(a.activityLog.map(o=>o.id)),c=[];(t||[]).forEach(o=>{var d;const u=`bi-incident-resolved-${o.id}`;i.has(u)||c.push({id:u,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date(String(o.resolved_at||o.updated_at)),toolCount:((d=o.metadata)==null?void 0:d.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:o.id,operatorId:o.resolved_by_operator,resolutionNotes:o.resolution_notes}})});const l=[...c,...a.activityLog].sort((o,d)=>new Date(d.time).getTime()-new Date(o.time).getTime()).slice(0,20);return Yr(Qr({},a),{activityLog:l})})}catch(t){console.error("Error loading BI failure incidents:",t)}}),loadBITestResults:e=>aa(null,null,function*(){try{const{data:t,error:n}=yield _.from("bi_test_results").select("*").eq("facility_id",e).order("test_date",{ascending:!1}).limit(50);if(n){console.error("Failed to load BI test results:",n);return}const a=(t||[]).map(i=>({id:String(i.id),facility_id:String(i.facility_id),test_number:String(i.test_number),test_date:String(i.test_date),result:String(i.result),status:String(i.result),operator:String(i.operator),cycle_id:String(i.cycle_id),bi_lot_number:String(i.bi_lot_number),bi_expiry_date:String(i.bi_expiry_date),incubation_time_minutes:Number(i.incubation_time_minutes),incubation_temperature_celsius:Number(i.incubation_temperature_celsius),test_conditions:i.test_conditions||{},failure_reason:String(i.failure_reason),skip_reason:String(i.skip_reason),compliance_notes:String(i.compliance_notes),date:new Date(String(i.test_date)),toolId:String(i.test_number||"default-tool"),passed:i.result==="pass",notes:String(i.compliance_notes||i.failure_reason||i.skip_reason),created_at:String(i.created_at),updated_at:String(i.updated_at)}));r(i=>{const c=new Set(i.activityLog.map(d=>d.id)),l=[];a.forEach(d=>{const u=`bi-test-${d.id}`;c.has(u)||l.push({id:u,type:"bi-test",title:d.passed?"BI Test Passed":"BI Test Failed",time:new Date(String(d.test_date)),toolCount:1,color:d.passed?"bg-green-500":"bg-red-500",metadata:{testNumber:String(d.test_number),operatorId:d.operator}})});const o=[...l,...i.activityLog].sort((d,u)=>new Date(u.time).getTime()-new Date(d.time).getTime()).slice(0,20);return Yr(Qr({},i),{biTestResults:a,activityLog:o})})}catch(t){console.error("Error loading BI test results:",t)}}),syncBIFailureFromDatabase:e=>r({biFailureActive:e.status==="active",biFailureDetails:e.status==="active"?{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:new Date(e.failure_date),affectedToolsCount:e.affected_tools_count,affectedBatchIds:e.affected_batch_ids,operator:e.detected_by_operator||"System Alert"}:null}),resetBIState:()=>r(()=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null}))});var yo=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Cf=r=>({enforceCi:!1,enforceBi:!1,allowOverrides:!0,loading:!1,fetchComplianceSettings:e=>yo(null,null,function*(){var t,n,a;r({loading:!0});const{data:i,error:c}=yield _.from("facility_compliance_settings").select("enforce_ci, enforce_bi, allow_overrides").eq("facility_id",e).maybeSingle();c?console.error("Failed to fetch compliance settings:",c.message):r(i?{enforceCi:(t=i.enforce_ci)!=null?t:!1,enforceBi:(n=i.enforce_bi)!=null?n:!1,allowOverrides:(a=i.allow_overrides)!=null?a:!0}:{enforceCi:!1,enforceBi:!1,allowOverrides:!0}),r({loading:!1})}),updateComplianceSettings:(e,t)=>yo(null,null,function*(){var n,a,i;const{error:c}=yield _.from("facility_compliance_settings").upsert({facility_id:e,enforce_ci:t.enforceCi,enforce_bi:t.enforceBi,allow_overrides:t.allowOverrides,updated_at:new Date().toISOString()},{onConflict:"facility_id"});c?console.error("Failed to update compliance settings:",c.message):r({enforceCi:(n=t.enforceCi)!=null?n:!1,enforceBi:(a=t.enforceBi)!=null?a:!1,allowOverrides:(i=t.allowOverrides)!=null?i:!0})})}),Nf=(r,e)=>{if(r.duration<=0)throw new Error(`${e} has invalid duration`);if(r.temperature!==void 0&&(r.temperature<30||r.temperature>150))throw new Error(`${e} has unsafe temperature`);if(r.pressure!==void 0&&(r.pressure<5||r.pressure>30))throw new Error(`${e} has unsafe pressure`)},ue={bath1:{name:"Bath 1",duration:1,temperature:60,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},bath2:{name:"Bath 2",duration:1,temperature:65,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},drying:{name:"Drying",duration:1,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},autoclave:{name:"Autoclave",duration:1,temperature:121,pressure:15,requiresCI:!0,requiresBI:!0,requiresCiStrip:!0,requiresBiTest:!0}};Object.entries(ue).forEach(([r,e])=>{Nf(e,r)});const Yu={bath1:{label:ue.bath1.name,duration:ue.bath1.duration*60},bath2:{label:ue.bath2.name,duration:ue.bath2.duration*60},drying:{label:ue.drying.name,duration:ue.drying.duration*60},autoclave:{label:ue.autoclave.name,duration:ue.autoclave.duration*60}},If=()=>{const e=new Date().toISOString().split("T")[0].replace(/-/g,""),t=`cycle_count_${e}`,a=parseInt(localStorage.getItem(t)||"0")+1;return localStorage.setItem(t,a.toString()),`CYCLE-${e}-${String(a).padStart(3,"0")}`},ci=r=>{const e=`cycle_${Date.now()}`,t=If();return{id:e,cycleNumber:t,phases:[],tools:[],operator:r,startTime:new Date,completedAt:null}},Tf=(r,e,t,n=[])=>({id:r,name:e,duration:t,tools:n,isActive:!1,startTime:null,endTime:null,status:"pending"}),Ef=r=>({bath1:{name:ue.bath1.name,duration:ue.bath1.duration*60},bath2:{name:ue.bath2.name,duration:ue.bath2.duration*60},drying:{name:ue.drying.name,duration:ue.drying.duration*60},autoclave:{name:ue.autoclave.name,duration:ue.autoclave.duration*60}})[r],kf=r=>{const e=["bath1","bath2","drying","autoclave"],t=e.indexOf(r);return e[t+1]||null},di=r=>r.phases.some(e=>e.id==="autoclave");var Df=Object.defineProperty,Pf=Object.defineProperties,Of=Object.getOwnPropertyDescriptors,vo=Object.getOwnPropertySymbols,Rf=Object.prototype.hasOwnProperty,Af=Object.prototype.propertyIsEnumerable,xo=(r,e,t)=>e in r?Df(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kt=(r,e)=>{for(var t in e||(e={}))Rf.call(e,t)&&xo(r,t,e[t]);if(vo)for(var t of vo(e))Af.call(e,t)&&xo(r,t,e[t]);return r},Dt=(r,e)=>Pf(r,Of(e)),$f=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Mf=(r,e,t)=>({setCurrentCycle:n=>r(a=>Dt(kt({},a),{currentCycle:n})),setError:n=>r(a=>Dt(kt({},a),{error:n})),startNewCycle:n=>{const a=ci(n);r(i=>Dt(kt({},i),{currentCycle:a}))},addToolToCycle:n=>{r(a=>{const i=a.currentCycle;if(!i){const c=ci("Current Operator");c.tools=[n];const l=e();return l.updateToolStatus&&l.availableTools.find(d=>d.id===n)&&l.updateToolStatus(n,"bath1"),Dt(kt({},a),{currentCycle:c})}if(!i.tools.includes(n)){const c=Dt(kt({},i),{tools:[...i.tools,n]}),l=e();return l.updateToolStatus&&l.availableTools.find(d=>d.id===n)&&l.updateToolStatus(n,"bath1"),Dt(kt({},a),{currentCycle:c})}return a})},loadCycles:n=>$f(null,null,function*(){try{const i=(yield Tt.getSterilizationCycles(n)).map(c=>({id:c.id,cycleNumber:c.cycle_number,phases:Array.isArray(c.phases)?c.phases.map(l=>({id:l.id,name:l.name,duration:l.duration,tools:Array.isArray(l.tools)?l.tools.map(o=>String(o)):[],isActive:l.isActive,startTime:l.startTime?new Date(l.startTime):null,endTime:l.endTime?new Date(l.endTime):null,status:l.status})):[],tools:Array.isArray(c.tools)?c.tools.map(l=>l.id):[],operator:c.operator_id||"Unknown",startTime:c.start_time?new Date(c.start_time):new Date,completedAt:c.end_time||null,batchId:c.cycle_number}));r(c=>Dt(kt({},c),{cycles:i}))}catch(a){console.error("Failed to load sterilization cycles:",a),r(i=>Dt(kt({},i),{error:a instanceof Error?a.message:"Failed to load cycles"}))}})});var Ff=Object.defineProperty,Lf=Object.defineProperties,zf=Object.getOwnPropertyDescriptors,bo=Object.getOwnPropertySymbols,Bf=Object.prototype.hasOwnProperty,qf=Object.prototype.propertyIsEnumerable,_o=(r,e,t)=>e in r?Ff(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,we=(r,e)=>{for(var t in e||(e={}))Bf.call(e,t)&&_o(r,t,e[t]);if(bo)for(var t of bo(e))qf.call(e,t)&&_o(r,t,e[t]);return r},Se=(r,e)=>Lf(r,zf(e));const Uf=(r,e,t)=>({addPhaseToCycle:(n,a,i)=>{r(c=>{if(!c.currentCycle){const p=e().availableTools.filter(g=>g.currentPhase==="bath1").map(g=>g.id),f=ci("Current Operator");return f.tools=p,Se(we({},c),{currentCycle:f})}if(c.currentCycle.phases.find(h=>h.id===n))return c;const o=Tf(n,a,i,[...c.currentCycle.tools]),d=[...c.currentCycle.phases,o],u=Se(we({},c.currentCycle),{phases:d});return Se(we({},c),{currentCycle:u})})},startPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Se(we({},c),{isActive:!0,startTime:new Date,status:"active"}):c);return Se(we({},a),{currentCycle:Se(we({},a.currentCycle),{phases:i})})})},completePhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Se(we({},c),{isActive:!1,endTime:new Date,status:"completed"}):c);return Se(we({},a),{currentCycle:Se(we({},a.currentCycle),{phases:i})})})},pausePhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Se(we({},c),{isActive:!1,status:"paused"}):c);return Se(we({},a),{currentCycle:Se(we({},a.currentCycle),{phases:i})})})},resetPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Se(we({},c),{isActive:!1,startTime:null,endTime:null,status:"pending"}):c);return Se(we({},a),{currentCycle:Se(we({},a.currentCycle),{phases:i})})})}});var Hf=Object.defineProperty,Vf=Object.defineProperties,Wf=Object.getOwnPropertyDescriptors,wo=Object.getOwnPropertySymbols,Gf=Object.prototype.hasOwnProperty,Kf=Object.prototype.propertyIsEnumerable,So=(r,e,t)=>e in r?Hf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ks=(r,e)=>{for(var t in e||(e={}))Gf.call(e,t)&&So(r,t,e[t]);if(wo)for(var t of wo(e))Kf.call(e,t)&&So(r,t,e[t]);return r},Qs=(r,e)=>Vf(r,Wf(e));const Qf=(r,e,t)=>({moveToolToNextPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.find(h=>h.tools.includes(n)&&h.isActive);if(!i)return a;const c=kf(i.id);if(!c){const h=e();return h.incrementToolCycleCount&&h.incrementToolCycleCount(n),a}const l=e(),o=l.availableTools.find(h=>h.id===n);if(o!=null&&o.isP2Status&&c==="autoclave")return l.incrementToolCycleCount&&l.incrementToolCycleCount(n),a;let d=a.currentCycle.phases.find(h=>h.id===c);if(!d){const h=Ef(c);h&&(d={id:c,name:h.name,duration:h.duration,tools:[],isActive:!1,startTime:null,endTime:null,status:"pending"})}if(!d)return a;const u=a.currentCycle.phases.map(h=>h.id===i.id?Qs(Ks({},h),{tools:h.tools.filter(p=>p!==n)}):h.id===c?Qs(Ks({},h),{tools:[...h.tools,n]}):h);return a.currentCycle.phases.find(h=>h.id===c)||u.push(d),Qs(Ks({},a),{currentCycle:Qs(Ks({},a.currentCycle),{phases:u})})})}}),Yf=r=>{let e=100,t=null;if(r.length>0){const n=new Date;n.setDate(n.getDate()-30);const a=r.filter(l=>l.date>=n),i=a.filter(l=>l.passed===!1),c=a.filter(l=>!l.passed&&l.date<n);if(a.length>0){const l=a.filter(o=>o.passed===!0).length;e=Math.round(l/a.length*100),i.length>0&&(t={direction:"down",value:`${i.length} failure(s) this month`})}else c.length>0&&(t={direction:"warning",value:`${c.length} test(s) missed this month`})}return{rate:e,trend:t}},Jf=r=>{const e=new Date;e.setDate(e.getDate()-7);const t=new Date;t.setDate(t.getDate()-14);const n=r.filter(l=>new Date(l.startTime)>=e&&di(l)),a=r.filter(l=>{const o=new Date(l.startTime);return o>=t&&o<e&&di(l)}),i=n.length,c=a.length;if(c>0){const l=Math.round((i-c)/c*100);return{direction:l>=0?"up":"down",value:`${l>=0?"+":""}${l}% from last week`}}else if(i>0)return{direction:"up",value:"New this week"};return null},Xf=(r,e)=>{const t=new Date;t.setDate(t.getDate()-30);const n=e.filter(c=>{const l=c.currentPhase==="complete"||c.currentPhase==="available",o=c.startTime&&c.endTime,d=o&&new Date(c.endTime)>=t,u=o&&new Date(c.endTime).getTime()-new Date(c.startTime).getTime()>1800*1e3;return l&&o&&d&&u});if(n.length===0)return 0;const a=n.reduce((c,l)=>{const o=new Date(l.startTime),u=new Date(l.endTime).getTime()-o.getTime();return c+u},0);return Math.round(a/n.length/(1e3*60))},Zf=(r,e,t,n,a)=>{const i={cycleCompletionRate:.2,timeEfficiency:.15,resourceUtilization:.15,qualityMetrics:.15,throughputEfficiency:.1,inventoryEfficiency:.15},c=new Date;c.setDate(c.getDate()-7);const l=new Date;l.setDate(l.getDate()-14);const o=r.filter(k=>new Date(k.startTime)>=c&&di(k)),d=o.length,u=o.filter(k=>k.completedAt!==null).length,h=d>0?u/d*100:0,p=60,f=Math.max(0,Math.min(100,(p-Math.abs(t-p))/p*100)),g=o.reduce((k,P)=>k+P.tools.length,0),y=d>0?g/d:0,b=Math.max(0,Math.min(100,y/7*100)),x=e,j=d/7,E=Math.max(0,Math.min(100,j/2.5*100));let O=0;const S=h*i.cycleCompletionRate+f*i.timeEfficiency+b*i.resourceUtilization+x*i.qualityMetrics+E*i.throughputEfficiency+O*i.inventoryEfficiency,C=r.filter(k=>{const P=new Date(k.startTime);return P>=l&&P<c});let D=null;if(C.length>0){const P=C.filter(z=>z.completedAt!==null).length/C.length*100*i.cycleCompletionRate+80,T=S-P,A=Math.round(T/P*100);D={direction:T>=0?"up":"down",value:`${T>=0?"+":""}${A}% from last week`}}return{score:Math.round(S),trend:D,breakdown:{sterilization:{completionRate:h,timeEfficiency:f,resourceUtilization:b,qualityScore:x,throughputEfficiency:E},inventory:{efficiency:O,lowStockItems:0,totalItems:0,expiringItems:0,accuracy:100}}}},eg=(r,e,t,n)=>{const{rate:a,trend:i}=Yf(t),c=Jf(r),l=Xf(r,e),o=Zf(r,a,l),d=new Date;d.setDate(d.getDate()-30);const u=r.filter(g=>{const y=new Date(g.startTime);return!isNaN(y.getTime())&&y>=d}),h=u.length,p=u.filter(g=>g.completedAt!==null).length,f=c&&c.direction!=="warning"?{direction:c.direction,value:c.value}:null;return{totalCycles:h,completedCycles:p,averageCycleTime:l,biPassRate:a,biPassRateTrend:i,cycleTrend:f,efficiencyScore:o}};var tg=Object.defineProperty,rg=Object.defineProperties,sg=Object.getOwnPropertyDescriptors,jo=Object.getOwnPropertySymbols,ng=Object.prototype.hasOwnProperty,ag=Object.prototype.propertyIsEnumerable,Co=(r,e,t)=>e in r?tg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ia=(r,e)=>{for(var t in e||(e={}))ng.call(e,t)&&Co(r,t,e[t]);if(jo)for(var t of jo(e))ag.call(e,t)&&Co(r,t,e[t]);return r},ig=(r,e)=>rg(r,sg(e));const og=(r,e,t)=>{const n=Mf(r,e),a=Uf(r,e),i=Qf(r,e);return ig(ia(ia(ia({currentCycle:null,cycles:[],error:null},n),a),i),{getCycleStats:()=>{const c=e();return eg(c.cycles||[],c.availableTools||[],c.biTestResults||[])}})},lg=r=>({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:"",setModalOpen:e=>r({isModalOpen:e}),setShowAnalyticsModal:e=>r({showAnalyticsModal:e}),setShowCleaningLogModal:e=>r({showCleaningLogModal:e}),setShowBITestModal:e=>r({showBITestModal:e}),setShowBatchCodeModal:e=>r({showBatchCodeModal:e}),setWorkflowType:e=>r({workflowType:e}),setScannedData:e=>r({scannedData:e}),resetUIState:()=>r({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:""})});var cg=Object.defineProperty,dg=Object.defineProperties,ug=Object.getOwnPropertyDescriptors,No=Object.getOwnPropertySymbols,mg=Object.prototype.hasOwnProperty,hg=Object.prototype.propertyIsEnumerable,Io=(r,e,t)=>e in r?cg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pg=(r,e)=>{for(var t in e||(e={}))mg.call(e,t)&&Io(r,t,e[t]);if(No)for(var t of No(e))hg.call(e,t)&&Io(r,t,e[t]);return r},fg=(r,e)=>dg(r,ug(e));const Ju=(r,e)=>({availableTools:[],toolsInCycle:[],setAvailableTools:t=>{r({availableTools:t})},addToolToCycle:t=>{const n=e().availableTools.find(a=>a.id===t);n&&r(a=>({toolsInCycle:[...a.toolsInCycle,n]}))},clearCycle:()=>{r({toolsInCycle:[]})},incrementToolCycleCount:t=>{r(n=>({availableTools:n.availableTools.map(a=>a.id===t?fg(pg({},a),{cycleCount:a.cycleCount+1}):a)}))},checkToolReplacementNeeded:t=>{const n=e().availableTools.find(a=>a.id===t);return n?n.cycleCount>=(n.maxCycles||200):!1},getToolCycleCount:t=>{const n=e().availableTools.find(a=>a.id===t);return n?n.cycleCount:0}}),Xu=(r,e,t)=>({}),Zu=(r,e)=>({currentBatchId:null,batchedToolIds:[],currentCycle:null,setCurrentBatchId:t=>r({currentBatchId:t}),addToolToBatch:t=>r({batchedToolIds:[...e().batchedToolIds,t]}),resetBatch:()=>r({currentBatchId:null,batchedToolIds:[]})});var gg=Object.defineProperty,To=Object.getOwnPropertySymbols,yg=Object.prototype.hasOwnProperty,vg=Object.prototype.propertyIsEnumerable,Eo=(r,e,t)=>e in r?gg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,oa=(r,e)=>{for(var t in e||(e={}))yg.call(e,t)&&Eo(r,t,e[t]);if(To)for(var t of To(e))vg.call(e,t)&&Eo(r,t,e[t]);return r};const xg=(r,e,t)=>oa(oa(oa({},Ju(r,e)),Xu()),Zu(r,e));var bg=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const _g=r=>({lastGeneratedCode:null,generatedCodes:[],generateBatchCode:(e,t)=>bg(null,null,function*(){const n=t===1,a=new Date,i=a.toISOString().slice(0,10).replace(/-/g,""),c=a.toISOString().slice(11,17).replace(/:/g,""),l=Math.random().toString(36).substring(2,5).toUpperCase(),o=`${i}-${c}-${l}`,d={code:o,generatedAt:a,operator:e,toolCount:t,isSingleTool:n};return r(u=>({lastGeneratedCode:d,generatedCodes:[...u.generatedCodes,d]})),o}),validateBatchCode:e=>/^\d{8}-\d{4}-[A-Z0-9]{3}$/.test(e),getBatchByCode:(e,t)=>t.find(n=>n.batchCode===e)||null});var wg=Object.defineProperty,Sg=Object.defineProperties,jg=Object.getOwnPropertyDescriptors,ko=Object.getOwnPropertySymbols,Cg=Object.prototype.hasOwnProperty,Ng=Object.prototype.propertyIsEnumerable,Do=(r,e,t)=>e in r?wg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Jr=(r,e)=>{for(var t in e||(e={}))Cg.call(e,t)&&Do(r,t,e[t]);if(ko)for(var t of ko(e))Ng.call(e,t)&&Do(r,t,e[t]);return r},Xr=(r,e)=>Sg(r,jg(e)),Po=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Ig=(r,e)=>({currentBatch:null,batches:[],batchHistory:[],batchLoading:!1,createBatch:(t,n)=>Po(null,null,function*(){r({batchLoading:!0});try{const a=`batch_${Date.now()}`,i={id:a,batchCode:"",createdAt:new Date,createdBy:t,status:"creating",tools:[],packageInfo:{packageType:"",packageSize:""},sterilizationInfo:{},auditTrail:[{id:`audit_${Date.now()}`,timestamp:new Date,action:"created",operator:t,details:`Batch created in ${n?"batch":"single tool"} mode`}]};return r(c=>({currentBatch:i,batches:[...c.batches,i],batchLoading:!1})),a}catch(a){throw r({batchLoading:!1}),a}}),addToolToBatch:t=>{const{currentBatch:n}=e();if(n&&!n.tools.includes(t)){const a=Xr(Jr({},n),{tools:[...n.tools,t],auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_added",operator:n.createdBy,details:`Tool ${t} added to batch`,metadata:{toolId:t}}]});r(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))}},removeToolFromBatch:t=>{const{currentBatch:n}=e();if(!n)return;const a=Xr(Jr({},n),{tools:n.tools.filter(i=>i!==t),auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_removed",operator:n.createdBy,details:`Tool ${t} removed from batch`,metadata:{toolId:t}}]});r(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))},finalizeBatch:t=>Po(null,null,function*(){const{currentBatch:n}=e();if(!n)throw new Error("No current batch to finalize");r({batchLoading:!0});try{const i=yield K.getState().generateBatchCode(n.createdBy,n.tools.length),c=Xr(Jr({},n),{batchCode:i,status:"ready",packageInfo:t,auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"ready_for_autoclave",operator:n.createdBy,details:`Batch finalized with code ${i}`,metadata:{batchCode:i,packageInfo:t}}]});r(l=>({currentBatch:c,batches:l.batches.map(o=>o.id===n.id?c:o),batchHistory:[...l.batchHistory,c],batchLoading:!1}))}catch(a){throw r({batchLoading:!1}),a}}),updateBatchStatus:(t,n)=>{r(a=>{var i;return{batches:a.batches.map(c=>c.id===t?Xr(Jr({},c),{status:n,auditTrail:[...c.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:n==="in_autoclave"?"autoclave_started":n==="completed"?"autoclave_completed":"tool_added",operator:c.createdBy,details:`Batch status updated to ${n}`,metadata:{status:n}}]}):c),currentBatch:((i=a.currentBatch)==null?void 0:i.id)===t?Xr(Jr({},a.currentBatch),{status:n}):a.currentBatch}})},getBatchById:t=>{const{batches:n,batchHistory:a}=e();return[...n,...a].find(i=>i.id===t)||null},getBatchesByStatus:t=>{const{batches:n,batchHistory:a}=e();return[...n,...a].filter(i=>i.status===t)},clearCurrentBatch:()=>r({currentBatch:null}),setBatchLoading:t=>r({batchLoading:t})});var Tg=Object.defineProperty,Oo=Object.getOwnPropertySymbols,Eg=Object.prototype.hasOwnProperty,kg=Object.prototype.propertyIsEnumerable,Ro=(r,e,t)=>e in r?Tg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,la=(r,e)=>{for(var t in e||(e={}))Eg.call(e,t)&&Ro(r,t,e[t]);if(Oo)for(var t of Oo(e))kg.call(e,t)&&Ro(r,t,e[t]);return r};const Dg=(r,e)=>({currentSession:null,startPackagingSession:(t,n)=>{const a={id:crypto.randomUUID(),operatorName:t,facilityId:n,scannedTools:[],startedAt:new Date().toISOString()};r({currentSession:a})},addToolToSession:t=>{const n=e().currentSession;n&&(n.scannedTools.includes(t)||(n.scannedTools.push(t),r({currentSession:la({},n)})))},removeToolFromSession:t=>{const n=e().currentSession;n&&(n.scannedTools=n.scannedTools.filter(a=>a!==t),r({currentSession:la({},n)}))},generateBatchId:()=>`PKG-${Math.floor(1e3+Math.random()*9e3)}`,assignBatchIdToSession:t=>{const n=e().currentSession;n&&(n.currentBatchId=t,r({currentSession:la({},n)}))},endPackagingSession:()=>{r({currentSession:null})},resetPackagingSession:()=>{r({currentSession:null})}});var Pg=Object.defineProperty,Og=Object.defineProperties,Rg=Object.getOwnPropertyDescriptors,Ao=Object.getOwnPropertySymbols,Ag=Object.prototype.hasOwnProperty,$g=Object.prototype.propertyIsEnumerable,$o=(r,e,t)=>e in r?Pg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zr=(r,e)=>{for(var t in e||(e={}))Ag.call(e,t)&&$o(r,t,e[t]);if(Ao)for(var t of Ao(e))$g.call(e,t)&&$o(r,t,e[t]);return r},ca=(r,e)=>Og(r,Rg(e));const Mo={gravity:{name:"Gravity",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35},prevacuum:{name:"Pre-vacuum",temperature:132,pressure:30,sterilizeTime:4,dryTime:15,totalTime:19},flash:{name:"Flash",temperature:132,pressure:30,sterilizeTime:3,dryTime:0,totalTime:3},custom:{name:"Custom",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35}},Mg={autoclaveHasPrinter:!1,receiptRetentionMonths:12},Fg=r=>({cycleSettings:Mo,defaultCycleType:"gravity",allowCustomCycles:!1,autoclaveReceiptSettings:Mg,updateCycleSettings:(e,t)=>{r(n=>({cycleSettings:ca(Zr({},n.cycleSettings),{[e]:Zr(Zr({},n.cycleSettings[e]),t)})}))},setDefaultCycleType:e=>{r({defaultCycleType:e})},setAllowCustomCycles:e=>{r({allowCustomCycles:e})},setAutoclaveHasPrinter:e=>{r(t=>({autoclaveReceiptSettings:ca(Zr({},t.autoclaveReceiptSettings),{autoclaveHasPrinter:e})}))},setReceiptRetentionMonths:e=>{r(t=>({autoclaveReceiptSettings:ca(Zr({},t.autoclaveReceiptSettings),{receiptRetentionMonths:e})}))},resetCycleSettings:()=>{r({cycleSettings:Mo,defaultCycleType:"gravity",allowCustomCycles:!1})}});var Lg=Object.defineProperty,zg=Object.defineProperties,Bg=Object.getOwnPropertyDescriptors,Fo=Object.getOwnPropertySymbols,qg=Object.prototype.hasOwnProperty,Ug=Object.prototype.propertyIsEnumerable,Lo=(r,e,t)=>e in r?Lg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Hg=(r,e)=>{for(var t in e||(e={}))qg.call(e,t)&&Lo(r,t,e[t]);if(Fo)for(var t of Fo(e))Ug.call(e,t)&&Lo(r,t,e[t]);return r},Vg=(r,e)=>zg(r,Bg(e)),je=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Wg=r=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,setBiTestCompleted:e=>r({biTestCompleted:e}),setBiTestDate:e=>r({biTestDate:e}),recordBITestResult:e=>je(null,null,function*(){const t=Vg(Hg({},e),{id:`bi-test-${Date.now()}`});r(n=>({biTestResults:[...n.biTestResults,t],biTestCompleted:!0,biTestDate:new Date().toISOString(),biTestPassed:e.passed}))}),setNextBITestDue:e=>r({nextBITestDue:e}),setLastBITestDate:e=>r({lastBITestDate:e}),setBiTestPassed:e=>r({biTestPassed:e}),setBiTestOptedOut:e=>r({biTestOptedOut:e}),setBiTestInProgress:e=>r({biTestInProgress:e}),resetBIState:()=>r({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1}),activateBIFailure:()=>je(null,null,function*(){}),deactivateBIFailure:()=>je(null,null,function*(){}),updateBIFailureStatus:()=>je(null,null,function*(){}),resolveBIFailure:()=>je(null,null,function*(){}),getBIFailureHistory:()=>je(null,null,function*(){}),addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>je(null,null,function*(){}),setEnforceBI:()=>je(null,null,function*(){}),setEnforceCI:()=>je(null,null,function*(){}),setAllowOverrides:()=>je(null,null,function*(){}),toggleEnforceBI:()=>je(null,null,function*(){}),toggleEnforceCI:()=>je(null,null,function*(){}),loadComplianceSettings:()=>je(null,null,function*(){}),syncWithSupabase:()=>je(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>je(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})});var Gg=Object.defineProperty,Kg=Object.defineProperties,Qg=Object.getOwnPropertyDescriptors,zo=Object.getOwnPropertySymbols,Yg=Object.prototype.hasOwnProperty,Jg=Object.prototype.propertyIsEnumerable,Bo=(r,e,t)=>e in r?Gg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qo=(r,e)=>{for(var t in e||(e={}))Yg.call(e,t)&&Bo(r,t,e[t]);if(zo)for(var t of zo(e))Jg.call(e,t)&&Bo(r,t,e[t]);return r},Uo=(r,e)=>Kg(r,Qg(e)),Ce=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Xg=(r,e)=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,activateBIFailure:t=>Ce(null,null,function*(){r({biFailureLoading:!0,biFailureError:null});try{const n={id:`bi-failure-${Date.now()}`,incident_number:`BI-${Date.now()}`,failure_date:new Date().toISOString(),affected_tools_count:t.affectedToolsCount,affected_batch_ids:t.affectedBatchIds,failure_reason:t.failureReason,severity_level:t.severity||"medium",status:"active",detected_by_operator_id:t.operator,regulatory_notification_sent:!1,regulatory_notification_date:void 0,facility_id:"default-facility",regulatory_notification_required:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};r({biFailureActive:!0,biFailureDetails:n,biFailureHistory:[...e().biFailureHistory,n],biFailureLoading:!1})}catch(n){r({biFailureError:n instanceof Error?n.message:"Failed to activate BI failure",biFailureLoading:!1})}}),deactivateBIFailure:()=>Ce(null,null,function*(){r({biFailureLoading:!0});try{r({biFailureActive:!1,biFailureDetails:null,biFailureLoading:!1})}catch(t){r({biFailureError:t instanceof Error?t.message:"Failed to deactivate BI failure",biFailureLoading:!1})}}),updateBIFailureStatus:t=>Ce(null,null,function*(){r({biFailureLoading:!0});try{const n=e().biFailureDetails;if(n){const a=Uo(qo({},n),{status:t,updated_at:new Date().toISOString()});r({biFailureDetails:a,biFailureActive:t==="active",biFailureLoading:!1})}}catch(n){r({biFailureError:n instanceof Error?n.message:"Failed to update BI failure status",biFailureLoading:!1})}}),resolveBIFailure:()=>Ce(null,null,function*(){r({biFailureLoading:!0});try{const t=e().biFailureDetails;if(t){const n=Uo(qo({},t),{status:"resolved",updated_at:new Date().toISOString()});r({biFailureDetails:n,biFailureActive:!1,biFailureLoading:!1})}}catch(t){r({biFailureError:t instanceof Error?t.message:"Failed to resolve BI failure",biFailureLoading:!1})}}),getBIFailureHistory:()=>Ce(null,null,function*(){r({biFailureLoading:!0});try{r({biFailureLoading:!1})}catch(t){r({biFailureError:t instanceof Error?t.message:"Failed to get BI failure history",biFailureLoading:!1})}}),setBiTestCompleted:()=>{},setBiTestDate:()=>{},recordBITestResult:()=>Ce(null,null,function*(){}),setNextBITestDue:()=>{},setLastBITestDate:()=>{},setBiTestPassed:()=>{},setBiTestOptedOut:()=>{},setBiTestInProgress:()=>{},resetBIState:()=>{},addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>Ce(null,null,function*(){}),setEnforceBI:()=>Ce(null,null,function*(){}),setEnforceCI:()=>Ce(null,null,function*(){}),setAllowOverrides:()=>Ce(null,null,function*(){}),toggleEnforceBI:()=>Ce(null,null,function*(){}),toggleEnforceCI:()=>Ce(null,null,function*(){}),loadComplianceSettings:()=>Ce(null,null,function*(){}),syncWithSupabase:()=>Ce(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>Ce(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})}),Zg=r=>{const{biTestPassed:e,nextBITestDue:t,biTestOptedOut:n,enforceBI:a}=r;if(!a||n)return{isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"};const i=new Date,c=t?Math.ceil((t.getTime()-i.getTime())/(1e3*60*60*24)):0;let l;return e?c<0?l="overdue":c<=3?l="due-soon":l="compliant":l="failed",{isCompliant:l==="compliant",nextTestDue:t,daysUntilDue:c,status:l}},ey=r=>{const{biFailureDetails:e}=r;return e&&e.severity_level||"low"},ty=r=>{const{activityLog:e}=r,t=new Date,n=new Date(t.getTime()-1440*60*1e3),a=e.filter(l=>l.time>n).length,i=e.filter(l=>l.type==="bi-test").length,c=e.filter(l=>l.type==="bi-failure").length;return{totalActivities:e.length,recentActivities:a,biTestCount:i,failureCount:c}};class he extends Error{constructor(e,t,n="medium",a=!1,i){super(e),this.code=t,this.severity=n,this.retryable=a,this.details=i,this.name="BIFailureError"}}const J={MISSING_FACILITY_ID:"MISSING_FACILITY_ID",INVALID_TOOLS_COUNT:"INVALID_TOOLS_COUNT",MISSING_BATCH_IDS:"MISSING_BATCH_IDS",VALIDATION_ERROR:"VALIDATION_ERROR"};var ry=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class B{static handleDatabaseError(e,t,n){this.logError("DATABASE_ERROR",e,t,n);const a=e;throw(a==null?void 0:a.code)==="PGRST116"?new he(`Database connection error during ${t}: ${a.message||"Unknown error"}`,"DATABASE_CONNECTION_ERROR","critical",!0):(a==null?void 0:a.code)==="23505"?new he(`Duplicate record error during ${t}: ${a.message||"Unknown error"}`,"DUPLICATE_RECORD_ERROR","high",!1):(a==null?void 0:a.code)==="23503"?new he(`Foreign key constraint error during ${t}: ${a.message||"Unknown error"}`,"FOREIGN_KEY_ERROR","high",!1):new he(`Database error during ${t}: ${(a==null?void 0:a.message)||"Unknown error"}`,"DATABASE_ERROR","critical",!0)}static handleNetworkError(e,t,n){var a;this.logError("NETWORK_ERROR",e,t,n);const i=e;throw(i==null?void 0:i.code)==="NETWORK_ERROR"||(a=i==null?void 0:i.message)!=null&&a.includes("network")?new he(`Network connection failed during ${t}: ${i.message||"Unknown error"}`,"NETWORK_ERROR","high",!0):(i==null?void 0:i.code)==="PGRST116"?new he(`Database connection timeout during ${t}: ${i.message||"Unknown error"}`,"DATABASE_TIMEOUT_ERROR","critical",!0):new he(`Network error during ${t}: ${(i==null?void 0:i.message)||"Unknown error"}`,"NETWORK_ERROR","high",!0)}static handleValidationError(e,t,n="medium"){throw this.logError("VALIDATION_ERROR",{message:e,code:t},"validation"),new he(e,t,n,!1)}static handleAuthorizationError(e,t,n){this.logError("AUTHORIZATION_ERROR",e,t,n);const a=e;throw new he(`Authorization error during ${t}: ${(a==null?void 0:a.message)||"Access denied"}`,"AUTHORIZATION_ERROR","high",!1)}static handleCriticalError(e,t,n){var a,i,c;this.logError("CRITICAL_ERROR",e,t,n);const l=e;throw(l==null?void 0:l.code)==="CRITICAL_ERROR"||(a=l==null?void 0:l.message)!=null&&a.includes("critical")?new he(`Critical error during ${t}: ${l.message||"System failure"}`,"CRITICAL_ERROR","critical",!1):(l==null?void 0:l.code)==="HIGH_PRIORITY"||(i=l==null?void 0:l.message)!=null&&i.includes("high")?new he(`High priority error during ${t}: ${l.message||"High priority issue"}`,"HIGH_PRIORITY_ERROR","high",!1):(l==null?void 0:l.code)==="MEDIUM_PRIORITY"||(c=l==null?void 0:l.message)!=null&&c.includes("medium")?new he(`Medium priority error during ${t}: ${l.message||"Medium priority issue"}`,"MEDIUM_PRIORITY_ERROR","medium",!1):new he(`Critical error during ${t}: ${(l==null?void 0:l.message)||"Unknown critical error"}`,"CRITICAL_ERROR","critical",!1)}static createStandardizedError(e,t,n="UNKNOWN_ERROR"){const a=e;return new he((a==null?void 0:a.message)||`Unknown error during ${t}`,n,"medium",!0,{name:(a==null?void 0:a.name)||"UnknownError",message:(a==null?void 0:a.message)||"No message",code:(a==null?void 0:a.code)||"NO_CODE",operation:t,stack:a==null?void 0:a.stack})}static logError(e,t,n,a){if(this.errorCount++,this.errorCount>this.MAX_ERRORS){console.warn("Maximum error count reached, stopping error logging");return}const i={type:e,operation:n,timestamp:new Date().toISOString(),context:a,error:t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t};console.error("BIFailureErrorHandler:",i),t instanceof Error&&(this.lastError=t)}static getLastError(){return this.lastError}static reset(){this.lastError=null,this.errorCount=0}static isRetryableError(e){var t,n,a;if(e instanceof he)return e.retryable;const i=e;return!!((i==null?void 0:i.code)==="NETWORK_ERROR"||(t=i==null?void 0:i.message)!=null&&t.includes("network")||(n=i==null?void 0:i.message)!=null&&n.includes("timeout")||(i==null?void 0:i.code)==="PGRST116"||(a=i==null?void 0:i.message)!=null&&a.includes("connection"))}static handleUnexpectedError(e,t){this.logError("UNEXPECTED_ERROR",e,t);const n=e;throw new he(`Unexpected error during ${t}: ${(n==null?void 0:n.message)||"Unknown error"}`,"UNEXPECTED_ERROR","critical",!1)}static withRetry(e,t,n=3,a=1e3){return ry(this,null,function*(){let i=null;for(let c=1;c<=n;c++)try{return yield e()}catch(l){if(i=this.createStandardizedError(l,t),!this.isRetryableError(l)||c===n)throw i;yield new Promise(o=>setTimeout(o,a*c))}throw i||new he(`Operation failed after ${n} attempts: ${t}`,"MAX_RETRIES_EXCEEDED","critical",!1)})}}B.lastError=null;B.errorCount=0;B.MAX_ERRORS=100;class gt{static validateCreateIncidentParams(e){e.facility_id||B.handleValidationError("Facility ID is required",J.MISSING_FACILITY_ID,"critical"),e.affected_tools_count<0&&B.handleValidationError("Affected tools count cannot be negative",J.INVALID_TOOLS_COUNT,"high"),(!Array.isArray(e.affected_batch_ids)||e.affected_batch_ids.length===0)&&B.handleValidationError("At least one affected batch ID is required",J.MISSING_BATCH_IDS,"critical");for(const t of e.affected_batch_ids)(!t||typeof t!="string"||t.trim().length===0)&&B.handleValidationError("Invalid batch ID format",J.VALIDATION_ERROR,"high");e.severity_level&&!["low","medium","high","critical"].includes(e.severity_level)&&B.handleValidationError("Invalid severity level. Must be one of: low, medium, high, critical",J.VALIDATION_ERROR,"medium"),this.isValidUUID(e.facility_id)||B.handleValidationError("Invalid facility ID format",J.VALIDATION_ERROR,"high"),e.detected_by_operator_id&&!this.isValidUUID(e.detected_by_operator_id)&&B.handleValidationError("Invalid operator ID format",J.VALIDATION_ERROR,"medium")}static validateResolveIncidentParams(e){e.incidentId||B.handleValidationError("Incident ID is required",J.VALIDATION_ERROR,"critical"),e.resolvedByOperatorId||B.handleValidationError("Resolving operator ID is required",J.VALIDATION_ERROR,"critical"),this.isValidUUID(e.incidentId)||B.handleValidationError("Invalid incident ID format",J.VALIDATION_ERROR,"high"),this.isValidUUID(e.resolvedByOperatorId)||B.handleValidationError("Invalid operator ID format",J.VALIDATION_ERROR,"high"),e.resolutionNotes&&e.resolutionNotes.length>1e4&&B.handleValidationError("Resolution notes cannot exceed 10,000 characters",J.VALIDATION_ERROR,"medium")}static validateQuarantineToolsParams(e){e.incidentId||B.handleValidationError("Incident ID is required",J.VALIDATION_ERROR,"critical"),e.quarantinedByOperatorId||B.handleValidationError("Quarantining operator ID is required",J.VALIDATION_ERROR,"critical"),(!Array.isArray(e.tools)||e.tools.length===0)&&B.handleValidationError("At least one tool must be specified for quarantine",J.VALIDATION_ERROR,"high");for(const t of e.tools)t.tool_id||B.handleValidationError("Tool ID is required for each tool",J.VALIDATION_ERROR,"high"),this.isValidUUID(t.tool_id)||B.handleValidationError("Invalid tool ID format",J.VALIDATION_ERROR,"high");this.isValidUUID(e.incidentId)||B.handleValidationError("Invalid incident ID format",J.VALIDATION_ERROR,"high"),this.isValidUUID(e.quarantinedByOperatorId)||B.handleValidationError("Invalid operator ID format",J.VALIDATION_ERROR,"high")}static validateRecordToolUsageParams(e){e.facilityId||B.handleValidationError("Facility ID is required",J.MISSING_FACILITY_ID,"critical"),e.toolId||B.handleValidationError("Tool ID is required",J.VALIDATION_ERROR,"critical"),e.patientId||B.handleValidationError("Patient ID is required",J.VALIDATION_ERROR,"critical"),this.isValidUUID(e.facilityId)||B.handleValidationError("Invalid facility ID format",J.VALIDATION_ERROR,"high"),this.isValidUUID(e.toolId)||B.handleValidationError("Invalid tool ID format",J.VALIDATION_ERROR,"high"),this.isValidUUID(e.patientId)||B.handleValidationError("Invalid patient ID format",J.VALIDATION_ERROR,"high"),e.operatorId&&!this.isValidUUID(e.operatorId)&&B.handleValidationError("Invalid operator ID format",J.VALIDATION_ERROR,"medium"),e.procedureNotes&&e.procedureNotes.length>5e3&&B.handleValidationError("Procedure notes cannot exceed 5,000 characters",J.VALIDATION_ERROR,"medium")}static validateFacilityId(e){e||B.handleValidationError("Facility ID is required",J.MISSING_FACILITY_ID,"high"),this.isValidUUID(e)||B.handleValidationError("Invalid facility ID format",J.VALIDATION_ERROR,"high")}static validateIncidentId(e){e||B.handleValidationError("Incident ID is required",J.VALIDATION_ERROR,"critical"),this.isValidUUID(e)||B.handleValidationError("Invalid incident ID format",J.VALIDATION_ERROR,"high")}static validateDateRange(e,t){const n=new Date(e),a=new Date(t);isNaN(n.getTime())&&B.handleValidationError("Invalid start date format",J.VALIDATION_ERROR,"medium"),isNaN(a.getTime())&&B.handleValidationError("Invalid end date format",J.VALIDATION_ERROR,"medium"),n>a&&B.handleValidationError("Start date cannot be after end date",J.VALIDATION_ERROR,"medium");const i=new Date;i.setFullYear(i.getFullYear()-5),n<i&&B.handleValidationError("Start date cannot be more than 5 years ago",J.VALIDATION_ERROR,"medium")}static isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}static validateBusinessRules(e){e.affected_tools_count>1e4&&B.handleValidationError("Affected tools count seems unreasonably high. Please verify the data.",J.VALIDATION_ERROR,"medium"),new Set(e.affected_batch_ids).size!==e.affected_batch_ids.length&&B.handleValidationError("Duplicate batch IDs are not allowed",J.VALIDATION_ERROR,"medium"),e.failure_reason&&e.failure_reason.length>2e3&&B.handleValidationError("Failure reason cannot exceed 2,000 characters",J.VALIDATION_ERROR,"medium")}}var sy=Object.defineProperty,Ho=Object.getOwnPropertySymbols,ny=Object.prototype.hasOwnProperty,ay=Object.prototype.propertyIsEnumerable,Vo=(r,e,t)=>e in r?sy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wo=(r,e)=>{for(var t in e||(e={}))ny.call(e,t)&&Vo(r,t,e[t]);if(Ho)for(var t of Ho(e))ay.call(e,t)&&Vo(r,t,e[t]);return r},ge=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class kn{static createIncident(e){return ge(this,null,function*(){try{gt.validateCreateIncidentParams(e),gt.validateBusinessRules(e);const t=yield B.withRetry(()=>ge(null,null,function*(){const{data:n,error:a}=yield _.from("bi_failure_incidents").insert({facility_id:e.facility_id,cycle_id:e.bi_test_result_id,user_id:e.detected_by_operator_id,incident_type:e.incident_type||"bi_failure",severity:e.severity||"medium",description:e.description||"BI test failure incident",failure_reason:e.failure_reason,status:"open",detected_at:new Date().toISOString(),metadata:{affected_tools_count:e.affected_tools_count,affected_batch_ids:e.affected_batch_ids,notes:e.notes}}).select().single();if(a)throw a;if(!n)throw new Error("No data returned from incident creation");return n}),"create BI failure incident");if(t&&e.lastSuccessfulBIDate)try{yield this.identifyExposureWindowTools(t.id,e.lastSuccessfulBIDate),console.log("Exposure window tools identified for incident:",t.incident_number)}catch(n){global.__TESTING__||console.error("Error identifying exposure window tools:",n)}return{id:t.id,facility_id:t.facility_id,bi_test_result_id:t.bi_test_result_id||"",incident_number:t.incident_number,failure_date:t.failure_date||new Date().toISOString(),detected_by_operator_id:t.detected_by_operator_id||"",affected_tools_count:e.affected_tools_count,affected_batch_ids:e.affected_batch_ids,failure_reason:e.failure_reason||"",severity_level:e.severity_level||"medium",status:"active",regulatory_notification_required:!1,regulatory_notification_sent:!1,created_at:t.created_at,updated_at:t.updated_at}}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;B.handleUnexpectedError(t,"create BI failure incident")}})}static getActiveIncidents(e){return ge(this,null,function*(){gt.validateFacilityId(e);try{const{data:t}=yield B.withRetry(()=>ge(null,null,function*(){const n=yield _.from("bi_failure_incidents").select("*").eq("facility_id",e).in("status",["active","in_resolution"]).order("failure_date",{ascending:!1});if(n.error)throw n.error;return n}),"get active BI failure incidents");return(t!=null?t:[]).map(n=>({id:n.id,facility_id:n.facility_id,bi_test_result_id:n.bi_test_result_id||"",incident_number:n.incident_number,failure_date:n.failure_date||new Date().toISOString(),detected_by_operator_id:n.detected_by_operator_id||"",affected_tools_count:n.affected_tools_count||0,affected_batch_ids:n.affected_batch_ids||[],failure_reason:n.failure_reason||"",severity_level:n.severity_level||"medium",status:n.status||"active",regulatory_notification_required:n.regulatory_notification_required||!1,regulatory_notification_sent:n.regulatory_notification_sent||!1,created_at:n.created_at,updated_at:n.updated_at}))}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;B.handleUnexpectedError(t,"get active BI failure incidents")}})}static getIncidentById(e,t){return ge(this,null,function*(){gt.validateIncidentId(e);try{const{data:n}=yield B.withRetry(()=>ge(null,null,function*(){const a=yield _.from("bi_failure_incidents").select("*").eq("id",e).eq("facility_id",t).single();if(a.error){if(a.error.code==="PGRST116")return{data:null,error:null};throw a.error}return a}),"get BI failure incident by ID");return n?{id:n.id,facility_id:n.facility_id,bi_test_result_id:n.bi_test_result_id||"",incident_number:n.incident_number,failure_date:n.failure_date||new Date().toISOString(),detected_by_operator_id:n.detected_by_operator_id||"",affected_tools_count:n.affected_tools_count||0,affected_batch_ids:n.affected_batch_ids||[],failure_reason:n.failure_reason||"",severity_level:n.severity_level||"medium",status:n.status||"active",regulatory_notification_required:n.regulatory_notification_required||!1,regulatory_notification_sent:n.regulatory_notification_sent||!1,created_at:n.created_at,updated_at:n.updated_at}:null}catch(n){if(n instanceof Error&&n.name==="BIFailureError")throw n;B.handleUnexpectedError(n,"get BI failure incident by ID")}})}static resolveIncident(e){return ge(this,null,function*(){gt.validateResolveIncidentParams(e);try{return!!(yield B.withRetry(()=>ge(null,null,function*(){const{data:n,error:a}=yield _.from("bi_failure_incidents").update({status:"resolved",resolved_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e.incidentId).select("id").single();return a&&B.handleDatabaseError(a,"resolve BI failure incident"),n}),"resolve BI failure incident"))}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;B.handleUnexpectedError(t,"resolve BI failure incident")}})}static updateIncidentStatus(e,t,n,a){return ge(this,null,function*(){gt.validateIncidentId(e);try{const{data:i}=yield B.withRetry(()=>ge(null,null,function*(){const c=yield _.from("bi_failure_incidents").update(Wo({status:n,updated_at:new Date().toISOString()},a&&{updated_by_operator_id:a})).eq("id",e).eq("facility_id",t).select("id").single();if(c.error)throw c.error;return c}),"update incident status");return!!i}catch(i){if(i instanceof Error&&i.name==="BIFailureError")throw i;B.handleUnexpectedError(i,"update incident status")}})}static deleteIncident(e,t,n){return ge(this,null,function*(){gt.validateIncidentId(e);try{const{data:a}=yield B.withRetry(()=>ge(null,null,function*(){const i=yield _.from("bi_failure_incidents").update(Wo({status:"closed",updated_at:new Date().toISOString()},n&&{deleted_by_operator_id:n})).eq("id",e).eq("facility_id",t).select("id").single();if(i.error)throw i.error;return i}),"delete BI failure incident");return!!a}catch(a){if(a instanceof Error&&a.name==="BIFailureError")throw a;B.handleUnexpectedError(a,"delete BI failure incident")}})}static getIncidentHistory(e,t,n,a=100){return ge(this,null,function*(){gt.validateFacilityId(e),t&&n&&gt.validateDateRange(t,n);try{let i=_.from("bi_failure_incidents").select("*").eq("facility_id",e).order("failure_date",{ascending:!1}).limit(a);t&&(i=i.gte("failure_date",t)),n&&(i=i.lte("failure_date",n));const{data:c}=yield B.withRetry(()=>ge(null,null,function*(){const l=yield i;if(l.error)throw l.error;return l}),"get incident history");return(c!=null?c:[]).map(l=>({id:l.id,facility_id:l.facility_id,bi_test_result_id:l.bi_test_result_id||"",incident_number:l.incident_number,failure_date:l.failure_date||new Date().toISOString(),detected_by_operator_id:l.detected_by_operator_id||"",affected_tools_count:l.affected_tools_count||0,affected_batch_ids:l.affected_batch_ids||[],failure_reason:l.failure_reason||"",severity_level:l.severity_level||"medium",status:l.status||"active",regulatory_notification_required:l.regulatory_notification_required||!1,regulatory_notification_sent:l.regulatory_notification_sent||!1,created_at:l.created_at,updated_at:l.updated_at}))}catch(i){if(i instanceof Error&&i.name==="BIFailureError")throw i;B.handleUnexpectedError(i,"get incident history")}})}static identifyExposureWindowTools(e,t){return ge(this,null,function*(){var n;try{const{data:a,error:i}=yield B.withRetry(()=>ge(null,null,function*(){return yield _.rpc("identify_exposure_window_tools",{p_incident_id:e,p_last_successful_bi_date:t.toISOString()})}),"identify exposure window tools");return i&&B.handleDatabaseError(i,"identify exposure window tools"),(n=parseInt(a))!=null?n:0}catch(a){if(a instanceof Error&&a.name==="BIFailureError")throw a;B.handleUnexpectedError(a,"identify exposure window tools")}})}static getCurrentFacilityId(){return ge(this,null,function*(){var e,t;try{const{data:{session:n}}=yield _.auth.getSession(),a=(t=(e=n==null?void 0:n.user)==null?void 0:e.app_metadata)==null?void 0:t.facility_id;if(!a)throw new Error("No authenticated facility ID found.");return a}catch(n){throw console.error("Failed to get current facility ID:",n),new Error("No authenticated facility ID found.")}})}}var iy=Object.defineProperty,oy=Object.defineProperties,ly=Object.getOwnPropertyDescriptors,Go=Object.getOwnPropertySymbols,cy=Object.prototype.hasOwnProperty,dy=Object.prototype.propertyIsEnumerable,Ko=(r,e,t)=>e in r?iy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vt=(r,e)=>{for(var t in e||(e={}))cy.call(e,t)&&Ko(r,t,e[t]);if(Go)for(var t of Go(e))dy.call(e,t)&&Ko(r,t,e[t]);return r},xr=(r,e)=>oy(r,ly(e)),yt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const uy=(r,e,t)=>xr(Vt(Vt({},Wg(r)),Xg(r,e)),{addActivity:n=>{const a=xr(Vt({},n),{id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});r(i=>({activityLog:[a,...i.activityLog].slice(0,50)}))},clearActivityLog:()=>r({activityLog:[]}),loadActivityLog:()=>yt(null,null,function*(){r({activityLogLoading:!0});try{const n=yield at.getCurrentFacilityId();if(!n)throw new Error("No facility ID available");const{data:a,error:i}=yield _.from("bi_activity_log").select("*").eq("facility_id",n).order("created_at",{ascending:!1}).limit(100);if(i)throw i;const c=(a||[]).map(l=>({id:l.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:l.type||"general",title:l.title||"Activity",time:new Date(l.created_at||new Date().toISOString()),color:l.color||"blue",description:(l.data&&typeof l.data=="object"&&"description"in l.data?l.data.description:"")||"",metadata:l.metadata||{}}));r({activityLog:c,activityLogLoading:!1})}catch(n){console.error("Failed to load activity log:",n),r({activityLogLoading:!1,syncError:"Failed to load activity log"})}}),setEnforceBI:n=>yt(null,null,function*(){r({enforceBI:n}),e().addPendingChange({type:"settings",data:{enforceBI:n}}),yield e().syncWithSupabase()}),setEnforceCI:n=>yt(null,null,function*(){r({enforceCI:n}),e().addPendingChange({type:"settings",data:{enforceCI:n}}),yield e().syncWithSupabase()}),setAllowOverrides:n=>yt(null,null,function*(){r({allowOverrides:n}),e().addPendingChange({type:"settings",data:{allowOverrides:n}}),yield e().syncWithSupabase()}),toggleEnforceBI:()=>yt(null,null,function*(){const{enforceBI:n}=e();yield e().setEnforceBI(!n)}),toggleEnforceCI:()=>yt(null,null,function*(){const{enforceCI:n}=e();yield e().setEnforceCI(!n)}),loadComplianceSettings:()=>yt(null,null,function*(){var n,a,i,c;r({complianceSettingsLoading:!0});try{const l=yield at.getCurrentFacilityId();if(!l)throw new Error("No facility ID available");const{data:o,error:d}=yield _.from("facilities").select("settings").eq("id",l).single();if(d&&d.code!=="PGRST116")throw d;const u=(n=o==null?void 0:o.settings)!=null?n:{},h=(a=u.enforce_bi)!=null?a:!1,p=(i=u.enforce_ci)!=null?i:!1,f=(c=u.allow_overrides)!=null?c:!1;r({enforceBI:!!h,enforceCI:!!p,allowOverrides:!!f,complianceSettingsLoading:!1})}catch(l){console.error("Failed to load compliance settings:",l),r({complianceSettingsLoading:!1,syncError:"Failed to load compliance settings"})}}),syncWithSupabase:()=>yt(null,null,function*(){r({isSyncing:!0,syncError:null});try{const n=yield at.getCurrentFacilityId();if(!n)throw new Error("No facility ID available");const{pendingChanges:a}=e();for(const i of a)try{switch(i.type){case"bi-test":i.data&&typeof i.data=="object"&&(yield qr.createBITestResult(xr(Vt({},i.data),{facility_id:n,result:"pass"})));break;case"bi-failure":i.data&&typeof i.data=="object"&&(yield kn.createIncident(xr(Vt({},i.data),{facility_id:n,affected_tools_count:0,affected_batch_ids:[]})));break;case"settings":if(i.data&&typeof i.data=="object"){const c=i.data,{data:l,error:o}=yield _.from("facilities").select("settings").eq("id",n).single();if(o)throw o;const d=(l==null?void 0:l.settings)||{},u=xr(Vt({},d),{enforce_bi:c.enforceBI,enforce_ci:c.enforceCI,allow_overrides:c.allowOverrides}),{error:h}=yield _.from("facilities").update({settings:u,updated_at:new Date().toISOString()}).eq("id",n);if(h)throw h}break}}catch(c){console.error(`Failed to sync ${i.type}:`,c)}r({isSyncing:!1,lastSyncTime:new Date,pendingChanges:[]})}catch(n){console.error("Sync failed:",n),r({isSyncing:!1,syncError:"Sync failed"})}}),syncBIFailureFromDatabase:n=>{const a=n;r({biFailureActive:a.status==="active",biFailureDetails:a.status==="active"?{id:a.id,incident_number:a.incident_number,failure_date:a.failure_date,affected_tools_count:a.affected_tools_count,affected_batch_ids:a.affected_batch_ids,failure_reason:a.failure_reason,severity_level:a.severity_level,status:a.status,detected_by_operator_id:a.detected_by_operator_id,regulatory_notification_sent:a.regulatory_notification_sent||!1,regulatory_notification_date:a.regulatory_notification_date,facility_id:a.facility_id||"",regulatory_notification_required:a.regulatory_notification_required||!1,created_at:a.created_at||new Date().toISOString(),updated_at:a.updated_at||new Date().toISOString()}:null})},addPendingChange:n=>{r(a=>({pendingChanges:[...a.pendingChanges,xr(Vt({},n),{id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date})]}))},clearPendingChanges:()=>r({pendingChanges:[]}),retryFailedSync:()=>yt(null,null,function*(){yield e().syncWithSupabase()}),addOptimisticUpdate:(n,a)=>{const{optimisticUpdates:i}=e();i.set(n,a),r({optimisticUpdates:new Map(i)})},removeOptimisticUpdate:n=>{const{optimisticUpdates:a}=e();a.delete(n),r({optimisticUpdates:new Map(a)})},clearOptimisticUpdates:()=>r({optimisticUpdates:new Map}),saveStateToLocalStorage:()=>{const n=e(),a={biTestCompleted:n.biTestCompleted,biTestDate:n.biTestDate,biTestResults:n.biTestResults,nextBITestDue:n.nextBITestDue,lastBITestDate:n.lastBITestDate,biTestPassed:n.biTestPassed,biTestOptedOut:n.biTestOptedOut,enforceBI:n.enforceBI,enforceCI:n.enforceCI,allowOverrides:n.allowOverrides,lastSyncTime:n.lastSyncTime};try{localStorage.setItem("biWorkflowState",JSON.stringify(a))}catch(i){console.error(i)}},loadStateFromLocalStorage:()=>{try{const n=localStorage.getItem("biWorkflowState");if(n){const a=JSON.parse(n);r({biTestCompleted:a.biTestCompleted||!1,biTestDate:a.biTestDate||null,biTestResults:a.biTestResults||[],nextBITestDue:a.nextBITestDue?new Date(a.nextBITestDue):null,lastBITestDate:a.lastBITestDate||null,biTestPassed:a.biTestPassed||!1,biTestOptedOut:a.biTestOptedOut||!1,enforceBI:a.enforceBI!==void 0?a.enforceBI:!0,enforceCI:a.enforceCI!==void 0?a.enforceCI:!0,allowOverrides:a.allowOverrides||!1,lastSyncTime:a.lastSyncTime?new Date(a.lastSyncTime):null})}}catch(n){console.error(n)}},clearLocalStorage:()=>{try{localStorage.removeItem("biWorkflowState")}catch(n){console.error(n)}},getBIComplianceStatus:()=>Zg(e()),getBIFailureRiskLevel:()=>ey(e()),getActivitySummary:()=>ty(e())});var my=Object.defineProperty,Qo=Object.getOwnPropertySymbols,hy=Object.prototype.hasOwnProperty,py=Object.prototype.propertyIsEnumerable,Yo=(r,e,t)=>e in r?my(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$e=(r,e)=>{for(var t in e||(e={}))hy.call(e,t)&&Yo(r,t,e[t]);if(Qo)for(var t of Qo(e))py.call(e,t)&&Yo(r,t,e[t]);return r};const K=Nt()((...r)=>$e($e($e($e($e($e($e($e($e($e($e($e($e({},jf(...r)),Cf(...r)),og(...r)),lg(...r)),xg(...r)),Zu(...r)),_g(...r)),Ig(...r)),Ju(...r)),Xu(...r)),Dg(...r)),Fg(...r)),uy(...r)));var ui=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Jo=(r,e)=>{const t=document.createElement("div");if(t.className=`
    fixed top-4 right-4 z-[10000] bg-white border-l-4 border-green-500 
    shadow-lg rounded-lg p-4 max-w-md transform transition-all duration-300 
    animate-slide-in-right
  `,t.style.cssText=`
    animation: slideInRight 0.3s ease-out;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  `,t.innerHTML=`
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div class="ml-3 flex-1">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-gray-800">${r}</h3>
          <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="ml-2 text-gray-400 hover:text-gray-600">
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
        <p class="mt-1 text-sm text-gray-600">${e}</p>
      </div>
    </div>
  `,!document.getElementById("cliniio-notification-styles")){const n=document.createElement("style");n.id="cliniio-notification-styles",n.textContent=`
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(n)}document.body.appendChild(t),setTimeout(()=>{t.parentElement&&(t.style.transform="translateX(100%)",t.style.opacity="0",setTimeout(()=>{t.parentElement&&t.remove()},300))},5e3)},Xo=()=>ui(null,null,function*(){try{const{SupabaseAuthService:r}=yield H(()=>import("./authService-FlO8B3wl.js"),__vite__mapDeps([0,1,2,3,4,5])),{user:e,error:t}=yield r.getCurrentUser();if(t&&console.warn("Auth service error:",t),e!=null&&e.id)return e.id;const n=sessionStorage.getItem("currentOperatorId")||localStorage.getItem("currentOperatorId");if(n)return n;throw console.error("No operator ID found in production. User may not be authenticated."),new Error("User not authenticated - no operator ID available")}catch(r){throw console.error("Failed to get operator ID:",r),new Error("Authentication required - unable to get operator ID")}}),fy=({onClose:r,onSuccess:e})=>{const{biFailureDetails:t,deactivateBIFailure:n}=K(),[a,i]=m.useState(!1),[c,l]=m.useState(null),[o,d]=m.useState(!1),[u,h]=m.useState(""),p=m.useCallback(()=>ui(null,null,function*(){i(!0),l(null);try{const S=yield Xo();if(!t)throw new Error("No BI failure incident to resolve");const C=sessionStorage.getItem("currentBIFailureIncidentId");if(C){const D=yield kn.resolveIncident({incidentId:C,resolvedByOperatorId:S,resolutionNotes:u});console.log("âœ… BI Failure Resolution completed:",{incidentId:C,resolvedByOperatorId:S,resolutionNotes:u,timestamp:new Date().toISOString()}),Jo("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const k=K.getState();k.loadBITestResults&&(k.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("ðŸ”„ Refreshed BI test results after incident resolution"))},1e3)}else{const D="550e8400-e29b-41d4-a716-446655440000",{data:k,error:P}=yield _.from("bi_failure_incidents").insert({facility_id:D,user_id:S,incident_type:"bi_test_failure",severity:"high",status:"open",description:"BI Test Failure - Contamination Detected",failure_reason:"Biological indicator test failed, indicating sterilization failure",metadata:{affected_tools_count:(t==null?void 0:t.affectedToolsCount)||1,affected_batch_ids:(t==null?void 0:t.affectedBatchIds)||["DEFAULT-BATCH"]}}).select().single();if(P)throw new Error(`Failed to create incident: ${P.message}`);const T=yield kn.resolveIncident({incidentId:k.id,resolvedByOperatorId:S,resolutionNotes:u}),A=K.getState();A.addActivity&&A.addActivity({id:`bi-incident-resolved-${k.id}`,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date,toolCount:(t==null?void 0:t.affectedToolsCount)||1,color:"bg-blue-500",metadata:{incidentId:k.id,operatorId:S,resolutionNotes:u}}),Jo("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const z=K.getState();z.loadBITestResults&&(z.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("ðŸ”„ Refreshed BI test results after incident resolution"))},1e3),console.log("âœ… BI Failure Resolution completed:",{incidentId:k.id,resolvedByOperatorId:S,resolutionNotes:u,timestamp:new Date().toISOString()}),sessionStorage.setItem("currentBIFailureIncidentId",k.id)}n(),e(),r()}catch(S){if(console.error("Failed to resolve BI failure incident:",S),S instanceof he)l({message:S.message,code:S.code,severity:S.severity,retryable:S.retryable});else if(S&&typeof S=="object"&&"name"in S&&S.name==="BIFailureError"){const C=S;l({message:C.message,code:C.code,severity:C.severity,retryable:C.retryable})}else l({message:S instanceof Error?S.message:"An unexpected error occurred",severity:"high",retryable:!1})}finally{i(!1)}}),[u,n,e,r,t]),f=m.useCallback(S=>ui(null,null,function*(){i(!0),l(null);try{const C=yield Xo(),D={facility_id:S.facilityId,detected_by_operator_id:C,affected_tools_count:S.affectedToolsCount,affected_batch_ids:S.affectedBatchIds,failure_reason:S.failureReason,severity_level:S.severityLevel||"high"};return yield kn.createIncident(D)}catch(C){throw console.error("Failed to create BI failure incident:",C),C instanceof he?l({message:C.message,code:C.code,severity:C.severity,retryable:C.retryable}):l({message:C instanceof Error?C.message:"Failed to create incident",severity:"high",retryable:!1}),C}finally{i(!1)}}),[]),g=m.useCallback(()=>{l(null),p()},[p]),y=m.useCallback(()=>{l(null),d(!1),r()},[r]),v=m.useCallback(S=>{S.target===S.currentTarget&&y()},[y]),b=m.useCallback(S=>{S.key==="Escape"&&y()},[y]),x=m.useCallback(()=>{d(S=>!S)},[]),w=m.useCallback(S=>{h(S)},[]),j=m.useCallback(()=>"mdiAlertCircle",[]),I=m.useCallback(S=>{switch(S){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},[]),E=m.useCallback(()=>a||!t,[a,t]),O=m.useCallback(()=>a?"Resolving...":"Confirm Resolution",[a]);return{isLoading:a,error:c,showExposureReport:o,resolutionNotes:u,biFailureDetails:t,handleResolve:p,createIncident:f,handleRetry:g,handleClose:y,handleBackdropClick:v,handleKeyDown:b,toggleExposureReport:x,updateResolutionNotes:w,getErrorIcon:j,getErrorColor:I,isResolveButtonDisabled:E,getResolveButtonText:O}},gy=({isSubmitting:r,onClose:e,onMinimize:t})=>{const n=()=>{r||e()},a=i=>{i.key==="Enter"&&!r&&n()};return s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(N,{path:$s,size:1.5,className:"text-red-500"}),s.jsxs("div",{children:[s.jsx("h2",{id:"bi-failure-modal-title",className:"text-xl font-semibold text-gray-900",children:"BI Failure Resolution Workflow"}),s.jsx("p",{id:"bi-failure-modal-description",className:"text-sm text-gray-600",children:"Complete these steps to resolve the BI failure"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[t&&s.jsx("button",{onClick:t,disabled:r,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${r?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Minimize workflow to banner",title:"Minimize to continue working on other tasks",children:s.jsx(N,{path:Un,size:1.2})}),s.jsx("button",{onClick:n,onKeyDown:a,disabled:r,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${r?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Close modal","aria-describedby":"bi-failure-modal-description",children:s.jsx(N,{path:Ae,size:1.2})})]})]})},Pi=()=>{const{biTestResults:r,cycles:e,currentCycle:t,availableTools:n}=K();return m.useMemo(()=>{if(!r||!Array.isArray(r))return{lastPassedDate:null,affectedCycles:[],affectedTools:[],totalToolsAffected:0,totalCyclesAffected:0,totalSterilizationEvents:0,toolsUsedMultipleTimes:0,uniqueOperators:[],dateRange:null,toolsByCategory:{},hasCurrentCycleAffected:!1};const a=r.filter(w=>w.passed).sort((w,j)=>new Date(j.date).getTime()-new Date(w.date).getTime())[0],i=a?new Date(a.date):null,c=t?[...e,t]:e,l=i?c.filter(w=>new Date(w.startTime)>i):c,o=l.flatMap(w=>w.tools.map(j=>j)),d=new Map;o.forEach(w=>{d.set(w,(d.get(w)||0)+1)});const h=Array.from(d.keys()).map(w=>n.find(I=>I.id===w)||{id:w,name:`Tool ${w}`,barcode:w,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:void 0,status:"available"}),p=h.length,f=l.length,g=o.length,y=h.filter(w=>(d.get(w.id)||0)>1).length,v=[...new Set(l.map(w=>w.operator).filter(w=>typeof w=="string"))],b=l.length>0?{start:new Date(Math.min(...l.map(w=>new Date(w.startTime).getTime()))),end:new Date(Math.max(...l.map(w=>new Date(w.startTime).getTime())))}:null,x=h.reduce((w,j)=>{const I=j.category||"Unknown";return w[I]=(w[I]||0)+1,w},{});return{lastPassedDate:i,affectedCycles:l,affectedTools:h,totalToolsAffected:p,totalCyclesAffected:f,totalSterilizationEvents:g,toolsUsedMultipleTimes:y,uniqueOperators:v,dateRange:b,toolsByCategory:x,hasCurrentCycleAffected:!!(t&&(!i||new Date(t.startTime)>i))}},[r,e,t,n])},yy=({biFailureDetails:r})=>{const e=Pi();return e.affectedCycles&&e.affectedCycles.map(t=>t.batchId).filter(t=>!!t),r?s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(N,{path:ce,size:1.2,className:"text-red-500"}),s.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),s.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4 p-3 bg-white rounded-lg border border-red-100",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"flex items-center justify-center mb-1",children:[s.jsx(N,{path:Ns,size:1,className:"text-red-500 mr-1"}),s.jsx("span",{className:"text-xs font-medium text-red-700",children:"Cycles"})]}),s.jsx("div",{className:"text-lg font-bold text-red-800",children:e.totalCyclesAffected})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"flex items-center justify-center mb-1",children:[s.jsx(N,{path:mr,size:1,className:"text-red-500 mr-1"}),s.jsx("span",{className:"text-xs font-medium text-red-700",children:"Batches"})]}),s.jsx("div",{className:"text-lg font-bold text-red-800",children:r.affectedBatchIds.length})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"flex items-center justify-center mb-1",children:[s.jsx(N,{path:ir,size:1,className:"text-red-500 mr-1"}),s.jsx("span",{className:"text-xs font-medium text-red-700",children:"Tools"})]}),s.jsx("div",{className:"text-lg font-bold text-red-800",children:r.affectedToolsCount})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"flex items-center justify-center mb-1",children:[s.jsx(N,{path:xp,size:1,className:"text-red-600 mr-1"}),s.jsx("span",{className:"text-xs font-medium text-red-700",children:"Multi-Use"})]}),s.jsx("div",{className:"text-lg font-bold text-red-800",children:e.toolsUsedMultipleTimes})]})]}),s.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:ir,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Affected Tools:"})," ",r.affectedToolsCount," tools are currently quarantined"]})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:Ns,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Failure Date:"})," ",r.date?r.date.toLocaleDateString():"Unknown date"]})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:Ns,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Risk Window:"})," ",e.dateRange?s.jsxs("span",{className:"font-mono text-xs",children:[e.dateRange.start.toLocaleDateString()," â†’"," ",e.dateRange.end.toLocaleDateString()]}):"All cycles (no previous passed BI test)"]})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:mr,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Affected Batches:"})," ",r.affectedBatchIds.length>0?s.jsxs("span",{className:"font-mono text-xs",children:[r.affectedBatchIds.slice(0,3).join(", "),r.affectedBatchIds.length>3&&` +${r.affectedBatchIds.length-3} more`]}):"No batch IDs available"]})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:ir,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Operator:"})," ",r.operator]})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:ir,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Tools by Category:"})," ",s.jsx("span",{className:"text-xs",children:e.toolsByCategory?Object.entries(e.toolsByCategory).map(([t,n])=>`${t}: ${n}`).join(", "):"No tools categorized"})]})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:ce,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Contamination Scope:"})," ",e.totalSterilizationEvents," total sterilization events in risk window."," ",e.toolsUsedMultipleTimes>0&&s.jsxs("span",{className:"text-red-600 font-medium",children:[e.toolsUsedMultipleTimes," tools used multiple times (require extra attention)"]})]})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(N,{path:ce,size:.8,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("strong",{children:"Detected By:"})," ",r.operator," â€¢"," ",s.jsx("strong",{children:"Date:"})," ",(()=>{try{return r.date?r.date instanceof Date?r.date.toLocaleDateString():new Date(r.date).toLocaleDateString():"Unknown date"}catch(t){return console.error("Date formatting error:",t),"Invalid date"}})()]})]})]})]}):s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(N,{path:ce,size:1.2,className:"text-red-500"}),s.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),s.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Affected Tools:"})," 0 tools are currently quarantined"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Failure Date:"})," Unknown date"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Affected Batches:"})," No batch IDs available"]})]})]})};var vy=Object.defineProperty,xy=Object.defineProperties,by=Object.getOwnPropertyDescriptors,Zo=Object.getOwnPropertySymbols,_y=Object.prototype.hasOwnProperty,wy=Object.prototype.propertyIsEnumerable,el=(r,e,t)=>e in r?vy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tl=(r,e)=>{for(var t in e||(e={}))_y.call(e,t)&&el(r,t,e[t]);if(Zo)for(var t of Zo(e))wy.call(e,t)&&el(r,t,e[t]);return r},rl=(r,e)=>xy(r,by(e)),Sy=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const jy=({onToggleExposureReport:r})=>{const{currentUser:e,initializeUserContext:t}=hr();m.useEffect(()=>{e||t()},[e,t]);const[n,a]=m.useState([]),[i,c]=m.useState(!1),[l,o]=m.useState(null);m.useEffect(()=>{const v=()=>{c(!0);const x=sessionStorage.getItem("biFailureWorkflowState");if(x)try{const w=JSON.parse(x);a(w),console.log("ðŸ“‹ Restored workflow state from session storage")}catch(w){console.error("Failed to parse saved workflow state:",w),b()}else b();c(!1)},b=()=>{a([{step_id:"quarantine",status:"in_progress"},{step_id:"re-sterilization",status:"pending"},{step_id:"new-bi-test",status:"pending"},{step_id:"documentation",status:"pending"}])};v()},[]);const d=v=>Sy(null,null,function*(){if(!e){console.error("No current user available - currentUser:",e);return}const b=e.id||e.email||"unknown-user",x=n.findIndex(w=>w.step_id===v);if(x===-1){console.error(`Step ${v} not found`);return}try{const w=[...n];w[x]=rl(tl({},w[x]),{status:"completed",completed_by_user_id:b,completed_at:new Date().toISOString(),notes:`Completed by ${e.email}`}),x+1<w.length&&(w[x+1]=rl(tl({},w[x+1]),{status:"in_progress"})),a(w),sessionStorage.setItem("biFailureWorkflowState",JSON.stringify(w)),console.log(`âœ… Step ${v} completed by ${e.email||"unknown user"}`)}catch(w){console.error(`Failed to complete step ${v}:`,w),o(`Failed to complete step: ${w instanceof Error?w.message:"Unknown error"}`)}}),u=v=>{const b=n.find(x=>x.step_id===v);return(b==null?void 0:b.status)||"pending"},h=v=>{const b=n.find(x=>x.step_id===v);return(b==null?void 0:b.status)==="in_progress"},p=v=>{const b=n.find(x=>x.step_id===v);return{completedBy:b==null?void 0:b.completed_by_user_id,completedAt:b==null?void 0:b.completed_at,notes:b==null?void 0:b.notes}},f=[{id:"quarantine",title:"Quarantine All Affected Tools",description:"Ensure all tools from affected batches are properly quarantined",icon:mr,isInteractive:!0},{id:"re-sterilization",title:"Re-sterilize All Quarantined Tools",description:"Re-sterilize all affected tools using proper protocols",icon:Ds,isInteractive:!0},{id:"new-bi-test",title:"Perform New BI Test",description:"Conduct a new biological indicator test to verify sterilization",icon:Ds,isInteractive:!0},{id:"documentation",title:"Complete Documentation",description:"Document all actions taken and results obtained",icon:Ye,isInteractive:!0}],g=v=>{switch(v){case"completed":return"text-green-600 bg-green-50 border-green-200";case"in_progress":return"text-blue-600 bg-blue-50 border-blue-200";case"pending":return"text-gray-600 bg-gray-50 border-gray-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},y=v=>{switch(v){case"completed":return"Completed";case"in_progress":return"In Progress";case"pending":return"Pending";default:return"Unknown"}};return i?s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading workflow progress..."})]})]}):l?s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(N,{path:ce,size:1.2,className:"text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:l})]})})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),s.jsx("div",{className:"space-y-3",children:f.map(v=>{const b=u(v.id),x=b==="completed",w=b==="pending",j=h(v.id),I=p(v.id);return s.jsx("div",{className:`border rounded-lg p-4 ${w?"text-gray-400 bg-gray-50 border-gray-200":g(b)}`,children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(N,{path:v.icon,size:1.2,className:"mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("h4",{className:"font-medium",children:v.title}),s.jsx("div",{className:"flex items-center space-x-2",children:j?s.jsxs("button",{onClick:()=>d(v.id),className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-xs font-medium",children:[s.jsx(N,{path:Ni,size:.8}),s.jsx("span",{children:"Mark Complete"})]}):x?s.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-white bg-opacity-75",children:y(b)}):w?s.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-200 text-gray-500",children:"Waiting for previous step"}):null})]}),s.jsx("p",{className:"text-sm opacity-90",children:v.description}),v.isInteractive&&x&&s.jsx("div",{className:"mt-2 text-xs opacity-75",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("span",{children:["âœ… Completed by:"," ",I.completedBy||"Unknown"]}),s.jsxs("span",{children:["ðŸ•’"," ",I.completedAt?new Date(I.completedAt).toLocaleString():"Unknown time"]})]})})]})]})},v.id)})}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{path:Cu,size:1.2,className:"text-blue-500"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Exposure Tracking"})]}),s.jsx("button",{onClick:r,onKeyDown:v=>v.key==="Enter"&&r(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium","aria-label":"View exposure report",children:"View Exposure Report"})]})})]})},Cy=({error:r,onRetry:e,getErrorColor:t})=>{if(!r)return null;const n=()=>{e()},a=i=>{i.key==="Enter"&&r.retryable&&n()};return s.jsx("div",{className:`border rounded-lg p-4 ${t(r.severity)}`,children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(N,{path:ce,size:1.2,className:"mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h4",{className:"font-medium",children:[r.severity==="critical"&&"Critical Error",r.severity==="high"&&"High Priority Error",r.severity==="medium"&&"Error",r.severity==="low"&&"Warning"]}),r.code&&s.jsxs("span",{className:"text-xs font-mono bg-white bg-opacity-75 px-2 py-1 rounded",children:["Error Code: ",r.code]})]}),s.jsx("p",{className:"text-sm mb-3",children:r.message}),r.retryable&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{onClick:n,onKeyDown:a,className:"inline-flex items-center space-x-1 px-3 py-1.5 text-sm font-medium bg-white bg-opacity-75 hover:bg-opacity-90 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-current","aria-label":"Retry the operation",children:[s.jsx(N,{path:pt,size:.9}),s.jsx("span",{children:"Retry"})]}),s.jsx("span",{className:"text-xs opacity-75",children:"This error may be temporary. You can try again."})]}),!r.retryable&&s.jsx("p",{className:"text-xs opacity-75",children:"This error requires manual intervention. Please contact your supervisor."})]})]})})},Ny=({isLoading:r,isResolveButtonDisabled:e,resolveButtonText:t,resolutionNotes:n,onResolve:a,onCancel:i,onUpdateNotes:c})=>{const l=h=>{c(h.target.value)},o=()=>{e||a()},d=()=>{r||i()},u=h=>{h.key==="Enter"&&(h.ctrlKey||h.metaKey)&&!e&&(h.preventDefault(),o()),h.key==="Escape"&&!r&&d()};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"resolution-notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Notes"}),s.jsx("textarea",{id:"resolution-notes",value:n,onChange:l,onKeyDown:u,disabled:r,rows:4,className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r?"bg-gray-100 cursor-not-allowed":"bg-white"}`,placeholder:"Document the steps taken to resolve this BI failure incident...","aria-describedby":"resolution-notes-help"}),s.jsx("p",{id:"resolution-notes-help",className:"mt-1 text-sm text-gray-500",children:"Include details about re-sterilization parameters, new BI test results, and any corrective actions taken."})]}),s.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[s.jsx("button",{onClick:d,disabled:r,className:`px-4 py-2 text-sm font-medium rounded-md border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${r?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,"aria-label":"Cancel resolution",children:"Cancel"}),s.jsx("button",{onClick:o,disabled:e,className:`px-4 py-2 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${e?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,"aria-label":"Resolve BI failure incident",children:t})]}),s.jsx("div",{className:"text-xs text-gray-500 text-center",children:s.jsxs("p",{children:[s.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Ctrl+Enter"})," ","to resolve â€¢"," ",s.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel"]})})]})};var sl=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const em={getLastSuccessfulBIDate(r){return sl(this,null,function*(){try{const{data:e,error:t}=yield _.from("bi_incidents").select("completed_at").eq("facility_id",r).eq("status","passed").order("completed_at",{ascending:!1}).limit(1).single();return t?(console.warn("No previous successful BI found or query failed:",t.message),null):(e==null?void 0:e.completed_at)||null}catch(e){return console.error("Error fetching lastSuccessfulBIDate:",e),null}})},getToolsInExposureWindow(r,e){return sl(this,null,function*(){var t;try{const{data:{user:n},error:a}=yield _.auth.getUser();if(a||!n)return console.error("Unauthorized: cannot fetch exposure tools."),[];const i=(t=n.user_metadata)==null?void 0:t.facility_id;if(!i)return console.error("Missing facility_id â€” cannot scope exposure query."),[];let c=r;c||(c=(yield em.getLastSuccessfulBIDate(i))||new Date(Date.now()-10080*60*1e3).toISOString());const l=e||new Date().toISOString(),{data:o,error:d}=yield _.from("sterilization_tools").select("id, name, last_used_at, status").eq("facility_id",i).gte("last_used_at",c).lte("last_used_at",l);if(d)throw new Error(d.message);return console.info(`âœ… Exposure window computed: ${c} â†’ ${l} (${(o==null?void 0:o.length)||0} tools)`),o||[]}catch(n){return console.error("Error computing exposure window:",n),[]}})}};class Iy{constructor(){this.cache=new Map,this.ttlMs=300*1e3}get(e){const t=this.cache.get(e);return t?Date.now()>t.expiresAt?(this.cache.delete(e),null):t.data:null}set(e,t,n){const a=n!=null?n:this.ttlMs;this.cache.set(e,{data:t,expiresAt:Date.now()+a})}clear(e){e?this.cache.delete(e):this.cache.clear()}get size(){return this.cache.size}}const Ln=new Iy;var Ty=Object.defineProperty,Ey=Object.defineProperties,ky=Object.getOwnPropertyDescriptors,nl=Object.getOwnPropertySymbols,Dy=Object.prototype.hasOwnProperty,Py=Object.prototype.propertyIsEnumerable,al=(r,e,t)=>e in r?Ty(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Oy=(r,e)=>{for(var t in e||(e={}))Dy.call(e,t)&&al(r,t,e[t]);if(nl)for(var t of nl(e))Py.call(e,t)&&al(r,t,e[t]);return r},Ry=(r,e)=>Ey(r,ky(e)),We=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Dn=Nt((r,e)=>({incidents:[],initError:null,setIncidents:t=>r({incidents:t}),setInitError:t=>r({initError:t}),subscribe:()=>{console.info("ðŸ“¡ Subscribing to realtime BI updatesâ€¦");const t=_.channel("bi_incident_updates").on("postgres_changes",{event:"*",schema:"public",table:"bi_incidents"},()=>We(null,null,function*(){const{data:n,error:a}=yield _.from("bi_incidents").select("*").order("created_at",{ascending:!1});if(a){console.error("Error refreshing BI data:",a);return}e().setIncidents(n)})).subscribe();window.__bi_channel__=t},unsubscribe:()=>{const t=window.__bi_channel__;t&&(console.info("ðŸ›‘ Unsubscribing from realtime BI updates"),_.removeChannel(t),window.__bi_channel__=null)}}));function Ay(){return We(this,null,function*(){var r;const e=Dn.getState().setInitError;try{const{data:{user:t},error:n}=yield _.auth.getUser();if(n||!t)throw new Error("Unauthorized: no authenticated user for BI init");const a=((r=t.user_metadata)==null?void 0:r.facility_id)||"",i=`bi_incidents:${a}`,c=Ln.get(i);if(c){console.info("ðŸ§  Loaded BI incidents from cache:",c.length),Dn.getState().setIncidents(c),e(null);return}const{data:l,error:o}=yield _.from("bi_incidents").select("*").eq("facility_id",a).order("created_at",{ascending:!1});if(o)throw new Error(o.message);Dn.getState().setIncidents(l||[]),Ln.set(i,l||[]),e(null),console.info(`âœ… Cached ${(l==null?void 0:l.length)||0} BI incidents for ${a}`)}catch(t){const n={message:t instanceof Error?t.message:String(t),at:new Date().toISOString()};e(n),yield ni.logSecurityEvent("security.bi_init_failed",n.message,{timestamp:n.at});try{const a=new CustomEvent("bi:init:error",{detail:n});window.dispatchEvent(a)}catch(a){}window.__BI_INIT_ERROR__=n,console.error("âŒ BI initialization failed:",n.message)}})}const $y={createIncident(r){return We(this,null,function*(){var e;if(!r.affected_batch_ids||!Array.isArray(r.affected_batch_ids)||r.affected_batch_ids.length===0)throw new Error("At least one affected batch ID is required");const{data:{user:t}}=yield _.auth.getUser();if(!t)return{error:"Unauthorized"};const{data:n,error:a}=yield _.from("bi_incidents").insert([Ry(Oy({},r),{created_by:t.id,facility_id:((e=t.user_metadata)==null?void 0:e.facility_id)||null})]).select().single();return a?{error:a.message}:{data:n}})},resolveIncident(r,e){return We(this,null,function*(){const{data:{user:t}}=yield _.auth.getUser();if(!t)return{error:"Unauthorized"};const{data:n,error:a}=yield _.from("bi_incidents").update({status:"resolved",resolution:e,resolved_by:t.id,resolved_at:new Date().toISOString()}).eq("id",r).select().single();return a?{error:a.message}:{data:n}})},fetchActivityLogs(r=50){return We(this,null,function*(){var e;try{const{data:{user:t},error:n}=yield _.auth.getUser();if(n||!t)return console.error("Unauthorized: cannot fetch BI activity logs without a valid user."),[];const a=(e=t.user_metadata)==null?void 0:e.facility_id;if(!a)return console.error("Missing facility_id for BI activity logs."),[];const{data:i,error:c}=yield _.from("bi_activity_logs").select("*").eq("facility_id",a).order("created_at",{ascending:!1}).limit(r);return c?(console.error("Error fetching BI activity logs:",c.message),[]):(console.info(`âœ… Loaded ${i.length} BI activity log entries`),i||[])}catch(t){return console.error("Unexpected BI log fetch error:",t),[]}})},identifyExposureWindowTools(r,e){return We(this,null,function*(){try{const t=yield em.getToolsInExposureWindow(r,e);return console.info(`âœ… Identified ${t.length} tools in exposure window.`),t}catch(t){return console.error("Error identifying exposure window tools:",t instanceof Error?t.message:String(t)),[]}})},getActiveIncidents(r){return We(this,null,function*(){try{const{data:e,error:t}=yield _.from("bi_failure_incidents").select("*").eq("facility_id",r).eq("status","active");if(t)throw t;return e||[]}catch(e){return console.error("Error fetching active incidents:",e),[]}})},getAnalyticsSummary(r,e){return We(this,null,function*(){try{return{totalIncidents:0,resolvedIncidents:0,averageResolutionTime:0,facilityId:r,timeRange:e}}catch(t){return console.error("Error fetching analytics summary:",t),null}})},sendRegulatoryNotification(r,e){return We(this,null,function*(){try{return console.log(`Sending ${e} notification for incident ${r}`),{success:!0,message:"Notification sent"}}catch(t){return console.error("Error sending regulatory notification:",t),{success:!1,message:"Failed to send notification"}}})},generatePatientExposureReport(r){return We(this,null,function*(){try{return{incidentNumber:`BI-FAIL-${r}`,exposureSummary:{totalPatientsExposed:15,highRiskPatients:3,mediumRiskPatients:7,lowRiskPatients:5},riskBreakdown:{high:3,medium:7,low:5},exposureDetails:[{patientId:"P001",riskLevel:"high",exposureDate:"2024-01-15",procedures:["Surgery A","Surgery B"]},{patientId:"P002",riskLevel:"medium",exposureDate:"2024-01-15",procedures:["Surgery C"]}],recommendations:["Immediate patient notification required","Enhanced monitoring for high-risk patients","Review sterilization protocols"],generatedAt:new Date().toISOString(),generatedBy:"system"}}catch(e){throw console.error("Error generating patient exposure report:",e),new Error("Failed to generate patient exposure report")}})},generateIncidentNumber(r){return We(this,null,function*(){try{const{data:e,error:t}=yield _.from("bi_failure_incidents").select("incident_number").eq("facility_id",r).order("created_at",{ascending:!1}).limit(1);if(t)throw t;const n=e==null?void 0:e[0],i=(n!=null&&n.incident_number?parseInt(n.incident_number.split("-").pop()||"0"):0)+1;return`BI-FAIL-${r}-${i.toString().padStart(3,"0")}`}catch(e){throw console.error("Error generating incident number:",e),e}})},subscribeToBIFailureUpdates(r){return We(this,null,function*(){try{return console.log(`Subscribing to BI failure updates for facility: ${r}`),Promise.resolve()}catch(e){throw console.error("Error subscribing to BI failure updates:",e),e}})}};var My=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const tm={exportExposureReport(r="csv"){return My(this,null,function*(){var e;try{const{data:{user:t},error:n}=yield _.auth.getUser();if(n||!t)throw new Error("Unauthorized: no authenticated user.");const a=(e=t.user_metadata)==null?void 0:e.facility_id;if(!a)throw new Error("Missing facility_id.");const{data:i,error:c}=yield _.from("patient_exposure_reports").select("*").eq("facility_id",a).order("created_at",{ascending:!1});if(c)throw new Error(c.message);if(!i||i.length===0)throw new Error("No exposure data available.");if(r==="csv"){const l=Object.keys(i[0]),o=[l.join(","),...i.map(h=>l.map(p=>{var f;return JSON.stringify((f=h[p])!=null?f:"")}).join(","))],d=new Blob([o.join(`
`)],{type:"text/csv"}),u=document.createElement("a");u.href=URL.createObjectURL(d),u.download=`exposure_report_${a}.csv`,u.click(),console.info("âœ… Exposure report exported to CSV")}else if(r==="pdf"){const l=window.open("","_blank");if(l){const o=`
            <html>
              <head><title>Exposure Report</title></head>
              <body>
                <h2>Patient Exposure Report</h2>
                <table border="1" cellspacing="0" cellpadding="5">
                  <thead><tr>${Object.keys(i[0]).map(d=>`<th>${d}</th>`).join("")}</tr></thead>
                  <tbody>
                    ${i.map(d=>`<tr>${Object.values(d).map(u=>`<td>${u!=null?u:""}</td>`).join("")}</tr>`).join("")}
                  </tbody>
                </table>
                <script>window.print()<\/script>
              </body>
            </html>`;l.document.write(o),l.document.close()}console.info("ðŸ–¨ï¸ Exposure report opened in print view")}}catch(t){console.error("âŒ Export failed:",t instanceof Error?t.message:String(t)),alert(`Export failed: ${t instanceof Error?t.message:String(t)}`)}})}};var rm=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Fy=()=>rm(null,null,function*(){try{const{biFailureDetails:r}=K.getState(),e=sessionStorage.getItem("currentBIFailureIncidentId");if(e)return e;if(r){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const a=Math.random()*16|0;return(n==="x"?a:a&3|8).toString(16)});return sessionStorage.setItem("currentBIFailureIncidentId",t),t}return null}catch(r){return console.error("Failed to get current incident ID:",r),null}}),il=()=>{tm.exportExposureReport("pdf")},ol=()=>{tm.exportExposureReport("csv")},Ly=({isOpen:r,onClose:e,incidentId:t})=>{const[n,a]=m.useState(null),[i,c]=m.useState(!1),[l,o]=m.useState(null),d=m.useCallback(()=>rm(null,null,function*(){c(!0),o(null);try{const f=t||(yield Fy());if(!f)throw new Error("No incident ID available for exposure report");const g=yield $y.generatePatientExposureReport(f);a(g)}catch(f){o(f instanceof Error?f.message:"Failed to load exposure report")}finally{c(!1)}}),[t]);m.useEffect(()=>{r&&d()},[r,d]);const u=()=>{a(null),o(null),e()},h=f=>{f.target===f.currentTarget&&u()},p=f=>{f.key==="Escape"&&u()};return r?Rs.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:h,onKeyDown:p,role:"button",tabIndex:0,"aria-label":"Close modal backdrop",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto scrollbar-hide",role:"dialog","aria-labelledby":"exposure-report-title","aria-describedby":"exposure-report-description",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(N,{path:Cu,size:1.5,className:"text-blue-500"}),s.jsxs("div",{children:[s.jsx("h2",{id:"exposure-report-title",className:"text-xl font-semibold text-gray-900",children:"Exposure Report"}),s.jsx("p",{id:"exposure-report-description",className:"text-sm text-gray-600",children:'Tools scanned dirty in "IN USE" rooms during BI failure risk window'})]})]}),s.jsx("button",{onClick:u,onKeyDown:f=>f.key==="Enter"&&u(),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close exposure report",children:s.jsx(N,{path:Ae,size:1.2})})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[i&&s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),s.jsx("span",{className:"ml-3 text-gray-600",children:"Loading exposure report..."})]}),l&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{path:ce,size:1.2,className:"text-red-500"}),s.jsxs("span",{className:"text-red-800",children:["Error: ",l]})]})}),n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(N,{path:$s,size:1.2,className:"text-red-500"}),s.jsx("span",{className:"font-medium text-red-800",children:'"IN USE" Rooms with Tool Contamination'})]}),s.jsx("p",{className:"text-2xl font-bold text-red-900 mb-3",children:n.totalRoomsAffected}),s.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[s.jsx("p",{className:"font-medium",children:"Risk Window Analysis:"}),s.jsx("p",{children:'This count shows tools that were used between the last passed BI test and the failed BI test. The tools have been traced to the rooms that were marked "IN USE" and scanned for use, taking them from a clean to dirty status.'}),s.jsx("p",{className:"font-medium text-red-800",children:"âš ï¸ Important:"}),s.jsx("p",{children:"These tools could have been cycled through the autoclave many times before a failed BI was identified. It is important to validate this list against your patient records software to initiate a patient trace and contact plan (if in your policies and procedures)."})]})]})}),n.roomDetails&&n.roomDetails.length>0?s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Room Exposure Analysis"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:'Tools scanned dirty in "IN USE" rooms during risk window'})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time/Date"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Room"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Associated Tools Scanned"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.roomDetails.map((f,g)=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"font-medium",children:new Date(f.roomUsedDate).toLocaleDateString()}),s.jsx("div",{className:"text-xs text-gray-500",children:new Date(f.roomUsedDate).toLocaleTimeString()})]})}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"font-medium",children:f.roomName}),s.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",f.roomId]})]})}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:f.contaminatedTools.length>0?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[f.contaminatedTools.length," tool",f.contaminatedTools.length!==1?"s":""," ","scanned dirty"]}),s.jsx("div",{className:"flex flex-wrap gap-1",children:f.contaminatedTools.map((y,v)=>s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:y},v))})]}):s.jsx("span",{className:"text-gray-400 italic",children:"No tools scanned"})})]},g))})]})})]}):s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(N,{path:Ii,size:1.2,className:"text-green-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-green-800",children:"No Room Exposure Found"}),s.jsxs("div",{className:"text-green-700 space-y-2",children:[s.jsx("p",{children:'Based on tool scans, it looks as though no tools that were autoclaved after the passed BI and before the failed BI have been initiated in the "dirty tool" status.'}),s.jsx("p",{className:"font-medium text-green-800",children:"This would indicate that there is no patient tracing needed."}),s.jsx("p",{className:"text-sm",children:"However, if your team is not scanning consistently, this data could be inaccurate."})]})]})]})}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs("button",{onClick:ol,onKeyDown:f=>f.key==="Enter"&&ol(),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Export exposure report",children:[s.jsx(N,{path:Ti,size:1}),s.jsx("span",{children:"Export Report"})]}),s.jsxs("button",{onClick:il,onKeyDown:f=>f.key==="Enter"&&il(),className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Print exposure report",children:[s.jsx(N,{path:Nu,size:1}),s.jsx("span",{children:"Print Report"})]})]}),s.jsx("button",{onClick:u,onKeyDown:f=>f.key==="Enter"&&u(),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})]})]})]})]})}),document.body):null};var zy=Object.defineProperty,By=Object.defineProperties,qy=Object.getOwnPropertyDescriptors,ll=Object.getOwnPropertySymbols,Uy=Object.prototype.hasOwnProperty,Hy=Object.prototype.propertyIsEnumerable,cl=(r,e,t)=>e in r?zy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vy=(r,e)=>{for(var t in e||(e={}))Uy.call(e,t)&&cl(r,t,e[t]);if(ll)for(var t of ll(e))Hy.call(e,t)&&cl(r,t,e[t]);return r},Wy=(r,e)=>By(r,qy(e));const Gy=({isOpen:r,onClose:e,onMinimize:t,isMinimized:n=!1})=>{const{isLoading:a,error:i,showExposureReport:c,resolutionNotes:l,biFailureDetails:o,handleResolve:d,handleRetry:u,handleClose:h,handleBackdropClick:p,handleKeyDown:f,toggleExposureReport:g,updateResolutionNotes:y,getErrorColor:v,isResolveButtonDisabled:b,getResolveButtonText:x}=fy({onClose:e,onSuccess:()=>{}});return r?Rs.createPortal(s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 p-4",style:{paddingTop:"12rem"},onClick:p,role:"button",tabIndex:0,"aria-label":"Close modal by clicking outside",onKeyDown:w=>{if(w.key==="Enter"||w.key===" "){w.preventDefault();const j=Wy(Vy({},w),{target:w.currentTarget,currentTarget:w.currentTarget,nativeEvent:w.nativeEvent,bubbles:!0,cancelable:!0,button:0});p(j)}},children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-y-auto transform translate-y-16 scrollbar-hide",role:"dialog","aria-labelledby":"bi-failure-modal-title","aria-describedby":"bi-failure-modal-description",onKeyDown:f,children:[s.jsx(gy,{isSubmitting:a,onClose:h,onMinimize:t}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx(yy,{biFailureDetails:o}),s.jsx(jy,{showExposureReport:c,onToggleExposureReport:g}),s.jsx(Cy,{error:i,onRetry:u,getErrorColor:v}),s.jsx(Ny,{isLoading:a,isResolveButtonDisabled:b(),resolveButtonText:x(),resolutionNotes:l,onResolve:d,onCancel:h,onUpdateNotes:y})]})]}),c&&s.jsx(Ly,{isOpen:c,onClose:g,incidentId:o==null?void 0:o.id})]}),document.body):null},Ky=({isOpen:r,onClose:e})=>s.jsx(Gy,{isOpen:r,onClose:e}),Qy=({onDismiss:r})=>{const[e,t]=m.useState(!1),[n,a]=m.useState(!1),{biFailureActive:i,biFailureDetails:c}=K(),{currentUser:l}=hr();return i?s.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[9999] bg-red-600 text-white shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.jsx("div",{className:"p-1 bg-red-700 rounded-lg flex-shrink-0",children:s.jsx(N,{path:ce,size:1.2,className:"text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("h3",{className:"text-lg font-bold",children:"ðŸš¨ TOOL RECALL: BI TEST FAILURE"}),s.jsx("span",{className:"text-sm bg-red-700 px-2 py-1 rounded",children:c!=null&&c.date?c.date instanceof Date?c.date.toLocaleDateString():new Date(c.date).toLocaleDateString():"Today"})]}),s.jsxs("p",{className:"text-sm text-red-100 mt-1",children:[s.jsx("strong",{children:"CRITICAL:"})," All tools sterilized since the last successful BI test must be quarantined immediately. Check packaging for affected batch numbers."]})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:()=>{t(!0),a(!1)},className:"flex items-center gap-2 bg-red-700 hover:bg-red-800 px-3 py-1 rounded-lg transition-colors",title:n?"Resume workflow":"View resolution workflow",children:[s.jsx(N,{path:Iu,size:1,className:"text-white"}),s.jsx("span",{className:"text-sm font-medium",children:n?"Resume Workflow":"Resolution Workflow"})]}),(c==null?void 0:c.affectedToolsCount)!==void 0&&s.jsxs("div",{className:"flex items-center gap-2 bg-red-700 px-3 py-1 rounded-lg",children:[s.jsx(N,{path:mr,size:1,className:"text-white"}),s.jsxs("span",{className:"text-sm font-medium",children:[c.affectedToolsCount," tools affected"]})]}),r&&s.jsx("button",{onClick:r,className:"p-1 hover:bg-red-700 rounded-lg transition-colors",title:"Dismiss banner",children:s.jsx(N,{path:Ae,size:1.2,className:"text-white"})})]})]}),s.jsx(Ky,{isOpen:e,onClose:()=>t(!1)})]}):null},Yy=({onDismiss:r})=>{const e=qn();return e.pathname==="/login"||e.pathname.startsWith("/auth")?null:s.jsx(Qy,{onDismiss:r})};var Jy=Object.defineProperty,dl=Object.getOwnPropertySymbols,Xy=Object.prototype.hasOwnProperty,Zy=Object.prototype.propertyIsEnumerable,ul=(r,e,t)=>e in r?Jy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,e0=(r,e)=>{for(var t in e||(e={}))Xy.call(e,t)&&ul(r,t,e[t]);if(dl)for(var t of dl(e))Zy.call(e,t)&&ul(r,t,e[t]);return r};class Vn{static subscribe(e,t,n={}){const a=this.getChannelKey(e,n);if(!this.subscriptions.has(a)){if(!Es())return console.warn("âš ï¸ Supabase not configured, skipping real-time subscription"),()=>{};try{const c=_.channel(a).on("postgres_changes",e0({event:n.event||"*",schema:"public",table:e},n.filter&&{filter:n.filter}),l=>{const o=this.channelSubscribers.get(a);o&&o.forEach(d=>d(l))}).subscribe();this.subscriptions.set(a,c),this.channelSubscribers.set(a,new Set),console.log(`âœ… Created shared realtime channel: ${a}`)}catch(c){return console.error(`âŒ Failed to create realtime channel ${a}:`,c),()=>{}}}const i=this.channelSubscribers.get(a);return i.add(t),console.log(`ðŸ“¡ Added subscriber to ${a} (total: ${i.size})`),()=>{this.unsubscribe(a,t)}}static unsubscribe(e,t){const n=this.channelSubscribers.get(e);if(n&&(n.delete(t),n.size===0)){const a=this.subscriptions.get(e);a&&(_.removeChannel(a),this.subscriptions.delete(e),this.channelSubscribers.delete(e),console.log(`ðŸ”• Cleaned up channel: ${e}`))}}static getChannelKey(e,t){const n=[e];return t.event&&t.event!=="*"&&n.push(t.event),t.filter&&n.push(t.filter),n.join("_")}static getStats(){return{activeChannels:this.subscriptions.size,totalSubscribers:Array.from(this.channelSubscribers.values()).reduce((e,t)=>e+t.size,0),tableSubscribers:Object.fromEntries(Array.from(this.channelSubscribers.entries()).map(([e,t])=>[e,t.size]))}}static cleanup(){this.subscriptions.forEach(e=>{_.removeChannel(e)}),this.subscriptions.clear(),this.channelSubscribers.clear(),console.log("ðŸ§¹ Cleaned up all realtime subscriptions")}static nuclearCleanup(){console.log("ðŸ§¹ Force cleaning up all realtime connections"),this.cleanup()}}Vn.subscriptions=new Map;Vn.channelSubscribers=new Map;class sm{static initialize(){if(this.isInitialized){$.realtime("ðŸ”„ SimpleRealtimeAutoOptimizer already initialized");return}$.realtime("ðŸš€ SimpleRealtimeAutoOptimizer: Initialized (simplified)"),this.isInitialized=!0}static forceRestart(){$.realtime("ðŸ”„ SimpleRealtimeAutoOptimizer: Force restart (simplified)")}static getStatus(){return{isInitialized:this.isInitialized,optimizationStatus:{isRunning:!0,interval:"simplified",mode:"simplified"}}}static immediateNuclearCleanup(){$.realtime("ðŸ§¹ SimpleRealtimeAutoOptimizer: Immediate cleanup"),Vn.cleanup()}}sm.isInitialized=!1;sm.initialize();class nm{static startOptimization(){if(this.isOptimizing){$.realtime("ðŸ”„ SimpleRealtimeOptimizer already running");return}this.isOptimizing=!0,$.realtime("ðŸš€ Started simplified realtime optimization")}static stopOptimization(){this.isOptimizing=!1,$.realtime("â¹ï¸ Stopped simplified realtime optimization")}static getStatus(){return{isRunning:this.isOptimizing,interval:this.isOptimizing?"simplified":"inactive",mode:this.isOptimizing?"simplified":"inactive"}}static emergencyCleanup(){$.realtime("ðŸ§¹ Emergency cleanup (simplified)"),Vn.cleanup()}}nm.isOptimizing=!1;setTimeout(()=>{$.realtime("ðŸš€ Auto-starting simplified realtime optimization..."),nm.startOptimization()},2e3);var t0=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const r0=({isOpen:r,onOpen:e,onClose:t})=>{const{currentUser:n,getUserDisplayName:a,isLoading:i,clearUserData:c}=hr(),[l,o]=m.useState(!1),d=m.useRef(null),u=Br(),p=qn().pathname;if(i)return s.jsx("div",{className:"bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen w-16 sm:w-20 md:w-20",children:s.jsx("div",{className:"flex-1 pt-4 flex justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[#4ECDC4]"})})});const f=y=>{u(y)},g=[{path:"/home",icon:Bh,label:"Home"},{path:"/sterilization",icon:qh,label:"Sterilization"},{path:"/inventory",icon:Uh,label:"Inventory"},{path:"/environmental-clean",icon:Hh,label:"Environmental Clean"},{path:"/knowledge-hub",icon:Vh,label:"Knowledge Hub"},{path:"/intelligence",icon:Wh,label:"Intelligence"},{path:"/settings",icon:Gh,label:"Settings"}];return s.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen ${r?"w-full sm:w-64 md:w-64":"w-16 sm:w-20 md:w-20"}`,children:[s.jsxs("div",{className:"flex-1 pt-4 overflow-y-auto",children:[r?s.jsxs("div",{className:"px-4 sm:px-6 pb-6 flex justify-between items-center",children:[s.jsx("div",{className:"relative",children:s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[#4ECDC4]",children:"Cliniio"})}),s.jsx("button",{onClick:t,onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),t())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Collapse navigation menu (Press Enter or Space)",title:"Collapse menu (Enter/Space)",tabIndex:0,children:s.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 12H5"})})})]}):s.jsx("div",{className:"px-4 sm:px-6 pb-6 flex justify-center items-center",children:s.jsx("button",{onClick:e,onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),e())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Expand navigation menu (Press Enter or Space)",title:"Expand menu (Enter/Space)",tabIndex:0,children:s.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5l7 7-7 7"})})})}),s.jsx("nav",{children:g.map(({path:y,icon:v,label:b})=>s.jsxs("button",{onClick:()=>f(y),className:`flex items-center transition-colors duration-200 w-full text-left touch-manipulation ${r?"px-4 sm:px-6 py-4":"px-3 sm:px-4 py-4 justify-center"} ${p===y?"bg-[#4ECDC4] bg-opacity-10 border-r-4 border-[#4ECDC4] text-[#4ECDC4]":"text-[#5b5b5b] hover:bg-gray-50 hover:text-[#4ECDC4]"}`,"aria-label":r?b:`${b} page`,title:r?void 0:b,children:[s.jsx(v,{size:20,className:`${r?"mr-4":""} ${p===y?"text-[#4ECDC4]":"text-gray-400"}`,"aria-hidden":"true"}),r&&s.jsx("span",{className:`font-medium whitespace-nowrap ${p===y?"text-[#4ECDC4]":"text-[#5b5b5b]"}`,children:b})]},y))})]}),s.jsx("div",{className:`${r?"p-3 sm:p-4":"p-1"} border-t border-gray-200 bg-white sticky bottom-0`,children:s.jsxs("div",{className:"relative",children:[s.jsxs("button",{ref:d,className:`flex items-center space-x-4 w-full text-left ${r?"mb-4":"justify-center mb-2"}`,onClick:()=>o(y=>!y),onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&o(v=>!v)},"aria-expanded":l,"aria-haspopup":"true","aria-label":r?`User menu for ${n?a():"User"}`:"User profile menu",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4ECDC4] flex items-center justify-center overflow-hidden",children:n!=null&&n.avatar_url?s.jsx("img",{src:n.avatar_url,alt:"Profile",className:"w-8 h-8 rounded-full object-cover",onLoad:()=>console.log("Avatar image loaded successfully in DrawerMenu"),onError:y=>console.error("Avatar image failed to load in DrawerMenu:",y)}):s.jsx(Kh,{size:20,className:"text-white"})}),r&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-700",children:a()}),s.jsx("p",{className:"text-xs text-gray-500",children:(n==null?void 0:n.role)||"User"})]})]}),l&&r&&s.jsx("div",{role:"menu","aria-labelledby":"user-menu",style:{position:"absolute",bottom:56,left:0,background:"white",borderRadius:8,boxShadow:"0 2px 16px rgba(0,0,0,0.15)",minWidth:180,zIndex:100,padding:12,textAlign:"center"},children:s.jsx("button",{role:"menuitem",className:"px-4 py-2 bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] w-full",onClick:()=>t0(null,null,function*(){console.log("ðŸšª DrawerMenu: Logout button clicked");try{console.log("ðŸšª DrawerMenu: Starting logout process..."),console.log("ðŸšª DrawerMenu: Calling clearUserData()..."),c(),yield new Promise(b=>setTimeout(b,100)),console.log("ðŸšª DrawerMenu: Calling login store reset()...");const{useLoginStore:y}=yield H(()=>import("./login-BkZ1x_Cy.js").then(b=>b.ad),__vite__mapDeps([1,2,3,4,5]));yield y.getState().reset(),console.log("ðŸšª DrawerMenu: Calling auth service logout()..."),yield new Su().logout(),console.log("ðŸšª DrawerMenu: Logout successful, navigating to login"),u("/login"),o(!1),console.log("ðŸ”„ DrawerMenu: Reloading page for clean state..."),window.location.reload()}catch(y){console.error("ðŸšª DrawerMenu: Logout failed:",y),u("/login"),o(!1),console.log("ðŸ”„ DrawerMenu: Reloading page after logout error..."),window.location.reload()}}),children:"Logout"})})]})})]})},s0=()=>{const r=qn();return{getCurrentContext:()=>{const t=r.pathname;return t.includes("/sterilization")?"sterilization":t.includes("/inventory")?"inventory":t.includes("/environmental-clean")?"environmental-clean":t.includes("/home")?"home":"general"}}},n0=r=>{const e=Br(),{getCurrentContext:t}=s0(),[n,a]=m.useState(null),[i,c]=m.useState(null),[l,o]=m.useState(new Set),[d,u]=m.useState(new Set),[h,p]=m.useState(new Set),[f,g]=m.useState(new Set),y=t();return{selectedHelpType:n,expandedMetrics:l,expandedTasks:d,expandedGamification:h,expandedRelevant:f,currentContext:y,handleOptionClick:S=>{S.action==="ai-chat"?a("ai-chat"):S.action==="context-help"?a("context-help"):S.action==="cliniio-help"?a("cliniio-help"):S.action==="product-feedback"?a("product-feedback"):S.action==="page"&&S.path?(e(S.path),r()):S.action==="modal"&&alert(`${S.title} - Coming soon! This will open a focused help interface.`)},handleBack:()=>{i?(a(i),c(null)):a(null)},handleFeedbackSuccess:()=>{a("cliniio-help")},toggleMetricSection:S=>{o(C=>{const D=new Set(C);return D.has(S)?D.delete(S):D.add(S),D})},toggleTaskSection:S=>{u(C=>{const D=new Set(C);return D.has(S)?D.delete(S):D.add(S),D})},toggleGamificationSection:S=>{p(C=>{const D=new Set(C);return D.has(S)?D.delete(S):D.add(S),D})},toggleRelevantSection:S=>{g(C=>{const D=new Set(C);return D.has(S)?D.delete(S):D.add(S),D})},setHelpType:S=>{c(n),a(S)}}},ml=({onOptionClick:r})=>{const e=[{id:"ai-assistant",icon:s.jsx("span",{children:"ðŸ¤–"}),title:"AI Assistant",description:"Get AI-powered help and answers",action:"ai-chat"},{id:"cliniio-help",icon:s.jsx("span",{children:"ðŸ’¬"}),title:"Cliniio Help",description:"General help and support",action:"cliniio-help"},{id:"context-help",icon:s.jsx("span",{children:"ðŸ“š"}),title:"Relevant Information",description:"Standards and protocols for your current task",action:"context-help"},{id:"product-feedback",icon:s.jsx("span",{children:"ðŸ’¡"}),title:"Product Feedback",description:"Report bugs or suggest improvements",action:"product-feedback"}];return s.jsx("div",{className:"p-4 space-y-3",children:e.map(t=>s.jsx("button",{onClick:()=>r(t),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:t.icon}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors text-sm",children:t.title}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]})},t.id))})};var a0=Object.defineProperty,hl=Object.getOwnPropertySymbols,i0=Object.prototype.hasOwnProperty,o0=Object.prototype.propertyIsEnumerable,pl=(r,e,t)=>e in r?a0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ys=(r,e)=>{for(var t in e||(e={}))i0.call(e,t)&&pl(r,t,e[t]);if(hl)for(var t of hl(e))o0.call(e,t)&&pl(r,t,e[t]);return r},es=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Oi{constructor(e={}){this.config=Ys({maxRequests:100,windowMs:60*1e3,burstLimit:10,retryDelay:1e3,maxRetries:3},e),this.generalLimiter=new Vs({maxRequests:this.config.maxRequests,windowMs:this.config.windowMs,keyPrefix:"ai_general",blockDurationMs:this.config.windowMs}),this.burstLimiter=new Vs({maxRequests:this.config.burstLimit,windowMs:10*1e3,keyPrefix:"ai_burst",blockDurationMs:30*1e3})}checkRateLimit(e,t=!1){return es(this,null,function*(){try{if(t){const a=yield this.burstLimiter.checkRateLimit(e);if(!a.allowed)return{allowed:!1,remaining:0,resetTime:a.resetTime,retryAfter:a.retryAfter,burstRemaining:0}}const n=yield this.generalLimiter.checkRateLimit(e);return{allowed:n.allowed,remaining:n.remaining,resetTime:n.resetTime,retryAfter:n.retryAfter,burstRemaining:t?yield this.getBurstRemaining(e):void 0}}catch(n){return $.error("AI rate limit check failed:",n),{allowed:!0,remaining:this.config.maxRequests,resetTime:Date.now()+this.config.windowMs}}})}recordRequest(e,t=!1){return es(this,null,function*(){try{t&&(yield this.burstLimiter.checkRateLimit(e)),yield this.generalLimiter.checkRateLimit(e)}catch(n){$.error("AI rate limit recording failed:",n)}})}getBurstRemaining(e){return es(this,null,function*(){try{return(yield this.burstLimiter.getRateLimitStatus(e)).remaining}catch(t){return $.error("Failed to get burst remaining:",t),this.config.burstLimit}})}resetRateLimit(e){return es(this,null,function*(){try{yield Promise.all([this.generalLimiter.resetRateLimit(e),this.burstLimiter.resetRateLimit(e)])}catch(t){$.error("Failed to reset AI rate limits:",t)}})}getStatus(e){return es(this,null,function*(){try{const[t,n]=yield Promise.all([this.generalLimiter.getRateLimitStatus(e),this.burstLimiter.getRateLimitStatus(e)]);return{general:{allowed:t.allowed,remaining:t.remaining,resetTime:t.resetTime,retryAfter:t.retryAfter},burst:{allowed:n.allowed,remaining:n.remaining,resetTime:n.resetTime,retryAfter:n.retryAfter}}}catch(t){return $.error("Failed to get AI rate limit status:",t),{general:{allowed:!0,remaining:this.config.maxRequests,resetTime:Date.now()+this.config.windowMs},burst:{allowed:!0,remaining:this.config.burstLimit,resetTime:Date.now()+10*1e3}}}})}updateConfig(e){this.config=Ys(Ys({},this.config),e),this.generalLimiter=new Vs({maxRequests:this.config.maxRequests,windowMs:this.config.windowMs,keyPrefix:"ai_general",blockDurationMs:this.config.windowMs}),this.burstLimiter=new Vs({maxRequests:this.config.burstLimit,windowMs:10*1e3,keyPrefix:"ai_burst",blockDurationMs:30*1e3}),$.info("AI rate limiter configuration updated",e)}getConfigs(){return Ys({},this.config)}getStats(){return{general:this.generalLimiter.getStats(),burst:this.burstLimiter.getStats(),config:this.config}}isHealthy(){try{const e=this.generalLimiter.getStats(),t=this.burstLimiter.getStats();return e.redisHealthy||t.redisHealthy}catch(e){return $.error("Health check failed:",e),!1}}}const mi=new Oi({maxRequests:50,windowMs:60*1e3,burstLimit:5,retryDelay:2e3,maxRetries:3});new Oi({maxRequests:20,windowMs:60*1e3,burstLimit:3,retryDelay:3e3,maxRetries:2});new Oi({maxRequests:10,windowMs:300*1e3,burstLimit:2,retryDelay:5e3,maxRetries:1});var l0=Object.defineProperty,fl=Object.getOwnPropertySymbols,c0=Object.prototype.hasOwnProperty,d0=Object.prototype.propertyIsEnumerable,gl=(r,e,t)=>e in r?l0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,da=(r,e)=>{for(var t in e||(e={}))c0.call(e,t)&&gl(r,t,e[t]);if(fl)for(var t of fl(e))d0.call(e,t)&&gl(r,t,e[t]);return r},Js=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class u0{constructor(e={}){this.queue=[],this.processing=!1,this.activeRequests=0,this.processingInterval=null,this.results=new Map,this.config=da({maxConcurrent:5,batchSize:3,processingInterval:1e3,retryDelay:2e3},e)}addRequest(e,t,n){return Js(this,arguments,function*(a,i,c,l={}){const o={id:`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,service:a,identifier:i,operation:c,priority:l.priority||0,maxRetries:l.maxRetries||3,timeout:l.timeout||3e4,createdAt:new Date,metadata:l.metadata};return this.queue.push(o),this.queue.sort((d,u)=>u.priority-d.priority),$.debug(`Added request to queue: ${o.id} (priority: ${o.priority})`),this.processing||this.startProcessing(),this.waitForCompletion(o.id)})}startProcessing(){this.processing||(this.processing=!0,this.processingInterval=setInterval(()=>{this.processQueue()},this.config.processingInterval),$.info("AI request queue processing started"))}stopProcessing(){this.processingInterval&&(clearInterval(this.processingInterval),this.processingInterval=null),this.processing=!1,$.info("AI request queue processing stopped")}processQueue(){return Js(this,null,function*(){if(this.activeRequests>=this.config.maxConcurrent||this.queue.length===0)return;const e=this.queue.splice(0,this.config.batchSize);for(const t of e){if(this.activeRequests>=this.config.maxConcurrent){this.queue.unshift(...e.slice(e.indexOf(t)));break}this.processRequest(t)}})}processRequest(e){return Js(this,null,function*(){this.activeRequests++;try{$.debug(`Processing request: ${e.id}`);const t=yield mi.checkRateLimit(e.identifier);if(!t.allowed)throw new Error(`Rate limit exceeded. Retry after ${t.retryAfter}ms`);const n=yield e.operation();yield mi.recordRequest(e.identifier),this.storeResult(e.id,{success:!0,data:n})}catch(t){$.error(`Request ${e.id} failed:`,t),e.maxRetries>0?(e.maxRetries--,this.queue.push(e),$.debug(`Retrying request ${e.id} (${e.maxRetries} retries left)`)):this.storeResult(e.id,{success:!1,error:t instanceof Error?t.message:"Unknown error"})}finally{this.activeRequests--}})}waitForCompletion(e){return Js(this,null,function*(){return new Promise((t,n)=>{const a=()=>{const i=this.getResult(e);i?i.success?t(i.data):n(new Error(i.error)):setTimeout(a,100)};a()})})}storeResult(e,t){this.results.set(e,t)}getResult(e){return this.results.get(e)}getStats(){return{queueLength:this.queue.length,activeRequests:this.activeRequests,processing:this.processing,config:this.config}}clearQueue(){this.queue=[],this.results.clear(),$.info("AI request queue cleared")}updateConfig(e){this.config=da(da({},this.config),e),$.info("AI request queue configuration updated:",this.config)}}const Xs=new u0;var ts=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class m0{constructor(){this.DEFAULT_TTL=3600,this.hitCounts=new Map,this.cache=new Wu("ai_responses")}generateCacheKey(e){const{service:t,operation:n,parameters:a,userId:i,facilityId:c}=e,l=this.hashObject(a);let o=`${t}:${n}:${l}`;return i&&(o+=`:user:${i}`),c&&(o+=`:facility:${c}`),o}get(e){return ts(this,null,function*(){try{const t=this.generateCacheKey(e),n=yield this.cache.get(t);if(n){const a=this.hitCounts.get(t)||0;return this.hitCounts.set(t,a+1),$.debug(`AI cache hit for ${e.service}:${e.operation}`),n.data}return null}catch(t){return $.error("Error getting from AI cache:",t),null}})}set(e,t){return ts(this,arguments,function*(n,a,i={}){try{const c=this.generateCacheKey(n),l=i.ttl||this.DEFAULT_TTL,o={data:a,timestamp:Date.now(),hitCount:0,metadata:{service:n.service,operation:n.operation,userId:n.userId,facilityId:n.facilityId}};yield this.cache.set(c,o,{ttl:l}),$.debug(`AI response cached for ${n.service}:${n.operation}`)}catch(c){$.error("Error setting AI cache:",c)}})}executeWithCache(e,t){return ts(this,arguments,function*(n,a,i={}){const c=yield this.get(n);if(c!==null)return c;const l=yield a();return yield this.set(n,l,i),l})}invalidate(e){return ts(this,null,function*(){try{$.info("Invalidating AI cache for pattern:",e),yield this.cache.clear()}catch(t){$.error("Error invalidating AI cache:",t)}})}getStats(){return{totalEntries:this.hitCounts.size,hitCounts:Object.fromEntries(this.hitCounts),cacheStats:this.cache.getStats()}}clear(){return ts(this,null,function*(){try{yield this.cache.clear(),this.hitCounts.clear(),$.info("AI response cache cleared")}catch(e){$.error("Error clearing AI cache:",e)}})}hashObject(e){const t=JSON.stringify(e,Object.keys(e).sort());return this.simpleHash(t)}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){const a=e.charCodeAt(n);t=(t<<5)-t+a,t=t&t}return Math.abs(t).toString(36)}}const Zs=new m0;var h0=Object.defineProperty,yl=Object.getOwnPropertySymbols,p0=Object.prototype.hasOwnProperty,f0=Object.prototype.propertyIsEnumerable,vl=(r,e,t)=>e in r?h0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ua=(r,e)=>{for(var t in e||(e={}))p0.call(e,t)&&vl(r,t,e[t]);if(yl)for(var t of yl(e))f0.call(e,t)&&vl(r,t,e[t]);return r},br=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class g0{constructor(e={}){this.pendingRequests=[],this.activeBatches=0,this.batchTimer=null,this.config=ua({maxBatchSize:10,maxWaitTime:2e3,maxConcurrentBatches:3,priorityThreshold:5},e)}addRequest(e){return br(this,arguments,function*(t,n={}){const a={id:`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,operation:t,priority:n.priority||0,metadata:n.metadata};return this.pendingRequests.push(a),this.pendingRequests.sort((i,c)=>c.priority-i.priority),$.debug(`Added request to batch queue: ${a.id} (priority: ${a.priority})`),this.batchTimer||this.startBatchTimer(),this.waitForCompletion(a.id)})}startBatchTimer(){this.batchTimer=setTimeout(()=>{this.processBatches(),this.batchTimer=null},this.config.maxWaitTime)}processBatches(){return br(this,null,function*(){if(this.activeBatches>=this.config.maxConcurrentBatches){this.startBatchTimer();return}const e=this.pendingRequests.filter(n=>n.priority<this.config.priorityThreshold);if(e.length===0)return;const t=this.createBatches(e);for(const n of t){if(this.activeBatches>=this.config.maxConcurrentBatches)break;this.processBatch(n)}this.pendingRequests.length>0&&this.startBatchTimer()})}createBatches(e){const t=[];for(let n=0;n<e.length;n+=this.config.maxBatchSize){const a=e.slice(n,n+this.config.maxBatchSize);t.push(a)}return t}processBatch(e){return br(this,null,function*(){this.activeBatches++;try{$.debug(`Processing batch of ${e.length} requests`),e.forEach(i=>{const c=this.pendingRequests.findIndex(l=>l.id===i.id);c!==-1&&this.pendingRequests.splice(c,1)});const t=Date.now(),n=e.map(i=>br(this,null,function*(){const c=Date.now();try{const l=yield i.operation(),o=Date.now()-c;this.storeResult(i.id,{id:i.id,success:!0,data:l,duration:o})}catch(l){const o=Date.now()-c;this.storeResult(i.id,{id:i.id,success:!1,error:l instanceof Error?l.message:"Unknown error",duration:o})}}));yield Promise.all(n);const a=Date.now()-t;$.debug(`Batch completed in ${a}ms`)}catch(t){$.error("Batch processing failed:",t),e.forEach(n=>{this.storeResult(n.id,{id:n.id,success:!1,error:"Batch processing failed",duration:0})})}finally{this.activeBatches--}})}waitForCompletion(e){return br(this,null,function*(){return new Promise((t,n)=>{const a=()=>{const i=this.getResult(e);i?i.success?t(i.data):n(new Error(i.error)):setTimeout(a,50)};a()})})}storeResult(e,t){this.results=this.results||new Map,this.results.set(e,t)}getResult(e){return this.results=this.results||new Map,this.results.get(e)}getStats(){return{pendingRequests:this.pendingRequests.length,activeBatches:this.activeBatches,config:this.config}}updateConfig(e){this.config=ua(ua({},this.config),e),$.info("AI request batcher configuration updated:",this.config)}clearPending(){this.pendingRequests=[],this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),$.info("AI request batcher cleared")}forceProcess(){return br(this,null,function*(){this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),yield this.processBatches()})}}const rs=new g0;var y0=Object.defineProperty,v0=Object.defineProperties,x0=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,b0=Object.prototype.hasOwnProperty,_0=Object.prototype.propertyIsEnumerable,bl=(r,e,t)=>e in r?y0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ma=(r,e)=>{for(var t in e||(e={}))b0.call(e,t)&&bl(r,t,e[t]);if(xl)for(var t of xl(e))_0.call(e,t)&&bl(r,t,e[t]);return r},w0=(r,e)=>v0(r,x0(e));class Ar{constructor(){this.serviceMetrics={},this.alerts=[],this.requestTimes=[],this.MAX_REQUEST_TIMES=1e3,this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,cacheHitRate:0,rateLimitHits:0,queueLength:0,activeRequests:0,lastUpdated:new Date}}static getInstance(){return Ar.instance||(Ar.instance=new Ar),Ar.instance}recordRequest(e,t,n,a=!1,i=!1){const c=new Date;this.metrics.totalRequests++,t?this.metrics.successfulRequests++:this.metrics.failedRequests++,a?this.metrics.cacheHitRate=(this.metrics.cacheHitRate*(this.metrics.totalRequests-1)+1)/this.metrics.totalRequests:this.metrics.cacheHitRate=this.metrics.cacheHitRate*(this.metrics.totalRequests-1)/this.metrics.totalRequests,i&&this.metrics.rateLimitHits++,this.requestTimes.push(n),this.requestTimes.length>this.MAX_REQUEST_TIMES&&this.requestTimes.shift(),this.metrics.averageResponseTime=this.calculateAverageResponseTime(),this.serviceMetrics[e]||(this.serviceMetrics[e]={requests:0,successes:0,failures:0,avgResponseTime:0,lastRequest:c});const l=this.serviceMetrics[e];l.requests++,l.lastRequest=c,t?l.successes++:l.failures++,l.avgResponseTime=(l.avgResponseTime*(l.requests-1)+n)/l.requests,this.metrics.lastUpdated=c,this.checkAlerts(e,t,n)}updateQueueMetrics(e,t){this.metrics.queueLength=e,this.metrics.activeRequests=t,this.metrics.lastUpdated=new Date}getMetrics(){return ma({},this.metrics)}getServiceMetrics(){return ma({},this.serviceMetrics)}getAlerts(){return[...this.alerts]}clearOldAlerts(e=1440*60*1e3){const t=new Date(Date.now()-e);this.alerts=this.alerts.filter(n=>n.timestamp>t)}getHealthStatus(){const e=[],t=[],n=this.metrics.totalRequests>0?this.metrics.failedRequests/this.metrics.totalRequests:0;n>.1&&(e.push(`High error rate: ${(n*100).toFixed(1)}%`),t.push("Investigate failed requests and improve error handling")),this.metrics.averageResponseTime>5e3&&(e.push(`Slow response time: ${this.metrics.averageResponseTime.toFixed(0)}ms`),t.push("Optimize AI operations and consider caching")),this.metrics.queueLength>50&&(e.push(`High queue length: ${this.metrics.queueLength}`),t.push("Increase processing capacity or optimize request handling")),this.metrics.cacheHitRate<.3&&(e.push(`Low cache hit rate: ${(this.metrics.cacheHitRate*100).toFixed(1)}%`),t.push("Improve caching strategy and cache more responses"));let a="healthy";return e.length>0&&(a=e.length>2?"critical":"warning"),{status:a,issues:e,recommendations:t}}calculateAverageResponseTime(){return this.requestTimes.length===0?0:this.requestTimes.reduce((e,t)=>e+t,0)/this.requestTimes.length}checkAlerts(e,t,n){if(!t){const a=this.serviceMetrics[e];if(a&&a.requests>10){const i=a.failures/a.requests;i>.2&&this.addAlert({type:"high_error_rate",severity:"critical",message:`High error rate for ${e}: ${(i*100).toFixed(1)}%`,metadata:{service:e,errorRate:i}})}}n>1e4&&this.addAlert({type:"slow_response",severity:"warning",message:`Slow response time for ${e}: ${n}ms`,metadata:{service:e,responseTime:n}}),this.metrics.queueLength>100&&this.addAlert({type:"high_queue_length",severity:"critical",message:`High queue length: ${this.metrics.queueLength}`,metadata:{queueLength:this.metrics.queueLength}}),this.metrics.rateLimitHits>10&&this.addAlert({type:"rate_limit_exceeded",severity:"warning",message:`Rate limit exceeded ${this.metrics.rateLimitHits} times`,metadata:{rateLimitHits:this.metrics.rateLimitHits}})}addAlert(e){const t=w0(ma({},e),{id:`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date});this.alerts.push(t),$.warn(`AI Performance Alert: ${t.message}`,t)}resetMetrics(){this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,cacheHitRate:0,rateLimitHits:0,queueLength:0,activeRequests:0,lastUpdated:new Date},this.serviceMetrics={},this.alerts=[],this.requestTimes=[],$.info("AI monitoring metrics reset")}}const ss=Ar.getInstance();var S0=Object.defineProperty,j0=Object.defineProperties,C0=Object.getOwnPropertyDescriptors,_l=Object.getOwnPropertySymbols,N0=Object.prototype.hasOwnProperty,I0=Object.prototype.propertyIsEnumerable,wl=(r,e,t)=>e in r?S0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,T0=(r,e)=>{for(var t in e||(e={}))N0.call(e,t)&&wl(r,t,e[t]);if(_l)for(var t of _l(e))I0.call(e,t)&&wl(r,t,e[t]);return r},E0=(r,e)=>j0(r,C0(e)),en=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class or{constructor(){}static getInstance(){return or.instance||(or.instance=new or),or.instance}execute(e,t,n){return en(this,null,function*(){const a=Date.now();let i=!1,c=!1,l,o;try{if(e.useCache!==!1){const u={service:e.service,operation:e.operation,parameters:(n==null?void 0:n.parameters)||{},userId:n==null?void 0:n.userId,facilityId:n==null?void 0:n.facilityId},h=yield Zs.get(u);h!==null&&(i=!0,l=h,c=!0,$.debug(`AI operation served from cache: ${e.service}:${e.operation}`))}if(!i&&(e.useBatching!==!1&&(e.priority||0)<5?l=yield rs.addRequest(t,{priority:e.priority,metadata:e.metadata}):l=yield Xs.addRequest(e.service,(n==null?void 0:n.userId)||"anonymous",t,{priority:e.priority,maxRetries:e.maxRetries,timeout:e.timeout,metadata:e.metadata}),c=!0,e.useCache!==!1&&l)){const u={service:e.service,operation:e.operation,parameters:(n==null?void 0:n.parameters)||{},userId:n==null?void 0:n.userId,facilityId:n==null?void 0:n.facilityId};yield Zs.set(u,l,{ttl:e.cacheTtl})}const d=Date.now()-a;return ss.recordRequest(e.service,c,d,i,!1),{success:c,data:l,error:o,fromCache:i,responseTime:d,metadata:e.metadata}}catch(d){const u=Date.now()-a;return o=d instanceof Error?d.message:"Unknown error",c=!1,ss.recordRequest(e.service,c,u,i,!1),$.error(`AI operation failed: ${e.service}:${e.operation}`,d),{success:c,data:l,error:o,fromCache:i,responseTime:u,metadata:e.metadata}}})}executeBatch(e){return en(this,null,function*(){const t=e.map(({config:n,operation:a,context:i})=>this.execute(n,a,i));return Promise.all(t)})}getStats(){return{monitoring:ss.getMetrics(),queue:Xs.getStats(),cache:Zs.getStats(),batcher:rs.getStats(),rateLimiter:mi.getConfigs()}}getHealthStatus(){const e=ss.getHealthStatus(),t=this.getStats();return E0(T0({},e),{metrics:t})}reset(){return en(this,null,function*(){yield Zs.clear(),Xs.clearQueue(),rs.clearPending(),ss.resetMetrics(),$.info("AI service reset completed")})}updateConfig(e){e.queue&&Xs.updateConfig(e.queue),e.batcher&&rs.updateConfig(e.batcher),$.info("AI service configuration updated")}forceProcess(){return en(this,null,function*(){yield rs.forceProcess(),$.info("AI service force processing completed")})}}or.getInstance();var k0=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const D0="/functions/v1/openai";function am(r){return k0(this,arguments,function*({prompt:e,context:t=""}){throw console.warn("askCliniioAI() is deprecated. Use UnifiedAIService.askAI() instead."),D0?new Error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY"):new Error("Missing NEXT_PUBLIC_SUPABASE_URL")})}var ha=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class P0{constructor(e){this.facilityId=e}getLearningInsights(){return ha(this,null,function*(){try{const e=[],{data:t}=yield _.from("learning_ai_personalized_recommendations").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);t&&t.forEach(c=>{e.push({type:"personalized_recommendation",title:"Personalized Learning Recommendations",description:`${c.recommended_content.length} content items recommended for user ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.recommendation_reasoning||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromConfidence(c.confidence_score),actionable:!0,id:c.id||`recommendation-${Date.now()}`})});const{data:n}=yield _.from("learning_ai_skill_gap_analysis").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);n&&n.forEach(c=>{const l=Object.keys(c.skill_gaps);e.push({type:"skill_gap_analysis",title:"Skill Gap Analysis",description:`${l.length} skill gaps identified for user ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.learning_recommendations||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromGapCount(l.length),actionable:!0,id:c.id||`skillgap-${Date.now()}`})});const{data:a}=yield _.from("learning_ai_path_optimization").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);a&&a.forEach(c=>{e.push({type:"learning_path_optimization",title:"Learning Path Optimized",description:`Path efficiency score: ${(c.path_efficiency_score*100).toFixed(1)}% for user ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.optimization_factors||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromEfficiency(c.path_efficiency_score),actionable:!0,id:c.id||`pathopt-${Date.now()}`})});const{data:i}=yield _.from("learning_ai_performance_prediction").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);return i&&i.forEach(c=>{e.push({type:"performance_prediction",title:"Performance Prediction",description:`Predicted performance: ${(c.predicted_performance*100).toFixed(1)}% for content ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.performance_factors||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromPerformance(c.predicted_performance),actionable:!0,id:c.id||`perfpred-${Date.now()}`})}),e}catch(e){return console.error("Error getting learning insights:",e),[]}})}getHistoricalLearningData(){return ha(this,null,function*(){try{const{data:e}=yield _.from("user_learning_progress").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(30);return e?e.map(t=>({date:t.created_at,user_id:t.user_id,content_id:t.content_id,progress_percentage:t.completion_rate,time_spent:t.session_duration,score:t.satisfaction_score,engagement_score:this.calculateEngagementScore(t)})):Array.from({length:30},(t,n)=>({date:new Date(Date.now()-n*24*60*60*1e3).toISOString(),user_id:`user-${Math.floor(Math.random()*10)+1}`,content_id:`content-${Math.floor(Math.random()*20)+1}`,progress_percentage:Math.random()*100,time_spent:Math.floor(Math.random()*120)+15,score:Math.random()>.3?Math.random()*40+60:void 0,engagement_score:Math.random()*.4+.6}))}catch(e){return console.error("Error getting historical learning data:",e),[]}})}getLearningCostData(){return ha(this,null,function*(){try{const{data:e}=yield _.from("learning_costs").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(1).single();if(e){const t=e;return{content_creation_costs:t.content_creation_costs,platform_costs:t.platform_costs,assessment_costs:t.assessment_costs,certification_costs:t.certification_costs,total_cost:t.total_cost}}return{content_creation_costs:15e3,platform_costs:5e3,assessment_costs:3e3,certification_costs:2e3,total_cost:25e3}}catch(e){return console.error("Error getting learning cost data:",e),{content_creation_costs:15e3,platform_costs:5e3,assessment_costs:3e3,certification_costs:2e3,total_cost:25e3}}})}calculateLearningEfficiency(e,t,n){const a=e*n/(t/60);return Math.min(a,1)}calculateEngagementScore(e){const t=e.time_spent_minutes||0,n=e.progress_percentage||0,a=e.attempts||1,i=Math.min(t/60,1),c=n/100,l=Math.max(0,1-(a-1)*.1);return i*.4+c*.4+l*.2}calculateRetentionRate(e,t){if(e.length!==t.length)return 0;const n=e.map((a,i)=>t[i]/a);return n.reduce((a,i)=>a+i,0)/n.length}calculateSkillProgression(e){const t={};return Object.entries(e).forEach(([n,a])=>{if(a.length<2){t[n]="stable";return}const i=a.slice(0,Math.ceil(a.length/2)),c=a.slice(Math.ceil(a.length/2)),l=i.reduce((u,h)=>u+h,0)/i.length,o=c.reduce((u,h)=>u+h,0)/c.length,d=l-o;d>.1?t[n]="improving":d<-.1?t[n]="declining":t[n]="stable"}),t}calculateLearningVelocity(e,t){return e/(t/7)}calculateKnowledgeDecayRate(e,t,n){if(n===0)return 0;const a=t/e;return a<=0?1:-Math.log(a)/n}calculateAdaptiveDifficultyAdjustment(e,t,n){const i=(e-t)*.1;return Math.max(0,Math.min(1,n+i))}detectLearningPatterns(e){const t=e.map(g=>g.content_id.split("-")[0]),n=e.map(g=>new Date(g.date).getHours()),a=t.reduce((g,y)=>(g[y]=(g[y]||0)+1,g),{}),i=Object.entries(a).sort(([,g],[,y])=>y-g).slice(0,3).map(([g])=>g),c=n.reduce((g,y)=>(g[y]=(g[y]||0)+1,g),{}),l=Object.entries(c).sort(([,g],[,y])=>y-g).slice(0,2).map(([g])=>`${g}:00`),o=Array.from(new Set(e.map(g=>g.date.split("T")[0]))).sort();let d=0,u=1;for(let g=1;g<o.length;g++){const y=new Date(o[g-1]);(new Date(o[g]).getTime()-y.getTime())/(1e3*60*60*24)===1?u++:(d=Math.max(d,u),u=1)}d=Math.max(d,u);const h=e.map(g=>g.progress_percentage),p=h.reduce((g,y)=>g+y,0)/h.length;let f="intermediate";return p>90?f="advanced":p<60&&(f="beginner"),{preferredContentTypes:i,optimalStudyTimes:l,learningStreaks:d,difficultyPreferences:f}}getPriorityFromConfidence(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}getPriorityFromGapCount(e){return e>=5?"critical":e>=3?"high":e>=1?"medium":"low"}getPriorityFromEfficiency(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}getPriorityFromPerformance(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}}var tn={},ct=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Wn{constructor(e){this.facilityId=e}processPersonalizedRecommendationsWithAI(){return ct(this,null,function*(){return{recommended_content:["infection_control_basics","sterilization_protocols_advanced","environmental_cleaning_standards"],recommendation_reasoning:["Based on your role as environmental services technician","Addresses identified skill gaps in infection control","Builds on your completed sterilization fundamentals course"],confidence_scores:[.92,.85,.78],learning_path_suggestions:["Complete infection control basics first","Then proceed to advanced sterilization protocols","Finish with environmental cleaning standards"],skill_development_areas:["Infection control protocols","Advanced sterilization techniques","Environmental monitoring"],estimated_completion_time:120,difficulty_progression:["beginner","intermediate","advanced"],alternative_recommendations:["safety_protocols_fundamentals","equipment_maintenance_basics"],confidence_score:.87}})}processSkillGapAnalysisWithAI(){return ct(this,null,function*(){return{current_skills:{basic_cleaning:.8,safety_protocols:.6,infection_control:.4,equipment_operation:.7,documentation:.5},required_skills:{basic_cleaning:.9,safety_protocols:.9,infection_control:.8,equipment_operation:.8,documentation:.8,advanced_sterilization:.7,environmental_monitoring:.6},skill_gaps:{infection_control:.4,documentation:.3,advanced_sterilization:.7,environmental_monitoring:.6},gap_priorities:["infection_control","advanced_sterilization","environmental_monitoring","documentation"],learning_recommendations:["Complete infection control certification course","Take advanced sterilization protocols training","Enroll in environmental monitoring workshop","Practice documentation best practices"],skill_development_plan:["Week 1-2: Infection control fundamentals","Week 3-4: Advanced sterilization techniques","Week 5-6: Environmental monitoring protocols","Week 7-8: Documentation and reporting"],estimated_learning_time:160,confidence_score:.82}})}processLearningPathOptimizationWithAI(){return ct(this,null,function*(){return{optimized_learning_path:["safety_fundamentals","infection_control_basics","sterilization_protocols","environmental_cleaning_standards","advanced_sterilization_techniques","quality_assurance_protocols"],path_efficiency_score:.88,estimated_total_time:180,difficulty_progression:["beginner","beginner","intermediate","intermediate","advanced","advanced"],prerequisite_mapping:{infection_control_basics:["safety_fundamentals"],sterilization_protocols:["infection_control_basics"],environmental_cleaning_standards:["sterilization_protocols"],advanced_sterilization_techniques:["environmental_cleaning_standards"],quality_assurance_protocols:["advanced_sterilization_techniques"]},alternative_paths:[["safety_fundamentals","equipment_operation","sterilization_protocols"],["safety_fundamentals","documentation_basics","infection_control_basics"]],optimization_factors:["Prerequisite knowledge alignment","Learning curve optimization","Time efficiency","Skill progression logic"],confidence_score:.85}})}processPerformancePredictionWithAI(){return ct(this,null,function*(){return{predicted_performance:.82,predicted_completion_time:45,success_probability:.78,risk_factors:["Limited experience with advanced sterilization","Time constraints for study sessions","Complex technical concepts in later modules"],improvement_suggestions:["Allocate additional study time for complex topics","Seek hands-on practice opportunities","Connect with experienced colleagues for guidance","Break down complex topics into smaller sessions"],study_recommendations:["Study in 30-minute focused sessions","Review prerequisite materials before starting","Take practice quizzes regularly","Join study groups for peer learning"],confidence_score:.79}})}processAdaptiveDifficultyWithAI(){return ct(this,null,function*(){return{recommended_difficulty:"intermediate",difficulty_adjustment:.2,learning_curve_analysis:"User shows strong grasp of fundamentals but needs more practice with intermediate concepts",adaptation_reasoning:["High performance on basic safety protocols (95% accuracy)","Moderate performance on infection control (78% accuracy)","Struggling with advanced sterilization concepts (65% accuracy)","Consistent engagement and completion rates"],performance_indicators:{quiz_accuracy:.78,completion_rate:.92,engagement_time:.85,retention_score:.73},next_difficulty_target:"advanced",confidence_score:.81}})}processEngagementAnalysisWithAI(){return ct(this,null,function*(){return{engagement_score:.76,engagement_trends:{video_content:.85,interactive_quizzes:.78,text_reading:.65,simulations:.92},engagement_factors:["Interactive content increases engagement","Visual learning materials are preferred","Practical simulations maintain interest","Short, focused sessions work best"],disengagement_triggers:["Long text-heavy modules","Complex technical jargon without explanation","Lack of immediate feedback","Repetitive content format"],improvement_suggestions:["Increase use of interactive simulations","Break down text content into smaller chunks","Add more visual aids and diagrams","Provide immediate feedback on quizzes"],optimal_learning_times:["Morning sessions (9-11 AM)","Afternoon sessions (2-4 PM)"],content_preferences:["Video demonstrations","Interactive simulations","Case study examples","Hands-on practice exercises"],confidence_score:.83}})}processRetentionPredictionWithAI(){return ct(this,null,function*(){return{retention_probability:.72,knowledge_decay_rate:.15,review_recommendations:["Review infection control protocols weekly","Practice sterilization procedures monthly","Take refresher quizzes every 2 weeks","Attend hands-on workshops quarterly"],reinforcement_schedule:["Week 1: Initial review of key concepts","Week 2: Practice quiz on fundamentals","Month 1: Comprehensive review session","Month 3: Advanced application practice"],retention_factors:["Regular practice and application","Immediate feedback on performance","Spaced repetition of key concepts","Real-world application opportunities"],forgetting_risk_areas:["Complex sterilization parameters","Specific compliance requirements","Equipment operation procedures","Emergency response protocols"],confidence_score:.77}})}processLearningAnalyticsWithAI(){return ct(this,null,function*(){return{learning_efficiency_score:.81,preferred_content_categories:["interactive_simulations","video_demonstrations","case_studies","hands_on_practice"],optimal_study_duration:30,learning_patterns:{peak_performance_hours:"9-11 AM, 2-4 PM",preferred_session_length:"25-35 minutes",break_frequency:"every 45 minutes",review_preference:"immediate after completion"},progress_trends:{completion_rate:"increasing",quiz_accuracy:"stable",engagement_level:"improving",retention_rate:"declining"},performance_metrics:{overall_completion:.88,quiz_average:.82,engagement_score:.76,retention_rate:.68},insights:["User performs best with interactive content","Morning sessions show higher engagement","Retention drops after 2 weeks without review","Case studies improve practical application"],recommendations:["Schedule more interactive content","Implement spaced repetition for retention","Add more case study examples","Optimize study session timing"],confidence_score:.84}})}buildPersonalizedRecommendationPrompt(e,t,n){return`Generate personalized learning recommendations based on:
  User Profile: ${e}
  Learning History: ${t}
  Skill Gaps: ${n}
  
  Please provide:
  1. Recommended content based on role and interests
  2. Reasoning for each recommendation
  3. Confidence scores for recommendations
  4. Learning path suggestions
  5. Skill development areas to focus on
  6. Estimated completion time
  7. Difficulty progression
  8. Alternative recommendations`}buildSkillGapAnalysisPrompt(e,t,n){return`Analyze skill gaps based on:
  Current Skills: ${e}
  Required Skills: ${t}
  Role Requirements: ${n}
  
  Please provide:
  1. Current skill levels assessment
  2. Required skill levels for role
  3. Identified skill gaps with priority levels
  4. Learning recommendations to address gaps
  5. Skill development plan with timeline
  6. Estimated learning time required
  7. Confidence score for analysis`}buildLearningPathOptimizationPrompt(e,t,n){return`Optimize learning path based on:
  User Goals: ${e}
  Available Content: ${t}
  Constraints: ${n}
  
  Please provide:
  1. Optimized learning path sequence
  2. Path efficiency score
  3. Estimated total completion time
  4. Difficulty progression through path
  5. Prerequisite mapping
  6. Alternative path options
  7. Optimization factors considered
  8. Confidence score for optimization`}buildPerformancePredictionPrompt(e,t,n){return`Predict learning performance based on:
  User Profile: ${e}
  Content Information: ${t}
  Historical Performance: ${n}
  
  Please provide:
  1. Predicted performance score
  2. Predicted completion time
  3. Success probability
  4. Risk factors that may impact performance
  5. Improvement suggestions
  6. Study recommendations
  7. Confidence score for prediction`}executeWithRetry(e,t=3,n=100){return ct(this,null,function*(){const{OptimizedRetryService:a}=yield H(()=>import("./login-BkZ1x_Cy.js").then(i=>i.ac),__vite__mapDeps([1,2,3,4,5]));return yield a.executeWithRetry(e,{maxRetries:t,baseDelay:n,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return ct(this,null,function*(){const n=new Promise((a,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,n])})}selectModelForTask(e){switch(e){case"recommendation":return"gpt-4";case"skill_gap":return"gpt-4";case"path_optimization":return"gpt-4";case"performance_prediction":return"gpt-4";case"adaptive_difficulty":return"gpt-4";case"engagement_analysis":return"gpt-4";case"retention_prediction":return"gpt-4";case"learning_analytics":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:tn.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:tn.GOOGLE_AI_API_BASE_URL||"https://generativelanguage.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro"},azure:{baseUrl:tn.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:tn.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}}const O0={ai_enabled:!1,ai_version:"1.0.0",personalized_recommendations:!1,skill_gap_analysis:!1,learning_path_optimization:!1,performance_prediction:!1,adaptive_difficulty:!1,learning_analytics_enabled:!1,behavior_tracking:!1,progress_prediction:!1,engagement_metrics:!1,retention_analysis:!1,ai_confidence_threshold:.8,recommendation_limit:5,data_retention_days:365,model_version:"v1.0",data_sharing_enabled:!1,local_ai_processing_enabled:!1,encrypted_data_transmission:!0,ai_model_training:!1},R0={NO_DATA_FOUND:"PGRST116"},Pr={DIFFICULTY_LEVEL:"beginner",USER_ROLE:"user",DEPARTMENT:"general",EXPERIENCE_LEVEL:"entry",LEARNING_STYLE:"visual",TIME_AVAILABILITY:30},A0={LEARNING_PROGRESS_DATA:100};function $0(r){var e,t,n,a,i,c,l,o,d,u,h,p,f,g,y,v,b,x,w,j,I,E,O,S;return{id:(e=r.id)!=null?e:"",facility_id:(t=r.facility_id)!=null?t:"",ai_enabled:(n=r.ai_enabled)!=null?n:!1,ai_version:(a=r.ai_version)!=null?a:"",personalized_recommendations:(i=r.personalized_recommendations)!=null?i:!1,skill_gap_analysis:(c=r.skill_gap_analysis)!=null?c:!1,learning_path_optimization:(l=r.learning_path_optimization)!=null?l:!1,performance_prediction:(o=r.performance_prediction)!=null?o:!1,adaptive_difficulty:(d=r.adaptive_difficulty)!=null?d:!1,learning_analytics_enabled:(u=r.learning_analytics_enabled)!=null?u:!1,behavior_tracking:(h=r.behavior_tracking)!=null?h:!1,progress_prediction:(p=r.progress_prediction)!=null?p:!1,engagement_metrics:(f=r.engagement_metrics)!=null?f:!1,retention_analysis:(g=r.retention_analysis)!=null?g:!1,ai_confidence_threshold:(y=r.ai_confidence_threshold)!=null?y:0,recommendation_limit:(v=r.recommendation_limit)!=null?v:0,data_retention_days:(b=r.data_retention_days)!=null?b:0,model_version:(x=r.model_version)!=null?x:"",data_sharing_enabled:(w=r.data_sharing_enabled)!=null?w:!1,local_ai_processing_enabled:(j=r.local_ai_processing_enabled)!=null?j:!1,encrypted_data_transmission:(I=r.encrypted_data_transmission)!=null?I:!1,ai_model_training:(E=r.ai_model_training)!=null?E:!1,created_at:(O=r.created_at)!=null?O:"",updated_at:(S=r.updated_at)!=null?S:""}}function M0(r){var e,t,n,a,i,c,l,o,d,u,h;return{id:(e=r.id)!=null?e:"",user_id:(t=r.user_id)!=null?t:"",role:(n=r.role)!=null?n:Pr.USER_ROLE,department:(a=r.department)!=null?a:Pr.DEPARTMENT,experience_level:(i=r.experience_level)!=null?i:Pr.EXPERIENCE_LEVEL,skill_areas:(c=r.skill_areas)!=null?c:[],learning_goals:(l=r.learning_goals)!=null?l:[],preferred_learning_style:(o=r.preferred_learning_style)!=null?o:Pr.LEARNING_STYLE,time_availability:(d=r.time_availability)!=null?d:Pr.TIME_AVAILABILITY,last_updated:(h=(u=r.updated_at)!=null?u:r.created_at)!=null?h:""}}function Pt(r,e){return r!==null&&r[e]===!0}function zt(r){return Date.now()-r}function F0(r){return Array.isArray(r)?r.join("; "):r}function L0(r){return r.split("; ").filter(e=>e.trim().length>0)}function jt(){return new Date().toISOString()}var z0=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class B0{constructor(e){this.facilityId=e,this.providerService=new Wn(e)}generatePersonalizedRecommendations(e){return z0(this,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,g;try{const y=Date.now(),v=yield this.providerService.processPersonalizedRecommendationsWithAI(),b=zt(y),x={facility_id:this.facilityId,user_id:e,recommended_content:v.recommended_content,recommendation_reasoning:v.recommendation_reasoning,confidence_scores:v.confidence_scores,learning_path_suggestions:v.learning_path_suggestions,skill_development_areas:v.skill_development_areas,estimated_completion_time:v.estimated_completion_time,difficulty_progression:v.difficulty_progression,alternative_recommendations:v.alternative_recommendations,confidence_score:v.confidence_score,processing_time_ms:b,created_at:jt()},w={facility_id:x.facility_id,user_id:x.user_id,recommended_content:x.recommended_content,recommendation_reasoning:F0(x.recommendation_reasoning),confidence_scores:x.confidence_scores,learning_path_suggestions:x.learning_path_suggestions,skill_development_areas:x.skill_development_areas,estimated_completion_time:x.estimated_completion_time,difficulty_progression:x.difficulty_progression,alternative_recommendations:x.alternative_recommendations,confidence_score:x.confidence_score,processing_time_ms:x.processing_time_ms,created_at:x.created_at},{data:j,error:I}=yield _.from("learning_ai_personalized_recommendations").insert(w).select().single();if(I)return console.error("Error saving personalized recommendation result:",I),null;if(!j)return null;const E=j;return{id:(t=E.id)!=null?t:"",facility_id:(n=E.facility_id)!=null?n:"",user_id:(a=E.user_id)!=null?a:"",recommended_content:(i=E.recommended_content)!=null?i:[],recommendation_reasoning:L0(E.recommendation_reasoning),confidence_scores:(c=E.confidence_scores)!=null?c:[],learning_path_suggestions:(l=E.learning_path_suggestions)!=null?l:[],skill_development_areas:(o=E.skill_development_areas)!=null?o:[],estimated_completion_time:(d=E.estimated_completion_time)!=null?d:0,difficulty_progression:(u=E.difficulty_progression)!=null?u:[],alternative_recommendations:(h=E.alternative_recommendations)!=null?h:[],confidence_score:(p=E.confidence_score)!=null?p:0,processing_time_ms:(f=E.processing_time_ms)!=null?f:0,created_at:(g=E.created_at)!=null?g:""}}catch(y){return console.error("Error generating personalized recommendations:",y),null}})}}var q0=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class U0{constructor(e){this.facilityId=e,this.providerService=new Wn(e)}analyzeSkillGaps(e){return q0(this,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,g;try{const y=Date.now(),v=yield this.providerService.processSkillGapAnalysisWithAI(),b=zt(y),x={facility_id:this.facilityId,user_id:e,current_skills:v.current_skills,required_skills:v.required_skills,skill_gaps:v.skill_gaps,gap_priorities:v.gap_priorities,learning_recommendations:v.learning_recommendations,skill_development_plan:v.skill_development_plan,estimated_learning_time:v.estimated_learning_time,confidence_score:v.confidence_score,processing_time_ms:b,created_at:jt()},w={facility_id:x.facility_id,user_id:x.user_id,current_skills:x.current_skills,required_skills:x.required_skills,skill_gaps:x.skill_gaps,gap_priorities:x.gap_priorities,learning_recommendations:x.learning_recommendations,skill_development_plan:x.skill_development_plan,estimated_learning_time:x.estimated_learning_time,confidence_score:x.confidence_score,processing_time_ms:x.processing_time_ms,created_at:x.created_at},{data:j,error:I}=yield _.from("learning_ai_skill_gap_analysis").insert(w).select().single();if(I)return console.error("Error saving skill gap analysis result:",I),null;if(!j)return null;const E=j;return{id:(t=E.id)!=null?t:"",facility_id:(n=E.facility_id)!=null?n:"",user_id:(a=E.user_id)!=null?a:"",current_skills:(i=E.current_skills)!=null?i:{},required_skills:(c=E.required_skills)!=null?c:{},skill_gaps:(l=E.skill_gaps)!=null?l:{},gap_priorities:(o=E.gap_priorities)!=null?o:[],learning_recommendations:(d=E.learning_recommendations)!=null?d:[],skill_development_plan:(u=E.skill_development_plan)!=null?u:[],estimated_learning_time:(h=E.estimated_learning_time)!=null?h:0,confidence_score:(p=E.confidence_score)!=null?p:0,processing_time_ms:(f=E.processing_time_ms)!=null?f:0,created_at:(g=E.created_at)!=null?g:""}}catch(y){return console.error(y),console.error("Error analyzing skill gaps"),null}})}}var H0=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class V0{constructor(e){this.facilityId=e,this.providerService=new Wn(e)}optimizeLearningPath(e){return H0(this,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,g;try{const y=Date.now(),v=yield this.providerService.processLearningPathOptimizationWithAI(),b=zt(y),x={facility_id:this.facilityId,user_id:e,optimized_learning_path:v.optimized_learning_path,path_efficiency_score:v.path_efficiency_score,estimated_total_time:v.estimated_total_time,difficulty_progression:v.difficulty_progression,prerequisite_mapping:v.prerequisite_mapping,alternative_paths:v.alternative_paths,optimization_factors:v.optimization_factors,confidence_score:v.confidence_score,processing_time_ms:b,created_at:jt()},w={facility_id:x.facility_id,user_id:x.user_id,optimized_learning_path:x.optimized_learning_path,path_efficiency_score:x.path_efficiency_score,estimated_total_time:x.estimated_total_time,difficulty_progression:x.difficulty_progression,prerequisite_mapping:x.prerequisite_mapping,alternative_paths:x.alternative_paths,optimization_factors:x.optimization_factors,confidence_score:x.confidence_score,processing_time_ms:x.processing_time_ms,created_at:x.created_at},{data:j,error:I}=yield _.from("learning_ai_path_optimization").insert(w).select().single();if(I)return console.error("Error saving learning path optimization result:",I),null;if(!j)return null;const E=j;return{id:(t=E.id)!=null?t:"",facility_id:(n=E.facility_id)!=null?n:"",user_id:(a=E.user_id)!=null?a:"",optimized_learning_path:(i=E.optimized_learning_path)!=null?i:[],path_efficiency_score:(c=E.path_efficiency_score)!=null?c:0,estimated_total_time:(l=E.estimated_total_time)!=null?l:0,difficulty_progression:(o=E.difficulty_progression)!=null?o:[],prerequisite_mapping:(d=E.prerequisite_mapping)!=null?d:{},alternative_paths:(u=E.alternative_paths)!=null?u:[],optimization_factors:(h=E.optimization_factors)!=null?h:[],confidence_score:(p=E.confidence_score)!=null?p:0,processing_time_ms:(f=E.processing_time_ms)!=null?f:0,created_at:(g=E.created_at)!=null?g:""}}catch(y){return console.error("Error optimizing learning path:",y),null}})}}var ns=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class W0{constructor(e){this.facilityId=e,this.providerService=new Wn(e)}predictPerformance(e,t){return ns(this,null,function*(){var n,a,i,c,l,o,d,u,h,p;try{const f=Date.now(),g=yield this.providerService.processPerformancePredictionWithAI(),y=zt(f),v={facility_id:this.facilityId,user_id:e,content_id:t,predicted_performance:g.predicted_performance,predicted_completion_time:g.predicted_completion_time,success_probability:g.success_probability,risk_factors:g.risk_factors,improvement_suggestions:g.improvement_suggestions,study_recommendations:g.study_recommendations,confidence_score:g.confidence_score,processing_time_ms:y,created_at:jt()},b={facility_id:v.facility_id,user_id:v.user_id,content_id:v.content_id,predicted_performance:v.predicted_performance,confidence_score:v.confidence_score,performance_factors:v.risk_factors,improvement_suggestions:v.improvement_suggestions,predicted_completion_time:v.predicted_completion_time,difficulty_assessment:v.study_recommendations,prerequisite_requirements:{},alternative_approaches:{},processing_time_ms:v.processing_time_ms,created_at:v.created_at},{data:x,error:w}=yield _.from("learning_ai_performance_prediction").insert(b).select().single();if(w)return console.error("Error saving performance prediction result:",w),null;if(!x)return null;const j=x;return{id:(n=j.id)!=null?n:"",facility_id:(a=j.facility_id)!=null?a:"",user_id:(i=j.user_id)!=null?i:"",content_id:(c=j.content_id)!=null?c:"",predicted_performance:(l=j.predicted_performance)!=null?l:0,predicted_completion_time:(o=j.predicted_completion_time)!=null?o:0,success_probability:0,risk_factors:[],improvement_suggestions:(d=j.improvement_suggestions)!=null?d:[],study_recommendations:[],confidence_score:(u=j.confidence_score)!=null?u:0,processing_time_ms:(h=j.processing_time_ms)!=null?h:0,created_at:(p=j.created_at)!=null?p:""}}catch(f){return console.error("Error predicting performance:",f),null}})}adjustDifficulty(e,t){return ns(this,null,function*(){var n,a,i,c,l,o,d;try{const u=Date.now(),h=yield this.providerService.processAdaptiveDifficultyWithAI(),p=zt(u),f={facility_id:this.facilityId,user_id:e,content_id:t,recommended_difficulty:h.recommended_difficulty,difficulty_adjustment:h.difficulty_adjustment,learning_curve_analysis:h.learning_curve_analysis,adaptation_reasoning:h.adaptation_reasoning,performance_indicators:h.performance_indicators,next_difficulty_target:h.next_difficulty_target,confidence_score:h.confidence_score,processing_time_ms:p,created_at:jt()},g={facility_id:f.facility_id,user_id:f.user_id,content_id:f.content_id,recommended_difficulty:f.recommended_difficulty,difficulty_adjustment:f.difficulty_adjustment,learning_curve_analysis:f.learning_curve_analysis,adaptation_reasoning:f.adaptation_reasoning,performance_indicators:f.performance_indicators,next_difficulty_target:f.next_difficulty_target,confidence_score:f.confidence_score,processing_time_ms:f.processing_time_ms,created_at:f.created_at},{data:y,error:v}=yield _.from("learning_ai_adaptive_difficulty").insert(g).select().single();if(v)return console.error("Error saving adaptive difficulty result:",v),null;if(!y)return null;const b=y;return{recommended_difficulty:(n=b.recommended_difficulty)!=null?n:Pr.DIFFICULTY_LEVEL,difficulty_adjustment:(a=b.difficulty_adjustment)!=null?a:0,learning_curve_analysis:(i=b.learning_curve_analysis)!=null?i:"",adaptation_reasoning:(c=b.adaptation_reasoning)!=null?c:[],performance_indicators:(l=b.performance_indicators)!=null?l:{},next_difficulty_target:(o=b.next_difficulty_target)!=null?o:"",confidence_score:(d=b.confidence_score)!=null?d:0}}catch(u){return console.error("Error adjusting difficulty:",u),null}})}analyzeEngagement(e){return ns(this,null,function*(){var t,n,a,i,c,l,o,d;try{const u=Date.now(),h=yield this.providerService.processEngagementAnalysisWithAI(),p=zt(u),f={facility_id:this.facilityId,user_id:e,engagement_score:h.engagement_score,engagement_trends:h.engagement_trends,engagement_factors:h.engagement_factors,disengagement_triggers:h.disengagement_triggers,improvement_suggestions:h.improvement_suggestions,optimal_learning_times:h.optimal_learning_times,content_preferences:h.content_preferences,confidence_score:h.confidence_score,processing_time_ms:p,created_at:jt()},g={facility_id:f.facility_id,user_id:f.user_id,engagement_score:f.engagement_score,engagement_trends:f.engagement_trends,engagement_factors:f.engagement_factors,disengagement_triggers:f.disengagement_triggers,improvement_suggestions:f.improvement_suggestions,optimal_learning_times:f.optimal_learning_times,content_preferences:f.content_preferences,confidence_score:f.confidence_score,processing_time_ms:f.processing_time_ms,created_at:f.created_at},{data:y,error:v}=yield _.from("learning_ai_engagement_analysis").insert(g).select().single();if(v)return console.error("Error saving engagement analysis result:",v),null;if(!y)return null;const b=y;return{engagement_score:(t=b.engagement_score)!=null?t:0,engagement_trends:(n=b.engagement_trends)!=null?n:{},engagement_factors:(a=b.engagement_factors)!=null?a:[],disengagement_triggers:(i=b.disengagement_triggers)!=null?i:[],improvement_suggestions:(c=b.improvement_suggestions)!=null?c:[],optimal_learning_times:(l=b.optimal_learning_times)!=null?l:[],content_preferences:(o=b.content_preferences)!=null?o:[],confidence_score:(d=b.confidence_score)!=null?d:0}}catch(u){return console.error("Error analyzing engagement:",u),null}})}predictRetention(e){return ns(this,null,function*(){var t,n,a,i,c,l,o;try{const d=Date.now(),u=yield this.providerService.processRetentionPredictionWithAI(),h=zt(d),p={facility_id:this.facilityId,user_id:e,retention_probability:u.retention_probability,knowledge_decay_rate:u.knowledge_decay_rate,review_recommendations:u.review_recommendations,reinforcement_schedule:u.reinforcement_schedule,retention_factors:u.retention_factors,forgetting_risk_areas:u.forgetting_risk_areas,confidence_score:u.confidence_score,processing_time_ms:h,created_at:jt()},f={facility_id:p.facility_id,user_id:p.user_id,retention_probability:p.retention_probability,knowledge_decay_rate:p.knowledge_decay_rate,review_recommendations:p.review_recommendations,reinforcement_schedule:p.reinforcement_schedule,retention_factors:p.retention_factors,forgetting_risk_areas:p.forgetting_risk_areas,confidence_score:p.confidence_score,processing_time_ms:p.processing_time_ms,created_at:p.created_at},{data:g,error:y}=yield _.from("learning_ai_retention_prediction").insert(f).select().single();if(y)return console.error("Error saving retention prediction result:",y),null;if(!g)return null;const v=g;return{retention_probability:(t=v.retention_probability)!=null?t:0,knowledge_decay_rate:(n=v.knowledge_decay_rate)!=null?n:0,review_recommendations:(a=v.review_recommendations)!=null?a:[],reinforcement_schedule:(i=v.reinforcement_schedule)!=null?i:[],retention_factors:(c=v.retention_factors)!=null?c:[],forgetting_risk_areas:(l=v.forgetting_risk_areas)!=null?l:[],confidence_score:(o=v.confidence_score)!=null?o:0}}catch(d){return console.error("Error predicting retention:",d),null}})}generateLearningAnalytics(e){return ns(this,null,function*(){var t,n,a,i,c,l,o,d,u;try{const h=Date.now(),p=yield this.providerService.processLearningAnalyticsWithAI(),f=zt(h),g={facility_id:this.facilityId,user_id:e,learning_efficiency_score:p.learning_efficiency_score,preferred_content_categories:p.preferred_content_categories,optimal_study_duration:p.optimal_study_duration,learning_patterns:p.learning_patterns,progress_trends:p.progress_trends,performance_metrics:p.performance_metrics,insights:p.insights,recommendations:p.recommendations,confidence_score:p.confidence_score,processing_time_ms:f,created_at:jt()},y={facility_id:g.facility_id,user_id:g.user_id,learning_efficiency_score:g.learning_efficiency_score,preferred_content_categories:g.preferred_content_categories,optimal_study_duration:g.optimal_study_duration,learning_patterns:g.learning_patterns,progress_trends:g.progress_trends,performance_metrics:g.performance_metrics,insights:g.insights,recommendations:g.recommendations,confidence_score:g.confidence_score,processing_time_ms:g.processing_time_ms,created_at:g.created_at},{data:v,error:b}=yield _.from("learning_ai_analytics").insert(y).select().single();if(b)return console.error("Error saving learning analytics result:",b),null;if(!v)return null;const x=v;return{learning_efficiency_score:(t=x.learning_efficiency_score)!=null?t:0,preferred_content_categories:(n=x.preferred_content_categories)!=null?n:[],optimal_study_duration:(a=x.optimal_study_duration)!=null?a:0,learning_patterns:(i=x.learning_patterns)!=null?i:{},progress_trends:(c=x.progress_trends)!=null?c:{},performance_metrics:(l=x.performance_metrics)!=null?l:{},insights:(o=x.insights)!=null?o:[],recommendations:(d=x.recommendations)!=null?d:[],confidence_score:(u=x.confidence_score)!=null?u:0}}catch(h){return console.error("Error generating learning analytics:",h),null}})}}var Gn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function G0(r){return Gn(this,null,function*(){try{const{data:e,error:t}=yield _.from("learning_ai_settings").select("*").eq("facility_id",r).single();if(t){if(t.code===R0.NO_DATA_FOUND)return null;throw t}return e?$0(e):null}catch(e){return console.error(e),console.error("Error loading learning AI settings"),null}})}function K0(r,e){return Gn(this,null,function*(){try{const t={facility_id:r,ai_enabled:e.ai_enabled,ai_version:e.ai_version,personalized_recommendations:e.personalized_recommendations,skill_gap_analysis:e.skill_gap_analysis,learning_path_optimization:e.learning_path_optimization,performance_prediction:e.performance_prediction,adaptive_difficulty:e.adaptive_difficulty,learning_analytics_enabled:e.learning_analytics_enabled,behavior_tracking:e.behavior_tracking,progress_prediction:e.progress_prediction,engagement_metrics:e.engagement_metrics,retention_analysis:e.retention_analysis,ai_confidence_threshold:e.ai_confidence_threshold,recommendation_limit:e.recommendation_limit,data_retention_days:e.data_retention_days,model_version:e.model_version,data_sharing_enabled:e.data_sharing_enabled,local_ai_processing_enabled:e.local_ai_processing_enabled,encrypted_data_transmission:e.encrypted_data_transmission,ai_model_training:e.ai_model_training,updated_at:jt()},{error:n}=yield _.from("learning_ai_settings").upsert(t);return n?(console.error("Error saving learning AI settings:",n),!1):!0}catch(t){return console.error(t),console.error("Error saving learning AI settings"),!1}})}function Q0(r,e){return Gn(this,null,function*(){try{const{data:t,error:n}=yield _.from("learning_progress").select("*").eq("facility_id",r).eq("user_id",e).order("created_at",{ascending:!1}).limit(A0.LEARNING_PROGRESS_DATA);return n?(console.error("Error getting learning progress data:",n),[]):t||[]}catch(t){return console.error("Error getting learning progress data:",t),[]}})}function Y0(r,e){return Gn(this,null,function*(){try{const{data:t,error:n}=yield _.from("user_profiles").select("*").eq("user_id",e).eq("facility_id",r).single();return n?(console.error("Error getting user profile:",n),null):t?M0(t):null}catch(t){return console.error("Error getting user profile:",t),null}})}var Ne=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class J0{constructor(e){this.facilityId=e,this.analyticsService=new P0(e),this.recommendationService=new B0(e),this.knowledgeGapService=new U0(e),this.pathwayAnalysisService=new V0(e),this.evaluationService=new W0(e)}initialize(){return Ne(this,null,function*(){try{return(yield this.loadSettings())!==null}catch(e){return console.error(e),console.error("Failed to initialize LearningAIService"),!1}})}loadSettings(){return Ne(this,null,function*(){return yield G0(this.facilityId)})}saveSettings(e){return Ne(this,null,function*(){return yield K0(this.facilityId,e)})}initializeSettings(){return Ne(this,null,function*(){try{const e=O0;return yield this.saveSettings(e)}catch(e){return console.error(e),console.error("Error initializing learning AI settings"),!1}})}generatePersonalizedRecommendations(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!Pt(t,"personalized_recommendations"))throw new Error("Personalized recommendations AI is not enabled");return yield this.recommendationService.generatePersonalizedRecommendations(e)}catch(t){return console.error("Error generating personalized recommendations:",t),null}})}analyzeSkillGaps(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!Pt(t,"skill_gap_analysis"))throw new Error("Skill gap analysis AI is not enabled");return yield this.knowledgeGapService.analyzeSkillGaps(e)}catch(t){return console.error(t),console.error("Error analyzing skill gaps"),null}})}optimizeLearningPath(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!Pt(t,"learning_path_optimization"))throw new Error("Learning path optimization AI is not enabled");return yield this.pathwayAnalysisService.optimizeLearningPath(e)}catch(t){return console.error("Error optimizing learning path:",t),null}})}predictPerformance(e,t){return Ne(this,null,function*(){try{const n=yield this.loadSettings();if(!Pt(n,"performance_prediction"))throw new Error("Performance prediction AI is not enabled");return yield this.evaluationService.predictPerformance(e,t)}catch(n){return console.error("Error predicting performance:",n),null}})}adjustDifficulty(e,t){return Ne(this,null,function*(){try{const n=yield this.loadSettings();if(!Pt(n,"adaptive_difficulty"))throw new Error("Adaptive difficulty AI is not enabled");return yield this.evaluationService.adjustDifficulty(e,t)}catch(n){return console.error("Error adjusting difficulty:",n),null}})}analyzeEngagement(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!Pt(t,"engagement_metrics"))throw new Error("Engagement analysis AI is not enabled");return yield this.evaluationService.analyzeEngagement(e)}catch(t){return console.error("Error analyzing engagement:",t),null}})}predictRetention(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!Pt(t,"retention_analysis"))throw new Error("Retention prediction AI is not enabled");return yield this.evaluationService.predictRetention(e)}catch(t){return console.error("Error predicting retention:",t),null}})}generateLearningAnalytics(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!Pt(t,"learning_analytics_enabled"))throw new Error("Learning analytics AI is not enabled");return yield this.evaluationService.generateLearningAnalytics(e)}catch(t){return console.error("Error generating learning analytics:",t),null}})}getLearningInsights(){return Ne(this,null,function*(){return this.analyticsService.getLearningInsights()})}getLearningProgressData(e){return Ne(this,null,function*(){return yield Q0(this.facilityId,e)})}getUserProfile(e){return Ne(this,null,function*(){return yield Y0(this.facilityId,e)})}}var pa=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Ri{constructor(e){this.facilityId=e}getInventoryInsights(){return pa(this,null,function*(){try{const e=[],{data:t}=yield _.from("inventory_ai_barcode_analysis").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);t&&t.forEach(a=>{e.push({type:"barcode_analysis",title:"Barcode Quality Assessment",description:`Barcode ${a.barcode_value} analyzed with ${(a.confidence_score*100).toFixed(1)}% confidence`,confidence:a.confidence_score||0,recommendations:a.recommendations||[],data:a,timestamp:a.created_at,priority:a.confidence_score<.7?"critical":a.confidence_score<.85?"high":"medium",id:a.id||`barcode-${Date.now()}`,actionable:!0})});const{data:n}=yield _.from("inventory_ai_demand_forecasting").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);return n&&n.forEach(a=>{e.push({type:"demand_forecast",title:"Demand Forecast",description:`${a.forecast_period} forecast: ${a.predicted_demand} units predicted`,confidence:a.confidence_score||0,recommendations:a.recommendations||[],data:a,timestamp:a.created_at,priority:a.confidence_score<.7?"critical":a.confidence_score<.85?"high":"medium",id:a.id||`forecast-${Date.now()}`,actionable:!0})}),e}catch(e){return console.error("Error getting inventory insights:",e),[]}})}getHistoricalInventoryData(){return pa(this,null,function*(){return Array.from({length:30},(e,t)=>({date:new Date(Date.now()-t*24*60*60*1e3).toISOString(),quantity:Math.floor(Math.random()*20)+10,transaction_type:"usage"}))})}getInventoryCostData(){return pa(this,null,function*(){return{purchasing_costs:8e3,storage_costs:4e3,transportation_costs:3e3,total_cost:15e3}})}detectBarcodeType(e){return e?e.length===13?"ean13":e.length===12?"upc":e.length===8?"ean8":"code128":"unknown"}assessBarcodeQuality(e){return e>=.9?"excellent":e>=.8?"good":e>=.7?"fair":"poor"}calculateInventoryTurns(e,t){return t===0?0:e/t}calculateStockoutRisk(e,t,n,a){const i=(e-a)/t;return i<=0?1:i<=n?.8:i<=n*1.5?.5:.2}calculateSafetyStock(e,t,n){const a=this.getZScore(n);return Math.ceil(e*t*a*.1)}calculateReorderPoint(e,t,n){return Math.ceil(e*t+n)}getZScore(e){return{.8:.84,.85:1.04,.9:1.28,.95:1.65,.99:2.33}[e]||1.28}}var fa=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class X0{constructor(e){this.facilityId=e}generateDemandForecast(e,t,n){return fa(this,null,function*(){try{const a=Date.now(),i=n||(yield this.getHistoricalInventoryData()),c=yield this.generateForecastWithAI(i,t),l=Date.now()-a;return{facility_id:this.facilityId,inventory_item_id:e,forecast_period:t,forecast_date:new Date().toISOString().split("T")[0],predicted_demand:c.predicted_demand,confidence_interval_lower:c.confidence_interval_lower,confidence_interval_upper:c.confidence_interval_upper,seasonal_factors:c.seasonal_factors,trend_analysis:c.trend_analysis,influencing_factors:c.influencing_factors,confidence_score:c.confidence_score,processing_time_ms:l,historical_data_points:i.length,accuracy_metrics:c.accuracy_metrics,recommendations:c.recommendations}}catch(a){throw console.error("Error generating demand forecast:",a),a}})}generateForecastWithAI(e,t){return fa(this,null,function*(){return{predicted_demand:this.calculateDeterministicForecast(e,t),confidence_interval_lower:this.calculateConfidenceInterval(e,t,"lower"),confidence_interval_upper:this.calculateConfidenceInterval(e,t,"upper"),seasonal_factors:this.analyzeSeasonality(e),trend_analysis:this.detectTrendDirection(e),influencing_factors:this.identifyInfluencingFactors(e),confidence_score:this.calculateConfidenceScore(e),accuracy_metrics:this.calculateAccuracyMetrics(e),recommendations:this.generateRecommendations(e,t)}})}getHistoricalInventoryData(){return fa(this,null,function*(){return Array.from({length:30},(e,t)=>({date:new Date(Date.now()-t*24*60*60*1e3).toISOString(),quantity:Math.floor(Math.random()*20)+10,transaction_type:"usage"}))})}calculateDeterministicForecast(e,t){if(e.length===0)return 0;const a=e.reduce((i,c)=>i+c.quantity,0)/e.length;switch(t){case"week":return Math.ceil(a*7);case"month":return Math.ceil(a*30);case"quarter":return Math.ceil(a*90);case"year":return Math.ceil(a*365);default:return Math.ceil(a*30)}}calculateConfidenceInterval(e,t,n){if(e.length===0)return 0;const a=this.calculateDeterministicForecast(e,t),i=this.calculateVariance(e),c=Math.sqrt(i/e.length),l=1.96;return n==="lower"?Math.max(0,Math.ceil(a-l*c)):Math.ceil(a+l*c)}calculateVariance(e){if(e.length<=1)return 0;const t=e.map(i=>i.quantity),n=t.reduce((i,c)=>i+c,0)/t.length;return t.map(i=>Math.pow(i-n,2)).reduce((i,c)=>i+c,0)/(t.length-1)}analyzeSeasonality(e){if(e.length<7)return{seasonality:"insufficient_data",trend:"unknown"};const t=this.groupByWeek(e);return{seasonality:this.detectWeeklyPattern(t)?"weekly":"none",trend:this.detectTrendDirection(e),weekly_variance:this.calculateWeeklyVariance(t)}}groupByWeek(e){const t={};return e.forEach(n=>{const a=new Date(n.date),i=`${a.getFullYear()}-W${Math.ceil((a.getDate()+a.getDay())/7)}`;t[i]||(t[i]=[]),t[i].push(n.quantity)}),t}detectWeeklyPattern(e){const t=Object.keys(e);if(t.length<2)return!1;const n=t.map(i=>{const c=e[i];return c.reduce((l,o)=>l+o,0)/c.length});return this.calculateVariance(n.map((i,c)=>({quantity:n[c],date:new Date().toISOString(),transaction_type:"usage"})))>5}detectTrendDirection(e){if(e.length<2)return"insufficient_data";const t=[...e].sort((o,d)=>new Date(o.date).getTime()-new Date(d.date).getTime()),n=t.slice(0,Math.floor(t.length/2)),a=t.slice(Math.floor(t.length/2)),i=n.reduce((o,d)=>o+d.quantity,0)/n.length,l=(a.reduce((o,d)=>o+d.quantity,0)/a.length-i)/i*100;return l>10?"increasing":l<-10?"decreasing":"stable"}calculateWeeklyVariance(e){const t=Object.values(e).map(i=>i.reduce((c,l)=>c+l,0)/i.length);if(t.length<=1)return 0;const n=t.reduce((i,c)=>i+c,0)/t.length;return t.map(i=>Math.pow(i-n,2)).reduce((i,c)=>i+c,0)/(t.length-1)}identifyInfluencingFactors(e){const t=[];if(e.length>0){const n=this.detectTrendDirection(e);n==="increasing"&&t.push("increased_procedures"),n==="decreasing"&&t.push("reduced_activity"),this.analyzeSeasonality(e).seasonality==="weekly"&&t.push("weekly_usage_patterns")}return t.length>0?t:["stable_usage_patterns"]}calculateConfidenceScore(e){return e.length===0?0:e.length<7?.5:e.length<14?.7:e.length<30?.8:.85}calculateAccuracyMetrics(e){if(e.length<2)return{mae:0,rmse:0};const t=this.calculateVariance(e),n=Math.sqrt(t)*.8,a=Math.sqrt(t);return{mae:Math.round(n*100)/100,rmse:Math.round(a*100)/100}}generateRecommendations(e,t){const n=[];if(e.length<7)return n.push("Collect more historical data for accurate forecasting"),n;const a=this.detectTrendDirection(e),i=this.calculateDeterministicForecast(e,t);return a==="increasing"?n.push(`Consider increasing stock levels by 15% for ${t} period`):a==="decreasing"&&n.push(`Consider reducing stock levels by 10% for ${t} period`),n.push(`Monitor usage patterns ${t}ly`),n.push(`Set reorder point at ${Math.ceil(i*.8)} units`),n}}var rn={},Ot=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Ai{constructor(e){this.facilityId=e}processImageWithAI(){return Ot(this,null,function*(){return{confidence:.85,damage_detected:!1,damage_types:[],objects:["inventory_item","barcode"],confidence_scores:[.9,.8],classification:"medical_supply",category:"disposables",quality:"good",condition:"good",damage_description:null,recommendations:["Item appears to be in good condition","Barcode is clearly visible"]}})}generateForecastWithAI(){return Ot(this,null,function*(){return{predicted_demand:Math.floor(Math.random()*100)+50,confidence_interval_lower:40,confidence_interval_upper:80,seasonal_factors:{seasonality:"moderate",trend:"increasing"},trend_analysis:"Steady increase in demand over the past 6 months",influencing_factors:["seasonal usage","increased procedures"],confidence_score:.82,accuracy_metrics:{mae:12.5,rmse:15.2},recommendations:["Consider increasing stock levels by 15%","Monitor usage patterns weekly"]}})}generateOptimizationWithAI(){return Ot(this,null,function*(){return{current_cost:15e3,optimized_cost:12e3,cost_savings:3e3,savings_percentage:20,optimization_factors:{bulk_purchasing:!0,supplier_negotiation:!0},recommended_actions:["Negotiate bulk pricing with suppliers","Implement just-in-time inventory"],implementation_timeline:"3-6 months",risk_assessment:"low",confidence_score:.88,roi_estimate:150}})}processCategorizationWithAI(){return Ot(this,null,function*(){return{suggested_category:"medical_supplies",suggested_subcategory:"disposables",category_confidence_score:.92,alternative_categories:["Item description matches medical supply patterns","Similar items in database"],categorization_reasoning:["Item description matches medical supply patterns","Similar items in database"],form_fill_suggestions:{category:"medical_supplies",subcategory:"disposables"},workflow_recommendations:["Use standard medical supply workflow","Apply medical supply pricing"],confidence_score:.92}})}uploadImage(e){return Ot(this,null,function*(){return`/uploads/inventory/${Date.now()}_${e.name}`})}buildImageAnalysisPrompt(e){return`Analyze this inventory item image: ${e}. 
    Please provide:
    1. Object recognition with confidence scores
    2. Item classification and category
    3. Quality assessment
    4. Damage detection if any
    5. Recommendations for inventory management`}buildForecastingPrompt(e,t){return`Based on the following historical inventory data: ${e}
    Generate a ${t} demand forecast including:
    1. Predicted demand quantity
    2. Confidence intervals
    3. Seasonal factors
    4. Trend analysis
    5. Influencing factors
    6. Recommendations`}buildOptimizationPrompt(e,t){return`Analyze the following cost data: ${e}
    Provide ${t} optimization including:
    1. Current vs optimized costs
    2. Cost savings and ROI
    3. Optimization factors
    4. Recommended actions
    5. Implementation timeline
    6. Risk assessment`}buildCategorizationPrompt(e,t){return`Categorize this ${t} input: ${e}
    Please provide:
    1. Suggested category and subcategory
    2. Confidence scores
    3. Alternative categories
    4. Reasoning for categorization
    5. Form fill suggestions
    6. Workflow recommendations`}executeWithRetry(e,t=3,n=100){return Ot(this,null,function*(){const{OptimizedRetryService:a}=yield H(()=>import("./login-BkZ1x_Cy.js").then(i=>i.ac),__vite__mapDeps([1,2,3,4,5]));return yield a.executeWithRetry(e,{maxRetries:t,baseDelay:n,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return Ot(this,null,function*(){const n=new Promise((a,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,n])})}selectModelForTask(e){switch(e){case"image":return"gpt-4-vision-preview";case"forecast":return"gpt-4";case"optimization":return"gpt-4";case"categorization":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:rn.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:rn.GOOGLE_VISION_API_BASE_URL||"https://vision.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro-vision"},azure:{baseUrl:rn.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:rn.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}processPredictiveAnalyticsWithAI(){return Ot(this,null,function*(){const e=[{itemId:"item-001",itemName:"Surgical Masks",predictedDemand:Math.floor(Math.random()*1e3)+500,confidence:.85+Math.random()*.1,timeframe:"30 days",factors:["seasonal flu season","increased procedures","historical usage patterns"]},{itemId:"item-002",itemName:"Gloves",predictedDemand:Math.floor(Math.random()*2e3)+1e3,confidence:.78+Math.random()*.15,timeframe:"30 days",factors:["standard usage","procedure volume","safety protocols"]}],t=[{itemId:"item-003",itemName:"Antibiotics",riskLevel:"high",probability:.75,estimatedStockoutDate:new Date(Date.now()+360*60*60*1e3).toISOString(),recommendedAction:"Increase order quantity and expedite delivery"},{itemId:"item-004",itemName:"IV Supplies",riskLevel:"medium",probability:.45,estimatedStockoutDate:new Date(Date.now()+720*60*60*1e3).toISOString(),recommendedAction:"Monitor usage and adjust reorder points"}],n=[{equipmentId:"equip-001",equipmentName:"Autoclave Unit A",predictedIssue:"Heating element degradation",estimatedFailureDate:new Date(Date.now()+1080*60*60*1e3).toISOString(),confidence:.82,recommendedMaintenance:"Schedule preventive maintenance within 2 weeks"}];return{demandForecast:e,stockoutRisk:t,maintenancePredictions:n,costTrends:[{category:"Medical Supplies",currentCost:15e3,predictedCost:16200,trend:"increasing",confidence:.79,factors:["inflation","supply chain issues","increased demand"]},{category:"Equipment",currentCost:8e3,predictedCost:7800,trend:"decreasing",confidence:.68,factors:["bulk purchasing","vendor negotiations","efficiency improvements"]}],seasonalPatterns:[{category:"Respiratory Supplies",pattern:"Winter peak, summer low",peakSeason:"December - February",lowSeason:"June - August",confidence:.91,recommendations:["Stock up in summer for winter demand","Negotiate seasonal pricing"]},{category:"Surgical Supplies",pattern:"Consistent year-round",peakSeason:"N/A",lowSeason:"N/A",confidence:.95,recommendations:["Maintain steady inventory levels","Focus on cost optimization"]}]}})}}const ga=.85,Z0=2160*60*60*1e3,ev=365*24*60*60*1e3,tv="30_days",rv=10,sv=5,nv="maintenance-1",av=[{month:"Jan",cost:1e3,trend:"stable"},{month:"Feb",cost:1200,trend:"increasing"}],im="Uncategorized",$i="Unknown",iv="Unknown Equipment",as={csv:"text/csv",excel:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf",json:"application/json",default:"text/plain"},ov="good",lv="good",cv=["Increase inventory levels for low stock items.","Review maintenance schedules."],dv="low";var Sl=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class uv{constructor(e){this.facilityId=e,this.analyticsService=new Ri(e),this.forecastingService=new X0(e),this.providerService=new Ai(e)}generateDemandForecast(e,t){return Sl(this,null,function*(){try{const n=yield this.analyticsService.getHistoricalInventoryData(),a=yield this.forecastingService.generateDemandForecast(e,t,n),{data:i,error:c}=yield _.from("inventory_ai_demand_forecasting").insert(a).select().single();return c?(console.error("Error saving demand forecast:",c),null):i}catch(n){return console.error("Error generating demand forecast:",n),null}})}getPredictiveAnalytics(){return Sl(this,null,function*(){try{const e=Date.now(),{data:t,error:n}=yield nt.getInventoryTransactionsByFacility(this.facilityId);if(n)return console.error("Error getting inventory transactions:",n),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};const a=new Date(Date.now()-Z0);(t||[]).filter(v=>v.created_at&&new Date(v.created_at)>=a).sort((v,b)=>new Date(b.created_at||"").getTime()-new Date(v.created_at||"").getTime());const{data:c,error:l}=yield nt.getEquipmentMaintenanceByFacility(this.facilityId);if(l)return console.error("Error getting equipment maintenance:",l),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};const o=new Date(Date.now()-ev);(c||[]).filter(v=>v.created_at&&new Date(v.created_at)>=o).sort((v,b)=>new Date(b.created_at||"").getTime()-new Date(v.created_at||"").getTime());const{data:u,error:h}=yield nt.getInventoryCostsByFacility(this.facilityId);if(h)return console.error("Error getting inventory costs:",h),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};(u||[]).filter(v=>v.created_at&&new Date(v.created_at)>=o).sort((v,b)=>new Date(b.created_at||"").getTime()-new Date(v.created_at||"").getTime());const f=yield this.providerService.processPredictiveAnalyticsWithAI(),g=Date.now()-e,{error:y}=yield _.from("inventory_ai_predictive_analytics").insert({facility_id:this.facilityId,predictions_data:f,processing_time_ms:g,generated_at:new Date().toISOString()});return y&&console.error("Error saving predictive analytics:",y),f}catch(e){throw console.error("Error generating predictive analytics:",e),e}})}}var jl=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class mv{constructor(e){this.facilityId=e,this.providerService=new Ai(e)}generateCostOptimization(e){return jl(this,null,function*(){try{const t=Date.now(),n=yield this.providerService.generateOptimizationWithAI(),a=Date.now()-t,i={facility_id:this.facilityId,optimization_type:e,current_cost:n.current_cost,optimized_cost:n.optimized_cost,cost_savings:n.cost_savings,savings_percentage:n.savings_percentage,optimization_factors:n.optimization_factors,recommended_actions:n.recommended_actions,implementation_timeline:n.implementation_timeline,risk_assessment:n.risk_assessment,confidence_score:n.confidence_score,processing_time_ms:a,data_analysis_period:tv,roi_estimate:n.roi_estimate},{data:c,error:l}=yield _.from("inventory_ai_cost_optimization").insert(i).select().single();return l?(console.error("Error saving cost optimization:",l),null):c}catch(t){return console.error("Error generating cost optimization:",t),null}})}categorizeItem(e,t){return jl(this,null,function*(){try{const n=Date.now(),a=yield this.providerService.processCategorizationWithAI(),i=Date.now()-n,c={facility_id:this.facilityId,suggested_category:a.suggested_category,suggested_subcategory:a.suggested_subcategory,category_confidence_score:a.category_confidence_score,alternative_categories:a.alternative_categories,categorization_reasoning:a.categorization_reasoning,form_fill_suggestions:a.form_fill_suggestions,workflow_recommendations:a.workflow_recommendations,confidence_score:a.confidence_score,processing_time_ms:i,input_data_type:t,learning_feedback:!1,user_acceptance:void 0},{data:l,error:o}=yield _.from("inventory_ai_smart_categorization").insert(c).select().single();return o?(console.error("Error saving smart categorization:",o),null):l}catch(n){return console.error("Error categorizing item:",n),null}})}}var Cl=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class hv{constructor(e){this.facilityId=e,this.analyticsService=new Ri(e),this.providerService=new Ai(e)}analyzeBarcode(e,t){return Cl(this,null,function*(){try{const n=Date.now(),a=yield this.providerService.processImageWithAI(),i=Date.now()-n,c={facility_id:this.facilityId,barcode_value:t,barcode_type:this.analyticsService.detectBarcodeType(t),quality_rating:this.analyticsService.assessBarcodeQuality(a.confidence),readability_score:a.confidence||ga,damage_detected:a.damage_detected||!1,damage_types:a.damage_types||[],confidence_score:a.confidence||ga,processing_time_ms:i,image_file_path:yield this.providerService.uploadImage(e),ai_insights:a,recommendations:a.recommendations||[]},{data:l,error:o}=yield _.from("inventory_ai_barcode_analysis").insert(c).select().single();return o?(console.error("Error saving barcode analysis:",o),null):l}catch(n){return console.error("Error analyzing barcode:",n),null}})}analyzeImage(e){return Cl(this,null,function*(){try{const t=Date.now(),n=yield this.providerService.processImageWithAI(),a=Date.now()-t,i={facility_id:this.facilityId,recognized_objects:n.objects||[],object_confidence_scores:n.confidence_scores||[],item_classification:n.classification,category_suggestion:n.category,quality_assessment:n.quality||ov,damage_detected:n.damage_detected||!1,damage_description:n.damage_description||void 0,condition_rating:n.condition||lv,confidence_score:n.confidence||ga,processing_time_ms:a,image_file_path:yield this.providerService.uploadImage(e),ai_insights:n,recommendations:n.recommendations||[]},{data:c,error:l}=yield _.from("inventory_ai_image_recognition").insert(i).select().single();return l?(console.error("Error saving image recognition:",l),null):c}catch(t){return console.error("Error analyzing image:",t),null}})}}function pv(r){return r.reduce((e,t)=>{const n=t.category||im;return e[n]||(e[n]=0),e[n]=e[n]+1,e},{})}function fv(r){return r.reduce((e,t)=>{const n=t.category||im;return e[n]=(e[n]||0)+(t.amount||0),e},{})}function gv(r){return r.reduce((e,t)=>{const n=t.type||$i;return e[n]=(e[n]||0)+1,e},{})}function yv(r){return r.filter(e=>{var t;return(e.quantity||0)<(((t=e.data)==null?void 0:t.min_quantity)||0)}).map(e=>{var t;return{id:e.id||"",name:e.name||"",current_stock:e.quantity||0,reorder_point:((t=e.data)==null?void 0:t.min_quantity)||0}})}function vv(r){return r.sort((e,t)=>(t.value||0)-(e.value||0)).slice(0,rv).map(e=>({id:e.id||"",name:e.name||"",value:e.value||0,category:e.category||$i}))}function xv(r){return r.slice(0,sv).map(e=>({id:nv,equipment_name:e.equipment_name||iv,due_date:e.due_date||new Date().toISOString(),type:e.type||$i}))}function bv(r){return r.reduce((e,t)=>e+(t.amount||0),0)}function _v(){return av}function wv(r){return{totalValue:r.totalItems,riskLevel:dv,recommendations:cv}}function Sv(r){if(Array.isArray(r)){const e=Object.keys(r[0]||{}),t=[e.join(",")];for(const n of r){const a=e.map(i=>JSON.stringify(n[i]||""));t.push(a.join(","))}return t.join(`
`)}return JSON.stringify(r)}function jv(r){switch(r){case"csv":return as.csv;case"excel":return as.excel;case"pdf":return as.pdf;case"json":return as.json;default:return as.default}}var Wt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Cv{constructor(e){this.facilityId=e}exportAnalyticsReport(e,t,n){return Wt(this,null,function*(){try{const a=Date.now();let i={};switch(e){case"inventory":i=yield this.generateInventoryReport();break;case"predictive":i={};break;case"cost":i=yield this.generateCostReport();break;case"maintenance":i=yield this.generateMaintenanceReport();break;case"comprehensive":i=yield this.generateComprehensiveReport();break}const c=yield this.formatReportData(i,t),{error:l}=yield _.from("inventory_ai_exports").insert({facility_id:this.facilityId,report_type:e,export_format:t,date_range:n,processing_time_ms:Date.now()-a,exported_at:new Date().toISOString()});return l&&console.error("Error saving export record:",l),{success:!0,data:c,downloadUrl:yield this.generateDownloadUrl(c,t)}}catch(a){return console.error("Error exporting analytics report:",a),{success:!1,error:a instanceof Error?a.message:"Export failed"}}})}generateInventoryReport(){return Wt(this,null,function*(){const t=(yield nt.getItems()).filter(n=>n.facility_id===this.facilityId);return{totalItems:(t==null?void 0:t.length)||0,categories:pv(t||[]),lowStockItems:yv(t||[]),highValueItems:vv(t||[])}})}generateCostReport(){return Wt(this,null,function*(){const{data:e,error:t}=yield nt.getInventoryCostsByFacility(this.facilityId);return t?(console.error("Error getting inventory costs for cost report:",t),{totalCosts:0,costByCategory:{},costTrends:[]}):{totalCosts:bv(e||[]),costByCategory:fv(e||[]),costTrends:_v()}})}generateMaintenanceReport(){return Wt(this,null,function*(){const{data:e,error:t}=yield nt.getEquipmentMaintenanceByFacility(this.facilityId);return t?(console.error("Error getting equipment maintenance for maintenance report:",t),{totalMaintenance:0,maintenanceByType:{},upcomingMaintenance:[]}):{totalMaintenance:(e==null?void 0:e.length)||0,maintenanceByType:gv(e||[]),upcomingMaintenance:xv(e||[])}})}generateComprehensiveReport(){return Wt(this,null,function*(){const[e,t,n]=yield Promise.all([this.generateInventoryReport(),this.generateCostReport(),this.generateMaintenanceReport()]);return{inventory:e,predictive:{},cost:t,maintenance:n,summary:wv(e)}})}formatReportData(e,t){return Wt(this,null,function*(){switch(t){case"json":return JSON.stringify(e,null,2);case"csv":return Sv(e);case"excel":return e;case"pdf":return e;default:return e}})}generateDownloadUrl(e,t){return Wt(this,null,function*(){const n=new Blob([JSON.stringify(e)],{type:jv(t)});return URL.createObjectURL(n)})}}var ya=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Nv={auto_reorder_enabled:!0,low_stock_threshold:10,prediction_accuracy_threshold:.85,ai_model_version:"1.0.0"};class Iv{constructor(e){this.facilityId=e}loadSettings(){return ya(this,null,function*(){try{const{data:e,error:t}=yield _.from("inventory_items").select("facility_id").eq("facility_id",this.facilityId).limit(1);return t?(console.error("Error loading AI settings:",t),null):{facility_id:this.facilityId,auto_reorder_enabled:!0,low_stock_threshold:10,prediction_accuracy_threshold:.85,ai_model_version:"1.0.0"}}catch(e){return console.error("Error loading AI settings:",e),null}})}saveSettings(e){return ya(this,null,function*(){try{return console.log("Saving AI settings:",e),!0}catch(t){return console.error("Error saving AI settings:",t),!1}})}initializeSettings(){return ya(this,null,function*(){try{const e=Nv;return yield this.saveSettings(e)}catch(e){return console.error("Error initializing AI settings:",e),!1}})}}var Ze=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Tv{constructor(e){this.facilityId=e,this.analyticsService=new Ri(e),this.forecastingService=new uv(e),this.optimizationService=new mv(e),this.riskAnalysisService=new hv(e),this.costAnalyticsService=new Cv(e),this.supabaseProvider=new Iv(e)}getInventoryInsights(){return Ze(this,null,function*(){return this.analyticsService.getInventoryInsights()})}loadSettings(){return Ze(this,null,function*(){return yield this.supabaseProvider.loadSettings()})}saveSettings(e){return Ze(this,null,function*(){return yield this.supabaseProvider.saveSettings(e)})}initializeSettings(){return Ze(this,null,function*(){return yield this.supabaseProvider.initializeSettings()})}analyzeBarcode(e,t){return Ze(this,null,function*(){try{const n=yield this.loadSettings();if(!(n!=null&&n.barcode_scanning_enabled))throw new Error("Barcode scanning AI is not enabled");return yield this.riskAnalysisService.analyzeBarcode(e,t)}catch(n){return console.error("Error analyzing barcode:",n),null}})}analyzeImage(e){return Ze(this,null,function*(){try{const t=yield this.loadSettings();if(!(t!=null&&t.image_recognition_enabled))throw new Error("Image recognition AI is not enabled");return yield this.riskAnalysisService.analyzeImage(e)}catch(t){return console.error("Error analyzing image:",t),null}})}generateDemandForecast(e,t){return Ze(this,null,function*(){try{const n=yield this.loadSettings();if(!(n!=null&&n.demand_forecasting_enabled))throw new Error("Demand forecasting AI is not enabled");return yield this.forecastingService.generateDemandForecast(e,t)}catch(n){return console.error("Error generating demand forecast:",n),null}})}generateCostOptimization(e){return Ze(this,null,function*(){try{const t=yield this.loadSettings();if(!(t!=null&&t.cost_optimization_enabled))throw new Error("Cost optimization AI is not enabled");return yield this.optimizationService.generateCostOptimization(e)}catch(t){return console.error("Error generating cost optimization:",t),null}})}categorizeItem(e,t){return Ze(this,null,function*(){try{const n=yield this.loadSettings();if(!(n!=null&&n.smart_categorization_enabled))throw new Error("Smart categorization AI is not enabled");return yield this.optimizationService.categorizeItem(e,t)}catch(n){return console.error("Error categorizing item:",n),null}})}getPredictiveAnalytics(){return Ze(this,null,function*(){try{const e=yield this.loadSettings();if(!(e!=null&&e.predictive_analytics_enabled))throw new Error("Predictive analytics AI is not enabled");return yield this.forecastingService.getPredictiveAnalytics()}catch(e){throw console.error("Error generating predictive analytics:",e),e}})}exportAnalyticsReport(e,t,n){return Ze(this,null,function*(){try{const a=yield this.loadSettings();if(!(a!=null&&a.predictive_analytics_enabled))throw new Error("Analytics export is not enabled");return yield this.costAnalyticsService.exportAnalyticsReport(e,t,n)}catch(a){return console.error("Error exporting analytics report:",a),{success:!1,error:a instanceof Error?a.message:"Export failed"}}})}}var Ev=Object.defineProperty,kv=Object.defineProperties,Dv=Object.getOwnPropertyDescriptors,Nl=Object.getOwnPropertySymbols,Pv=Object.prototype.hasOwnProperty,Ov=Object.prototype.propertyIsEnumerable,Il=(r,e,t)=>e in r?Ev(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rv=(r,e)=>{for(var t in e||(e={}))Pv.call(e,t)&&Il(r,t,e[t]);if(Nl)for(var t of Nl(e))Ov.call(e,t)&&Il(r,t,e[t]);return r},Av=(r,e)=>kv(r,Dv(e)),Tl=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class $v{constructor(e){this.settings=null,this.facilityId=e}loadSettings(){return Tl(this,null,function*(){try{const{data:e,error:t}=yield _.from("sterilization_ai_settings").select("*").eq("facility_id",this.facilityId).single();return t?(console.error("Error loading AI settings:",t),null):(this.settings=e,e)}catch(e){return console.error("Error loading AI settings:",e),null}})}saveSettings(e){return Tl(this,null,function*(){try{const t=Av(Rv({},e),{facility_id:this.facilityId,updated_at:new Date().toISOString()}),{error:n}=yield _.from("sterilization_ai_settings").upsert(t,{onConflict:"facility_id"});return n?(console.error("Error saving AI settings:",n),!1):(yield this.loadSettings(),!0)}catch(t){return console.error("Error saving AI settings:",t),!1}})}isFeatureEnabled(e){var t;return(t=this.settings)!=null&&t.ai_enabled?this.settings[e]===!0:!1}getCurrentSettings(){return this.settings}getOpenAIKey(){var e;return((e=this.settings)==null?void 0:e.openai_api_key_encrypted)||Qh("VITE_OPENAI_API_KEY")}isComputerVisionEnabled(){return this.isFeatureEnabled("computer_vision_enabled")}isToolConditionAssessmentEnabled(){return this.isFeatureEnabled("tool_condition_assessment")}isBarcodeQualityDetectionEnabled(){return this.isFeatureEnabled("barcode_quality_detection")}isToolTypeRecognitionEnabled(){return this.isFeatureEnabled("tool_type_recognition")}isPredictiveAnalyticsEnabled(){return this.isFeatureEnabled("predictive_analytics_enabled")}isCycleOptimizationEnabled(){return this.isFeatureEnabled("cycle_optimization")}isIntelligentWorkflowSelectionEnabled(){return this.isFeatureEnabled("intelligent_workflow_selection")}isAutomatedProblemDetectionEnabled(){return this.isFeatureEnabled("automated_problem_detection")}isRealTimeMonitoringEnabled(){return this.isFeatureEnabled("real_time_monitoring_enabled")}isComplianceMonitoringEnabled(){return this.isFeatureEnabled("compliance_monitoring")}isBiologicalIndicatorAnalysisEnabled(){return this.isFeatureEnabled("biological_indicator_analysis")}getConfidenceThreshold(){var e;return((e=this.settings)==null?void 0:e.ai_confidence_threshold)||.8}getDataRetentionDays(){var e;return((e=this.settings)==null?void 0:e.ai_data_retention_days)||365}}function Mv(){try{const r=localStorage.getItem("currentUser");if(r){const e=JSON.parse(r);return(e==null?void 0:e.id)||null}return null}catch(r){return console.warn("Failed to get user ID from storage:",r),null}}function ut(r){const e=Mv();return e||r||null}var El=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class X{static callOpenAI(e,t){return El(this,null,function*(){var n,a;if(!t)throw new Error("OpenAI API key not configured");try{const i=yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are a healthcare AI specialist for Cliniio, specializing in sterilization facility management, medical instrument analysis, and compliance workflows. Provide accurate, actionable insights based on the data provided."},{role:"user",content:e}],temperature:.3,max_tokens:1e3})});if(!i.ok)throw new Error(`OpenAI API error: ${i.status} ${i.statusText}`);return((a=(n=(yield i.json()).choices[0])==null?void 0:n.message)==null?void 0:a.content)||"AI analysis completed but no response received"}catch(i){throw console.error("OpenAI API call failed:",i),new Error("AI analysis failed")}})}static testConnection(e){return El(this,null,function*(){try{return{success:!0,response:yield this.callOpenAI("Hello! This is a test message from Cliniio sterilization AI service. Please respond with a brief confirmation that you are working.",e)}}catch(t){return{success:!1,response:"",error:t instanceof Error?t.message:"Unknown error"}}})}static parseConditionFromAI(e){return e.includes("excellent")||e.includes("perfect")?"excellent":e.includes("good")||e.includes("acceptable")?"good":e.includes("fair")||e.includes("adequate")?"fair":e.includes("poor")||e.includes("unacceptable")?"poor":e.includes("damaged")||e.includes("broken")?"damaged":"good"}static parseWearLevelFromAI(e){return e.includes("minimal")||e.includes("new")?"minimal":e.includes("moderate")||e.includes("normal")?"moderate":e.includes("significant")||e.includes("worn")?"significant":e.includes("critical")||e.includes("severe")?"critical":"moderate"}static parseCleaningQualityFromAI(e){return e.includes("excellent")||e.includes("clean")?"excellent":e.includes("good")||e.includes("acceptable")?"good":e.includes("fair")||e.includes("adequate")?"fair":e.includes("poor")||e.includes("dirty")?"poor":"good"}static parseDamageFromAI(e){return e.includes("damage")||e.includes("broken")||e.includes("cracked")}static parseDamageTypesFromAI(e){const t=[];return e.includes("crack")&&t.push("crack"),e.includes("scratch")&&t.push("scratch"),e.includes("rust")&&t.push("rust"),e.includes("bend")&&t.push("bent"),t}static parseBarcodeQualityFromAI(e){return e.includes("excellent")||e.includes("clear")?"excellent":e.includes("good")||e.includes("readable")?"good":e.includes("fair")||e.includes("acceptable")?"fair":e.includes("poor")||e.includes("unreadable")?"poor":"good"}static parseToolTypeFromAI(e){return e.includes("handpiece")?"Dental Handpiece":e.includes("scalpel")?"Surgical Scalpel":e.includes("forceps")?"Surgical Forceps":e.includes("scissors")?"Surgical Scissors":"Medical Instrument"}static parseToolCategoryFromAI(e){return e.includes("dental")?"Dental Instruments":e.includes("surgical")?"Surgical Instruments":e.includes("ophthalmic")?"Ophthalmic Instruments":"General Medical Instruments"}static parseRiskLevel(e){return e.includes("high")||e.includes("critical")?"high":e.includes("medium")||e.includes("moderate")?"medium":"low"}static parseComplianceScore(e){return e.includes("excellent")||e.includes("100%")?.95:e.includes("good")||e.includes("90%")?.9:e.includes("fair")||e.includes("80%")?.8:.75}static generateRecommendations(e){const t=[];return e.includes("clean")&&t.push("Ensure thorough cleaning before sterilization"),e.includes("inspect")&&t.push("Perform detailed visual inspection"),e.includes("maintenance")&&t.push("Schedule maintenance check"),t.length===0&&t.push("Tool appears in good condition"),t}static generateBarcodeRecommendations(e){const t=[];return e.includes("poor")&&t.push("Replace barcode label"),e.includes("fair")&&t.push("Clean barcode surface"),e.includes("good")&&t.push("Monitor for degradation"),t}static generateToolSuggestions(e){const t=[];return e.includes("high-speed")&&t.push("High-speed handpiece - requires special sterilization cycle"),e.includes("delicate")&&t.push("Delicate instrument - handle with care"),e.includes("sharp")&&t.push("Sharp instrument - use protective packaging"),t}static parseOptimizationSuggestions(e){const t=[];return e.includes("temperature")&&t.push("Optimize temperature settings"),e.includes("duration")&&t.push("Adjust cycle duration"),e.includes("grouping")&&t.push("Improve tool grouping"),t.length===0&&t.push("Review cycle parameters"),t}static parseRecommendedParameters(e){const t={};return e.includes("temperature")&&(t.temperature=134),e.includes("duration")&&(t.duration=20),e.includes("pressure")&&(t.pressure=30),t}static parseRecommendedWorkflow(e){return e.includes("clean")?"clean":e.includes("dirty")?"dirty":e.includes("problem")?"problem":e.includes("packaging")?"packaging":"dirty"}static parseWorkflowReasoning(){return["Tool condition assessment completed","Historical usage patterns analyzed","Sterilization requirements verified"]}static parseAlternativeWorkflows(){return[{workflow:"clean",confidence:.75,reasoning:"Alternative cleaning approach"}]}static parseIssues(e){const t=[];return e.includes("wear")&&t.push("Tool wear detected"),e.includes("damage")&&t.push("Potential damage"),e.includes("maintenance")&&t.push("Maintenance needed"),t}static parseRiskFactors(e){const t=[];return e.includes("temperature")&&t.push("Temperature variations"),e.includes("pressure")&&t.push("Pressure fluctuations"),e.includes("time")&&t.push("Timing issues"),t}static parseRequiredActions(e){const t=[];return e.includes("document")&&t.push("Document variations"),e.includes("investigate")&&t.push("Investigate causes"),e.includes("correct")&&t.push("Correct procedures"),t}static parseAuditRecommendations(e){const t=[];return e.includes("review")&&t.push("Review procedures"),e.includes("monitor")&&t.push("Monitor parameters"),e.includes("train")&&t.push("Staff training"),t}static parseBIValidation(e){return e.includes("pass")||e.includes("success")?!0:(e.includes("fail")||e.includes("failure"),!1)}}var Fv=Object.defineProperty,Lv=Object.defineProperties,zv=Object.getOwnPropertyDescriptors,kl=Object.getOwnPropertySymbols,Bv=Object.prototype.hasOwnProperty,qv=Object.prototype.propertyIsEnumerable,Dl=(r,e,t)=>e in r?Fv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Uv=(r,e)=>{for(var t in e||(e={}))Bv.call(e,t)&&Dl(r,t,e[t]);if(kl)for(var t of kl(e))qv.call(e,t)&&Dl(r,t,e[t]);return r},Hv=(r,e)=>Lv(r,zv(e)),Gt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Vv{constructor(e){this.facilityId=e}recordMetric(e){return Gt(this,null,function*(){try{const t=Hv(Uv({facility_id:this.facilityId},e),{created_at:new Date().toISOString()}),{data:n,error:a}=yield _.from("ai_performance_metrics").insert(t).select("id").single();return a?(console.error("Error recording performance metric:",a),null):n.id}catch(t){return console.error("Error recording performance metric:",t),null}})}getPerformanceSummary(e="day",t){return Gt(this,null,function*(){try{const n=this.getStartDate(e);let a=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",n.toISOString());t&&(a=a.eq("service_name",t));const{data:i,error:c}=yield a;return c?(console.error("Error fetching performance metrics:",c),this.getDefaultPerformanceSummary()):this.calculatePerformanceSummary(i||[])}catch(n){return console.error("Error getting performance summary:",n),this.getDefaultPerformanceSummary()}})}getServicePerformance(e="day"){return Gt(this,null,function*(){try{const t=this.getStartDate(e),{data:n,error:a}=yield _.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",t.toISOString());return a?(console.error("Error fetching service performance:",a),[]):this.calculateServicePerformance(n||[])}catch(t){return console.error("Error getting service performance:",t),[]}})}getDetailedMetrics(e){return Gt(this,null,function*(){try{const t=this.getStartDate(e.timeRange||"day");let n=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",t.toISOString()).order("created_at",{ascending:!1});e.serviceName&&(n=n.eq("service_name",e.serviceName)),e.operationName&&(n=n.eq("operation_name",e.operationName)),e.success!==void 0&&(n=n.eq("success",e.success)),e.limit&&(n=n.limit(e.limit));const{data:a,error:i}=yield n;return i?(console.error("Error fetching detailed metrics:",i),[]):a}catch(t){return console.error("Error getting detailed metrics:",t),[]}})}getPerformanceTrends(e="month",t){return Gt(this,null,function*(){try{const n=this.getStartDate(e),a=this.getInterval(e);let i=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",n.toISOString()).order("created_at",{ascending:!0});t&&(i=i.eq("service_name",t));const{data:c,error:l}=yield i;return l?(console.error("Error fetching performance trends:",l),{dates:[],processingTimes:[],successRates:[],operationCounts:[]}):this.calculateTrends(c||[],a)}catch(n){return console.error("Error getting performance trends:",n),{dates:[],processingTimes:[],successRates:[],operationCounts:[]}}})}getOptimizationRecommendations(){return Gt(this,null,function*(){try{const e=yield this.getPerformanceSummary("week"),t=[];return e.averageProcessingTime>5e3&&t.push("Consider optimizing AI model selection or reducing input complexity"),e.p95ProcessingTime>1e4&&t.push("Investigate performance bottlenecks in AI service calls"),e.successRate<.9&&t.push("Review error patterns and improve error handling"),e.errorRate>.1&&t.push("Implement retry mechanisms and fallback strategies"),e.performanceTrend==="degrading"&&t.push("Monitor system resources and consider scaling AI services"),t.length===0&&t.push("Performance is within acceptable ranges - continue monitoring"),t}catch(e){return console.error("Error getting optimization recommendations:",e),["Unable to generate recommendations at this time"]}})}cleanupOldMetrics(e=90){return Gt(this,null,function*(){try{const t=new Date(Date.now()-e*24*60*60*1e3),{data:n,error:a}=yield _.from("ai_performance_metrics").delete().lt("created_at",t.toISOString()).eq("facility_id",this.facilityId).select("id");return a?(console.error("Error cleaning up old metrics:",a),0):(n==null?void 0:n.length)||0}catch(t){return console.error("Error cleaning up old metrics:",t),0}})}getStartDate(e){const t=new Date;switch(e){case"hour":return new Date(t.getTime()-3600*1e3);case"day":return new Date(t.getTime()-1440*60*1e3);case"week":return new Date(t.getTime()-10080*60*1e3);case"month":return new Date(t.getTime()-720*60*60*1e3);case"quarter":return new Date(t.getTime()-2160*60*60*1e3);default:return new Date(t.getTime()-1440*60*1e3)}}getInterval(e){switch(e){case"week":return 1440*60*1e3;case"month":return 1440*60*1e3;case"quarter":return 10080*60*1e3;default:return 1440*60*1e3}}calculatePerformanceSummary(e){if(e.length===0)return this.getDefaultPerformanceSummary();const t=e.map(y=>y.processing_time_ms).filter(y=>y>0),n=e.filter(y=>y.success),a=e.filter(y=>!y.success),i=t.sort((y,v)=>y-v),c=e.length,l=n.length/c,o=t.reduce((y,v)=>y+v,0)/t.length,d=i[Math.floor(i.length/2)],u=i[Math.floor(i.length*.95)],h=i[Math.floor(i.length*.99)],p=e.slice(-10),f=p.reduce((y,v)=>y+v.processing_time_ms,0)/p.length,g=f<o*.9?"improving":f>o*1.1?"degrading":"stable";return{totalOperations:c,successRate:l,averageProcessingTime:o,medianProcessingTime:d,p95ProcessingTime:u,p99ProcessingTime:h,totalErrors:a.length,errorRate:a.length/c,performanceTrend:g,recommendations:this.generateRecommendations(e)}}calculateServicePerformance(e){const t=new Map;return e.forEach(n=>{t.has(n.service_name)||t.set(n.service_name,[]),t.get(n.service_name).push(n)}),Array.from(t.entries()).map(([n,a])=>{var i;const c=a.map(y=>y.processing_time_ms).filter(y=>y>0),l=a.filter(y=>y.success),o=((i=a[0])==null?void 0:i.created_at)||"",d=a.length,u=l.length/d,h=c.length>0?c.reduce((y,v)=>y+v,0)/c.length:0,p=Math.max(0,100-h/100),f=u*100,g=Math.round((p+f)/2);return{serviceName:n,operationCount:d,successRate:u,averageTime:h,totalErrors:a.filter(y=>!y.success).length,lastOperation:o,performanceScore:g}}).sort((n,a)=>a.performanceScore-n.performanceScore)}calculateTrends(e,t){const n=new Date,a=new Map;for(let c=0;c<10;c++){const o=new Date(n.getTime()-c*t).toISOString().split("T")[0];a.set(o,{times:[],success:0,total:0})}e.forEach(c=>{const l=new Date(c.created_at).toISOString().split("T")[0],o=a.get(l);o&&(o.times.push(c.processing_time_ms),o.total++,c.success&&o.success++)});const i=Array.from(a.entries()).sort(([c],[l])=>c.localeCompare(l));return{dates:i.map(([c])=>c),processingTimes:i.map(([,c])=>c.times.length>0?c.times.reduce((l,o)=>l+o,0)/c.times.length:0),successRates:i.map(([,c])=>c.total>0?c.success/c.total:0),operationCounts:i.map(([,c])=>c.total)}}generateRecommendations(e){const t=[];if(e.length===0)return["No performance data available for recommendations"];const n=e.reduce((i,c)=>i+c.processing_time_ms,0)/e.length,a=e.filter(i=>i.success).length/e.length;return n>5e3&&t.push("Consider optimizing AI model selection for faster processing"),a<.9&&t.push("Review error patterns and implement better error handling"),t.length===0&&t.push("Performance is within acceptable ranges"),t}getDefaultPerformanceSummary(){return{totalOperations:0,successRate:0,averageProcessingTime:0,medianProcessingTime:0,p95ProcessingTime:0,p99ProcessingTime:0,totalErrors:0,errorRate:0,performanceTrend:"stable",recommendations:["No performance data available"]}}}var is=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Wv{constructor(e){this.analysisStartTime=0,this.facilityId=e,this.performanceMetrics=new Vv(e)}analyzeToolCondition(e,t,n){return is(this,null,function*(){this.analysisStartTime=Date.now();try{let a;t?a=`Analyze medical instrument data for tool ID: ${e}. Provide general condition assessment, wear level estimation, cleaning quality recommendations, and damage detection guidance based on best practices for medical instrument sterilization.`:a=`Analyze medical instrument data for tool ID: ${e}. Provide general condition assessment, wear level estimation, cleaning quality recommendations, and damage detection guidance based on best practices for medical instrument sterilization.`;const i=yield X.callOpenAI(a,n||""),c={success:!0,toolId:e,condition:X.parseConditionFromAI(i),wearLevel:X.parseWearLevelFromAI(i),cleaningQuality:X.parseCleaningQualityFromAI(i),damageDetected:X.parseDamageFromAI(i),damageTypes:X.parseDamageTypesFromAI(i),confidence:.8,recommendations:X.generateRecommendations(i)},l=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"analyzeToolCondition",processing_time_ms:l,success:!0,input_size_bytes:(t==null?void 0:t.size)||0,ai_model_used:"gpt-4",confidence_score:c.confidence,user_id:ut()||void 0}),yield this.saveToolAssessment(c),c}catch(a){const i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"analyzeToolCondition",processing_time_ms:i,success:!1,error_message:a instanceof Error?a.message:"Unknown error",user_id:ut()||void 0}),console.error("Tool condition analysis failed:",a),{success:!1,condition:"good",wearLevel:"moderate",cleaningQuality:"good",damageDetected:!1,confidence:.5,recommendations:["Analysis failed - manual inspection recommended"],error:a instanceof Error?a.message:"Unknown error"}}})}detectBarcodeQuality(e,t){return is(this,null,function*(){this.analysisStartTime=Date.now();try{let n;e?n=yield X.callOpenAI("Provide general guidance on barcode quality assessment for medical instruments. Include best practices for barcode readability, common issues, and maintenance recommendations.",t||""):n=yield X.callOpenAI("Provide general guidance on barcode quality assessment for medical instruments. Include best practices for barcode readability, common issues, and maintenance recommendations.",t||"");const a=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectBarcodeQuality",processing_time_ms:a,success:!0,input_size_bytes:(e==null?void 0:e.size)||0,ai_model_used:"gpt-4",confidence_score:.9,user_id:ut()||void 0}),{success:!0,quality:X.parseBarcodeQualityFromAI(n),confidence:.9,recommendations:X.generateBarcodeRecommendations(n)}}catch(n){const a=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectBarcodeQuality",processing_time_ms:a,success:!1,error_message:n instanceof Error?n.message:"Unknown error",user_id:ut()||void 0}),console.error("Barcode quality detection failed:",n),{success:!1,quality:"fair",confidence:.5,recommendations:["Analysis failed - manual verification recommended"]}}})}identifyToolType(e,t){return is(this,null,function*(){this.analysisStartTime=Date.now();try{let n;return e?n=yield X.callOpenAI("Provide comprehensive guidance on medical instrument classification and sterilization requirements. Include common instrument types, categories, sterilization cycles, and best practices for healthcare facilities.",t||""):n=yield X.callOpenAI("Provide comprehensive guidance on medical instrument classification and sterilization requirements. Include common instrument types, categories, sterilization cycles, and best practices for healthcare facilities.",t||""),{success:!0,toolType:X.parseToolTypeFromAI(n),category:X.parseToolCategoryFromAI(n),confidence:.8,suggestions:X.generateToolSuggestions(n)}}catch(n){return console.error("Tool type identification failed:",n),{success:!1,confidence:.5,suggestions:["Identification failed - manual classification needed"]}}})}detectPotentialProblems(e,t,n){return is(this,null,function*(){this.analysisStartTime=Date.now();try{const a=yield X.callOpenAI(`Analyze tool data for potential problems: ${JSON.stringify(t)}. Identify risks and provide recommendations.`,n||""),i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectPotentialProblems",processing_time_ms:i,success:!0,ai_model_used:"gpt-4",confidence_score:.8,user_id:ut()||void 0}),{success:!0,problemsDetected:a.includes("problem")||a.includes("risk"),riskLevel:X.parseRiskLevel(a),issues:X.parseIssues(a),recommendations:X.generateRecommendations(a)}}catch(a){const i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectPotentialProblems",processing_time_ms:i,success:!1,error_message:a instanceof Error?a.message:"Unknown error",user_id:ut()||void 0}),console.error("Problem detection failed:",a),{success:!1,problemsDetected:!1,riskLevel:"low",issues:[],recommendations:["Analysis failed - manual inspection recommended"]}}})}saveToolAssessment(e){return is(this,null,function*(){try{const t={facility_id:this.facilityId,tool_id:e.toolId,cycle_id:null,condition_rating:e.condition,wear_level:e.wearLevel,cleaning_quality:e.cleaningQuality,damage_detected:e.damageDetected,damage_types:e.damageTypes||[],confidence_score:e.confidence,model_id:null,processing_time_ms:Date.now()-this.analysisStartTime,image_file_path:null,ai_insights:{recommendations:e.recommendations},created_by:ut()},{data:n,error:a}=yield _.from("sterilization_ai_tool_assessments").insert(t).select("id").single();return a?(console.error("Error saving tool assessment:",a),null):n.id}catch(t){return console.error("Error saving tool assessment:",t),null}})}}var sn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Gv{constructor(e){this.facilityId=e}getCycleOptimization(e,t){return sn(this,null,function*(){try{const{data:n}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).eq("status","completed").order("created_at",{ascending:!1}).limit(100);if(!n||n.length===0)throw new Error("No historical cycle data available");const a=yield X.callOpenAI(`Analyze sterilization cycle data for optimization. Historical cycles: ${JSON.stringify(n)}. Provide efficiency improvements and parameter recommendations.`,t||""),i={cycleId:e,currentEfficiency:this.calculateCurrentEfficiency(n),predictedEfficiency:this.calculatePredictedEfficiency(n),optimizationSuggestions:X.parseOptimizationSuggestions(a),estimatedTimeSavings:this.calculateTimeSavings(),recommendedParameters:X.parseRecommendedParameters(a),confidence:.85};return yield this.saveCycleOptimization(i),i}catch(n){throw console.error("Cycle optimization failed:",n),new Error("Cycle optimization analysis failed")}})}getWorkflowSuggestion(e,t,n){return sn(this,null,function*(){try{const{data:a}=yield _.from("tools").select("*").eq("id",e).eq("facility_id",this.facilityId).single();if(!a)throw new Error("Tool not found");const i=yield X.callOpenAI(`Recommend sterilization workflow for tool: ${JSON.stringify(a)}. History: ${JSON.stringify(t)}. Consider tool type, condition, and usage patterns.`,n||""),c={toolId:e,recommendedWorkflow:X.parseRecommendedWorkflow(i),confidence:this.calculateWorkflowConfidence(a,t),reasoning:X.parseWorkflowReasoning(),alternativeWorkflows:X.parseAlternativeWorkflows()};return yield this.saveWorkflowSuggestion(c),c}catch(a){throw console.error("Workflow suggestion failed:",a),new Error("Workflow suggestion failed")}})}calculateCurrentEfficiency(e){if(!e||e.length===0)return .75;const t=e.reduce((n,a)=>n+(a.duration_minutes||0),0)/e.length;return Math.max(.5,Math.min(1,1-(t-20)/100))}calculatePredictedEfficiency(e){const t=this.calculateCurrentEfficiency(e);return Math.min(1,t+.15)}calculateTimeSavings(){return Math.floor(Math.random()*15)+5}calculateWorkflowConfidence(e,t){let n=.5;return e.condition==="excellent"&&(n+=.2),t.usage_count<100&&(n+=.1),Math.min(n,.95)}saveCycleOptimization(e){return sn(this,null,function*(){try{const t={facility_id:this.facilityId,cycle_id:e.cycleId,current_efficiency:e.currentEfficiency,predicted_efficiency:e.predictedEfficiency,estimated_time_savings:e.estimatedTimeSavings,recommended_parameters:e.recommendedParameters,confidence_score:e.confidence,model_id:null,processing_time_ms:0,optimization_factors:{},created_by:null};yield _.from("sterilization_ai_cycle_optimizations").insert(t)}catch(t){console.error("Error saving cycle optimization:",t)}})}saveWorkflowSuggestion(e){return sn(this,null,function*(){try{const t={facility_id:this.facilityId,tool_id:e.toolId,recommended_workflow:e.recommendedWorkflow,confidence_score:e.confidence,reasoning:e.reasoning,alternative_workflows:e.alternativeWorkflows,model_id:null,processing_time_ms:0,tool_history_data:{},created_by:null};yield _.from("sterilization_ai_workflow_suggestions").insert(t)}catch(t){console.error("Error saving workflow suggestion:",t)}})}}var Rt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Kv{constructor(e){this.facilityId=e}getPredictiveAnalytics(e){return Rt(this,null,function*(){try{const{data:t}=yield _.from("autoclave_equipment").select("*").eq("facility_id",this.facilityId),{data:n}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).eq("status","completed").order("created_at",{ascending:!1}).limit(50),a=`
        Analyze sterilization data for predictive insights:
        Equipment: ${JSON.stringify(t)}
        Recent cycles: ${JSON.stringify(n)}
        
        Provide:
        1. Equipment maintenance predictions
        2. Cycle efficiency trends
        3. Quality metrics analysis
        4. Risk factors and recommendations
      `,i=yield X.callOpenAI(a,e||"");return this.parsePredictiveAnalytics(i,t)}catch(t){throw console.error("Predictive analytics failed:",t),new Error("Predictive analytics failed")}})}getRealTimeInsights(){return Rt(this,null,function*(){try{const{data:e}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).gte("created_at",new Date(Date.now()-864e5).toISOString()),t=[];if(e&&e.length>0){const a=yield this.analyzeCycleEfficiency(e);a&&t.push(a)}const{data:n}=yield _.from("autoclave_equipment").select("*").eq("facility_id",this.facilityId);if(n&&n.length>0){const a=yield this.analyzeEquipmentMaintenance(n);a&&t.push(a)}return t}catch(e){return console.error("Real-time insights failed:",e),[]}})}getHistoricalTrends(e){return Rt(this,null,function*(){try{const t=new Date,n=new Date;switch(e){case"week":n.setDate(t.getDate()-7);break;case"month":n.setMonth(t.getMonth()-1);break;case"quarter":n.setMonth(t.getMonth()-3);break;case"year":n.setFullYear(t.getFullYear()-1);break}const{data:a}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).gte("created_at",n.toISOString()).lte("created_at",t.toISOString()).order("created_at",{ascending:!0});if(!a||a.length===0)throw new Error("No historical data available");const i=this.calculateTrends(a),c=this.generateTrendInsights(i),l=this.generateTrendPredictions(i);return{success:!0,trends:i,insights:c,predictions:l}}catch(t){return console.error("Historical trends analysis failed:",t),{success:!1,trends:{efficiency:[],quality:[],duration:[],temperature:[]},insights:["Analysis failed"],predictions:["Unable to generate predictions"]}}})}parsePredictiveAnalytics(e,t){return{equipmentMaintenance:(t==null?void 0:t.map(n=>({equipmentId:n.id,nextMaintenanceDue:new Date(Date.now()+720*60*60*1e3).toISOString(),riskLevel:"medium",predictedIssues:["Calibration needed","Wear detection"]})))||[],cycleEfficiency:{trend:"improving",factors:["Optimized parameters","Better tool grouping"],recommendations:["Continue current practices","Monitor performance"]},qualityMetrics:{currentQuality:.94,predictedQuality:.96,riskFactors:["Temperature variations"],improvementActions:["Standardize procedures"]}}}analyzeCycleEfficiency(e){return Rt(this,null,function*(){try{const t=this.calculateCurrentEfficiency(e);return t<.8?{id:`efficiency-${Date.now()}`,type:"efficiency_improvement",title:"Cycle Efficiency Improvement Opportunity",description:`Current efficiency is ${(t*100).toFixed(1)}%. Optimization could improve this by 15-20%.`,confidence:.85,priority:"medium",actionable:!0,recommendations:["Review cycle parameters","Optimize tool grouping","Analyze temperature settings"],data:{currentEfficiency:t,potentialEfficiency:t+.15},created_at:new Date().toISOString(),facility_id:this.facilityId}:null}catch(t){return console.error("Cycle efficiency analysis failed:",t),null}})}analyzeEquipmentMaintenance(e){return Rt(this,null,function*(){try{const t=e.filter(n=>(new Date(n.last_maintenance).getTime()-Date.now())/(1e3*60*60*24)<=14);return t.length>0?{id:`maintenance-${Date.now()}`,type:"maintenance_prediction",title:"Equipment Maintenance Due Soon",description:`${t.length} piece(s) of equipment require maintenance within 2 weeks.`,confidence:.9,priority:"high",actionable:!0,recommendations:["Schedule maintenance","Review maintenance logs","Check calibration status"],data:{equipmentCount:t.length,daysUntilMaintenance:14},created_at:new Date().toISOString(),facility_id:this.facilityId}:null}catch(t){return console.error("Equipment maintenance analysis failed:",t),null}})}calculateCurrentEfficiency(e){if(!e||e.length===0)return .75;const t=e.reduce((n,a)=>{var i;return n+((i=a.duration_minutes)!=null?i:0)},0)/e.length;return Math.max(.5,Math.min(1,1-(t-20)/100))}calculateTrends(e){const t=[],n=[],a=[],i=[];return e.forEach((c,l)=>{var o,d;t.push(.75+l*.02+Math.random()*.1),n.push(.9+l*.01+Math.random()*.05),a.push((o=c.duration_minutes)!=null?o:20),i.push((d=c.temperature)!=null?d:134)}),{efficiency:t,quality:n,duration:a,temperature:i}}generateTrendInsights(e){const t=[];if(e.efficiency.length>1){const n=e.efficiency[e.efficiency.length-1]-e.efficiency[0];n>.1&&t.push(`Efficiency has improved ${(n*100).toFixed(1)}% over the period`)}return e.quality.length>1&&e.quality.reduce((a,i)=>a+i,0)/e.quality.length>.95&&t.push("Quality metrics remain consistently high"),t}generateTrendPredictions(e){const t=[];if(e.efficiency.length>1){const n=e.efficiency[e.efficiency.length-1],a=Math.min(1,n+.05);t.push(`Efficiency expected to reach ${(a*100).toFixed(1)}% by end of quarter`)}return e.quality.length>1&&t.push("Quality metrics likely to maintain 96%+ levels"),t}exportAnalyticsReport(e,t,n){return Rt(this,null,function*(){try{const a=Date.now();let i={};switch(e){case"insights":i={insights:yield this.getRealTimeInsights()};break;case"predictive":i={predictive:yield this.getPredictiveAnalytics()};break;case"historical":i=yield this.getHistoricalTrends("month");break;case"comprehensive":{const[o,d,u]=yield Promise.all([this.getRealTimeInsights(),this.getPredictiveAnalytics(),this.getHistoricalTrends("month")]);i={insights:o,predictive:d,historical:u};break}}const c=yield this.formatReportData(i,t),{error:l}=yield _.from("sterilization_ai_exports").insert({facility_id:this.facilityId,report_type:e,export_format:t,date_range:n,processing_time_ms:Date.now()-a,exported_at:new Date().toISOString()});return l&&console.error("Error saving export record:",l),{success:!0,data:c,downloadUrl:yield this.generateDownloadUrl(c,t)}}catch(a){return console.error("Error exporting analytics report:",a),{success:!1,error:a instanceof Error?a.message:"Export failed"}}})}formatReportData(e,t){return Rt(this,null,function*(){switch(t){case"json":return JSON.stringify(e,null,2);case"csv":return this.convertToCSV(e);case"excel":return this.convertToExcel(e);case"pdf":return this.convertToPDF(e);default:return e}})}generateDownloadUrl(e,t){return Rt(this,null,function*(){const n=new Blob([JSON.stringify(e)],{type:this.getMimeType(t)});return URL.createObjectURL(n)})}getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"pdf":return"application/pdf";case"json":return"application/json";default:return"text/plain"}}convertToCSV(e){if(Array.isArray(e)){const t=Object.keys(e[0]||{}),n=[t.join(",")];for(const a of e){const i=t.map(c=>{var l;return JSON.stringify((l=a[c])!=null?l:"")});n.push(i.join(","))}return n.join(`
`)}return JSON.stringify(e)}convertToExcel(e){return e}convertToPDF(e){return e}}var Pl=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Qv{constructor(e){this.facilityId=e}analyzeCompliance(e,t){return Pl(this,null,function*(){try{const{data:n}=yield _.from("sterilization_cycles").select("*").eq("id",e).single();if(!n)throw new Error("Cycle not found");const a=yield X.callOpenAI(`Analyze sterilization cycle for compliance: ${JSON.stringify(n)}. Check for regulatory requirements and audit recommendations.`,t||"");return{cycleId:e,complianceScore:X.parseComplianceScore(a),riskFactors:X.parseRiskFactors(a),requiredActions:X.parseRequiredActions(a),auditRecommendations:X.parseAuditRecommendations(a),regulatoryUpdates:this.parseRegulatoryUpdates()}}catch(n){throw console.error("Compliance analysis failed:",n),new Error("Compliance analysis failed")}})}validateBiologicalIndicators(e,t){return Pl(this,null,function*(){try{const n=yield X.callOpenAI(`Analyze biological indicator data: ${JSON.stringify(e)}. Determine if sterilization conditions were properly achieved.`,t||"");return{valid:X.parseBIValidation(n),confidence:.95,recommendations:["Continue current sterilization parameters","Monitor for any trend changes","Schedule next validation per protocol"]}}catch(n){return console.error("BI validation failed:",n),{valid:!1,confidence:.5,recommendations:["Manual validation required"]}}})}parseRegulatoryUpdates(){return["New FDA guidelines effective Q1 2025","Updated AAMI standards for autoclave validation"]}}var xe=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Yv{constructor(e){this.facilityId=e,this.settingsManager=new $v(e),this.analysisServices=new Wv(e),this.optimizationServices=new Gv(e),this.analyticsServices=new Kv(e),this.complianceServices=new Qv(e)}initialize(){return xe(this,null,function*(){try{return(yield this.settingsManager.loadSettings())!==null}catch(e){return console.error("Failed to initialize SterilizationAIService:",e),!1}})}loadSettings(){return xe(this,null,function*(){return this.settingsManager.loadSettings()})}saveSettings(e){return xe(this,null,function*(){return this.settingsManager.saveSettings(e)})}analyzeToolCondition(e,t){return xe(this,null,function*(){if(!this.settingsManager.isToolConditionAssessmentEnabled())throw new Error("Tool condition assessment is not enabled");const n=this.settingsManager.getOpenAIKey();return this.analysisServices.analyzeToolCondition(e,t,n)})}detectBarcodeQuality(e){return xe(this,null,function*(){if(!this.settingsManager.isBarcodeQualityDetectionEnabled())throw new Error("Barcode quality detection is not enabled");const t=this.settingsManager.getOpenAIKey();return this.analysisServices.detectBarcodeQuality(e,t)})}identifyToolType(e){return xe(this,null,function*(){if(!this.settingsManager.isToolTypeRecognitionEnabled())throw new Error("Tool type recognition is not enabled");const t=this.settingsManager.getOpenAIKey();return this.analysisServices.identifyToolType(e,t)})}getCycleOptimization(e){return xe(this,null,function*(){if(!this.settingsManager.isCycleOptimizationEnabled())throw new Error("Cycle optimization is not enabled");const t=this.settingsManager.getOpenAIKey();return this.optimizationServices.getCycleOptimization(e,t)})}getWorkflowSuggestion(e,t){return xe(this,null,function*(){if(!this.settingsManager.isIntelligentWorkflowSelectionEnabled())throw new Error("Intelligent workflow selection is not enabled");const n=this.settingsManager.getOpenAIKey();return this.optimizationServices.getWorkflowSuggestion(e,t,n)})}getPredictiveAnalytics(){return xe(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Predictive analytics is not enabled");const e=this.settingsManager.getOpenAIKey();return this.analyticsServices.getPredictiveAnalytics(e)})}getRealTimeInsights(){return xe(this,null,function*(){if(!this.settingsManager.isRealTimeMonitoringEnabled())throw new Error("Real-time monitoring is not enabled");return this.analyticsServices.getRealTimeInsights()})}getHistoricalTrends(e){return xe(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Predictive analytics is not enabled");return this.analyticsServices.getHistoricalTrends(e)})}exportAnalyticsReport(e,t,n){return xe(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Analytics export is not enabled");return this.analyticsServices.exportAnalyticsReport(e,t,n)})}detectPotentialProblems(e,t){return xe(this,null,function*(){if(!this.settingsManager.isAutomatedProblemDetectionEnabled())throw new Error("Automated problem detection is not enabled");const n=this.settingsManager.getOpenAIKey();return this.analysisServices.detectPotentialProblems(e,t,n)})}analyzeCompliance(e){return xe(this,null,function*(){if(!this.settingsManager.isComplianceMonitoringEnabled())throw new Error("Compliance monitoring is not enabled");const t=this.settingsManager.getOpenAIKey();return this.complianceServices.analyzeCompliance(e,t)})}validateBiologicalIndicators(e){return xe(this,null,function*(){if(!this.settingsManager.isBiologicalIndicatorAnalysisEnabled())throw new Error("Biological indicator analysis is not enabled");const t=this.settingsManager.getOpenAIKey();return this.complianceServices.validateBiologicalIndicators(e,t)})}testChatGPT4Connection(){return xe(this,null,function*(){const e=this.settingsManager.getOpenAIKey();return e?X.testConnection(e):{success:!1,response:"",error:"OpenAI API key not configured"}})}isFeatureEnabled(e){return this.settingsManager.isFeatureEnabled(e)}getCurrentSettings(){return this.settingsManager.getCurrentSettings()}getConfidenceThreshold(){return this.settingsManager.getConfidenceThreshold()}getDataRetentionDays(){return this.settingsManager.getDataRetentionDays()}}var nn={},dt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Jv{constructor(e){this.facilityId=e}processPredictiveCleaningWithAI(){return dt(this,null,function*(){return{predicted_cleaning_date:new Date(Date.now()+2880*60*1e3).toISOString(),confidence_score:.85,urgency_level:"medium",cleaning_type:"routine",estimated_duration:45,required_resources:["cleaning_supplies","staff_2","equipment_standard"],risk_factors:["high_traffic_area","recent_contamination"],optimization_suggestions:["Schedule during low-traffic hours","Use eco-friendly cleaning products","Implement double-cleaning for high-risk areas"]}})}processContaminationPredictionWithAI(){return dt(this,null,function*(){return{contamination_probability:.25,predicted_contamination_type:"bacterial",risk_factors:["high_occupancy","inadequate_ventilation","recent_illness"],prevention_measures:["Increase cleaning frequency","Improve ventilation","Implement additional disinfection protocols"],early_warning_signs:["Increased moisture levels","Unusual odors","Staff illness reports"],confidence_score:.78}})}processResourceOptimizationWithAI(){return dt(this,null,function*(){return{current_usage:{cleaning_supplies:100,staff_hours:40,equipment_usage:8,water_usage:200,energy_consumption:150},optimized_usage:{cleaning_supplies:85,staff_hours:35,equipment_usage:7,water_usage:180,energy_consumption:135},savings_percentage:15,cost_savings:2500,efficiency_improvement:20,recommended_actions:["Implement smart scheduling to reduce staff hours","Use concentrated cleaning products to reduce supply usage","Optimize equipment usage patterns","Install water-efficient cleaning systems"],implementation_timeline:"2-4 weeks",risk_assessment:"low",confidence_score:.82}})}processSmartSchedulingWithAI(){return dt(this,null,function*(){return{optimal_cleaning_time:"2024-09-04T14:00:00Z",staff_recommendations:["experienced_cleaner_1","trainee_cleaner_2"],resource_requirements:["standard_cleaning_kit","disinfection_spray","mop_bucket"],conflict_avoidance:["Avoid patient visiting hours","Schedule around maintenance windows","Coordinate with other departments"],efficiency_score:.88,cost_optimization:.75,quality_assurance:["Pre-cleaning inspection","Post-cleaning verification","Quality checklist completion"],confidence_score:.85}})}processRiskAssessmentWithAI(){return dt(this,null,function*(){return{overall_risk_score:.35,risk_categories:{contamination:.4,compliance:.2,safety:.3,efficiency:.5},risk_factors:["High-traffic areas with increased contamination risk","Aging equipment requiring maintenance","Staff training gaps in new protocols","Inconsistent cleaning schedules"],mitigation_strategies:["Implement enhanced cleaning protocols for high-risk areas","Schedule preventive maintenance for aging equipment","Provide additional staff training on new protocols","Standardize cleaning schedules across all areas"],priority_actions:["Immediate: Schedule equipment maintenance","Short-term: Implement enhanced cleaning protocols","Medium-term: Comprehensive staff training program"],confidence_score:.79}})}processTrendAnalysisWithAI(){return dt(this,null,function*(){return{analysis_type:"cleaning_efficiency",trend_direction:"improving",trend_strength:.7,key_insights:["Cleaning efficiency has improved 15% over the past quarter","Resource usage optimization is showing positive results","Quality scores are consistently above target thresholds"],contributing_factors:["Implementation of new cleaning protocols","Staff training improvements","Better scheduling optimization","Upgraded cleaning equipment"],recommendations:["Continue current optimization strategies","Expand successful protocols to other areas","Monitor for potential plateau effects","Consider additional technology investments"],confidence_score:.84}})}processAnomalyDetectionWithAI(){return dt(this,null,function*(){return{anomaly_type:"resource_spike",severity:"medium",description:"Unusual increase in cleaning supply usage detected in Room 204",detected_at:new Date().toISOString(),normal_range:{daily_usage:"10-15 units",weekly_usage:"70-105 units"},actual_value:{daily_usage:"25 units",weekly_usage:"175 units"},potential_causes:["Increased contamination requiring additional cleaning","Equipment malfunction causing waste","Staff training issue with proper usage","Room usage pattern changes"],recommended_actions:["Investigate room conditions and usage patterns","Check equipment functionality","Review staff training records","Implement usage monitoring for this area"],confidence_score:.76}})}processQualityAssuranceWithAI(){return dt(this,null,function*(){return{quality_score:.87,quality_metrics:{cleanliness:.92,compliance:.85,efficiency:.88,safety:.9},quality_trends:{cleanliness_trend:"improving",compliance_trend:"stable",efficiency_trend:"improving",safety_trend:"stable"},improvement_areas:["Documentation completeness","Staff training consistency","Equipment maintenance scheduling"],best_practices:["Standardized cleaning protocols","Regular quality inspections","Staff feedback integration","Continuous improvement processes"],compliance_status:"compliant",audit_recommendations:["Maintain current quality standards","Focus on documentation improvements","Schedule regular compliance reviews","Implement additional quality checkpoints"],confidence_score:.83}})}buildPredictiveCleaningPrompt(e,t){return`Analyze the following room and historical cleaning data:
    Room Data: ${e}
    Historical Data: ${t}
    
    Please provide:
    1. Predicted optimal cleaning date
    2. Confidence score for prediction
    3. Urgency level assessment
    4. Recommended cleaning type
    5. Estimated duration
    6. Required resources
    7. Risk factors to consider
    8. Optimization suggestions`}buildContaminationPredictionPrompt(e,t){return`Analyze contamination risk based on:
    Room Data: ${e}
    Environmental Data: ${t}
    
    Please provide:
    1. Contamination probability score
    2. Predicted contamination type
    3. Risk factors identified
    4. Prevention measures
    5. Early warning signs to monitor
    6. Confidence score for prediction`}buildResourceOptimizationPrompt(e,t){return`Optimize resource usage based on:
    Current Usage: ${e}
    Cost Data: ${t}
    
    Please provide:
    1. Current vs optimized usage comparison
    2. Savings percentage and cost reduction
    3. Efficiency improvement metrics
    4. Recommended actions
    5. Implementation timeline
    6. Risk assessment
    7. Confidence score for optimization`}buildSmartSchedulingPrompt(e,t,n){return`Create optimal cleaning schedule based on:
    Room Data: ${e}
    Staff Availability: ${t}
    Constraints: ${n}
    
    Please provide:
    1. Optimal cleaning time
    2. Staff recommendations
    3. Resource requirements
    4. Conflict avoidance strategies
    5. Efficiency and cost optimization scores
    6. Quality assurance measures
    7. Confidence score for scheduling`}executeWithRetry(e,t=3,n=100){return dt(this,null,function*(){const{OptimizedRetryService:a}=yield H(()=>import("./login-BkZ1x_Cy.js").then(i=>i.ac),__vite__mapDeps([1,2,3,4,5]));return yield a.executeWithRetry(e,{maxRetries:t,baseDelay:n,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return dt(this,null,function*(){const n=new Promise((a,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,n])})}selectModelForTask(e){switch(e){case"predictive_cleaning":return"gpt-4";case"contamination_prediction":return"gpt-4";case"resource_optimization":return"gpt-4";case"smart_scheduling":return"gpt-4";case"risk_assessment":return"gpt-4";case"trend_analysis":return"gpt-4";case"anomaly_detection":return"gpt-4";case"quality_assurance":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:nn.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:nn.GOOGLE_AI_API_BASE_URL||"https://generativelanguage.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro"},azure:{baseUrl:nn.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:nn.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}}var va=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Xv{constructor(e){this.facilityId=e}getEnvironmentalInsights(){return va(this,null,function*(){try{return[]}catch(e){return console.error("Error getting environmental insights:",e),[]}})}getHistoricalCleaningData(){return va(this,null,function*(){try{const{data:e}=yield _.from("environmental_cleans_enhanced").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(30);return e?e.map(t=>({date:t.created_at,room_id:t.room_id,cleaning_type:t.cleaning_type||"routine",duration:this.calculateDuration(t.started_time,t.completed_time),quality_score:t.quality_score||.8,resources_used:{cleaning_supplies:5,staff_hours:1,equipment_usage:1,water_usage:20,energy_consumption:10}})):[]}catch(e){return console.error("Error getting historical cleaning data:",e),[]}})}calculateDuration(e,t){if(!e||!t)return 30;const n=new Date(e),i=new Date(t).getTime()-n.getTime();return Math.max(Math.floor(i/(1e3*60)),1)}getEnvironmentalCleaningCostData(){return va(this,null,function*(){try{return{staff_costs:12e3,supply_costs:3e3,equipment_costs:2e3,utility_costs:1500,total_cost:18500}}catch(e){return console.error("Error getting environmental cleaning cost data:",e),{staff_costs:12e3,supply_costs:3e3,equipment_costs:2e3,utility_costs:1500,total_cost:18500}}})}calculateCleaningEfficiency(e,t,n){const a=this.calculateResourceUsageFactor(n),i=e/(t*a);return Math.min(i,1)}calculateResourceUsageFactor(e){const t=e.staff_hours||1,n=e.cleaning_supplies||1,a=e.equipment_usage||1;return(t*.4+n*.3+a*.3)/10}calculateContaminationRisk(e,t,n,a){const i=(Date.now()-new Date(n).getTime())/864e5;let c=.1;c+={operating_room:.3,icu:.25,patient_room:.15,common_area:.1,storage:.05}[e]||.1,c+=t*.2,i>7?c+=.3:i>3&&(c+=.15);const o=a.humidity||50,d=a.temperature||20;return o>70&&(c+=.1),d>25&&(c+=.05),Math.min(c,1)}calculateCostSavings(e,t){const n=e-t,a=n/e*100;return{savings:n,percentage:a}}calculateQualityTrend(e){if(e.length<2)return"stable";const t=e.slice(0,Math.ceil(e.length/2)),n=e.slice(Math.ceil(e.length/2)),a=t.reduce((l,o)=>l+o,0)/t.length,i=n.reduce((l,o)=>l+o,0)/n.length,c=a-i;return c>.05?"improving":c<-.05?"declining":"stable"}calculateResourceEfficiency(e,t){const n=Object.values(e).reduce((i,c)=>i+c,0),a=Object.values(t).reduce((i,c)=>i+c,0);return n===0?0:(n-a)/n*100}detectAnomalies(e,t=2){if(e.length<3)return[];const n=e.reduce((c,l)=>c+l,0)/e.length,a=e.reduce((c,l)=>c+Math.pow(l-n,2),0)/e.length,i=Math.sqrt(a);return e.map((c,l)=>({index:l,value:c,deviation:Math.abs(c-n)/i})).filter(c=>c.deviation>t)}getPriorityFromUrgency(e){switch(e){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low";default:return"medium"}}getPriorityFromProbability(e){return e>=.8?"critical":e>=.6?"high":e>=.4?"medium":"low"}getPriorityFromSavings(e){return e>=30?"critical":e>=20?"high":e>=10?"medium":"low"}getPriorityFromSeverity(e){switch(e){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low";default:return"medium"}}}var Ie=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Zv{constructor(e){this.facilityId=e,this.providerService=new Jv(e),this.analyticsService=new Xv(e)}initialize(){return Ie(this,null,function*(){try{return(yield this.loadSettings())!==null}catch(e){return console.error(e),console.error("Failed to initialize EnvironmentalAIService"),!1}})}loadSettings(){return Ie(this,null,function*(){return null})}saveSettings(e){return Ie(this,null,function*(){return!1})}initializeSettings(){return Ie(this,null,function*(){return!1})}generatePredictiveCleaning(e){return Ie(this,null,function*(){return null})}predictContamination(e){return Ie(this,null,function*(){return null})}optimizeResources(e){return Ie(this,null,function*(){return null})}generateSmartSchedule(e){return Ie(this,null,function*(){return null})}assessRisk(e){return Ie(this,null,function*(){return null})}analyzeTrends(e){return Ie(this,null,function*(){return null})}detectAnomalies(e){return Ie(this,null,function*(){return null})}assessQuality(e){return Ie(this,null,function*(){return null})}getEnvironmentalInsights(){return Ie(this,null,function*(){return this.analyticsService.getEnvironmentalInsights()})}getHistoricalCleaningData(){return Ie(this,null,function*(){try{const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(100);return t?(console.error("Error getting historical cleaning data:",t),[]):(e==null?void 0:e.map(a=>({id:a.id,facility_id:a.facility_id,room_id:a.room_id,room_name:a.room_name,cleaning_type:a.cleaning_type,status:a.status,started_time:a.started_time,completed_time:a.completed_time,created_at:a.created_at,updated_at:a.updated_at})))||[]}catch(e){return console.error("Error getting historical cleaning data:",e),[]}})}getRoomData(e){return Ie(this,null,function*(){var t,n,a,i,c,l,o,d;try{const{data:u,error:h}=yield _.from("environmental_cleans_enhanced").select("*").eq("id",e).eq("facility_id",this.facilityId).single();if(h)return console.error("Error getting room data:",h),null;const p=u;return{id:p.id,room_id:p.id,room_name:(t=p.room_name)!=null?t:"Unknown Room",room_type:(n=p.room_type)!=null?n:"unknown",last_cleaned:(a=p.last_cleaned)!=null?a:new Date().toISOString(),cleaning_frequency:(i=p.cleaning_frequency)!=null?i:1,priority_level:(c=p.priority_level)!=null?c:"medium",contamination_risk:(l=p.contamination_risk)!=null?l:.5,usage_pattern:(o=p.usage_pattern)!=null?o:{},maintenance_status:(d=p.maintenance_status)!=null?d:"good"}}catch(u){return console.error("Error getting room data:",u),null}})}isFeatureEnabled(e,t){return this.getNestedProperty(e,t)===!0}getNestedProperty(e,t){return t.split(".").reduce((n,a)=>n==null?void 0:n[a],e)}}var be=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class zs{static askAI(e,t){return be(this,null,function*(){return am({prompt:e,context:t})})}static executeOptimizedAI(e,t,n){return be(this,null,function*(){return or.getInstance().execute(e,t,n)})}static getLearningAI(e){return this.learningAIInstance||(this.learningAIInstance=new J0(e)),this.learningAIInstance}static getLearningRecommendations(e,t){return be(this,null,function*(){return this.getLearningAI(e).generatePersonalizedRecommendations(t)})}static analyzeSkillGaps(e,t){return be(this,null,function*(){return this.getLearningAI(e).analyzeSkillGaps(t)})}static optimizeLearningPath(e,t){return be(this,null,function*(){return this.getLearningAI(e).optimizeLearningPath(t)})}static getInventoryAI(e){return this.inventoryAIInstance||(this.inventoryAIInstance=new Tv(e)),this.inventoryAIInstance}static analyzeBarcode(e,t){return be(this,null,function*(){return this.getInventoryAI(e).analyzeBarcode(t)})}static performImageRecognition(e,t){return be(this,null,function*(){return this.getInventoryAI(e).analyzeImage(t)})}static generateDemandForecast(e,t,n){return be(this,null,function*(){return this.getInventoryAI(e).generateDemandForecast(t,n)})}static generateCostOptimization(e,t){return be(this,null,function*(){return this.getInventoryAI(e).generateCostOptimization(t)})}static getSterilizationAI(e){return this.sterilizationAIInstance||(this.sterilizationAIInstance=new Yv(e)),this.sterilizationAIInstance}static getSterilizationInsights(e){return be(this,null,function*(){return this.getSterilizationAI(e).getRealTimeInsights()})}static getSterilizationPredictiveAnalytics(e){return be(this,null,function*(){return this.getSterilizationAI(e).getPredictiveAnalytics()})}static getSterilizationRealTimeInsights(e){return be(this,null,function*(){return this.getSterilizationAI(e).getRealTimeInsights()})}static getSterilizationHistoricalTrends(e,t){return be(this,null,function*(){return this.getSterilizationAI(e).getHistoricalTrends(t)})}static getEnvironmentalAI(e){return this.environmentalAIInstance||(this.environmentalAIInstance=new Zv(e)),this.environmentalAIInstance}static analyzeEnvironmentalData(e,t){return be(this,null,function*(){return this.getEnvironmentalAI(e).generatePredictiveCleaning(t)})}static generateEnvironmentalInsights(e){return be(this,null,function*(){return this.getEnvironmentalAI(e).getEnvironmentalInsights()})}static initializeServices(e){return be(this,null,function*(){try{yield this.getLearningAI(e).initialize(),yield this.getInventoryAI(e).initializeSettings(),yield this.getEnvironmentalAI(e).initialize(),console.log(`[UnifiedAIService] All AI services initialized for facility: ${e}`)}catch(t){throw console.error("[UnifiedAIService] Failed to initialize AI services:",t),t}})}static getServiceStatus(){return{learningAI:!!this.learningAIInstance,inventoryAI:!!this.inventoryAIInstance,sterilizationAI:!!this.sterilizationAIInstance,environmentalAI:!!this.environmentalAIInstance}}static clearInstances(){this.learningAIInstance=null,this.inventoryAIInstance=null,this.sterilizationAIInstance=null,this.environmentalAIInstance=null}}zs.learningAIInstance=null;zs.inventoryAIInstance=null;zs.sterilizationAIInstance=null;zs.environmentalAIInstance=null;const ex=()=>({checkQuestionRelevance:(t,n)=>{const a=t.toLowerCase();if(n==="sterilization")return["sterilization","sterilize","autoclave","bi","biological indicator","csa","z314","steam","cycle","load","packaging","maintenance","cleaning","validation","monitoring","temperature","pressure","exposure","drying","cooling","documentation","traceability"].some(c=>a.includes(c));if(n==="inventory")return["inventory","stock","supply","order","purchase","tracking","expiry","lot","serial","barcode","scan","count","reorder"].some(c=>a.includes(c));if(n==="environmental-clean")return["cleaning","disinfection","environmental","infection control","protocol","procedure","schedule","checklist","compliance"].some(c=>a.includes(c));if(n==="home"){const i=["dashboard","home","overview","summary","metrics","stats","performance","tasks","gamification","points","level","streak","leaderboard","challenge","navigation","menu","help","assistant","cliniio","general","status","welcome","getting started","tutorial","onboarding"];return["settings","configuration","admin","setup","sterilization","autoclave","inventory","stock","cleaning","disinfection","password","login","access","account","user","permission","report","analytics","data","export","training","course","learning","education"].some(l=>a.includes(l))?!1:i.some(l=>a.includes(l))}return!0},getRedirectMessage:(t,n)=>{const a=n.toLowerCase();return t==="sterilization"?a.includes("inventory")||a.includes("stock")||a.includes("supply")?"That's an inventory question! Please go to the Inventory page or ask your manager for inventory-related help.":a.includes("cleaning")&&!a.includes("autoclave")&&!a.includes("sterilization")?"For general cleaning questions, try the Environmental Clean page or ask your manager.":a.includes("password")||a.includes("login")||a.includes("system")?"For system access issues, try Cliniio Help or contact your manager.":"That question isn't related to sterilization. Try the Relevant Information section above for standards and protocols, or ask your manager for other topics.":t==="inventory"?a.includes("sterilization")||a.includes("autoclave")?"That's a sterilization question! Please go to the Sterilization page or ask your manager for sterilization-related help.":"That question isn't related to inventory. Try the Relevant Information section above, or ask your manager for other topics.":t==="environmental-clean"?a.includes("sterilization")||a.includes("autoclave")?"For sterilization questions, try the Sterilization page or ask your manager.":"That question isn't related to environmental cleaning. Try the Relevant Information section above, or ask your manager for other topics.":t==="home"?a.includes("sterilization")||a.includes("autoclave")||a.includes("bi")||a.includes("biological indicator")?"That's a sterilization question! Please go to the Sterilization page for specialized help, or contact your clinic administrator for detailed guidance.":a.includes("inventory")||a.includes("stock")||a.includes("supply")||a.includes("order")||a.includes("purchase")?"That's an inventory question! Please go to the Inventory page for specialized help, or contact your clinic administrator for detailed guidance.":a.includes("cleaning")||a.includes("disinfection")||a.includes("environmental")?"That's an environmental cleaning question! Please go to the Environmental Clean page for specialized help, or contact your clinic administrator for detailed guidance.":a.includes("password")||a.includes("login")||a.includes("access")||a.includes("account")||a.includes("user")||a.includes("permission")?"For system access issues, please contact your clinic administrator or IT support. They can help with login problems, password resets, and account permissions.":a.includes("settings")||a.includes("configuration")||a.includes("admin")||a.includes("setup")?"For system settings and configuration questions, please contact your clinic administrator. They have access to the necessary administrative functions.":a.includes("report")||a.includes("analytics")||a.includes("data")||a.includes("export")?"For detailed reports and analytics, please go to the Analytics page or contact your clinic administrator for comprehensive data analysis.":a.includes("training")||a.includes("course")||a.includes("learning")||a.includes("education")?"For training and learning resources, please go to the Learning Hub or contact your clinic administrator for educational materials and courses.":"I can only help with general dashboard questions here. For specialized topics like sterilization, inventory, cleaning, or system administration, please go to the appropriate page or contact your clinic administrator for detailed assistance.":"That question isn't related to your current page. Try the Relevant Information section above, or ask your manager for other topics."}});var tx=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const rx=({currentContext:r,onBack:e})=>{const[t,n]=m.useState([{role:"assistant",content:"Hello! I'm your Cliniio AI assistant. How can I help you today?"}]),[a,i]=m.useState(""),[c,l]=m.useState(!1),{checkQuestionRelevance:o,getRedirectMessage:d}=ex(),u=()=>tx(null,null,function*(){if(!a.trim()||c)return;const p=a.trim();if(i(""),n(g=>[...g,{role:"user",content:p}]),l(!0),!o(p,r)){const g=d(r,p);n(y=>[...y,{role:"assistant",content:g}]),l(!1);return}try{const g=yield zs.askAI(p,`User is on ${r} page and asking for help. Only answer questions related to ${r}.`);n(y=>[...y,{role:"assistant",content:g}])}catch(g){console.error(g),n(y=>[...y,{role:"assistant",content:"Sorry, I encountered an error. Please try again."}])}finally{l(!1)}}),h=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u())};return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"AI Assistant"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Ask me anything about Cliniio"})]})]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 scrollbar-hide",children:[t.map((p,f)=>s.jsx("div",{className:`flex ${p.role==="user"?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`max-w-xs px-4 py-2 rounded-lg ${p.role==="user"?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-800"}`,children:s.jsx("p",{className:"text-sm",children:p.content})})},f)),c&&s.jsx("div",{className:"flex justify-start",children:s.jsx("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),s.jsx("div",{className:"border-t border-gray-200 p-4 bg-white",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("input",{type:"text",value:a,onChange:p=>i(p.target.value),onKeyPress:h,placeholder:"Ask me anything...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",disabled:c}),s.jsx("button",{onClick:u,disabled:!a.trim()||c,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:s.jsx("span",{className:"text-sm",children:"Send"})})]})})]})};var os=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class sx{getArticlesByCategory(e){return os(this,null,function*(){try{const{data:t,error:n}=yield _.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count").eq("category",e).eq("is_published",!0).order("priority",{ascending:!0}).order("created_at",{ascending:!1});return n?(console.error("Error fetching help articles:",n),[]):t||[]}catch(t){return console.error("Error fetching help articles:",t),[]}})}getArticleBySlug(e){return os(this,null,function*(){try{const{data:t,error:n}=yield _.from("help_articles").select("*").eq("slug",e).eq("is_published",!0).single();return n?(console.error("Error fetching help article:",n),null):t}catch(t){return console.error("Error fetching help article:",t),null}})}incrementViewCount(e){return os(this,null,function*(){try{const{data:t}=yield _.from("help_articles").select("view_count").eq("slug",e).single();t&&(yield _.from("help_articles").update({view_count:t.view_count+1,last_viewed_at:new Date().toISOString()}).eq("slug",e))}catch(t){console.error("Error incrementing view count:",t)}})}getFeaturedArticles(e=3){return os(this,null,function*(){try{const{data:t,error:n}=yield _.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count").eq("is_published",!0).eq("is_featured",!0).order("priority",{ascending:!0}).order("view_count",{ascending:!1}).limit(e);return n?(console.error("Error fetching featured articles:",n),[]):t||[]}catch(t){return console.error("Error fetching featured articles:",t),[]}})}searchArticles(e,t){return os(this,null,function*(){try{let n=_.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count").eq("is_published",!0).or(`title.ilike.%${e}%,excerpt.ilike.%${e}%`);t&&(n=n.eq("category",t));const{data:a,error:i}=yield n.order("priority",{ascending:!0}).order("view_count",{ascending:!1});return i?(console.error("Error searching help articles:",i),[]):a||[]}catch(n){return console.error("Error searching help articles:",n),[]}})}}const Kn=new sx;var nx=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ax=({currentContext:r,expandedRelevant:e,onToggleRelevantSection:t,onBack:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{nx(null,null,function*(){try{console.log("ðŸ” Loading relevant information articles...");const p=yield Kn.getArticlesByCategory("relevant-information");console.log("ðŸ“‹ Found articles:",p),i(p)}catch(p){console.error("Error loading relevant information articles:",p)}finally{l(!1)}})},[]);const o=h=>{window.open(`/help/article/${h}`,"_blank")},d=[{id:"canadian-standards",title:"ðŸ‡¨ðŸ‡¦ Canadian Standards",color:"blue",content:s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"â€¢ CSA Z314.2-19 - Decontamination of Reusable Medical Devices"}),s.jsx("li",{children:"â€¢ CSA Z314.3-19 - Steam Sterilization in Health Care Facilities"}),s.jsx("li",{children:"â€¢ Health Canada SOR/98-282 - Medical Device Regulations"}),s.jsx("li",{children:"â€¢ Public Health Agency of Canada - Routine Practices and Additional Precautions"}),s.jsx("li",{children:"â€¢ Ontario Health - Infection Prevention and Control Guidelines"}),s.jsx("li",{children:"â€¢ BC Centre for Disease Control - Healthcare-Associated Infection Prevention"}),s.jsx("li",{children:"â€¢ Alberta Health Services - Sterilization and Reprocessing Standards"}),s.jsx("li",{children:"â€¢ Quebec Health - Hygiene Practices in Healthcare Facilities"})]})},{id:"us-standards",title:"ðŸ‡ºðŸ‡¸ US Standards",color:"green",content:s.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[s.jsx("li",{children:"â€¢ AAMI ST79:2017 - Comprehensive Guide to Steam Sterilization"}),s.jsx("li",{children:"â€¢ AAMI ST91:2021 - Flexible Endoscope Reprocessing"}),s.jsx("li",{children:"â€¢ CDC Guidelines - Disinfection and Sterilization in Healthcare Facilities"}),s.jsx("li",{children:"â€¢ FDA Regulations - Medical Device Reprocessing Standards"}),s.jsx("li",{children:"â€¢ Joint Commission - Healthcare Accreditation Standards"}),s.jsx("li",{children:"â€¢ OSHA Guidelines - Workplace Safety and Chemical Handling"}),s.jsx("li",{children:"â€¢ ANSI/AAMI Standards - Sterilization Validation and Monitoring"})]})},{id:"international-standards",title:"ðŸŒ International Standards",color:"purple",content:s.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[s.jsx("li",{children:"â€¢ ISO 15883 - Washer-disinfectors"}),s.jsx("li",{children:"â€¢ ISO 17665 - Steam sterilization"}),s.jsx("li",{children:"â€¢ ISO 13485 - Medical Device Quality Management"}),s.jsx("li",{children:"â€¢ ISO 9001 - Quality Management Systems"}),s.jsx("li",{children:"â€¢ WHO Guidelines - Infection Prevention and Control"}),s.jsx("li",{children:"â€¢ ASTM Standards - Material Testing and Validation"}),s.jsx("li",{children:"â€¢ IAC Standards - Infection Prevention and Control"}),s.jsx("li",{children:"â€¢ APIC Guidelines - Healthcare-Associated Infection Prevention"})]})}],u=h=>{const p=e.has(h.id),g={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[h.color];return s.jsxs("div",{className:`${g.bg} ${g.border} border rounded-lg overflow-hidden`,children:[s.jsxs("button",{onClick:()=>t(h.id),className:`w-full p-3 text-left flex items-center justify-between ${g.hover} transition-colors`,children:[s.jsx("h5",{className:`font-medium ${g.text}`,children:h.title}),s.jsx("span",{className:`${g.icon} text-lg transition-transform duration-200`,children:p?"âˆ’":"+"})]}),p&&s.jsxs("div",{className:"px-3 pb-3",children:[h.content,h.slug&&s.jsx("div",{className:"mt-3",children:s.jsxs("button",{onClick:()=>o(h.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[s.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},h.id)};if(r==="home"||r==="general"){if(c)return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about standards and compliance.'})})})):d;return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),s.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Standards and compliance reference"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Comprehensive Standards Reference"}),h.map(u)]})})]})}return r==="sterilization"?s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"BI Testing"}),s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Biological indicator testing protocols"}),s.jsx("li",{children:"â€¢ Testing frequency requirements"}),s.jsx("li",{children:"â€¢ Result interpretation and documentation"}),s.jsx("li",{children:"â€¢ Quality assurance procedures"})]})]}),s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Sterilization Workflow"}),s.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Pre-cleaning and inspection protocols"}),s.jsx("li",{children:"â€¢ Proper packaging and loading techniques"}),s.jsx("li",{children:"â€¢ Sterilization cycle parameters"}),s.jsx("li",{children:"â€¢ Post-sterilization handling procedures"})]})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Reporting and Compliance"}),s.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Documentation requirements"}),s.jsx("li",{children:"â€¢ Regulatory compliance standards"}),s.jsx("li",{children:"â€¢ Audit preparation and procedures"}),s.jsx("li",{children:"â€¢ Quality management systems"})]})]})]})]}):s.jsx("div",{className:"text-center text-gray-500 py-8",children:s.jsx("p",{children:"General information and standards will be displayed here based on your current page."})})};var Ol=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ix={submitFeedback(r){return Ol(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return{success:!1,error:"User not authenticated"};const{error:t}=yield _.from("product_feedback").insert([{type:r.type,title:r.title,description:r.description,priority:r.priority,user_id:e.id,contact_email:r.email,page_url:window.location.href,user_agent:navigator.userAgent,browser_info:{language:navigator.language,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled}}]);return t?(console.error("Error submitting feedback:",t),{success:!1,error:t.message}):{success:!0}}catch(e){return console.error("Error submitting feedback:",e),{success:!1,error:e instanceof Error?e.message:"An unknown error occurred"}}})},getFeedbackHistory(){return Ol(this,null,function*(){try{const{data:{user:r}}=yield _.auth.getUser();if(!r)return{data:[],error:"User not authenticated"};const{data:e,error:t}=yield _.from("product_feedback").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});return t?(console.error("Error fetching feedback history:",t),{data:[],error:t.message}):{data:e||[]}}catch(r){return console.error("Error fetching feedback history:",r),{data:[],error:"Failed to fetch feedback history"}}})}};var ox=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const lx=()=>{const[r,e]=m.useState(""),[t,n]=m.useState(""),[a,i]=m.useState(""),[c,l]=m.useState("medium"),[o,d]=m.useState(""),[u,h]=m.useState(!1);return{feedbackType:r,setFeedbackType:e,feedbackTitle:t,setFeedbackTitle:n,feedbackDescription:a,setFeedbackDescription:i,feedbackPriority:c,setFeedbackPriority:l,feedbackEmail:o,setFeedbackEmail:d,isSubmittingFeedback:u,handleFeedbackSubmit:g=>ox(null,null,function*(){g.preventDefault(),h(!0);try{const y={type:r,title:t,description:a,priority:c,email:o},v=yield ix.submitFeedback(y);return v.success?(e(""),n(""),i(""),l("medium"),d(""),alert("Thank you for your feedback! We'll review it and get back to you if needed."),!0):(console.error("Error submitting feedback:",v.error),alert("There was an error submitting your feedback. Please try again."),!1)}catch(y){return console.error("Error submitting feedback:",y),alert("There was an error submitting your feedback. Please try again."),!1}finally{h(!1)}}),resetFeedbackForm:()=>{e(""),n(""),i(""),l("medium"),d("")}}};var cx=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const dx=({onBack:r,onSuccess:e})=>{const{feedbackType:t,setFeedbackType:n,feedbackTitle:a,setFeedbackTitle:i,feedbackDescription:c,setFeedbackDescription:l,feedbackPriority:o,setFeedbackPriority:d,feedbackEmail:u,setFeedbackEmail:h,isSubmittingFeedback:p,handleFeedbackSubmit:f}=lx(),g=y=>cx(null,null,function*(){(yield f(y))&&e()});return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Product Feedback"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Help us improve Cliniio"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:s.jsx("span",{className:"text-white text-2xl",children:"ðŸ’¡"})}),s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Share Your Feedback"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Help us make Cliniio better for everyone"})]}),s.jsxs("form",{onSubmit:g,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"feedbackType",className:"block text-sm font-medium text-gray-700 mb-2",children:"Feedback Type *"}),s.jsxs("select",{id:"feedbackType",value:t,onChange:y=>n(y.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0,children:[s.jsx("option",{value:"",children:"Select feedback type"}),s.jsx("option",{value:"bug",children:"Bug Report"}),s.jsx("option",{value:"feature",children:"Feature Request"}),s.jsx("option",{value:"improvement",children:"Improvement Suggestion"}),s.jsx("option",{value:"other",children:"Other"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"feedbackTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),s.jsx("input",{id:"feedbackTitle",type:"text",value:a,onChange:y=>i(y.target.value),placeholder:"Brief description of your feedback",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"feedbackDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),s.jsx("textarea",{id:"feedbackDescription",value:c,onChange:y=>l(y.target.value),placeholder:"Please provide detailed information...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"feedbackPriority",className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),s.jsxs("select",{id:"feedbackPriority",value:o,onChange:y=>d(y.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[s.jsx("option",{value:"low",children:"Low"}),s.jsx("option",{value:"medium",children:"Medium"}),s.jsx("option",{value:"high",children:"High"}),s.jsx("option",{value:"critical",children:"Critical"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"feedbackEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email (optional)"}),s.jsx("input",{id:"feedbackEmail",type:"email",value:u,onChange:y=>h(y.target.value),placeholder:"your.email@facility.com",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"We'll only use this to follow up on your feedback"})]}),s.jsx("button",{type:"submit",disabled:p,className:"w-full bg-[#4ECDC4] text-white py-3 px-4 rounded-lg hover:bg-[#4ECDC4]/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:p?"Submitting...":"Submit Feedback"})]})]})})]})},ux=({onBack:r})=>{const[e,t]=m.useState(new Set([0])),[n,a]=m.useState(null),i=l=>{t(o=>{const d=new Set(o);return d.has(l)?(d.delete(l),n===l&&a(null)):(d.add(l),a(l)),d})},c=()=>{a(null)};return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Onboarding Tour"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Step-by-step guide to using the Home page"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:s.jsx("span",{className:"text-white text-2xl",children:"ðŸŽ¯"})}),s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Welcome to Cliniio!"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Let's take a quick tour of your Home page"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>i(0),className:"w-full p-4 text-left flex items-center justify-between hover:bg-blue-100 transition-colors",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"1"}),s.jsx("h5",{className:"font-medium text-blue-800",children:"Daily Tasks & Progress"})]}),s.jsx("span",{className:"text-blue-600 text-lg transition-transform duration-200",children:e.has(0)?"âˆ’":"+"})]}),e.has(0)&&s.jsxs("div",{className:"px-4 pb-4",children:[s.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"The main area shows your daily tasks and responsibilities. Each task card displays what needs to be done and your progress."}),s.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3 text-xs text-blue-600",children:[s.jsx("strong",{children:"Try it:"})," Look for task cards with checkboxes. Click on a checkbox to mark a task as complete and earn points!"]}),s.jsxs("button",{onClick:()=>a(n===0?null:0),className:"mt-3 w-full bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600 transition-colors",children:["ðŸŽ¯"," ",n===0?"Hide arrow":"Show me where this is"]})]})]}),s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>i(1),className:"w-full p-4 text-left flex items-center justify-between hover:bg-green-100 transition-colors",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"2"}),s.jsx("h5",{className:"font-medium text-green-800",children:"Quick Action Buttons"})]}),s.jsx("span",{className:"text-green-600 text-lg transition-transform duration-200",children:e.has(1)?"âˆ’":"+"})]}),e.has(1)&&s.jsxs("div",{className:"px-4 pb-4",children:[s.jsx("p",{className:"text-sm text-green-700 mb-3",children:"At the top of your Home page, you'll find quick access buttons for important features and your performance stats."}),s.jsxs("div",{className:"bg-white border border-green-200 rounded p-3 text-xs text-green-600",children:[s.jsx("strong",{children:"Try it:"}),' Click on the purple "Stats" button to see your performance metrics, or the amber "Leaderboard" to check your ranking.']}),s.jsxs("button",{onClick:()=>a(n===1?null:1),className:"mt-3 w-full bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 transition-colors",children:["ðŸŽ¯"," ",n===1?"Hide arrow":"Show me where this is"]})]})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>i(2),className:"w-full p-4 text-left flex items-center justify-between hover:bg-purple-100 transition-colors",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"3"}),s.jsx("h5",{className:"font-medium text-purple-800",children:"Gamification & Points"})]}),s.jsx("span",{className:"text-purple-600 text-lg transition-transform duration-200",children:e.has(2)?"âˆ’":"+"})]}),e.has(2)&&s.jsxs("div",{className:"px-4 pb-4",children:[s.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Notice the points and progress indicators? Cliniio makes work fun by rewarding your achievements and tracking your progress."}),s.jsxs("div",{className:"bg-white border border-purple-500 rounded p-3 text-xs text-purple-600",children:[s.jsx("strong",{children:"Try it:"})," Complete a task and watch your points increase. Check your progress in the Stats section to see your growth."]}),s.jsxs("button",{onClick:()=>a(n===2?null:2),className:"mt-3 w-full bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600 transition-colors",children:["ðŸŽ¯"," ",n===2?"Hide arrow":"Show me where this is"]})]})]}),s.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>i(3),className:"w-full p-4 text-left flex items-center justify-between hover:bg-amber-100 transition-colors",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"4"}),s.jsx("h5",{className:"font-medium text-amber-800",children:"Performance Metrics"})]}),s.jsx("span",{className:"text-amber-600 text-lg transition-transform duration-200",children:e.has(3)?"âˆ’":"+"})]}),e.has(3)&&s.jsxs("div",{className:"px-4 pb-4",children:[s.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Below your tasks, you'll see cards showing your time savings, cost savings, AI efficiency, and team performance."}),s.jsxs("div",{className:"bg-white border border-amber-200 rounded p-3 text-xs text-amber-600",children:[s.jsx("strong",{children:"Try it:"})," Review your metrics to see how you're performing. These update automatically as you complete tasks."]}),s.jsxs("button",{onClick:()=>a(n===3?null:3),className:"mt-3 w-full bg-amber-500 text-white px-3 py-2 rounded text-sm hover:bg-amber-600 transition-colors",children:["ðŸŽ¯"," ",n===3?"Hide arrow":"Show me where this is"]})]})]}),s.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>i(4),className:"w-full p-4 text-left flex items-center justify-between hover:bg-teal-100 transition-colors",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"5"}),s.jsx("h5",{className:"font-medium text-teal-800",children:"Help & Support"})]}),s.jsx("span",{className:"text-teal-600 text-lg transition-transform duration-200",children:e.has(4)?"âˆ’":"+"})]}),e.has(4)&&s.jsxs("div",{className:"px-4 pb-4",children:[s.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"That floating help button (ðŸ›Ÿ) you used to get here is always available when you need assistance with any feature."}),s.jsxs("div",{className:"bg-white border border-teal-200 rounded p-3 text-xs text-teal-600",children:[s.jsx("strong",{children:"Remember:"})," You can access help from anywhere in Cliniio. Just look for the floating button!"]}),s.jsxs("button",{onClick:()=>a(n===4?null:4),className:"mt-3 w-full bg-teal-500 text-white px-3 py-2 rounded text-sm hover:bg-teal-600 transition-colors",children:["ðŸŽ¯"," ",n===4?"Hide arrow":"Show me where this is"]})]})]})]}),s.jsx("div",{className:"bg-[#4ECDC4] border border-[#4ECDC4] rounded-lg p-4 text-center",children:s.jsxs("div",{className:"text-white",children:[s.jsx("h5",{className:"font-medium text-lg mb-2",children:"ðŸŽ‰ You're All Set!"}),s.jsx("p",{className:"text-sm text-white text-opacity-90 mb-3",children:"You now know the basics of navigating your Home page. Feel free to explore and try things out!"}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-white text-[#4ECDC4] rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Finish Tour"})]})})]})}),n!==null&&s.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[n===0&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"absolute left-1/4 top-1/3 z-50",children:[s.jsx("div",{className:"bg-blue-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ“‹ Daily Tasks"}),s.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-blue-500 ml-4"})]})}),n===1&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"absolute right-1/4 top-20 z-50",children:[s.jsx("div",{className:"bg-green-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"âš¡ Quick Actions"}),s.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-green-500 ml-4"})]})}),n===2&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"absolute left-1/4 top-1/4 z-50",children:[s.jsx("div",{className:"bg-purple-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ† Points & Progress"}),s.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-purple-500 ml-4"})]})}),n===3&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"absolute left-1/4 bottom-1/4 z-50",children:[s.jsx("div",{className:"bg-amber-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ“Š Performance Metrics"}),s.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-amber-500 ml-4"})]})}),n===4&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"absolute bottom-20 right-20 z-50",children:[s.jsx("div",{className:"bg-teal-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ›Ÿ Help Button"}),s.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-teal-500 ml-4"})]})}),s.jsx("button",{onClick:c,className:"absolute top-4 right-4 bg-white text-gray-700 px-3 py-2 rounded-lg shadow-lg pointer-events-auto hover:bg-gray-100 transition-colors border border-gray-200 z-50",children:"âœ• Close"})]})]})},mx=({currentContext:r,onBack:e,onSetHelpType:t})=>s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Cliniio Help"}),s.jsx("p",{className:"text-xs text-gray-500",children:r==="home"?"Help for Home page":"General help and support"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r==="home"?s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Home Page Help"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>t("performance-metrics"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:s.jsx("span",{className:"text-lg",children:"ðŸ“Š"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Performance Metrics"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Understanding your dashboard metrics"})]})]})}),s.jsx("button",{onClick:()=>t("task-management"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:s.jsx("span",{className:"text-lg",children:"âœ…"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Task Management"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Managing daily tasks and workflows"})]})]})}),s.jsx("button",{onClick:()=>t("gamification"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:s.jsx("span",{className:"text-lg",children:"ðŸ†"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Gamification System"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How points, levels, and streaks work"})]})]})}),s.jsx("button",{onClick:()=>t("ai-features"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:s.jsx("span",{className:"text-lg",children:"ðŸ¤–"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"AI Features"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How AI improves your workflow"})]})]})})]})]}):r==="sterilization"?s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>t("bi-testing"),className:"bg-blue-50 border border-blue-200 rounded-lg p-3 w-full text-left hover:bg-blue-100 transition-colors",children:s.jsx("h5",{className:"font-medium text-blue-800",children:"ðŸ§ª BI Testing"})}),s.jsx("button",{onClick:()=>t("sterilization-workflow"),className:"bg-green-50 border border-green-200 rounded-lg p-3 w-full text-left hover:bg-green-100 transition-colors",children:s.jsx("h5",{className:"font-medium text-green-800",children:"âœ‚ï¸ Sterilization Workflow"})}),s.jsx("button",{onClick:()=>t("reporting-compliance"),className:"bg-purple-50 border border-purple-200 rounded-lg p-3 w-full text-left hover:bg-purple-100 transition-colors",children:s.jsx("h5",{className:"font-medium text-purple-800",children:"ðŸ“Š Reporting and Compliance"})})]})]}):s.jsx("div",{className:"text-center text-gray-500 py-8",children:s.jsx("p",{children:"Help content coming soon for this page."})})})]});var hx=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const px=({onBack:r,expandedMetrics:e,onToggleMetricSection:t,onSetHelpType:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{hx(null,null,function*(){try{console.log("ðŸ” Loading performance metrics articles...");const f=yield Kn.getArticlesByCategory("performance-metrics");console.log("ðŸ“Š Found articles:",f),console.log("ðŸ“Š Articles count:",f.length),console.log("ðŸ“Š Articles details:",f.map(g=>({slug:g.slug,title:g.title,published:g.is_published}))),i(f)}catch(f){console.error("âŒ Error loading performance metrics articles:",f)}finally{l(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"time-savings",title:"Time Savings",color:"blue",content:s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Shows hours saved through AI assistance"}),s.jsx("li",{children:"â€¢ Daily and monthly tracking"}),s.jsx("li",{children:"â€¢ Compares AI vs. manual task completion"}),s.jsx("li",{children:"â€¢ Real-time updates as tasks complete"})]})},{id:"cost-savings",title:"Cost Savings",color:"green",content:s.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Calculates dollar impact of AI efficiency"}),s.jsx("li",{children:"â€¢ Includes error prevention and compliance savings"}),s.jsx("li",{children:"â€¢ Uses facility-specific hourly rates"}),s.jsx("li",{children:"â€¢ Projects annual savings with growth factors"})]})},{id:"team-performance",title:"Team Performance",color:"purple",content:s.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Skills: Based on AI task completion rates"}),s.jsx("li",{children:"â€¢ Inventory: Real-time accuracy from actual data"}),s.jsx("li",{children:"â€¢ Sterilization: Performance from cycle data"}),s.jsx("li",{children:"â€¢ Helps identify training needs"})]})}],u=p=>{const f=e.has(p.id),y={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return s.jsxs("div",{className:`${y.bg} ${y.border} border rounded-lg overflow-hidden`,children:[s.jsxs("button",{onClick:()=>t(p.id),className:`w-full p-3 text-left flex items-center justify-between ${y.hover} transition-colors`,children:[s.jsx("h5",{className:`font-medium ${y.text}`,children:p.title}),s.jsx("span",{className:`${y.icon} text-lg transition-transform duration-200`,children:f?"âˆ’":"+"})]}),f&&s.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&s.jsx("div",{className:"mt-3",children:s.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[s.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},p.id)};if(c)return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about this performance metric.'})})})):d;return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),s.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Understanding your dashboard metrics"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Dashboard Metrics Explained"}),h.map(u)]})})]})};var fx=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const gx=({onBack:r,onSetHelpType:e,expandedTasks:t,onToggleTaskSection:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{fx(null,null,function*(){try{console.log("ðŸ” Loading task management articles...");const f=yield Kn.getArticlesByCategory("task-management");console.log("ðŸ“‹ Found articles:",f),i(f)}catch(f){console.error("Error loading task management articles:",f)}finally{l(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"task-categories",title:"ðŸ“‹ Task Categories",color:"blue",content:s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Sterilization: Autoclave cycles and BI tests"}),s.jsx("li",{children:"â€¢ Inventory: Stock checks and ordering"}),s.jsx("li",{children:"â€¢ Environmental: Cleaning schedules and compliance"}),s.jsx("li",{children:"â€¢ Quality: Documentation and audits"})]})},{id:"task-completion",title:"âœ… Task Completion",color:"green",content:s.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Click checkboxes to mark tasks complete"}),s.jsx("li",{children:"â€¢ Earn points for each completed task"}),s.jsx("li",{children:"â€¢ Track progress throughout the day"}),s.jsx("li",{children:"â€¢ Maintain streaks for consistency"})]})},{id:"workflow-tips",title:"ðŸ’¡ Workflow Tips",color:"purple",content:s.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Use filters to focus on specific task types"}),s.jsx("li",{children:"â€¢ Prioritize high-impact tasks first"}),s.jsx("li",{children:"â€¢ Set reminders for time-sensitive items"}),s.jsx("li",{children:"â€¢ Review completed tasks for quality"})]})}],u=p=>{const f=t.has(p.id),y={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return s.jsxs("div",{className:`${y.bg} ${y.border} border rounded-lg overflow-hidden`,children:[s.jsxs("button",{onClick:()=>n(p.id),className:`w-full p-3 text-left flex items-center justify-between ${y.hover} transition-colors`,children:[s.jsx("h5",{className:`font-medium ${y.text}`,children:p.title}),s.jsx("span",{className:`${y.icon} text-lg transition-transform duration-200`,children:f?"âˆ’":"+"})]}),f&&s.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&s.jsx("div",{className:"mt-3",children:s.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[s.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},p.id)};if(c)return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about task management.'})})})):d;return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),s.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Managing daily tasks and workflows"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Daily Task Management"}),h.map(u)]})})]})};var yx=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const vx=({onBack:r,onSetHelpType:e,expandedGamification:t,onToggleGamificationSection:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{yx(null,null,function*(){try{console.log("ðŸ” Loading gamification articles...");const f=yield Kn.getArticlesByCategory("gamification");console.log("ðŸŽ® Found articles:",f),i(f)}catch(f){console.error("Error loading gamification articles:",f)}finally{l(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"point-system",title:"â­ Point System",color:"blue",content:s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Complete tasks to earn points"}),s.jsx("li",{children:"â€¢ Points vary by task difficulty and impact"}),s.jsx("li",{children:"â€¢ Bonus points for maintaining streaks"}),s.jsx("li",{children:"â€¢ Level up as you accumulate points"})]})},{id:"streaks-consistency",title:"ðŸ”¥ Streaks & Consistency",color:"green",content:s.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Daily streaks increase your multiplier"}),s.jsx("li",{children:"â€¢ Perfect days earn bonus rewards"}),s.jsx("li",{children:"â€¢ Streaks reset on missed days"}),s.jsx("li",{children:"â€¢ Long streaks unlock special achievements"})]})},{id:"level-progression",title:"ðŸ“Š Level Progression",color:"purple",content:s.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Multiple skill-based sub-levels"}),s.jsx("li",{children:"â€¢ Sterilization, inventory, and environmental"}),s.jsx("li",{children:"â€¢ Rank against other users"}),s.jsx("li",{children:"â€¢ Unlock new features as you progress"})]})}],u=p=>{const f=t.has(p.id),y={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return s.jsxs("div",{className:`${y.bg} ${y.border} border rounded-lg overflow-hidden`,children:[s.jsxs("button",{onClick:()=>n(p.id),className:`w-full p-3 text-left flex items-center justify-between ${y.hover} transition-colors`,children:[s.jsx("h5",{className:`font-medium ${y.text}`,children:p.title}),s.jsx("span",{className:`${y.icon} text-lg transition-transform duration-200`,children:f?"âˆ’":"+"})]}),f&&s.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&s.jsx("div",{className:"mt-3",children:s.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[s.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},p.id)};if(c)return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about gamification.'})})})):d;return s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),s.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"How points, levels, and streaks work"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Earning and Progress"}),h.map(u)]})})]})},xx=({onBack:r})=>s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"AI Features"}),s.jsx("p",{className:"text-xs text-gray-500",children:"How AI improves your workflow"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"AI-Powered Assistance"}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Smart Task Generation"}),s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"â€¢ AI creates relevant daily tasks"}),s.jsx("li",{children:"â€¢ Adapts to your facility's needs"}),s.jsx("li",{children:"â€¢ Suggests optimal task sequences"}),s.jsx("li",{children:"â€¢ Learns from your preferences"})]})]}),s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Optimization"}),s.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Real-time efficiency monitoring"}),s.jsx("li",{children:"â€¢ Predictive maintenance alerts"}),s.jsx("li",{children:"â€¢ Resource optimization suggestions"}),s.jsx("li",{children:"â€¢ Compliance risk mitigation"})]})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Intelligent Insights"}),s.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Data-driven recommendations"}),s.jsx("li",{children:"â€¢ Trend analysis and forecasting"}),s.jsx("li",{children:"â€¢ Best practice suggestions"}),s.jsx("li",{children:"â€¢ Continuous improvement tips"})]})]})]})})]}),bx=({onBack:r})=>s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"New Features"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Discover what's new in Cliniio"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"What's New in Cliniio"}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Latest Updates"}),s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Enhanced AI assistance capabilities"}),s.jsx("li",{children:"â€¢ Improved task management system"}),s.jsx("li",{children:"â€¢ New gamification features"}),s.jsx("li",{children:"â€¢ Enhanced reporting and analytics"})]})]}),s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Improvements"}),s.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Faster page loading times"}),s.jsx("li",{children:"â€¢ Better mobile responsiveness"}),s.jsx("li",{children:"â€¢ Improved accessibility features"}),s.jsx("li",{children:"â€¢ Enhanced security measures"})]})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[s.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Coming Soon"}),s.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[s.jsx("li",{children:"â€¢ Advanced workflow automation"}),s.jsx("li",{children:"â€¢ Integration with external systems"}),s.jsx("li",{children:"â€¢ Enhanced mobile app features"}),s.jsx("li",{children:"â€¢ More customization options"})]})]})]})})]}),_x=({onBack:r})=>s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Sterilization Workflow"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Sterilization processes and procedures"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsx("div",{className:"text-center text-gray-500 py-8",children:s.jsx("p",{children:"Sterilization workflow content coming soon."})})})]}),wx=({onBack:r})=>s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Reporting and Compliance"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Documentation and regulatory compliance procedures"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsx("div",{className:"text-center text-gray-500 py-8",children:s.jsx("p",{children:"Reporting and compliance content coming soon."})})})]}),Sx=({onBack:r})=>s.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"BI Testing"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Biological indicator testing protocols"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s.jsx("div",{className:"text-center text-gray-500 py-8",children:s.jsx("p",{children:"BI testing content coming soon."})})})]}),jx=({selectedHelpType:r,currentContext:e,expandedMetrics:t,expandedTasks:n,expandedGamification:a,expandedRelevant:i,onOptionClick:c,onBack:l,onFeedbackSuccess:o,onToggleMetricSection:d,onToggleTaskSection:u,onToggleGamificationSection:h,onToggleRelevantSection:p,onSetHelpType:f})=>{if(!r)return s.jsx(ml,{onOptionClick:c});switch(r){case"ai-chat":return s.jsx(rx,{currentContext:e,onBack:l});case"context-help":return s.jsx(ax,{currentContext:e,expandedRelevant:i,onToggleRelevantSection:p,onBack:l});case"product-feedback":return s.jsx(dx,{onBack:l,onSuccess:o});case"onboarding":return s.jsx(ux,{onBack:l});case"cliniio-help":return s.jsx(mx,{currentContext:e,onBack:l,onSetHelpType:f});case"performance-metrics":return s.jsx(px,{onBack:l,expandedMetrics:t,onToggleMetricSection:d,onSetHelpType:f});case"task-management":return s.jsx(gx,{onBack:l,onSetHelpType:f,expandedTasks:n,onToggleTaskSection:u});case"gamification":return s.jsx(vx,{onBack:l,onSetHelpType:f,expandedGamification:a,onToggleGamificationSection:h});case"ai-features":return s.jsx(xx,{onBack:l});case"new-features":return s.jsx(bx,{onBack:l});case"bi-testing":return s.jsx(Sx,{onBack:l});case"sterilization-workflow":return s.jsx(_x,{onBack:l});case"reporting-compliance":return s.jsx(wx,{onBack:l});default:return s.jsx(ml,{onOptionClick:c})}},Cx=({isDrawerOpen:r,onClose:e})=>{const{selectedHelpType:t,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,currentContext:l,handleOptionClick:o,handleBack:d,handleFeedbackSuccess:u,toggleMetricSection:h,toggleTaskSection:p,toggleGamificationSection:f,toggleRelevantSection:g,setHelpType:y}=n0(e),v=()=>s.jsx(jx,{selectedHelpType:t,currentContext:l,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,onOptionClick:o,onBack:d,onFeedbackSuccess:u,onToggleMetricSection:h,onToggleTaskSection:p,onToggleGamificationSection:f,onToggleRelevantSection:g,onSetHelpType:y});return r?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:e,onKeyDown:b=>b.key==="Escape"&&e(),role:"button",tabIndex:0,"aria-label":"Close help drawer"}),s.jsxs("div",{className:"fixed top-0 right-0 h-screen w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out flex flex-col",children:[s.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-[#4ECDC4] text-white",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white text-sm font-bold",children:"?"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-bold",children:"Help & Support"}),s.jsx("p",{className:"text-xs text-white text-opacity-90",children:"Choose how you'd like to get help"})]})]})}),v()]})]}):null},Nx=()=>{const[r,e]=m.useState(!1),t=()=>{e(!r)},n=()=>{e(!1)};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:s.jsx("button",{onClick:t,className:"w-14 h-14 bg-transparent text-gray-700 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 relative flex items-center justify-center","aria-label":"Get AI help and assistance",title:"AI Help & Assistant",children:s.jsx("span",{className:"text-6xl",children:"ðŸ›Ÿ"})})}),s.jsx(Cx,{isDrawerOpen:r,onClose:n})]})},Ur=({children:r})=>{const{isDrawerOpen:e,openDrawer:t,closeDrawer:n}=Vu();return s.jsx(As,{children:s.jsxs(m.Suspense,{fallback:s.jsx(Yh,{size:"lg"}),children:[s.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-blue-50 to-teal-50",children:[s.jsx(r0,{isOpen:e,onOpen:t,onClose:n}),s.jsx("div",{className:"flex-1",children:s.jsx("div",{className:"pt-6",children:r})})]}),s.jsx(Nx,{})]})})},xa=["Welcome back, sterilization superstar! âœ¨","Hey there, inventory rockstar! ðŸŽ¸","The clinic's MVP is back in action! ðŸ†","Welcome to another day of medical excellence! ðŸŒŸ","Ready to tackle some sterilization challenges? ðŸ’ª","Back in the clinic and ready to shine! âœ¨","Time to make those tools gleam! âœ¨","Welcome back! The tools missed you! ðŸ”§","Let's make today spotlessly successful! âœ¨","Ready to master the medical inventory? ðŸ“‹","The sterilization superstar has arrived! ðŸŒŸ","Let's make those tools SHINE today! âœ¨","Welcome back to your sterilization kingdom! ðŸ‘‘","Ready to conquer today's challenge? Let's do this! ðŸ…","Another day, another challenge to crush! ðŸš€","Your daily challenge awaitsâ€”show it who's boss! ðŸ’ª","Inventory hero reporting for duty! ðŸ“¦","Let's keep those supplies in tip-top shape! ðŸ—‚ï¸","Inventory wizardry in progressâ€”abracadabra! ðŸ§™â€â™‚ï¸","Time to check off those tasks like a pro! âœ…","Taskmaster mode: activated! ðŸ•¹ï¸","Let's make that to-do list disappear! âœ¨","Sparkle squad, assemble! ðŸ§½","Let's make every room shine bright! ðŸ’¡","Clean team, ready for action! ðŸ¦¸â€â™€ï¸","Knowledge quest begins now! ðŸ“š","Time to level up your skills! ðŸŽ®","Learning legend in the house! ðŸ†"],Ix=()=>{const[r,e]=m.useState(xa[0]);return m.useEffect(()=>{const t=Math.floor(Math.random()*xa.length);e(xa[t])},[]),s.jsx("h1",{className:"text-xl md:text-2xl font-bold text-[#5b5b5b] mb-2",children:r})},om=({content:r,children:e,className:t=""})=>{const[n,a]=m.useState(!1);return s.jsxs("div",{className:`relative inline-block ${t}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[e,n&&s.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50",children:s.jsx("div",{className:"bg-white text-gray-700 text-xs font-medium px-3 py-2 rounded-lg shadow-lg border border-gray-200 text-center whitespace-pre-line",children:r})})]})},Tx=[{icon:bp,bg:"teal",label:"Cumulative Stats",description:`Performance
Statistics`},{icon:ai,bg:"purple",label:"Leaderboard",description:`Team
Rankings`},{icon:Tu,bg:"blue",label:"Daily Challenge",description:`Daily
Challenge`}],Ex=({onStatsClick:r,onLeaderboardClick:e,onChallengeClick:t})=>{const n=(a,i)=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),i==null||i())};return s.jsxs("header",{className:"mb-6 pl-8","aria-label":"Dashboard header","data-testid":"nav-bar",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(Ix,{}),s.jsx("nav",{className:"flex gap-4 pr-8",role:"navigation","aria-label":"Dashboard actions",children:Tx.map(a=>{const i=a.label==="Cumulative Stats"?r:a.label==="Leaderboard"?e:a.label==="Daily Challenge"?t:void 0;return s.jsx(om,{content:a.description,children:s.jsx("button",{className:`rounded-xl w-12 h-12 flex items-center justify-center transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 ${a.label==="Cumulative Stats"?"bg-purple-100 focus:ring-purple-500":a.label==="Leaderboard"?"bg-amber-100 focus:ring-amber-500":"bg-blue-100 focus:ring-blue-500"}`,"aria-label":`${a.label}: ${a.description}`,onClick:i,onKeyDown:c=>n(c,i),tabIndex:0,children:s.jsx(N,{path:a.icon,size:1.1,"aria-hidden":"true",color:a.label==="Cumulative Stats"?"#9333ea":a.label==="Leaderboard"?"#d97706":"#2563eb"})})},a.label)})})]}),s.jsx("p",{className:"text-sm text-gray-500",role:"status","aria-live":"polite",children:"Here's your impact and progress for today."})]})},Le={NAV_BAR_MARGIN_TOP:4,NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:24,NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED:72,COLORS:{PRIMARY:"#4ECDC4",PRIMARY_BG:"teal-100",BORDER:"teal-400",BG_GRADIENT:{FROM:"blue-50",TO:"teal-50"}},SPACING:{PADDING:6,MARGIN_TOP:6},BORDER:{LEFT_WIDTH:4},taskCard:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50",sectionBox:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50"},kx=r=>{const e=r?Le.NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:Le.NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED,t=Le.NAV_BAR_MARGIN_TOP;return{navBarMarginLeft:e,navBarMarginTop:t}};function Dx(){return ur(Le.sectionBox,"mb-4")}function ba(){return ur(Le.taskCard,"mb-4")}var Px=Object.defineProperty,Rl=Object.getOwnPropertySymbols,Ox=Object.prototype.hasOwnProperty,Rx=Object.prototype.propertyIsEnumerable,Al=(r,e,t)=>e in r?Px(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$l=(r,e)=>{for(var t in e||(e={}))Ox.call(e,t)&&Al(r,t,e[t]);if(Rl)for(var t of Rl(e))Rx.call(e,t)&&Al(r,t,e[t]);return r};const Mi=Nt(r=>({totalScore:0,availablePoints:0,showFilters:!1,showLeaderboardModal:!1,showStatsModal:!1,showChallengeModal:!1,leaderboardUsers:[],tasks:[],gamificationData:{totalScore:0,level:1,totalPoints:0,streak:0,rank:100,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}},drawerOpen:!0,loading:!1,taskError:null,setTotalScore:e=>r({totalScore:e}),setAvailablePoints:e=>r({availablePoints:e}),setShowFilters:e=>r({showFilters:e}),setShowLeaderboardModal:e=>r({showLeaderboardModal:e}),setShowStatsModal:e=>r({showStatsModal:e}),setShowChallengeModal:e=>r({showChallengeModal:e}),setLeaderboardUsers:e=>r({leaderboardUsers:e}),setTasks:e=>r({tasks:e}),setGamificationData:e=>r({gamificationData:e}),updateGamificationData:e=>{wt(),r(t=>({gamificationData:$l($l({},t.gamificationData),e)}))},setDrawerOpen:e=>r({drawerOpen:e}),setLoading:e=>r({loading:e}),setTaskError:e=>r({taskError:e})}));var Ml=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const lm={fetchStats(){return Ml(this,null,function*(){const{data:{user:r},error:e}=yield _.auth.getUser();if(e||!r)return console.error("Stats fetch blocked â€” no authenticated user"),null;const{data:t,error:n}=yield _.from("users").select("facility_id").eq("id",r.id).single();if(n||!(t!=null&&t.facility_id))return console.error("Missing facility_id in user profile"),null;const a=t.facility_id,{data:i,error:c}=yield _.from("user_stats").select("*").eq("facility_id",a).eq("user_id",r.id).single();return c?(console.error("Error fetching stats:",c),null):i})},fetchCumulativeStats(){return Ml(this,null,function*(){const{data:{user:r},error:e}=yield _.auth.getUser();return e||!r?(console.error("Cumulative stats fetch blocked â€” no authenticated user"),{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}):{toolsSterilized:23,inventoryChecks:15,perfectDays:7,totalTasks:12,completedTasks:8,currentStreak:3,bestStreak:12,totalPoints:450,challengesCompleted:5,totalChallenges:8}})}};var Ax=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const cm=()=>{const[r,e]=m.useState({toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}),[t,n]=m.useState(!0),[a,i]=m.useState(null),c=m.useCallback(()=>Ax(null,null,function*(){try{n(!0),i(null);const o=yield lm.fetchCumulativeStats();e(o)}catch(o){console.error("Error fetching cumulative stats:",o),i(o instanceof Error?o.message:"Failed to fetch stats")}finally{n(!1)}}),[]);m.useEffect(()=>{c()},[c]);const l=m.useCallback(()=>{c()},[c]);return{stats:r,loading:t,error:a,refreshStats:l}},$x=({isOpen:r,onClose:e,gamificationData:t})=>{const{stats:n,loading:a,error:i,refreshStats:c}=cm(),l=(t==null?void 0:t.stats)||{toolsSterilized:n.toolsSterilized,inventoryChecks:n.inventoryChecks,perfectDays:n.perfectDays,totalTasks:n.totalTasks,completedTasks:n.completedTasks,currentStreak:n.currentStreak,bestStreak:n.bestStreak};return s.jsx(Bn,{children:r&&s.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:s.jsxs(ne.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:o=>o.stopPropagation(),children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:s.jsx(N,{path:Fr,size:.9,className:"text-white"})}),s.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:"Cumulative Stats"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:c,disabled:a,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg disabled:opacity-50",title:"Refresh stats",children:s.jsx(N,{path:pt,size:.9,className:a?"animate-spin":""})}),s.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg",children:s.jsx(N,{path:Ae,size:.9})})]})]}),i&&s.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[s.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Stats"}),s.jsx("div",{className:"text-red-500 text-xs mt-1",children:i})]}),s.jsxs("div",{className:"space-y-3",children:[a&&s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4] mx-auto"}),s.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading stats..."})]}),!a&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-[#4ECDC4] bg-opacity-10 p-3 rounded-xl",children:[s.jsx("div",{className:"mb-0.5 text-[#4ECDC4] font-semibold text-sm",children:"Tools Sterilized"}),s.jsx("div",{className:"text-2xl font-bold text-[#4ECDC4]",children:l.toolsSterilized}),s.jsx("div",{className:"text-xs text-[#4ECDC4] mt-0.5",children:"That's impressive!"})]}),s.jsxs("div",{className:"bg-blue-50 p-3 rounded-xl",children:[s.jsx("div",{className:"mb-0.5 text-blue-600 font-semibold text-sm",children:"Inventory Checks"}),s.jsx("div",{className:"text-2xl font-bold text-blue-700",children:l.inventoryChecks}),s.jsx("div",{className:"text-xs text-blue-500 mt-0.5",children:"Always organized!"})]}),s.jsxs("div",{className:"bg-green-50 p-3 rounded-xl",children:[s.jsx("div",{className:"mb-0.5 text-green-600 font-semibold text-sm",children:"Perfect Days"}),s.jsx("div",{className:"text-2xl font-bold text-green-700",children:l.perfectDays}),s.jsx("div",{className:"text-xs text-green-500 mt-0.5",children:"Zero errors!"})]}),s.jsxs("div",{className:"bg-purple-50 p-3 rounded-xl",children:[s.jsx("div",{className:"mb-0.5 text-purple-600 font-semibold text-sm",children:"Task Completion"}),s.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[l.totalTasks>0?Math.round(l.completedTasks/l.totalTasks*100):0,"%"]}),s.jsxs("div",{className:"text-xs text-purple-500 mt-0.5",children:[l.completedTasks," / ",l.totalTasks," tasks completed"]})]}),s.jsxs("div",{className:"bg-amber-50 p-3 rounded-xl",children:[s.jsx("div",{className:"mb-0.5 text-amber-600 font-semibold text-sm",children:"Current Streak"}),s.jsx("div",{className:"text-2xl font-bold text-amber-700",children:l.currentStreak}),s.jsxs("div",{className:"text-xs text-amber-500 mt-0.5",children:["Best streak: ",l.bestStreak]})]})]})]})]})})})},Mx=({isOpen:r,onClose:e,gamificationData:t,loading:n=!1,error:a=null})=>{const i={rank:(t==null?void 0:t.rank)||1,topUsers:(t==null?void 0:t.topUsers)||[]};return s.jsx(Bn,{children:r&&s.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:s.jsxs(ne.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-6 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:c=>c.stopPropagation(),children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 bg-blue-500 rounded-xl",children:s.jsx(N,{path:ai,size:1,className:"text-white"})}),s.jsx("h2",{className:"ml-3 text-xl font-bold text-[#5b5b5b]",children:"Office Leaderboard"})]}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:s.jsx(N,{path:Ae,size:1})})]}),s.jsxs("div",{className:"flex items-center justify-between mb-4 bg-blue-50 p-3 rounded-lg",children:[s.jsx("div",{className:"text-blue-700 font-medium",children:"Your Rank"}),s.jsxs("div",{className:"flex items-center",children:[s.jsxs("span",{className:"text-xl font-bold text-blue-700 mr-1",children:["#",i.rank]}),s.jsx("span",{className:"text-blue-500 text-sm",children:"/15"})]})]}),a&&s.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[s.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Leaderboard"}),s.jsx("div",{className:"text-red-500 text-xs mt-1",children:a})]}),s.jsxs("div",{className:"space-y-3",children:[n&&s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),s.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading leaderboard..."})]}),!n&&!a&&i.topUsers.map((c,l)=>s.jsxs(ne.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:l*.2+.2},className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-semibold",children:c.avatar}),l===0&&s.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center",children:s.jsx(N,{path:ai,size:.4,className:"text-white"})})]}),s.jsxs("div",{className:"ml-3",children:[s.jsx("div",{className:"text-sm font-semibold text-gray-700",children:c.full_name}),s.jsxs("div",{className:"text-xs text-gray-500",children:["Rank #",l+1]})]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-lg font-bold text-[#4ECDC4]",children:c.score}),s.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"pts"})]})]},c.id||c.full_name))]})]})})})},Fx=te.memo(Mx),Fi={TASKS:"Daily Operations Tasks",STATS:"Stats Overview",CHALLENGES:"Today's Challenge"};var Lx=Object.defineProperty,zx=Object.defineProperties,Bx=Object.getOwnPropertyDescriptors,Fl=Object.getOwnPropertySymbols,qx=Object.prototype.hasOwnProperty,Ux=Object.prototype.propertyIsEnumerable,Ll=(r,e,t)=>e in r?Lx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Hx=(r,e)=>{for(var t in e||(e={}))qx.call(e,t)&&Ll(r,t,e[t]);if(Fl)for(var t of Fl(e))Ux.call(e,t)&&Ll(r,t,e[t]);return r},Vx=(r,e)=>zx(r,Bx(e)),_a=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const zl={createChallenge(r){return _a(this,null,function*(){try{const{data:{user:e},error:t}=yield _.auth.getUser();if(t||!e)throw new Error("Unauthorized: no authenticated user.");const{data:n,error:a}=yield _.from("users").select("facility_id, role").eq("id",e.id).single();if(a||!(n!=null&&n.facility_id))throw new Error("Missing facility context.");const i=n.facility_id,c=n.role||"staff";if(!["admin","manager"].includes(c))throw new Error("Forbidden: insufficient permissions to create challenges.");const o={title:r.title,description:r.description||"",points:r.points||0,facility_id:i,created_by:e.id,created_at:new Date().toISOString()},{data:d,error:u}=yield _.from("home_challenges").insert([o]).select().single();if(u)throw new Error(u.message);return console.info(`âœ… Challenge created by ${c}:`,d.title),{success:!0,data:d}}catch(e){return console.error("âŒ Challenge creation failed:",e instanceof Error?e.message:String(e)),{success:!1,error:e instanceof Error?e.message:String(e)}}})},fetchUserChallenges(){return _a(this,null,function*(){try{const{data:{user:r},error:e}=yield _.auth.getUser();if(e||!r)return console.warn("âš ï¸ No authenticated user, returning empty challenges"),[];const{data:t,error:n}=yield _.from("users").select("facility_id").eq("id",r.id).single();if(n||!(t!=null&&t.facility_id))return console.warn("âš ï¸ Missing facility context, returning empty challenges"),[];const a=t.facility_id,i=`challenges_and_completions:${a}`,c=Ln.get(i);if(c)return console.info("ðŸ§  Loaded challenges from cache:",c.length),c;const[l,o]=yield Promise.all([_.from("home_challenges").select("*").eq("facility_id",a).order("created_at",{ascending:!1}),_.from("home_challenge_completions").select("challenge_id, user_id, completed_at").eq("facility_id",a).eq("user_id",r.id)]);if(l.error)throw new Error(l.error.message);if(o.error)throw new Error(o.error.message);const d=l.data||[],u=o.data||[],h=d.map(p=>{var f;return Vx(Hx({},p),{isCompleted:u.some(g=>g.challenge_id===p.id),completedAt:((f=u.find(g=>g.challenge_id===p.id))==null?void 0:f.completed_at)||null})});return Ln.set(i,h),console.info(`âœ… Cached ${h.length} merged challenges for ${a}`),h}catch(r){return console.error("âŒ Failed to fetch challenges:",r instanceof Error?r.message:String(r)),[]}})},completeChallenge(r){return _a(this,null,function*(){var e,t;try{const{data:{user:n},error:a}=yield _.auth.getUser();if(a||!n)throw new Error("Unauthorized: no authenticated user.");let i=((e=n.user_metadata)==null?void 0:e.facility_id)||((t=n.app_metadata)==null?void 0:t.facility_id);if(!i){const{data:d,error:u}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(u||!(d!=null&&d.facility_id))throw new Error("Missing facility context.");i=d.facility_id}const{data:c,error:l}=yield _.from("challenge_completions").select("id").eq("challenge_id",r.challenge_id).eq("user_id",n.id).eq("facility_id",i).single();if(l&&l.code!=="PGRST116")throw new Error(l.message);if(c)return console.warn("Challenge already completed by user"),!0;const{error:o}=yield _.from("home_challenge_completions").insert([{challenge_id:r.challenge_id,user_id:n.id,facility_id:i,points_earned:r.points_earned,completed_at:new Date().toISOString()}]);if(o)throw new Error(o.message);return console.info(`âœ… Challenge ${r.challenge_id} completed by user ${n.id}`),!0}catch(n){return console.error("âŒ Challenge completion failed:",n instanceof Error?n.message:String(n)),!1}})}};var Wx=Object.defineProperty,Gx=Object.defineProperties,Kx=Object.getOwnPropertyDescriptors,Bl=Object.getOwnPropertySymbols,Qx=Object.prototype.hasOwnProperty,Yx=Object.prototype.propertyIsEnumerable,ql=(r,e,t)=>e in r?Wx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Jx=(r,e)=>{for(var t in e||(e={}))Qx.call(e,t)&&ql(r,t,e[t]);if(Bl)for(var t of Bl(e))Yx.call(e,t)&&ql(r,t,e[t]);return r},Xx=(r,e)=>Gx(r,Kx(e)),Ul=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Zx={knowledge:"bg-blue-100 text-blue-800",process:"bg-purple-100 text-purple-800",quality:"bg-green-100 text-green-800",collaboration:"bg-orange-100 text-orange-800",daily:"bg-gray-100 text-gray-800",team:"bg-pink-100 text-pink-800"},eb={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"},tb=({isOpen:r,onClose:e,onChallengeComplete:t})=>{const[n,a]=m.useState("all"),[i,c]=m.useState("all"),[l,o]=m.useState("pending"),[d,u]=m.useState([]),[h,p]=m.useState(!0);m.useEffect(()=>{Ul(null,null,function*(){try{p(!0);const w=(yield zl.fetchUserChallenges()).map(j=>({id:j.id,title:j.title,description:j.description,category:j.category,difficulty:j.difficulty,points:j.points,timeEstimate:j.time_estimate,completed:j.isCompleted||!1}));u(w)}catch(x){console.error("Error loading challenges:",x)}finally{p(!1)}})},[]);const f=[{id:"knowledge",icon:_p,label:"Knowledge"},{id:"process",icon:wp,label:"Process"},{id:"quality",icon:Sp,label:"Quality"},{id:"collaboration",icon:ao,label:"Collaboration"},{id:"daily",icon:An,label:"Daily"},{id:"team",icon:ao,label:"Team"}],g=[{id:"easy",label:"Easy",color:"text-green-500"},{id:"medium",label:"Medium",color:"text-yellow-500"},{id:"hard",label:"Hard",color:"text-red-500"}],y=d.filter(b=>{const x=n==="all"||b.category===n,w=i==="all"||b.difficulty===i,j=l==="all"||l==="pending"&&!b.completed||l==="completed"&&b.completed;return x&&w&&j}),v=b=>Ul(null,null,function*(){try{(yield zl.completeChallenge({challenge_id:b.id,points_earned:b.points}))?(u(w=>w.map(j=>j.id===b.id?Xx(Jx({},j),{completed:!0}):j)),t(b.points)):console.error("Failed to complete challenge")}catch(x){console.error("Error completing challenge:",x)}});return s.jsx(Bn,{children:r&&s.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:s.jsxs(ne.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto scrollbar-hide",onClick:b=>b.stopPropagation(),children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:s.jsx(N,{path:Tu,size:.9,className:"text-white"})}),s.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:Fi.CHALLENGES})]}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:s.jsx(N,{path:Ae,size:.9})})]}),s.jsxs("div",{className:"mb-4 flex gap-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Category"}),s.jsxs("select",{value:n,onChange:b=>a(b.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[s.jsx("option",{value:"all",children:"All Categories"}),f.map(b=>s.jsx("option",{value:b.id,children:b.label},b.id))]})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Difficulty"}),s.jsxs("select",{value:i,onChange:b=>c(b.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[s.jsx("option",{value:"all",children:"All Difficulties"}),g.map(b=>s.jsx("option",{value:b.id,children:b.label},b.id))]})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Status"}),s.jsxs("select",{value:l,onChange:b=>o(b.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[s.jsx("option",{value:"all",children:"All Challenges"}),s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"completed",children:"Completed"})]})]})]}),s.jsx("div",{className:"space-y-3",children:h?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-gray-500",children:"Loading challenges..."})}):y.length===0?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-gray-500",children:"No challenges available"})}):y.map(b=>s.jsx("div",{className:`p-3 rounded-lg border ${b.completed?"bg-gray-50 border-gray-200":"bg-white border-gray-200 hover:border-[#4ECDC4]"}`,children:s.jsx("div",{className:"flex justify-between items-start",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Zx[b.category]}`,children:b.category}),s.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${eb[b.difficulty]}`,children:b.difficulty}),s.jsx("span",{className:"text-xs text-gray-500",children:b.timeEstimate})]}),s.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-0.5",children:b.title}),s.jsx("p",{className:"text-xs text-gray-600 mb-2",children:b.description}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-xs font-medium text-[#4ECDC4]",children:[b.points," points"]}),!b.completed&&s.jsx("button",{onClick:()=>v(b),className:"px-3 py-1 bg-[#4ECDC4] text-white text-xs rounded-lg hover:bg-[#38b2ac] transition-colors",children:"Complete"}),b.completed&&s.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[s.jsx(N,{path:jp,size:.8,className:"mr-1"}),"Completed"]})]})]})})},b.id))})]})})})};var Hl=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const rb={fetchLeaderboard(){return Hl(this,null,function*(){var r;const{data:{user:e},error:t}=yield _.auth.getUser();if(t||!e)return console.error("Leaderboard fetch blocked â€” no authenticated user"),[];const{data:n,error:a}=yield _.from("leaderboard").select("*").eq("facility_id",((r=e.user_metadata)==null?void 0:r.facility_id)||"").order("points",{ascending:!1});return a?(console.error("Error fetching leaderboard:",a),[]):n||[]})},fetchLeaderboardData(){return Hl(this,null,function*(){return this.fetchLeaderboard()})}},sb=({isStatsOpen:r,onStatsClose:e,isLeaderboardOpen:t,onLeaderboardClose:n,isChallengeOpen:a,onChallengeClose:i,gamificationData:c,leaderboardRank:l,leaderboardTopUsers:o,leaderboardLoading:d=!1,leaderboardError:u=null})=>{const[h,p]=m.useState({rank:l,topUsers:o}),[f,g]=m.useState(!1),[y,v]=m.useState(null);m.useEffect(()=>{t&&o.length===0&&(g(!0),v(null),rb.fetchLeaderboardData().then(x=>{var w;p({rank:x.userRank||1,topUsers:((w=x.users)==null?void 0:w.map(j=>({id:j.id,name:j.full_name||"Anonymous",score:j.score||0,avatar:j.avatar||"ðŸ‘¤"})))||[]})}).catch(x=>{v(x.message||"Failed to load leaderboard")}).finally(()=>{g(!1)}))},[t,o.length]);const b={stats:c.stats||{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}};return s.jsxs(s.Fragment,{children:[r&&s.jsx($x,{isOpen:r,onClose:e,gamificationData:b}),s.jsx(Fx,{isOpen:t,onClose:n,gamificationData:h,loading:f,error:y}),s.jsx(tb,{isOpen:a,onClose:i,onChallengeComplete:x=>{console.log("Challenge completed with points:",x)}})]})};function nb({leaderboardData:r}){const{showStatsModal:e,setShowStatsModal:t,showLeaderboardModal:n,setShowLeaderboardModal:a,showChallengeModal:i,setShowChallengeModal:c,gamificationData:l}=Mi(),o=m.useMemo(()=>r.users||[],[r.users]),d=m.useMemo(()=>!o||o.length===0?[]:o.slice().sort((p,f)=>f.score-p.score).slice(0,3),[o]),u=m.useMemo(()=>r.userRank||1,[r.userRank]),h=m.useMemo(()=>!r.users||r.users.length===0?[]:d.map(p=>({id:p.id,name:p.full_name||"Anonymous",score:p.score||0,rank:p.rank,avatar:p.avatar||"ðŸ‘¤"})),[d,r.users]);return s.jsx(sb,{isStatsOpen:e,onStatsClose:()=>t(!1),isLeaderboardOpen:n,onLeaderboardClose:()=>a(!1),isChallengeOpen:i,onChallengeClose:()=>c(!1),gamificationData:l,leaderboardRank:u,leaderboardTopUsers:h,leaderboardLoading:!1,leaderboardError:null})}var ab=Object.defineProperty,Vl=Object.getOwnPropertySymbols,ib=Object.prototype.hasOwnProperty,ob=Object.prototype.propertyIsEnumerable,Wl=(r,e,t)=>e in r?ab(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lb=(r,e)=>{for(var t in e||(e={}))ib.call(e,t)&&Wl(r,t,e[t]);if(Vl)for(var t of Vl(e))ob.call(e,t)&&Wl(r,t,e[t]);return r};const Me={maxTasksPerUser:3,enabledCategories:["equipment","compliance","operational","safety"],priorityThresholds:{low:1,medium:2,high:3,urgent:4},priorityWeights:{low:1,medium:2,high:3,urgent:4},rolePreferences:{technician:["equipment","compliance"],operator:["operational","compliance"],cleaning_staff:["compliance"],inventory_manager:["operational"],supervisor:["safety","operational"]},timeConstraints:{maxTaskDuration:120,minTaskDuration:5},autoAssignment:!0,aiSensitivity:"medium",aiEnabled:!0},cb={urgent:4,high:3,medium:2,low:1},db={equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]};function ub(r){var e,t,n,a,i,c,l,o,d,u,h,p,f,g,y,v;return{maxTasksPerUser:(e=r.maxTasksPerUser)!=null?e:Me.maxTasksPerUser,enabledCategories:(t=r.enabledCategories)!=null?t:Me.enabledCategories,priorityThresholds:{low:(a=(n=r.priorityThresholds)==null?void 0:n.low)!=null?a:Me.priorityThresholds.low,medium:(c=(i=r.priorityThresholds)==null?void 0:i.medium)!=null?c:Me.priorityThresholds.medium,high:(o=(l=r.priorityThresholds)==null?void 0:l.high)!=null?o:Me.priorityThresholds.high,urgent:(u=(d=r.priorityThresholds)==null?void 0:d.urgent)!=null?u:Me.priorityThresholds.urgent},priorityWeights:(h=r.priorityWeights)!=null?h:Me.priorityWeights,rolePreferences:(p=r.rolePreferences)!=null?p:Me.rolePreferences,timeConstraints:(f=r.timeConstraints)!=null?f:Me.timeConstraints,autoAssignment:(g=r.autoAssignment)!=null?g:Me.autoAssignment,aiSensitivity:(y=r.aiSensitivity)!=null?y:Me.aiSensitivity,aiEnabled:(v=r.aiEnabled)!=null?v:Me.aiEnabled}}function Gl(r){return cb[r]}function dm(r,e){const t=db[e];return t?t.includes(r):!0}function wa(){return lb({},Me)}var an=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class mb{calculateLevel(e){return e<100?1:e<250?2:e<500?3:e<750?4:e<1e3?5:Math.floor(Math.log(e/100)/Math.log(1.5))+5}calculatePointsToNextLevel(e,t){const n=this.getLevelThreshold(e+1);return Math.max(0,n-t)}getLevelThreshold(e){return e<=1?0:e<=5?[0,100,250,500,750,1e3][e-1]:Math.floor(100*Math.pow(1.5,e-5))}calculateUserRank(e,t){return an(this,null,function*(){try{const{data:n,error:a}=yield _.from("home_challenge_completions").select("user_id, points_earned").eq("facility_id",t);if(a)return console.error("Error fetching facility users for ranking:",a),{rank:1,percentile:100};const i=new Map;n==null||n.forEach(u=>{const h=u.user_id,p=u.points_earned;i.set(h,(i.get(h)||0)+p)});const c=Array.from(i.entries()).sort(([,u],[,h])=>h-u),l=c.findIndex(([u])=>u===e),o=l===-1?c.length:l+1,d=Math.round((1-(o-1)/c.length)*100);return{rank:o,percentile:d}}catch(n){return console.error("Error calculating user rank:",n),{rank:1,percentile:100}}})}updateGamificationData(e){return an(this,null,function*(){try{const{data:t,error:n}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e.userId).eq("facility_id",e.facilityId);if(n)throw console.error("Error fetching user completions:",n),n;const a=(t||[]).reduce((h,p)=>h+p.points_earned,0),i=this.calculateLevel(a),c=i+1,l=this.calculatePointsToNextLevel(i,a),{rank:o,percentile:d}=yield this.calculateUserRank(e.userId,e.facilityId),u={currentLevel:i,nextLevel:c,pointsToNextLevel:l,totalPoints:a,rank:o,rankPercentile:d};return $.info("Gamification update:",{userId:e.userId,pointsEarned:e.pointsEarned,totalPoints:a,currentLevel:i,rank:o,taskTitle:e.taskTitle}),u}catch(t){throw console.error("Error updating gamification data:",t),t}})}checkLevelUp(e,t,n){return an(this,null,function*(){try{const{data:a,error:i}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e).eq("facility_id",t);if(i)return console.error("Error fetching user completions for level check:",i),!1;const c=(a||[]).reduce((d,u)=>d+u.points_earned,0),l=this.calculateLevel(n);return this.calculateLevel(c)>l}catch(a){return console.error("Error checking level up:",a),!1}})}getGamificationSummary(e,t){return an(this,null,function*(){try{const{data:n,error:a}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e).eq("facility_id",t);if(a)throw console.error("Error fetching gamification summary:",a),a;const i=(n||[]).reduce((h,p)=>h+p.points_earned,0),c=this.calculateLevel(i),l=c+1,o=this.calculatePointsToNextLevel(c,i),{rank:d,percentile:u}=yield this.calculateUserRank(e,t);return{currentLevel:c,nextLevel:l,pointsToNextLevel:o,totalPoints:i,rank:d,rankPercentile:u}}catch(n){throw console.error("Error getting gamification summary:",n),n}})}}const hb=new mb;var pb=Object.defineProperty,Kl=Object.getOwnPropertySymbols,fb=Object.prototype.hasOwnProperty,gb=Object.prototype.propertyIsEnumerable,Ql=(r,e,t)=>e in r?pb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,um=(r,e)=>{for(var t in e||(e={}))fb.call(e,t)&&Ql(r,t,e[t]);if(Kl)for(var t of Kl(e))gb.call(e,t)&&Ql(r,t,e[t]);return r},Qn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function At(){return`gap-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function yb(){return`task-${Date.now()}-${Math.random()}`}function vb(){return`ai-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function xb(r,e){return Qn(this,null,function*(){try{for(const t of r)for(const n of t.tasks){const{error:a}=yield _.from("home_daily_operations_tasks").insert({facility_id:e,title:n.title,description:n.description,completed:!1,points:n.points,type:n.type,category:n.category,priority:n.priority,due_date:n.dueDate,estimated_duration:n.estimatedDuration,status:"pending",assigned_to:t.userId,created_by:ut(t.userId)||t.userId,created_at:n.createdAt,updated_at:n.updatedAt});a&&console.error("Error creating daily task:",a)}}catch(t){throw console.error("Error creating daily tasks:",t),t}})}function bb(r){return Qn(this,null,function*(){const{data:e,error:t}=yield _.from("home_daily_operations_tasks").select("*").eq("assigned_to",r).eq("status","pending").order("priority",{ascending:!1}).order("due_date",{ascending:!0});if(t)throw t;return(e||[]).map(n=>um({id:n.id},n))})}function _b(r){return Qn(this,null,function*(){const{data:e,error:t}=yield _.from("home_daily_operations_tasks").select("*").eq("facility_id",r).eq("status","pending").order("priority",{ascending:!1}).order("due_date",{ascending:!0});if(t)throw t;return(e||[]).map(n=>um({id:n.id},n))})}function wb(r,e){return Qn(this,null,function*(){try{const{data:t,error:n}=yield _.from("home_daily_operations_tasks").select("points, facility_id, title, category").eq("id",r).single();if(n||!t)throw new Error(`Task not found: ${(n==null?void 0:n.message)||"Unknown error"}`);const a=t.points||0,{error:i}=yield _.from("home_daily_operations_tasks").update({completed:!0,status:"completed",completed_by:e,completed_at:new Date().toISOString()}).eq("id",r);if(i)throw new Error(`Failed to complete task: ${i.message}`);if(a>0){const{error:c}=yield _.from("home_challenge_completions").insert({challenge_id:r,user_id:e,facility_id:t.facility_id,points_earned:a,completion_type:"daily_task",task_title:t.title,task_category:t.category});if(c)console.error("Failed to award points for task completion:",c);else{console.log(`Awarded ${a} points for completing task: ${t.title}`);try{const l=yield hb.updateGamificationData({userId:e,facilityId:t.facility_id,pointsEarned:a,taskTitle:t.title,taskCategory:t.category});l.currentLevel>1&&console.log(`ðŸŽ‰ Level up! User ${e} reached level ${l.currentLevel}`),console.log("Gamification updated:",{level:l.currentLevel,totalPoints:l.totalPoints,rank:l.rank,pointsToNextLevel:l.pointsToNextLevel})}catch(l){console.error("Error updating gamification data:",l)}}}}catch(t){throw console.error("Error completing daily task:",t),t}})}var Ee=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function Sb(){return Ee(this,null,function*(){const{data:{user:r}}=yield _.auth.getUser();if(!r)throw new Error("User not authenticated");return r.id})}function Ue(){return Ee(this,null,function*(){const{data:{user:r}}=yield _.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:e,error:t}=yield _.from("users").select("facility_id").eq("id",r.id).single();if(t||!e)throw new Error("Failed to get user facility");return e.facility_id})}const Fe={getToolByBarcode(r){return Ee(this,null,function*(){const e=yield Ue(),{data:t,error:n}=yield _.from("tools").select("*").eq("barcode",r).eq("facility_id",e).maybeSingle();return n?(console.error("ToolService.getToolByBarcode error:",n),null):t})},getToolsByStatus(r){return Ee(this,null,function*(){const e=yield Ue(),{data:t,error:n}=yield _.from("tools").select("*").eq("status",r).eq("facility_id",e);return n?(console.error("ToolService.getToolsByStatus error:",n),[]):t||[]})},updateToolStatus(r,e){return Ee(this,null,function*(){if(r.startsWith("mock-tool-"))return console.log("ðŸ§ª Skipping database update for mock tool:",r),{id:r,status:e,updated_at:new Date().toISOString()};const t={status:e,facility_id:yield Ue(),updated_at:new Date().toISOString()},{data:n,error:a}=yield _.from("tools").update(t).eq("id",r).select().single();if(a)throw a;return n})},getToolByBarcodeAndStatus(r,e){return Ee(this,null,function*(){if(r==="TEST-CLEAN-001"&&e==="clean")return console.log("ðŸ§ª Using mock tool data for testing Clean Tool workflow"),{id:"mock-tool-test-clean-001",barcode:"TEST-CLEAN-001",tool_type:"surgical_scissors",tool_name:"Test Surgical Scissors",status:"clean",facility_id:"550e8400-e29b-41d4-a716-446655440000",current_cycle_id:"00000000-0000-0000-0000-000000000000",location:"Sterilization Room",sterilization_count:0,notes:"Mock tool for testing Clean Tool workflow",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),latitude:null,longitude:null,gps_accuracy:null,location_timestamp:null,maintenance_due_date:null,metadata:null,model:"Test Model",manufacturer:"Test Manufacturer",serial_number:"TEST-001",is_p2_tool:!1};const t=yield Ue(),{data:n,error:a}=yield _.from("tools").select("id, tool_name, barcode, facility_id, current_cycle_id, status, is_p2_tool").eq("barcode",r).eq("status",e).eq("facility_id",t).single();if(a)throw a;return n})},getToolsByFacilityAndStatus(r,e){return Ee(this,null,function*(){const{data:t,error:n}=yield _.from("tools").select("id, tool_name, barcode, facility_id, current_cycle_id, status, is_p2_tool").eq("facility_id",r).eq("status",e);if(n)throw n;return t})},getToolsByStatuses(r){return Ee(this,null,function*(){const e=yield Ue(),{data:t,error:n}=yield _.from("tools").select("id, tool_name, barcode, facility_id, current_cycle_id, status, is_p2_tool").in("status",r).eq("facility_id",e);if(n)throw n;return t})},updateToolsStatus(r,e){return Ee(this,null,function*(){const t={status:e,facility_id:yield Ue(),updated_at:new Date().toISOString()},{data:n,error:a}=yield _.from("tools").update(t).in("id",r).select();if(a)throw a;return n!=null?n:[]})},updateToolsCyclePhase(r,e,t,n){return Ee(this,null,function*(){const a={status:e,facility_id:yield Ue(),updated_at:new Date().toISOString()},{data:i,error:c}=yield _.from("tools").update(a).in("id",r).select();if(c)throw c;return i!=null?i:[]})},clearCycleAssignment(r,e){return Ee(this,null,function*(){const t=r.filter(l=>l.startsWith("mock-tool-")),n=r.filter(l=>!l.startsWith("mock-tool-"));if(t.length>0&&console.log("ðŸ§ª Skipping database update for mock tools:",t),n.length===0)return t.map(l=>({id:l,status:e,current_cycle_id:"00000000-0000-0000-0000-000000000000",current_phase:null,updated_at:new Date().toISOString()}));const a={status:e,facility_id:yield Ue(),updated_at:new Date().toISOString()},{data:i,error:c}=yield _.from("tools").update(a).in("id",n).select();if(c)throw c;return i!=null?i:[]})},markAsSterilized(r){return Ee(this,null,function*(){if(r.startsWith("mock-tool-"))return console.log("ðŸ§ª Skipping database update for mock tool:",r),{id:r,last_sterilized:new Date().toISOString(),updated_at:new Date().toISOString()};const e={facility_id:yield Ue(),updated_at:new Date().toISOString()},{data:t,error:n}=yield _.from("tools").update(e).eq("id",r).select().single();if(n)throw n;return t})},updateToolPhase(r,e){return Ee(this,null,function*(){const t={facility_id:yield Ue(),updated_at:new Date().toISOString()},{data:n,error:a}=yield _.from("tools").update(t).eq("id",r).select().single();if(a)throw a;return n})},touchTools(r){return Ee(this,null,function*(){const e={facility_id:yield Ue(),updated_at:new Date().toISOString()},{data:t,error:n}=yield _.from("tools").update(e).in("id",r).select();if(n)throw n;return t!=null?t:[]})},persistProblemTool(r,e,t){return Ee(this,null,function*(){if(r.startsWith("mock-tool-"))return console.log("ðŸ§ª Skipping database update for mock tool:",r),{id:r,status:"problem",updated_at:new Date().toISOString()};const n=yield Ue(),a=yield Sb(),i={status:"problem",facility_id:n,updated_at:new Date().toISOString(),notes:t?`PROBLEM: ${e} - ${t}`:`PROBLEM: ${e}`},{data:c,error:l}=yield _.from("tools").update(i).eq("id",r).select().single();if(l)throw l;yield this.clearCycleAssignment([r],"problem");const{error:o}=yield _.from("audit_logs").insert({id:crypto.randomUUID(),module:"sterilization",table_name:"tools",action:"tool_marked_problem",record_id:r,user_id:a,facility_id:n,old_values:{status:"available"},new_values:{status:"problem",notes:i.notes},metadata:{problem_type:e,problem_notes:t,timestamp:new Date().toISOString()},created_at:new Date().toISOString()});return o&&console.error("Failed to log problem tool audit event:",o),yield _.from("inventory_items").update({is_available:!1}).eq("tool_id",r).eq("facility_id",n),c})}};var He=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class jb{scanOperationalGaps(e){return He(this,null,function*(){const t=[],n=yield this.scanEquipmentMaintenance(e);t.push(...n);const a=yield this.scanComplianceGaps(e);t.push(...a);const i=yield this.scanOperationalIssues(e);t.push(...i);const c=yield this.scanSafetyGaps(e);return t.push(...c),t})}scanEquipmentMaintenance(e){return He(this,null,function*(){const t=[],n=new Date;try{const a=yield this.scanAutoclaveMaintenance(e,n);t.push(...a);const i=yield this.scanToolMaintenance(e);t.push(...i)}catch(a){console.error("Error scanning equipment maintenance:",a)}return t})}scanAutoclaveMaintenance(e,t){return He(this,null,function*(){const n=[],{data:a,error:i}=yield _.from("autoclaves").select("*").eq("facility_id",e).eq("status","active");if(i)throw i;return a==null||a.forEach(c=>{const l=c;l.next_maintenance&&new Date(l.next_maintenance)<=t&&n.push({id:At(),type:"equipment",priority:"high",title:`Autoclave Maintenance Due: ${l.autoclave_name}`,description:`Maintenance is due for autoclave ${l.autoclave_name}. Schedule maintenance to ensure proper operation.`,category:"equipment",dueDate:l.next_maintenance,estimatedPoints:75,estimatedDuration:120,assignedRole:"technician",facilityId:e,metadata:{autoclaveId:l.id,equipmentType:"autoclave"}}),l.calibration_due&&new Date(l.calibration_due)<=t&&n.push({id:At(),type:"compliance",priority:"urgent",title:`Autoclave Calibration Due: ${l.autoclave_name}`,description:`Calibration is due for autoclave ${l.autoclave_name}. This is critical for compliance.`,category:"compliance",dueDate:l.calibration_due,estimatedPoints:100,estimatedDuration:60,assignedRole:"technician",facilityId:e,metadata:{autoclaveId:l.id,equipmentType:"autoclave"}})}),n})}scanToolMaintenance(e){return He(this,null,function*(){const t=[],n=yield Fe.getToolsByFacilityAndStatus(e,"problem");return n==null||n.forEach(a=>{t.push({id:At(),type:"equipment",priority:"medium",title:`Tool Maintenance Required: ${a.name||a.id}`,description:`Tool ${a.name||a.id} requires maintenance. Check condition and repair if possible.`,category:"equipment",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:50,estimatedDuration:45,assignedRole:"technician",facilityId:e,metadata:{toolId:a.id,toolName:a.name||a.id}})}),t})}scanComplianceGaps(e){return He(this,null,function*(){const t=[],n=new Date;try{const a=yield this.scanBITests(e,n);t.push(...a);const i=yield this.scanCleaningTasks(e,n);t.push(...i)}catch(a){console.error("Error scanning compliance gaps:",a)}return t})}scanBITests(e,t){return He(this,null,function*(){const n=[],{data:a,error:i}=yield _.from("biological_indicator_tests").select("*").eq("facility_id",e).eq("status","pending").lte("due_date",t.toISOString().split("T")[0]);if(i)throw i;return a==null||a.forEach(c=>{const l=c;n.push({id:At(),type:"compliance",priority:"urgent",title:"Daily BI Test Required",description:"Daily Biological Indicator test is required for sterilization compliance.",category:"compliance",dueDate:l.due_date,estimatedPoints:80,estimatedDuration:30,assignedRole:"operator",facilityId:e,metadata:{biTestId:l.id,testType:"daily_bi"}})}),n})}scanCleaningTasks(e,t){return He(this,null,function*(){const n=[],{data:a,error:i}=yield _.from("cleaning_tasks").select("*").eq("facility_id",e).eq("status","pending").lte("due_date",t.toISOString());if(i)throw i;return a==null||a.forEach(c=>{const l=c;n.push({id:At(),type:"compliance",priority:l.priority==="critical"?"urgent":"high",title:`Cleaning Task Overdue: ${l.name}`,description:`Cleaning task "${l.name}" is overdue. Complete to maintain compliance.`,category:"compliance",dueDate:l.due_date,estimatedPoints:60,estimatedDuration:l.estimated_duration_minutes||60,assignedRole:"cleaning_staff",facilityId:e,metadata:{taskId:l.id,taskName:l.name,location:l.location}})}),n})}scanOperationalIssues(e){return He(this,null,function*(){const t=[];try{const n=yield this.scanStuckTools(e);t.push(...n);const a=yield this.scanLowInventory(e);t.push(...a)}catch(n){console.error("Error scanning operational issues:",n)}return t})}scanStuckTools(e){return He(this,null,function*(){const t=[],n=["bath1","bath2","airDry","autoclave"],i=(yield Promise.all(n.map(c=>Fe.getToolsByFacilityAndStatus(e,c)))).flat();return i==null||i.forEach(c=>{t.push({id:At(),type:"operational",priority:"medium",title:`Tool Stuck in Phase: ${c.name||c.id}`,description:`Tool ${c.name||c.id} appears to be stuck in ${c.status} phase. Check workflow status.`,category:"operational",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:40,estimatedDuration:30,assignedRole:"operator",facilityId:e,metadata:{toolId:c.id,toolName:c.name||c.id,currentPhase:c.status}})}),t})}scanLowInventory(e){return He(this,null,function*(){const t=[],a=(yield nt.getItems()).filter(i=>{var c,l;return i.facility_id===e&&(i.quantity||0)<(((c=i.data)==null?void 0:c.min_quantity)||0)&&((l=i.data)==null?void 0:l.isActive)===!0});return a==null||a.forEach(i=>{var c;t.push({id:At(),type:"operational",priority:"high",title:`Low Stock Alert: ${i.name}`,description:`Inventory item ${i.name} is running low. Current quantity: ${i.quantity}.`,category:"operational",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:35,estimatedDuration:20,assignedRole:"inventory_manager",facilityId:e,metadata:{itemId:i.id,itemName:i.name,currentQuantity:i.quantity,minQuantity:(c=i.data)==null?void 0:c.min_quantity}})}),t})}scanSafetyGaps(e){return He(this,null,function*(){const t=[];try{const n=yield this.scanFailedCycles(e);t.push(...n)}catch(n){console.error("Error scanning safety gaps:",n)}return t})}scanFailedCycles(e){return He(this,null,function*(){const t=[],{data:n,error:a}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e).eq("status","failed").gte("created_at",new Date(Date.now()-6048e5).toISOString());if(a)throw a;return n==null||n.forEach(i=>{const c=i;t.push({id:At(),type:"safety",priority:"high",title:`Investigate Failed Cycle: ${c.id}`,description:`Sterilization cycle ${c.id} failed and requires investigation to prevent future failures.`,category:"safety",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:70,estimatedDuration:90,assignedRole:"supervisor",facilityId:e,metadata:{cycleId:c.id,failureReason:c.failure_reason}})}),t})}getGapStatistics(e){const t=e.length,n=e.reduce((d,u)=>(d[u.type]=(d[u.type]||0)+1,d),{}),a=e.reduce((d,u)=>(d[u.priority]=(d[u.priority]||0)+1,d),{}),i=e.reduce((d,u)=>(d[u.category]=(d[u.category]||0)+1,d),{}),c=e.reduce((d,u)=>(d[u.assignedRole]=(d[u.assignedRole]||0)+1,d),{}),l=t>0?e.reduce((d,u)=>d+u.estimatedPoints,0)/t:0,o=e.reduce((d,u)=>d+u.estimatedDuration,0);return{total:t,byType:n,byPriority:a,byCategory:i,byRole:c,averagePoints:l,totalEstimatedDuration:o}}filterGaps(e,t){return e.filter(n=>!(t.type&&n.type!==t.type||t.priority&&n.priority!==t.priority||t.category&&n.category!==t.category||t.assignedRole&&n.assignedRole!==t.assignedRole||t.facilityId&&n.facilityId!==t.facilityId))}sortGapsByPriority(e){const t={urgent:4,high:3,medium:2,low:1};return e.sort((n,a)=>{const i=(t[a.priority]||0)-(t[n.priority]||0);return i!==0?i:new Date(n.dueDate).getTime()-new Date(a.dueDate).getTime()})}getGapsDueToday(e){const t=new Date().toISOString().split("T")[0];return e.filter(n=>n.dueDate<=t)}getOverdueGaps(e){const t=new Date().toISOString().split("T")[0];return e.filter(n=>n.dueDate<t)}}var Cb=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Nb{assignTasksWithAI(e,t,n){return Cb(this,null,function*(){try{const a=this.prepareAnalysisData(e,t,n),i=yield am({prompt:this.buildAIPrompt(a),context:"Daily Operations Task Assignment"});return this.parseAITaskAssignments(i,e,t,n)}catch(a){return console.error("AI task assignment failed, using fallback logic:",a),this.fallbackTaskAssignment(e,t,n)}})}prepareAnalysisData(e,t,n){return{operationalGaps:e,availableUsers:t,configuration:n,facilityContext:{totalGaps:e.length,gapTypes:e.reduce((a,i)=>(a[i.type]=(a[i.type]||0)+1,a),{}),priorityDistribution:e.reduce((a,i)=>(a[i.priority]=(a[i.priority]||0)+1,a),{})}}}buildAIPrompt(e){return`Analyze the following operational gaps and assign tasks to users optimally:

Operational Gaps: ${JSON.stringify(e.operationalGaps,null,2)}
Available Users: ${JSON.stringify(e.availableUsers,null,2)}
Configuration: ${JSON.stringify(e.configuration,null,2)}
Facility Context: ${JSON.stringify(e.facilityContext,null,2)}

Please provide a JSON response with task assignments that:
1. Respects max tasks per user (${e.configuration.maxTasksPerUser})
2. Prioritizes urgent and high priority tasks
3. Matches user roles to task categories
4. Balances workload across users
5. Considers task priority and estimated duration

Return ONLY valid JSON in this exact format:
[
  {
    "userId": "user_id_here",
    "tasks": [
      {
        "gapId": "gap_id_here"
      }
    ]
  }
]

Each task should reference a gapId from the operational gaps. Do not include any explanatory text, only the JSON array.`}parseAITaskAssignments(e,t,n,a){try{const i=e.match(/\[[\s\S]*\]/);if(!i)return console.warn("No JSON array found in AI response, using fallback"),this.fallbackTaskAssignment(t,n,a);const c=JSON.parse(i[0]);if(!Array.isArray(c))return console.warn("AI response is not an array, using fallback"),this.fallbackTaskAssignment(t,n,a);const l=[],o=new Map(n.map(u=>[u.id,u])),d=new Map(t.map(u=>[u.id,u]));for(const u of c){if(!u.userId||!Array.isArray(u.tasks))continue;if(!o.get(u.userId)){console.warn(`User ${u.userId} not found, skipping assignment`);continue}const p=[];for(const f of u.tasks){if(!f.gapId)continue;const g=d.get(f.gapId);g&&p.push({id:vb(),title:g.title,description:g.description,category:g.category,priority:g.priority,points:g.estimatedPoints,estimatedDuration:g.estimatedDuration,dueDate:g.dueDate,type:g.type,assignedRole:g.assignedRole,facilityId:g.facilityId,metadata:g.metadata,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}p.length>0&&l.push({userId:u.userId,tasks:p})}return l.length>0?l:(console.warn("AI parsing produced no valid assignments, using fallback"),this.fallbackTaskAssignment(t,n,a))}catch(i){return console.error("Error parsing AI response:",i),this.fallbackTaskAssignment(t,n,a)}}fallbackTaskAssignment(e,t,n){const a=[],i=[...e].sort((l,o)=>Gl(o.priority)-Gl(l.priority)),c=new Map;for(const l of i){const o=t.filter(u=>(c.get(u.id)||0)<n.maxTasksPerUser);if(o.length===0)break;const d=this.findBestUserMatch(l,o);if(d){const u=c.get(d.id)||0;c.set(d.id,u+1);let h=a.find(p=>p.userId===d.id);h||(h={userId:d.id,tasks:[]},a.push(h)),h.tasks.push({id:yb(),title:l.title,description:l.description,category:l.category,priority:l.priority,points:l.estimatedPoints,dueDate:l.dueDate,type:l.type,estimatedDuration:l.estimatedDuration,assignedRole:l.assignedRole,facilityId:l.facilityId,metadata:l.metadata,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}}return a}findBestUserMatch(e,t){if(e.assignedRole){const a=t.find(i=>i.role===e.assignedRole);if(a)return a}const n=t.filter(a=>dm(a.role,e.category));return n.length>0?n[0]:t[0]||null}validateTaskAssignments(e,t){const n=[],a=[];return e.forEach((i,c)=>{var l;i.userId||n.push(`Assignment ${c+1}: Missing userId`),(!i.tasks||i.tasks.length===0)&&a.push(`Assignment ${c+1}: No tasks assigned`),i.tasks&&i.tasks.length>t.maxTasksPerUser&&n.push(`Assignment ${c+1}: Exceeds max tasks per user (${i.tasks.length} > ${t.maxTasksPerUser})`),(l=i.tasks)==null||l.forEach((o,d)=>{o.title||n.push(`Assignment ${c+1}, Task ${d+1}: Missing title`),o.category||n.push(`Assignment ${c+1}, Task ${d+1}: Missing category`),o.priority||n.push(`Assignment ${c+1}, Task ${d+1}: Missing priority`),o.points<=0&&a.push(`Assignment ${c+1}, Task ${d+1}: Zero or negative points`),o.estimatedDuration<=0&&a.push(`Assignment ${c+1}, Task ${d+1}: Zero or negative duration`)})}),{isValid:n.length===0,errors:n,warnings:a}}getAssignmentStatistics(e){const t=e.length,n=e.reduce((d,u)=>d+u.tasks.length,0),a=t>0?n/t:0,i={},c={};let l=0,o=0;return e.forEach(d=>{d.tasks.forEach(u=>{i[u.priority]=(i[u.priority]||0)+1,c[u.category]=(c[u.category]||0)+1,l+=u.points,o+=u.estimatedDuration})}),{totalAssignments:t,totalTasks:n,averageTasksPerUser:a,tasksByPriority:i,tasksByCategory:c,totalPoints:l,totalEstimatedDuration:o}}optimizeTaskAssignments(e,t){const n=new Map;e.forEach(c=>{const l={taskCount:c.tasks.length,totalPoints:c.tasks.reduce((o,d)=>o+d.points,0),totalDuration:c.tasks.reduce((o,d)=>o+d.estimatedDuration,0)};n.set(c.userId,l)});const a=[...e];return Array.from(n.entries()).filter(([c,l])=>l.taskCount>t.maxTasksPerUser).map(([c,l])=>c).forEach(c=>{const l=a.find(u=>u.userId===c);if(!l)return;const o=l.tasks.slice(t.maxTasksPerUser);l.tasks=l.tasks.slice(0,t.maxTasksPerUser);const d=a.filter(u=>u.tasks.length<t.maxTasksPerUser&&u.userId!==c);o.forEach(u=>{if(d.length>0){const h=d[0];h.tasks.push(u);const p=d.findIndex(f=>f.userId===h.userId);p>=0&&h.tasks.length>=t.maxTasksPerUser&&d.splice(p,1)}})}),a}exportTaskAssignments(e){return JSON.stringify(e,null,2)}importTaskAssignments(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,assignments:[],errors:["Invalid format: expected array of assignments"]};const n=[];return t.forEach((a,i)=>{a.userId||n.push(`Assignment ${i+1}: Missing userId`),(!a.tasks||!Array.isArray(a.tasks))&&n.push(`Assignment ${i+1}: Missing or invalid tasks array`)}),{success:n.length===0,assignments:t,errors:n}}catch(t){return{success:!1,assignments:[],errors:["Invalid JSON format"]}}}}var on=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Ib{getFacilityUsers(e){return on(this,null,function*(){const{data:t,error:n}=yield _.from("users").select("id, full_name, role, department, is_active, facility_id").eq("facility_id",e).eq("is_active",!0);if(n)throw n;return(t||[]).map(a=>{const i=a;return{id:i.id,role:i.role,full_name:i.full_name,department:i.department,is_active:i.is_active,facility_id:i.facility_id}})})}getUsersByRole(e,t){return on(this,null,function*(){return(yield this.getFacilityUsers(e)).filter(a=>a.role===t)})}getUsersByDepartment(e,t){return on(this,null,function*(){return(yield this.getFacilityUsers(e)).filter(a=>a.department===t)})}getAvailableRoles(){return[{role:"technician",description:"Equipment maintenance and repair specialist",capabilities:["equipment_maintenance","tool_repair","calibration"],compatibleCategories:["equipment","compliance"]},{role:"operator",description:"Daily operations and sterilization specialist",capabilities:["sterilization","daily_operations","bi_testing"],compatibleCategories:["operational","compliance"]},{role:"cleaning_staff",description:"Environmental cleaning and sanitation specialist",capabilities:["environmental_cleaning","sanitization","compliance"],compatibleCategories:["compliance","operational"]},{role:"inventory_manager",description:"Inventory management and supply specialist",capabilities:["inventory_management","supply_ordering","stock_control"],compatibleCategories:["operational"]},{role:"supervisor",description:"Operations oversight and safety specialist",capabilities:["safety_investigation","quality_control","oversight"],compatibleCategories:["safety","operational"]},{role:"manager",description:"Facility management and coordination",capabilities:["facility_management","coordination","planning"],compatibleCategories:["operational","safety","compliance"]}]}isRoleCompatibleWithCategory(e,t){const a=this.getAvailableRoles().find(i=>i.role===e);return a?a.compatibleCategories.includes(t):!1}getRoleCapabilities(e){const n=this.getAvailableRoles().find(a=>a.role===e);return(n==null?void 0:n.capabilities)||[]}findBestUserMatch(e,t,n){if(e.assignedRole){const i=t.find(c=>c.role===e.assignedRole);if(i)return i}const a=t.filter(i=>this.isRoleCompatibleWithCategory(i.role,e.category));return a.length>0?n?a.reduce((i,c)=>{const l=n.get(i.id),o=n.get(c.id);return l?o&&o.utilization<l.utilization?c:i:c}):a[0]:n&&t.length>0?t.reduce((i,c)=>{const l=n.get(i.id),o=n.get(c.id);return l?o&&o.utilization<l.utilization?c:i:c}):t[0]||null}calculateUserWorkload(e,t,n,a,i=5){const c=i,l=c>0?t/c*100:0;return{userId:e,currentTasks:t,totalPoints:n,totalDuration:a,capacity:c,utilization:l}}getUserWorkloadStatistics(e,t){const n=e.length;let a=0,i=0,c=0;const l={},o={low:0,medium:0,high:0};e.forEach(u=>{const h=t.get(u.id);h&&(a+=h.utilization,h.utilization>100?i++:h.utilization<50&&c++,h.utilization<50?o.low++:h.utilization<=80?o.medium++:o.high++,l[u.role]=(l[u.role]||0)+h.utilization)});const d=n>0?a/n:0;return{totalUsers:n,averageUtilization:d,overloadedUsers:i,underutilizedUsers:c,workloadByRole:l,workloadDistribution:o}}getUsersWithCapacity(e,t,n){return e.filter(a=>{const i=t.get(a.id);return!i||i.currentTasks<n})}getOverloadedUsers(e,t,n){return e.filter(a=>{const i=t.get(a.id);return i&&i.currentTasks>n})}balanceWorkload(e,t,n){const a=[],i=this.getOverloadedUsers(e,t,n),c=this.getUsersWithCapacity(e,t,n);return i.length>0&&(c.length>0?a.push({type:"redistribute",description:`Redistribute tasks from ${i.length} overloaded users to ${c.length} users with capacity`,priority:"high"}):a.push({type:"add_user",description:"All users are at capacity. Consider adding more staff or increasing capacity limits",priority:"high"})),Array.from(t.values()).reduce((o,d)=>o+d.utilization,0)/t.size>90&&a.push({type:"reduce_tasks",description:"Overall utilization is very high. Consider reducing task load or adding resources",priority:"medium"}),{recommendations:a,canBalance:c.length>0}}getUserPerformanceMetrics(e,t){return on(this,null,function*(){return(yield this.getFacilityUsers(e)).map(a=>({userId:a.id,userName:a.full_name,role:a.role,tasksCompleted:0,averageCompletionTime:0,pointsEarned:0,efficiency:0}))})}validateUserData(e){const t=[];(!e.id||e.id.trim()==="")&&t.push("User ID is required"),(!e.role||e.role.trim()==="")&&t.push("User role is required"),(!e.full_name||e.full_name.trim()==="")&&t.push("Full name is required"),(!e.facility_id||e.facility_id.trim()==="")&&t.push("Facility ID is required");const n=this.getAvailableRoles();return e.role&&!n.find(a=>a.role===e.role)&&t.push(`Invalid role: ${e.role}`),{isValid:t.length===0,errors:t}}exportUserData(e){return JSON.stringify(e,null,2)}importUserData(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,users:[],errors:["Invalid format: expected array of users"]};const n=[];return t.forEach((a,i)=>{const c=this.validateUserData(a);c.isValid||n.push(`User ${i+1}: ${c.errors.join(", ")}`)}),{success:n.length===0,users:t,errors:n}}catch(t){return{success:!1,users:[],errors:["Invalid JSON format"]}}}}var Tb=Object.defineProperty,Eb=Object.defineProperties,kb=Object.getOwnPropertyDescriptors,Yl=Object.getOwnPropertySymbols,Db=Object.prototype.hasOwnProperty,Pb=Object.prototype.propertyIsEnumerable,Jl=(r,e,t)=>e in r?Tb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ob=(r,e)=>{for(var t in e||(e={}))Db.call(e,t)&&Jl(r,t,e[t]);if(Yl)for(var t of Yl(e))Pb.call(e,t)&&Jl(r,t,e[t]);return r},Rb=(r,e)=>Eb(r,kb(e));const Xl={inventory_items:{defaultLimit:50,maxLimit:200,maxOffset:1e4,allowedOrderByFields:["created_at","updated_at","name","category","quantity"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},sterilization_cycles:{defaultLimit:100,maxLimit:500,maxOffset:5e3,allowedOrderByFields:["start_time","created_at","cycle_number","status"],defaultOrderBy:"start_time",defaultOrderDirection:"desc"},audit_logs:{defaultLimit:100,maxLimit:500,maxOffset:2e3,allowedOrderByFields:["created_at","action","module"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},users:{defaultLimit:100,maxLimit:500,maxOffset:2e3,allowedOrderByFields:["created_at","email","role"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},admin_task_config:{defaultLimit:20,maxLimit:100,maxOffset:1e3,allowedOrderByFields:["facility_id","created_at","updated_at"],defaultOrderBy:"facility_id",defaultOrderDirection:"asc"},default:{defaultLimit:50,maxLimit:200,maxOffset:5e3,allowedOrderByFields:["created_at","id"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"}};function Yn(r={},e="default"){const t=Xl[e]||Xl.default;let n=r.limit||t.defaultLimit;n<=0&&(n=t.defaultLimit),n>t.maxLimit&&($.warn(`Query limit ${n} exceeds maximum ${t.maxLimit} for table ${e}, capping to maximum`),n=t.maxLimit);let a=r.offset||0;a<0&&(a=0),a>t.maxOffset&&($.warn(`Query offset ${a} exceeds maximum ${t.maxOffset} for table ${e}, capping to maximum`),a=t.maxOffset);let i=r.orderBy||t.defaultOrderBy;t.allowedOrderByFields.includes(i)||($.warn(`Order by field '${i}' not allowed for table ${e}, using default '${t.defaultOrderBy}'`),i=t.defaultOrderBy);const c=r.orderDirection||t.defaultOrderDirection;return["asc","desc"].includes(c)||$.warn(`Invalid order direction '${c}' for table ${e}, using default '${t.defaultOrderDirection}'`),Rb(Ob({},r),{limit:n,offset:a,orderBy:i,orderDirection:c})}function Ab(r,e={},t="default"){const n=Yn(e,t);return{query:r.limit(n.limit).range(n.offset,n.offset+n.limit-1),offset:n.offset,limit:n.limit}}function $b(r,e={},t="default"){const n=Yn(e,t);return r.order(n.orderBy,{ascending:n.orderDirection==="asc"})}function Mb(r,e,t={},n="default"){const a=Yn(t,n),i=Math.ceil(e/a.limit),c=Math.floor(a.offset/a.limit)+1;return{data:r,total:e,page:c,limit:a.limit,totalPages:i,hasNext:c<i,hasPrev:c>1}}function Fb(r,e){return["id","created_at","updated_at"].join(", ")}function Lb(r,e={},t="default"){const n=Yn(e,t),a=$b(r,n,t),{query:i}=Ab(a,n,t);return{query:i,safeOptions:n,warnings:[]}}var zb=Object.defineProperty,Bb=Object.defineProperties,qb=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertySymbols,Ub=Object.prototype.hasOwnProperty,Hb=Object.prototype.propertyIsEnumerable,ec=(r,e,t)=>e in r?zb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vb=(r,e)=>{for(var t in e||(e={}))Ub.call(e,t)&&ec(r,t,e[t]);if(Zl)for(var t of Zl(e))Hb.call(e,t)&&ec(r,t,e[t]);return r},Wb=(r,e)=>Bb(r,qb(e)),$t=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Sa{static getConfig(e){return $t(this,null,function*(){try{const{data:t,error:n}=yield _.from("admin_task_config").select("id, facility_id, max_tasks_per_user, enabled_categories, priority_thresholds, auto_assignment, ai_sensitivity, ai_confidence_threshold, max_ai_processing_time_ms, workload_balancing_enabled, max_concurrent_tasks_per_user, role_category_mapping, task_notifications_enabled, notification_channels, compliance_tracking_enabled, audit_logging_enabled, task_optimization_enabled, predictive_assignment_enabled, created_by, updated_by, created_at, updated_at").eq("facility_id",e).single();if(n){if(n.code==="PGRST116")return $.info(`No admin config found for facility ${e}, creating default`),yield this.createDefaultConfig(e);throw n}return this.mapDatabaseToConfig(t)}catch(t){throw $.error("Error getting admin task config:",t),new Error("Failed to retrieve admin task configuration")}})}static updateConfig(e,t){return $t(this,null,function*(){return this.upsertConfig(e,t)})}static upsertConfig(e,t){return $t(this,null,function*(){try{const n=ub(t),a=ut(),i={facility_id:e,max_tasks_per_user:n.maxTasksPerUser,enabled_categories:n.enabledCategories,priority_thresholds:n.priorityThresholds,auto_assignment:n.autoAssignment,ai_sensitivity:n.aiSensitivity,ai_confidence_threshold:.75,max_ai_processing_time_ms:3e4,workload_balancing_enabled:!0,max_concurrent_tasks_per_user:5,role_category_mapping:{equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]},task_notifications_enabled:!0,notification_channels:["email","in_app"],compliance_tracking_enabled:!0,audit_logging_enabled:!0,task_optimization_enabled:!0,predictive_assignment_enabled:!0,updated_by:a},{data:c,error:l}=yield _.from("admin_task_config").upsert(i,{onConflict:"facility_id",ignoreDuplicates:!1}).select("*").single();if(l)throw l;return $.info(`Admin task config updated for facility ${e}`),this.mapDatabaseToConfig(c)}catch(n){throw $.error("Error upserting admin task config:",n),new Error("Failed to save admin task configuration")}})}static createDefaultConfig(e){return $t(this,null,function*(){try{const t=ut(),n={facility_id:e,max_tasks_per_user:3,enabled_categories:["equipment","compliance","operational","safety"],priority_thresholds:{low:1,medium:2,high:3,urgent:4},auto_assignment:!0,ai_sensitivity:"medium",ai_confidence_threshold:.75,max_ai_processing_time_ms:3e4,workload_balancing_enabled:!0,max_concurrent_tasks_per_user:5,role_category_mapping:{equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]},task_notifications_enabled:!0,notification_channels:["email","in_app"],compliance_tracking_enabled:!0,audit_logging_enabled:!0,task_optimization_enabled:!0,predictive_assignment_enabled:!0,created_by:t,updated_by:t},{data:a,error:i}=yield _.from("admin_task_config").insert(n).select("*").single();if(i)throw i;return $.info(`Default admin task config created for facility ${e}`),this.mapDatabaseToConfig(a)}catch(t){throw $.error("Error creating default admin task config:",t),new Error("Failed to create default admin task configuration")}})}static deleteConfig(e){return $t(this,null,function*(){try{const{error:t}=yield _.from("admin_task_config").delete().eq("facility_id",e);if(t)throw t;$.info(`Admin task config deleted for facility ${e}`)}catch(t){throw $.error("Error deleting admin task config:",t),new Error("Failed to delete admin task configuration")}})}static mapDatabaseToConfig(e){var t;return{maxTasksPerUser:e.max_tasks_per_user,enabledCategories:e.enabled_categories||[],priorityThresholds:e.priority_thresholds||{low:1,medium:2,high:3,urgent:4},priorityWeights:e.priority_weights||{low:1,medium:2,high:3,urgent:4},rolePreferences:e.role_category_mapping||{},timeConstraints:e.time_constraints||{maxTaskDuration:120,minTaskDuration:5},autoAssignment:e.auto_assignment,aiSensitivity:e.ai_sensitivity||"medium",aiEnabled:(t=e.ai_enabled)!=null?t:!0}}static getAllConfigs(){return $t(this,arguments,function*(e={}){try{const{orderBy:t="facility_id",orderDirection:n="asc"}=e,{query:a,safeOptions:i,warnings:c}=Lb(_.from("admin_task_config"),Wb(Vb({},e),{orderBy:t,orderDirection:n}),"admin_task_config"),l=a.select(Fb("admin_task_config"),{count:"exact"}),{data:o,error:d,count:u}=yield l;if(d)throw d;return c.length>0&&$.warn("Admin config query warnings:",c),Mb(o||[],u||0,i,"admin_task_config")}catch(t){throw $.error("Error getting all admin task configs:",t),new Error("Failed to retrieve admin task configurations")}})}static getConfigHistory(e){return $t(this,null,function*(){try{const{data:t,error:n}=yield _.from("admin_task_config").select("*").eq("facility_id",e).order("updated_at",{ascending:!1});if(n)throw n;return(t||[]).map(a=>({id:a.id,config:this.mapDatabaseToConfig(a),updatedAt:new Date(a.updated_at),updatedBy:a.updated_by||"Unknown",changes:[]}))}catch(t){return $.error("Error getting configuration history:",t),[]}})}static hasConfig(e){return $t(this,null,function*(){try{const{count:t,error:n}=yield _.from("admin_task_config").select("*",{count:"exact",head:!0}).eq("facility_id",e);if(n)throw n;return(t||0)>0}catch(t){return $.error("Error checking admin task config existence:",t),!1}})}}var Gb=Object.defineProperty,Kb=Object.defineProperties,Qb=Object.getOwnPropertyDescriptors,tc=Object.getOwnPropertySymbols,Yb=Object.prototype.hasOwnProperty,Jb=Object.prototype.propertyIsEnumerable,rc=(r,e,t)=>e in r?Gb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ln=(r,e)=>{for(var t in e||(e={}))Yb.call(e,t)&&rc(r,t,e[t]);if(tc)for(var t of tc(e))Jb.call(e,t)&&rc(r,t,e[t]);return r},cn=(r,e)=>Kb(r,Qb(e)),dn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Xb{getAdminTaskConfig(e){return dn(this,null,function*(){try{if(!e){const{FacilityService:t}=yield H(()=>Promise.resolve().then(()=>Re),void 0);e=yield t.getCurrentFacilityId()}return yield Sa.getConfig(e)}catch(t){return console.warn("Failed to get admin config from database, using default:",t),wa()}})}updateAdminTaskConfig(e,t){return dn(this,null,function*(){try{return yield Sa.updateConfig(e,t)}catch(n){throw console.error("Failed to update admin config:",n),n}})}resetToDefaults(e){return dn(this,null,function*(){const t=wa();return yield this.updateAdminTaskConfig(e,t)})}validateConfig(e){const t=[],n=[];if(e.maxTasksPerUser!==void 0&&(e.maxTasksPerUser<1&&t.push("Max tasks per user must be at least 1"),e.maxTasksPerUser>20&&n.push("Max tasks per user is very high, may impact user productivity")),e.priorityWeights){const a=e.priorityWeights;a.urgent!==void 0&&a.urgent<1&&t.push("Urgent priority weight must be at least 1"),a.high!==void 0&&a.high<1&&t.push("High priority weight must be at least 1"),a.medium!==void 0&&a.medium<1&&t.push("Medium priority weight must be at least 1"),a.low!==void 0&&a.low<1&&t.push("Low priority weight must be at least 1"),a.urgent&&a.high&&a.urgent<=a.high&&n.push("Urgent priority weight should be higher than high priority"),a.high&&a.medium&&a.high<=a.medium&&n.push("High priority weight should be higher than medium priority"),a.medium&&a.low&&a.medium<=a.low&&n.push("Medium priority weight should be higher than low priority")}if(e.rolePreferences&&Object.entries(e.rolePreferences).forEach(([a,i])=>{Array.isArray(i)?i.forEach(c=>{dm(a,c)||n.push(`Role ${a} may not be compatible with category ${c}`)}):t.push(`Role preferences for ${a} must be an array`)}),e.timeConstraints){const a=e.timeConstraints;a.maxTaskDuration!==void 0&&a.maxTaskDuration<5&&t.push("Max task duration must be at least 5 minutes"),a.minTaskDuration!==void 0&&a.minTaskDuration<1&&t.push("Min task duration must be at least 1 minute"),a.maxTaskDuration&&a.minTaskDuration&&a.maxTaskDuration<=a.minTaskDuration&&t.push("Max task duration must be greater than min task duration")}return{isValid:t.length===0,errors:t,warnings:n}}getConfigurationRecommendations(e,t){const n=[];if(t&&(t.taskCompletionRate<.8&&n.push({category:"performance",title:"Low Task Completion Rate",description:`Current completion rate is ${(t.taskCompletionRate*100).toFixed(1)}%. Consider reducing max tasks per user or improving task assignment.`,priority:"high",suggestedValue:Math.max(1,e.maxTasksPerUser-1)}),t.averageTasksPerUser>e.maxTasksPerUser*.9&&n.push({category:"workload",title:"High User Workload",description:`Users are consistently at ${(t.averageTasksPerUser/e.maxTasksPerUser*100).toFixed(1)}% capacity. Consider increasing max tasks or adding more users.`,priority:"medium",suggestedValue:e.maxTasksPerUser+1}),t.averageTaskDuration>120&&n.push({category:"performance",title:"Long Task Duration",description:`Average task duration is ${t.averageTaskDuration} minutes. Consider breaking down complex tasks or adjusting time estimates.`,priority:"medium"})),e.priorityWeights){const a=e.priorityWeights;a.urgent&&a.high&&a.urgent<=a.high&&n.push({category:"priority",title:"Priority Weight Ordering",description:"Urgent priority weight should be higher than high priority to ensure proper task prioritization.",priority:"medium",suggestedValue:cn(ln({},a),{urgent:a.high+1})})}return(!e.rolePreferences||Object.keys(e.rolePreferences).length===0)&&n.push({category:"role",title:"Missing Role Preferences",description:"No role preferences configured. Consider setting up role-category mappings for better task assignment.",priority:"low",suggestedValue:{technician:["equipment","compliance"],operator:["operational","compliance"],cleaning_staff:["compliance"],inventory_manager:["operational"],supervisor:["safety","operational"]}}),n}getDefaultConfigForFacilityType(e){const t=wa();switch(e){case"small":return cn(ln({},t),{maxTasksPerUser:3,priorityWeights:{urgent:10,high:7,medium:4,low:1}});case"medium":return cn(ln({},t),{maxTasksPerUser:5,priorityWeights:{urgent:12,high:8,medium:5,low:2}});case"large":return cn(ln({},t),{maxTasksPerUser:7,priorityWeights:{urgent:15,high:10,medium:6,low:3}});default:return t}}exportConfig(e){return JSON.stringify(e,null,2)}importConfig(e){try{const t=JSON.parse(e),n=this.validateConfig(t);return{success:n.isValid,config:n.isValid?t:null,errors:n.errors}}catch(t){return{success:!1,config:null,errors:["Invalid JSON format"]}}}getConfigurationHistory(e){return dn(this,null,function*(){try{return yield Sa.getConfigHistory(e)}catch(t){return console.error("Failed to get configuration history:",t),[]}})}compareConfigurations(e,t){const n=[];return new Set([...Object.keys(e),...Object.keys(t)]).forEach(i=>{const c=e[i],l=t[i];c===void 0&&l!==void 0?n.push({field:i,oldValue:void 0,newValue:l,type:"added"}):c!==void 0&&l===void 0?n.push({field:i,oldValue:c,newValue:void 0,type:"removed"}):JSON.stringify(c)!==JSON.stringify(l)&&n.push({field:i,oldValue:c,newValue:l,type:"modified"})}),{changes:n,hasChanges:n.length>0}}getConfigurationSummary(e){var t;const n=e.priorityWeights?Object.keys(e.priorityWeights).length:0,a=e.rolePreferences?Object.keys(e.rolePreferences).length:0,i=!!e.timeConstraints,c=e.aiEnabled!==!1;let l="simple";return(n>2||a>3||i)&&(l="moderate"),(n>3||a>5||i&&((t=e.timeConstraints)!=null&&t.maxTaskDuration))&&(l="complex"),{maxTasksPerUser:e.maxTasksPerUser,priorityCount:n,rolePreferencesCount:a,timeConstraintsEnabled:i,aiEnabled:c,complexity:l}}}var Jn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Zb=new jb,e_=new Nb,t_=new Ib,r_=new Xb;function s_(r){return Jn(this,null,function*(){return Zb.scanOperationalGaps(r)})}function n_(r){return Jn(this,null,function*(){return t_.getFacilityUsers(r)})}function a_(r){return Jn(this,null,function*(){return r_.getAdminTaskConfig(r)})}function i_(r,e,t){return Jn(this,null,function*(){return e_.assignTasksWithAI(r,e,t)})}var ls=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class o_{generateDailyTasks(e){return ls(this,null,function*(){try{const t=yield s_(e);if(t.length===0)return console.log("No operational gaps found for daily tasks"),[];const n=yield n_(e),a=yield a_(),i=yield i_(t,n,a);return yield xb(i,e),i}catch(t){throw console.error("Error generating daily tasks:",t),new Error(`Failed to generate daily tasks: ${t instanceof Error?t.message:"Unknown error"}`)}})}getUserDailyTasks(e){return ls(this,null,function*(){return bb(e)})}getFacilityDailyTasks(e){return ls(this,null,function*(){return _b(e)})}completeDailyTask(e,t){return ls(this,null,function*(){return wb(e,t)})}updateDailyTask(e,t){return ls(this,null,function*(){try{const{data:{user:n}}=yield _.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:a,error:i}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(i||!(a!=null&&a.facility_id))throw new Error("User facility not found");const c={updated_at:new Date().toISOString()};t.title!==void 0&&(c.title=t.title),t.description!==void 0&&(c.description=t.description),t.category!==void 0&&(c.category=t.category),t.difficulty!==void 0&&(c.difficulty=t.difficulty),t.points!==void 0&&(c.points=t.points),t.timeEstimate!==void 0&&(c.time_estimate=t.timeEstimate),t.isCompleted!==void 0&&(c.is_completed=t.isCompleted);const{data:l,error:o}=yield _.from("home_challenges").update(c).eq("id",e).eq("facility_id",a.facility_id).select().single();if(o)throw new Error(`Failed to update task: ${o.message}`);return{id:l.id,title:l.title,description:l.description||"",category:l.category,difficulty:l.difficulty,points:l.points,timeEstimate:l.time_estimate,isCompleted:l.is_completed||!1,completedAt:l.completed_at||null,pointsEarned:l.points_earned||0,createdAt:l.created_at,updatedAt:l.updated_at}}catch(n){throw console.error("Error updating daily task:",n),n}})}}const mm=new o_,de=({path:r,size:e=24,color:t="currentColor",className:n})=>s.jsx(En.Icon,{path:r,size:e,color:t,className:n}),l_=({currentPage:r,totalPages:e,onPageChange:t,onNextPage:n,onPreviousPage:a,hasNextPage:i,hasPreviousPage:c,isLoading:l=!1,className:o=""})=>{if(e<=1)return null;const d=()=>{const u=[];if(e<=5)for(let p=1;p<=e;p++)u.push(p);else if(r<=3){for(let p=1;p<=4;p++)u.push(p);u.push("..."),u.push(e)}else if(r>=e-2){u.push(1),u.push("...");for(let p=e-3;p<=e;p++)u.push(p)}else{u.push(1),u.push("...");for(let p=r-1;p<=r+1;p++)u.push(p);u.push("..."),u.push(e)}return u};return s.jsxs("div",{className:`flex items-center justify-center space-x-2 ${o}`,children:[s.jsxs("button",{onClick:a,disabled:!c||l,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${c&&!l?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:[s.jsx(de,{path:Eu,size:16,className:"mr-1"}),"Previous"]}),s.jsx("div",{className:"flex items-center space-x-1",children:d().map((u,h)=>s.jsx(te.Fragment,{children:u==="..."?s.jsx("span",{className:"px-3 py-2 text-sm text-gray-500",children:"..."}):s.jsx("button",{onClick:()=>t(u),disabled:l,className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${u===r?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"} ${l?"cursor-not-allowed":""}`,children:u})},h))}),s.jsxs("button",{onClick:n,disabled:!i||l,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${i&&!l?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:["Next",s.jsx(de,{path:Ms,size:16,className:"ml-1"})]}),s.jsxs("div",{className:"ml-4 text-sm text-gray-500",children:["Page ",r," of ",e]})]})},c_=({onLoadMore:r,hasMore:e,isLoading:t,className:n="",buttonText:a="Load More",loadingText:i="Loading..."})=>e?s.jsx("div",{className:`flex justify-center ${n}`,children:s.jsx("button",{onClick:r,disabled:t,className:"flex items-center px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t?s.jsxs(s.Fragment,{children:[s.jsx(de,{path:ku,size:16,className:"animate-spin mr-2"}),i]}):s.jsxs(s.Fragment,{children:[a,s.jsx(de,{path:Fs,size:16,className:"ml-2"})]})})}):null;var d_=Object.defineProperty,u_=Object.defineProperties,m_=Object.getOwnPropertyDescriptors,sc=Object.getOwnPropertySymbols,h_=Object.prototype.hasOwnProperty,p_=Object.prototype.propertyIsEnumerable,nc=(r,e,t)=>e in r?d_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ja=(r,e)=>{for(var t in e||(e={}))h_.call(e,t)&&nc(r,t,e[t]);if(sc)for(var t of sc(e))p_.call(e,t)&&nc(r,t,e[t]);return r},Ca=(r,e)=>u_(r,m_(e)),f_=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const g_=({task:r,isOpen:e,onClose:t,onSave:n})=>{const[a,i]=m.useState({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),[c,l]=m.useState({}),[o,d]=m.useState(!1),[u,h]=m.useState(null);m.useEffect(()=>{r&&(i({title:r.title||"",description:r.description||"",priority:r.priority||"medium",dueDate:r.dueDate?new Date(r.dueDate).toISOString().split("T")[0]:"",status:r.status||"pending"}),l({}),h(null))},[r]),m.useEffect(()=>{e||(i({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),l({}),h(null),d(!1))},[e]);const p=m.useCallback(()=>{const v={};if(a.title.trim()?a.title.trim().length<3?v.title="Title must be at least 3 characters long":a.title.trim().length>100&&(v.title="Title must be less than 100 characters"):v.title="Title is required",a.description.trim().length>500&&(v.description="Description must be less than 500 characters"),a.dueDate){const b=new Date(a.dueDate),x=new Date;x.setHours(0,0,0,0),b<x&&(v.dueDate="Due date cannot be in the past")}return l(v),Object.keys(v).length===0},[a]),f=m.useCallback((v,b)=>{i(x=>Ca(ja({},x),{[v]:b})),c[v]&&l(x=>Ca(ja({},x),{[v]:void 0}))},[c]),g=m.useCallback(v=>f_(null,null,function*(){if(v.preventDefault(),!!r&&p()){d(!0),h(null);try{const b=Ca(ja({},r),{title:a.title.trim(),description:a.description.trim()||void 0,priority:a.priority,dueDate:a.dueDate||new Date().toISOString(),status:a.status});yield n(r.id,b),t()}catch(b){h(b instanceof Error?b.message:"Failed to save task")}finally{d(!1)}}}),[r,a,p,n,t]),y=m.useCallback(()=>{o||t()},[o,t]);return m.useEffect(()=>{const v=b=>{b.key==="Escape"&&e&&!o&&t()};if(e)return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[e,o,t]),!e||!r?null:s.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:y,onKeyDown:v=>{v.key==="Escape"&&y()},role:"button",tabIndex:0,"aria-label":"Close modal"}),s.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:s.jsxs("div",{className:"relative w-full max-w-md transform overflow-hidden rounded-lg bg-white shadow-xl transition-all",children:[s.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Task"}),s.jsx("button",{onClick:y,disabled:o,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50","aria-label":"Close modal",children:s.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),s.jsxs("form",{onSubmit:g,className:"px-6 py-4",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),s.jsx("input",{type:"text",id:"title",value:a.title,onChange:v=>f("title",v.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.title?"border-red-300":"border-gray-300"}`,placeholder:"Enter task title",disabled:o}),c.title&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.title})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),s.jsx("textarea",{id:"description",value:a.description,onChange:v=>f("description",v.target.value),rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.description?"border-red-300":"border-gray-300"}`,placeholder:"Enter task description (optional)",disabled:o}),c.description&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.description}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[a.description.length,"/500 characters"]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),s.jsxs("select",{id:"priority",value:a.priority,onChange:v=>f("priority",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o,children:[s.jsx("option",{value:"low",children:"Low"}),s.jsx("option",{value:"medium",children:"Medium"}),s.jsx("option",{value:"high",children:"High"}),s.jsx("option",{value:"urgent",children:"Urgent"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),s.jsx("input",{type:"date",id:"dueDate",value:a.dueDate,onChange:v=>f("dueDate",v.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.dueDate?"border-red-300":"border-gray-300"}`,disabled:o}),c.dueDate&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.dueDate})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),s.jsxs("select",{id:"status",value:a.status,onChange:v=>f("status",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o,children:[s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"completed",children:"Completed"})]})]}),u&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-800",children:u})}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:y,disabled:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:o?"Saving...":"Save Changes"})]})]})]})})]})};var y_=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const v_=({tasks:r,onTaskComplete:e,onTaskUpdate:t})=>{const[n,a]=m.useState(1),[i,c]=m.useState(null),[l,o]=m.useState(null),[d,u]=m.useState(!1),h=10,p=m.useCallback(k=>{if(!k.dueDate)return!1;const P=new Date(k.dueDate);return(new Date().getTime()-P.getTime())/(1e3*60*60)<=24},[]),f=m.useCallback(k=>{const P="task-item border rounded-lg p-4 mb-2",T=p(k);return ur(P,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":T,"shadow-sm":!T})},[p]),g=m.useMemo(()=>Array.isArray(r)?r:[],[r]),y=m.useMemo(()=>g.filter(k=>k.status!=="completed"),[g]),v=m.useMemo(()=>Math.max(1,Math.ceil(y.length/h)),[y.length,h]),b=m.useMemo(()=>(n-1)*h,[n,h]),x=m.useMemo(()=>b+h,[b,h]),w=m.useMemo(()=>y.slice(b,x),[y,b,x]),j=m.useCallback(k=>{c(P=>P===k?null:k)},[]),I=m.useCallback(k=>{o(k),u(!0)},[]),E=m.useCallback((k,P)=>y_(null,null,function*(){if(t)try{yield t(k,P),u(!1),o(null)}catch(T){console.error("Failed to update task:",T)}}),[t]),O=m.useCallback(()=>{u(!1),o(null)},[]),S=m.useCallback(()=>{a(k=>Math.max(1,k-1))},[]),C=m.useCallback(()=>{a(k=>Math.min(v,k+1))},[v]),D=m.useMemo(()=>w.map(k=>s.jsxs("div",{className:f(k),children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>j(k.id),className:"text-gray-400 hover:text-gray-600","aria-label":i===k.id?"Collapse task details":"Expand task details",children:s.jsx("span",{className:`transform transition-transform ${i===k.id?"rotate-90":""}`,children:"â–¶"})}),s.jsx("span",{className:"font-medium",children:k.title}),p(k)&&s.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:"text-sm font-semibold text-[#4ECDC4] bg-[#4ECDC4] bg-opacity-10 px-2 py-1 rounded-full",children:["+",k.points||0," pts"]}),s.jsx("button",{onClick:()=>I(k),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Edit"}),e&&s.jsx("button",{onClick:()=>e(k.id,k.points||0),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Complete"})]})]}),i===k.id&&s.jsxs("div",{className:"mt-3 pt-3 border-t",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-2",children:k.description}),s.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[s.jsxs("div",{children:["Priority: ",k.priority]}),s.jsxs("div",{children:["Status: ",k.status]}),s.jsxs("div",{children:["Points: ",k.points||0]}),k.dueDate&&s.jsxs("div",{children:["Due: ",new Date(k.dueDate).toLocaleDateString()]})]})]})]},k.id)),[w,i,j,I,e,f,p]);return y.length===0?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No tasks available"}):s.jsxs("div",{className:"space-y-4",children:[D,v>1&&s.jsxs("div",{className:"flex items-center justify-between pt-4",children:[s.jsx("button",{onClick:S,disabled:n===1,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),s.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",n," of ",v]}),s.jsx("button",{onClick:C,disabled:n===v,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),s.jsx(g_,{task:l,isOpen:d,onClose:O,onSave:E})]})},x_={COMPLETE:"Complete"};var b_=Object.defineProperty,__=Object.defineProperties,w_=Object.getOwnPropertyDescriptors,ac=Object.getOwnPropertySymbols,S_=Object.prototype.hasOwnProperty,j_=Object.prototype.propertyIsEnumerable,ic=(r,e,t)=>e in r?b_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_r=(r,e)=>{for(var t in e||(e={}))S_.call(e,t)&&ic(r,t,e[t]);if(ac)for(var t of ac(e))j_.call(e,t)&&ic(r,t,e[t]);return r},un=(r,e)=>__(r,w_(e)),C_=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const N_=r=>({id:r.id,title:r.title,description:r.description,status:r.status,priority:r.priority==="urgent"?"high":r.priority||"medium",due_date:r.dueDate,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),user_id:"",facility_id:"",completed:r.completed}),hm=te.memo(({onTaskComplete:r,onTaskUpdate:e,tasks:t,itemHeight:n=120,containerHeight:a=600})=>{const[i,c]=m.useState(null),[l,o]=m.useState(null),[d,u]=m.useState({}),[h,p]=m.useState(0),f=m.useRef(null),g=m.useCallback(T=>{if(!T.dueDate)return!1;const A=new Date(T.dueDate);return(new Date().getTime()-A.getTime())/(1e3*60*60)<=24},[]),y=m.useCallback(T=>{const A="rounded-xl border border-gray-200 p-4 bg-white mx-2",z=g(T);return ur(A,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":z,"shadow-sm":!z})},[g]),v=m.useMemo(()=>Array.isArray(t)?t:[],[t]),b=m.useMemo(()=>v.filter(T=>T.status!=="completed"),[v]),x=Math.ceil(a/n),w=Math.floor(h/n),j=Math.min(w+x+2,b.length),I=m.useMemo(()=>b.slice(w,j),[b,w,j]),E=b.length*n,O=m.useCallback(T=>{p(T.currentTarget.scrollTop)},[]),S=m.useCallback(T=>{c(A=>A===T?null:T)},[]),C=m.useCallback(T=>{o(T.id),u(T)},[]),D=m.useCallback(()=>{o(null),u({})},[]),k=m.useCallback(()=>C_(null,null,function*(){if(l)try{const T=b.find(R=>R.id===l);if(!T){console.error("Task not found for editing");return}const A=_r(_r({},T),d),z=N_(A),{createTaskService:W}=yield H(()=>import("./taskService-BiAedh4o.js"),__vite__mapDeps([6,1,2,3,4,5]));yield W().updateTask(z),e&&e(l,A),o(null),u({})}catch(T){console.error("Failed to save task:",T)}}),[l,b,d,e]),P=m.useMemo(()=>I.map((T,A)=>{const W=(w+A)*n;return s.jsx("div",{className:"absolute w-full",style:{top:W,height:n},children:s.jsxs("div",{className:y(T),children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("button",{onClick:()=>S(T.id),className:"mt-1 text-gray-400 hover:text-gray-600","aria-label":i===T.id?"Collapse task details":"Expand task details",children:s.jsx(Jh,{className:`transform transition-transform ${i===T.id?"rotate-90":""}`})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"font-semibold text-gray-800",children:T.title}),g(T)&&s.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),s.jsx("div",{className:"text-sm text-gray-500",children:`${T.category||"General"} - ${T.type||"Training"} - Due: ${T.dueDate||"N/A"}`})]})]}),s.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[s.jsxs("span",{className:"text-violet-600 font-semibold",children:["+",T.points," pts"]}),s.jsx("button",{onClick:()=>r==null?void 0:r(T.id,T.points||0),className:"rounded-full border border-green-500 text-green-500 text-sm px-3 py-1 hover:bg-green-50","aria-label":`Complete task: ${T.title}`,"data-testid":`task-checkbox-${T.id}`,children:x_.COMPLETE})]})]}),i===T.id&&s.jsxs(s.Fragment,{children:[s.jsx("hr",{className:"my-3"}),s.jsxs("div",{className:"text-sm space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:`category-${T.id}`,className:"block text-gray-600 font-medium mb-1",children:"Category"}),l===T.id?s.jsx("input",{id:`category-${T.id}`,type:"text",value:d.category||"",onChange:M=>u(un(_r({},d),{category:M.target.value})),className:"w-full px-3 py-2 border rounded-md"}):s.jsx("div",{className:"text-gray-700",children:T.category||"General"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`type-${T.id}`,className:"block text-gray-600 font-medium mb-1",children:"Type"}),l===T.id?s.jsx("input",{id:`type-${T.id}`,type:"text",value:d.type||"",onChange:M=>u(un(_r({},d),{type:M.target.value})),className:"w-full px-3 py-2 border rounded-md"}):s.jsx("div",{className:"text-gray-700",children:T.type||"Training"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:`dueDate-${T.id}`,className:"block text-gray-600 font-medium mb-1",children:"Due Date"}),l===T.id?s.jsx("input",{id:`dueDate-${T.id}`,type:"date",value:d.dueDate||"",onChange:M=>u(un(_r({},d),{dueDate:M.target.value})),className:"w-full px-3 py-2 border rounded-md"}):s.jsx("div",{className:"text-gray-700",children:T.dueDate||"N/A"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`points-${T.id}`,className:"block text-gray-600 font-medium mb-1",children:"Points"}),l===T.id?s.jsx("input",{id:`points-${T.id}`,type:"number",value:d.points||0,onChange:M=>u(un(_r({},d),{points:parseInt(M.target.value)})),className:"w-full px-3 py-2 border rounded-md"}):s.jsxs("div",{className:"text-gray-700",children:[T.points||0," points"]})]})]}),s.jsx("div",{className:"mt-4 space-y-4",children:s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("button",{onClick:()=>C(T),className:"rounded-full border border-violet-500 text-violet-500 text-sm px-3 py-1 hover:bg-violet-50","aria-label":`Edit task: ${T.title}`,children:[s.jsx(Xh,{className:"inline-block mr-1"}),"Edit"]})})})}),l===T.id&&s.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[s.jsx("button",{onClick:D,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),s.jsx("button",{onClick:k,className:"px-4 py-2 bg-violet-600 text-white rounded-md hover:bg-violet-700",children:"Save"})]})]})]})]})},T.id)}),[I,w,n,i,l,d,S,r,C,D,k,y,g]);return s.jsx("div",{ref:f,className:"relative overflow-auto",style:{height:a},onScroll:O,children:s.jsx("div",{style:{height:E,position:"relative"},children:P})})});hm.displayName="VirtualizedTasksList";const oc={categories:[{value:"operations",label:"Operations"},{value:"maintenance",label:"Maintenance"},{value:"safety",label:"Safety"}],types:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}]},I_=({selectedCategory:r,selectedType:e,onCategoryChange:t,onTypeChange:n})=>s.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:r,onChange:a=>t(a.target.value),children:[s.jsx("option",{value:"",children:"Category"}),oc.categories.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]}),s.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:e,onChange:a=>n(a.target.value),children:[s.jsx("option",{value:"",children:"Type"}),oc.types.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]}),s.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",children:[s.jsx("option",{value:"",children:"Due Date"}),s.jsx("option",{value:"today",children:"Today"}),s.jsx("option",{value:"tomorrow",children:"Tomorrow"}),s.jsx("option",{value:"this_week",children:"This Week"})]})]})}),T_=(r,e,t)=>{if(!r||r.length===0)return[];let n=r;return e&&(n=n.filter(a=>a.category===e)),t&&(n=n.filter(a=>a.type===t)),n},E_=({tasks:r,onTaskComplete:e,onTaskUpdate:t,availablePoints:n,showFilters:a,onToggleFilters:i,selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d,isLoading:u=!1})=>{const h=m.useMemo(()=>{if(r)return T_(r,c,l)},[r,c,l]),p=m.useMemo(()=>h&&h.length>50,[h]);return u?s.jsx("div",{className:`${ba()} h-full`,"data-testid":"tasks-list",children:s.jsxs("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),s.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((f,g)=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),s.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]},g))})]})}):r?s.jsxs("div",{className:`${ba()} h-full`,"data-testid":"tasks-list",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`bg-${Le.COLORS.PRIMARY_BG} rounded-md p-1`,children:s.jsx(N,{path:ii,size:1,color:Le.COLORS.PRIMARY})}),s.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:Fi.TASKS})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"px-3 py-2 text-sm font-semibold bg-[#4ECDC4] bg-opacity-10 text-[#4ECDC4] border border-[#4ECDC4] border-opacity-30 rounded-lg",children:["ðŸ“Š Total Available: ",n," Points"]}),s.jsxs("button",{onClick:i,className:"p-2 bg-[#4ECDC4] hover:bg-[#38b2ac] rounded-lg text-white flex items-center transition-colors duration-200",children:[s.jsx(N,{path:Du,size:.8}),s.jsx("span",{className:"ml-1 text-sm hidden sm:inline-block",children:"Filter"})]})]})]}),a&&s.jsx(I_,{selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto h-full",children:p?s.jsx(hm,{tasks:h,onTaskComplete:e,onTaskUpdate:t,itemHeight:120,containerHeight:600}):s.jsx(v_,{tasks:h,onTaskComplete:e,onTaskUpdate:t})})]}):s.jsx("div",{className:`${ba()} h-full`,"data-testid":"tasks-list",children:s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsxs("div",{className:"text-gray-500 text-center",children:[s.jsx("div",{className:"text-lg font-medium mb-2",children:"No tasks available"}),s.jsx("div",{className:"text-sm",children:"Tasks will appear here when they become available."})]})})})},k_=m.memo(E_),D_=({message:r="Something went wrong."})=>s.jsx("div",{role:"alert","aria-live":"assertive",className:"text-sm text-red-600 mt-2",children:r});function P_({loading:r,tasks:e,taskError:t}){return r?null:t?s.jsx(D_,{message:"Some tasks may not be available due to a loading error."}):(!e||e.length===0,null)}const pm=te.memo(({tasks:r,loading:e,taskError:t,storeAvailablePoints:n,storeShowFilters:a,setStoreShowFilters:i,selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d,onTaskToggle:u,onTaskUpdate:h})=>s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsx(P_,{loading:e,tasks:r,taskError:t}),s.jsx(As,{children:s.jsx("div",{className:"flex-1",children:s.jsx(k_,{tasks:r,onTaskComplete:u,onTaskUpdate:h,availablePoints:n,showFilters:a,onToggleFilters:()=>i(!a),selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d})})})]}));pm.displayName="HomeTasksSection";const O_=({data:r})=>s.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("span",{className:"bg-blue-100 rounded-md p-2 mr-3",children:s.jsx(Zh,{size:20,className:"text-[#2563eb]"})}),s.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Time Savings"})]}),s.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Day)"}),s.jsxs("span",{className:"text-base text-blue-900 text-right",children:[r.daily," hrs"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Month)"}),s.jsxs("span",{className:"text-base text-blue-900 text-right",children:[r.monthly," hrs"]})]})]})]}),R_=({data:r={monthly:0,annual:0}})=>s.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("span",{className:"bg-green-100 rounded-md p-2 mr-3",children:s.jsx(ep,{size:20,className:"text-green-800"})}),s.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Cost Savings"})]}),s.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Monthly Savings"}),s.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(r.monthly||0).toLocaleString()]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Annual Savings"}),s.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(r.annual||0).toLocaleString()]})]})]})]});var vt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class A_{constructor(){this.baselineData=null,this.lastUpdate=0,this.UPDATE_INTERVAL=120*1e3,this.cachedMetrics=null}getAIImpactMetrics(){return vt(this,null,function*(){try{const e=Date.now();if(e-this.lastUpdate<this.UPDATE_INTERVAL)return this.getCachedMetrics();this.baselineData||(this.baselineData=yield this.getBaselineData());const t=yield this.calculateRealTimeMetrics();return this.cacheMetrics(t),this.lastUpdate=e,t}catch(e){return console.error("Error getting AI impact metrics:",e),this.getDefaultMetrics()}})}calculateRealTimeMetrics(){return vt(this,null,function*(){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());new Date(t.getTime()-t.getDay()*24*60*60*1e3);const n=new Date(e.getFullYear(),e.getMonth(),1),{FacilityService:a}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:i}=yield a.getCurrentUserAndFacility(),{data:c}=yield _.from("ai_task_performance").select("*").eq("facility_id",i).gte("completed_at",n.toISOString()),{data:l}=yield _.from("ai_challenge_completions").select("*").eq("facility_id",i).gte("completed_at",n.toISOString()),o=yield this.calculateProactiveManagement(c||[],l||[]),{aiTimeSavingsService:d}=yield H(()=>Promise.resolve().then(()=>ww),void 0),u=yield d.getAITimeSavings(),h={daily:u.daily_time_saved,weekly:Math.round(u.daily_time_saved*7),monthly:u.monthly_time_saved,total:u.monthly_time_saved,percentage:0},{aiCostCalculationService:p}=yield H(()=>Promise.resolve().then(()=>$_),void 0),f=yield p.calculateCostSavings(h,c||[]),g=yield this.calculateEfficiencyGains(c||[]);return{timeSavings:h,proactiveManagement:o,costSavings:f,efficiencyGains:g,realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:new Date(Date.now()+this.UPDATE_INTERVAL).toISOString(),dataFreshness:Math.floor((Date.now()-this.lastUpdate)/6e4)}}})}calculateTimeSavings(e,t,n,a){return vt(this,null,function*(){var i;const l=e.filter(v=>new Date(v.completed_at)>=t).reduce((v,b)=>v+(b.time_saved||0),0),d=e.filter(v=>new Date(v.completed_at)>=n).reduce((v,b)=>v+(b.time_saved||0),0),u=e.filter(v=>new Date(v.completed_at)>=a),h=u.reduce((v,b)=>v+(b.time_saved||0),0),p=e.reduce((v,b)=>v+(b.time_saved||0),0),f=((i=this.baselineData)==null?void 0:i.preAITaskDuration)||30,g=u.length>0?u.reduce((v,b)=>v+b.actual_duration,0)/u.length:f,y=f>0?Math.round((f-g)/f*100):0;return{daily:l,weekly:d,monthly:h,total:p,percentage:Math.max(0,Math.min(100,y))}})}calculateProactiveManagement(e,t){return vt(this,null,function*(){const n=new Date;n.setHours(n.getHours()+2);const a=e.filter(f=>new Date(f.completed_at)<n).length,i=e.filter(f=>f.estimated_duration&&f.actual_duration&&f.actual_duration<f.estimated_duration).length,c=e.length,l=e.filter(f=>f.estimated_duration&&f.actual_duration&&f.actual_duration<=f.estimated_duration).length,o=c>0?Math.round(l/c*100):100,d=e.filter(f=>f.difficulty==="high"||f.difficulty==="urgent").length,u=c>0?Math.round((c-d)/c*100):100,h=t.filter(f=>f.quality_score&&f.quality_score>=4).length,p=t.length>0?Math.round(h/t.length*100):100;return{issuesPrevented:a,earlyInterventions:i,complianceScore:o,riskMitigation:u,predictiveAccuracy:p}})}calculateEfficiencyGains(e){return vt(this,null,function*(){const t=e.length,n=e.filter(d=>d.completed_at).length,a=t>0?Math.round(n/t*100):100,i=e.length>0?e.reduce((d,u)=>d+(u.efficiency_score||0),0)/e.length:100,c=Math.round(i),l=yield this.calculateResourceOptimization(),o=yield this.calculateWorkflowStreamlining();return{taskCompletionRate:a,qualityImprovement:c,resourceOptimization:l,workflowStreamlining:o}})}calculateResourceOptimization(){return vt(this,null,function*(){try{const{FacilityService:e}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("sterilization_cycles").select("tools").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString());if(!n||n.length===0)return 85;const i=n.reduce((o,d)=>{var u;return o+(((u=d.tools)==null?void 0:u.length)||0)},0)/n.length,c={min:6,max:8},l=i>=c.min&&i<=c.max?100:Math.max(0,100-Math.abs(i-7)*10);return Math.round(l)}catch(e){return console.error(e),console.error("Error calculating resource optimization"),85}})}calculateWorkflowStreamlining(){return vt(this,null,function*(){try{const{FacilityService:e}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("home_daily_operations_tasks").select("estimated_duration, actual_duration").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString());if(!n||n.length===0)return 80;const a=n.map(c=>!c.estimated_duration||!c.actual_duration?100:Math.max(0,Math.min(100,c.estimated_duration/c.actual_duration*100))),i=a.reduce((c,l)=>c+l,0)/a.length;return Math.round(i)}catch(e){return console.error("Error calculating workflow streamlining:",e),80}})}getBaselineData(){return vt(this,null,function*(){try{return{preAITaskDuration:45,preAICompletionRate:75,preAIErrorRate:15,preAICostPerTask:33.75,implementationDate:"2024-01-01"}}catch(e){return console.error("Error getting baseline data:",e),{preAITaskDuration:45,preAICompletionRate:75,preAIErrorRate:15,preAICostPerTask:33.75,implementationDate:"2024-01-01"}}})}cacheMetrics(e){this.cachedMetrics=e}getCachedMetrics(){return this.cachedMetrics||this.getDefaultMetrics()}getDefaultMetrics(){return{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:100,riskMitigation:100,predictiveAccuracy:100},costSavings:{daily:0,monthly:0,annual:0,roi:0},efficiencyGains:{taskCompletionRate:100,qualityImprovement:100,resourceOptimization:85,workflowStreamlining:80},realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:new Date(Date.now()+this.UPDATE_INTERVAL).toISOString(),dataFreshness:0}}}getAIInsights(){return vt(this,null,function*(){try{const e=yield this.getAIImpactMetrics(),{aiReportingService:t}=yield H(()=>Promise.resolve().then(()=>F_),void 0);return yield t.getAIInsights(e)}catch(e){return console.error("Error getting AI insights:",e),["AI system is actively monitoring facility operations"]}})}}const lc=new A_;var wr=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class fm{calculateCostSavings(e,t){return wr(this,null,function*(){try{const n=yield this.getFacilityCosts(),a=this.calculateDirectTimeSavings(e,n.hourlyRate),i=yield this.calculateIndirectCostSavings(t,n),c=yield this.calculateErrorPreventionSavings(t,n),l=yield this.calculateComplianceSavings(),o=yield this.calculateResourceOptimizationSavings(),d=a.daily+i.daily+c.daily+l.daily+o.daily,u=a.monthly+i.monthly+c.monthly+l.monthly+o.monthly,h=1e4,p=u*12,f=h>0?p/h*100:0;return{daily:Math.round(d*100)/100,monthly:Math.round(u*100)/100,annual:Math.round(p*100)/100,roi:Math.round(f*100)/100}}catch(n){return console.error("Error calculating cost savings:",n),this.calculateBasicCostSavings(e)}})}getFacilityCosts(){return wr(this,null,function*(){try{const{FacilityService:e}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("facilities").select("hourly_rate, type, staff_count").eq("id",t).single();return{hourlyRate:(n==null?void 0:n.hourly_rate)||45,facilityType:(n==null?void 0:n.facility_type)||"general",staffCount:(n==null?void 0:n.staff_count)||10}}catch(e){return console.error(e),{hourlyRate:45,facilityType:"general",staffCount:10}}})}calculateDirectTimeSavings(e,t){return{daily:e.daily/60*t,monthly:e.monthly/60*t}}calculateIndirectCostSavings(e,t){return wr(this,null,function*(){const a=t.hourlyRate*t.staffCount*.3*.5,i=a*22;return{daily:a,monthly:i}})}calculateErrorPreventionSavings(e,t){return wr(this,null,function*(){try{const{FacilityService:n}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:a}=yield n.getCurrentUserAndFacility(),{data:i}=yield _.from("quality_incidents").select("cost_impact, severity").eq("facility_id",a).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString());if(!i||i.length===0){const o=t.facilityType==="dental"?150:200;return{daily:o*.1,monthly:o*2}}const l=i.reduce((o,d)=>o+(d.cost_impact||0),0)*.4;return{daily:l/30,monthly:l}}catch(n){console.error(n);const a=200;return{daily:a*.1,monthly:a*2}}})}calculateComplianceSavings(){return wr(this,null,function*(){return{daily:600/30,monthly:600}})}calculateResourceOptimizationSavings(){return wr(this,null,function*(){try{const{FacilityService:e}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("inventory_items").select("unit_cost, quantity, reorder_point").eq("facility_id",t),{data:a}=yield _.from("sterilization_cycles").select("tools, cycle_time").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString()),i=(n==null?void 0:n.filter(d=>d.quantity<d.reorder_point))||[],c=i?i.reduce((d,u)=>d+u.unit_cost*.1,0):100,l=a?a.reduce((d,u)=>d+u.cycle_time*.15,0):50,o=c+l;return{daily:o/30,monthly:o}}catch(e){return console.error(e),{daily:5,monthly:150}}})}calculateBasicCostSavings(e){const n=e.daily/60*45,a=e.monthly/60*45,i=a*12;return{daily:Math.round(n*100)/100,monthly:Math.round(a*100)/100,annual:Math.round(i*100)/100,roi:0}}}const gm=new fm,$_=Object.freeze(Object.defineProperty({__proto__:null,AICostCalculationService:fm,aiCostCalculationService:gm},Symbol.toStringTag,{value:"Module"}));var M_=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class ym{getAIInsights(e){return M_(this,null,function*(){try{const t=[];return e.timeSavings.daily>120&&t.push(`ðŸš€ AI saved ${Math.round(e.timeSavings.daily/60)} hours today!`),e.costSavings.monthly>1e3&&t.push(`ðŸ’° AI generated $${e.costSavings.monthly} in monthly savings`),e.proactiveManagement.issuesPrevented>5&&t.push(`ðŸ›¡ï¸ AI prevented ${e.proactiveManagement.issuesPrevented} potential issues this week`),e.costSavings.roi>50&&t.push(`ðŸ“ˆ AI ROI: ${e.costSavings.roi}% - Excellent investment!`),t}catch(t){return console.error("Error getting AI insights:",t),["AI system is actively monitoring facility operations"]}})}generateAIImpactReport(e){return`
AI Impact Report - ${new Date().toLocaleDateString()}
================================================

TIME SAVINGS
------------
Daily: ${Math.round(e.timeSavings.daily/60)} hours (${Math.round(e.timeSavings.daily)} minutes)
Weekly: ${Math.round(e.timeSavings.weekly/60)} hours (${Math.round(e.timeSavings.weekly)} minutes)
Monthly: ${Math.round(e.timeSavings.monthly/60)} hours (${Math.round(e.timeSavings.monthly)} minutes)
Total: ${Math.round(e.timeSavings.total/60)} hours (${Math.round(e.timeSavings.total)} minutes)
Improvement: ${e.timeSavings.percentage}%

PROACTIVE MANAGEMENT
-------------------
Issues Prevented: ${e.proactiveManagement.issuesPrevented}
Early Interventions: ${e.proactiveManagement.earlyInterventions}
Compliance Score: ${e.proactiveManagement.complianceScore}%
Risk Mitigation: ${e.proactiveManagement.riskMitigation}%
Predictive Accuracy: ${e.proactiveManagement.predictiveAccuracy}%

COST SAVINGS
------------
Daily: $${e.costSavings.daily}
Monthly: $${e.costSavings.monthly}
Annual: $${e.costSavings.annual}
ROI: ${e.costSavings.roi}%

EFFICIENCY GAINS
----------------
Task Completion Rate: ${e.efficiencyGains.taskCompletionRate}%
Quality Improvement: ${e.efficiencyGains.qualityImprovement}%
Resource Optimization: ${e.efficiencyGains.resourceOptimization}%
Workflow Streamlining: ${e.efficiencyGains.workflowStreamlining}%

REAL-TIME UPDATES
-----------------
Last Updated: ${new Date(e.realTimeUpdates.lastUpdated).toLocaleString()}
Next Update: ${new Date(e.realTimeUpdates.nextUpdate).toLocaleString()}
Data Freshness: ${e.realTimeUpdates.dataFreshness} minutes
`.trim()}generateExecutiveSummary(e){return`
AI Implementation Executive Summary
==================================

KEY HIGHLIGHTS
--------------
â€¢ AI has saved ${Math.round(e.timeSavings.monthly/60)} hours this month
â€¢ Generated $${e.costSavings.monthly} in monthly cost savings
â€¢ Achieved ${e.costSavings.roi}% ROI on AI investment
â€¢ Prevented ${e.proactiveManagement.issuesPrevented} potential issues

PERFORMANCE METRICS
-------------------
â€¢ Time Efficiency: ${e.timeSavings.percentage}% improvement
â€¢ Cost Reduction: $${e.costSavings.annual} annual savings
â€¢ Compliance: ${e.proactiveManagement.complianceScore}% score
â€¢ Quality: ${e.efficiencyGains.qualityImprovement}% improvement

RECOMMENDATIONS
---------------
â€¢ Continue AI implementation across all departments
â€¢ Monitor ROI trends for investment decisions
â€¢ Expand proactive management capabilities
â€¢ Leverage efficiency gains for strategic planning

Generated: ${new Date().toLocaleString()}
`.trim()}generatePerformanceBreakdown(e){return{timeAnalysis:{dailyBreakdown:{hours:Math.round(e.timeSavings.daily/60),minutes:Math.round(e.timeSavings.daily),percentage:e.timeSavings.percentage},weeklyBreakdown:{hours:Math.round(e.timeSavings.weekly/60),minutes:Math.round(e.timeSavings.weekly)},monthlyBreakdown:{hours:Math.round(e.timeSavings.monthly/60),minutes:Math.round(e.timeSavings.monthly)}},costAnalysis:{savings:{daily:e.costSavings.daily,monthly:e.costSavings.monthly,annual:e.costSavings.annual},roi:e.costSavings.roi,investment:1e4},efficiencyAnalysis:{completion:e.efficiencyGains.taskCompletionRate,quality:e.efficiencyGains.qualityImprovement,resources:e.efficiencyGains.resourceOptimization,workflow:e.efficiencyGains.workflowStreamlining},proactiveAnalysis:{issues:e.proactiveManagement.issuesPrevented,interventions:e.proactiveManagement.earlyInterventions,compliance:e.proactiveManagement.complianceScore,risk:e.proactiveManagement.riskMitigation,accuracy:e.proactiveManagement.predictiveAccuracy},metadata:{generated:new Date().toISOString(),lastUpdated:e.realTimeUpdates.lastUpdated,nextUpdate:e.realTimeUpdates.nextUpdate,dataFreshness:e.realTimeUpdates.dataFreshness}}}}const Pn=new ym,F_=Object.freeze(Object.defineProperty({__proto__:null,AIReportingService:ym,aiReportingService:Pn},Symbol.toStringTag,{value:"Module"}));var Na=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class vm{getAIImpactMetrics(){return Na(this,null,function*(){return yield lc.getAIImpactMetrics()})}getAIInsights(){return Na(this,null,function*(){return yield lc.getAIInsights()})}generateAIImpactReport(e){return Pn.generateAIImpactReport(e)}generateExecutiveSummary(e){return Pn.generateExecutiveSummary(e)}generatePerformanceBreakdown(e){return Pn.generatePerformanceBreakdown(e)}calculateCostSavings(e,t){return Na(this,null,function*(){return yield gm.calculateCostSavings(e,t)})}}const Li=new vm,L_=Object.freeze(Object.defineProperty({__proto__:null,AIImpactMeasurementService:vm,aiImpactMeasurementService:Li},Symbol.toStringTag,{value:"Module"}));var z_=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const B_=({timeframe:r="daily",aiImpactMetrics:e})=>{const[t,n]=m.useState(null),[a,i]=m.useState(!0);if(m.useEffect(()=>{if(e){console.log("ðŸ¤– EnhancedAiEfficiencyCard: Using pre-loaded AI metrics:",e),n(e),i(!1);return}console.log("ðŸ¤– EnhancedAiEfficiencyCard: No pre-loaded metrics, fetching independently...");const u=()=>z_(null,null,function*(){try{i(!0);const p=yield Li.getAIImpactMetrics();n(p)}catch(p){console.error("Error fetching AI metrics:",p)}finally{i(!1)}});u();const h=setInterval(u,120*1e3);return()=>clearInterval(h)},[e]),a)return s.jsx("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"bg-purple-200 rounded-md p-2 mr-3 w-10 h-10"}),s.jsx("div",{className:"h-5 bg-gray-200 rounded w-32"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})});const c=t||{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},costSavings:{daily:0,monthly:0,annual:0,roi:0}},l=()=>{const u=(()=>{switch(r){case"daily":return c.timeSavings.daily;case"weekly":return c.timeSavings.weekly;case"monthly":return c.timeSavings.monthly;default:return c.timeSavings.daily}})();return console.log("ðŸ•’ EnhancedAiEfficiencyCard: getTimeframeValue:",{timeframe:r,timeSavings:c.timeSavings,returnedValue:u}),u},o=u=>{console.log("â° EnhancedAiEfficiencyCard: formatTime called with:",u);const h=(()=>{if(u<60)return`${u} m`;const p=Math.floor(u/60),f=u%60;return f>0?`${p}h ${f} m`:`${p}h`})();return console.log("â° EnhancedAiEfficiencyCard: formatTime result:",h),h},d=u=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(u);return s.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"bg-purple-200 rounded-md p-2 mr-3",children:s.jsx(tp,{size:20,className:"text-purple-900"})}),s.jsx("div",{children:s.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"AI & Process Efficiency"})})]}),s.jsx("div",{className:"flex items-center text-xs text-gray-400"})]}),s.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-xs text-left text-gray-500",children:"Time Saved"}),s.jsx("span",{className:"text-base text-right text-gray-700",children:o(l())})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-xs text-left text-gray-500",children:"Cost Saved"}),s.jsx("span",{className:"text-base text-right text-gray-700",children:d(r==="weekly"?c.costSavings.monthly/4:c.costSavings[r]||0)})]})]})]})},q_=({data:r})=>s.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("span",{className:"bg-yellow-200 rounded-md p-2 mr-3",children:s.jsx(rp,{size:20,className:"text-yellow-900"})}),s.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Team Performance"})]}),s.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Skills"}),s.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.skills,"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Inventory Efficiency"}),s.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.inventory,"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Sterilization Efficiency"}),s.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.sterilization,"%"]})]})]})]});function U_(r){return Xp({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"},child:[]}]})(r)}const H_=({metrics:r={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0}},aiImpactMetrics:e})=>{var t,n,a,i,c,l,o,d,u;const[h]=m.useState("daily");return console.log("ðŸ“Š PerformanceMetrics: Received metrics:",r),console.log("ðŸ¤– PerformanceMetrics: Received aiImpactMetrics:",e),console.log("ðŸ‘¥ PerformanceMetrics: Team performance data:",r.teamPerformance),e&&console.log("ðŸ” aiImpactMetrics structure:",{timeSavings:e.timeSavings,costSavings:e.costSavings,keys:Object.keys(e)}),s.jsxs("div",{className:"bg-white rounded-lg p-4 pt-2",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"bg-teal-100 rounded-md p-1",children:s.jsx(U_,{size:24,color:"#4ECDC4"})}),s.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:"Performance Metrics"})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(O_,{data:r.timeSaved,timeframe:h}),s.jsx(R_,{data:r.costSavings}),s.jsx(B_,{timeframe:h,showInsights:!1,aiImpactMetrics:e?{timeSavings:{daily:((t=e.timeSavings)==null?void 0:t.daily)||0,weekly:((n=e.timeSavings)==null?void 0:n.weekly)||0,monthly:((a=e.timeSavings)==null?void 0:a.monthly)||0,total:((i=e.timeSavings)==null?void 0:i.total)||0,percentage:((c=e.timeSavings)==null?void 0:c.percentage)||0},costSavings:{daily:((l=e.costSavings)==null?void 0:l.daily)||0,monthly:((o=e.costSavings)==null?void 0:o.monthly)||0,annual:((d=e.costSavings)==null?void 0:d.annual)||0,roi:((u=e.costSavings)==null?void 0:u.roi)||0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:0,riskMitigation:0,predictiveAccuracy:0},efficiencyGains:{taskCompletionRate:0,qualityImprovement:0,resourceOptimization:0,workflowStreamlining:0},realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:"",dataFreshness:100}}:null}),s.jsx(q_,{data:r.teamPerformance,timeframe:h})]})]})};function V_(){return s.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 shadow-sm mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"BI Indicator Dashboard"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Biological indicator results will be displayed here once available."})]})}function W_(){return s.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50 shadow-sm mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CI Indicator Dashboard"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Chemical indicator results will be displayed here once available."})]})}const G_=({biData:r,ciData:e,performanceMetrics:t,aiImpactMetrics:n})=>s.jsxs("div",{className:Dx(),"data-testid":"metrics-section",children:[s.jsx(H_,{metrics:t,aiImpactMetrics:n}),r&&s.jsx(V_,{}),e&&s.jsx(W_,{})]}),K_=m.memo(G_);var Q_=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Y_=({onRefresh:r,className:e="",size:t="md"})=>{const[n,a]=m.useState(!1),[i,c]=m.useState(null),[l,o]=m.useState("idle"),d={sm:"w-6 h-6 text-sm",md:"w-8 h-8 text-base",lg:"w-10 h-10 text-lg"},u=()=>Q_(null,null,function*(){if(!n){a(!0),o("idle");try{yield r(),c(new Date),o("success"),setTimeout(()=>o("idle"),2e3)}catch(g){console.error("Refresh failed:",g),o("error"),setTimeout(()=>o("idle"),3e3)}finally{a(!1)}}}),h=()=>{if(n)return s.jsx(so,{className:"animate-spin"});switch(l){case"success":return s.jsx(np,{className:"text-green-500"});case"error":return s.jsx(sp,{className:"text-red-500"});default:return s.jsx(so,{})}},p=()=>n?"Refreshing...":l==="success"?"Updated successfully":l==="error"?"Refresh failed":i?`Last updated: ${i.toLocaleTimeString()}`:"Refresh",f=()=>n?"Refreshing performance metrics":l==="success"?"Performance metrics updated successfully":l==="error"?"Failed to refresh performance metrics - try again":i?`Refresh performance metrics - Last updated: ${i.toLocaleTimeString()}`:"Refresh performance metrics (PRN)";return s.jsx(om,{content:p(),children:s.jsx("button",{onClick:u,disabled:n,className:`
          ${d[t]}
          flex items-center justify-center
          bg-white hover:bg-gray-50
          border border-gray-200 hover:border-gray-300
          rounded-lg shadow-sm hover:shadow-md
          transition-all duration-200
          disabled:opacity-50 disabled:cursor-not-allowed
          ${e}
        `,"aria-label":f(),children:h()})})};var cc=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class J_{constructor(){this.cache=null,this.CACHE_DURATION=1440*60*1e3,this.lastLogTime=0}fetchAndCacheMetricsOnLogin(){return cc(this,null,function*(){try{$.debug("PerformanceMetricsCache: Fetching metrics on login...");const{homeMetricsService:e}=yield H(()=>Promise.resolve().then(()=>jw),void 0),{homeSterilizationIntegration:t}=yield H(()=>Promise.resolve().then(()=>Nw),void 0),{homeIntegrationService:n}=yield H(()=>Promise.resolve().then(()=>Tw),void 0),{FacilityService:a}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:i}=yield a.getCurrentUserAndFacility();if(!i)return $.debug("PerformanceMetricsCache: No facility ID, skipping cache"),null;const[c,l,o,d]=yield Promise.allSettled([e.getHomeMetrics(),t.getSterilizationMetrics(),n.getAllMetrics(),H(()=>Promise.resolve().then(()=>L_),void 0).then(p=>p.aiImpactMeasurementService.getAIImpactMetrics())]);console.log("ðŸ” PerformanceMetricsCache: AI Metrics result:",c),console.log("ðŸ” PerformanceMetricsCache: Sterilization result:",l),console.log("ðŸ” PerformanceMetricsCache: Integration result:",o),console.log("ðŸ” PerformanceMetricsCache: AI Impact result:",d);const u={aiMetrics:c.status==="fulfilled"?c.value:null,sterilizationMetrics:l.status==="fulfilled"?l.value:null,integrationMetrics:o.status==="fulfilled"?o.value:null,aiImpactMetrics:d.status==="fulfilled"?d.value:null,timestamp:Date.now(),facilityId:i};this.cache=u;try{localStorage.setItem("performanceMetricsCache",JSON.stringify(u))}catch(p){$.debug("PerformanceMetricsCache: Could not store in localStorage")}const h=Date.now();return h-this.lastLogTime>1e3&&($.debug("PerformanceMetricsCache: Metrics cached successfully for facility:",i),this.lastLogTime=h),u}catch(e){return console.error("PerformanceMetricsCache: Error fetching metrics on login:",e),null}})}getCachedMetrics(){if(this.cache&&this.isCacheValid(this.cache))return this.cache;try{const e=localStorage.getItem("performanceMetricsCache");if(e){const t=JSON.parse(e);if(this.isCacheValid(t))return this.cache=t,t}}catch(e){$.debug("PerformanceMetricsCache: Could not read from localStorage:",e)}return null}refreshMetrics(){return cc(this,null,function*(){return $.debug("PerformanceMetricsCache: Manual refresh requested"),this.cache=null,localStorage.removeItem("performanceMetricsCache"),yield this.fetchAndCacheMetricsOnLogin()})}isCacheValid(e){const n=Date.now()-e.timestamp;if(n>this.CACHE_DURATION)return $.debug("PerformanceMetricsCache: Cache expired (age:",n,"ms)"),!1;try{at.getCurrentUserAndFacility().then(({facilityId:a})=>{if(a!==e.facilityId)return $.debug("PerformanceMetricsCache: Facility changed, cache invalid"),!1})}catch(a){}return!0}clearCache(){this.cache=null,localStorage.removeItem("performanceMetricsCache"),$.debug("PerformanceMetricsCache: Cache cleared")}getCacheStatus(){const e=this.getCachedMetrics();return e?{hasCache:!0,age:Date.now()-e.timestamp,facilityId:e.facilityId}:{hasCache:!1}}}const hi=new J_;var X_=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Z_=te.memo(function({loading:e=!1,aiMetrics:t,sterilizationMetrics:n,integrationMetrics:a,aiImpactMetrics:i}){const c=()=>X_(null,null,function*(){try{hi.clearCache(),yield hi.fetchAndCacheMetricsOnLogin(),window.location.reload()}catch(d){throw console.error("Failed to refresh metrics:",d),d}}),l=m.useMemo(()=>{var d,u,h;return{timeSaved:(t==null?void 0:t.timeSaved)||{daily:0,monthly:0},aiTimeSaved:(t==null?void 0:t.aiTimeSaved)||{daily:0,monthly:0},costSavings:(t==null?void 0:t.costSavings)||{monthly:0,annual:0},aiEfficiency:(t==null?void 0:t.aiEfficiency)||{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:((d=t==null?void 0:t.teamPerformance)==null?void 0:d.skills)||0,inventory:((u=t==null?void 0:t.teamPerformance)==null?void 0:u.inventory)||0,sterilization:((h=t==null?void 0:t.teamPerformance)==null?void 0:h.sterilization)||0}}},[t]);return e&&!(t||n||a)?s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full",children:s.jsxs("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})}):s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute top-4 right-4 z-10",children:s.jsx(Y_,{onRefresh:c,size:"sm",className:"shadow-md"})}),s.jsx(m.Suspense,{fallback:s.jsx(ks,{}),children:s.jsx(As,{children:s.jsx(K_,{biData:void 0,ciData:void 0,performanceMetrics:l,aiImpactMetrics:i})})})]})}),ew=({points:r})=>{const e=Math.max(0,r||0);return s.jsx("div",{className:"text-xl font-bold text-[#4ECDC4]",children:e})},tw=({streakCount:r})=>{const e=Math.max(0,r||0);return s.jsxs("div",{className:"text-sm text-orange-500 font-medium",children:["ðŸ”¥ ",e,"-day streak"]})},rw=({level:r})=>{const e=Math.max(1,r||1);return s.jsx("span",{className:"text-xl font-bold text-[#4ECDC4]",children:e})},sw=({gamificationData:r={streak:0,level:1,rank:100,totalScore:0,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}}})=>s.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2","aria-label":Fi.STATS,"aria-live":"polite","data-testid":"gamification-stats",children:s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center p-1 pr-8",children:[s.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:s.jsx(ap,{size:20,className:"text-[#4ECDC4]"})}),s.jsxs("div",{className:"ml-2",children:[s.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Current Streak"}),s.jsx("div",{className:"flex items-baseline",children:s.jsx(tw,{streakCount:r.streak})})]})]}),s.jsxs("div",{className:"flex items-center p-1",children:[s.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:s.jsx(ip,{size:20,className:"text-[#4ECDC4]"})}),s.jsxs("div",{className:"ml-2",children:[s.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Level"}),s.jsxs("div",{className:"flex items-baseline",children:[s.jsx(rw,{level:r.level}),s.jsx("div",{className:"ml-2 px-2 py-0.5 bg-blue-100 rounded-full",children:s.jsxs("span",{className:"text-xs font-semibold text-blue-600",children:["Top ",r.rank,"%"]})})]})]})]}),s.jsxs("div",{className:"flex items-center p-1 pl-8",children:[s.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:s.jsx(op,{size:20,className:"text-[#4ECDC4]"})}),s.jsxs("div",{className:"ml-2",children:[s.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Points"}),s.jsx("div",{className:"flex items-baseline",children:s.jsx(ew,{points:r.totalScore})})]})]})]})}),Ia={DEFAULT_RANK:100,DEFAULT_LEVEL:1,DEFAULT_SCORE:0},xm=te.memo(({gamificationData:r})=>{const{stats:e,loading:t}=cm(),{updateGamificationData:n}=Mi(),i=!(r&&typeof r.streak=="number"&&typeof r.level=="number"&&typeof r.rank=="number"&&typeof r.totalScore=="number"&&r.streak>=0&&r.level>=1&&r.rank>=1&&r.totalScore>=0)||t,c=m.useMemo(()=>{const l=Math.max(0,(r==null?void 0:r.streak)||0),o=Math.max(1,(r==null?void 0:r.level)||Ia.DEFAULT_LEVEL),d=Math.max(1,(r==null?void 0:r.rank)||Ia.DEFAULT_RANK),u=Math.max(0,(r==null?void 0:r.totalScore)||Ia.DEFAULT_SCORE);return{streak:l,level:o,rank:d,totalScore:u,stats:{toolsSterilized:e.toolsSterilized||0,inventoryChecks:e.inventoryChecks||0,perfectDays:e.perfectDays||0,totalTasks:e.totalTasks||0,completedTasks:e.completedTasks||0,currentStreak:e.currentStreak||l,bestStreak:e.bestStreak||0}}},[r==null?void 0:r.streak,r==null?void 0:r.level,r==null?void 0:r.rank,r==null?void 0:r.totalScore,e]);return m.useEffect(()=>{!i&&c&&n(c)},[c,i,n]),i?s.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2",children:s.jsx("div",{className:"animate-pulse",children:s.jsxs("div",{className:"flex items-center justify-between p-1",children:[s.jsxs("div",{className:"flex items-center p-1",children:[s.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:s.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),s.jsxs("div",{className:"ml-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 mb-1"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]}),s.jsxs("div",{className:"flex items-center p-1",children:[s.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:s.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),s.jsxs("div",{className:"ml-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),s.jsxs("div",{className:"flex items-baseline",children:[s.jsx("div",{className:"h-6 bg-gray-200 rounded w-8 mr-2"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]})]}),s.jsxs("div",{className:"flex items-center p-1 pl-8",children:[s.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:s.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),s.jsxs("div",{className:"ml-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),s.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]})]})]})})}):s.jsx(sw,{gamificationData:c})});xm.displayName="HomeGamificationSection";const bm=te.memo(({gamificationData:r,tasks:e,loading:t,taskError:n,storeAvailablePoints:a,storeShowFilters:i,setStoreShowFilters:c,selectedCategory:l,selectedType:o,onCategoryChange:d,onTypeChange:u,onTaskToggle:h,onTaskUpdate:p,aiMetrics:f,sterilizationMetrics:g,integrationMetrics:y,aiImpactMetrics:v})=>{const b=m.useMemo(()=>ur("flex flex-col lg:flex-row gap-6",`mt-${Le.SPACING.MARGIN_TOP}`),[]),x=m.useMemo(()=>ur(`p-${Le.SPACING.PADDING}`),[]);return s.jsx("div",{className:x,children:s.jsxs("div",{className:"space-y-6",children:[s.jsx(xm,{gamificationData:r}),s.jsxs("div",{className:b,children:[s.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:s.jsx(pm,{tasks:e,loading:t,taskError:n,storeAvailablePoints:a,storeShowFilters:i,setStoreShowFilters:c,selectedCategory:l,selectedType:o,onCategoryChange:d,onTypeChange:u,onTaskToggle:h,onTaskUpdate:p})}),s.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:s.jsx(Z_,{loading:t,aiMetrics:f,sterilizationMetrics:g,integrationMetrics:y,aiImpactMetrics:v})})]})]})})});bm.displayName="HomeContentLayout";var mn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const _m=te.memo(({homeData:r})=>{const[e,t]=m.useState(!1),[n,a]=m.useState(!1),[i,c]=m.useState(""),[l,o]=m.useState(""),d=m.useMemo(()=>r.tasks||[],[r.tasks]),u=d.length,[h,p]=m.useState(1),g=Math.ceil(u/10),y=h<g,v=m.useCallback(()=>{y&&p(F=>F+1)},[y]),b=m.useCallback(()=>{h>1&&p(F=>F-1)},[h]),x=m.useCallback(F=>{F>=1&&F<=g&&p(F)},[g]),w=m.useCallback(F=>mn(null,null,function*(){console.log("Completing task:",F)}),[]),j=m.useCallback(()=>mn(null,null,function*(){console.log("Refreshing tasks...")}),[]),I=!1,E=null,{aiMetrics:O={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:S={},integrationMetrics:C={},aiImpactMetrics:D=null}=r||{},k=m.useMemo(()=>d.map(F=>({id:F.id,title:F.title,description:F.description||"",completed:F.isCompleted,points:F.points,type:F.category,category:F.category,priority:"medium",dueDate:F.createdAt,status:F.isCompleted?"completed":"pending"})),[d]),P=m.useMemo(()=>d.reduce((F,V)=>F+(V.points||0),0),[d]),T=m.useMemo(()=>(L=>L&&typeof L=="object"&&L!==null&&"streak"in L&&typeof L.streak=="number"&&Number(L.streak)>=0&&"level"in L&&typeof L.level=="number"&&Number(L.level)>=1&&"rank"in L&&typeof L.rank=="number"&&Number(L.rank)>=1&&"totalScore"in L&&typeof L.totalScore=="number"&&Number(L.totalScore)>=0)(r.gamificationData)?r.gamificationData:{streak:0,level:5,rank:1,totalScore:Math.max(0,P||0)},[r.gamificationData,P]),A=m.useCallback(F=>{t(F)},[]);m.useCallback(()=>{},[]);const z=m.useCallback(F=>{c(F)},[]),W=m.useCallback(F=>{o(F)},[]),M=m.useCallback((F,V)=>mn(null,null,function*(){try{const{FacilityService:L}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{userId:Y}=yield L.getCurrentUserAndFacility();if(!Y)throw new Error("No authenticated user for task toggle");yield w(F),V&&V>0&&console.log(`Task completed! Awarded ${V} points.`)}catch(L){console.error("Error toggling task:",L)}}),[w]),R=m.useCallback((F,V)=>mn(null,null,function*(){try{const L={title:V.title,description:V.description,category:V.category,points:V.points||0,isCompleted:V.status==="completed"};yield mm.updateDailyTask(F,L),yield j(),console.log("Task updated successfully:",F)}catch(L){throw console.error("Failed to update task:",L),L}}),[j]);return s.jsxs("div",{className:"home-content","data-testid":"home-content",children:[s.jsx(bm,{gamificationData:T,tasks:k,loading:I,taskError:E,storeAvailablePoints:P,storeShowFilters:n,setStoreShowFilters:a,selectedCategory:i,selectedType:l,onCategoryChange:z,onTypeChange:W,onTaskToggle:M,onTaskUpdate:R,aiMetrics:O||void 0,sterilizationMetrics:S||void 0,integrationMetrics:C||void 0,aiImpactMetrics:D||void 0}),g>1&&s.jsxs("div",{className:"mt-8 mb-4",children:[s.jsx("div",{className:"flex justify-center mb-4",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",name:"paginationStyle",checked:!e,onChange:()=>A(!1),className:"mr-2"}),"Pagination"]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",name:"paginationStyle",checked:e,onChange:()=>A(!0),className:"mr-2"}),"Load More"]})]})}),e?s.jsx(c_,{onLoadMore:v,hasMore:y,isLoading:I,className:"mb-4"}):s.jsx(l_,{currentPage:h,totalPages:g,onPageChange:x,onNextPage:v,onPreviousPage:b,hasNextPage:y,hasPreviousPage:h>1,isLoading:I,className:"mb-4"})]})]})});_m.displayName="HomeContent";var nw=Object.defineProperty,aw=Object.defineProperties,iw=Object.getOwnPropertyDescriptors,dc=Object.getOwnPropertySymbols,ow=Object.prototype.hasOwnProperty,lw=Object.prototype.propertyIsEnumerable,uc=(r,e,t)=>e in r?nw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cw=(r,e)=>{for(var t in e||(e={}))ow.call(e,t)&&uc(r,t,e[t]);if(dc)for(var t of dc(e))lw.call(e,t)&&uc(r,t,e[t]);return r},dw=(r,e)=>aw(r,iw(e));function uw({homeData:r}){const{setShowStatsModal:e,setShowLeaderboardModal:t,setShowChallengeModal:n}=Mi(),{isDrawerOpen:a}=Vu(),{navBarMarginLeft:i,navBarMarginTop:c}=kx(a),l=m.useRef(null),o=m.useCallback(()=>e(!0),[e]),d=m.useCallback(()=>t(!0),[t]),u=m.useCallback(()=>n(!0),[n]);return s.jsx(As,{children:s.jsxs(Ur,{children:[s.jsxs("div",{className:ur("h-screen bg-gradient-to-br hide-scrollbar overflow-hidden",`from-${Le.COLORS.BG_GRADIENT.FROM}`,`to-${Le.COLORS.BG_GRADIENT.TO}`),"aria-label":"Cliniio Home Dashboard","data-testid":"home-layout",children:[s.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white text-black p-2 z-50 rounded shadow-lg","aria-label":"Skip to main content",children:"Skip to main content"}),s.jsxs("main",{className:`flex-1 border-l-${Le.BORDER.LEFT_WIDTH} border-${Le.COLORS.BORDER} pt-6 overflow-hidden`,role:"main",id:"main-content",ref:l,tabIndex:-1,"aria-label":"Main content area",children:[s.jsx("div",{style:{marginLeft:i,marginTop:c},className:"flex-shrink-0","aria-label":"Dashboard header container",children:s.jsx(Ex,{onStatsClick:o,onLeaderboardClick:d,onChallengeClick:u})}),s.jsx("div",{style:{marginLeft:i},className:"flex-1 overflow-y-auto hide-scrollbar",role:"region","aria-label":"Dashboard content",children:s.jsx(_m,{homeData:r})})]})]}),s.jsx(nb,{leaderboardData:dw(cw({},r.leaderboardData),{users:[],userRank:1})})]})})}function mw(r){return r.toISOString().split("T")[0]}var hw=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function pw(r,e){return hw(this,null,function*(){const{data:t}=yield _.from("performance_metrics").select("*").eq("date",r).eq("facility_id",e);return t||[]})}var fw=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function gw(){return fw(this,null,function*(){try{const r=yield Li.getAIImpactMetrics();return{monthly:r.costSavings.monthly,annual:r.costSavings.annual}}catch(r){return console.warn("Failed to get AI impact metrics for cost savings:",r),{monthly:0,annual:0}}})}var wm=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function yw(){return wm(this,null,function*(){try{const r=yield gw();return{monthly_cost_savings:r.monthly,annual_cost_savings:r.annual}}catch(r){return console.error("Error getting cost savings aggregates:",r),{monthly_cost_savings:0,annual_cost_savings:0}}})}function vw(){return wm(this,null,function*(){try{const{FacilityService:r}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:e}=yield r.getCurrentUserAndFacility(),t=mw(new Date);console.log("ðŸ‘¥ getTeamPerformanceAggregates: Fetching for facility:",e,"date:",t);const n=yield pw(t,e);console.log("ðŸ‘¥ getTeamPerformanceAggregates: Daily metrics:",n);const a=n==null?void 0:n.find(c=>c.metric_type==="team_performance");console.log("ðŸ‘¥ getTeamPerformanceAggregates: Team performance data:",a);const i={skills_score:(a==null?void 0:a.skills)||85,inventory_score:(a==null?void 0:a.inventory)||92,sterilization_score:(a==null?void 0:a.sterilization)||88};return console.log("ðŸ‘¥ getTeamPerformanceAggregates: Returning:",i),i}catch(r){return console.error("Error getting team performance aggregates:",r),{skills_score:85,inventory_score:92,sterilization_score:88}}})}var hn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class xw{constructor(){this.CACHE_DURATION=300*1e3,this.cache=new Map}isCacheValid(e){return Date.now()-e<this.CACHE_DURATION}getCachedData(e){const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}getOperationalTimeSavings(){return hn(this,null,function*(){try{console.log("ðŸ” OperationalTimeSavingsService: Starting calculation...");const{FacilityService:e}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility();if(console.log("ðŸ¥ OperationalTimeSavingsService: Facility ID:",t),!t)return console.log("âŒ OperationalTimeSavingsService: No facility ID, returning defaults"),{daily_time_saved:0,monthly_time_saved:0};const n=`operational-time-savings-${t}-${new Date().toISOString().split("T")[0]}`,a=this.getCachedData(n);if(a)return console.log("ðŸ“Š OperationalTimeSavingsService: Using cached data:",a),a;console.log("ðŸ§® OperationalTimeSavingsService: Calculating from multiple sources...");const[i,c,l]=yield Promise.all([this.calculateSterilizationTimeSavings(t),this.calculateTaskCompletionTimeSavings(t),this.calculateCleaningTimeSavings(t)]);console.log("ðŸ“ˆ OperationalTimeSavingsService: Individual savings:",{sterilization:i,tasks:c,cleaning:l});const o=i.daily+c.daily+l.daily,d=i.monthly+c.monthly+l.monthly,u={daily_time_saved:Math.round(o),monthly_time_saved:Math.round(d)};return this.setCachedData(n,u),console.log("âœ… OperationalTimeSavingsService: Final result:",u),u}catch(e){return console.error("âŒ OperationalTimeSavingsService: Error calculating operational time savings:",e),{daily_time_saved:0,monthly_time_saved:0}}})}calculateSterilizationTimeSavings(e){return hn(this,null,function*(){try{const t=new Date().toISOString().split("T")[0],n=new Date().toISOString().slice(0,7),{data:a}=yield _.from("sterilization_cycles").select("duration_minutes, end_time").eq("facility_id",e).eq("status","completed").gte("end_time",`${t}T00:00:00`).lt("end_time",`${t}T23:59:59`),{data:i}=yield _.from("sterilization_cycles").select("duration_minutes, end_time").eq("facility_id",e).eq("status","completed").gte("end_time",`${n}-01T00:00:00`).lt("end_time",`${n}-31T23:59:59`),c=(a||[]).reduce((o,d)=>{const h=d.duration_minutes||60;return o+Math.max(0,60-h)},0),l=(i||[]).reduce((o,d)=>{const h=d.duration_minutes||60;return o+Math.max(0,60-h)},0);return{daily:c,monthly:l}}catch(t){return $.error("OperationalTimeSavingsService: Error calculating sterilization savings:",t),{daily:0,monthly:0}}})}calculateTaskCompletionTimeSavings(e){return hn(this,null,function*(){try{const t=new Date().toISOString().split("T")[0],n=new Date().toISOString().slice(0,7),{data:a}=yield _.from("home_daily_operations_tasks").select("estimated_duration, actual_duration").eq("facility_id",e).eq("completed",!0).gte("completed_at",`${t}T00:00:00`).lt("completed_at",`${t}T23:59:59`),{data:i}=yield _.from("home_daily_operations_tasks").select("estimated_duration, actual_duration").eq("facility_id",e).eq("completed",!0).gte("completed_at",`${n}-01T00:00:00`).lt("completed_at",`${n}-31T23:59:59`),c=(a||[]).reduce((o,d)=>{const u=d.estimated_duration||30,h=d.actual_duration||u;return o+Math.max(0,u-h)},0),l=(i||[]).reduce((o,d)=>{const u=d.estimated_duration||30,h=d.actual_duration||u;return o+Math.max(0,u-h)},0);return{daily:c,monthly:l}}catch(t){return $.error("OperationalTimeSavingsService: Error calculating task completion savings:",t),{daily:0,monthly:0}}})}calculateCleaningTimeSavings(e){return hn(this,null,function*(){try{return{daily:45,monthly:1350}}catch(t){return $.error("OperationalTimeSavingsService: Error calculating cleaning savings:",t),{daily:0,monthly:0}}})}clearCache(){this.cache.clear()}}const bw=new xw;var cs=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class _w{constructor(){this.CACHE_DURATION=300*1e3,this.cache=new Map}isCacheValid(e){return Date.now()-e<this.CACHE_DURATION}getCachedData(e){const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}getAITimeSavings(){return cs(this,null,function*(){try{const{FacilityService:e}=yield H(()=>Promise.resolve().then(()=>Re),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility();if(!t)return $.debug("AITimeSavingsService: No facility ID, returning defaults"),{daily_time_saved:0,monthly_time_saved:0};const n=`ai-time-savings-${t}-${new Date().toISOString().split("T")[0]}`,a=this.getCachedData(n);if(a)return a;const[i,c,l,o]=yield Promise.all([this.calculateAITaskPerformanceSavings(t),this.calculateAITrainingSavings(t),this.calculateAIComplianceSavings(t),this.calculateAIPredictiveSavings(t)]),d=i.daily+c.daily+l.daily+o.daily,u=i.monthly+c.monthly+l.monthly+o.monthly,h={daily_time_saved:Math.round(d),monthly_time_saved:Math.round(u)};return this.setCachedData(n,h),$.debug("AITimeSavingsService: Calculated AI time savings:",h),h}catch(e){return $.error("AITimeSavingsService: Error calculating AI time savings:",e),{daily_time_saved:0,monthly_time_saved:0}}})}calculateAITaskPerformanceSavings(e){return cs(this,null,function*(){try{const t=new Date().toISOString().split("T")[0],n=new Date().toISOString().slice(0,7),{data:a}=yield _.from("ai_task_performance").select("time_saved").eq("facility_id",e).gte("completed_at",`${t}T00:00:00`).lt("completed_at",`${t}T23:59:59`),{data:i}=yield _.from("ai_task_performance").select("time_saved").eq("facility_id",e).gte("completed_at",`${n}-01T00:00:00`).lt("completed_at",`${n}-31T23:59:59`),c=(a||[]).reduce((o,d)=>o+(d.time_saved||0),0),l=(i||[]).reduce((o,d)=>o+(d.time_saved||0),0);return{daily:c,monthly:l}}catch(t){return $.error("AITimeSavingsService: Error calculating AI task performance savings:",t),{daily:0,monthly:0}}})}calculateAITrainingSavings(e){return cs(this,null,function*(){try{return{daily:30,monthly:900}}catch(t){return $.error("AITimeSavingsService: Error calculating AI training savings:",t),{daily:0,monthly:0}}})}calculateAIComplianceSavings(e){return cs(this,null,function*(){try{return{daily:20,monthly:600}}catch(t){return $.error("AITimeSavingsService: Error calculating AI compliance savings:",t),{daily:0,monthly:0}}})}calculateAIPredictiveSavings(e){return cs(this,null,function*(){try{return{daily:25,monthly:750}}catch(t){return $.error("AITimeSavingsService: Error calculating AI predictive savings:",t),{daily:0,monthly:0}}})}clearCache(){this.cache.clear()}}const Sm=new _w,ww=Object.freeze(Object.defineProperty({__proto__:null,aiTimeSavingsService:Sm},Symbol.toStringTag,{value:"Module"}));var pn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Sw{constructor(){this.cache=new Map,this.CACHE_TTL=300*1e3}isCacheValid(e){return Date.now()-e<this.CACHE_TTL}getCachedData(e){const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}getHomeMetrics(){return pn(this,null,function*(){try{const e=new Date().toISOString().split("T")[0],t=`home-metrics-${e}`,n=this.getCachedData(t);if(n)return n;const{data:{user:a}}=yield _.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:i,error:c}=yield _.from("users").select("facility_id").eq("id",a.id).single();if(c)return console.warn("Failed to fetch user profile, using default facility:",c),this.getDefaultMetrics();const l=(i==null?void 0:i.facility_id)||"550e8400-e29b-41d4-a716-446655440000";console.log("ðŸ  HomeMetricsService: Fetching metrics for facility:",l);const[o,d,u,h,p,f]=yield Promise.allSettled([bw.getOperationalTimeSavings(),Sm.getAITimeSavings(),yw(),vw(),this.getDailyMetrics(e,l),this.getGamificationStats(e,l)]),g=o.status==="fulfilled"?o.value:{daily_time_saved:0,monthly_time_saved:0},y=d.status==="fulfilled"?d.value:{daily_time_saved:0,monthly_time_saved:0},v=u.status==="fulfilled"?u.value:{monthly_cost_savings:0,annual_cost_savings:0},b=h.status==="fulfilled"?h.value:{skills_score:0,inventory_score:0,sterilization_score:0},x=p.status==="fulfilled"?p.value:[],w=f.status==="fulfilled"?f.value:[];console.log("ðŸ“Š HomeMetricsService: Received operational time savings:",g),console.log("ðŸ“Š HomeMetricsService: Received AI time savings:",y),console.log("ðŸ“Š HomeMetricsService: Received cost savings:",v),console.log("ðŸ“Š HomeMetricsService: Received team performance:",b);const j={timeSaved:{daily:g.daily_time_saved,monthly:g.monthly_time_saved},aiTimeSaved:{daily:y.daily_time_saved,monthly:y.monthly_time_saved},costSavings:{monthly:v.monthly_cost_savings,annual:v.annual_cost_savings},aiEfficiency:{timeSavings:this.extractAIEfficiency(x,"time_savings"),proactiveMgmt:this.extractAIEfficiency(x,"proactive_mgmt")},teamPerformance:{skills:b.skills_score,inventory:b.inventory_score,sterilization:b.sterilization_score},gamificationStats:{totalTasks:this.calculateTotalTasks(w),completedTasks:this.calculateCompletedTasks(w),perfectDays:this.calculatePerfectDays(w),currentStreak:this.calculateCurrentStreak(w),bestStreak:this.calculateBestStreak(w)}};return this.setCachedData(t,j),j}catch(e){return console.warn("Failed to fetch home metrics, using defaults:",e),this.getDefaultMetrics()}})}getDailyMetrics(e,t){return pn(this,null,function*(){const{data:n}=yield _.from("performance_metrics").select("*").eq("date",e).eq("facility_id",t);return n||[]})}getMonthlyMetrics(e,t){return pn(this,null,function*(){const{data:n}=yield _.from("performance_metrics").select("*").like("month",e).eq("facility_id",t);return n||[]})}getGamificationStats(e,t){return pn(this,null,function*(){const{data:n}=yield _.from("user_gamification_stats").select("*").eq("date",e).eq("facility_id",t).limit(10);return n||[]})}extractTimeSaved(e,t){const n=e.find(a=>a.metric_type==="time_saved");return t==="daily"?(n==null?void 0:n.daily_time_saved)||0:(n==null?void 0:n.monthly_time_saved)||0}extractCostSavings(e,t){const n=e.find(a=>a.metric_type==="cost_savings");return t==="monthly"?(n==null?void 0:n.monthly_cost_savings)||0:(n==null?void 0:n.annual_cost_savings)||0}extractAIEfficiency(e,t){const n=e.find(a=>a.metric_type==="ai_efficiency");return(n==null?void 0:n[t])||0}extractTeamPerformance(e,t){const n=e.find(a=>a.metric_type==="team_performance");return(n==null?void 0:n[t])||0}calculateTotalTasks(e){return e.reduce((t,n)=>t+(n.total_tasks||0),0)}calculateCompletedTasks(e){return e.reduce((t,n)=>t+(n.completed_tasks||0),0)}calculatePerfectDays(e){return e.filter(t=>(t.completed_tasks||0)===(t.total_tasks||0)).length}calculateCurrentStreak(e){return e.reduce((t,n)=>Math.max(t,n.current_streak||0),0)}calculateBestStreak(e){return e.reduce((t,n)=>Math.max(t,n.best_streak||0),0)}getDefaultMetrics(){return{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}}}}const jm=new Sw,jw=Object.freeze(Object.defineProperty({__proto__:null,homeMetricsService:jm},Symbol.toStringTag,{value:"Module"}));var xt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Cw{getCachedUser(){return null}getSterilizationMetrics(){return xt(this,null,function*(){try{const e=yield this.getCachedUser();return e?yield this.getConsolidatedSterilizationMetrics(e.facility_id):this.getDefaultSterilizationMetrics()}catch(e){return console.error("Error fetching sterilization metrics:",e),this.getDefaultSterilizationMetrics()}})}getConsolidatedSterilizationMetrics(e){return xt(this,null,function*(){const t=new Date().toISOString().split("T")[0],n=new Date;n.setDate(n.getDate()-7);const a=new Date;a.setDate(a.getDate()-30);const{data:i,error:c}=yield _.from("sterilization_cycles").select("id, status, created_at, end_time").eq("facility_id",e).gte("created_at",a.toISOString()).lte("created_at",t).order("created_at",{ascending:!1});return c?(console.error("Error fetching consolidated sterilization metrics:",c),yield this.getFallbackSterilizationMetrics(e)):i&&Array.isArray(i)&&i.length>0?this.mapDatabaseResponseToMetrics(i[0]):this.getDefaultSterilizationMetrics()})}mapDatabaseResponseToMetrics(e){return{cyclesToday:e.cycles_today||0,cyclesThisWeek:e.cycles_this_week||0,biPassRate:e.bi_pass_rate||0,averageCycleTime:e.average_cycle_time||0,toolsInCycle:e.tools_in_cycle||0,toolsCompletedToday:e.tools_completed_today||0,performanceScore:e.performance_score||0}}getFallbackSterilizationMetrics(e){return xt(this,null,function*(){const[t,n,a,i,c,l]=yield Promise.all([this.getCyclesToday(e),this.getCyclesThisWeek(e),this.getBITestResults(e),this.getCycleTimes(e),this.getToolsInCycle(e),this.getToolsCompletedToday(e)]),o=this.calculateBIPassRate(a),d=this.calculateAverageCycleTime(i),u=this.calculatePerformanceScore({biPassRate:o,averageCycleTime:d,cyclesToday:t});return{cyclesToday:t,cyclesThisWeek:n,biPassRate:o,averageCycleTime:d,toolsInCycle:c,toolsCompletedToday:l,performanceScore:u}})}getCyclesToday(e){return xt(this,null,function*(){const{data:t,error:n}=yield _.from("sterilization_cycles").select("id").eq("facility_id",e).gte("created_at",new Date().toISOString().split("T")[0]);return n?(console.error("Error fetching cycles today:",n),0):(t==null?void 0:t.length)||0})}getCyclesThisWeek(e){return xt(this,null,function*(){const t=new Date;t.setDate(t.getDate()-7);const{data:n,error:a}=yield _.from("sterilization_cycles").select("id").eq("facility_id",e).gte("created_at",t.toISOString());return a?(console.error("Error fetching cycles this week:",a),0):(n==null?void 0:n.length)||0})}getBITestResults(e){return xt(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_results").select("result").eq("facility_id",e).gte("created_at",new Date(Date.now()-2592e6).toISOString());return n?(console.error("Error fetching BI test results:",n),[]):t||[]})}getCycleTimes(e){return xt(this,null,function*(){const{data:t,error:n}=yield _.from("sterilization_cycles").select("start_time, end_time, duration_minutes").eq("facility_id",e).eq("status","completed").gte("created_at",new Date(Date.now()-6048e5).toISOString());return n?(console.error("Error fetching cycle times:",n),[]):t||[]})}getToolsInCycle(e){return xt(this,null,function*(){try{return(yield Fe.getToolsByFacilityAndStatus(e,"in_cycle")).length}catch(t){return console.error("Error fetching tools in cycle:",t),0}})}getToolsCompletedToday(e){return xt(this,null,function*(){try{const t=yield Fe.getToolsByFacilityAndStatus(e,"available"),n=new Date().toISOString().split("T")[0];return t.filter(i=>i.updated_at&&i.updated_at.split("T")[0]>=n).length}catch(t){return console.error("Error fetching tools completed today:",t),0}})}calculateBIPassRate(e){if(e.length===0)return 0;const t=e.filter(n=>n.result==="pass").length;return Math.round(t/e.length*100)}calculateAverageCycleTime(e){if(e.length===0)return 0;const t=e.reduce((n,a)=>n+(a.duration_minutes||0),0);return Math.round(t/e.length)}calculatePerformanceScore(e){const t=Math.min(e.biPassRate,100),n=Math.min(e.cyclesToday*10,50),a=Math.max(0,50-e.averageCycleTime);return Math.round((t+n+a)/3)}getDefaultSterilizationMetrics(){return{cyclesToday:0,cyclesThisWeek:0,biPassRate:0,averageCycleTime:0,toolsInCycle:0,toolsCompletedToday:0,performanceScore:0}}}const Cm=new Cw,Nw=Object.freeze(Object.defineProperty({__proto__:null,homeSterilizationIntegration:Cm},Symbol.toStringTag,{value:"Module"}));var Ta=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Iw{getInventoryMetrics(){return Ta(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),n=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:a,error:i}=yield _.from("inventory_items").select("status").eq("facility_id",n);if(i)return console.warn("Failed to fetch aggregated inventory metrics, using fallback:",i),{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0};const c=(a==null?void 0:a.length)||0,l=(a==null?void 0:a.filter(u=>u.status==="low_stock").length)||0,o=(a==null?void 0:a.filter(u=>u.status==="expiring").length)||0,d=c>0?(c-l)/c*100:0;return{lowStockItems:l,totalItems:c,expiringItems:o,inventoryAccuracy:d}}catch(e){return console.error("Error fetching inventory metrics:",e),{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0}}})}getEnvironmentalCleanMetrics(){return Ta(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),n=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:a,error:i}=yield _.from("environmental_clean_logs").select("status, area").eq("facility_id",n);if(i)return console.warn("Failed to fetch aggregated environmental clean metrics, using fallback:",i),{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98};const c=(a==null?void 0:a.length)||0,l=(a==null?void 0:a.filter(u=>u.status==="completed").length)||0,o=c>0?l/c*100:0,d=o>90?98:Math.max(70,o);return{cleaningEfficiency:o,totalRooms:c,cleanRooms:l,complianceScore:d}}catch(e){return console.error("Error fetching environmental clean metrics:",e),{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98}}})}getAllMetrics(){return Ta(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),n=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:a,error:i}=yield _.from("sterilization_cycles").select("status, created_at, end_time").eq("facility_id",n).order("created_at",{ascending:!1}).limit(10);if(i){console.warn("Failed to fetch combined metrics, falling back to individual calls:",i);const[l,o]=yield Promise.all([this.getInventoryMetrics(),this.getEnvironmentalCleanMetrics()]);return{inventory:l,environmentalClean:o}}const c=(a==null?void 0:a[0])||{};return{inventory:{lowStockItems:(c==null?void 0:c.inventory_low_stock_items)||0,totalItems:(c==null?void 0:c.inventory_total_items)||0,expiringItems:(c==null?void 0:c.inventory_expiring_items)||0,inventoryAccuracy:(c==null?void 0:c.inventory_accuracy)||0},environmentalClean:{cleaningEfficiency:(c==null?void 0:c.cleaning_efficiency)||0,totalRooms:(c==null?void 0:c.cleaning_total_rooms)||0,cleanRooms:(c==null?void 0:c.cleaning_clean_rooms)||0,complianceScore:(c==null?void 0:c.cleaning_compliance_score)||98}}}catch(e){return console.error("Error fetching all home integration metrics:",e),{inventory:{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0},environmentalClean:{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98}}}})}}const Nm=new Iw,Tw=Object.freeze(Object.defineProperty({__proto__:null,homeIntegrationService:Nm},Symbol.toStringTag,{value:"Module"}));var Ew=Object.defineProperty,kw=Object.defineProperties,Dw=Object.getOwnPropertyDescriptors,mc=Object.getOwnPropertySymbols,Pw=Object.prototype.hasOwnProperty,Ow=Object.prototype.propertyIsEnumerable,hc=(r,e,t)=>e in r?Ew(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ea=(r,e)=>{for(var t in e||(e={}))Pw.call(e,t)&&hc(r,t,e[t]);if(mc)for(var t of mc(e))Ow.call(e,t)&&hc(r,t,e[t]);return r},ka=(r,e)=>kw(r,Dw(e)),pc=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Da=[{id:"demo-1",title:"Complete Daily Safety Checklist",description:"Review and complete the facility safety checklist",category:"Safety",difficulty:"Easy",points:50,timeEstimate:"15 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-2",title:"Update Inventory Records",description:"Verify and update current inventory levels",category:"Inventory",difficulty:"Medium",points:75,timeEstimate:"30 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-3",title:"Review Sterilization Protocols",description:"Ensure all sterilization equipment is properly maintained",category:"Sterilization",difficulty:"Hard",points:100,timeEstimate:"45 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],ds={aiMetrics:{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:{cyclesCompleted:0,successRate:"0%",equipmentStatus:"No Data"},integrationMetrics:{systemHealth:"No Data",uptime:"0%",lastSync:"Never"}},Rw=()=>{const{currentFacility:r,isLoading:e}=Ku(),[t,n]=m.useState({tasks:[],aiMetrics:null,aiImpactMetrics:null,sterilizationMetrics:null,integrationMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!0,error:null});m.useCallback(()=>pc(null,null,function*(){try{const i=yield Promise.allSettled([jm.getHomeMetrics(),Cm.getSterilizationMetrics(),Nm.getAllMetrics()]);n(c=>ka(Ea({},c),{aiMetrics:i[0].status==="fulfilled"?i[0].value:c.aiMetrics,sterilizationMetrics:i[1].status==="fulfilled"?i[1].value:c.sterilizationMetrics,integrationMetrics:i[2].status==="fulfilled"?i[2].value:c.integrationMetrics}))}catch(i){console.warn("Background AI PROCESS AND EFFICIENCY loading failed, using basic data:",i)}}),[]);const a=m.useCallback(()=>pc(null,null,function*(){try{n(x=>ka(Ea({},x),{loading:!0,error:null}));let i;if(r!=null&&r.id)i=r.id;else{if(e)return;i="demo-facility-id"}const[c,l,o]=yield Promise.allSettled([mm.getFacilityDailyTasks(i),hi.fetchAndCacheMetricsOnLogin(),lm.fetchCumulativeStats()]),d=yield Promise.resolve([]);console.log("ðŸ” useHomeDataLoader: Promise.allSettled results:",{allDailyTasks:c.status,freshMetrics:l.status,gamificationStats:o.status,leaderboardData:"skipped"});const u=c.status==="fulfilled"?c.value:Da,h=l.status==="fulfilled"&&l.value?l.value:null,p=(h==null?void 0:h.aiMetrics)||{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},f=(h==null?void 0:h.sterilizationMetrics)||ds.sterilizationMetrics,g=(h==null?void 0:h.integrationMetrics)||ds.integrationMetrics,y={id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},v=o.status==="fulfilled"&&o.value?(()=>{const x=o.value,w=d.status==="fulfilled"&&d.values?d.values:{userRank:1,totalUsers:1},j=Math.max(0,x.currentStreak||0),I=Math.max(0,x.totalPoints||0),E=Math.max(1,w.userRank||1),O=Math.max(1,w.totalUsers||1),S=E/O;let C;return S<=.1?C=Math.max(10,Math.floor(10+(.1-S)*50)):S<=.25?C=Math.max(7,Math.floor(7+(.25-S)*20)):S<=.5?C=Math.max(5,Math.floor(5+(.5-S)*8)):C=Math.max(1,Math.floor(1+(1-S)*4)),{streak:j,level:C,rank:E,totalScore:I}})():null,b=u.length>0?u.map(x=>"difficulty"in x&&"timeEstimate"in x?x:{id:x.id,title:x.title,description:x.description||"",category:x.category,difficulty:x.priority||"medium",points:x.points,timeEstimate:`${x.estimated_duration||30} min`,isCompleted:x.completed||!1,completedAt:x.completed_at||null,pointsEarned:x.completed?x.points:0,createdAt:x.created_at||x.due_date||new Date().toISOString(),updatedAt:x.updated_at||new Date().toISOString()}):Da;n({tasks:b,aiMetrics:p,sterilizationMetrics:f,integrationMetrics:g,aiImpactMetrics:(h==null?void 0:h.aiImpactMetrics)||null,leaderboardData:y,gamificationData:v,loading:!1,error:null}),console.log("ðŸš€ Home data loaded (with fallbacks if needed):",{tasks:b.length,aiMetrics:!!p,sterilizationMetrics:!!f,integrationMetrics:!!g})}catch(i){console.error("Critical error loading home data, using all fallbacks:",i),n({tasks:Da,aiMetrics:ka(Ea({},ds.aiMetrics),{costSavings:{monthly:0,annual:0},teamPerformance:{skills:0,inventory:0,sterilization:0}}),sterilizationMetrics:ds.sterilizationMetrics,integrationMetrics:ds.integrationMetrics,aiImpactMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!1,error:null})}}),[r==null?void 0:r.id,e]);return m.useEffect(()=>{e||a()},[e,a]),t},fc=({size:r="lg",message:e="Data Compilation In Progress..."})=>{const t={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},n={sm:"text-sm",md:"text-base",lg:"text-lg"};return s.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:`${t[r]} animate-bounce`,children:s.jsx("div",{className:"text-6xl",children:"ðŸš€"})}),s.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:s.jsx("div",{className:"w-1 h-8 bg-gradient-to-t from-orange-400 to-transparent animate-pulse"})})]}),s.jsxs("div",{className:"text-center space-y-2",children:[s.jsx("h3",{className:`font-semibold text-gray-700 ${n[r]}`,children:e}),s.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Preparing your dashboard for takeoff..."})]}),s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})};function Aw(){const{currentUser:r,isLoading:e}=hr(),t=Rn(c=>c.authToken),n=Rn(c=>c.isTokenExpired),a=Rw();return!!!(r&&t&&!n())&&!e?s.jsx(Ci,{to:"/login",replace:!0}):e||!r?s.jsx(fc,{size:"lg",message:"Verifying Authentication..."}):a.loading?s.jsx(fc,{size:"lg",message:"Data Compilation In Progress..."}):s.jsx(uw,{homeData:a})}const $w=m.createContext(null),Pa={didCatch:!1,error:null};class zr extends m.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Pa}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,n,a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];(t=(n=this.props).onReset)===null||t===void 0||t.call(n,{args:i,reason:"imperative-api"}),this.setState(Pa)}}componentDidCatch(e,t){var n,a;(n=(a=this.props).onError)===null||n===void 0||n.call(a,e,t)}componentDidUpdate(e,t){const{didCatch:n}=this.state,{resetKeys:a}=this.props;if(n&&t.error!==null&&Mw(e.resetKeys,a)){var i,c;(i=(c=this.props).onReset)===null||i===void 0||i.call(c,{next:a,prev:e.resetKeys,reason:"keys"}),this.setState(Pa)}}render(){const{children:e,fallbackRender:t,FallbackComponent:n,fallback:a}=this.props,{didCatch:i,error:c}=this.state;let l=e;if(i){const o={error:c,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")l=t(o);else if(n)l=m.createElement(n,o);else if(a!==void 0)l=a;else throw c}return m.createElement($w.Provider,{value:{didCatch:i,error:c,resetErrorBoundary:this.resetErrorBoundary}},l)}}function Mw(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return r.length!==e.length||r.some((t,n)=>!Object.is(t,e[n]))}const fn=({title:r,value:e,icon:t,iconBgColor:n,gradientFrom:a,gradientTo:i,borderColor:c,textColor:l,valueColor:o,trend:d})=>s.jsxs("div",{className:`bg-gradient-to-br from-${a} to-${i} p-4 rounded-lg border border-${c}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-medium ${l}`,children:r}),s.jsx("p",{className:`text-2xl font-bold ${o}`,children:e})]}),s.jsx("div",{className:`p-2 ${n} rounded-lg`,children:s.jsx(N,{path:t,size:1.5,className:"text-white"})})]}),d&&s.jsxs("div",{className:`mt-2 flex items-center text-xs ${l}`,children:[s.jsx(N,{path:d.direction==="up"?Ei:d.direction==="down"?Pu:$s,size:.8,className:"mr-1"}),s.jsx("span",{children:d.value})]})]}),Fw=({score:r,trend:e})=>{const t=()=>e?e.direction==="up"?"text-green-600":"text-red-600":"text-gray-500",n=()=>e?e.direction==="up"?Ei:Pu:Fr;return s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-3 mt-4 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"bg-blue-500 p-1.5 rounded-lg mr-3",children:s.jsx(N,{path:Fr,size:1,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-semibold text-blue-800",children:"Overall Efficiency Trend"}),s.jsxs("p",{className:"text-xl font-bold text-blue-900",children:[r,"%"]})]})]}),e&&s.jsxs("div",{className:`flex items-center text-sm font-medium ${t()}`,children:[s.jsx(N,{path:n(),size:.9,className:"mr-1"}),s.jsx("span",{children:e.value})]})]}),!e&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"No trend data available yet. Complete more cycles to see performance trends."})]})};function Lw(r,e){let t;try{t=r()}catch(a){return}return{getItem:a=>{var i;const c=o=>o===null?null:JSON.parse(o,void 0),l=(i=t.getItem(a))!=null?i:null;return l instanceof Promise?l.then(c):c(l)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const pi=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return pi(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return pi(n)(t)}}}},zw=(r,e)=>(t,n,a)=>{let i=se({storage:Lw(()=>localStorage),partialize:y=>y,version:0,merge:(y,v)=>se(se({},v),y)},e),c=!1;const l=new Set,o=new Set;let d=i.storage;if(!d)return r((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},n,a);const u=()=>{const y=i.partialize(se({},n()));return d.setItem(i.name,{state:y,version:i.version})},h=a.setState;a.setState=(y,v)=>(h(y,v),u());const p=r((...y)=>(t(...y),u()),n,a);a.getInitialState=()=>p;let f;const g=()=>{var y,v;if(!d)return;c=!1,l.forEach(x=>{var w;return x((w=n())!=null?w:p)});const b=((v=i.onRehydrateStorage)==null?void 0:v.call(i,(y=n())!=null?y:p))||void 0;return pi(d.getItem.bind(d))(i.name).then(x=>{if(x)if(typeof x.version=="number"&&x.version!==i.version){if(i.migrate){const w=i.migrate(x.state,x.version);return w instanceof Promise?w.then(j=>[!0,j]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,x.state];return[!1,void 0]}).then(x=>{var w;const[j,I]=x;if(f=i.merge(I,(w=n())!=null?w:p),t(f,!0),j)return u()}).then(()=>{b==null||b(f,void 0),f=n(),c=!0,o.forEach(x=>x(f))}).catch(x=>{b==null||b(void 0,x)})};return a.persist={setOptions:y=>{i=se(se({},i),y),y.storage&&(d=y.storage)},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>c,onHydrate:y=>(l.add(y),()=>{l.delete(y)}),onFinishHydration:y=>(o.add(y),()=>{o.delete(y)})},i.skipHydration||g(),f||p},Xn=zw;var Bw=Object.defineProperty,gc=Object.getOwnPropertySymbols,qw=Object.prototype.hasOwnProperty,Uw=Object.prototype.propertyIsEnumerable,yc=(r,e,t)=>e in r?Bw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Oa=(r,e)=>{for(var t in e||(e={}))qw.call(e,t)&&yc(r,t,e[t]);if(gc)for(var t of gc(e))Uw.call(e,t)&&yc(r,t,e[t]);return r};class $r{constructor(){this.metrics=new Map,this.callHistory=[],this.thresholds={maxResponseTime:5e3,maxErrorRate:10,maxCallsPerMinute:100},this.startCleanupInterval()}static getInstance(){return $r.instance||($r.instance=new $r),$r.instance}startCall(e,t){const n=`${e}.${t}.${Date.now()}`,a={serviceName:e,methodName:t,startTime:Date.now()};return this.callHistory.push(a),n}endCall(e,t,n){const a=this.callHistory.find(i=>`${i.serviceName}.${i.methodName}.${i.startTime}`===e);if(!a){console.warn(`[ServiceMonitor] Call ${e} not found`);return}a.endTime=Date.now(),a.success=t,a.error=n,a.responseTime=a.endTime-a.startTime,this.updateMetrics(a)}updateMetrics(e){const t=e.serviceName,n=this.metrics.get(t)||{serviceName:t,totalCalls:0,successfulCalls:0,failedCalls:0,averageResponseTime:0,lastCallTime:0,errorRate:0,uptime:0};if(n.totalCalls++,e.success?n.successfulCalls++:n.failedCalls++,e.responseTime){const i=n.averageResponseTime*(n.totalCalls-1)+e.responseTime;n.averageResponseTime=i/n.totalCalls}n.errorRate=n.failedCalls/n.totalCalls*100,n.lastCallTime=e.endTime||e.startTime;const a=this.callHistory.find(i=>i.serviceName===t);a&&(n.uptime=e.endTime-a.startTime),this.metrics.set(t,n),this.checkPerformanceIssues(n)}checkPerformanceIssues(e){const t=[];e.averageResponseTime>this.thresholds.maxResponseTime&&t.push(`High response time: ${e.averageResponseTime}ms (threshold: ${this.thresholds.maxResponseTime}ms)`),e.errorRate>this.thresholds.maxErrorRate&&t.push(`High error rate: ${e.errorRate.toFixed(2)}% (threshold: ${this.thresholds.maxErrorRate}%)`);const n=this.getCallsLastMinute(e.serviceName);n>this.thresholds.maxCallsPerMinute&&t.push(`High call frequency: ${n} calls/minute (threshold: ${this.thresholds.maxCallsPerMinute})`),t.length>0&&(console.warn(`[ServiceMonitor] Performance issues detected for ${e.serviceName}:`,t),this.alertPerformanceIssues(e.serviceName,t))}getCallsLastMinute(e){const t=Date.now()-6e4;return this.callHistory.filter(n=>n.serviceName===e&&n.startTime>t).length}alertPerformanceIssues(e,t){console.error(`[ServiceMonitor] ALERT: ${e} has performance issues:`,t)}getServiceMetrics(e){return this.metrics.get(e)||null}getAllMetrics(){return Array.from(this.metrics.values())}getTopPerformingServices(e=5){return this.getAllMetrics().sort((t,n)=>t.errorRate-n.errorRate).slice(0,e)}getServicesWithIssues(){return this.getAllMetrics().filter(e=>e.errorRate>this.thresholds.maxErrorRate||e.averageResponseTime>this.thresholds.maxResponseTime)}updateThresholds(e){this.thresholds=Oa(Oa({},this.thresholds),e),console.log("[ServiceMonitor] Performance thresholds updated:",this.thresholds)}getThresholds(){return Oa({},this.thresholds)}startCleanupInterval(){setInterval(()=>{this.cleanupOldCalls()},3e5)}cleanupOldCalls(){const e=Date.now()-36e5,t=this.callHistory.length;this.callHistory=this.callHistory.filter(a=>a.startTime>e);const n=t-this.callHistory.length;n>0&&console.log(`[ServiceMonitor] Cleaned up ${n} old call records`)}resetMetrics(){this.metrics.clear(),this.callHistory=[],console.log("[ServiceMonitor] All metrics reset")}exportMetrics(){return{metrics:this.getAllMetrics(),callHistory:[...this.callHistory],thresholds:this.getThresholds(),exportTime:Date.now()}}}const Ke=$r.getInstance();class Hw{constructor(e,t){this.serviceName=e,this.originalService=t,this.wrapMethods()}wrapMethods(){const e=Object.getPrototypeOf(this.originalService);Object.getOwnPropertyNames(e).forEach(n=>{if(typeof e[n]=="function"&&n!=="constructor"){const a=e[n];e[n]=(...i)=>{const c=Ke.startCall(this.serviceName,n);try{const l=a.apply(this.originalService,i);return l&&typeof l.then=="function"?l.then(o=>(Ke.endCall(c,!0),o)).catch(o=>{throw Ke.endCall(c,!1,o instanceof Error?o.message:String(o)),o}):(Ke.endCall(c,!0),l)}catch(l){throw Ke.endCall(c,!1,l instanceof Error?l.message:String(l)),l}}}})}getService(){return this.originalService}}function Vw(r,e){return new Hw(r,e).getService()}var Kt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Im=class Or{constructor(){this.services=new Map,this.serviceFactories=new Map,this.registerDefaultServices()}static getInstance(){return Or.instance||(Or.instance=new Or),Or.instance}register(e,t){this.serviceFactories.set(e,t)}get(e){if(!this.services.has(e)){const t=this.serviceFactories.get(e);if(!t)throw new Error(`Service '${e}' not registered`);const n=performance.now();try{const a=t(),i=Vw(e,a);this.services.set(e,i);const c=performance.now()-n;ra.recordResponseTime("service_creation",c,{service:e,operation:"create"});const l=Ke.startCall("ServiceRegistry","createService");Ke.endCall(l,!0)}catch(a){const i=performance.now()-n;throw ra.recordErrorRate("service_creation",100,{service:e,operation:"create",error:a instanceof Error?a.message:"Unknown error"}),console.error(`[ServiceRegistry] Failed to create service '${e}' after ${i.toFixed(2)}ms:`,a),a}}return this.services.get(e)}has(e){return this.services.has(e)}remove(e){return this.services.delete(e)}getServiceNames(){return Array.from(this.services.keys())}getPerformanceMetrics(){return Ke.getAllMetrics()}getServicePerformanceMetrics(e){return Ke.getServiceMetrics(e)}getServicesWithPerformanceIssues(){return Ke.getServicesWithIssues()}getTopPerformingServices(e=5){return Ke.getTopPerformingServices(e)}exportPerformanceData(){return Ke.exportMetrics()}clear(){this.services.clear()}reset(){this.services.clear(),this.serviceFactories.clear(),Or.instance=null}registerDefaultServices(){this.register("performanceMonitor",()=>ra),this.register("inventoryService",()=>Kt(this,null,function*(){const{getInventoryService:e}=yield H(()=>import("./InventoryServiceFactory-D2ojGv80.js"),__vite__mapDeps([7,1,2,3,4,5]));return e()})),this.register("errorHandling",()=>Kt(this,null,function*(){const{ErrorHandlingService:e}=yield H(()=>import("./errorHandlingService-_ewckZgi.js"),__vite__mapDeps([8,1,2,3,4,5]));return e.getInstance()})),this.register("settings",()=>Kt(this,null,function*(){const{SettingsService:e}=yield H(()=>import("./settingsService-B82XYdbV.js"),__vite__mapDeps([9,1,2,3,4,5]));return e.getInstance()})),this.register("usageTracking",()=>Kt(this,null,function*(){const{usageTrackingService:e}=yield H(()=>Promise.resolve().then(()=>YT),void 0);return e})),this.register("learningProgress",()=>Kt(this,null,function*(){return(yield H(()=>Promise.resolve().then(()=>AD),void 0)).default.getInstance()})),this.register("cleaningSchedule",()=>Kt(this,null,function*(){const{cleaningScheduleService:e}=yield H(()=>import("./cleaningScheduleService-F-OKgSSu.js"),__vite__mapDeps([10,1,2,3,4,5]));return e})),this.register("duplicatePrevention",()=>Kt(this,null,function*(){const{duplicatePreventionService:e}=yield H(()=>import("./duplicatePreventionService-BEC6oIlE.js"),__vite__mapDeps([11,1,2,3,4,5]));return e}))}};Im.instance=null;let Ww=Im;const Mt=Ww.getInstance();var Gw=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Kw{static getInventoryService(){return Gw(this,null,function*(){return Mt.get("inventoryService")})}static getErrorHandlingService(){return Mt.get("errorHandling")}static getSettingsService(){return Mt.get("settings")}static getPerformanceMonitor(){return Mt.get("performanceMonitor")}static getUsageTrackingService(){return Mt.get("usageTracking")}static getLearningProgressService(){return Mt.get("learningProgress")}static getCleaningScheduleService(){return Mt.get("cleaningSchedule")}static getDuplicatePreventionService(){return Mt.get("duplicatePrevention")}}const us=Kw.getInventoryService;var ms=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Ra=(...r)=>console.log("[useCentralizedInventoryData]",...r);let On=!1;const cr=Nt()(Xn((r,e)=>({data:null,isLoading:!0,error:null,items:[],tools:[],supplies:[],equipment:[],officeHardware:[],getTools:()=>e().tools,getSupplies:()=>e().supplies,getEquipment:()=>e().equipment,getOfficeHardware:()=>e().officeHardware,getCategories:()=>{const t=e();return Array.from(new Set([...t.tools.map(n=>n.category).filter(n=>n!==null),...t.supplies.map(n=>n.category).filter(n=>n!==null),...t.equipment.map(n=>n.category).filter(n=>n!==null),...t.officeHardware.map(n=>n.category).filter(n=>n!==null)]))},getFilteredData:t=>ms(null,null,function*(){const a=yield(yield us()).fetchInventoryItems();return!a||!Array.isArray(a)?[]:a.filter(i=>{var c,l;return((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))})}),getFilteredSuppliesData:t=>ms(null,null,function*(){return(yield(yield us()).fetchInventoryItems()).filter(i=>{var c,l;return i.category==="Supplies"&&(((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase())))})}),getFilteredEquipmentData:t=>ms(null,null,function*(){return(yield(yield us()).fetchInventoryItems()).filter(i=>{var c,l;return i.category==="Equipment"&&(((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase())))})}),getFilteredOfficeHardwareData:t=>ms(null,null,function*(){return(yield(yield us()).fetchInventoryItems()).filter(i=>{var c,l;return i.category==="Office Hardware"&&(((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase())))})}),refreshData:()=>ms(null,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,g,y,v,b,x,w,j;if(On){console.log("[useCentralizedInventoryData] Data fetch already in progress, skipping...");return}On=!0,r({isLoading:!0,error:null});try{let I=0;const E=2,O=25;for(;I<E;)try{const C=yield(yield us()).fetchAllInventoryData(),D=[...(t=C==null?void 0:C.tools)!=null?t:[],...(n=C==null?void 0:C.supplies)!=null?n:[],...(a=C==null?void 0:C.equipment)!=null?a:[],...(i=C==null?void 0:C.officeHardware)!=null?i:[]];console.log("[useCentralizedInventoryData] Setting state with data:",{allItems:D.length,tools:((c=C==null?void 0:C.tools)==null?void 0:c.length)||0,supplies:((l=C==null?void 0:C.supplies)==null?void 0:l.length)||0,equipment:((o=C==null?void 0:C.equipment)==null?void 0:o.length)||0,officeHardware:((d=C==null?void 0:C.officeHardware)==null?void 0:d.length)||0}),r({items:D,tools:(u=C==null?void 0:C.tools)!=null?u:[],supplies:(h=C==null?void 0:C.supplies)!=null?h:[],equipment:(p=C==null?void 0:C.equipment)!=null?p:[],officeHardware:(f=C==null?void 0:C.officeHardware)!=null?f:[],data:C,error:null,isLoading:!1}),Ra("âœ… single-source applied",{counts:{all:D.length,tools:((g=C==null?void 0:C.tools)!=null?g:[]).length,supplies:((y=C==null?void 0:C.supplies)!=null?y:[]).length,equipment:((v=C==null?void 0:C.equipment)!=null?v:[]).length,officeHardware:((b=C==null?void 0:C.officeHardware)!=null?b:[]).length}});break}catch(S){if(I++,I>=E)Ra("âŒ facade fetch failed after all retries; clearing state",String((x=S==null?void 0:S.message)!=null?x:S)),r({items:[],tools:[],supplies:[],equipment:[],officeHardware:[],error:String((w=S==null?void 0:S.message)!=null?w:S),isLoading:!1});else{Ra(`âš ï¸ Facade fetch attempt ${I} failed, retrying...`,String((j=S==null?void 0:S.message)!=null?j:S));const C=O*(I+1);yield new Promise(D=>setTimeout(D,C))}}}finally{On=!1}}),clearError:()=>r({error:null}),inventoryData:[],suppliesData:[],equipmentData:[],officeHardwareData:[]}),{name:"centralized-inventory-store",partialize:r=>({tools:r.tools,supplies:r.supplies,equipment:r.equipment,officeHardware:r.officeHardware,items:r.items,data:r.data})})),Qw=()=>{const r=cr(n=>n.refreshData),e=cr(n=>n.isLoading),t=cr(n=>n.data);return te.useEffect(()=>{if(!e&&!t&&!On){const n=setTimeout(()=>{r()},0);return()=>clearTimeout(n)}},[r,e,t]),{refreshData:r,isLoading:e}};var Aa=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Yw=()=>{const{getCycleStats:r,biTestResults:e,nextBITestDue:t,activityLog:n,availableTools:a,loadBITestResults:i,loadBIFailureIncidents:c}=K(),{tools:l}=cr(),[o,d]=m.useState([]),[u,h]=m.useState([]),[p,f]=m.useState(!1),[g,y]=m.useState(null),[v,b]=m.useState(!1),x=!l||l.length===0,w=m.useCallback(()=>Aa(null,null,function*(){try{console.log("ðŸ”„ Manually refreshing BI results...");const C="550e8400-e29b-41d4-a716-446655440000";yield i(C),yield c(C),console.log("âœ… BI results refreshed successfully")}catch(C){console.error("âŒ Failed to refresh BI results:",C)}}),[i,c]);m.useEffect(()=>{const C=()=>Aa(null,null,function*(){try{const A="550e8400-e29b-41d4-a716-446655440000";yield i(A),yield c(A)}catch(A){console.error("Failed to load BI activities:",A)}});C();const D=new Date,k=new Date(D);k.setDate(k.getDate()+1),k.setHours(0,0,0,0);const P=k.getTime()-D.getTime(),T=setTimeout(()=>{C(),setInterval(C,1440*60*1e3)},P);return()=>clearTimeout(T)},[i,c]);const j=m.useMemo(()=>{const C=l.length;if(x)return{totalTools:C,activeTools:0,completedToday:0};const D=a.filter(T=>T.currentPhase&&T.currentPhase!=="complete"&&T.currentPhase!=="failed").length,k=new Date,P=a.filter(T=>{if(!T.endTime)return!1;const z=new Date(T.endTime).toDateString()===k.toDateString(),W=T.currentPhase==="complete";return z&&W}).length;return{totalTools:C,activeTools:D,completedToday:P}},[a,l,x]),I=m.useMemo(()=>(console.log("ðŸ” recentBITests filter:",{isLoading:x,biTestResultsLength:(e==null?void 0:e.length)||0,biTestResults:(e==null?void 0:e.length)>0?e.slice(0,3).map(C=>({status:C.status,date:C.date,passed:C.passed,id:C.id})):"none"}),x||!e||e.length===0?[]:e.filter(C=>{const D=new Date;return D.setDate(D.getDate()-7),new Date(C.date)>=D}).sort((C,D)=>new Date(D.date).getTime()-new Date(C.date).getTime()).slice(0,5)),[e,x]),E=m.useMemo(()=>x||!n||n.length===0?[]:n.map(C=>{var D;const k=Jw(C.time);return{id:C.id,type:C.type,title:C.title,description:(D=C.data)==null?void 0:D.description,time:k,toolCount:C.toolCount,color:C.color,operatorId:C.operatorId,metadata:C.metadata}}),[n,x]),O=m.useCallback(()=>Aa(null,null,function*(){d([]),h([]),f(!1),b(!0),y(null)}),[]);return m.useEffect(()=>{!x&&a&&e&&n&&!v&&O().catch(C=>{console.warn("AI insights generation failed (non-blocking):",C)})},[x,a,e,n,O,v]),x?{stats:{totalCycles:0,completedCycles:0,averageCycleTime:0,biPassRate:100,efficiencyScore:{score:0,trend:null},cycleTrend:null,biPassRateTrend:null},additionalMetrics:j,recentBITests:I,nextBITestDue:null,recentActivities:E,aiInsights:[],aiForecasts:[],isAiLoading:!1,aiError:null,generateAIInsights:O,isLoading:!0}:{stats:r(),additionalMetrics:j,recentBITests:I,nextBITestDue:t,refreshBIResults:w,recentActivities:E,aiInsights:o,aiForecasts:u,isAiLoading:p,aiError:g,generateAIInsights:O,isLoading:!1}};function Jw(r){const t=new Date().getTime()-new Date(r).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return`${n} minute${n===1?"":"s"} ago`;const a=Math.floor(n/60);if(a<24)return`${a} hour${a===1?"":"s"} ago`;const i=Math.floor(a/24);return`${i} day${i===1?"":"s"} ago`}var $a=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class zi{static scanToolForCleanWorkflow(e,t){return $a(this,null,function*(){try{let n;try{if(n=yield Fe.getToolByBarcodeAndStatus(e,"clean"),!n)return{success:!1,message:`Tool with barcode "${e}" not found or not available for sterilization.`}}catch(o){return{success:!1,message:`Tool with barcode "${e}" not found or not available for sterilization.`}}if(n.current_cycle_id&&!n.id.startsWith("mock-tool-")){const{data:o}=yield _.from("sterilization_cycles").select("status").eq("id",n.current_cycle_id).single();if((o==null?void 0:o.status)!=="completed")return{success:!1,message:`Tool "${n.tool_name}" is not ready for clean workflow. Current cycle status: ${(o==null?void 0:o.status)||"unknown"}`}}const a=yield Fe.updateToolStatus(n.id,"dirty");yield Fe.clearCycleAssignment([n.id],"dirty"),yield Fe.markAsSterilized(n.id);const i={user_id:t,facility_id:n.facility_id,module:"sterilization",action:"tool_scanned_clean_workflow",table_name:"sterilization_tools",record_id:n.id,old_values:{status:"available",current_cycle_id:n.current_cycle_id},new_values:{status:"in_cycle",current_cycle_id:null},metadata:{barcode:e,workflow:"clean",previous_phase:"complete",new_phase:"dirty"}};yield _.from("audit_logs").insert(i);const c=a,l={id:c.id,name:c.tool_name,barcode:c.barcode,category:c.category||"general",type:c.tool_type,currentPhase:"failed",status:c.status,location:c.location,cycleCount:c.sterilization_count||0,lastSterilized:c.last_sterilized,notes:c.notes,is_p2_tool:c.is_p2_tool};return{success:!0,message:`Successfully scanned tool "${c.tool_name}" and marked as dirty. Ready for sterilization.`,tool:l}}catch(n){return console.error("Error scanning tool for clean workflow:",n),{success:!1,message:"An unexpected error occurred while scanning the tool."}}})}static scanToolForProblemWorkflow(e,t,n,a){return $a(this,null,function*(){try{const{data:i,error:c}=yield _.from("tools").select("*").eq("barcode",e).single();if(c||!i)return{success:!1,message:`Tool with barcode "${e}" not found in system.`};const l=i;let o=null;if(l.current_cycle_id){const{data:g}=yield _.from("sterilization_cycles").select("*").eq("id",l.current_cycle_id).single();o=g}const d=yield Fe.updateToolStatus(l.id,"problem");yield Fe.clearCycleAssignment([l.id],"problem");const{error:u}=yield _.from("tools").update({updated_at:new Date().toISOString(),notes:`PROBLEM: ${t} - ${n}`}).eq("id",l.id);if(u)return console.error("Failed to update tool status:",u),{success:!1,message:"Failed to update tool status. Please try again."};const h={user_id:a,facility_id:l.facility_id,module:"sterilization",action:"tool_scanned_problem_workflow",table_name:"sterilization_tools",record_id:l.id,old_values:{status:l.status,current_cycle_id:l.current_cycle_id,sterilization_count:l.sterilization_count,last_sterilized:l.last_sterilized},new_values:{status:"quarantine",current_cycle_id:null,notes:`PROBLEM: ${t} - ${n}`},metadata:{barcode:e,workflow:"problem",problem_type:t,problem_notes:n,previous_phase:"clean_workflow_scan",new_phase:"quarantine",last_cycle_id:l.current_cycle_id,last_cycle_status:o==null?void 0:o.status,last_cycle_completed:o==null?void 0:o.completed_at,sterilization_count_at_problem:l.sterilization_count,process_improvement_flag:!0,inspection_quality_issue:t.includes("damage")||t.includes("inspection"),cleaning_quality_issue:t.includes("cleaning")||t.includes("contamination")}};yield _.from("audit_logs").insert(h);const p=d,f={id:p.id,name:p.tool_name,barcode:p.barcode,category:p.category||"general",type:p.tool_type,currentPhase:"quarantine",status:p.status,location:p.location,cycleCount:p.sterilization_count||0,lastSterilized:p.last_sterilized,notes:p.notes,is_p2_tool:p.is_p2_tool};return{success:!0,message:`Tool "${p.tool_name}" marked as problem (${t}). Process improvement data collected.`,tool:f}}catch(i){return console.error("Error scanning tool for problem workflow:",i),{success:!1,message:"An unexpected error occurred while processing the problem tool."}}})}static getAvailableTools(e){return $a(this,null,function*(){try{return(yield Fe.getToolsByFacilityAndStatus(e,"clean")).sort((a,i)=>(a.name||"").localeCompare(i.name||"")).map(a=>{const i=a;return{id:i.id,name:i.tool_name,barcode:i.barcode,category:i.category||"general",type:i.tool_type,currentPhase:i.current_cycle_id?"complete":"available",status:i.status,location:i.location,cycleCount:i.sterilization_count||0,lastSterilized:i.last_sterilized,notes:i.notes}})}catch(t){return console.error("Error fetching available tools:",t),[]}})}}var vc=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Xw=()=>{const{currentUser:r}=hr(),{getCurrentFacilityId:e,isLoading:t}=Ku(),{availableTools:n,setAvailableTools:a,loadCycles:i}=K(),[c,l]=m.useState(!1),[o,d]=m.useState(!1),[u,h]=m.useState(null);return m.useEffect(()=>{vc(null,null,function*(){if(!(c||t)){if(!r){console.log("â³ Waiting for user authentication...");return}try{d(!0),h(null);const f=e();if(!f)throw new Error("User facility not found");const g=yield zi.getAvailableTools(f);a(g),yield i(f),l(!0)}catch(f){console.error("Failed to initialize sterilization store:",f),h(f instanceof Error?f.message:"Unknown error")}finally{d(!1)}}})},[r,c,a,i,e,t]),m.useEffect(()=>{if(c)return;vc(null,null,function*(){try{h(null);const f=e();if(!f){console.log("âš ï¸ No facility ID available, skipping sterilization initialization");return}yield i(f),l(!0),console.log("âœ… Sterilization analytics initialized successfully")}catch(f){console.error("Failed to initialize sterilization analytics:",f),h(f instanceof Error?f.message:"Unknown error")}})},[c,i,e]),{isInitialized:c,isLoading:o,error:u,hasData:n.length>0}},Zw=m.lazy(()=>H(()=>import("./RecentActivity-BMQXcSNd.js"),__vite__mapDeps([12,2,3,13,1,4,5])).then(r=>({default:r.RecentActivity}))),eS=m.lazy(()=>H(()=>import("./BITestResults-7aGgBMEs.js"),__vite__mapDeps([14,2,3,13,1,4,5])).then(r=>({default:r.BITestResults}))),tS=m.lazy(()=>H(()=>import("./ToolStatus-DmWBGIo_.js"),__vite__mapDeps([15,2,3,13,1,4,5])).then(r=>({default:r.ToolStatus}))),Ma=()=>s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-32 bg-gray-200 rounded-lg mb-4"}),s.jsx("div",{className:"h-24 bg-gray-200 rounded-lg"})]}),rS=()=>{var r,e;const[t,n]=m.useState(!0),{isLoading:a,error:i}=Xw(),{stats:c,additionalMetrics:l,recentBITests:o,nextBITestDue:d,recentActivities:u,refreshBIResults:h}=Yw();return m.useEffect(()=>{const p=setTimeout(()=>{n(!0)},100);return()=>clearTimeout(p)},[]),a||!t?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:Fr,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),s.jsx("div",{className:"text-sm text-gray-500",children:i?"Error loading data":"Loading..."})]}),i&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm",children:i}),s.jsxs("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((p,f)=>s.jsx("div",{className:"h-24 bg-gray-200 rounded"},f))}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[...Array(3)].map((p,f)=>s.jsx("div",{className:"h-32 bg-gray-200 rounded"},f))})]})]}):s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:Fr,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),s.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]}),s.jsx(Fw,{score:((r=c.efficiencyScore)==null?void 0:r.score)||0,trend:(e=c.efficiencyScore)==null?void 0:e.trend}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[s.jsx(fn,{title:"Total Cycles",value:c.totalCycles,icon:Cp,iconBgColor:"bg-blue-500",gradientFrom:"blue-50",gradientTo:"blue-100",borderColor:"blue-200",textColor:"text-blue-600",valueColor:"text-blue-800",trend:c.cycleTrend}),s.jsx(fn,{title:"Completed Cycles",value:c.completedCycles,icon:It,iconBgColor:"bg-green-500",gradientFrom:"green-50",gradientTo:"green-100",borderColor:"green-200",textColor:"text-green-600",valueColor:"text-green-800",trend:c.cycleTrend}),s.jsx(fn,{title:"Tool Turnaround Time",value:`${Math.round(c.averageCycleTime)} min`,icon:Ou,iconBgColor:"bg-purple-500",gradientFrom:"purple-50",gradientTo:"purple-100",borderColor:"purple-200",textColor:"text-purple-600",valueColor:"text-purple-800",trend:{direction:"down",value:"Target: <60 min"}}),s.jsx(fn,{title:"BI Pass Rate",value:`${Math.round(c.biPassRate)}%`,icon:$n,iconBgColor:"bg-orange-500",gradientFrom:"orange-50",gradientTo:"orange-100",borderColor:"orange-200",textColor:"text-orange-600",valueColor:"text-orange-800",trend:c.biPassRateTrend})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx(m.Suspense,{fallback:s.jsx(Ma,{}),children:s.jsx(Zw,{activities:u})}),s.jsx(m.Suspense,{fallback:s.jsx(Ma,{}),children:s.jsx(eS,{recentTests:o,nextTestDue:d,refreshBIResults:h})}),s.jsx(m.Suspense,{fallback:s.jsx(Ma,{}),children:s.jsx(tS,{totalTools:l.totalTools,activeTools:l.activeTools,completedToday:l.completedToday})})]})]})},sS=({quarantineData:r})=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(N,{path:mr,size:1,className:"text-gray-600"}),s.jsx("h3",{className:"font-medium text-gray-800",children:"Quarantine Summary"})]}),r.lastPassedDate&&s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{path:pt,size:.8,className:"text-blue-600"}),s.jsx("h4",{className:"font-medium text-blue-800 text-sm",children:"Last Successful BI Test"})]}),s.jsxs("p",{className:"text-xs text-blue-700",children:[s.jsx("strong",{children:"Date:"})," ",r.lastPassedDate.toLocaleDateString()," at"," ",r.lastPassedDate.toLocaleTimeString()]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.totalToolsAffected}),s.jsx("div",{className:"text-gray-600",children:"Tools Affected"})]}),s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.totalCyclesAffected}),s.jsx("div",{className:"text-gray-600",children:"Cycles Affected"})]}),s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r.uniqueOperators.length}),s.jsx("div",{className:"text-gray-600",children:"Operators Involved"})]}),s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.hasCurrentCycleAffected?"Yes":"No"}),s.jsx("div",{className:"text-gray-600",children:"Current Cycle Affected"})]})]}),r.dateRange&&s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{path:Ru,size:.8,className:"text-yellow-600"}),s.jsx("h4",{className:"font-medium text-yellow-800 text-sm",children:"Affected Date Range"})]}),s.jsxs("p",{className:"text-xs text-yellow-700",children:[s.jsx("strong",{children:"From:"})," ",r.dateRange.start.toLocaleDateString()," ",s.jsx("strong",{children:"To:"})," ",r.dateRange.end.toLocaleDateString()]})]}),Object.keys(r.toolsByCategory).length>0&&s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[s.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Tools by Category:"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:Object.entries(r.toolsByCategory).map(([e,t])=>s.jsxs("div",{className:"flex justify-between items-center bg-gray-50 px-2 py-1 rounded",children:[s.jsx("span",{className:"text-gray-600",children:e}),s.jsx("span",{className:"font-semibold text-gray-800",children:t})]},e))})]})]}),nS=({affectedCycles:r})=>r.length===0?null:s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[s.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Cycles:"}),s.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:s.jsxs("div",{className:"space-y-2 text-xs",children:[r.slice(0,5).map((e,t)=>s.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-800",children:e.cycleNumber||`Cycle ${t+1}`}),s.jsxs("div",{className:"text-gray-500",children:[new Date(e.startTime).toLocaleDateString()," -"," ",e.operator]})]}),s.jsxs("div",{className:"text-right text-xs text-gray-500",children:[s.jsxs("div",{children:[e.tools.length," tools"]}),s.jsxs("div",{children:[e.phases.length," phases"]})]})]})},e.id)),r.length>5&&s.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",r.length-5," more cycles affected"]})]})})]});var _s=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function hs(){return _s(this,null,function*(){const{data:{user:r}}=yield _.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:e,error:t}=yield _.from("users").select("facility_id").eq("id",r.id).single();if(t||!e)throw new Error("Failed to get user facility");return e.facility_id})}class aS{static getBatchInfoForTool(e){return _s(this,null,function*(){try{const{data:t,error:n}=yield _.from("sterilization_batches").select("*").eq("id",e).order("created_at",{ascending:!1}).limit(1).single();if(n||!t)return null;const a=t;let i;if(a.cycle_id){const d=yield hs(),{data:u,error:h}=yield _.from("sterilization_cycles").select("cycle_name").eq("id",a.cycle_id).eq("facility_id",d).single();!h&&u&&(i=u.cycle_name)}const{data:c,error:l}=yield _.from("users").select("name").eq("id",a.requested_by).single(),o=l?"Unknown":(c==null?void 0:c.full_name)||"Unknown";return{batchId:a.id,batchName:a.batch_name,cycleId:a.cycle_id,cycleName:i,status:a.status,totalItems:a.total_items,createdBy:o,createdAt:new Date(a.created_at),completedAt:a.completed_at?new Date(a.completed_at):void 0}}catch(t){return console.error("Error getting batch info for tool:",t),null}})}static getBatchInfoForTools(e){return _s(this,null,function*(){try{if(e.length===0)return[];const{data:t,error:n}=yield _.from("sterilization_batches").select("*").in("id",e).order("created_at",{ascending:!1});if(n||!t)return[];const a=yield hs(),{data:i,error:c}=yield _.from("tools").select("id, tool_name, barcode, last_sterilized, sterilization_count").in("id",e).eq("facility_id",a);if(c||!i)return[];const l=new Map(i.map(h=>[h.id,{name:h.tool_name,barcode:h.barcode,lastSterilized:h.last_sterilized,cycleCount:h.sterilization_count}])),o=t,d=Array.from(new Set(o.map(h=>h.cycle_id).filter(Boolean))),u=new Map;if(d.length>0){const h=yield hs(),{data:p,error:f}=yield _.from("sterilization_cycles").select("id, cycle_name").in("id",d).eq("facility_id",h);!f&&p&&p.forEach(g=>{u.set(g.id,g.cycle_name)})}return o.map(h=>{const p=l.get(h.id);return{toolId:h.id,toolName:(p==null?void 0:p.name)||"Unknown Tool",barcode:(p==null?void 0:p.barcode)||"Unknown",batchId:h.id,batchName:h.batch_name,cycleId:h.cycle_id,cycleName:h.cycle_id?u.get(h.cycle_id):void 0,status:h.status,lastSterilized:p!=null&&p.lastSterilized?new Date(p.lastSterilized):void 0,cycleCount:(p==null?void 0:p.cycleCount)||0}})}catch(t){return console.error("Error getting batch info for tools:",t),[]}})}static getCurrentBatchFromCycle(e){return _s(this,null,function*(){try{const t=yield hs(),{data:n,error:a}=yield _.from("tools").select("current_cycle_id, tool_name").eq("id",e).eq("facility_id",t).single(),i=n;if(a||!n||!i.current_cycle_id)return null;const{data:c,error:l}=yield _.from("sterilization_cycles").select("*").eq("id",i.current_cycle_id).eq("facility_id",t).single();if(l||!c)return null;const{data:o,error:d}=yield _.from("sterilization_batches").select("*").eq("cycle_id",i.current_cycle_id).single(),u=c;if(d||!o)return{batchId:`VIRTUAL-${i.current_cycle_id}`,batchName:`Cycle ${u.cycle_name||u.id}`,cycleId:i.current_cycle_id,cycleName:u.cycle_name,status:u.status,totalItems:1,createdBy:"System",createdAt:new Date(u.start_time),completedAt:u.end_time?new Date(u.end_time):void 0};const h=o,{data:p,error:f}=yield _.from("users").select("name").eq("id",h.requested_by).single(),g=p,y=f?"Unknown":(g==null?void 0:g.full_name)||"Unknown";return{batchId:h.id,batchName:h.batch_name,cycleId:h.cycle_id||void 0,cycleName:u.cycle_name,status:h.status,totalItems:h.total_items,createdBy:y,createdAt:new Date(h.created_at),completedAt:h.completed_at?new Date(h.completed_at):void 0}}catch(t){return console.error("Error getting current batch from cycle:",t),null}})}static generateBatchIdFromCycleData(e){try{if(e.cycleId)return`BATCH-${e.cycleId}`;if(e.lastSterilized){const t=new Date(e.lastSterilized);return`BATCH-${t.getFullYear()}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}-${e.id.slice(-4)}`}return e.currentCycleId?`BATCH-${e.currentCycleId}`:null}catch(t){return console.error("Failed to generate batch ID from cycle data:",t),null}}static getMostRecentBatchForTool(e){return _s(this,null,function*(){try{let t=yield this.getBatchInfoForTool(e);if(t||(t=yield this.getCurrentBatchFromCycle(e),t))return t;const n=yield hs(),{data:a,error:i}=yield _.from("tools").select("tool_name, last_sterilized, sterilization_count").eq("id",e).eq("facility_id",n).single();if(i||!a)return null;const c=a;if(c.last_sterilized){const l=new Date(c.last_sterilized);return{batchId:`VIRTUAL-${e}`,batchName:`Last Sterilization - ${c.tool_name}`,status:"completed",totalItems:1,createdBy:"System",createdAt:l,completedAt:l}}return null}catch(t){return console.error("Error getting most recent batch for tool:",t),null}})}}var Tm=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const iS=r=>Tm(null,null,function*(){try{const e=yield aS.getMostRecentBatchForTool(r);return e||null}catch(e){return console.error("Failed to get batch info for tool:",e),null}}),oS=({affectedTools:r})=>{const{availableTools:e}=K(),[t,n]=m.useState(new Map),[a,i]=m.useState(!1);m.useEffect(()=>{Tm(null,null,function*(){if(r.length!==0){i(!0);try{const o=new Map;for(const d of r){const u=yield iS(d.id);u&&o.set(d.id,u)}n(o)}catch(o){console.error("Failed to load batch info:",o)}finally{i(!1)}}})},[r]);const c=l=>{const o=e.find(d=>d.id===l);return o?{id:o.id,name:o.name,barcode:o.barcode,category:o.category,type:o.type||"Unknown",cycleCount:o.cycleCount||0,lastSterilized:o.lastSterilized,status:o.status,cycleId:o.cycleId}:{id:l,name:`Tool ${l}`,barcode:l,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:null,status:"unknown",cycleId:void 0}};return r.length===0?null:s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Tool Details:"}),s.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200 max-h-32 overflow-hidden",children:s.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:s.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs",children:[r.slice(0,6).map((l,o)=>{const d=c(l.id),u=t.get(l.id),h=(u==null?void 0:u.batchName)||"Batch Info Pending",p=u==null?void 0:u.cycleName,f=u==null?void 0:u.status,g=[`Tool: ${d.name}`,`Barcode: ${d.barcode}`,`Category: ${d.category}`,`Type: ${d.type}`,`Cycle Count: ${d.cycleCount}`,`Status: ${d.status}`,`Batch: ${h}`,...p?[`Cycle: ${p}`]:[],...f?[`Batch Status: ${f}`]:[]].join(`
`);return s.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700 hover:bg-gray-200 transition-colors cursor-help",title:g,children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-800",children:d.name}),s.jsxs("div",{className:"text-gray-500 text-xs",children:["#",d.barcode]}),s.jsx("div",{className:"text-orange-600 text-xs font-medium",children:a?"Loading Batch...":`Batch: ${h}`}),p&&s.jsxs("div",{className:"text-blue-600 text-xs",children:["Cycle: ",p]})]}),s.jsxs("div",{className:"text-right text-xs text-gray-500",children:[s.jsx("div",{children:d.category}),s.jsxs("div",{children:["Cycles: ",d.cycleCount]}),f&&s.jsx("div",{className:`text-xs ${f==="completed"?"text-green-600":f==="failed"?"text-red-600":f==="in_cycle"?"text-blue-600":"text-gray-600"}`,children:f})]})]})},o)}),r.length>6&&s.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",r.length-6," more tools affected"]})]})})})]}),s.jsx("div",{className:"mt-2 text-xs text-gray-600",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Note:"})," Hover over tools for detailed information. All tools must be quarantined and re-sterilized."]})})]})},lS=({totalToolsAffected:r})=>s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Required Actions"}),s.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),s.jsxs("span",{children:["Quarantine all ",r," affected tools immediately"]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{children:"Re-sterilize all quarantined tools"})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{children:"Perform a new BI test after re-sterilization"})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{children:"Contact supervisor for incident documentation"})]})]})]}),cS=({operatorName:r,totalToolsAffected:e,totalCyclesAffected:t})=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{path:Ru,size:1,className:"text-gray-600"}),s.jsx("span",{className:"font-medium text-gray-700",children:"Operator Confirmation"})]}),s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("strong",{children:r}),", by confirming this BI test failure, you acknowledge that:"]}),s.jsxs("ul",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[s.jsxs("li",{children:["â€¢ All ",e," affected tools will be quarantined"]}),s.jsxs("li",{children:["â€¢ ",t," sterilization cycles are affected"]}),s.jsx("li",{children:"â€¢ A compliance incident report will be generated"}),s.jsx("li",{children:"â€¢ Re-sterilization procedures must be followed"})]})]}),dS=({onCancel:r})=>s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-red-50",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:s.jsx(N,{path:tt,size:1.5,className:"text-red-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-red-800",children:"BI Test Failure - Critical Alert"}),s.jsx("p",{className:"text-sm text-red-600",children:"Sterilization process failure detected"})]})]}),s.jsx("button",{onClick:r,className:"p-2 hover:bg-red-100 rounded-lg transition-colors",children:s.jsx(N,{path:Ae,size:1,className:"text-red-600"})})]}),uS=()=>s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(N,{path:ce,size:1.2,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-red-800 mb-2",children:"Immediate Action Required"}),s.jsx("p",{className:"text-sm text-red-700",children:"A Biological Indicator test failure indicates that the sterilization process may not have been effective. All tools processed since the last successful BI test must be quarantined and re-sterilized."})]})]})}),mS=({isOpen:r,onConfirm:e,onCancel:t,operatorName:n})=>{const a=Pi();return r?Rs.createPortal(s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:t,onKeyDown:i=>{i.key==="Escape"&&t()},role:"button",tabIndex:0,"aria-label":"Close modal"}),s.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[s.jsx(dS,{onCancel:t}),s.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto bi-modal-scrollbar-hide",children:[s.jsx(uS,{}),s.jsx(sS,{quarantineData:a}),s.jsx(nS,{affectedCycles:a.affectedCycles}),s.jsx(oS,{affectedTools:a.affectedTools}),s.jsx(lS,{totalToolsAffected:a.totalToolsAffected}),s.jsx(cS,{operatorName:n,totalToolsAffected:a.totalToolsAffected,totalCyclesAffected:a.totalCyclesAffected})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[s.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:e,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Confirm BI Test Failure"})]})]})]}),document.body):null},hS=({isVisible:r,onComplete:e,onOptOut:t})=>{const[n,a]=m.useState(!1),[i,c]=m.useState(null),{currentCycle:l,enforceBI:o}=K(),d=Pi();if(!r||!o)return null;const u=f=>{if(f==="fail"){c(f),a(!0);return}const g={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:f==="pass",date:new Date,status:f,operator:(l==null?void 0:l.operator)||"Operator"};f==="skip"&&t(),e(g)},h=()=>{if(a(!1),i){const f={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:!1,date:new Date,status:"fail",operator:(l==null?void 0:l.operator)||"Operator"},{activateBIFailure:g}=K.getState(),y=d.totalToolsAffected,v=d.affectedCycles.map(b=>b.batchId).filter(b=>!!b);g({affectedToolsCount:y,affectedBatchIds:v,operator:(l==null?void 0:l.operator)||"Operator"}),e(f)}c(null)},p=()=>{a(!1),c(null)};return s.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 mb-4 rounded-r-lg shadow-sm",children:[s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[s.jsx("div",{className:"p-2 bg-orange-100 rounded-lg flex-shrink-0",children:s.jsx(N,{path:$n,size:1.2,className:"text-orange-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold text-orange-800",children:"Daily BI Test Required"}),s.jsxs("span",{className:"text-sm text-orange-600",children:["(",new Date().toLocaleDateString(),")"]})]}),s.jsx("p",{className:"text-orange-700 text-sm mb-3",children:"Please complete the daily Biological Indicator test to ensure sterilization compliance."}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:()=>u("pass"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-green-300 hover:border-green-500 bg-green-50 hover:bg-green-100 text-green-800 transition-colors",children:[s.jsx(N,{path:It,size:1,className:"text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"PASS"})]}),s.jsxs("button",{onClick:()=>u("fail"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-red-300 hover:border-red-500 bg-red-50 hover:bg-red-100 text-red-800 transition-colors",children:[s.jsx(N,{path:ce,size:1,className:"text-red-600"}),s.jsx("span",{className:"text-sm font-medium",children:"FAIL"})]}),s.jsxs("button",{onClick:()=>u("skip"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-gray-300 hover:border-gray-500 bg-gray-50 hover:bg-gray-100 text-gray-800 transition-colors",children:[s.jsx(N,{path:$n,size:1,className:"text-gray-600"}),s.jsx("span",{className:"text-sm font-medium",children:"SKIP"})]})]})]})]})}),s.jsx(mS,{isOpen:n,onConfirm:h,onCancel:p,operatorName:(l==null?void 0:l.operator)||"Operator"})]})},pS=r=>{if(!r)return!0;const e=new Date().toDateString();return new Date(r).toDateString()!==e};class Qt{static getTabs(){return[{id:"timers",label:"Phase Timers",icon:Lr},{id:"analytics",label:"Analytics",icon:Fr},{id:"logs",label:"Cleaning Logs",icon:Ye}]}static getCycleProgressInfo(e){const t=e.phases.some(a=>a.status==="active"),n=e.phases.map(a=>({id:a.id,name:a.name,status:a.status,toolCount:a.tools.length,statusColor:this.getPhaseStatusColor(a.status)}));return{hasActivePhase:t,phaseStatuses:n}}static getPhaseStatusColor(e){switch(e){case"completed":return"bg-green-500";case"active":return"bg-blue-500";case"failed":return"bg-red-500";default:return"bg-gray-300"}}static validateOperatorName(e){return e.trim().length>0}static getTabButtonClasses(e){return e?"bg-[#4ECDC4] text-white shadow-md":"text-gray-600 hover:text-[#4ECDC4] hover:bg-gray-50"}static getStartCycleButtonState(e){const t=!this.validateOperatorName(e),n=this.validateOperatorName(e)?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-gray-300 text-gray-500 cursor-not-allowed";return{disabled:t,className:n}}static shouldShowNoCycleMessage(e){return!e}static shouldShowActiveCycleInfo(e){return e.phases.some(t=>t.status==="active")}}const fS=()=>{const{currentCycle:r}=K();m.useRef(performance.now());const e=m.useMemo(()=>Qt.getTabs(),[]),t=m.useMemo(()=>r?Qt.getCycleProgressInfo(r):null,[r]),n=m.useCallback(o=>Qt.validateOperatorName(o),[]),a=m.useCallback(o=>Qt.getTabButtonClasses(o),[]),i=m.useCallback(o=>Qt.getStartCycleButtonState(o),[]),c=m.useCallback(()=>Qt.shouldShowNoCycleMessage(r),[r]),l=m.useCallback(()=>r?Qt.shouldShowActiveCycleInfo(r):!1,[r]);return m.useMemo(()=>{},[]),{tabs:e,cycleProgressInfo:t,validateOperatorName:n,getTabButtonClasses:a,getStartCycleButtonState:i,shouldShowNoCycleMessage:c,shouldShowActiveCycleInfo:l}},gS=()=>{const[r,e]=m.useState("timers"),[t,n]=m.useState(!1),[a,i]=m.useState(""),c=m.useCallback(p=>{(p==="timers"||p==="analytics"||p==="logs")&&e(p)},[]),l=m.useCallback(p=>{i(p.target.value)},[]),o=m.useCallback(p=>{p.key},[]),d=m.useCallback(()=>{n(!1),i("")},[]),u=m.useCallback(()=>{n(!0)},[]),h=m.useCallback(()=>{i("")},[]);return{activeTab:r,showNewCycleModal:t,operatorName:a,handleTabChange:c,handleOperatorNameChange:l,handleOperatorNameKeyPress:o,handleCloseNewCycleModal:d,openNewCycleModal:u,resetOperatorName:h}},Em=m.memo(()=>s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Sterilization Management"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"Manage sterilization cycles, track tools, and monitor performance"})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-6 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsx("span",{className:"text-gray-600",children:"Tool Scanner"}),s.jsxs(wu,{to:"/sterilization/scanner",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center gap-2",children:[s.jsx(N,{path:Qe,size:1}),"Scan Tool"]})]})]}));Em.displayName="DashboardHeader";var yS=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Ve{static fetchCleaningLogs(){return yS(this,null,function*(){try{const{data:e,error:t}=yield _.from("sterilization_cycles").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching sterilization cycles:",t),t;return(e||[]).map(a=>({id:a.id,room_id:a.id,room_name:`Cycle ${a.id.slice(0,8)}`,status:a.status||"in_progress",cleaning_type:"sterilization",scheduled_time:a.start_time,started_time:a.start_time,completed_time:a.completed_at,operator_id:a.operator_id,notes:a.notes||"",checklist_items:[],completed_items:[],failed_items:[],created_at:a.created_at,updated_at:a.updated_at}))}catch(e){return console.error("Failed to fetch sterilization cycles:",e),[]}})}static filterCleaningLogs(e,t){return e.filter(n=>{let a=!1;t.status==="all"?a=!0:t.status==="in_progress"?a=n.status==="pending"||n.status==="in_progress":a=n.status===t.status;const i=!t.date||new Date(n.created_at).toDateString()===new Date(t.date).toDateString();return a&&i})}static calculateStats(e){return{totalCycles:e.length,completed:e.filter(t=>t.status==="completed").length,failed:e.filter(t=>t.status==="failed").length,totalTools:e.length}}static getStatusColor(e){switch(e){case"completed":return{color:"text-green-600 bg-green-100"};case"verified":return{color:"text-blue-600 bg-blue-100"};case"failed":return{color:"text-red-600 bg-red-100"};case"in_progress":return{color:"text-yellow-600 bg-yellow-100"};case"pending":return{color:"text-gray-600 bg-gray-100"};case"cancelled":return{color:"text-orange-600 bg-orange-100"};default:return{color:"text-gray-600 bg-gray-100"}}}static formatDuration(e,t){if(!t)return"In Progress";const n=new Date(e),i=new Date(t).getTime()-n.getTime(),c=Math.floor(i/(1e3*60)),l=Math.floor(c/60),o=c%60;return`${l}h ${o}m`}static getBITestResultsForCycle(e,t){return e.filter(n=>{const a=new Date(t);return new Date(n.date).toDateString()===a.toDateString()})}static getBITestResultColor(e){return e==="pass"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}static formatTestTime(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static getCleaningTypeDisplayName(e){switch(e){case"routine":return"Routine";case"deep_clean":return"Deep Clean";case"emergency":return"Emergency";case"post_procedure":return"Post Procedure";default:return e}}static getQualityScoreDisplay(e){return e?`${Math.round(e*100)}%`:"N/A"}static getComplianceScoreDisplay(e){return e?`${Math.round(e*100)}%`:"N/A"}static exportToCSV(e){if(!e||e.length===0){alert("No data to export");return}try{const t=["Cycle ID","Room Name","Status","Cleaning Type","Scheduled Time","Started Time","Completed Time","Operator ID","Notes","Created At","Updated At"],n=e.map(o=>[o.id,o.room_name,o.status,o.cleaning_type,o.scheduled_time||"",o.started_time||"",o.completed_time||"",o.operator_id||"",o.notes||"",o.created_at,o.updated_at]),a=[t.join(","),...n.map(o=>o.map(d=>`"${d}"`).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),c=window.URL.createObjectURL(i),l=document.createElement("a");l.href=c,l.download=`cleaning_logs_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(c)}catch(t){console.error("Failed to export cleaning logs:",t),alert("Failed to export data. Please try again.")}}}var vS=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const xS=({filterStatus:r,filterDate:e})=>{const{biTestResults:t}=K(),[n,a]=m.useState([]),[i,c]=m.useState(!0),[l,o]=m.useState(null);m.useEffect(()=>{vS(null,null,function*(){try{c(!0),o(null);const I=yield Ve.fetchCleaningLogs();a(I)}catch(I){console.error("Failed to fetch cleaning logs:",I),o("Failed to load cleaning logs")}finally{c(!1)}})},[]);const d=m.useMemo(()=>{const j={status:r,date:e};return Ve.filterCleaningLogs(n,j)},[n,r,e]),u=m.useMemo(()=>Ve.calculateStats(d),[d]);return{filteredLogs:d,stats:u,loading:i,error:l,getStatusColor:j=>Ve.getStatusColor(j).color,formatDuration:(j,I)=>Ve.formatDuration(j,I),getBITestResultsForCycle:j=>Ve.getBITestResultsForCycle(t,j),getBITestResultColor:j=>Ve.getBITestResultColor(j),formatTestTime:j=>Ve.formatTestTime(j),getCleaningTypeDisplayName:j=>Ve.getCleaningTypeDisplayName(j),getQualityScoreDisplay:j=>Ve.getQualityScoreDisplay(j),getComplianceScoreDisplay:j=>Ve.getComplianceScoreDisplay(j),exportLogs:()=>{Ve.exportToCSV(d)}}},bS=()=>{const[r,e]=m.useState(null),[t,n]=m.useState("all"),[a,i]=m.useState(""),{filteredLogs:c,stats:l,loading:o,error:d,getStatusColor:u,formatDuration:h,getBITestResultsForCycle:p,getBITestResultColor:f,formatTestTime:g,getQualityScoreDisplay:y,getComplianceScoreDisplay:v,exportLogs:b}=xS({filterStatus:t,filterDate:a});return o?s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(N,{path:ku,size:2,className:"animate-spin text-[#4ECDC4] mr-3"}),s.jsx("span",{className:"text-gray-600",children:"Loading cleaning logs..."})]})}):d?s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(N,{path:ce,size:2,className:"text-red-500 mr-3"}),s.jsx("span",{className:"text-red-600",children:d})]})}):s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:Ye,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Cleaning Log Tracker"]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[s.jsx(N,{path:Ti,size:1}),"Export"]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Filter"}),s.jsxs("select",{id:"status-filter",value:t,onChange:x=>n(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[s.jsx("option",{value:"all",children:"All Statuses"}),s.jsx("option",{value:"in_progress",children:"In Progress"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"failed",children:"Failed"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Filter"}),s.jsx("input",{id:"date-filter",type:"date",value:a,onChange:x=>i(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]"})]}),s.jsx("div",{className:"flex items-end",children:s.jsx("button",{onClick:()=>{n("all"),i("")},className:"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear Filters"})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-green-600",children:"Completed"}),s.jsx("p",{className:"text-2xl font-bold text-green-800",children:l.completed})]}),s.jsx(N,{path:It,size:1.5,className:"text-green-500"})]})}),s.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-red-600",children:"Failed"}),s.jsx("p",{className:"text-2xl font-bold text-red-800",children:l.failed})]}),s.jsx(N,{path:ce,size:1.5,className:"text-red-500"})]})}),s.jsx("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Cycles"}),s.jsx("p",{className:"text-2xl font-bold text-purple-800",children:l.totalTools})]}),s.jsx(N,{path:ir,size:1.5,className:"text-purple-500"})]})})]}),s.jsx("div",{className:"space-y-4",children:c.length===0?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No sterilization cycles found for the selected filters."}):c.map(x=>s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:x.room_name}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u(x.status)}`,children:x.status.toUpperCase()}),s.jsx("span",{className:"text-sm text-gray-500",children:"Sterilization Cycle"})]}),s.jsxs("button",{onClick:()=>e(r===x.id?null:x.id),className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[s.jsx(N,{path:Np,size:1}),r===x.id?"Hide":"View"," Details"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:Ns,size:1}),s.jsxs("span",{children:["Scheduled:"," ",new Date(x.scheduled_time).toLocaleDateString()]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:Ou,size:1}),s.jsxs("span",{children:["Duration:"," ",h(x.started_time||x.scheduled_time,x.completed_time)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:Au,size:1}),s.jsxs("span",{children:["Room ID: ",x.room_id]})]})]}),r===x.id&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Quality Metrics"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Quality Score:"}),s.jsx("span",{className:"font-medium",children:y(x.quality_score)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Compliance Score:"}),s.jsx("span",{className:"font-medium",children:v(x.compliance_score)})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Timeline"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Scheduled:"}),s.jsx("span",{children:new Date(x.scheduled_time).toLocaleString()})]}),x.started_time&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Started:"}),s.jsx("span",{children:new Date(x.started_time).toLocaleString()})]}),x.completed_time&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Completed:"}),s.jsx("span",{children:new Date(x.completed_time).toLocaleString()})]})]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center gap-2",children:[s.jsx(N,{path:$n,size:1}),"BI Test Results"]}),s.jsxs("div",{className:"space-y-2",children:[p(x.created_at).map((w,j)=>s.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${f(w.passed?"pass":"fail")}`,children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{children:w.passed?"PASS":"FAIL"}),s.jsx("span",{children:g(new Date(w.date))})]})},j)),p(x.created_at).length===0&&s.jsx("p",{className:"text-sm text-gray-500",children:"No BI tests for this date"})]})]})]})]},x.id))})]})};var _S=Object.defineProperty,wS=Object.defineProperties,SS=Object.getOwnPropertyDescriptors,xc=Object.getOwnPropertySymbols,jS=Object.prototype.hasOwnProperty,CS=Object.prototype.propertyIsEnumerable,bc=(r,e,t)=>e in r?_S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ie=(r,e)=>{for(var t in e||(e={}))jS.call(e,t)&&bc(r,t,e[t]);if(xc)for(var t of xc(e))CS.call(e,t)&&bc(r,t,e[t]);return r},le=(r,e)=>wS(r,SS(e));const Os=Nt((r,e)=>({timers:{},overexposed:!1,intervals:{},startTimer:(t,n,a)=>{const i=e().intervals[t];i&&clearInterval(i),r(l=>({timers:le(ie({},l.timers),{[t]:{id:t,timeRemaining:a?a.timeRemaining:t==="drying"?0:n,elapsedTime:a?a.elapsedTime:0,duration:n,isRunning:!0,overexposed:!1}})}));const c=setInterval(()=>{const l=e().timers[t];if(l&&l.isRunning)if(t==="drying"){const o=l.elapsedTime+1;r(d=>({timers:le(ie({},d.timers),{[t]:le(ie({},l),{elapsedTime:o})})}))}else{const o=l.elapsedTime+1;if(l.timeRemaining>0){const d=l.timeRemaining-1;r(u=>({timers:le(ie({},u.timers),{[t]:le(ie({},l),{timeRemaining:d,elapsedTime:o,overexposed:!1})})}))}else{const d=t==="bath1"||t==="bath2",u=d?l.elapsedTime-l.duration:0;r(h=>({timers:le(ie({},h.timers),{[t]:le(ie({},l),{timeRemaining:0,elapsedTime:o,overexposed:d&&u>0})}),overexposed:d&&u>0||h.overexposed}))}}},1e3);r(l=>({intervals:le(ie({},l.intervals),{[t]:c})}))},pauseTimer:t=>{const n=e().intervals[t];n&&(clearInterval(n),r(a=>{const i=ie({},a.intervals);return delete i[t],{intervals:i}})),r(a=>({timers:le(ie({},a.timers),{[t]:a.timers[t]?le(ie({},a.timers[t]),{isRunning:!1}):a.timers[t]})}))},resetTimer:t=>{const n=e().intervals[t];n&&(clearInterval(n),r(a=>{const i=ie({},a.intervals);return delete i[t],{intervals:i}})),r(a=>({timers:le(ie({},a.timers),{[t]:a.timers[t]?le(ie({},a.timers[t]),{timeRemaining:t==="drying"?0:a.timers[t].duration,elapsedTime:0,isRunning:!1,overexposed:!1}):a.timers[t]})}))},updateTimer:(t,n)=>{r(a=>({timers:le(ie({},a.timers),{[t]:a.timers[t]?le(ie({},a.timers[t]),{timeRemaining:n}):a.timers[t]})}))},getTimer:t=>e().timers[t],resumeTimer:t=>{const n=e().timers[t];if(!n)return;const a=e().intervals[t];a&&clearInterval(a),r(c=>({timers:le(ie({},c.timers),{[t]:le(ie({},n),{isRunning:!0})})}));const i=setInterval(()=>{const c=e().timers[t];if(c&&c.isRunning)if(t==="drying"){const l=c.elapsedTime+1;r(o=>({timers:le(ie({},o.timers),{[t]:le(ie({},c),{elapsedTime:l})})}))}else{const l=c.elapsedTime+1;if(c.timeRemaining>0){const o=c.timeRemaining-1;r(d=>({timers:le(ie({},d.timers),{[t]:le(ie({},c),{timeRemaining:o,elapsedTime:l,overexposed:!1})})}))}else{const o=t==="bath1"||t==="bath2",d=o?c.elapsedTime-c.duration:0;r(u=>({timers:le(ie({},u.timers),{[t]:le(ie({},c),{timeRemaining:0,elapsedTime:l,overexposed:o&&d>0})}),overexposed:o&&d>0||u.overexposed}))}}},1e3);r(c=>({intervals:le(ie({},c.intervals),{[t]:i})}))},setOverexposed:t=>{r({overexposed:t})}})),NS={unwrapped:{name:"Unwrapped",temp:"132Â°C (270Â°F)",sterilizeTime:3,dryTime:30,totalTime:15,duration:900},pouches:{name:"Pouches",temp:"132Â°C (270Â°F)",sterilizeTime:5,dryTime:30,totalTime:17,duration:1020},packs:{name:"Packs",temp:"121Â°C (250Â°F)",sterilizeTime:30,dryTime:30,totalTime:40,duration:2400},handpieces:{name:"Handpieces",temp:"132Â°C (270Â°F)",sterilizeTime:6,dryTime:30,totalTime:16,duration:960}},IS=()=>"pouches";var TS=Object.defineProperty,ES=Object.defineProperties,kS=Object.getOwnPropertyDescriptors,_c=Object.getOwnPropertySymbols,DS=Object.prototype.hasOwnProperty,PS=Object.prototype.propertyIsEnumerable,wc=(r,e,t)=>e in r?TS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sc=(r,e)=>{for(var t in e||(e={}))DS.call(e,t)&&wc(r,t,e[t]);if(_c)for(var t of _c(e))PS.call(e,t)&&wc(r,t,e[t]);return r},jc=(r,e)=>ES(r,kS(e));const OS=()=>{const{timers:r,startTimer:e,pauseTimer:t,resetTimer:n,resumeTimer:a}=Os(),{currentCycle:i,setCurrentCycle:c}=K(),l=m.useCallback((u,h)=>{e(u,h)},[e]),o=m.useCallback(u=>{const h=r[u];h!=null&&h.isRunning?t(u):h&&a(u)},[r,t,a]),d=m.useCallback(u=>{if(console.log("ðŸ›‘ Cancelling timer for phase:",u),t(u),n(u),i){console.log("ðŸ›‘ Clearing tools from cycle. Current tools:",i.tools);const h=jc(Sc({},i),{tools:[],phases:i.phases.map(p=>jc(Sc({},p),{tools:[],isActive:!1,status:"pending",startTime:null,endTime:null}))});c(h),console.log("âœ… Cycle cleared, tools removed. Workflow can be restarted.")}},[t,n,i,c]);return{handleStartTimer:l,handlePauseTimer:o,handleStopTimer:d}};var RS=Object.defineProperty,AS=Object.defineProperties,$S=Object.getOwnPropertyDescriptors,Cc=Object.getOwnPropertySymbols,MS=Object.prototype.hasOwnProperty,FS=Object.prototype.propertyIsEnumerable,Nc=(r,e,t)=>e in r?RS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,LS=(r,e)=>{for(var t in e||(e={}))MS.call(e,t)&&Nc(r,t,e[t]);if(Cc)for(var t of Cc(e))FS.call(e,t)&&Nc(r,t,e[t]);return r},zS=(r,e)=>AS(r,$S(e));class BS{constructor(){this.notifications=[],this.priorityQueue=[],this.statusChangeCallbacks=[]}trackTool(e,t,n="medium"){const a=this.priorityQueue.findIndex(i=>i.toolId===e&&i.doctorName===t);a>=0?this.priorityQueue[a]=zS(LS({},this.priorityQueue[a]),{timestamp:new Date().toISOString(),priority:n,status:"waiting"}):this.priorityQueue.push({toolId:e,doctorName:t,timestamp:new Date().toISOString(),priority:n,status:"waiting"})}untrackTool(e,t){const n=this.priorityQueue.findIndex(a=>a.toolId===e&&a.doctorName===t);if(n>=0){const a=this.getToolTrackers(e),i=this.priorityQueue[n];this.priorityQueue.splice(n,1),this.notifyQueuePositionChanges(e,a,i.doctorName)}}notifyQueuePositionChanges(e,t,n){const a=this.getToolTrackers(e);t.forEach((i,c)=>{i.doctorName!==n&&a.findIndex(l=>l.doctorName===i.doctorName)})}isToolTracked(e){return this.priorityQueue.some(t=>t.toolId===e)}getToolTrackers(e){return this.priorityQueue.filter(t=>t.toolId===e).sort((t,n)=>{const a={high:3,medium:2,low:1},i=a[n.priority]-a[t.priority];return i!==0?i:new Date(t.timestamp).getTime()-new Date(n.timestamp).getTime()})}monitorToolStatusChange(e,t,n){(n==="available"||n==="complete")&&this.handleToolBecameAvailable(e),t==="available"&&(n==="in_use"||n==="sterilizing")&&this.handleToolBecameUnavailable(e),this.statusChangeCallbacks.forEach(a=>a(e,t,n))}handleToolBecameUnavailable(e){const t=this.getToolTrackers(e);t.length!==0&&t.forEach((n,a)=>{})}handleToolBecameAvailable(e){const t=this.getToolTrackers(e);if(t.length===0)return;const n={high:3,medium:2,low:1},a=[...t].sort((l,o)=>n[o.priority]-n[l.priority]),i=a[0];if(i&&i.status==="waiting"){const l=`Tool ${e}`,o={id:`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,toolId:e,toolName:l,doctorName:i.doctorName,timestamp:new Date().toISOString(),status:"pending",priority:i.priority,message:"Your tracked tool is now available! You have first priority to claim it."};this.notifications.push(o),i.status="notified"}a.map(l=>l.doctorName===i.doctorName?i:l).forEach(l=>{const o=this.priorityQueue.findIndex(d=>d.toolId===e&&d.doctorName===l.doctorName);o>=0&&(this.priorityQueue[o]=l)})}acknowledgeNotification(e){const t=this.notifications.find(n=>n.id===e);if(t){t.status="acknowledged";const n=this.priorityQueue.find(a=>a.toolId===t.toolId&&a.doctorName===t.doctorName);n&&(n.status="claimed")}}getPendingNotifications(e){return this.notifications.filter(t=>t.doctorName===e&&t.status==="pending")}getAllNotifications(e){return this.notifications.filter(t=>t.doctorName===e)}clearExpiredNotifications(){const e=new Date(Date.now()-864e5);this.notifications=this.notifications.filter(t=>{const n=new Date(t.timestamp)<e;return n&&t.status==="pending"&&(t.status="expired"),!n})}subscribeToStatusChanges(e){return this.statusChangeCallbacks.push(e),()=>{const t=this.statusChangeCallbacks.indexOf(e);t>=0&&this.statusChangeCallbacks.splice(t,1)}}isCleanStatus(e){const t=e.toLowerCase();return["clean","active"].includes(t)}getPriorityQueue(e){return this.priorityQueue.filter(t=>t.toolId===e).sort((t,n)=>{const a={high:3,medium:2,low:1},i=a[n.priority]-a[t.priority];return i!==0?i:new Date(t.timestamp).getTime()-new Date(n.timestamp).getTime()})}getTrackedToolsForDoctor(e){return this.priorityQueue.filter(t=>t.doctorName===e)}getTrackingStats(){const e=this.priorityQueue.length,t=this.priorityQueue.filter(c=>c.priority==="high").length,n=this.priorityQueue.filter(c=>c.priority==="medium").length,a=this.priorityQueue.filter(c=>c.priority==="low").length,i=this.notifications.filter(c=>c.status==="pending").length;return{totalTracked:e,highPriority:t,mediumPriority:n,lowPriority:a,pendingNotifications:i}}}const Ic=new BS,qS=()=>{const{startTimer:r,pauseTimer:e,resetTimer:t}=Os(),{currentCycle:n,moveToolToNextPhase:a,updateToolStatus:i,addActivity:c}=K(),{currentUser:l}=hr();return{handleMoveToNextPhase:m.useCallback(d=>{if(console.log(`ðŸ”„ Starting phase transition from ${d}`),!l){console.log("âŒ User authentication required for phase transitions"),alert("Please log in to perform sterilization phase transitions");return}if(!n){console.log("âŒ No active cycle found");return}const u=n.tools.some(g=>{const y=K.getState().availableTools.find(v=>v.id===g);return y==null?void 0:y.isP2Status});if(d==="drying"&&u){console.log("âœ… Completing P2 Status tools after drying phase"),n.tools.forEach(g=>{const y=K.getState().availableTools.find(v=>v.id===g);if(y!=null&&y.isP2Status){const v=K.getState();v.incrementToolCycleCount&&v.incrementToolCycleCount(g),i(g,"complete"),Ic.monitorToolStatusChange(g,"drying","complete"),console.log(`âœ… P2 Status tool ${y.name} completed and cycle count incremented`)}}),e(d),t(d);return}const h=["bath1","bath2","airDry","autoclave"],p=h.indexOf(d),f=h[p+1];if(f){console.log(`ðŸ”„ Moving tools from ${d} to ${f}`),n.tools.forEach(y=>{const v=K.getState().availableTools.find(b=>b.id===y);v&&(a(y),i(y,f),console.log(`âœ… Moved tool ${v.name} from ${d} to ${f}`))}),e(d),t(d);const g=Yu[f];g&&r(f,g.duration),console.log(`âœ… Phase transition completed: ${d} â†’ ${f}`)}else{console.log("âœ… Completing all tools after autoclave phase");const g=[];n.tools.forEach(y=>{const v=K.getState().availableTools.find(b=>b.id===y);if(v){const b=K.getState();b.incrementToolCycleCount&&b.incrementToolCycleCount(y),i(y,"complete"),Ic.monitorToolStatusChange(y,"autoclave","available"),g.push(v),console.log(`âœ… Tool ${v.name} completed sterilization cycle and marked as available`)}}),g.length>0&&(c({id:`cycle-${n.cycleNumber}-${Date.now()}`,type:"cycle-complete",title:`Cycle ${n.cycleNumber} Completed`,time:new Date,toolCount:g.length,color:"bg-green-500"}),console.log(`âœ… Activity logged: Cycle ${n.cycleNumber} completed with ${g.length} tools`)),e(d),t(d)}},[l,n,r,e,t,a,i,c])}},qt=r=>{const e=Math.floor(r/3600),t=Math.floor(r%3600/60),n=r%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},US=(r,e)=>r?"bg-red-100 text-red-700 border border-red-200":e?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-600",HS=(r,e)=>r?"OVEREXPOSED":e?"ACTIVE":"INACTIVE",VS=(r,e,t,n)=>{var a;if(!r)return e==="drying"?"00:00:00":qt(t);if(e==="drying")return qt(n);if((e==="bath1"||e==="bath2")&&r.overexposed&&r.elapsedTime){const c=r.elapsedTime-t;return`+${qt(c)}`}return qt((a=r.timeRemaining)!=null?a:0)},WS=({phaseId:r,phaseConfig:e,timer:t,duration:n,elapsedTime:a,isExpanded:i,onToggleExpanded:c})=>{var l;const{currentCycle:o}=K(),d=(l=t==null?void 0:t.timeRemaining)!=null?l:n,u=(t==null?void 0:t.isRunning)||!1,h=(t==null?void 0:t.overexposed)||!1,p=o==null?void 0:o.tools.some(f=>{const g=K.getState().availableTools.find(y=>y.id===f);return g==null?void 0:g.isP2Status});return s.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:c,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&c()},role:"button",tabIndex:0,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("h3",{className:"text-lg font-semibold text-[#5b5b5b]",children:e.label}),s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${US(h,u)}`,children:HS(h,u)}),r==="drying"&&p&&s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 border border-blue-200",children:"P2 STATUS"})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:`text-2xl font-mono font-bold ${h?"text-red-600":"text-[#5b5b5b]"}`,children:VS(t,r,n,a)}),s.jsx("div",{className:"text-xs text-gray-500",children:t?`${t.elapsedTime?`${Math.floor(t.elapsedTime/60)}:${(t.elapsedTime%60).toString().padStart(2,"0")}`:"00:00"} elapsed`:"Ready"})]}),s.jsx(N,{path:i?Ip:Fs,size:1,className:"text-gray-400"})]})]}),r!=="drying"&&s.jsxs("div",{className:"mt-3",children:[s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 relative",children:s.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${h?"bg-red-500":"bg-[#4ECDC4]"}`,style:{width:`${d/n*100}%`}})}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:h&&(r==="bath1"||r==="bath2")?`100% + ${qt(a-n)} overexposed`:`${Math.round((n-d)/n*100)}% complete`})]})]})},GS=({phaseId:r,timer:e,onPauseTimer:t,onStopTimer:n,onMoveToNextPhase:a})=>{const{currentCycle:i}=K(),c=(e==null?void 0:e.isRunning)||!1,l=e&&e.timeRemaining===0,o=i&&i.tools.length>0,d=i==null?void 0:i.tools.some(h=>{const p=K.getState().availableTools.find(f=>f.id===h);return p==null?void 0:p.isP2Status}),u=o&&(r==="bath1"&&l||r==="bath2"&&e||r==="drying"&&e||r==="autoclave"&&l);return s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-3",children:[r==="bath1"&&e?s.jsxs("button",{onClick:()=>t(r),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200"}`,children:[s.jsx(N,{path:c?Mn:Lr,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):r==="bath1"?s.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via workflow"}):e?s.jsxs("button",{onClick:()=>t(r),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,children:[s.jsx(N,{path:c?Mn:Lr,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):s.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via previous phase"}),s.jsx("button",{onClick:()=>n(r),className:"px-4 py-2 bg-red-100 text-red-700 border border-red-300 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Cancel"})]}),u&&s.jsx("div",{className:"mt-2",children:s.jsx("button",{onClick:()=>a(r),className:"w-full px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:r==="drying"&&d?"Complete P2 Status Tools":r==="autoclave"?"Complete All Tools":"Move to Next Phase"})})]})},KS=({selectedCycle:r,onCycleSelect:e})=>s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Select Cycle Type:"}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(NS).map(([t,n])=>s.jsxs("button",{onClick:()=>e(t),className:`p-3 text-xs rounded-lg border transition-all duration-200 ${r===t?"bg-[#4ECDC4] text-white border-[#4ECDC4] shadow-sm":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-[#4ECDC4]"}`,children:[s.jsx("div",{className:"font-medium",children:n.name}),s.jsx("div",{className:"text-xs opacity-75",children:n.temp}),s.jsxs("div",{className:"text-xs opacity-75",children:[n.totalTime," min"]})]},t))})]}),QS=({duration:r,isRunning:e,timer:t})=>s.jsxs("div",{className:"text-xs text-gray-500 space-y-1 bg-gray-50 p-3 rounded-lg",children:[s.jsxs("div",{children:["Duration: ",qt(r)]}),s.jsxs("div",{children:["Status: ",e?"Running":"Stopped"]}),t&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:["Remaining: ",qt(t.timeRemaining||0)]}),s.jsxs("div",{children:["Elapsed: ",qt(t.elapsedTime||0)]})]})]}),YS=()=>{const r=K(a=>a.currentCycle),e=K(a=>a.availableTools),n=m.useMemo(()=>(r==null?void 0:r.tools)||[],[r==null?void 0:r.tools]).map(a=>e.find(i=>i.id===a)).filter(a=>a!==void 0);return s.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{path:ir,size:.8,className:"text-gray-500"}),s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Tools in Phase"})]}),(r==null?void 0:r.cycleNumber)&&s.jsx("span",{className:"text-xs text-gray-500 font-mono bg-white px-2 py-1 rounded border",children:r.cycleNumber})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:n.length>0?n.map(a=>s.jsx("span",{className:"px-2 py-1 bg-white text-xs text-gray-600 rounded border",children:a.name},a.id)):s.jsx("span",{className:"px-2 py-1 bg-gray-100 text-xs text-gray-500 rounded border",children:"No tools in cycle"})})]})},km=m.memo(({className:r=""})=>{const{timers:e}=Os(),[t,n]=m.useState(null),[a,i]=m.useState(IS()),{handlePauseTimer:c,handleStopTimer:l}=OS(),{handleMoveToNextPhase:o}=qS(),d=p=>{n(t===p?null:p)},u=p=>{l(p),n(null)},h=p=>{o(p),n(null)};return s.jsxs("div",{className:`space-y-4 ${r}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"Sterilization Timers"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Individual phase timers for concurrent cycles"})]}),s.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-[#4ECDC4] text-white rounded-full",children:"Phase Timers"})]}),s.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(Yu).map(([p,f])=>{var g;const y=e[p],v=f.duration,b=t===p,x=(g=y==null?void 0:y.elapsedTime)!=null?g:0;return s.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-300 ${y!=null&&y.isRunning||p==="bath1"?"shadow-[0_0_25px_rgba(78,205,196,0.5)] border-[#4ECDC4] ring-2 ring-[#4ECDC4] ring-opacity-30":""}`,children:[s.jsx(WS,{phaseId:p,phaseConfig:f,timer:y,duration:v,elapsedTime:x,isExpanded:b,onToggleExpanded:()=>d(p)}),b&&s.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[s.jsx(YS,{}),p==="autoclave"&&s.jsx(KS,{selectedCycle:a,onCycleSelect:i}),s.jsx(GS,{phaseId:p,timer:y,onPauseTimer:c,onStopTimer:u,onMoveToNextPhase:h}),s.jsx(QS,{duration:v||0,isRunning:(y==null?void 0:y.isRunning)||!1,timer:y})]})]},p)})})]})});km.displayName="TimerDisplay";const JS=m.memo(function({activeTab:e,tabs:t,SterilizationAnalyticsComponent:n,onTabChange:a,getTabButtonClasses:i}){return s.jsxs("div",{className:"bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsx("div",{className:"border-b border-gray-200",children:s.jsx("div",{className:"flex flex-wrap gap-2 p-4",children:t.map(c=>s.jsxs("button",{onClick:()=>a(c.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${i(e===c.id)}`,children:[s.jsx(N,{path:c.icon,size:.8}),c.label]},c.id))})}),s.jsxs("div",{className:"p-6",children:[e==="timers"&&s.jsx(km,{}),e==="analytics"&&s.jsx(s.Fragment,{children:n&&s.jsx(n,{})}),e==="logs"&&s.jsx(m.Suspense,{fallback:s.jsx(ks,{}),children:s.jsx(bS,{})})]})]})}),XS=({isOpen:r,operatorName:e,onOperatorNameChange:t,onOperatorNameKeyPress:n,onStartCycle:a,onClose:i,getStartCycleButtonState:c})=>r?Rs.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999]",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},children:s.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Start New Sterilization Cycle"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator Name"}),s.jsx("input",{id:"operator-name",type:"text",value:e,onChange:t,placeholder:"Enter operator name...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",onKeyPress:n})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:a,disabled:c(e).disabled,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${c(e).className}`,children:"Start Cycle"}),s.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"})]})]})]})}),document.body):null;var ZS=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ej=({isOpen:r,onClose:e})=>{const{lastGeneratedCode:t,setShowBatchCodeModal:n}=K(),[a,i]=m.useState(!1);m.useEffect(()=>{r||n(!1)},[r,n]);const c=()=>{n(!1),e()},l=()=>ZS(null,null,function*(){if(t!=null&&t.code)try{yield navigator.clipboard.writeText(t.code),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error(d)}}),o=()=>{const d=window.open("","_blank");d&&t&&(d.document.write(`
        <html>
          <head>
            <title>Batch Code - ${t.code}</title>
            <style>
              body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
              .batch-code { font-size: 48px; font-weight: bold; margin: 20px 0; }
              .info { font-size: 16px; margin: 10px 0; }
              .instructions { text-align: left; margin: 20px 0; }
              @media print { body { margin: 0; } }
            </style>
          </head>
          <body>
            <h1>Batch Code</h1>
            <div class="batch-code">${t.code}</div>
            <div class="info">
              <p><strong>Generated:</strong> ${t.generatedAt.toLocaleString()}</p>
              <p><strong>Operator:</strong> ${t.operator}</p>
              <p><strong>Tools:</strong> ${t.toolCount}</p>
            </div>
            <div class="instructions">
              <h3>Instructions:</h3>
              <ol>
                <li>Write this batch code clearly on the package</li>
                <li>Add today's date</li>
                <li>Add your name (${t.operator})</li>
                <li>Place package in autoclave</li>
              </ol>
            </div>
          </body>
        </html>
      `),d.document.close(),d.print())};return!r||!t?null:s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(de,{path:Tp,size:1.5,className:"text-purple-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Batch Code Generated"})]}),s.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(de,{path:Ae,size:1.5})})]}),s.jsxs("div",{className:"text-center mb-6",children:[s.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-4",children:[s.jsx("p",{className:"text-sm text-purple-600 mb-2",children:"Your Batch Code"}),s.jsx("div",{className:"text-3xl font-bold text-purple-800 font-mono tracking-wider",children:t.code})]}),s.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Generated:"})," ",t.generatedAt.toLocaleString()]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Operator:"})," ",t.operator]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Tools:"})," ",t.toolCount]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Type:"})," ",t.isSingleTool?"Single Tool":"Batch"]})]})]}),s.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Instructions"}),s.jsxs("ol",{className:"text-sm text-blue-700 space-y-2",children:[s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"font-bold mr-2",children:"1."}),s.jsx("span",{children:"Write this batch code clearly on the package"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"font-bold mr-2",children:"2."}),s.jsxs("span",{children:["Add today's date: ",new Date().toLocaleDateString()]})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"font-bold mr-2",children:"3."}),s.jsxs("span",{children:["Add your name: ",t.operator]})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"font-bold mr-2",children:"4."}),s.jsx("span",{children:"Place package in autoclave for sterilization"})]})]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs("button",{onClick:l,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[s.jsx(de,{path:$u,size:1}),s.jsx("span",{children:a?"Copied!":"Copy Code"})]}),s.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[s.jsx(de,{path:Nu,size:1}),s.jsx("span",{children:"Print"})]})]}),s.jsx("div",{className:"mt-4",children:s.jsx("button",{onClick:c,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Done"})}),s.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:"Important:"})," This batch code is now tracked in the system. If a BI failure occurs, all tools in this batch will be affected."]})})]})})},Dm=m.memo(({SterilizationAnalyticsComponent:r})=>{const{startNewCycle:e,recordBITestResult:t,lastBITestDate:n,biTestOptedOut:a,setBiTestOptedOut:i,enforceBI:c,showBatchCodeModal:l,setShowBatchCodeModal:o}=K(),{initError:d,subscribe:u,unsubscribe:h}=Dn(),{tabs:p,validateOperatorName:f,getTabButtonClasses:g,getStartCycleButtonState:y}=fS(),{activeTab:v,showNewCycleModal:b,operatorName:x,handleTabChange:w,handleOperatorNameChange:j,handleCloseNewCycleModal:I,resetOperatorName:E}=gS();m.useEffect(()=>(Ay(),u(),()=>{h()}),[u,h]),m.useEffect(()=>{let P=null,T=!0;function A(){T&&(pS(n),P=setTimeout(A,3e5))}return A(),()=>{T=!1,P&&(clearTimeout(P),P=null)}},[n]);const O=m.useCallback(P=>{t(P)},[t]),S=m.useCallback(()=>{f(x)&&(e(x.trim()),I(),E())},[x,e,f,I,E]),C=m.useCallback(()=>{i(!0)},[i]);m.useCallback(()=>{},[]);const D=m.useMemo(()=>{if(!c||a)return!1;const P=new Date().toDateString();return(n?new Date(n).toDateString():null)!==P},[c,a,n]),k=m.useCallback(P=>{P.key==="Enter"&&S()},[S]);return s.jsxs("div",{className:"space-y-6",children:[s.jsx(hS,{isVisible:D,onComplete:O,onOptOut:C}),d&&s.jsxs("div",{className:"bg-red-100 text-red-700 text-sm p-2 rounded-md",children:["BI Initialization Failed: ",d.message]}),s.jsx(Em,{}),s.jsx(JS,{activeTab:v,tabs:p,SterilizationAnalyticsComponent:r,onTabChange:w,getTabButtonClasses:g}),s.jsx(XS,{isOpen:b,operatorName:x,onOperatorNameChange:j,onOperatorNameKeyPress:k,onClose:I,onStartCycle:S,getStartCycleButtonState:y}),s.jsx(ej,{isOpen:l,onClose:()=>o(!1)})]})});Dm.displayName="SterilizationDashboard";const Tc=()=>s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}),Pm=m.memo(()=>s.jsx(zr,{FallbackComponent:Tc,children:s.jsx(Ur,{children:s.jsx("div",{className:"p-6 space-y-6",children:s.jsx(zr,{FallbackComponent:Tc,children:s.jsx(Dm,{SterilizationAnalyticsComponent:rS})})})})}));Pm.displayName="Sterilization";class tj{static scanTool(e,t){const n=t.map(c=>c.barcode),a=n[Math.floor(Math.random()*n.length)],i=t.find(c=>c.barcode===a);return i?{success:!0,message:`Successfully processed ${i.name} for ${e} workflow`,tool:i}:{success:!1,message:"No tools available for scanning"}}}var rj=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const sj=()=>{const[r,e]=m.useState(!1),[t,n]=m.useState(""),[a,i]=m.useState(null),[c,l]=m.useState(""),{availableTools:o,addToolToCycle:d}=K();return{isScanning:r,scannedCode:t,scanResult:a,scanMessage:c,simulateScan:(h,p,f=!1)=>rj(null,null,function*(){var g;e(!0),l(`Scanning tool for ${h} workflow...`);try{if(h==="clean"){const{data:y}=yield _.from("tools").select("barcode").eq("status","clean").eq("facility_id","550e8400-e29b-41d4-a716-446655440000").limit(10);let v;!y||y.length===0?(console.log("ðŸ§ª No clean tools found in database, using mock data for testing"),v="TEST-CLEAN-001"):v=y[Math.floor(Math.random()*y.length)].barcode;const b=yield zi.scanToolForCleanWorkflow(v);n(((g=b.tool)==null?void 0:g.barcode)||""),b.success&&b.tool?(d(b.tool.id),i("success"),l(b.message),f||setTimeout(p,2e3)):(i("error"),l(b.message))}else{setTimeout(()=>{var y;const v=tj.scanTool(h,o);n(((y=v.tool)==null?void 0:y.barcode)||""),v.success&&v.tool?(d(v.tool.id),i("success"),l(v.message),f||setTimeout(p,2e3)):(i("error"),l(v.message)),e(!1)},1e3);return}}catch(y){console.error("Error during scan:",y),i("error"),l("An unexpected error occurred during scanning.")}finally{e(!1)}})}};var nj=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const aj=r=>{var e;typeof window!="undefined"&&((e=window.toast)!=null&&e.error)?window.toast.error(r):console.warn("âš ï¸",r)},ij=({scannedData:r,toolId:e,onClose:t,batchMode:n=!1})=>{const{availableTools:a,currentCycle:i,addPhaseToCycle:c,startPhase:l,addToolToCycle:o}=K(),[d,u]=m.useState(!1),[h,p]=m.useState(null),[f,g]=m.useState([]),[y,v]=m.useState({show:!1,tool:null}),b=m.useCallback(T=>a.find(A=>A.barcode===T),[a]),w=m.useCallback(()=>e?a.find(T=>T.id===e):b(r),[e,a,b,r])(),j=m.useCallback(()=>!i||!w?!1:i.tools.includes(w.id),[i,w]),I=m.useCallback(T=>nj(null,null,function*(){if(!T||typeof T!="string"||T.trim()===""){aj("No barcode detected â€” please rescan.");return}const A=T.trim();console.info("âœ… Scanned barcode received:",A),u(!0),p(null);try{yield new Promise(M=>setTimeout(M,1e3));const z=b(A);if(!z){p({type:"error",text:`Tool with barcode "${A}" not found in inventory.`});return}if(f.find(M=>M.id===z.id)){p({type:"error",text:`Tool "${z.name}" already scanned.`});return}const W=K.getState();if(W.checkToolReplacementNeeded&&W.checkToolReplacementNeeded(z.id)){v({show:!0,tool:z});return}g(M=>{const R=[...M,z];return p(n?{type:"success",text:`Tool "${z.name}" added to batch. Total: ${R.length} tools.`}:{type:"success",text:`Tool "${z.name}" scanned successfully. Ready for sterilization.`}),R})}catch(z){p({type:"error",text:"Failed to scan tool. Please try again."}),console.error("Scan error:",z)}finally{u(!1)}}),[b,n,f]),E=m.useCallback(()=>{if(!i)return null;const T=i.phases.find(z=>z.isActive),A=i.tools.length;return{cycleId:i.id,operator:i.operator,totalTools:A,activePhase:(T==null?void 0:T.name)||"No active phase",startTime:i.startTime}},[i]),O=m.useCallback(()=>{const T=(i==null?void 0:i.phases.some(M=>M.id==="bath1"&&M.isActive))||!1,{getTimer:A}=Os.getState(),z=A("bath1"),W=(z==null?void 0:z.isRunning)||!1;return T||W},[i]),S=m.useCallback(()=>{g([]),p(null)},[]),C=m.useCallback(()=>{v({show:!1,tool:null}),p({type:"error",text:"Tool marked for replacement. Please replace with a new tool before continuing."})},[]),D=m.useCallback(()=>{y.tool&&(g(T=>[...T,y.tool]),p({type:"success",text:`Tool "${y.tool.name}" added despite needing replacement.`})),v({show:!1,tool:null})},[y.tool]),k=m.useCallback(()=>{v({show:!1,tool:null})},[]),P=m.useCallback(T=>{if(!T||T.length===0){console.warn("âš ï¸ handleSendToBath1 called with no tools.");return}if(O()){p({type:"error",text:"âš ï¸ Bath 1 timer is already in process. Please wait for the current phase to complete before starting a new one."});return}try{T.forEach(z=>{o(z.id);const W=K.getState();W.updateToolStatus&&W.updateToolStatus(z.id,"bath1")}),c("bath1",ue.bath1.name,ue.bath1.duration*60),l("bath1");const{startTimer:A}=Os.getState();A("bath1",ue.bath1.duration*60),p({type:"success",text:`ðŸš€ ${T.length} tools sent to Bath 1! Phase timer started.`}),g([]),t&&t()}catch(A){console.error("âŒ Error in handleSendToBath1:",A),p({type:"error",text:"Failed to start Bath 1 phase. Please try again."})}},[o,c,l,p,t,O]);return m.useEffect(()=>{if(h){const T=setTimeout(()=>{p(null)},5e3);return()=>clearTimeout(T)}},[h]),{tool:w,currentCycle:i,isScanning:d,scanMessage:h,scannedTools:f,batchMode:n,handleScanTool:I,handleSendToBath1:P,clearScannedTools:S,isToolInCycle:j(),isBath1Active:O(),cycleStatus:E(),replacementAlert:y,handleReplaceTool:C,handleContinueAnyway:D,handleDismissReplacementAlert:k}},oj=()=>{const{setWorkflowType:r,setScannedData:e,scannedData:t}=K(),{isScanning:n,scanResult:a,scanMessage:i,simulateScan:c}=sj(),[l,o]=m.useState(""),[d,u]=m.useState(!1),[h,p]=m.useState("single"),f=M=>{console.log("ScannerPage: Workflow selected:",M),o(M),r(M),u(!1)},g=()=>{console.log("ðŸ”§ handleBackToWorkflow called"),o(""),r(""),e(""),u(!1),console.log("ðŸ”§ Returning to workflow selection...")},{scannedTools:y,handleSendToBath1:v,handleScanTool:b,scanMessage:x,isBath1Active:w,clearScannedTools:j,replacementAlert:I,handleReplaceTool:E,handleContinueAnyway:O,handleDismissReplacementAlert:S}=ij({scannedData:t||"",onClose:()=>{console.log("ðŸ”§ Dirty workflow onClose called - navigating back to sterilization page"),window.history.back()},batchMode:h==="batch"});return{selectedWorkflow:l,showWorkflowResult:d,scanMode:h,isScanning:n,scanResult:a,scanMessage:i,scannedData:t,scannedTools:y,dirtyScanMessage:x,isBath1Active:w,replacementAlert:I,handleWorkflowSelect:f,handleBackToWorkflow:g,handleScan:()=>{l&&(l==="clean"?c(l,()=>{setTimeout(()=>{u(!0)},1e3)},!1):c(l,()=>{},!1))},handleCloseWorkflow:()=>{u(!1),g()},handleReceiptUploadSuccess:M=>{console.log("Receipt uploaded successfully:",M),window.history.back()},handleReceiptUploadCancel:()=>{g()},handleDeleteTool:M=>{console.log("Delete tool:",M)},handleCancelAll:()=>{j(),console.log("Cancel all tools")},handleSendScannedToBath1:()=>{console.log("ðŸ§ª scannedTools.length:",y.length),console.log("ðŸ§ª handleSendToBath1:",typeof v),v(y)},handleScanModeChange:M=>{p(M),j()},handleScanTool:b,handleReplaceTool:E,handleContinueAnyway:O,handleDismissReplacementAlert:S,clearScannedTools:j}},Om=[{id:"clean",name:"Clean Tool",icon:Ep,color:"green",description:"Ready to use on patients",statusRequirement:"Complete â†’ Dirty"},{id:"dirty",name:"Dirty Tool",icon:kp,color:"orange",description:"Ready for cleaning process",statusRequirement:"Dirty â†’ Clean"},{id:"problem",name:"Tool Problem",icon:ce,color:"red",description:"Report tool issues or problems",statusRequirement:"Any status â†’ Problem"},{id:"import",name:"Import Autoclave Receipt",icon:Ye,color:"blue",description:"Import physical autoclave cycle documentation",statusRequirement:"Documentation"},{id:"packaging",name:"Packaging Workflow",icon:mr,color:"purple",description:"Tools that are ready for packaging",statusRequirement:"Complete â†’ Packaged"}],lj=r=>Om.find(e=>e.id===r),cj=r=>({green:"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",orange:"border-orange-200 hover:border-orange-300 bg-orange-50 hover:bg-orange-100",blue:"border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",purple:"border-purple-200 hover:border-purple-300 bg-purple-50 hover:bg-purple-100",red:"border-red-200 hover:border-red-300 bg-red-50 hover:bg-red-100"})[r],dj=r=>({green:"bg-green-100",orange:"bg-orange-100",blue:"bg-blue-100",purple:"bg-purple-100",red:"bg-red-100"})[r],uj=r=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[r],mj=r=>({green:"text-green-800",orange:"text-orange-800",blue:"text-blue-800",purple:"text-purple-800",red:"text-red-800"})[r],hj=r=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[r],pj=r=>({green:"text-green-700",orange:"text-orange-700",blue:"text-blue-700",purple:"text-purple-700",red:"text-red-700"})[r],fj=({workflow:r,onClick:e})=>s.jsx("button",{onClick:()=>e(r.id),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${cj(r.color)}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${dj(r.color)}`,children:s.jsx(N,{path:r.icon,size:1.2,className:uj(r.color)})}),s.jsxs("div",{children:[s.jsx("h4",{className:`font-semibold text-sm ${mj(r.color)}`,children:r.name}),s.jsx("p",{className:`text-xs ${hj(r.color)}`,children:r.description}),s.jsx("p",{className:`text-xs mt-1 font-medium ${pj(r.color)}`,children:r.statusRequirement})]})]})}),gj=({onWorkflowSelect:r})=>s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Select Workflow"}),s.jsx("div",{className:"space-y-3",children:Om.map(e=>s.jsx(fj,{workflow:e,onClick:r},e.id))})]}),Ec=({workflowId:r,color:e="blue"})=>{const t=lj(r);if(!t)return null;const n=()=>({blue:"bg-blue-50 border-blue-200 text-blue-800 text-blue-600",orange:"bg-orange-50 border-orange-200 text-orange-800 text-orange-600",purple:"bg-purple-50 border-purple-200 text-purple-800 text-purple-600"})[e],[a,i,c,l]=n().split(" ");return s.jsxs("div",{className:`${a} border ${i} rounded-lg p-3`,children:[s.jsxs("h3",{className:`font-semibold ${c} text-sm mb-1`,children:[t.name," Workflow"]}),s.jsx("p",{className:`${l} text-xs`,children:t.description}),s.jsxs("div",{className:"mt-2 text-xs text-blue-500",children:[s.jsx("strong",{children:"Tool Status:"})," ",t.statusRequirement]})]})},kc=({isScanning:r,scanMessage:e,onScan:t,size:n="large",showCameraStatus:a=!0})=>{const i=n==="large",c=i?"w-48 h-32":"w-32 h-24",l=i?"w-4 h-4":"w-3 h-3",o=i?"p-4":"p-3",d=i?1.5:1.2,u=i?"w-2 h-2":"w-1.5 h-1.5",h="text-xs",p=i?"bottom-4 right-4":"bottom-2 right-2",f=i?"h-48":"h-32",g=i?"text-lg":"text-base",y=i?"text-sm":"text-xs",v=()=>e?typeof e=="string"?e:e.text:null,b=()=>e?typeof e=="string"?"success":e.type:null;return s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsxs("div",{className:"text-center space-y-3",children:[s.jsxs("div",{className:`relative bg-black rounded-lg ${f} flex items-center justify-center`,children:[s.jsxs("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] ${c} rounded-lg`,children:[s.jsx("div",{className:`absolute top-0 left-0 ${l} border-t-2 border-l-2 border-[#4ECDC4] rounded-tl`}),s.jsx("div",{className:`absolute top-0 right-0 ${l} border-t-2 border-r-2 border-[#4ECDC4] rounded-tr`}),s.jsx("div",{className:`absolute bottom-0 left-0 ${l} border-b-2 border-l-2 border-[#4ECDC4] rounded-bl`}),s.jsx("div",{className:`absolute bottom-0 right-0 ${l} border-b-2 border-r-2 border-[#4ECDC4] rounded-br`})]}),a&&s.jsxs("div",{className:`absolute ${p} flex items-center`,children:[s.jsx("div",{className:`${u} rounded-full bg-red-500 mr-1 animate-pulse`}),s.jsx("span",{className:`text-white ${h}`,children:"Camera active"})]}),s.jsx("button",{onClick:t,disabled:r,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 ${o} rounded-full transition-all duration-200 ${r?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:s.jsx(N,{path:Qe,size:d,className:`${r?"text-gray-400":"text-white"}`})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:`${g} font-medium text-gray-800 mb-1`,children:r?"Scanning...":"Click to Scan"}),s.jsx("p",{className:`text-gray-600 ${y}`,children:r?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),e&&s.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-3 p-3 rounded-lg ${b()==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:Qe,size:.8,className:b()==="success"?"text-green-600":"text-red-600"}),s.jsx("span",{className:`font-medium text-sm ${b()==="success"?"text-green-800":"text-red-800"}`,children:v()})]})})]})};var yj=Object.defineProperty,vj=Object.defineProperties,xj=Object.getOwnPropertyDescriptors,Dc=Object.getOwnPropertySymbols,bj=Object.prototype.hasOwnProperty,_j=Object.prototype.propertyIsEnumerable,Pc=(r,e,t)=>e in r?yj(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Oc=(r,e)=>{for(var t in e||(e={}))bj.call(e,t)&&Pc(r,t,e[t]);if(Dc)for(var t of Dc(e))_j.call(e,t)&&Pc(r,t,e[t]);return r},wj=(r,e)=>vj(r,xj(e)),_t=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ps=()=>_t(null,null,function*(){return yield at.getCurrentFacilityId()});class Sr{static compressImage(e,t=1200,n=.8){return _t(this,null,function*(){return new Promise((a,i)=>{const c=document.createElement("canvas"),l=c.getContext("2d"),o=new Image;o.onload=()=>{const d=Math.min(t/o.width,t/o.height),u=o.width*d,h=o.height*d;c.width=u,c.height=h,l==null||l.drawImage(o,0,0,u,h),c.toBlob(p=>{if(p){const f=new File([p],e.name,{type:"image/jpeg",lastModified:Date.now()});a(f)}else i(new Error("Failed to compress image"))},"image/jpeg",n)},o.onerror=()=>i(new Error("Failed to load image")),o.src=URL.createObjectURL(e)})})}static uploadReceipt(e,t,n){return _t(this,null,function*(){try{const a=n||(yield ps()),i=Wr(a),{data:{user:c},error:l}=yield i.auth.getUser();if(l||!c)throw new Error("User not authenticated. Please log in again.");const{data:o,error:d}=yield i.from("users").select("facility_id").eq("id",c.id).single();if(d||!(o!=null&&o.facility_id))throw new Error("User facility not found");if(o.facility_id!==a)throw new Error("Unauthorized: tenant mismatch");const u=yield this.compressImage(e.photoFile),h=new Date().toISOString().replace(/[:.]/g,"-"),p=`${c.id}/autoclave-receipt-${e.batchCode}-${h}.jpg`,{error:f}=yield i.storage.from("autoclave-receipts").upload(p,u,{cacheControl:"3600",upsert:!1});if(f)throw new Error(`Failed to upload file: ${f.message}`);const{data:g,error:y}=yield i.storage.from("autoclave-receipts").createSignedUrl(p,3600);if(y)throw y;console.info(`[AutoclaveReceipt] Signed URL created for tenant ${a} â†’ ${p}`);const{data:v,error:b}=yield i.from("autoclave_receipts").insert({receipt_number:e.batchCode,autoclave_id:null,facility_id:o.facility_id,tenant_id:a,photo_url:g.signedUrl,created_at:new Date().toISOString()}).select().single();if(b)throw yield i.storage.from("autoclave-receipts").remove([p]),new Error(`Failed to save receipt metadata: ${b.message}`);return this.mapDatabaseReceipt(v)}catch(a){throw console.error("Error uploading autoclave receipt:",a),a}})}static getReceiptsByBatch(e,t){return _t(this,null,function*(){try{const n=t||(yield ps()),a=Wr(n),{data:{user:i},error:c}=yield a.auth.getUser();if(c||!i)throw new Error("User not authenticated. Please log in again.");const{data:l,error:o}=yield a.from("users").select("facility_id").eq("id",i.id).single();if(o||!(l!=null&&l.facility_id))throw new Error("User facility not found");if(l.facility_id!==n)throw new Error("Unauthorized: tenant mismatch");const u=a.from("autoclave_receipts").select("*").eq("receipt_number",e).eq("tenant_id",n),{data:h,error:p}=yield u.order("created_at",{ascending:!1});if(p)throw new Error(`Failed to fetch receipts: ${p.message}`);return h.map(this.mapDatabaseReceipt)}catch(n){throw console.error("Error fetching receipts:",n),n}})}static getAllReceipts(e=50,t=0,n){return _t(this,null,function*(){try{const a=n||(yield ps()),i=Wr(a),{data:{user:c},error:l}=yield i.auth.getUser();if(l||!c)throw new Error("User not authenticated. Please log in again.");const{data:o,error:d}=yield i.from("users").select("facility_id").eq("id",c.id).single();if(d||!(o!=null&&o.facility_id))throw new Error("User facility not found");if(o.facility_id!==a)throw new Error("Unauthorized: tenant mismatch");const h=i.from("autoclave_receipts").select("*").eq("tenant_id",a),{data:p,error:f}=yield h.order("created_at",{ascending:!1}).range(t,t+e-1);if(f)throw new Error(`Failed to fetch receipts: ${f.message}`);return p.map(this.mapDatabaseReceipt)}catch(a){throw console.error("Error fetching all receipts:",a),a}})}static deleteReceipt(e,t){return _t(this,null,function*(){try{const n=t||(yield ps()),a=Wr(n),{data:{user:i},error:c}=yield a.auth.getUser();if(c||!i)throw new Error("User not authenticated. Please log in again.");const{data:l,error:o}=yield a.from("users").select("facility_id").eq("id",i.id).single();if(o||!(l!=null&&l.facility_id))throw new Error("User facility not found");if(l.facility_id!==n)throw new Error("Unauthorized: tenant mismatch");const u=a.from("autoclave_receipts").select("id").eq("id",e).eq("tenant_id",n),{data:h,error:p}=yield u.single();if(p)throw new Error(`Failed to fetch receipt: ${p.message}`);const f=a.from("autoclave_receipts").delete().eq("id",e).eq("tenant_id",n),{error:g}=yield f;if(g)throw new Error(`Failed to delete receipt: ${g.message}`)}catch(n){throw console.error("Error deleting receipt:",n),n}})}static getFacilitySettings(){return _t(this,null,function*(){return{id:"default",facilityId:void 0,autoclaveHasPrinter:!1,receiptRetentionMonths:24,createdAt:new Date,updatedAt:new Date}})}static updateFacilitySettings(e){return _t(this,null,function*(){const t=yield this.getFacilitySettings();return wj(Oc(Oc({},t),e),{updatedAt:new Date})})}static cleanupExpiredReceipts(e){return _t(this,null,function*(){var t;try{const n=e||(yield ps()),a=Wr(n),{data:{user:i},error:c}=yield a.auth.getUser();if(c||!i)throw new Error("User not authenticated. Please log in again.");const{data:l,error:o}=yield a.from("users").select("facility_id").eq("id",i.id).single();if(o||!(l!=null&&l.facility_id))throw new Error("User facility not found");if(l.facility_id!==n)throw new Error("Unauthorized: tenant mismatch");const u=new Date;u.setMonth(u.getMonth()-24);const{data:h,error:p}=yield a.from("autoclave_receipts").select("id, photo_url").lt("created_at",u.toISOString()).eq("tenant_id",n);if(p)throw new Error(`Failed to fetch expired receipts: ${p.message}`);if(!h||h.length===0)return 0;for(const f of h){const g=(t=f.photo_url)==null?void 0:t.split("/").pop();g&&(yield a.storage.from("autoclave-receipts").remove([g])),yield a.from("autoclave_receipts").delete().eq("id",f.id)}return h.length}catch(n){throw console.error("Error cleaning up expired receipts:",n),n}})}static mapDatabaseReceipt(e){return{id:e.id,batchId:"",batchCode:e.receipt_number,cycleNumber:void 0,photoUrl:"",photoFilename:"",photoSize:0,temperatureEvidence:void 0,uploadedBy:"",uploadedAt:new Date(e.created_at),retentionUntil:new Date,isExpired:!1,createdAt:new Date(e.created_at),updatedAt:new Date(e.created_at)}}static mapDatabaseFacilitySettings(e){return{id:e.id,facilityId:e.facility_id,autoclaveHasPrinter:e.autoclave_has_printer,receiptRetentionMonths:e.receipt_retention_months,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}}var jr=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Sj=()=>{const[r,e]=m.useState([]),[t,n]=m.useState(null),[a,i]=m.useState(!1),[c,l]=m.useState(null),o=m.useCallback((v,b)=>jr(null,null,function*(){i(!0),l(null);try{const x=yield Sr.uploadReceipt(v,b);return e(w=>[x,...w]),x}catch(x){const w=x instanceof Error?x.message:"Failed to upload receipt";throw l(w),x}finally{i(!1)}}),[]),d=m.useCallback(v=>jr(null,null,function*(){i(!0),l(null);try{const b=yield Sr.getReceiptsByBatch(v);return e(b),b}catch(b){const x=b instanceof Error?b.message:"Failed to load receipts";throw l(x),b}finally{i(!1)}}),[]),u=m.useCallback((v=50,b=0)=>jr(null,null,function*(){i(!0),l(null);try{const x=yield Sr.getAllReceipts(v,b);return e(x),x}catch(x){const w=x instanceof Error?x.message:"Failed to load receipts";throw l(w),x}finally{i(!1)}}),[]),h=m.useCallback(v=>jr(null,null,function*(){i(!0),l(null);try{yield Sr.deleteReceipt(v),e(b=>b.filter(x=>x.id!==v))}catch(b){const x=b instanceof Error?b.message:"Failed to delete receipt";throw l(x),b}finally{i(!1)}}),[]),p=m.useCallback(()=>jr(null,null,function*(){i(!0),l(null);try{const v=yield Sr.getFacilitySettings();return n(v),v}catch(v){const b=v instanceof Error?v.message:"Failed to load facility settings";throw l(b),v}finally{i(!1)}}),[]),f=m.useCallback(v=>jr(null,null,function*(){i(!0),l(null);try{const b=yield Sr.updateFacilitySettings(v);return n(b),b}catch(b){const x=b instanceof Error?b.message:"Failed to update facility settings";throw l(x),b}finally{i(!1)}}),[]),g=m.useCallback(()=>{l(null)},[]),y=m.useCallback(()=>{e([])},[]);return{receipts:r,facilitySettings:t,loading:a,error:c,uploadReceipt:o,loadReceiptsByBatch:d,loadAllReceipts:u,deleteReceipt:h,loadFacilitySettings:p,updateFacilitySettings:f,clearError:g,clearReceipts:y}};var jj=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Cj=()=>{const r=navigator.userAgent.toLowerCase(),t=["android","iphone","ipad","ipod","blackberry","windows phone","mobile","tablet"].some(c=>r.includes(c)),n="ontouchstart"in window||navigator.maxTouchPoints>0,a=window.innerWidth<=768,i="orientation"in window||"deviceorientation"in window;return t||n&&a||i},Nj=()=>jj(null,null,function*(){try{return!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?!1:(yield navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput").length>0}catch(r){return console.warn("Error checking camera access:",r),!1}});var Ij=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Tj=({isMobile:r,hasCamera:e,onPhotoCapture:t})=>{const[n,a]=m.useState(!1),i=m.useRef(null),c=m.useRef(null),l=m.useRef(null),o=m.useCallback(()=>Ij(null,null,function*(){if(!r){alert("Camera access is only available on mobile devices. Please use the file upload option instead.");return}if(!e){alert("No camera detected on this device. Please use file upload instead.");return}try{const h=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});i.current&&(i.current.srcObject=h,l.current=h,a(!0))}catch(h){console.error(h),alert("Unable to access camera. Please use file upload instead.")}}),[r,e]),d=m.useCallback(()=>{l.current&&(l.current.getTracks().forEach(h=>h.stop()),l.current=null),a(!1)},[]),u=m.useCallback(()=>{if(i.current&&c.current){const h=i.current,p=c.current,f=p.getContext("2d");f&&(p.width=h.videoWidth,p.height=h.videoHeight,f.drawImage(h,0,0),p.toBlob(g=>{if(g){const y=new File([g],`receipt-${Date.now()}.jpg`,{type:"image/jpeg"}),v=URL.createObjectURL(g);t(y,v),d()}},"image/jpeg",.8))}},[t,d]);return!r||!e?null:s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",onClick:o,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[s.jsx(N,{path:Dp,size:1.2}),s.jsx("span",{children:"Take Photo"})]}),n&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-sm w-full mx-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,className:"w-full h-64 object-cover rounded-md",children:s.jsx("track",{kind:"captions"})}),s.jsx("canvas",{ref:c,className:"hidden"})]}),s.jsxs("div",{className:"flex space-x-2 mt-4",children:[s.jsxs("button",{type:"button",onClick:u,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[s.jsx(N,{path:Ni,size:1}),s.jsx("span",{children:"Capture"})]}),s.jsxs("button",{type:"button",onClick:d,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[s.jsx(N,{path:Ae,size:1}),s.jsx("span",{children:"Cancel"})]})]})]})})]})};var Rc=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Ej=({photoFile:r,photoPreview:e,isMobile:t,onFileSelect:n,onClearPhoto:a})=>{const i=m.useRef(null),c=d=>Rc(null,null,function*(){if(d.type==="image/jpeg")return d;const u=yield createImageBitmap(d),h=document.createElement("canvas");h.width=u.width,h.height=u.height;const p=h.getContext("2d");if(!p)return d;p.drawImage(u,0,0);const f=yield new Promise(g=>h.toBlob(y=>g(y),"image/jpeg",.8));return f?new File([f],d.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}):d}),l=m.useCallback(d=>Rc(null,null,function*(){var u;const h=(u=d.target.files)==null?void 0:u[0];if(h&&h.type.startsWith("image/")){let p=h;p=yield c(p);const f=new FileReader;f.onload=g=>{var y;const v=(y=g.target)==null?void 0:y.result;n(p,v)},f.readAsDataURL(p)}}),[n]),o=m.useCallback(()=>{var d;(d=i.current)==null||d.click()},[]);return s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{htmlFor:"photo-upload",className:"block text-sm font-medium text-gray-700",children:"Receipt Photo *"}),e?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:e,alt:"Receipt preview",className:"w-full h-48 object-cover rounded-md border border-gray-300"}),s.jsx("button",{type:"button",onClick:a,className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:s.jsx(N,{path:Ae,size:.8})})]}),s.jsxs("p",{className:"text-xs text-gray-500",children:["Photo captured: ",(r==null?void 0:r.name)||"Receipt photo"]}),s.jsx("p",{className:"text-xs text-blue-600",children:"Note: Photos are uploaded directly to Cliniio and not stored on your device"})]}):s.jsxs("div",{className:"space-y-2",children:[!t&&s.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-md mb-2",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{path:$s,size:1,className:"text-yellow-600"}),s.jsx("p",{className:"text-sm text-yellow-800",children:"Camera access is only available on mobile devices. Please use the file upload option below."})]})}),s.jsxs("button",{type:"button",onClick:o,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[s.jsx(N,{path:Fn,size:1.2}),s.jsx("span",{children:"Choose File"})]}),s.jsx("input",{ref:i,id:"photo-upload",type:"file",accept:"image/*",onChange:l,className:"hidden"}),s.jsx("p",{className:"text-xs text-blue-600 text-center",children:"Photos are uploaded directly to Cliniio and not stored on your device"})]})]})},kj=({cycleNumber:r,temperatureEvidence:e,onCycleNumberChange:t,onTemperatureEvidenceChange:n})=>s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"cycleNumber",className:"block text-sm font-medium text-gray-700",children:"Cycle Number (Optional)"}),s.jsx("input",{type:"text",id:"cycleNumber",value:r,onChange:a=>t(a.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., CYC-2024-001"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"temperatureEvidence",className:"block text-sm font-medium text-gray-700",children:"Temperature Evidence (Optional)"}),s.jsx("textarea",{id:"temperatureEvidence",value:e,onChange:a=>n(a.target.value),rows:3,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Temperature reached 121Â°C for 4 minutes"})]})]});var Ac=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Rm=({batchCode:r,operator:e,onSuccess:t,onCancel:n})=>{const{uploadReceipt:a,loading:i,error:c}=Sj(),[l,o]=m.useState(null),[d,u]=m.useState(null),[h,p]=m.useState(""),[f,g]=m.useState(""),[y,v]=m.useState(!1),[b,x]=m.useState(!1),[w,j]=m.useState(null);m.useEffect(()=>{Ac(null,null,function*(){const D=Cj(),k=yield Nj();v(D),x(k)})},[]),m.useEffect(()=>()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d)},[d]);const I=m.useCallback((C,D)=>{o(C),u(D)},[]),E=m.useCallback((C,D)=>{o(C),u(D)},[]),O=m.useCallback(()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),o(null),u(null)},[d]),S=m.useCallback(C=>Ac(null,null,function*(){if(C.preventDefault(),!l){alert("Please select or capture a photo of the receipt");return}try{const D={batchCode:r,cycleNumber:h||void 0,photoFile:l,temperatureEvidence:f||void 0};j("Compressing image for optimal storage...");const k=yield a(D,e);d&&d.startsWith("blob:")&&URL.revokeObjectURL(d);const P=k.photoSize<l.size?` (compressed from ${(l.size/1024).toFixed(1)}KB to ${(k.photoSize/1024).toFixed(1)}KB)`:"";j(`Receipt uploaded successfully!${P}`),t==null||t(k)}catch(D){console.error("Error uploading receipt:",D);const k=D instanceof Error?D.message:"Error uploading receipt";j(`Upload failed: ${k}`)}}),[l,r,h,f,a,e,t,d]);return s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[s.jsx("div",{className:"mb-4",children:s.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Upload Autoclave Receipt"})}),s.jsxs("form",{onSubmit:S,className:"space-y-4",children:[s.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("span",{className:"font-medium",children:"Batch Code:"})," ",r]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(Tj,{isMobile:y,hasCamera:b,onPhotoCapture:I}),y&&b&&s.jsx("div",{className:"text-center text-gray-500 text-sm",children:"or"}),s.jsx(Ej,{photoFile:l,photoPreview:d,isMobile:y,onFileSelect:E,onClearPhoto:O})]}),s.jsx(kj,{cycleNumber:h,temperatureEvidence:f,onCycleNumberChange:p,onTemperatureEvidenceChange:g}),c&&s.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-800",children:c})}),w&&s.jsx("div",{className:`p-3 rounded-md ${w.includes("successfully")?"bg-green-50 border border-green-200":w.includes("failed")?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"}`,children:s.jsx("p",{className:`text-sm ${w.includes("successfully")?"text-green-800":w.includes("failed")?"text-red-800":"text-blue-800"}`,children:w})}),s.jsx("button",{type:"submit",disabled:!l||i,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),s.jsx("span",{children:"Uploading..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(N,{path:Fn,size:1.2}),s.jsx("span",{children:"Upload Receipt"})]})})]}),s.jsx("div",{className:"flex justify-center pt-2",children:s.jsx("button",{onClick:n,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"â† Back to Workflow Selection"})})]})},Dj=[{type:"damaged",label:"Damaged",description:"Physical damage or broken parts"},{type:"improperly_cleaned",label:"Improperly Cleaned",description:"Rust, residue, or staining"},{type:"worn_out",label:"Worn Out",description:"Excessive wear or dull edges"},{type:"other",label:"Other",description:"Other issues not listed above"}],Pj=({selectedProblemType:r,onProblemTypeSelect:e})=>s.jsx("div",{className:"space-y-3",children:Dj.map(t=>s.jsx("button",{onClick:()=>e(t.type),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${r===t.type?"border-red-300 bg-red-50":"border-gray-200 hover:border-red-200 bg-white hover:bg-red-50"}`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-800",children:t.label}),s.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}),r===t.type&&s.jsx(N,{path:Ni,size:1,className:"text-red-600"})]})},t.type))}),Oj=()=>{const[r,e]=m.useState(!1),t=m.useRef(null);return m.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition;t.current=new i,t.current.continuous=!1,t.current.interimResults=!1,t.current.lang="en-US",t.current.onresult=c=>{const l=c.results[0][0].transcript;return e(!1),l},t.current.onerror=c=>{console.error("Speech recognition error:",c.error),e(!1)},t.current.onend=()=>{e(!1)}}},[]),{isRecording:r,startRecording:i=>{t.current&&(e(!0),t.current.onresult=c=>{const l=c.results[0][0].transcript;i(l),e(!1)},t.current.start())},stopRecording:()=>{t.current&&t.current.stop()}}},Rj=({value:r,onChange:e})=>{const{isRecording:t,startRecording:n,stopRecording:a}=Oj(),i=()=>{t?a():n(c=>{e(c)})};return s.jsxs(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:[s.jsx("label",{htmlFor:"problem-description",className:"block text-sm font-medium text-gray-700",children:"Describe the problem"}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("textarea",{id:"problem-description",value:r,onChange:c=>e(c.target.value),placeholder:"Describe the issue...",className:"flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 resize-none",rows:3}),s.jsx("button",{onClick:i,className:`p-3 rounded-md transition-colors ${t?"bg-red-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:t?"Stop recording":"Voice input",children:s.jsx(N,{path:t?Mu:oi,size:1})})]}),t&&s.jsx("p",{className:"text-sm text-red-600",children:"Recording... Speak now"})]})};var Aj=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const $j=({onClose:r})=>{const[e,t]=m.useState(!1),[n,a]=m.useState(""),[i,c]=m.useState(null),[l,o]=m.useState(""),[d,u]=m.useState(!1),[h,p]=m.useState(null),[f,g]=m.useState(""),[y,v]=m.useState(!1),{availableTools:b,markToolAsProblem:x}=K(),w=()=>{t(!0),o("Scanning tool..."),setTimeout(()=>{const I=b.filter(S=>S.barcode).map(S=>S.barcode);if(I.length===0){c("error"),o("No tools available for scanning"),t(!1);return}const E=I[Math.floor(Math.random()*I.length)],O=b.find(S=>S.barcode===E);O?(a(E),c("success"),o(`Successfully scanned ${O.name}`),u(!0)):(c("error"),o("Tool not found in system")),t(!1)},1e3)},j=()=>Aj(null,null,function*(){if(!(!h||!n)){v(!0);try{const{data:{user:I},error:E}=yield _.auth.getUser();if(E||!I){o("Authentication error. Please log in again.");return}const O=yield zi.scanToolForProblemWorkflow(n,h,f||"No additional notes provided",I.id);if(O.success){o(O.message);const S=b.find(C=>C.barcode===n);S&&(yield x(S.id,h,f)),setTimeout(()=>{r()},2e3)}else o(O.message)}catch(I){console.error("Error reporting tool problem:",I),o("Error reporting tool problem. Please try again.")}finally{v(!1)}}});return s.jsxs("div",{className:"space-y-6",children:[d?s.jsxs(ne.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Report Tool Problem"}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Tool: ",n]})]}),s.jsx(Pj,{selectedProblemType:h,onProblemTypeSelect:p}),h==="other"&&s.jsx(Rj,{value:f,onChange:g}),s.jsxs("div",{className:"flex space-x-3 pt-4",children:[s.jsx("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Back"}),s.jsx("button",{onClick:j,disabled:!h||y,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:y?"Processing...":"Report Problem"})]}),s.jsx("div",{className:"flex justify-center pt-2",children:s.jsx("button",{onClick:r,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"â† Back to Workflow Selection"})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold text-red-800 mb-1",children:"Tool Problem Workflow"}),s.jsx("p",{className:"text-red-600 text-sm",children:"Report tool issues or problems"}),s.jsxs("div",{className:"mt-2 text-xs text-red-500",children:[s.jsx("strong",{children:"Tool Status:"})," Any status â†’ Problem"]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsxs("div",{className:"text-center space-y-4",children:[s.jsxs("div",{className:"relative bg-black rounded-lg h-48 flex items-center justify-center",children:[s.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-32 rounded-lg",children:[s.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),s.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),s.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),s.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),s.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),s.jsx("button",{onClick:w,disabled:e,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${e?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:s.jsx(N,{path:Qe,size:1.5,className:`${e?"text-gray-400":"text-white"}`})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:e?"Scanning...":"Click to Scan"}),s.jsx("p",{className:"text-gray-600 text-sm",children:e?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),i&&s.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg ${i==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:Qe,size:1,className:i==="success"?"text-green-600":"text-red-600"}),s.jsx("span",{className:`font-medium ${i==="success"?"text-green-800":"text-red-800"}`,children:l})]})})]})]}),!d&&s.jsx("div",{className:"flex justify-center pt-2",children:s.jsx("button",{onClick:r,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"â† Back to Workflow Selection"})})]})},Mj=()=>{const r=new Date,e=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/(1e3*60*60*24)),t=e%26,n=e%9+1;return`${String.fromCharCode(65+t)}${n}`},Fj=()=>Mj();var Lj=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const zj=({scannedData:r,toolId:e})=>{const{markToolAsDirty:t,availableTools:n}=K(),[a]=m.useState(Fj()),[i,c]=m.useState(!1),l=m.useCallback(u=>n.find(h=>h.barcode===u),[n]),o=m.useCallback(()=>e?n.find(u=>u.id===e):l(r),[e,n,l,r]);m.useEffect(()=>{const u=o();u&&u.currentPhase==="complete"&&r&&t(u.id)},[r,t,o,a]);const d=()=>Lj(null,null,function*(){try{yield navigator.clipboard.writeText(a),c(!0),setTimeout(()=>c(!1),2e3)}catch(u){console.error("Failed to copy code:",u)}});return{tool:o(),traceabilityCode:a,copied:i,handleCopyCode:d}},Bj=({traceabilityCode:r,copied:e,onCopyCode:t})=>s.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[s.jsx(N,{path:ii,size:1.2,className:"text-blue-600"}),s.jsx("h4",{className:"text-lg font-semibold text-blue-800",children:"Traceability Code"})]}),s.jsx("p",{className:"text-blue-700 mb-4 text-sm",children:"Enter this code in your patient chart for compliance tracking"}),s.jsx("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 mb-4",children:s.jsx("div",{className:"text-4xl font-bold text-blue-800 tracking-wider font-mono",children:r})}),s.jsxs("button",{onClick:t,className:`flex items-center gap-2 mx-auto px-4 py-2 rounded-lg transition-all duration-200 ${e?"bg-green-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[s.jsx(N,{path:e?It:$u,size:1}),s.jsx("span",{children:e?"Copied!":"Copy Code"})]}),s.jsxs("button",{onClick:()=>{const n=`EMR-${Date.now()}-${Math.random().toString(36).substr(2,6).toUpperCase()}`;navigator.clipboard.writeText(n),alert(`EMR ID generated and copied: ${n}`)},className:"flex items-center gap-2 mx-auto mt-3 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all duration-200",children:[s.jsx(N,{path:ii,size:1}),s.jsx("span",{children:"Generate EMR ID"})]})]})});function qj({scannedData:r,onClose:e,toolId:t}){const{tool:n,traceabilityCode:a,copied:i,handleCopyCode:c}=zj({scannedData:r,toolId:t});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(ne.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{path:It,size:1.2,className:"text-green-600"}),s.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Tool Ready for Use"})]}),s.jsx("p",{className:"text-green-700 mb-2",children:n?`${n.name} is clean and ready for patient use.`:"Tool is clean and ready for patient use."}),s.jsxs("p",{className:"text-sm text-green-600",children:["Scanned: ",r]})]}),s.jsx(Bj,{traceabilityCode:a,copied:i,onCopyCode:c}),s.jsxs(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[s.jsx("h4",{className:"text-md font-semibold text-orange-800 mb-2",children:"Status Update"}),s.jsxs("p",{className:"text-orange-700 mb-2",children:[s.jsx("strong",{children:'Tool has been marked as "dirty"'})," and will need sterilization after use."]}),s.jsx("p",{className:"text-sm text-orange-600",children:"This change is automatically reflected in the inventory system."})]}),s.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},className:"flex gap-2",children:s.jsx("button",{onClick:e,className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition-colors font-medium",children:"Confirm & Close"})})]})}var Uj=Object.defineProperty,Hj=Object.defineProperties,Vj=Object.getOwnPropertyDescriptors,$c=Object.getOwnPropertySymbols,Wj=Object.prototype.hasOwnProperty,Gj=Object.prototype.propertyIsEnumerable,Mc=(r,e,t)=>e in r?Uj(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kj=(r,e)=>{for(var t in e||(e={}))Wj.call(e,t)&&Mc(r,t,e[t]);if($c)for(var t of $c(e))Gj.call(e,t)&&Mc(r,t,e[t]);return r},Qj=(r,e)=>Hj(r,Vj(e)),fi=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Yj=(r,e)=>{let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>r(...n),e)}},Fc=new Map,Jj=1e3,Xj=(r,e,t)=>{const n=`${r}:${e}:${JSON.stringify(t)}`,a=Date.now(),i=Fc.get(n);return i&&a-i<Jj?!0:(Fc.set(n,a),!1)},st={log:Yj((...r)=>fi(null,null,function*(){const[e,t,n]=r;if(Xj(e,t,n)){console.log("Skipping duplicate audit event:",{category:e,action:t});return}try{if(!Es()){console.warn("âš ï¸ Supabase not configured, skipping audit event logging");return}const{userId:a,facilityId:i}=yield at.getCurrentUserAndFacility(),{error:c}=yield _.from("audit_logs").insert({id:crypto.randomUUID(),module:e,table_name:e,action:t,record_id:null,user_id:a,facility_id:i,metadata:Qj(Kj({},n),{category:e,timestamp:new Date().toISOString()}),created_at:new Date().toISOString()});c?console.error("Failed to log audit event:",c):console.log("Audit event logged:",{category:e,action:t})}catch(a){console.error("Error logging audit event:",a)}}),100),logProblemToolAction:(r,e,t,n,a)=>fi(null,null,function*(){const{error:i}=yield _.from("audit_logs").insert({event_type:"tool_problem_flagged",tool_id:r,facility_id:t,user_id:e,previous_status:n,new_status:"problem",details:a||null,happened_at:new Date().toISOString()});i&&console.error("Audit log insert failed:",i);try{if(!Es()){console.warn("âš ï¸ Supabase not configured, skipping problem tool audit logging");return}const{error:c}=yield _.from("audit_logs").insert({id:crypto.randomUUID(),module:"sterilization",table_name:"tools",action:"tool_problem_action",record_id:r,user_id:e,facility_id:t,old_values:{status:n},new_values:{status:"problem"},metadata:{problem_notes:a,timestamp:new Date().toISOString()},created_at:new Date().toISOString()});c?console.error("Failed to log problem tool action:",c):console.log("Problem tool action logged:",r)}catch(c){console.error("Error logging problem tool action:",c)}})};function Zj(r,e,t,n){return fi(this,null,function*(){yield _.from("audit_logs").insert({event_type:"RECEIPT_UPLOADED",receipt_id:r,batch_id:e,operator_name:t,facility_id:n,happened_at:new Date().toISOString()})})}var gn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ae=r=>typeof r=="string"?r:"",yn=r=>typeof r=="number"?r:0,Lc=r=>typeof r=="boolean"?r:!1,Cr=r=>{if(typeof r=="string"){const e=new Date(r);return isNaN(e.getTime())?void 0:e}},zc=r=>{switch(r){case"active":return"available";case"dirty":return"maintenance";case"clean":return"available";case"problem":return"problem";case"new_barcode":return"available";default:return"available"}};function eC(r){const e=Date.now().toString(36).toUpperCase(),t=Math.random().toString(36).substr(2,4).toUpperCase();return`PKG-${r.slice(0,4).toUpperCase()}-${e}-${t}`}class Bc{static getToolsReadyForPackaging(){return gn(this,null,function*(){let t=null;for(let n=1;n<=3;n++)try{if(!Rn.getState().authToken){if(n<3){yield new Promise(p=>setTimeout(p,n*500));continue}throw new Error("User not authenticated")}const{data:{user:i},error:c}=yield _.auth.getUser();if(c||!i)throw new Error("User not authenticated");const{data:l,error:o}=yield _.from("users").select("facility_id").eq("id",i.id).single();if(o||!l)throw new Error("User facility not found");const{data:d,error:u}=yield _.from("tools").select("*").eq("facility_id",l.facility_id).eq("status","active");if(u)throw new Error(`Failed to fetch tools: ${u.message}`);return(d||[]).map(p=>{const f=p;return{id:ae(f.tool_id),name:ae(f.tool_name),barcode:ae(f.barcode),type:ae(f.tool_type),category:ae(f.category)||"general",currentPhase:ae(f.current_phase),status:zc(ae(f.current_phase)),lastSterilized:ae(f.last_sterilized)||void 0,cycleCount:yn(f.cycle_count),maxCycles:yn(f.max_cycles)||void 0,location:ae(f.location)||void 0,notes:ae(f.notes)||void 0}})}catch(a){if(t=a instanceof Error?a:new Error("Unknown error"),n===3)throw console.error(`Error fetching tools ready for packaging (attempt ${n}/3):`,a),t;yield new Promise(i=>setTimeout(i,n*500))}throw t||new Error("Failed to fetch tools after all retries")})}static createPackage(e,t,n){return gn(this,null,function*(){try{if(!Rn.getState().authToken)throw new Error("User not authenticated");const{FacilityService:i}=yield H(()=>Promise.resolve().then(()=>Re),void 0),c=yield i.getCurrentFacilityId(),{data:{user:l},error:o}=yield _.auth.getUser();if(o||!l)throw new Error("User not authenticated");const d=l.id,u=eC(c),{data:h,error:p}=yield _.from("sterilization_batches").insert({id:crypto.randomUUID(),cycle_id:crypto.randomUUID(),facility_id:c,batch_name:`Package ${u}`,batch_type:"routine",status:"packaged",package_id:u,package_type:t.packageType,package_size:t.packageSize,chemical_indicator_added:!0,packaged_by:d,packaged_at:new Date().toISOString(),requested_by:d,total_items:e.length,notes:t.notes}).select().single();if(p)throw new Error(`Failed to create package: ${p.message}`);const f=h,g=e.map(j=>({batch_id:f.id,tool_id:j,item_name:"Tool",item_type:"sterilization_tool",quantity:1,package_type:t.packageType,package_configuration:{package_size:t.packageSize,notes:t.notes}})),y=e.map(j=>Fe.updateToolStatus(j,"active"));yield Promise.all(y),yield Fe.touchTools(e);const b=yield new Su().getCurrentUser(),x=b?{id:b.facility_id}:null;yield _.from("audit_logs").insert({created_by:(b==null?void 0:b.id)||"unknown",facility_id:(x==null?void 0:x.id)||"unknown",module:"sterilization",action:"package_created",table_name:"sterilization_batches",record_id:f.id,old_values:{},new_values:{package_id:u,package_type:t.packageType,total_items:e.length,status:"packaged"},metadata:{package_id:u,tool_count:e.length,operator_name:n,package_info:t}});const w={id:ae(f.id),packageId:ae(f.package_id),batchName:ae(f.batch_name),batchType:ae(f.batch_type),status:ae(f.status),packageType:ae(f.package_type),packageSize:ae(f.package_size),chemicalIndicatorAdded:Lc(f.chemical_indicator_added),packagedBy:ae(f.packaged_by),packagedAt:Cr(f.packaged_at)||new Date,totalItems:yn(f.total_items),createdAt:Cr(f.created_at)||new Date,updatedAt:Cr(f.updated_at)||new Date};return{success:!0,message:`Package ${u} created successfully with ${e.length} tools`,batch:w,packageId:ae(u)}}catch(a){return console.error("Error creating package:",a),{success:!1,message:a instanceof Error?a.message:"Failed to create package"}}})}static getPackageById(e){return gn(this,null,function*(){try{const{data:t,error:n}=yield _.from("sterilization_batches").select("*").eq("package_id",e).single();if(n||!t)return null;const a=t;return{id:ae(a.id),packageId:ae(a.package_id),batchName:ae(a.batch_name),batchType:ae(a.batch_type),status:ae(a.status),packageType:ae(a.package_type),packageSize:ae(a.package_size),chemicalIndicatorAdded:Lc(a.chemical_indicator_added),packagedBy:ae(a.packaged_by),packagedAt:Cr(a.packaged_at)||new Date,totalItems:yn(a.total_items),createdAt:Cr(a.created_at)||new Date,updatedAt:Cr(a.updated_at)||new Date}}catch(t){return console.error("Error fetching package:",t),null}})}static getToolsInPackage(e){return gn(this,null,function*(){try{const{data:t,error:n}=yield _.from("sterilization_batches").select("id").eq("package_id",e).single();if(n||!t)throw new Error("Package not found");const a=t,{data:i,error:c}=yield _.from("sterilization_cycle_tools").select(`
          tool_id,
          tools (
            id,
            tool_name,
            barcode,
            tool_type,
            status,
            last_sterilized,
            sterilization_count,
            location,
            manufacturer,
            model,
            serial_number,
            maintenance_due_date,
            notes,
            metadata
          )
        `).eq("cycle_id",a.id);if(c)throw new Error(`Failed to fetch package tools: ${c.message}`);return(i||[]).map(l=>{const d=l.tools;if(!d)throw new Error("Tool data not found");return{id:d.id,name:d.tool_name,barcode:d.barcode,type:d.tool_type,category:d.category||"general",currentPhase:d.status,status:zc(d.status),location:d.location,notes:d.notes||void 0,cycleCount:d.cycle_count||0,lastSterilized:d.last_sterilized}})}catch(t){throw console.error("Error fetching package tools:",t),t}})}}var vn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const tC=(r,e)=>{const{currentSession:t,startPackagingSession:n,addToolToSession:a,removeToolFromSession:i,generateBatchId:c,assignBatchIdToSession:l,endPackagingSession:o}=K(),[d,u]=m.useState(""),[h,p]=m.useState(""),[f,g]=m.useState(""),[y,v]=m.useState(null),[b,x]=m.useState({packageType:"",packageSize:"",notes:""}),[w,j]=m.useState(!1),[I,E]=m.useState(!1),[O,S]=m.useState([]),[C,D]=m.useState([]),k=K(q=>q.currentBatch)||null,P=K(q=>q.batchLoading)||!1,T=m.useCallback(()=>vn(null,null,function*(){try{const q=yield Bc.getToolsReadyForPackaging();S(q)}catch(q){console.error("Error loading tools ready for packaging:",q),g("Error loading tools ready for packaging")}}),[]),A=m.useCallback(q=>vn(null,null,function*(){p(q),v(null),g("Processing scan...");const Q=O.find(Z=>Z.barcode===q);if(!Q){v("error"),g("Tool not found or not ready for packaging");return}if(C.find(Z=>Z.id===Q.id)){v("error"),g("Tool already added to package");return}if(D(Z=>[...Z,Q]),a(q),e&&k){const Z=K.getState().addToolToBatch;Z(Q.id)}v("success"),g(`Successfully added ${Q.name} to package`),setTimeout(()=>{p(""),g(""),v(null)},2e3)}),[O,C,a,e,k]),z=m.useCallback(()=>{if(O.length===0){v("error"),g("No tools available for packaging");return}const q=O[Math.floor(Math.random()*O.length)];A(q.barcode)},[O,A]),W=m.useCallback(q=>vn(null,null,function*(){if(!t){g("Please start a packaging session first");return}try{g("Creating new autoclave load...");const Q=q?`${q}${Math.floor(1e3+Math.random()*9e3)}`:c();l(Q);const Z=K.getState().createBatch;yield Z(d,!0),g("New autoclave load created successfully!"),setTimeout(()=>{g("")},2e3)}catch(Q){g("Error creating new autoclave load"),console.error("Error creating new autoclave load:",Q)}}),[t,d,c,l]),M=m.useCallback(()=>{if(!(k!=null&&k.batchCode)){g("Please create a batch first before uploading receipts");return}E(!0)},[k==null?void 0:k.batchCode]),R=m.useCallback(()=>{E(!1),g("Receipt uploaded successfully!"),setTimeout(()=>{g("")},2e3)},[]),F=m.useCallback(()=>{E(!1)},[]),V=m.useCallback(()=>vn(null,null,function*(){if(C.length===0){g("No tools selected for packaging");return}if(!b.packageType){g("Please select a package type");return}try{g("Creating package...");const q=yield Bc.createPackage(C.map(Q=>Q.id),b,d);q.success?(g(q.message),D([]),j(!1),yield T(),setTimeout(()=>{r()},3e3)):g(q.message)}catch(q){console.error("Error finalizing package:",q),g("Error creating package. Please try again.")}}),[C,b,d,T,r]),L=m.useCallback(()=>{o(),D([]),g(""),v(null),r()},[o,r]),Y=m.useCallback(q=>{const Q=C.find(Z=>Z.id===q);if(Q&&(D(Z=>Z.filter(ze=>ze.id!==q)),i(Q.barcode),e&&k)){const Z=K.getState().removeToolFromBatch;Z(q)}},[C,i,e,k]),G=m.useCallback(()=>{if(!d.trim()){g("Please enter operator name");return}n(d,"default-facility")},[d,n]);return{operatorName:d,scannedBarcode:h,scanMessage:f,scanResult:y,packageInfo:b,showPackageForm:w,showReceiptUpload:I,scannedTools:C,batchLoading:P,currentSession:t,availableTools:O,setOperatorName:u,setScannedBarcode:p,setPackageInfo:x,setShowPackageForm:j,handleScan:A,simulateScan:z,handleNewAutoclaveLoad:W,handleImportReceipt:M,handleReceiptUploadSuccess:R,handleReceiptUploadCancel:F,handleFinalizePackage:V,handleEndSession:L,handleRemoveTool:Y,handleStartSession:G,loadToolsReadyForPackaging:T}},rC=({operatorName:r,isBatchMode:e,onEndSession:t})=>s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Packaging Workflow"}),s.jsxs("p",{className:"text-sm text-gray-600",children:[e?"Batch Mode":"Single Tool Mode"," - Operator:"," ",r]})]}),s.jsxs("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:[s.jsx(de,{path:Ae,size:1.5}),s.jsx("span",{className:"sr-only",children:"Close"})]})]}),sC=({scannedBarcode:r,scanMessage:e,scanResult:t,onScan:n,onBarcodeChange:a,onSimulateScan:i,onNewAutoclaveLoad:c,onImportReceipt:l,currentBatchCode:o,availableTools:d})=>{const u=h=>{h.key==="Enter"&&n(r)};return s.jsxs("div",{className:"mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(de,{path:Pp,size:1.2,className:"text-purple-600"}),s.jsx("h4",{className:"font-medium text-purple-800",children:"Scanner"})]}),s.jsx("button",{onClick:i,disabled:d.length===0,className:`px-3 py-1 text-sm rounded-md transition-colors ${d.length===0?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:"Simulate Scan"})]}),s.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(de,{path:Ii,size:1,className:"text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Tools Ready for Packaging"})]}),s.jsxs("p",{className:"text-sm text-blue-700",children:[d.length," tools available for packaging"]}),d.length>0&&s.jsx("div",{className:"mt-2 text-xs text-blue-600",children:s.jsxs("p",{children:["Available barcodes:"," ",d.slice(0,3).map(h=>h.barcode).join(", "),d.length>3&&`... and ${d.length-3} more`]})})]}),o&&s.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md mb-4",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("span",{className:"font-medium",children:"Current Batch:"})," ",o]})}),s.jsxs("div",{className:"flex space-x-2 mb-4",children:[c&&s.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[s.jsx(de,{path:ki,size:1}),s.jsx("span",{children:"+ New Autoclave Load"})]}),l&&s.jsxs("button",{onClick:l,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[s.jsx(de,{path:Ye,size:1}),s.jsx("span",{children:"Import Receipt"})]})]}),t&&s.jsx("div",{className:`p-3 rounded-md mb-3 ${t==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("input",{type:"text",value:r,onChange:h=>a(h.target.value),onKeyPress:u,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter barcode manually or scan..."}),s.jsx("button",{onClick:()=>n(r),disabled:!r.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Scan Tool"})]})]})},nC=({scannedTools:r,onRemoveTool:e,onFinalizePackage:t})=>s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h4",{className:"font-medium text-gray-800",children:["Scanned Tools (",r.length,")"]}),r.length>0&&s.jsx("button",{onClick:t,className:"px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors",children:"Finalize Package"})]}),r.length===0?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(de,{path:mr,size:2,className:"mx-auto mb-2 text-gray-300"}),s.jsx("p",{children:"No tools scanned yet"}),s.jsx("p",{className:"text-sm",children:"Scan tools to add them to the package"})]}):s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map(n=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-800",children:n.name}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Barcode: ",n.barcode]})]}),s.jsxs("button",{onClick:()=>e(n.id),className:"p-1 text-red-500 hover:text-red-700 transition-colors",children:[s.jsx(de,{path:Un,size:1}),s.jsx("span",{className:"sr-only",children:"Remove"})]})]},n.id))})]});var aC=Object.defineProperty,iC=Object.defineProperties,oC=Object.getOwnPropertyDescriptors,qc=Object.getOwnPropertySymbols,lC=Object.prototype.hasOwnProperty,cC=Object.prototype.propertyIsEnumerable,Uc=(r,e,t)=>e in r?aC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Fa=(r,e)=>{for(var t in e||(e={}))lC.call(e,t)&&Uc(r,t,e[t]);if(qc)for(var t of qc(e))cC.call(e,t)&&Uc(r,t,e[t]);return r},La=(r,e)=>iC(r,oC(e));const dC=({packageInfo:r,batchLoading:e,onPackageInfoChange:t,onFinalizePackage:n,onCancel:a,packageTypes:i,packageSizes:c})=>{const l=u=>{t(La(Fa({},r),{packageType:u}))},o=u=>{t(La(Fa({},r),{packageSize:u}))},d=u=>{t(La(Fa({},r),{notes:u}))};return s.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-blue-800 mb-3",children:"Package Information"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"package-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Type"}),s.jsxs("select",{id:"package-type",value:r.packageType,onChange:u=>l(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Select package type"}),i.map(u=>s.jsx("option",{value:u,children:u.charAt(0).toUpperCase()+u.slice(1)},u))]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"package-size",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Size"}),s.jsxs("select",{id:"package-size",value:r.packageSize,onChange:u=>o(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Select package size"}),c.map(u=>s.jsx("option",{value:u,children:u.charAt(0).toUpperCase()+u.slice(1).replace("-"," ")},u))]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"package-notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),s.jsx("textarea",{id:"package-notes",value:r.notes,onChange:u=>d(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"Additional notes about the package..."})]})]}),s.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[s.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:n,disabled:e||!r.packageType||!r.packageSize,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:e?"Processing...":"Generate Batch Code"})]})]})},uC=({operatorName:r,onOperatorNameChange:e,onStartSession:t,onCancel:n})=>s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Packaging Workflow"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Operator Name"}),s.jsx("input",{id:"operator-name",type:"text",value:r,onChange:a=>e(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter your name"})]}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:t,disabled:!r.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 transition-colors",children:"Start Session"})]})]});var Hc=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const mC=({onClose:r,isBatchMode:e})=>{const{currentUser:t}=hr(),[n,a]=m.useState(!1),[i,c]=m.useState(["pouch","wrap","container","tray"]),[l,o]=m.useState(["small","medium","large","extra-large"]),[d,u]=m.useState("PKG-"),[h,p]=m.useState(25),[f,g]=m.useState(!1),[y,v]=m.useState(null);m.useEffect(()=>{Hc(null,null,function*(){try{if(!(t!=null&&t.facility_id))return;const{data:De,error:it}=yield _.from("facility_settings").select("packaging_settings").eq("facility_id",t.facility_id).single();if(it)console.warn("No packaging settings found, using defaults");else if(De!=null&&De.packaging_settings){const Pe=De.packaging_settings;c(ye=>Pe.packageTypes||ye),o(ye=>Pe.packageSizes||ye),u(ye=>Pe.batchPrefix||ye),p(ye=>Pe.maxToolsPerBatch||ye),g(!!Pe.requireReceiptUpload)}}catch(De){console.error("Error loading packaging settings:",De)}finally{a(!0)}})},[t]);const b=tC(r,e);te.useEffect(()=>{b!=null&&b.loadToolsReadyForPackaging&&b.loadToolsReadyForPackaging()},[b]);const x=ee=>{if(P.length>=h){alert(`â— Maximum batch size reached. You can only package up to ${h} tools per batch.`);return}b==null||b.handleScan(ee)},w=ee=>Hc(null,null,function*(){v({url:ee.photoUrl,id:ee.id});try{ee&&(A!=null&&A.currentBatchId)&&(t!=null&&t.facility_id)&&(yield Zj(ee.id||ee.photoUrl||"unknown",A.currentBatchId,(t==null?void 0:t.name)||"Unknown Operator",t.facility_id))}catch(De){console.error("Failed to log receipt upload audit event:",De)}b==null||b.handleReceiptUploadSuccess()}),j=()=>{if(f&&(!y||!y.url)){alert("ðŸ“„ Receipt upload required before completing this batch.");return}b==null||b.handleFinalizePackage()};if(!n)return s.jsx("p",{className:"text-sm text-gray-500",children:"Loading Packaging Settings..."});if(!b)return s.jsx("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading packaging workflow..."})]})});const{operatorName:I,scannedBarcode:E,scanMessage:O,scanResult:S,packageInfo:C,showPackageForm:D,showReceiptUpload:k,scannedTools:P,batchLoading:T,currentSession:A,availableTools:z,setOperatorName:W,setScannedBarcode:M,setPackageInfo:R,setShowPackageForm:F,handleScan:V,simulateScan:L,handleNewAutoclaveLoad:Y,handleImportReceipt:G,handleReceiptUploadSuccess:q,handleReceiptUploadCancel:Q,handleFinalizePackage:Z,handleEndSession:ze,handleRemoveTool:U,handleStartSession:me}=b;return A?k?s.jsx(Rm,{batchCode:A.currentBatchId||"",operator:I,onSuccess:w,onCancel:Q}):s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:[s.jsx(rC,{operatorName:I,isBatchMode:e,onEndSession:ze}),s.jsx(sC,{scannedBarcode:E,scanMessage:O,scanResult:S,onScan:x,onBarcodeChange:M,onSimulateScan:L,onNewAutoclaveLoad:()=>Y(d),onImportReceipt:G,currentBatchCode:A.currentBatchId||void 0,availableTools:z}),s.jsx(nC,{scannedTools:P,onRemoveTool:U,onFinalizePackage:()=>F(!0)}),f&&!y&&s.jsxs("div",{className:"mb-4 rounded-md bg-yellow-100 border border-yellow-300 px-4 py-3 text-sm text-yellow-800 flex items-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-yellow-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:"Receipt upload required before finalizing this batch."})]}),D&&s.jsx(dC,{packageInfo:C,batchLoading:T,onPackageInfoChange:R,onFinalizePackage:j,onCancel:()=>F(!1),packageTypes:i,packageSizes:l}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsxs("p",{children:["Session ID: ",A==null?void 0:A.id]}),s.jsxs("p",{children:["Started:"," ",A!=null&&A.startedAt?new Date(A.startedAt).toLocaleTimeString():"N/A"]}),s.jsxs("p",{children:["Tools Ready: ",z.length]})]})]}):s.jsx(uC,{operatorName:I,onOperatorNameChange:W,onStartSession:me,onCancel:r})},hC=({tool:r,onDismiss:e,onReplace:t,onContinue:n})=>{const a=(r.maxCycles||200)-r.cycleCount;return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:ce,size:1.5,className:"text-red-500"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tool Replacement Required"})]}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(N,{path:Ae,size:1})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(N,{path:Ii,size:1,className:"text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-red-800 font-medium mb-2",children:[r.name," (Barcode: ",r.barcode,")"]}),s.jsxs("p",{className:"text-red-700 text-sm",children:["This tool has completed ",s.jsx("strong",{children:r.cycleCount})," ","sterilization cycles and has reached the maximum recommended limit of ",r.maxCycles||200," cycles."]}),a<=0&&s.jsx("p",{className:"text-red-700 text-sm font-medium mt-2",children:"âš ï¸ This tool has exceeded the maximum cycle limit and should be replaced immediately."}),a>0&&a<=5&&s.jsxs("p",{className:"text-orange-700 text-sm font-medium mt-2",children:["âš ï¸ Only ",a," cycle",a!==1?"s":""," remaining before replacement is required."]})]})]})}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cycle Information"}),s.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Current Cycles:"}),s.jsx("span",{className:"font-medium",children:r.cycleCount})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Maximum Cycles:"}),s.jsx("span",{className:"font-medium",children:r.maxCycles||200})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Cycles Remaining:"}),s.jsx("span",{className:`font-medium ${a<=0?"text-red-600":a<=5?"text-orange-600":"text-green-600"}`,children:a<=0?"Exceeded":a})]})]})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Recommendation"}),s.jsx("p",{className:"text-blue-800 text-sm",children:"For patient safety and compliance, it is recommended to replace this tool with a new one. Continued use beyond the cycle limit may compromise sterilization effectiveness."})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:t,className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Replace Tool"}),s.jsx("button",{onClick:n,className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"Continue Anyway"})]}),s.jsx("div",{className:"mt-3 text-center",children:s.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-sm transition-colors",children:"Dismiss"})})]})})},Am=m.memo(()=>{const{selectedWorkflow:r,scannedData:e,showWorkflowResult:t,scanMode:n,isScanning:a,scanMessage:i,scannedTools:c,dirtyScanMessage:l,isBath1Active:o,replacementAlert:d,handleWorkflowSelect:u,handleBackToWorkflow:h,handleScan:p,handleCloseWorkflow:f,handleReceiptUploadSuccess:g,handleReceiptUploadCancel:y,handleDeleteTool:v,handleCancelAll:b,handleSendScannedToBath1:x,handleScanModeChange:w,handleScanTool:j,handleReplaceTool:I,handleContinueAnyway:E,handleDismissReplacementAlert:O}=oj();return s.jsxs(s.Fragment,{children:[s.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:()=>window.history.back()}),s.jsx(ne.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:s.jsx("div",{className:"h-full flex flex-col",children:s.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Sterilization Scanner"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Scan tools for sterilization workflows"})]}),s.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",style:{maxHeight:"calc(100vh - 120px)"},children:r?r==="import"?s.jsx("div",{children:s.jsx(Rm,{batchCode:"",operator:"",onSuccess:g,onCancel:y})}):r==="problem"?s.jsx("div",{children:s.jsx($j,{onClose:h})}):r==="clean"&&t?s.jsx("div",{children:s.jsx(qj,{scannedData:e,onClose:f})}):r==="packaging"?s.jsx("div",{children:s.jsx(mC,{onClose:h,isBatchMode:n==="batch"})}):r==="dirty"?s.jsxs("div",{className:"space-y-4",children:[s.jsx(Ec,{workflowId:"dirty",color:"orange"}),o&&s.jsx("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(N,{path:ce,size:.8,className:"text-red-600"}),s.jsx("span",{className:"text-red-700 text-xs font-medium",children:"Bath 1 is currently active"})]})}),d.show&&d.tool&&s.jsx(hC,{tool:d.tool,onDismiss:O,onReplace:I,onContinue:E}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>w("single"),className:`px-3 py-1.5 rounded text-sm transition-colors ${n==="single"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Single Scan"}),s.jsx("button",{onClick:()=>w("batch"),className:`px-3 py-1.5 rounded text-sm transition-colors ${n==="batch"?"bg-green-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Batch Scan"})]}),s.jsx(kc,{isScanning:a,scanMessage:l,onScan:j,size:"small"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"font-medium text-gray-800 text-sm",children:["Scanned Tools (",c.length,")"]}),c.length===0?s.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 p-4 rounded text-center",children:[s.jsx(N,{path:Qe,size:1.5,className:"text-gray-400 mx-auto mb-1"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"No tools scanned yet"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Use the scanner above to add tools"})]}):s.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 scrollbar-hide hide-scrollbar",children:c.map(S=>s.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-sm",children:S.name}),s.jsxs("span",{className:"text-gray-600 text-xs ml-2",children:["(",S.barcode,")"]})]}),s.jsx("button",{onClick:()=>v(S.id),className:"text-red-500 hover:text-red-700 p-1",title:"Remove tool",children:s.jsx(N,{path:Hn,size:.7})})]},S.id))})]}),o&&s.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(N,{path:ce,size:1,className:"text-orange-600"}),s.jsx("span",{className:"text-orange-800 text-sm font-medium",children:"âš ï¸ Bath 1 timer is already in process"})]}),s.jsx("p",{className:"text-orange-600 text-xs mt-1",children:"Please wait for the current Bath 1 phase to complete before starting a new one."})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:b,disabled:c.length===0,className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${c.length===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,children:"Cancel"}),s.jsx("button",{onClick:x,disabled:c.length===0||o,className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${c.length===0||o?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,title:o?"Bath 1 timer is already in process":void 0,children:"Send to Bath 1"})]}),s.jsx("div",{className:"flex justify-center pt-2",children:s.jsx("button",{onClick:h,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"â† Back to Workflow Selection"})})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsx(Ec,{workflowId:r,color:"blue"}),s.jsx(kc,{isScanning:a,scanMessage:i,onScan:p,size:"large"}),s.jsx("div",{className:"flex justify-center",children:s.jsx("button",{onClick:h,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"â† Back to Workflow Selection"})})]}):s.jsx(gj,{onWorkflowSelect:u})})]})})})]})});Am.displayName="ScannerPage";const pC=({children:r})=>s.jsx("div",{className:"space-y-6",children:r}),fC=({children:r})=>s.jsx(s.Fragment,{children:r});var za={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var Vc;function gC(){return Vc||(Vc=1,(function(r){(function(){var e={}.hasOwnProperty;function t(){for(var i="",c=0;c<arguments.length;c++){var l=arguments[c];l&&(i=a(i,n(l)))}return i}function n(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var c="";for(var l in i)e.call(i,l)&&i[l]&&(c=a(c,l));return c}function a(i,c){return c?i?i+" "+c:i+c:i}r.exports?(t.default=t,r.exports=t):window.classNames=t})()})(za)),za.exports}var yC=gC();const Je=ji(yC);function vC(r,e){if(r==null)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)!==-1)continue;t[n]=r[n]}return t}function gi(r,e){return gi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},gi(r,e)}function xC(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,gi(r,e)}const bC=["xxl","xl","lg","md","sm","xs"],_C="xs",Bi=m.createContext({prefixes:{},breakpoints:bC,minBreakpoint:_C}),{Consumer:lP,Provider:cP}=Bi;function pr(r,e){const{prefixes:t}=m.useContext(Bi);return r||t[e]||e}function wC(){const{dir:r}=m.useContext(Bi);return r==="rtl"}function Zn(r){return r&&r.ownerDocument||document}function SC(r){var e=Zn(r);return e&&e.defaultView||window}function jC(r,e){return SC(r).getComputedStyle(r,e)}var CC=/([A-Z])/g;function NC(r){return r.replace(CC,"-$1").toLowerCase()}var IC=/^ms-/;function xn(r){return NC(r).replace(IC,"-ms-")}var TC=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function EC(r){return!!(r&&TC.test(r))}function dr(r,e){var t="",n="";if(typeof e=="string")return r.style.getPropertyValue(xn(e))||jC(r).getPropertyValue(xn(e));Object.keys(e).forEach(function(a){var i=e[a];!i&&i!==0?r.style.removeProperty(xn(a)):EC(a)?n+=a+"("+i+") ":t+=xn(a)+": "+i+";"}),n&&(t+="transform: "+n+";"),r.style.cssText+=";"+t}var kC=Zp();const Ba=ji(kC),Wc={disabled:!1},$m=te.createContext(null);var DC=function(e){return e.scrollTop},ws="unmounted",tr="exited",Lt="entering",nr="entered",yi="exiting",Et=(function(r){xC(e,r);function e(n,a){var i;i=r.call(this,n,a)||this;var c=a,l=c&&!c.isMounting?n.enter:n.appear,o;return i.appearStatus=null,n.in?l?(o=tr,i.appearStatus=Lt):o=nr:n.unmountOnExit||n.mountOnEnter?o=ws:o=tr,i.state={status:o},i.nextCallback=null,i}e.getDerivedStateFromProps=function(a,i){var c=a.in;return c&&i.status===ws?{status:tr}:null};var t=e.prototype;return t.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},t.componentDidUpdate=function(a){var i=null;if(a!==this.props){var c=this.state.status;this.props.in?c!==Lt&&c!==nr&&(i=Lt):(c===Lt||c===nr)&&(i=yi)}this.updateStatus(!1,i)},t.componentWillUnmount=function(){this.cancelNextCallback()},t.getTimeouts=function(){var a=this.props.timeout,i,c,l;return i=c=l=a,a!=null&&typeof a!="number"&&(i=a.exit,c=a.enter,l=a.appear!==void 0?a.appear:c),{exit:i,enter:c,appear:l}},t.updateStatus=function(a,i){if(a===void 0&&(a=!1),i!==null)if(this.cancelNextCallback(),i===Lt){if(this.props.unmountOnExit||this.props.mountOnEnter){var c=this.props.nodeRef?this.props.nodeRef.current:Rr.findDOMNode(this);c&&DC(c)}this.performEnter(a)}else this.performExit();else this.props.unmountOnExit&&this.state.status===tr&&this.setState({status:ws})},t.performEnter=function(a){var i=this,c=this.props.enter,l=this.context?this.context.isMounting:a,o=this.props.nodeRef?[l]:[Rr.findDOMNode(this),l],d=o[0],u=o[1],h=this.getTimeouts(),p=l?h.appear:h.enter;if(!a&&!c||Wc.disabled){this.safeSetState({status:nr},function(){i.props.onEntered(d)});return}this.props.onEnter(d,u),this.safeSetState({status:Lt},function(){i.props.onEntering(d,u),i.onTransitionEnd(p,function(){i.safeSetState({status:nr},function(){i.props.onEntered(d,u)})})})},t.performExit=function(){var a=this,i=this.props.exit,c=this.getTimeouts(),l=this.props.nodeRef?void 0:Rr.findDOMNode(this);if(!i||Wc.disabled){this.safeSetState({status:tr},function(){a.props.onExited(l)});return}this.props.onExit(l),this.safeSetState({status:yi},function(){a.props.onExiting(l),a.onTransitionEnd(c.exit,function(){a.safeSetState({status:tr},function(){a.props.onExited(l)})})})},t.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},t.safeSetState=function(a,i){i=this.setNextCallback(i),this.setState(a,i)},t.setNextCallback=function(a){var i=this,c=!0;return this.nextCallback=function(l){c&&(c=!1,i.nextCallback=null,a(l))},this.nextCallback.cancel=function(){c=!1},this.nextCallback},t.onTransitionEnd=function(a,i){this.setNextCallback(i);var c=this.props.nodeRef?this.props.nodeRef.current:Rr.findDOMNode(this),l=a==null&&!this.props.addEndListener;if(!c||l){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var o=this.props.nodeRef?[this.nextCallback]:[c,this.nextCallback],d=o[0],u=o[1];this.props.addEndListener(d,u)}a!=null&&setTimeout(this.nextCallback,a)},t.render=function(){var a=this.state.status;if(a===ws)return null;var i=this.props,c=i.children;i.in,i.mountOnEnter,i.unmountOnExit,i.appear,i.enter,i.exit,i.timeout,i.addEndListener,i.onEnter,i.onEntering,i.onEntered,i.onExit,i.onExiting,i.onExited,i.nodeRef;var l=vC(i,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return te.createElement($m.Provider,{value:null},typeof c=="function"?c(a,l):te.cloneElement(te.Children.only(c),l))},e})(te.Component);Et.contextType=$m;Et.propTypes={};function Nr(){}Et.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Nr,onEntering:Nr,onEntered:Nr,onExit:Nr,onExiting:Nr,onExited:Nr};Et.UNMOUNTED=ws;Et.EXITED=tr;Et.ENTERING=Lt;Et.ENTERED=nr;Et.EXITING=yi;function PC(r){return r.code==="Escape"||r.keyCode===27}function OC(){const r=m.version.split(".");return{major:+r[0],minor:+r[1],patch:+r[2]}}function ea(r){if(!r||typeof r=="function")return null;const{major:e}=OC();return e>=19?r.props.ref:r.ref}const Hr=!!(typeof window!="undefined"&&window.document&&window.document.createElement);var vi=!1,xi=!1;try{var qa={get passive(){return vi=!0},get once(){return xi=vi=!0}};Hr&&(window.addEventListener("test",qa,qa),window.removeEventListener("test",qa,!0))}catch(r){}function Mm(r,e,t,n){if(n&&typeof n!="boolean"&&!xi){var a=n.once,i=n.capture,c=t;!xi&&a&&(c=t.__once||function l(o){this.removeEventListener(e,l,i),t.call(this,o)},t.__once=c),r.addEventListener(e,c,vi?n:i)}r.addEventListener(e,t,n)}function bi(r,e,t,n){var a=n&&typeof n!="boolean"?n.capture:n;r.removeEventListener(e,t,a),t.__once&&r.removeEventListener(e,t.__once,a)}function zn(r,e,t,n){return Mm(r,e,t,n),function(){bi(r,e,t,n)}}function RC(r,e,t,n){if(n===void 0&&(n=!0),r){var a=document.createEvent("HTMLEvents");a.initEvent(e,t,n),r.dispatchEvent(a)}}function AC(r){var e=dr(r,"transitionDuration")||"",t=e.indexOf("ms")===-1?1e3:1;return parseFloat(e)*t}function $C(r,e,t){t===void 0&&(t=5);var n=!1,a=setTimeout(function(){n||RC(r,"transitionend",!0)},e+t),i=zn(r,"transitionend",function(){n=!0},{once:!0});return function(){clearTimeout(a),i()}}function Fm(r,e,t,n){t==null&&(t=AC(r)||0);var a=$C(r,t,n),i=zn(r,"transitionend",e);return function(){a(),i()}}function Gc(r,e){const t=dr(r,e)||"",n=t.indexOf("ms")===-1?1e3:1;return parseFloat(t)*n}function MC(r,e){const t=Gc(r,"transitionDuration"),n=Gc(r,"transitionDelay"),a=Fm(r,i=>{i.target===r&&(a(),e(i))},t+n)}function FC(r){r.offsetHeight}const Kc=r=>!r||typeof r=="function"?r:e=>{r.current=e};function LC(r,e){const t=Kc(r),n=Kc(e);return a=>{t&&t(a),n&&n(a)}}function Lm(r,e){return m.useMemo(()=>LC(r,e),[r,e])}function zC(r){return r&&"setState"in r?Rr.findDOMNode(r):r!=null?r:null}const zm=te.forwardRef((h,u)=>{var p=h,{onEnter:r,onEntering:e,onEntered:t,onExit:n,onExiting:a,onExited:i,addEndListener:c,children:l,childRef:o}=p,d=Be(p,["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children","childRef"]);const f=m.useRef(null),g=Lm(f,o),y=S=>{g(zC(S))},v=S=>C=>{S&&f.current&&S(f.current,C)},b=m.useCallback(v(r),[r]),x=m.useCallback(v(e),[e]),w=m.useCallback(v(t),[t]),j=m.useCallback(v(n),[n]),I=m.useCallback(v(a),[a]),E=m.useCallback(v(i),[i]),O=m.useCallback(v(c),[c]);return s.jsx(Et,_e(se({ref:u},d),{onEnter:b,onEntered:w,onEntering:x,onExit:j,onExited:E,onExiting:I,addEndListener:O,nodeRef:f,children:typeof l=="function"?(S,C)=>l(S,_e(se({},C),{ref:y})):te.cloneElement(l,{ref:y})}))});zm.displayName="TransitionWrapper";function BC(r){const e=m.useRef(r);return m.useEffect(()=>{e.current=r},[r]),e}function _i(r){const e=BC(r);return m.useCallback(function(...t){return e.current&&e.current(...t)},[e])}const qC=(r=>m.forwardRef((e,t)=>s.jsx("div",_e(se({},e),{ref:t,className:Je(e.className,r)}))));function UC(r){const e=m.useRef(r);return m.useEffect(()=>{e.current=r},[r]),e}function ar(r){const e=UC(r);return m.useCallback(function(...t){return e.current&&e.current(...t)},[e])}function HC(){const r=m.useRef(!0),e=m.useRef(()=>r.current);return m.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[]),e.current}function VC(r){const e=m.useRef(null);return m.useEffect(()=>{e.current=r}),e.current}const WC=typeof global!="undefined"&&global.navigator&&global.navigator.product==="ReactNative",GC=typeof document!="undefined",Qc=GC||WC?m.useLayoutEffect:m.useEffect,KC=["as","disabled"];function QC(r,e){if(r==null)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}function YC(r){return!r||r.trim()==="#"}function Bm({tagName:r,disabled:e,href:t,target:n,rel:a,role:i,onClick:c,tabIndex:l=0,type:o}){r||(t!=null||n!=null||a!=null?r="a":r="button");const d={tagName:r};if(r==="button")return[{type:o||"button",disabled:e},d];const u=p=>{if((e||r==="a"&&YC(t))&&p.preventDefault(),e){p.stopPropagation();return}c==null||c(p)},h=p=>{p.key===" "&&(p.preventDefault(),u(p))};return r==="a"&&(t||(t="#"),e&&(t=void 0)),[{role:i!=null?i:"button",disabled:void 0,tabIndex:e?void 0:l,href:t,target:r==="a"?n:void 0,"aria-disabled":e||void 0,rel:r==="a"?a:void 0,onClick:u,onKeyDown:h},d]}const JC=m.forwardRef((r,e)=>{let{as:t,disabled:n}=r,a=QC(r,KC);const[i,{tagName:c}]=Bm(Object.assign({tagName:t,disabled:n},a));return s.jsx(c,Object.assign({},a,i,{ref:e}))});JC.displayName="Button";const XC={[Lt]:"show",[nr]:"show"},qi=m.forwardRef((c,i)=>{var l=c,{className:r,children:e,transitionClasses:t={},onEnter:n}=l,a=Be(l,["className","children","transitionClasses","onEnter"]);const o=se({in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1},a),d=m.useCallback((u,h)=>{FC(u),n==null||n(u,h)},[n]);return s.jsx(zm,_e(se({ref:i,addEndListener:MC},o),{onEnter:d,childRef:ea(e),children:(u,h)=>m.cloneElement(e,_e(se({},h),{className:Je("fade",r,e.props.className,XC[u],t[u])}))}))});qi.displayName="Fade";const ZC={"aria-label":Ba.string,onClick:Ba.func,variant:Ba.oneOf(["white"])},Ui=m.forwardRef((i,a)=>{var c=i,{className:r,variant:e,"aria-label":t="Close"}=c,n=Be(c,["className","variant","aria-label"]);return s.jsx("button",se({ref:a,type:"button",className:Je("btn-close",e&&`btn-close-${e}`,r),"aria-label":t},n))});Ui.displayName="CloseButton";Ui.propTypes=ZC;const Hi=m.forwardRef((d,o)=>{var u=d,{as:r,bsPrefix:e,variant:t="primary",size:n,active:a=!1,disabled:i=!1,className:c}=u,l=Be(u,["as","bsPrefix","variant","size","active","disabled","className"]);const h=pr(e,"btn"),[p,{tagName:f}]=Bm(se({tagName:r,disabled:i},l)),g=f;return s.jsx(g,_e(se(se({},p),l),{ref:o,disabled:i,className:Je(c,h,a&&"active",t&&`${h}-${t}`,n&&`${h}-${n}`,l.href&&i&&"disabled")}))});Hi.displayName="Button";function eN(r){const e=m.useRef(r);return e.current=r,e}function tN(r){const e=eN(r);m.useEffect(()=>()=>e.current(),[])}var rN=Function.prototype.bind.call(Function.prototype.call,[].slice);function Ir(r,e){return rN(r.querySelectorAll(e))}function Yc(r,e){if(r.contains)return r.contains(e);if(r.compareDocumentPosition)return r===e||!!(r.compareDocumentPosition(e)&16)}const sN="data-rr-ui-";function nN(r){return`${sN}${r}`}const qm=m.createContext(Hr?window:void 0);qm.Provider;function Vi(){return m.useContext(qm)}const Jc=r=>!r||typeof r=="function"?r:e=>{r.current=e};function aN(r,e){const t=Jc(r),n=Jc(e);return a=>{t&&t(a),n&&n(a)}}function Wi(r,e){return m.useMemo(()=>aN(r,e),[r,e])}var bn;function Xc(r){if((!bn&&bn!==0||r)&&Hr){var e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.width="50px",e.style.height="50px",e.style.overflow="scroll",document.body.appendChild(e),bn=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return bn}function iN(){return m.useState(null)}function Ua(r){r===void 0&&(r=Zn());try{var e=r.activeElement;return!e||!e.nodeName?null:e}catch(t){return r.body}}function oN(r){const e=m.useRef(r);return e.current=r,e}function lN(r){const e=oN(r);m.useEffect(()=>()=>e.current(),[])}function cN(r=document){const e=r.defaultView;return Math.abs(e.innerWidth-r.documentElement.clientWidth)}const Zc=nN("modal-open");class Gi{constructor({ownerDocument:e,handleContainerOverflow:t=!0,isRTL:n=!1}={}){this.handleContainerOverflow=t,this.isRTL=n,this.modals=[],this.ownerDocument=e}getScrollbarWidth(){return cN(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(e){}removeModalAttributes(e){}setContainerStyle(e){const t={overflow:"hidden"},n=this.isRTL?"paddingLeft":"paddingRight",a=this.getElement();e.style={overflow:a.style.overflow,[n]:a.style[n]},e.scrollBarWidth&&(t[n]=`${parseInt(dr(a,n)||"0",10)+e.scrollBarWidth}px`),a.setAttribute(Zc,""),dr(a,t)}reset(){[...this.modals].forEach(e=>this.remove(e))}removeContainerStyle(e){const t=this.getElement();t.removeAttribute(Zc),Object.assign(t.style,e.style)}add(e){let t=this.modals.indexOf(e);return t!==-1||(t=this.modals.length,this.modals.push(e),this.setModalAttributes(e),t!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),t}remove(e){const t=this.modals.indexOf(e);t!==-1&&(this.modals.splice(t,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(e))}isTopModal(e){return!!this.modals.length&&this.modals[this.modals.length-1]===e}}const Ha=(r,e)=>Hr?r==null?(e||Zn()).body:(typeof r=="function"&&(r=r()),r&&"current"in r&&(r=r.current),r&&("nodeType"in r||r.getBoundingClientRect)?r:null):null;function dN(r,e){const t=Vi(),[n,a]=m.useState(()=>Ha(r,t==null?void 0:t.document));if(!n){const i=Ha(r);i&&a(i)}return m.useEffect(()=>{},[e,n]),m.useEffect(()=>{const i=Ha(r);i!==n&&a(i)},[r,n]),n}function uN({children:r,in:e,onExited:t,mountOnEnter:n,unmountOnExit:a}){const i=m.useRef(null),c=m.useRef(e),l=ar(t);m.useEffect(()=>{e?c.current=!0:l(i.current)},[e,l]);const o=Wi(i,ea(r)),d=m.cloneElement(r,{ref:o});return e?d:a||!c.current&&n?null:d}const mN=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function hN(r,e){if(r==null)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}function pN(r){let{onEnter:e,onEntering:t,onEntered:n,onExit:a,onExiting:i,onExited:c,addEndListener:l,children:o}=r,d=hN(r,mN);const u=m.useRef(null),h=Wi(u,ea(o)),p=j=>I=>{j&&u.current&&j(u.current,I)},f=m.useCallback(p(e),[e]),g=m.useCallback(p(t),[t]),y=m.useCallback(p(n),[n]),v=m.useCallback(p(a),[a]),b=m.useCallback(p(i),[i]),x=m.useCallback(p(c),[c]),w=m.useCallback(p(l),[l]);return Object.assign({},d,{nodeRef:u},e&&{onEnter:f},t&&{onEntering:g},n&&{onEntered:y},a&&{onExit:v},i&&{onExiting:b},c&&{onExited:x},l&&{addEndListener:w},{children:typeof o=="function"?(j,I)=>o(j,Object.assign({},I,{ref:h})):m.cloneElement(o,{ref:h})})}const fN=["component"];function gN(r,e){if(r==null)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}const yN=m.forwardRef((r,e)=>{let{component:t}=r,n=gN(r,fN);const a=pN(n);return s.jsx(t,Object.assign({ref:e},a))});function vN({in:r,onTransition:e}){const t=m.useRef(null),n=m.useRef(!0),a=ar(e);return Qc(()=>{if(!t.current)return;let i=!1;return a({in:r,element:t.current,initial:n.current,isStale:()=>i}),()=>{i=!0}},[r,a]),Qc(()=>(n.current=!1,()=>{n.current=!0}),[]),t}function xN({children:r,in:e,onExited:t,onEntered:n,transition:a}){const[i,c]=m.useState(!e);e&&i&&c(!1);const l=vN({in:!!e,onTransition:d=>{const u=()=>{d.isStale()||(d.in?n==null||n(d.element,d.initial):(c(!0),t==null||t(d.element)))};Promise.resolve(a(d)).then(u,h=>{throw d.in||c(!0),h})}}),o=Wi(l,ea(r));return i&&!e?null:m.cloneElement(r,{ref:o})}function ed(r,e,t){return r?s.jsx(yN,Object.assign({},t,{component:r})):e?s.jsx(xN,Object.assign({},t,{transition:e})):s.jsx(uN,Object.assign({},t))}const bN=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function _N(r,e){if(r==null)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}let Va;function wN(r){return Va||(Va=new Gi({ownerDocument:r==null?void 0:r.document})),Va}function SN(r){const e=Vi(),t=r||wN(e),n=m.useRef({dialog:null,backdrop:null});return Object.assign(n.current,{add:()=>t.add(n.current),remove:()=>t.remove(n.current),isTopModal:()=>t.isTopModal(n.current),setDialogRef:m.useCallback(a=>{n.current.dialog=a},[]),setBackdropRef:m.useCallback(a=>{n.current.backdrop=a},[])})}const Um=m.forwardRef((r,e)=>{let{show:t=!1,role:n="dialog",className:a,style:i,children:c,backdrop:l=!0,keyboard:o=!0,onBackdropClick:d,onEscapeKeyDown:u,transition:h,runTransition:p,backdropTransition:f,runBackdropTransition:g,autoFocus:y=!0,enforceFocus:v=!0,restoreFocus:b=!0,restoreFocusOptions:x,renderDialog:w,renderBackdrop:j=oe=>s.jsx("div",Object.assign({},oe)),manager:I,container:E,onShow:O,onHide:S=()=>{},onExit:C,onExited:D,onExiting:k,onEnter:P,onEntering:T,onEntered:A}=r,z=_N(r,bN);const W=Vi(),M=dN(E),R=SN(I),F=HC(),V=VC(t),[L,Y]=m.useState(!t),G=m.useRef(null);m.useImperativeHandle(e,()=>R,[R]),Hr&&!V&&t&&(G.current=Ua(W==null?void 0:W.document)),t&&L&&Y(!1);const q=ar(()=>{if(R.add(),ee.current=zn(document,"keydown",U),me.current=zn(document,"focus",()=>setTimeout(Z),!0),O&&O(),y){var oe,qs;const fr=Ua((oe=(qs=R.dialog)==null?void 0:qs.ownerDocument)!=null?oe:W==null?void 0:W.document);R.dialog&&fr&&!Yc(R.dialog,fr)&&(G.current=fr,R.dialog.focus())}}),Q=ar(()=>{if(R.remove(),ee.current==null||ee.current(),me.current==null||me.current(),b){var oe;(oe=G.current)==null||oe.focus==null||oe.focus(x),G.current=null}});m.useEffect(()=>{!t||!M||q()},[t,M,q]),m.useEffect(()=>{L&&Q()},[L,Q]),lN(()=>{Q()});const Z=ar(()=>{if(!v||!F()||!R.isTopModal())return;const oe=Ua(W==null?void 0:W.document);R.dialog&&oe&&!Yc(R.dialog,oe)&&R.dialog.focus()}),ze=ar(oe=>{oe.target===oe.currentTarget&&(d==null||d(oe),l===!0&&S())}),U=ar(oe=>{o&&PC(oe)&&R.isTopModal()&&(u==null||u(oe),oe.defaultPrevented||S())}),me=m.useRef(),ee=m.useRef(),De=(...oe)=>{Y(!0),D==null||D(...oe)};if(!M)return null;const it=Object.assign({role:n,ref:R.setDialogRef,"aria-modal":n==="dialog"?!0:void 0},z,{style:i,className:a,tabIndex:-1});let Pe=w?w(it):s.jsx("div",Object.assign({},it,{children:m.cloneElement(c,{role:"document"})}));Pe=ed(h,p,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!t,onExit:C,onExiting:k,onExited:De,onEnter:P,onEntering:T,onEntered:A,children:Pe});let ye=null;return l&&(ye=j({ref:R.setBackdropRef,onClick:ze}),ye=ed(f,g,{in:!!t,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:ye})),s.jsx(s.Fragment,{children:Rr.createPortal(s.jsxs(s.Fragment,{children:[ye,Pe]}),M)})});Um.displayName="Modal";const jN=Object.assign(Um,{Manager:Gi});function CN(r,e){return r.classList?r.classList.contains(e):(" "+(r.className.baseVal||r.className)+" ").indexOf(" "+e+" ")!==-1}function NN(r,e){r.classList?r.classList.add(e):CN(r,e)||(typeof r.className=="string"?r.className=r.className+" "+e:r.setAttribute("class",(r.className&&r.className.baseVal||"")+" "+e))}function td(r,e){return r.replace(new RegExp("(^|\\s)"+e+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function IN(r,e){r.classList?r.classList.remove(e):typeof r.className=="string"?r.className=td(r.className,e):r.setAttribute("class",td(r.className&&r.className.baseVal||"",e))}const Tr={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class TN extends Gi{adjustAndStore(e,t,n){const a=t.style[e];t.dataset[e]=a,dr(t,{[e]:`${parseFloat(dr(t,e))+n}px`})}restore(e,t){const n=t.dataset[e];n!==void 0&&(delete t.dataset[e],dr(t,{[e]:n}))}setContainerStyle(e){super.setContainerStyle(e);const t=this.getElement();if(NN(t,"modal-open"),!e.scrollBarWidth)return;const n=this.isRTL?"paddingLeft":"paddingRight",a=this.isRTL?"marginLeft":"marginRight";Ir(t,Tr.FIXED_CONTENT).forEach(i=>this.adjustAndStore(n,i,e.scrollBarWidth)),Ir(t,Tr.STICKY_CONTENT).forEach(i=>this.adjustAndStore(a,i,-e.scrollBarWidth)),Ir(t,Tr.NAVBAR_TOGGLER).forEach(i=>this.adjustAndStore(a,i,e.scrollBarWidth))}removeContainerStyle(e){super.removeContainerStyle(e);const t=this.getElement();IN(t,"modal-open");const n=this.isRTL?"paddingLeft":"paddingRight",a=this.isRTL?"marginLeft":"marginRight";Ir(t,Tr.FIXED_CONTENT).forEach(i=>this.restore(n,i)),Ir(t,Tr.STICKY_CONTENT).forEach(i=>this.restore(a,i)),Ir(t,Tr.NAVBAR_TOGGLER).forEach(i=>this.restore(a,i))}}let Wa;function EN(r){return Wa||(Wa=new TN(r)),Wa}const Hm=m.forwardRef((i,a)=>{var c=i,{className:r,bsPrefix:e,as:t="div"}=c,n=Be(c,["className","bsPrefix","as"]);return e=pr(e,"modal-body"),s.jsx(t,se({ref:a,className:Je(r,e)},n))});Hm.displayName="ModalBody";const Vm=m.createContext({onHide(){}}),Ki=m.forwardRef((u,d)=>{var h=u,{bsPrefix:r,className:e,contentClassName:t,centered:n,size:a,fullscreen:i,children:c,scrollable:l}=h,o=Be(h,["bsPrefix","className","contentClassName","centered","size","fullscreen","children","scrollable"]);r=pr(r,"modal");const p=`${r}-dialog`,f=typeof i=="string"?`${r}-fullscreen-${i}`:`${r}-fullscreen`;return s.jsx("div",_e(se({},o),{ref:d,className:Je(p,e,a&&`${r}-${a}`,n&&`${p}-centered`,l&&`${p}-scrollable`,i&&f),children:s.jsx("div",{className:Je(`${r}-content`,t),children:c})}))});Ki.displayName="ModalDialog";const Wm=m.forwardRef((i,a)=>{var c=i,{className:r,bsPrefix:e,as:t="div"}=c,n=Be(c,["className","bsPrefix","as"]);return e=pr(e,"modal-footer"),s.jsx(t,se({ref:a,className:Je(r,e)},n))});Wm.displayName="ModalFooter";const Gm=m.forwardRef((l,c)=>{var o=l,{closeLabel:r="Close",closeVariant:e,closeButton:t=!1,onHide:n,children:a}=o,i=Be(o,["closeLabel","closeVariant","closeButton","onHide","children"]);const d=m.useContext(Vm),u=_i(()=>{d==null||d.onHide(),n==null||n()});return s.jsxs("div",_e(se({ref:c},i),{children:[a,t&&s.jsx(Ui,{"aria-label":r,variant:e,onClick:u})]}))});Gm.displayName="AbstractModalHeader";const Km=m.forwardRef((c,i)=>{var l=c,{bsPrefix:r,className:e,closeLabel:t="Close",closeButton:n=!1}=l,a=Be(l,["bsPrefix","className","closeLabel","closeButton"]);return r=pr(r,"modal-header"),s.jsx(Gm,_e(se({ref:i},a),{className:Je(e,r),closeLabel:t,closeButton:n}))});Km.displayName="ModalHeader";const kN=qC("h4"),Qm=m.forwardRef((i,a)=>{var c=i,{className:r,bsPrefix:e,as:t=kN}=c,n=Be(c,["className","bsPrefix","as"]);return e=pr(e,"modal-title"),s.jsx(t,se({ref:a,className:Je(r,e)},n))});Qm.displayName="ModalTitle";function DN(r){return s.jsx(qi,_e(se({},r),{timeout:null}))}function PN(r){return s.jsx(qi,_e(se({},r),{timeout:null}))}const Ym=m.forwardRef((M,W)=>{var R=M,{bsPrefix:r,className:e,style:t,dialogClassName:n,contentClassName:a,children:i,dialogAs:c=Ki,"data-bs-theme":l,"aria-labelledby":o,"aria-describedby":d,"aria-label":u,show:h=!1,animation:p=!0,backdrop:f=!0,keyboard:g=!0,onEscapeKeyDown:y,onShow:v,onHide:b,container:x,autoFocus:w=!0,enforceFocus:j=!0,restoreFocus:I=!0,restoreFocusOptions:E,onEntered:O,onExit:S,onExiting:C,onEnter:D,onEntering:k,onExited:P,backdropClassName:T,manager:A}=R,z=Be(R,["bsPrefix","className","style","dialogClassName","contentClassName","children","dialogAs","data-bs-theme","aria-labelledby","aria-describedby","aria-label","show","animation","backdrop","keyboard","onEscapeKeyDown","onShow","onHide","container","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","onEntered","onExit","onExiting","onEnter","onEntering","onExited","backdropClassName","manager"]);const[F,V]=m.useState({}),[L,Y]=m.useState(!1),G=m.useRef(!1),q=m.useRef(!1),Q=m.useRef(null),[Z,ze]=iN(),U=Lm(W,ze),me=_i(b),ee=wC();r=pr(r,"modal");const De=m.useMemo(()=>({onHide:me}),[me]);function it(){return A||EN({isRTL:ee})}function Pe(re){if(!Hr)return;const gr=it().getScrollbarWidth()>0,Xi=re.scrollHeight>Zn(re).documentElement.clientHeight;V({paddingRight:gr&&!Xi?Xc():void 0,paddingLeft:!gr&&Xi?Xc():void 0})}const ye=_i(()=>{Z&&Pe(Z.dialog)});tN(()=>{bi(window,"resize",ye),Q.current==null||Q.current()});const oe=()=>{G.current=!0},qs=re=>{G.current&&Z&&re.target===Z.dialog&&(q.current=!0),G.current=!1},fr=()=>{Y(!0),Q.current=Fm(Z.dialog,()=>{Y(!1)})},Nh=re=>{re.target===re.currentTarget&&fr()},Ih=re=>{if(f==="static"){Nh(re);return}if(q.current||re.target!==re.currentTarget){q.current=!1;return}b==null||b()},Th=re=>{g?y==null||y(re):(re.preventDefault(),f==="static"&&fr())},Eh=(re,gr)=>{re&&Pe(re),D==null||D(re,gr)},kh=re=>{Q.current==null||Q.current(),S==null||S(re)},Dh=(re,gr)=>{k==null||k(re,gr),Mm(window,"resize",ye)},Ph=re=>{re&&(re.style.display=""),P==null||P(re),bi(window,"resize",ye)},Oh=m.useCallback(re=>s.jsx("div",_e(se({},re),{className:Je(`${r}-backdrop`,T,!p&&"show")})),[p,T,r]),Ji=se(se({},t),F);Ji.display="block";const Rh=re=>s.jsx("div",_e(se({role:"dialog"},re),{style:Ji,className:Je(e,r,L&&`${r}-static`,!p&&"show"),onClick:f?Ih:void 0,onMouseUp:qs,"data-bs-theme":l,"aria-label":u,"aria-labelledby":o,"aria-describedby":d,children:s.jsx(c,_e(se({},z),{onMouseDown:oe,className:n,contentClassName:a,children:i}))}));return s.jsx(Vm.Provider,{value:De,children:s.jsx(jN,{show:h,ref:U,backdrop:f,container:x,keyboard:!0,autoFocus:w,enforceFocus:j,restoreFocus:I,restoreFocusOptions:E,onEscapeKeyDown:Th,onShow:v,onHide:b,onEnter:Eh,onEntering:Dh,onEntered:O,onExit:kh,onExiting:C,onExited:Ph,manager:it(),transition:p?DN:void 0,backdropTransition:p?PN:void 0,renderBackdrop:Oh,renderDialog:Rh})})});Ym.displayName="Modal";const ke=Object.assign(Ym,{Body:Hm,Header:Km,Title:Qm,Footer:Wm,Dialog:Ki,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),ON=()=>s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",role:"banner","aria-label":"Inventory management header",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Inventory Management"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage your inventory items and equipment"})]}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Item scanner controls",children:[s.jsx("span",{className:"text-gray-600",children:"Item Scanner"}),s.jsx(wu,{to:"/inventory/scanner",children:s.jsx(Hi,{variant:"success",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1","aria-label":"Scan new inventory item using barcode scanner",tabIndex:0,children:"Inventory Scanner"})})]})})]}),RN=()=>s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})});var AN=Object.defineProperty,$N=Object.defineProperties,MN=Object.getOwnPropertyDescriptors,rd=Object.getOwnPropertySymbols,FN=Object.prototype.hasOwnProperty,LN=Object.prototype.propertyIsEnumerable,sd=(r,e,t)=>e in r?AN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zN=(r,e)=>{for(var t in e||(e={}))FN.call(e,t)&&sd(r,t,e[t]);if(rd)for(var t of rd(e))LN.call(e,t)&&sd(r,t,e[t]);return r},BN=(r,e)=>$N(r,MN(e));const nd=()=>{Qw();const r=cr(),{tools:e,supplies:t,equipment:n,officeHardware:a}=r,i=[...e,...t,...n,...a],c=i.map(l=>{var o;return BN(zN({},l),{category:(o=l.category)!=null?o:"uncategorized"})});return{allItems:i,itemsWithCategory:c,tools:e,supplies:t,equipment:n,officeHardware:a,totalUniqueItems:e.length+t.length+n.length+a.length,refreshData:r.refreshData,getAllItems:()=>i,getItemsByCategory:l=>{switch(l){case"tools":return e;case"supplies":return t;case"equipment":return n;case"officeHardware":return a;default:return[]}}}};var qN=Object.defineProperty,ad=Object.getOwnPropertySymbols,UN=Object.prototype.hasOwnProperty,HN=Object.prototype.propertyIsEnumerable,id=(r,e,t)=>e in r?qN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,od=(r,e)=>{for(var t in e||(e={}))UN.call(e,t)&&id(r,t,e[t]);if(ad)for(var t of ad(e))HN.call(e,t)&&id(r,t,e[t]);return r},VN=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const WN=r=>({items:[],categories:[],selectedItems:[],isLoading:!1,isCategoriesLoading:!1,setItems:e=>r({items:e,inventoryItems:e}),setCategories:e=>r({categories:e}),addItem:e=>r(t=>({items:[...t.items,e],inventoryItems:[...t.items,e]})),updateItem:(e,t)=>r(n=>{const a=n.items.map(i=>i.id===e?od(od({},i),t):i);return{items:a,inventoryItems:a}}),deleteItem:e=>r(t=>{const n=t.items.filter(a=>a.id!==e);return{items:n,inventoryItems:n}}),addCategory:e=>r(t=>({categories:[...t.categories,e]})),removeCategory:e=>r(t=>({categories:t.categories.filter(n=>n!==e)})),setSelectedItems:e=>r({selectedItems:e}),setLoading:e=>r({isLoading:e}),setCategoriesLoading:e=>r({isCategoriesLoading:e}),setInventoryLoading:e=>r({isLoading:e}),refreshInventoryData:()=>VN(null,null,function*(){console.log("Refreshing inventory data...")}),getFilteredItems:()=>[],getUniqueCategories:()=>[],inventoryItems:[]});var GN=Object.defineProperty,KN=Object.defineProperties,QN=Object.getOwnPropertyDescriptors,ld=Object.getOwnPropertySymbols,YN=Object.prototype.hasOwnProperty,JN=Object.prototype.propertyIsEnumerable,cd=(r,e,t)=>e in r?GN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,XN=(r,e)=>{for(var t in e||(e={}))YN.call(e,t)&&cd(r,t,e[t]);if(ld)for(var t of ld(e))JN.call(e,t)&&cd(r,t,e[t]);return r},ZN=(r,e)=>KN(r,QN(e));const eI=r=>({activeTab:"tools",showFilters:!1,showTrackedOnly:!1,showFavoritesOnly:!1,expandedSections:{general:!0,purchase:!1,maintenance:!1,usage:!1},showFiltersPanel:!1,showAnalytics:!0,showBulkActions:!1,mergeMode:!1,selectedItems:new Set,trackedItems:new Set,trackingData:new Map,setActiveTab:e=>r({activeTab:e}),setShowFilters:e=>r({showFilters:e}),setShowTrackedOnly:e=>r({showTrackedOnly:e}),setShowFavoritesOnly:e=>r({showFavoritesOnly:e}),setExpandedSections:e=>r({expandedSections:e}),toggleExpandedSection:e=>r(t=>({expandedSections:ZN(XN({},t.expandedSections),{[e]:!t.expandedSections[e]})})),setShowFiltersPanel:e=>r({showFiltersPanel:e}),setShowAnalytics:e=>r({showAnalytics:e}),setShowBulkActions:e=>r({showBulkActions:e}),toggleTrackedItem:(e,t)=>r(n=>{const a=new Set(n.trackedItems),i=new Map(n.trackingData);return a.has(e)?(a.delete(e),i.delete(e)):(a.add(e),i.set(e,{doctor:t,timestamp:new Date().toISOString()})),{trackedItems:a,trackingData:i}}),setTrackedItems:e=>r({trackedItems:e}),setTrackingData:e=>r({trackingData:e}),setMergeMode:e=>r({mergeMode:e,selectedItems:e?new Set:new Set}),toggleItemSelection:e=>r(t=>{const n=new Set(t.selectedItems);return n.has(e)?n.delete(e):n.add(e),{selectedItems:n}}),clearSelectedItems:()=>r({selectedItems:new Set}),selectAllItems:e=>r({selectedItems:new Set(e)})}),tI=r=>({showAddModal:!1,showTrackModal:!1,showUploadBarcodeModal:!1,showScanModal:!1,showDeleteModal:!1,itemToDelete:null,scanMode:null,scannedItems:[],setShowAddModal:e=>r({showAddModal:e}),setShowTrackModal:e=>r({showTrackModal:e}),setShowUploadBarcodeModal:e=>r({showUploadBarcodeModal:e}),setShowScanModal:e=>r({showScanModal:e}),setShowDeleteModal:e=>r({showDeleteModal:e}),setItemToDelete:e=>r({itemToDelete:e}),openDeleteModal:e=>r({showDeleteModal:!0,itemToDelete:e}),closeDeleteModal:()=>r({showDeleteModal:!1,itemToDelete:null}),setScanMode:e=>r({scanMode:e}),addScannedItem:e=>r(t=>({scannedItems:[...t.scannedItems,e]})),removeScannedItem:e=>r(t=>({scannedItems:t.scannedItems.filter(n=>n!==e)})),resetScannedItems:()=>r({scannedItems:[]}),openAddModal:()=>r({showAddModal:!0}),closeAddModal:()=>r({showAddModal:!1}),openTrackModal:()=>r({showTrackModal:!0}),closeTrackModal:()=>r({showTrackModal:!1}),openUploadBarcodeModal:()=>r({showUploadBarcodeModal:!0}),closeUploadBarcodeModal:()=>r({showUploadBarcodeModal:!1}),toggleUploadBarcodeModal:()=>r(e=>({showUploadBarcodeModal:!e.showUploadBarcodeModal})),openScanModal:()=>r({showScanModal:!0}),closeScanModal:()=>r({showScanModal:!1})}),rI=()=>{try{const r=localStorage.getItem("cliniio-favorites");return r?JSON.parse(r):[]}catch(r){return console.warn("Failed to load favorites from localStorage:",r),[]}},dd=r=>{try{localStorage.setItem("cliniio-favorites",JSON.stringify(r))}catch(e){console.warn("Failed to save favorites to localStorage:",e)}},sI=r=>({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",favorites:rI(),showFavoritesOnly:!1,sortField:"name",sortDirection:"asc",setSearchQuery:e=>r({searchQuery:e,searchTerm:e}),setSearchTerm:e=>r({searchTerm:e,searchQuery:e}),setCategoryFilter:e=>r({categoryFilter:e}),setLocationFilter:e=>r({locationFilter:e}),setStatusFilter:e=>r({statusFilter:e}),setActiveFilter:e=>r({activeFilter:e}),setFavorites:e=>{r({favorites:e}),dd(e)},toggleFavorite:e=>r(t=>{const n=t.favorites.includes(e)?t.favorites.filter(a=>a!==e):[...t.favorites,e];return dd(n),{favorites:n}}),setShowFavoritesOnly:e=>r({showFavoritesOnly:e}),setSortField:e=>r({sortField:e}),setSortDirection:e=>r({sortDirection:e}),clearFilters:()=>r({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:""}),resetFilters:()=>r({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",sortField:"name",sortDirection:"asc",showFavoritesOnly:!1}),clearSearch:()=>r({searchQuery:"",searchTerm:""})});var nI=Object.defineProperty,aI=Object.defineProperties,iI=Object.getOwnPropertyDescriptors,ud=Object.getOwnPropertySymbols,oI=Object.prototype.hasOwnProperty,lI=Object.prototype.propertyIsEnumerable,md=(r,e,t)=>e in r?nI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ga=(r,e)=>{for(var t in e||(e={}))oI.call(e,t)&&md(r,t,e[t]);if(ud)for(var t of ud(e))lI.call(e,t)&&md(r,t,e[t]);return r},cI=(r,e)=>aI(r,iI(e));function hd(){return{id:"",itemName:"",category:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:0,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const dI=(r,e)=>({formData:hd(),isEditMode:!1,isDirty:!1,isCloned:!1,setFormData:t=>r({formData:t,isDirty:!1}),mergeFormData:t=>{console.log("ðŸ” mergeFormData called with:",t),r(n=>({formData:Ga(Ga({},n.formData),t),isDirty:!0}))},updateField:(t,n)=>r(a=>({formData:cI(Ga({},a.formData),{[t]:n}),isDirty:!0})),resetForm:()=>r({formData:hd(),isEditMode:!1,isDirty:!1,isCloned:!1}),setEditMode:t=>r({isEditMode:t}),setIsCloned:t=>r({isCloned:t}),markAsDirty:()=>r({isDirty:!0}),markAsClean:()=>r({isDirty:!1}),openEditModal:t=>{var n;const{setFormData:a,setEditMode:i}=e(),c={id:t.id,itemName:t.name||t.item||"",category:t.category||"",location:t.location||"",status:t.status||"",quantity:t.quantity||1,unitCost:t.unit_cost||0,minimumQuantity:t.reorder_point||0,maximumQuantity:((n=t.data)==null?void 0:n.maximumQuantity)||0,supplier:t.supplier||"",barcode:t.barcode||"",sku:t.sku||"",description:t.description||"",notes:t.notes||"",updated_at:t.updated_at||new Date().toISOString(),createdAt:t.created_at||new Date().toISOString()};a(c),i(!0)},closeEditModal:()=>{const{resetForm:t}=e();t()}}),uI=r=>({currentPage:1,itemsPerPage:10,totalItems:0,setCurrentPage:e=>r({currentPage:e}),setItemsPerPage:e=>r({itemsPerPage:e,currentPage:1}),setTotalItems:e=>r({totalItems:e}),nextPage:()=>r(e=>{const t=Math.ceil(e.totalItems/e.itemsPerPage);return{currentPage:Math.min(e.currentPage+1,t)}}),previousPage:()=>r(e=>({currentPage:Math.max(e.currentPage-1,1)})),goToPage:e=>r(t=>{const n=Math.ceil(t.totalItems/t.itemsPerPage);return{currentPage:Math.max(1,Math.min(e,n))}}),resetPagination:()=>r({currentPage:1}),get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)},get startIndex(){return(this.currentPage-1)*this.itemsPerPage},get endIndex(){return Math.min(this.startIndex+this.itemsPerPage,this.totalItems)},get pagination(){return{currentPage:this.currentPage,pageSize:this.itemsPerPage}}});var mI=Object.defineProperty,pd=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,pI=Object.prototype.propertyIsEnumerable,fd=(r,e,t)=>e in r?mI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fI=(r,e)=>{for(var t in e||(e={}))hI.call(e,t)&&fd(r,t,e[t]);if(pd)for(var t of pd(e))pI.call(e,t)&&fd(r,t,e[t]);return r};const gI=r=>({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1,setAnalyticsData:e=>r({analyticsData:e}),setLoadingAnalytics:e=>r({isLoadingAnalytics:e}),updateAnalytics:()=>{r(()=>({isLoadingAnalytics:!0})),setTimeout(()=>{r(e=>({isLoadingAnalytics:!1,analyticsData:fI({},e.analyticsData)}))},1e3)},resetAnalytics:()=>r({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1})});var yI=Object.defineProperty,gd=Object.getOwnPropertySymbols,vI=Object.prototype.hasOwnProperty,xI=Object.prototype.propertyIsEnumerable,yd=(r,e,t)=>e in r?yI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yt=(r,e)=>{for(var t in e||(e={}))vI.call(e,t)&&yd(r,t,e[t]);if(gd)for(var t of gd(e))xI.call(e,t)&&yd(r,t,e[t]);return r};const bI=Nt()((...r)=>Yt(Yt(Yt(Yt(Yt(Yt(Yt({},WN(...r)),eI(...r)),tI(...r)),sI(...r)),dI(...r)),uI(...r)),gI(...r))),ft=()=>bI();function _I({scanMode:r,scannedItems:e,currentScannedItemIndex:t,setCurrentScannedItemIndex:n,resetScannedItems:a,handleCloseAddModal:i,handleOpenAddItemModalWithBarcode:c}){const l=m.useCallback(()=>{if(r==="add"&&e.length>0){const d=t+1;d<e.length?(n(d),c(e[d])):(n(0),a())}},[r,e,t,n,a,i,c]),o=m.useCallback(()=>{if(r==="add"&&e.length>0){const d=e[t],u=d.split("-"),h=u.length>=3?u.slice(2).join("-"):d;return{current:t+1,total:e.length,currentItemName:h}}},[r,e,t]);return{handleAddItemModalClosed:l,getProgressInfo:o}}const wI=r=>{var e;if(!r)return null;const t=r.split("-");if(t.length>=3){const n=((e=t[0])==null?void 0:e.toUpperCase())||"",a=t[1]||"",i=t.slice(2).join("-");let c="tools";if(n==="TOOL")c="tools";else if(n==="SUPPLY")c="supplies";else if(n==="EQUIP")c="equipment";else if(n==="HARDWARE")c="officeHardware";else if(n==="INV"){const l=i.toLowerCase();l.includes("scissors")||l.includes("forceps")||l.includes("scalpel")?c="tools":l.includes("bandage")||l.includes("gauze")||l.includes("tape")?c="supplies":l.includes("monitor")||l.includes("machine")||l.includes("device")?c="equipment":c="tools"}return{itemId:a,itemName:i,category:c}}return r.length>0?{itemId:r||"",itemName:r||"",category:"tools"}:null},Jm=r=>{if(!r)return{item:"",category:"",toolId:"",location:"",cost:0,p2Status:"clean",barcode:""};const e=wI(r);return e?{item:e.itemName,category:e.category,toolId:e.itemId,location:"",cost:0,p2Status:"clean",barcode:r}:{item:r,category:"tools",toolId:r,location:"",cost:0,p2Status:"clean",barcode:r}},Xm=r=>{const e=Jm(r);return{itemName:e.item,category:e.category,id:e.toolId,location:e.location,purchaseDate:"",vendor:"",cost:e.cost.toString(),warranty:"",maintenanceSchedule:"",lastServiced:"",nextDue:"",serviceProvider:"",assignedTo:"",status:e.p2Status,quantity:"1",notes:"",barcode:e.barcode}},Zm=r=>({id:r.id,itemName:r.itemName,category:r.category,location:r.location,status:r.status,quantity:parseInt(r.quantity)||1,unitCost:parseFloat(r.cost)||0,minimumQuantity:0,maximumQuantity:999,supplier:r.vendor,barcode:r.barcode,sku:"",description:"",notes:r.notes,updated_at:new Date().toISOString(),createdAt:r.purchaseDate||new Date().toISOString()}),SI=r=>({id:r.toolId,itemName:r.item,category:r.category,location:r.location,status:r.p2Status,quantity:1,unitCost:r.cost,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:r.barcode,sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}),jI=()=>{const{scanMode:r,scannedItems:e,setScanMode:t,resetScannedItems:n,setShowScanModal:a,formData:i,setFormData:c,isEditMode:l}=ft(),[o,d]=m.useState(0),u=m.useCallback((f,g)=>{const y=Jm(g),v=SI(y);c(v),f()},[c]),{getProgressInfo:h}=_I({scanMode:r,scannedItems:e,currentScannedItemIndex:o,setCurrentScannedItemIndex:d,resetScannedItems:n,handleCloseAddModal:()=>{},handleOpenAddItemModalWithBarcode:f=>u(()=>{},f)}),p=m.useCallback(()=>{t(null),n(),a(!0)},[t,n,a]);return{scanMode:r,scannedItems:e,currentScannedItemIndex:o,storeFormData:i,isEditMode:l,handleScanClick:p,handleOpenAddItemModalWithBarcode:u,getProgressInfo:h,setFormData:c,setScanMode:t,resetScannedItems:n,setShowScanModal:a}};function CI(){const r=m.useRef(null),e=m.useRef(new Set),[t,n]=m.useState(!1),a=m.useRef(!1);m.useEffect(()=>{if(!a.current)try{console.log("ðŸ”” Setting up real-time inventory subscription via useInventoryRealtimeUpdates");const o=ht.subscribeToChanges();return r.current=o,n(!0),a.current=!0,()=>{r.current&&typeof r.current=="function"&&(r.current(),r.current=null),n(!1),a.current=!1}}catch(o){console.error("âŒ Failed to set up real-time subscription in useInventoryRealtimeUpdates:",o),n(!1),a.current=!1}},[]);const i=m.useCallback(o=>(e.current.add(o),()=>{e.current.delete(o)}),[]),c=m.useCallback(o=>{e.current.delete(o)},[]),l=m.useCallback(()=>{e.current.forEach(o=>{try{o()}catch(d){console.error("Error in refresh callback:",d)}})},[]);return{registerRefreshCallback:i,unregisterRefreshCallback:c,triggerRefresh:l,isSubscribed:t}}function NI({openAddModal:r,closeAddModal:e,setEditMode:t,resetForm:n,setExpandedSections:a,setFormData:i}){const c=m.useCallback(()=>{r(),t(!1),a(no())},[r,t,a]),l=m.useCallback(()=>{e(),a(no())},[e,n,a]),o=m.useCallback(d=>{let u;const h=d.data;h!=null&&h.toolId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{toolId:h.toolId,p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:h!=null&&h.supplyId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{supplyId:h.supplyId,expiration:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:h!=null&&h.equipmentId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{equipmentId:h.equipmentId,lastServiced:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:h!=null&&h.hardwareId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{hardwareId:h.hardwareId,warranty:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{toolId:"",p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null},i(lp(u)),t(!0),r()},[i,t,r]);return{handleShowAddModal:c,handleCloseAddModal:l,handleEditClick:o}}const II=({expandedSections:r,setExpandedSections:e,mergeFormData:t})=>({handleFormChangeWrapper:(a,i)=>{if(console.log("ðŸ›  handleFormChangeWrapper invoked. Field:",a,"Value:",i,"mergeFormData type:",typeof t),typeof t!="function"){console.error("âŒ mergeFormData is not a function inside useInventoryFormHandlers!");return}t(a==="category"?{category:i}:{[a]:i})},handleToggleSection:a=>{e(r.includes(a)?r.filter(i=>i!==a):[...r,a])}});function TI(r,e){return{handleToggleFavorite:m.useCallback(n=>{const a=cp(new Set(r),n);e(Array.from(a))},[r,e])}}const EI=()=>{const r=cr(),e=m.useMemo(()=>[...r.tools,...r.supplies,...r.equipment,...r.officeHardware],[r.tools,r.supplies,r.equipment,r.officeHardware]);return{getAllItems:()=>e,getItemsByCategory:t=>e.filter(a=>{var i;return((i=a.category)==null?void 0:i.toLowerCase())===t.toLowerCase()}),getFilteredItems:r.getFilteredData,getCategories:r.getCategories,fetchData:r.refreshData,inventoryData:e}},kI=()=>{const{showAddModal:r,showTrackModal:e,showUploadBarcodeModal:t,showScanModal:n,openAddModal:a,closeAddModal:i,openTrackModal:c,closeTrackModal:l,openUploadBarcodeModal:o,closeUploadBarcodeModal:d,openScanModal:u,closeScanModal:h,formData:p,setFormData:f,mergeFormData:g,updateField:y,isEditMode:v,setEditMode:b,expandedSections:x,setExpandedSections:w,resetForm:j}=ft(),I=m.useCallback(()=>{b(!1),j(),a()},[b,j,a]),E=m.useCallback(A=>{b(!0),f(A),a()},[b,f,a]),O=m.useCallback(()=>{i(),b(!1),j()},[i,b,j]),S=m.useCallback(()=>{c()},[c]),C=m.useCallback(()=>{l()},[l]),D=m.useCallback(()=>{o()},[o]),k=m.useCallback(()=>{d()},[d]),P=m.useCallback(()=>{u()},[u]),T=m.useCallback(()=>{h()},[h]);return{showAddModal:r,showTrackModal:e,showUploadBarcodeModal:t,showScanModal:n,formData:p,isEditMode:v,expandedSections:x,openAddModal:I,openEditModal:E,openTrackModal:S,openUploadBarcodeModal:D,openScanModal:P,closeAddModal:O,closeTrackModal:C,closeUploadBarcodeModal:k,closeScanModal:T,setFormData:f,mergeFormData:g,updateField:y,setExpandedSections:w}};var DI=Object.defineProperty,PI=Object.defineProperties,OI=Object.getOwnPropertyDescriptors,vd=Object.getOwnPropertySymbols,RI=Object.prototype.hasOwnProperty,AI=Object.prototype.propertyIsEnumerable,xd=(r,e,t)=>e in r?DI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fs=(r,e)=>{for(var t in e||(e={}))RI.call(e,t)&&xd(r,t,e[t]);if(vd)for(var t of vd(e))AI.call(e,t)&&xd(r,t,e[t]);return r},gs=(r,e)=>PI(r,OI(e)),$I=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const eh=()=>{const r=kI(),{refreshData:e}=cr(),{searchQuery:t,setSearchQuery:n,favorites:a,setFavorites:i,trackedItems:c,trackingData:l,toggleTrackedItem:o}=ft(),d=m.useCallback((S,C)=>{console.log(`ðŸ”„ Form field changed: ${S} = "${C}"`),console.log("ðŸ“ Current form data before update:",r.formData),console.log("ðŸ” Calling updateField with:",S,C),r.updateField(S,C),console.log("ðŸ“ Form data after update should be updated in store")},[r]),u=m.useCallback(S=>{r.setExpandedSections(gs(fs({},r.expandedSections),{[S]:!r.expandedSections[S]}))},[r]),h=m.useCallback(S=>{const D=(P=>{if(!P)return 0;if(typeof P=="number")return P;const T=P.toString().replace(/[$,\s]/g,""),A=parseFloat(T);return isNaN(A)?0:A})(S.unitCost);console.log(`ðŸ’° Cost parsing: "${S.unitCost}" -> ${D}`);const k={name:S.itemName||null,category:S.category||null,location:S.location||void 0,status:S.status||void 0,quantity:S.quantity||1,unit_cost:D,facility_id:"unknown",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,data:{warranty:S.warranty||null,notes:S.notes||null,purchaseDate:S.purchaseDate||null,supplier:S.supplier||null,manufacturer:S.manufacturer||null,expiry_date:S.expiry_date||null,assetTag:S.assetTag||null,brand:S.brand||null,model:S.model||null,serialNumber:S.serialNumber||null}};return console.log("ðŸ“¦ Converted item to save:",k),k},[]),p=m.useCallback(()=>$I(null,null,function*(){try{console.log("ðŸ”„ Starting save process..."),console.log("ðŸ“ Form data:",r.formData);const S=h(gs(fs({},r.formData),{name:r.formData.itemName,category:r.formData.category,quantity:r.formData.quantity,location:r.formData.location,manufacturer:r.formData.manufacturer,supplier:r.formData.supplier,expiry_date:r.formData.expiry_date}));if(console.log("ðŸ’¾ Item to save:",S),r.isEditMode){if(r.formData.id){console.log("âœï¸ Updating existing item...");const C=yield ht.updateItem(r.formData.id,S);if(console.log("âœ… Update response:",C),C.error)throw new Error(`Update failed: ${C.error}`);if(C.data){console.log("âœ… Item updated successfully:",C.data);const k=(P=>{var T,A,z,W,M,R;return{itemName:P.name||P.item||"",category:P.category||"",id:P.id||"",location:P.location||"",createdAt:((T=P.data)==null?void 0:T.purchaseDate)||new Date().toISOString(),supplier:P.supplier||"",unit_cost:P.unit_cost||0,notes:((A=P.data)==null?void 0:A.notes)||"",updated_at:((z=P.data)==null?void 0:z.lastServiced)||new Date().toISOString(),status:P.status||"",quantity:P.quantity||1,reorder_point:P.reorder_point||0,barcode:((W=P.data)==null?void 0:W.barcode)||"",sku:((M=P.data)==null?void 0:M.sku)||"",description:((R=P.data)==null?void 0:R.description)||"",unitCost:P.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3}})(C.data);r.setFormData(k)}else throw new Error("Update succeeded but no data returned")}}else{console.log("âž• Creating new item...");const C=yield ht.createItem(S);if(console.log("âœ… Create response:",C),C.error)throw new Error(`Create failed: ${C.error}`);if(!C.data)throw new Error("Create succeeded but no data returned")}console.log("âœ… Item saved successfully!"),console.log("ðŸ”„ Refreshing inventory data..."),yield e(),console.log("âœ… Inventory data refreshed!"),console.log("ðŸ§¹ Clearing analytics cache..."),ht.clearCache(),console.log("âœ… Analytics cache cleared!")}catch(S){console.error("âŒ Failed to save item:",S)}}),[r,h,e]),f=m.useCallback(()=>{},[]),g=m.useCallback(S=>{const C=new Set(a);C.has(S)?C.delete(S):C.add(S),i(Array.from(C))},[a,i]),y=m.useCallback((S,C)=>{o(S,C)},[o]),v=m.useCallback(S=>{n(S)},[n]),b=m.useCallback(S=>{const D=(k=>{var P,T,A,z,W,M;return{itemName:k.name||k.item||"",category:k.category||"",id:k.id||"",location:k.location||"",createdAt:((P=k.data)==null?void 0:P.purchaseDate)||new Date().toISOString(),supplier:k.supplier||"",unit_cost:k.unit_cost||0,notes:((T=k.data)==null?void 0:T.notes)||"",updated_at:((A=k.data)==null?void 0:A.lastServiced)||new Date().toISOString(),status:k.status||"",quantity:k.quantity||1,reorder_point:k.reorder_point||0,barcode:((z=k.data)==null?void 0:z.barcode)||"",sku:((W=k.data)==null?void 0:W.sku)||"",description:((M=k.data)==null?void 0:M.description)||"",unitCost:k.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3}})(S);r.openEditModal(D)},[r]),x=m.useCallback(()=>{r.openAddModal()},[r]),w=m.useCallback(S=>{console.log("ðŸ”„ Cloning item:",S);const C=convertItemToFormData(S),D=gs(fs({},C),{id:"",barcode:"",itemName:`${C.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("ðŸ“‹ Cloned form data:",D),r.setFormData(D),r.setEditMode(!1),r.openAddModal()},[r]),j=m.useCallback(()=>{console.log("ðŸ”„ Cloning current form data");const S=r.formData,C=gs(fs({},S),{id:"",barcode:"",sku:"",itemName:`${S.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("ðŸ“‹ Cloned form data:",C),r.closeAddModal(),r.setFormData(C),r.setEditMode(!1),r.setIsCloned(!0),r.openAddModal()},[r]),I=m.useCallback(()=>{r.openTrackModal()},[r]),E=m.useCallback(()=>{r.openUploadBarcodeModal()},[r]),O=m.useCallback(()=>{r.openScanModal()},[r]);return gs(fs({},r),{handleFormChange:d,toggleSection:u,handleSaveItem:p,handleDeleteItem:f,handleEditItem:b,handleAddItem:x,handleCloneItem:w,handleCloneCurrentForm:j,openAddModal:x,handleTrackItem:y,handleSearchChange:v,handleOpenTrackModal:I,handleOpenUploadBarcodeModal:E,handleOpenScanModal:O,toggleFavorite:g,searchQuery:t,favorites:a,trackedItems:c,trackingData:l})};var MI=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const th=()=>{const r=ft(),{formData:e,setFormData:t,isEditMode:n,setEditMode:a,favorites:i,setFavorites:c,expandedSections:l,setExpandedSections:o,openAddModal:d,closeAddModal:u,setActiveTab:h,showTrackedOnly:p,setShowTrackedOnly:f,showFavoritesOnly:g,setShowFavoritesOnly:y,searchQuery:v,setSearchQuery:b}=r,x=r.mergeFormData;typeof x!="function"&&console.error("âŒ mergeFormData is NOT a function! Store might not be wired correctly."),EI();const{handleToggleSection:w,handleFormChangeWrapper:j}=II({expandedSections:l,setExpandedSections:o,mergeFormData:x}),{handleToggleFavorite:I}=TI(i,c),{handleCloneItem:E}=eh(),{handleShowAddModal:O,handleCloseAddModal:S}=NI({openAddModal:d,closeAddModal:u,setEditMode:a,resetForm:()=>{},setExpandedSections:o,setFormData:t}),C=m.useCallback(R=>{var F,V;return((V=(F=ht.statusService).getStatusBadge)==null?void 0:V.call(F,R))||R},[]),D=m.useCallback(R=>{var F,V;return((V=(F=ht.statusService).getStatusText)==null?void 0:V.call(F,R))||R},[]),k=m.useCallback(R=>{var F,V,L;const Y=G=>h(G);(L=(V=(F=ht.categoryService).createCategoryChangeHandler)==null?void 0:V.call(F,Y))==null||L(R)},[h]),P=m.useCallback(()=>{var R,F,V;(V=(F=(R=ht.categoryService).createTrackedFilterHandler)==null?void 0:F.call(R,p,f))==null||V()},[p,f]),T=m.useCallback(()=>{var R,F,V;(V=(F=(R=ht.categoryService).createFavoritesFilterHandler)==null?void 0:F.call(R,g,y))==null||V()},[g,y]),A=m.useCallback(R=>b(R),[b]),z=m.useCallback(R=>{const F={itemName:R.name||R.item||"",category:R.category||"",id:R.id,location:R.location||"",createdAt:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.purchaseDate:null)||new Date().toISOString(),supplier:R.supplier||"",unit_cost:R.unit_cost||0,unitCost:R.unit_cost||0,notes:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.notes:null)||"",updated_at:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.lastServiced:null)||new Date().toISOString(),status:R.status||"",quantity:R.quantity||1,reorder_point:R.reorder_point||0,minimumQuantity:0,maximumQuantity:999,barcode:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.barcode:null)||"",sku:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.sku:null)||"",description:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.description:null)||""};t(F),a(!0),d()},[t,a,d]),W=m.useCallback(()=>MI(null,null,function*(){if(!e)return;const R={name:e.itemName||"",category:e.category||"",location:e.location||"",status:e.status||"active",quantity:e.quantity||0,unit_cost:e.unitCost||0,description:e.description||"",notes:e.notes||"",supplier:e.supplier||"",barcode:e.barcode||"",sku:e.sku||"",updated_at:new Date().toISOString()};try{n&&e.id?yield nt.handleUpdateItem(e.id,R,()=>console.log("Item updated successfully"),F=>console.error("Update failed:",F)):yield nt.handleCreateItem(R,()=>console.log("Item created successfully"),F=>console.error("Creation failed:",F)),S()}catch(F){console.error("âŒ Inventory save failed",F)}}),[e,n,S]),M=m.useMemo(()=>[],[]);return{showTrackedOnly:p,showFavoritesOnly:g,searchQuery:v,expandedSections:l,favorites:i,filteredTools:M,isEditMode:n,handleShowAddModal:O,handleCloseAddModal:S,handleEditItem:z,handleCloneItem:E,handleToggleTrackedFilter:P,handleToggleFavoritesFilter:T,onCategoryChange:k,setSearchTerm:A,handleSave:W,handleToggleSection:w,handleFormChangeWrapper:j,handleToggleFavorite:I,getStatusBadge:C,getStatusText:D}},FI=m.createContext(void 0),LI=r=>{const e=dp(),t="itemName"in r?r.itemName:r.name||r.item||"",n=r.category,a=r.id,i=r.location||"",c=r.unit_cost,l=typeof c=="number"?c.toString()||"0":c||"0",o=r.status||"";return{itemName:String(t||e.itemName||""),category:String(n||e.category||""),id:String(a||e.id||""),location:String(i||e.location||""),status:String(o||e.status),quantity:Number((r==null?void 0:r.quantity)||e.quantity),unitCost:Number(l),minimumQuantity:0,maximumQuantity:Number(e.maximumQuantity),supplier:String((r==null?void 0:r.supplier)||e.supplier||""),barcode:String((r==null?void 0:r.barcode)||e.barcode||""),sku:String((r==null?void 0:r.sku)||e.sku||""),description:String((r==null?void 0:r.description)||e.description||""),notes:String((r==null?void 0:r.notes)||e.notes||""),updated_at:String((r==null?void 0:r.updated_at)||e.updated_at||new Date().toISOString()),createdAt:String((r==null?void 0:r.createdAt)||e.createdAt||new Date().toISOString())}},bd={ADD_ITEM:{id:"add-item-modal",title:"Add New Item",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!0,className:"inventory-modal"},SCAN_ITEM:{id:"scan-item-modal",title:"Scan Items",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!1,className:"scan-modal"}},rh=[{id:"general",title:"General Information",defaultExpanded:!0,fields:[{name:"itemName",label:"Item Name",type:"text",required:!0,placeholder:"Enter item name"},{name:"category",label:"Category",type:"select",required:!0,options:[{value:"tools",label:"Tools"},{value:"supplies",label:"Supplies"},{value:"equipment",label:"Equipment"},{value:"officeHardware",label:"Office Hardware"}]},{name:"id",label:"ID / Serial #",type:"text",required:!0,placeholder:"Enter ID or serial number"},{name:"location",label:"Location",type:"location",required:!0}]},{id:"purchase",title:"Purchase Information",defaultExpanded:!1,fields:[{name:"purchaseDate",label:"Purchase Date",type:"date",required:!1},{name:"vendor",label:"Vendor",type:"text",required:!1,placeholder:"Enter vendor name"},{name:"unitCost",label:"Cost",type:"text",required:!0,placeholder:"Enter cost (e.g., $25.99, 15.50)"},{name:"warranty",label:"Warranty",type:"text",required:!1,placeholder:"Enter warranty information"}]},{id:"maintenance",title:"Maintenance Information",defaultExpanded:!1,fields:[{name:"maintenanceSchedule",label:"Maintenance Schedule",type:"text",required:!1,placeholder:"Enter maintenance schedule"},{name:"lastServiced",label:"Last Serviced",type:"date",required:!1},{name:"nextDue",label:"Next Due",type:"date",required:!1},{name:"serviceProvider",label:"Service Provider",type:"text",required:!1,placeholder:"Enter service provider"}]},{id:"usage",title:"Usage Information",defaultExpanded:!1,fields:[{name:"assignedTo",label:"Assigned To",type:"text",required:!1,placeholder:"Enter assigned person"},{name:"status",label:"Status",type:"select",required:!1,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"p2",label:"P2"},{value:"n/a",label:"N/A"}]},{name:"isP2Status",label:"P2 Tool",type:"select",required:!1,options:[{value:"false",label:"No"},{value:"true",label:"Yes"}]},{name:"quantity",label:"Quantity",type:"number",required:!0,placeholder:"Enter quantity",validation:{min:0}},{name:"notes",label:"Notes",type:"textarea",required:!1,placeholder:"Additional notes"}]}],zI=(r,e=!1)=>{const t={};for(const n of rh)for(const a of n.fields)if(!(a.name==="id"&&!e)&&(a.required&&!r[a.name]&&(t[a.name]=`${a.label} is required`),a.validation&&r[a.name])){const i=r[a.name];a.validation.min!==void 0&&Number(i)<a.validation.min&&(t[a.name]=`${a.label} must be at least ${a.validation.min}`),a.validation.max!==void 0&&Number(i)>a.validation.max&&(t[a.name]=`${a.label} must be at most ${a.validation.max}`),a.validation.pattern&&typeof i=="string"&&(new RegExp(a.validation.pattern).test(i)||(t[a.name]=a.validation.message||`${a.label} format is invalid`))}return t};var BI=Object.defineProperty,qI=Object.defineProperties,UI=Object.getOwnPropertyDescriptors,_d=Object.getOwnPropertySymbols,HI=Object.prototype.hasOwnProperty,VI=Object.prototype.propertyIsEnumerable,wd=(r,e,t)=>e in r?BI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_n=(r,e)=>{for(var t in e||(e={}))HI.call(e,t)&&wd(r,t,e[t]);if(_d)for(var t of _d(e))VI.call(e,t)&&wd(r,t,e[t]);return r},wn=(r,e)=>qI(r,UI(e));const WI=()=>{const[r,e]=m.useState({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1}),t=()=>{if(!navigator.geolocation){e(a=>wn(_n({},a),{error:"Geolocation is not supported by this browser.",isLoading:!1}));return}e(a=>wn(_n({},a),{isLoading:!0,error:null})),navigator.geolocation.getCurrentPosition(a=>{e({latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,error:null,isLoading:!1})},a=>{let i="Unknown error occurred";switch(a.code){case a.PERMISSION_DENIED:i="Location access denied. Please enable location services.";break;case a.POSITION_UNAVAILABLE:i="Location information unavailable.";break;case a.TIMEOUT:i="Location request timed out.";break}e(c=>wn(_n({},c),{error:i,isLoading:!1}))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},n=()=>{e({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1})};return wn(_n({},r),{getCurrentLocation:t,clearLocation:n})};var GI=Object.defineProperty,KI=Object.defineProperties,QI=Object.getOwnPropertyDescriptors,Sd=Object.getOwnPropertySymbols,YI=Object.prototype.hasOwnProperty,JI=Object.prototype.propertyIsEnumerable,jd=(r,e,t)=>e in r?GI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ka=(r,e)=>{for(var t in e||(e={}))YI.call(e,t)&&jd(r,t,e[t]);if(Sd)for(var t of Sd(e))JI.call(e,t)&&jd(r,t,e[t]);return r},Cd=(r,e)=>KI(r,QI(e));const Qi=Nt()(Xn((r,e)=>({rooms:[],addRoom:t=>{const n=Cd(Ka({},t),{id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});r(a=>({rooms:[...a.rooms,n]}))},updateRoom:(t,n)=>{r(a=>({rooms:a.rooms.map(i=>i.id===t?Cd(Ka(Ka({},i),n),{updatedAt:new Date().toISOString()}):i)}))},deleteRoom:t=>{r(n=>({rooms:n.rooms.filter(a=>a.id!==t)}))},getActiveRooms:()=>e().rooms.filter(t=>t.isActive),getRoomsByDepartment:t=>e().rooms.filter(n=>n.department===t&&n.isActive),getRoomByBarcode:t=>e().rooms.find(n=>n.barcode===t&&n.isActive)}),{name:"room-storage"})),XI=Object.freeze(Object.defineProperty({__proto__:null,useRoomStore:Qi},Symbol.toStringTag,{value:"Module"}));var ZI=Object.defineProperty,eT=Object.defineProperties,tT=Object.getOwnPropertyDescriptors,Nd=Object.getOwnPropertySymbols,rT=Object.prototype.hasOwnProperty,sT=Object.prototype.propertyIsEnumerable,Id=(r,e,t)=>e in r?ZI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nT=(r,e)=>{for(var t in e||(e={}))rT.call(e,t)&&Id(r,t,e[t]);if(Nd)for(var t of Nd(e))sT.call(e,t)&&Id(r,t,e[t]);return r},aT=(r,e)=>eT(r,tT(e));const iT=(r,e)=>{const n=r.latitude*Math.PI/180,a=e.latitude*Math.PI/180,i=(e.latitude-r.latitude)*Math.PI/180,c=(e.longitude-r.longitude)*Math.PI/180,l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n)*Math.cos(a)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},oT=(r,e,t=100)=>{const n=e.filter(c=>c.gpsCoordinates&&c.isActive);if(n.length===0)return null;let a=null,i=1/0;return n.forEach(c=>{if(c.gpsCoordinates){const l=iT(r,c.gpsCoordinates);l<i&&l<=t&&(i=l,a=aT(nT({},c),{distance:Math.round(l)}))}}),a},dP=r=>`${r.latitude.toFixed(6)}, ${r.longitude.toFixed(6)}`,lT=r=>r<1e3?`${Math.round(r)}m`:`${(r/1e3).toFixed(1)}km`,cT=({value:r,onChange:e,placeholder:t="Select location or use GPS",className:n=""})=>{const[a,i]=m.useState(!1),[c,l]=m.useState("room"),{getCurrentLocation:o,latitude:d,longitude:u,accuracy:h,isLoading:p}=WI(),{getActiveRooms:f}=Qi(),g=f(),[y,v]=m.useState(null),b=E=>{l(E),v(null),E==="gps"?o():E==="manual"&&e("")},x=E=>{e(E),i(!1)},w=()=>{if(d&&u){const E=oT({latitude:d,longitude:u},g,50);if(E)v({room:E,distance:E.distance||0}),e(E.name);else{const O=`GPS: ${d.toFixed(6)}, ${u.toFixed(6)}`;e(O),v(null)}i(!1)}},j=E=>{e(E.target.value)},I=()=>c==="gps"&&d&&u?`GPS: ${d.toFixed(6)}, ${u.toFixed(6)}`:r;return s.jsxs("div",{className:`relative ${n}`,children:[s.jsxs("div",{className:"flex flex-col space-y-2",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{type:"button",onClick:()=>b("room"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="room"?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[s.jsx(N,{path:li,size:.8,className:"inline mr-1"}),"Room"]}),s.jsxs("button",{type:"button",onClick:()=>b("gps"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="gps"?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[s.jsx(N,{path:Op,size:.8,className:"inline mr-1"}),"GPS"]}),s.jsx("button",{type:"button",onClick:()=>b("manual"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="manual"?"bg-purple-100 text-purple-700 border border-purple-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:"Manual"})]}),c==="room"&&s.jsxs("div",{className:"relative",children:[s.jsxs("button",{type:"button",onClick:()=>i(!a),className:"w-full px-3 py-2 text-left border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("span",{className:r?"text-gray-900":"text-gray-500",children:r||t}),s.jsx(N,{path:Fs,size:1,className:"float-right mt-1"})]}),a&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:g.length>0?g.map(E=>s.jsxs("button",{type:"button",onClick:()=>x(E.name),className:"w-full px-3 py-2 text-left hover:bg-gray-100 focus:outline-none focus:bg-gray-100",children:[s.jsx("div",{className:"font-medium text-gray-900",children:E.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[E.department," â€¢ ",E.floor]})]},E.id)):s.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No rooms available"})})]}),c==="gps"&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("button",{type:"button",onClick:o,disabled:p,className:"w-full px-3 py-2 text-sm bg-green-100 text-green-700 border border-green-300 rounded-md hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:p?"Getting location...":"Get Current Location"}),y&&s.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsxs("div",{className:"font-medium flex items-center",children:[s.jsx(N,{path:li,size:.8,className:"mr-1"}),"Smart Room Detection"]}),s.jsxs("div",{className:"mt-1",children:["Suggested:"," ",s.jsx("span",{className:"font-medium",children:y.room.name})]}),s.jsxs("div",{className:"text-xs text-blue-600",children:["Distance: ",lT(y.distance)," â€¢ Department: ",y.room.department," â€¢ Floor:"," ",y.room.floor]})]})}),d&&u&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsxs("div",{children:["Latitude: ",d.toFixed(6)]}),s.jsxs("div",{children:["Longitude: ",u.toFixed(6)]}),h&&s.jsxs("div",{children:["Accuracy: Â±",Math.round(h),"m"]})]}),s.jsx("button",{type:"button",onClick:w,className:"w-full px-3 py-2 text-sm bg-blue-100 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:y?"Use Suggested Room":"Use GPS Coordinates"})]})]}),c==="manual"&&s.jsx("input",{type:"text",value:r,onChange:j,placeholder:"Enter location manually",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r&&s.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Current location: ",I()]})]})},dT=({field:r,value:e,onChange:t})=>{var n,a,i;const c=l=>{t(l.target.value)};switch(r.type){case"text":return s.jsx("input",{type:"text",className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,value:e||"",onChange:c,required:r.required});case"number":return s.jsx("input",{type:"number",className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,value:e||"",onChange:c,required:r.required,min:(n=r.validation)==null?void 0:n.min,max:(a=r.validation)==null?void 0:a.max});case"date":return s.jsx("input",{type:"date",className:"form-control py-1 px-2 text-sm",value:e||"",onChange:c,required:r.required});case"select":return s.jsxs("select",{className:"form-select py-1 px-2 text-sm",value:e||"",onChange:c,required:r.required,children:[s.jsxs("option",{value:"",children:["Select ",r.label.toLowerCase()]}),(i=r.options)==null?void 0:i.map(l=>s.jsx("option",{value:l.value,children:l.label},l.value))]});case"textarea":return s.jsx("textarea",{className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,rows:2,value:e||"",onChange:c,required:r.required});case"location":return s.jsx(cT,{value:e||"",onChange:t});default:return null}},uT=({section:r,expanded:e,onToggle:t,formData:n,handleFormChange:a})=>s.jsxs("div",{className:"mb-3 border border-gray-200 rounded-lg",children:[s.jsxs("button",{type:"button",onClick:t,className:"w-full p-3 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors rounded-t-lg",children:[s.jsx("h3",{className:"text-base font-semibold text-gray-800",children:r.title}),s.jsx(N,{path:e?Fs:Ms,size:1,className:"text-gray-600"})]}),e&&s.jsx("div",{className:"p-3 border-t border-gray-200",children:s.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.fields.map(i=>i.name==="quantity"&&n.category==="tools"?null:s.jsxs("div",{children:[s.jsx("label",{htmlFor:`modal-${i.name}`,className:"block text-xs font-medium text-gray-700 mb-1",children:i.label}),s.jsx(dT,{field:i,value:n[i.name]||"",onChange:c=>a(i.name,c)})]},i.name))})})]}),Td=({modalConfig:r,show:e,onHide:t,formData:n,isEditMode:a,isCloned:i=!1,expandedSections:c,toggleSection:l,handleFormChange:o,onSave:d,onClone:u,progressInfo:h,sections:p,children:f})=>{const g=i?"Cloned Edit Item":a?"Edit Item":r.title;return s.jsxs(ke,{show:e,onHide:t,size:r.size,centered:r.centered,backdrop:r.backdrop,keyboard:r.keyboard,scrollable:r.scrollable,className:r.className,children:[s.jsx(ke.Header,{closeButton:!0,children:s.jsxs(ke.Title,{className:"flex items-center gap-3",children:[g,h&&s.jsxs("div",{className:"text-sm text-gray-500 font-normal",children:["(",h.current," of ",h.total,")"," ",h.currentItemName]})]})}),i&&s.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mx-4 mt-2",children:s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),s.jsxs("div",{className:"ml-3",children:[s.jsxs("p",{className:"text-sm text-yellow-700",children:[s.jsx("strong",{children:"Database Safety Alert:"})," Please update the following fields before saving:"]}),s.jsxs("ul",{className:"mt-2 text-sm text-yellow-700 list-disc list-inside",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"ID/Serial #"})," - Must be unique"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Barcode"})," - Must be unique"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"SKU"})," - Must be unique"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Item Name"}),' - Currently shows "(Copy)" suffix']})]})]})]})}),s.jsxs(ke.Body,{className:"max-h-[70vh] overflow-y-auto",children:[h&&s.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Processing scanned items: ",h.current," of"," ",h.total]}),s.jsxs("span",{className:"text-xs text-blue-600",children:[Math.round(h.current/h.total*100),"% complete"]})]}),s.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${h.current/h.total*100}%`}})})]}),s.jsx("div",{style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:s.jsxs("form",{id:"inventory-form",onSubmit:y=>{y.preventDefault(),d&&d()},children:[p==null?void 0:p.map(y=>s.jsx(uT,{section:y,expanded:c[y.id]||!1,onToggle:()=>l(y.id),formData:n,handleFormChange:o},y.id)),f]})})]}),s.jsxs(ke.Footer,{className:"pt-2",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:u,className:"bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Clone"}),s.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Cancel"})]}),d&&s.jsx("button",{type:"submit",form:"inventory-form",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:a?"Update Item":"Save Item"})]})]})};var mT=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const hT=({show:r,onClose:e})=>{const[t,n]=m.useState(null),[a,i]=m.useState(!1),[c,l]=m.useState(null),[o,d]=m.useState(!1),[u,h]=m.useState(null),[p,f]=m.useState(0),{activeTab:g}=ft(),y=()=>{const j=`${(()=>{const S="barcode,name,category,location,quantity,status,purchaseDate,vendor,cost,notes";switch(g){case"tools":return`${S},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,assignedTo`;case"supplies":return`${S},expirationDate,reorderPoint,minimumStock`;case"equipment":return`${S},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,serialNumber`;case"officeHardware":return`${S},warranty,serialNumber,assignedTo`;default:return S}})()}
123456789,${g.slice(0,-1)} Name,${g},Location,1,Available,2024-01-01,Vendor Name,100.00,Notes`,I=new Blob([j],{type:"text/csv"}),E=window.URL.createObjectURL(I),O=document.createElement("a");O.href=E,O.download=`${g}_template.csv`,document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(E)},v=w=>{var j;const I=(j=w.target.files)==null?void 0:j[0];I&&I.type==="text/csv"&&(n(I),l(null),d(!1))},b=(w,j)=>{var I;const E=[];return(!((I=w.data)!=null&&I.barcode)||String(w.data.barcode).trim()==="")&&E.push(`Row ${j}: Barcode is required`),(!w.name||String(w.name).trim()==="")&&E.push(`Row ${j}: Name is required`),w.quantity&&(isNaN(Number(w.quantity))||Number(w.quantity)<0)&&E.push(`Row ${j}: Quantity must be a positive number`),w.unit_cost&&(isNaN(parseFloat(String(w.unit_cost)))||parseFloat(String(w.unit_cost))<0)&&E.push(`Row ${j}: Cost must be a positive number`),E},x=()=>mT(null,null,function*(){if(t){i(!0),l(null),d(!1),h(null),f(0);try{const j=(yield t.text()).split(`
`),I=j[0].split(",").map(U=>U.trim()),E=I.findIndex(U=>U.toLowerCase().includes("barcode")),O=I.findIndex(U=>U.toLowerCase().includes("name")),S=I.findIndex(U=>U.toLowerCase().includes("category")),C=I.findIndex(U=>U.toLowerCase().includes("location")),D=I.findIndex(U=>U.toLowerCase().includes("quantity")),k=I.findIndex(U=>U.toLowerCase().includes("status")),P=I.findIndex(U=>U.toLowerCase().includes("purchasedate")),T=I.findIndex(U=>U.toLowerCase().includes("vendor")),A=I.findIndex(U=>U.toLowerCase().includes("cost")),z=I.findIndex(U=>U.toLowerCase().includes("warranty")),W=I.findIndex(U=>U.toLowerCase().includes("maintenanceschedule")),M=I.findIndex(U=>U.toLowerCase().includes("lastserviced")),R=I.findIndex(U=>U.toLowerCase().includes("nextdue")),F=I.findIndex(U=>U.toLowerCase().includes("serviceprovider")),V=I.findIndex(U=>U.toLowerCase().includes("assignedto")),L=I.findIndex(U=>U.toLowerCase().includes("notes"));if(E===-1||O===-1)throw new Error("CSV must contain barcode and name columns");const Y=[],G=[];for(let U=1;U<j.length;U++){const me=j[U].trim();if(!me)continue;const ee=me.split(",").map(Pe=>Pe.trim());if(ee.length<I.length)continue;const De={id:`csv-${Date.now()}-${U}`,name:ee[O],category:S!==-1?ee[S]:g,location:C!==-1?ee[C]:"Unknown",quantity:D!==-1&&parseInt(ee[D])||1,status:k!==-1?ee[k]:"Available",unit_cost:A!==-1&&parseFloat(ee[A])||0,updated_at:new Date().toISOString(),data:{barcode:ee[E],purchaseDate:P!==-1?ee[P]:new Date().toISOString().split("T")[0],vendor:T!==-1?ee[T]:"",warranty:z!==-1?ee[z]:"",maintenanceSchedule:W!==-1?ee[W]:"",lastServiced:M!==-1?ee[M]:"",nextDue:R!==-1?ee[R]:"",serviceProvider:F!==-1?ee[F]:"",assignedTo:V!==-1?ee[V]:"",notes:L!==-1?ee[L]:"Imported via CSV upload"}},it=b(De,U+1);G.push(...it),it.length===0&&Y.push(De)}if(G.length>0){h({success:!1,message:`Validation failed for ${G.length} items`,importedCount:0,failedCount:G.length,errors:G});return}let q=0,Q=0;const Z=[];for(let U=0;U<Y.length;U++){try{const me=Y[U];if(me&&me.id&&me.name)yield ht.addInventoryItem(me),q++;else throw new Error("Invalid item data")}catch(me){Q++,Z.push(`Row ${U+2}: ${me instanceof Error?me.message:"Import failed"}`)}f((U+1)/Y.length*100)}const ze={success:Q===0,message:Q===0?`Successfully imported ${q} items`:`Imported ${q} items, ${Q} failed`,importedCount:q,failedCount:Q,errors:Z};h(ze),d(Q===0),Q===0&&setTimeout(()=>{n(null),d(!1),h(null),f(0),e()},3e3)}catch(w){l(w instanceof Error?w.message:"Failed to upload CSV")}finally{i(!1)}}});return s.jsxs(ke,{show:r,onHide:e,centered:!0,backdrop:"static",size:"lg",children:[s.jsx(ke.Header,{closeButton:!0,className:"pb-2",children:s.jsxs(ke.Title,{className:"text-lg",children:["Import ",g.charAt(0).toUpperCase()+g.slice(1)," CSV"]})}),s.jsxs(ke.Body,{className:"py-3 pb-6",children:[s.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:s.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[s.jsx(N,{path:Ti,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 1: Download Template"]})}),s.jsxs("div",{className:"p-3 border-t border-gray-200",children:[s.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Get the CSV template with all required columns for ",g," ","data."]}),s.jsxs("button",{onClick:y,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center",children:[s.jsx(N,{path:Ye,size:.8,className:"mr-2"}),"Download Template"]})]})]}),s.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[s.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:s.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[s.jsx(N,{path:Fn,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 2: Upload CSV"]})}),s.jsxs("div",{className:"p-3 border-t border-gray-200",children:[s.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Upload your filled CSV file to import ",g," into the database."]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"csv-file-input",className:"block text-xs font-medium text-gray-700 mb-1",children:"Select CSV File"}),s.jsx("input",{id:"csv-file-input",type:"file",accept:".csv",onChange:v,className:"form-control py-1 px-2 text-sm"})]}),t&&s.jsxs("p",{className:"text-sm text-green-600 mb-2",children:["âœ“ Selected: ",t.name]}),c&&s.jsxs("p",{className:"text-sm text-red-600 mb-2",children:["âœ— ",c]}),o&&s.jsx("p",{className:"text-sm text-green-600 mb-2",children:"âœ“ Items uploaded successfully!"}),a&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[s.jsx("span",{children:"Uploading..."}),s.jsxs("span",{children:[Math.round(p),"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-[#4ECDC4] h-2 rounded-full transition-all duration-300",style:{width:`${p}%`}})})]}),u&&s.jsxs("div",{className:`p-3 rounded-lg border ${u.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(N,{path:u.success?It:ce,size:1,className:`mr-2 ${u.success?"text-green-600":"text-red-600"}`}),s.jsx("span",{className:`font-medium ${u.success?"text-green-800":"text-red-800"}`,children:u.message})]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsxs("p",{children:["Imported: ",u.importedCount," items"]}),s.jsxs("p",{children:["Failed: ",u.failedCount," items"]})]}),u.errors.length>0&&s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Errors:"}),s.jsxs("div",{className:"max-h-20 overflow-y-auto text-xs text-red-600",children:[u.errors.slice(0,5).map((w,j)=>s.jsxs("div",{children:["â€¢ ",w]},j)),u.errors.length>5&&s.jsxs("div",{children:["... and ",u.errors.length-5," more errors"]})]})]})]})]})]})]}),s.jsxs(ke.Footer,{className:"pt-2",children:[s.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors duration-200",children:"Cancel"}),s.jsxs("button",{onClick:x,disabled:!t||a,className:"px-4 py-2 bg-[#4ECDC4] hover:bg-[#3db8b0] text-white rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[s.jsx(N,{path:Fn,size:.8,className:"mr-2"}),a?"Importing...":`Import ${g.charAt(0).toUpperCase()+g.slice(1)}`]})]})]})},pT=()=>{const{showAddModal:r,showUploadBarcodeModal:e,showScanModal:t,closeAddModal:n,closeUploadBarcodeModal:a,closeScanModal:i,formData:c,isEditMode:l,isCloned:o,expandedSections:d,handleFormChange:u,toggleSection:h,handleSaveItem:p,handleCloneCurrentForm:f}=eh(),g=()=>{console.log("ðŸ” Save button clicked!"),console.log("ðŸ“ Current form data:",c),console.log("ðŸ” Is edit mode:",l);const v=zI(c,l);if(console.log("ðŸ” Validation errors:",v),Object.keys(v).length===0)console.log("âœ… Validation passed, calling handleSaveItem..."),p();else{console.error("âŒ Validation errors:",v);return}},y=v=>{h(v)};return s.jsxs(s.Fragment,{children:[s.jsx(Td,{modalConfig:bd.ADD_ITEM,show:r,onHide:n,formData:c,isEditMode:l,isCloned:o,expandedSections:d,toggleSection:y,handleFormChange:u,onSave:g,onClone:f,sections:rh}),s.jsx(hT,{show:e,onClose:a}),t&&s.jsx(Td,{modalConfig:bd.SCAN_ITEM,show:t,onHide:i,formData:{itemName:"",category:"",id:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()},isEditMode:!1,expandedSections:{general:!1,purchase:!1,maintenance:!1,usage:!1},toggleSection:()=>{},handleFormChange:()=>{},children:s.jsxs("div",{className:"text-center p-4",children:[s.jsx("h4",{children:"Scan Items"}),s.jsx("p",{children:"Scan modal content would be implemented here"})]})})]})},fT=({isEditMode:r,formData:e,progressInfo:t})=>(th(),s.jsx(pT,{}));var gT=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Ed={analyzeScan(r){return gT(this,null,function*(){const{barcode:e,mode:t,userId:n,facilityId:a}=r;if(!e)return{recommendation:"Invalid barcode",confidence:1};try{yield _.from("ai_scan_audit").insert([{barcode:e,mode:t,user_id:n||null,facility_id:a||null,event_context:r}])}catch(i){}return{recommendation:t==="add"?"Confirm inventory addition and set expiry date.":t==="use"?"Deduct from stock and log usage.":"Flag anomalies for review.",confidence:.85}})}};var yT=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const vT=(r,e="success")=>{switch(e){case"success":Bt.success(r);break;case"warning":Bt(r,{icon:"âš ï¸",style:{background:"#fef3c7",color:"#92400e"}});break;case"error":Bt.error(r);break;default:Bt(r)}},sh=({scanMode:r,onScan:e})=>{const[t,n]=m.useState([]),{openAddModal:a,closeScanModal:i,setFormData:c,setEditMode:l,inventoryItems:o,refreshInventoryData:d}=ft(),u=m.useCallback(f=>{const g=o.find(y=>{var v;return((v=y.data)==null?void 0:v.barcode)===f||y.id===f});if(g)console.log("Item already exists:",g),vT(`Item "${g.name}" already exists in inventory.`,"warning");else{const y=Xm(f),v=Zm(y);c(v),l(!1),i(),a()}},[o,c,l,i,a]),h=m.useCallback(f=>yT(null,null,function*(){var g;try{const{data:y,error:v}=yield _.from("inventory_items").select("*").eq("barcode",f).single();if(v||!y){Bt.error("Item not found in inventory.");return}const b=Math.max(((g=y.quantity)!=null?g:1)-1,0),{error:x}=yield _.from("inventory_items").update({quantity:b}).eq("id",y.id);if(x){Bt.error("Failed to update inventory.");return}yield _.from("inventory_usage").insert([{barcode:f,item_id:y.id,facility_id:y.facility_id,user_id:y.user_id||null,action:"use",timestamp:new Date().toISOString()}]),Ed.analyzeScan({barcode:f,mode:"use",timestamp:new Date().toISOString()}).catch(()=>{}),Bt.success(`${y.name||"Item"} used successfully.`)}catch(y){console.error("Error in handleUseInventoryWorkflow:",y),Bt.error("Unexpected error using item.")}}),[]),p=m.useCallback(f=>{if(n(g=>[...g,f]),e)try{e(f)}catch(g){console.error("Error in onScan callback:",g)}r==="use"?h(f):r==="add"&&u(f),Ed.analyzeScan({barcode:f,mode:r,timestamp:new Date().toISOString()}).catch(()=>{})},[r,u,h,e]);return{scannedBarcodes:t,handleBarcodeScan:p}},xT=({scanMode:r,onClose:e})=>s.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("h3",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(de,{path:Qe,size:1.2,className:"text-[#4ECDC4] mr-3"}),r?"Inventory Scanner":"Scan Inventory"]})}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(de,{path:Ae,size:1.2})})]}),bT=r=>r==="add"?"Add Inventory":"Use Inventory",_T=r=>`${r} item${r!==1?"s":""}`,wT=({scanMode:r,scannedItems:e,onSelectMode:t,onClearScannedItems:n,onRemoveScannedItem:a})=>r?s.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Scanner Active"}),s.jsx("div",{className:"bg-black h-32 rounded-lg flex items-center justify-center",children:s.jsx("div",{className:"text-white text-sm",children:"Camera Scanner"})})]}),e.length>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsxs("h4",{className:"font-medium",children:["Scanned Items (",_T(e.length),")"]}),s.jsx("button",{onClick:()=>{n&&n()},className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Clear All"})]}),s.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 hide-scrollbar",children:e.map(i=>s.jsxs("div",{className:"bg-gray-50 p-2 rounded text-sm flex items-center justify-between",children:[s.jsx("span",{className:"flex-1",children:i}),s.jsx("button",{onClick:()=>{a&&a(i)},className:"ml-2 p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors duration-200",title:"Remove item",children:s.jsx(En.Icon,{path:Hn,size:.8})})]},i))})]})]})}):s.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Select the type of inventory operation you want to perform:"}),s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:s.jsxs("p",{className:"text-yellow-800 text-xs",children:["ðŸ’¡ ",s.jsx("strong",{children:"Tip:"}),' For items without barcodes, use the "Add Item" button in the appropriate category table.']})}),s.jsx("button",{onClick:()=>t("add"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:s.jsx(En.Icon,{path:ki,size:1.2,className:"text-green-600"})}),s.jsxs("div",{className:"text-left",children:[s.jsx("h4",{className:"font-semibold text-green-800 text-sm",children:"Add Inventory"}),s.jsx("p",{className:"text-xs text-green-600",children:"Scan barcode to add new items. If no barcode exists, you can add one manually."})]})]})}),s.jsx("button",{onClick:()=>t("use"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:s.jsx(En.Icon,{path:Un,size:1.2,className:"text-blue-600"})}),s.jsxs("div",{className:"text-left",children:[s.jsx("h4",{className:"font-semibold text-blue-800 text-sm",children:"Use Inventory"}),s.jsx("p",{className:"text-xs text-blue-600",children:"Scan barcode to remove items from inventory when they are used."})]})]})})]})});var kd=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ST=({scanMode:r,scannedItems:e,onSelectMode:t})=>{const{openAddModal:n,closeScanModal:a,setFormData:i,setEditMode:c,inventoryItems:l}=ft(),o=()=>kd(null,null,function*(){if(r==="add"&&e.length>0){const d=e[0];if(l.find(f=>{var g;return((g=f.data)==null?void 0:g.barcode)===d||f.id===d})){alert(`Item with barcode ${d} already exists in inventory.`);return}const h=Xm(d),p=Zm(h);i(p),c(!1),a(),n()}else if(r==="use"&&e.length>0){const d=e.map(f=>kd(null,null,function*(){const g=l.find(y=>{var v;return((v=y.data)==null?void 0:v.barcode)===f||y.id===f});if(g)try{return yield up.deleteItem(g.id),console.log("Successfully removed item from inventory:",g.name),{success:!0,item:g}}catch(y){return console.error("Failed to remove item:",g.name,y),{success:!1,item:g,error:y}}else return console.log("Item not found in inventory:",f),{success:!1,item:null,error:"Item not found"}})),u=yield Promise.all(d),h=u.filter(f=>f.success).length,p=u.filter(f=>!f.success).length;h>0&&alert(`Successfully removed ${h} item(s) from inventory.`),p>0&&alert(`Failed to remove ${p} item(s). Please check the console for details.`),a()}});return r?s.jsx("div",{className:"p-6 border-t border-gray-200",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>o().catch(console.error),className:"flex-1 bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#4ECDC4] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:bT(r)}),s.jsx("button",{onClick:()=>t("add"),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200",children:"Back"})]})}):null},jT=({scanMode:r,scannedItems:e,onClose:t,onSelectMode:n,onScan:a,onProcess:i,onClearScannedItems:c,onOpenAddItemModal:l,onRemoveScannedItem:o})=>{sh({scanMode:r,onScan:a});const d=s.jsx(Bn,{children:s.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999] p-4",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},onClick:t,children:s.jsxs(ne.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl overflow-hidden w-full max-w-md shadow-2xl max-h-[90vh] flex flex-col",onClick:u=>u.stopPropagation(),children:[s.jsx(xT,{scanMode:r,onClose:t}),s.jsx(wT,{scanMode:r,scannedItems:e,onSelectMode:n,onClearScannedItems:c,onRemoveScannedItem:o}),s.jsx(ST,{scanMode:r,scannedItems:e,onSelectMode:n,onProcess:i,onClose:t,onOpenAddItemModal:l})]})})});return Rs.createPortal(d,document.body)};function CT(){return s.jsx("div",{className:"text-red-600 text-sm p-4",children:"âš ï¸ Something went wrong loading the Scan Modal. Please refresh or try again later."})}const NT=()=>{const{showScanModal:r,scanMode:e,scannedItems:t,resetScannedItems:n,setScanMode:a,setShowScanModal:i,addScannedItem:c,removeScannedItem:l}=ft(),o=()=>{n(),a(null),i(!1)};return r?s.jsx(jT,{scanMode:e,scannedItems:t,onClose:o,onSelectMode:a,onScan:c,onProcess:()=>{},onClearScannedItems:n,onOpenAddItemModal:()=>{},onRemoveScannedItem:l}):null};function IT(){return s.jsx(zr,{FallbackComponent:CT,children:s.jsx(NT,{})})}const Yi=({show:r,onClose:e,title:t,children:n,footer:a,size:i="lg"})=>s.jsxs(ke,{show:r,onHide:e,centered:!0,size:i,"aria-modal":"true",role:"dialog",children:[t&&s.jsx(ke.Header,{closeButton:!0,className:"bg-gray-50 border-b border-gray-200",children:s.jsx(ke.Title,{className:"text-xl font-semibold text-gray-800",children:t})}),s.jsx(ke.Body,{className:"p-4",children:n}),a&&s.jsx(ke.Footer,{className:"bg-gray-50 border-t border-gray-200 px-4 py-3",children:a})]}),TT=({show:r,onClose:e,onConfirm:t,item:n,isLoading:a=!1,activeTab:i="tools"})=>{if(!n)return null;const c=()=>{t()},l=()=>{e()};return s.jsx(Yi,{show:r,onClose:e,title:"Confirm Archive",size:"lg",footer:s.jsxs("div",{className:"flex gap-3 justify-end",children:[s.jsx("button",{onClick:l,disabled:a,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md font-medium transition-colors duration-200 disabled:opacity-50",children:"Cancel"}),s.jsx("button",{onClick:c,disabled:a,className:"px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-md font-medium transition-colors duration-200 disabled:opacity-50 flex items-center gap-2",children:a?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Archiving..."]}):s.jsxs(s.Fragment,{children:[s.jsx(N,{path:Hn,size:.8}),"Archive"]})})]}),children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(N,{path:$s,size:1.2,className:"text-red-600"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:['Archive "',n.name,'"?']}),s.jsx("p",{className:"text-gray-600 mb-4",children:"This will archive the item from the active inventory. The item will be hidden but preserved for audit purposes and compliance requirements."}),s.jsx("div",{className:"bg-gray-50 rounded-md p-3",children:s.jsxs("div",{className:"text-sm text-gray-700",children:[s.jsxs("div",{className:"flex justify-between mb-1",children:[s.jsx("span",{className:"font-medium",children:"Item:"}),s.jsx("span",{children:n.name})]}),s.jsxs("div",{className:"flex justify-between mb-1",children:[s.jsx("span",{className:"font-medium",children:"Category:"}),s.jsx("span",{children:n.category})]}),s.jsxs("div",{className:"flex justify-between mb-1",children:[s.jsx("span",{className:"font-medium",children:"Location:"}),s.jsx("span",{children:n.location})]}),i!=="tools"&&n.quantity!==void 0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Quantity:"}),s.jsx("span",{children:n.quantity})]})]})})]})]})})};var Dd=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ET=m.lazy(()=>H(()=>import("./InventoryTableSection-BYn7CC1E.js"),__vite__mapDeps([16,2,3,13,1,4,5,17]))),kT=m.lazy(()=>H(()=>import("./InventoryInsightsCard-C4ps1wdx.js"),__vite__mapDeps([18,2,3,13,1,4,5]))),DT=m.lazy(()=>H(()=>import("./CategoriesCard-DV98GOcN.js"),__vite__mapDeps([19,2,3,13,1,4,5]))),PT=()=>{const{refreshData:r}=nd(),{registerRefreshCallback:e}=CI();te.useEffect(()=>e(()=>{console.log("ðŸ”„ InventoryDashboard received real-time update, refreshing data..."),r()}),[r,e]);const{tools:t,supplies:n,equipment:a,officeHardware:i}=nd(),{getProgressInfo:c}=jI(),{formData:l,activeTab:o,showDeleteModal:d,itemToDelete:u,closeDeleteModal:h,showTrackedOnly:p,setShowTrackedOnly:f}=ft(),g=m.useMemo(()=>LI(l),[l]),{expandedSections:y,handleCloseAddModal:v,handleSave:b,handleToggleSection:x,handleFormChangeWrapper:w,handleEditItem:j,handleCloneItem:I,isEditMode:E}=th(),{setActiveTab:O}=ft(),S=m.useMemo(()=>{switch(o){case"tools":return t||[];case"supplies":return n||[];case"equipment":return a||[];case"officeHardware":return i||[];default:return t||[]}},[o,t,n,a,i]),C={showTrackedOnly:p,showFavoritesOnly:!1,handleShowAddModal:()=>{},handleCloseAddModal:v,handleToggleTrackedFilter:()=>f(!p),handleToggleFavoritesFilter:()=>{},onCategoryChange:T=>O(T),searchTerm:"",expandedSections:y,favorites:[],filteredTools:[],setSearchTerm:()=>{},handleToggleFavorite:()=>{},handleSave:b,handleToggleSection:x,handleFormChangeWrapper:w,getStatusBadge:T=>T,getStatusText:T=>T},D=T=>Dd(null,null,function*(){try{yield nt.handleDeleteItem(T.id,()=>{console.log("Item deleted successfully"),r()},A=>{console.error("Failed to delete item:",A)})}catch(A){console.error("Error in delete handler:",A)}}),k=()=>Dd(null,null,function*(){if(u)try{yield nt.handleArchiveItem(u.id,()=>{console.log("Item archived successfully"),h(),r()},T=>{console.error("Failed to archive item:",T)})}catch(T){console.error("Error in archive handler:",T)}}),P={tools:t,supplies:n,equipment:a,officeHardware:i};return te.useEffect(()=>{console.log("ðŸ  InventoryDashboard insights data:",{tools:(t==null?void 0:t.length)||0,supplies:(n==null?void 0:n.length)||0,equipment:(a==null?void 0:a.length)||0,officeHardware:(i==null?void 0:i.length)||0,total:((t==null?void 0:t.length)||0)+((n==null?void 0:n.length)||0)+((a==null?void 0:a.length)||0)+((i==null?void 0:i.length)||0)})},[t,n,a,i]),s.jsx(FI.Provider,{value:C,children:s.jsx(zr,{fallback:s.jsx(RN,{}),children:s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx(ON,{}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[s.jsxs("div",{className:"flex flex-col gap-4 lg:w-1/4 pl-4",children:[s.jsx(m.Suspense,{fallback:s.jsx(ks,{}),children:s.jsx(kT,{data:P})}),s.jsx(m.Suspense,{fallback:s.jsx(ks,{}),children:s.jsx(DT,{onCategoryChange:T=>O(T),counts:{tools:(t==null?void 0:t.length)||0,supplies:(n==null?void 0:n.length)||0,equipment:(a==null?void 0:a.length)||0,officeHardware:(i==null?void 0:i.length)||0}})})]}),s.jsx("div",{className:"flex-1 pr-4",children:s.jsx(m.Suspense,{fallback:s.jsx(ju,{rows:8,columns:5}),children:s.jsx("div",{className:"bg-white rounded-lg shadow p-6 w-full max-w-full flex flex-col min-h-fit",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"inventory table and controls",children:s.jsx(ET,{onEdit:j,onDelete:D,onClone:I,items:S})})})})]}),s.jsx(fT,{isEditMode:E,formData:g,progressInfo:c()}),s.jsx(IT,{}),s.jsx(TT,{show:d,onClose:h,onConfirm:k,item:u,activeTab:o})]})})})};function OT(){function r({children:t}){return s.jsx(pC,{children:s.jsx(Ur,{children:s.jsx(fC,{children:t})})})}function e(){return s.jsx(PT,{})}return{ProviderTree:r,PageContent:e}}function RT(){const{ProviderTree:r,PageContent:e}=OT();return s.jsx(r,{children:s.jsx(e,{})})}var Qa=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const AT=()=>{var r;const[e,t]=m.useState(null),[n,a]=m.useState([]),[i,c]=m.useState(!1),[l,o]=m.useState(null),{handleBarcodeScan:d}=sh({scanMode:e,onScan:v=>{a(b=>[...b,v])}}),u=()=>Qa(null,null,function*(){e&&(c(!0),o(null),setTimeout(()=>Qa(null,null,function*(){const v=["ITEM-001","ITEM-002","ITEM-003","ITEM-004","ITEM-005"],b=v[Math.floor(Math.random()*v.length)];try{d(b),e==="add"?n.includes(b)?o({type:"warning",message:`Item ${b} already scanned.`}):o({type:"success",message:`Item ${b} scanned successfully! Ready to add to inventory.`}):e==="use"&&(n.includes(b)?(o({type:"success",message:`Item ${b} used successfully! Removed from inventory.`}),a(x=>x.filter(w=>w!==b))):o({type:"error",message:`Item ${b} not found in inventory.`}))}catch(x){o({type:"error",message:x instanceof Error?x.message:"Scan failed"})}finally{c(!1)}}),1e3))}),h=v=>Qa(null,null,function*(){if(v.trim()){c(!0),o(null);try{d(v),e==="add"?n.includes(v)?o({type:"warning",message:`Item ${v} already scanned.`}):o({type:"success",message:`Item ${v} scanned successfully! Ready to add to inventory.`}):e==="use"&&(n.includes(v)?(o({type:"success",message:`Item ${v} used successfully! Removed from inventory.`}),a(b=>b.filter(x=>x!==v))):o({type:"error",message:`Item ${v} not found in inventory.`}))}catch(b){o({type:"error",message:b instanceof Error?b.message:"Manual scan failed"})}finally{c(!1)}}}),p=[{id:"add",name:"Add Inventory",icon:ki,color:"green",description:"Add new items to inventory"},{id:"use",name:"Use Inventory",icon:Un,color:"blue",description:"Remove items from inventory"}],f=v=>{switch(v){case"success":return It;case"error":return ce;case"warning":return ce;default:return Qe}},g=v=>{switch(v){case"success":return"text-green-600";case"error":return"text-red-600";case"warning":return"text-yellow-600";default:return"text-gray-600"}},y=v=>{switch(v){case"success":return"bg-green-100 border-green-200";case"error":return"bg-red-100 border-red-200";case"warning":return"bg-yellow-100 border-yellow-200";default:return"bg-gray-100 border-gray-200"}};return s.jsxs(s.Fragment,{children:[s.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:()=>window.location.href="/inventory"}),s.jsx(ne.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:s.jsx("div",{className:"h-full flex flex-col",children:s.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Inventory Scanner"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Scan items for inventory management"})]}),s.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",children:e?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`border rounded-lg p-4 ${e==="add"?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("h3",{className:`font-semibold mb-1 ${e==="add"?"text-green-800":"text-blue-800"}`,children:[e.charAt(0).toUpperCase()+e.slice(1)," ","Operation"]}),s.jsx("p",{className:`text-sm ${e==="add"?"text-green-600":"text-blue-600"}`,children:(r=p.find(v=>v.id===e))==null?void 0:r.description})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("label",{htmlFor:"manual-barcode-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"Manual Barcode Entry"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{id:"manual-barcode-input",type:"text",placeholder:"Enter barcode manually...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyPress:v=>{if(v.key==="Enter"){const b=v.target;h(b.value),b.value=""}},disabled:i}),s.jsx("button",{onClick:()=>{const v=document.querySelector('input[placeholder="Enter barcode manually..."]');v&&(h(v.value),v.value="")},disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Scan"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsxs("div",{className:"text-center space-y-4",children:[s.jsxs("div",{className:"relative bg-black h-64 rounded-lg overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 to-black"}),s.jsx(ne.div,{className:"absolute left-0 right-0 h-1 bg-[#4ECDC4]",animate:{top:["10%","90%","10%"],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),s.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-32 rounded-lg",children:[s.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),s.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),s.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),s.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),s.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),s.jsx("button",{onClick:u,disabled:i,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${i?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:s.jsx(N,{path:Qe,size:1.5,className:`${i?"text-gray-400":"text-white"}`})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:i?"Scanning...":"Click to Scan"}),s.jsx("p",{className:"text-gray-600 text-sm",children:i?"Position barcode in camera view":"Use camera to scan item barcode"})]})]}),l&&s.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg border ${y(l.type)}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:f(l.type),size:1,className:g(l.type)}),s.jsx("span",{className:`font-medium ${g(l.type)}`,children:l.message})]})})]}),n.length>0&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsxs("h4",{className:"font-medium text-gray-800 mb-2",children:["Scanned Items (",n.length,")"]}),s.jsx("div",{className:"space-y-1",children:n.map((v,b)=>s.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[s.jsx(N,{path:Qe,size:.8,className:"text-gray-400"}),v]},b))})]}),s.jsx("div",{className:"flex justify-center",children:s.jsx("button",{onClick:()=>{t(null),a([]),o(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"â† Back to Operation Selection"})})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Select Operation"}),s.jsx("div",{className:"space-y-3",children:p.map(v=>s.jsx("button",{onClick:()=>t(v.id),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${v.color==="green"?"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100":"border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100"}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${v.color==="green"?"bg-green-100":"bg-blue-100"}`,children:s.jsx(N,{path:v.icon,size:1.2,className:v.color==="green"?"text-green-600":"text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h4",{className:`font-semibold text-sm ${v.color==="green"?"text-green-800":"text-blue-800"}`,children:v.name}),s.jsx("p",{className:`text-xs ${v.color==="green"?"text-green-600":"text-blue-600"}`,children:v.description})]})]})},v.id))})]})})]})})})]})},$T=()=>s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}),MT=({error:r,resetErrorBoundary:e})=>{const n=(a=>a.message.includes("fetch")||a.message.includes("network")?{title:"Connection Error",description:"Unable to connect to the server. Please check your internet connection.",suggestion:"Try refreshing the page or check your network connection.",severity:"warning"}:a.message.includes("permission")||a.message.includes("unauthorized")?{title:"Access Denied",description:"You don't have permission to access this feature.",suggestion:"Contact your administrator if you believe this is an error.",severity:"error"}:a.message.includes("timeout")?{title:"Request Timeout",description:"The request took too long to complete.",suggestion:"Try again in a moment. If the problem persists, contact support.",severity:"warning"}:{title:"Unexpected Error",description:"Something went wrong while loading the Environmental Clean module.",suggestion:"Try refreshing the page. If the problem continues, contact support.",severity:"error"})(r);return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:s.jsx("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${n.severity==="error"?"bg-red-100":"bg-yellow-100"}`,children:s.jsx(N,{path:ce,size:2,className:n.severity==="error"?"text-red-600":"text-yellow-600"})}),s.jsx("h2",{className:`text-xl font-semibold mb-2 ${n.severity==="error"?"text-red-600":"text-yellow-600"}`,children:n.title}),s.jsx("p",{className:"text-gray-700 mb-4 leading-relaxed",children:n.description}),s.jsxs("details",{className:"mb-4 text-left",children:[s.jsxs("summary",{className:"cursor-pointer text-sm text-gray-500 hover:text-gray-700 flex items-center justify-center",children:[s.jsx(N,{path:Rp,size:.8,className:"mr-1"}),"Technical Details"]}),s.jsxs("div",{className:"mt-2 p-3 bg-gray-100 rounded text-xs font-mono text-gray-600 break-all",children:[r.message,r.stack&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Stack trace:"}),s.jsx("div",{className:"mt-1",children:r.stack})]})]})]}),s.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["ðŸ’¡ ",n.suggestion]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[s.jsxs("button",{onClick:e,className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[s.jsx(N,{path:pt,size:.8,className:"mr-2"}),"Try Again"]}),s.jsxs("button",{onClick:()=>window.location.href="/",className:"flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[s.jsx(N,{path:Fu,size:.8,className:"mr-2"}),"Go Home"]})]}),s.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:s.jsxs("p",{className:"text-xs text-gray-500",children:["Still having trouble? Contact support at"," ",s.jsx("a",{href:"mailto:support@cliniio.com",className:"text-blue-600 hover:underline",children:"support@cliniio.com"})]})})]})})})};class Ft extends Error{constructor(e,t,n,a){super(e),this.code=t,this.statusCode=n,this.details=a,this.name="EnvironmentalCleanServiceError"}}const Jt={NETWORK_ERROR:"Unable to connect to the server. Please check your internet connection.",TIMEOUT_ERROR:"The request took too long to complete. Please try again.",UNAUTHORIZED:"You don't have permission to perform this action. Please contact your administrator.",NOT_FOUND:"The requested resource was not found.",VALIDATION_ERROR:"The provided data is invalid. Please check your input and try again.",SERVER_ERROR:"A server error occurred. Please try again later.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again."},Ct=(r,e)=>{if(r instanceof Ft)return r;const t=r instanceof Error?r.message:String(r);return t.includes("fetch")||t.includes("network")||t.includes("ENOTFOUND")?new Ft(Jt.NETWORK_ERROR,"NETWORK_ERROR",void 0,{originalError:t,context:e}):t.includes("timeout")||t.includes("ETIMEDOUT")?new Ft(Jt.TIMEOUT_ERROR,"TIMEOUT_ERROR",void 0,{originalError:t,context:e}):t.includes("401")||t.includes("unauthorized")?new Ft(Jt.UNAUTHORIZED,"UNAUTHORIZED",401,{originalError:t,context:e}):t.includes("404")||t.includes("not found")?new Ft(Jt.NOT_FOUND,"NOT_FOUND",404,{originalError:t,context:e}):t.includes("422")||t.includes("validation")?new Ft(Jt.VALIDATION_ERROR,"VALIDATION_ERROR",422,{originalError:t,context:e}):t.includes("500")||t.includes("server error")?new Ft(Jt.SERVER_ERROR,"SERVER_ERROR",500,{originalError:t,context:e}):new Ft(Jt.UNKNOWN_ERROR,"UNKNOWN_ERROR",void 0,{originalError:t,context:e})},Ya=r=>({pending:"Dirty",in_progress:"In Progress",completed:"Clean",verified:"Clean",clean:"Clean",failed:"Supervisor",cancelled:"Out of Service",dirty:"Dirty"})[r]||"Dirty",Pd=r=>({Dirty:"dirty","In Progress":"in_progress",Clean:"clean","Out of Service":"cancelled",Supervisor:"pending",Isolation:"failed",Quarantine:"failed",Maintenance:"pending","Equipment Failure":"failed","Patient Occupied":"pending","Discharge Cleaning":"pending",Unassigned:"pending","Audit Required":"pending"})[r]||"dirty";var rr=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Er=()=>rr(null,null,function*(){return yield at.getCurrentFacilityId()});class kr{static fetchRooms(){return rr(this,null,function*(){try{const e=yield Er(),t=_.from("environmental_cleans_enhanced").select(`
          id,
          room_id,
          room_name,
          status,
          cleaning_type,
          scheduled_time,
          completed_time,
          quality_score,
          compliance_score,
          created_at,
          updated_at
        `).eq("facility_id",e),{data:n,error:a}=yield t.order("scheduled_time",{ascending:!1});if(a)throw a;return(n!=null?n:[]).map(c=>{var l,o,d,u,h;const p=Ya(c.status);return{id:c.room_id||c.id,name:c.room_name||`Room ${c.room_id||c.id}`,status:p,metadata:{cleaningType:(l=c.cleaning_type)!=null?l:"",qualityScore:(o=c.quality_score)!=null?o:0,complianceScore:(d=c.compliance_score)!=null?d:0,scheduledTime:(u=c.scheduled_time)!=null?u:"",completedTime:(h=c.completed_time)!=null?h:void 0},createdAt:c.created_at,updatedAt:c.updated_at}})}catch(e){return console.warn("Environmental Clean rooms fetch failed, falling back to static data:",e),[{id:"room-1",name:"Operating Room 1",status:"pending",metadata:{cleaningType:"surgical",qualityScore:95,complianceScore:98,scheduledTime:new Date().toISOString(),completedTime:void 0},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"room-2",name:"Recovery Room A",status:"in_progress",metadata:{cleaningType:"standard",qualityScore:87,complianceScore:92,scheduledTime:new Date().toISOString(),completedTime:void 0},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"room-3",name:"ICU Room 3",status:"completed",metadata:{cleaningType:"intensive",qualityScore:99,complianceScore:100,scheduledTime:new Date().toISOString(),completedTime:new Date().toISOString()},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}})}static updateRoomStatus(e,t){return rr(this,null,function*(){try{const n=yield Er(),a=_.from("environmental_cleans_enhanced").update({status:Pd(t),updated_at:new Date().toISOString()}).eq("room_id",e).eq("facility_id",n),{error:i}=yield a;if(i)throw i;st.log("environmental_clean","room_status_updated",{roomId:e,status:t,timestamp:new Date().toISOString()})}catch(n){const a=Ct(n,"updateRoomStatus");throw console.error("âŒ Failed to update room status:",a),a}})}static createEnvironmentalClean(e){return rr(this,null,function*(){var t,n,a,i;try{const c=yield Er(),l={room_id:(t=e.id)!=null?t:"",room_name:(n=e.name)!=null?n:"",status:"pending",cleaning_type:"routine",scheduled_time:new Date().toISOString(),checklist_items:[],completed_items:[],failed_items:[],facility_id:c},{data:o,error:d}=yield _.from("environmental_cleans_enhanced").insert(l).select().single();if(d||!o)throw d!=null?d:new Error("Insert failed");const u={id:o.room_id,name:o.room_name||`Room ${o.room_id}`,status:Ya(o.status),metadata:{cleaningType:(a=o.cleaning_type)!=null?a:"",scheduledTime:(i=o.scheduled_time)!=null?i:""},createdAt:o.created_at,updatedAt:o.updated_at};return st.log("environmental_clean","room_created",{roomId:u.id,roomName:u.name}),u}catch(c){const l=Ct(c,"createEnvironmentalClean");throw console.error("âŒ Failed to create environmental clean:",l),l}})}static updateEnvironmentalClean(e,t){return rr(this,null,function*(){var n,a,i,c,l;try{const o=yield Er(),d={updated_at:new Date().toISOString()};t.name&&(d.room_name=t.name),t.status&&(d.status=Pd(t.status));const u=_.from("environmental_cleans_enhanced").update(d).eq("room_id",e).eq("facility_id",o),{data:h,error:p}=yield u.select().single();if(p||!h)throw p!=null?p:new Error("Update failed");const f={id:h.room_id,name:h.room_name||`Room ${h.room_id}`,status:Ya(h.status),metadata:{cleaningType:(n=h.cleaning_type)!=null?n:"",qualityScore:(a=h.quality_score)!=null?a:0,complianceScore:(i=h.compliance_score)!=null?i:0,scheduledTime:(c=h.scheduled_time)!=null?c:"",completedTime:(l=h.completed_time)!=null?l:void 0},createdAt:h.created_at,updatedAt:h.updated_at};return st.log("environmental_clean","room_updated",{roomId:f.id,roomName:f.name}),f}catch(o){const d=Ct(o,"updateEnvironmentalClean");throw console.error("âŒ Failed to update environmental clean:",d),d}})}static deleteEnvironmentalClean(e){return rr(this,null,function*(){try{const t=yield Er(),n=_.from("environmental_cleans_enhanced").delete().eq("room_id",e).eq("facility_id",t),{error:a}=yield n;if(a)throw a;st.log("environmental_clean","room_deleted",{roomId:e})}catch(t){const n=Ct(t,"deleteEnvironmentalClean");throw console.error("âŒ Failed to delete environmental clean:",n),n}})}static completeRoomCleaning(e){return rr(this,null,function*(){try{if(!e)throw new Error("Room ID is required");const t=yield Er(),n=_.from("environmental_cleans_enhanced").update({status:"completed",completed_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("room_id",e).eq("facility_id",t),{error:a}=yield n;if(a)throw a;st.log("environmental_clean","room_cleaning_completed",{roomId:e,timestamp:new Date().toISOString()})}catch(t){const n=Ct(t,"completeRoomCleaning");throw console.error("âŒ Error completing room cleaning:",n),n}})}}var Sn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class jn{static fetchAnalytics(){return Sn(this,null,function*(){try{console.log("ðŸ“Š Fetching analytics from Supabase...");const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("status, completed_time, scheduled_time, created_at");if(t)throw t;const n=e||[],a=n.length,i=n.filter(b=>b.status==="clean"||b.status==="completed"||b.status==="verified").length,c=n.filter(b=>b.status==="dirty"||b.status==="pending").length,l=n.filter(b=>b.status==="in_progress").length,o=n.filter(b=>b.status==="biohazard").length,d=n.filter(b=>b.status==="theft").length,u=n.filter(b=>b.status==="low_inventory").length,h=n.filter(b=>b.status==="out_of_service").length,p=n.filter(b=>b.status==="public_areas").length,f=a>0?Math.round(i/a*100):0,g=n.filter(b=>b.completed_time&&b.scheduled_time);let y=0;if(g.length>0){const b=g.reduce((x,w)=>{const j=new Date(w.scheduled_time).getTime(),I=new Date(w.completed_time).getTime();return x+(I-j)},0);y=Math.round(b/g.length/(1e3*60))}const v={totalRooms:a,cleanRooms:i,dirtyRooms:c,inProgressRooms:l,biohazardRooms:o,theftRooms:d,lowInventoryRooms:u,outOfServiceRooms:h,publicAreas:p,cleaningEfficiency:f,averageCleaningTime:y,lastUpdated:new Date().toISOString()};return console.log("âœ… Analytics fetched successfully:",v),v}catch(e){throw console.error("âŒ Error fetching analytics:",e),e}})}static getRoomCountsByStatus(){return Sn(this,null,function*(){try{console.log("ðŸ“Š Fetching room counts from Supabase...");const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("status");if(t)throw t;const n=e||[],a={completed:n.filter(i=>i.status==="clean"||i.status==="completed").length,pending:n.filter(i=>i.status==="dirty"||i.status==="pending").length,in_progress:n.filter(i=>i.status==="in_progress").length,failed:n.filter(i=>i.status==="failed").length,cancelled:n.filter(i=>i.status==="cancelled").length,verified:n.filter(i=>i.status==="verified").length};return console.log("âœ… Room counts fetched successfully:",a),a}catch(e){throw console.error("âŒ Error getting room counts by status:",e),e}})}static getRecentlyCompletedCleanings(e=10){return Sn(this,null,function*(){try{const{data:t,error:n}=yield _.from("environmental_cleans_enhanced").select("room_name, completed_time, cleaner_id").eq("status","clean").not("completed_time","is",null).order("completed_time",{ascending:!1}).limit(e);if(n)throw n;return(t||[]).map(c=>({room:c.room_name||"Unknown Room",cleanedAt:c.completed_time,cleanedBy:c.cleaner_id?`Cleaner ${c.cleaner_id}`:"System"}))}catch(t){throw console.error("âŒ Error getting recently completed cleanings:",t),t}})}static getCleaningEfficiencyTrends(e=7){return Sn(this,null,function*(){try{const t=new Date;t.setDate(t.getDate()-e);const{data:n,error:a}=yield _.from("environmental_cleans_enhanced").select("status, completed_time, scheduled_time, created_at").gte("created_at",t.toISOString()).order("created_at",{ascending:!1});if(a)throw a;const i=n||[],c={};return i.forEach(l=>{const o=new Date(l.created_at).toISOString().split("T")[0];c[o]||(c[o]={completed:0,total:0,efficiency:0}),c[o].total++,(l.status==="completed"||l.status==="verified")&&c[o].completed++}),Object.keys(c).forEach(l=>{const o=c[l];o.efficiency=o.total>0?Math.round(o.completed/o.total*100):0}),c}catch(t){throw console.error("âŒ Error getting cleaning efficiency trends:",t),t}})}}var FT=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class LT{static fetchChecklists(){return FT(this,null,function*(){try{console.log("ðŸ” Fetching environmental cleaning checklists...");const{data:e,error:t}=yield _.from("environmental_cleaning_task_categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw console.error("âŒ Supabase error:",t),t;return console.log("âœ… Checklists fetched successfully:",(e==null?void 0:e.length)||0,"records"),(e||[]).map(n=>{var a,i,c,l;return{id:n.id,name:n.name,description:(a=n.data)==null?void 0:a.description,items:[],isActive:!!((i=n.is_active)==null||i),createdAt:String((c=n.created_at)!=null?c:new Date().toISOString()),updatedAt:String((l=n.updated_at)!=null?l:new Date().toISOString())}})}catch(e){throw console.error("âŒ Error fetching checklists:",e),Ct(e,"fetchChecklists")}})}}var Od=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Rd{static fetchRecentlyCleanedRooms(e=10){return Od(this,null,function*(){try{const{data:t,error:n}=yield _.from("environmental_cleans_enhanced").select(`
          room_name,
          completed_time,
          cleaner_id
        `).eq("status","clean").neq("completed_time",null).order("completed_time",{ascending:!1}).limit(e);if(n)throw console.error("âŒ Supabase error:",n),n;return(t||[]).map(i=>({room:i.room_name||"Unknown Room",cleanedAt:i.completed_time,cleanedBy:i.cleaner_id?`Cleaner ${i.cleaner_id}`:"System"}))}catch(t){console.error("âŒ Raw error in fetchRecentlyCleanedRooms:",t);const n=Ct(t,"fetchRecentlyCleanedRooms");throw console.error("âŒ Failed to fetch recently cleaned rooms:",n),n}})}static scanRoomBarcode(e){return Od(this,null,function*(){try{if(!e||e.trim()==="")return{success:!1,message:"Please enter a valid barcode"};const{useRoomStore:t}=yield H(()=>Promise.resolve().then(()=>XI),void 0),a=t.getState().getRoomByBarcode(e.trim());return a?(st.log("environmental_clean","room_scan",{barcode:e,roomId:a.id,roomName:a.name}),{success:!0,room:{id:a.barcode||a.id,name:a.name,status:"dirty"},message:`Successfully scanned room: ${a.name}`}):{success:!1,message:`Room with barcode "${e}" not found. Please check the barcode or add the room in Settings.`}}catch(t){return console.error("âŒ Error scanning room barcode:",t),{success:!1,message:"An error occurred while scanning the barcode. Please try again."}}})}}var zT=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class BT{static batchEnvironmentalCleanAction(e){return zT(this,arguments,function*({ids:t,action:n}){try{const a={updated_at:new Date().toISOString()};switch(n){case"mark_completed":a.status="completed",a.completed_time=new Date().toISOString();break;case"mark_in_progress":a.status="in_progress",a.started_time=new Date().toISOString();break;case"mark_verified":a.status="verified",a.verified_time=new Date().toISOString();break;default:throw new Error(`Unknown action: ${n}`)}const{error:i}=yield _.from("environmental_cleans_enhanced").update(a).in("room_id",t);if(i)throw i;return st.log("environmental_clean","batch_action",{action:n,roomIds:t,count:t.length}),{success:!0}}catch(a){const i=Ct(a,"batchEnvironmentalCleanAction");throw console.error("âŒ Failed to perform batch action:",i),i}})}}var qT=Object.defineProperty,UT=Object.defineProperties,HT=Object.getOwnPropertyDescriptors,Ad=Object.getOwnPropertySymbols,VT=Object.prototype.hasOwnProperty,WT=Object.prototype.propertyIsEnumerable,$d=(r,e,t)=>e in r?qT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,GT=(r,e)=>{for(var t in e||(e={}))VT.call(e,t)&&$d(r,t,e[t]);if(Ad)for(var t of Ad(e))WT.call(e,t)&&$d(r,t,e[t]);return r},KT=(r,e)=>UT(r,HT(e));class Mr{constructor(){this.usageData=new Map,this.STORAGE_KEY="inventory_usage_data",this.loadUsageData()}static getInstance(){return Mr.instance||(Mr.instance=new Mr),Mr.instance}loadUsageData(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e),n=Object.fromEntries(Object.entries(t).map(([a,i])=>{const c=i;return[a,KT(GT({},c),{lastUsed:new Date(c.lastUsed)})]}));this.usageData=new Map(Object.entries(n))}}catch(e){console.error(e),console.warn("Failed to load usage data:")}}saveUsageData(){try{const e=Object.fromEntries(this.usageData);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error(e),console.warn("Failed to save usage data:")}}getOrCreateUsageData(e){const t=this.usageData.get(e);if(!t){const n={itemId:e,usageCount:0,lastUsed:new Date,searchCount:0,favoriteCount:0,trackCount:0};return this.usageData.set(e,n),n}return t}trackItemView(e){const t=this.getOrCreateUsageData(e);t.usageCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemSearch(e){const t=this.getOrCreateUsageData(e);t.searchCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemFavorite(e){const t=this.getOrCreateUsageData(e);t.favoriteCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemTrack(e){const t=this.getOrCreateUsageData(e);t.trackCount+=1,t.lastUsed=new Date,this.saveUsageData()}calculateSmartScore(e){const t=this.usageData.get(e);if(!t)return 0;const n=new Date;let a;try{a=t.lastUsed instanceof Date?t.lastUsed:new Date(t.lastUsed),isNaN(a.getTime())&&(a=new Date)}catch(l){console.error(l),a=new Date}const i=(n.getTime()-a.getTime())/(1e3*60*60*24);let c=t.usageCount*10;return i<=7&&(c+=50),c+=t.searchCount*5,c+=t.favoriteCount*20,c+=t.trackCount*15,i>30&&(c*=.8),Math.round(c)}getSmartRanking(e){return[...e].sort((t,n)=>{var a,i,c,l,o,d,u,h;const p=t.toolId||t.supplyId||t.equipmentId||t.hardwareId||((a=t.data)==null?void 0:a.toolId)||((i=t.data)==null?void 0:i.supplyId)||((c=t.data)==null?void 0:c.equipmentId)||((l=t.data)==null?void 0:l.hardwareId)||"",f=n.toolId||n.supplyId||n.equipmentId||n.hardwareId||((o=n.data)==null?void 0:o.toolId)||((d=n.data)==null?void 0:d.supplyId)||((u=n.data)==null?void 0:u.equipmentId)||((h=n.data)==null?void 0:h.hardwareId)||"",g=this.calculateSmartScore(p);return this.calculateSmartScore(f)-g})}getUsageStats(){return Object.fromEntries(this.usageData)}clearUsageData(){this.usageData.clear(),localStorage.removeItem(this.STORAGE_KEY)}}const QT=Mr.getInstance(),YT=Object.freeze(Object.defineProperty({__proto__:null,usageTrackingService:QT},Symbol.toStringTag,{value:"Module"}));var Oe=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Is{static fetchRooms(){return Oe(this,null,function*(){return kr.fetchRooms()})}static fetchChecklists(){return Oe(this,null,function*(){return LT.fetchChecklists()})}static updateRoomStatus(e,t){return Oe(this,null,function*(){return kr.updateRoomStatus(e,t)})}static completeRoomCleaning(e){return Oe(this,null,function*(){return kr.completeRoomCleaning(e)})}static fetchAnalytics(){return Oe(this,null,function*(){return jn.fetchAnalytics()})}static getRoomCountsByStatus(){return Oe(this,null,function*(){return jn.getRoomCountsByStatus()})}static getRecentlyCompletedCleanings(e=10){return Oe(this,null,function*(){return jn.getRecentlyCompletedCleanings(e)})}static getCleaningEfficiencyTrends(e=7){return Oe(this,null,function*(){return jn.getCleaningEfficiencyTrends(e)})}static fetchRecentlyCleanedRooms(e=10){return Oe(this,null,function*(){return Rd.fetchRecentlyCleanedRooms(e)})}static scanRoomBarcode(e){return Oe(this,null,function*(){return Rd.scanRoomBarcode(e)})}static createEnvironmentalClean(e){return Oe(this,null,function*(){return kr.createEnvironmentalClean(e)})}static updateEnvironmentalClean(e,t){return Oe(this,null,function*(){return kr.updateEnvironmentalClean(e,t)})}static deleteEnvironmentalClean(e){return Oe(this,null,function*(){return kr.deleteEnvironmentalClean(e)})}static batchEnvironmentalCleanAction(e){return Oe(this,arguments,function*({ids:t,action:n}){return BT.batchEnvironmentalCleanAction({ids:t,action:n})})}}var Cn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const nh=()=>{const[r,e]=m.useState([]),[t,n]=m.useState([]),[a,i]=m.useState(null),[c,l]=m.useState(!1),[o,d]=m.useState(null),u=(y,v)=>{const b=Ct(y,v);d(b.message),console.error(`âŒ ${v} failed:`,b)},h=m.useCallback(()=>Cn(null,null,function*(){try{l(!0),d(null);const y=yield Is.fetchRooms();e(y)}catch(y){u(y,"fetchRooms")}finally{l(!1)}}),[]),p=m.useCallback(()=>Cn(null,null,function*(){try{l(!0),d(null);const y=yield Is.fetchChecklists();n(y)}catch(y){u(y,"fetchChecklists")}finally{l(!1)}}),[]),f=m.useCallback(()=>Cn(null,null,function*(){try{l(!0),d(null);const y=yield Is.fetchAnalytics();i(y)}catch(y){u(y,"fetchAnalytics")}finally{l(!1)}}),[]),g=m.useCallback(()=>Cn(null,null,function*(){Promise.all([h(),p(),f()]).catch(y=>{console.error("Background data refresh failed:",y)})}),[h,p,f]);return m.useEffect(()=>{const y=setTimeout(()=>{g()},0);return()=>clearTimeout(y)},[g]),{rooms:r,checklists:t,analytics:a,loading:c,error:o,fetchRooms:h,fetchChecklists:p,fetchAnalytics:f,refreshData:g}};function JT(r=[]){const[e,t]=m.useState(""),[n,a]=m.useState("all"),[i,c]=m.useState(1),l=20,o=m.useMemo(()=>r.filter(g=>{const y=e===""||g.id.toLowerCase().includes(e.toLowerCase())||g.status.toLowerCase().includes(e.toLowerCase()),v=n==="all"||g.status===n;return y&&v}),[r,e,n]),d=Math.ceil(o.length/l),u=m.useMemo(()=>{const g=(i-1)*l;return o.slice(g,g+l)},[o,i]),h=m.useCallback(g=>{t(g),c(1)},[]),p=m.useCallback(g=>{a(g),c(1)},[]),f=m.useCallback(g=>{c(g)},[]);return{searchTerm:e,status:n,paginatedItems:u,onSearchChange:h,onStatusChange:p,currentPage:i,totalPages:d,onPageChange:f}}var XT=Object.defineProperty,ZT=Object.defineProperties,eE=Object.getOwnPropertyDescriptors,Md=Object.getOwnPropertySymbols,tE=Object.prototype.hasOwnProperty,rE=Object.prototype.propertyIsEnumerable,Fd=(r,e,t)=>e in r?XT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ld=(r,e)=>{for(var t in e||(e={}))tE.call(e,t)&&Fd(r,t,e[t]);if(Md)for(var t of Md(e))rE.call(e,t)&&Fd(r,t,e[t]);return r},zd=(r,e)=>ZT(r,eE(e)),sE=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function nE(){return gp({mutationFn:r=>sE(null,null,function*(){try{const e=new Date().toISOString(),t=r.operator||"Unknown Operator",n=zd(Ld({},r),{timestamp:e,operator:t,module:"environmental_clean",category:"environmental_clean"}),a=[Promise.resolve().then(()=>{try{st.log("environmental_clean",r.action,zd(Ld({},r.item),{operator:t,roomId:r.roomId,status:r.status,metadata:r.metadata,timestamp:e}))}catch(c){console.warn("Audit logger failed:",c)}})];return Promise.allSettled(a).catch(()=>{}),{success:!0,auditId:`EC-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:e}}catch(e){return console.error("âŒ Failed to log Environmental Clean audit:",e),console.warn("âš ï¸ Audit logging failed, using console fallback:",r),{success:!1,error:e instanceof Error?e.message:"Unknown audit error"}}}),retry:2,retryDelay:1e3,onMutate:()=>{},onError:r=>{console.error("âŒ Environmental Clean audit failed:",r)},onSuccess:r=>{}})}const aE=({onScan:r})=>s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Environmental Clean"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage room cleaning workflows and maintain compliance standards."})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsx("span",{className:"text-gray-600",children:"Room Scanner"}),s.jsx(Hi,{variant:"success",onClick:r,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Scan Room"})]})]}),St={borderLeftColor:"rgba(78, 205, 196, 0.5)",primaryIconColor:"#4ECDC4",defaultBorderColor:"border-gray-200"},ah={error:{light:"#fee2e2"},info:{light:"#dbeafe"}},Ts=r=>e=>{e.key==="Enter"&&(e.preventDefault(),r())},ih=r=>e=>{e.key===" "&&(e.preventDefault(),r())},oh=(r,e,t=0)=>{const[n,a]=m.useState(t),i=m.useCallback(c=>{switch(c.key){case"ArrowDown":c.preventDefault(),a(l=>(l+1)%r.length);break;case"ArrowUp":c.preventDefault(),a(l=>(l-1+r.length)%r.length);break;case"Home":c.preventDefault(),a(0);break;case"End":c.preventDefault(),a(r.length-1);break;case"Enter":case" ":c.preventDefault(),e(r[n],n);break}},[r,n,e]);return{selectedIndex:n,setSelectedIndex:a,handleKeyDown:i}},iE=(r,e,t)=>{const n=m.useCallback(a=>{if(r)switch(a.key){case"Escape":e();break}},[r,e,t]);return m.useEffect(()=>(document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)),[n]),{handleKeyDown:n}},oE=(r,e)=>e?`${r} ${e}`:r;var lE=Object.defineProperty,cE=Object.defineProperties,dE=Object.getOwnPropertyDescriptors,Bd=Object.getOwnPropertySymbols,uE=Object.prototype.hasOwnProperty,mE=Object.prototype.propertyIsEnumerable,qd=(r,e,t)=>e in r?lE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hE=(r,e)=>{for(var t in e||(e={}))uE.call(e,t)&&qd(r,t,e[t]);if(Bd)for(var t of Bd(e))mE.call(e,t)&&qd(r,t,e[t]);return r},pE=(r,e)=>cE(r,dE(e)),fE=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const lh=m.createContext(void 0);function ch(){const r=m.useContext(lh);if(!r)throw new Error("useRoomStatus must be used within a RoomStatusProvider");return r}const gE=({children:r})=>{const{rooms:e}=nh(),[t,n]=m.useState([]),[a,i]=m.useState([]);m.useEffect(()=>{const h=e.map(p=>({id:p.id,status:p.status,name:p.name,metadata:p.metadata}));n(h)},[e]),m.useEffect(()=>{fE(null,null,function*(){try{const p=yield Is.fetchRecentlyCleanedRooms(10);i(p)}catch(p){console.error("Failed to fetch recently cleaned rooms:",p)}})},[]);const c=m.useCallback((h,p)=>{if(n(f=>f.map(g=>g.id===h?pE(hE({},g),{status:p}):g)),p==="Clean"){const f=e.find(v=>v.id===h),y={room:f?f.name:`Room ${h}`,cleanedAt:new Date().toISOString(),cleanedBy:"Current User"};i(v=>[y,...v.slice(0,9)])}},[e]),l=m.useCallback(()=>t.filter(h=>h.status==="Clean").length,[t]),o=m.useCallback(()=>t.filter(h=>h.status==="Dirty").length,[t]),d=m.useCallback(()=>{const h=t.length,p=l();return h>0?Math.round(p/h*100):0},[t,l]),u={rooms:t,recentlyCleanedRooms:a,updateRoomStatus:c,getCleanRoomsCount:l,getDirtyRoomsCount:o,getEfficiency:d};return s.jsx(lh.Provider,{value:u,children:r})};var yE=Object.defineProperty,vE=Object.defineProperties,xE=Object.getOwnPropertyDescriptors,Ud=Object.getOwnPropertySymbols,bE=Object.prototype.hasOwnProperty,_E=Object.prototype.propertyIsEnumerable,Hd=(r,e,t)=>e in r?yE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ys=(r,e)=>{for(var t in e||(e={}))bE.call(e,t)&&Hd(r,t,e[t]);if(Ud)for(var t of Ud(e))_E.call(e,t)&&Hd(r,t,e[t]);return r},Vd=(r,e)=>vE(r,xE(e)),Xt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const wi=Nt()(Xn((r,e)=>({statusTypes:[],isLoading:!1,error:null,fetchStatusTypes:()=>Xt(null,null,function*(){r({isLoading:!0,error:null});try{r({statusTypes:[{id:"1",name:"Available",color:"#10B981",icon:"check-circle",description:"Item is available and ready for use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"2",name:"In Use",color:"#6B7280",icon:"pause-circle",description:"Item is currently in use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"3",name:"Maintenance",color:"#F59E0B",icon:"wrench",description:"Item requires maintenance",isDefault:!0,isCore:!0,isPublished:!0,category:"maintenance",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{id:"4",name:"Critical",color:"#EF4444",icon:"exclamation-triangle",description:"Item has critical issues",isDefault:!0,isCore:!0,isPublished:!0,category:"critical",requiresVerification:!0,autoTransition:!1,alertLevel:"critical"}],isLoading:!1})}catch(t){console.error("âŒ Error fetching status types:",t),r({error:t instanceof Error?t.message:"Failed to fetch status types",isLoading:!1})}}),refreshStatusTypes:()=>Xt(null,null,function*(){yield e().fetchStatusTypes()}),getCoreStatusTypes:()=>e().statusTypes.filter(t=>t.isCore),getPublishedStatusTypes:()=>e().statusTypes.filter(t=>t.isPublished),getCustomStatusTypes:()=>e().statusTypes.filter(t=>!t.isCore),getStatusTypesByCategory:t=>e().statusTypes.filter(n=>n.category===t),getAllStatusTypes:()=>e().statusTypes,addStatusType:t=>Xt(null,null,function*(){try{const n=ys({id:Date.now().toString()},t);r(a=>({statusTypes:[...a.statusTypes,n]}))}catch(n){throw console.error("Error adding status type:",n),n}}),updateStatusType:(t,n)=>Xt(null,null,function*(){const a=e().statusTypes.find(i=>i.id===t);if(a&&a.isCore){console.warn("Cannot update core status types");return}try{r(i=>({statusTypes:i.statusTypes.map(c=>c.id===t?ys(ys({},c),n):c)}))}catch(i){throw console.error("Error updating status type:",i),i}}),deleteStatusType:t=>Xt(null,null,function*(){const n=e().statusTypes.find(a=>a.id===t);if(n&&n.isCore){console.warn("Cannot delete core status types");return}try{r(a=>({statusTypes:a.statusTypes.filter(i=>i.id!==t)}))}catch(a){throw console.error("Error deleting status type:",a),a}}),publishStatusType:t=>Xt(null,null,function*(){const n=e().statusTypes.find(a=>a.id===t);if(n&&n.isCore){console.warn("Core status types are always published");return}try{r(a=>({statusTypes:a.statusTypes.map(i=>i.id===t?Vd(ys({},i),{isPublished:!0}):i)}))}catch(a){throw console.error("Error publishing status type:",a),a}}),unpublishStatusType:t=>Xt(null,null,function*(){const n=e().statusTypes.find(a=>a.id===t);if(n&&n.isCore){console.warn("Cannot unpublish core status types");return}try{r(a=>({statusTypes:a.statusTypes.map(i=>i.id===t?Vd(ys({},i),{isPublished:!1}):i)}))}catch(a){throw console.error("Error unpublishing status type:",a),a}}),getStatusTypeById:t=>e().statusTypes.find(n=>n.id===t),getStatusTypeByName:t=>e().statusTypes.find(n=>n.name===t),getCategories:()=>{const t=new Set(e().statusTypes.map(n=>n.category).filter(Boolean));return Array.from(t).filter(n=>n!==void 0).sort()}}),{name:"status-types-storage",partialize:()=>({})})),dh=()=>{const r=wi();return m.useEffect(()=>{r.statusTypes.length===0&&!r.isLoading&&r.fetchStatusTypes()},[r]),r},uh=()=>({iconMap:{default:tt,broom:zu,"progress-clock":Fp,"check-circle":It,biohazard:Mp,"shield-alert":tt,"package-variant":$p,wrench:Ap,"office-building":Lu,"account-supervisor":tt,"shield-lock":tt,"shield-cross":tt,"help-circle":tt,"alert-circle":tt,account:tt,"clipboard-check":tt},colorMap:{"#16a34a":"#16a34a","#dc2626":"#dc2626","#ca8a04":"#ca8a04","#9333ea":"#9333ea","#4b5563":"#4b5563","#b45309":"#b45309","#047857":"#047857","#8B5CF6":"#8B5CF6","#EA580C":"#EA580C","#9CA3AF":"#9CA3AF","#059669":"#059669","#3B82F6":"#3B82F6","#F59E0B":"#F59E0B"},bgColorMap:{"#16a34a":"bg-green-100","#dc2626":"bg-red-100","#ca8a04":"bg-yellow-100","#9333ea":"bg-purple-100","#4b5563":"bg-gray-100","#b45309":"bg-amber-100","#047857":"bg-emerald-100","#8B5CF6":"bg-purple-100","#EA580C":"bg-amber-100","#9CA3AF":"bg-gray-100","#059669":"bg-green-100","#3B82F6":"bg-blue-100","#F59E0B":"bg-amber-100"},borderColorMap:{"#16a34a":"border-green-500","#dc2626":"border-red-500","#ca8a04":"border-yellow-500","#9333ea":"border-purple-500","#4b5563":"border-gray-500","#b45309":"border-amber-500","#047857":"border-emerald-500","#8B5CF6":"border-purple-500","#EA580C":"border-amber-500","#9CA3AF":"border-gray-500","#059669":"border-green-500","#3B82F6":"border-blue-500","#F59E0B":"border-amber-500"},bgColorSelectedMap:{"#16a34a":"bg-green-50","#dc2626":"bg-red-50","#ca8a04":"bg-yellow-50","#9333ea":"bg-purple-50","#4b5563":"bg-gray-50","#b45309":"bg-amber-50","#047857":"bg-emerald-50","#8B5CF6":"bg-purple-50","#EA580C":"bg-amber-50","#9CA3AF":"bg-gray-50","#059669":"bg-green-50","#3B82F6":"bg-blue-50","#F59E0B":"bg-amber-50"},textColorMap:{"#16a34a":"text-green-600","#dc2626":"text-red-600","#ca8a04":"text-yellow-600","#9333ea":"text-purple-600","#4b5563":"text-gray-600","#b45309":"text-amber-600","#047857":"text-emerald-600","#8B5CF6":"text-purple-600","#EA580C":"text-amber-600","#9CA3AF":"text-gray-600","#059669":"text-green-600","#3B82F6":"text-blue-600","#F59E0B":"text-amber-600"}}),wE=(r,e)=>e[r]||tt,SE=(r,e)=>e[r]||"bg-gray-100",jE=(r,e)=>e[r]||"text-gray-600",CE=()=>{const{getCoreStatusTypes:r,getPublishedStatusTypes:e,statusTypes:t,isLoading:n}=dh(),a=uh();return m.useMemo(()=>{const i=r(),c=e(),l=h=>h.map(p=>{const f=a.iconMap[p.icon]||a.iconMap.default;return{value:p.id,name:p.name,bgColor:a.bgColorMap[p.color]||a.bgColorMap.default,bgColorSelected:a.bgColorSelectedMap[p.color]||a.bgColorSelectedMap.default,borderColor:a.borderColorMap[p.color]||a.borderColorMap.default,color:a.colorMap[p.color]||a.colorMap.default,icon:f,isCore:p.isCore||!1}}),o=l(i),d=l(c),u=[...o];return d.forEach(h=>{u.find(p=>p.value===h.value)||u.push(h)}),u},[r,e,a.bgColorMap,a.bgColorSelectedMap,a.borderColorMap,a.colorMap,a.iconMap])},NE=()=>{const{getCoreStatusTypes:r,getPublishedStatusTypes:e}=dh(),t=uh();return m.useMemo(()=>{const n=r(),a=e();return[...n,...a.filter(c=>!c.isCore)].map(c=>({status:c.name,icon:wE(c.icon,t.iconMap),color:c.color,bgColor:SE(c.color,t.bgColorMap),textColor:jE(c.color,t.textColorMap),isCore:c.isCore}))},[r,e,t.bgColorMap,t.iconMap,t.textColorMap])},IE=(r,e)=>r.filter(t=>t.status===e).length,TE=(r,e)=>{var t,n;if(r.name)return{name:r.name,department:((t=r.metadata)==null?void 0:t.department)||"",floor:((n=r.metadata)==null?void 0:n.floor)||""};const a=e.find(i=>(i.barcode||i.id)===r.id);return{name:a?a.name:`Room ${r.id}`,department:a&&a.department||"",floor:a&&a.floor||""}},EE=({isOpen:r,onClose:e,onUpdate:t,currentStatus:n})=>{const[a,i]=m.useState([]);iE(r,e);const c=CE(),{selectedIndex:l,handleKeyDown:o}=oh(c,h=>{const p=h.value;i(f=>f.includes(p)?f.filter(g=>g!==p):[...f,p])},0),d=h=>{i(p=>p.includes(h)?p.filter(f=>f!==h):[...p,h])},u=()=>{t(a),e()};return r?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"status-modal-title","aria-describedby":"status-modal-description",children:s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",role:"document",children:[s.jsx("h3",{id:"status-modal-title",className:"text-lg font-semibold mb-4",children:"Update Room Status"}),s.jsx("div",{id:"status-modal-description",className:"sr-only",children:"Select room statuses using arrow keys to navigate and Enter or Space to select. Use Tab to move between options."}),s.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",role:"grid","aria-label":"Status options",onKeyDown:o,tabIndex:0,children:c.map((h,p)=>s.jsx("button",{className:`p-3 rounded-lg border transition-colors focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] ${a.includes(h.value)?`${h.bgColor} ${h.borderColor}`:n===h.value?`${h.borderColor} ${h.bgColorSelected}`:St.defaultBorderColor} ${l===p?"ring-2 ring-[#4ECDC4]":""}`,onClick:()=>d(h.value),onKeyDown:f=>{Ts(()=>d(h.value))(f),ih(()=>d(h.value))(f)},role:"gridcell","aria-selected":a.includes(h.value),tabIndex:l===p?0:-1,"aria-label":oE("Select status",h.name),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:h.icon,size:.8,color:h.color,"aria-hidden":"true"}),s.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[s.jsx("span",{className:"truncate",children:h.name}),h.isCore&&s.jsx(N,{path:Bu,size:.5,className:"text-gray-200 flex-shrink-0 ml-1",title:"Core status - always available"})]})]})},h.value))}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:e,onKeyDown:Ts(e),className:"px-4 py-2 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 rounded","aria-label":"Cancel status update",children:"Cancel"}),s.jsx("button",{onClick:u,onKeyDown:Ts(u),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":"Update room status",children:"Update"})]})]})}):null},kE=({status:r,icon:e,color:t,bgColor:n,textColor:a,isCore:i,roomCount:c,onClick:l,isSelected:o})=>s.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200 shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-0.5 cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] min-h-[80px] min-w-[80px] relative group",onClick:l,role:"gridcell",tabIndex:o?0:-1,"aria-label":`${r} rooms: ${c} rooms`,title:r,onKeyDown:d=>{Ts(l)(d),ih(l)(d)},children:[s.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-white text-gray-800 text-xs rounded border border-gray-300 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[r,s.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-300"})]}),s.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[s.jsx("div",{className:`${n} rounded-full p-2 mb-2`,children:s.jsx(N,{path:e,size:1,color:t,"aria-hidden":"true"})}),s.jsx("div",{className:`text-2xl font-bold ${a}`,children:c})]}),i&&s.jsx("div",{className:"absolute top-1 right-1",children:s.jsx(N,{path:Bu,size:.4,className:"text-gray-300",title:"Core status - always available"})})]}),DE=({status:r,rooms:e,onUpdateStatus:t})=>{const{getActiveRooms:n}=Qi(),a=n(),i=e.filter(c=>c.status===r);return s.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",role:"region","aria-label":`${r} rooms details`,children:[s.jsxs("h3",{className:"text-lg font-medium mb-3",children:[r," Rooms"]}),s.jsxs("div",{className:"space-y-2",children:[i.map(c=>{const{name:l,department:o,floor:d}=TE(c,a);return s.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("span",{className:"text-sm font-medium",children:l}),(o||d)&&s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[o&&s.jsx("span",{children:o}),o&&d&&s.jsx("span",{children:" â€¢ "}),d&&s.jsx("span",{children:d})]})]}),s.jsx("button",{onClick:()=>t(c.id),onKeyDown:Ts(()=>t(c.id)),className:"text-xs text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded ml-2","aria-label":`Update status for ${l}`,children:"Update Status"})]},c.id)}),i.length===0&&s.jsx("p",{className:"text-sm text-gray-500",children:"No rooms with this status"})]})]})},PE=()=>{const{rooms:r,updateRoomStatus:e}=ch(),[t,n]=m.useState(null),[a,i]=m.useState(null),[c,l]=m.useState(!1),o=NE(),{selectedIndex:d,handleKeyDown:u}=oh(o,g=>p(g.status),0),h=(g,y)=>{if(y.length>0){const v=y[0];e(g,v)}},p=g=>{n(t===g?null:g)},f=g=>{i(g),l(!0)};return s.jsxs("div",{id:"room-status-summary",className:"bg-white rounded-lg shadow p-6 mb-6 relative",style:{borderLeft:`4px solid ${St.borderLeftColor}`},role:"region","aria-label":"Room status summary",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:li,size:1.1,color:St.primaryIconColor,className:"mr-2"}),"Room Status Summary"]}),s.jsx("div",{className:"grid grid-cols-4 gap-4",role:"grid","aria-label":"Status summary cards",onKeyDown:u,tabIndex:0,children:o.map((g,y)=>s.jsx(kE,{status:g.status,icon:g.icon,color:g.color,bgColor:g.bgColor,textColor:g.textColor,isCore:g.isCore,roomCount:IE(r,g.status),onClick:()=>p(g.status),isSelected:d===y,index:y},g.status))}),t&&s.jsx(DE,{status:t,rooms:r,onUpdateStatus:f}),s.jsx(EE,{isOpen:c,onClose:()=>l(!1),onUpdate:g=>{a&&h(a,g)},currentStatus:t||"Available"})]})},OE=()=>s.jsx("div",{className:"flex-1",children:s.jsx(PE,{})});var Wd=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function RE(){const[r,e]=m.useState({totalRooms:0,cleanRooms:0,dirtyRooms:0,inProgressRooms:0,cleaningEfficiency:0,averageCleaningTime:0,lastUpdated:new Date().toISOString()}),[t,n]=m.useState(!0),[a,i]=m.useState(null),c=m.useCallback(()=>Wd(null,null,function*(){try{n(!0),i(null);const o=yield Is.fetchAnalytics();e(o)}catch(o){i("Failed to load analytics"),console.error("Error fetching analytics:",o)}finally{n(!1)}}),[]),l=m.useCallback(()=>Wd(null,null,function*(){yield c()}),[c]);return m.useEffect(()=>{c()},[c]),{analytics:r,isLoading:t,error:a,refreshAnalytics:l}}const AE=()=>{const{analytics:r,isLoading:e,error:t,refreshAnalytics:n}=RE();return e?s.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${St.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:sa,size:1.1,color:St.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:s.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})}),s.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:s.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})}),s.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:s.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})})]})]}):t?s.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${St.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:sa,size:1.1,color:St.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),s.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Refresh analytics",children:s.jsx(N,{path:pt,size:.8,className:"text-gray-600"})})]}),s.jsx("div",{className:"text-red-600 text-sm text-center py-4",children:t})]}):s.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${St.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:sa,size:1.1,color:St.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),s.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Refresh analytics",children:s.jsx(N,{path:pt,size:.8,className:"text-gray-600"})})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-2",role:"group","aria-label":"Analytics metrics",children:[s.jsxs("div",{className:"p-2 bg-green-100 rounded-lg text-center",role:"status","aria-label":`Clean rooms: ${r.cleanRooms}`,children:[s.jsx("h3",{className:"text-sm text-green-700 font-medium mb-1",children:"Clean Rooms"}),s.jsx("p",{className:"text-xl font-bold text-green-700",children:r.cleanRooms})]}),s.jsxs("div",{className:"p-2 bg-orange-100 rounded-lg text-center",role:"status","aria-label":`Dirty rooms: ${r.dirtyRooms}`,children:[s.jsx("h3",{className:"text-sm text-orange-700 font-medium mb-1",children:"Dirty Rooms"}),s.jsx("p",{className:"text-xl font-bold text-orange-700",children:r.dirtyRooms})]}),s.jsxs("div",{className:"p-2 bg-purple-100 rounded-lg text-center",role:"status","aria-label":`Efficiency: ${r.cleaningEfficiency}%`,children:[s.jsx("h3",{className:"text-sm text-purple-700 font-medium mb-1",children:"Efficiency"}),s.jsxs("p",{className:"text-xl font-bold text-purple-700",children:[r.cleaningEfficiency,"%"]})]})]}),s.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-center",children:["Last updated: ",new Date(r.lastUpdated).toLocaleTimeString()]})]})},$E=()=>{const{recentlyCleanedRooms:r}=ch(),e=m.useRef(null),t=!1,n=()=>{e.current&&(e.current.scrollTop=0)},a=()=>{console.log("Refreshing recently cleaned rooms...")};return s.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6 relative",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsxs("div",{className:"sticky top-0 bg-white pb-1 flex justify-between items-center",children:[s.jsxs("h2",{className:"text-lg font-semibold mb-1 text-[#5b5b5b] flex items-center",children:[s.jsx(N,{path:An,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Recently Cleaned Rooms"]}),s.jsx("button",{onClick:a,className:"p-1 text-gray-500 hover:text-[#4ECDC4] transition-colors",title:"Refresh data",disabled:t,children:s.jsx(N,{path:pt,size:.8,className:""})})]}),s.jsx("div",{className:"overflow-y-auto [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",style:{maxHeight:"120px"},ref:e,children:r.length===0?s.jsx("p",{className:"text-gray-500 text-sm py-1",children:"No rooms cleaned recently"}):s.jsx("div",{className:"space-y-1",children:r.map((i,c)=>s.jsx("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg relative",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"relative",children:s.jsxs("span",{className:"font-medium text-gray-700 cursor-help hover:text-brand-primary transition-colors group",children:[i.room,s.jsxs("div",{className:"hidden group-hover:block absolute left-0 top-full mt-1 bg-white rounded-lg shadow-xl border border-gray-200 p-3 w-64 z-50",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(N,{path:Au,size:.8,color:"#4ECDC4"}),s.jsx("span",{className:"font-medium text-gray-800",children:i.cleanedBy})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{path:An,size:.8,color:"#4ECDC4"}),s.jsx("span",{className:"text-sm text-gray-600",children:new Date(i.cleanedAt).toLocaleString()})]})]})]})}),s.jsx(N,{path:It,size:.8,color:"#4ECDC4"})]})},c))})}),s.jsx("button",{onClick:n,className:"absolute bottom-2 right-2 p-1.5 bg-brand-primary text-white rounded-full shadow-md hover:bg-brand-primary transition-colors",title:"Scroll to most recent",children:s.jsx(N,{path:Lp,size:.8,className:"opacity-70"})})]})},ME=()=>s.jsxs("div",{className:"flex-1",children:[s.jsx(AE,{}),s.jsx("div",{className:"mt-4",children:s.jsx($E,{})})]});var FE=Object.defineProperty,LE=Object.defineProperties,zE=Object.getOwnPropertyDescriptors,Gd=Object.getOwnPropertySymbols,BE=Object.prototype.hasOwnProperty,qE=Object.prototype.propertyIsEnumerable,Kd=(r,e,t)=>e in r?FE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zt=(r,e)=>{for(var t in e||(e={}))BE.call(e,t)&&Kd(r,t,e[t]);if(Gd)for(var t of Gd(e))qE.call(e,t)&&Kd(r,t,e[t]);return r},Dr=(r,e)=>LE(r,zE(e));class UE{constructor(e=[]){this.checklists=[],this.checklists=e}getAllChecklists(){return[...this.checklists]}getChecklistById(e){return this.checklists.find(t=>t.id===e)}getChecklistsByCategory(e){return this.checklists.filter(t=>t.category===e)}getPublishedChecklistsByCategory(e){return this.checklists.filter(t=>t.category===e&&t.status==="published")}getChecklistsByStatus(e){return this.checklists.filter(t=>t.status===e)}addChecklist(e){const t=Dr(Zt({},e),{status:"draft",id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});return this.checklists.push(t),t}updateChecklist(e,t){const n=this.checklists.findIndex(i=>i.id===e);if(n===-1)return null;const a=Dr(Zt(Zt({},this.checklists[n]),t),{updatedAt:new Date().toISOString()});return this.checklists[n]=a,a}deleteChecklist(e){const t=this.checklists.findIndex(n=>n.id===e);return t===-1?!1:(this.checklists.splice(t,1),!0)}publishChecklist(e){return this.updateChecklist(e,{status:"published",updatedAt:new Date().toISOString()})}unpublishChecklist(e){return this.updateChecklist(e,{status:"draft",updatedAt:new Date().toISOString()})}duplicateChecklist(e,t){const n=this.getChecklistById(e);if(!n)return null;const a=Dr(Zt({},n),{id:this.generateId(),title:t||`${n.title} (Copy)`,status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:n.items.map(i=>Dr(Zt({},i),{id:this.generateId(),completed:!1,skipped:!1}))});return this.checklists.push(a),a}getChecklistStatistics(){const e=this.checklists.length,t=this.checklists.filter(l=>l.status==="published").length,n=this.checklists.filter(l=>l.status==="draft").length,a=this.checklists.reduce((l,o)=>(l[o.category]=(l[o.category]||0)+1,l),{}),i=this.checklists.reduce((l,o)=>l+o.items.length,0),c=e>0?i/e:0;return{total:e,published:t,draft:n,byCategory:a,averageItemsPerChecklist:c,totalItems:i}}searchChecklists(e){const t=e.toLowerCase();return this.checklists.filter(n=>n.title.toLowerCase().includes(t)||n.items.some(a=>a.title.toLowerCase().includes(t)||a.instructions.toLowerCase().includes(t)))}filterChecklists(e){return this.checklists.filter(t=>!(e.category&&t.category!==e.category||e.status&&t.status!==e.status||e.hasScheduling!==void 0&&!!(t.autoSchedule||t.scheduleFrequency)!==e.hasScheduling||e.minItems!==void 0&&t.items.length<e.minItems||e.maxItems!==void 0&&t.items.length>e.maxItems))}sortChecklists(e,t,n="asc"){return[...e].sort((a,i)=>{let c=0;switch(t){case"title":c=a.title.localeCompare(i.title);break;case"createdAt":c=new Date(a.createdAt).getTime()-new Date(i.createdAt).getTime();break;case"updatedAt":c=new Date(a.updatedAt).getTime()-new Date(i.updatedAt).getTime();break;case"category":c=a.category.localeCompare(i.category);break;case"status":c=a.status.localeCompare(i.status);break}return n==="desc"?-c:c})}exportChecklists(e){const t=e?this.checklists.filter(n=>e.includes(n.id)):this.checklists;return JSON.stringify(t,null,2)}importChecklists(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,imported:[],errors:["Invalid format: expected array of checklists"]};const n=[],a=[];return t.forEach((i,c)=>{const l=this.validateChecklist(i);if(!l.isValid)n.push(`Checklist ${c+1}: ${l.errors.join(", ")}`);else{const o=Dr(Zt({},i),{id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:i.items.map(d=>Dr(Zt({},d),{id:this.generateId()}))});a.push(o)}}),a.length>0&&this.checklists.push(...a),{success:n.length===0,imported:a,errors:n}}catch(t){return{success:!1,imported:[],errors:["Invalid JSON format"]}}}validateChecklist(e){const t=[];return(!e.title||e.title.trim()==="")&&t.push("Title is required"),e.category?["setup","patient","weekly","public","deep","environmental_cleaning"].includes(e.category)||t.push(`Invalid category: ${e.category}`):t.push("Category is required"),!e.items||!Array.isArray(e.items)?t.push("Items array is required"):e.items.length===0&&t.push("At least one item is required"),{isValid:t.length===0,errors:t}}getDefaultChecklists(){return[{id:"treatment-room-setup",title:"Treatment Room Setup",category:"setup",status:"published",items:[{id:"clean-surfaces",title:"Clean and sanitize all surfaces with CaviWipes",instructions:"Use 2 wipes per surface. Allow to air dry for 3 minutes.",requiredInventory:[{id:"caviwipes-001",name:"CaviWipes",required:2,available:100,used:0,unit:"wipes"}],sdsId:"caviwipes-sds",skipped:!1,completed:!1},{id:"restock-supplies",title:"Restock Treatment Room Supplies",instructions:"Verify all supplies are present and in date",requiredInventory:[{id:"gloves-001",name:"Nitrile Gloves",required:10,available:500,used:0,unit:"pairs"},{id:"gauze-001",name:"Sterile Gauze",required:5,available:200,used:0,unit:"packs"},{id:"alcohol-001",name:"Alcohol Swabs",required:10,available:300,used:0,unit:"swabs"}],skipped:!1,completed:!1}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}setChecklists(e){this.checklists=[...e]}clearChecklists(){this.checklists=[]}}var HE=Object.defineProperty,VE=Object.defineProperties,WE=Object.getOwnPropertyDescriptors,Qd=Object.getOwnPropertySymbols,GE=Object.prototype.hasOwnProperty,KE=Object.prototype.propertyIsEnumerable,Yd=(r,e,t)=>e in r?HE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,et=(r,e)=>{for(var t in e||(e={}))GE.call(e,t)&&Yd(r,t,e[t]);if(Qd)for(var t of Qd(e))KE.call(e,t)&&Yd(r,t,e[t]);return r},bt=(r,e)=>VE(r,WE(e));class QE{addItemToChecklist(e,t,n){const a=bt(et({},n),{id:this.generateId()});return e.map(i=>i.id===t?bt(et({},i),{items:[...i.items,a],updatedAt:new Date().toISOString()}):i)}updateChecklistItem(e,t,n,a){return e.map(i=>i.id===t?bt(et({},i),{items:i.items.map(c=>c.id===n?et(et({},c),a):c),updatedAt:new Date().toISOString()}):i)}deleteChecklistItem(e,t,n){return e.map(a=>a.id===t?bt(et({},a),{items:a.items.filter(i=>i.id!==n),updatedAt:new Date().toISOString()}):a)}getItemById(e,t,n){const a=e.find(i=>i.id===t);return a&&a.items.find(i=>i.id===n)||null}completeItem(e,t,n){return this.updateChecklistItem(e,t,n,{completed:!0,skipped:!1})}skipItem(e,t,n){return this.updateChecklistItem(e,t,n,{skipped:!0,completed:!1})}resetItem(e,t,n){return this.updateChecklistItem(e,t,n,{completed:!1,skipped:!1})}moveItemUp(e,t,n){return e.map(a=>{if(a.id!==t)return a;const i=[...a.items],c=i.findIndex(l=>l.id===n);return c<=0?a:([i[c],i[c-1]]=[i[c-1],i[c]],bt(et({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemDown(e,t,n){return e.map(a=>{if(a.id!==t)return a;const i=[...a.items],c=i.findIndex(l=>l.id===n);return c===-1||c>=i.length-1?a:([i[c],i[c+1]]=[i[c+1],i[c]],bt(et({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemToPosition(e,t,n,a){return e.map(i=>{if(i.id!==t)return i;const c=[...i.items],l=c.findIndex(d=>d.id===n);if(l===-1)return i;const[o]=c.splice(l,1);return c.splice(a,0,o),bt(et({},i),{items:c,updatedAt:new Date().toISOString()})})}duplicateItem(e,t,n){const a=this.getItemById(e,t,n);if(!a)return e;const i=bt(et({},a),{id:this.generateId(),title:`${a.title} (Copy)`,completed:!1,skipped:!1});return e.map(c=>c.id===t?bt(et({},c),{items:[...c.items,i],updatedAt:new Date().toISOString()}):c)}getItemStatistics(e){let t=0,n=0,a=0,i=0,c=0;e.forEach(d=>{d.items.forEach(u=>{t++,u.completed&&n++,u.skipped&&a++,u.requiredInventory&&u.requiredInventory.length>0&&i++,u.sdsId&&c++})});const l=t-n-a,o=t>0?n/t*100:0;return{totalItems:t,completedItems:n,skippedItems:a,pendingItems:l,completionRate:o,itemsWithInventory:i,itemsWithSDS:c}}getChecklistCompletionStatus(e){const t=e.items.length,n=e.items.filter(o=>o.completed).length,a=e.items.filter(o=>o.skipped).length,i=t-n-a,c=t>0?n/t*100:0;return{totalItems:t,completedItems:n,skippedItems:a,pendingItems:i,completionRate:c,isFullyCompleted:n===t}}validateItem(e){const t=[];return(!e.title||e.title.trim()==="")&&t.push("Title is required"),(!e.instructions||e.instructions.trim()==="")&&t.push("Instructions are required"),e.requiredInventory&&Array.isArray(e.requiredInventory)&&e.requiredInventory.forEach((n,a)=>{(!n.id||n.id.trim()==="")&&t.push(`Inventory item ${a+1}: ID is required`),(!n.name||n.name.trim()==="")&&t.push(`Inventory item ${a+1}: Name is required`),n.required<=0&&t.push(`Inventory item ${a+1}: Required quantity must be greater than 0`),n.available<0&&t.push(`Inventory item ${a+1}: Available quantity cannot be negative`),n.used<0&&t.push(`Inventory item ${a+1}: Used quantity cannot be negative`),n.used>n.available&&t.push(`Inventory item ${a+1}: Used quantity cannot exceed available quantity`)}),{isValid:t.length===0,errors:t}}searchItems(e,t){const n=t.toLowerCase(),a=[];return e.forEach(i=>{i.items.forEach(c=>{var l;c.title.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"title"}):c.instructions.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"instructions"}):(l=c.requiredInventory)!=null&&l.some(o=>o.name.toLowerCase().includes(n))&&a.push({checklist:i,item:c,matchType:"inventory"})})}),a}filterItems(e,t){const n=[];return e.forEach(a=>{t.category&&a.category!==t.category||a.items.forEach(i=>{t.completed!==void 0&&i.completed!==t.completed||t.skipped!==void 0&&i.skipped!==t.skipped||t.hasInventory!==void 0&&!!(i.requiredInventory&&i.requiredInventory.length>0)!==t.hasInventory||t.hasSDS!==void 0&&!!i.sdsId!==t.hasSDS||n.push({checklist:a,item:i})})}),n}sortItems(e,t,n="asc"){return[...e].sort((a,i)=>{var c,l;let o=0;switch(t){case"title":o=a.item.title.localeCompare(i.item.title);break;case"completed":o=(a.item.completed?1:0)-(i.item.completed?1:0);break;case"skipped":o=(a.item.skipped?1:0)-(i.item.skipped?1:0);break;case"inventoryCount":{const d=((c=a.item.requiredInventory)==null?void 0:c.length)||0,u=((l=i.item.requiredInventory)==null?void 0:l.length)||0;o=d-u;break}}return n==="desc"?-o:o})}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}}const er=new UE,Ja=new QE,YE=Nt()(Xn((r,e)=>({checklists:er.getDefaultChecklists(),addChecklist:t=>{const n=er.addChecklist(t);r(a=>({checklists:[...a.checklists,n]}))},updateChecklist:(t,n)=>{r(a=>{const i=er.updateChecklist(t,n);return i?{checklists:a.checklists.map(c=>c.id===t?i:c)}:a})},deleteChecklist:t=>{r(n=>er.deleteChecklist(t)?{checklists:n.checklists.filter(i=>i.id!==t)}:n)},addItemToChecklist:(t,n)=>{r(a=>({checklists:Ja.addItemToChecklist(a.checklists,t,n)}))},updateChecklistItem:(t,n,a)=>{r(i=>({checklists:Ja.updateChecklistItem(i.checklists,t,n,a)}))},deleteChecklistItem:(t,n)=>{r(a=>({checklists:Ja.deleteChecklistItem(a.checklists,t,n)}))},getChecklistsByCategory:t=>er.getChecklistsByCategory(t),publishChecklist:t=>{r(n=>{const a=er.publishChecklist(t);return a?{checklists:n.checklists.map(i=>i.id===t?a:i)}:n})},getPublishedChecklistsByCategory:t=>er.getPublishedChecklistsByCategory(t)}),{name:"checklist-storage"}));var JE=Object.defineProperty,XE=Object.defineProperties,ZE=Object.getOwnPropertyDescriptors,Jd=Object.getOwnPropertySymbols,ek=Object.prototype.hasOwnProperty,tk=Object.prototype.propertyIsEnumerable,Xd=(r,e,t)=>e in r?JE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Xa=(r,e)=>{for(var t in e||(e={}))ek.call(e,t)&&Xd(r,t,e[t]);if(Jd)for(var t of Jd(e))tk.call(e,t)&&Xd(r,t,e[t]);return r},Za=(r,e)=>XE(r,ZE(e));const rk=()=>{const[r,e]=m.useState(null),[t,n]=m.useState(null),[a,i]=m.useState("checklists"),[c,l]=m.useState(""),[o,d]=m.useState(null),[u,h]=m.useState("all"),[p,f]=m.useState(new Set),[g,y]=m.useState({}),[v,b]=m.useState(!1),[x,w]=m.useState(""),[j,I]=m.useState([]),[E,O]=m.useState([]),S=L=>{e(L),n(null),b(!0)},C=L=>{n(L)},D=()=>{e(null),n(null),b(!1)};return{selectedCategory:r,selectedChecklist:t,activeTab:a,searchQuery:c,selectedSDS:o,sdsCategory:u,bypassedItems:p,adjustedQuantities:g,showModal:v,notes:x,stolenItems:j,prnItems:E,setSelectedCategory:e,setSelectedChecklist:n,setActiveTab:i,setSearchQuery:l,setSelectedSDS:d,setSdsCategory:h,setShowModal:b,setNotes:w,handleCategoryClick:S,handleChecklistSelect:C,handleCloseModal:D,handleMarkComplete:()=>{D()},handleBypassItem:L=>{f(Y=>{const G=new Set(Y);return G.has(L)?G.delete(L):G.add(L),G})},handleAdjustQuantity:(L,Y,G)=>{y(q=>Za(Xa({},q),{[`${L}-${Y}`]:(q[`${L}-${Y}`]||0)+G}))},handleAddStolenItem:()=>{I([...j,{item:"",quantity:1,notes:""}])},handleAddPrnItem:()=>{O([...E,{item:"",quantity:1,reason:""}])},handleUpdateStolenItem:(L,Y,G)=>{const q=[...j];q[L]=Za(Xa({},q[L]),{[Y]:G}),I(q)},handleUpdatePrnItem:(L,Y,G)=>{const q=[...E];q[L]=Za(Xa({},q[L]),{[Y]:G}),O(q)},clearStolenItems:()=>{I([])},clearPrnItems:()=>{O([])},clearNotes:()=>{w("")}}},sk=()=>{const[r,e]=m.useState(!1),[t,n]=m.useState(""),a=m.useRef(null),i=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("Speech recognition is not supported in this browser. Please use Chrome or Edge.");return}const o=window.SpeechRecognition||window.webkitSpeechRecognition,d=new o;d.continuous=!0,d.interimResults=!0,d.lang="en-US",d.addEventListener("start",()=>{e(!0),n("")}),d.onresult=u=>{let h="",p="";for(let f=u.resultIndex;f<u.results.length;f++){const g=u.results[f][0].transcript;u.results[f].isFinal?h+=g:p+=g}n(h+p)},d.onerror=u=>{console.error("Speech recognition error:",u.error),e(!1),u.error==="no-speech"&&alert("No speech detected. Please try again.")},d.onend=()=>{e(!1)},a.current=d,d.start()},c=()=>{a.current&&(a.current.stop(),a.current=null),e(!1)},l=o=>{t.trim()&&(o(t),n(""))};return m.useEffect(()=>()=>{a.current&&a.current.stop()},[]),{isListening:r,transcript:t,startSpeechRecognition:i,stopSpeechRecognition:c,applyTranscriptToNotes:l}},nk=[{id:"setup",title:"Setup/Take Down",iconColor:"#FF6B6B",icon:ir},{id:"patient",title:"Per Patient",iconColor:"#4ECDC4",icon:zp},{id:"weekly",title:"Weekly",iconColor:"#45B7D1",icon:Bp},{id:"public",title:"Public Spaces",iconColor:"#96CEB4",icon:Lu},{id:"deep",title:"Deep Clean",iconColor:"#FF9F1C",icon:zu}],ak=[{id:"1",name:"Bleach SDS",category:"Cleaning",lastUpdated:"2024-03-20",url:"/sds/bleach.pdf",sections:[]},{id:"2",name:"Disinfectant SDS",category:"Cleaning",lastUpdated:"2024-03-19",url:"/sds/disinfectant.pdf",sections:[]},{id:"3",name:"Hand Sanitizer SDS",category:"Sanitization",lastUpdated:"2024-03-18",url:"/sds/hand-sanitizer.pdf",sections:[]}],ik=({activeTab:r,onTabChange:e})=>s.jsx("div",{className:"flex justify-between items-center mb-6",children:s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs("button",{className:`pb-2 px-1 font-medium flex items-center ${r==="checklists"?"text-[#5b5b5b] border-b-2 border-[#4ECDC4]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>e("checklists"),type:"button",children:[s.jsx(N,{path:Iu,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Cleaning Checklists"]}),s.jsxs("button",{className:`pb-2 px-1 font-medium flex items-center ${r==="sds"?"text-[#5b5b5b] border-b-2 border-[#4ECDC4]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>e("sds"),type:"button",children:[s.jsx(N,{path:Ye,size:1.1,color:"#4ECDC4",className:"mr-2"}),"SDS Sheets"]})]})}),ok=({categories:r,selectedCategory:e,onCategoryClick:t})=>s.jsx("div",{className:"p-6",children:s.jsx("div",{role:"tablist","aria-label":"Cleaning Category Tabs",className:"grid grid-cols-5 gap-4",children:r.map(n=>s.jsxs("button",{role:"tab","aria-selected":(e==null?void 0:e.id)===n.id,"aria-controls":`panel-${n.id}`,id:`tab-${n.id}`,onClick:()=>t(n),className:`flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors w-full ${(e==null?void 0:e.id)===n.id?"bg-brand-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[s.jsx(N,{path:n.icon,size:1.2,color:n.iconColor}),s.jsx("span",{children:n.title})]},n.id))})}),mh=({item:r,bypassedItems:e,adjustedQuantities:t,onBypassItem:n,onAdjustQuantity:a,onViewSDS:i})=>s.jsx("div",{className:"border-b border-gray-200 py-3",children:s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex-1 px-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("h3",{className:"text-lg font-medium text-[#5b5b5b]",children:r.title}),s.jsx("button",{onClick:()=>n(r.id),className:`ml-4 px-3 py-1 text-sm rounded-full transition-colors ${e.has(r.id)?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"}`,type:"button",children:e.has(r.id)?"Not Needed":"Mark Not Needed"})]}),s.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r.instructions}),r.inventoryItems&&s.jsxs("div",{className:"mt-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Required Items:"}),s.jsx("ul",{className:"mt-1 space-y-1",children:r.inventoryItems.map(c=>{const l=t[`${r.id}-${c.id}`]||0,o=c.requiredQuantity+l;return s.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[s.jsx("span",{className:"w-32",children:c.name}),s.jsx("span",{className:"mx-2",children:"â€¢"}),s.jsxs("span",{children:["Required: ",o]}),s.jsx("span",{className:"mx-2",children:"â€¢"}),s.jsxs("span",{children:["Available: ",c.currentStock]}),c.status&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"mx-2",children:"â€¢"}),s.jsxs("span",{children:["Status: ",c.status]})]}),s.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[s.jsx("button",{onClick:()=>a(r.id,c.id,-1),className:"px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",type:"button",children:"-"}),s.jsx("button",{onClick:()=>a(r.id,c.id,1),className:"px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",type:"button",children:"+"})]})]},c.id)})})]}),r.sds&&s.jsx("div",{className:"mt-2",children:s.jsxs("button",{onClick:()=>i(r.sds),className:"inline-flex items-center text-sm text-[#4ECDC4] hover:text-[#3db8b0]",type:"button",children:[s.jsx(N,{path:Ye,size:1,className:"mr-1"}),"View SDS Sheet"]})})]})})}),lk=({selectedCategory:r,selectedChecklist:e,bypassedItems:t,adjustedQuantities:n,onCategoryClick:a,onChecklistSelect:i,onBypassItem:c,onAdjustQuantity:l,onViewSDS:o,onMarkComplete:d,getChecklistsForCategory:u})=>s.jsxs(s.Fragment,{children:[s.jsx(ok,{categories:nk,selectedCategory:r,onCategoryClick:a}),r&&s.jsxs("div",{role:"tabpanel",id:`panel-${r.id}`,"aria-labelledby":`tab-${r.id}`,className:"p-6 bg-white rounded-lg shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:`${r.iconColor}20`},children:s.jsx(N,{path:r.icon,size:1.5,color:r.iconColor})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r.title})]}),s.jsxs("div",{className:"space-y-4",children:[!e&&s.jsxs("div",{className:"space-y-4",children:[u(r.id).map(h=>s.jsxs("div",{onClick:()=>i(h),onKeyDown:p=>p.key==="Enter"&&i(h),className:"w-full text-left p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",role:"button",tabIndex:0,"aria-label":`Select ${h.title} checklist`,children:[s.jsx("h3",{className:"font-medium text-[#5b5b5b]",children:h.title}),h.description&&s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:h.description})]},h.id)),u(r.id).length===0&&s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("p",{children:"No published checklists available for this category."}),s.jsx("p",{className:"text-sm mt-1",children:"Create and publish checklists in Settings to see them here."})]})]}),e&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-[#5b5b5b]",children:e.title}),s.jsx("div",{className:"space-y-2",children:e.items.map(h=>s.jsx(mh,{item:h,bypassedItems:t,adjustedQuantities:n,onBypassItem:c,onAdjustQuantity:l,onViewSDS:o},h.id))}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:d,className:"bg-[#4ECDC4] text-white px-4 py-2 rounded-lg hover:bg-[#3db8b0] transition-colors",type:"button",children:"Mark All Complete"})})]})]})]})]}),ck=({searchQuery:r,sdsCategory:e,filteredSDSSheets:t,onTabChange:n,onSearchQueryChange:a,onSdsCategoryChange:i,onSDSSelect:c})=>s.jsx("button",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>n("checklists"),onKeyDown:l=>l.key==="Escape"&&n("checklists"),type:"button","aria-label":"Close SDS Sheets",children:s.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",role:"document",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(N,{path:Ye,size:1.2,color:"#4ECDC4",className:"mr-2"}),s.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"SDS Sheets"})]}),s.jsx("button",{onClick:()=>n("checklists"),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close SDS Sheets",type:"button",children:s.jsx(N,{path:Ae,size:1.2,color:"#5b5b5b"})})]}),s.jsxs("div",{className:"flex gap-2 mb-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx("input",{type:"text",placeholder:"Search SDS sheets...",value:r,onChange:l=>a(l.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]"}),s.jsx(N,{path:Di,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),s.jsxs("select",{value:e,onChange:l=>i(l.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[s.jsx("option",{value:"all",children:"All Categories"}),s.jsx("option",{value:"Cleaning",children:"Cleaning"}),s.jsx("option",{value:"Sanitization",children:"Sanitization"})]})]}),s.jsx("div",{className:"space-y-2",children:t.map(l=>s.jsxs("div",{onClick:()=>c(l),onKeyDown:o=>o.key==="Enter"&&c(l),className:"w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",role:"button",tabIndex:0,"aria-label":`Select ${l.name} SDS sheet`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-medium text-[#5b5b5b]",children:l.name}),s.jsx("span",{className:"text-sm text-gray-500",children:"â€¢"}),s.jsx("p",{className:"text-sm text-gray-500",children:l.category})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-500",children:l.lastUpdated}),s.jsx(N,{path:Ye,size:1,color:"#4ECDC4"})]})]},l.id))})]})}),dk=({stolenItems:r,onAddStolenItem:e,onUpdateStolenItem:t,onClearStolenItems:n})=>s.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Reported Stolen Items"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:n,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear All"}),s.jsx("button",{onClick:e,className:`px-3 py-1 ${ah.error.light} text-red-600 rounded-md hover:bg-red-100 text-sm`,children:"+ Add Stolen Item"})]})]}),r.map((a,i)=>{var c;return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"text",placeholder:"Item",value:a.item,onChange:l=>t(i,"item",l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),s.jsx("input",{type:"number",placeholder:"Qty",value:a.quantity,onChange:l=>t(i,"quantity",parseInt(l.target.value)||0),className:"w-20 px-3 py-2 border border-gray-300 rounded-md"}),s.jsx("input",{type:"text",placeholder:"Notes",value:(c=a.data)==null?void 0:c.notes,onChange:l=>t(i,"notes",l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"})]},i)})]}),uk=({prnItems:r,onAddPrnItem:e,onUpdatePrnItem:t,onClearPrnItems:n})=>s.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"PRN Cleaning Items"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:n,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear All"}),s.jsx("button",{onClick:e,className:`px-3 py-1 ${ah.info.light} text-blue-600 rounded-md hover:bg-blue-100 text-sm`,children:"+ Add PRN Item"})]})]}),r.map((a,i)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"text",placeholder:"Item",value:a.item,onChange:c=>t(i,"item",c.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),s.jsx("input",{type:"number",placeholder:"Qty",value:a.quantity,onChange:c=>t(i,"quantity",parseInt(c.target.value)||0),className:"w-20 px-3 py-2 border border-gray-300 rounded-md"}),s.jsx("input",{type:"text",placeholder:"Reason",value:a.reason,onChange:c=>t(i,"reason",c.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"})]},i))]}),mk=({notes:r,isListening:e,transcript:t,onNotesChange:n,onClearNotes:a,onStartSpeechRecognition:i,onStopSpeechRecognition:c,onApplyTranscriptToNotes:l})=>s.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Notes"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:a,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear Notes"}),s.jsxs("button",{onClick:e?c:i,className:`px-3 py-1 rounded-md text-sm flex items-center gap-1 ${e?"bg-red-100 text-red-600 hover:bg-red-200":"bg-blue-100 text-blue-600 hover:bg-blue-200"}`,children:[s.jsx(N,{path:e?Mu:oi,size:.8}),e?"Stop Dictation":"Start Dictation"]})]})]}),e&&s.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-sm font-medium text-blue-800 flex items-center",children:[s.jsx(N,{path:oi,size:.8,className:"mr-1 animate-pulse"}),"Listening... Speak now"]}),s.jsx("button",{onClick:()=>l(n),disabled:!t.trim(),className:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add to Notes"})]}),s.jsx("div",{className:"text-sm text-blue-700 min-h-[2rem]",children:t||"Waiting for speech..."})]}),s.jsx("textarea",{value:r,onChange:o=>n(o.target.value),placeholder:"Add any additional notes here... Use the dictation button to speak your notes!",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md"})]}),hk=({showModal:r,selectedCategory:e,selectedChecklist:t,bypassedItems:n,adjustedQuantities:a,stolenItems:i,prnItems:c,notes:l,isListening:o,transcript:d,onClose:u,onChecklistSelect:h,onSetSelectedChecklist:p,onBypassItem:f,onAdjustQuantity:g,onViewSDS:y,onAddStolenItem:v,onUpdateStolenItem:b,onClearStolenItems:x,onAddPrnItem:w,onUpdatePrnItem:j,onClearPrnItems:I,onNotesChange:E,onClearNotes:O,onStartSpeechRecognition:S,onStopSpeechRecognition:C,onApplyTranscriptToNotes:D,getChecklistsForCategory:k})=>s.jsx(Yi,{show:r,onClose:u,title:(e==null?void 0:e.title)||"Select Checklist",footer:s.jsx("div",{className:"flex justify-end w-full",children:s.jsx("button",{onClick:u,className:"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 font-medium py-2 px-4 rounded-md transition-colors",children:"Close"})}),children:t?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:t.title}),s.jsxs("button",{onClick:()=>p(null),className:"text-sm text-gray-600 hover:text-gray-800 flex items-center",children:[s.jsx(N,{path:qu,size:1,className:"mr-1"}),"Back to Lists"]})]}),s.jsx("div",{className:"bg-white rounded-lg border border-gray-200 divide-y divide-gray-200",children:t.items.map(P=>s.jsx(mh,{item:P,bypassedItems:n,adjustedQuantities:a,onBypassItem:f,onAdjustQuantity:g,onViewSDS:y},P.id))}),s.jsx(dk,{stolenItems:i,onAddStolenItem:v,onUpdateStolenItem:b,onClearStolenItems:x}),s.jsx(uk,{prnItems:c,onAddPrnItem:w,onUpdatePrnItem:j,onClearPrnItems:I}),s.jsx(mk,{notes:l,isListening:o,transcript:d,onNotesChange:E,onClearNotes:O,onStartSpeechRecognition:S,onStopSpeechRecognition:C,onApplyTranscriptToNotes:D})]}):s.jsxs("div",{className:"space-y-3",children:[e&&k(e.id).map(P=>s.jsxs("div",{onClick:()=>h(P),onKeyDown:T=>T.key==="Enter"&&h(P),className:"w-full p-3 text-left bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer",role:"button",tabIndex:0,"aria-label":`Select ${P.title} checklist`,children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-1",children:P.title}),s.jsx("p",{className:"text-sm text-gray-600",children:P.description})]},P.id)),e&&k(e.id).length===0&&s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("p",{children:"No published checklists available for this category."}),s.jsx("p",{className:"text-sm mt-1",children:"Create and publish checklists in Settings to see them here."})]})]})}),pk=({selectedSDS:r,onClose:e})=>s.jsx(Yi,{show:!!r,onClose:e,title:"Safety Data Sheet",children:r&&s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:r.name}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:r.name}),s.jsx("div",{className:"flex flex-wrap gap-2",children:r.sections.map(t=>s.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm",children:t},t))})]})})}),fk=()=>{const{getPublishedChecklistsByCategory:r}=YE(),{selectedCategory:e,selectedChecklist:t,activeTab:n,searchQuery:a,selectedSDS:i,sdsCategory:c,bypassedItems:l,adjustedQuantities:o,showModal:d,notes:u,stolenItems:h,prnItems:p,setSelectedChecklist:f,setActiveTab:g,setSearchQuery:y,setSelectedSDS:v,setSdsCategory:b,setNotes:x,handleCategoryClick:w,handleChecklistSelect:j,handleCloseModal:I,handleMarkComplete:E,handleBypassItem:O,handleAdjustQuantity:S,handleAddStolenItem:C,handleAddPrnItem:D,handleUpdateStolenItem:k,handleUpdatePrnItem:P,clearStolenItems:T,clearPrnItems:A,clearNotes:z}=rk(),{isListening:W,transcript:M,startSpeechRecognition:R,stopSpeechRecognition:F,applyTranscriptToNotes:V}=sk(),L=G=>r(G).map(Q=>({id:Q.id,title:Q.title,description:`Published checklist with ${Q.items.length} items`,items:Q.items.map(Z=>{var ze;return{id:Z.id,title:Z.title,instructions:Z.instructions,inventoryItems:(ze=Z.requiredInventory)==null?void 0:ze.map(U=>({id:U.id,name:U.name,currentStock:U.available,requiredQuantity:U.required,category:"Cleaning Supplies"})),completed:Z.completed||!1}})})),Y=ak.filter(G=>{const q=G.name.toLowerCase().includes(a.toLowerCase()),Q=c==="all"||G.category===c;return q&&Q});return s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsx(ik,{activeTab:n,onTabChange:g}),n==="checklists"&&s.jsx(lk,{selectedCategory:e,selectedChecklist:t,bypassedItems:l,adjustedQuantities:o,onCategoryClick:w,onChecklistSelect:j,onBypassItem:O,onAdjustQuantity:S,onViewSDS:v,onMarkComplete:E,getChecklistsForCategory:L}),n==="sds"&&s.jsx(ck,{searchQuery:a,sdsCategory:c,filteredSDSSheets:Y,onTabChange:g,onSearchQueryChange:y,onSdsCategoryChange:b,onSDSSelect:v}),s.jsx(hk,{showModal:d,selectedCategory:e,selectedChecklist:t,bypassedItems:l,adjustedQuantities:o,stolenItems:h,prnItems:p,notes:u,isListening:W,transcript:M,onClose:I,onChecklistSelect:j,onSetSelectedChecklist:f,onBypassItem:O,onAdjustQuantity:S,onViewSDS:v,onAddStolenItem:C,onUpdateStolenItem:k,onClearStolenItems:T,onAddPrnItem:D,onUpdatePrnItem:P,onClearPrnItems:A,onNotesChange:x,onClearNotes:z,onStartSpeechRecognition:R,onStopSpeechRecognition:F,onApplyTranscriptToNotes:V,getChecklistsForCategory:L}),s.jsx(pk,{selectedSDS:i,onClose:()=>v(null)})]})},gk=()=>s.jsx("div",{children:s.jsx(fk,{})}),yk=te.memo(({clean:r})=>s.jsxs("div",{className:"p-4 border rounded-lg shadow-sm",children:[s.jsxs("h3",{className:"font-medium text-gray-900",children:["Room ",r.id]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",r.status]})]}));yk.displayName="EnvironmentalCleanItem";const vk=()=>{const r=Br(),[e]=m.useState(!1),t=nE(),n=m.useRef(t);n.current=t;const{rooms:a}=nh(),{searchTerm:i,status:c,onSearchChange:l,onStatusChange:o}=JT(a);m.useEffect(()=>{n.current.mutate({action:"view_page"})},[]),m.useEffect(()=>{c&&c!=="all"&&n.current.mutate({action:"filter_status",item:{status:c}})},[c]);const d=()=>{console.log("ðŸ” Navigating to scanner page..."),r("/environmental-clean/scanner")};return s.jsx(gE,{children:s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx(aE,{isScanning:e,onScan:d,searchTerm:i,onSearchTermChange:l,selectedStatus:c,onStatusChange:o}),s.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[s.jsx(OE,{}),s.jsx(ME,{})]}),s.jsx(gk,{})]})})]})})},xk=()=>{const[r]=m.useState(null);return m.useEffect(()=>(console.log("â„¹ï¸ Workflow session creation temporarily disabled to avoid RLS issues"),()=>{r&&console.log("Session cleanup needed for:",r)}),[r]),s.jsx(zr,{FallbackComponent:$T,children:s.jsx(Ur,{children:s.jsx(zr,{FallbackComponent:MT,children:s.jsx(vk,{})})})})};var bk=Object.defineProperty,Zd=Object.getOwnPropertySymbols,_k=Object.prototype.hasOwnProperty,wk=Object.prototype.propertyIsEnumerable,eu=(r,e,t)=>e in r?bk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sk=(r,e)=>{for(var t in e||(e={}))_k.call(e,t)&&eu(r,t,e[t]);if(Zd)for(var t of Zd(e))wk.call(e,t)&&eu(r,t,e[t]);return r},ei=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Nn{static scanRoomBarcode(e){return ei(this,null,function*(){var t,n,a,i,c;try{if(!e||e.trim()==="")return{success:!1,message:"Please enter a valid barcode"};const{data:l,error:o}=yield _.from("rooms").select("*").eq("barcode",e.trim()).eq("is_active",!0).single();if(o){if(o.code==="PGRST116")return{success:!1,message:`Room with barcode "${e}" not found in system`};throw o}if(!l)return{success:!1,message:"Room not found in system"};const d=l,u={id:d.id,barcode:d.barcode,name:d.name,department:(t=d.department)!=null?t:void 0,floor:(n=d.floor)!=null?n:void 0,building:(a=d.building)!=null?a:void 0,roomType:(i=d.room_type)!=null?i:void 0,capacity:(c=d.capacity)!=null?c:void 0,isActive:d.is_active,createdAt:d.created_at,updatedAt:d.updated_at};return st.log("environmental_clean","room_scanned",{roomId:u.id,roomName:u.name,barcode:e,timestamp:new Date().toISOString()}),{success:!0,room:u,message:`Room "${u.name}" scanned successfully!`}}catch(l){return console.error("âŒ Error scanning room barcode:",l),{success:!1,message:"An error occurred while scanning the barcode. Please try again."}}})}static updateRoomStatus(e,t){return ei(this,null,function*(){try{if(!e)return{success:!1,message:"Room ID is required"};if(!wi.getState().getAllStatusTypes().map(p=>p.id).includes(t))return{success:!1,message:`Invalid status: ${t}`};const{data:c,error:l}=yield _.from("rooms").select("name").eq("id",e).single();if(l||!c)return{success:!1,message:"Room not found in system"};const o=c,d=this.mapStatusToDatabase(t),u={status:d,updated_at:new Date().toISOString()};t==="available"&&(u.completed_time=new Date().toISOString());const{data:h}=yield _.from("environmental_cleans_enhanced").select("id").eq("room_id",e).order("created_at",{ascending:!1}).limit(1).single();if(h){const p=h,{error:f}=yield _.from("environmental_cleans_enhanced").update(u).eq("id",p.id);if(f)throw f}else{const p=Sk({room_id:e,room_name:o.name,status:d,cleaning_type:"routine",scheduled_time:new Date().toISOString()},u),{error:f}=yield _.from("environmental_cleans_enhanced").insert(p);if(f)throw f}return st.log("environmental_clean","room_status_updated",{roomId:e,roomName:o.name,status:t,timestamp:new Date().toISOString()}),{success:!0,message:`Room "${o.name}" status updated to ${t}`,roomId:e,status:t}}catch(n){return console.error("âŒ Error updating room status:",n),{success:!1,message:"An error occurred while updating room status. Please try again."}}})}static completeRoomCleaning(e,t){return ei(this,null,function*(){var n;try{const{data:a,error:i}=yield _.from("rooms").select("name").eq("id",e).single();if(i||!a)return{success:!1,message:"Room not found in system"};const c=a,{data:l,error:o}=yield _.from("environmental_cleans_enhanced").update({status:"completed",completed_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("room_id",e).order("created_at",{ascending:!1}).limit(1).select().single();if(o)throw o;if(t&&t.length>0&&l){const{data:d}=yield _.auth.getUser(),u=(n=d==null?void 0:d.user)==null?void 0:n.id,h=t.map(f=>({environmental_clean_id:l.id,inventory_item_id:f.itemId,quantity_used:f.quantity,usage_reason:f.usageReason,task_step:f.taskStep,used_by:u!=null?u:null})),{error:p}=yield _.from("environmental_cleaning_inventory_usage").insert(h);p&&console.error("âŒ Error tracking inventory usage:",p)}return st.log("environmental_clean","room_cleaning_completed",{roomId:e,roomName:c.name,inventoryUsage:(t==null?void 0:t.length)||0,timestamp:new Date().toISOString()}),{success:!0,message:`Room "${c.name}" cleaning completed successfully`,roomId:e,status:"clean"}}catch(a){return console.error("âŒ Error completing room cleaning:",a),{success:!1,message:"An error occurred while completing room cleaning. Please try again."}}})}static getAvailableStatuses(){const e=wi.getState(),t=e.getCoreStatusTypes(),n=e.getPublishedStatusTypes();return[...t,...n.filter(a=>!a.isCore)]}static mapStatusToDatabase(e){return{Clean:"clean",Dirty:"dirty","In Progress":"in_progress","Out of Service":"cancelled",Supervisor:"pending",Isolation:"failed",Quarantine:"failed",Maintenance:"pending","Equipment Failure":"failed","Patient Occupied":"pending","Discharge Cleaning":"pending",Unassigned:"pending","Audit Required":"pending"}[e]||"dirty"}static mapDatabaseToStatus(e){return{completed:"Clean",clean:"Clean",pending:"Dirty",dirty:"Dirty",in_progress:"In Progress",failed:"Supervisor",cancelled:"Out of Service"}[e]||"Dirty"}}var ti=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const jk=()=>{var r;const e=Br(),[t,n]=m.useState(!1),[a,i]=m.useState(null),[c,l]=m.useState(""),[o,d]=m.useState(""),[u,h]=m.useState(null),p=m.useMemo(()=>Nn.getAvailableStatuses().map(w=>({id:w.id,name:w.name,icon:w.icon||"default-icon",color:w.color||"#6b7280",description:w.description||"",isCore:w.isCore||!1})),[]),f=()=>ti(null,null,function*(){n(!0),i(null),h(null);try{const x=["ROOM-001","ROOM-002","ROOM-003","ROOM-004","ROOM-005"],w=x[Math.floor(Math.random()*x.length)],j=yield Nn.scanRoomBarcode(w);j.success&&j.room?(i("success"),l(j.message),h(j.room)):(i("error"),l(j.message))}catch(x){console.error(x),i("error"),l("An error occurred during scanning. Please try again.")}finally{n(!1)}}),g=x=>{const j={clean:"clean",dirty:"dirty",in_progress:"in_progress",available:"available",biohazard:"biohazard",theft:"theft",low_inventory:"low_inventory",out_of_service:"out_of_service",public_areas:"public_areas"}[x]||"dirty";d(j)},y=()=>ti(null,null,function*(){if(!u){l("No room selected for cleaning completion");return}try{const x=yield Nn.completeRoomCleaning(u.id);x.success?(l(x.message),setTimeout(()=>{e("/environmental-clean")},2e3)):l(x.message)}catch(x){console.error(x),l("An error occurred while completing cleaning. Please try again.")}}),v=()=>ti(null,null,function*(){if(!u||!o){l("Please select a room and status");return}try{const x=yield Nn.updateRoomStatus(u.id,o);x.success?(l(x.message),setTimeout(()=>{e("/environmental-clean")},2e3)):l(x.message)}catch(x){console.error(x),l("An error occurred while updating status. Please try again.")}}),b=()=>{e("/environmental-clean")};return s.jsxs(Ur,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:b,onKeyDown:x=>x.key==="Escape"&&b(),role:"button",tabIndex:0}),s.jsx(ne.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:s.jsx("div",{className:"h-full flex flex-col",children:s.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center gap-4",children:[s.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(N,{path:qu,size:1.2,className:"text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Environmental Clean Scanner"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Scan rooms for cleaning management"})]})]}),s.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",children:o?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsxs("h3",{className:"font-semibold text-blue-800 mb-1",children:[o.charAt(0).toUpperCase()+o.slice(1)," ","Status"]}),s.jsx("p",{className:"text-blue-600 text-sm",children:(r=p.find(x=>x.id===o))==null?void 0:r.description})]}),u&&s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold text-green-800 mb-1",children:"Scanned Room"}),s.jsxs("p",{className:"text-green-600 text-sm",children:[s.jsx("strong",{children:"Name:"})," ",u.name,s.jsx("br",{}),s.jsx("strong",{children:"Department:"})," ",u.department||"N/A",s.jsx("br",{}),s.jsx("strong",{children:"Floor:"})," ",u.floor||"N/A",s.jsx("br",{}),s.jsx("strong",{children:"Building:"})," ",u.building||"N/A"]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsxs("div",{className:"text-center space-y-4",children:[s.jsxs("div",{className:"relative bg-black h-64 rounded-lg overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 to-black"}),s.jsx(ne.div,{className:"absolute left-0 right-0 h-1 bg-[#4ECDC4]",animate:{top:["10%","90%","10%"],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),s.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-48 rounded-lg",children:[s.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),s.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),s.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),s.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),s.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),s.jsx("button",{onClick:f,disabled:t,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${t?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:s.jsx(N,{path:Qe,size:1.5,className:`${t?"text-gray-400":"text-white"}`})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:t?"Scanning...":"Click to Scan"}),s.jsx("p",{className:"text-gray-600 text-sm",children:t?"Position room barcode in camera view":"Use camera to scan room barcode"})]})]}),a&&s.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg ${a==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{path:Qe,size:1,className:a==="success"?"text-green-600":"text-red-600"}),s.jsx("span",{className:`font-medium ${a==="success"?"text-green-800":"text-red-800"}`,children:c})]})})]}),s.jsxs("div",{className:"flex justify-center space-x-4",children:[s.jsx("button",{onClick:()=>d(""),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"â† Back to Status Selection"}),a==="success"&&u&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:v,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Update Status"}),s.jsx("button",{onClick:y,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Complete Cleaning"})]})]})]}):s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-3",children:"Select Room Status"}),s.jsx("div",{className:"space-y-2",children:p.map(x=>s.jsx("button",{onClick:()=>g(x.id),className:`w-full p-3 rounded-lg border-2 transition-all duration-200 text-left ${x.color==="#16a34a"?"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100":x.color==="#ca8a04"?"border-yellow-200 hover:border-yellow-300 bg-yellow-50 hover:bg-yellow-100":x.color==="#dc2626"?"border-red-200 hover:border-red-300 bg-red-50 hover:bg-red-100":x.color==="#9333ea"?"border-purple-200 hover:border-purple-300 bg-purple-50 hover:bg-purple-100":x.color==="#4b5563"?"border-gray-200 hover:border-gray-300 bg-gray-50 hover:bg-gray-100":x.color==="#b45309"?"border-amber-200 hover:border-amber-300 bg-amber-50 hover:bg-amber-100":x.color==="#047857"?"border-emerald-200 hover:border-emerald-300 bg-emerald-50 hover:bg-emerald-100":"border-gray-200 hover:border-gray-300 bg-gray-50 hover:bg-gray-100"}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`p-1.5 rounded-lg ${x.color==="#16a34a"?"bg-green-100":x.color==="#ca8a04"?"bg-yellow-100":x.color==="#dc2626"?"bg-red-100":x.color==="#9333ea"?"bg-purple-100":x.color==="#4b5563"?"bg-gray-100":x.color==="#b45309"?"bg-amber-100":x.color==="#047857"?"bg-emerald-100":"bg-gray-100"}`,children:s.jsx(N,{path:x.icon,size:1,className:x.color==="#16a34a"?"text-green-600":x.color==="#ca8a04"?"text-yellow-600":x.color==="#dc2626"?"text-red-600":x.color==="#9333ea"?"text-purple-600":x.color==="#4b5563"?"text-gray-600":x.color==="#b45309"?"text-amber-600":x.color==="#047857"?"text-emerald-600":"text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h4",{className:`font-semibold text-sm ${x.color==="#16a34a"?"text-green-800":x.color==="#ca8a04"?"text-yellow-800":x.color==="#dc2626"?"text-red-800":x.color==="#9333ea"?"text-purple-800":x.color==="#4b5563"?"text-gray-800":x.color==="#b45309"?"text-amber-800":x.color==="#047857"?"text-emerald-800":"text-gray-800"}`,children:x.name}),s.jsx("p",{className:`text-xs ${x.color==="#16a34a"?"text-green-600":x.color==="#ca8a04"?"text-yellow-600":x.color==="#dc2626"?"text-red-600":x.color==="#9333ea"?"text-purple-600":x.color==="#4b5563"?"text-gray-600":x.color==="#b45309"?"text-amber-600":x.color==="#047857"?"text-emerald-600":"text-gray-600"}`,children:x.description})]})]})},x.id))})]})})]})})})]})};var Ck=Object.defineProperty,tu=Object.getOwnPropertySymbols,Nk=Object.prototype.hasOwnProperty,Ik=Object.prototype.propertyIsEnumerable,ru=(r,e,t)=>e in r?Ck(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,su=(r,e)=>{for(var t in e||(e={}))Nk.call(e,t)&&ru(r,t,e[t]);if(tu)for(var t of tu(e))Ik.call(e,t)&&ru(r,t,e[t]);return r},pe=(r=>(r.NETWORK_ERROR="NETWORK_ERROR",r.VALIDATION_ERROR="VALIDATION_ERROR",r.CONTENT_NOT_FOUND="CONTENT_NOT_FOUND",r.OPERATION_FAILED="OPERATION_FAILED",r.UNAUTHORIZED="UNAUTHORIZED",r.RATE_LIMIT_EXCEEDED="RATE_LIMIT_EXCEEDED",r.SERVER_ERROR="SERVER_ERROR",r.TIMEOUT_ERROR="TIMEOUT_ERROR",r))(pe||{}),Ge=(r=>(r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH",r.CRITICAL="CRITICAL",r))(Ge||{});class Bs extends Error{constructor(e,t,n={}){var a,i;super(t),this.name="ApiError",this.type=e,this.code=n.code,this.retryable=(a=n.retryable)!=null?a:this.isRetryableByDefault(e),this.severity=(i=n.severity)!=null?i:this.getSeverityByType(e),this.context=n.context,this.timestamp=new Date}isRetryableByDefault(e){switch(e){case"NETWORK_ERROR":case"TIMEOUT_ERROR":case"SERVER_ERROR":return!0;case"VALIDATION_ERROR":case"CONTENT_NOT_FOUND":case"UNAUTHORIZED":case"RATE_LIMIT_EXCEEDED":return!1;default:return!1}}getSeverityByType(e){switch(e){case"UNAUTHORIZED":return"CRITICAL";case"NETWORK_ERROR":case"SERVER_ERROR":return"HIGH";case"VALIDATION_ERROR":case"RATE_LIMIT_EXCEEDED":return"MEDIUM";case"CONTENT_NOT_FOUND":case"TIMEOUT_ERROR":return"LOW";default:return"MEDIUM"}}toKnowledgeHubError(e){return{type:this.type,message:this.message,code:this.code,details:this.context,retryable:this.retryable,severity:this.severity,timestamp:new Date,context:su(su({},this.context),e)}}}class sr extends Bs{constructor(e,t){super("VALIDATION_ERROR",e,{severity:"MEDIUM",context:{details:t}}),this.name="ValidationError"}}class In extends Bs{constructor(e,t){super("NETWORK_ERROR",e,{severity:"HIGH",context:t}),this.name="NetworkError"}}class vs extends Bs{constructor(e){super("CONTENT_NOT_FOUND",`Content with ID ${e} not found`,{severity:"LOW",context:{contentId:e}}),this.name="ContentNotFoundError"}}class Tk extends m.Component{constructor(e){super(e),this.retryTimeouts=[],this.handleRetry=()=>{const{maxRetries:t=3,retryDelay:n=1e3}=this.props,{retryCount:a}=this.state;if(a>=t){console.warn("Max retry attempts reached");return}this.setState(c=>({hasError:!1,error:null,retryCount:c.retryCount+1}));const i=setTimeout(()=>{this.forceUpdate()},n);this.addTimeout(i)},this.state={hasError:!1,error:null,retryCount:0}}static getDerivedStateFromError(e){let t,n=!1,a;if(e instanceof Bs)t=e.type,n=e.retryable,a=e.severity;else{const c=e.message.toLowerCase();c.includes("network")||c.includes("fetch")||c.includes("connection")?(t=pe.NETWORK_ERROR,n=!0,a=Ge.HIGH):c.includes("timeout")?(t=pe.TIMEOUT_ERROR,n=!0,a=Ge.MEDIUM):c.includes("auth")||c.includes("unauthorized")?(t=pe.UNAUTHORIZED,n=!1,a=Ge.CRITICAL):c.includes("validation")||c.includes("invalid")?(t=pe.VALIDATION_ERROR,n=!1,a=Ge.MEDIUM):c.includes("not found")||c.includes("404")?(t=pe.CONTENT_NOT_FOUND,n=!1,a=Ge.LOW):(t=pe.OPERATION_FAILED,n=!0,a=Ge.MEDIUM)}return{hasError:!0,error:{type:t,message:e.message,timestamp:new Date,retryable:n,severity:a,context:{component:"BaseErrorBoundary",operation:e.name}},retryCount:0}}componentDidCatch(e,t){const{onError:n,componentName:a}=this.props,{error:i}=this.state;console.error(`ErrorBoundary caught an error${a?` in ${a}`:""}:`,e,t),i&&n&&n(i),console.error("Production error logging:",{error:i,errorInfo:t,timestamp:new Date().toISOString()})}componentWillUnmount(){this.retryTimeouts.forEach(e=>clearTimeout(e)),this.retryTimeouts=[]}clearAllTimeouts(){this.retryTimeouts.forEach(e=>clearTimeout(e)),this.retryTimeouts=[]}addTimeout(e){this.retryTimeouts.push(e)}getErrorSeverity(e){return e.severity}getSeverityStyles(e){switch(e){case Ge.CRITICAL:return"bg-red-50 border-red-200 text-red-800";case Ge.HIGH:return"bg-orange-50 border-orange-200 text-orange-800";case Ge.MEDIUM:return"bg-yellow-50 border-yellow-200 text-yellow-800";case Ge.LOW:return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}}getErrorMessage(e){switch(e.type){case pe.NETWORK_ERROR:return"Connection issue detected. Please check your internet connection and try again.";case pe.TIMEOUT_ERROR:return"The request took too long to complete. Please try again.";case pe.UNAUTHORIZED:return"Your session has expired. Please log in again to continue.";case pe.VALIDATION_ERROR:return"The data provided is invalid. Please check your input and try again.";case pe.CONTENT_NOT_FOUND:return"The requested content could not be found.";case pe.OPERATION_FAILED:return"The operation failed. Please try again.";case pe.RATE_LIMIT_EXCEEDED:return"Too many requests. Please wait a moment and try again.";case pe.SERVER_ERROR:return"Server error occurred. Please try again later.";default:return"An unexpected error occurred. Please try again or contact support."}}renderErrorDetails(e){return null}render(){const{hasError:e,error:t}=this.state,{fallback:n,children:a}=this.props;return e&&t?n||this.renderErrorContent(t):a}}var Ek=Object.defineProperty,kk=Object.defineProperties,Dk=Object.getOwnPropertyDescriptors,nu=Object.getOwnPropertySymbols,Pk=Object.prototype.hasOwnProperty,Ok=Object.prototype.propertyIsEnumerable,au=(r,e,t)=>e in r?Ek(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rk=(r,e)=>{for(var t in e||(e={}))Pk.call(e,t)&&au(r,t,e[t]);if(nu)for(var t of nu(e))Ok.call(e,t)&&au(r,t,e[t]);return r},Ak=(r,e)=>kk(r,Dk(e));class $k extends Tk{constructor(e){super(e),this.retryCount=0,this.handleRetry=()=>{const{maxRetries:t=3,retryDelay:n=1e3}=this.props,{error:a}=this.state;if(!(a!=null&&a.retryable)||this.retryCount>=t)return;this.retryCount++,this.setState({hasError:!1,error:null});const i=n*Math.pow(2,this.retryCount-1),c=setTimeout(()=>{this.forceUpdate()},i);this.addTimeout(c)},this.handleReset=()=>{this.clearAllTimeouts(),this.retryCount=0,this.setState({hasError:!1,error:null,errorCount:0,lastErrorTime:null},()=>{this.forceUpdate()})},this.handleNavigateHome=()=>{window.location.href="/"},this.renderErrorContent=t=>{const n=this.getErrorSeverity(t),{retryable:a}=t,i=()=>this.getSeverityStyles(n),c=()=>{switch(t.type){case pe.NETWORK_ERROR:case pe.TIMEOUT_ERROR:return pt;case pe.UNAUTHORIZED:return ce;default:return ce}},l=()=>this.getErrorMessage(t),o=()=>{const d=[];return a&&this.retryCount<(this.props.maxRetries||3)&&d.push(s.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#3db8b0] transition-colors",children:[s.jsx(de,{path:qp,size:.8}),"Retry"]},"retry")),d.push(s.jsxs("button",{onClick:this.handleReset,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors",children:[s.jsx(de,{path:pt,size:.8}),"Reset"]},"reset")),t.type===pe.UNAUTHORIZED&&d.push(s.jsxs("button",{onClick:this.handleNavigateHome,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:[s.jsx(de,{path:Fu,size:.8}),"Go Home"]},"home")),d};return s.jsx("div",{className:`min-h-screen flex items-center justify-center p-6 ${i()}`,children:s.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 border",children:s.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[s.jsx(de,{path:c(),size:3,color:n===Ge.CRITICAL?"#ef4444":"#f59e0b"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:t.type?t.type.replace("_"," "):"UNKNOWN ERROR"}),s.jsx("p",{className:"text-gray-600 mb-4",children:l()}),t.message&&s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:t.message})]}),s.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:o()}),this.renderErrorDetails(t),this.retryCount>0&&s.jsxs("p",{className:"text-xs text-gray-500",children:["Retry attempt ",this.retryCount," of ",this.props.maxRetries||3]})]})})})},this.state={hasError:!1,error:null,retryCount:0,errorCount:0,lastErrorTime:null}}static getDerivedStateFromError(e){const t=super.getDerivedStateFromError(e);return Ak(Rk({},t),{errorCount:1,lastErrorTime:new Date})}render(){const{hasError:e,error:t}=this.state,{fallback:n,children:a}=this.props;return e&&t?n||this.renderErrorContent(t):a}}var Mk=Object.defineProperty,iu=Object.getOwnPropertySymbols,Fk=Object.prototype.hasOwnProperty,Lk=Object.prototype.propertyIsEnumerable,ou=(r,e,t)=>e in r?Mk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lu=(r,e)=>{for(var t in e||(e={}))Fk.call(e,t)&&ou(r,t,e[t]);if(iu)for(var t of iu(e))Lk.call(e,t)&&ou(r,t,e[t]);return r},rt=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const cu={MAX_REQUESTS_PER_WINDOW:100,WINDOW_MS:60*1e3,BURST_LIMIT:10,RETRY_DELAY:1e3,MAX_RETRIES:3};class du{constructor(e){this.requests=[],this.burstRequests=[],this.maxRequests=e.MAX_REQUESTS_PER_WINDOW,this.windowMs=e.WINDOW_MS,this.burstLimit=e.BURST_LIMIT,this.retryDelay=e.RETRY_DELAY,this.maxRetries=e.MAX_RETRIES}cleanup(){const e=Date.now();this.requests=this.requests.filter(t=>e-t<this.windowMs),this.burstRequests=this.burstRequests.filter(t=>e-t<1e3)}canMakeRequest(){return this.cleanup(),this.requests.length<this.maxRequests}canMakeBurstRequest(){return this.cleanup(),this.burstRequests.length<this.burstLimit}acquireToken(){return rt(this,null,function*(){let e=0;for(;!this.canMakeRequest();){if(e>=this.maxRetries)throw new Error("Rate limit exceeded. Please try again later.");yield new Promise(t=>setTimeout(t,this.retryDelay)),e++}this.requests.push(Date.now())})}acquireBurstToken(){return rt(this,null,function*(){let e=0;for(;!this.canMakeBurstRequest();){if(e>=this.maxRetries)throw new Error("Burst rate limit exceeded. Please try again later.");yield new Promise(t=>setTimeout(t,this.retryDelay/2)),e++}this.burstRequests.push(Date.now())})}getStats(){return this.cleanup(),{currentRequests:this.requests.length,currentBurstRequests:this.burstRequests.length,maxRequests:this.maxRequests,maxBurstRequests:this.burstLimit,windowMs:this.windowMs}}reset(){this.requests=[],this.burstRequests=[]}}const ri=(r,e,t=!1)=>rt(null,null,function*(){if(e)try{t?yield e.acquireBurstToken():yield e.acquireToken()}catch(n){throw new In(n instanceof Error?n.message:"Rate limit exceeded",{endpoint:r,rateLimited:!0})}try{const{data:n,error:a}=yield _.from("knowledge_articles").select("*");if(a)throw new In(a.message,{endpoint:r,originalError:a});return n}catch(n){throw n instanceof Bs?n:n instanceof Error?new In(n.message,{endpoint:r,originalError:n}):new In("Unknown error occurred",{endpoint:r})}}),uu=r=>{if(!r||typeof r!="object")throw new sr("Invalid content item data");const e=r;if(!e.id||typeof e.id!="string")throw new sr("Content item must have a valid ID");if(!e.title||typeof e.title!="string")throw new sr("Content item must have a valid title");if(!e.category||!["Courses","Procedures","Policies","Learning Pathways","Advanced"].includes(e.category))throw new sr("Content item must have a valid category");if(!e.status||!["Not Started","In Progress","Completed"].includes(e.status))throw new sr("Content item must have a valid status");if(typeof e.progress!="number"||e.progress<0||e.progress>100)throw new sr("Content item must have a valid progress value (0-100)");return e};class zk{constructor(){this.requestCache=new Map,this.CACHE_DURATION=300*1e3,this.rateLimiter=new du(cu)}getCachedData(e){const t=this.requestCache.get(e);return t&&Date.now()-t.timestamp<this.CACHE_DURATION?t.data:(this.requestCache.delete(e),null)}setCachedData(e,t){this.requestCache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.requestCache.clear()}invalidateRelatedCaches(e){const t=[];for(const n of Array.from(this.requestCache.keys()))(n.includes("fetchContent")||n.includes("contentStats"))&&t.push(n),e&&n.includes(e)&&t.push(n);t.forEach(n=>this.requestCache.delete(n))}fetchContent(){return rt(this,null,function*(){const e="fetchContent",t=this.getCachedData(e);if(t)return t;const n=[{id:"1",title:"Basic Sterilization Training",description:"Learn the fundamentals of sterilization procedures",category:"Courses",status:"draft",progress:0,dueDate:"2024-12-31",lastUpdated:"2024-12-01",department:"Sterilization",tags:["beginner","required"],estimatedDuration:30,difficultyLevel:"Beginner"},{id:"2",title:"Advanced Autoclave Procedures",description:"Master advanced autoclave operation techniques",category:"Procedures",status:"draft",progress:45,dueDate:"2024-12-15",lastUpdated:"2024-12-05",department:"Sterilization",tags:["advanced","hands-on"],estimatedDuration:60,difficultyLevel:"Advanced"},{id:"3",title:"Safety Protocols",description:"Essential safety protocols for medical facilities",category:"Policies",status:"draft",progress:100,dueDate:"2024-11-30",lastUpdated:"2024-11-25",department:"General",tags:["safety","mandatory"],estimatedDuration:45,difficultyLevel:"Intermediate"}];return this.setCachedData(e,n),n})}fetchContentByCategory(e){return rt(this,null,function*(){const t=`fetchContentByCategory:${e}`,n=this.getCachedData(t);if(n)return n;const i=(yield this.fetchContent()).filter(c=>c.category===e);return this.setCachedData(t,i),i})}updateContent(e,t){return rt(this,null,function*(){try{let n;t?n=t:n=yield ri(`/content/${e}`,this.rateLimiter,!0);const a=uu(n);return this.invalidateRelatedCaches(e),a}catch(n){throw n instanceof vs?new vs(e):n}})}updateContentStatus(e,t){return rt(this,null,function*(){if(!["Not Started","In Progress","Completed"].includes(t))throw new sr(`Invalid status: ${t}`);return this.updateContent(e,{status:t})})}deleteContent(e){return rt(this,null,function*(){try{yield ri(`/content/${e}`,this.rateLimiter,!0),this.invalidateRelatedCaches(e)}catch(t){throw t instanceof vs?new vs(e):t}})}searchContent(e,t){return rt(this,null,function*(){const n=new URLSearchParams;n.append("q",e),t!=null&&t.category&&n.append("category",t.category),t!=null&&t.status&&n.append("status",t.status),t!=null&&t.department&&n.append("department",t.department);try{return(yield ri(`/content/search?${n.toString()}`,this.rateLimiter)).map(i=>uu(i))}catch(a){if(a instanceof vs)return[];throw a}})}getContentStats(){return rt(this,null,function*(){const e="contentStats",t=this.getCachedData(e);if(t)return t;const n=yield this.fetchContent(),a={total:n.length,byCategory:{},byStatus:{}};return n.forEach(i=>{a.byCategory[i.category]=(a.byCategory[i.category]||0)+1,a.byStatus[i.status]=(a.byStatus[i.status]||0)+1}),this.setCachedData(e,a),a})}healthCheck(){return rt(this,null,function*(){return!0})}getRateLimitStats(){return this.rateLimiter.getStats()}resetRateLimiter(){this.rateLimiter.reset()}updateRateLimitConfig(e){this.rateLimiter=new du(lu(lu({},cu),e))}}const Ss=new zk;Ss.clearCache=()=>{console.log("Cache cleared")};var Bk=Object.defineProperty,mu=Object.getOwnPropertySymbols,qk=Object.prototype.hasOwnProperty,Uk=Object.prototype.propertyIsEnumerable,hu=(r,e,t)=>e in r?Bk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,si=(r,e)=>{for(var t in e||(e={}))qk.call(e,t)&&hu(r,t,e[t]);if(mu)for(var t of mu(e))Uk.call(e,t)&&hu(r,t,e[t]);return r},Tn=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Te{static getCategoryCount(e,t){return e.filter(n=>n.category===t).length}static updateContentInList(e,t,n){return e.map(a=>a.id===t?si(si({},a),n):a)}static removeContentFromList(e,t){return e.filter(n=>n.id!==t)}static performContentUpdate(e,t){return Tn(this,null,function*(){try{return yield Ss.updateContent(e,t)}catch(n){return console.error(n),si({id:e},t)}})}static performContentDeletion(e){return Tn(this,null,function*(){try{return yield Ss.deleteContent(e)}catch(t){console.error(t);return}})}static performContentStatusUpdate(e,t){return Tn(this,null,function*(){try{return yield Ss.updateContentStatus(e,t)}catch(n){return console.error(n),{id:e,status:t}}})}static performContentFetch(){return Tn(this,null,function*(){try{return yield Ss.fetchContent()}catch(e){return console.error(e),[]}})}static createError(e){return new Error(e)}static getErrorMessage(e){return e instanceof Error?e.message:"An unknown error occurred"}}var js=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Hk=()=>js(null,null,function*(){try{return[{id:"course-1",title:"Sterilization Fundamentals",description:"Learn the basics of sterilization processes and best practices",category:"Courses",status:"draft",dueDate:new Date().toISOString().split("T")[0],progress:0,department:"central_sterile",lastUpdated:void 0,difficultyLevel:"Beginner",estimatedDuration:30},{id:"course-2",title:"Advanced Sterilization Techniques",description:"Master advanced sterilization methods and troubleshooting",category:"Courses",status:"review",dueDate:new Date().toISOString().split("T")[0],progress:45,department:"central_sterile",lastUpdated:"2025-01-15T10:00:00Z",difficultyLevel:"Advanced",estimatedDuration:60},{id:"policy-1",title:"Infection Control Policy",description:"Comprehensive infection prevention and control guidelines",category:"Policies",status:"draft",dueDate:new Date().toISOString().split("T")[0],progress:0,department:"clinical",lastUpdated:void 0,difficultyLevel:"Beginner",estimatedDuration:20},{id:"procedure-1",title:"Steam Sterilization Procedure",description:"Step-by-step steam sterilization process",category:"Procedures",status:"published",dueDate:new Date().toISOString().split("T")[0],progress:100,department:"central_sterile",lastUpdated:"2025-01-10T14:30:00Z",difficultyLevel:"Beginner",estimatedDuration:15}]}catch(r){return console.error("âŒ getAllContentItems: Error:",r),[{id:"fallback-1",title:"Sample Course",description:"This is a sample course for demonstration",category:"Courses",status:"draft",dueDate:new Date().toISOString().split("T")[0],progress:0,department:"general",lastUpdated:new Date().toISOString(),difficultyLevel:"Beginner",estimatedDuration:15}]}}),hh=m.createContext(void 0),Vk=({children:r})=>{const[e,t]=m.useState([]),[n,a]=m.useState(null),[i,c]=m.useState(!1),[l,o]=m.useState(null),[d,u]=m.useState(null),[h,p]=m.useState(null),f=m.useCallback(()=>js(null,null,function*(){try{c(!0),o(null);const I=yield Hk();if(t(I),a(I),!d&&I.length>0){const E=I[0].category;u(E)}_.auth.getUser().then(E=>{var O;(O=E==null?void 0:E.data)!=null&&O.user}).catch(E=>{console.warn("Supabase auth not available:",E)})}catch(I){const E=Te.getErrorMessage(I);o(Te.createError(E)),console.error("âŒ KnowledgeHub: Error fetching content:",I)}finally{c(!1)}}),[]);m.useEffect(()=>{const I=setTimeout(()=>{f()},0);return()=>clearTimeout(I)},[f]);const g=m.useCallback((I,E)=>js(null,null,function*(){try{c(!0),o(null);const O=yield Te.performContentUpdate(I,E);return t(S=>Te.updateContentInList(S,I,O)),!0}catch(O){const S=Te.getErrorMessage(O);return o(Te.createError(S)),!1}finally{c(!1)}}),[]),y=m.useCallback(I=>js(null,null,function*(){try{return c(!0),o(null),yield Te.performContentDeletion(I),t(E=>Te.removeContentFromList(E,I)),!0}catch(E){const O=Te.getErrorMessage(E);return o(Te.createError(O)),!1}finally{c(!1)}}),[]),v=m.useCallback(I=>Te.getCategoryCount(e,I),[e]),b=m.useCallback((I,E)=>js(null,null,function*(){try{c(!0),o(null);const O=yield Te.performContentStatusUpdate(I,E);return t(S=>Te.updateContentInList(S,I,O)),!0}catch(O){const S=Te.getErrorMessage(O);return o(Te.createError(S)),!1}finally{c(!1)}}),[]),x=m.useCallback(()=>{p(null)},[]),w=m.useCallback(I=>{u(I);const E=e.filter(O=>O.category===I);a(E)},[e]),j={content:e,selectedContent:n,selectedCategory:d,isLoading:i,error:l,validationError:h,setSelectedCategory:w,getCategoryCount:v,refetchContent:f,deleteContent:y,updateContentStatus:b,updateContent:g,clearValidationError:x};return s.jsx(hh.Provider,{value:j,children:r})},Vr=()=>{const r=m.useContext(hh);if(r===void 0)throw new Error("useSimplifiedKnowledgeHub must be used within a SimplifiedKnowledgeHubProvider");return r};var Wk=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const Gk=()=>{const[r,e]=m.useState([]),[t,n]=m.useState(!0),[a,i]=m.useState(null);m.useEffect(()=>{Wk(null,null,function*(){try{n(!0),i(null);const{data:{user:o}}=yield _.auth.getUser();if(!o){e([]);return}const d=yield mp.getRecentUserActivity(o.id,10);e(d)}catch(o){console.error("âŒ RecentUpdatesPanel: Error fetching recent updates:",o),i("Failed to load recent updates"),e([])}finally{n(!1)}})},[]);const c=l=>{const o=new Date(l),u=Math.floor((new Date().getTime()-o.getTime())/(1e3*60*60));return u<1?"Just now":u<24?`${u}h ago`:`${Math.floor(u/24)}d ago`};return s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center mb-2",children:[s.jsx(N,{path:Up,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Recent Updates"]}),s.jsx("div",{className:"overflow-y-auto scrollbar-hide",style:{maxHeight:"175px"},children:t?s.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"Loading updates..."}):a?s.jsx("div",{className:"text-center py-4 text-red-500 text-sm",children:a}):r.length>0?r.map(l=>s.jsxs("div",{className:"flex items-center py-1.5 hover:bg-gray-50 rounded-lg transition-colors",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-[#5b5b5b]",children:l.title}),s.jsx("p",{className:"text-xs text-gray-500",children:c(l.time)})]}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${l.type==="new"?"bg-blue-100 text-blue-700":l.type==="completed"?"bg-green-100 text-green-700":l.type==="assigned"?"bg-purple-100 text-purple-700":l.type==="viewed"?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"}`,children:l.type?l.type.charAt(0).toUpperCase()+l.type.slice(1):"Unknown"})]},l.id)):s.jsxs("div",{className:"text-center py-6 text-gray-500",children:[s.jsx("div",{className:"text-sm mb-2",children:"No recent updates yet"}),s.jsx("div",{className:"text-xs text-gray-400",children:"Start learning to see your progress here"})]})})]})};class xs{static filterByCategory(e,t){return!e||!Array.isArray(e)?[]:e.filter(n=>n.category===t)}static filterContent(e,t){let n=[...e];if(t.searchQuery.trim()){const a=t.searchQuery.toLowerCase();n=n.filter(i=>{var c,l,o,d;return i.title.toLowerCase().includes(a)||((l=(c=i.data)==null?void 0:c.description)==null?void 0:l.toLowerCase().includes(a))||((d=(o=i.data)==null?void 0:o.tags)==null?void 0:d.some(u=>u.toLowerCase().includes(a)))})}return t.selectedDomain&&t.selectedDomain!=="All"&&(n=n.filter(a=>a.domain===t.selectedDomain)),t.selectedContentType&&t.selectedContentType!=="All"&&(n=n.filter(a=>a.contentType===t.selectedContentType)),n}static getCategoryCount(e,t){return!e||!Array.isArray(e)?0:e.filter(n=>n.category===t).length}static getUniqueDomains(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(n=>n.domain).filter(n=>!!n));return Array.from(t).sort()}static getUniqueContentTypes(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(n=>n.contentType).filter(n=>!!n));return Array.from(t).sort()}}const ph=({content:r,selectedCategory:e,filterOptions:t})=>{const n=m.useMemo(()=>!r||!Array.isArray(r)?[]:xs.filterByCategory(r,e||""),[r,e]),a=m.useMemo(()=>xs.filterContent(n,t),[n,t]),i=m.useMemo(()=>r?xs.getUniqueDomains(r):[],[r]),c=m.useMemo(()=>r?xs.getUniqueContentTypes(r):[],[r]);return{categoryItems:n,filteredItems:a,uniqueDomains:i,uniqueContentTypes:c,getCategoryCount:o=>r?xs.getCategoryCount(r,o):0}},Kk={Courses:{icon:"#9333ea",bgColor:"bg-purple-100",textColor:"text-purple-600",selectedBgColor:"bg-purple-50"},"Learning Pathways":{icon:"#16a34a",bgColor:"bg-green-100",textColor:"text-green-600",selectedBgColor:"bg-green-50"},Procedures:{icon:"#ea580c",bgColor:"bg-orange-100",textColor:"text-orange-600",selectedBgColor:"bg-orange-50"},Policies:{icon:"#3b82f6",bgColor:"bg-blue-100",textColor:"text-blue-600",selectedBgColor:"bg-blue-50"}},Qk=()=>{const{selectedCategory:r,setSelectedCategory:e,content:t}=Vr(),{getCategoryCount:n}=ph({content:t,selectedCategory:r,filterOptions:{searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""}}),a=[{id:"Courses",icon:Ps},{id:"Learning Pathways",icon:Uu},{id:"Procedures",icon:Ye},{id:"Policies",icon:Ds}];return s.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center mb-4",children:[s.jsx(N,{path:Hp,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Categories"]}),s.jsx("div",{className:"space-y-2",children:a.map(i=>{const c=Kk[i.id];return s.jsxs("button",{onClick:()=>e(i.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors flex items-center justify-between ${r===i.id?`${c.selectedBgColor} ${c.textColor}`:"text-[#5b5b5b] hover:bg-gray-100"}`,children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:`${c.bgColor} rounded-full p-1 mr-2`,children:s.jsx(N,{path:i.icon,size:.9,color:c.icon,"aria-hidden":"true"})}),i.id]}),s.jsx("span",{className:"text-sm text-gray-500",children:n(i.id)})]},i.id)})})]})};class Yk{static determineRenderState(e,t,n){const{isLoading:a,error:i}=e;return{shouldShowLoading:a,shouldShowError:!!i,shouldShowEmpty:!a&&!i&&(!t||n.length===0),shouldShowContent:!a&&!i&&!!t&&n.length>0}}static getTagColor(e){switch(e){case"Required":return"bg-red-100 text-red-800";case"Optional":return"bg-blue-100 text-blue-800";case"New":return"bg-green-100 text-green-800";case"Updated":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}}static getStatusColor(e){switch(e){case"Not Started":return"bg-gray-100 text-gray-700";case"In Progress":return"bg-blue-100 text-blue-700";case"Completed":return"bg-green-100 text-green-700";default:return"bg-gray-100 text-gray-700"}}static formatTimeAgo(e){const t=new Date,n=new Date(e),a=Math.floor((t.getTime()-n.getTime())/(1e3*60*60));if(a<1)return"Just now";if(a<24)return`${a} hours ago`;const i=Math.floor(a/24);if(i<7)return`${i} days ago`;const c=Math.floor(i/7);return c<4?`${c} weeks ago`:`${Math.floor(i/30)} months ago`}}const Jk=({uiState:r,selectedCategory:e,categoryItems:t})=>m.useMemo(()=>Yk.determineRenderState(r,e,t),[r,e,t]),fh=({selectedCategory:r})=>s.jsx("div",{className:"mt-4",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-50",children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"?"Course Name":r==="Learning Pathways"?"Pathway Name":r==="Procedures"?"Procedure Name":r==="Policies"?"Policy Name":"Content Name"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"?"Status":r==="Learning Pathways"?"Courses":r==="Procedures"?"Department":"Category"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"?"Due Date":r==="Learning Pathways"?"Status":"Last Updated"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"||r==="Learning Pathways"?"Progress":"Status"}),s.jsx("th",{className:"w-10 px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:r?"No content available in this category.":"Select a category to view content."})})})]})})}),Cs=()=>s.jsx(ju,{rows:5,columns:4}),Xk=({error:r,onRetry:e})=>s.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[s.jsx(N,{path:ce,size:2,color:"#ef4444",className:"mb-2"}),s.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Failed to load content"}),s.jsx("p",{className:"text-gray-500 text-sm mb-4",children:r.message}),s.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#3db8b0] transition",children:[s.jsx(N,{path:pt,size:.8}),"Retry"]})]}),Zk=({category:r})=>{const e=m.useMemo(()=>{switch(r){case"Courses":return Ps;case"Learning Pathways":return Uu;case"Procedures":return Ye;case"Policies":return Ds;default:return Ps}},[r]);return s.jsx(N,{path:e,size:1.1,color:"#4ECDC4",className:"mr-2"})},eD=({category:r,isLoading:e})=>s.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[s.jsx(Zk,{category:r}),r||"All Categories",e&&s.jsx("div",{className:"ml-2 animate-spin rounded-full h-4 w-4 border-b-2 border-[#4ECDC4]"})]}),tD=({category:r,items:e,CoursesTable:t,LearningPathwaysTable:n,ProceduresTable:a,PoliciesTable:i})=>m.useMemo(()=>{switch(r){case"Courses":return s.jsx(m.Suspense,{fallback:s.jsx(Cs,{}),children:s.jsx(t,{items:e})});case"Learning Pathways":return s.jsx(m.Suspense,{fallback:s.jsx(Cs,{}),children:s.jsx(n,{items:e})});case"Procedures":return s.jsx(m.Suspense,{fallback:s.jsx(Cs,{}),children:s.jsx(a,{items:e})});case"Policies":return s.jsx(m.Suspense,{fallback:s.jsx(Cs,{}),children:s.jsx(i,{items:e})});default:return s.jsx(fh,{selectedCategory:r})}},[r,e,t,n,a,i]),rD=({pagination:r,onPageChange:e,onPageSizeChange:t})=>{const{totalItems:n,totalPages:a,startIndex:i,endIndex:c,currentPage:l,pageSize:o}=r,d=()=>{const y=[];if(a<=5)for(let b=1;b<=a;b++)y.push(b);else{let b=Math.max(1,l-Math.floor(2.5));const x=Math.min(a,b+5-1);x-b+1<5&&(b=Math.max(1,x-5+1));for(let w=b;w<=x;w++)y.push(w)}return y},u=y=>{const v=parseInt(y.target.value);t(v)},h=()=>{l>1&&e(1)},p=()=>{l>1&&e(l-1)},f=()=>{l<a&&e(l+1)},g=()=>{l<a&&e(a)};return n===0?null:s.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 px-4 py-3 bg-white border-t border-gray-200",children:[s.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",i+1," to ",Math.min(c,n)," of"," ",n," items"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"Show:"}),s.jsxs("select",{value:o,onChange:u,className:"px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[s.jsx("option",{value:5,children:"5"}),s.jsx("option",{value:10,children:"10"}),s.jsx("option",{value:25,children:"25"}),s.jsx("option",{value:50,children:"50"})]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:h,disabled:l===1,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"First page",children:s.jsx(N,{path:Vp,size:.8})}),s.jsx("button",{onClick:p,disabled:l===1,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous page",children:s.jsx(N,{path:Eu,size:.8})}),s.jsx("div",{className:"flex items-center gap-1",children:d().map(y=>s.jsx("button",{onClick:()=>e(y),className:`px-2 py-1 text-sm rounded ${y===l?"bg-blue-500 text-white":"hover:bg-gray-100 text-gray-700"}`,children:y},y))}),s.jsx("button",{onClick:f,disabled:l===a,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next page",children:s.jsx(N,{path:Ms,size:.8})}),s.jsx("button",{onClick:g,disabled:l===a,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Last page",children:s.jsx(N,{path:Wp,size:.8})})]})]})]})},sD=({item:r,isExpanded:e,onToggleExpansion:t,onDelete:n,onStartContent:a,progressDisplay:i,dueDateDisplay:c,actionButton:l,columnWidths:o})=>{var d,u;if(!r)return console.warn("TableRow: item prop is undefined or null"),null;const h=()=>{r!=null&&r.id&&t(r.id)},p=()=>{r!=null&&r.id&&n(r.id)},f=()=>{a&&(r!=null&&r.id)&&a(r.id)};try{return s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.content)||"auto"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:h,className:"p-1 hover:bg-gray-200 rounded",children:s.jsx(N,{path:e?Fs:Ms,size:.8,className:"text-gray-500"})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("div",{className:"font-medium text-gray-900 leading-tight",children:r!=null&&r.title&&r.title.length>40?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:r.title.substring(0,40)}),s.jsx("div",{className:"text-sm text-gray-600",children:r.title.substring(40)})]}):(r==null?void 0:r.title)||"Untitled"})})]})}),s.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.progress)||"auto"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex-1",children:s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full ${((i==null?void 0:i.percentage)||0)===0?"bg-gray-400":((i==null?void 0:i.percentage)||0)===100?"bg-[#10B981]":"bg-[#4ECDC4]"}`,style:{width:`${(i==null?void 0:i.percentage)||0}%`}})})}),s.jsx("span",{className:"text-sm text-gray-600 min-w-[3rem]",children:(i==null?void 0:i.text)||"0%"})]})}),s.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.startDate)||"auto"},children:((i==null?void 0:i.percentage)||0)>0&&(r!=null&&r.lastUpdated)?s.jsx("span",{className:"text-sm text-gray-700",children:(()=>{try{return new Date(r.lastUpdated).toLocaleDateString()}catch(g){return console.error(g),"Invalid date"}})()}):s.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),s.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.assigned)||"auto"},children:s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("span",{className:`text-lg font-medium ${((i==null?void 0:i.percentage)||0)>0?"text-[#10B981]":"text-gray-400"}`,children:((i==null?void 0:i.percentage)||0)>0?"âœ“":"âœ—"})})}),s.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.actions)||"auto"},children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:f,disabled:(l==null?void 0:l.disabled)||!1,className:`w-8 h-8 rounded flex items-center justify-center transition-colors ${(l==null?void 0:l.variant)==="primary"?"bg-[#4ECDC4] text-white hover:bg-[#3DB8B0] disabled:bg-gray-300":(l==null?void 0:l.variant)==="secondary"?"bg-[#5B5B5B] text-white hover:bg-[#4A4A4A] disabled:bg-gray-300":"bg-[#EF4444] text-white hover:bg-[#DC2626] disabled:bg-gray-300"} disabled:cursor-not-allowed`,title:((i==null?void 0:i.percentage)||0)===100?"View":((i==null?void 0:i.percentage)||0)>0?"Resume":"Start",children:s.jsx(N,{path:((i==null?void 0:i.percentage)||0)===100?Gp:((i==null?void 0:i.percentage)||0)>0?Mn:Lr,size:.8})}),s.jsx("button",{onClick:p,className:"w-8 h-8 text-[#EF4444] hover:bg-red-50 rounded flex items-center justify-center transition-colors",title:"Delete",children:s.jsx(N,{path:Hn,size:.8})})]})})]}),e&&s.jsx("tr",{className:"bg-gray-50",children:s.jsx("td",{colSpan:5,className:"px-4 py-3",children:s.jsxs("div",{className:"space-y-3",children:[(r==null?void 0:r.description)&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Description"}),s.jsx("p",{className:"text-sm text-gray-600",children:(d=r.data)==null?void 0:d.description})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Category"}),s.jsx("p",{className:"text-sm text-gray-600",children:(r==null?void 0:r.category)||"No category"})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Due Date"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(N,{path:Ns,size:.6,className:"text-gray-400"}),s.jsx("span",{className:`text-sm ${(c==null?void 0:c.color)||"text-gray-600"}`,children:(c==null?void 0:c.text)||"No due date"})]})]}),((u=r==null?void 0:r.data)==null?void 0:u.tags)&&r.data.tags.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Tags"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:r.data.tags.map((g,y)=>s.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:g},y))})]})]})]})})})]})}catch(g){return console.error("Error rendering TableRow:",g),s.jsx("tr",{className:"border-b border-gray-200",children:s.jsxs("td",{colSpan:5,className:"px-4 py-3 text-center text-red-600",children:["Error loading row data. Please refresh the page."," ",g instanceof Error?g.message:"Unknown error"]})})}},nD=r=>{const e=gh(r),t=aD(e),n=`${e}%`;return{percentage:e,color:t,text:n}},gh=r=>{if(r.progress!==void 0)return Math.round(r.progress);switch(r.status){case"draft":return 0;case"published":return 25;case"review":return 75;case"archived":return 100;default:return 0}},aD=r=>r>=100?"bg-green-500":r>=75?"bg-blue-500":r>=50?"bg-yellow-500":r>=25?"bg-orange-500":"bg-red-500",iD=(r,e)=>{const t=e[r];if(!t)return{text:"Not started",color:"text-gray-500",isOverdue:!1};const a=t<new Date;return{text:yh(t),color:a?"text-red-600":"text-gray-700",isOverdue:a}},oD=(r,e)=>{const t=e[r];if(!t)return{text:"No due date",color:"text-gray-500",isOverdue:!1};const a=t<new Date;return{text:yh(t),color:a?"text-red-600":"text-gray-700",isOverdue:a}},lD=(r,e)=>{const t=gh(r);return t===100?{text:"Completed",icon:Mn,onClick:()=>{},disabled:!0,variant:"secondary"}:t>0?{text:"Resume",icon:Lr,onClick:()=>e==null?void 0:e(r.id),disabled:!1,variant:"primary"}:{text:"Start",icon:Lr,onClick:()=>e==null?void 0:e(r.id),disabled:!1,variant:"primary"}},yh=r=>{const e=new Date,t=Math.abs(e.getTime()-r.getTime()),n=Math.ceil(t/(1e3*60*60*24));return n===0?"Today":n===1?r<e?"Yesterday":"Tomorrow":n<7?`${n} days ${r<e?"ago":"from now"}`:r.toLocaleDateString()},cD=(r,e,t)=>{const n=Math.ceil(r/t),a=(e-1)*t,i=a+t;return{totalItems:r,totalPages:n,startIndex:a,endIndex:i,currentPage:e,pageSize:t}},ta=({items:r,onDelete:e,onStartContent:t})=>{const[n,a]=m.useState(new Set),[i]=m.useState({}),[c]=m.useState({}),[l,o]=m.useState(1),[d,u]=m.useState(10),[h]=m.useState({content:500,progress:150,startDate:140,assigned:120,actions:120}),p=r,f=m.useMemo(()=>cD(p.length,l,d),[p.length,l,d]),g=m.useMemo(()=>{const j=f.startIndex,I=f.endIndex;return p.slice(j,I)},[p,f.startIndex,f.endIndex]),y=j=>{o(j)},v=j=>{u(j),o(1)},b=j=>{const I=new Set(n);I.has(j)?I.delete(j):I.add(j),a(I)},x=j=>{e(j)},w=j=>{t&&t(j)};return s.jsxs("div",{className:"overflow-hidden",children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Content"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(j=>{const I=nD(j),E=iD(j.id,i),O=oD(j.id,c),S=lD(j,w);return s.jsx(sD,{item:j,isExpanded:n.has(j.id),onToggleExpansion:b,onDelete:x,onStartContent:w,progressDisplay:I,startDateDisplay:E,dueDateDisplay:O,actionButton:S,columnWidths:h},j.id)})})]})}),s.jsx(rD,{pagination:f,onPageChange:y,onPageSizeChange:v})]})},vh=te.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Vr(),a=r&&r.length>0?r:[];return s.jsx(ta,{items:a,type:"courses",onDelete:t,onStatusUpdate:n,onStartContent:e})});vh.displayName="CoursesTable";const xh=te.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Vr(),a=r.length>0?r:[];return s.jsx(ta,{items:a,type:"learning-pathways",onDelete:t,onStatusUpdate:n,onStartContent:e})});xh.displayName="LearningPathwaysTable";const bh=te.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Vr(),a=r&&r.length>0?r:[];return s.jsx(ta,{items:a,type:"procedures",onDelete:t,onStatusUpdate:n,onStartContent:e})});bh.displayName="ProceduresTable";const _h=te.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Vr(),a=r&&r.length>0?r:[];return s.jsx(ta,{items:a,type:"policies",onDelete:t,onStatusUpdate:n,onStartContent:e})});_h.displayName="PoliciesTable";var dD=Object.defineProperty,uD=Object.defineProperties,mD=Object.getOwnPropertyDescriptors,pu=Object.getOwnPropertySymbols,hD=Object.prototype.hasOwnProperty,pD=Object.prototype.propertyIsEnumerable,fu=(r,e,t)=>e in r?dD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gu=(r,e)=>{for(var t in e||(e={}))hD.call(e,t)&&fu(r,t,e[t]);if(pu)for(var t of pu(e))pD.call(e,t)&&fu(r,t,e[t]);return r},yu=(r,e)=>uD(r,mD(e));const fD=({onFiltersChange:r,selectedCategory:e,onCategoryChange:t,statusOptions:n,departmentOptions:a,difficultyOptions:i,durationOptions:c})=>{const[l,o]=m.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),[d,u]=m.useState(!1),h=m.useCallback((x,w)=>{const j=yu(gu({},l),{[x]:w});o(j),r(j)},[l,r]),p=m.useCallback(x=>{const w=x.target.value,j=yu(gu({},l),{searchQuery:w});o(j),r(j)},[l,r]),f=m.useCallback(x=>{t(x.target.value)},[t]),g=m.useCallback(()=>{u(!d)},[d]),y=m.useCallback(()=>{const x={searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"};o(x),r(x)},[r]),v=[{value:"all",label:"All Categories"},{value:"Courses",label:"Courses"},{value:"Policies",label:"Policies"},{value:"Procedures",label:"Procedures"},{value:"Learning Pathways",label:"Learning Pathways"}],b=[{value:"title",label:"Title"},{value:"date",label:"Date"},{value:"progress",label:"Progress"},{value:"difficulty",label:"Difficulty"},{value:"duration",label:"Duration"}];return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-6",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-4",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(N,{path:Di,size:1,className:"text-gray-400"})}),s.jsx("input",{type:"text",placeholder:"Search all content...",value:l.searchQuery,onChange:p,className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-[#4ECDC4] focus:border-[#4ECDC4] sm:text-sm"})]}),s.jsx("div",{className:"lg:w-48",children:s.jsx("select",{value:e,onChange:f,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4ECDC4] focus:border-[#4ECDC4] sm:text-sm",children:v.map(x=>s.jsx("option",{value:x.value,children:x.label},x.value))})}),s.jsxs("button",{onClick:g,className:`inline-flex items-center px-3 py-2 border rounded-md text-sm font-medium transition-colors ${d?"bg-[#4ECDC4] text-white border-[#4ECDC4]":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[s.jsx(N,{path:Kp,size:1,className:"mr-2"}),"Filters"]}),s.jsxs("button",{onClick:()=>h("sortOrder",l.sortOrder==="asc"?"desc":"asc"),className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 transition-colors",children:[s.jsx(N,{path:Qp,size:1,className:"mr-2"}),l.sortOrder==="asc"?"â†‘":"â†“"]})]}),d&&s.jsxs("div",{className:"border-t pt-4 space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("div",{className:"sm:w-32",children:[s.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),s.jsxs("select",{id:"status-filter",value:l.statusFilter,onChange:x=>h("statusFilter",x.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[s.jsx("option",{value:"all",children:"All Statuses"}),n.map(x=>s.jsx("option",{value:x,children:x},x))]})]}),s.jsxs("div",{className:"sm:w-32",children:[s.jsx("label",{htmlFor:"department-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Department"}),s.jsxs("select",{id:"department-filter",value:l.departmentFilter,onChange:x=>h("departmentFilter",x.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[s.jsx("option",{value:"all",children:"All Departments"}),a.map(x=>s.jsx("option",{value:x,children:x},x))]})]}),s.jsxs("div",{className:"sm:w-32",children:[s.jsx("label",{htmlFor:"difficulty-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Difficulty"}),s.jsxs("select",{id:"difficulty-filter",value:l.difficultyFilter,onChange:x=>h("difficultyFilter",x.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[s.jsx("option",{value:"all",children:"All Levels"}),i.map(x=>s.jsx("option",{value:x,children:x},x))]})]}),s.jsxs("div",{className:"sm:w-32",children:[s.jsx("label",{htmlFor:"duration-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Duration"}),s.jsxs("select",{id:"duration-filter",value:l.durationFilter,onChange:x=>h("durationFilter",x.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[s.jsx("option",{value:"all",children:"Any Duration"}),c.map(x=>s.jsx("option",{value:x,children:x},x))]})]}),s.jsxs("div",{className:"sm:w-32",children:[s.jsx("label",{htmlFor:"sort-by-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Sort By"}),s.jsx("select",{id:"sort-by-filter",value:l.sortBy,onChange:x=>h("sortBy",x.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:b.map(x=>s.jsx("option",{value:x.value,children:x.label},x.value))})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{onClick:y,className:"inline-flex items-center px-3 py-1 border border-gray-300 rounded text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Clear All Filters"})})]})]})},wh=te.memo(()=>{const[r,e]=m.useState(null),t=m.useCallback(D=>{console.error("ContentTable error:",D),e(D)},[]),n=m.useCallback(()=>{e(null)},[]),{selectedCategory:a,selectedContent:i,isLoading:c,error:l,refetchContent:o,deleteContent:d,updateContentStatus:u,setSelectedCategory:h}=Vr(),[p,f]=m.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),g=["Not Started","In Progress","Completed"],y=["central_sterile","clinical","biomedical","supply_chain","general"],v=["Beginner","Intermediate","Advanced"],b=["15 min","30 min","45 min","60 min","90 min+"],x=m.useCallback(D=>{f(D)},[]),w=m.useCallback(D=>{h(D==="all"?"all":D)},[h]),j={isLoading:c,error:l,validationError:null},I={searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""},E=m.useMemo(()=>{if(!i)return[];let D=i;if(p.searchQuery){const k=p.searchQuery.toLowerCase();D=D.filter(P=>{var T;return P.title.toLowerCase().includes(k)||((T=P.data)==null?void 0:T.description)&&P.data.description.toLowerCase().includes(k)||P.department&&P.department.toLowerCase().includes(k)})}return p.statusFilter!=="all"&&(D=D.filter(k=>k.status===p.statusFilter)),p.departmentFilter!=="all"&&(D=D.filter(k=>k.department===p.departmentFilter)),p.difficultyFilter!=="all"&&(D=D.filter(k=>k.difficultyLevel===p.difficultyFilter)),p.durationFilter!=="all"&&(D=D.filter(k=>{if(!k.estimatedDuration)return!1;const P=k.estimatedDuration;switch(p.durationFilter){case"15 min":return P<=15;case"30 min":return P<=30;case"45 min":return P<=45;case"60 min":return P<=60;case"90 min+":return P>90;default:return!0}})),D.sort((k,P)=>{let T,A;switch(p.sortBy){case"title":T=(k.title||"").toLowerCase(),A=(P.title||"").toLowerCase();break;case"date":T=k.lastUpdated?new Date(k.lastUpdated):new Date(0),A=P.lastUpdated?new Date(P.lastUpdated):new Date(0);break;case"progress":T=k.progress,A=P.progress;break;case"difficulty":T=k.difficultyLevel||"",A=P.difficultyLevel||"";break;case"duration":T=k.estimatedDuration||0,A=P.estimatedDuration||0;break;default:T=k.title.toLowerCase(),A=P.title.toLowerCase()}return p.sortOrder==="asc"?T<A?-1:T>A?1:0:T>A?-1:T<A?1:0}),D},[i,p]),{categoryItems:O}=ph({content:E,selectedCategory:a==="all"?null:a,filterOptions:I}),S=Jk({uiState:j,selectedCategory:a,categoryItems:O}),C=()=>S.shouldShowLoading?s.jsx(Cs,{}):S.shouldShowError?s.jsx(Xk,{error:l,onRetry:o}):S.shouldShowEmpty?s.jsx(fh,{selectedCategory:a}):S.shouldShowContent?s.jsx(tD,{category:a,items:O,onStatusUpdate:u,CoursesTable:vh,LearningPathwaysTable:xh,ProceduresTable:bh,PoliciesTable:_h}):null;return r?s.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"text-red-600 text-lg font-medium mb-2",children:"Something went wrong"}),s.jsx("div",{className:"text-gray-600 mb-4",children:r.message}),s.jsx("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Again"})]})}):s.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[s.jsx(fD,{onFiltersChange:x,selectedCategory:a||"all",onCategoryChange:w,statusOptions:g,departmentOptions:y,difficultyOptions:v,durationOptions:b}),s.jsx(eD,{category:a==="all"?"All Categories":a||"",isLoading:c}),(()=>{try{return C()}catch(D){return console.error("Error rendering content:",D),t(D instanceof Error?D:new Error("Unknown error")),null}})()]})});wh.displayName="ContentTable";var bs=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function gD(){const[r,e]=m.useState(null),[t,n]=m.useState([]),[a,i]=m.useState(!1),[c,l]=m.useState(null),o=m.useMemo(()=>new hp,[]),d=m.useCallback(()=>bs(null,null,function*(){try{i(!0),l(null);const g=yield o.getLearningInsights();if(e(g),!g){const y=yield o.generateLearningInsights();y&&e(y)}}catch(g){l(g instanceof Error?g.message:"Failed to load learning insights")}finally{i(!1)}}),[o]),u=m.useCallback((g=5)=>bs(null,null,function*(){try{i(!0),l(null);const y=yield o.getContentRecommendations(g);n(y)}catch(y){l(y instanceof Error?y.message:"Failed to load content recommendations")}finally{i(!1)}}),[o]),h=m.useCallback((g,y)=>bs(null,null,function*(){try{yield o.trackRecommendationInteraction(g,y)}catch(v){console.error("Failed to track recommendation interaction:",v)}}),[o]),p=m.useCallback(g=>bs(null,null,function*(){try{yield o.storeSessionAnalytics(g)}catch(y){console.error("Failed to store session analytics:",y)}}),[o]),f=m.useCallback(()=>bs(null,null,function*(){try{i(!0),l(null);const g=yield o.generateLearningInsights();g&&e(g)}catch(g){l(g instanceof Error?g.message:"Failed to generate new insights")}finally{i(!1)}}),[o]);return m.useEffect(()=>{const g=setTimeout(()=>{d(),u()},200);return()=>clearTimeout(g)},[d,u]),{learningInsights:r,contentRecommendations:t,isLoading:a,error:c,loadLearningInsights:d,loadContentRecommendations:u,trackRecommendationInteraction:h,storeSessionAnalytics:p,generateNewInsights:f,refreshData:()=>{d(),u()}}}const Sh=te.memo(()=>{var r;const e=Br(),{learningInsights:t,storeSessionAnalytics:n,isLoading:a}=gD(),i=m.useCallback(()=>{e("/library")},[e]),c=m.useCallback(l=>{console.error("Knowledge Hub error:",l)},[]);return te.useEffect(()=>{const l=setTimeout(()=>{!a&&t&&n({session_start:new Date().toISOString(),content_items_accessed:["knowledge_hub_main"],learning_path_progress:{current_page:"knowledge_hub"}})},100);return()=>clearTimeout(l)},[a,t,n]),s.jsx($k,{onError:c,maxRetries:3,retryDelay:1e3,children:s.jsx(Ur,{children:s.jsx(Vk,{children:s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Knowledge Hub"}),s.jsxs("p",{className:"text-gray-500 text-sm",children:["Access training materials and educational resources",!a&&t&&s.jsxs("span",{className:"ml-2 text-[#4ECDC4]",children:["â€¢ AI Learning Score:"," ",t==null?void 0:t.learning_efficiency_score,"%"]})]})]}),s.jsx("button",{onClick:i,className:"rounded-md bg-[#4ECDC4] px-4 py-2 text-white hover:bg-[#3db8b0] transition",children:"+ Library"})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[s.jsxs("div",{className:"lg:w-1/4 space-y-6",children:[s.jsx(Gk,{}),s.jsx(Qk,{}),!a&&t&&s.jsx("div",{className:"hidden",children:s.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"AI Learning Insights"}),s.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[s.jsxs("p",{children:["Efficiency:"," ",t==null?void 0:t.learning_efficiency_score,"%"]}),s.jsxs("p",{children:["Next Milestone:"," ",t==null?void 0:t.next_learning_milestone]}),s.jsxs("p",{children:["Optimal Study Time:"," ",t==null?void 0:t.optimal_study_duration," min"]}),((r=t==null?void 0:t.skill_gaps)==null?void 0:r.length)>0&&s.jsxs("p",{children:["Skill Gaps: ",t.skill_gaps.join(", ")]})]})]})})]}),s.jsx("div",{className:"lg:w-3/4",children:s.jsx(wh,{})})]})]})})})})});Sh.displayName="KnowledgeHub";const Si=({item:r,onActionClick:e,status:t,className:n="",isFavorite:a=!1,onToggleFavorite:i,isAiSuggestion:c=!1,aiGlowIntensity:l=0,index:o=0})=>{var d;const u=g=>{switch(g){case"Favorites":return io;case"Courses":return Ps;case"Learning Pathways":return Ei;case"Procedures":return Yp;case"Policies":return oo;case"SDS Sheets":return oo;default:return Ps}},h=g=>{switch(g){case"Favorites":return"bg-yellow-100 text-yellow-800 border border-yellow-200";case"Courses":return"bg-blue-100 text-blue-800 border border-blue-200";case"Learning Pathways":return"bg-purple-100 text-purple-800 border border-purple-200";case"Procedures":return"bg-red-100 text-red-800 border border-red-200";case"Policies":return"bg-green-100 text-green-800 border border-green-200";case"SDS Sheets":return"bg-orange-100 text-orange-800 border border-orange-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},p=()=>{switch(t){case"In Progress":return"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200";case"Completed":return"bg-blue-100 text-blue-700 border border-blue-300 hover:bg-blue-200";default:return c?"bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700 shadow-lg hover:shadow-xl":"border-2 border-[#4ECDC4] text-[#4ECDC4] hover:bg-teal-50"}},f=()=>{switch(t){case"In Progress":return"Added";case"Completed":return"Completed";default:return"+Add"}};return s.jsxs(ne.div,{role:"article","aria-labelledby":`content-card-title-${r.id}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:c?o*.1:0},className:`relative group h-80 flex flex-col ${c?"bg-gradient-to-br from-white via-purple-50 to-pink-50 border-2 border-purple-200 shadow-xl hover:shadow-2xl ai-card":"bg-white border border-gray-100 shadow-lg hover:shadow-xl"} rounded-xl p-6 transition-all duration-300 transform hover:scale-105 ${n}`,style:{boxShadow:c?`0 10px 25px rgba(147, 51, 234, 0.15), 0 0 20px rgba(236, 72, 153, ${.1+Math.sin(l*.1+o)*.05})`:void 0},children:[c&&s.jsx(ne.div,{animate:{opacity:[.3,.8,.3],scale:[1,1.02,1]},transition:{duration:3,repeat:1/0,ease:"easeInOut",delay:o*.2},className:"absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-orange-400 rounded-xl blur-sm -z-10"}),i&&s.jsx("button",{onClick:i,className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-full transition-colors duration-200",children:s.jsx(N,{path:io,size:1.2,color:a?"#FFD700":"#9CA3AF"})}),s.jsx("div",{className:"flex items-start justify-between mb-4 flex-1",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(N,{path:u(r.category),size:1,className:`${c?"text-purple-600":"text-[#4ECDC4]"}`}),s.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${h(r.category)}`,children:r.category})]}),s.jsx("h4",{id:`content-card-title-${r.id}`,className:`text-lg font-semibold mb-2 transition-colors duration-200 h-12 flex items-start ${c?"text-gray-900 group-hover:text-purple-600":"text-gray-900 group-hover:text-[#4ECDC4]"}`,children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"line-clamp-2 leading-tight",children:r.title}),r.source==="Cliniio"&&s.jsx("div",{className:"flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-500 rounded-full text-xs font-medium border border-blue-200 flex-shrink-0",children:s.jsx(N,{path:Ds,size:.6})})]})}),s.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2 h-10 leading-tight",children:String(((d=r.data)==null?void 0:d.description)||"")}),s.jsx("div",{className:`flex items-center gap-2 text-sm font-medium ${c?"text-purple-600":"text-violet-600"}`,children:s.jsxs("span",{children:["+",r.points," points"]})})]})}),s.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full border ${c?"bg-purple-100 text-purple-800 border-purple-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:r.level}),s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[s.jsx(N,{path:An,size:.7}),s.jsx("span",{children:r.duration})]})]}),s.jsx("button",{onClick:e,"aria-label":`Add ${r.title} to Knowledge Hub`,className:`px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${p()}`,children:f()})]})]})},yD=Object.freeze(Object.defineProperty({__proto__:null,default:Si},Symbol.toStringTag,{value:"Module"})),vD=te.lazy(()=>H(()=>Promise.resolve().then(()=>yD),void 0)),xD=({filteredContent:r,handleAddToList:e,getItemStatus:t,favorites:n,handleToggleFavorite:a})=>s.jsx("section",{role:"list","aria-label":"Library content list",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.jsx(m.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:r.map((i,c)=>s.jsx(ne.div,{role:"listitem",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:c*.1},children:s.jsx(vD,{item:i,status:t(i.id),onActionClick:()=>e(i),isFavorite:n.has(i.id),onToggleFavorite:()=>a(i.id),isAiSuggestion:!1,index:c})},i.id))})});class bD extends m.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){console.error("Library Error:",e,t)}render(){return this.state.hasError?s.jsxs("div",{className:"p-6 bg-red-50 text-red-800 rounded-lg",children:[s.jsx("h2",{className:"text-lg font-bold",children:"Oops! Something went wrong in the Library."}),s.jsx("p",{children:"Please refresh the page or try again later."})]}):this.props.children}}var _D=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function wD(){return _D(this,null,function*(){try{const{data:r,error:e}=yield _.from("knowledge_hub_content").select("*").eq("is_active",!0).eq("status","published").order("created_at",{ascending:!1});return e?(console.error("Error fetching content:",e),vu()):(r||[]).map(n=>CD(n,"knowledge_hub_content"))}catch(r){return console.error("Error in fetchLibraryContent:",r),vu()}})}function vu(){return console.log("Using fallback content"),[{id:"handwashing-policy-1",title:"Handwashing Policies for Staff",category:"Policies",status:"Not Started",dueDate:void 0,progress:0,department:"infection_control",lastUpdated:new Date().toISOString(),source:"Cliniio",description:"Comprehensive handwashing protocols and procedures for healthcare staff to maintain infection control standards",level:"Beginner",duration:"20 min",points:7,publishedDate:new Date().toISOString()},{id:"test-item-2",title:"TEST ITEM - This Should Show",category:"Courses",status:"Not Started",dueDate:void 0,progress:0,department:"general",lastUpdated:new Date().toISOString(),source:"Cliniio",description:"This is a test item to verify the library is working",level:"Beginner",duration:"15 min",points:5,publishedDate:new Date().toISOString()}]}function SD(r){return{course:"Courses",procedure:"Procedures",policy:"Policies",learning_pathway:"Learning Pathways"}[r]||"Courses"}function jD(r){if(!r)return"15 min";if(r<60)return`${r} min`;const e=Math.floor(r/60),t=r%60;return t===0?`${e} hr`:`${e} hr ${t} min`}const CD=(r,e)=>{var t;return{id:r.id,title:r.title,description:(t=r.data)==null?void 0:t.description,category:SD(r.content_type||e),level:r.difficulty_level||"Beginner",duration:jD(r.estimated_duration_minutes||r.estimated_read_time_minutes||0),points:r.points||0,status:"Not Started",dueDate:void 0,progress:0,department:r.department||"general",lastUpdated:r.updated_at||r.created_at||new Date().toISOString(),source:"Cliniio",publishedDate:r.published_at||r.created_at||new Date().toISOString()}};var ND=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ID=()=>{const[r,e]=m.useState([]),[t,n]=m.useState(!0),[a,i]=m.useState(null);return m.useEffect(()=>{ND(null,null,function*(){try{n(!0);const l=yield wD();e(l)}catch(l){console.error("useLibraryContent: Error loading content:",l),i(l instanceof Error?l:new Error("Failed to load content")),e([])}finally{n(!1)}})},[]),{content:r,loading:t,error:a}};var TD=Object.defineProperty,ED=Object.defineProperties,kD=Object.getOwnPropertyDescriptors,xu=Object.getOwnPropertySymbols,DD=Object.prototype.hasOwnProperty,PD=Object.prototype.propertyIsEnumerable,bu=(r,e,t)=>e in r?TD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,OD=(r,e)=>{for(var t in e||(e={}))DD.call(e,t)&&bu(r,t,e[t]);if(xu)for(var t of xu(e))PD.call(e,t)&&bu(r,t,e[t]);return r},RD=(r,e)=>ED(r,kD(e));class lr{constructor(){this.progressItems=new Map;try{this.loadFromStorage()}catch(e){console.error("[LearningProgressService] Failed to initialize:",e)}}static getInstance(){try{return lr.instance||(lr.instance=new lr),lr.instance}catch(e){return console.error("[LearningProgressService] Failed to get instance:",e),null}}loadFromStorage(){try{if(typeof window=="undefined"||!window.localStorage){console.warn("[LearningProgressService] localStorage not available");return}const e=localStorage.getItem("learningProgress");if(e){const t=JSON.parse(e);this.progressItems.clear(),t.forEach(n=>{this.progressItems.set(n.id,n)})}}catch(e){console.error("[LearningProgressService] Failed to load from storage:",e)}}saveToStorage(){try{if(typeof window=="undefined"||!window.localStorage){console.warn("[LearningProgressService] localStorage not available for saving");return}const e=Array.from(this.progressItems.values());localStorage.setItem("learningProgress",JSON.stringify(e))}catch(e){console.error("[LearningProgressService] Failed to save to storage:",e)}}addToMyList(e){const t=RD(OD({},e),{status:"In Progress",updated_at:new Date().toISOString()});this.progressItems.set(e.id,t),this.saveToStorage()}markInProgress(e){const t=this.progressItems.get(e);t&&(t.status="In Progress",t.updated_at=new Date().toISOString(),this.saveToStorage())}getItemStatus(e){const t=this.progressItems.get(e);return t?t.status:"Not Started"}updateItemStatus(e,t){const n=this.progressItems.get(e);n&&(n.status=t,n.updated_at=new Date().toISOString(),this.saveToStorage())}getItemsByCategory(e){return Array.from(this.progressItems.values()).filter(t=>t.category===e)}getAllProgressItems(){return Array.from(this.progressItems.values())}removeItem(e){this.progressItems.delete(e),this.saveToStorage()}isInitialized(){return this.progressItems!==void 0}}const AD=Object.freeze(Object.defineProperty({__proto__:null,default:lr},Symbol.toStringTag,{value:"Module"}));function $D(){const[r,e]=m.useState(""),[t,n]=m.useState(!1),[a,i]=m.useState(new Set),[c,l]=m.useState({category:"",skillLevel:"",timeline:"",status:"",source:"",showNewOnly:!1}),[o,d]=m.useState("All"),[u,h]=m.useState("All"),[p]=m.useState(()=>lr.getInstance()),[f,g]=m.useState(!1),[y,v]=m.useState(0),[b,x]=m.useState(!1),w=m.useMemo(()=>["All","Beginner","Intermediate","Advanced"],[]),j=m.useMemo(()=>["< 1 hour","1-3 hours","3-5 hours","5+ hours"],[]),I=m.useMemo(()=>["Not Started","In Progress","Completed"],[]),E=m.useMemo(()=>["All Sources","Cliniio","Admin"],[]),O=m.useMemo(()=>["All","Favorites","Courses","Learning Pathways","Procedures","Policies","SDS Sheets"],[]);return{searchQuery:r,setSearchQuery:e,showFilters:t,setShowFilters:n,favorites:a,setFavorites:i,filters:c,setFilters:l,selectedCategory:o,setSelectedCategory:d,selectedLevel:u,setSelectedLevel:h,progressService:p,aiSuggestionsActive:f,setAiSuggestionsActive:g,aiGlowIntensity:y,setAiGlowIntensity:v,showAiTooltip:b,setShowAiTooltip:x,skillLevels:w,timelines:j,statuses:I,sources:E,categories:O}}var MD=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const FD=te.lazy(()=>H(()=>import("./LibraryFilters-DPffRYxj.js"),__vite__mapDeps([20,2,3,13,1,4,5]))),LD=te.lazy(()=>H(()=>import("./LibraryHeader-n5k2zmOV.js"),__vite__mapDeps([21,2,3,13,1,4,5]))),zD=()=>{const r=Br(),{searchQuery:e,setSearchQuery:t,showFilters:n,setShowFilters:a,favorites:i,setFavorites:c,filters:l,setFilters:o,selectedCategory:d,setSelectedCategory:u,selectedLevel:h,setSelectedLevel:p,progressService:f,aiSuggestionsActive:g,setAiSuggestionsActive:y,aiGlowIntensity:v,setAiGlowIntensity:b,showAiTooltip:x,setShowAiTooltip:w,skillLevels:j,timelines:I,statuses:E,sources:O,categories:S}=$D(),{content:C}=ID();m.useEffect(()=>{const M=setInterval(()=>{b(R=>R+1)},100);return()=>clearInterval(M)},[g,b]);const D=C.filter(M=>{var R;const F=e===""||M.title.toLowerCase().includes(e.toLowerCase())||String(((R=M.data)==null?void 0:R.description)||"").toLowerCase().includes(e.toLowerCase())||M.category.toLowerCase().includes(e.toLowerCase()),V=!l.category||M.category===l.category,L=!l.skillLevel||M.level===l.skillLevel,Y=!l.status||M.status===l.status,G=!l.source||M.source===l.source;return F&&V&&L&&Y&&G}),k=m.useCallback(()=>{y(M=>{const R=!M;if(R){const F={session_start:new Date().toISOString(),content_items_accessed:C.map(V=>V.id),learning_path_progress:{ai_suggestions_enabled:!0},learning_patterns:{ai_interaction:"enabled"}};H(()=>Hs(null,null,function*(){const{AISuggestionsService:V}=yield import("./aiSuggestionsService-Dwba7VEh.js");return{AISuggestionsService:V}}),__vite__mapDeps([22,1,2,3,4,5])).then(({AISuggestionsService:V})=>{new V().storeLearningSessionAnalytics(F)})}return R})},[C,y]),P=m.useCallback(M=>{c(R=>{const F=new Set(R);F.has(M)?F.delete(M):F.add(M);const V=R.has(M)?"removed":"added",L={session_start:new Date().toISOString(),content_items_accessed:[M],learning_path_progress:{favorites_updated:!0},learning_patterns:{favorite_action:V}};return H(()=>Hs(null,null,function*(){const{AISuggestionsService:Y}=yield import("./aiSuggestionsService-Dwba7VEh.js");return{AISuggestionsService:Y}}),__vite__mapDeps([22,1,2,3,4,5])).then(({AISuggestionsService:Y})=>{new Y().storeLearningSessionAnalytics(L)}),F})},[c]),T=m.useCallback(M=>(f==null?void 0:f.getItemStatus(M))||"Not Started",[f]),A=m.useCallback(M=>C.filter(R=>R.category===M).length,[C]),z=m.useCallback(()=>{o({category:"",skillLevel:"",status:"",source:"",timeline:"",showNewOnly:!1}),u(""),p("")},[o,u,p]),W=m.useCallback(M=>MD(null,null,function*(){try{const{data:{user:R}}=yield _.auth.getUser();if(!R){console.error("No authenticated user");return}let F="courses";M.category==="Policies"?F="policies":M.category==="Procedures"&&(F="procedures");const V={user_id:R.id,content_id:M.id,content_type:F,status:"not_started",progress_percentage:0,assigned_at:new Date().toISOString(),is_repeat:M.isRepeat||!1},{error:L}=yield _.from("knowledge_hub_user_progress").insert([V]);if(L){console.error("Error adding to knowledge hub:",L);return}console.log("Successfully added to knowledge hub:",M.title);const Y=document.querySelector(`[data-item-id="${M.id}"]`);if(Y){const G=Y.querySelector("button[onclick]")||Y.querySelector("button:last-child");if(G){const q=G.textContent;G.textContent="Added!",G.classList.add("bg-green-500","text-white"),setTimeout(()=>{G.textContent=q,G.classList.remove("bg-green-500","text-white")},2e3)}else console.log("Button not found in card, item ID:",M.id)}else console.log("Card not found for visual feedback, item ID:",M.id)}catch(R){console.error("Error adding to knowledge hub:",R)}}),[]);return s.jsx(bD,{children:s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white",children:[s.jsx("div",{className:"p-6",children:s.jsxs("button",{onClick:()=>r("/knowledge-hub"),className:"inline-flex items-center gap-2 text-sm text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200",children:[s.jsx(N,{path:Ms,size:.8,className:"rotate-180"}),"Back to Knowledge Hub"]})}),s.jsx(m.Suspense,{fallback:s.jsx(ks,{}),children:s.jsx(LD,{})}),s.jsx("div",{className:"px-6 pb-8",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:"max-w-2xl mx-auto mb-8",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:s.jsx(N,{path:Di,size:1.2,className:"text-gray-400"})}),s.jsx("input",{type:"text",placeholder:"Search courses, procedures, policies...",value:e,onChange:M=>t(M.target.value),className:"w-full pl-12 pr-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-[#4ECDC4]/20 focus:border-[#4ECDC4] transition-all duration-200 shadow-sm","aria-label":"Search content"}),s.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center gap-2",children:s.jsx("button",{onClick:()=>a(!n),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors duration-200 shadow-md ${n?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"}`,children:s.jsx(N,{path:Du,size:1})})})]})}),s.jsx(m.Suspense,{fallback:s.jsx(pp,{}),children:s.jsx(FD,{showFilters:n,filters:l,setFilters:o,selectedCategory:d,setSelectedCategory:u,selectedLevel:h,setSelectedLevel:p,handleResetFilters:z,handleToggleAiSuggestions:k,aiSuggestionsActive:g,aiGlowIntensity:v,showAiTooltip:x,setShowAiTooltip:w,skillLevels:j,timelines:I,statuses:E,sources:O,categories:S,getCategoryCount:A})})]})}),s.jsx("div",{className:"px-6 pb-12",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[g&&s.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-[#4ECDC4]/10 to-[#3db8b0]/10 rounded-2xl p-8 mb-8 border border-[#4ECDC4]/20",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-[#4ECDC4] rounded-full flex items-center justify-center",children:s.jsx(N,{path:Jp,size:1.2,color:"white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"AI-Powered Recommendations"}),s.jsx("p",{className:"text-gray-600",children:"Personalized content suggestions based on your role and learning history"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(Si,{item:{id:"ai-1",title:"Infection Control Mastery",category:"Procedures",description:"Advanced techniques for maintaining sterile environments",level:"Advanced",duration:"75 min",points:65,status:"Not Started",source:"Cliniio",publishedDate:"2025-01-15"},status:(f==null?void 0:f.getItemStatus("ai-1"))||"Not Started",onActionClick:()=>{f==null||f.markInProgress("ai-1")},isFavorite:i.has("ai-1"),onToggleFavorite:()=>P("ai-1"),isAiSuggestion:!0,aiGlowIntensity:v,index:0}),s.jsx(Si,{item:{id:"ai-2",title:"Patient Safety Leadership",category:"Learning Pathways",description:"Develop leadership skills in patient safety protocols",level:"Advanced",duration:"120 min",points:85,status:"Not Started",source:"Cliniio",publishedDate:"2025-01-10"},status:(f==null?void 0:f.getItemStatus("ai-2"))||"Not Started",onActionClick:()=>{f==null||f.markInProgress("ai-2")},isFavorite:i.has("ai-2"),onToggleFavorite:()=>P("ai-2"),isAiSuggestion:!0,aiGlowIntensity:v,index:1})]})]}),s.jsx(xD,{filteredContent:D,handleAddToList:W,getItemStatus:T,favorites:i,handleToggleFavorite:P})]})})]})})},BD=m.createContext(void 0),qD=({children:r})=>{const[e,t]=m.useState("favourites");return s.jsx(BD.Provider,{value:{activeTab:e,setActiveTab:t},children:r})},UD=()=>s.jsx(qD,{children:s.jsx(zD,{})});var jh=(r,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const HD=m.lazy(()=>H(()=>import("./index-DqyDB7Pr.js"),__vite__mapDeps([23,2,3,13,1,4,5,24]))),VD=m.lazy(()=>H(()=>import("./index-Bt3NXZGL.js").then(r=>r.i),__vite__mapDeps([25,2,3,13,1,4,5]))),WD=m.lazy(()=>H(()=>import("./login-BkZ1x_Cy.js").then(r=>r.ae),__vite__mapDeps([1,2,3,4,5]))),GD=m.lazy(()=>H(()=>import("./index-BYMcqti5.js"),__vite__mapDeps([26,2,3,13,1,4,5]))),KD=m.lazy(()=>H(()=>import("./AuthCallback-D-TiER5V.js"),__vite__mapDeps([27,2,3,1,4,5]))),QD=m.lazy(()=>H(()=>import("./HelpArticlePage-C2EX0DJC.js"),__vite__mapDeps([28,2,3,1,4,5,13,29])));let mt=null;const YD=300*1e3;function Ch(){return jh(this,null,function*(){if(!(typeof window!="undefined"&&window.location.pathname==="/login"))try{const{FacilityService:r}=yield H(()=>Promise.resolve().then(()=>Re),void 0),e=yield r.getCurrentFacilityId();if(!e){console.warn("No facility ID available - using development fallback"),mt={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()};return}mt={id:e,timestamp:Date.now()}}catch(r){console.warn("Failed to update facility ID cache:",r),mt||(mt={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()})}})}function _u(){const r=Date.now();if(mt&&r-mt.timestamp<YD)return mt.id;if(mt)return Ch(),mt.id;throw mt?new Error("Unexpected state in getCurrentFacilityId"):new Error("Facility ID lookup failed â€” no fallback allowed in production.")}function JD(){const r=window;if(typeof window=="undefined"||r.__postgrestGuardInstalled||typeof window.fetch=="undefined")return;r.__postgrestGuardInstalled=!0;const e=".supabase.co/rest/v1/",t=window.fetch.bind(window);window.fetch=(n,a)=>jh(null,null,function*(){try{let i=typeof n=="string"?n:n.toString();if(i.includes(e)){const c=new URL(i),l=p=>p.endsWith(":1")?p.slice(0,-2):p,o=[],d=[];for(const[p,f]of c.searchParams.entries()){const g=f.trim();if(g==="eq."||g==="eq"||g==="eq:"||g==="eq:."||g==="."){o.push(p);continue}if(p==="facility_id"&&(g==="eq.:1"||g==="eq:1"||g===":1"||g==="eq.:")){const v=_u();d.push(["facility_id",`eq.${v}`]);continue}const y=l(g);if(y!==g){d.push([p,y]);continue}if(p==="quantity"&&g==="lt.reorder_point"){o.push(p);continue}}if(o.forEach(p=>c.searchParams.delete(p)),d.forEach(([p,f])=>{c.searchParams.set(p,f)}),c.search.includes("facility_id=eq.:1")){const p=_u();c.search=c.search.replace("facility_id=eq.:1",`facility_id=eq.${p}`)}c.search=c.search.replace(/(^|&)([^=&]+)=eq\.(?=(&|$))/g,(p,f)=>f?f.slice(0,-1):""),c.search=c.search.replace(/(:1)(?=(&|$))/g,""),c.search=c.search.replace(/(^|&)quantity=lt\.reorder_point(?=(&|$))/g,(p,f)=>f?f.slice(0,-1):"");const u=new URL(c.toString()),h=new Map;for(const[p,f]of u.searchParams.entries())h.set(p,f);u.search="";for(const[p,f]of h.entries())u.searchParams.append(p,f);u.toString()!==i&&(r.__postgrestGuardLogged||(r.__postgrestGuardLogged=!0,console.info("ðŸ›¡ï¸ PostgREST guard rewrote URL:",{from:i,to:u.toString()})),i=u.toString(),n=i)}}catch(i){console.error(i)}return t(n,a)})}const XD=new yp;function ZD(){return te.useEffect(()=>{H(()=>Hs(null,null,function*(){const{inventoryServiceFacade:r}=yield import("./login-BkZ1x_Cy.js").then(e=>e.ab);return{inventoryServiceFacade:r}}),__vite__mapDeps([1,2,3,4,5])).then(({inventoryServiceFacade:r})=>{r.initialize().catch(e=>{console.error("Failed to initialize inventory service facade:",e)})}),Ch(),JD()},[]),s.jsx(vp,{client:XD,children:s.jsx(As,{children:s.jsx(fp,{children:s.jsx(cf,{children:s.jsx(Lh,{children:s.jsxs(sf,{children:[s.jsxs(zh,{children:[s.jsx(ve,{path:"/login",element:s.jsx(WD,{})}),s.jsx(ve,{path:"/auth/callback",element:s.jsx(KD,{})}),s.jsx(ve,{path:"/home",element:s.jsx(qe,{children:s.jsx(Aw,{})})}),s.jsx(ve,{path:"/sterilization",element:s.jsx(qe,{children:s.jsx(Pm,{})})}),s.jsx(ve,{path:"/sterilization/scanner",element:s.jsx(qe,{children:s.jsx(Am,{})})}),s.jsx(ve,{path:"/inventory",element:s.jsx(qe,{children:s.jsx(RT,{})})}),s.jsx(ve,{path:"/inventory/scanner",element:s.jsx(qe,{children:s.jsx(AT,{})})}),s.jsx(ve,{path:"/environmental-clean",element:s.jsx(qe,{children:s.jsx(xk,{})})}),s.jsx(ve,{path:"/environmental-clean/scanner",element:s.jsx(qe,{children:s.jsx(jk,{})})}),s.jsx(ve,{path:"/knowledge-hub",element:s.jsx(qe,{children:s.jsx(Sh,{})})}),s.jsx(ve,{path:"/library",element:s.jsx(qe,{children:s.jsx(UD,{})})}),s.jsx(ve,{path:"/intelligence",element:s.jsx(qe,{children:s.jsx(GD,{})})}),s.jsx(ve,{path:"/settings",element:s.jsx(qe,{children:s.jsx(HD,{})})}),s.jsx(ve,{path:"/content-builder",element:s.jsx(qe,{children:s.jsx(VD,{})})}),s.jsx(ve,{path:"/help/article/:slug",element:s.jsx(QD,{})}),s.jsx(ve,{path:"/",element:s.jsx(Ci,{to:"/home",replace:!0})})]}),s.jsx(Yy,{})]})})})})})})}"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistrations().then(function(r){for(const e of r)e.unregister(),console.log("Service worker unregistered")}),navigator.serviceWorker.ready.then(r=>{r.unregister(),console.log("Main service worker unregistered")}));rf.createRoot(document.getElementById("root")).render(s.jsx(te.StrictMode,{children:s.jsx(ZD,{})}));export{Hi as B,Zv as E,at as F,Tv as I,J0 as L,fc as R,Yv as S,zs as U,xC as _,K as a,WI as b,Qi as c,wi as d,YE as e,dP as f,Ur as g,Vu as h,Kn as i,oP as j,ft as k,nd as l,Re as m,Ic as t,Ku as u};
