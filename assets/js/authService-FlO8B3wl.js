import{s as o,a6 as l}from"./login-BkZ1x_Cy.js";import"./utils-DSBVV_PW.js";import"./vendor-DoALFvsH.js";import"./data-73RVSc-N.js";import"./ui-DETUEJ2B.js";var c=(d,e,r)=>new Promise((t,s)=>{var n=a=>{try{i(r.next(a))}catch(h){s(h)}},u=a=>{try{i(r.throw(a))}catch(h){s(h)}},i=a=>a.done?t(a.value):Promise.resolve(a.value).then(n,u);i((r=r.apply(d,e)).next())});class P{static signIn(e){return c(this,arguments,function*({email:r,password:t}){try{const{data:s,error:n}=yield o.auth.signInWithPassword({email:r,password:t});if(n)throw n;if(s&&s.user&&s.user.id){const{data:u,error:i}=yield o.from("users").select("*").eq("id",s.user.id).single();return i&&console.warn("Failed to fetch user profile:",i),{user:u,session:s.session,error:null}}return{user:null,session:null,error:"No user data received"}}catch(s){return{user:null,session:null,error:l(s).message}}})}static signUp(e){return c(this,arguments,function*({email:r,password:t,fullName:s,role:n="user"}){try{const{data:u,error:i}=yield o.auth.signUp({email:r,password:t,options:{data:{full_name:s,role:n}}});if(i)throw i;if(u.user){const a=s.trim().split(" "),h=a[0]||"",p=a.slice(1).join(" ")||"",f={id:u.user.id,email:u.user.email,first_name:h,last_name:p,role:n,facility_id:"default"},{error:m}=yield o.from("users").insert(f);return m&&console.warn("Failed to create user profile:",m),{user:f,session:u.session,error:null}}return{user:null,session:null,error:"No user data received"}}catch(u){return{user:null,session:null,error:l(u).message}}})}static signOut(){return c(this,null,function*(){try{const{error:e}=yield o.auth.signOut();if(e)throw e;return{error:null}}catch(e){return{error:l(e).message}}})}static getCurrentUser(){return c(this,null,function*(){try{const{data:{user:e},error:r}=yield o.auth.getUser();if(r)throw r;if(!e)return{user:null,session:null,error:null};const{data:{session:t}}=yield o.auth.getSession();if(!t)return{user:null,session:null,error:"No active session"};const{data:s,error:n}=yield o.from("users").select("*").eq("id",e.id).single();return n&&console.warn("Failed to fetch user profile:",n),{user:s,session:null,error:null}}catch(e){return{user:null,session:null,error:l(e).message}}})}static getSession(){return c(this,null,function*(){try{const{data:{session:e},error:r}=yield o.auth.getSession();if(r)throw r;return{session:e,error:null}}catch(e){return{session:null,error:l(e).message}}})}static updateProfile(e,r){return c(this,null,function*(){try{const{data:t,error:s}=yield o.from("users").update(r).eq("id",e).select().single();if(s)throw s;return{user:t,error:null}}catch(t){return{user:null,error:l(t).message}}})}static resetPassword(e){return c(this,null,function*(){try{const{error:r}=yield o.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/reset-password`});if(r)throw r;return{error:null}}catch(r){return{error:l(r).message}}})}static updatePassword(e){return c(this,null,function*(){try{const{error:r}=yield o.auth.updateUser({password:e});if(r)throw r;return{error:null}}catch(r){return{error:l(r).message}}})}static onAuthStateChange(e){return o.auth.onAuthStateChange((r,t)=>{e(r,t)})}}export{P as SupabaseAuthService};
