const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/services-JA4N6ZXe.js","assets/js/react-vendor-DBfrHuQ-.js","assets/js/data-vendor-4okv28M8.js","assets/js/vendor-BY7xYAL4.js","assets/js/inventory-pages-yK5D55FD.js","assets/js/ui-vendor-BmV1twT8.js","assets/css/ui-vendor-DJSy8M6b.css","assets/js/utils-vendor-BtegoRPv.js","assets/js/knowledgehub-pages-DX_b2YG9.js"])))=>i.map(i=>d[i]);
import{j as e,r as u,R as Z,c as Oe,N as no,I as C,a as Ds,u as Er,b as Es,F as lo,d as io,e as oo,f as co,g as uo,h as mo,i as xo,k as po,l as ho,m as go,n as fo,o as Jl,p as bo,q as yo,s as vo,M as jo,t as Hr,v as ws,w as Xl,x as wo,y as No,z as Co,L as Zl,B as gr,A as je,C as So,D as _o,E as To,G as ko,H as ei,J as ti,K as Io,O as Po}from"./react-vendor-DBfrHuQ-.js";import{f as si,F as _t,o as Do,l as Eo,B as Ls,a as Oo,b as $o,c as fs,d as Ao,e as Vr,g as Ro,h as ri,t as ts,i as fr,S as Bo,U as Os,j as $s,k as Fo,s as Mo,m as Wr,n as Lo,p as zo,T as Uo,I as $t,q as ai,r as qo,v as ni,u as ue,w as Ho,x as bs,A as ht,P as Gr,y as At,z as Rt,C as zs,D as gt,E as os,G as Vo}from"./services-JA4N6ZXe.js";import{m as xt,a as li,b as ae,c as ce,d as ze,e as ut,f as Me,g as Wo,h as Kr,i as Ne,j as Ue,k as ii,l as ns,n as qe,o as As,p as oi,q as Go,r as Se,s as Ko,t as br,u as ci,v as kt,w as Qo,x as Yo,y as Jo,z as Qr,A as Xo,B as Zo,C as ec,D as Et,E as Or,F as pt,G as yr,H as $r,I as ss,J as mt,K as di,L as ui,M as Ns,N as Ee,O as Ar,P as mi,Q as vr,R as It,S as Pt,T as tc,U as Yr,V as sc,W as xi,X as jr,Y as wr,Z as Dt,_ as rc,$ as ac,a0 as nc,a1 as Cs,a2 as lc,a3 as ic,a4 as oc,a5 as He,a6 as Zt,a7 as rs,a8 as Jr,a9 as cc,aa as pi,ab as hi,ac as gi,ad as fi,ae as bi,af as dc,ag as ys,ah as uc,ai as mc,aj as Rs,ak as xc,al as pc,am as hc,an as Xr,ao as gc,ap as fc,aq as Zr,ar as bc,as as es,at as yc,au as ea,av as vc,aw as jc,ax as wc,ay as Nc,az as Cc,aA as ta}from"./ui-vendor-BmV1twT8.js";import{c as Ot,A as Bs,m as me}from"./utils-vendor-BtegoRPv.js";import{c as Sc,p as Fs}from"./data-vendor-4okv28M8.js";const _c="modulepreload",Tc=function(r){return"/"+r},sa={},Ve=function(t,s,n){let a=Promise.resolve();if(s&&s.length>0){let l=function(d){return Promise.all(d.map(x=>Promise.resolve(x).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),o=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=l(s.map(d=>{if(d=Tc(d),d in sa)return;sa[d]=!0;const x=d.endsWith(".css"),m=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const p=document.createElement("link");if(p.rel=x?"stylesheet":_c,x||(p.as="script"),p.crossOrigin="",p.href=d,o&&p.setAttribute("nonce",o),document.head.appendChild(p),x)return new Promise((f,g)=>{p.addEventListener("load",f),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(c){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=c,window.dispatchEvent(o),!o.defaultPrevented)throw c}return a.then(c=>{for(const o of c||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})};function tv(){return e.jsxs("div",{className:"flex items-center justify-center h-full w-full bg-transparent",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-t-transparent border-gray-400"}),e.jsx("span",{className:"ml-3 text-gray-500 text-sm font-medium",children:"Loading..."})]})}const yi=u.createContext(void 0),sv=({children:r})=>{const[t,s]=Z.useState("/"),[n,a]=Z.useState(!0),i=Z.useCallback(()=>{a(!0)},[]),c=Z.useCallback(()=>{a(!1)},[]);return e.jsx(yi.Provider,{value:{currentPath:t,setCurrentPath:s,isDrawerOpen:n,openDrawer:i,closeDrawer:c},children:r})},kc=()=>{const r=u.useContext(yi);if(!r)throw new Error("useNavigation must be used within NavigationProvider");return r},Ic="",Pc="";console.debug=()=>{},console.info=()=>{},console.warn=()=>{};const K=Sc(Ic,Pc,{auth:{persistSession:!0,autoRefreshToken:!0}}),Dc=r=>(r?console.info(`🏥 Using facility scope: ${r}`):console.warn("⚠️ Missing facilityId — using default Supabase client"),K),Ec=Object.freeze(Object.defineProperty({__proto__:null,getScopedClient:Dc,supabase:K},Symbol.toStringTag,{value:"Module"})),Nr={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},Oc=()=>"INFO";let Cr=Oc();const Te=r=>Nr[r]<=Nr[Cr],ye={error:(r,...t)=>{Te("ERROR")&&console.error(r,...t)},warn:(r,...t)=>{Te("WARN")&&console.warn(r,...t)},info:(r,...t)=>{Te("INFO")&&console.info(r,...t)},debug:(r,...t)=>{Te("DEBUG")&&console.log(r,...t)},verbose:(r,...t)=>{Te("VERBOSE")&&console.log(r,...t)},perf:(r,...t)=>{Te("DEBUG")&&console.log(`[PERF] ${r}`,...t)},security:(r,...t)=>{Te("INFO")&&console.log(`[SECURITY] ${r}`,...t)},audit:(r,...t)=>{Te("INFO")&&console.log(`[AUDIT] ${r}`,...t)},realtime:(r,...t)=>{Te("DEBUG")&&console.log(r,...t)},getLevel:()=>Cr,setLevel:r=>{Nr[r]!==void 0&&(Cr=r,console.log(`🔧 Logger level changed to: ${r}`))},isEnabled:r=>Te(r)};var vs={};const Ss=(r,t="")=>{if(typeof process!="undefined"&&(process!=null&&vs)&&r in vs)return vs[r];if(typeof window!="undefined"&&window.env&&r in window.env)return window.env[r];if(t===void 0)throw new Error(`Missing required env var: ${r}`);return t},$c=()=>{var r;return typeof process!="undefined"&&((r=process==null?void 0:vs)==null?void 0:r.NODE_ENV)==="development"},rv=()=>typeof window!="undefined";var Us=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const vi=u.createContext(void 0),av=({children:r})=>{const[t,s]=u.useState(null),[n,a]=u.useState(!1),[i,c]=u.useState(!1),[o,l]=u.useState(!1),[d,x]=u.useState(0),m=1800*1e3,p=()=>t?!t.name||t.name.trim()===""?t.email||"Unknown User":t.name:"Unknown User",f=h=>{console.log("🔄 UserContext: handleSetCurrentUser called with:",h?`${h.name} (${h.email})`:"null"),s(h),h?(localStorage.setItem("currentUser",JSON.stringify(h)),x(Date.now())):(localStorage.removeItem("currentUser"),x(0))},g=u.useCallback(()=>Us(null,null,function*(){if(n)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log("🚫 UserContext: No auth token found, skipping refreshUserData");return}console.log("🔄 UserContext: Starting refreshUserData...");const y=Date.now();if(t&&y-d<m){ye.info("✅ UserContext: Using cached user data"),l(!0);return}try{a(!0),ye.info("🔄 UserContext: Starting user data refresh...");const{data:{session:b}}=yield K.auth.getSession();if(!b){ye.info("⚠️ UserContext: No active Supabase session, skipping refresh"),l(!0);return}const _=new Promise(($,D)=>{setTimeout(()=>D(new Error("User data fetch timeout")),5e3)}),P=Us(null,null,function*(){var $,D,w,T,k;const S=Date.now(),{data:{user:I},error:E}=yield K.auth.getUser();if(E){console.error("❌ UserContext: Auth error:",E);return}if(!I){ye.info("⚠️ UserContext: No authenticated user found");return}ye.info("✅ UserContext: Found authenticated user:",I.id);const O=Date.now()-S;ye.info(`⏱️ UserContext: Auth fetch took ${O}ms`);const A=Date.now(),{data:B,error:R}=yield K.from("users").select("*").eq("id",I.id).single();if(R){if(console.error("❌ UserContext: Failed to fetch user profile:",R),R.code==="PGRST116"){console.log("🔄 UserContext: Creating missing user profile...");const{error:q}=yield K.from("users").insert({id:I.id,email:I.email,first_name:I.email.split("@")[0],last_name:"",role:"user",facility_id:si.getDefaultFacilityId(),avatar_url:(($=I.user_metadata)==null?void 0:$.avatar_url)||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(q){console.error("❌ UserContext: Failed to create user profile:",q);return}console.log("✅ UserContext: User profile created successfully");const{data:M}=yield K.from("users").select("*").eq("id",I.id).single();if(M){const H={id:M.id,name:`${M.first_name||""} ${M.last_name||""}`.trim()||((D=M.email)==null?void 0:D.split("@")[0])||"User",email:M.email,role:M.role,avatar_url:M.avatar_url,facility_id:M.facility_id};f(H);return}}return}const Q=Date.now()-A;if(ye.info(`⏱️ UserContext: Profile fetch took ${Q}ms`),ye.info(`⏱️ UserContext: Total fetch time: ${Date.now()-S}ms`),B){let q=B.avatar_url;if(!q&&((w=I.user_metadata)!=null&&w.avatar_url)){q=I.user_metadata.avatar_url,console.log("🔧 UserContext: Using avatar_url from auth metadata:",q);try{yield K.from("users").update({avatar_url:q}).eq("id",I.id),console.log("✅ UserContext: Updated database with avatar_url from auth metadata")}catch(X){console.error("❌ UserContext: Failed to update avatar_url:",X)}}!q&&((T=I.user_metadata)!=null&&T.avatar_url)&&(q=I.user_metadata.avatar_url,console.log("🔧 UserContext: Using avatar_url from Supabase auth user:",q)),q||(q=`https://ui-avatars.com/api/?name=${encodeURIComponent(B.first_name||B.email||"User")}&background=4ECDC4&color=fff&size=128`,console.log("🔧 UserContext: Using default avatar URL:",q));const M={id:B.id,name:`${B.first_name||""} ${B.last_name||""}`.trim()||((k=B.email)==null?void 0:k.split("@")[0])||"User",email:B.email,role:B.role,avatar_url:q,facility_id:B.facility_id},H={admin:"Administrator",manager:"Manager",user:"User",viewer:"Viewer"},V=typeof B.role=="string"?B.role:"user";M.role=H[V]||V,s(M),x(y)}c(!0)});yield Promise.race([P,_])}catch(b){b instanceof Error&&b.message.includes("timeout")&&ye.warn("⚠️ UserContext: User data fetch timed out, this may indicate database performance issues"),console.error("❌ UserContext: Error refreshing user data:",b)}finally{a(!1),c(!0)}}),[n,t,d,m]),v=u.useCallback(()=>{console.log("🧹 UserContext: Starting clearUserData..."),ye.info("🧹 UserContext: Clearing all user data on logout"),s(null),c(!1),l(!1),x(0),a(!1),["currentUser","userProfile","userData","user_preferences","sb-user","user_data"].forEach(b=>{const _=localStorage.getItem(b);_&&(console.log(`🗑️ Clearing localStorage.${b}:`,_.substring(0,100)+"..."),localStorage.removeItem(b))}),["currentUser","userProfile","userData","user_preferences","user_id","user_email","user_role"].forEach(b=>{const _=sessionStorage.getItem(b);_&&(console.log(`🗑️ Clearing sessionStorage.${b}:`,_.substring(0,100)+"..."),sessionStorage.removeItem(b))}),console.log("✅ UserContext: clearUserData completed"),ye.info("✅ UserContext: All user data cleared successfully")},[]),j=u.useCallback(()=>Us(null,null,function*(){if(i||n)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log("🚫 UserContext: No auth token found, skipping initializeUserContext");return}ye.info("🔄 UserContext: Starting user data refresh..."),yield g(),c(!0)}),[i,n,g]);return u.useEffect(()=>{if(!i){const h=Date.now();if(t&&h-d<m){c(!0);return}const y=setTimeout(()=>{if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log("🚫 UserContext: No auth token found, skipping auto-initialization"),c(!0);return}t?g():c(!0)},100);return()=>clearTimeout(y)}},[i,t,d,m,g]),e.jsx(vi.Provider,{value:{currentUser:t,setCurrentUser:f,getUserDisplayName:p,refreshUserData:g,initializeUserContext:j,clearUserData:v,isLoading:n},children:r})},$e=()=>{const r=u.useContext(vi);if(!r)throw new Error("useUser must be used within a UserProvider");return r};var Ac=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const ji=u.createContext(void 0),nv=({children:r})=>{const[t,s]=u.useState(null),[n,a]=u.useState(!0),[i,c]=u.useState(null),o=()=>(t==null?void 0:t.id)||null,l=()=>Ac(null,null,function*(){var d;try{a(!0),c(null);const x=yield _t.getCurrentFacilityId();if(!x)throw new Error("No facility ID available - user not authenticated");const m=yield _t.getFacility(x);s(m),localStorage.setItem("currentFacility",JSON.stringify(m))}catch(x){if(console.warn("⚠️ Facility context error, using development fallback:",x),typeof window!="undefined"&&((d=window.location)==null?void 0:d.hostname)==="localhost"){console.warn("Using dev facility fallback in development/test mode");const p={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0};s(p),localStorage.setItem("currentFacility",JSON.stringify(p)),c(null)}else throw new Error("FacilityContext failed to resolve facility ID — no fallback allowed in production.")}finally{a(!1)}});return u.useEffect(()=>{if(typeof window!="undefined"&&window.location.pathname==="/login"){a(!1);return}l().catch(d=>{typeof window!="undefined"&&c(d.message)})},[]),e.jsx(ji.Provider,{value:{currentFacility:t,setCurrentFacility:s,getCurrentFacilityId:o,isLoading:n,error:i,refreshFacility:l},children:r})},Rr=()=>{const r=u.useContext(ji);if(!r)throw new Error("useFacility must be used within a FacilityProvider");return r};var Rc=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class Bc extends Z.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){return Rc(this,null,function*(){console.error("💥 Global Error Boundary caught:",t,s),this.props.onError&&this.props.onError(t,s),yield Do.logCritical("Global React component crash",{error:t.message,stack:t.stack,componentStack:s.componentStack})})}render(){if(this.state.hasError){if(this.props.fallback){if(Z.isValidElement(this.props.fallback))return this.props.fallback;{const t=this.props.fallback;return e.jsx(t,{error:this.state.error,errorInfo:void 0})}}return e.jsxs("div",{className:"p-6 text-center text-red-700 bg-red-50 rounded-xl",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Something went wrong."}),e.jsx("p",{className:"text-sm opacity-75",children:"The team has been notified and is investigating."})]})}return this.props.children}}var Fc=Object.defineProperty,Mc=Object.defineProperties,Lc=Object.getOwnPropertyDescriptors,ra=Object.getOwnPropertySymbols,zc=Object.prototype.hasOwnProperty,Uc=Object.prototype.propertyIsEnumerable,aa=(r,t,s)=>t in r?Fc(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Bt=(r,t)=>{for(var s in t||(t={}))zc.call(t,s)&&aa(r,s,t[s]);if(ra)for(var s of ra(t))Uc.call(t,s)&&aa(r,s,t[s]);return r},qs=(r,t)=>Mc(r,Lc(t));const Br=Oe((r,t)=>{const n=typeof window!="undefined"?localStorage.getItem("token"):null;return{token:n,authToken:n,tokenExpiry:null,remember:!1,formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,stage:"credentials",otp:""},errors:{},loading:!1,csrfToken:null,isSecureMode:!1,isOffline:!1,failedAttempts:0,setToken:(a,i)=>{typeof window!="undefined"&&(i?localStorage.setItem("token",a):sessionStorage.setItem("token",a),r({token:a,authToken:a,remember:i}))},setAuthToken:a=>{typeof window!="undefined"&&a&&localStorage.setItem("token",a),r({authToken:a,token:a})},setSessionExpiry:a=>{r({tokenExpiry:a})},setField:(a,i)=>{r(c=>({formData:qs(Bt({},c.formData),{[a]:i})}))},setErrors:a=>{r(i=>({errors:Bt(Bt({},i.errors),a)}))},setLoading:a=>{r({loading:a})},setError:a=>{r(i=>({errors:qs(Bt({},i.errors),{submit:a})}))},clearError:()=>{r(a=>({errors:qs(Bt({},a.errors),{submit:void 0})}))},incrementFailedAttempts:()=>{r(a=>({failedAttempts:a.failedAttempts+1}))},resetFailedAttempts:()=>{r({failedAttempts:0})},reset:()=>{r({formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,stage:"credentials",otp:""},errors:{},loading:!1,failedAttempts:0})},clear:()=>{typeof window!="undefined"&&(localStorage.removeItem("token"),sessionStorage.removeItem("token"),r({token:null,authToken:null,tokenExpiry:null,formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,stage:"credentials",otp:""},errors:{},loading:!1,failedAttempts:0}))},get isTokenExpired(){const a=t();return a.tokenExpiry?new Date>new Date(a.tokenExpiry):!1}}}),qc=Object.freeze(Object.defineProperty({__proto__:null,useLoginStore:Br},Symbol.toStringTag,{value:"Module"}));function lv({children:r}){const{token:t,clear:s}=Br();return u.useEffect(()=>{t||(Eo.info("No token found — triggering logout cleanup."),s())},[t,s]),t?e.jsx(e.Fragment,{children:r}):e.jsx(no,{to:"/login",replace:!0})}var na,la;const Hc=(na=void 0)!=null?na:"",Vc=(la=void 0)!=null?la:"",wi=()=>({url:Hc,anonKey:Vc}),Sr=()=>{function r(){let n=Ss("VITE_SUPABASE_URL",""),a=Ss("VITE_SUPABASE_ANON_KEY","");if(!n||!a){const i=wi();n=i.url,a=i.anonKey}return{supabaseUrl:n,supabaseAnonKey:a}}const{supabaseUrl:t,supabaseAnonKey:s}=r();return!!(t&&s&&t!=="https://mock.supabase.co")},Wc=()=>{function r(){let s=Ss("VITE_SUPABASE_URL",""),n=Ss("VITE_SUPABASE_ANON_KEY","");if(!s||!n){const a=wi();s=a.url,n=a.anonKey}return{supabaseUrl:s,supabaseAnonKey:n}}const{supabaseUrl:t}=r();return t||""},Gc=r=>typeof r=="string"?new Error(r):r!=null&&r.message?new Error(r.message):typeof r=="object"&&"error_description"in r&&r.error_description?new Error(r.error_description):new Error("An unexpected error occurred with Supabase"),iv=Object.freeze(Object.defineProperty({__proto__:null,getSupabaseUrl:Wc,handleSupabaseError:Gc,isSupabaseConfigured:Sr,supabase:K},Symbol.toStringTag,{value:"Module"})),ia=r=>{if(!r)return null;const t=localStorage.getItem("officeHoursSettings");if(!t)return oa(r,{workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},startHour:8,endHour:17});const s=JSON.parse(t);return oa(r,s)},oa=(r,t)=>{const s=new Date(r);return s.setHours(s.getHours()+24),Kc(s,t)},Kc=(r,t)=>{const s=new Date(r),n=s.getDay(),a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i=a[n];if(!t.workingDays[i]){let l=1;for(;l<=7;){const d=new Date(s);d.setDate(d.getDate()+l);const x=d.getDay(),m=a[x];if(t.workingDays[m])return s.setDate(s.getDate()+l),s.setHours(t.startHour,0,0,0),s;l++}}const o=s.getHours();if(o<t.startHour)s.setHours(t.startHour,0,0,0);else if(o>=t.endHour){let l=1;for(;l<=7;){const d=new Date(s);d.setDate(d.getDate()+l);const x=d.getDay(),m=a[x];if(t.workingDays[m])return s.setDate(s.getDate()+l),s.setHours(t.startHour,0,0,0),s;l++}}return s},Qc=r=>{const t=new Date,s=r.getTime()-t.getTime(),n=Math.ceil(s/(1e3*60*60*24));return n===0?"Today":n===1?"Tomorrow":n<7?r.toLocaleDateString("en-US",{weekday:"long"}):r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};var Yc=Object.defineProperty,Jc=Object.defineProperties,Xc=Object.getOwnPropertyDescriptors,ca=Object.getOwnPropertySymbols,Zc=Object.prototype.hasOwnProperty,ed=Object.prototype.propertyIsEnumerable,da=(r,t,s)=>t in r?Yc(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ft=(r,t)=>{for(var s in t||(t={}))Zc.call(t,s)&&da(r,s,t[s]);if(ca)for(var s of ca(t))ed.call(t,s)&&da(r,s,t[s]);return r},Mt=(r,t)=>Jc(r,Xc(t)),Hs=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const td=r=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null,setBiTestCompleted:t=>r({biTestCompleted:t}),setBiTestDate:t=>r({biTestDate:t}),recordBITestResult:t=>Hs(null,null,function*(){console.log("🔬 Store: recordBITestResult called with:",t);try{const{data:{user:s},error:n}=yield K.auth.getUser();if(n||!s)throw new Error("User not authenticated");const a="550e8400-e29b-41d4-a716-446655440000",i={facility_id:a};let c=[],o=null,l=null;try{c=yield Ls.getAvailableKits(i.facility_id),c.length>0&&(o=c[0],l=yield Ls.getCurrentTestConditions())}catch(m){console.error(m),o={id:"default-kit",facility_id:i.facility_id,name:"Default BI Kit",manufacturer:"Default Manufacturer",lot_number:"DEFAULT-001",expiry_date:new Date(Date.now()+365*24*60*60*1e3).toISOString(),incubation_time_minutes:60,incubation_temperature_celsius:37,quantity:1,min_quantity:1,max_quantity:100,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},l={room_temperature_celsius:22,humidity_percent:45,equipment_used:"Default Equipment",operator:s.id,operator_id:s.id,facility_id:i.facility_id,test_date:new Date().toISOString()}}const d={facility_id:a,operator:s.id,test_date:new Date().toISOString(),result:t.status==="pending"?"pass":t.status,bi_lot_number:(o==null?void 0:o.lot_number)||"",bi_expiry_date:(o==null?void 0:o.expiry_date)||null,incubation_time_minutes:(o==null?void 0:o.incubation_time_minutes)||60,incubation_temperature_celsius:(o==null?void 0:o.incubation_temperature_celsius)||37,test_conditions:l||void 0,failure_reason:t.status==="fail"?"BI test failed":void 0,skip_reason:t.status==="skip"?"BI test skipped":void 0,compliance_notes:t.status==="pass"?"BI test passed":void 0},x=yield Oo.createBITestResult(d);if(o&&o.id!=="default-kit")try{yield Ls.decrementKitQuantity(o.id)}catch(m){console.error(m)}return console.log("🔬 Store: Updating state with lastBITestDate:",t.date.toISOString()),r(m=>{const p=ia(t.date),f={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:t.passed?"BI Test Passed":"BI Test Failed",time:t.date,toolCount:1,color:t.passed?"bg-green-500":"bg-red-500"},g=Mt(Ft({},t),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),v={biTestCompleted:t.passed,biTestDate:t.date.toISOString(),biTestResults:[...m.biTestResults,g],lastBITestDate:t.date.toISOString(),nextBITestDue:p,biTestPassed:t.passed,activityLog:[f,...m.activityLog].slice(0,20)};return console.log("🔬 Store: New state lastBITestDate:",v.lastBITestDate),v}),x}catch(s){throw console.error("Error recording BI test result:",s),console.log("🔬 Store: Error path - updating state with lastBITestDate:",t.date.toISOString()),r(n=>{const a=ia(t.date),i={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:t.passed?"BI Test Passed":"BI Test Failed",time:t.date,toolCount:1,color:t.passed?"bg-green-500":"bg-red-500"},c=Mt(Ft({},t),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),o={biTestCompleted:t.passed,biTestDate:t.date.toISOString(),biTestResults:[...n.biTestResults,c],lastBITestDate:t.date.toISOString(),nextBITestDue:a,biTestPassed:t.passed,activityLog:[i,...n.activityLog].slice(0,20)};return console.log("🔬 Store: Error path - New state lastBITestDate:",o.lastBITestDate),o}),s}}),setNextBITestDue:t=>r({nextBITestDue:t}),setLastBITestDate:t=>r({lastBITestDate:t}),setBiTestPassed:t=>r({biTestPassed:t}),setBiTestOptedOut:t=>r({biTestOptedOut:t}),addActivity:t=>r(s=>({activityLog:[Mt(Ft({},t),{id:t.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),...s.activityLog].slice(0,20)})),activateBIFailure:t=>r(()=>({biFailureActive:!0,biFailureDetails:{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,failure_date:new Date,affected_tools_count:t.affectedToolsCount,affected_batch_ids:t.affectedBatchIds,detected_by_operator_id:t.operator,facility_id:"unknown",incident_number:`BI-${Date.now()}`,severity_level:"high",status:"active",resolution_notes:null,resolved_at:null,resolved_by:null}})),deactivateBIFailure:()=>r(()=>({biFailureActive:!1,biFailureDetails:null})),loadBIFailureIncidents:t=>Hs(null,null,function*(){try{const{data:s,error:n}=yield K.from("bi_failure_incidents").select("*").eq("facility_id",t).eq("status","resolved").gte("resolved_at",new Date(Date.now()-2592e6).toISOString()).order("resolved_at",{ascending:!1}).limit(20);if(n){console.error("Failed to load BI failure incidents:",n);return}r(a=>{const i=new Set(a.activityLog.map(l=>l.id)),c=[];(s||[]).forEach(l=>{var d;const x=`bi-incident-resolved-${l.id}`;i.has(x)||c.push({id:x,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date(String(l.resolved_at||l.updated_at)),toolCount:((d=l.metadata)==null?void 0:d.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:l.id,operatorId:l.resolved_by_operator,resolutionNotes:l.resolution_notes}})});const o=[...c,...a.activityLog].sort((l,d)=>new Date(d.time).getTime()-new Date(l.time).getTime()).slice(0,20);return Mt(Ft({},a),{activityLog:o})})}catch(s){console.error("Error loading BI failure incidents:",s)}}),loadBITestResults:t=>Hs(null,null,function*(){try{const{data:s,error:n}=yield K.from("bi_test_results").select("*").eq("facility_id",t).order("test_date",{ascending:!1}).limit(50);if(n){console.error("Failed to load BI test results:",n);return}const a=(s||[]).map(i=>({id:String(i.id),facility_id:String(i.facility_id),test_number:String(i.test_number),test_date:String(i.test_date),result:String(i.result),status:String(i.result),operator:String(i.operator),cycle_id:String(i.cycle_id),bi_lot_number:String(i.bi_lot_number),bi_expiry_date:String(i.bi_expiry_date),incubation_time_minutes:Number(i.incubation_time_minutes),incubation_temperature_celsius:Number(i.incubation_temperature_celsius),test_conditions:i.test_conditions||{},failure_reason:String(i.failure_reason),skip_reason:String(i.skip_reason),compliance_notes:String(i.compliance_notes),date:new Date(String(i.test_date)),toolId:String(i.test_number||"default-tool"),passed:i.result==="pass",notes:String(i.compliance_notes||i.failure_reason||i.skip_reason),created_at:String(i.created_at),updated_at:String(i.updated_at)}));r(i=>{const c=new Set(i.activityLog.map(d=>d.id)),o=[];a.forEach(d=>{const x=`bi-test-${d.id}`;c.has(x)||o.push({id:x,type:"bi-test",title:d.passed?"BI Test Passed":"BI Test Failed",time:new Date(String(d.test_date)),toolCount:1,color:d.passed?"bg-green-500":"bg-red-500",metadata:{testNumber:String(d.test_number),operatorId:d.operator}})});const l=[...o,...i.activityLog].sort((d,x)=>new Date(x.time).getTime()-new Date(d.time).getTime()).slice(0,20);return Mt(Ft({},i),{biTestResults:a,activityLog:l})})}catch(s){console.error("Error loading BI test results:",s)}}),syncBIFailureFromDatabase:t=>r({biFailureActive:t.status==="active",biFailureDetails:t.status==="active"?{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,facility_id:"",incident_number:"",failure_date:t.failure_date,affected_tools_count:t.affected_tools_count,affected_batch_ids:t.affected_batch_ids,detected_by_operator_id:t.detected_by_operator||"System Alert",severity_level:"medium",status:t.status||"active",regulatory_notification_required:!1,regulatory_notification_sent:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}:null}),resetBIState:()=>r(()=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null}))});var ua=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const sd=r=>({enforceCi:!1,enforceBi:!1,allowOverrides:!0,loading:!1,fetchComplianceSettings:t=>ua(null,null,function*(){var s,n,a;r({loading:!0});const{data:i,error:c}=yield K.from("facility_compliance_settings").select("enforce_ci, enforce_bi, allow_overrides").eq("facility_id",t).maybeSingle();c?console.error("Failed to fetch compliance settings:",c.message):r(i?{enforceCi:(s=i.enforce_ci)!=null?s:!1,enforceBi:(n=i.enforce_bi)!=null?n:!1,allowOverrides:(a=i.allow_overrides)!=null?a:!0}:{enforceCi:!1,enforceBi:!1,allowOverrides:!0}),r({loading:!1})}),updateComplianceSettings:(t,s)=>ua(null,null,function*(){var n,a,i;const{error:c}=yield K.from("facility_compliance_settings").upsert({facility_id:t,enforce_ci:s.enforceCi,enforce_bi:s.enforceBi,allow_overrides:s.allowOverrides,updated_at:new Date().toISOString()},{onConflict:"facility_id"});c?console.error("Failed to update compliance settings:",c.message):r({enforceCi:(n=s.enforceCi)!=null?n:!1,enforceBi:(a=s.enforceBi)!=null?a:!1,allowOverrides:(i=s.allowOverrides)!=null?i:!0})})}),rd=(r,t)=>{if(r.duration<=0)throw new Error(`${t} has invalid duration`);if(r.temperature!==void 0&&(r.temperature<30||r.temperature>150))throw new Error(`${t} has unsafe temperature`);if(r.pressure!==void 0&&(r.pressure<5||r.pressure>30))throw new Error(`${t} has unsafe pressure`)},oe={bath1:{name:"Bath 1",duration:1,temperature:60,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},bath2:{name:"Bath 2",duration:1,temperature:65,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},drying:{name:"Drying",duration:1,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},autoclave:{name:"Autoclave",duration:1,temperature:121,pressure:15,requiresCI:!0,requiresBI:!0,requiresCiStrip:!0,requiresBiTest:!0}};Object.entries(oe).forEach(([r,t])=>{rd(t,r)});const Ni={bath1:{label:oe.bath1.name,duration:oe.bath1.duration*60},bath2:{label:oe.bath2.name,duration:oe.bath2.duration*60},drying:{label:oe.drying.name,duration:oe.drying.duration*60},autoclave:{label:oe.autoclave.name,duration:oe.autoclave.duration*60}},ad=()=>{const t=new Date().toISOString().split("T")[0].replace(/-/g,""),s=`cycle_count_${t}`,a=parseInt(localStorage.getItem(s)||"0")+1;return localStorage.setItem(s,a.toString()),`CYCLE-${t}-${String(a).padStart(3,"0")}`},_r=r=>{const t=`cycle_${Date.now()}`,s=ad();return{id:t,cycleNumber:s,phases:[],tools:[],operator:r,startTime:new Date,completedAt:null}},nd=(r,t,s,n=[])=>({id:r,name:t,duration:s,tools:n,isActive:!1,startTime:null,endTime:null,status:"pending"}),ld=r=>({bath1:{name:oe.bath1.name,duration:oe.bath1.duration*60},bath2:{name:oe.bath2.name,duration:oe.bath2.duration*60},drying:{name:oe.drying.name,duration:oe.drying.duration*60},autoclave:{name:oe.autoclave.name,duration:oe.autoclave.duration*60}})[r],id=r=>{const t=["bath1","bath2","drying","autoclave"],s=t.indexOf(r);return t[s+1]||null},Tr=r=>r.phases.some(t=>t.id==="autoclave");var od=Object.defineProperty,cd=Object.defineProperties,dd=Object.getOwnPropertyDescriptors,ma=Object.getOwnPropertySymbols,ud=Object.prototype.hasOwnProperty,md=Object.prototype.propertyIsEnumerable,xa=(r,t,s)=>t in r?od(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ye=(r,t)=>{for(var s in t||(t={}))ud.call(t,s)&&xa(r,s,t[s]);if(ma)for(var s of ma(t))md.call(t,s)&&xa(r,s,t[s]);return r},Je=(r,t)=>cd(r,dd(t)),xd=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const pd=(r,t,s)=>({setCurrentCycle:n=>r(a=>Je(Ye({},a),{currentCycle:n})),setError:n=>r(a=>Je(Ye({},a),{error:n})),startNewCycle:n=>{const a=_r(n);r(i=>Je(Ye({},i),{currentCycle:a}))},addToolToCycle:n=>{r(a=>{const i=a.currentCycle;if(!i){const c=_r("Current Operator");return c.tools=[n],t(),Je(Ye({},a),{currentCycle:c})}if(!i.tools.includes(n)){const c=Je(Ye({},i),{tools:[...i.tools,n]});return t(),Je(Ye({},a),{currentCycle:c})}return a})},loadCycles:n=>xd(null,null,function*(){try{const i=(yield $o.getSterilizationCycles(n)).map(c=>({id:c.id,cycleNumber:c.cycle_number,phases:Array.isArray(c.phases)?c.phases.map(o=>({id:o.id,name:o.name,duration:o.duration,tools:Array.isArray(o.tools)?o.tools.map(l=>String(l)):[],isActive:o.isActive,startTime:o.startTime?new Date(o.startTime):null,endTime:o.endTime?new Date(o.endTime):null,status:o.status})):[],tools:Array.isArray(c.tools)?c.tools.map(o=>o.id):[],operator:c.operator_id||"Unknown",startTime:c.start_time?new Date(c.start_time):new Date,completedAt:c.end_time||null,batchId:c.cycle_number}));r(c=>Je(Ye({},c),{cycles:i}))}catch(a){console.error("Failed to load sterilization cycles:",a),r(i=>Je(Ye({},i),{error:a instanceof Error?a.message:"Failed to load cycles"}))}})});var hd=Object.defineProperty,gd=Object.defineProperties,fd=Object.getOwnPropertyDescriptors,pa=Object.getOwnPropertySymbols,bd=Object.prototype.hasOwnProperty,yd=Object.prototype.propertyIsEnumerable,ha=(r,t,s)=>t in r?hd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,he=(r,t)=>{for(var s in t||(t={}))bd.call(t,s)&&ha(r,s,t[s]);if(pa)for(var s of pa(t))yd.call(t,s)&&ha(r,s,t[s]);return r},ge=(r,t)=>gd(r,fd(t));const vd=(r,t,s)=>({addPhaseToCycle:(n,a,i)=>{r(c=>{if(!c.currentCycle){const p=t().availableTools.filter(g=>g.currentPhase==="bath1").map(g=>g.id),f=_r("Current Operator");return f.tools=p,ge(he({},c),{currentCycle:f})}if(c.currentCycle.phases.find(m=>m.id===n))return c;const l=nd(n,a,i,[...c.currentCycle.tools]),d=[...c.currentCycle.phases,l],x=ge(he({},c.currentCycle),{phases:d});return ge(he({},c),{currentCycle:x})})},startPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!0,startTime:new Date,status:"active"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})},completePhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!1,endTime:new Date,status:"completed"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})},pausePhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!1,status:"paused"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})},resetPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!1,startTime:null,endTime:null,status:"pending"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})}});var jd=Object.defineProperty,wd=Object.defineProperties,Nd=Object.getOwnPropertyDescriptors,ga=Object.getOwnPropertySymbols,Cd=Object.prototype.hasOwnProperty,Sd=Object.prototype.propertyIsEnumerable,fa=(r,t,s)=>t in r?jd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,cs=(r,t)=>{for(var s in t||(t={}))Cd.call(t,s)&&fa(r,s,t[s]);if(ga)for(var s of ga(t))Sd.call(t,s)&&fa(r,s,t[s]);return r},ds=(r,t)=>wd(r,Nd(t));const _d=(r,t,s)=>({moveToolToNextPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.find(m=>m.tools.includes(n)&&m.isActive);if(!i)return a;const c=id(i.id);if(!c){const m=t();return m.incrementToolCycleCount&&m.incrementToolCycleCount(n),a}const o=t(),l=o.availableTools.find(m=>m.id===n);if(l!=null&&l.isP2Status&&c==="autoclave")return o.incrementToolCycleCount&&o.incrementToolCycleCount(n),a;let d=a.currentCycle.phases.find(m=>m.id===c);if(!d){const m=ld(c);m&&(d={id:c,name:m.name,duration:m.duration,tools:[],isActive:!1,startTime:null,endTime:null,status:"pending"})}if(!d)return a;const x=a.currentCycle.phases.map(m=>m.id===i.id?ds(cs({},m),{tools:m.tools.filter(p=>p!==n)}):m.id===c?ds(cs({},m),{tools:[...m.tools,n]}):m);return a.currentCycle.phases.find(m=>m.id===c)||x.push(d),ds(cs({},a),{currentCycle:ds(cs({},a.currentCycle),{phases:x})})})}}),Td=r=>{let t=100,s=null;if(r.length>0){const n=new Date;n.setDate(n.getDate()-30);const a=r.filter(o=>o.date>=n),i=a.filter(o=>o.passed===!1),c=a.filter(o=>!o.passed&&o.date<n);if(a.length>0){const o=a.filter(l=>l.passed===!0).length;t=Math.round(o/a.length*100),i.length>0&&(s={direction:"down",value:`${i.length} failure(s) this month`})}else c.length>0&&(s={direction:"warning",value:`${c.length} test(s) missed this month`})}return{rate:t,trend:s}},kd=r=>{const t=new Date;t.setDate(t.getDate()-7);const s=new Date;s.setDate(s.getDate()-14);const n=r.filter(o=>new Date(o.startTime)>=t&&Tr(o)),a=r.filter(o=>{const l=new Date(o.startTime);return l>=s&&l<t&&Tr(o)}),i=n.length,c=a.length;if(c>0){const o=Math.round((i-c)/c*100);return{direction:o>=0?"up":"down",value:`${o>=0?"+":""}${o}% from last week`}}else if(i>0)return{direction:"up",value:"New this week"};return null},Id=(r,t)=>{const s=new Date;s.setDate(s.getDate()-30);const n=t.filter(c=>{const o=c.currentPhase==="complete"||c.currentPhase==="available",l=c.startTime&&c.endTime,d=l&&new Date(c.endTime)>=s,x=l&&new Date(c.endTime).getTime()-new Date(c.startTime).getTime()>1800*1e3;return o&&l&&d&&x});if(n.length===0)return 0;const a=n.reduce((c,o)=>{const l=new Date(o.startTime),x=new Date(o.endTime).getTime()-l.getTime();return c+x},0);return Math.round(a/n.length/(1e3*60))},Pd=(r,t,s,n,a)=>{const i={cycleCompletionRate:.2,timeEfficiency:.15,resourceUtilization:.15,qualityMetrics:.15,throughputEfficiency:.1,inventoryEfficiency:.15},c=new Date;c.setDate(c.getDate()-7);const o=new Date;o.setDate(o.getDate()-14);const l=r.filter(S=>new Date(S.startTime)>=c&&Tr(S)),d=l.length,x=l.filter(S=>S.completedAt!==null).length,m=d>0?x/d*100:0,p=60,f=Math.max(0,Math.min(100,(p-Math.abs(s-p))/p*100)),g=l.reduce((S,I)=>S+I.tools.length,0),v=d>0?g/d:0,h=Math.max(0,Math.min(100,v/7*100)),y=t,_=d/7,$=Math.max(0,Math.min(100,_/2.5*100));let D=0;const w=m*i.cycleCompletionRate+f*i.timeEfficiency+h*i.resourceUtilization+y*i.qualityMetrics+$*i.throughputEfficiency+D*i.inventoryEfficiency,T=r.filter(S=>{const I=new Date(S.startTime);return I>=o&&I<c});let k=null;if(T.length>0){const I=T.filter(A=>A.completedAt!==null).length/T.length*100*i.cycleCompletionRate+80,E=w-I,O=Math.round(E/I*100);k={direction:E>=0?"up":"down",value:`${E>=0?"+":""}${O}% from last week`}}return{score:Math.round(w),trend:k,breakdown:{sterilization:{completionRate:m,timeEfficiency:f,resourceUtilization:h,qualityScore:y,throughputEfficiency:$},inventory:{efficiency:D,lowStockItems:0,totalItems:0,expiringItems:0,accuracy:100}}}},Dd=(r,t,s,n)=>{const{rate:a,trend:i}=Td(s),c=kd(r),o=Id(r,t),l=Pd(r,a,o),d=new Date;d.setDate(d.getDate()-30);const x=r.filter(g=>{const v=new Date(g.startTime);return!isNaN(v.getTime())&&v>=d}),m=x.length,p=x.filter(g=>g.completedAt!==null).length,f=c&&c.direction!=="warning"?{direction:c.direction,value:c.value}:null;return{totalCycles:m,completedCycles:p,averageCycleTime:o,biPassRate:a,biPassRateTrend:i,cycleTrend:f,efficiencyScore:l}};var Ed=Object.defineProperty,Od=Object.defineProperties,$d=Object.getOwnPropertyDescriptors,ba=Object.getOwnPropertySymbols,Ad=Object.prototype.hasOwnProperty,Rd=Object.prototype.propertyIsEnumerable,ya=(r,t,s)=>t in r?Ed(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Vs=(r,t)=>{for(var s in t||(t={}))Ad.call(t,s)&&ya(r,s,t[s]);if(ba)for(var s of ba(t))Rd.call(t,s)&&ya(r,s,t[s]);return r},Bd=(r,t)=>Od(r,$d(t));const Fd=(r,t,s)=>{const n=pd(r,t),a=vd(r,t),i=_d(r,t);return Bd(Vs(Vs(Vs({currentCycle:null,cycles:[],error:null},n),a),i),{getCycleStats:()=>{const c=t();return Dd(c.cycles||[],c.availableTools||[],c.biTestResults||[])}})},Md=r=>({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:"",setModalOpen:t=>r({isModalOpen:t}),setShowAnalyticsModal:t=>r({showAnalyticsModal:t}),setShowCleaningLogModal:t=>r({showCleaningLogModal:t}),setShowBITestModal:t=>r({showBITestModal:t}),setShowBatchCodeModal:t=>r({showBatchCodeModal:t}),setWorkflowType:t=>r({workflowType:t}),setScannedData:t=>r({scannedData:t}),resetUIState:()=>r({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:""})});var Ld=Object.defineProperty,zd=Object.defineProperties,Ud=Object.getOwnPropertyDescriptors,va=Object.getOwnPropertySymbols,qd=Object.prototype.hasOwnProperty,Hd=Object.prototype.propertyIsEnumerable,ja=(r,t,s)=>t in r?Ld(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Vd=(r,t)=>{for(var s in t||(t={}))qd.call(t,s)&&ja(r,s,t[s]);if(va)for(var s of va(t))Hd.call(t,s)&&ja(r,s,t[s]);return r},Wd=(r,t)=>zd(r,Ud(t));const Ci=(r,t)=>({availableTools:[],toolsInCycle:[],setAvailableTools:s=>{r({availableTools:s})},addToolToCycle:s=>{const n=t().availableTools.find(a=>a.id===s);n&&r(a=>({toolsInCycle:[...a.toolsInCycle,n]}))},clearCycle:()=>{r({toolsInCycle:[]})},incrementToolCycleCount:s=>{r(n=>({availableTools:n.availableTools.map(a=>a.id===s?Wd(Vd({},a),{cycleCount:a.cycleCount+1}):a)}))},checkToolReplacementNeeded:s=>{const n=t().availableTools.find(a=>a.id===s);return n?n.cycleCount>=(n.maxCycles||200):!1},getToolCycleCount:s=>{const n=t().availableTools.find(a=>a.id===s);return n?n.cycleCount:0}}),Si=(r,t,s)=>({}),_i=(r,t)=>({currentBatchId:null,batchedToolIds:[],currentCycle:null,setCurrentBatchId:s=>r({currentBatchId:s}),addToolToBatch:s=>r({batchedToolIds:[...t().batchedToolIds,s]}),resetBatch:()=>r({currentBatchId:null,batchedToolIds:[]})});var Gd=Object.defineProperty,wa=Object.getOwnPropertySymbols,Kd=Object.prototype.hasOwnProperty,Qd=Object.prototype.propertyIsEnumerable,Na=(r,t,s)=>t in r?Gd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ws=(r,t)=>{for(var s in t||(t={}))Kd.call(t,s)&&Na(r,s,t[s]);if(wa)for(var s of wa(t))Qd.call(t,s)&&Na(r,s,t[s]);return r};const Yd=(r,t,s)=>Ws(Ws(Ws({},Ci(r,t)),Si()),_i(r,t));var Jd=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Xd=r=>({lastGeneratedCode:null,generatedCodes:[],generateBatchCode:(t,s)=>Jd(null,null,function*(){const n=s===1,a=new Date,i=a.toISOString().slice(0,10).replace(/-/g,""),c=a.toISOString().slice(11,17).replace(/:/g,""),o=Math.random().toString(36).substring(2,5).toUpperCase(),l=`${i}-${c}-${o}`,d={code:l,generatedAt:a,operator:t,toolCount:s,isSingleTool:n};return r(x=>({lastGeneratedCode:d,generatedCodes:[...x.generatedCodes,d]})),l}),validateBatchCode:t=>/^\d{8}-\d{4}-[A-Z0-9]{3}$/.test(t),getBatchByCode:(t,s)=>s.find(n=>n.batchCode===t)||null});var Zd=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class eu{static generateBatchCode(t,s){return Zd(this,null,function*(){try{const n=new Date().toISOString().slice(0,10).replace(/-/g,""),a=t.slice(0,3).toUpperCase(),i=s.toString().padStart(2,"0");return{batchCode:`${a}${n}${i}`,success:!0}}catch(n){return{batchCode:"",success:!1,error:n instanceof Error?n.message:"Unknown error"}}})}}var tu=Object.defineProperty,su=Object.defineProperties,ru=Object.getOwnPropertyDescriptors,Ca=Object.getOwnPropertySymbols,au=Object.prototype.hasOwnProperty,nu=Object.prototype.propertyIsEnumerable,Sa=(r,t,s)=>t in r?tu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Lt=(r,t)=>{for(var s in t||(t={}))au.call(t,s)&&Sa(r,s,t[s]);if(Ca)for(var s of Ca(t))nu.call(t,s)&&Sa(r,s,t[s]);return r},zt=(r,t)=>su(r,ru(t)),_a=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const lu=(r,t)=>({currentBatch:null,batches:[],batchHistory:[],batchLoading:!1,createBatch:(s,n)=>_a(null,null,function*(){r({batchLoading:!0});try{const a=`batch_${Date.now()}`,i={id:a,batchCode:"",createdAt:new Date,createdBy:s,status:"creating",tools:[],packageInfo:{packageType:"",packageSize:""},sterilizationInfo:{},facility_id:"default-facility",auditTrail:[{id:`audit_${Date.now()}`,timestamp:new Date,action:"created",operator:s,details:`Batch created in ${n?"batch":"single tool"} mode`}]};return r(c=>({currentBatch:i,batches:[...c.batches,i],batchLoading:!1})),a}catch(a){throw r({batchLoading:!1}),a}}),addToolToBatch:s=>{const{currentBatch:n}=t();if(n&&!n.tools.includes(s)){const a=zt(Lt({},n),{tools:[...n.tools,s],auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_added",operator:n.createdBy,details:`Tool ${s} added to batch`,metadata:{toolId:s}}]});r(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))}},removeToolFromBatch:s=>{const{currentBatch:n}=t();if(!n)return;const a=zt(Lt({},n),{tools:n.tools.filter(i=>i!==s),auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_removed",operator:n.createdBy,details:`Tool ${s} removed from batch`,metadata:{toolId:s}}]});r(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))},finalizeBatch:s=>_a(null,null,function*(){const{currentBatch:n}=t();if(!n)throw new Error("No current batch to finalize");r({batchLoading:!0});try{const a=yield eu.generateBatchCode(n.createdBy,n.tools.length);if(!a.success)throw new Error(a.error||"Failed to generate batch code");const i=a.batchCode,c=zt(Lt({},n),{batchCode:i,status:"ready",packageInfo:s,auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"ready_for_autoclave",operator:n.createdBy,details:`Batch finalized with code ${i}`,metadata:{batchCode:i,packageInfo:s}}]});r(o=>({currentBatch:c,batches:o.batches.map(l=>l.id===n.id?c:l),batchHistory:[...o.batchHistory,c],batchLoading:!1}))}catch(a){throw r({batchLoading:!1}),a}}),updateBatchStatus:(s,n)=>{r(a=>{var i;return{batches:a.batches.map(c=>c.id===s?zt(Lt({},c),{status:n,auditTrail:[...c.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:n==="in_autoclave"?"autoclave_started":n==="completed"?"autoclave_completed":"tool_added",operator:c.createdBy,details:`Batch status updated to ${n}`,metadata:{status:n}}]}):c),currentBatch:((i=a.currentBatch)==null?void 0:i.id)===s?zt(Lt({},a.currentBatch),{status:n}):a.currentBatch}})},getBatchById:s=>{const{batches:n,batchHistory:a}=t();return[...n,...a].find(i=>i.id===s)||null},getBatchesByStatus:s=>{const{batches:n,batchHistory:a}=t();return[...n,...a].filter(i=>i.status===s)},clearCurrentBatch:()=>r({currentBatch:null}),setBatchLoading:s=>r({batchLoading:s})});var iu=Object.defineProperty,Ta=Object.getOwnPropertySymbols,ou=Object.prototype.hasOwnProperty,cu=Object.prototype.propertyIsEnumerable,ka=(r,t,s)=>t in r?iu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Gs=(r,t)=>{for(var s in t||(t={}))ou.call(t,s)&&ka(r,s,t[s]);if(Ta)for(var s of Ta(t))cu.call(t,s)&&ka(r,s,t[s]);return r};const du=(r,t)=>({currentSession:null,startPackagingSession:(s,n)=>{const a={id:crypto.randomUUID(),operatorName:s,facilityId:n,scannedTools:[],startedAt:new Date().toISOString()};r({currentSession:a})},addToolToSession:s=>{const n=t().currentSession;n&&(n.scannedTools.includes(s)||(n.scannedTools.push(s),r({currentSession:Gs({},n)})))},removeToolFromSession:s=>{const n=t().currentSession;n&&(n.scannedTools=n.scannedTools.filter(a=>a!==s),r({currentSession:Gs({},n)}))},generateBatchId:()=>`PKG-${Math.floor(1e3+Math.random()*9e3)}`,assignBatchIdToSession:s=>{const n=t().currentSession;n&&(n.currentBatchId=s,r({currentSession:Gs({},n)}))},endPackagingSession:()=>{r({currentSession:null})},resetPackagingSession:()=>{r({currentSession:null})}});var uu=Object.defineProperty,mu=Object.defineProperties,xu=Object.getOwnPropertyDescriptors,Ia=Object.getOwnPropertySymbols,pu=Object.prototype.hasOwnProperty,hu=Object.prototype.propertyIsEnumerable,Pa=(r,t,s)=>t in r?uu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ut=(r,t)=>{for(var s in t||(t={}))pu.call(t,s)&&Pa(r,s,t[s]);if(Ia)for(var s of Ia(t))hu.call(t,s)&&Pa(r,s,t[s]);return r},Ks=(r,t)=>mu(r,xu(t));const Da={gravity:{name:"Gravity",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35},prevacuum:{name:"Pre-vacuum",temperature:132,pressure:30,sterilizeTime:4,dryTime:15,totalTime:19},flash:{name:"Flash",temperature:132,pressure:30,sterilizeTime:3,dryTime:0,totalTime:3},custom:{name:"Custom",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35}},gu={autoclaveHasPrinter:!1,receiptRetentionMonths:12},fu=r=>({cycleSettings:Da,defaultCycleType:"gravity",allowCustomCycles:!1,autoclaveReceiptSettings:gu,updateCycleSettings:(t,s)=>{r(n=>({cycleSettings:Ks(Ut({},n.cycleSettings),{[t]:Ut(Ut({},n.cycleSettings[t]),s)})}))},setDefaultCycleType:t=>{r({defaultCycleType:t})},setAllowCustomCycles:t=>{r({allowCustomCycles:t})},setAutoclaveHasPrinter:t=>{r(s=>({autoclaveReceiptSettings:Ks(Ut({},s.autoclaveReceiptSettings),{autoclaveHasPrinter:t})}))},setReceiptRetentionMonths:t=>{r(s=>({autoclaveReceiptSettings:Ks(Ut({},s.autoclaveReceiptSettings),{receiptRetentionMonths:t})}))},resetCycleSettings:()=>{r({cycleSettings:Da,defaultCycleType:"gravity",allowCustomCycles:!1})}});var fe=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const bu=r=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,setBiTestCompleted:t=>r({biTestCompleted:t}),setBiTestDate:t=>r({biTestDate:t}),recordBITestResult:()=>fe(null,null,function*(){}),debugCheck:()=>{console.log("🔬 biTestSlice is being used!")},setNextBITestDue:t=>r({nextBITestDue:t}),setLastBITestDate:t=>r({lastBITestDate:t}),setBiTestPassed:t=>r({biTestPassed:t}),setBiTestOptedOut:t=>r({biTestOptedOut:t}),setBiTestInProgress:t=>r({biTestInProgress:t}),resetBIState:()=>r({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1}),activateBIFailure:()=>fe(null,null,function*(){}),deactivateBIFailure:()=>fe(null,null,function*(){}),updateBIFailureStatus:()=>fe(null,null,function*(){}),resolveBIFailure:()=>fe(null,null,function*(){}),getBIFailureHistory:()=>fe(null,null,function*(){}),addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>fe(null,null,function*(){}),setEnforceBI:()=>fe(null,null,function*(){}),setEnforceCI:()=>fe(null,null,function*(){}),setAllowOverrides:()=>fe(null,null,function*(){}),toggleEnforceBI:()=>fe(null,null,function*(){}),toggleEnforceCI:()=>fe(null,null,function*(){}),loadComplianceSettings:()=>fe(null,null,function*(){}),syncWithSupabase:()=>fe(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>fe(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})});var yu=Object.defineProperty,vu=Object.defineProperties,ju=Object.getOwnPropertyDescriptors,Ea=Object.getOwnPropertySymbols,wu=Object.prototype.hasOwnProperty,Nu=Object.prototype.propertyIsEnumerable,Oa=(r,t,s)=>t in r?yu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,$a=(r,t)=>{for(var s in t||(t={}))wu.call(t,s)&&Oa(r,s,t[s]);if(Ea)for(var s of Ea(t))Nu.call(t,s)&&Oa(r,s,t[s]);return r},Aa=(r,t)=>vu(r,ju(t)),be=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Cu=(r,t)=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,activateBIFailure:s=>be(null,null,function*(){r({biFailureLoading:!0,biFailureError:null});try{const n={id:`bi-failure-${Date.now()}`,incident_number:`BI-${Date.now()}`,failure_date:new Date().toISOString(),affected_tools_count:s.affectedToolsCount,affected_batch_ids:s.affectedBatchIds,failure_reason:s.failureReason,severity_level:s.severity||"medium",status:"active",detected_by_operator_id:s.operator,regulatory_notification_sent:!1,regulatory_notification_date:void 0,facility_id:"default-facility",regulatory_notification_required:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};r({biFailureActive:!0,biFailureDetails:n,biFailureHistory:[...t().biFailureHistory,n],biFailureLoading:!1})}catch(n){r({biFailureError:n instanceof Error?n.message:"Failed to activate BI failure",biFailureLoading:!1})}}),deactivateBIFailure:()=>be(null,null,function*(){r({biFailureLoading:!0});try{r({biFailureActive:!1,biFailureDetails:null,biFailureLoading:!1})}catch(s){r({biFailureError:s instanceof Error?s.message:"Failed to deactivate BI failure",biFailureLoading:!1})}}),updateBIFailureStatus:s=>be(null,null,function*(){r({biFailureLoading:!0});try{const n=t().biFailureDetails;if(n){const a=Aa($a({},n),{status:s,updated_at:new Date().toISOString()});r({biFailureDetails:a,biFailureActive:s==="active",biFailureLoading:!1})}}catch(n){r({biFailureError:n instanceof Error?n.message:"Failed to update BI failure status",biFailureLoading:!1})}}),resolveBIFailure:()=>be(null,null,function*(){r({biFailureLoading:!0});try{const s=t().biFailureDetails;if(s){const n=Aa($a({},s),{status:"resolved",updated_at:new Date().toISOString()});r({biFailureDetails:n,biFailureActive:!1,biFailureLoading:!1})}}catch(s){r({biFailureError:s instanceof Error?s.message:"Failed to resolve BI failure",biFailureLoading:!1})}}),getBIFailureHistory:()=>be(null,null,function*(){r({biFailureLoading:!0});try{r({biFailureLoading:!1})}catch(s){r({biFailureError:s instanceof Error?s.message:"Failed to get BI failure history",biFailureLoading:!1})}}),setBiTestCompleted:()=>{},setBiTestDate:()=>{},recordBITestResult:()=>be(null,null,function*(){}),setNextBITestDue:()=>{},setLastBITestDate:()=>{},setBiTestPassed:()=>{},setBiTestOptedOut:()=>{},setBiTestInProgress:()=>{},resetBIState:()=>{},addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>be(null,null,function*(){}),setEnforceBI:()=>be(null,null,function*(){}),setEnforceCI:()=>be(null,null,function*(){}),setAllowOverrides:()=>be(null,null,function*(){}),toggleEnforceBI:()=>be(null,null,function*(){}),toggleEnforceCI:()=>be(null,null,function*(){}),loadComplianceSettings:()=>be(null,null,function*(){}),syncWithSupabase:()=>be(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>be(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})}),Su=r=>{const{biTestPassed:t,nextBITestDue:s,biTestOptedOut:n,enforceBI:a}=r;if(!a||n)return{isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"};const i=new Date,c=s?Math.ceil((s.getTime()-i.getTime())/(1e3*60*60*24)):0;let o;return t?c<0?o="overdue":c<=3?o="due-soon":o="compliant":o="failed",{isCompliant:o==="compliant",nextTestDue:s,daysUntilDue:c,status:o}},_u=r=>{const{biFailureDetails:t}=r;return t&&t.severity_level||"low"},Tu=r=>{const{activityLog:t}=r,s=new Date,n=new Date(s.getTime()-1440*60*1e3),a=t.filter(o=>o.time>n).length,i=t.filter(o=>o.type==="bi-test").length,c=t.filter(o=>o.type==="bi-failure").length;return{totalActivities:t.length,recentActivities:a,biTestCount:i,failureCount:c}};var ku=Object.defineProperty,Iu=Object.defineProperties,Pu=Object.getOwnPropertyDescriptors,_s=Object.getOwnPropertySymbols,Ti=Object.prototype.hasOwnProperty,ki=Object.prototype.propertyIsEnumerable,Ra=(r,t,s)=>t in r?ku(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,rt=(r,t)=>{for(var s in t||(t={}))Ti.call(t,s)&&Ra(r,s,t[s]);if(_s)for(var s of _s(t))ki.call(t,s)&&Ra(r,s,t[s]);return r},ft=(r,t)=>Iu(r,Pu(t)),Du=(r,t)=>{var s={};for(var n in r)Ti.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&_s)for(var n of _s(r))t.indexOf(n)<0&&ki.call(r,n)&&(s[n]=r[n]);return s},Ae=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Eu=(r,t,s)=>ft(rt(rt({},(()=>{const a=bu(r),{recordBITestResult:i}=a;return Du(a,["recordBITestResult"])})()),Cu(r,t)),{addActivity:n=>{const a=ft(rt({},n),{id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});r(i=>({activityLog:[a,...i.activityLog].slice(0,50)}))},clearActivityLog:()=>r({activityLog:[]}),loadActivityLog:()=>Ae(null,null,function*(){r({activityLogLoading:!0});try{const n=yield _t.getCurrentFacilityId();if(!n)throw new Error("No facility ID available");const{data:a,error:i}=yield K.from("bi_activity_log").select("*").eq("facility_id",n).order("created_at",{ascending:!1}).limit(100);if(i)throw i;const c=(a||[]).map(o=>({id:o.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:o.type||"general",title:o.title||"Activity",time:new Date(o.created_at||new Date().toISOString()),color:o.color||"blue",description:(o.data&&typeof o.data=="object"&&"description"in o.data?o.data.description:"")||"",metadata:o.metadata||{}}));r({activityLog:c,activityLogLoading:!1})}catch(n){console.error("Failed to load activity log:",n),r({activityLogLoading:!1,syncError:"Failed to load activity log"})}}),setEnforceBI:n=>Ae(null,null,function*(){r({enforceBI:n}),t().addPendingChange({type:"settings",data:{enforceBI:n}}),yield t().syncWithSupabase()}),setEnforceCI:n=>Ae(null,null,function*(){r({enforceCI:n}),t().addPendingChange({type:"settings",data:{enforceCI:n}}),yield t().syncWithSupabase()}),setAllowOverrides:n=>Ae(null,null,function*(){r({allowOverrides:n}),t().addPendingChange({type:"settings",data:{allowOverrides:n}}),yield t().syncWithSupabase()}),toggleEnforceBI:()=>Ae(null,null,function*(){const{enforceBI:n}=t();yield t().setEnforceBI(!n)}),toggleEnforceCI:()=>Ae(null,null,function*(){const{enforceCI:n}=t();yield t().setEnforceCI(!n)}),loadComplianceSettings:()=>Ae(null,null,function*(){var n,a,i,c;r({complianceSettingsLoading:!0});try{const o=yield _t.getCurrentFacilityId();if(!o)throw new Error("No facility ID available");const{data:l,error:d}=yield K.from("facilities").select("settings").eq("id",o).single();if(d&&d.code!=="PGRST116")throw d;const x=(n=l==null?void 0:l.settings)!=null?n:{},m=(a=x.enforce_bi)!=null?a:!1,p=(i=x.enforce_ci)!=null?i:!1,f=(c=x.allow_overrides)!=null?c:!1;r({enforceBI:!!m,enforceCI:!!p,allowOverrides:!!f,complianceSettingsLoading:!1})}catch(o){console.error("Failed to load compliance settings:",o),r({complianceSettingsLoading:!1,syncError:"Failed to load compliance settings"})}}),syncWithSupabase:()=>Ae(null,null,function*(){r({isSyncing:!0,syncError:null});try{const n=yield _t.getCurrentFacilityId();if(!n)throw new Error("No facility ID available");const{pendingChanges:a}=t();for(const i of a)try{switch(i.type){case"bi-test":i.data&&typeof i.data=="object"&&(yield Ao.createBITestResult(ft(rt({},i.data),{facility_id:n,result:"pass"})));break;case"bi-failure":i.data&&typeof i.data=="object"&&(yield fs.createIncident(ft(rt({},i.data),{facility_id:n,affected_tools_count:0,affected_batch_ids:[]})));break;case"settings":if(i.data&&typeof i.data=="object"){const c=i.data,{data:o,error:l}=yield K.from("facilities").select("settings").eq("id",n).single();if(l)throw l;const d=(o==null?void 0:o.settings)||{},x=ft(rt({},d),{enforce_bi:c.enforceBI,enforce_ci:c.enforceCI,allow_overrides:c.allowOverrides}),{error:m}=yield K.from("facilities").update({settings:x,updated_at:new Date().toISOString()}).eq("id",n);if(m)throw m}break}}catch(c){console.error(`Failed to sync ${i.type}:`,c)}r({isSyncing:!1,lastSyncTime:new Date,pendingChanges:[]})}catch(n){console.error("Sync failed:",n),r({isSyncing:!1,syncError:"Sync failed"})}}),syncBIFailureFromDatabase:n=>{const a=n;r({biFailureActive:a.status==="active",biFailureDetails:a.status==="active"?{id:a.id,incident_number:a.incident_number,failure_date:a.failure_date,affected_tools_count:a.affected_tools_count,affected_batch_ids:a.affected_batch_ids,failure_reason:a.failure_reason,severity_level:a.severity_level,status:a.status,detected_by_operator_id:a.detected_by_operator_id,regulatory_notification_sent:a.regulatory_notification_sent||!1,regulatory_notification_date:a.regulatory_notification_date,facility_id:a.facility_id||"",regulatory_notification_required:a.regulatory_notification_required||!1,created_at:a.created_at||new Date().toISOString(),updated_at:a.updated_at||new Date().toISOString()}:null})},addPendingChange:n=>{r(a=>({pendingChanges:[...a.pendingChanges,ft(rt({},n),{id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date})]}))},clearPendingChanges:()=>r({pendingChanges:[]}),retryFailedSync:()=>Ae(null,null,function*(){yield t().syncWithSupabase()}),addOptimisticUpdate:(n,a)=>{const{optimisticUpdates:i}=t();i.set(n,a),r({optimisticUpdates:new Map(i)})},removeOptimisticUpdate:n=>{const{optimisticUpdates:a}=t();a.delete(n),r({optimisticUpdates:new Map(a)})},clearOptimisticUpdates:()=>r({optimisticUpdates:new Map}),saveStateToLocalStorage:()=>{const n=t(),a={biTestCompleted:n.biTestCompleted,biTestDate:n.biTestDate,biTestResults:n.biTestResults,nextBITestDue:n.nextBITestDue,lastBITestDate:n.lastBITestDate,biTestPassed:n.biTestPassed,biTestOptedOut:n.biTestOptedOut,enforceBI:n.enforceBI,enforceCI:n.enforceCI,allowOverrides:n.allowOverrides,lastSyncTime:n.lastSyncTime};try{localStorage.setItem("biWorkflowState",JSON.stringify(a))}catch(i){console.error(i)}},loadStateFromLocalStorage:()=>{try{const n=localStorage.getItem("biWorkflowState");if(n){const a=JSON.parse(n);r({biTestCompleted:a.biTestCompleted||!1,biTestDate:a.biTestDate||null,biTestResults:a.biTestResults||[],nextBITestDue:a.nextBITestDue?new Date(a.nextBITestDue):null,lastBITestDate:a.lastBITestDate||null,biTestPassed:a.biTestPassed||!1,biTestOptedOut:a.biTestOptedOut||!1,enforceBI:a.enforceBI!==void 0?a.enforceBI:!0,enforceCI:a.enforceCI!==void 0?a.enforceCI:!0,allowOverrides:a.allowOverrides||!1,lastSyncTime:a.lastSyncTime?new Date(a.lastSyncTime):null})}}catch(n){console.error(n)}},clearLocalStorage:()=>{try{localStorage.removeItem("biWorkflowState")}catch(n){console.error(n)}},getBIComplianceStatus:()=>Su(t()),getBIFailureRiskLevel:()=>_u(t()),getActivitySummary:()=>Tu(t())});var Ou=Object.defineProperty,Ba=Object.getOwnPropertySymbols,$u=Object.prototype.hasOwnProperty,Au=Object.prototype.propertyIsEnumerable,Fa=(r,t,s)=>t in r?Ou(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,we=(r,t)=>{for(var s in t||(t={}))$u.call(t,s)&&Fa(r,s,t[s]);if(Ba)for(var s of Ba(t))Au.call(t,s)&&Fa(r,s,t[s]);return r};const W=Oe()((...r)=>we(we(we(we(we(we(we(we(we(we(we(we(we({},td(...r)),sd(...r)),Fd(...r)),Md(...r)),Yd(...r)),_i(...r)),Xd(...r)),lu(...r)),Ci(...r)),Si(...r)),du(...r)),fu(...r)),Eu(...r)));var kr=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Ma=(r,t)=>{const s=document.createElement("div");if(s.className=`
    fixed top-4 right-4 z-[10000] bg-white border-l-4 border-green-500 
    shadow-lg rounded-lg p-4 max-w-md transform transition-all duration-300 
    animate-slide-in-right
  `,s.style.cssText=`
    animation: slideInRight 0.3s ease-out;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  `,s.innerHTML=`
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div class="ml-3 flex-1">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-gray-800">${r}</h3>
          <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="ml-2 text-gray-400 hover:text-gray-600">
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
        <p class="mt-1 text-sm text-gray-600">${t}</p>
      </div>
    </div>
  `,!document.getElementById("cliniio-notification-styles")){const n=document.createElement("style");n.id="cliniio-notification-styles",n.textContent=`
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(n)}document.body.appendChild(s),setTimeout(()=>{s.parentElement&&(s.style.transform="translateX(100%)",s.style.opacity="0",setTimeout(()=>{s.parentElement&&s.remove()},300))},5e3)},La=()=>kr(null,null,function*(){try{const{SupabaseAuthService:r}=yield Ve(()=>import("./services-JA4N6ZXe.js").then(a=>a.aW),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{user:t,error:s}=yield r.getCurrentUser();if(s&&console.warn("Auth service error:",s),t!=null&&t.id)return t.id;const n=sessionStorage.getItem("currentOperatorId")||localStorage.getItem("currentOperatorId");if(n)return n;throw console.error("No operator ID found in production. User may not be authenticated."),new Error("User not authenticated - no operator ID available")}catch(r){throw console.error("Failed to get operator ID:",r),new Error("Authentication required - unable to get operator ID")}}),Ru=({onClose:r,onSuccess:t})=>{const{biFailureDetails:s,deactivateBIFailure:n}=W(),[a,i]=u.useState(!1),[c,o]=u.useState(null),[l,d]=u.useState(!1),[x,m]=u.useState(""),p=u.useCallback(()=>kr(null,null,function*(){i(!0),o(null);try{const w=yield La();if(!s)throw new Error("No BI failure incident to resolve");const T=sessionStorage.getItem("currentBIFailureIncidentId");if(T){const k=yield fs.resolveIncident({incidentId:T,resolvedByOperatorId:w,resolutionNotes:x});console.log("✅ BI Failure Resolution completed:",{incidentId:T,resolvedByOperatorId:w,resolutionNotes:x,timestamp:new Date().toISOString()}),Ma("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const S=W.getState();S.loadBITestResults&&(S.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("🔄 Refreshed BI test results after incident resolution"))},1e3)}else{const k="550e8400-e29b-41d4-a716-446655440000",{data:S,error:I}=yield K.from("bi_failure_incidents").insert({facility_id:k,user_id:w,incident_type:"bi_test_failure",severity:"high",status:"open",description:"BI Test Failure - Contamination Detected",failure_reason:"Biological indicator test failed, indicating sterilization failure",metadata:{affected_tools_count:(s==null?void 0:s.affected_tools_count)||1,affected_batch_ids:(s==null?void 0:s.affected_batch_ids)||["DEFAULT-BATCH"]}}).select().single();if(I)throw new Error(`Failed to create incident: ${I.message}`);const E=yield fs.resolveIncident({incidentId:S.id,resolvedByOperatorId:w,resolutionNotes:x}),O=W.getState();O.addActivity&&O.addActivity({id:`bi-incident-resolved-${S.id}`,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date,toolCount:(s==null?void 0:s.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:S.id,operatorId:w,resolutionNotes:x}}),Ma("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const A=W.getState();A.loadBITestResults&&(A.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("🔄 Refreshed BI test results after incident resolution"))},1e3),console.log("✅ BI Failure Resolution completed:",{incidentId:S.id,resolvedByOperatorId:w,resolutionNotes:x,timestamp:new Date().toISOString()}),sessionStorage.setItem("currentBIFailureIncidentId",S.id)}n(),t(),r()}catch(w){if(console.error("Failed to resolve BI failure incident:",w),w instanceof Vr)o({message:w.message,code:w.code,severity:w.severity,retryable:w.retryable});else if(w&&typeof w=="object"&&"name"in w&&w.name==="BIFailureError"&&"message"in w&&"code"in w&&"severity"in w&&"retryable"in w){const T=w;o({message:T.message,code:T.code,severity:T.severity,retryable:T.retryable})}else o({message:w instanceof Error?w.message:"An unexpected error occurred",severity:"high",retryable:!1})}finally{i(!1)}}),[x,n,t,r,s]),f=u.useCallback(w=>kr(null,null,function*(){i(!0),o(null);try{const T=yield La(),k={facility_id:w.facilityId,detected_by_operator_id:T,affected_tools_count:w.affected_tools_count,affected_batch_ids:w.affectedBatchIds,failure_reason:w.failureReason,severity_level:w.severityLevel||"high"};return yield fs.createIncident(k)}catch(T){throw console.error("Failed to create BI failure incident:",T),T instanceof Vr?o({message:T.message,code:T.code,severity:T.severity,retryable:T.retryable}):o({message:T instanceof Error?T.message:"Failed to create incident",severity:"high",retryable:!1}),T}finally{i(!1)}}),[]),g=u.useCallback(()=>{o(null),p()},[p]),v=u.useCallback(()=>{o(null),d(!1),r()},[r]),j=u.useCallback(w=>{w.target===w.currentTarget&&v()},[v]),h=u.useCallback(w=>{w.key==="Escape"&&v()},[v]),y=u.useCallback(()=>{d(w=>!w)},[]),b=u.useCallback(w=>{m(w)},[]),_=u.useCallback(()=>"mdiAlertCircle",[]),P=u.useCallback(w=>{switch(w){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},[]),$=u.useCallback(()=>a||!s,[a,s]),D=u.useCallback(()=>a?"Resolving...":"Confirm Resolution",[a]);return{isLoading:a,error:c,showExposureReport:l,resolutionNotes:x,biFailureDetails:s,handleResolve:p,createIncident:f,handleRetry:g,handleClose:v,handleBackdropClick:j,handleKeyDown:h,toggleExposureReport:y,updateResolutionNotes:b,getErrorIcon:_,getErrorColor:P,isResolveButtonDisabled:$,getResolveButtonText:D}},Bu=({isSubmitting:r,onClose:t,onMinimize:s})=>{const n=()=>{r||t()},a=i=>{i.key==="Enter"&&!r&&n()};return e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{path:xt,size:1.5,className:"text-red-500"}),e.jsxs("div",{children:[e.jsx("h2",{id:"bi-failure-modal-title",className:"text-xl font-semibold text-gray-900",children:"BI Failure Resolution Workflow"}),e.jsx("p",{id:"bi-failure-modal-description",className:"text-sm text-gray-600",children:"Complete these steps to resolve the BI failure"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx("button",{onClick:s,disabled:r,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${r?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Minimize workflow to banner",title:"Minimize to continue working on other tasks",children:e.jsx(C,{path:li,size:1.2})}),e.jsx("button",{onClick:n,onKeyDown:a,disabled:r,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${r?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Close modal","aria-describedby":"bi-failure-modal-description",children:e.jsx(C,{path:ae,size:1.2})})]})]})},Fr=()=>{const{biTestResults:r,cycles:t,currentCycle:s,availableTools:n}=W();return u.useMemo(()=>{if(!r||!Array.isArray(r))return{lastPassedDate:null,affectedCycles:[],affectedTools:[],totalToolsAffected:0,totalCyclesAffected:0,totalSterilizationEvents:0,toolsUsedMultipleTimes:0,uniqueOperators:[],dateRange:null,toolsByCategory:{},hasCurrentCycleAffected:!1};const a=r.filter(b=>b.passed).sort((b,_)=>new Date(_.date).getTime()-new Date(b.date).getTime())[0],i=a?new Date(a.date):null,c=s?[...t,s]:t,o=i?c.filter(b=>new Date(b.startTime)>i):c,l=o.flatMap(b=>b.tools.map(_=>_)),d=new Map;l.forEach(b=>{d.set(b,(d.get(b)||0)+1)});const m=Array.from(d.keys()).map(b=>n.find(P=>P.id===b)||{id:b,name:`Tool ${b}`,barcode:b,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:void 0,status:"available"}),p=m.length,f=o.length,g=l.length,v=m.filter(b=>(d.get(b.id)||0)>1).length,j=[...new Set(o.map(b=>b.operator).filter(b=>typeof b=="string"))],h=o.length>0?{start:new Date(Math.min(...o.map(b=>new Date(b.startTime).getTime()))),end:new Date(Math.max(...o.map(b=>new Date(b.startTime).getTime())))}:null,y=m.reduce((b,_)=>{const P=_.category||"Unknown";return b[P]=(b[P]||0)+1,b},{});return{lastPassedDate:i,affectedCycles:o,affectedTools:m,totalToolsAffected:p,totalCyclesAffected:f,totalSterilizationEvents:g,toolsUsedMultipleTimes:v,uniqueOperators:j,dateRange:h,toolsByCategory:y,hasCurrentCycleAffected:!!(s&&(!i||new Date(s.startTime)>i))}},[r,t,s,n])},Fu=({biFailureDetails:r})=>{var t,s,n,a,i;const c=Fr();return c.affectedCycles&&c.affectedCycles.map(o=>o.batchId).filter(o=>!!o),r?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4 p-3 bg-white rounded-lg border border-red-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:ze,size:1,className:"text-red-500 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Cycles"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:c.totalCyclesAffected})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:ut,size:1,className:"text-red-500 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Batches"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:((t=r.affectedBatchIds)==null?void 0:t.length)||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:Me,size:1,className:"text-red-500 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Tools"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:r.affectedToolsCount||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:Wo,size:1,className:"text-red-600 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Multi-Use"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:c.toolsUsedMultipleTimes})]})]}),e.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Me,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Affected Tools:"})," ",r.affectedToolsCount||0," tools are currently quarantined"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:ze,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Failure Date:"})," ",r.date?r.date.toLocaleDateString():"Unknown date"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:ze,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Risk Window:"})," ",c.dateRange?e.jsxs("span",{className:"font-mono text-xs",children:[c.dateRange.start.toLocaleDateString()," →"," ",c.dateRange.end.toLocaleDateString()]}):"All cycles (no previous passed BI test)"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:ut,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Affected Batches:"})," ",(((s=r.affectedBatchIds)==null?void 0:s.length)||0)>0?e.jsxs("span",{className:"font-mono text-xs",children:[(n=r.affectedBatchIds)==null?void 0:n.slice(0,3).join(", "),(((a=r.affectedBatchIds)==null?void 0:a.length)||0)>3&&` +${(((i=r.affectedBatchIds)==null?void 0:i.length)||0)-3} more`]}):"No batch IDs available"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Me,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Operator:"})," ",r.operator]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Me,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tools by Category:"})," ",e.jsx("span",{className:"text-xs",children:c.toolsByCategory?Object.entries(c.toolsByCategory).map(([o,l])=>`${o}: ${l}`).join(", "):"No tools categorized"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:ce,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contamination Scope:"})," ",c.totalSterilizationEvents," total sterilization events in risk window."," ",c.toolsUsedMultipleTimes>0&&e.jsxs("span",{className:"text-red-600 font-medium",children:[c.toolsUsedMultipleTimes," tools used multiple times (require extra attention)"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:ce,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Detected By:"})," ",r.operator," •"," ",e.jsx("strong",{children:"Date:"})," ",(()=>{try{return r.date?r.date instanceof Date?r.date.toLocaleDateString():new Date(r.date).toLocaleDateString():"Unknown date"}catch(o){return console.error("Date formatting error:",o),"Invalid date"}})()]})]})]})]}):e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),e.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Affected Tools:"})," 0 tools are currently quarantined"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Failure Date:"})," Unknown date"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Affected Batches:"})," No batch IDs available"]})]})]})};var Mu=Object.defineProperty,Lu=Object.defineProperties,zu=Object.getOwnPropertyDescriptors,za=Object.getOwnPropertySymbols,Uu=Object.prototype.hasOwnProperty,qu=Object.prototype.propertyIsEnumerable,Ua=(r,t,s)=>t in r?Mu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,qa=(r,t)=>{for(var s in t||(t={}))Uu.call(t,s)&&Ua(r,s,t[s]);if(za)for(var s of za(t))qu.call(t,s)&&Ua(r,s,t[s]);return r},Ha=(r,t)=>Lu(r,zu(t)),Hu=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Vu=({onToggleExposureReport:r})=>{const{currentUser:t,initializeUserContext:s}=$e();u.useEffect(()=>{t||s()},[t,s]);const[n,a]=u.useState([]),[i,c]=u.useState(!1),[o,l]=u.useState(null);u.useEffect(()=>{const j=()=>{c(!0);const y=sessionStorage.getItem("biFailureWorkflowState");if(y)try{const b=JSON.parse(y);a(b),console.log("📋 Restored workflow state from session storage")}catch(b){console.error("Failed to parse saved workflow state:",b),h()}else h();c(!1)},h=()=>{a([{step_id:"quarantine",status:"in_progress"},{step_id:"re-sterilization",status:"pending"},{step_id:"new-bi-test",status:"pending"},{step_id:"documentation",status:"pending"}])};j()},[]);const d=j=>Hu(null,null,function*(){if(!t){console.error("No current user available - currentUser:",t);return}const h=t.id||t.email||"unknown-user",y=n.findIndex(b=>b.step_id===j);if(y===-1){console.error(`Step ${j} not found`);return}try{const b=[...n];b[y]=Ha(qa({},b[y]),{status:"completed",completed_by_user_id:h,completed_at:new Date().toISOString(),notes:`Completed by ${t.email}`}),y+1<b.length&&(b[y+1]=Ha(qa({},b[y+1]),{status:"in_progress"})),a(b),sessionStorage.setItem("biFailureWorkflowState",JSON.stringify(b)),console.log(`✅ Step ${j} completed by ${t.email||"unknown user"}`)}catch(b){console.error(`Failed to complete step ${j}:`,b),l(`Failed to complete step: ${b instanceof Error?b.message:"Unknown error"}`)}}),x=j=>{const h=n.find(y=>y.step_id===j);return(h==null?void 0:h.status)||"pending"},m=j=>{const h=n.find(y=>y.step_id===j);return(h==null?void 0:h.status)==="in_progress"},p=j=>{const h=n.find(y=>y.step_id===j);return{completedBy:h==null?void 0:h.completed_by_user_id,completedAt:h==null?void 0:h.completed_at,notes:h==null?void 0:h.notes}},f=[{id:"quarantine",title:"Quarantine All Affected Tools",description:"Ensure all tools from affected batches are properly quarantined",icon:ut,isInteractive:!0},{id:"re-sterilization",title:"Re-sterilize All Quarantined Tools",description:"Re-sterilize all affected tools using proper protocols",icon:Kr,isInteractive:!0},{id:"new-bi-test",title:"Perform New BI Test",description:"Conduct a new biological indicator test to verify sterilization",icon:Kr,isInteractive:!0},{id:"documentation",title:"Complete Documentation",description:"Document all actions taken and results obtained",icon:Ne,isInteractive:!0}],g=j=>{switch(j){case"completed":return"text-green-600 bg-green-50 border-green-200";case"in_progress":return"text-blue-600 bg-blue-50 border-blue-200";case"pending":return"text-gray-600 bg-gray-50 border-gray-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},v=j=>{switch(j){case"completed":return"Completed";case"in_progress":return"In Progress";case"pending":return"Pending";default:return"Unknown"}};return i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading workflow progress..."})]})]}):o?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700",children:o})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),e.jsx("div",{className:"space-y-3",children:f.map(j=>{const h=x(j.id),y=h==="completed",b=h==="pending",_=m(j.id),P=p(j.id);return e.jsx("div",{className:`border rounded-lg p-4 ${b?"text-gray-400 bg-gray-50 border-gray-200":g(h)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(C,{path:j.icon,size:1.2,className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-medium",children:j.title}),e.jsx("div",{className:"flex items-center space-x-2",children:_?e.jsxs("button",{onClick:()=>d(j.id),className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-xs font-medium",children:[e.jsx(C,{path:Ue,size:.8}),e.jsx("span",{children:"Mark Complete"})]}):y?e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-white bg-opacity-75",children:v(h)}):b?e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-200 text-gray-500",children:"Waiting for previous step"}):null})]}),e.jsx("p",{className:"text-sm opacity-90",children:j.description}),j.isInteractive&&y&&e.jsx("div",{className:"mt-2 text-xs opacity-75",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["✅ Completed by:"," ",P.completedBy||"Unknown"]}),e.jsxs("span",{children:["🕒"," ",P.completedAt?new Date(P.completedAt).toLocaleString():"Unknown time"]})]})})]})]})},j.id)})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:ii,size:1.2,className:"text-blue-500"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Exposure Tracking"})]}),e.jsx("button",{onClick:r,onKeyDown:j=>j.key==="Enter"&&r(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium","aria-label":"View exposure report",children:"View Exposure Report"})]})})]})},Wu=({error:r,onRetry:t,getErrorColor:s})=>{if(!r)return null;const n=()=>{t()},a=i=>{i.key==="Enter"&&r.retryable&&n()};return e.jsx("div",{className:`border rounded-lg p-4 ${s(r.severity)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(C,{path:ce,size:1.2,className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium",children:[r.severity==="critical"&&"Critical Error",r.severity==="high"&&"High Priority Error",r.severity==="medium"&&"Error",r.severity==="low"&&"Warning"]}),r.code&&e.jsxs("span",{className:"text-xs font-mono bg-white bg-opacity-75 px-2 py-1 rounded",children:["Error Code: ",r.code]})]}),e.jsx("p",{className:"text-sm mb-3",children:r.message}),r.retryable&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:n,onKeyDown:a,className:"inline-flex items-center space-x-1 px-3 py-1.5 text-sm font-medium bg-white bg-opacity-75 hover:bg-opacity-90 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-current","aria-label":"Retry the operation",children:[e.jsx(C,{path:ns,size:.9}),e.jsx("span",{children:"Retry"})]}),e.jsx("span",{className:"text-xs opacity-75",children:"This error may be temporary. You can try again."})]}),!r.retryable&&e.jsx("p",{className:"text-xs opacity-75",children:"This error requires manual intervention. Please contact your supervisor."})]})]})})},Gu=({isLoading:r,isResolveButtonDisabled:t,resolveButtonText:s,resolutionNotes:n,onResolve:a,onCancel:i,onUpdateNotes:c})=>{const o=m=>{c(m.target.value)},l=()=>{t||a()},d=()=>{r||i()},x=m=>{m.key==="Enter"&&(m.ctrlKey||m.metaKey)&&!t&&(m.preventDefault(),l()),m.key==="Escape"&&!r&&d()};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resolution-notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Notes"}),e.jsx("textarea",{id:"resolution-notes",value:n,onChange:o,onKeyDown:x,disabled:r,rows:4,className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r?"bg-gray-100 cursor-not-allowed":"bg-white"}`,placeholder:"Document the steps taken to resolve this BI failure incident...","aria-describedby":"resolution-notes-help"}),e.jsx("p",{id:"resolution-notes-help",className:"mt-1 text-sm text-gray-500",children:"Include details about re-sterilization parameters, new BI test results, and any corrective actions taken."})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:d,disabled:r,className:`px-4 py-2 text-sm font-medium rounded-md border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${r?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,"aria-label":"Cancel resolution",children:"Cancel"}),e.jsx("button",{onClick:l,disabled:t,className:`px-4 py-2 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${t?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,"aria-label":"Resolve BI failure incident",children:s})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Ctrl+Enter"})," ","to resolve •"," ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel"]})})]})};var Ii=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Ku=()=>Ii(null,null,function*(){try{const{biFailureDetails:r}=W.getState(),t=sessionStorage.getItem("currentBIFailureIncidentId");if(t)return t;if(r){const s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const a=Math.random()*16|0;return(n==="x"?a:a&3|8).toString(16)});return sessionStorage.setItem("currentBIFailureIncidentId",s),s}return null}catch(r){return console.error("Failed to get current incident ID:",r),null}}),Va=()=>{ri.exportExposureReport("pdf")},Wa=()=>{ri.exportExposureReport("csv")},Qu=({isOpen:r,onClose:t,incidentId:s})=>{const[n,a]=u.useState(null),[i,c]=u.useState(!1),[o,l]=u.useState(null),d=u.useCallback(()=>Ii(null,null,function*(){c(!0),l(null);try{const f=s||(yield Ku());if(!f)throw new Error("No incident ID available for exposure report");const g=yield Ro.generatePatientExposureReport(f);a(g)}catch(f){l(f instanceof Error?f.message:"Failed to load exposure report")}finally{c(!1)}}),[s]);u.useEffect(()=>{r&&d()},[r,d]);const x=()=>{a(null),l(null),t()},m=f=>{f.target===f.currentTarget&&x()},p=f=>{f.key==="Escape"&&x()};return r?Ds.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:m,onKeyDown:p,role:"button",tabIndex:0,"aria-label":"Close modal backdrop",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto scrollbar-hide",role:"dialog","aria-labelledby":"exposure-report-title","aria-describedby":"exposure-report-description",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{path:ii,size:1.5,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h2",{id:"exposure-report-title",className:"text-xl font-semibold text-gray-900",children:"Exposure Report"}),e.jsx("p",{id:"exposure-report-description",className:"text-sm text-gray-600",children:'Tools scanned dirty in "IN USE" rooms during BI failure risk window'})]})]}),e.jsx("button",{onClick:x,onKeyDown:f=>f.key==="Enter"&&x(),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close exposure report",children:e.jsx(C,{path:ae,size:1.2})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[i&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading exposure report..."})]}),o&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500"}),e.jsxs("span",{className:"text-red-800",children:["Error: ",o]})]})}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(C,{path:xt,size:1.2,className:"text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:'"IN USE" Rooms with Tool Contamination'})]}),e.jsx("p",{className:"text-2xl font-bold text-red-900 mb-3",children:n.totalRoomsAffected||0}),e.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Risk Window Analysis:"}),e.jsx("p",{children:'This count shows tools that were used between the last passed BI test and the failed BI test. The tools have been traced to the rooms that were marked "IN USE" and scanned for use, taking them from a clean to dirty status.'}),e.jsx("p",{className:"font-medium text-red-800",children:"⚠️ Important:"}),e.jsx("p",{children:"These tools could have been cycled through the autoclave many times before a failed BI was identified. It is important to validate this list against your patient records software to initiate a patient trace and contact plan (if in your policies and procedures)."})]})]})}),n.roomDetails&&n.roomDetails.length>0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Room Exposure Analysis"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:'Tools scanned dirty in "IN USE" rooms during risk window'})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time/Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Room"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Associated Tools Scanned"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.roomDetails.map((f,g)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:new Date(String(f.roomUsedDate)).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(String(f.roomUsedDate)).toLocaleTimeString()})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:String(f.roomName)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",String(f.roomId)]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length," tool",f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length!==1?"s":""," ","scanned dirty"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.map((v,j)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:String(v)},j))})]}):e.jsx("span",{className:"text-gray-400 italic",children:"No tools scanned"})})]},g))})]})})]}):e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{path:qe,size:1.2,className:"text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-green-800",children:"No Room Exposure Found"}),e.jsxs("div",{className:"text-green-700 space-y-2",children:[e.jsx("p",{children:'Based on tool scans, it looks as though no tools that were autoclaved after the passed BI and before the failed BI have been initiated in the "dirty tool" status.'}),e.jsx("p",{className:"font-medium text-green-800",children:"This would indicate that there is no patient tracing needed."}),e.jsx("p",{className:"text-sm",children:"However, if your team is not scanning consistently, this data could be inaccurate."})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:Wa,onKeyDown:f=>f.key==="Enter"&&Wa(),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Export exposure report",children:[e.jsx(C,{path:As,size:1}),e.jsx("span",{children:"Export Report"})]}),e.jsxs("button",{onClick:Va,onKeyDown:f=>f.key==="Enter"&&Va(),className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Print exposure report",children:[e.jsx(C,{path:oi,size:1}),e.jsx("span",{children:"Print Report"})]})]}),e.jsx("button",{onClick:x,onKeyDown:f=>f.key==="Enter"&&x(),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})]})]})]})]})}),document.body):null};var Yu=Object.defineProperty,Ju=Object.defineProperties,Xu=Object.getOwnPropertyDescriptors,Ga=Object.getOwnPropertySymbols,Zu=Object.prototype.hasOwnProperty,em=Object.prototype.propertyIsEnumerable,Ka=(r,t,s)=>t in r?Yu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,tm=(r,t)=>{for(var s in t||(t={}))Zu.call(t,s)&&Ka(r,s,t[s]);if(Ga)for(var s of Ga(t))em.call(t,s)&&Ka(r,s,t[s]);return r},sm=(r,t)=>Ju(r,Xu(t));const rm=({isOpen:r,onClose:t,onMinimize:s,isMinimized:n=!1})=>{const{isLoading:a,error:i,showExposureReport:c,resolutionNotes:o,biFailureDetails:l,handleResolve:d,handleRetry:x,handleClose:m,handleBackdropClick:p,handleKeyDown:f,toggleExposureReport:g,updateResolutionNotes:v,getErrorColor:j,isResolveButtonDisabled:h,getResolveButtonText:y}=Ru({onClose:t,onSuccess:()=>{}});return r?Ds.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 p-4",style:{paddingTop:"12rem"},onClick:p,role:"button",tabIndex:0,"aria-label":"Close modal by clicking outside",onKeyDown:b=>{if(b.key==="Enter"||b.key===" "){b.preventDefault();const _=sm(tm({},b),{target:b.currentTarget,currentTarget:b.currentTarget,nativeEvent:b.nativeEvent,bubbles:!0,cancelable:!0,button:0});p(_)}},children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-y-auto transform translate-y-16 scrollbar-hide",role:"dialog","aria-labelledby":"bi-failure-modal-title","aria-describedby":"bi-failure-modal-description",onKeyDown:f,children:[e.jsx(Bu,{isSubmitting:a,onClose:m,onMinimize:s}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Fu,{biFailureDetails:l?{date:typeof l.failure_date=="string"?new Date(l.failure_date):l.failure_date instanceof Date?l.failure_date:new Date,affectedToolsCount:l.affected_tools_count,affectedBatchIds:l.affected_batch_ids,operator:l.detected_by_operator_id}:null}),e.jsx(Vu,{showExposureReport:c,onToggleExposureReport:g}),e.jsx(Wu,{error:i,onRetry:x,getErrorColor:j}),e.jsx(Gu,{isLoading:a,isResolveButtonDisabled:h(),resolveButtonText:y(),resolutionNotes:o,onResolve:d,onCancel:m,onUpdateNotes:v})]})]}),c&&e.jsx(Qu,{isOpen:c,onClose:g,incidentId:l==null?void 0:l.id})]}),document.body):null},am=({isOpen:r,onClose:t})=>e.jsx(rm,{isOpen:r,onClose:t}),nm=({onDismiss:r})=>{const[t,s]=u.useState(!1),[n,a]=u.useState(!1),{biFailureActive:i,biFailureDetails:c}=W(),{currentUser:o}=$e();return i?e.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[9999] bg-red-600 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-1 bg-red-700 rounded-lg flex-shrink-0",children:e.jsx(C,{path:ce,size:1.2,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"🚨 TOOL RECALL: BI TEST FAILURE"}),e.jsx("span",{className:"text-sm bg-red-700 px-2 py-1 rounded",children:c!=null&&c.failure_date&&typeof c.failure_date=="string"?new Date(c.failure_date).toLocaleDateString():c!=null&&c.failure_date&&c.failure_date instanceof Date?c.failure_date.toLocaleDateString():"Today"})]}),e.jsxs("p",{className:"text-sm text-red-100 mt-1",children:[e.jsx("strong",{children:"CRITICAL:"})," All tools sterilized since the last successful BI test must be quarantined immediately. Check packaging for affected batch numbers."]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>{s(!0),a(!1)},className:"flex items-center gap-2 bg-red-700 hover:bg-red-800 px-3 py-1 rounded-lg transition-colors",title:n?"Resume workflow":"View resolution workflow",children:[e.jsx(C,{path:Go,size:1,className:"text-white"}),e.jsx("span",{className:"text-sm font-medium",children:n?"Resume Workflow":"Resolution Workflow"})]}),(c==null?void 0:c.affected_tools_count)!==void 0&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-700 px-3 py-1 rounded-lg",children:[e.jsx(C,{path:ut,size:1,className:"text-white"}),e.jsxs("span",{className:"text-sm font-medium",children:[c.affected_tools_count," tools affected"]})]}),r&&e.jsx("button",{onClick:r,className:"p-1 hover:bg-red-700 rounded-lg transition-colors",title:"Dismiss banner",children:e.jsx(C,{path:ae,size:1.2,className:"text-white"})})]})]}),e.jsx(am,{isOpen:t,onClose:()=>s(!1)})]}):null},ov=({onDismiss:r})=>{const t=Er();return t.pathname==="/login"||t.pathname.startsWith("/auth")?null:e.jsx(nm,{onDismiss:r})},lm=({notification:r})=>{const[t,s]=u.useState(!0);u.useEffect(()=>{const o=setTimeout(()=>{s(!1),setTimeout(()=>{ts.removeNotification(r.id)},300)},5e3);return()=>clearTimeout(o)},[r.id]);const n=()=>{s(!1),setTimeout(()=>{ts.removeNotification(r.id)},300)},a=()=>{switch(r.type){case"tool_available":return Se;case"position_changed":case"queue_update":return qe;case"tool_unavailable":return ce;default:return qe}},i=()=>{switch(r.type){case"tool_available":return"text-green-500";case"position_changed":case"queue_update":return"text-blue-500";case"tool_unavailable":return"text-orange-500";default:return"text-gray-500"}},c=()=>{switch(r.type){case"tool_available":return r.title.includes("🔥")?"bg-red-50 border-red-200":r.title.includes("⚡")?"bg-yellow-50 border-yellow-200":r.title.includes("📋")?"bg-gray-50 border-gray-200":"bg-green-50 border-green-200";case"position_changed":case"queue_update":return"bg-blue-50 border-blue-200";case"tool_unavailable":return"bg-orange-50 border-orange-200";default:return"bg-gray-50 border-gray-200"}};return e.jsx("div",{className:`
        ${c()}
        border rounded-lg shadow-lg p-4 mb-3 max-w-sm w-full
        transform transition-all duration-300 ease-in-out
        ${t?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{path:a(),size:1.2,className:i()})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:r.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:r.message}),r.action&&e.jsx("button",{onClick:r.action.onClick,className:"mt-2 text-sm font-medium text-blue-600 hover:text-blue-500",children:r.action.label})]}),e.jsx("button",{onClick:n,className:"ml-4 flex-shrink-0 text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]})})},cv=()=>{const[r,t]=u.useState([]);return u.useEffect(()=>ts.subscribe(t),[]),r.length===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-[9999] max-w-sm",children:r.map(s=>e.jsx(lm,{notification:s},s.id))})};function im(){const r=u.useCallback(()=>fr.getRecentInsights(10),[]),t=u.useCallback(()=>fr.getPerformanceSummary(),[]);return{getInsights:r,getSummary:t}}const dv=({isVisible:r=!1,onClose:t})=>{const[s,n]=u.useState(null),[a,i]=u.useState([]),[c,o]=u.useState("all"),{getInsights:l,getSummary:d}=im();if(u.useEffect(()=>{if(r){const p=()=>{n(d()),i(l())};p();const f=setInterval(p,5e3);return()=>clearInterval(f)}},[r,l,d]),!r)return null;const x=[{key:"all",label:"All Categories",color:"bg-gray-500"},{key:"ui",label:"UI Performance",color:"bg-blue-500"},{key:"api",label:"API Performance",color:"bg-green-500"},{key:"database",label:"Database",color:"bg-purple-500"},{key:"memory",label:"Memory Usage",color:"bg-yellow-500"},{key:"network",label:"Network",color:"bg-red-500"},{key:"user-interaction",label:"User Interaction",color:"bg-indigo-500"}],m=p=>{switch(p){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Enhanced Performance Dashboard"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Performance Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(p=>e.jsx("button",{onClick:()=>o(p.key),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${c===p.key?`${p.color} text-white`:"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:p.label},p.key))})]}),s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Performance Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.totalMetrics}),e.jsx("div",{className:"text-sm text-blue-800",children:"Total Metrics"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.totalInsights}),e.jsx("div",{className:"text-sm text-green-800",children:"Insights Generated"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:Object.keys(s.categories).length}),e.jsx("div",{className:"text-sm text-purple-800",children:"Active Categories"})]})]})]}),s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Category Performance"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(s.categories).map(([p,f])=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold capitalize",children:p}),e.jsxs("span",{className:"text-sm text-gray-600",children:[f.count," metrics"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Avg:"}),e.jsxs("span",{className:"font-medium",children:[f.avgValue.toFixed(1),"ms"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Max:"}),e.jsxs("span",{className:"font-medium",children:[f.maxValue.toFixed(1),"ms"]})]})]})]},p))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Recent Performance Insights"}),e.jsxs("div",{className:"space-y-3",children:[a.map((p,f)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:p.metric}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${m(p.severity)}`,children:p.severity})]}),e.jsx("p",{className:"text-gray-700 mb-2",children:p.insight}),e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:p.recommendation}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:p.timestamp.toLocaleString()})]},f)),a.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No performance insights available"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{onClick:()=>fr.clearOldMetrics(1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Clear Old Metrics (1h)"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleString()]})]})]})]})})};var om=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const cm=({isOpen:r,onOpen:t,onClose:s,hasComplianceIssues:n=!1,hasAIUsageIssues:a=!1})=>{const{currentUser:i,getUserDisplayName:c,isLoading:o,clearUserData:l}=$e(),[d,x]=u.useState(!1),m=u.useRef(null),p=Es(),g=Er().pathname;if(o)return e.jsx("div",{className:"bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen w-16 sm:w-20 md:w-20",children:e.jsx("div",{className:"flex-1 pt-4 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[#4ECDC4]"})})});const v=h=>{p(h)},j=[{path:"/home",icon:lo,label:"Home"},{path:"/sterilization",icon:io,label:"Sterilization"},{path:"/inventory",icon:oo,label:"Inventory"},{path:"/environmental-clean",icon:co,label:"Environmental Clean"},{path:"/knowledge-hub",icon:uo,label:"Knowledge Hub"},{path:"/intelligence",icon:mo,label:"Intelligence"},{path:"/settings",icon:xo,label:"Settings"}];return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:s,"aria-hidden":"true"}),e.jsxs("aside",{className:Ot("bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen",r?"fixed inset-y-0 left-0 z-50 w-full md:relative md:w-64":"w-16 sm:w-20 md:w-20"),children:[e.jsxs("div",{className:"flex-1 pt-4 overflow-y-auto",children:[r?e.jsxs("div",{className:"px-4 sm:px-6 pb-6 flex justify-between items-center",children:[e.jsx("div",{className:"relative",children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[#4ECDC4]",children:"Cliniio"})}),e.jsx("button",{onClick:s,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),s())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Collapse navigation menu (Press Enter or Space)",title:"Collapse menu (Enter/Space)",tabIndex:0,children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 12H5"})})})]}):e.jsx("div",{className:"px-4 sm:px-6 pb-6 flex justify-center items-center",children:e.jsx("button",{onClick:t,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),t())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Expand navigation menu (Press Enter or Space)",title:"Expand menu (Enter/Space)",tabIndex:0,children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5l7 7-7 7"})})})}),e.jsx("nav",{children:j.map(({path:h,icon:y,label:b})=>e.jsxs("button",{onClick:()=>v(h),className:`flex items-center transition-colors duration-200 w-full text-left touch-manipulation relative ${r?"px-4 sm:px-6 py-4":"px-3 sm:px-4 py-4 justify-center"} ${g===h?"bg-[#4ECDC4] bg-opacity-10 border-r-4 border-[#4ECDC4] text-[#4ECDC4]":"text-[#5b5b5b] hover:bg-gray-50 hover:text-[#4ECDC4]"}`,"aria-label":r?b:`${b} page`,title:r?void 0:b,children:[e.jsx(y,{size:20,className:`${r?"mr-4":""} ${g===h?"text-[#4ECDC4]":"text-gray-400"}`,"aria-hidden":"true"}),r&&e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:`font-medium whitespace-nowrap ${g===h?"text-[#4ECDC4]":"text-[#5b5b5b]"}`,children:b}),h==="/settings"&&(n||a)&&e.jsx("div",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold ml-2",children:"!"})]}),!r&&h==="/settings"&&(n||a)&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold",children:"!"})]},h))})]}),e.jsx("div",{className:`${r?"p-3 sm:p-4":"p-1"} border-t border-gray-200 bg-white sticky bottom-0`,children:e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:m,className:`flex items-center space-x-4 w-full text-left ${r?"mb-4":"justify-center mb-2"}`,onClick:()=>x(h=>!h),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&x(y=>!y)},"aria-expanded":d,"aria-haspopup":"true","aria-label":r?`User menu for ${i?c():"User"}`:"User profile menu",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4ECDC4] flex items-center justify-center overflow-hidden",children:i!=null&&i.avatar_url?e.jsx("img",{src:i.avatar_url,alt:"Profile",className:"w-8 h-8 rounded-full object-cover",onLoad:()=>console.log("Avatar image loaded successfully in DrawerMenu"),onError:h=>console.error("Avatar image failed to load in DrawerMenu:",h)}):e.jsx(po,{size:20,className:"text-white"})}),r&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:c()}),e.jsx("p",{className:"text-xs text-gray-500",children:(i==null?void 0:i.role)||"User"})]})]}),d&&r&&e.jsx("div",{role:"menu","aria-labelledby":"user-menu",style:{position:"absolute",bottom:56,left:0,background:"white",borderRadius:8,boxShadow:"0 2px 16px rgba(0,0,0,0.15)",minWidth:180,zIndex:100,padding:12,textAlign:"center"},children:e.jsx("button",{role:"menuitem",className:"px-4 py-2 bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] w-full",onClick:()=>om(null,null,function*(){console.log("🚪 DrawerMenu: Logout button clicked");try{console.log("🚪 DrawerMenu: Starting logout process..."),console.log("🚪 DrawerMenu: Calling clearUserData()..."),l(),yield new Promise(b=>setTimeout(b,100)),console.log("🚪 DrawerMenu: Calling login store reset()...");const{useLoginStore:h}=yield Ve(()=>Promise.resolve().then(()=>qc),void 0);yield h.getState().reset(),console.log("🚪 DrawerMenu: Calling auth service logout()..."),yield new Bo().logout(),console.log("🚪 DrawerMenu: Logout successful, navigating to login"),p("/login"),x(!1),console.log("🔄 DrawerMenu: Reloading page for clean state..."),window.location.reload()}catch(h){console.error("🚪 DrawerMenu: Logout failed:",h),p("/login"),x(!1),console.log("🔄 DrawerMenu: Reloading page after logout error..."),window.location.reload()}}),children:"Logout"})})]})})]})]})},Le=({className:r="",children:t})=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${r}`,"aria-label":"Loading content",role:"status",children:t}),dm=({className:r=""})=>e.jsxs("div",{className:`bg-white rounded-lg shadow-sm p-6 ${r}`,children:[e.jsx(Le,{className:"h-4 w-3/4 mb-4"}),e.jsx(Le,{className:"h-8 w-1/2 mb-2"}),e.jsx(Le,{className:"h-3 w-full mb-1"}),e.jsx(Le,{className:"h-3 w-2/3"})]}),uv=({rows:r=5,columns:t=4})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:e.jsx("div",{className:"flex space-x-4",children:Array.from({length:t}).map((s,n)=>e.jsx(Le,{className:"h-4 flex-1"},`header-${n}`))})}),e.jsx("div",{className:"divide-y divide-gray-200",children:Array.from({length:r}).map((s,n)=>e.jsx("div",{className:"px-6 py-4",children:e.jsx("div",{className:"flex space-x-4",children:Array.from({length:t}).map((a,i)=>e.jsx(Le,{className:"h-4 flex-1"},`cell-${n}-${i}`))})},`row-${n}`))})]}),mv=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Le,{className:"h-10 flex-1"}),e.jsx(Le,{className:"h-10 w-20"})]}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:4}).map((r,t)=>e.jsx(Le,{className:"h-8 w-16"},t))})]}),um=({size:r="md"})=>{const t={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return e.jsx("div",{className:"flex justify-center items-center p-4",children:e.jsx("div",{className:`animate-spin rounded-full border-4 border-t-transparent border-blue-500 ${t[r]}`,role:"status","aria-label":"Loading"})})},mm=()=>{const r=Er();return{getCurrentContext:()=>{const s=r.pathname;return s.includes("/sterilization")?"sterilization":s.includes("/inventory")?"inventory":s.includes("/environmental-clean")?"environmental-clean":s.includes("/home")?"home":"general"}}},xm=r=>{const t=Es(),{getCurrentContext:s}=mm(),[n,a]=u.useState(null),[i,c]=u.useState(null),[o,l]=u.useState(new Set),[d,x]=u.useState(new Set),[m,p]=u.useState(new Set),[f,g]=u.useState(new Set),v=s();return{selectedHelpType:n,expandedMetrics:o,expandedTasks:d,expandedGamification:m,expandedRelevant:f,currentContext:v,handleOptionClick:w=>{w.action==="ai-chat"?a("ai-chat"):w.action==="context-help"?a("context-help"):w.action==="cliniio-help"?a("cliniio-help"):w.action==="product-feedback"?a("product-feedback"):w.action==="page"&&w.path?(t(w.path),r()):w.action==="modal"&&alert(`${w.title} - Coming soon! This will open a focused help interface.`)},handleBack:()=>{i?(a(i),c(null)):a(null)},handleFeedbackSuccess:()=>{a("cliniio-help")},toggleMetricSection:w=>{l(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},toggleTaskSection:w=>{x(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},toggleGamificationSection:w=>{p(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},toggleRelevantSection:w=>{g(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},setHelpType:w=>{c(n),a(w)}}},Qa=({onOptionClick:r})=>{const t=[{id:"ai-assistant",icon:e.jsx("span",{children:"🤖"}),title:"AI Assistant",description:"Get AI-powered help and answers",action:"ai-chat"},{id:"cliniio-help",icon:e.jsx("span",{children:"💬"}),title:"Cliniio Help",description:"General help and support",action:"cliniio-help"},{id:"context-help",icon:e.jsx("span",{children:"📚"}),title:"Relevant Information",description:"Standards and protocols for your current task",action:"context-help"},{id:"product-feedback",icon:e.jsx("span",{children:"💡"}),title:"Product Feedback",description:"Report bugs or suggest improvements",action:"product-feedback"}];return e.jsx("div",{className:"p-4 space-y-3",children:t.map(s=>e.jsx("button",{onClick:()=>r(s),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:s.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description})]})]})},s.id))})};var pm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const hm=({currentContext:r,onBack:t})=>{const[s,n]=u.useState([{role:"assistant",content:"Hello! I'm your Cliniio AI assistant. How can I help you today?"}]),[a,i]=u.useState(""),[c,o]=u.useState(!1),l=()=>pm(null,null,function*(){if(!a.trim()||c)return;const x=a.trim();i(""),n(m=>[...m,{role:"user",content:x}]),o(!0);try{const m=yield Os.askAI(x,{module:"ai-chat",facilityId:"unknown",userId:"unknown"});n(p=>[...p,{role:"assistant",content:m}])}catch(m){console.error(m),n(p=>[...p,{role:"assistant",content:"Sorry, I encountered an error. Please try again."}])}finally{o(!1)}}),d=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),l())};return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"AI Assistant"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ask me anything about Cliniio"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 scrollbar-hide",children:[s.map((x,m)=>e.jsx("div",{className:`flex ${x.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-4 py-2 rounded-lg ${x.role==="user"?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-800"}`,children:e.jsx("p",{className:"text-sm",children:x.content})})},m)),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),e.jsx("div",{className:"border-t border-gray-200 p-4 bg-white",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:a,onChange:x=>i(x.target.value),onKeyPress:d,placeholder:"Ask me anything...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",disabled:c}),e.jsx("button",{onClick:l,disabled:!a.trim()||c,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("span",{className:"text-sm",children:"Send"})})]})})]})};var gm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const fm=({currentContext:r,expandedRelevant:t,onToggleRelevantSection:s,onBack:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{gm(null,null,function*(){try{console.log("🔍 Loading relevant information articles...");const p=yield $s.getArticlesByCategory("relevant-information");console.log("📋 Found articles:",p),i(p)}catch(p){console.error("Error loading relevant information articles:",p)}finally{o(!1)}})},[]);const l=m=>{window.open(`/help/article/${m}`,"_blank")},d=[{id:"canadian-standards",title:"🇨🇦 Canadian Standards",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• CSA Z314.2-19 - Decontamination of Reusable Medical Devices"}),e.jsx("li",{children:"• CSA Z314.3-19 - Steam Sterilization in Health Care Facilities"}),e.jsx("li",{children:"• Health Canada SOR/98-282 - Medical Device Regulations"}),e.jsx("li",{children:"• Public Health Agency of Canada - Routine Practices and Additional Precautions"}),e.jsx("li",{children:"• Ontario Health - Infection Prevention and Control Guidelines"}),e.jsx("li",{children:"• BC Centre for Disease Control - Healthcare-Associated Infection Prevention"}),e.jsx("li",{children:"• Alberta Health Services - Sterilization and Reprocessing Standards"}),e.jsx("li",{children:"• Quebec Health - Hygiene Practices in Healthcare Facilities"})]})},{id:"us-standards",title:"🇺🇸 US Standards",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• AAMI ST79:2017 - Comprehensive Guide to Steam Sterilization"}),e.jsx("li",{children:"• AAMI ST91:2021 - Flexible Endoscope Reprocessing"}),e.jsx("li",{children:"• CDC Guidelines - Disinfection and Sterilization in Healthcare Facilities"}),e.jsx("li",{children:"• FDA Regulations - Medical Device Reprocessing Standards"}),e.jsx("li",{children:"• Joint Commission - Healthcare Accreditation Standards"}),e.jsx("li",{children:"• OSHA Guidelines - Workplace Safety and Chemical Handling"}),e.jsx("li",{children:"• ANSI/AAMI Standards - Sterilization Validation and Monitoring"})]})},{id:"international-standards",title:"🌍 International Standards",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"• ISO 15883 - Washer-disinfectors"}),e.jsx("li",{children:"• ISO 17665 - Steam sterilization"}),e.jsx("li",{children:"• ISO 13485 - Medical Device Quality Management"}),e.jsx("li",{children:"• ISO 9001 - Quality Management Systems"}),e.jsx("li",{children:"• WHO Guidelines - Infection Prevention and Control"}),e.jsx("li",{children:"• ASTM Standards - Material Testing and Validation"}),e.jsx("li",{children:"• IAC Standards - Infection Prevention and Control"}),e.jsx("li",{children:"• APIC Guidelines - Healthcare-Associated Infection Prevention"})]})}],x=m=>{const p=t.has(m.id),g={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[m.color];return e.jsxs("div",{className:`${g.bg} ${g.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>s(m.id),className:`w-full p-3 text-left flex items-center justify-between ${g.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${g.text}`,children:m.title}),e.jsx("span",{className:`${g.icon} text-lg transition-transform duration-200`,children:p?"−":"+"})]}),p&&e.jsxs("div",{className:"px-3 pb-3",children:[m.content,m.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(m.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},m.id)};if(r==="home"||r==="general"){if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about standards and compliance.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Standards and compliance reference"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Comprehensive Standards Reference"}),m.map(x)]})})]})}return r==="sterilization"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"BI Testing"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Biological indicator testing protocols"}),e.jsx("li",{children:"• Testing frequency requirements"}),e.jsx("li",{children:"• Result interpretation and documentation"}),e.jsx("li",{children:"• Quality assurance procedures"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Sterilization Workflow"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Pre-cleaning and inspection protocols"}),e.jsx("li",{children:"• Proper packaging and loading techniques"}),e.jsx("li",{children:"• Sterilization cycle parameters"}),e.jsx("li",{children:"• Post-sterilization handling procedures"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Reporting and Compliance"}),e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"• Documentation requirements"}),e.jsx("li",{children:"• Regulatory compliance standards"}),e.jsx("li",{children:"• Audit preparation and procedures"}),e.jsx("li",{children:"• Quality management systems"})]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"General information and standards will be displayed here based on your current page."})})};var bm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const ym=()=>{const[r,t]=u.useState(""),[s,n]=u.useState(""),[a,i]=u.useState(""),[c,o]=u.useState("medium"),[l,d]=u.useState(""),[x,m]=u.useState(!1);return{feedbackType:r,setFeedbackType:t,feedbackTitle:s,setFeedbackTitle:n,feedbackDescription:a,setFeedbackDescription:i,feedbackPriority:c,setFeedbackPriority:o,feedbackEmail:l,setFeedbackEmail:d,isSubmittingFeedback:x,handleFeedbackSubmit:g=>bm(null,null,function*(){g.preventDefault(),m(!0);try{const v={type:r,title:s,description:a,priority:c,email:l},j=yield Fo.submitFeedback(v);return j.success?(t(""),n(""),i(""),o("medium"),d(""),alert("Thank you for your feedback! We'll review it and get back to you if needed."),!0):(console.error("Error submitting feedback:",j.error),alert("There was an error submitting your feedback. Please try again."),!1)}catch(v){return console.error("Error submitting feedback:",v),alert("There was an error submitting your feedback. Please try again."),!1}finally{m(!1)}}),resetFeedbackForm:()=>{t(""),n(""),i(""),o("medium"),d("")}}};var vm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const jm=({onBack:r,onSuccess:t})=>{const{feedbackType:s,setFeedbackType:n,feedbackTitle:a,setFeedbackTitle:i,feedbackDescription:c,setFeedbackDescription:o,feedbackPriority:l,setFeedbackPriority:d,feedbackEmail:x,setFeedbackEmail:m,isSubmittingFeedback:p,handleFeedbackSubmit:f}=ym(),g=v=>vm(null,null,function*(){(yield f(v))&&t()});return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Product Feedback"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Help us improve Cliniio"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-white text-2xl",children:"💡"})}),e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Share Your Feedback"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Help us make Cliniio better for everyone"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackType",className:"block text-sm font-medium text-gray-700 mb-2",children:"Feedback Type *"}),e.jsxs("select",{id:"feedbackType",value:s,onChange:v=>n(v.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select feedback type"}),e.jsx("option",{value:"bug",children:"Bug Report"}),e.jsx("option",{value:"feature",children:"Feature Request"}),e.jsx("option",{value:"improvement",children:"Improvement Suggestion"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),e.jsx("input",{id:"feedbackTitle",type:"text",value:a,onChange:v=>i(v.target.value),placeholder:"Brief description of your feedback",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{id:"feedbackDescription",value:c,onChange:v=>o(v.target.value),placeholder:"Please provide detailed information...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackPriority",className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("select",{id:"feedbackPriority",value:l,onChange:v=>d(v.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email (optional)"}),e.jsx("input",{id:"feedbackEmail",type:"email",value:x,onChange:v=>m(v.target.value),placeholder:"your.email@facility.com",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"We'll only use this to follow up on your feedback"})]}),e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-[#4ECDC4] text-white py-3 px-4 rounded-lg hover:bg-[#4ECDC4]/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:p?"Submitting...":"Submit Feedback"})]})]})})]})},wm=({onBack:r})=>{const[t,s]=u.useState(new Set([0])),[n,a]=u.useState(null),i=o=>{s(l=>{const d=new Set(l);return d.has(o)?(d.delete(o),n===o&&a(null)):(d.add(o),a(o)),d})},c=()=>{a(null)};return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Onboarding Tour"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Step-by-step guide to using the Home page"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-white text-2xl",children:"🎯"})}),e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Welcome to Cliniio!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Let's take a quick tour of your Home page"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(0),className:"w-full p-4 text-left flex items-center justify-between hover:bg-blue-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"1"}),e.jsx("h5",{className:"font-medium text-blue-800",children:"Daily Tasks & Progress"})]}),e.jsx("span",{className:"text-blue-600 text-lg transition-transform duration-200",children:t.has(0)?"−":"+"})]}),t.has(0)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"The main area shows your daily tasks and responsibilities. Each task card displays what needs to be done and your progress."}),e.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3 text-xs text-blue-600",children:[e.jsx("strong",{children:"Try it:"})," Look for task cards with checkboxes. Click on a checkbox to mark a task as complete and earn points!"]}),e.jsxs("button",{onClick:()=>a(n===0?null:0),className:"mt-3 w-full bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600 transition-colors",children:["🎯"," ",n===0?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(1),className:"w-full p-4 text-left flex items-center justify-between hover:bg-green-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"2"}),e.jsx("h5",{className:"font-medium text-green-800",children:"Quick Action Buttons"})]}),e.jsx("span",{className:"text-green-600 text-lg transition-transform duration-200",children:t.has(1)?"−":"+"})]}),t.has(1)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"At the top of your Home page, you'll find quick access buttons for important features and your performance stats."}),e.jsxs("div",{className:"bg-white border border-green-200 rounded p-3 text-xs text-green-600",children:[e.jsx("strong",{children:"Try it:"}),' Click on the purple "Stats" button to see your performance metrics, or the amber "Leaderboard" to check your ranking.']}),e.jsxs("button",{onClick:()=>a(n===1?null:1),className:"mt-3 w-full bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 transition-colors",children:["🎯"," ",n===1?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(2),className:"w-full p-4 text-left flex items-center justify-between hover:bg-purple-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"3"}),e.jsx("h5",{className:"font-medium text-purple-800",children:"Gamification & Points"})]}),e.jsx("span",{className:"text-purple-600 text-lg transition-transform duration-200",children:t.has(2)?"−":"+"})]}),t.has(2)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Notice the points and progress indicators? Cliniio makes work fun by rewarding your achievements and tracking your progress."}),e.jsxs("div",{className:"bg-white border border-purple-500 rounded p-3 text-xs text-purple-600",children:[e.jsx("strong",{children:"Try it:"})," Complete a task and watch your points increase. Check your progress in the Stats section to see your growth."]}),e.jsxs("button",{onClick:()=>a(n===2?null:2),className:"mt-3 w-full bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600 transition-colors",children:["🎯"," ",n===2?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(3),className:"w-full p-4 text-left flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"4"}),e.jsx("h5",{className:"font-medium text-amber-800",children:"Performance Metrics"})]}),e.jsx("span",{className:"text-amber-600 text-lg transition-transform duration-200",children:t.has(3)?"−":"+"})]}),t.has(3)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Below your tasks, you'll see cards showing your time savings, cost savings, AI efficiency, and team performance."}),e.jsxs("div",{className:"bg-white border border-amber-200 rounded p-3 text-xs text-amber-600",children:[e.jsx("strong",{children:"Try it:"})," Review your metrics to see how you're performing. These update automatically as you complete tasks."]}),e.jsxs("button",{onClick:()=>a(n===3?null:3),className:"mt-3 w-full bg-amber-500 text-white px-3 py-2 rounded text-sm hover:bg-amber-600 transition-colors",children:["🎯"," ",n===3?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(4),className:"w-full p-4 text-left flex items-center justify-between hover:bg-teal-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"5"}),e.jsx("h5",{className:"font-medium text-teal-800",children:"Help & Support"})]}),e.jsx("span",{className:"text-teal-600 text-lg transition-transform duration-200",children:t.has(4)?"−":"+"})]}),t.has(4)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"That floating help button (🛟) you used to get here is always available when you need assistance with any feature."}),e.jsxs("div",{className:"bg-white border border-teal-200 rounded p-3 text-xs text-teal-600",children:[e.jsx("strong",{children:"Remember:"})," You can access help from anywhere in Cliniio. Just look for the floating button!"]}),e.jsxs("button",{onClick:()=>a(n===4?null:4),className:"mt-3 w-full bg-teal-500 text-white px-3 py-2 rounded text-sm hover:bg-teal-600 transition-colors",children:["🎯"," ",n===4?"Hide arrow":"Show me where this is"]})]})]})]}),e.jsx("div",{className:"bg-[#4ECDC4] border border-[#4ECDC4] rounded-lg p-4 text-center",children:e.jsxs("div",{className:"text-white",children:[e.jsx("h5",{className:"font-medium text-lg mb-2",children:"🎉 You're All Set!"}),e.jsx("p",{className:"text-sm text-white text-opacity-90 mb-3",children:"You now know the basics of navigating your Home page. Feel free to explore and try things out!"}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-white text-[#4ECDC4] rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Finish Tour"})]})})]})}),n!==null&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[n===0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute left-1/4 top-1/3 z-50",children:[e.jsx("div",{className:"bg-blue-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"📋 Daily Tasks"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-blue-500 ml-4"})]})}),n===1&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute right-1/4 top-20 z-50",children:[e.jsx("div",{className:"bg-green-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"⚡ Quick Actions"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-green-500 ml-4"})]})}),n===2&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute left-1/4 top-1/4 z-50",children:[e.jsx("div",{className:"bg-purple-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"🏆 Points & Progress"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-purple-500 ml-4"})]})}),n===3&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute left-1/4 bottom-1/4 z-50",children:[e.jsx("div",{className:"bg-amber-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"📊 Performance Metrics"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-amber-500 ml-4"})]})}),n===4&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute bottom-20 right-20 z-50",children:[e.jsx("div",{className:"bg-teal-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"🛟 Help Button"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-teal-500 ml-4"})]})}),e.jsx("button",{onClick:c,className:"absolute top-4 right-4 bg-white text-gray-700 px-3 py-2 rounded-lg shadow-lg pointer-events-auto hover:bg-gray-100 transition-colors border border-gray-200 z-50",children:"✕ Close"})]})]})},Nm=({currentContext:r,onBack:t,onSetHelpType:s})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Cliniio Help"}),e.jsx("p",{className:"text-xs text-gray-500",children:r==="home"?"Help for Home page":"General help and support"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r==="home"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Home Page Help"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s("performance-metrics"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"📊"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Understanding your dashboard metrics"})]})]})}),e.jsx("button",{onClick:()=>s("task-management"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"✅"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Task Management"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Managing daily tasks and workflows"})]})]})}),e.jsx("button",{onClick:()=>s("gamification"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"🏆"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Gamification System"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How points, levels, and streaks work"})]})]})}),e.jsx("button",{onClick:()=>s("ai-features"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"🤖"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"AI Features"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How AI improves your workflow"})]})]})})]})]}):r==="sterilization"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s("bi-testing"),className:"bg-blue-50 border border-blue-200 rounded-lg p-3 w-full text-left hover:bg-blue-100 transition-colors",children:e.jsx("h5",{className:"font-medium text-blue-800",children:"🧪 BI Testing"})}),e.jsx("button",{onClick:()=>s("sterilization-workflow"),className:"bg-green-50 border border-green-200 rounded-lg p-3 w-full text-left hover:bg-green-100 transition-colors",children:e.jsx("h5",{className:"font-medium text-green-800",children:"✂️ Sterilization Workflow"})}),e.jsx("button",{onClick:()=>s("reporting-compliance"),className:"bg-purple-50 border border-purple-200 rounded-lg p-3 w-full text-left hover:bg-purple-100 transition-colors",children:e.jsx("h5",{className:"font-medium text-purple-800",children:"📊 Reporting and Compliance"})})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"Help content coming soon for this page."})})})]});var Cm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Sm=({onBack:r,expandedMetrics:t,onToggleMetricSection:s,onSetHelpType:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{Cm(null,null,function*(){try{console.log("🔍 Loading performance metrics articles...");const f=yield $s.getArticlesByCategory("performance-metrics");console.log("📊 Found articles:",f),console.log("📊 Articles count:",f.length),console.log("📊 Articles details:",f.map(g=>({slug:g.slug,title:g.title,published:g.is_published}))),i(f)}catch(f){console.error("❌ Error loading performance metrics articles:",f)}finally{o(!1)}})},[]);const l=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"time-savings",title:"Time Savings",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Shows hours saved through AI assistance"}),e.jsx("li",{children:"• Daily and monthly tracking"}),e.jsx("li",{children:"• Compares AI vs. manual task completion"}),e.jsx("li",{children:"• Real-time updates as tasks complete"})]})},{id:"cost-savings",title:"Cost Savings",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Calculates dollar impact of AI efficiency"}),e.jsx("li",{children:"• Includes error prevention and compliance savings"}),e.jsx("li",{children:"• Uses facility-specific hourly rates"}),e.jsx("li",{children:"• Projects annual savings with growth factors"})]})},{id:"team-performance",title:"Team Performance",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"• Skills: Based on AI task completion rates"}),e.jsx("li",{children:"• Inventory: Real-time accuracy from actual data"}),e.jsx("li",{children:"• Sterilization: Performance from cycle data"}),e.jsx("li",{children:"• Helps identify training needs"})]})}],x=p=>{const f=t.has(p.id),v={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return e.jsxs("div",{className:`${v.bg} ${v.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>s(p.id),className:`w-full p-3 text-left flex items-center justify-between ${v.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${v.text}`,children:p.title}),e.jsx("span",{className:`${v.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&e.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about this performance metric.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Understanding your dashboard metrics"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Dashboard Metrics Explained"}),m.map(x)]})})]})};var _m=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Tm=({onBack:r,onSetHelpType:t,expandedTasks:s,onToggleTaskSection:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{_m(null,null,function*(){try{console.log("🔍 Loading task management articles...");const f=yield $s.getArticlesByCategory("task-management");console.log("📋 Found articles:",f),i(f)}catch(f){console.error("Error loading task management articles:",f)}finally{o(!1)}})},[]);const l=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"task-categories",title:"📋 Task Categories",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Sterilization: Autoclave cycles and BI tests"}),e.jsx("li",{children:"• Inventory: Stock checks and ordering"}),e.jsx("li",{children:"• Environmental: Cleaning schedules and compliance"}),e.jsx("li",{children:"• Quality: Documentation and audits"})]})},{id:"task-completion",title:"✅ Task Completion",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Click checkboxes to mark tasks complete"}),e.jsx("li",{children:"• Earn points for each completed task"}),e.jsx("li",{children:"• Track progress throughout the day"}),e.jsx("li",{children:"• Maintain streaks for consistency"})]})},{id:"workflow-tips",title:"💡 Workflow Tips",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"• Use filters to focus on specific task types"}),e.jsx("li",{children:"• Prioritize high-impact tasks first"}),e.jsx("li",{children:"• Set reminders for time-sensitive items"}),e.jsx("li",{children:"• Review completed tasks for quality"})]})}],x=p=>{const f=s.has(p.id),v={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return e.jsxs("div",{className:`${v.bg} ${v.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>n(p.id),className:`w-full p-3 text-left flex items-center justify-between ${v.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${v.text}`,children:p.title}),e.jsx("span",{className:`${v.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&e.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about task management.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Managing daily tasks and workflows"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Daily Task Management"}),m.map(x)]})})]})};var km=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Im=({onBack:r,onSetHelpType:t,expandedGamification:s,onToggleGamificationSection:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{km(null,null,function*(){try{console.log("🔍 Loading gamification articles...");const f=yield $s.getArticlesByCategory("gamification");console.log("🎮 Found articles:",f),i(f)}catch(f){console.error("Error loading gamification articles:",f)}finally{o(!1)}})},[]);const l=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"point-system",title:"⭐ Point System",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Complete tasks to earn points"}),e.jsx("li",{children:"• Points vary by task difficulty and impact"}),e.jsx("li",{children:"• Bonus points for maintaining streaks"}),e.jsx("li",{children:"• Level up as you accumulate points"})]})},{id:"streaks-consistency",title:"🔥 Streaks & Consistency",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Daily streaks increase your multiplier"}),e.jsx("li",{children:"• Perfect days earn bonus rewards"}),e.jsx("li",{children:"• Streaks reset on missed days"}),e.jsx("li",{children:"• Long streaks unlock special achievements"})]})},{id:"level-progression",title:"📊 Level Progression",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"• Multiple skill-based sub-levels"}),e.jsx("li",{children:"• Sterilization, inventory, and environmental"}),e.jsx("li",{children:"• Rank against other users"}),e.jsx("li",{children:"• Unlock new features as you progress"})]})}],x=p=>{const f=s.has(p.id),v={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return e.jsxs("div",{className:`${v.bg} ${v.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>n(p.id),className:`w-full p-3 text-left flex items-center justify-between ${v.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${v.text}`,children:p.title}),e.jsx("span",{className:`${v.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&e.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about gamification.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"How points, levels, and streaks work"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Earning and Progress"}),m.map(x)]})})]})},Pm=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"AI Features"}),e.jsx("p",{className:"text-xs text-gray-500",children:"How AI improves your workflow"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"AI-Powered Assistance"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Smart Task Generation"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• AI creates relevant daily tasks"}),e.jsx("li",{children:"• Adapts to your facility's needs"}),e.jsx("li",{children:"• Suggests optimal task sequences"}),e.jsx("li",{children:"• Learns from your preferences"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Optimization"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Real-time efficiency monitoring"}),e.jsx("li",{children:"• Predictive maintenance alerts"}),e.jsx("li",{children:"• Resource optimization suggestions"}),e.jsx("li",{children:"• Compliance risk mitigation"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Intelligent Insights"}),e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"• Data-driven recommendations"}),e.jsx("li",{children:"• Trend analysis and forecasting"}),e.jsx("li",{children:"• Best practice suggestions"}),e.jsx("li",{children:"• Continuous improvement tips"})]})]})]})})]}),Dm=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"New Features"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Discover what's new in Cliniio"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"What's New in Cliniio"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Latest Updates"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Enhanced AI assistance capabilities"}),e.jsx("li",{children:"• Improved task management system"}),e.jsx("li",{children:"• New gamification features"}),e.jsx("li",{children:"• Enhanced reporting and analytics"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Improvements"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"• Faster page loading times"}),e.jsx("li",{children:"• Better mobile responsiveness"}),e.jsx("li",{children:"• Improved accessibility features"}),e.jsx("li",{children:"• Enhanced security measures"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Coming Soon"}),e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"• Advanced workflow automation"}),e.jsx("li",{children:"• Integration with external systems"}),e.jsx("li",{children:"• Enhanced mobile app features"}),e.jsx("li",{children:"• More customization options"})]})]})]})})]}),Em=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Sterilization Workflow"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sterilization processes and procedures"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"Sterilization workflow content coming soon."})})})]}),Om=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Reporting and Compliance"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Documentation and regulatory compliance procedures"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"Reporting and compliance content coming soon."})})})]}),$m=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"BI Testing"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Biological indicator testing protocols"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"BI testing content coming soon."})})})]}),Am=({selectedHelpType:r,currentContext:t,expandedMetrics:s,expandedTasks:n,expandedGamification:a,expandedRelevant:i,onOptionClick:c,onBack:o,onFeedbackSuccess:l,onToggleMetricSection:d,onToggleTaskSection:x,onToggleGamificationSection:m,onToggleRelevantSection:p,onSetHelpType:f})=>{if(!r)return e.jsx(Qa,{onOptionClick:c});switch(r){case"ai-chat":return e.jsx(hm,{currentContext:t,onBack:o});case"context-help":return e.jsx(fm,{currentContext:t,expandedRelevant:i,onToggleRelevantSection:p,onBack:o});case"product-feedback":return e.jsx(jm,{onBack:o,onSuccess:l});case"onboarding":return e.jsx(wm,{onBack:o});case"cliniio-help":return e.jsx(Nm,{currentContext:t,onBack:o,onSetHelpType:f});case"performance-metrics":return e.jsx(Sm,{onBack:o,expandedMetrics:s,onToggleMetricSection:d,onSetHelpType:f});case"task-management":return e.jsx(Tm,{onBack:o,onSetHelpType:f,expandedTasks:n,onToggleTaskSection:x});case"gamification":return e.jsx(Im,{onBack:o,onSetHelpType:f,expandedGamification:a,onToggleGamificationSection:m});case"ai-features":return e.jsx(Pm,{onBack:o});case"new-features":return e.jsx(Dm,{onBack:o});case"bi-testing":return e.jsx($m,{onBack:o});case"sterilization-workflow":return e.jsx(Em,{onBack:o});case"reporting-compliance":return e.jsx(Om,{onBack:o});default:return e.jsx(Qa,{onOptionClick:c})}},Rm=({isDrawerOpen:r,onClose:t})=>{const{selectedHelpType:s,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,currentContext:o,handleOptionClick:l,handleBack:d,handleFeedbackSuccess:x,toggleMetricSection:m,toggleTaskSection:p,toggleGamificationSection:f,toggleRelevantSection:g,setHelpType:v}=xm(t),j=()=>e.jsx(Am,{selectedHelpType:s,currentContext:o,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,onOptionClick:l,onBack:d,onFeedbackSuccess:x,onToggleMetricSection:m,onToggleTaskSection:p,onToggleGamificationSection:f,onToggleRelevantSection:g,onSetHelpType:v});return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t,onKeyDown:h=>h.key==="Escape"&&t(),role:"button",tabIndex:0,"aria-label":"Close help drawer"}),e.jsxs("div",{className:"fixed top-0 right-0 h-screen w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out flex flex-col",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-[#4ECDC4] text-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"?"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Help & Support"}),e.jsx("p",{className:"text-xs text-white text-opacity-90",children:"Choose how you'd like to get help"})]})]})}),j()]})]}):null},Bm=()=>{const[r,t]=u.useState(!1),s=()=>{t(!r)},n=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{onClick:s,className:"w-14 h-14 bg-transparent text-gray-700 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 relative flex items-center justify-center","aria-label":"Get AI help and assistance",title:"AI Help & Assistant",children:e.jsx("span",{className:"text-6xl",children:"🛟"})})}),e.jsx(Rm,{isDrawerOpen:r,onClose:n})]})};var Fm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const xv=({children:r,hasComplianceIssues:t,hasAIUsageIssues:s})=>{const{isDrawerOpen:n,openDrawer:a,closeDrawer:i}=kc(),[c,o]=u.useState(!1);u.useEffect(()=>{function d(){return Fm(this,null,function*(){try{const{data:m,error:p}=yield K.from("audit_flags").select("id").eq("resolved",!1).limit(1);p||o(m&&m.length>0)}catch(m){console.error("Failed to check compliance issues:",m)}})}d();const x=()=>{setTimeout(()=>{d()},1e3)};return window.addEventListener("complianceIssueResolved",x),()=>window.removeEventListener("complianceIssueResolved",x)},[]);const l=t!==void 0?t:c;return e.jsx(Bc,{children:e.jsxs(u.Suspense,{fallback:e.jsx(um,{size:"lg"}),children:[e.jsxs("div",{className:"flex min-h-[100dvh] md:min-h-screen bg-gradient-to-br from-blue-50 to-teal-50",children:[e.jsx(cm,{isOpen:n,onOpen:a,onClose:i,hasComplianceIssues:l,hasAIUsageIssues:s||!1}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"pt-6",children:r})})]}),e.jsx(Bm,{})]})})},Qs=["Welcome back, sterilization superstar! ✨","Hey there, inventory rockstar! 🎸","The clinic's MVP is back in action! 🏆","Welcome to another day of medical excellence! 🌟","Ready to tackle some sterilization challenges? 💪","Back in the clinic and ready to shine! ✨","Time to make those tools gleam! ✨","Welcome back! The tools missed you! 🔧","Let's make today spotlessly successful! ✨","Ready to master the medical inventory? 📋","The sterilization superstar has arrived! 🌟","Let's make those tools SHINE today! ✨","Welcome back to your sterilization kingdom! 👑","Ready to conquer today's challenge? Let's do this! 🏅","Another day, another challenge to crush! 🚀","Your daily challenge awaits—show it who's boss! 💪","Inventory hero reporting for duty! 📦","Let's keep those supplies in tip-top shape! 🗂️","Inventory wizardry in progress—abracadabra! 🧙‍♂️","Time to check off those tasks like a pro! ✅","Taskmaster mode: activated! 🕹️","Let's make that to-do list disappear! ✨","Sparkle squad, assemble! 🧽","Let's make every room shine bright! 💡","Clean team, ready for action! 🦸‍♀️","Knowledge quest begins now! 📚","Time to level up your skills! 🎮","Learning legend in the house! 🏆"],Mm=()=>{const[r,t]=u.useState(Qs[0]);return u.useEffect(()=>{const s=Math.floor(Math.random()*Qs.length);setTimeout(()=>{t(Qs[s])},0)},[]),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-[#5b5b5b] mb-2",children:r})},Pi=({content:r,children:t,className:s=""})=>{const[n,a]=u.useState(!1);return e.jsxs("div",{className:`relative inline-block ${s}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[t,n&&e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50",children:e.jsx("div",{className:"bg-white text-gray-700 text-xs font-medium px-3 py-2 rounded-lg shadow-lg border border-gray-200 text-center whitespace-pre-line",children:r})})]})},Lm=[{icon:Ko,bg:"teal",label:"Cumulative Stats",description:`Performance
Statistics`},{icon:br,bg:"purple",label:"Leaderboard",description:`Team
Rankings`},{icon:ci,bg:"blue",label:"Daily Challenge",description:`Daily
Challenge`}],pv=({onStatsClick:r,onLeaderboardClick:t,onChallengeClick:s})=>{const n=(a,i)=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),i==null||i())};return e.jsxs("header",{className:"mb-6 pl-8","aria-label":"Dashboard header","data-testid":"nav-bar",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Mm,{}),e.jsx("nav",{className:"flex gap-2 md:gap-4 pr-4 md:pr-8",role:"navigation","aria-label":"Dashboard actions",children:Lm.map(a=>{const i=a.label==="Cumulative Stats"?r:a.label==="Leaderboard"?t:a.label==="Daily Challenge"?s:void 0;return e.jsx(Pi,{content:a.description,children:e.jsx("button",{className:`rounded-xl w-14 h-14 md:w-12 md:h-12 flex items-center justify-center transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 ${a.label==="Cumulative Stats"?"bg-purple-100 focus:ring-purple-500":a.label==="Leaderboard"?"bg-amber-100 focus:ring-amber-500":"bg-blue-100 focus:ring-blue-500"}`,"aria-label":`${a.label}: ${a.description}`,onClick:i,onKeyDown:c=>n(c,i),tabIndex:0,children:e.jsx(C,{path:a.icon,size:1.1,"aria-hidden":"true",color:a.label==="Cumulative Stats"?"#9333ea":a.label==="Leaderboard"?"#d97706":"#2563eb"})})},a.label)})})]}),e.jsx("p",{className:"text-sm text-gray-500",role:"status","aria-live":"polite",children:"Here's your impact and progress for today."})]})},dt={NAV_BAR_MARGIN_TOP:4,NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:24,NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED:72,COLORS:{PRIMARY:"#4ECDC4",PRIMARY_BG:"teal-100",BORDER:"teal-400",BG_GRADIENT:{FROM:"blue-50",TO:"teal-50"}},SPACING:{PADDING:6,MARGIN_TOP:6},BORDER:{LEFT_WIDTH:4},taskCard:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50",sectionBox:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50"},hv=r=>{const t=r?dt.NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:dt.NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED,s=dt.NAV_BAR_MARGIN_TOP;return{navBarMarginLeft:t,navBarMarginTop:s}};function zm(){return Ot(dt.sectionBox,"mb-4")}function Ys(){return Ot(dt.taskCard,"mb-4")}var Um=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const qm=()=>{const[r,t]=u.useState({toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}),[s,n]=u.useState(!0),[a,i]=u.useState(null),c=u.useCallback(()=>Um(null,null,function*(){try{n(!0),i(null);const l=yield Mo.fetchCumulativeStats();t(l)}catch(l){console.error("Error fetching cumulative stats:",l),i(l instanceof Error?l.message:"Failed to fetch stats")}finally{n(!1)}}),[]);u.useEffect(()=>{c()},[c]);const o=u.useCallback(()=>{c()},[c]);return{stats:r,loading:s,error:a,refreshStats:o}},Hm=({isOpen:r,onClose:t,gamificationData:s})=>{const{stats:n,loading:a,error:i,refreshStats:c}=qm(),o=(s==null?void 0:s.stats)||{toolsSterilized:n.toolsSterilized,inventoryChecks:n.inventoryChecks,perfectDays:n.perfectDays,totalTasks:n.totalTasks,completedTasks:n.completedTasks,currentStreak:n.currentStreak,bestStreak:n.bestStreak};return e.jsx(Bs,{children:r&&e.jsx(me.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:e.jsxs(me.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:e.jsx(C,{path:kt,size:.9,className:"text-white"})}),e.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:"Cumulative Stats"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,disabled:a,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg disabled:opacity-50",title:"Refresh stats",children:e.jsx(C,{path:ns,size:.9,className:a?"animate-spin":""})}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg",children:e.jsx(C,{path:ae,size:.9})})]})]}),i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[e.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Stats"}),e.jsx("div",{className:"text-red-500 text-xs mt-1",children:i})]}),e.jsxs("div",{className:"space-y-3",children:[a&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4] mx-auto"}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading stats..."})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-[#4ECDC4] bg-opacity-10 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-[#4ECDC4] font-semibold text-sm",children:"Tools Sterilized"}),e.jsx("div",{className:"text-2xl font-bold text-[#4ECDC4]",children:o.toolsSterilized}),e.jsx("div",{className:"text-xs text-[#4ECDC4] mt-0.5",children:"That's impressive!"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-blue-600 font-semibold text-sm",children:"Inventory Checks"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:o.inventoryChecks}),e.jsx("div",{className:"text-xs text-blue-500 mt-0.5",children:"Always organized!"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-green-600 font-semibold text-sm",children:"Perfect Days"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:o.perfectDays}),e.jsx("div",{className:"text-xs text-green-500 mt-0.5",children:"Zero errors!"})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-purple-600 font-semibold text-sm",children:"Task Completion"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[o.totalTasks>0?Math.round(o.completedTasks/o.totalTasks*100):0,"%"]}),e.jsxs("div",{className:"text-xs text-purple-500 mt-0.5",children:[o.completedTasks," / ",o.totalTasks," tasks completed"]})]}),e.jsxs("div",{className:"bg-amber-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-amber-600 font-semibold text-sm",children:"Current Streak"}),e.jsx("div",{className:"text-2xl font-bold text-amber-700",children:o.currentStreak}),e.jsxs("div",{className:"text-xs text-amber-500 mt-0.5",children:["Best streak: ",o.bestStreak]})]})]})]})]})})})};var Vm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Wm=({isOpen:r,onClose:t,gamificationData:s,loading:n=!1,error:a=null})=>{const[i,c]=u.useState("All"),[o,l]=u.useState([]);u.useEffect(()=>{Vm(null,null,function*(){try{let m=K.from("user_gamification_stats").select("user_id, total_xp, category");i!=="All"&&(m=m.eq("category",i.toLowerCase()));const{data:p,error:f}=yield m.order("total_xp",{ascending:!1}).limit(10);if(f)throw f;l(p||[])}catch(m){console.error("Error fetching leaderboard:",m)}})},[i]);const d={rank:(s==null?void 0:s.rank)||1,topUsers:(s==null?void 0:s.topUsers)||[]};return e.jsx(Bs,{children:r&&e.jsx(me.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:e.jsxs(me.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-6 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-blue-500 rounded-xl",children:e.jsx(C,{path:br,size:1,className:"text-white"})}),e.jsx("h2",{className:"ml-3 text-xl font-bold text-[#5b5b5b]",children:"Office Leaderboard"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-blue-700 font-medium",children:"Your Rank"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xl font-bold text-blue-700 mr-1",children:["#",d.rank]}),e.jsx("span",{className:"text-blue-500 text-sm",children:"/15"})]})]}),a&&e.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[e.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Leaderboard"}),e.jsx("div",{className:"text-red-500 text-xs mt-1",children:a})]}),e.jsx("div",{className:"flex gap-2 mb-4 justify-center",children:["All","Learning","Cleaning","Challenges"].map(x=>e.jsx("button",{onClick:()=>c(x),className:`px-3 py-1 rounded-full text-sm font-medium border transition ${i===x?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-100"}`,children:x},x))}),e.jsxs("div",{className:"space-y-3",children:[n&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading leaderboard..."})]}),!n&&!a&&d.topUsers.map((x,m)=>e.jsxs(me.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:m*.2+.2},className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-semibold",children:x.avatar}),m===0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center",children:e.jsx(C,{path:br,size:.4,className:"text-white"})})]}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700",children:x.full_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Rank #",m+1]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg font-bold text-[#4ECDC4]",children:x.score}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"pts"})]})]},x.id||x.full_name))]})]})})})},Gm=Z.memo(Wm),Mr={TASKS:"Daily Operations Tasks",STATS:"Stats Overview",CHALLENGES:"Today's Challenge"};var Km=Object.defineProperty,Qm=Object.defineProperties,Ym=Object.getOwnPropertyDescriptors,Ya=Object.getOwnPropertySymbols,Jm=Object.prototype.hasOwnProperty,Xm=Object.prototype.propertyIsEnumerable,Ja=(r,t,s)=>t in r?Km(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Zm=(r,t)=>{for(var s in t||(t={}))Jm.call(t,s)&&Ja(r,s,t[s]);if(Ya)for(var s of Ya(t))Xm.call(t,s)&&Ja(r,s,t[s]);return r},ex=(r,t)=>Qm(r,Ym(t)),Xa=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const tx={knowledge:"bg-blue-100 text-blue-800",process:"bg-purple-100 text-purple-800",quality:"bg-green-100 text-green-800",collaboration:"bg-orange-100 text-orange-800",daily:"bg-gray-100 text-gray-800",team:"bg-pink-100 text-pink-800"},sx={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"},rx=({isOpen:r,onClose:t,onChallengeComplete:s})=>{const[n,a]=u.useState("all"),[i,c]=u.useState("all"),[o,l]=u.useState("pending"),[d,x]=u.useState([]),[m,p]=u.useState(!0);u.useEffect(()=>{Xa(null,null,function*(){try{p(!0);const b=(yield Wr.fetchUserChallenges()).map(_=>({id:_.id,title:_.title,description:_.description,category:_.category,difficulty:_.difficulty,points:_.points,timeEstimate:_.time_estimate,completed:_.isCompleted||!1}));x(b)}catch(y){console.error("Error loading challenges:",y)}finally{p(!1)}})},[]);const f=[{id:"knowledge",icon:Qo,label:"Knowledge"},{id:"process",icon:Yo,label:"Process"},{id:"quality",icon:Jo,label:"Quality"},{id:"collaboration",icon:Qr,label:"Collaboration"},{id:"daily",icon:Xo,label:"Daily"},{id:"team",icon:Qr,label:"Team"}],g=[{id:"easy",label:"Easy",color:"text-green-500"},{id:"medium",label:"Medium",color:"text-yellow-500"},{id:"hard",label:"Hard",color:"text-red-500"}],v=d.filter(h=>{const y=n==="all"||h.category===n,b=i==="all"||h.difficulty===i,_=o==="all"||o==="pending"&&!h.completed||o==="completed"&&h.completed;return y&&b&&_}),j=h=>Xa(null,null,function*(){try{(yield Wr.completeChallenge({challenge_id:h.id,points_earned:h.points}))?(x(b=>b.map(_=>_.id===h.id?ex(Zm({},_),{completed:!0}):_)),s(h.points)):console.error("Failed to complete challenge")}catch(y){console.error("Error completing challenge:",y)}});return e.jsx(Bs,{children:r&&e.jsx(me.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:e.jsxs(me.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto scrollbar-hide",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:e.jsx(C,{path:ci,size:.9,className:"text-white"})}),e.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:Mr.CHALLENGES})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:.9})})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Category"}),e.jsxs("select",{value:n,onChange:h=>a(h.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Categories"}),f.map(h=>e.jsx("option",{value:h.id,children:h.label},h.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Difficulty"}),e.jsxs("select",{value:i,onChange:h=>c(h.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),g.map(h=>e.jsx("option",{value:h.id,children:h.label},h.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Status"}),e.jsxs("select",{value:o,onChange:h=>l(h.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Challenges"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsx("div",{className:"space-y-3",children:m?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading challenges..."})}):v.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"No challenges available"})}):v.map(h=>e.jsx("div",{className:`p-3 rounded-lg border ${h.completed?"bg-gray-50 border-gray-200":"bg-white border-gray-200 hover:border-[#4ECDC4]"}`,children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${tx[h.category]}`,children:h.category}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${sx[h.difficulty]}`,children:h.difficulty}),e.jsx("span",{className:"text-xs text-gray-500",children:h.timeEstimate})]}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-0.5",children:h.title}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:h.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-[#4ECDC4]",children:[h.points," points"]}),!h.completed&&e.jsx("button",{onClick:()=>j(h),className:"px-3 py-1 bg-[#4ECDC4] text-white text-xs rounded-lg hover:bg-[#38b2ac] transition-colors",children:"Complete"}),h.completed&&e.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[e.jsx(C,{path:Zo,size:.8,className:"mr-1"}),"Completed"]})]})]})})},h.id))})]})})})},gv=({isStatsOpen:r,onStatsClose:t,isLeaderboardOpen:s,onLeaderboardClose:n,isChallengeOpen:a,onChallengeClose:i,gamificationData:c,leaderboardRank:o,leaderboardTopUsers:l,leaderboardLoading:d=!1,leaderboardError:x=null})=>{const{getCurrentFacilityId:m}=Rr(),[p,f]=u.useState({rank:o,topUsers:l}),[g,v]=u.useState(!1),[j,h]=u.useState(null);u.useEffect(()=>{if(s&&l.length===0){setTimeout(()=>{v(!0),h(null)},0);const b=m();Lo.fetchLeaderboardData(b||void 0).then(_=>{f({rank:1,topUsers:(_==null?void 0:_.map(P=>({id:P.user_id,name:P.user_name||"Anonymous",score:P.points||0,avatar:"👤"})))||[]})}).catch(_=>{h(_.message||"Failed to load leaderboard")}).finally(()=>{v(!1)})}},[s,l.length,m]);const y={stats:c.stats||{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}};return e.jsxs(e.Fragment,{children:[r&&e.jsx(Hm,{isOpen:r,onClose:t,gamificationData:y}),e.jsx(Gm,{isOpen:s,onClose:n,gamificationData:p,loading:g,error:j}),e.jsx(rx,{isOpen:a,onClose:i,onChallengeComplete:b=>{console.log("Challenge completed with points:",b)}})]})},le=({path:r,size:t=24,color:s="currentColor",className:n})=>e.jsx(ho.Icon,{path:r,size:t,color:s,className:n}),fv=({currentPage:r,totalPages:t,onPageChange:s,onNextPage:n,onPreviousPage:a,hasNextPage:i,hasPreviousPage:c,isLoading:o=!1,className:l=""})=>{if(t<=1)return null;const d=()=>{const x=[];if(t<=5)for(let p=1;p<=t;p++)x.push(p);else if(r<=3){for(let p=1;p<=4;p++)x.push(p);x.push("..."),x.push(t)}else if(r>=t-2){x.push(1),x.push("...");for(let p=t-3;p<=t;p++)x.push(p)}else{x.push(1),x.push("...");for(let p=r-1;p<=r+1;p++)x.push(p);x.push("..."),x.push(t)}return x};return e.jsxs("div",{className:`flex items-center justify-center space-x-2 ${l}`,children:[e.jsxs("button",{onClick:a,disabled:!c||o,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${c&&!o?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:[e.jsx(le,{path:ec,size:16,className:"mr-1"}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-1",children:d().map((x,m)=>e.jsx(Z.Fragment,{children:x==="..."?e.jsx("span",{className:"px-3 py-2 text-sm text-gray-500",children:"..."}):e.jsx("button",{onClick:()=>s(x),disabled:o,className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${x===r?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"} ${o?"cursor-not-allowed":""}`,children:x})},m))}),e.jsxs("button",{onClick:n,disabled:!i||o,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${i&&!o?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:["Next",e.jsx(le,{path:Et,size:16,className:"ml-1"})]}),e.jsxs("div",{className:"ml-4 text-sm text-gray-500",children:["Page ",r," of ",t]})]})},bv=({onLoadMore:r,hasMore:t,isLoading:s,className:n="",buttonText:a="Load More",loadingText:i="Loading..."})=>t?e.jsx("div",{className:`flex justify-center ${n}`,children:e.jsx("button",{onClick:r,disabled:s,className:"flex items-center px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?e.jsxs(e.Fragment,{children:[e.jsx(le,{path:Or,size:16,className:"animate-spin mr-2"}),i]}):e.jsxs(e.Fragment,{children:[a,e.jsx(le,{path:pt,size:16,className:"ml-2"})]})})}):null;var ax=Object.defineProperty,nx=Object.defineProperties,lx=Object.getOwnPropertyDescriptors,Za=Object.getOwnPropertySymbols,ix=Object.prototype.hasOwnProperty,ox=Object.prototype.propertyIsEnumerable,en=(r,t,s)=>t in r?ax(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Js=(r,t)=>{for(var s in t||(t={}))ix.call(t,s)&&en(r,s,t[s]);if(Za)for(var s of Za(t))ox.call(t,s)&&en(r,s,t[s]);return r},Xs=(r,t)=>nx(r,lx(t)),cx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const dx=({task:r,isOpen:t,onClose:s,onSave:n})=>{const[a,i]=u.useState({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),[c,o]=u.useState({}),[l,d]=u.useState(!1),[x,m]=u.useState(null);u.useEffect(()=>{r&&(i({title:r.title||"",description:r.description||"",priority:r.priority||"medium",dueDate:r.dueDate?new Date(r.dueDate).toISOString().split("T")[0]:"",status:r.status||"pending"}),o({}),m(null))},[r]),u.useEffect(()=>{t||(i({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),o({}),m(null),d(!1))},[t]);const p=u.useCallback(()=>{const j={};if(a.title.trim()?a.title.trim().length<3?j.title="Title must be at least 3 characters long":a.title.trim().length>100&&(j.title="Title must be less than 100 characters"):j.title="Title is required",a.description.trim().length>500&&(j.description="Description must be less than 500 characters"),a.dueDate){const h=new Date(a.dueDate),y=new Date;y.setHours(0,0,0,0),h<y&&(j.dueDate="Due date cannot be in the past")}return o(j),Object.keys(j).length===0},[a]),f=u.useCallback((j,h)=>{i(y=>Xs(Js({},y),{[j]:h})),c[j]&&o(y=>Xs(Js({},y),{[j]:void 0}))},[c]),g=u.useCallback(j=>cx(null,null,function*(){if(j.preventDefault(),!!r&&p()){d(!0),m(null);try{const h=Xs(Js({},r),{title:a.title.trim(),description:a.description.trim()||void 0,priority:a.priority,dueDate:a.dueDate||new Date().toISOString(),status:a.status});yield n(r.id,h),s()}catch(h){m(h instanceof Error?h.message:"Failed to save task")}finally{d(!1)}}}),[r,a,p,n,s]),v=u.useCallback(()=>{l||s()},[l,s]);return u.useEffect(()=>{const j=h=>{h.key==="Escape"&&t&&!l&&s()};if(t)return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[t,l,s]),!t||!r?null:e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:v,onKeyDown:j=>{j.key==="Escape"&&v()},role:"button",tabIndex:0,"aria-label":"Close modal"}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-md transform overflow-hidden rounded-lg bg-white shadow-xl transition-all",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Task"}),e.jsx("button",{onClick:v,disabled:l,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50","aria-label":"Close modal",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("form",{onSubmit:g,className:"px-6 py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),e.jsx("input",{type:"text",id:"title",value:a.title,onChange:j=>f("title",j.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.title?"border-red-300":"border-gray-300"}`,placeholder:"Enter task title",disabled:l}),c.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.title})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{id:"description",value:a.description,onChange:j=>f("description",j.target.value),rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.description?"border-red-300":"border-gray-300"}`,placeholder:"Enter task description (optional)",disabled:l}),c.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.description}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[a.description.length,"/500 characters"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{id:"priority",value:a.priority,onChange:j=>f("priority",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",id:"dueDate",value:a.dueDate,onChange:j=>f("dueDate",j.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.dueDate?"border-red-300":"border-gray-300"}`,disabled:l}),c.dueDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.dueDate})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",value:a.status,onChange:j=>f("status",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800",children:x})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:v,disabled:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:l?"Saving...":"Save Changes"})]})]})]})})]})};var ux=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const mx=({tasks:r,onTaskComplete:t,onTaskUpdate:s})=>{const[n,a]=u.useState(1),[i,c]=u.useState(null),[o,l]=u.useState(null),[d,x]=u.useState(!1),m=10,p=u.useCallback(S=>{if(!S.dueDate)return!1;const I=new Date(S.dueDate);return(new Date().getTime()-I.getTime())/(1e3*60*60)<=24},[]),f=u.useCallback(S=>{const I="task-item border rounded-lg p-4 mb-2",E=p(S);return Ot(I,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":E,"shadow-sm":!E})},[p]),g=u.useMemo(()=>Array.isArray(r)?r:[],[r]),v=u.useMemo(()=>g.filter(S=>S.status!=="completed"),[g]),j=u.useMemo(()=>Math.max(1,Math.ceil(v.length/m)),[v.length,m]),h=u.useMemo(()=>(n-1)*m,[n,m]),y=u.useMemo(()=>h+m,[h,m]),b=u.useMemo(()=>v.slice(h,y),[v,h,y]),_=u.useCallback(S=>{c(I=>I===S?null:S)},[]),P=u.useCallback(S=>{l(S),x(!0)},[]),$=u.useCallback((S,I)=>ux(null,null,function*(){if(s)try{yield s(S,I),x(!1),l(null)}catch(E){console.error("Failed to update task:",E)}}),[s]),D=u.useCallback(()=>{x(!1),l(null)},[]),w=u.useCallback(()=>{a(S=>Math.max(1,S-1))},[]),T=u.useCallback(()=>{a(S=>Math.min(j,S+1))},[j]),k=u.useMemo(()=>b.map(S=>e.jsxs("div",{className:f(S),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>_(S.id),className:"text-gray-400 hover:text-gray-600","aria-label":i===S.id?"Collapse task details":"Expand task details",children:e.jsx("span",{className:`transform transition-transform ${i===S.id?"rotate-90":""}`,children:"▶"})}),e.jsx("span",{className:"font-medium",children:S.title}),p(S)&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-[#4ECDC4] bg-[#4ECDC4] bg-opacity-10 px-2 py-1 rounded-full",children:["+",S.points||0," pts"]}),e.jsx("button",{onClick:()=>P(S),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Edit"}),t&&e.jsx("button",{onClick:()=>t(S.id,S.points||0),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Complete"})]})]}),i===S.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:S.description}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Priority: ",S.priority]}),e.jsxs("div",{children:["Status: ",S.status]}),e.jsxs("div",{children:["Points: ",S.points||0]}),S.dueDate&&e.jsxs("div",{children:["Due: ",new Date(S.dueDate).toLocaleDateString()]})]})]})]},S.id)),[b,i,_,P,t,f,p]);return v.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No tasks available"}):e.jsxs("div",{className:"space-y-4",children:[k,j>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsx("button",{onClick:w,disabled:n===1,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",n," of ",j]}),e.jsx("button",{onClick:T,disabled:n===j,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsx(dx,{task:o,isOpen:d,onClose:D,onSave:$})]})},xx={COMPLETE:"Complete"};var px=Object.defineProperty,hx=Object.defineProperties,gx=Object.getOwnPropertyDescriptors,tn=Object.getOwnPropertySymbols,fx=Object.prototype.hasOwnProperty,bx=Object.prototype.propertyIsEnumerable,sn=(r,t,s)=>t in r?px(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,bt=(r,t)=>{for(var s in t||(t={}))fx.call(t,s)&&sn(r,s,t[s]);if(tn)for(var s of tn(t))bx.call(t,s)&&sn(r,s,t[s]);return r},us=(r,t)=>hx(r,gx(t)),yx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const vx=r=>({id:r.id,title:r.title,description:r.description,status:r.status,priority:r.priority==="urgent"?"urgent":r.priority==="high"?"high":r.priority==="low"?"low":"normal",due_date:r.dueDate,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),user_id:"",facility_id:"",completed:r.completed}),Di=Z.memo(({onTaskComplete:r,onTaskUpdate:t,tasks:s,itemHeight:n=120,containerHeight:a=600})=>{const[i,c]=u.useState(null),[o,l]=u.useState(null),[d,x]=u.useState({}),[m,p]=u.useState(0),f=u.useRef(null),g=u.useCallback(E=>{if(!E.dueDate)return!1;const O=new Date(E.dueDate);return(new Date().getTime()-O.getTime())/(1e3*60*60)<=24},[]),v=u.useCallback(E=>{const O="rounded-xl border border-gray-200 p-4 bg-white mx-2",A=g(E);return Ot(O,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":A,"shadow-sm":!A})},[g]),j=u.useMemo(()=>Array.isArray(s)?s:[],[s]),h=u.useMemo(()=>j.filter(E=>E.status!=="completed"),[j]),y=Math.ceil(a/n),b=Math.floor(m/n),_=Math.min(b+y+2,h.length),P=u.useMemo(()=>h.slice(b,_),[h,b,_]),$=h.length*n,D=u.useCallback(E=>{p(E.currentTarget.scrollTop)},[]),w=u.useCallback(E=>{c(O=>O===E?null:E)},[]),T=u.useCallback(E=>{l(E.id),x(E)},[]),k=u.useCallback(()=>{l(null),x({})},[]),S=u.useCallback(()=>yx(null,null,function*(){if(o)try{const E=h.find(R=>R.id===o);if(!E){console.error("Task not found for editing");return}const O=bt(bt({},E),d),A=vx(O),{TaskService:B}=yield Ve(()=>import("./services-JA4N6ZXe.js").then(R=>R.aV),__vite__mapDeps([0,1,2,3,4,5,6,7,8]));yield B.updateTask(A.id,A),t&&t(o,O),l(null),x({})}catch(E){console.error("Failed to save task:",E)}}),[o,h,d,t]),I=u.useMemo(()=>P.map((E,O)=>{const B=(b+O)*n;return e.jsx("div",{className:"absolute w-full",style:{top:B,height:n},children:e.jsxs("div",{className:v(E),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{onClick:()=>w(E.id),className:"mt-1 text-gray-400 hover:text-gray-600","aria-label":i===E.id?"Collapse task details":"Expand task details",children:e.jsx(go,{className:`transform transition-transform ${i===E.id?"rotate-90":""}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:E.title}),g(E)&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:`${E.category||"General"} - ${E.type||"Training"} - Due: ${E.dueDate||"N/A"}`})]})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[e.jsxs("span",{className:"text-violet-600 font-semibold",children:["+",E.points," pts"]}),e.jsx("button",{onClick:()=>r==null?void 0:r(E.id,E.points||0),className:"rounded-full border border-green-500 text-green-500 text-sm px-3 py-1 hover:bg-green-50","aria-label":`Complete task: ${E.title}`,"data-testid":`task-checkbox-${E.id}`,children:xx.COMPLETE})]})]}),i===E.id&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"text-sm space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`category-${E.id}`,className:"block text-gray-600 font-medium mb-1",children:"Category"}),o===E.id?e.jsx("input",{id:`category-${E.id}`,type:"text",value:d.category||"",onChange:R=>x(us(bt({},d),{category:R.target.value})),className:"w-full px-3 py-2 border rounded-md"}):e.jsx("div",{className:"text-gray-700",children:E.category||"General"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`type-${E.id}`,className:"block text-gray-600 font-medium mb-1",children:"Type"}),o===E.id?e.jsx("input",{id:`type-${E.id}`,type:"text",value:d.type||"",onChange:R=>x(us(bt({},d),{type:R.target.value})),className:"w-full px-3 py-2 border rounded-md"}):e.jsx("div",{className:"text-gray-700",children:E.type||"Training"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`dueDate-${E.id}`,className:"block text-gray-600 font-medium mb-1",children:"Due Date"}),o===E.id?e.jsx("input",{id:`dueDate-${E.id}`,type:"date",value:d.dueDate||"",onChange:R=>x(us(bt({},d),{dueDate:R.target.value})),className:"w-full px-3 py-2 border rounded-md"}):e.jsx("div",{className:"text-gray-700",children:E.dueDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`points-${E.id}`,className:"block text-gray-600 font-medium mb-1",children:"Points"}),o===E.id?e.jsx("input",{id:`points-${E.id}`,type:"number",value:d.points||0,onChange:R=>x(us(bt({},d),{points:parseInt(R.target.value)})),className:"w-full px-3 py-2 border rounded-md"}):e.jsxs("div",{className:"text-gray-700",children:[E.points||0," points"]})]})]}),e.jsx("div",{className:"mt-4 space-y-4",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:()=>T(E),className:"rounded-full border border-violet-500 text-violet-500 text-sm px-3 py-1 hover:bg-violet-50","aria-label":`Edit task: ${E.title}`,children:[e.jsx(fo,{className:"inline-block mr-1"}),"Edit"]})})})}),o===E.id&&e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-violet-600 text-white rounded-md hover:bg-violet-700",children:"Save"})]})]})]})]})},E.id)}),[P,b,n,i,o,d,w,r,T,k,S,v,g]);return e.jsx("div",{ref:f,className:"relative overflow-auto",style:{height:a},onScroll:D,children:e.jsx("div",{style:{height:$,position:"relative"},children:I})})});Di.displayName="VirtualizedTasksList";const rn={categories:[{value:"operations",label:"Operations"},{value:"maintenance",label:"Maintenance"},{value:"safety",label:"Safety"}],types:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}]},jx=({selectedCategory:r,selectedType:t,onCategoryChange:s,onTypeChange:n})=>e.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:r,onChange:a=>s(a.target.value),children:[e.jsx("option",{value:"",children:"Category"}),rn.categories.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:t,onChange:a=>n(a.target.value),children:[e.jsx("option",{value:"",children:"Type"}),rn.types.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",children:[e.jsx("option",{value:"",children:"Due Date"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"tomorrow",children:"Tomorrow"}),e.jsx("option",{value:"this_week",children:"This Week"})]})]})}),wx=(r,t,s)=>{if(!r||r.length===0)return[];let n=r;return t&&(n=n.filter(a=>a.category===t)),s&&(n=n.filter(a=>a.type===s)),n},Nx=({tasks:r,onTaskComplete:t,onTaskUpdate:s,availablePoints:n,showFilters:a,onToggleFilters:i,selectedCategory:c,selectedType:o,onCategoryChange:l,onTypeChange:d,isLoading:x=!1})=>{const m=u.useMemo(()=>{if(r)return wx(r,c,o)},[r,c,o]),p=u.useMemo(()=>m&&m.length>50,[m]);return x?e.jsx("div",{className:`${Ys()} h-full`,"data-testid":"tasks-list",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((f,g)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]},g))})]})}):r?e.jsxs("div",{className:`${Ys()} h-full`,"data-testid":"tasks-list",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`bg-${dt.COLORS.PRIMARY_BG} rounded-md p-1`,children:e.jsx(C,{path:yr,size:1,color:dt.COLORS.PRIMARY})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:Mr.TASKS})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"px-3 py-2 text-sm font-semibold bg-[#4ECDC4] bg-opacity-10 text-[#4ECDC4] border border-[#4ECDC4] border-opacity-30 rounded-lg",children:["📊 Total Available: ",n," Points"]}),e.jsxs("button",{onClick:i,className:"p-2 bg-[#4ECDC4] hover:bg-[#38b2ac] rounded-lg text-white flex items-center transition-colors duration-200",children:[e.jsx(C,{path:$r,size:.8}),e.jsx("span",{className:"ml-1 text-sm hidden sm:inline-block",children:"Filter"})]})]})]}),a&&e.jsx(jx,{selectedCategory:c,selectedType:o,onCategoryChange:l,onTypeChange:d}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto h-full",children:p?e.jsx(Di,{tasks:m,onTaskComplete:t,onTaskUpdate:s,itemHeight:120,containerHeight:600}):e.jsx(mx,{tasks:m,onTaskComplete:t,onTaskUpdate:s})})]}):e.jsx("div",{className:`${Ys()} h-full`,"data-testid":"tasks-list",children:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-gray-500 text-center",children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:"No tasks available"}),e.jsx("div",{className:"text-sm",children:"Tasks will appear here when they become available."})]})})})},yv=u.memo(Nx),vv=({message:r="Something went wrong."})=>e.jsx("div",{role:"alert","aria-live":"assertive",className:"text-sm text-red-600 mt-2",children:r}),Cx=({data:r})=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"bg-blue-100 rounded-md p-2 mr-3",children:e.jsx(Jl,{size:20,className:"text-[#2563eb]"})}),e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Time Savings"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Day)"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:[r.daily," hrs"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Month)"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:[r.monthly," hrs"]})]})]})]}),Sx=({data:r={monthly:0,annual:0}})=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"bg-green-100 rounded-md p-2 mr-3",children:e.jsx(bo,{size:20,className:"text-green-800"})}),e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Cost Savings"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Monthly Savings"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(r.monthly||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Annual Savings"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(r.annual||0).toLocaleString()]})]})]})]});var _x=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Tx=({timeframe:r="daily",aiImpactMetrics:t})=>{const[s,n]=u.useState(null),[a,i]=u.useState(!0),c=u.useRef(0);if(u.useEffect(()=>{if(t){console.log("🤖 EnhancedAiEfficiencyCard: Using pre-loaded AI metrics:",t),n(t),i(!1);return}console.log("🤖 EnhancedAiEfficiencyCard: No pre-loaded metrics, fetching independently...");const m=()=>_x(null,null,function*(){try{i(!0);const f=yield zo.getAIImpactMetrics();n(f)}catch(f){console.error("Error fetching AI metrics:",f)}finally{i(!1)}});m();const p=setInterval(m,120*1e3);return()=>clearInterval(p)},[t]),a)return e.jsx("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"bg-purple-200 rounded-md p-2 mr-3 w-10 h-10"}),e.jsx("div",{className:"h-5 bg-gray-200 rounded w-32"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})});const o=s||{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},costSavings:{daily:0,monthly:0,annual:0,roi:0}},l=()=>{const m=(()=>{switch(r){case"daily":return o.timeSavings.daily;case"weekly":return o.timeSavings.weekly;case"monthly":return o.timeSavings.monthly;default:return o.timeSavings.daily}})(),p=Date.now();return p-c.current>1e3&&(console.log("🕒 EnhancedAiEfficiencyCard: getTimeframeValue:",{timeframe:r,timeSavings:o.timeSavings,returnedValue:m}),c.current=p),m},d=m=>{const p=Date.now();p-c.current>1e3&&console.log("⏰ EnhancedAiEfficiencyCard: formatTime called with:",m);const f=(()=>{if(m<60)return`${m} m`;const g=Math.floor(m/60),v=m%60;return v>0?`${g}h ${v} m`:`${g}h`})();return p-c.current>1e3&&(console.log("⏰ EnhancedAiEfficiencyCard: formatTime result:",f),c.current=p),f},x=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m);return e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"bg-purple-200 rounded-md p-2 mr-3",children:e.jsx(yo,{size:20,className:"text-purple-900"})}),e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"AI & Process Efficiency"})})]}),e.jsx("div",{className:"flex items-center text-xs text-gray-400"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-left text-gray-500",children:"Time Saved"}),e.jsx("span",{className:"text-base text-right text-gray-700",children:d(l())})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-left text-gray-500",children:"Cost Saved"}),e.jsx("span",{className:"text-base text-right text-gray-700",children:x(r==="weekly"?o.costSavings.monthly/4:o.costSavings[r]||0)})]})]})]})},kx=({data:r})=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"bg-yellow-200 rounded-md p-2 mr-3",children:e.jsx(vo,{size:20,className:"text-yellow-900"})}),e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Team Performance"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Skills"}),e.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.skills,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Inventory Efficiency"}),e.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.inventory,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Sterilization Efficiency"}),e.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.sterilization,"%"]})]})]})]}),Ix=({metrics:r={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0}},aiImpactMetrics:t})=>{var s,n,a,i,c,o,l,d,x;const[m]=u.useState("daily");return console.log("📊 PerformanceMetrics: Received metrics:",r),console.log("🤖 PerformanceMetrics: Received aiImpactMetrics:",t),console.log("👥 PerformanceMetrics: Team performance data:",r.teamPerformance),t&&console.log("🔍 aiImpactMetrics structure:",{timeSavings:t.timeSavings,costSavings:t.costSavings,keys:Object.keys(t)}),e.jsxs("div",{className:"bg-white rounded-lg p-4 pt-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-teal-100 rounded-md p-1",children:e.jsx(jo,{size:24,color:"#4ECDC4"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:"Performance Metrics"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Cx,{data:r.timeSaved,timeframe:m}),e.jsx(Sx,{data:r.costSavings}),e.jsx(Tx,{timeframe:m,showInsights:!1,aiImpactMetrics:t?{timeSavings:{daily:((s=t.timeSavings)==null?void 0:s.daily)||0,weekly:((n=t.timeSavings)==null?void 0:n.weekly)||0,monthly:((a=t.timeSavings)==null?void 0:a.monthly)||0,total:((i=t.timeSavings)==null?void 0:i.total)||0,percentage:((c=t.timeSavings)==null?void 0:c.percentage)||0},costSavings:{daily:((o=t.costSavings)==null?void 0:o.daily)||0,monthly:((l=t.costSavings)==null?void 0:l.monthly)||0,annual:((d=t.costSavings)==null?void 0:d.annual)||0,roi:((x=t.costSavings)==null?void 0:x.roi)||0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:0,riskMitigation:0,predictiveAccuracy:0},efficiencyGains:{taskCompletionRate:0,qualityImprovement:0,resourceOptimization:0,workflowStreamlining:0},realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:"",dataFreshness:100}}:null}),e.jsx(kx,{data:r.teamPerformance,timeframe:m})]})]})};function Px(){return e.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 shadow-sm mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"BI Indicator Dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Biological indicator results will be displayed here once available."})]})}function Dx(){return e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50 shadow-sm mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CI Indicator Dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Chemical indicator results will be displayed here once available."})]})}const Ex=({biData:r,ciData:t,performanceMetrics:s,aiImpactMetrics:n})=>e.jsxs("div",{className:zm(),"data-testid":"metrics-section",children:[e.jsx(Ix,{metrics:s,aiImpactMetrics:n}),r&&e.jsx(Px,{}),t&&e.jsx(Dx,{})]}),jv=u.memo(Ex);var Ox=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const wv=({onRefresh:r,className:t="",size:s="md"})=>{const[n,a]=u.useState(!1),[i,c]=u.useState(null),[o,l]=u.useState("idle"),d={sm:"w-6 h-6 text-sm",md:"w-8 h-8 text-base",lg:"w-10 h-10 text-lg"},x=()=>Ox(null,null,function*(){if(!n){a(!0),l("idle");try{yield r(),c(new Date),l("success"),setTimeout(()=>l("idle"),2e3)}catch(g){console.error("Refresh failed:",g),l("error"),setTimeout(()=>l("idle"),3e3)}finally{a(!1)}}}),m=()=>{if(n)return e.jsx(Hr,{className:"animate-spin"});switch(o){case"success":return e.jsx(Xl,{className:"text-green-500"});case"error":return e.jsx(ws,{className:"text-red-500"});default:return e.jsx(Hr,{})}},p=()=>n?"Refreshing...":o==="success"?"Updated successfully":o==="error"?"Refresh failed":i?`Last updated: ${i.toLocaleTimeString()}`:"Refresh",f=()=>n?"Refreshing performance metrics":o==="success"?"Performance metrics updated successfully":o==="error"?"Failed to refresh performance metrics - try again":i?`Refresh performance metrics - Last updated: ${i.toLocaleTimeString()}`:"Refresh performance metrics (PRN)";return e.jsx(Pi,{content:p(),children:e.jsx("button",{onClick:x,disabled:n,className:`
          ${d[s]}
          flex items-center justify-center
          bg-white hover:bg-gray-50
          border border-gray-200 hover:border-gray-300
          rounded-lg shadow-sm hover:shadow-md
          transition-all duration-200
          disabled:opacity-50 disabled:cursor-not-allowed
          ${t}
        `,"aria-label":f(),children:m()})})},$x=({points:r})=>{const t=Math.max(0,r||0);return e.jsx("div",{className:"text-xl font-bold text-[#4ECDC4]",children:t})},Ax=({streakCount:r})=>{const t=Math.max(0,r||0);return e.jsxs("div",{className:"text-sm text-orange-500 font-medium",children:["🔥 ",t,"-day streak"]})},Rx=({level:r})=>{const t=Math.max(1,r||1);return e.jsx("span",{className:"text-xl font-bold text-[#4ECDC4]",children:t})},Nv=({gamificationData:r={streak:0,level:1,rank:100,totalScore:0,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}}})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2","aria-label":Mr.STATS,"aria-live":"polite","data-testid":"gamification-stats",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center p-1 pr-8",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:e.jsx(wo,{size:20,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Current Streak"}),e.jsx("div",{className:"flex items-baseline",children:e.jsx(Ax,{streakCount:r.streak})})]})]}),e.jsxs("div",{className:"flex items-center p-1",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:e.jsx(No,{size:20,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Level"}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx(Rx,{level:r.level}),e.jsx("div",{className:"ml-2 px-2 py-0.5 bg-blue-100 rounded-full",children:e.jsxs("span",{className:"text-xs font-semibold text-blue-600",children:["Top ",r.rank,"%"]})})]})]})]}),e.jsxs("div",{className:"flex items-center p-1 pl-8",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:e.jsx(Co,{size:20,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Points"}),e.jsx("div",{className:"flex items-baseline",children:e.jsx($x,{points:r.totalScore})})]})]})]})}),Bx=({task:r})=>{const t=Es(),s=()=>{if(r.type==="content_approval"){const{contentId:o}=r.metadata;t(`/settings?tab=content&subtab=publishing&review=${o}`)}},n=o=>{switch(o){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"normal":return"bg-blue-100 text-blue-800";case"low":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},a=o=>{switch(o){case"content_approval":return Ne;default:return Ne}},i=o=>{const l=new Date(o),x=new Date().getTime()-l.getTime(),m=Math.floor(x/(1e3*60)),p=Math.floor(x/(1e3*60*60)),f=Math.floor(x/(1e3*60*60*24));return m<1?"Just now":m<60?`${m}m ago`:p<24?`${p}h ago`:f<7?`${f}d ago`:l.toLocaleDateString()},c=o=>{switch(o){case"course":return"Course";case"policy":return"Policy";case"procedure":return"Procedure";case"learning_pathway":return"Learning Pathway";default:return o}};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-gray-300 hover:shadow-sm transition-all duration-200 cursor-pointer",onClick:s,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{path:a(r.type),size:1,className:"text-blue-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:r.title}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${n(r.priority)}`,children:r.priority})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[r.type==="content_approval"&&r.metadata&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:ss,size:.8}),e.jsxs("span",{children:["by ",r.metadata.authorName]})]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:c(r.metadata.contentType)}),e.jsx("span",{children:"•"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:mt,size:.8}),e.jsx("span",{children:i(r.created_at)})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx(C,{path:Et,size:1,className:"text-gray-400"})})]}),r.due_date&&new Date(r.due_date)<new Date&&e.jsx("div",{className:"mt-3 pt-3 border-t border-red-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-red-600",children:[e.jsx(C,{path:mt,size:.8}),e.jsxs("span",{children:["Overdue since ",i(r.due_date)]})]})})]})};var Fx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Cv=()=>{const{currentUser:r}=$e(),[t,s]=u.useState([]),[n,a]=u.useState(!0),[i,c]=u.useState(null);return u.useEffect(()=>{Fx(null,null,function*(){if(r!=null&&r.id)try{a(!0),c(null);const l=yield Uo.getUserTasks(r.id,"pending");s(l)}catch(l){console.error("Error fetching tasks:",l),c(l instanceof Error?l.message:"Failed to load tasks")}finally{a(!1)}})},[r]),n?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pending Tasks"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(o=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]})]})},o))})]}):i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pending Tasks"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-red-600 text-sm",children:["Error loading tasks: ",i]})})]}):t.length===0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pending Tasks"}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:"No pending tasks"}),e.jsx("p",{className:"text-sm text-gray-500",children:"You're all caught up! New tasks will appear here when assigned."})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Pending Tasks (",t.length,")"]}),t.length>0&&e.jsx("span",{className:"text-sm text-gray-500",children:"Click any task to review"})]}),e.jsx("div",{className:"space-y-3",children:t.map(o=>e.jsx(Bx,{task:o},o.id))})]})},Sv=({size:r="lg",message:t="Data Compilation In Progress..."})=>{const s={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},n={sm:"text-sm",md:"text-base",lg:"text-lg"};return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`${s[r]} animate-bounce`,children:e.jsx("div",{className:"text-6xl",children:"🚀"})}),e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"w-1 h-8 bg-gradient-to-t from-orange-400 to-transparent animate-pulse"})})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:`font-semibold text-gray-700 ${n[r]}`,children:t}),e.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Preparing your dashboard for takeoff..."})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})},Mx={"blue-500":"from-blue-500 to-blue-600","green-500":"from-green-500 to-emerald-600","red-500":"from-red-500 to-rose-600","yellow-500":"from-yellow-500 to-orange-500","purple-500":"from-purple-500 to-purple-600","gray-400":"from-gray-400 to-gray-500"},Lx={"blue-200":"border-blue-200","green-200":"border-green-200","red-200":"border-red-200","yellow-200":"border-yellow-200","purple-200":"border-purple-200","gray-200":"border-gray-200"},ms=({title:r,value:t,icon:s,iconBgColor:n,gradientFrom:a,gradientTo:i,borderColor:c,textColor:o,valueColor:l,trend:d})=>{const x=Mx[a]||"from-gray-400 to-gray-500",m=Lx[c]||"border-gray-200";return e.jsxs("div",{className:Ot("bg-gradient-to-br p-4 rounded-lg border",x,m),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${o}`,children:r}),e.jsx("p",{className:`text-2xl font-bold ${l}`,children:t})]}),e.jsx("div",{className:`p-2 ${n} rounded-lg`,children:e.jsx(C,{path:s,size:1.5,className:"text-white"})})]}),d&&e.jsxs("div",{className:`mt-2 flex items-center text-xs ${o}`,children:[e.jsx(C,{path:d.direction==="up"?di:d.direction==="down"?ui:xt,size:.8,className:"mr-1"}),e.jsx("span",{children:d.value})]})]})},zx=({score:r,trend:t})=>{const s=()=>t?t.direction==="up"?"text-green-600":"text-red-600":"text-gray-500",n=()=>t?t.direction==="up"?di:ui:kt;return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-3 mt-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-blue-500 p-1.5 rounded-lg mr-3",children:e.jsx(C,{path:kt,size:1,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-blue-800",children:"Overall Efficiency Trend"}),e.jsxs("p",{className:"text-xl font-bold text-blue-900",children:[r,"%"]})]})]}),t&&e.jsxs("div",{className:`flex items-center text-sm font-medium ${s()}`,children:[e.jsx(C,{path:n(),size:.9,className:"mr-1"}),e.jsx("span",{children:t.value})]})]}),!t&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"No trend data available yet. Complete more cycles to see performance trends."})]})};var qt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Zs=(...r)=>console.log("[useCentralizedInventoryData]",...r);let js=!1;const Tt=Oe()(Fs((r,t)=>({data:null,isLoading:!0,error:null,items:[],tools:[],supplies:[],equipment:[],officeHardware:[],getTools:()=>t().tools,getSupplies:()=>t().supplies,getEquipment:()=>t().equipment,getOfficeHardware:()=>t().officeHardware,getCategories:()=>{const s=t();return Array.from(new Set([...s.tools.map(n=>n.category).filter(n=>n!==null),...s.supplies.map(n=>n.category).filter(n=>n!==null),...s.equipment.map(n=>n.category).filter(n=>n!==null),...s.officeHardware.map(n=>n.category).filter(n=>n!==null)]))},getFilteredData:s=>qt(null,null,function*(){const i=(yield(yield $t.getInstance()).getAllItems()).data||[];return!i||!Array.isArray(i)?[]:i.filter(c=>{var o,l;return((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase()))})}),getFilteredSuppliesData:s=>qt(null,null,function*(){return((yield(yield $t.getInstance()).getAllItems()).data||[]).filter(c=>{var o,l;return c.category==="Supplies"&&(((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase())))})}),getFilteredEquipmentData:s=>qt(null,null,function*(){return((yield(yield $t.getInstance()).getAllItems()).data||[]).filter(c=>{var o,l;return c.category==="Equipment"&&(((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase())))})}),getFilteredOfficeHardwareData:s=>qt(null,null,function*(){return((yield(yield $t.getInstance()).getAllItems()).data||[]).filter(c=>{var o,l;return c.category==="Office Hardware"&&(((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase())))})}),refreshData:()=>qt(null,null,function*(){var s,n,a;if(js){console.log("[useCentralizedInventoryData] Data fetch already in progress, skipping...");return}js=!0,r({isLoading:!0,error:null});try{let i=0;const c=2,o=25;for(;i<c;)try{const x=(yield(yield $t.getInstance()).getAllItems()).data||[],m={tools:x.filter(p=>p.category==="Tools"),supplies:x.filter(p=>p.category==="Supplies"),equipment:x.filter(p=>p.category==="Equipment"),officeHardware:x.filter(p=>p.category==="Office Hardware")};console.log("[useCentralizedInventoryData] Setting state with data:",{allItems:x.length,tools:m.tools.length,supplies:m.supplies.length,equipment:m.equipment.length,officeHardware:m.officeHardware.length}),r({items:x,tools:m.tools,supplies:m.supplies,equipment:m.equipment,officeHardware:m.officeHardware,data:{tools:m.tools,supplies:m.supplies,equipment:m.equipment,officeHardware:m.officeHardware,categories:Array.from(new Set(x.map(p=>p.category).filter(Boolean))),isLoading:!1,error:null},error:null,isLoading:!1}),Zs("✅ single-source applied",{counts:{all:x.length,tools:m.tools.length,supplies:m.supplies.length,equipment:m.equipment.length,officeHardware:m.officeHardware.length}});break}catch(l){if(i++,i>=c)Zs("❌ facade fetch failed after all retries; clearing state",String((s=l==null?void 0:l.message)!=null?s:l)),r({items:[],tools:[],supplies:[],equipment:[],officeHardware:[],error:String((n=l==null?void 0:l.message)!=null?n:l),isLoading:!1});else{Zs(`⚠️ Facade fetch attempt ${i} failed, retrying...`,String((a=l==null?void 0:l.message)!=null?a:l));const d=o*(i+1);yield new Promise(x=>setTimeout(x,d))}}}finally{js=!1}}),clearError:()=>r({error:null}),inventoryData:[],suppliesData:[],equipmentData:[],officeHardwareData:[]}),{name:"centralized-inventory-store",partialize:r=>({tools:r.tools,supplies:r.supplies,equipment:r.equipment,officeHardware:r.officeHardware,items:r.items,data:r.data})})),Ux=()=>{const r=Tt(n=>n.refreshData),t=Tt(n=>n.isLoading),s=Tt(n=>n.data);return Z.useEffect(()=>{if(!t&&!s&&!js){const n=setTimeout(()=>{r()},0);return()=>clearTimeout(n)}},[r,t,s]),{refreshData:r,isLoading:t}};var er=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const qx=()=>{const{getCycleStats:r,biTestResults:t,nextBITestDue:s,activityLog:n,availableTools:a,loadBITestResults:i,loadBIFailureIncidents:c}=W(),{tools:o}=Tt(),[l,d]=u.useState([]),[x,m]=u.useState([]),[p,f]=u.useState(!1),[g,v]=u.useState(null),[j,h]=u.useState(!1),y=!o||o.length===0,b=u.useCallback(()=>er(null,null,function*(){try{console.log("🔄 Manually refreshing BI results...");const T="550e8400-e29b-41d4-a716-446655440000";yield i(T),yield c(T),console.log("✅ BI results refreshed successfully")}catch(T){console.error("❌ Failed to refresh BI results:",T)}}),[i,c]);u.useEffect(()=>{const T=()=>er(null,null,function*(){try{const O="550e8400-e29b-41d4-a716-446655440000";yield i(O),yield c(O)}catch(O){console.error("Failed to load BI activities:",O)}});T();const k=new Date,S=new Date(k);S.setDate(S.getDate()+1),S.setHours(0,0,0,0);const I=S.getTime()-k.getTime(),E=setTimeout(()=>{T(),setInterval(T,1440*60*1e3)},I);return()=>clearTimeout(E)},[i,c]);const _=u.useMemo(()=>{const T=o.length;if(y)return{totalTools:T,activeTools:0,completedToday:0};const k=a.filter(E=>E.currentPhase&&E.currentPhase!=="complete"&&E.currentPhase!=="failed").length,S=new Date,I=a.filter(E=>{if(!E.endTime)return!1;const A=new Date(E.endTime).toDateString()===S.toDateString(),B=E.currentPhase==="complete";return A&&B}).length;return{totalTools:T,activeTools:k,completedToday:I}},[a,o,y]),P=u.useMemo(()=>(console.log("🔍 recentBITests filter:",{isLoading:y,biTestResultsLength:(t==null?void 0:t.length)||0,biTestResults:(t==null?void 0:t.length)>0?t.slice(0,3).map(T=>({status:T.status,date:T.date,passed:T.passed,id:T.id})):"none"}),y||!t||t.length===0?[]:t.filter(T=>{const k=new Date;return k.setDate(k.getDate()-7),new Date(T.date)>=k}).sort((T,k)=>new Date(k.date).getTime()-new Date(T.date).getTime()).slice(0,5)),[t,y]),$=u.useMemo(()=>y||!n||n.length===0?[]:n.map(T=>{var k;const S=Hx(T.time);return{id:T.id,type:T.type,title:T.title,description:(k=T.data)==null?void 0:k.description,time:S,toolCount:T.toolCount,color:T.color,operatorId:T.operatorId,metadata:T.metadata}}),[n,y]),D=u.useCallback(()=>er(null,null,function*(){d([]),m([]),f(!1),h(!0),v(null)}),[]);return u.useEffect(()=>{!y&&a&&t&&n&&!j&&setTimeout(()=>{D().catch(T=>{console.warn("AI insights generation failed (non-blocking):",T)})},0)},[y,a,t,n,D,j]),y?{stats:{totalCycles:0,completedCycles:0,averageCycleTime:0,biPassRate:100,efficiencyScore:{score:0,trend:null},cycleTrend:null,biPassRateTrend:null},additionalMetrics:_,recentBITests:P,nextBITestDue:null,recentActivities:$,aiInsights:[],aiForecasts:[],isAiLoading:!1,aiError:null,generateAIInsights:D,isLoading:!0}:{stats:r(),additionalMetrics:_,recentBITests:P,nextBITestDue:s,refreshBIResults:b,recentActivities:$,aiInsights:l,aiForecasts:x,isAiLoading:p,aiError:g,generateAIInsights:D,isLoading:!1}};function Hx(r){const s=new Date().getTime()-new Date(r).getTime(),n=Math.floor(s/6e4);if(n<1)return"just now";if(n<60)return`${n} minute${n===1?"":"s"} ago`;const a=Math.floor(n/60);if(a<24)return`${a} hour${a===1?"":"s"} ago`;const i=Math.floor(a/24);return`${i} day${i===1?"":"s"} ago`}var an=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Vx=()=>{const{currentUser:r}=$e(),{getCurrentFacilityId:t,isLoading:s}=Rr(),{availableTools:n,setAvailableTools:a,loadCycles:i}=W(),[c,o]=u.useState(!1),[l,d]=u.useState(!1),[x,m]=u.useState(null);return u.useEffect(()=>{an(null,null,function*(){if(!(c||s)){if(!r){console.log("⏳ Waiting for user authentication...");return}try{d(!0),m(null);const f=t();if(!f)throw new Error("User facility not found");const g=yield ai.getAvailableTools(f);a(g),yield i(f),o(!0)}catch(f){console.error("Failed to initialize sterilization store:",f),m(f instanceof Error?f.message:"Unknown error")}finally{d(!1)}}})},[r,c,a,i,t,s]),u.useEffect(()=>{if(c)return;an(null,null,function*(){try{m(null);const f=t();if(!f){console.log("⚠️ No facility ID available, skipping sterilization initialization");return}yield i(f),o(!0),console.log("✅ Sterilization analytics initialized successfully")}catch(f){console.error("Failed to initialize sterilization analytics:",f),m(f instanceof Error?f.message:"Unknown error")}})},[c,i,t]),{isInitialized:c,isLoading:l,error:x,hasData:n.length>0}},Wx=u.lazy(()=>Ve(()=>Promise.resolve().then(()=>Qb),void 0).then(r=>({default:r.RecentActivity}))),Gx=u.lazy(()=>Ve(()=>Promise.resolve().then(()=>Jb),void 0).then(r=>({default:r.BITestResults}))),Kx=u.lazy(()=>Ve(()=>Promise.resolve().then(()=>Zb),void 0).then(r=>({default:r.ToolStatus}))),tr=()=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg mb-4"}),e.jsx("div",{className:"h-24 bg-gray-200 rounded-lg"})]}),_v=()=>{var r,t;const[s,n]=u.useState(!0),{isLoading:a,error:i}=Vx(),{stats:c,additionalMetrics:o,recentBITests:l,nextBITestDue:d,recentActivities:x,refreshBIResults:m}=qx();return u.useEffect(()=>{const p=setTimeout(()=>{n(!0)},100);return()=>clearTimeout(p)},[]),a||!s?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[e.jsx(C,{path:kt,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),e.jsx("div",{className:"text-sm text-gray-500",children:i?"Error loading data":"Loading..."})]}),i&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm",children:i}),e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((p,f)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},f))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[...Array(3)].map((p,f)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},f))})]})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[e.jsx(C,{path:kt,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]}),e.jsx(zx,{score:((r=c.efficiencyScore)==null?void 0:r.score)||0,trend:(t=c.efficiencyScore)==null?void 0:t.trend}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(ms,{title:"Total Cycles",value:c.totalCycles,icon:Ns,iconBgColor:"bg-blue-500",gradientFrom:"blue-50",gradientTo:"blue-100",borderColor:"blue-200",textColor:"text-blue-600",valueColor:"text-blue-800",trend:c.cycleTrend}),e.jsx(ms,{title:"Completed Cycles",value:c.completedCycles,icon:Se,iconBgColor:"bg-green-500",gradientFrom:"green-50",gradientTo:"green-100",borderColor:"green-200",textColor:"text-green-600",valueColor:"text-green-800",trend:c.cycleTrend}),e.jsx(ms,{title:"Tool Turnaround Time",value:`${Math.round(c.averageCycleTime)} min`,icon:mt,iconBgColor:"bg-purple-500",gradientFrom:"purple-50",gradientTo:"purple-100",borderColor:"purple-200",textColor:"text-purple-600",valueColor:"text-purple-800",trend:{direction:"down",value:"Target: <60 min"}}),e.jsx(ms,{title:"BI Pass Rate",value:`${Math.round(c.biPassRate)}%`,icon:Ee,iconBgColor:"bg-orange-500",gradientFrom:"orange-50",gradientTo:"orange-100",borderColor:"orange-200",textColor:"text-orange-600",valueColor:"text-orange-800",trend:c.biPassRateTrend})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(u.Suspense,{fallback:e.jsx(tr,{}),children:e.jsx(Wx,{activities:x})}),e.jsx(u.Suspense,{fallback:e.jsx(tr,{}),children:e.jsx(Gx,{recentTests:l,nextTestDue:d,refreshBIResults:m})}),e.jsx(u.Suspense,{fallback:e.jsx(tr,{}),children:e.jsx(Kx,{totalTools:o.totalTools,activeTools:o.activeTools,completedToday:o.completedToday})})]})]})};var Qx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Ei=Oe((r,t)=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,setBiTestCompleted:s=>r({biTestCompleted:s}),setBiTestDate:s=>r({biTestDate:s}),setNextBITestDue:s=>r({nextBITestDue:s}),setLastBITestDate:s=>r({lastBITestDate:s}),setBiTestPassed:s=>r({biTestPassed:s}),setBiTestOptedOut:s=>r({biTestOptedOut:s}),setBiTestInProgress:s=>r({biTestInProgress:s}),setEnforceBI:s=>r({enforceBI:s}),setEnforceCI:s=>r({enforceCI:s}),setAllowOverrides:s=>r({allowOverrides:s}),resetBIState:()=>r({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1}),recordBITestResult:s=>Qx(null,null,function*(){console.log("🔬 Clean BI Store: recordBITestResult called with:",s);try{const{data:{user:n},error:a}=yield K.auth.getUser();if(a||!n)throw new Error("User not authenticated");const i="550e8400-e29b-41d4-a716-446655440000",c={facility_id:i,operator_id:n.id,test_date:new Date().toISOString(),result:s.status==="pending"?"pass":s.status,bi_lot_number:"DEFAULT-001",bi_expiry_date:new Date(Date.now()+365*24*60*60*1e3).toISOString(),incubation_time_minutes:60,incubation_temperature_celsius:37,test_conditions:{room_temperature_celsius:22,humidity_percent:45,equipment_used:"Default Equipment",operator:n.id,operator_id:n.id,facility_id:i,test_date:new Date().toISOString()},failure_reason:s.status==="fail"?"BI test failed":void 0,skip_reason:s.status==="skip"?"BI test skipped":void 0,compliance_notes:s.status==="pass"?"BI test passed":void 0,cycle_id:"00000000-0000-0000-0000-000000000000",test_number:`BI-${Date.now()}`},{error:o}=yield K.from("bi_test_results").insert(c);if(o)throw o;const l=new Date;l.setDate(l.getDate()+1),r(d=>({biTestResults:[...d.biTestResults,s],biTestCompleted:s.passed,biTestDate:s.date.toISOString(),lastBITestDate:s.date.toISOString(),nextBITestDue:l,biTestPassed:s.passed})),console.log("🔬 Clean BI Store: State updated successfully"),console.log("🔬 Clean BI Store: lastBITestDate set to:",s.date.toISOString())}catch(n){console.error("🔬 Clean BI Store: Error recording BI test result:",n);const a=new Date;throw a.setDate(a.getDate()+1),r(i=>({biTestResults:[...i.biTestResults,s],biTestCompleted:s.passed,biTestDate:s.date.toISOString(),lastBITestDate:s.date.toISOString(),nextBITestDue:a,biTestPassed:s.passed})),console.log("🔬 Clean BI Store: State updated despite error"),n}})})),Yx=({quarantineData:r})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(C,{path:ut,size:1,className:"text-gray-600"}),e.jsx("h3",{className:"font-medium text-gray-800",children:"Quarantine Summary"})]}),r.lastPassedDate&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:ns,size:.8,className:"text-blue-600"}),e.jsx("h4",{className:"font-medium text-blue-800 text-sm",children:"Last Successful BI Test"})]}),e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx("strong",{children:"Date:"})," ",r.lastPassedDate.toLocaleDateString()," at"," ",r.lastPassedDate.toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.totalToolsAffected}),e.jsx("div",{className:"text-gray-600",children:"Tools Affected"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.totalCyclesAffected}),e.jsx("div",{className:"text-gray-600",children:"Cycles Affected"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r.uniqueOperators.length}),e.jsx("div",{className:"text-gray-600",children:"Operators Involved"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.hasCurrentCycleAffected?"Yes":"No"}),e.jsx("div",{className:"text-gray-600",children:"Current Cycle Affected"})]})]}),r.dateRange&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:Ar,size:.8,className:"text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800 text-sm",children:"Affected Date Range"})]}),e.jsxs("p",{className:"text-xs text-yellow-700",children:[e.jsx("strong",{children:"From:"})," ",r.dateRange.start.toLocaleDateString()," ",e.jsx("strong",{children:"To:"})," ",r.dateRange.end.toLocaleDateString()]})]}),Object.keys(r.toolsByCategory).length>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Tools by Category:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:Object.entries(r.toolsByCategory).map(([t,s])=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-gray-600",children:t}),e.jsx("span",{className:"font-semibold text-gray-800",children:s})]},t))})]})]}),Jx=({affectedCycles:r})=>r.length===0?null:e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Cycles:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:e.jsxs("div",{className:"space-y-2 text-xs",children:[r.slice(0,5).map((t,s)=>e.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.cycleNumber||`Cycle ${s+1}`}),e.jsxs("div",{className:"text-gray-500",children:[new Date(t.startTime).toLocaleDateString()," -"," ",t.operator]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-500",children:[e.jsxs("div",{children:[t.tools.length," tools"]}),e.jsxs("div",{children:[t.phases.length," phases"]})]})]})},t.id)),r.length>5&&e.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",r.length-5," more cycles affected"]})]})})]});var Oi=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Xx=r=>Oi(null,null,function*(){try{const t=yield qo.getMostRecentBatchForTool(r);return t||null}catch(t){return console.error("Failed to get batch info for tool:",t),null}}),Zx=({affectedTools:r})=>{const{availableTools:t}=W(),[s,n]=u.useState(new Map),[a,i]=u.useState(!1);u.useEffect(()=>{Oi(null,null,function*(){if(r.length!==0){i(!0);try{const l=new Map;for(const d of r){const x=yield Xx(d.id);x&&l.set(d.id,x)}n(l)}catch(l){console.error("Failed to load batch info:",l)}finally{i(!1)}}})},[r]);const c=o=>{const l=t.find(d=>d.id===o);return l?{id:l.id,name:l.name,barcode:l.barcode,category:l.category,type:l.type||"Unknown",cycleCount:l.cycleCount||0,lastSterilized:l.lastSterilized,status:l.status,cycleId:l.cycleId}:{id:o,name:`Tool ${o}`,barcode:o,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:null,status:"unknown",cycleId:void 0}};return r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Tool Details:"}),e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200 max-h-32 overflow-hidden",children:e.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs",children:[r.slice(0,6).map((o,l)=>{const d=c(o.id),x=s.get(o.id),m=(x==null?void 0:x.batchName)||"Batch Info Pending",p=x==null?void 0:x.cycleName,f=x==null?void 0:x.status,g=[`Tool: ${d.name}`,`Barcode: ${d.barcode}`,`Category: ${d.category}`,`Type: ${d.type}`,`Cycle Count: ${d.cycleCount}`,`Status: ${d.status}`,`Batch: ${m}`,...p?[`Cycle: ${p}`]:[],...f?[`Batch Status: ${f}`]:[]].join(`
`);return e.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700 hover:bg-gray-200 transition-colors cursor-help",title:g,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:d.name}),e.jsxs("div",{className:"text-gray-500 text-xs",children:["#",d.barcode]}),e.jsx("div",{className:"text-orange-600 text-xs font-medium",children:a?"Loading Batch...":`Batch: ${m}`}),p&&e.jsxs("div",{className:"text-blue-600 text-xs",children:["Cycle: ",p]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-500",children:[e.jsx("div",{children:d.category}),e.jsxs("div",{children:["Cycles: ",d.cycleCount]}),f&&e.jsx("div",{className:`text-xs ${f==="completed"?"text-green-600":f==="failed"?"text-red-600":f==="in_cycle"?"text-blue-600":"text-gray-600"}`,children:f})]})]})},l)}),r.length>6&&e.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",r.length-6," more tools affected"]})]})})})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-600",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," Hover over tools for detailed information. All tools must be quarantined and re-sterilized."]})})]})},ep=({totalToolsAffected:r})=>e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Required Actions"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("span",{children:["Quarantine all ",r," affected tools immediately"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:"Re-sterilize all quarantined tools"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:"Perform a new BI test after re-sterilization"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:"Contact supervisor for incident documentation"})]})]})]}),tp=({operatorName:r,totalToolsAffected:t,totalCyclesAffected:s})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:Ar,size:1,className:"text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Operator Confirmation"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:r}),", by confirming this BI test failure, you acknowledge that:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{children:["• All ",t," affected tools will be quarantined"]}),e.jsxs("li",{children:["• ",s," sterilization cycles are affected"]}),e.jsx("li",{children:"• A compliance incident report will be generated"}),e.jsx("li",{children:"• Re-sterilization procedures must be followed"})]})]}),sp=({onCancel:r})=>e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-red-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(C,{path:mi,size:1.5,className:"text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800",children:"BI Test Failure - Critical Alert"}),e.jsx("p",{className:"text-sm text-red-600",children:"Sterilization process failure detected"})]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-red-100 rounded-lg transition-colors",children:e.jsx(C,{path:ae,size:1,className:"text-red-600"})})]}),rp=()=>e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800 mb-2",children:"Immediate Action Required"}),e.jsx("p",{className:"text-sm text-red-700",children:"A Biological Indicator test failure indicates that the sterilization process may not have been effective. All tools processed since the last successful BI test must be quarantined and re-sterilized."})]})]})}),ap=({isOpen:r,onConfirm:t,onCancel:s,operatorName:n})=>{const a=Fr();return r?Ds.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:s,onKeyDown:i=>{i.key==="Escape"&&s()},role:"button",tabIndex:0,"aria-label":"Close modal"}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsx(sp,{onCancel:s}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto bi-modal-scrollbar-hide",children:[e.jsx(rp,{}),e.jsx(Yx,{quarantineData:a}),e.jsx(Jx,{affectedCycles:a.affectedCycles}),e.jsx(Zx,{affectedTools:a.affectedTools}),e.jsx(ep,{totalToolsAffected:a.totalToolsAffected}),e.jsx(tp,{operatorName:n,totalToolsAffected:a.totalToolsAffected,totalCyclesAffected:a.totalCyclesAffected})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:t,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Confirm BI Test Failure"})]})]})]}),document.body):null},np=({isVisible:r,onComplete:t,onOptOut:s,onDismiss:n})=>{const[a,i]=u.useState(!1),[c,o]=u.useState(null),{enforceBI:l}=Ei(),{currentCycle:d}=W(),x=Fr();if(!r||!l)return null;const m=g=>{if(console.log("🔬 BITestBanner: Button clicked:",g),g==="fail"){o(g),i(!0);return}const v={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:g==="pass",date:new Date,status:g,operator:(d==null?void 0:d.operator)||"Operator"};g==="skip"&&s(),console.log("🔬 BITestBanner: Calling onComplete with:",v),t(v)},p=()=>{if(i(!1),c){const g={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:!1,date:new Date,status:"fail",operator:(d==null?void 0:d.operator)||"Operator"},{activateBIFailure:v}=W.getState(),j=x.totalToolsAffected,h=x.affectedCycles.map(y=>y.batchId).filter(y=>!!y);v({affectedToolsCount:j,affectedBatchIds:h,operator:(d==null?void 0:d.operator)||"Operator"}),t(g)}o(null)},f=()=>{i(!1),o(null)};return e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 mb-4 rounded-r-lg shadow-sm",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg flex-shrink-0",children:e.jsx(C,{path:Ee,size:1.2,className:"text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800",children:"Daily BI Test Required"}),e.jsxs("span",{className:"text-sm text-orange-600",children:["(",new Date().toLocaleDateString(),")"]})]}),e.jsx("p",{className:"text-orange-700 text-sm mb-3",children:"Please complete the daily Biological Indicator test to ensure sterilization compliance."}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>m("pass"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-green-300 hover:border-green-500 bg-green-50 hover:bg-green-100 text-green-800 transition-colors",children:[e.jsx(C,{path:Se,size:1,className:"text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PASS"})]}),e.jsxs("button",{onClick:()=>m("fail"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-red-300 hover:border-red-500 bg-red-50 hover:bg-red-100 text-red-800 transition-colors",children:[e.jsx(C,{path:ce,size:1,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"FAIL"})]}),e.jsxs("button",{onClick:()=>m("skip"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-gray-300 hover:border-gray-500 bg-gray-50 hover:bg-gray-100 text-gray-800 transition-colors",children:[e.jsx(C,{path:Ee,size:1,className:"text-gray-600"}),e.jsx("span",{className:"text-sm font-medium",children:"SKIP"})]})]})]})]})}),e.jsx(ap,{isOpen:a,onConfirm:p,onCancel:f,operatorName:(d==null?void 0:d.operator)||"Operator"})]})},lp=r=>{if(!r)return!0;const t=new Date().toDateString();return new Date(r).toDateString()!==t};class at{static getTabs(){return[{id:"timers",label:"Phase Timers",icon:vr},{id:"analytics",label:"Analytics",icon:kt},{id:"logs",label:"Cleaning Logs",icon:Ne}]}static getCycleProgressInfo(t){const s=t.phases.some(a=>a.status==="active"),n=t.phases.map(a=>({id:a.id,name:a.name,status:a.status,toolCount:a.tools.length,statusColor:this.getPhaseStatusColor(a.status)}));return{hasActivePhase:s,phaseStatuses:n}}static getPhaseStatusColor(t){switch(t){case"completed":return"bg-green-500";case"active":return"bg-blue-500";case"failed":return"bg-red-500";default:return"bg-gray-300"}}static validateOperatorName(t){return t.trim().length>0}static getTabButtonClasses(t){return t?"bg-[#4ECDC4] text-white shadow-md":"text-gray-600 hover:text-[#4ECDC4] hover:bg-gray-50"}static getStartCycleButtonState(t){const s=!this.validateOperatorName(t),n=this.validateOperatorName(t)?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-gray-300 text-gray-500 cursor-not-allowed";return{disabled:s,className:n}}static shouldShowNoCycleMessage(t){return!t}static shouldShowActiveCycleInfo(t){return t.phases.some(s=>s.status==="active")}}const ip=()=>{const{currentCycle:r}=W();u.useRef(performance.now());const t=u.useMemo(()=>at.getTabs(),[]),s=u.useMemo(()=>r?at.getCycleProgressInfo(r):null,[r]),n=u.useCallback(l=>at.validateOperatorName(l),[]),a=u.useCallback(l=>at.getTabButtonClasses(l),[]),i=u.useCallback(l=>at.getStartCycleButtonState(l),[]),c=u.useCallback(()=>at.shouldShowNoCycleMessage(r),[r]),o=u.useCallback(()=>r?at.shouldShowActiveCycleInfo(r):!1,[r]);return u.useMemo(()=>{},[]),{tabs:t,cycleProgressInfo:s,validateOperatorName:n,getTabButtonClasses:a,getStartCycleButtonState:i,shouldShowNoCycleMessage:c,shouldShowActiveCycleInfo:o}},op=()=>{const[r,t]=u.useState("timers"),[s,n]=u.useState(!1),[a,i]=u.useState(""),c=u.useCallback(p=>{(p==="timers"||p==="analytics"||p==="logs")&&t(p)},[]),o=u.useCallback(p=>{i(p.target.value)},[]),l=u.useCallback(p=>{p.key},[]),d=u.useCallback(()=>{n(!1),i("")},[]),x=u.useCallback(()=>{n(!0)},[]),m=u.useCallback(()=>{i("")},[]);return{activeTab:r,showNewCycleModal:s,operatorName:a,handleTabChange:c,handleOperatorNameChange:o,handleOperatorNameKeyPress:l,handleCloseNewCycleModal:d,openNewCycleModal:x,resetOperatorName:m}},$i=u.memo(()=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Sterilization Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Manage sterilization cycles, track tools, and monitor performance"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsx("span",{className:"text-gray-600",children:"Tool Scanner"}),e.jsxs(Zl,{to:"/sterilization/scanner",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center gap-2",children:[e.jsx(C,{path:It,size:1}),"Scan Tool"]})]})]}));$i.displayName="DashboardHeader";var cp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class Ce{static fetchCleaningLogs(){return cp(this,null,function*(){try{const{data:t,error:s}=yield K.from("sterilization_cycles").select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching sterilization cycles:",s),s;return(t||[]).map(a=>({id:a.id,room_id:a.id,room_name:`Cycle ${a.id.slice(0,8)}`,status:a.status||"in_progress",cleaning_type:"sterilization",scheduled_time:a.start_time,started_time:a.start_time,completed_time:a.end_time,operator_id:a.operator_id,notes:"",checklist_items:[],completed_items:[],failed_items:[],created_at:a.created_at,updated_at:a.updated_at}))}catch(t){return console.error("Failed to fetch sterilization cycles:",t),[]}})}static filterCleaningLogs(t,s){return t.filter(n=>{let a=!1;s.status==="all"?a=!0:s.status==="in_progress"?a=n.status==="pending"||n.status==="in_progress":a=n.status===s.status;const i=!s.date||new Date(n.created_at).toDateString()===new Date(s.date).toDateString();return a&&i})}static calculateStats(t){return{totalCycles:t.length,completed:t.filter(s=>s.status==="completed").length,failed:t.filter(s=>s.status==="failed").length,totalTools:t.length}}static getStatusColor(t){switch(t){case"completed":return{color:"text-green-600 bg-green-100"};case"verified":return{color:"text-blue-600 bg-blue-100"};case"failed":return{color:"text-red-600 bg-red-100"};case"in_progress":return{color:"text-yellow-600 bg-yellow-100"};case"pending":return{color:"text-gray-600 bg-gray-100"};case"cancelled":return{color:"text-orange-600 bg-orange-100"};default:return{color:"text-gray-600 bg-gray-100"}}}static formatDuration(t,s){if(!s)return"In Progress";const n=new Date(t),i=new Date(s).getTime()-n.getTime(),c=Math.floor(i/(1e3*60)),o=Math.floor(c/60),l=c%60;return`${o}h ${l}m`}static getBITestResultsForCycle(t,s){return t.filter(n=>{const a=new Date(s);return new Date(n.date).toDateString()===a.toDateString()})}static getBITestResultColor(t){return t==="pass"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}static formatTestTime(t){return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static getCleaningTypeDisplayName(t){switch(t){case"routine":return"Routine";case"deep_clean":return"Deep Clean";case"emergency":return"Emergency";case"post_procedure":return"Post Procedure";default:return t}}static getQualityScoreDisplay(t){return t?`${Math.round(t*100)}%`:"N/A"}static getComplianceScoreDisplay(t){return t?`${Math.round(t*100)}%`:"N/A"}static filterCycles(t,s){return Array.isArray(t)?t.filter(n=>{const a=s.status?n.status===s.status:!0;let i=!0;if(s.date){const c=new Date(s.date);isNaN(c.getTime())||(i=new Date(n.start_time).toDateString()===c.toDateString())}return a&&i}):[]}static calculateFailedCycles(t){return Array.isArray(t)?t.filter(s=>{var n;return((n=s.status)==null?void 0:n.toLowerCase())==="failed"}).length:0}static exportToCSV(t){if(!t||t.length===0){alert("No data to export");return}try{const s=["Cycle ID","Room Name","Status","Cleaning Type","Scheduled Time","Started Time","Completed Time","Operator ID","Notes","Created At","Updated At"],n=t.map(l=>[l.id,l.room_name,l.status,l.cleaning_type,l.scheduled_time||"",l.started_time||"",l.completed_time||"",l.operator_id||"",l.notes||"",l.created_at,l.updated_at]),a=[s.join(","),...n.map(l=>l.map(d=>`"${d}"`).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),c=window.URL.createObjectURL(i),o=document.createElement("a");o.href=c,o.download=`cleaning_logs_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(c)}catch(s){console.error("Failed to export cleaning logs:",s),alert("Failed to export data. Please try again.")}}}var dp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const up=({filterStatus:r,filterDate:t})=>{const{biTestResults:s}=W(),[n,a]=u.useState([]),[i,c]=u.useState(!0),[o,l]=u.useState(null);u.useEffect(()=>{dp(null,null,function*(){try{c(!0),l(null);const P=yield Ce.fetchCleaningLogs();a(P)}catch(P){console.error("Failed to fetch cleaning logs:",P),l("Failed to load cleaning logs")}finally{c(!1)}})},[]);const d=u.useMemo(()=>{const _={status:r,date:t};return Ce.filterCleaningLogs(n,_)},[n,r,t]),x=u.useMemo(()=>Ce.calculateStats(d),[d]);return{filteredLogs:d,stats:x,loading:i,error:o,getStatusColor:_=>Ce.getStatusColor(_).color,formatDuration:(_,P)=>Ce.formatDuration(_,P),getBITestResultsForCycle:_=>Ce.getBITestResultsForCycle(s,_),getBITestResultColor:_=>Ce.getBITestResultColor(_),formatTestTime:_=>Ce.formatTestTime(_),getCleaningTypeDisplayName:_=>Ce.getCleaningTypeDisplayName(_),getQualityScoreDisplay:_=>Ce.getQualityScoreDisplay(_),getComplianceScoreDisplay:_=>Ce.getComplianceScoreDisplay(_),exportLogs:()=>{Ce.exportToCSV(d)}}},mp=()=>{const[r,t]=u.useState(null),[s,n]=u.useState("all"),[a,i]=u.useState(""),{filteredLogs:c,stats:o,loading:l,error:d,getStatusColor:x,formatDuration:m,getBITestResultsForCycle:p,getBITestResultColor:f,formatTestTime:g,getQualityScoreDisplay:v,getComplianceScoreDisplay:j}=up({filterStatus:s,filterDate:a});return l?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(C,{path:Or,size:2,className:"animate-spin text-[#4ECDC4] mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading cleaning logs..."})]})}):d?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(C,{path:ce,size:2,className:"text-red-500 mr-3"}),e.jsx("span",{className:"text-red-600",children:d})]})}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[e.jsx(C,{path:Ne,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Cleaning Log Tracker"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>{console.warn("⚠️ Export not yet implemented.")},disabled:!0,className:"flex items-center gap-2 px-3 py-2 bg-gray-400 text-white rounded-lg opacity-70 cursor-not-allowed","aria-disabled":"true",children:[e.jsx(C,{path:As,size:1}),"Export (Coming Soon)"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Filter"}),e.jsxs("select",{id:"status-filter",value:s,onChange:h=>n(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Filter"}),e.jsx("input",{id:"date-filter",type:"date",value:a,onChange:h=>i(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{n("all"),i("")},className:"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear Filters"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-800",children:o.completed})]}),e.jsx(C,{path:Se,size:1.5,className:"text-green-500"})]})}),e.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-800",children:o.failed})]}),e.jsx(C,{path:ce,size:1.5,className:"text-red-500"})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Cycles"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:o.totalTools})]}),e.jsx(C,{path:Me,size:1.5,className:"text-purple-500"})]})})]}),e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No sterilization cycles found for the selected filters."}):c.map(h=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:h.room_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x(h.status)}`,children:h.status.toUpperCase()}),e.jsx("span",{className:"text-sm text-gray-500",children:"Sterilization Cycle"})]}),e.jsxs("button",{onClick:()=>t(r===h.id?null:h.id),className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(C,{path:Pt,size:1}),r===h.id?"Hide":"View"," Details"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:ze,size:1}),e.jsxs("span",{children:["Scheduled:"," ",new Date(h.scheduled_time).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:mt,size:1}),e.jsxs("span",{children:["Duration:"," ",m(h.started_time||h.scheduled_time,h.completed_time)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:ss,size:1}),e.jsxs("span",{children:["Room ID: ",h.room_id]})]})]}),r===h.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Quality Metrics"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Quality Score:"}),e.jsx("span",{className:"font-medium",children:v(h.quality_score)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Compliance Score:"}),e.jsx("span",{className:"font-medium",children:j(h.compliance_score)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Timeline"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Scheduled:"}),e.jsx("span",{children:new Date(h.scheduled_time).toLocaleString()})]}),h.started_time&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Started:"}),e.jsx("span",{children:new Date(h.started_time).toLocaleString()})]}),h.completed_time&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Completed:"}),e.jsx("span",{children:new Date(h.completed_time).toLocaleString()})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(C,{path:Ee,size:1}),"BI Test Results"]}),e.jsxs("div",{className:"space-y-2",children:[p(h.created_at).map((y,b)=>e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${f(y.passed?"pass":"fail")}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:y.passed?"PASS":"FAIL"}),e.jsx("span",{children:g(new Date(y.date))})]})},b)),p(h.created_at).length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No BI tests for this date"})]})]})]})]},h.id))})]})};var xp=Object.defineProperty,pp=Object.defineProperties,hp=Object.getOwnPropertyDescriptors,nn=Object.getOwnPropertySymbols,gp=Object.prototype.hasOwnProperty,fp=Object.prototype.propertyIsEnumerable,ln=(r,t,s)=>t in r?xp(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,ee=(r,t)=>{for(var s in t||(t={}))gp.call(t,s)&&ln(r,s,t[s]);if(nn)for(var s of nn(t))fp.call(t,s)&&ln(r,s,t[s]);return r},re=(r,t)=>pp(r,hp(t)),bp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const as=Oe((r,t)=>({timers:{},overexposed:!1,intervals:{},startTimer:(s,n,a)=>{const i=t().intervals[s];i&&clearInterval(i),r(o=>({timers:re(ee({},o.timers),{[s]:{id:s,timeRemaining:a?a.timeRemaining:s==="drying"?0:n,elapsedTime:a?a.elapsedTime:0,duration:n,isRunning:!0,overexposed:!1}})}));const c=setInterval(()=>{const o=t().timers[s];if(o&&o.isRunning)if(s==="drying"){const l=o.elapsedTime+1;r(d=>({timers:re(ee({},d.timers),{[s]:re(ee({},o),{elapsedTime:l})})}))}else{const l=o.elapsedTime+1;if(o.timeRemaining>0){const d=o.timeRemaining-1;r(x=>({timers:re(ee({},x.timers),{[s]:re(ee({},o),{timeRemaining:d,elapsedTime:l,overexposed:!1})})}))}else{const d=s==="bath1"||s==="bath2",x=d?o.elapsedTime-o.duration:0;r(m=>({timers:re(ee({},m.timers),{[s]:re(ee({},o),{timeRemaining:0,elapsedTime:l,overexposed:d&&x>0})}),overexposed:d&&x>0||m.overexposed})),s==="autoclave"&&o.elapsedTime===o.duration&&t().triggerRoomAssignment()}}},1e3);r(o=>({intervals:re(ee({},o.intervals),{[s]:c})}))},pauseTimer:s=>{const n=t().intervals[s];n&&(clearInterval(n),r(a=>{const i=ee({},a.intervals);return delete i[s],{intervals:i}})),r(a=>({timers:re(ee({},a.timers),{[s]:a.timers[s]?re(ee({},a.timers[s]),{isRunning:!1}):a.timers[s]})}))},resetTimer:s=>{const n=t().intervals[s];n&&(clearInterval(n),r(a=>{const i=ee({},a.intervals);return delete i[s],{intervals:i}})),r(a=>({timers:re(ee({},a.timers),{[s]:a.timers[s]?re(ee({},a.timers[s]),{timeRemaining:s==="drying"?0:a.timers[s].duration,elapsedTime:0,isRunning:!1,overexposed:!1}):a.timers[s]})}))},updateTimer:(s,n)=>{r(a=>({timers:re(ee({},a.timers),{[s]:a.timers[s]?re(ee({},a.timers[s]),{timeRemaining:n}):a.timers[s]})}))},getTimer:s=>t().timers[s],resumeTimer:s=>{const n=t().timers[s];if(!n)return;const a=t().intervals[s];a&&clearInterval(a),r(c=>({timers:re(ee({},c.timers),{[s]:re(ee({},n),{isRunning:!0})})}));const i=setInterval(()=>{const c=t().timers[s];if(c&&c.isRunning)if(s==="drying"){const o=c.elapsedTime+1;r(l=>({timers:re(ee({},l.timers),{[s]:re(ee({},c),{elapsedTime:o})})}))}else{const o=c.elapsedTime+1;if(c.timeRemaining>0){const l=c.timeRemaining-1;r(d=>({timers:re(ee({},d.timers),{[s]:re(ee({},c),{timeRemaining:l,elapsedTime:o,overexposed:!1})})}))}else{const l=s==="bath1"||s==="bath2",d=l?c.elapsedTime-c.duration:0;r(x=>({timers:re(ee({},x.timers),{[s]:re(ee({},c),{timeRemaining:0,elapsedTime:o,overexposed:l&&d>0})}),overexposed:l&&d>0||x.overexposed})),s==="autoclave"&&c.elapsedTime===c.duration&&t().triggerRoomAssignment()}}},1e3);r(c=>({intervals:re(ee({},c.intervals),{[s]:i})}))},setOverexposed:s=>{r({overexposed:s})},triggerRoomAssignment:()=>{const s=document.createElement("div");s.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",s.innerHTML=`
      <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h2 class="text-lg font-semibold mb-4">Room Assignment Required</h2>
        <p class="text-sm text-gray-600 mb-4">Autoclave cycle completed. Please scan the location barcode where these tools will be stored.</p>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Location Barcode</label>
            <input 
              id="locationBarcode" 
              type="text" 
              placeholder="Scan or enter location barcode" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div class="flex space-x-3">
            <button 
              id="assignLocation" 
              class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              Assign Location
            </button>
            <button 
              id="skipLocation" 
              class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500"
            >
              Skip
            </button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(s);const n=s.querySelector("#assignLocation"),a=s.querySelector("#skipLocation"),i=s.querySelector("#locationBarcode"),c=()=>bp(null,null,function*(){const l=i.value.trim();if(!l){alert("Please enter a location barcode");return}try{const d=localStorage.getItem("currentBatchId");if(!d){alert("No active batch found");return}const x=yield ni({batchId:d,toolsCount:1,assignedLocation:l});if(x.status==="invalid_location"){alert(`Invalid location: ${x.reasoning}`);return}const{supabase:m}=yield Ve(()=>Promise.resolve().then(()=>Ec),void 0);yield m.from("sterilization_batches").update({location_barcode:l}).eq("id",d),yield m.from("inventory_items").update({scanned_location:l}).eq("batch_id",d),alert(`✅ Location ${l} assigned successfully`),document.body.removeChild(s)}catch(d){console.error("Error assigning location:",d),alert("Error assigning location. Please try again.")}}),o=()=>{document.body.removeChild(s)};n==null||n.addEventListener("click",c),a==null||a.addEventListener("click",o),setTimeout(()=>i==null?void 0:i.focus(),100)}})),yp={unwrapped:{name:"Unwrapped",temp:"132°C (270°F)",sterilizeTime:3,dryTime:30,totalTime:15,duration:900},pouches:{name:"Pouches",temp:"132°C (270°F)",sterilizeTime:5,dryTime:30,totalTime:17,duration:1020},packs:{name:"Packs",temp:"121°C (250°F)",sterilizeTime:30,dryTime:30,totalTime:40,duration:2400},handpieces:{name:"Handpieces",temp:"132°C (270°F)",sterilizeTime:6,dryTime:30,totalTime:16,duration:960}},vp=()=>"pouches";var jp=Object.defineProperty,wp=Object.defineProperties,Np=Object.getOwnPropertyDescriptors,on=Object.getOwnPropertySymbols,Cp=Object.prototype.hasOwnProperty,Sp=Object.prototype.propertyIsEnumerable,cn=(r,t,s)=>t in r?jp(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,dn=(r,t)=>{for(var s in t||(t={}))Cp.call(t,s)&&cn(r,s,t[s]);if(on)for(var s of on(t))Sp.call(t,s)&&cn(r,s,t[s]);return r},un=(r,t)=>wp(r,Np(t));const _p=()=>{const{timers:r,startTimer:t,pauseTimer:s,resetTimer:n,resumeTimer:a}=as(),{currentCycle:i,setCurrentCycle:c}=W(),o=u.useCallback((x,m)=>{t(x,m)},[t]),l=u.useCallback(x=>{const m=r[x];m!=null&&m.isRunning?s(x):m&&a(x)},[r,s,a]),d=u.useCallback(x=>{if(console.log("🛑 Cancelling timer for phase:",x),s(x),n(x),i){console.log("🛑 Clearing tools from cycle. Current tools:",i.tools);const m=un(dn({},i),{tools:[],phases:i.phases.map(p=>un(dn({},p),{tools:[],isActive:!1,status:"pending",startTime:null,endTime:null}))});c(m),console.log("✅ Cycle cleared, tools removed. Workflow can be restarted.")}},[s,n,i,c]);return{handleStartTimer:o,handlePauseTimer:l,handleStopTimer:d}},Tp=()=>{const{startTimer:r,pauseTimer:t,resetTimer:s}=as(),{currentCycle:n,moveToolToNextPhase:a,updateToolStatus:i,addActivity:c}=W(),{currentUser:o}=$e();return{handleMoveToNextPhase:u.useCallback(d=>{if(console.log(`🔄 Starting phase transition from ${d}`),!o){console.log("❌ User authentication required for phase transitions"),alert("Please log in to perform sterilization phase transitions");return}if(!n){console.log("❌ No active cycle found");return}const x=n.tools.some(g=>{const v=W.getState().availableTools.find(j=>j.id===g);return v==null?void 0:v.isP2Status});if(d==="drying"&&x){console.log("✅ Completing P2 Status tools after drying phase"),n.tools.forEach(g=>{const v=W.getState().availableTools.find(j=>j.id===g);if(v!=null&&v.isP2Status){const j=W.getState();j.incrementToolCycleCount&&j.incrementToolCycleCount(g),console.log(`Tool ${g} status updated to complete`),ue.monitorToolStatusChange(g,"drying","complete"),console.log(`✅ P2 Status tool ${v.name} completed and cycle count incremented`)}}),t(d),s(d);return}const m=["bath1","bath2","airDry","autoclave"],p=m.indexOf(d),f=m[p+1];if(f){console.log(`🔄 Moving tools from ${d} to ${f}`),n.tools.forEach(v=>{const j=W.getState().availableTools.find(h=>h.id===v);j&&(a(v),console.log(`Tool ${v} status updated to ${f}`),console.log(`✅ Moved tool ${j.name} from ${d} to ${f}`))}),t(d),s(d);const g=Ni[f];g&&r(f,g.duration),console.log(`✅ Phase transition completed: ${d} → ${f}`)}else{console.log("✅ Completing all tools after autoclave phase");const g=[];n.tools.forEach(v=>{const j=W.getState().availableTools.find(h=>h.id===v);if(j){const h=W.getState();h.incrementToolCycleCount&&h.incrementToolCycleCount(v),console.log(`Tool ${v} status updated to complete`),ue.monitorToolStatusChange(v,"autoclave","available"),g.push(j),console.log(`✅ Tool ${j.name} completed sterilization cycle and marked as available`)}}),g.length>0&&(c({id:`cycle-${n.cycleNumber}-${Date.now()}`,type:"cycle-complete",title:`Cycle ${n.cycleNumber} Completed`,time:new Date,toolCount:g.length,color:"bg-green-500"}),console.log(`✅ Activity logged: Cycle ${n.cycleNumber} completed with ${g.length} tools`)),t(d),s(d)}},[o,n,r,t,s,a,c])}},Xe=r=>{const t=Math.floor(r/3600),s=Math.floor(r%3600/60),n=r%60;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},kp=(r,t)=>r?"bg-red-100 text-red-700 border border-red-200":t?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-600",Ip=(r,t)=>r?"OVEREXPOSED":t?"ACTIVE":"INACTIVE",Pp=(r,t,s,n)=>{var a;if(!r)return t==="drying"?"00:00:00":Xe(s);if(t==="drying")return Xe(n);if((t==="bath1"||t==="bath2")&&r.overexposed&&r.elapsedTime){const c=r.elapsedTime-s;return`+${Xe(c)}`}return Xe((a=r.timeRemaining)!=null?a:0)},Dp=({phaseId:r,phaseConfig:t,timer:s,duration:n,elapsedTime:a,isExpanded:i,onToggleExpanded:c})=>{var o;const{currentCycle:l}=W(),d=(o=s==null?void 0:s.timeRemaining)!=null?o:n,x=(s==null?void 0:s.isRunning)||!1,m=(s==null?void 0:s.overexposed)||!1,p=l==null?void 0:l.tools.some(f=>{const g=W.getState().availableTools.find(v=>v.id===f);return g==null?void 0:g.isP2Status});return e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:c,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&c()},role:"button",tabIndex:0,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#5b5b5b]",children:t.label}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${kp(m,x)}`,children:Ip(m,x)}),r==="drying"&&p&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 border border-blue-200",children:"P2 STATUS"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-2xl font-mono font-bold ${m?"text-red-600":"text-[#5b5b5b]"}`,children:Pp(s,r,n,a)}),e.jsx("div",{className:"text-xs text-gray-500",children:s?`${s.elapsedTime?`${Math.floor(s.elapsedTime/60)}:${(s.elapsedTime%60).toString().padStart(2,"0")}`:"00:00"} elapsed`:"Ready"})]}),e.jsx(C,{path:i?tc:pt,size:1,className:"text-gray-400"})]})]}),r!=="drying"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 relative",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${m?"bg-red-500":"bg-[#4ECDC4]"}`,style:{width:`${d/n*100}%`}})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:m&&(r==="bath1"||r==="bath2")?`100% + ${Xe(a-n)} overexposed`:`${Math.round((n-d)/n*100)}% complete`})]})]})},Ep=({phaseId:r,timer:t,onPauseTimer:s,onStopTimer:n,onMoveToNextPhase:a})=>{const{currentCycle:i}=W(),c=(t==null?void 0:t.isRunning)||!1,o=t&&t.timeRemaining===0,l=i&&i.tools.length>0,d=i==null?void 0:i.tools.some(m=>{const p=W.getState().availableTools.find(f=>f.id===m);return p==null?void 0:p.isP2Status}),x=l&&(r==="bath1"&&o||r==="bath2"&&t||r==="drying"&&t||r==="autoclave"&&o);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[r==="bath1"&&t?e.jsxs("button",{onClick:()=>s(r),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200"}`,children:[e.jsx(C,{path:c?Yr:vr,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):r==="bath1"?e.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via workflow"}):t?e.jsxs("button",{onClick:()=>s(r),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,children:[e.jsx(C,{path:c?Yr:vr,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):e.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via previous phase"}),e.jsx("button",{onClick:()=>n(r),className:"px-4 py-2 bg-red-100 text-red-700 border border-red-300 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Cancel"})]}),x&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>a(r),className:"w-full px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:r==="drying"&&d?"Complete P2 Status Tools":r==="autoclave"?"Complete All Tools":"Move to Next Phase"})})]})},Op=({selectedCycle:r,onCycleSelect:t})=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Select Cycle Type:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(yp).map(([s,n])=>e.jsxs("button",{onClick:()=>t(s),className:`p-3 text-xs rounded-lg border transition-all duration-200 ${r===s?"bg-[#4ECDC4] text-white border-[#4ECDC4] shadow-sm":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-[#4ECDC4]"}`,children:[e.jsx("div",{className:"font-medium",children:n.name}),e.jsx("div",{className:"text-xs opacity-75",children:n.temp}),e.jsxs("div",{className:"text-xs opacity-75",children:[n.totalTime," min"]})]},s))})]}),$p=({duration:r,isRunning:t,timer:s})=>e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{children:["Duration: ",Xe(r||0)]}),e.jsxs("div",{children:["Status: ",t?"Running":"Stopped"]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Remaining: ",Xe(s.timeRemaining||0)]}),e.jsxs("div",{children:["Elapsed: ",Xe(s.elapsedTime||0)]})]})]}),Ap=()=>{const r=W(a=>a.currentCycle),t=W(a=>a.availableTools),n=u.useMemo(()=>(r==null?void 0:r.tools)||[],[r==null?void 0:r.tools]).map(a=>t.find(i=>i.id===a)).filter(a=>a!==void 0);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:Me,size:.8,className:"text-gray-500"}),e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Tools in Phase"})]}),(r==null?void 0:r.cycleNumber)&&e.jsx("span",{className:"text-xs text-gray-500 font-mono bg-white px-2 py-1 rounded border",children:r.cycleNumber})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.length>0?n.map(a=>e.jsx("span",{className:"px-2 py-1 bg-white text-xs text-gray-600 rounded border",children:a.name},a.id)):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-xs text-gray-500 rounded border",children:"No tools in cycle"})})]})},Ai=u.memo(({className:r=""})=>{const{timers:t}=as(),[s,n]=u.useState(null),[a,i]=u.useState(vp()),{handlePauseTimer:c,handleStopTimer:o}=_p(),{handleMoveToNextPhase:l}=Tp(),d=p=>{n(s===p?null:p)},x=p=>{o(p),n(null)},m=p=>{l(p),n(null)};return e.jsxs("div",{className:`space-y-4 ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"Sterilization Timers"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Individual phase timers for concurrent cycles"})]}),e.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-[#4ECDC4] text-white rounded-full",children:"Phase Timers"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(Ni).map(([p,f])=>{var g;const v=t[p],j=f.duration,h=s===p,y=(g=v==null?void 0:v.elapsedTime)!=null?g:0;return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-300 ${v!=null&&v.isRunning||p==="bath1"?"shadow-[0_0_25px_rgba(78,205,196,0.5)] border-[#4ECDC4] ring-2 ring-[#4ECDC4] ring-opacity-30":""}`,children:[e.jsx(Dp,{phaseId:p,phaseConfig:f,timer:v,duration:j,elapsedTime:y,isExpanded:h,onToggleExpanded:()=>d(p)}),h&&e.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[e.jsx(Ap,{}),p==="autoclave"&&e.jsx(Op,{selectedCycle:a,onCycleSelect:i}),e.jsx(Ep,{phaseId:p,timer:v,onPauseTimer:c,onStopTimer:x,onMoveToNextPhase:m}),e.jsx($p,{duration:j||0,isRunning:(v==null?void 0:v.isRunning)||!1,timer:v})]})]},p)})})]})});Ai.displayName="TimerDisplay";const Rp=u.memo(function({activeTab:t,tabs:s,SterilizationAnalyticsComponent:n,onTabChange:a,getTabButtonClasses:i}){return e.jsxs("div",{className:"bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("div",{className:"flex flex-wrap gap-2 p-4",children:s.map(c=>e.jsxs("button",{onClick:()=>a(c.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${i(t===c.id)}`,children:[e.jsx(C,{path:c.icon,size:.8}),c.label]},c.id))})}),e.jsxs("div",{className:"p-6",children:[t==="timers"&&e.jsx(Ai,{}),t==="analytics"&&e.jsx(e.Fragment,{children:n&&e.jsx(n,{})}),t==="logs"&&e.jsx(u.Suspense,{fallback:e.jsx(dm,{}),children:e.jsx(mp,{})})]})]})}),Bp=({isOpen:r,operatorName:t,onOperatorNameChange:s,onOperatorNameKeyPress:n,onStartCycle:a,onClose:i,getStartCycleButtonState:c})=>r?Ds.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999]",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Start New Sterilization Cycle"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator Name"}),e.jsx("input",{id:"operator-name",type:"text",value:t,onChange:s,placeholder:"Enter operator name...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",onKeyPress:n})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a,disabled:c(t).disabled,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${c(t).className}`,children:"Start Cycle"}),e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"})]})]})]})}),document.body):null;var Fp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Mp=({isOpen:r,onClose:t})=>{const{lastGeneratedCode:s,setShowBatchCodeModal:n}=W(),[a,i]=u.useState(!1);u.useEffect(()=>{r||n(!1)},[r,n]);const c=()=>{n(!1),t()},o=()=>Fp(null,null,function*(){if(s!=null&&s.code)try{yield navigator.clipboard.writeText(s.code),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error(d)}}),l=()=>{const d=window.open("","_blank");d&&s&&(d.document.write(`
        <html>
          <head>
            <title>Batch Code - ${s.code}</title>
            <style>
              body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
              .batch-code { font-size: 48px; font-weight: bold; margin: 20px 0; }
              .info { font-size: 16px; margin: 10px 0; }
              .instructions { text-align: left; margin: 20px 0; }
              @media print { body { margin: 0; } }
            </style>
          </head>
          <body>
            <h1>Batch Code</h1>
            <div class="batch-code">${s.code}</div>
            <div class="info">
              <p><strong>Generated:</strong> ${s.generatedAt.toLocaleString()}</p>
              <p><strong>Operator:</strong> ${s.operator}</p>
              <p><strong>Tools:</strong> ${s.toolCount}</p>
            </div>
            <div class="instructions">
              <h3>Instructions:</h3>
              <ol>
                <li>Write this batch code clearly on the package</li>
                <li>Add today's date</li>
                <li>Add your name (${s.operator})</li>
                <li>Place package in autoclave</li>
              </ol>
            </div>
          </body>
        </html>
      `),d.document.close(),d.print())};return!r||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{path:sc,size:1.5,className:"text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Batch Code Generated"})]}),e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(le,{path:ae,size:1.5})})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-4",children:[e.jsx("p",{className:"text-sm text-purple-600 mb-2",children:"Your Batch Code"}),e.jsx("div",{className:"text-3xl font-bold text-purple-800 font-mono tracking-wider",children:s.code})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Generated:"})," ",s.generatedAt.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Operator:"})," ",s.operator]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tools:"})," ",s.toolCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",s.isSingleTool?"Single Tool":"Batch"]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Instructions"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-2",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"1."}),e.jsx("span",{children:"Write this batch code clearly on the package"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"2."}),e.jsxs("span",{children:["Add today's date: ",new Date().toLocaleDateString()]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"3."}),e.jsxs("span",{children:["Add your name: ",s.operator]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"4."}),e.jsx("span",{children:"Place package in autoclave for sterilization"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[e.jsx(le,{path:xi,size:1}),e.jsx("span",{children:a?"Copied!":"Copy Code"})]}),e.jsxs("button",{onClick:l,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(le,{path:oi,size:1}),e.jsx("span",{children:"Print"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:c,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Done"})}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Important:"})," This batch code is now tracked in the system. If a BI failure occurs, all tools in this batch will be affected."]})})]})})};var Lp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const zp=u.memo(({SterilizationAnalyticsComponent:r})=>{const{recordBITestResult:t,lastBITestDate:s,biTestOptedOut:n,setBiTestOptedOut:a,enforceBI:i}=Ei(),{startNewCycle:c,showBatchCodeModal:o,setShowBatchCodeModal:l}=W(),{tabs:d,validateOperatorName:x,getTabButtonClasses:m,getStartCycleButtonState:p}=ip(),{activeTab:f,showNewCycleModal:g,operatorName:v,handleTabChange:j,handleOperatorNameChange:h,handleCloseNewCycleModal:y,resetOperatorName:b}=op();u.useEffect(()=>{Ho()},[]),u.useEffect(()=>{let T=null,k=!0;function S(){k&&(lp(s),T=setTimeout(S,3e5))}return S(),()=>{k=!1,T&&(clearTimeout(T),T=null)}},[s]);const _=u.useCallback(T=>Lp(null,null,function*(){console.log("🔬 Dashboard: handleBITestComplete called with:",T);try{yield t(T),console.log("🔬 Dashboard: BI test result recorded successfully")}catch(k){console.error("🔬 Dashboard: Error recording BI test result:",k)}}),[t]),P=u.useCallback(()=>{x(v)&&(c(v.trim()),y(),b())},[v,c,x,y,b]),$=u.useCallback(()=>{a(!0)},[a]);u.useCallback(()=>{},[]);const D=u.useMemo(()=>{if(!i||n)return!1;const T=new Date().toDateString(),k=s?new Date(s).toDateString():null;return console.log("🔬 Dashboard: Banner visibility check:",{enforceBI:i,biTestOptedOut:n,lastBITestDate:s,lastTestDate:k,today:T,shouldShow:k!==T}),k!==T},[i,n,s]),w=u.useCallback(T=>{T.key==="Enter"&&P()},[P]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(np,{isVisible:D,onComplete:_,onOptOut:$}),e.jsx($i,{}),e.jsx(Rp,{activeTab:f,tabs:d,SterilizationAnalyticsComponent:r,onTabChange:j,getTabButtonClasses:m}),e.jsx(Bp,{isOpen:g,operatorName:v,onOperatorNameChange:h,onOperatorNameKeyPress:w,onClose:y,onStartCycle:P,getStartCycleButtonState:p}),e.jsx(Mp,{isOpen:o,onClose:()=>l(!1)})]})});zp.displayName="SterilizationDashboard";const Tv=()=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",role:"banner","aria-label":"Inventory management header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Inventory Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage your inventory items and equipment"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Item scanner controls",children:[e.jsx("span",{className:"text-gray-600",children:"Item Scanner"}),e.jsx(Zl,{to:"/inventory/scanner",children:e.jsx(gr,{variant:"success",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1","aria-label":"Scan new inventory item using barcode scanner",tabIndex:0,children:"Inventory Scanner"})})]})})]}),kv=()=>e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})});var Up=Object.defineProperty,qp=Object.defineProperties,Hp=Object.getOwnPropertyDescriptors,mn=Object.getOwnPropertySymbols,Vp=Object.prototype.hasOwnProperty,Wp=Object.prototype.propertyIsEnumerable,xn=(r,t,s)=>t in r?Up(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Gp=(r,t)=>{for(var s in t||(t={}))Vp.call(t,s)&&xn(r,s,t[s]);if(mn)for(var s of mn(t))Wp.call(t,s)&&xn(r,s,t[s]);return r},Kp=(r,t)=>qp(r,Hp(t));const Ri=()=>{Ux();const r=Tt(),{tools:t,supplies:s,equipment:n,officeHardware:a}=r,i=[...t,...s,...n,...a],c=i.map(o=>{var l;return Kp(Gp({},o),{category:(l=o.category)!=null?l:"uncategorized"})});return{allItems:i,itemsWithCategory:c,tools:t,supplies:s,equipment:n,officeHardware:a,totalUniqueItems:t.length+s.length+n.length+a.length,refreshData:r.refreshData,getAllItems:()=>i,getItemsByCategory:o=>{switch(o){case"tools":return t;case"supplies":return s;case"equipment":return n;case"officeHardware":return a;default:return[]}}}};var Qp=Object.defineProperty,pn=Object.getOwnPropertySymbols,Yp=Object.prototype.hasOwnProperty,Jp=Object.prototype.propertyIsEnumerable,hn=(r,t,s)=>t in r?Qp(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,gn=(r,t)=>{for(var s in t||(t={}))Yp.call(t,s)&&hn(r,s,t[s]);if(pn)for(var s of pn(t))Jp.call(t,s)&&hn(r,s,t[s]);return r},Xp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Zp=r=>({items:[],categories:[],selectedItems:[],isLoading:!1,isCategoriesLoading:!1,setItems:t=>r({items:t,inventoryItems:t}),setCategories:t=>r({categories:t}),addItem:t=>r(s=>({items:[...s.items,t],inventoryItems:[...s.items,t]})),updateItem:(t,s)=>r(n=>{const a=n.items.map(i=>i.id===t?gn(gn({},i),s):i);return{items:a,inventoryItems:a}}),deleteItem:t=>r(s=>{const n=s.items.filter(a=>a.id!==t);return{items:n,inventoryItems:n}}),addCategory:t=>r(s=>({categories:[...s.categories,t]})),removeCategory:t=>r(s=>({categories:s.categories.filter(n=>n!==t)})),setSelectedItems:t=>r({selectedItems:t}),setLoading:t=>r({isLoading:t}),setCategoriesLoading:t=>r({isCategoriesLoading:t}),setInventoryLoading:t=>r({isLoading:t}),refreshInventoryData:()=>Xp(null,null,function*(){console.log("Refreshing inventory data...")}),getFilteredItems:()=>[],getUniqueCategories:()=>[],inventoryItems:[]});var eh=Object.defineProperty,th=Object.defineProperties,sh=Object.getOwnPropertyDescriptors,fn=Object.getOwnPropertySymbols,rh=Object.prototype.hasOwnProperty,ah=Object.prototype.propertyIsEnumerable,bn=(r,t,s)=>t in r?eh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,nh=(r,t)=>{for(var s in t||(t={}))rh.call(t,s)&&bn(r,s,t[s]);if(fn)for(var s of fn(t))ah.call(t,s)&&bn(r,s,t[s]);return r},lh=(r,t)=>th(r,sh(t));const ih=r=>({activeTab:"tools",showFilters:!1,showTrackedOnly:!1,showFavoritesOnly:!1,expandedSections:{general:!0,purchase:!1,maintenance:!1,usage:!1},showFiltersPanel:!1,showAnalytics:!0,showBulkActions:!1,mergeMode:!1,selectedItems:[],trackedItems:new Set,trackingData:new Map,setActiveTab:t=>r({activeTab:t}),setShowFilters:t=>r({showFilters:t}),setShowTrackedOnly:t=>r({showTrackedOnly:t}),setShowFavoritesOnly:t=>r({showFavoritesOnly:t}),setExpandedSections:t=>r({expandedSections:t}),toggleExpandedSection:t=>r(s=>({expandedSections:lh(nh({},s.expandedSections),{[t]:!s.expandedSections[t]})})),setShowFiltersPanel:t=>r({showFiltersPanel:t}),setShowAnalytics:t=>r({showAnalytics:t}),setShowBulkActions:t=>r({showBulkActions:t}),toggleTrackedItem:(t,s)=>r(n=>{const a=new Set(n.trackedItems),i=new Map(n.trackingData);return a.has(t)?(a.delete(t),i.delete(t)):(a.add(t),i.set(t,{doctor:s,timestamp:new Date().toISOString()})),{trackedItems:a,trackingData:i}}),setTrackedItems:t=>r({trackedItems:t}),setTrackingData:t=>r({trackingData:t}),setMergeMode:t=>r({mergeMode:t,selectedItems:t?[]:[]}),toggleItemSelection:t=>r(s=>{const n=[...s.selectedItems],a=n.indexOf(t);return a>-1?n.splice(a,1):n.push(t),{selectedItems:n}}),clearSelectedItems:()=>r({selectedItems:[]}),selectAllItems:t=>r({selectedItems:[...t]})}),oh=r=>({showAddModal:!1,showTrackModal:!1,showUploadBarcodeModal:!1,showScanModal:!1,showDeleteModal:!1,itemToDelete:null,scanMode:null,scannedItems:[],setShowAddModal:t=>r({showAddModal:t}),setShowTrackModal:t=>r({showTrackModal:t}),setShowUploadBarcodeModal:t=>r({showUploadBarcodeModal:t}),setShowScanModal:t=>r({showScanModal:t}),setShowDeleteModal:t=>r({showDeleteModal:t}),setItemToDelete:t=>r({itemToDelete:t}),openDeleteModal:t=>r({showDeleteModal:!0,itemToDelete:t}),closeDeleteModal:()=>r({showDeleteModal:!1,itemToDelete:null}),setScanMode:t=>r({scanMode:t}),addScannedItem:t=>r(s=>({scannedItems:[...s.scannedItems,t]})),removeScannedItem:t=>r(s=>({scannedItems:s.scannedItems.filter(n=>n!==t)})),resetScannedItems:()=>r({scannedItems:[]}),openAddModal:()=>r({showAddModal:!0}),closeAddModal:()=>r({showAddModal:!1}),openTrackModal:()=>r({showTrackModal:!0}),closeTrackModal:()=>r({showTrackModal:!1}),openUploadBarcodeModal:()=>r({showUploadBarcodeModal:!0}),closeUploadBarcodeModal:()=>r({showUploadBarcodeModal:!1}),toggleUploadBarcodeModal:()=>r(t=>({showUploadBarcodeModal:!t.showUploadBarcodeModal})),openScanModal:()=>r({showScanModal:!0}),closeScanModal:()=>r({showScanModal:!1})}),ch=()=>{try{const r=localStorage.getItem("cliniio-favorites");return r?JSON.parse(r):[]}catch(r){return console.warn("Failed to load favorites from localStorage:",r),[]}},yn=r=>{try{localStorage.setItem("cliniio-favorites",JSON.stringify(r))}catch(t){console.warn("Failed to save favorites to localStorage:",t)}},dh=r=>({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",favorites:ch(),showFavoritesOnly:!1,sortField:"name",sortDirection:"asc",setSearchQuery:t=>r({searchQuery:t,searchTerm:t}),setSearchTerm:t=>r({searchTerm:t,searchQuery:t}),setCategoryFilter:t=>r({categoryFilter:t}),setLocationFilter:t=>r({locationFilter:t}),setStatusFilter:t=>r({statusFilter:t}),setActiveFilter:t=>r({activeFilter:t}),setFavorites:t=>{r({favorites:t}),yn(t)},toggleFavorite:t=>r(s=>{const n=s.favorites.includes(t)?s.favorites.filter(a=>a!==t):[...s.favorites,t];return yn(n),{favorites:n}}),setShowFavoritesOnly:t=>r({showFavoritesOnly:t}),setSortField:t=>r({sortField:t}),setSortDirection:t=>r({sortDirection:t}),clearFilters:()=>r({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:""}),resetFilters:()=>r({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",sortField:"name",sortDirection:"asc",showFavoritesOnly:!1}),clearSearch:()=>r({searchQuery:"",searchTerm:""})});var uh=Object.defineProperty,mh=Object.defineProperties,xh=Object.getOwnPropertyDescriptors,vn=Object.getOwnPropertySymbols,ph=Object.prototype.hasOwnProperty,hh=Object.prototype.propertyIsEnumerable,jn=(r,t,s)=>t in r?uh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,sr=(r,t)=>{for(var s in t||(t={}))ph.call(t,s)&&jn(r,s,t[s]);if(vn)for(var s of vn(t))hh.call(t,s)&&jn(r,s,t[s]);return r},gh=(r,t)=>mh(r,xh(t));function wn(){return{id:"",itemName:"",category:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:0,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const fh=(r,t)=>({formData:wn(),isEditMode:!1,isDirty:!1,isCloned:!1,setFormData:s=>r({formData:s,isDirty:!1}),mergeFormData:s=>{console.log("🔍 mergeFormData called with:",s),r(n=>({formData:sr(sr({},n.formData),s),isDirty:!0}))},updateField:(s,n)=>r(a=>({formData:gh(sr({},a.formData),{[s]:n}),isDirty:!0})),resetForm:()=>r({formData:wn(),isEditMode:!1,isDirty:!1,isCloned:!1}),setEditMode:s=>r({isEditMode:s}),setIsCloned:s=>r({isCloned:s}),markAsDirty:()=>r({isDirty:!0}),markAsClean:()=>r({isDirty:!1}),openEditModal:s=>{var n;const{setFormData:a,setEditMode:i}=t(),c={id:s.id,itemName:s.name||s.item||"",category:s.category||"",location:s.location||"",status:s.status||"",quantity:s.quantity||1,unitCost:s.unit_cost||0,minimumQuantity:s.reorder_point||0,maximumQuantity:((n=s.data)==null?void 0:n.maximumQuantity)||0,supplier:s.supplier||"",barcode:s.barcode||"",sku:s.sku||"",description:s.description||"",notes:s.notes||"",updated_at:s.updated_at||new Date().toISOString(),createdAt:s.created_at||new Date().toISOString()};a(c),i(!0)},closeEditModal:()=>{const{resetForm:s}=t();s()}}),bh=r=>({currentPage:1,itemsPerPage:10,totalItems:0,setCurrentPage:t=>r({currentPage:t}),setItemsPerPage:t=>r({itemsPerPage:t,currentPage:1}),setTotalItems:t=>r({totalItems:t}),nextPage:()=>r(t=>{const s=Math.ceil(t.totalItems/t.itemsPerPage);return{currentPage:Math.min(t.currentPage+1,s)}}),previousPage:()=>r(t=>({currentPage:Math.max(t.currentPage-1,1)})),goToPage:t=>r(s=>{const n=Math.ceil(s.totalItems/s.itemsPerPage);return{currentPage:Math.max(1,Math.min(t,n))}}),resetPagination:()=>r({currentPage:1}),get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)},get startIndex(){return(this.currentPage-1)*this.itemsPerPage},get endIndex(){return Math.min(this.startIndex+this.itemsPerPage,this.totalItems)},get pagination(){return{currentPage:this.currentPage,pageSize:this.itemsPerPage}}});var yh=Object.defineProperty,Nn=Object.getOwnPropertySymbols,vh=Object.prototype.hasOwnProperty,jh=Object.prototype.propertyIsEnumerable,Cn=(r,t,s)=>t in r?yh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,wh=(r,t)=>{for(var s in t||(t={}))vh.call(t,s)&&Cn(r,s,t[s]);if(Nn)for(var s of Nn(t))jh.call(t,s)&&Cn(r,s,t[s]);return r};const Nh=r=>({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1,setAnalyticsData:t=>r({analyticsData:t}),setLoadingAnalytics:t=>r({isLoadingAnalytics:t}),updateAnalytics:()=>{r(()=>({isLoadingAnalytics:!0})),setTimeout(()=>{r(t=>({isLoadingAnalytics:!1,analyticsData:wh({},t.analyticsData)}))},1e3)},resetAnalytics:()=>r({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1})});var Ch=Object.defineProperty,Sn=Object.getOwnPropertySymbols,Sh=Object.prototype.hasOwnProperty,_h=Object.prototype.propertyIsEnumerable,_n=(r,t,s)=>t in r?Ch(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,nt=(r,t)=>{for(var s in t||(t={}))Sh.call(t,s)&&_n(r,s,t[s]);if(Sn)for(var s of Sn(t))_h.call(t,s)&&_n(r,s,t[s]);return r};const Th=Oe()((...r)=>nt(nt(nt(nt(nt(nt(nt({},Zp(...r)),ih(...r)),oh(...r)),dh(...r)),fh(...r)),bh(...r)),Nh(...r))),We=()=>Th(),kh=()=>{const{showAddModal:r,showTrackModal:t,showUploadBarcodeModal:s,showScanModal:n,openAddModal:a,closeAddModal:i,openTrackModal:c,closeTrackModal:o,openUploadBarcodeModal:l,closeUploadBarcodeModal:d,openScanModal:x,closeScanModal:m,formData:p,setFormData:f,mergeFormData:g,updateField:v,isEditMode:j,setEditMode:h,expandedSections:y,setExpandedSections:b,resetForm:_}=We(),P=u.useCallback(()=>{h(!1),_(),a()},[h,_,a]),$=u.useCallback(O=>{h(!0),f(O),a()},[h,f,a]),D=u.useCallback(()=>{i(),h(!1),_()},[i,h,_]),w=u.useCallback(()=>{c()},[c]),T=u.useCallback(()=>{o()},[o]),k=u.useCallback(()=>{l()},[l]),S=u.useCallback(()=>{d()},[d]),I=u.useCallback(()=>{x()},[x]),E=u.useCallback(()=>{m()},[m]);return{showAddModal:r,showTrackModal:t,showUploadBarcodeModal:s,showScanModal:n,formData:p,isEditMode:j,expandedSections:y,openAddModal:P,openEditModal:$,openTrackModal:w,openUploadBarcodeModal:k,openScanModal:I,closeAddModal:D,closeTrackModal:T,closeUploadBarcodeModal:S,closeScanModal:E,setFormData:f,mergeFormData:g,updateField:v,setExpandedSections:b}};var Ih=Object.defineProperty,Ph=Object.defineProperties,Dh=Object.getOwnPropertyDescriptors,Tn=Object.getOwnPropertySymbols,Eh=Object.prototype.hasOwnProperty,Oh=Object.prototype.propertyIsEnumerable,kn=(r,t,s)=>t in r?Ih(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ht=(r,t)=>{for(var s in t||(t={}))Eh.call(t,s)&&kn(r,s,t[s]);if(Tn)for(var s of Tn(t))Oh.call(t,s)&&kn(r,s,t[s]);return r},Vt=(r,t)=>Ph(r,Dh(t)),$h=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Ah=()=>{const r=kh(),{refreshData:t}=Tt(),{searchQuery:s,setSearchQuery:n,favorites:a,setFavorites:i,trackedItems:c,trackingData:o,toggleTrackedItem:l}=We(),d=u.useCallback((w,T)=>{console.log(`🔄 Form field changed: ${w} = "${T}"`),console.log("📝 Current form data before update:",r.formData),console.log("🔍 Calling updateField with:",w,T),r.updateField(w,T),console.log("📝 Form data after update should be updated in store")},[r]),x=u.useCallback(w=>{r.setExpandedSections(Vt(Ht({},r.expandedSections),{[w]:!r.expandedSections[w]}))},[r]),m=u.useCallback(w=>{const k=(I=>{if(!I)return 0;if(typeof I=="number")return I;const E=I.toString().replace(/[$,\s]/g,""),O=parseFloat(E);return isNaN(O)?0:O})(w.unitCost);console.log(`💰 Cost parsing: "${w.unitCost}" -> ${k}`);const S={name:w.itemName||"",category:w.category||"",location:w.location||"",status:w.status||"Active",quantity:w.quantity||1,unit_cost:k,facility_id:"unknown",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:(typeof w.reorder_point=="number"?w.reorder_point:0)||0,expiration_date:(typeof w.expiry_date=="string"?w.expiry_date:"")||"",supplier:(typeof w.supplier=="string"?w.supplier:"")||"",cost:k,vendor:(typeof w.supplier=="string"?w.supplier:"")||"",warranty:(typeof w.warranty=="string"?w.warranty:"")||"",maintenance_schedule:"",next_due:"",service_provider:"",assigned_to:"",notes:w.notes||"",tool_id:"",supply_id:"",equipment_id:"",hardware_id:"",p2_status:"",serial_number:(typeof w.serialNumber=="string"?w.serialNumber:"")||"",manufacturer:(typeof w.manufacturer=="string"?w.manufacturer:"")||"",image_url:"",tags:[],favorite:!1,tracked:!0,barcode:w.barcode||"",sku:w.sku||"",description:w.description||"",current_phase:"Active",is_active:!0,unit:"",expiration:(typeof w.expiry_date=="string"?w.expiry_date:"")||"",purchase_date:(typeof w.purchaseDate=="string"?w.purchaseDate:"")||"",last_serviced:"",last_updated:new Date().toISOString(),data:{warranty:w.warranty||"",notes:w.notes||"",purchaseDate:w.purchaseDate||"",supplier:w.supplier||"",manufacturer:w.manufacturer||"",expiry_date:w.expiry_date||"",assetTag:w.assetTag||"",brand:w.brand||"",model:w.model||"",serialNumber:w.serialNumber||"",barcode:w.barcode||"",sku:w.sku||"",description:w.description||"",tags:[],imageUrl:"",isActive:!0,tracked:!0,favorite:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),currentPhase:"Active",p2Status:"",toolId:"",supplyId:"",equipmentId:"",hardwareId:"",serviceProvider:"",assignedTo:""}};return console.log("📦 Converted item to save:",S),S},[]),p=u.useCallback(()=>$h(null,null,function*(){try{console.log("🔄 Starting save process..."),console.log("📝 Form data:",r.formData);const w=m(Vt(Ht({},r.formData),{name:r.formData.itemName,category:r.formData.category,quantity:r.formData.quantity,location:r.formData.location,manufacturer:r.formData.manufacturer,supplier:r.formData.supplier,expiry_date:r.formData.expiry_date}));if(console.log("💾 Item to save:",w),r.isEditMode){if(r.formData.id){console.log("✏️ Updating existing item...");const T=yield bs.updateItem(r.formData.id,w);if(console.log("✅ Update response:",T),T.error)throw new Error(`Update failed: ${T.error}`);if(T.data){console.log("✅ Item updated successfully:",T.data);const S=(I=>{var E,O,A,B,R,Q,q,M,H,V,X,ie,te;return{itemName:I.name||I.item||"",category:I.category||"",id:I.id||"",location:I.location||"",createdAt:((E=I.data)==null?void 0:E.purchaseDate)||new Date().toISOString(),supplier:I.supplier||"",unit_cost:I.unit_cost||0,notes:((O=I.data)==null?void 0:O.notes)||"",updated_at:((A=I.data)==null?void 0:A.lastServiced)||new Date().toISOString(),status:I.status||"",quantity:I.quantity||1,reorder_point:I.reorder_point||0,barcode:((B=I.data)==null?void 0:B.barcode)||"",sku:((R=I.data)==null?void 0:R.sku)||"",description:((Q=I.data)==null?void 0:Q.description)||"",unitCost:I.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((q=I.data)==null?void 0:q.warranty)||"",purchaseDate:((M=I.data)==null?void 0:M.purchaseDate)||"",expiry_date:((H=I.data)==null?void 0:H.expiry_date)||"",assetTag:((V=I.data)==null?void 0:V.assetTag)||"",brand:((X=I.data)==null?void 0:X.brand)||"",model:((ie=I.data)==null?void 0:ie.model)||"",serialNumber:((te=I.data)==null?void 0:te.serialNumber)||"",manufacturer:I.manufacturer||""}})(T.data);r.setFormData(S)}else throw new Error("Update succeeded but no data returned")}}else{console.log("➕ Creating new item...");const T=yield bs.createItem(w);if(console.log("✅ Create response:",T),T.error)throw new Error(`Create failed: ${T.error}`);if(!T.data)throw new Error("Create succeeded but no data returned")}console.log("✅ Item saved successfully!"),console.log("🔄 Refreshing inventory data..."),yield t(),console.log("✅ Inventory data refreshed!"),console.log("🧹 Clearing analytics cache..."),bs.clearCache(),console.log("✅ Analytics cache cleared!")}catch(w){console.error("❌ Failed to save item:",w)}}),[r,m,t]),f=u.useCallback(()=>{},[]),g=u.useCallback(w=>{const T=new Set(a);T.has(w)?T.delete(w):T.add(w),i(Array.from(T))},[a,i]),v=u.useCallback((w,T)=>{l(w,T)},[l]),j=u.useCallback(w=>{n(w)},[n]),h=u.useCallback(w=>{const k=(S=>{var I,E,O,A,B,R,Q,q,M,H,V,X,ie;return{itemName:S.name||S.item||"",category:S.category||"",id:S.id||"",location:S.location||"",createdAt:((I=S.data)==null?void 0:I.purchaseDate)||new Date().toISOString(),supplier:S.supplier||"",unit_cost:S.unit_cost||0,notes:((E=S.data)==null?void 0:E.notes)||"",updated_at:((O=S.data)==null?void 0:O.lastServiced)||new Date().toISOString(),status:S.status||"",quantity:S.quantity||1,reorder_point:S.reorder_point||0,barcode:((A=S.data)==null?void 0:A.barcode)||"",sku:((B=S.data)==null?void 0:B.sku)||"",description:((R=S.data)==null?void 0:R.description)||"",unitCost:S.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((Q=S.data)==null?void 0:Q.warranty)||"",purchaseDate:((q=S.data)==null?void 0:q.purchaseDate)||"",expiry_date:((M=S.data)==null?void 0:M.expiry_date)||"",assetTag:((H=S.data)==null?void 0:H.assetTag)||"",brand:((V=S.data)==null?void 0:V.brand)||"",model:((X=S.data)==null?void 0:X.model)||"",serialNumber:((ie=S.data)==null?void 0:ie.serialNumber)||"",manufacturer:S.manufacturer||""}})(w);r.openEditModal(k)},[r]),y=u.useCallback(()=>{r.openAddModal()},[r]),b=u.useCallback(w=>{console.log("🔄 Cloning item:",w);const k=(I=>{var E,O,A,B,R,Q,q,M,H,V,X,ie,te;return{itemName:I.name||I.item||"",category:I.category||"",id:I.id||"",location:I.location||"",createdAt:((E=I.data)==null?void 0:E.purchaseDate)||new Date().toISOString(),supplier:I.supplier||"",unit_cost:I.unit_cost||0,notes:((O=I.data)==null?void 0:O.notes)||"",updated_at:((A=I.data)==null?void 0:A.lastServiced)||new Date().toISOString(),status:I.status||"",quantity:I.quantity||1,reorder_point:I.reorder_point||0,barcode:((B=I.data)==null?void 0:B.barcode)||"",sku:((R=I.data)==null?void 0:R.sku)||"",description:((Q=I.data)==null?void 0:Q.description)||"",unitCost:I.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((q=I.data)==null?void 0:q.warranty)||"",purchaseDate:((M=I.data)==null?void 0:M.purchaseDate)||"",expiry_date:((H=I.data)==null?void 0:H.expiry_date)||"",assetTag:((V=I.data)==null?void 0:V.assetTag)||"",brand:((X=I.data)==null?void 0:X.brand)||"",model:((ie=I.data)==null?void 0:ie.model)||"",serialNumber:((te=I.data)==null?void 0:te.serialNumber)||"",manufacturer:I.manufacturer||""}})(w),S=Vt(Ht({},k),{id:"",barcode:"",itemName:`${k.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("📋 Cloned form data:",S),r.setFormData(S),r.openAddModal()},[r]),_=u.useCallback(()=>{console.log("🔄 Cloning current form data");const w=r.formData,T=Vt(Ht({},w),{id:"",barcode:"",sku:"",itemName:`${w.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("📋 Cloned form data:",T),r.closeAddModal(),r.setFormData(T),r.openAddModal()},[r]),P=u.useCallback(()=>{r.openTrackModal()},[r]),$=u.useCallback(()=>{r.openUploadBarcodeModal()},[r]),D=u.useCallback(()=>{r.openScanModal()},[r]);return Vt(Ht({},r),{handleFormChange:d,toggleSection:x,handleSaveItem:p,handleDeleteItem:f,handleEditItem:h,handleAddItem:y,handleCloneItem:b,handleCloneCurrentForm:_,openAddModal:y,handleTrackItem:v,handleSearchChange:j,handleOpenTrackModal:P,handleOpenUploadBarcodeModal:$,handleOpenScanModal:D,toggleFavorite:g,searchQuery:s,favorites:a,trackedItems:c,trackingData:o})},In={ADD_ITEM:{id:"add-item-modal",title:"Add New Item",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!0,className:"inventory-modal"},SCAN_ITEM:{id:"scan-item-modal",title:"Scan Items",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!1,className:"scan-modal"}},Bi=[{id:"general",title:"General Information",defaultExpanded:!0,fields:[{name:"itemName",label:"Item Name",type:"text",required:!0,placeholder:"Enter item name"},{name:"category",label:"Category",type:"select",required:!0,options:[{value:"tools",label:"Tools"},{value:"supplies",label:"Supplies"},{value:"equipment",label:"Equipment"},{value:"officeHardware",label:"Office Hardware"}]},{name:"id",label:"ID / Serial #",type:"text",required:!0,placeholder:"Enter ID or serial number"},{name:"location",label:"Location",type:"location",required:!0}]},{id:"purchase",title:"Purchase Information",defaultExpanded:!1,fields:[{name:"purchaseDate",label:"Purchase Date",type:"date",required:!1},{name:"vendor",label:"Vendor",type:"text",required:!1,placeholder:"Enter vendor name"},{name:"unitCost",label:"Cost",type:"text",required:!0,placeholder:"Enter cost (e.g., $25.99, 15.50)"},{name:"warranty",label:"Warranty",type:"text",required:!1,placeholder:"Enter warranty information"}]},{id:"maintenance",title:"Maintenance Information",defaultExpanded:!1,fields:[{name:"maintenanceSchedule",label:"Maintenance Schedule",type:"text",required:!1,placeholder:"Enter maintenance schedule"},{name:"lastServiced",label:"Last Serviced",type:"date",required:!1},{name:"nextDue",label:"Next Due",type:"date",required:!1},{name:"serviceProvider",label:"Service Provider",type:"text",required:!1,placeholder:"Enter service provider"}]},{id:"usage",title:"Usage Information",defaultExpanded:!1,fields:[{name:"assignedTo",label:"Assigned To",type:"text",required:!1,placeholder:"Enter assigned person"},{name:"status",label:"Status",type:"select",required:!1,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"p2",label:"P2"},{value:"n/a",label:"N/A"}]},{name:"isP2Status",label:"P2 Tool",type:"select",required:!1,options:[{value:"false",label:"No"},{value:"true",label:"Yes"}]},{name:"quantity",label:"Quantity",type:"number",required:!0,placeholder:"Enter quantity",validation:{min:0}},{name:"notes",label:"Notes",type:"textarea",required:!1,placeholder:"Additional notes"}]}],Rh=(r,t=!1)=>{const s={};for(const n of Bi)for(const a of n.fields)if(!(a.name==="id"&&!t)&&(a.required&&!r[a.name]&&(s[a.name]=`${a.label} is required`),a.validation&&r[a.name])){const i=r[a.name];a.validation.min!==void 0&&Number(i)<a.validation.min&&(s[a.name]=`${a.label} must be at least ${a.validation.min}`),a.validation.max!==void 0&&Number(i)>a.validation.max&&(s[a.name]=`${a.label} must be at most ${a.validation.max}`),a.validation.pattern&&typeof i=="string"&&(new RegExp(a.validation.pattern).test(i)||(s[a.name]=a.validation.message||`${a.label} format is invalid`))}return s},Bh=({formData:r,isEditMode:t,handleSaveItem:s})=>({handleSave:u.useCallback(()=>{console.log("🔍 Validating form data before save..."),console.log("📝 Current form data:",r),console.log("🔍 Is edit mode:",t);const a=Rh(r,t);if(console.log("✅ Validation errors:",a),Object.keys(a).length===0)console.log("✅ Validation passed, calling handleSaveItem..."),s();else{console.error("❌ Validation failed:",a);return}},[r,t,s])});var Fh=Object.defineProperty,Mh=Object.defineProperties,Lh=Object.getOwnPropertyDescriptors,Pn=Object.getOwnPropertySymbols,zh=Object.prototype.hasOwnProperty,Uh=Object.prototype.propertyIsEnumerable,Dn=(r,t,s)=>t in r?Fh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,xs=(r,t)=>{for(var s in t||(t={}))zh.call(t,s)&&Dn(r,s,t[s]);if(Pn)for(var s of Pn(t))Uh.call(t,s)&&Dn(r,s,t[s]);return r},ps=(r,t)=>Mh(r,Lh(t));const Fi=()=>{const[r,t]=u.useState({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1}),s=()=>{if(!navigator.geolocation){t(a=>ps(xs({},a),{error:"Geolocation is not supported by this browser.",isLoading:!1}));return}t(a=>ps(xs({},a),{isLoading:!0,error:null})),navigator.geolocation.getCurrentPosition(a=>{t({latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,error:null,isLoading:!1})},a=>{let i="Unknown error occurred";switch(a.code){case a.PERMISSION_DENIED:i="Location access denied. Please enable location services.";break;case a.POSITION_UNAVAILABLE:i="Location information unavailable.";break;case a.TIMEOUT:i="Location request timed out.";break}t(c=>ps(xs({},c),{error:i,isLoading:!1}))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},n=()=>{t({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1})};return ps(xs({},r),{getCurrentLocation:s,clearLocation:n})};var qh=Object.defineProperty,Hh=Object.defineProperties,Vh=Object.getOwnPropertyDescriptors,En=Object.getOwnPropertySymbols,Wh=Object.prototype.hasOwnProperty,Gh=Object.prototype.propertyIsEnumerable,On=(r,t,s)=>t in r?qh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,rr=(r,t)=>{for(var s in t||(t={}))Wh.call(t,s)&&On(r,s,t[s]);if(En)for(var s of En(t))Gh.call(t,s)&&On(r,s,t[s]);return r},$n=(r,t)=>Hh(r,Vh(t));const Ms=Oe()(Fs((r,t)=>({rooms:[],addRoom:s=>{const n=$n(rr({},s),{id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});r(a=>({rooms:[...a.rooms,n]}))},updateRoom:(s,n)=>{r(a=>({rooms:a.rooms.map(i=>i.id===s?$n(rr(rr({},i),n),{updatedAt:new Date().toISOString()}):i)}))},deleteRoom:s=>{r(n=>({rooms:n.rooms.filter(a=>a.id!==s)}))},getActiveRooms:()=>t().rooms.filter(s=>s.isActive),getRoomsByDepartment:s=>t().rooms.filter(n=>n.department===s&&n.isActive),getRoomByBarcode:s=>t().rooms.find(n=>n.barcode===s&&n.isActive)}),{name:"room-storage"})),Iv=Object.freeze(Object.defineProperty({__proto__:null,useRoomStore:Ms},Symbol.toStringTag,{value:"Module"}));var Kh=Object.defineProperty,Qh=Object.defineProperties,Yh=Object.getOwnPropertyDescriptors,An=Object.getOwnPropertySymbols,Jh=Object.prototype.hasOwnProperty,Xh=Object.prototype.propertyIsEnumerable,Rn=(r,t,s)=>t in r?Kh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Zh=(r,t)=>{for(var s in t||(t={}))Jh.call(t,s)&&Rn(r,s,t[s]);if(An)for(var s of An(t))Xh.call(t,s)&&Rn(r,s,t[s]);return r},eg=(r,t)=>Qh(r,Yh(t));const tg=(r,t)=>{const n=r.latitude*Math.PI/180,a=t.latitude*Math.PI/180,i=(t.latitude-r.latitude)*Math.PI/180,c=(t.longitude-r.longitude)*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n)*Math.cos(a)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},sg=(r,t,s=100)=>{const n=t.filter(c=>c.gpsCoordinates&&c.isActive);if(n.length===0)return null;let a=null,i=1/0;return n.forEach(c=>{if(c.gpsCoordinates){const o=tg(r,c.gpsCoordinates);o<i&&o<=s&&(i=o,a=eg(Zh({},c),{distance:Math.round(o)}))}}),a},rg=r=>`${r.latitude.toFixed(6)}, ${r.longitude.toFixed(6)}`,ag=r=>r<1e3?`${Math.round(r)}m`:`${(r/1e3).toFixed(1)}km`,ng=({value:r,onChange:t,placeholder:s="Select location or use GPS",className:n=""})=>{const[a,i]=u.useState(!1),[c,o]=u.useState("room"),{getCurrentLocation:l,latitude:d,longitude:x,accuracy:m,isLoading:p}=Fi(),{getActiveRooms:f}=Ms(),g=f(),[v,j]=u.useState(null),h=$=>{o($),j(null),$==="gps"?l():$==="manual"&&t("")},y=$=>{t($),i(!1)},b=()=>{if(d&&x){const $=sg({latitude:d,longitude:x},g,50);if($)j({room:$,distance:$.distance||0}),t($.name);else{const D=`GPS: ${d.toFixed(6)}, ${x.toFixed(6)}`;t(D),j(null)}i(!1)}},_=$=>{t($.target.value)},P=()=>c==="gps"&&d&&x?`GPS: ${d.toFixed(6)}, ${x.toFixed(6)}`:r;return e.jsxs("div",{className:`relative ${n}`,children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>h("room"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="room"?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[e.jsx(C,{path:jr,size:.8,className:"inline mr-1"}),"Room"]}),e.jsxs("button",{type:"button",onClick:()=>h("gps"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="gps"?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[e.jsx(C,{path:wr,size:.8,className:"inline mr-1"}),"GPS"]}),e.jsx("button",{type:"button",onClick:()=>h("manual"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="manual"?"bg-purple-100 text-purple-700 border border-purple-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:"Manual"})]}),c==="room"&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>i(!a),className:"w-full px-3 py-2 text-left border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("span",{className:r?"text-gray-900":"text-gray-500",children:r||s}),e.jsx(C,{path:pt,size:1,className:"float-right mt-1"})]}),a&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:g.length>0?g.map($=>e.jsxs("button",{type:"button",onClick:()=>y($.name),className:"w-full px-3 py-2 text-left hover:bg-gray-100 focus:outline-none focus:bg-gray-100",children:[e.jsx("div",{className:"font-medium text-gray-900",children:$.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[$.department," • ",$.floor]})]},$.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No rooms available"})})]}),c==="gps"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",onClick:l,disabled:p,className:"w-full px-3 py-2 text-sm bg-green-100 text-green-700 border border-green-300 rounded-md hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:p?"Getting location...":"Get Current Location"}),v&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("div",{className:"font-medium flex items-center",children:[e.jsx(C,{path:jr,size:.8,className:"mr-1"}),"Smart Room Detection"]}),e.jsxs("div",{className:"mt-1",children:["Suggested:"," ",e.jsx("span",{className:"font-medium",children:v.room.name})]}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Distance: ",ag(v.distance)]})]})}),d&&x&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Latitude: ",d.toFixed(6)]}),e.jsxs("div",{children:["Longitude: ",x.toFixed(6)]}),m&&e.jsxs("div",{children:["Accuracy: ±",Math.round(m),"m"]})]}),e.jsx("button",{type:"button",onClick:b,className:"w-full px-3 py-2 text-sm bg-blue-100 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:v?"Use Suggested Room":"Use GPS Coordinates"})]})]}),c==="manual"&&e.jsx("input",{type:"text",value:r,onChange:_,placeholder:"Enter location manually",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Current location: ",P()]})]})},lg=({field:r,value:t,onChange:s})=>{var n,a,i;const c=o=>{s(o.target.value)};switch(r.type){case"text":return e.jsx("input",{type:"text",className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,value:t||"",onChange:c,required:r.required});case"number":return e.jsx("input",{type:"number",className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,value:t||"",onChange:c,required:r.required,min:(n=r.validation)==null?void 0:n.min,max:(a=r.validation)==null?void 0:a.max});case"date":return e.jsx("input",{type:"date",className:"form-control py-1 px-2 text-sm",value:t||"",onChange:c,required:r.required});case"select":return e.jsxs("select",{className:"form-select py-1 px-2 text-sm",value:t||"",onChange:c,required:r.required,children:[e.jsxs("option",{value:"",children:["Select ",r.label.toLowerCase()]}),(i=r.options)==null?void 0:i.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]});case"textarea":return e.jsx("textarea",{className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,rows:2,value:t||"",onChange:c,required:r.required});case"location":return e.jsx(ng,{value:t||"",onChange:s});default:return null}},ig=({section:r,expanded:t,onToggle:s,formData:n,handleFormChange:a})=>e.jsxs("div",{className:"mb-3 border border-gray-200 rounded-lg",children:[e.jsxs("button",{type:"button",onClick:s,className:"w-full p-3 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors rounded-t-lg",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:r.title}),e.jsx(C,{path:t?pt:Et,size:1,className:"text-gray-600"})]}),t&&e.jsx("div",{className:"p-3 border-t border-gray-200",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.fields.map(i=>i.name==="quantity"&&n.category==="tools"?null:e.jsxs("div",{children:[e.jsx("label",{htmlFor:`modal-${i.name}`,className:"block text-xs font-medium text-gray-700 mb-1",children:i.label}),e.jsx(lg,{field:i,value:n[i.name]||"",onChange:c=>a(i.name,c)})]},i.name))})})]}),Bn=({modalConfig:r,show:t,onHide:s,formData:n,isEditMode:a,isCloned:i=!1,expandedSections:c,toggleSection:o,handleFormChange:l,onSave:d,onClone:x,progressInfo:m,sections:p,children:f})=>{const g=i?"Cloned Edit Item":a?"Edit Item":r.title;return e.jsxs(je,{show:t,onHide:s,size:r.size,centered:r.centered,backdrop:r.backdrop,keyboard:r.keyboard,scrollable:r.scrollable,className:r.className,children:[e.jsx(je.Header,{closeButton:!0,children:e.jsxs(je.Title,{className:"flex items-center gap-3",children:[g,m&&e.jsxs("div",{className:"text-sm text-gray-500 font-normal",children:["(",m.current," of ",m.total,")"," ",m.currentItemName]})]})}),i&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mx-4 mt-2",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsx("strong",{children:"Database Safety Alert:"})," Please update the following fields before saving:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-yellow-700 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"ID/Serial #"})," - Must be unique"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Barcode"})," - Must be unique"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"SKU"})," - Must be unique"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Item Name"}),' - Currently shows "(Copy)" suffix']})]})]})]})}),e.jsxs(je.Body,{className:"max-h-[70vh] overflow-y-auto",children:[m&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Processing scanned items: ",m.current," of"," ",m.total]}),e.jsxs("span",{className:"text-xs text-blue-600",children:[Math.round(m.current/m.total*100),"% complete"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${m.current/m.total*100}%`}})})]}),e.jsx("div",{style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsxs("form",{id:"inventory-form",onSubmit:v=>{v.preventDefault(),d&&d()},children:[p==null?void 0:p.map(v=>e.jsx(ig,{section:v,expanded:c[v.id]||!1,onToggle:()=>o(v.id),formData:n,handleFormChange:l},v.id)),f]})})]}),e.jsxs(je.Footer,{className:"pt-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:x,className:"bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Clone"}),e.jsx("button",{onClick:s,className:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Cancel"})]}),d&&e.jsx("button",{type:"submit",form:"inventory-form",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:a?"Update Item":"Save Item"})]})]})},og=u.lazy(()=>Ve(()=>Promise.resolve().then(()=>sy),void 0));u.lazy(()=>Ve(()=>Promise.resolve().then(()=>ry),void 0));const Pv=()=>{const{showAddModal:r,showUploadBarcodeModal:t,showScanModal:s,closeAddModal:n,closeUploadBarcodeModal:a,closeScanModal:i,formData:c,isEditMode:o,expandedSections:l,handleFormChange:d,toggleSection:x,handleSaveItem:m,handleCloneCurrentForm:p}=Ah(),{handleSave:f}=Bh({formData:c,isEditMode:o,handleSaveItem:m}),g=v=>{x(v)};return e.jsxs(e.Fragment,{children:[e.jsx(Bn,{modalConfig:In.ADD_ITEM,show:r,onHide:n,formData:c,isEditMode:o,expandedSections:l,toggleSection:g,handleFormChange:d,onSave:f,onClone:p,sections:Bi}),e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center p-4",children:"Loading..."}),children:e.jsx(og,{show:t,onClose:a})}),s&&e.jsx(Bn,{modalConfig:In.SCAN_ITEM,show:s,onHide:i,formData:{itemName:"",category:"",id:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()},isEditMode:!1,expandedSections:{general:!1,purchase:!1,maintenance:!1,usage:!1},toggleSection:()=>{},handleFormChange:()=>{},children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("h4",{children:"Scan Items"}),e.jsx("p",{children:"Scan modal content would be implemented here"})]})})]})},cg=({show:r,onClose:t,title:s,children:n,footer:a,size:i="lg"})=>e.jsxs(je,{show:r,onHide:t,centered:!0,size:i,"aria-modal":"true",role:"dialog",children:[s&&e.jsx(je.Header,{closeButton:!0,className:"bg-gray-50 border-b border-gray-200",children:e.jsx(je.Title,{className:"text-xl font-semibold text-gray-800",children:s})}),e.jsx(je.Body,{className:"p-4",children:n}),a&&e.jsx(je.Footer,{className:"bg-gray-50 border-t border-gray-200 px-4 py-3",children:a})]}),Dv=({show:r,onClose:t,onConfirm:s,item:n,isLoading:a=!1,activeTab:i="tools"})=>{if(!n)return null;const c=()=>{s()},o=()=>{t()};return e.jsx(cg,{show:r,onClose:t,title:"Confirm Archive",size:"lg",footer:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:o,disabled:a,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md font-medium transition-colors duration-200 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:c,disabled:a,className:"px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-md font-medium transition-colors duration-200 disabled:opacity-50 flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Archiving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{path:Dt,size:.8}),"Archive"]})})]}),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(C,{path:xt,size:1.2,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:['Archive "',n.name,'"?']}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This will archive the item from the active inventory. The item will be hidden but preserved for audit purposes and compliance requirements."}),e.jsx("div",{className:"bg-gray-50 rounded-md p-3",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Item:"}),e.jsx("span",{children:n.name})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Category:"}),e.jsx("span",{children:n.category})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{children:n.location})]}),i!=="tools"&&n.quantity!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Quantity:"}),e.jsx("span",{children:n.quantity})]})]})})]})]})})},Ev=()=>e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})});var dg=Object.defineProperty,ug=Object.defineProperties,mg=Object.getOwnPropertyDescriptors,Fn=Object.getOwnPropertySymbols,xg=Object.prototype.hasOwnProperty,pg=Object.prototype.propertyIsEnumerable,Mn=(r,t,s)=>t in r?dg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,hg=(r,t)=>{for(var s in t||(t={}))xg.call(t,s)&&Mn(r,s,t[s]);if(Fn)for(var s of Fn(t))pg.call(t,s)&&Mn(r,s,t[s]);return r},gg=(r,t)=>ug(r,mg(t)),Ir=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const fg=(r,t)=>{let s;return(...n)=>{clearTimeout(s),s=setTimeout(()=>r(...n),t)}},Ln=new Map,bg=1e3,yg=(r,t,s)=>{const n=`${r}:${t}:${JSON.stringify(s)}`,a=Date.now(),i=Ln.get(n);return i&&a-i<bg?!0:(Ln.set(n,a),!1)},Ov={log:fg((...r)=>Ir(null,null,function*(){const[t,s,n]=r;if(yg(t,s,n)){console.log("Skipping duplicate audit event:",{category:t,action:s});return}try{if(!Sr()){console.warn("⚠️ Supabase not configured, skipping audit event logging");return}const a=yield _t.getCurrentFacilityId(),{data:{user:i}}=yield K.auth.getUser(),c=(i==null?void 0:i.id)||crypto.randomUUID(),{error:o}=yield K.from("audit_logs").insert({id:crypto.randomUUID(),module:t,table_name:t,action:s,record_id:null,user_id:c,facility_id:a,metadata:gg(hg({},n),{category:t,timestamp:new Date().toISOString()}),created_at:new Date().toISOString()});o?console.error("Failed to log audit event:",o):console.log("Audit event logged:",{category:t,action:s})}catch(a){console.error("Error logging audit event:",a)}}),100),logProblemToolAction:(r,t,s,n,a)=>Ir(null,null,function*(){const{error:i}=yield K.from("audit_logs").insert({event_type:"tool_problem_flagged",tool_id:r,facility_id:s,user_id:t,previous_status:n,new_status:"problem",details:a||null,happened_at:new Date().toISOString()});i&&console.error("Audit log insert failed:",i);try{if(!Sr()){console.warn("⚠️ Supabase not configured, skipping problem tool audit logging");return}const{error:c}=yield K.from("audit_logs").insert({id:crypto.randomUUID(),module:"sterilization",table_name:"tools",action:"tool_problem_action",record_id:r,user_id:t,facility_id:s,old_values:{status:n},new_values:{status:"problem"},metadata:{problem_notes:a,timestamp:new Date().toISOString()},created_at:new Date().toISOString()});c?console.error("Failed to log problem tool action:",c):console.log("Problem tool action logged:",r)}catch(c){console.error("Error logging problem tool action:",c)}})};function vg(r,t,s,n){return Ir(this,null,function*(){yield K.from("audit_logs").insert({event_type:"RECEIPT_UPLOADED",receipt_id:r,batch_id:t,operator_name:s,facility_id:n,happened_at:new Date().toISOString()})})}var jg=Object.defineProperty,wg=Object.defineProperties,Ng=Object.getOwnPropertyDescriptors,zn=Object.getOwnPropertySymbols,Cg=Object.prototype.hasOwnProperty,Sg=Object.prototype.propertyIsEnumerable,Un=(r,t,s)=>t in r?jg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Wt=(r,t)=>{for(var s in t||(t={}))Cg.call(t,s)&&Un(r,s,t[s]);if(zn)for(var s of zn(t))Sg.call(t,s)&&Un(r,s,t[s]);return r},ar=(r,t)=>wg(r,Ng(t)),lt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const nr=8,hs=4,Mi=Oe()(Fs((r,t)=>({statusTypes:[],isLoading:!1,error:null,fetchStatusTypes:()=>lt(null,null,function*(){r({isLoading:!0,error:null});try{r({statusTypes:[{id:"1",name:"Available",color:"#10B981",icon:"check-circle",description:"Item is available and ready for use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"2",name:"In Use",color:"#6B7280",icon:"pause-circle",description:"Item is currently in use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"3",name:"Maintenance",color:"#F59E0B",icon:"wrench",description:"Item requires maintenance",isDefault:!0,isCore:!0,isPublished:!0,category:"maintenance",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{id:"4",name:"Critical",color:"#EF4444",icon:"exclamation-triangle",description:"Item has critical issues",isDefault:!0,isCore:!0,isPublished:!0,category:"critical",requiresVerification:!0,autoTransition:!1,alertLevel:"critical"}],isLoading:!1})}catch(s){console.error("❌ Error fetching status types:",s),r({error:s instanceof Error?s.message:"Failed to fetch status types",isLoading:!1})}}),refreshStatusTypes:()=>lt(null,null,function*(){yield t().fetchStatusTypes()}),getCoreStatusTypes:()=>t().statusTypes.filter(s=>s.isCore),getPublishedStatusTypes:()=>t().statusTypes.filter(s=>s.isPublished),getCustomStatusTypes:()=>t().statusTypes.filter(s=>!s.isCore),getStatusTypesByCategory:s=>t().statusTypes.filter(n=>n.category===s),getAllStatusTypes:()=>t().statusTypes,addStatusType:s=>lt(null,null,function*(){try{const n=t(),a=n.getCustomStatusTypes();if(a.length>=hs)throw new Error(`Maximum of ${hs} custom statuses allowed. You currently have ${a.length} custom statuses.`);if(n.statusTypes.length>=nr)throw new Error(`Maximum of ${nr} total statuses allowed. You currently have ${n.statusTypes.length} statuses.`);const i=ar(Wt({id:Date.now().toString()},s),{isCore:!1,isPublished:!1});r(c=>({statusTypes:[...c.statusTypes,i]}))}catch(n){throw console.error("Error adding status type:",n),n}}),updateStatusType:(s,n)=>lt(null,null,function*(){const a=t().statusTypes.find(i=>i.id===s);if(a&&a.isCore){console.warn("Cannot update core status types");return}try{r(i=>({statusTypes:i.statusTypes.map(c=>c.id===s?Wt(Wt({},c),n):c)}))}catch(i){throw console.error("Error updating status type:",i),i}}),deleteStatusType:s=>lt(null,null,function*(){const n=t().statusTypes.find(a=>a.id===s);if(n&&n.isCore){console.warn("Cannot delete core status types");return}try{r(a=>({statusTypes:a.statusTypes.filter(i=>i.id!==s)}))}catch(a){throw console.error("Error deleting status type:",a),a}}),publishStatusType:s=>lt(null,null,function*(){const n=t().statusTypes.find(a=>a.id===s);if(n&&n.isCore){console.warn("Core status types are always published");return}try{r(a=>({statusTypes:a.statusTypes.map(i=>i.id===s?ar(Wt({},i),{isPublished:!0}):i)}))}catch(a){throw console.error("Error publishing status type:",a),a}}),unpublishStatusType:s=>lt(null,null,function*(){const n=t().statusTypes.find(a=>a.id===s);if(n&&n.isCore){console.warn("Cannot unpublish core status types");return}try{r(a=>({statusTypes:a.statusTypes.map(i=>i.id===s?ar(Wt({},i),{isPublished:!1}):i)}))}catch(a){throw console.error("Error unpublishing status type:",a),a}}),getStatusTypeById:s=>t().statusTypes.find(n=>n.id===s),getStatusTypeByName:s=>t().statusTypes.find(n=>n.name===s),getCategories:()=>{const s=new Set(t().statusTypes.map(n=>n.category).filter(Boolean));return Array.from(s).filter(n=>n!==void 0).sort()},getStatusCountInfo:()=>{const s=t(),n=s.getCoreStatusTypes(),a=s.getCustomStatusTypes();return{total:s.statusTypes.length,core:n.length,custom:a.length,maxCustom:hs}},canAddCustomStatus:()=>{const s=t();return s.getCustomStatusTypes().length<hs&&s.statusTypes.length<nr}}),{name:"status-types-storage",partialize:()=>({})})),$v=()=>{const r=Mi();return u.useEffect(()=>{r.statusTypes.length===0&&!r.isLoading&&r.fetchStatusTypes()},[r]),r};var _g=Object.defineProperty,Tg=Object.defineProperties,kg=Object.getOwnPropertyDescriptors,qn=Object.getOwnPropertySymbols,Ig=Object.prototype.hasOwnProperty,Pg=Object.prototype.propertyIsEnumerable,Hn=(r,t,s)=>t in r?_g(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,it=(r,t)=>{for(var s in t||(t={}))Ig.call(t,s)&&Hn(r,s,t[s]);if(qn)for(var s of qn(t))Pg.call(t,s)&&Hn(r,s,t[s]);return r},yt=(r,t)=>Tg(r,kg(t));class Dg{constructor(t=[]){this.checklists=[],this.checklists=t}getAllChecklists(){return[...this.checklists]}getChecklistById(t){return this.checklists.find(s=>s.id===t)}getChecklistsByCategory(t){return this.checklists.filter(s=>s.category===t)}getPublishedChecklistsByCategory(t){return this.checklists.filter(s=>s.category===t&&s.status==="published")}getChecklistsByStatus(t){return this.checklists.filter(s=>s.status===t)}addChecklist(t){const s=yt(it({},t),{status:"draft",id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});return this.checklists.push(s),s}updateChecklist(t,s){const n=this.checklists.findIndex(i=>i.id===t);if(n===-1)return null;const a=yt(it(it({},this.checklists[n]),s),{updatedAt:new Date().toISOString()});return this.checklists[n]=a,a}deleteChecklist(t){const s=this.checklists.findIndex(n=>n.id===t);return s===-1?!1:(this.checklists.splice(s,1),!0)}publishChecklist(t){return this.updateChecklist(t,{status:"published",updatedAt:new Date().toISOString()})}unpublishChecklist(t){return this.updateChecklist(t,{status:"draft",updatedAt:new Date().toISOString()})}duplicateChecklist(t,s){const n=this.getChecklistById(t);if(!n)return null;const a=yt(it({},n),{id:this.generateId(),title:s||`${n.title} (Copy)`,status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:n.items.map(i=>yt(it({},i),{id:this.generateId(),completed:!1,skipped:!1}))});return this.checklists.push(a),a}getChecklistStatistics(){const t=this.checklists.length,s=this.checklists.filter(o=>o.status==="published").length,n=this.checklists.filter(o=>o.status==="draft").length,a=this.checklists.reduce((o,l)=>(o[l.category]=(o[l.category]||0)+1,o),{}),i=this.checklists.reduce((o,l)=>o+l.items.length,0),c=t>0?i/t:0;return{total:t,published:s,draft:n,byCategory:a,averageItemsPerChecklist:c,totalItems:i}}searchChecklists(t){const s=t.toLowerCase();return this.checklists.filter(n=>n.title.toLowerCase().includes(s)||n.items.some(a=>a.title.toLowerCase().includes(s)||a.instructions.toLowerCase().includes(s)))}filterChecklists(t){return this.checklists.filter(s=>!(t.category&&s.category!==t.category||t.status&&s.status!==t.status||t.hasScheduling!==void 0&&!!(s.autoSchedule||s.scheduleFrequency)!==t.hasScheduling||t.minItems!==void 0&&s.items.length<t.minItems||t.maxItems!==void 0&&s.items.length>t.maxItems))}sortChecklists(t,s,n="asc"){return[...t].sort((a,i)=>{let c=0;switch(s){case"title":c=a.title.localeCompare(i.title);break;case"createdAt":c=new Date(a.createdAt).getTime()-new Date(i.createdAt).getTime();break;case"updatedAt":c=new Date(a.updatedAt).getTime()-new Date(i.updatedAt).getTime();break;case"category":c=a.category.localeCompare(i.category);break;case"status":c=a.status.localeCompare(i.status);break}return n==="desc"?-c:c})}exportChecklists(t){const s=t?this.checklists.filter(n=>t.includes(n.id)):this.checklists;return JSON.stringify(s,null,2)}importChecklists(t){try{const s=JSON.parse(t);if(!Array.isArray(s))return{success:!1,imported:[],errors:["Invalid format: expected array of checklists"]};const n=[],a=[];return s.forEach((i,c)=>{const o=this.validateChecklist(i);if(!o.isValid)n.push(`Checklist ${c+1}: ${o.errors.join(", ")}`);else{const l=yt(it({},i),{id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:i.items.map(d=>yt(it({},d),{id:this.generateId()}))});a.push(l)}}),a.length>0&&this.checklists.push(...a),{success:n.length===0,imported:a,errors:n}}catch(s){return{success:!1,imported:[],errors:["Invalid JSON format"]}}}validateChecklist(t){const s=[];return(!t.title||t.title.trim()==="")&&s.push("Title is required"),t.category?["setup","patient","weekly","public","deep","environmental_cleaning"].includes(t.category)||s.push(`Invalid category: ${t.category}`):s.push("Category is required"),!t.items||!Array.isArray(t.items)?s.push("Items array is required"):t.items.length===0&&s.push("At least one item is required"),{isValid:s.length===0,errors:s}}getDefaultChecklists(){return[{id:"treatment-room-setup",title:"Treatment Room Setup",category:"setup",status:"published",items:[{id:"clean-surfaces",title:"Clean and sanitize all surfaces with CaviWipes",instructions:"Use 2 wipes per surface. Allow to air dry for 3 minutes.",requiredInventory:[{id:"caviwipes-001",name:"CaviWipes",required:2,available:100,used:0,unit:"wipes"}],sdsId:"caviwipes-sds",skipped:!1,completed:!1},{id:"restock-supplies",title:"Restock Treatment Room Supplies",instructions:"Verify all supplies are present and in date",requiredInventory:[{id:"gloves-001",name:"Nitrile Gloves",required:10,available:500,used:0,unit:"pairs"},{id:"gauze-001",name:"Sterile Gauze",required:5,available:200,used:0,unit:"packs"},{id:"alcohol-001",name:"Alcohol Swabs",required:10,available:300,used:0,unit:"swabs"}],skipped:!1,completed:!1}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}setChecklists(t){this.checklists=[...t]}clearChecklists(){this.checklists=[]}}var Eg=Object.defineProperty,Og=Object.defineProperties,$g=Object.getOwnPropertyDescriptors,Vn=Object.getOwnPropertySymbols,Ag=Object.prototype.hasOwnProperty,Rg=Object.prototype.propertyIsEnumerable,Wn=(r,t,s)=>t in r?Eg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,_e=(r,t)=>{for(var s in t||(t={}))Ag.call(t,s)&&Wn(r,s,t[s]);if(Vn)for(var s of Vn(t))Rg.call(t,s)&&Wn(r,s,t[s]);return r},Re=(r,t)=>Og(r,$g(t));class Bg{addItemToChecklist(t,s,n){const a=Re(_e({},n),{id:this.generateId()});return t.map(i=>i.id===s?Re(_e({},i),{items:[...i.items,a],updatedAt:new Date().toISOString()}):i)}updateChecklistItem(t,s,n,a){return t.map(i=>i.id===s?Re(_e({},i),{items:i.items.map(c=>c.id===n?_e(_e({},c),a):c),updatedAt:new Date().toISOString()}):i)}deleteChecklistItem(t,s,n){return t.map(a=>a.id===s?Re(_e({},a),{items:a.items.filter(i=>i.id!==n),updatedAt:new Date().toISOString()}):a)}getItemById(t,s,n){const a=t.find(i=>i.id===s);return a&&a.items.find(i=>i.id===n)||null}completeItem(t,s,n){return this.updateChecklistItem(t,s,n,{completed:!0,skipped:!1})}skipItem(t,s,n){return this.updateChecklistItem(t,s,n,{skipped:!0,completed:!1})}resetItem(t,s,n){return this.updateChecklistItem(t,s,n,{completed:!1,skipped:!1})}moveItemUp(t,s,n){return t.map(a=>{if(a.id!==s)return a;const i=[...a.items],c=i.findIndex(o=>o.id===n);return c<=0?a:([i[c],i[c-1]]=[i[c-1],i[c]],Re(_e({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemDown(t,s,n){return t.map(a=>{if(a.id!==s)return a;const i=[...a.items],c=i.findIndex(o=>o.id===n);return c===-1||c>=i.length-1?a:([i[c],i[c+1]]=[i[c+1],i[c]],Re(_e({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemToPosition(t,s,n,a){return t.map(i=>{if(i.id!==s)return i;const c=[...i.items],o=c.findIndex(d=>d.id===n);if(o===-1)return i;const[l]=c.splice(o,1);return c.splice(a,0,l),Re(_e({},i),{items:c,updatedAt:new Date().toISOString()})})}duplicateItem(t,s,n){const a=this.getItemById(t,s,n);if(!a)return t;const i=Re(_e({},a),{id:this.generateId(),title:`${a.title} (Copy)`,completed:!1,skipped:!1});return t.map(c=>c.id===s?Re(_e({},c),{items:[...c.items,i],updatedAt:new Date().toISOString()}):c)}getItemStatistics(t){let s=0,n=0,a=0,i=0,c=0;t.forEach(d=>{d.items.forEach(x=>{s++,x.completed&&n++,x.skipped&&a++,x.requiredInventory&&x.requiredInventory.length>0&&i++,x.sdsId&&c++})});const o=s-n-a,l=s>0?n/s*100:0;return{totalItems:s,completedItems:n,skippedItems:a,pendingItems:o,completionRate:l,itemsWithInventory:i,itemsWithSDS:c}}getChecklistCompletionStatus(t){const s=t.items.length,n=t.items.filter(l=>l.completed).length,a=t.items.filter(l=>l.skipped).length,i=s-n-a,c=s>0?n/s*100:0;return{totalItems:s,completedItems:n,skippedItems:a,pendingItems:i,completionRate:c,isFullyCompleted:n===s}}validateItem(t){const s=[];return(!t.title||t.title.trim()==="")&&s.push("Title is required"),(!t.instructions||t.instructions.trim()==="")&&s.push("Instructions are required"),t.requiredInventory&&Array.isArray(t.requiredInventory)&&t.requiredInventory.forEach((n,a)=>{(!n.id||n.id.trim()==="")&&s.push(`Inventory item ${a+1}: ID is required`),(!n.name||n.name.trim()==="")&&s.push(`Inventory item ${a+1}: Name is required`),n.required<=0&&s.push(`Inventory item ${a+1}: Required quantity must be greater than 0`),n.available<0&&s.push(`Inventory item ${a+1}: Available quantity cannot be negative`),n.used<0&&s.push(`Inventory item ${a+1}: Used quantity cannot be negative`),n.used>n.available&&s.push(`Inventory item ${a+1}: Used quantity cannot exceed available quantity`)}),{isValid:s.length===0,errors:s}}searchItems(t,s){const n=s.toLowerCase(),a=[];return t.forEach(i=>{i.items.forEach(c=>{var o;c.title.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"title"}):c.instructions.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"instructions"}):(o=c.requiredInventory)!=null&&o.some(l=>l.name.toLowerCase().includes(n))&&a.push({checklist:i,item:c,matchType:"inventory"})})}),a}filterItems(t,s){const n=[];return t.forEach(a=>{s.category&&a.category!==s.category||a.items.forEach(i=>{s.completed!==void 0&&i.completed!==s.completed||s.skipped!==void 0&&i.skipped!==s.skipped||s.hasInventory!==void 0&&!!(i.requiredInventory&&i.requiredInventory.length>0)!==s.hasInventory||s.hasSDS!==void 0&&!!i.sdsId!==s.hasSDS||n.push({checklist:a,item:i})})}),n}sortItems(t,s,n="asc"){return[...t].sort((a,i)=>{var c,o;let l=0;switch(s){case"title":l=a.item.title.localeCompare(i.item.title);break;case"completed":l=(a.item.completed?1:0)-(i.item.completed?1:0);break;case"skipped":l=(a.item.skipped?1:0)-(i.item.skipped?1:0);break;case"inventoryCount":{const d=((c=a.item.requiredInventory)==null?void 0:c.length)||0,x=((o=i.item.requiredInventory)==null?void 0:o.length)||0;l=d-x;break}}return n==="desc"?-l:l})}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}}const ot=new Dg,lr=new Bg,Gn=Oe()(Fs((r,t)=>({checklists:ot.getDefaultChecklists(),addChecklist:s=>{const n=ot.addChecklist(s);r(a=>({checklists:[...a.checklists,n]}))},updateChecklist:(s,n)=>{r(a=>{const i=ot.updateChecklist(s,n);return i?{checklists:a.checklists.map(c=>c.id===s?i:c)}:a})},deleteChecklist:s=>{r(n=>ot.deleteChecklist(s)?{checklists:n.checklists.filter(i=>i.id!==s)}:n)},addItemToChecklist:(s,n)=>{r(a=>({checklists:lr.addItemToChecklist(a.checklists,s,n)}))},updateChecklistItem:(s,n,a)=>{r(i=>({checklists:lr.updateChecklistItem(i.checklists,s,n,a)}))},deleteChecklistItem:(s,n)=>{r(a=>({checklists:lr.deleteChecklistItem(a.checklists,s,n)}))},getChecklistsByCategory:s=>ot.getChecklistsByCategory(s),publishChecklist:s=>{r(n=>{const a=ot.publishChecklist(s);return a?{checklists:n.checklists.map(i=>i.id===s?a:i)}:n})},getPublishedChecklistsByCategory:s=>ot.getPublishedChecklistsByCategory(s)}),{name:"checklist-storage"}));var Fg=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Mg=r=>{var t;typeof window!="undefined"&&((t=window.toast)!=null&&t.error)?window.toast.error(r):console.warn("⚠️",r)},Av=({scannedData:r,toolId:t,onClose:s,batchMode:n=!1})=>{const{availableTools:a,currentCycle:i,addPhaseToCycle:c,startPhase:o,addToolToCycle:l}=W(),[d,x]=u.useState(!1),[m,p]=u.useState(null),[f,g]=u.useState([]),[v,j]=u.useState({show:!1,tool:null}),h=u.useCallback(E=>a.find(O=>O.barcode===E),[a]),b=u.useCallback(()=>t?a.find(E=>E.id===t):h(r),[t,a,h,r])(),_=u.useCallback(()=>!i||!b?!1:i.tools.includes(b.id),[i,b]),P=u.useCallback(E=>Fg(null,null,function*(){if(!E||typeof E!="string"||E.trim()===""){Mg("No barcode detected — please rescan.");return}const O=E.trim();console.info("✅ Scanned barcode received:",O),x(!0),p(null);try{yield new Promise(R=>setTimeout(R,1e3));const A=h(O);if(!A){p({type:"error",text:`Tool with barcode "${O}" not found in inventory.`});return}if(f.find(R=>R.id===A.id)){p({type:"error",text:`Tool "${A.name}" already scanned.`});return}const B=W.getState();if(B.checkToolReplacementNeeded&&B.checkToolReplacementNeeded(A.id)){j({show:!0,tool:A});return}g(R=>{const Q=[...R,A];return p(n?{type:"success",text:`Tool "${A.name}" added to batch. Total: ${Q.length} tools.`}:{type:"success",text:`Tool "${A.name}" scanned successfully. Ready for sterilization.`}),Q})}catch(A){p({type:"error",text:"Failed to scan tool. Please try again."}),console.error("Scan error:",A)}finally{x(!1)}}),[h,n,f]),$=u.useCallback(()=>{if(!i)return null;const E=i.phases.find(A=>A.isActive),O=i.tools.length;return{cycleId:i.id,operator:i.operator,totalTools:O,activePhase:(E==null?void 0:E.name)||"No active phase",startTime:i.startTime}},[i]),D=u.useCallback(()=>{const E=(i==null?void 0:i.phases.some(R=>R.id==="bath1"&&R.isActive))||!1,{getTimer:O}=as.getState(),A=O("bath1"),B=(A==null?void 0:A.isRunning)||!1;return E||B},[i]),w=u.useCallback(()=>{g([]),p(null)},[]),T=u.useCallback(()=>{j({show:!1,tool:null}),p({type:"error",text:"Tool marked for replacement. Please replace with a new tool before continuing."})},[]),k=u.useCallback(()=>{v.tool&&(g(E=>[...E,v.tool]),p({type:"success",text:`Tool "${v.tool.name}" added despite needing replacement.`})),j({show:!1,tool:null})},[v.tool]),S=u.useCallback(()=>{j({show:!1,tool:null})},[]),I=u.useCallback(E=>{if(!E||E.length===0){console.warn("⚠️ handleSendToBath1 called with no tools.");return}if(D()){p({type:"error",text:"⚠️ Bath 1 timer is already in process. Please wait for the current phase to complete before starting a new one."});return}try{E.forEach(A=>{l(A.id);const B=W.getState();console.log(`Tool ${A.id} status updated to bath1`)}),c("bath1",oe.bath1.name,oe.bath1.duration*60),o("bath1");const{startTimer:O}=as.getState();O("bath1",oe.bath1.duration*60),p({type:"success",text:`🚀 ${E.length} tools sent to Bath 1! Phase timer started.`}),g([]),s&&s()}catch(O){console.error("❌ Error in handleSendToBath1:",O),p({type:"error",text:"Failed to start Bath 1 phase. Please try again."})}},[l,c,o,p,s,D]);return u.useEffect(()=>{if(m){const E=setTimeout(()=>{p(null)},5e3);return()=>clearTimeout(E)}},[m]),{tool:b,currentCycle:i,isScanning:d,scanMessage:m,scannedTools:f,batchMode:n,handleScanTool:P,handleSendToBath1:I,clearScannedTools:w,isToolInCycle:_(),isBath1Active:D(),cycleStatus:$(),replacementAlert:v,handleReplaceTool:T,handleContinueAnyway:k,handleDismissReplacementAlert:S}},Li=[{id:"clean",name:"Clean Tool",icon:rc,color:"green",description:"Ready to use on patients",statusRequirement:"Complete → Dirty"},{id:"dirty",name:"Dirty Tool",icon:ac,color:"orange",description:"Ready for cleaning process",statusRequirement:"Dirty → Clean"},{id:"problem",name:"Tool Problem",icon:ce,color:"red",description:"Report tool issues or problems",statusRequirement:"Any status → Problem"},{id:"import",name:"Import Autoclave Receipt",icon:Ne,color:"blue",description:"Import physical autoclave cycle documentation",statusRequirement:"Documentation"},{id:"packaging",name:"Packaging Workflow",icon:ut,color:"purple",description:"Tools that are ready for packaging",statusRequirement:"Complete → Packaged"}],Lg=r=>Li.find(t=>t.id===r),zg=r=>({green:"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",orange:"border-orange-200 hover:border-orange-300 bg-orange-50 hover:bg-orange-100",blue:"border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",purple:"border-purple-200 hover:border-purple-300 bg-purple-50 hover:bg-purple-100",red:"border-red-200 hover:border-red-300 bg-red-50 hover:bg-red-100"})[r],Ug=r=>({green:"bg-green-100",orange:"bg-orange-100",blue:"bg-blue-100",purple:"bg-purple-100",red:"bg-red-100"})[r],qg=r=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[r],Hg=r=>({green:"text-green-800",orange:"text-orange-800",blue:"text-blue-800",purple:"text-purple-800",red:"text-red-800"})[r],Vg=r=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[r],Wg=r=>({green:"text-green-700",orange:"text-orange-700",blue:"text-blue-700",purple:"text-purple-700",red:"text-red-700"})[r],Gg=({workflow:r,onClick:t})=>e.jsx("button",{onClick:()=>t(r.id),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${zg(r.color)}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Ug(r.color)}`,children:e.jsx(C,{path:r.icon,size:1.2,className:qg(r.color)})}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold text-sm ${Hg(r.color)}`,children:r.name}),e.jsx("p",{className:`text-xs ${Vg(r.color)}`,children:r.description}),e.jsx("p",{className:`text-xs mt-1 font-medium ${Wg(r.color)}`,children:r.statusRequirement})]})]})}),Rv=({onWorkflowSelect:r})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Select Workflow"}),e.jsx("div",{className:"space-y-3",children:Li.map(t=>e.jsx(Gg,{workflow:t,onClick:r},t.id))})]}),Bv=({workflowId:r,color:t="blue"})=>{const s=Lg(r);if(!s)return null;const n=()=>({blue:"bg-blue-50 border-blue-200 text-blue-800 text-blue-600",orange:"bg-orange-50 border-orange-200 text-orange-800 text-orange-600",purple:"bg-purple-50 border-purple-200 text-purple-800 text-purple-600"})[t],[a,i,c,o]=n().split(" ");return e.jsxs("div",{className:`${a} border ${i} rounded-lg p-3`,children:[e.jsxs("h3",{className:`font-semibold ${c} text-sm mb-1`,children:[s.name," Workflow"]}),e.jsx("p",{className:`${o} text-xs`,children:s.description}),e.jsxs("div",{className:"mt-2 text-xs text-blue-500",children:[e.jsx("strong",{children:"Tool Status:"})," ",s.statusRequirement]})]})},Fv=({isScanning:r,scanMessage:t,onScan:s,size:n="large",showCameraStatus:a=!0})=>{const i=n==="large",c=i?"w-48 h-32":"w-32 h-24",o=i?"w-4 h-4":"w-3 h-3",l=i?"p-4":"p-3",d=i?1.5:1.2,x=i?"w-2 h-2":"w-1.5 h-1.5",m="text-xs",p=i?"bottom-4 right-4":"bottom-2 right-2",f=i?"h-48":"h-32",g=i?"text-lg":"text-base",v=i?"text-sm":"text-xs",j=()=>t?typeof t=="string"?t:t.text:null,h=()=>t?typeof t=="string"?"success":t.type:null;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("div",{className:`relative bg-black rounded-lg ${f} flex items-center justify-center`,children:[e.jsxs("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] ${c} rounded-lg`,children:[e.jsx("div",{className:`absolute top-0 left-0 ${o} border-t-2 border-l-2 border-[#4ECDC4] rounded-tl`}),e.jsx("div",{className:`absolute top-0 right-0 ${o} border-t-2 border-r-2 border-[#4ECDC4] rounded-tr`}),e.jsx("div",{className:`absolute bottom-0 left-0 ${o} border-b-2 border-l-2 border-[#4ECDC4] rounded-bl`}),e.jsx("div",{className:`absolute bottom-0 right-0 ${o} border-b-2 border-r-2 border-[#4ECDC4] rounded-br`})]}),a&&e.jsxs("div",{className:`absolute ${p} flex items-center`,children:[e.jsx("div",{className:`${x} rounded-full bg-red-500 mr-1 animate-pulse`}),e.jsx("span",{className:`text-white ${m}`,children:"Camera active"})]}),e.jsx("button",{onClick:s,disabled:r,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 ${l} rounded-full transition-all duration-200 ${r?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:e.jsx(C,{path:It,size:d,className:`${r?"text-gray-400":"text-white"}`})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`${g} font-medium text-gray-800 mb-1`,children:r?"Scanning...":"Click to Scan"}),e.jsx("p",{className:`text-gray-600 ${v}`,children:r?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),t&&e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-3 p-3 rounded-lg ${h()==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:It,size:.8,className:h()==="success"?"text-green-600":"text-red-600"}),e.jsx("span",{className:`font-medium text-sm ${h()==="success"?"text-green-800":"text-red-800"}`,children:j()})]})})]})};var vt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Kg=()=>{const[r,t]=u.useState([]),[s,n]=u.useState(null),[a,i]=u.useState(!1),[c,o]=u.useState(null),l=u.useCallback((j,h)=>vt(null,null,function*(){i(!0),o(null);try{const y=yield ht.uploadReceipt(j,h);return t(b=>[y,...b]),y}catch(y){const b=y instanceof Error?y.message:"Failed to upload receipt";throw o(b),y}finally{i(!1)}}),[]),d=u.useCallback(j=>vt(null,null,function*(){i(!0),o(null);try{const h=yield ht.getReceiptsByBatch(j);return t(h),h}catch(h){const y=h instanceof Error?h.message:"Failed to load receipts";throw o(y),h}finally{i(!1)}}),[]),x=u.useCallback((j=50,h=0)=>vt(null,null,function*(){i(!0),o(null);try{const y=yield ht.getAllReceipts(j,h);return t(y),y}catch(y){const b=y instanceof Error?y.message:"Failed to load receipts";throw o(b),y}finally{i(!1)}}),[]),m=u.useCallback(j=>vt(null,null,function*(){i(!0),o(null);try{yield ht.deleteReceipt(j),t(h=>h.filter(y=>y.id!==j))}catch(h){const y=h instanceof Error?h.message:"Failed to delete receipt";throw o(y),h}finally{i(!1)}}),[]),p=u.useCallback(()=>vt(null,null,function*(){i(!0),o(null);try{const j=yield ht.getFacilitySettings();return n(j),j}catch(j){const h=j instanceof Error?j.message:"Failed to load facility settings";throw o(h),j}finally{i(!1)}}),[]),f=u.useCallback(j=>vt(null,null,function*(){i(!0),o(null);try{const h=yield ht.updateFacilitySettings(j);return n(h),h}catch(h){const y=h instanceof Error?h.message:"Failed to update facility settings";throw o(y),h}finally{i(!1)}}),[]),g=u.useCallback(()=>{o(null)},[]),v=u.useCallback(()=>{t([])},[]);return{receipts:r,facilitySettings:s,loading:a,error:c,uploadReceipt:l,loadReceiptsByBatch:d,loadAllReceipts:x,deleteReceipt:m,loadFacilitySettings:p,updateFacilitySettings:f,clearError:g,clearReceipts:v}};var Qg=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Yg=()=>{const r=navigator.userAgent.toLowerCase(),s=["android","iphone","ipad","ipod","blackberry","windows phone","mobile","tablet"].some(c=>r.includes(c)),n="ontouchstart"in window||navigator.maxTouchPoints>0,a=window.innerWidth<=768,i="orientation"in window||"deviceorientation"in window;return s||n&&a||i},Jg=()=>Qg(null,null,function*(){try{return!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?!1:(yield navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="videoinput").length>0}catch(r){return console.warn("Error checking camera access:",r),!1}});var Xg=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Zg=({isMobile:r,hasCamera:t,onPhotoCapture:s,onCancel:n})=>{const[a,i]=u.useState(!1),c=u.useRef(null),o=u.useRef(null),l=u.useRef(null),d=u.useCallback(()=>Xg(null,null,function*(){if(!r){alert("Camera access is only available on mobile devices. Please use the file upload option instead.");return}if(!t){alert("No camera detected on this device. Please use file upload instead.");return}try{const p=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});c.current&&(c.current.srcObject=p,l.current=p,i(!0))}catch(p){console.error(p),alert("Unable to access camera. Please use file upload instead.")}}),[r,t]),x=u.useCallback(()=>{l.current&&(l.current.getTracks().forEach(p=>p.stop()),l.current=null),i(!1)},[]),m=u.useCallback(()=>{if(c.current&&o.current){const p=c.current,f=o.current,g=f.getContext("2d");g&&(f.width=p.videoWidth,f.height=p.videoHeight,g.drawImage(p,0,0),f.toBlob(v=>{if(v){const j=new File([v],`receipt-${Date.now()}.jpg`,{type:"image/jpeg"}),h=URL.createObjectURL(v);s(j,h),x()}},"image/jpeg",.8))}},[s,x]);return!r||!t?null:e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:d,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(C,{path:nc,size:1.2}),e.jsx("span",{children:"Take Photo"})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,className:"w-full h-64 object-cover rounded-md",children:e.jsx("track",{kind:"captions"})}),e.jsx("canvas",{ref:o,className:"hidden"})]}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsxs("button",{type:"button",onClick:m,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[e.jsx(C,{path:Ue,size:1}),e.jsx("span",{children:"Capture"})]}),e.jsxs("button",{type:"button",onClick:x,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[e.jsx(C,{path:ae,size:1}),e.jsx("span",{children:"Cancel"})]})]})]})})]})};var Kn=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const ef=({photoFile:r,photoPreview:t,isMobile:s,onFileSelect:n,onClearPhoto:a})=>{const i=u.useRef(null),c=d=>Kn(null,null,function*(){if(d.type==="image/jpeg")return d;const x=yield createImageBitmap(d),m=document.createElement("canvas");m.width=x.width,m.height=x.height;const p=m.getContext("2d");if(!p)return d;p.drawImage(x,0,0);const f=yield new Promise(g=>m.toBlob(v=>g(v),"image/jpeg",.8));return f?new File([f],d.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}):d}),o=u.useCallback(d=>Kn(null,null,function*(){var x;const m=(x=d.target.files)==null?void 0:x[0];if(m&&m.type.startsWith("image/")){let p=m;p=yield c(p);const f=new FileReader;f.onload=g=>{var v;const j=(v=g.target)==null?void 0:v.result;n(p,j)},f.readAsDataURL(p)}}),[n]),l=u.useCallback(()=>{var d;(d=i.current)==null||d.click()},[]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"photo-upload",className:"block text-sm font-medium text-gray-700",children:"Receipt Photo *"}),t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:"Receipt preview",className:"w-full h-48 object-cover rounded-md border border-gray-300"}),e.jsx("button",{type:"button",onClick:a,className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(C,{path:ae,size:.8})})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Photo captured: ",(r==null?void 0:r.name)||"Receipt photo"]}),e.jsx("p",{className:"text-xs text-blue-600",children:"Note: Photos are uploaded directly to Cliniio and not stored on your device"})]}):e.jsxs("div",{className:"space-y-2",children:[!s&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-md mb-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:xt,size:1,className:"text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Camera access is only available on mobile devices. Please use the file upload option below."})]})}),e.jsxs("button",{type:"button",onClick:l,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[e.jsx(C,{path:Cs,size:1.2}),e.jsx("span",{children:"Choose File"})]}),e.jsx("input",{ref:i,id:"photo-upload",type:"file",accept:"image/*",onChange:o,className:"hidden"}),e.jsx("p",{className:"text-xs text-blue-600 text-center",children:"Photos are uploaded directly to Cliniio and not stored on your device"})]})]})},tf=({cycleNumber:r,temperatureEvidence:t,onCycleNumberChange:s,onTemperatureEvidenceChange:n})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cycleNumber",className:"block text-sm font-medium text-gray-700",children:"Cycle Number (Optional)"}),e.jsx("input",{type:"text",id:"cycleNumber",value:r,onChange:a=>s(a.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., CYC-2024-001"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temperatureEvidence",className:"block text-sm font-medium text-gray-700",children:"Temperature Evidence (Optional)"}),e.jsx("textarea",{id:"temperatureEvidence",value:t,onChange:a=>n(a.target.value),rows:3,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Temperature reached 121°C for 4 minutes"})]})]});var Qn=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const sf=({batchCode:r,operator:t,onSuccess:s,onCancel:n})=>{const{uploadReceipt:a,loading:i,error:c}=Kg(),[o,l]=u.useState(null),[d,x]=u.useState(null),[m,p]=u.useState(""),[f,g]=u.useState(""),[v,j]=u.useState(!1),[h,y]=u.useState(!1),[b,_]=u.useState(null);u.useEffect(()=>{Qn(null,null,function*(){const k=Yg(),S=yield Jg();j(k),y(S)})},[]),u.useEffect(()=>()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d)},[d]);const P=u.useCallback((T,k)=>{l(T),x(k)},[]),$=u.useCallback((T,k)=>{l(T),x(k)},[]),D=u.useCallback(()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),l(null),x(null)},[d]),w=u.useCallback(T=>Qn(null,null,function*(){if(T.preventDefault(),!o){alert("Please select or capture a photo of the receipt");return}try{const k={batchCode:r,cycleNumber:m||void 0,photoFile:o,temperatureEvidence:f||void 0};_("Compressing image for optimal storage...");const S=yield a(k,t);d&&d.startsWith("blob:")&&URL.revokeObjectURL(d);const I=S.photoSize<o.size?` (compressed from ${(o.size/1024).toFixed(1)}KB to ${(S.photoSize/1024).toFixed(1)}KB)`:"";_(`Receipt uploaded successfully!${I}`),s==null||s(S)}catch(k){console.error("Error uploading receipt:",k);const S=k instanceof Error?k.message:"Error uploading receipt";_(`Upload failed: ${S}`)}}),[o,r,m,f,a,t,s,d]);return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Upload Autoclave Receipt"})}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Batch Code:"})," ",r]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Zg,{isMobile:v,hasCamera:h,onPhotoCapture:P}),v&&h&&e.jsx("div",{className:"text-center text-gray-500 text-sm",children:"or"}),e.jsx(ef,{photoFile:o,photoPreview:d,isMobile:v,onFileSelect:$,onClearPhoto:D})]}),e.jsx(tf,{cycleNumber:m,temperatureEvidence:f,onCycleNumberChange:p,onTemperatureEvidenceChange:g}),c&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800",children:c})}),b&&e.jsx("div",{className:`p-3 rounded-md ${b.includes("successfully")?"bg-green-50 border border-green-200":b.includes("failed")?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"}`,children:e.jsx("p",{className:`text-sm ${b.includes("successfully")?"text-green-800":b.includes("failed")?"text-red-800":"text-blue-800"}`,children:b})}),e.jsx("button",{type:"submit",disabled:!o||i,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{path:Cs,size:1.2}),e.jsx("span",{children:"Upload Receipt"})]})})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:n,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to Workflow Selection"})})]})},rf=[{type:"damaged",label:"Damaged",description:"Physical damage or broken parts"},{type:"improperly_cleaned",label:"Improperly Cleaned",description:"Rust, residue, or staining"},{type:"worn_out",label:"Worn Out",description:"Excessive wear or dull edges"},{type:"other",label:"Other",description:"Other issues not listed above"}],af=({selectedProblemType:r,onProblemTypeSelect:t})=>e.jsx("div",{className:"space-y-3",children:rf.map(s=>e.jsx("button",{onClick:()=>t(s.type),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${r===s.type?"border-red-300 bg-red-50":"border-gray-200 hover:border-red-200 bg-white hover:bg-red-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.label}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),r===s.type&&e.jsx(C,{path:Ue,size:1,className:"text-red-600"})]})},s.type))}),nf=()=>{const[r,t]=u.useState(!1),s=u.useRef(null);return u.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition;s.current=new i,s.current.continuous=!1,s.current.interimResults=!1,s.current.lang="en-US",s.current.onresult=c=>{const o=c.results[0][0].transcript;return t(!1),o},s.current.onerror=c=>{console.error("Speech recognition error:",c.error),t(!1)},s.current.onend=()=>{t(!1)}}},[]),{isRecording:r,startRecording:i=>{s.current&&(t(!0),s.current.onresult=c=>{const o=c.results[0][0].transcript;i(o),t(!1)},s.current.start())},stopRecording:()=>{s.current&&s.current.stop()}}},lf=({value:r,onChange:t})=>{const{isRecording:s,startRecording:n,stopRecording:a}=nf(),i=()=>{s?a():n(c=>{t(c)})};return e.jsxs(me.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:[e.jsx("label",{htmlFor:"problem-description",className:"block text-sm font-medium text-gray-700",children:"Describe the problem"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("textarea",{id:"problem-description",value:r,onChange:c=>t(c.target.value),placeholder:"Describe the issue...",className:"flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 resize-none",rows:3}),e.jsx("button",{onClick:i,className:`p-3 rounded-md transition-colors ${s?"bg-red-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:s?"Stop recording":"Voice input",children:e.jsx(C,{path:s?lc:ic,size:1})})]}),s&&e.jsx("p",{className:"text-sm text-red-600",children:"Recording... Speak now"})]})};var of=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Mv=({onClose:r})=>{const[t,s]=u.useState(!1),[n,a]=u.useState(""),[i,c]=u.useState(null),[o,l]=u.useState(""),[d,x]=u.useState(!1),[m,p]=u.useState(null),[f,g]=u.useState(""),[v,j]=u.useState(!1),{availableTools:h,markToolAsProblem:y}=W(),b=()=>{s(!0),l("Scanning tool..."),setTimeout(()=>{const P=h.filter(w=>w.barcode).map(w=>w.barcode);if(P.length===0){c("error"),l("No tools available for scanning"),s(!1);return}const $=P[Math.floor(Math.random()*P.length)],D=h.find(w=>w.barcode===$);D?(a($),c("success"),l(`Successfully scanned ${D.name}`),x(!0)):(c("error"),l("Tool not found in system")),s(!1)},1e3)},_=()=>of(null,null,function*(){if(!(!m||!n)){j(!0);try{const{data:{user:P},error:$}=yield K.auth.getUser();if($||!P){l("Authentication error. Please log in again.");return}const D=yield ai.scanToolForProblemWorkflow(n,m,f||"No additional notes provided",P.id);if(D.success){l(D.message);const w=h.find(T=>T.barcode===n);w&&console.log(`Tool ${w.id} marked as problem: ${m}`),setTimeout(()=>{r()},2e3)}else l(D.message)}catch(P){console.error("Error reporting tool problem:",P),l("Error reporting tool problem. Please try again.")}finally{j(!1)}}});return e.jsxs("div",{className:"space-y-6",children:[d?e.jsxs(me.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Report Tool Problem"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Tool: ",n]})]}),e.jsx(af,{selectedProblemType:m,onProblemTypeSelect:p}),m==="other"&&e.jsx(lf,{value:f,onChange:g}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Back"}),e.jsx("button",{onClick:_,disabled:!m||v,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Processing...":"Report Problem"})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:r,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to Workflow Selection"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-1",children:"Tool Problem Workflow"}),e.jsx("p",{className:"text-red-600 text-sm",children:"Report tool issues or problems"}),e.jsxs("div",{className:"mt-2 text-xs text-red-500",children:[e.jsx("strong",{children:"Tool Status:"})," Any status → Problem"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative bg-black rounded-lg h-48 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-32 rounded-lg",children:[e.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),e.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),e.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),e.jsx("button",{onClick:b,disabled:t,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${t?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:e.jsx(C,{path:It,size:1.5,className:`${t?"text-gray-400":"text-white"}`})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:t?"Scanning...":"Click to Scan"}),e.jsx("p",{className:"text-gray-600 text-sm",children:t?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),i&&e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg ${i==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:It,size:1,className:i==="success"?"text-green-600":"text-red-600"}),e.jsx("span",{className:`font-medium ${i==="success"?"text-green-800":"text-red-800"}`,children:o})]})})]})]}),!d&&e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:r,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to Workflow Selection"})})]})},cf=()=>{const r=new Date,t=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/(1e3*60*60*24)),s=t%26,n=t%9+1;return`${String.fromCharCode(65+s)}${n}`},df=()=>cf();var uf=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const mf=({scannedData:r,toolId:t})=>{const{availableTools:s}=W(),[n]=u.useState(df()),[a,i]=u.useState(!1),c=u.useCallback(d=>s.find(x=>x.barcode===d),[s]),o=u.useCallback(()=>t?s.find(d=>d.id===t):c(r),[t,s,c,r]);u.useEffect(()=>{const d=o();d&&d.currentPhase==="complete"&&r&&console.log(`Tool ${d.id} marked as dirty`)},[r,o,n]);const l=()=>uf(null,null,function*(){try{yield navigator.clipboard.writeText(n),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error("Failed to copy code:",d)}});return{tool:o(),traceabilityCode:n,copied:a,handleCopyCode:l}},xf=({traceabilityCode:r,copied:t,onCopyCode:s})=>e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx(C,{path:yr,size:1.2,className:"text-blue-600"}),e.jsx("h4",{className:"text-lg font-semibold text-blue-800",children:"Traceability Code"})]}),e.jsx("p",{className:"text-blue-700 mb-4 text-sm",children:"Enter this code in your patient chart for compliance tracking"}),e.jsx("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 mb-4",children:e.jsx("div",{className:"text-4xl font-bold text-blue-800 tracking-wider font-mono",children:r})}),e.jsxs("button",{onClick:s,className:`flex items-center gap-2 mx-auto px-4 py-2 rounded-lg transition-all duration-200 ${t?"bg-green-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[e.jsx(C,{path:t?Se:xi,size:1}),e.jsx("span",{children:t?"Copied!":"Copy Code"})]}),e.jsxs("button",{onClick:()=>{const n=`EMR-${Date.now()}-${Math.random().toString(36).substr(2,6).toUpperCase()}`;navigator.clipboard.writeText(n),alert(`EMR ID generated and copied: ${n}`)},className:"flex items-center gap-2 mx-auto mt-3 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all duration-200",children:[e.jsx(C,{path:yr,size:1}),e.jsx("span",{children:"Generate EMR ID"})]})]})});function Lv({scannedData:r,onClose:t,toolId:s}){const{tool:n,traceabilityCode:a,copied:i,handleCopyCode:c}=mf({scannedData:r,toolId:s});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(me.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:Se,size:1.2,className:"text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Tool Ready for Use"})]}),e.jsx("p",{className:"text-green-700 mb-2",children:n?`${n.name} is clean and ready for patient use.`:"Tool is clean and ready for patient use."}),e.jsxs("p",{className:"text-sm text-green-600",children:["Scanned: ",r]})]}),e.jsx(xf,{traceabilityCode:a,copied:i,onCopyCode:c}),e.jsxs(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-md font-semibold text-orange-800 mb-2",children:"Status Update"}),e.jsxs("p",{className:"text-orange-700 mb-2",children:[e.jsx("strong",{children:'Tool has been marked as "dirty"'})," and will need sterilization after use."]}),e.jsx("p",{className:"text-sm text-orange-600",children:"This change is automatically reflected in the inventory system."})]}),e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},className:"flex gap-2",children:e.jsx("button",{onClick:t,className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition-colors font-medium",children:"Confirm & Close"})})]})}var jt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const pf=(r,t)=>{const{currentSession:s,startPackagingSession:n,addToolToSession:a,removeToolFromSession:i,generateBatchId:c,assignBatchIdToSession:o,endPackagingSession:l}=W(),{currentUser:d}=$e(),{getCurrentFacilityId:x}=Rr(),[m,p]=u.useState(""),[f,g]=u.useState(""),[v,j]=u.useState(""),[h,y]=u.useState(null),[b,_]=u.useState({packageType:"",packageSize:"",notes:""}),[P,$]=u.useState(!1),[D,w]=u.useState(!1),[T,k]=u.useState([]),[S,I]=u.useState([]),[E,O]=u.useState(!1),[A,B]=u.useState(""),[R,Q]=u.useState(null),q=W(J=>J.currentBatch)||null,M=W(J=>J.batchLoading)||!1,H=u.useCallback(()=>jt(null,null,function*(){try{const J=yield Gr.getToolsReadyForPackaging();k(J)}catch(J){console.error("Error loading tools ready for packaging:",J),j("Error loading tools ready for packaging")}}),[]),V=u.useCallback(J=>jt(null,null,function*(){g(J),y(null),j("Processing scan...");const ne=T.find(Y=>Y.barcode===J);if(!ne){y("error"),j("Tool not found or not ready for packaging");return}if(S.find(Y=>Y.id===ne.id)){y("error"),j("Tool already added to package");return}if(I(Y=>[...Y,ne]),a(J),t&&q){const Y=W.getState().addToolToBatch;Y(ne.id)}y("success"),j(`Successfully added ${ne.name} to package`),setTimeout(()=>{g(""),j(""),y(null)},2e3)}),[T,S,a,t,q]),X=u.useCallback(()=>{if(T.length===0){y("error"),j("No tools available for packaging");return}const J=T[Math.floor(Math.random()*T.length)];V(J.barcode)},[T,V]),ie=u.useCallback(J=>jt(null,null,function*(){if(!s){j("Please start a packaging session first");return}try{j("Creating new autoclave load...");const ne=J?`${J}${Math.floor(1e3+Math.random()*9e3)}`:c();o(ne);const Y=W.getState().createBatch;yield Y(m,!0),j("New autoclave load created successfully!"),setTimeout(()=>{j("")},2e3)}catch(ne){j("Error creating new autoclave load"),console.error("Error creating new autoclave load:",ne)}}),[s,m,c,o]),te=u.useCallback(()=>{if(!(q!=null&&q.batchCode)){j("Please create a batch first before uploading receipts");return}w(!0)},[q==null?void 0:q.batchCode]),Ge=u.useCallback(()=>{w(!1),j("Receipt uploaded successfully!"),setTimeout(()=>{j("")},2e3)},[]),Ze=u.useCallback(()=>{w(!1)},[]),U=u.useCallback(()=>jt(null,null,function*(){try{j("Creating package...");const J=yield Gr.createPackage(S.map(ne=>ne.id),b,m);J.success?(j(J.message),I([]),$(!1),yield H(),setTimeout(()=>{r()},3e3)):j(J.message)}catch(J){console.error("Error finalizing package:",J),j("Error creating package. Please try again.")}}),[S,b,m,H,r]),de=u.useCallback(()=>jt(null,null,function*(){if(!A){alert("Please scan a location barcode first.");return}const J={batchId:(s==null?void 0:s.currentBatchId)||"",toolsCount:S.length,assignedLocation:A,technicianId:d==null?void 0:d.id},ne=yield ni(J);if(Q(ne.status),ne.status==="invalid_location"){alert(`⚠️ Location "${A}" is not valid for this facility. Please check the location name.`);return}try{s!=null&&s.currentBatchId&&(yield K.from("sterilization_batches").update({location_barcode:A}).eq("id",s.currentBatchId)),yield K.from("inventory_items").update({scanned_location:A}).in("id",S.map(Y=>Y.id)),alert(`✅ Location ${A} assigned successfully`),O(!1),B(""),yield U()}catch(Y){console.error("Error assigning location:",Y),alert("Error assigning location. Please try again.")}}),[A,S,s,d,U]),se=u.useCallback(()=>jt(null,null,function*(){if(S.length===0){j("No tools selected for packaging");return}if(!b.packageType){j("Please select a package type");return}O(!0)}),[S,b]),et=u.useCallback(()=>{l(),I([]),j(""),y(null),r()},[l,r]),Ke=u.useCallback(J=>{const ne=S.find(Y=>Y.id===J);if(ne&&(I(Y=>Y.filter(N=>N.id!==J)),i(ne.barcode),t&&q)){const Y=W.getState().removeToolFromBatch;Y(J)}},[S,i,t,q]),tt=u.useCallback(()=>{if(!m.trim()){j("Please enter operator name");return}const J=x()||"unknown-facility";n(m,J)},[m,n,x]);return{operatorName:m,scannedBarcode:f,scanMessage:v,scanResult:h,packageInfo:b,showPackageForm:P,showReceiptUpload:D,scannedTools:S,batchLoading:M,currentSession:s,availableTools:T,isAssigning:E,locationCode:A,locationStatus:R,setOperatorName:p,setScannedBarcode:g,setPackageInfo:_,setShowPackageForm:$,setLocationCode:B,setIsAssigning:O,handleScan:V,simulateScan:X,handleNewAutoclaveLoad:ie,handleImportReceipt:te,handleReceiptUploadSuccess:Ge,handleReceiptUploadCancel:Ze,handleFinalizePackage:se,handleAssignLocation:de,handleEndSession:et,handleRemoveTool:Ke,handleStartSession:tt,loadToolsReadyForPackaging:H}},hf=({operatorName:r,isBatchMode:t,onEndSession:s})=>e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Packaging Workflow"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t?"Batch Mode":"Single Tool Mode"," - Operator:"," ",r]})]}),e.jsxs("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:[e.jsx(le,{path:ae,size:1.5}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),gf=({scannedBarcode:r,scanMessage:t,scanResult:s,onScan:n,onBarcodeChange:a,onSimulateScan:i,onNewAutoclaveLoad:c,onImportReceipt:o,currentBatchCode:l,availableTools:d})=>{const x=m=>{m.key==="Enter"&&n(r)};return e.jsxs("div",{className:"mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{path:oc,size:1.2,className:"text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-800",children:"Scanner"})]}),e.jsx("button",{onClick:i,disabled:d.length===0,className:`px-3 py-1 text-sm rounded-md transition-colors ${d.length===0?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:"Simulate Scan"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(le,{path:qe,size:1,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Tools Ready for Packaging"})]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[d.length," tools available for packaging"]}),d.length>0&&e.jsx("div",{className:"mt-2 text-xs text-blue-600",children:e.jsxs("p",{children:["Available barcodes:"," ",d.slice(0,3).map(m=>m.barcode).join(", "),d.length>3&&`... and ${d.length-3} more`]})})]}),l&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Current Batch:"})," ",l]})}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[c&&e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[e.jsx(le,{path:He,size:1}),e.jsx("span",{children:"+ New Autoclave Load"})]}),o&&e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(le,{path:Ne,size:1}),e.jsx("span",{children:"Import Receipt"})]})]}),s&&e.jsx("div",{className:`p-3 rounded-md mb-3 ${s==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:r,onChange:m=>a(m.target.value),onKeyPress:x,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter barcode manually or scan..."}),e.jsx("button",{onClick:()=>n(r),disabled:!r.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Scan Tool"})]})]})},ff=({scannedTools:r,onRemoveTool:t,onFinalizePackage:s})=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-800",children:["Scanned Tools (",r.length,")"]}),r.length>0&&e.jsx("button",{onClick:s,className:"px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors",children:"Finalize Package"})]}),r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{path:ut,size:2,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No tools scanned yet"}),e.jsx("p",{className:"text-sm",children:"Scan tools to add them to the package"})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Barcode: ",n.barcode]})]}),e.jsxs("button",{onClick:()=>t(n.id),className:"p-1 text-red-500 hover:text-red-700 transition-colors",children:[e.jsx(le,{path:li,size:1}),e.jsx("span",{className:"sr-only",children:"Remove"})]})]},n.id))})]});var bf=Object.defineProperty,yf=Object.defineProperties,vf=Object.getOwnPropertyDescriptors,Yn=Object.getOwnPropertySymbols,jf=Object.prototype.hasOwnProperty,wf=Object.prototype.propertyIsEnumerable,Jn=(r,t,s)=>t in r?bf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,ir=(r,t)=>{for(var s in t||(t={}))jf.call(t,s)&&Jn(r,s,t[s]);if(Yn)for(var s of Yn(t))wf.call(t,s)&&Jn(r,s,t[s]);return r},or=(r,t)=>yf(r,vf(t));const Nf=({packageInfo:r,batchLoading:t,onPackageInfoChange:s,onFinalizePackage:n,onCancel:a,packageTypes:i,packageSizes:c})=>{const o=x=>{s(or(ir({},r),{packageType:x}))},l=x=>{s(or(ir({},r),{packageSize:x}))},d=x=>{s(or(ir({},r),{notes:x}))};return e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-3",children:"Package Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"package-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Type"}),e.jsxs("select",{id:"package-type",value:r.packageType,onChange:x=>o(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select package type"}),i.map(x=>e.jsx("option",{value:x,children:x.charAt(0).toUpperCase()+x.slice(1)},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"package-size",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Size"}),e.jsxs("select",{id:"package-size",value:r.packageSize,onChange:x=>l(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select package size"}),c.map(x=>e.jsx("option",{value:x,children:x.charAt(0).toUpperCase()+x.slice(1).replace("-"," ")},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"package-notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{id:"package-notes",value:r.notes,onChange:x=>d(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"Additional notes about the package..."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:n,disabled:t||!r.packageType||!r.packageSize,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:t?"Processing...":"Generate Batch Code"})]})]})},Cf=({operatorName:r,onOperatorNameChange:t,onStartSession:s,onCancel:n})=>e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Packaging Workflow"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Operator Name"}),e.jsx("input",{id:"operator-name",type:"text",value:r,onChange:a=>t(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter your name"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:s,disabled:!r.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 transition-colors",children:"Start Session"})]})]});var Xn=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const zv=({onClose:r,isBatchMode:t})=>{const{currentUser:s}=$e(),[n,a]=u.useState(!1),[i,c]=u.useState(["pouch","wrap","container","tray"]),[o,l]=u.useState(["small","medium","large","extra-large"]),[d,x]=u.useState("PKG-"),[m,p]=u.useState(25),[f,g]=u.useState(!1),[v,j]=u.useState(null);u.useEffect(()=>{Xn(null,null,function*(){try{if(!(s!=null&&s.facility_id))return;const{data:N,error:F}=yield K.from("facility_settings").select("packaging_settings").eq("facility_id",s.facility_id).single();if(F)console.warn("No packaging settings found, using defaults");else if(N!=null&&N.packaging_settings){const L=N.packaging_settings;c(z=>L.packageTypes||z),l(z=>L.packageSizes||z),x(z=>L.batchPrefix||z),p(z=>L.maxToolsPerBatch||z),g(!!L.requireReceiptUpload)}}catch(N){console.error("Error loading packaging settings:",N)}finally{a(!0)}})},[s]);const h=pf(r,t);Z.useEffect(()=>{h!=null&&h.loadToolsReadyForPackaging&&h.loadToolsReadyForPackaging()},[h]);const y=Y=>{if(I.length>=m){alert(`❗ Maximum batch size reached. You can only package up to ${m} tools per batch.`);return}h==null||h.handleScan(Y)},b=Y=>Xn(null,null,function*(){j({url:Y.photoUrl,id:Y.id});try{Y&&(O!=null&&O.currentBatchId)&&(s!=null&&s.facility_id)&&(yield vg(Y.id||Y.photoUrl||"unknown",O.currentBatchId,(s==null?void 0:s.name)||"Unknown Operator",s.facility_id))}catch(N){console.error("Failed to log receipt upload audit event:",N)}h==null||h.handleReceiptUploadSuccess()}),_=()=>{if(f&&(!v||!v.url)){alert("📄 Receipt upload required before completing this batch.");return}h==null||h.handleFinalizePackage()};if(!n)return e.jsx("p",{className:"text-sm text-gray-500",children:"Loading Packaging Settings..."});if(!h)return e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading packaging workflow..."})]})});const{operatorName:P,scannedBarcode:$,scanMessage:D,scanResult:w,packageInfo:T,showPackageForm:k,showReceiptUpload:S,scannedTools:I,batchLoading:E,currentSession:O,availableTools:A,isAssigning:B,locationCode:R,locationStatus:Q,setOperatorName:q,setScannedBarcode:M,setPackageInfo:H,setShowPackageForm:V,setLocationCode:X,setIsAssigning:ie,handleScan:te,simulateScan:Ge,handleNewAutoclaveLoad:Ze,handleImportReceipt:U,handleReceiptUploadSuccess:de,handleReceiptUploadCancel:se,handleFinalizePackage:et,handleAssignLocation:Ke,handleEndSession:tt,handleRemoveTool:J,handleStartSession:ne}=h;return O?S?e.jsx(sf,{batchCode:O.currentBatchId||"",operator:P,onSuccess:b,onCancel:se}):B?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999] p-4",children:e.jsx("div",{className:"bg-white rounded-xl overflow-hidden w-full max-w-md shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Room Assignment"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 mb-2",children:"Scan or enter location barcode:"}),e.jsx("input",{id:"location",type:"text",value:R,onChange:Y=>X(Y.target.value),placeholder:"e.g., ROOM-1-CUPBOARD-A",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ie(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Ke,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Assign Location"})]}),Q&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Location Status: ",Q]})]})]})})}):e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:[e.jsx(hf,{operatorName:P,isBatchMode:t,onEndSession:tt}),e.jsx(gf,{scannedBarcode:$,scanMessage:D,scanResult:w,onScan:y,onBarcodeChange:M,onSimulateScan:Ge,onNewAutoclaveLoad:()=>Ze(d),onImportReceipt:U,currentBatchCode:O.currentBatchId||void 0,availableTools:A}),e.jsx(ff,{scannedTools:I,onRemoveTool:J,onFinalizePackage:()=>V(!0)}),f&&!v&&e.jsxs("div",{className:"mb-4 rounded-md bg-yellow-100 border border-yellow-300 px-4 py-3 text-sm text-yellow-800 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-yellow-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Receipt upload required before finalizing this batch."})]}),k&&e.jsx(Nf,{packageInfo:T,batchLoading:E,onPackageInfoChange:H,onFinalizePackage:_,onCancel:()=>V(!1),packageTypes:i,packageSizes:o}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Session ID: ",O==null?void 0:O.id]}),e.jsxs("p",{children:["Started:"," ",O!=null&&O.startedAt?new Date(O.startedAt).toLocaleTimeString():"N/A"]}),e.jsxs("p",{children:["Tools Ready: ",A.length]})]})]}):e.jsx(Cf,{operatorName:P,onOperatorNameChange:q,onStartSession:ne,onCancel:r})},Uv=({tool:r,onDismiss:t,onReplace:s,onContinue:n})=>{const a=(r.maxCycles||200)-r.cycleCount;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:ce,size:1.5,className:"text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tool Replacement Required"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(C,{path:ae,size:1})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{path:qe,size:1,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-red-800 font-medium mb-2",children:[r.name," (Barcode: ",r.barcode,")"]}),e.jsxs("p",{className:"text-red-700 text-sm",children:["This tool has completed ",e.jsx("strong",{children:r.cycleCount})," ","sterilization cycles and has reached the maximum recommended limit of ",r.maxCycles||200," cycles."]}),a<=0&&e.jsx("p",{className:"text-red-700 text-sm font-medium mt-2",children:"⚠️ This tool has exceeded the maximum cycle limit and should be replaced immediately."}),a>0&&a<=5&&e.jsxs("p",{className:"text-orange-700 text-sm font-medium mt-2",children:["⚠️ Only ",a," cycle",a!==1?"s":""," remaining before replacement is required."]})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cycle Information"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Current Cycles:"}),e.jsx("span",{className:"font-medium",children:r.cycleCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Maximum Cycles:"}),e.jsx("span",{className:"font-medium",children:r.maxCycles||200})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cycles Remaining:"}),e.jsx("span",{className:`font-medium ${a<=0?"text-red-600":a<=5?"text-orange-600":"text-green-600"}`,children:a<=0?"Exceeded":a})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Recommendation"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"For patient safety and compliance, it is recommended to replace this tool with a new one. Continued use beyond the cycle limit may compromise sterilization effectiveness."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:s,className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Replace Tool"}),e.jsx("button",{onClick:n,className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"Continue Anyway"})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 text-sm transition-colors",children:"Dismiss"})})]})})};var Gt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Sf=Oe(r=>({users:[],roles:[],userRoles:[],loading:!1,error:null,fetchUsers(t){return Gt(this,null,function*(){r({loading:!0,error:null});try{const s=yield At.getUsers(t);console.log("🔍 Store.fetchUsers - Received users:",s),console.log("🔍 Store.fetchUsers - First user:",s[0]),r({users:s,loading:!1})}catch(s){console.error("🔍 Store.fetchUsers - Error:",s),r({error:s instanceof Error?s.message:String(s),loading:!1})}})},fetchRoles(t){return Gt(this,null,function*(){r({loading:!0,error:null});try{const s=yield At.getRoles(t);r({roles:s,loading:!1})}catch(s){r({error:s instanceof Error?s.message:String(s),loading:!1})}})},fetchUserRoles(t){return Gt(this,null,function*(){r({loading:!0,error:null});try{const s=yield At.getUserRoles(t);r({userRoles:s,loading:!1})}catch(s){r({error:s instanceof Error?s.message:String(s),loading:!1})}})},assignRole(t,s,n){return Gt(this,null,function*(){r({loading:!0});try{yield At.assignUserRole(t,s,n),yield this.fetchUserRoles(s),r({loading:!1})}catch(a){r({error:a instanceof Error?a.message:String(a),loading:!1})}})},removeRole(t,s,n){return Gt(this,null,function*(){r({loading:!0});try{yield At.softDeleteUser(t,s),yield this.fetchUserRoles(s),r({loading:!1})}catch(a){r({error:a instanceof Error?a.message:String(a),loading:!1})}})},clearRoles(){r({users:[],roles:[],userRoles:[],error:null,loading:!1})}}));var _f=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});function Tf(r){const{users:t,roles:s,userRoles:n,loading:a,error:i,fetchUsers:c,fetchRoles:o,fetchUserRoles:l,assignRole:d,removeRole:x,clearRoles:m}=Sf(),p=u.useCallback(()=>_f(null,null,function*(){yield Promise.all([c(r),o(r),l(r)])}),[r,c,o,l]);return u.useEffect(()=>(p(),()=>m()),[r,p,m]),{users:t,roles:s,userRoles:n,loading:a,error:i,assignRole:d,removeRole:x,reload:p}}var kf=Object.defineProperty,If=Object.defineProperties,Pf=Object.getOwnPropertyDescriptors,Zn=Object.getOwnPropertySymbols,Df=Object.prototype.hasOwnProperty,Ef=Object.prototype.propertyIsEnumerable,el=(r,t,s)=>t in r?kf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,xe=(r,t)=>{for(var s in t||(t={}))Df.call(t,s)&&el(r,s,t[s]);if(Zn)for(var s of Zn(t))Ef.call(t,s)&&el(r,s,t[s]);return r},pe=(r,t)=>If(r,Pf(t)),wt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});function qv(){const{currentUser:r}=$e(),t=(r==null?void 0:r.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{users:s,loading:n,error:a,assignRole:i,removeRole:c,reload:o}=Tf(t),[l,d]=u.useState(""),[x,m]=u.useState(null),[p,f]=u.useState(!1),[g,v]=u.useState(!1),[j,h]=u.useState(!1),[y,b]=u.useState(null),[_,P]=u.useState(null),[$,D]=u.useState({name:"",description:"",permissions:{}}),[w,T]=u.useState(null),[k,S]=u.useState({first_name:"",last_name:"",email:"",role:"",permissions:{}}),[I,E]=u.useState({first_name:"",last_name:"",email:"",role:"",permissions:{}}),O=s.filter(N=>{var F,L,z;if(!l.trim())return!0;const Qe=l.toLowerCase(),st=((F=N.first_name)==null?void 0:F.toLowerCase())||"",ls=((L=N.last_name)==null?void 0:L.toLowerCase())||"",is=((z=N.email)==null?void 0:z.toLowerCase())||"";return st.includes(Qe)||ls.includes(Qe)||is.includes(Qe)});if(u.useEffect(()=>{if(a&&console.error("User Management error:",a),console.log("🔍 Debug - All users:",s),console.log("🔍 Debug - Filtered users:",O),console.log("🔍 Debug - Search term:",l),s.length>0){const N=s[0];console.log("🔍 Debug - First user name fields:",{id:N.id,first_name:N.first_name,last_name:N.last_name,email:N.email,full_name:N.full_name})}},[a,s,O,l]),u.useEffect(()=>{wt(null,null,function*(){try{const F=yield Rt.checkTierLimits(t);T(F)}catch(F){console.error("Error fetching tier info:",F)}})},[t,s.length]),n)return e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading user management data..."})]});if(a)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("p",{className:"text-red-600",children:["Error loading user data: ",a]})});const A=N=>{m(N),E({first_name:N.first_name||"",last_name:N.last_name||"",email:N.email||"",role:N.role||"",permissions:N.permissions||{}})},B=N=>{const F=Q(N);E(pe(xe({},I),{role:N,permissions:F}))},R=(N,F)=>{const L=pe(xe({},I.permissions),{[N]:F}),z=q(L);E(pe(xe({},I),{role:z||"custom",permissions:L}))},Q=N=>({administrator:{view_dashboard:!0,view_analytics:!0,export_data:!0,manage_users:!0,assign_roles:!0,view_user_activity:!0,system_settings:!0,facility_settings:!0,security_settings:!0,create_tasks:!0,edit_tasks:!0,delete_tasks:!0,assign_tasks:!0,approve_content:!0},manager:{view_dashboard:!0,view_analytics:!0,export_data:!0,manage_users:!1,assign_roles:!0,view_user_activity:!0,system_settings:!1,facility_settings:!0,security_settings:!1,create_tasks:!0,edit_tasks:!0,delete_tasks:!0,assign_tasks:!0,approve_content:!0},technician:{view_dashboard:!0,view_analytics:!1,export_data:!1,manage_users:!1,assign_roles:!1,view_user_activity:!1,system_settings:!1,facility_settings:!1,security_settings:!1,create_tasks:!0,edit_tasks:!0,delete_tasks:!1,assign_tasks:!1},viewer:{view_dashboard:!0,view_analytics:!0,export_data:!1,manage_users:!1,assign_roles:!1,view_user_activity:!1,system_settings:!1,facility_settings:!1,security_settings:!1,create_tasks:!1,edit_tasks:!1,delete_tasks:!1,assign_tasks:!1},trainer:{view_dashboard:!0,view_analytics:!0,export_data:!0,manage_users:!1,assign_roles:!1,view_user_activity:!1,system_settings:!1,facility_settings:!0,security_settings:!1,create_tasks:!0,edit_tasks:!0,delete_tasks:!1,assign_tasks:!0},custom:{}})[N]||{},q=N=>{const F=["administrator","manager","technician","viewer","trainer"];for(const L of F){const z=Q(L);if(Object.keys(z).every(st=>N[st]===z[st]))return L}return null},M=N=>{b(N),h(!0)},H=()=>wt(null,null,function*(){if(y)try{yield c(y.id,t,y.role),yield Rt.cleanupUserInvitations(y.id,t),alert(`User ${y.first_name} ${y.last_name} has been removed from the facility.`),h(!1),b(null),yield o()}catch(N){console.error("Error deleting user:",N),alert(`Failed to remove user: ${N instanceof Error?N.message:"Unknown error"}`)}}),V=()=>{h(!1),b(null)},X=()=>wt(null,null,function*(){if(x)try{yield i(x.id,t,I.role),m(null),yield o()}catch(N){console.error("Error updating user:",N)}}),ie=()=>{m(null),E({first_name:"",last_name:"",email:"",role:"",permissions:{}})},te=()=>{f(!0),S({first_name:"",last_name:"",email:"",role:"",permissions:{}})},Ge=()=>{f(!1),S({first_name:"",last_name:"",email:"",role:"",permissions:{}})},Ze=()=>wt(null,null,function*(){if(!k.first_name||!k.last_name||!k.email||!k.role){alert("Please fill in all required fields");return}try{const N=yield Rt.checkTierLimits(t);if(!N.canAdd){alert(`You've reached the user limit for your ${N.tier} tier (${N.currentCount}/${N.limit}). Please upgrade your plan to add more users.`);return}const F={first_name:k.first_name,last_name:k.last_name,facility_id:t,role:k.role,permissions:k.permissions},{data:L,error:z}=yield Rt.sendInvitation(k.email,F);if(z){console.error("Invitation error:",z),alert(`Failed to send invitation: ${z instanceof Error?z.message:String(z)}`);return}const Qe=yield Rt.createInvitation({email:k.email,facility_id:t,invited_by:(r==null?void 0:r.id)||"",role:k.role,permissions:k.permissions});alert(`Invitation sent successfully to ${k.email}! They will receive an email to complete their registration.`),f(!1),yield o()}catch(N){console.error("Error adding user:",N),alert("An error occurred while sending the invitation. Please try again.")}}),U=N=>{const F=Q(N);S(pe(xe({},k),{role:N,permissions:F}))},de=(N,F)=>{const L=pe(xe({},k.permissions),{[N]:F}),z=q(L);S(pe(xe({},k),{role:z||"custom",permissions:L}))},se=()=>{v(!0),P(null),D({name:"",description:"",permissions:{}})},et=N=>{P(N),D({name:N.role_name||"",description:N.description||"",permissions:N.permissions||{}})},Ke=()=>{P(null),D({name:"",description:"",permissions:{}})},tt=()=>wt(null,null,function*(){if(!$.name.trim()){alert("Please enter a role name");return}try{_&&_.id?yield zs.updateRole(_.id,{name:$.name,description:$.description,permissions:$.permissions,facility_id:t,created_by:(r==null?void 0:r.id)||""}):yield zs.createRole({name:$.name,description:$.description,permissions:$.permissions,facility_id:t,created_by:(r==null?void 0:r.id)||""}),alert(`Role ${_?"updated":"created"} successfully!`),v(!1),yield o()}catch(N){console.error("Error saving role:",N),alert(`Failed to ${_?"update":"create"} role: ${N instanceof Error?N.message:"Unknown error"}`)}}),J=N=>wt(null,null,function*(){if(window.confirm(`Are you sure you want to delete the role "${N.role_name}"? This action cannot be undone.`))try{yield zs.deleteRole(N.id),alert("Role deleted successfully!"),yield o()}catch(F){console.error("Error deleting role:",F),alert(`Failed to delete role: ${F instanceof Error?F.message:"Unknown error"}`)}}),ne=()=>{v(!1),P(null),D({name:"",description:"",permissions:{}})},Y=(N,F)=>{D(pe(xe({},$),{permissions:pe(xe({},$.permissions),{[N]:F})}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("button",{onClick:o,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(C,{path:ns,size:.8,className:"mr-2"}),"Refresh"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(C,{path:ss,size:1,className:"text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(C,{path:ss,size:1,className:"text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(N=>N.is_active!==!1).length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-20 rounded-lg",children:e.jsx(C,{path:Zt,size:1,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Plan Tier"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 capitalize",children:w?w.tier:"Loading..."}),e.jsx("p",{className:"text-xs text-gray-500",children:w?`${w.currentCount}/${w.limit===999999?"∞":w.limit} users`:"Loading..."})]})]})})]}),w&&(()=>{const N=w.currentCount/w.limit*100;return N>=80&&N<100?e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{path:Zt,size:1,className:"text-yellow-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Approaching Tier Limit"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["You're using ",w.currentCount," users on your ",w.tier," tier. Consider upgrading to add more team members."]})]})]})}):N>=100?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{path:Zt,size:1,className:"text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Tier Limit Reached"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["You've reached the maximum number of users (",w.limit,") for your ",w.tier," tier. Upgrade your plan to add more team members."]})]})]})}):null})(),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Team Directory"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:l,onChange:N=>d(N.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("button",{onClick:te,className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(C,{path:He,size:.8,className:"mr-2"}),"Add User"]}),e.jsxs("button",{onClick:se,className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] transition-colors",children:[e.jsx(C,{path:Zt,size:.8,className:"mr-2"}),"Manage Roles"]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O.map(N=>{var F,L;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden flex items-center justify-center",children:N.avatar_url?e.jsx("img",{src:N.avatar_url,alt:`${N.first_name} ${N.last_name}`,className:"h-10 w-10 object-cover rounded-full",onError:z=>{var Qe,st;const ls=z.target;ls.style.display="none";const is=ls.parentElement;if(is){const qr=((Qe=N.first_name)==null?void 0:Qe[0])||"",ro=((st=N.last_name)==null?void 0:st[0])||"",ao=qr+ro||"?";is.innerHTML=`
                                  <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-sm font-medium text-blue-600">
                                      ${ao}
                                    </span>
                                  </div>
                                `}}}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:(((F=N.first_name)==null?void 0:F[0])||"")+(((L=N.last_name)==null?void 0:L[0])||"")||"?"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.first_name||N.last_name?`${N.first_name||""} ${N.last_name||""}`.trim():N.email||"Unknown User"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",N.id.slice(0,8),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:N.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N.role==="admin"?"bg-red-100 text-red-800":N.role==="manager"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:N.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N.is_active===!1?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:N.is_active===!1?"Inactive":"Active"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>A(N),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"Edit user",children:e.jsx(C,{path:rs,size:.8})}),e.jsx("button",{onClick:()=>M(N),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Delete user",children:e.jsx(C,{path:Jr,size:.8})})]})})]},N.id)})})]})}),O.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No users found matching your search."})})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-hide flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-6",children:["Edit User: ",x.first_name," ",x.last_name]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),e.jsx("input",{type:"text",value:I.first_name,onChange:N=>E(pe(xe({},I),{first_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",value:I.last_name,onChange:N=>E(pe(xe({},I),{last_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:I.email,onChange:N=>E(pe(xe({},I),{email:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"👤 User Role"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{id:"administrator",name:"👑 Administrator",desc:"Full system access"},{id:"manager",name:"👨‍💼 Manager",desc:"Department management"},{id:"technician",name:"🔧 Technician",desc:"Task execution"},{id:"viewer",name:"👀 Viewer",desc:"Read-only access"},{id:"trainer",name:"📚 Trainer",desc:"Content management"},{id:"custom",name:"➕ Custom",desc:"Manual permissions"}].map(N=>e.jsxs("button",{onClick:()=>B(N.id),className:`p-3 rounded-lg border text-left transition-colors ${I.role===N.id?"border-teal-500 bg-teal-50 text-teal-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:N.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N.desc})]},N.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"🔐 Permissions"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📊 Dashboard Access"}),e.jsx("div",{className:"space-y-2",children:[{id:"view_dashboard",label:"View Dashboard",desc:"Access main dashboard"},{id:"view_analytics",label:"View Analytics",desc:"Access reports and analytics"},{id:"export_data",label:"Export Data",desc:"Download reports and data"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=I.permissions)==null?void 0:F[N.id])||!1,onChange:z=>R(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"👥 User Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"manage_users",label:"Manage Users",desc:"Add, edit, remove users"},{id:"assign_roles",label:"Assign Roles",desc:"Change user roles and permissions"},{id:"view_user_activity",label:"View User Activity",desc:"Monitor user actions"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=I.permissions)==null?void 0:F[N.id])||!1,onChange:z=>R(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"⚙️ System Settings"}),e.jsx("div",{className:"space-y-2",children:[{id:"system_settings",label:"System Settings",desc:"Modify system configuration"},{id:"facility_settings",label:"Facility Settings",desc:"Manage facility preferences"},{id:"security_settings",label:"Security Settings",desc:"Configure security policies"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=I.permissions)==null?void 0:F[N.id])||!1,onChange:z=>R(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📋 Task Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"create_tasks",label:"Create Tasks",desc:"Create new tasks and assignments"},{id:"edit_tasks",label:"Edit Tasks",desc:"Modify existing tasks"},{id:"delete_tasks",label:"Delete Tasks",desc:"Remove tasks and assignments"},{id:"assign_tasks",label:"Assign Tasks",desc:"Assign tasks to team members"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=I.permissions)==null?void 0:F[N.id])||!1,onChange:z=>R(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📚 Content Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"approve_content",label:"Approve Content",desc:"Approve content for publishing"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=I.permissions)==null?void 0:F[N.id])||!1,onChange:z=>R(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 pt-4 border-t bg-white sticky bottom-0 z-10",children:[e.jsx("button",{onClick:ie,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 bg-white",children:"Cancel"}),e.jsx("button",{onClick:X,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] border border-[#4ECDC4]",children:"Save Changes"})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-hide flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Add New User"}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",value:k.first_name,onChange:N=>S(pe(xe({},k),{first_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter first name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",value:k.last_name,onChange:N=>S(pe(xe({},k),{last_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter last name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",value:k.email,onChange:N=>S(pe(xe({},k),{email:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email address"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"👤 User Role"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{id:"administrator",name:"👑 Administrator",desc:"Full system access"},{id:"manager",name:"👨‍💼 Manager",desc:"Department management"},{id:"technician",name:"🔧 Technician",desc:"Task execution"},{id:"viewer",name:"👀 Viewer",desc:"Read-only access"},{id:"trainer",name:"📚 Trainer",desc:"Content management"},{id:"custom",name:"➕ Custom",desc:"Manual permissions"}].map(N=>e.jsxs("button",{onClick:()=>U(N.id),className:`p-3 rounded-lg border text-left transition-colors ${k.role===N.id?"border-teal-500 bg-teal-50 text-teal-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:N.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N.desc})]},N.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"🔐 Permissions"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📊 Dashboard Access"}),e.jsx("div",{className:"space-y-2",children:[{id:"view_dashboard",label:"View Dashboard",desc:"Access main dashboard"},{id:"view_analytics",label:"View Analytics",desc:"Access reports and analytics"},{id:"export_data",label:"Export Data",desc:"Download reports and data"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=k.permissions)==null?void 0:F[N.id])||!1,onChange:z=>de(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"👥 User Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"manage_users",label:"Manage Users",desc:"Add, edit, remove users"},{id:"assign_roles",label:"Assign Roles",desc:"Change user roles and permissions"},{id:"view_user_activity",label:"View User Activity",desc:"Monitor user actions"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=k.permissions)==null?void 0:F[N.id])||!1,onChange:z=>de(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"⚙️ System Settings"}),e.jsx("div",{className:"space-y-2",children:[{id:"system_settings",label:"System Settings",desc:"Modify system configuration"},{id:"facility_settings",label:"Facility Settings",desc:"Manage facility preferences"},{id:"security_settings",label:"Security Settings",desc:"Configure security policies"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=k.permissions)==null?void 0:F[N.id])||!1,onChange:z=>de(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📋 Task Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"create_tasks",label:"Create Tasks",desc:"Create new tasks and assignments"},{id:"edit_tasks",label:"Edit Tasks",desc:"Modify existing tasks"},{id:"delete_tasks",label:"Delete Tasks",desc:"Remove tasks and assignments"},{id:"assign_tasks",label:"Assign Tasks",desc:"Assign tasks to team members"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=k.permissions)==null?void 0:F[N.id])||!1,onChange:z=>de(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📚 Content Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"approve_content",label:"Approve Content",desc:"Approve content for publishing"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=k.permissions)==null?void 0:F[N.id])||!1,onChange:z=>de(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 pt-4 border-t bg-white sticky bottom-0 z-10",children:[e.jsx("button",{onClick:Ge,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 bg-white",children:"Cancel"}),e.jsx("button",{onClick:Ze,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] border border-[#4ECDC4]",children:"Add User"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-hide flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:_?`Edit Role: ${_.role_name}`:"Role Management"}),e.jsxs("button",{onClick:Ke,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] flex items-center gap-2",children:[e.jsx(C,{path:He,size:.8}),"Create New Role"]})]}),!_&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"📋 Current Roles"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[{id:"administrator",role_name:"👑 Administrator",description:"Full system access",isDefault:!0,facility_id:t},{id:"manager",role_name:"👨‍💼 Manager",description:"Department management",isDefault:!0,facility_id:t},{id:"technician",role_name:"🔧 Technician",description:"Task execution",isDefault:!0,facility_id:t},{id:"viewer",role_name:"👀 Viewer",description:"Read-only access",isDefault:!0,facility_id:t},{id:"trainer",role_name:"📚 Trainer",description:"Content management",isDefault:!0,facility_id:t},{id:"custom",role_name:"➕ Custom",description:"Manual permissions",isDefault:!1,facility_id:t}].map(N=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-sm",children:N.role_name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:N.description}),N.isDefault&&e.jsx("span",{className:"inline-block mt-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:"Default"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>et(N),className:"p-1 text-gray-500 hover:text-gray-700",title:"Edit Role",children:e.jsx(C,{path:rs,size:.8})}),!N.isDefault&&e.jsx("button",{onClick:()=>J(N),className:"p-1 text-red-500 hover:text-red-700",title:"Delete Role",children:e.jsx(C,{path:Jr,size:.8})})]})]})},N.id))})]}),_&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role Name *"}),e.jsx("input",{type:"text",value:$.name,onChange:N=>D(pe(xe({},$),{name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter role name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:$.description,onChange:N=>D(pe(xe({},$),{description:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Enter role description"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"🔐 Role Permissions"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📊 Dashboard Access"}),e.jsx("div",{className:"space-y-2",children:[{id:"view_dashboard",label:"View Dashboard",desc:"Access main dashboard"},{id:"view_analytics",label:"View Analytics",desc:"Access reports and analytics"},{id:"export_data",label:"Export Data",desc:"Download reports and data"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=$.permissions)==null?void 0:F[N.id])||!1,onChange:z=>Y(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"👥 User Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"manage_users",label:"Manage Users",desc:"Add, edit, remove users"},{id:"assign_roles",label:"Assign Roles",desc:"Change user roles and permissions"},{id:"view_user_activity",label:"View User Activity",desc:"Monitor user actions"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=$.permissions)==null?void 0:F[N.id])||!1,onChange:z=>Y(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"⚙️ System Settings"}),e.jsx("div",{className:"space-y-2",children:[{id:"system_settings",label:"System Settings",desc:"Modify system configuration"},{id:"facility_settings",label:"Facility Settings",desc:"Manage facility preferences"},{id:"security_settings",label:"Security Settings",desc:"Configure security policies"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=$.permissions)==null?void 0:F[N.id])||!1,onChange:z=>Y(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📋 Task Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"create_tasks",label:"Create Tasks",desc:"Create new tasks and assignments"},{id:"edit_tasks",label:"Edit Tasks",desc:"Modify existing tasks"},{id:"delete_tasks",label:"Delete Tasks",desc:"Remove tasks and assignments"},{id:"assign_tasks",label:"Assign Tasks",desc:"Assign tasks to team members"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=$.permissions)==null?void 0:F[N.id])||!1,onChange:z=>Y(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"📚 Content Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"approve_content",label:"Approve Content",desc:"Approve content for publishing"}].map(N=>{var F,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((F=$.permissions)==null?void 0:F[N.id])||!1,onChange:z=>Y(N.id,z.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 pt-4 border-t bg-white sticky bottom-0 z-10",children:[e.jsx("button",{onClick:ne,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 bg-white",children:_?"Back to Roles":"Close"}),_&&e.jsx("button",{onClick:tt,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] border border-[#4ECDC4]",children:_.id?"Update Role":"Create Role"})]})]})}),j&&y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Remove Team Member"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone."})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Are you sure you want to remove ",e.jsxs("strong",{children:[y.first_name," ",y.last_name]})," from your facility? They will lose access to all facility data and will need to be re-invited to regain access."]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:V,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{onClick:H,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Remove User"})]})]})})]})}var Of=Object.defineProperty,tl=Object.getOwnPropertySymbols,$f=Object.prototype.hasOwnProperty,Af=Object.prototype.propertyIsEnumerable,sl=(r,t,s)=>t in r?Of(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,rl=(r,t)=>{for(var s in t||(t={}))$f.call(t,s)&&sl(r,s,t[s]);if(tl)for(var s of tl(t))Af.call(t,s)&&sl(r,s,t[s]);return r},Nt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class Rf{constructor(){this.sessionStartTime=Date.now(),this.lastActivityTime=Date.now(),this.inactivityTimer=null,this.sessionTimer=null,this.warningTimer=null,this.isRememberMe=!1,this.config={sessionTimeout:480,inactiveTimeout:30,rememberMeDuration:7},this.loadConfig(),this.setupActivityListeners(),this.startTimers()}loadConfig(){const t=localStorage.getItem("cliniio_session_timeout"),s=localStorage.getItem("cliniio_inactive_timeout"),n=localStorage.getItem("cliniio_remember_me_duration");t&&(this.config.sessionTimeout=parseInt(t)),s&&(this.config.inactiveTimeout=parseInt(s)),n&&(this.config.rememberMeDuration=parseInt(n)),this.isRememberMe=localStorage.getItem("cliniio_remember_me")==="true",this.isRememberMe&&(this.config.sessionTimeout=this.config.rememberMeDuration*24*60)}setupActivityListeners(){["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(s=>{document.addEventListener(s,()=>this.updateActivity(),{passive:!0})}),document.addEventListener("visibilitychange",()=>{document.hidden?this.pauseTimers():this.resumeTimers()})}updateActivity(){this.lastActivityTime=Date.now(),this.resetInactivityTimer()}startTimers(){this.startSessionTimer(),this.startInactivityTimer()}startSessionTimer(){this.sessionTimer&&clearTimeout(this.sessionTimer);const t=this.config.sessionTimeout*60*1e3,s=Date.now()-this.sessionStartTime,n=Math.max(0,t-s),a=Math.max(0,n-300*1e3);a>0&&(this.warningTimer=setTimeout(()=>{this.showSessionWarning(n)},a)),this.sessionTimer=setTimeout(()=>{this.handleSessionExpired()},n)}startInactivityTimer(){this.inactivityTimer&&clearTimeout(this.inactivityTimer);const t=this.config.inactiveTimeout*60*1e3;this.inactivityTimer=setTimeout(()=>{this.handleInactivityTimeout()},t)}resetInactivityTimer(){this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.startInactivityTimer()}pauseTimers(){this.sessionTimer&&clearTimeout(this.sessionTimer),this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.warningTimer&&clearTimeout(this.warningTimer)}resumeTimers(){this.startTimers()}showSessionWarning(t){var s,n;const a=Math.ceil(t/6e4),i=document.createElement("div");i.id="session-warning",i.className="fixed top-4 right-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4 shadow-lg z-50 max-w-sm",i.innerHTML=`
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-yellow-800">Session Expiring Soon</h3>
          <div class="mt-2 text-sm text-yellow-700">
            <p>Your session will expire in ${a} minute${a!==1?"s":""}.</p>
          </div>
          <div class="mt-4 flex space-x-3">
            <button id="extend-session" class="bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 rounded-md border border-yellow-200 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
              Extend Session
            </button>
            <button id="dismiss-warning" class="bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 rounded-md border border-yellow-200 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
              Dismiss
            </button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(i),(s=document.getElementById("extend-session"))==null||s.addEventListener("click",()=>{this.extendSession(),i.remove()}),(n=document.getElementById("dismiss-warning"))==null||n.addEventListener("click",()=>{i.remove()}),setTimeout(()=>{i.parentNode&&i.remove()},3e4)}extendSession(){return Nt(this,null,function*(){try{const{data:t,error:s}=yield K.auth.refreshSession();if(s){console.error("Error extending session:",s);return}t.session&&(this.sessionStartTime=Date.now(),this.startTimers(),this.showMessage("Session extended successfully!","success"))}catch(t){console.error("Error extending session:",t),this.showMessage("Failed to extend session. Please log in again.","error")}})}handleSessionExpired(){return Nt(this,null,function*(){console.log("🚨 SESSION EXPIRED - redirecting to login"),this.showMessage("Your session has expired. Please log in again.","error"),setTimeout(()=>Nt(this,null,function*(){yield this.logout()}),2e3)})}handleInactivityTimeout(){return Nt(this,null,function*(){this.showMessage("You have been inactive for too long. Logging out...","warning"),setTimeout(()=>Nt(this,null,function*(){yield this.logout()}),2e3)})}showMessage(t,s){const n={success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800"},a=document.createElement("div");a.className=`fixed top-4 right-4 ${n[s]} border rounded-lg p-4 shadow-lg z-50 max-w-sm`,a.innerHTML=`
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 ${s==="success"?"text-green-400":s==="error"?"text-red-400":"text-yellow-400"}" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm font-medium">${t}</p>
        </div>
      </div>
    `,document.body.appendChild(a),setTimeout(()=>{a.parentNode&&a.remove()},5e3)}logout(){return Nt(this,null,function*(){try{yield K.auth.signOut(),window.location.href="/login"}catch(t){console.error("Error during logout:",t),window.location.href="/login"}})}updateConfig(t){this.config=rl(rl({},this.config),t),this.startTimers()}setRememberMe(t){this.isRememberMe=t,localStorage.setItem("cliniio_remember_me",t.toString()),t?this.config.sessionTimeout=this.config.rememberMeDuration*24*60:this.config.sessionTimeout=480,this.startTimers()}getSessionInfo(){const t=Date.now(),s=t-this.sessionStartTime,n=Math.max(0,this.config.sessionTimeout*60*1e3-s),a=t-this.lastActivityTime,i=Math.max(0,this.config.inactiveTimeout*60*1e3-a);return{sessionStartTime:this.sessionStartTime,lastActivityTime:this.lastActivityTime,remainingTime:n,inactiveTimeRemaining:i}}destroy(){this.sessionTimer&&clearTimeout(this.sessionTimer),this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.warningTimer&&clearTimeout(this.warningTimer),["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(s=>{document.removeEventListener(s,()=>this.updateActivity())})}}const cr=new Rf,Hv=({variant:r="compact",className:t=""})=>{const[s,n]=u.useState(cr.getSessionInfo()),[a,i]=u.useState(!1);u.useEffect(()=>{const d=setInterval(()=>{n(cr.getSessionInfo())},3e4);return()=>clearInterval(d)},[]);const c=d=>{const x=Math.floor(d/6e4),m=Math.floor(x/60);return m>0?`${m}h ${x%60}m`:`${x}m`},o=d=>d<300*1e3?"text-red-600":d<900*1e3?"text-yellow-600":"text-green-600",l=d=>d<300*1e3?e.jsx(ws,{className:"h-4 w-4"}):e.jsx(Jl,{className:"h-4 w-4"});return r==="compact"?e.jsxs("div",{className:`flex items-center space-x-2 ${t}`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[l(s.remainingTime),e.jsx("span",{className:`text-sm font-medium ${o(s.remainingTime)}`,children:c(s.remainingTime)})]}),e.jsx("button",{onClick:()=>i(!a),className:"text-xs text-gray-500 hover:text-gray-700 underline",children:a?"Hide":"Details"})]}):e.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 p-4 ${t}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Session Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l(s.remainingTime),e.jsxs("span",{className:`text-sm font-medium ${o(s.remainingTime)}`,children:[c(s.remainingTime)," remaining"]})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Session started:"}),e.jsx("span",{children:new Date(s.sessionStartTime).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last activity:"}),e.jsx("span",{children:new Date(s.lastActivityTime).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Inactive timeout:"}),e.jsx("span",{children:c(s.inactiveTimeRemaining)})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("button",{onClick:()=>cr.extendSession(),className:"w-full px-3 py-2 bg-blue-600 text-white text-xs rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Extend Session"})})]})},Vv=({children:r,className:t=""})=>e.jsx("div",{className:`rounded-lg border bg-card text-card-foreground shadow-sm ${t}`,children:r});var Bf=Object.defineProperty,Ts=Object.getOwnPropertySymbols,zi=Object.prototype.hasOwnProperty,Ui=Object.prototype.propertyIsEnumerable,al=(r,t,s)=>t in r?Bf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ff=(r,t)=>{for(var s in t||(t={}))zi.call(t,s)&&al(r,s,t[s]);if(Ts)for(var s of Ts(t))Ui.call(t,s)&&al(r,s,t[s]);return r},Mf=(r,t)=>{var s={};for(var n in r)zi.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&Ts)for(var n of Ts(r))t.indexOf(n)<0&&Ui.call(r,n)&&(s[n]=r[n]);return s};const Wv=r=>{var t=r,{className:s=""}=t,n=Mf(t,["className"]);return e.jsx("input",Ff({className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${s}`},n))};var Lf=Object.defineProperty,zf=Object.defineProperties,Uf=Object.getOwnPropertyDescriptors,ks=Object.getOwnPropertySymbols,qi=Object.prototype.hasOwnProperty,Hi=Object.prototype.propertyIsEnumerable,nl=(r,t,s)=>t in r?Lf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,qf=(r,t)=>{for(var s in t||(t={}))qi.call(t,s)&&nl(r,s,t[s]);if(ks)for(var s of ks(t))Hi.call(t,s)&&nl(r,s,t[s]);return r},Hf=(r,t)=>zf(r,Uf(t)),Vf=(r,t)=>{var s={};for(var n in r)qi.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&ks)for(var n of ks(r))t.indexOf(n)<0&&Hi.call(r,n)&&(s[n]=r[n]);return s};const Gv=r=>{var t=r,{children:s,className:n=""}=t,a=Vf(t,["children","className"]);return e.jsx("label",Hf(qf({className:`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${n}`},a),{children:s}))};var Wf=Object.defineProperty,Is=Object.getOwnPropertySymbols,Vi=Object.prototype.hasOwnProperty,Wi=Object.prototype.propertyIsEnumerable,ll=(r,t,s)=>t in r?Wf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Gf=(r,t)=>{for(var s in t||(t={}))Vi.call(t,s)&&ll(r,s,t[s]);if(Is)for(var s of Is(t))Wi.call(t,s)&&ll(r,s,t[s]);return r},Kf=(r,t)=>{var s={};for(var n in r)Vi.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&Is)for(var n of Is(r))t.indexOf(n)<0&&Wi.call(r,n)&&(s[n]=r[n]);return s};const Kv=r=>{var t=r,{className:s="",onCheckedChange:n,onChange:a}=t,i=Kf(t,["className","onCheckedChange","onChange"]);const c=o=>{n&&n(o.target.checked),a&&a(o)};return e.jsx("input",Gf({type:"checkbox",className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${s}`,onChange:c},i))},Qv=({checked:r,onCheckedChange:t,className:s="",disabled:n=!1})=>{const a=()=>{n||t(!r)};return e.jsx("button",{type:"button",role:"switch","aria-checked":r,disabled:n,onClick:a,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${r?"bg-blue-600":"bg-gray-200"} ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"} ${s}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r?"translate-x-6":"translate-x-1"}`})})};var il=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Yv=({content:r,onApprove:t,onReject:s})=>{const[n,a]=u.useState(!1),[i,c]=u.useState(""),[o,l]=u.useState(""),[d,x]=u.useState(!1),[m,p]=u.useState(!1),f=P=>{switch(P){case"course":return Ne;case"policy":return Ne;case"procedure":return Ne;case"learning_pathway":return Ne;default:return Ne}},g=P=>{switch(P){case"course":return"text-blue-600 bg-blue-100";case"policy":return"text-purple-600 bg-purple-100";case"procedure":return"text-green-600 bg-green-100";case"learning_pathway":return"text-orange-600 bg-orange-100";default:return"text-gray-600 bg-gray-100"}},v=P=>{switch(P){case"course":return"Course";case"policy":return"Policy";case"procedure":return"Procedure";case"learning_pathway":return"Learning Pathway";default:return P}},j=P=>{const $=new Date(P),w=new Date().getTime()-$.getTime(),T=Math.floor(w/(1e3*60)),k=Math.floor(w/(1e3*60*60)),S=Math.floor(w/(1e3*60*60*24));return T<1?"Just now":T<60?`${T}m ago`:k<24?`${k}h ago`:S<7?`${S}d ago`:$.toLocaleDateString()},h=()=>il(null,null,function*(){if(!m){p(!0);try{yield t(r.id,r.type,i.trim()||void 0)}finally{p(!1)}}}),y=()=>il(null,null,function*(){if(!(m||!o.trim())){p(!0);try{yield s(r.id,r.type,o.trim())}finally{p(!1)}}}),b=()=>{x(!0),a(!1)},_=()=>{x(!1),l("")};return e.jsxs("div",{id:`content-${r.id}`,className:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${g(r.type)}`,children:e.jsx(C,{path:f(r.type),size:1})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-900 truncate",children:r.title}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${g(r.type)}`,children:v(r.type)})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:ss,size:.8}),e.jsxs("span",{children:["by ",r.authorName]})]}),e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:mt,size:.8}),e.jsxs("span",{children:["Submitted ",j(r.submittedAt)]})]}),r.revisionNumber>1&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Revision ",r.revisionNumber]})]}),r.previousRejections>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-orange-600",children:[r.previousRejections," previous rejection",r.previousRejections>1?"s":""]})]})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 ml-4",children:e.jsx("button",{onClick:()=>a(!n),className:"text-blue-600 hover:text-blue-800 text-sm",disabled:m,children:n?"Hide Comments":"Add Comments"})})]}),n&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("textarea",{value:i,onChange:P=>c(P.target.value),placeholder:"Optional comments for the creator...",className:"w-full p-2 border border-gray-300 rounded-md text-sm resize-none",rows:2,disabled:m})}),d&&e.jsx("div",{className:"mt-3 pt-3 border-t border-red-200",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason *"}),e.jsx("textarea",{value:o,onChange:P=>l(P.target.value),placeholder:"Please provide specific feedback for the creator...",className:"w-full p-2 border border-red-300 rounded-md text-sm resize-none focus:ring-red-500 focus:border-red-500",rows:3,disabled:m})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:_,className:"px-3 py-1 text-gray-600 hover:text-gray-800 text-sm",disabled:m,children:"Cancel"}),e.jsx("button",{onClick:y,disabled:m||!o.trim(),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:m?"Rejecting...":"Reject"})]})]})}),!d&&e.jsxs("div",{className:"flex items-center justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-red-600 border border-red-300 rounded-md hover:bg-red-50 text-sm",disabled:m,children:"Reject"}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm",disabled:m,children:m?"Processing...":"Approve & Publish"})]})]})};var Qf=Object.defineProperty,Yf=Object.defineProperties,Jf=Object.getOwnPropertyDescriptors,ol=Object.getOwnPropertySymbols,Xf=Object.prototype.hasOwnProperty,Zf=Object.prototype.propertyIsEnumerable,cl=(r,t,s)=>t in r?Qf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,e0=(r,t)=>{for(var s in t||(t={}))Xf.call(t,s)&&cl(r,s,t[s]);if(ol)for(var s of ol(t))Zf.call(t,s)&&cl(r,s,t[s]);return r},t0=(r,t)=>Yf(r,Jf(t));const s0={id:"dental",name:"Dental Practice",description:"Statuses optimized for dental offices and clinics",category:"Specialty Care",statuses:[{name:"Pre-Procedure Ready",color:"#16a34a",icon:"check-circle",description:"Dental chair prepared, instruments sterilized, ready for patient",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Post-Procedure Cleaning",color:"#dc2626",icon:"broom",description:"Biohazard cleanup required after dental procedure",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Sterilization Cycle",color:"#ca8a04",icon:"progress-clock",description:"Instruments currently in autoclave sterilization cycle",requiresVerification:!1,autoTransition:!0,transitionTo:"Pre-Procedure Ready",alertLevel:"medium"},{name:"Patient in Chair",color:"#3b82f6",icon:"account",description:"Patient currently in dental chair, room occupied",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"X-Ray Room Ready",color:"#8b5cf6",icon:"radiology-box",description:"X-ray room prepared and ready for imaging",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Equipment Maintenance",color:"#ea580c",icon:"wrench",description:"Dental equipment under maintenance or repair",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"}]},r0={id:"primary_care",name:"Primary Care",description:"Statuses for general practice and family medicine",category:"General Practice",statuses:[{name:"Patient Exam Room",color:"#3b82f6",icon:"account",description:"Patient currently in exam room for consultation",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Waiting for Labs",color:"#ca8a04",icon:"progress-clock",description:"Room waiting for lab results or test completion",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Vaccination Ready",color:"#16a34a",icon:"needle",description:"Vaccination station prepared and ready",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Chronic Care Visit",color:"#8b5cf6",icon:"account-clock",description:"Extended visit for chronic condition management",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Wellness Check",color:"#059669",icon:"heart-pulse",description:"Routine physical examination in progress",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Follow-up Visit",color:"#3b82f6",icon:"calendar-check",description:"Follow-up appointment for previous condition",requiresVerification:!1,autoTransition:!1,alertLevel:"low"}]},a0={id:"private_surgery",name:"Private Surgery",description:"Statuses for surgical centers and operating rooms",category:"Surgical",statuses:[{name:"Pre-Op Ready",color:"#16a34a",icon:"check-circle",description:"Pre-operative room prepared for patient",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{name:"Surgery in Progress",color:"#dc2626",icon:"scissors-cutting",description:"Active surgery currently in progress",requiresVerification:!1,autoTransition:!1,alertLevel:"critical"},{name:"Post-Op Recovery",color:"#3b82f6",icon:"bed",description:"Post-operative recovery room occupied",requiresVerification:!1,autoTransition:!1,alertLevel:"high"},{name:"Sterile Instruments",color:"#8b5cf6",icon:"package-variant",description:"Surgical instruments sterilized and ready",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{name:"Anesthesia Ready",color:"#ca8a04",icon:"gas-cylinder",description:"Anesthesia equipment prepared and ready",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Surgical Suite Clean",color:"#16a34a",icon:"broom",description:"Surgical suite cleaned and sanitized post-procedure",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"}]},n0={id:"emergency_room",name:"Emergency Room",description:"Statuses for emergency departments and urgent care",category:"Emergency",statuses:[{name:"Trauma Bay Ready",color:"#16a34a",icon:"ambulance",description:"Trauma bay prepared for emergency patient",requiresVerification:!1,autoTransition:!1,alertLevel:"critical"},{name:"Code Blue",color:"#dc2626",icon:"alert-circle",description:"Cardiac arrest or medical emergency in progress",requiresVerification:!1,autoTransition:!1,alertLevel:"critical"},{name:"Isolation Room",color:"#ea580c",icon:"shield-lock",description:"Isolation room for infectious disease patients",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Waiting for Specialist",color:"#ca8a04",icon:"account-clock",description:"Patient waiting for specialist consultation",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Discharge Pending",color:"#8b5cf6",icon:"exit-to-app",description:"Patient ready for discharge, paperwork pending",requiresVerification:!1,autoTransition:!1,alertLevel:"low"}]},l0={id:"laboratory",name:"Laboratory",description:"Statuses for medical laboratories and testing facilities",category:"Diagnostic",statuses:[{name:"Sample Processing",color:"#ca8a04",icon:"test-tube",description:"Laboratory samples currently being processed",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Equipment Calibration",color:"#ea580c",icon:"wrench",description:"Laboratory equipment under calibration",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Quality Control",color:"#8b5cf6",icon:"clipboard-check",description:"Quality control testing in progress",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Results Ready",color:"#16a34a",icon:"file-document",description:"Test results completed and ready for review",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Hazardous Materials",color:"#dc2626",icon:"biohazard",description:"Hazardous materials handling in progress",requiresVerification:!0,autoTransition:!1,alertLevel:"critical"}]},Gi=[s0,r0,a0,n0,l0];function Ps(r){return Gi.find(t=>t.id===r)}function dl(r){return r.statuses.map(t=>t0(e0({},t),{id:t.name.toLowerCase().replace(/\s+/g,"_"),isDefault:!1,isCore:!1,isPublished:!1}))}function i0(r,t){const s=[];for(const n of r.statuses)for(const a of t){if(n.name.toLowerCase()===a.name.toLowerCase()){s.push({bundleStatus:n.name,existingStatus:a.name,similarity:1});continue}const i=n.name.toLowerCase().split(/\s+/),c=a.name.toLowerCase().split(/\s+/),o=i.filter(l=>c.includes(l));if(o.length>0){const l=o.length/Math.max(i.length,c.length);l>=.5&&s.push({bundleStatus:n.name,existingStatus:a.name,similarity:l})}}return s.sort((n,a)=>a.similarity-n.similarity)}const o0=({rooms:r,onEditRoom:t,onDeleteRoom:s,onToggleActive:n})=>e.jsx("div",{className:"space-y-2",children:r.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.department," • ",a.floor]}),a.barcode&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Barcode: ",a.barcode]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>n(a.id,a.isActive),className:`px-3 py-1 text-sm rounded-md transition-colors ${a.isActive?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:a.isActive?"Active":"Inactive"}),e.jsx("button",{onClick:()=>t(a),className:"p-1 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx(C,{path:rs,size:.8})}),e.jsx("button",{onClick:()=>s(a.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:Dt,size:.8})})]})]},a.id))}),c0=()=>{const r=["OR001","ICU101","SUP001","ER001","LAB001","RAD001","PHY001","ADM001"];return r[Math.floor(Math.random()*r.length)]||"OR001"};var d0=Object.defineProperty,u0=Object.defineProperties,m0=Object.getOwnPropertyDescriptors,ul=Object.getOwnPropertySymbols,x0=Object.prototype.hasOwnProperty,p0=Object.prototype.propertyIsEnumerable,ml=(r,t,s)=>t in r?d0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Be=(r,t)=>{for(var s in t||(t={}))x0.call(t,s)&&ml(r,s,t[s]);if(ul)for(var s of ul(t))p0.call(t,s)&&ml(r,s,t[s]);return r},Fe=(r,t)=>u0(r,m0(t));const h0=({isOpen:r,onClose:t,room:s,mode:n,onSave:a})=>{const[i,c]=u.useState({name:"",department:"",floor:"",barcode:"",gpsCoordinates:null}),{getCurrentLocation:o,latitude:l,longitude:d,accuracy:x,isLoading:m}=Fi(),p=["Surgery","Intensive Care","Emergency","Logistics","Administration","Laboratory"];u.useEffect(()=>{setTimeout(s&&n==="edit"?()=>{c({name:s.name||"",department:s.department||"",floor:s.floor||"",barcode:s.barcode||"",gpsCoordinates:s.gpsCoordinates||null})}:()=>{c({name:"",department:"",floor:"",barcode:"",gpsCoordinates:null})},0)},[s,n,r]),u.useEffect(()=>{l&&d&&setTimeout(()=>{c(g=>Fe(Be({},g),{gpsCoordinates:{latitude:l,longitude:d,accuracy:x||0,lastUpdated:new Date().toISOString()}}))},0)},[l,d,x]);const f=()=>{if(i.name&&i.department&&i.floor){const g=Fe(Be({},i),{gpsCoordinates:i.gpsCoordinates?Fe(Be({},i.gpsCoordinates),{lastUpdated:new Date().toISOString()}):void 0});a(g),t()}};return r?e.jsxs("div",{className:"mb-4 p-3 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h3",{className:"text-md font-medium mb-3",children:n==="add"?"Add New Room":"Edit Room"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-name",className:"block text-xs font-medium text-gray-700 mb-1",children:"Room Name"}),e.jsx("input",{id:"room-name",type:"text",value:i.name,onChange:g=>c(Fe(Be({},i),{name:g.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Operating Room 1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-barcode",className:"block text-xs font-medium text-gray-700 mb-1",children:"Barcode"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{id:"room-barcode",type:"text",value:i.barcode,onChange:g=>c(Fe(Be({},i),{barcode:g.target.value})),className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., OR001"}),e.jsxs("button",{type:"button",onClick:()=>c(Fe(Be({},i),{barcode:c0()})),className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors flex items-center gap-1 text-xs",title:"Generate random barcode",children:[e.jsx(C,{path:It,size:.6}),e.jsx("span",{children:"Gen"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-department",className:"block text-xs font-medium text-gray-700 mb-1",children:"Department"}),e.jsxs("select",{id:"room-department",value:i.department,onChange:g=>c(Fe(Be({},i),{department:g.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Department"}),p.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-floor",className:"block text-xs font-medium text-gray-700 mb-1",children:"Floor"}),e.jsx("input",{id:"room-floor",type:"text",value:i.floor,onChange:g=>c(Fe(Be({},i),{floor:g.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 2nd Floor"})]})]}),e.jsxs("div",{className:"mt-4 p-3 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-blue-800 flex items-center",children:[e.jsx(C,{path:wr,size:.8,className:"mr-1"}),"GPS Coordinates (Optional)"]}),e.jsxs("button",{type:"button",onClick:o,disabled:m,className:"flex items-center px-3 py-1 bg-blue-600 text-white text-xs rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(C,{path:wr,size:.6,className:"mr-1"}),m?"Getting Location...":"Get Current Location"]})]}),i.gpsCoordinates?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("div",{className:"font-medium",children:"Current GPS Coordinates:"}),e.jsx("div",{className:"font-mono text-xs",children:rg(i.gpsCoordinates)}),i.gpsCoordinates.accuracy&&e.jsxs("div",{className:"text-xs text-blue-600",children:["Accuracy: ±",Math.round(i.gpsCoordinates.accuracy),"m"]})]}),e.jsx("button",{type:"button",onClick:()=>c(g=>Fe(Be({},g),{gpsCoordinates:null})),className:"text-xs text-red-600 hover:text-red-800",children:"Remove GPS Coordinates"})]}):e.jsx("div",{className:"text-sm text-blue-600",children:`No GPS coordinates set. Click "Get Current Location" to capture the room's GPS coordinates. This will enable smart location detection for inventory items.`})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:f,className:"flex items-center px-3 py-1 bg-[#4ECDC4] text-white text-sm rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:n==="add"?He:Ue,size:.8,className:"mr-1"}),n==="add"?"Add Room":"Update Room"]}),e.jsxs("button",{onClick:t,className:"flex items-center px-3 py-1 bg-gray-500 text-white text-sm rounded-md hover:bg-gray-600 transition-colors",children:[e.jsx(C,{path:ae,size:.8,className:"mr-1"}),"Cancel"]})]})]}):null},g0=({coreStatuses:r,customStatuses:t,onEditStatus:s,onDeleteStatus:n,onTogglePublishStatus:a,statusCountInfo:i})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Core Status Types (Required)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:r.map(c=>e.jsxs("div",{className:"p-2 rounded-lg border bg-white border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-1",style:{backgroundColor:c.color}}),e.jsx("span",{className:"font-medium text-xs",children:c.name}),e.jsx(C,{path:cc,size:.4,className:"text-gray-300 ml-1",title:"Core status - always available"})]}),e.jsx("span",{className:"px-1 py-0.5 bg-blue-100 text-blue-600 text-xs rounded",children:"Core"})]}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:c.description})]},c.id))}),e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Custom Status Types (Optional)"}),e.jsxs("div",{className:"relative ml-2 tooltip-container",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold cursor-help",children:"i"}),e.jsxs("div",{className:"tooltip-content",children:[e.jsx("div",{className:"mb-1 font-medium",children:"💡 Data Integrity Protection"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:"• Similar statuses (≥90% match) are blocked"}),e.jsx("div",{children:"• Very similar statuses (≥80% match) show warnings"}),e.jsx("div",{children:"• Smart suggestions help you choose better names"}),e.jsx("div",{children:"• All statuses start as drafts for testing"})]}),e.jsx("div",{className:"tooltip-arrow"})]})]})]}),i&&e.jsxs("div",{className:"text-xs text-gray-500",children:[i.custom,"/",i.maxCustom," custom statuses"]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Custom statuses start as drafts. Click the eye icon to publish them and make them visible in the cleaning workflow."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4",children:t.map(c=>e.jsxs("div",{className:`p-3 rounded-lg border ${c.isPublished?"bg-purple-100 border-purple-300":"bg-gray-100 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full mr-2",style:{backgroundColor:c.color}}),e.jsx("span",{className:"font-medium text-sm",children:c.name}),e.jsx("span",{className:`ml-2 px-1 py-0.5 text-xs rounded ${c.isPublished?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"}`,children:c.isPublished?"Published":"Draft"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>s(c),className:"p-1 text-purple-600 hover:bg-purple-100 rounded",title:"Edit status",children:e.jsx(C,{path:rs,size:.6})}),e.jsx("button",{onClick:()=>a(c.id,!c.isPublished),className:`p-1 rounded ${c.isPublished?"text-orange-600 hover:bg-orange-100":"text-green-600 hover:bg-green-100"}`,title:c.isPublished?"Unpublish status":"Publish status",children:e.jsx(C,{path:c.isPublished?pi:Pt,size:.6})}),e.jsx("button",{onClick:()=>n(c.id),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Delete status",children:e.jsx(C,{path:Dt,size:.6})})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:c.description}),e.jsxs("div",{className:"text-xs text-purple-600",children:[c.requiresVerification&&e.jsx("span",{className:"mr-2",children:"✓ Verification"}),c.autoTransition&&e.jsx("span",{className:"mr-2",children:"✓ Auto Transition"}),c.alertLevel&&c.alertLevel!=="low"&&e.jsxs("span",{className:"mr-2",children:["⚠ ",c.alertLevel]})]})]},c.id))})]}),f0=({customStatuses:r,onLoadBundle:t,onReplaceWithBundle:s})=>{var n;const[a,i]=u.useState(""),[c,o]=u.useState(!1),[l,d]=u.useState([]),x=g=>{i(g);const v=Ps(g);if(v){const j=i0(v,r);d(j),o(!0)}},m=()=>{t(a),i(""),o(!1),d([])},p=()=>{s(a),i(""),o(!1),d([])},f=()=>{i(""),o(!1),d([])};return e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-medium text-green-800 mb-2",children:"🚀 Quick Setup: Pre-configured Status Bundles"}),e.jsx("p",{className:"text-xs text-green-700 mb-3",children:"Select a bundle to quickly add relevant statuses for your healthcare specialty. All statuses start as drafts."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-3",children:Gi.map(g=>e.jsxs("button",{onClick:()=>x(g.id),className:`p-2 text-left rounded border transition-colors ${a===g.id?"bg-green-100 border-green-400 text-green-800":"bg-white border-green-200 hover:bg-green-50 text-green-700"}`,children:[e.jsx("div",{className:"font-medium text-xs",children:g.name}),e.jsx("div",{className:"text-xs opacity-75",children:g.description}),e.jsxs("div",{className:"text-xs opacity-60",children:[g.statuses.length," statuses"]})]},g.id))}),c&&a&&e.jsxs("div",{className:"mt-3 p-3 bg-white border border-green-300 rounded",children:[e.jsxs("h6",{className:"text-sm font-medium text-green-800 mb-2",children:["Bundle Preview: ",(n=Ps(a))==null?void 0:n.name]}),l.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsxs("p",{className:"text-xs text-yellow-800 mb-1",children:["⚠️ Found ",l.length," similar statuses:"]}),e.jsx("ul",{className:"text-xs text-yellow-700 space-y-1",children:l.slice(0,3).map((g,v)=>e.jsxs("li",{children:['• "',g.bundleStatus,'" similar to "',g.existingStatus,'"']},v))})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Add New Statuses Only"}),e.jsx("button",{onClick:p,className:"px-3 py-1 text-xs bg-orange-600 text-white rounded hover:bg-orange-700",children:"Replace All Custom Statuses"}),e.jsx("button",{onClick:f,className:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]})]})]})};var b0=Object.defineProperty,y0=Object.defineProperties,v0=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,j0=Object.prototype.hasOwnProperty,w0=Object.prototype.propertyIsEnumerable,pl=(r,t,s)=>t in r?b0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,N0=(r,t)=>{for(var s in t||(t={}))j0.call(t,s)&&pl(r,s,t[s]);if(xl)for(var s of xl(t))w0.call(t,s)&&pl(r,s,t[s]);return r},C0=(r,t)=>y0(r,v0(t)),S0=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const hl=[{name:"check-circle",label:"Check Circle",path:"mdiCheckCircle"},{name:"exclamation-triangle",label:"Warning",path:"mdiExclamationTriangle"},{name:"pause-circle",label:"Pause",path:"mdiPauseCircle"},{name:"clock",label:"Clock",path:"mdiClock"},{name:"shield",label:"Shield",path:"mdiShield"},{name:"wrench",label:"Wrench",path:"mdiWrench"},{name:"heart",label:"Heart",path:"mdiHeart"},{name:"star",label:"Star",path:"mdiStar"},{name:"flag",label:"Flag",path:"mdiFlag"},{name:"home",label:"Home",path:"mdiHome"}],_0=[{name:"Green",value:"#16a34a",bgClass:"bg-green-100",textClass:"text-green-600"},{name:"Red",value:"#dc2626",bgClass:"bg-red-100",textClass:"text-red-600"},{name:"Yellow",value:"#ca8a04",bgClass:"bg-yellow-100",textClass:"text-yellow-600"},{name:"Blue",value:"#3b82f6",bgClass:"bg-blue-100",textClass:"text-blue-600"},{name:"Purple",value:"#9333ea",bgClass:"bg-purple-100",textClass:"text-purple-600"},{name:"Orange",value:"#ea580c",bgClass:"bg-orange-100",textClass:"text-orange-600"},{name:"Gray",value:"#6b7280",bgClass:"bg-gray-100",textClass:"text-gray-600"},{name:"Pink",value:"#ec4899",bgClass:"bg-pink-100",textClass:"text-pink-600"}],T0=({isOpen:r,onClose:t,onSave:s,existingStatuses:n})=>{var a;const[i,c]=u.useState({name:"",description:"",icon:"check-circle",color:"#16a34a"}),[o,l]=u.useState(!1),[d,x]=u.useState([]),m=(g,v)=>{c(j=>C0(N0({},j),{[g]:v})),x([])},p=()=>{const g=[];return i.name.trim()||g.push("Status name is required"),i.name.trim().split(/\s+/).length>1&&g.push("Status name must be 1 word only"),i.name.trim().length<2&&g.push("Status name must be at least 2 characters"),i.name.trim().length>20&&g.push("Status name must be less than 20 characters"),n.map(h=>h.name.toLowerCase()).includes(i.name.toLowerCase())&&g.push("A status with this name already exists"),/^[a-zA-Z0-9]+$/.test(i.name.trim())||g.push("Status name can only contain letters and numbers"),x(g),g.length===0},f=()=>S0(null,null,function*(){if(p()){l(!0);try{yield s({name:i.name.trim(),description:i.description.trim()||`${i.name.trim()} status`,icon:i.icon,color:i.color,isDefault:!1,isCore:!1,isPublished:!0,category:"custom",requiresVerification:!1,autoTransition:!1,alertLevel:"low"}),c({name:"",description:"",icon:"check-circle",color:"#16a34a"}),t()}catch(g){console.error("Error saving status:",g),x(["Failed to save status. Please try again."])}finally{l(!1)}}});return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Custom Status"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1.2})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:g=>m("name",g.target.value),placeholder:"e.g., Clean, Dirty, Maintenance",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",maxLength:20}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"One word only, letters and numbers"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (Optional)"}),e.jsx("textarea",{value:i.description,onChange:g=>m("description",g.target.value),placeholder:"Brief description of this status",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Icon"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:hl.map(g=>e.jsx("button",{onClick:()=>m("icon",g.name),className:`p-2 rounded-md border-2 transition-colors ${i.icon===g.name?"border-[#4ECDC4] bg-[#4ECDC4]/10":"border-gray-200 hover:border-gray-300"}`,title:g.label,children:e.jsx(C,{path:g.path,size:1,className:i.icon===g.name?"text-[#4ECDC4]":"text-gray-600"})},g.name))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:_0.map(g=>e.jsx("button",{onClick:()=>m("color",g.value),className:`p-3 rounded-md border-2 transition-colors ${i.color===g.value?"border-gray-400":"border-gray-200 hover:border-gray-300"}`,title:g.name,children:e.jsx("div",{className:`w-full h-6 rounded ${g.bgClass} flex items-center justify-center`,children:e.jsx(C,{path:Ue,size:.8,className:g.textClass})})},g.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preview"}),e.jsx("div",{className:"p-3 border border-gray-200 rounded-md bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:`${i.color}20`},children:e.jsx(C,{path:((a=hl.find(g=>g.name===i.icon))==null?void 0:a.path)||"mdiCheckCircle",size:.8,color:i.color})}),e.jsx("span",{className:"font-medium text-gray-800",children:i.name||"Status Name"})]})})]}),d.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:d.map((g,v)=>e.jsxs("li",{children:["• ",g]},v))})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:o||!i.name.trim(),className:`px-4 py-2 rounded-md transition-colors ${o||!i.name.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,children:o?"Creating...":"Create Status"})]})]})]})}):null};var k0=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Jv=()=>{const{rooms:r,addRoom:t,updateRoom:s,deleteRoom:n}=Ms(),{getCoreStatusTypes:a,getCustomStatusTypes:i,addStatusType:c,deleteStatusType:o,publishStatusType:l,unpublishStatusType:d,getStatusCountInfo:x,canAddCustomStatus:m}=Mi(),p=a(),f=i(),[g,v]=u.useState(!1),[j,h]=u.useState(null),[y,b]=u.useState(!1),[_,P]=u.useState(!1),[$,D]=u.useState(!1),w=M=>{t({name:M.name||"",department:M.department||"",floor:M.floor||"",barcode:M.barcode||"",isActive:!0}),v(!1)},T=M=>{j&&(s(j.id,M),h(null))},k=M=>{h(M)},S=()=>{v(!1),h(null)},I=(M,H)=>{s(M,{isActive:!H})},E=M=>{n(M)},O=()=>{},A=M=>{o(M)},B=(M,H)=>{H?l(M):d(M)},R=M=>k0(null,null,function*(){try{yield c(M),D(!1)}catch(H){throw console.error("Error creating status:",H),H}}),Q=M=>{const H=Ps(M);if(!H)return;const V=dl(H),X=f.map(te=>te.name.toLowerCase());V.filter(te=>!X.includes(te.name.toLowerCase())).forEach(te=>{c(te)})},q=M=>{const H=Ps(M);if(!H)return;f.forEach(X=>{o(X.id)}),dl(H).forEach(X=>{c(X)})};return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>b(!y),className:"flex items-center text-xl font-semibold text-gray-800 hover:text-gray-600 transition-colors",children:[e.jsx(C,{path:y?pt:Et,size:1.2,className:"mr-2"}),"Room Management",e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",r.filter(M=>M.isActive).length," active)"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>P(!_),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:[e.jsx(C,{path:Zt,size:1,className:"mr-2"}),"Status Types"]}),e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:He,size:1,className:"mr-2"}),"Add Room"]})]})]}),_&&e.jsxs("div",{className:"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-purple-800",children:"Custom Status Types"}),e.jsx("div",{className:"text-sm text-purple-600 mt-1",children:(()=>{const M=x();return`${M.custom}/${M.maxCustom} custom statuses used (${M.total}/8 total)`})()})]}),e.jsxs("button",{onClick:()=>D(!0),disabled:!m(),className:`flex items-center px-3 py-1 rounded-md transition-colors text-sm ${m()?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:m()?"Add a new custom status":"Maximum of 4 custom statuses reached",children:[e.jsx(C,{path:He,size:.8,className:"mr-1"}),"Add Custom Status"]})]}),e.jsx(f0,{customStatuses:f,onLoadBundle:Q,onReplaceWithBundle:q}),e.jsx(g0,{coreStatuses:p,customStatuses:f,onEditStatus:O,onDeleteStatus:A,onTogglePublishStatus:B,statusCountInfo:x()})]}),e.jsx(h0,{isOpen:g||!!j,onClose:S,room:j,mode:g?"add":"edit",onSave:g?w:T}),y&&e.jsx(o0,{rooms:r,onEditRoom:k,onDeleteRoom:E,onToggleActive:I}),e.jsx(T0,{isOpen:$,onClose:()=>D(!1),onSave:R,existingStatuses:[...p,...f]})]})},I0={title:"",category:"setup",autoSchedule:!1,scheduleFrequency:"weekly",scheduleDay:"monday",scheduleTime:"09:00",schedulePriority:"medium",schedulePoints:50,scheduleDuration:30,triggerRoomStatus:!1,triggerStaffSchedule:!1,triggerAdminDecision:!1};var P0=Object.defineProperty,D0=Object.defineProperties,E0=Object.getOwnPropertyDescriptors,gl=Object.getOwnPropertySymbols,O0=Object.prototype.hasOwnProperty,$0=Object.prototype.propertyIsEnumerable,fl=(r,t,s)=>t in r?P0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,A0=(r,t)=>{for(var s in t||(t={}))O0.call(t,s)&&fl(r,s,t[s]);if(gl)for(var s of gl(t))$0.call(t,s)&&fl(r,s,t[s]);return r},R0=(r,t)=>D0(r,E0(t)),bl=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const B0=(r,t)=>{const[s,n]=u.useState(I0),[a,i]=u.useState(!1),[c,o]=u.useState(!1),[l,d]=u.useState([]);u.useEffect(()=>{r?n({title:r.title,category:r.category,autoSchedule:r.autoSchedule||!1,scheduleFrequency:r.scheduleFrequency||"weekly",scheduleDay:r.scheduleDay||"monday",scheduleTime:r.scheduleTime||"09:00",schedulePriority:r.schedulePriority||"medium",schedulePoints:r.schedulePoints||50,scheduleDuration:r.scheduleDuration||30,triggerRoomStatus:r.triggerRoomStatus||!1,triggerStaffSchedule:r.triggerStaffSchedule||!1,triggerAdminDecision:r.triggerAdminDecision||!1}):t&&n({title:"",category:"setup",autoSchedule:!1,scheduleFrequency:"weekly",scheduleDay:"monday",scheduleTime:"09:00",schedulePriority:"medium",schedulePoints:50,scheduleDuration:30,triggerRoomStatus:!1,triggerStaffSchedule:!1,triggerAdminDecision:!1})},[r,t]);const x=()=>bl(null,null,function*(){o(!0);try{try{const g=yield Os.askAI(`Generate 8 checklist title suggestions for the ${s.category} category. Each title should be descriptive and follow healthcare facility naming conventions.`,{module:"checklist-form",facilityId:"unknown",userId:"unknown"}),v=p(g);d(v),i(!0)}catch(g){console.warn("AI service failed, using fallback suggestions:",g);const v=yield f(s.category);d(v),i(!0)}}catch(g){console.error("Error generating AI suggestions:",g);const v=yield f(s.category);d(v),i(!0)}finally{o(!1)}}),m=g=>{n(v=>R0(A0({},v),{title:g})),i(!1)},p=g=>{try{const v=g.match(/\[[\s\S]*\]/);if(v){const y=JSON.parse(v[0]);if(Array.isArray(y))return y.map(b=>typeof b=="string"?b:b.title||b.name||b.suggestion||"Untitled Checklist")}const j=g.split(`
`).filter(y=>y.trim()),h=[];for(const y of j)if(y.match(/^\d+\./)){const b=y.replace(/^\d+\.\s*/,"").trim();b&&h.push(b)}else y.trim()&&!y.toLowerCase().includes("category")&&!y.toLowerCase().includes("suggestions")&&h.push(y.trim());return h.length>0?h:["AI-generated checklist","Custom checklist","Professional checklist"]}catch(v){return console.error("Error parsing AI response:",v),["AI-generated checklist","Custom checklist","Professional checklist"]}},f=g=>bl(null,null,function*(){return yield new Promise(j=>setTimeout(j,1e3)),{setup:["Treatment Room Setup Checklist","Surgical Suite Preparation","Examination Room Setup","Emergency Room Preparation","Laboratory Setup Protocol","Radiology Room Setup","Pharmacy Setup Checklist","Reception Area Setup"],patient:["Patient Room Cleaning Protocol","Isolation Room Procedures","Post-Procedure Room Cleanup","Patient Equipment Sanitization","Bedside Supply Restocking","Patient Safety Equipment Check","Infection Control Protocol","Patient Comfort Items Setup"],weekly:["Weekly Deep Cleaning Protocol","Equipment Maintenance Schedule","Supply Inventory Audit","Safety Equipment Inspection","Emergency Equipment Check","Compliance Documentation Review","Staff Training Verification","Quality Assurance Audit"],public:["Waiting Room Maintenance","Lobby Cleaning Protocol","Restroom Sanitization","Common Area Disinfection","Public Equipment Cleaning","Visitor Area Maintenance","Cafeteria Cleaning Protocol","Parking Area Maintenance"],deep:["Post-Contamination Deep Clean","Equipment Sterilization Protocol","Ventilation System Cleaning","Structural Disinfection","Biohazard Cleanup Protocol","Emergency Response Cleanup","Infection Outbreak Response","Facility-Wide Sanitization"]}[g]||[]});return{checklistFormData:s,showAIChecklistSuggestions:a,isGeneratingSuggestions:c,aiChecklistSuggestions:l,setChecklistFormData:n,setShowAIChecklistSuggestions:i,generateAIChecklistSuggestions:x,applyAIChecklistSuggestion:m}},F0=[{id:"setup",title:"Setup/Take Down",icon:Me,color:"#FF6B6B"},{id:"patient",title:"Per Patient",icon:hi,color:"#4ECDC4"},{id:"weekly",title:"Weekly",icon:gi,color:"#45B7D1"},{id:"public",title:"Public Spaces",icon:fi,color:"#96CEB4"},{id:"deep",title:"Deep Clean",icon:bi,color:"#FF9F1C"}];var M0=Object.defineProperty,L0=Object.defineProperties,z0=Object.getOwnPropertyDescriptors,yl=Object.getOwnPropertySymbols,U0=Object.prototype.hasOwnProperty,q0=Object.prototype.propertyIsEnumerable,vl=(r,t,s)=>t in r?M0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,jl=(r,t)=>{for(var s in t||(t={}))U0.call(t,s)&&vl(r,s,t[s]);if(yl)for(var s of yl(t))q0.call(t,s)&&vl(r,s,t[s]);return r},wl=(r,t)=>L0(r,z0(t));const H0=({checklistFormData:r,setChecklistFormData:t,showAIChecklistSuggestions:s,isGeneratingSuggestions:n,aiChecklistSuggestions:a,onGenerateAISuggestions:i,onApplyAISuggestion:c,onCloseAISuggestions:o})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"checklist-title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Checklist Title"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{id:"checklist-title",type:"text",value:r.title,onChange:l=>t(wl(jl({},r),{title:l.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"e.g., Treatment Room Setup"}),e.jsxs("button",{onClick:i,disabled:n,className:"flex items-center px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-400 transition-colors",title:"Get AI suggestions for checklist titles",children:[e.jsx(C,{path:dc,size:.8,className:"mr-1"}),n?"...":"AI"]})]}),s&&e.jsxs("div",{className:"mt-3 p-3 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h5",{className:"text-sm font-medium text-purple-800 flex items-center",children:[e.jsx(C,{path:ys,size:.8,className:"mr-1"}),"AI Suggestions"]}),e.jsx("button",{onClick:o,className:"text-purple-600 hover:text-purple-800",children:e.jsx(C,{path:ae,size:.8})})]}),e.jsx("div",{className:"space-y-2",children:a.map((l,d)=>e.jsx("button",{onClick:()=>c(l),className:"w-full text-left p-2 text-sm text-purple-700 hover:bg-purple-100 rounded-md transition-colors",children:l},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"checklist-category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsx("select",{id:"checklist-category",value:r.category,onChange:l=>t(wl(jl({},r),{category:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:F0.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))})]})]});var V0=Object.defineProperty,W0=Object.defineProperties,G0=Object.getOwnPropertyDescriptors,Nl=Object.getOwnPropertySymbols,K0=Object.prototype.hasOwnProperty,Q0=Object.prototype.propertyIsEnumerable,Cl=(r,t,s)=>t in r?V0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,ke=(r,t)=>{for(var s in t||(t={}))K0.call(t,s)&&Cl(r,s,t[s]);if(Nl)for(var s of Nl(t))Q0.call(t,s)&&Cl(r,s,t[s]);return r},Ie=(r,t)=>W0(r,G0(t));const Y0=({checklistFormData:r,setChecklistFormData:t})=>e.jsxs("div",{className:"mt-6 p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-md font-medium text-blue-800 flex items-center",children:[e.jsx(C,{path:ze,size:1,className:"mr-2"}),"Scheduling Configuration"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.autoSchedule||!1,onChange:s=>t(Ie(ke({},r),{autoSchedule:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Enable Auto-Scheduling"})]})]}),r.autoSchedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-frequency",className:"block text-sm font-medium text-blue-700 mb-1",children:"Frequency"}),e.jsxs("select",{id:"schedule-frequency",value:r.scheduleFrequency||"weekly",onChange:s=>t(Ie(ke({},r),{scheduleFrequency:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"per_patient",children:"Per Patient"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"bi_weekly",children:"Bi-Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),(r.scheduleFrequency==="weekly"||r.scheduleFrequency==="bi_weekly"||r.scheduleFrequency==="monthly")&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-day",className:"block text-sm font-medium text-blue-700 mb-1",children:"Schedule Day"}),e.jsxs("select",{id:"schedule-day",value:r.scheduleDay||"monday",onChange:s=>t(Ie(ke({},r),{scheduleDay:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"monday",children:"Monday"}),e.jsx("option",{value:"tuesday",children:"Tuesday"}),e.jsx("option",{value:"wednesday",children:"Wednesday"}),e.jsx("option",{value:"thursday",children:"Thursday"}),e.jsx("option",{value:"friday",children:"Friday"}),e.jsx("option",{value:"saturday",children:"Saturday"}),e.jsx("option",{value:"sunday",children:"Sunday"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-time",className:"block text-sm font-medium text-blue-700 mb-1",children:"Schedule Time"}),e.jsx("input",{id:"schedule-time",type:"time",value:r.scheduleTime||"09:00",onChange:s=>t(Ie(ke({},r),{scheduleTime:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-priority",className:"block text-sm font-medium text-blue-700 mb-1",children:"Priority"}),e.jsxs("select",{id:"schedule-priority",value:r.schedulePriority||"medium",onChange:s=>t(Ie(ke({},r),{schedulePriority:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-points",className:"block text-sm font-medium text-blue-700 mb-1",children:"Points"}),e.jsx("input",{id:"schedule-points",type:"number",value:r.schedulePoints||50,onChange:s=>t(Ie(ke({},r),{schedulePoints:parseInt(s.target.value)})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-duration",className:"block text-sm font-medium text-blue-700 mb-1",children:"Duration (minutes)"}),e.jsx("input",{id:"schedule-duration",type:"number",value:r.scheduleDuration||30,onChange:s=>t(Ie(ke({},r),{scheduleDuration:parseInt(s.target.value)})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-700 mb-2",children:"Trigger Conditions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.triggerRoomStatus||!1,onChange:s=>t(Ie(ke({},r),{triggerRoomStatus:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Trigger on room status change"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.triggerStaffSchedule||!1,onChange:s=>t(Ie(ke({},r),{triggerStaffSchedule:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Trigger based on staff availability"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.triggerAdminDecision||!1,onChange:s=>t(Ie(ke({},r),{triggerAdminDecision:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Require admin approval"})]})]})]})]})]}),J0=({selectedChecklist:r,onSaveDraft:t,onPublish:s,isValid:n=!0})=>e.jsxs("div",{className:"flex justify-end mt-4 space-x-3",children:[e.jsxs("button",{onClick:t,disabled:!n,className:`flex items-center px-6 py-2 rounded-lg font-semibold text-lg ${n?"bg-gray-500 text-white hover:bg-gray-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(C,{path:Ue,size:1,className:"mr-2"}),"Save Draft"]}),r&&e.jsxs("button",{onClick:s,disabled:!n,className:`flex items-center px-6 py-2 rounded-lg font-semibold text-lg ${n?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(C,{path:Ue,size:1,className:"mr-2"}),"Publish"]})]}),X0=({selectedChecklist:r,isAddingChecklist:t,onSaveDraft:s,onPublish:n})=>{const{checklistFormData:a,showAIChecklistSuggestions:i,isGeneratingSuggestions:c,aiChecklistSuggestions:o,setChecklistFormData:l,setShowAIChecklistSuggestions:d,generateAIChecklistSuggestions:x,applyAIChecklistSuggestion:m}=B0(r,t),p=()=>{a.title&&a.category&&s(a)},f=()=>{a.title&&a.category&&(s(a),n())},g=a.title.trim()!==""&&a.category!==null;return e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-md font-medium mb-3",children:"Checklist Details"}),e.jsx(H0,{checklistFormData:a,setChecklistFormData:l,showAIChecklistSuggestions:i,isGeneratingSuggestions:c,aiChecklistSuggestions:o,onGenerateAISuggestions:x,onApplyAISuggestion:m,onCloseAISuggestions:()=>d(!1)}),e.jsx(Y0,{checklistFormData:a,setChecklistFormData:l}),e.jsx(J0,{selectedChecklist:r,onSaveDraft:p,onPublish:f,isValid:g})]})},Z0=[{id:"setup",title:"Setup/Take Down",icon:Me,color:"#FF6B6B"},{id:"patient",title:"Per Patient",icon:hi,color:"#4ECDC4"},{id:"weekly",title:"Weekly",icon:gi,color:"#45B7D1"},{id:"public",title:"Public Spaces",icon:fi,color:"#96CEB4"},{id:"deep",title:"Deep Clean",icon:bi,color:"#FF9F1C"}],eb=({checklists:r,onEditChecklist:t,onDeleteChecklist:s})=>{const[n,a]=u.useState(new Set(["setup"])),i=c=>{a(o=>{const l=new Set(o);return l.has(c)?l.delete(c):l.add(c),l})};return e.jsx("div",{className:"space-y-6",children:Z0.map(c=>{const o=r.filter(m=>m.category===c.id),l=o.filter(m=>m.status==="published"),d=o.filter(m=>m.status==="draft"),x=n.has(c.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("button",{onClick:()=>i(c.id),className:"flex items-center w-full text-left hover:bg-gray-50 p-2 -m-2 rounded-md transition-colors",children:[e.jsx(C,{path:c.icon,size:1.2,color:c.color,className:"mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:c.title}),e.jsxs("span",{className:"ml-2 px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:[l.length," published, ",d.length," ","draft"]}),e.jsx(C,{path:x?pt:Et,size:1,className:"ml-auto text-gray-400"})]}),x&&e.jsx(e.Fragment,{children:o.length===0?e.jsx("p",{className:"text-gray-500 text-sm italic mt-4",children:"No checklists created yet."}):e.jsxs("div",{className:"space-y-3 mt-4",children:[l.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Published Checklists"}),l.map(m=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:m.title}),e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[m.items.length," item",m.items.length!==1?"s":""]}),e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${m.status==="published"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:m.status==="published"?"Published":"Draft"}),m.autoSchedule&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full flex items-center",children:[e.jsx(C,{path:ze,size:.7,className:"mr-1"}),"Auto-Scheduled"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>t(m),className:"px-3 py-1 text-sm text-[#4ECDC4] hover:bg-[#4ECDC4] hover:text-white rounded-md transition-colors",children:"Edit & Manage"}),e.jsx("button",{onClick:()=>s(m.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:Dt,size:.8})})]})]})},m.id))]}),d.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Draft Checklists"}),d.map(m=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:m.title}),e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[m.items.length," item",m.items.length!==1?"s":""]}),e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${m.status==="published"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:m.status==="published"?"Published":"Draft"}),m.autoSchedule&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full flex items-center",children:[e.jsx(C,{path:ze,size:.7,className:"mr-1"}),"Auto-Scheduled"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>t(m),className:"px-3 py-1 text-sm text-[#4ECDC4] hover:bg-[#4ECDC4] hover:text-white rounded-md transition-colors",children:"Edit & Manage"}),e.jsx("button",{onClick:()=>s(m.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:Dt,size:.8})})]})]})},m.id))]})]})})]},c.id)})})},tb=r=>{const t=r.data&&typeof r.data=="object"&&r.data!==null?r.data.expiration:null;if(!t&&!r.expiryDate)return null;const s=new Date(String(t||r.expiryDate||"")),n=new Date,a=new Date;return a.setDate(n.getDate()+30),s<n?{status:"expired",color:"text-red-600",bgColor:"bg-red-50"}:s<=a?{status:"expiring-soon",color:"text-orange-600",bgColor:"bg-orange-50"}:{status:"valid",color:"text-green-600",bgColor:"bg-green-50"}},sb=r=>new Date(r).toLocaleDateString(),dr=(r,t)=>({searchQuery:r.trim()||void 0,category:t.category||void 0,manufacturer:t.manufacturer||void 0,supplier:t.supplier||void 0,reorder_point:t.reorder_point?parseInt(t.reorder_point):void 0,expiryDate:t.expiryDate||void 0,sortBy:t.sortBy,sortDirection:t.sortDirection}),Sl=()=>({category:"",location:"",status:"",manufacturer:"",supplier:"",reorder_point:"",expiryDate:"",sortBy:"name",sortDirection:"asc"});var rb=Object.defineProperty,ab=Object.defineProperties,nb=Object.getOwnPropertyDescriptors,_l=Object.getOwnPropertySymbols,lb=Object.prototype.hasOwnProperty,ib=Object.prototype.propertyIsEnumerable,Tl=(r,t,s)=>t in r?rb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,kl=(r,t)=>{for(var s in t||(t={}))lb.call(t,s)&&Tl(r,s,t[s]);if(_l)for(var s of _l(t))ib.call(t,s)&&Tl(r,s,t[s]);return r},ob=(r,t)=>ab(r,nb(t)),Ct=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class cb{searchInventoryItems(t){return Ct(this,null,function*(){try{const s=ob(kl(kl({search:t.searchQuery,category:t.category},t.manufacturer&&{search:`${t.searchQuery||""} ${t.manufacturer}`.trim()}),t.supplier&&{search:`${t.searchQuery||""} ${t.supplier}`.trim()}),{minQuantity:t.reorder_point}),n=yield gt.getItemsFromSupabase(s);if(n.error)return console.error("Error fetching inventory items:",n.error),[];let a=n.data||[];if(t.manufacturer&&!t.searchQuery&&(a=a.filter(i=>(i.data&&typeof i.data=="object"&&i.data!==null?i.data.manufacturer:null)===t.manufacturer)),t.supplier&&!t.searchQuery&&(a=a.filter(i=>(i.data&&typeof i.data=="object"&&i.data!==null?i.data.supplier:null)===t.supplier)),t.expiryDate){const i=new Date,c=new Date;c.setDate(i.getDate()+30),a=a.filter(o=>{const l=o.data&&typeof o.data=="object"&&o.data!==null?o.data.expiration:null;if(!l&&!o.expiration_date)return!1;const d=new Date(String(l||o.expiration_date||""));switch(t.expiryDate){case"expired":return d<i;case"expiring-soon":return d>=i&&d<=c;case"valid":return d>c;default:return!0}})}return t.sortBy&&a.sort((i,c)=>{let o,l;switch(t.sortBy){case"name":o=i.name||"",l=c.name||"";break;case"category":o=i.category||"",l=c.category||"";break;case"quantity":o=i.quantity||0,l=c.quantity||0;break;case"expiration":{const d=i.data&&typeof i.data=="object"&&i.data!==null?i.data.expiration:null,x=c.data&&typeof c.data=="object"&&c.data!==null?c.data.expiration:null;o=new Date(String(d||i.expiration_date||"")),l=new Date(String(x||c.expiration_date||""));break}case"unit_cost":o=i.unit_cost||0,l=c.unit_cost||0;break;default:return 0}return t.sortDirection==="desc"?o>l?-1:o<l?1:0:o<l?-1:o>l?1:0}),a}catch(s){return console.error("Error in searchInventoryItems:",s),[]}})}getCategories(){return Ct(this,null,function*(){try{const t=yield gt.getItemsFromSupabase();return t.error?(console.error("Error fetching categories:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.category).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getCategories:",t),[]}})}getManufacturers(){return Ct(this,null,function*(){try{const t=yield gt.getItemsFromSupabase();return t.error?(console.error("Error fetching manufacturers:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.data&&typeof n.data=="object"&&n.data!==null?n.data.manufacturer:null).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getManufacturers:",t),[]}})}getSuppliers(){return Ct(this,null,function*(){try{const t=yield gt.getItemsFromSupabase();return t.error?(console.error("Error fetching suppliers:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.data&&typeof n.data=="object"&&n.data!==null?n.data.supplier:null).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getSuppliers:",t),[]}})}getLocations(){return Ct(this,null,function*(){try{const t=yield gt.getItemsFromSupabase();return t.error?(console.error("Error fetching locations:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.location).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getLocations:",t),[]}})}getStatuses(){return Ct(this,null,function*(){try{const t=yield gt.getItemsFromSupabase();return t.error?(console.error("Error fetching statuses:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.status).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getStatuses:",t),[]}})}}const ct=new cb;var ur=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const db=()=>{const[r,t]=u.useState([]),[s,n]=u.useState(!1),[a,i]=u.useState(null),[c,o]=u.useState([]),[l,d]=u.useState([]),[x,m]=u.useState([]),[p,f]=u.useState([]),[g,v]=u.useState([]);u.useEffect(()=>{ur(null,null,function*(){try{const[b,_,P,$,D]=yield Promise.all([ct.getCategories(),ct.getLocations(),ct.getStatuses(),ct.getManufacturers(),ct.getSuppliers()]);o(b),d(_),m(P),f($),v(D)}catch(b){i(b instanceof Error?b.message:"Failed to load filter options")}})},[]);const j=u.useCallback(y=>ur(null,null,function*(){n(!0),i(null);try{const b=yield ct.searchInventoryItems(y);t(b)}catch(b){i(b instanceof Error?b.message:"Failed to search inventory")}finally{n(!1)}}),[]),h=u.useCallback(()=>ur(null,null,function*(){n(!0),i(null);try{const y=yield ct.searchInventoryItems({});t(y)}catch(y){i(y instanceof Error?y.message:"Failed to clear search")}finally{n(!1)}}),[]);return{inventoryItems:r,isLoading:s,error:a,categories:c,locations:l,statuses:x,manufacturers:p,suppliers:g,searchInventory:j,clearSearch:h}},ub=({isOpen:r,selectedItems:t=[],onSelectItems:s,onClose:n})=>{const{inventoryItems:a,isLoading:i,error:c,categories:o,locations:l,statuses:d,searchInventory:x,clearSearch:m}=db(),[p,f]=u.useState(""),[g,v]=u.useState(!1),[j,h]=u.useState(Sl()),[y,b]=u.useState(t);return u.useEffect(()=>{if(!r)return;const w=setTimeout(()=>{if(p.trim()||Object.values(j).some(T=>T!=="")){const T=dr(p,j);x(T)}},300);return()=>clearTimeout(w)},[p,j,r,x]),u.useEffect(()=>{if(r){m(),b(t);const w=dr(p,j);x(w)}},[r,t,m,x,p,j]),u.useEffect(()=>{b(t)},[t]),{searchQuery:p,showFilters:g,filters:j,localSelectedItems:y,inventoryItems:a,isLoading:i,error:c,categories:o,locations:l,statuses:d,setSearchQuery:f,setShowFilters:v,setFilters:h,handleClearFilters:()=>{h(Sl()),f(""),m().then(()=>{setTimeout(()=>{x({})},100)})},handleItemToggle:w=>{const T=y.some(k=>k.id===w.id);b(T?k=>k.filter(S=>S.id!==w.id):k=>[...k,w])},handleConfirmSelection:()=>{s(y),n()},handleSearch:()=>{const w=dr(p,j);x(w)}}},mb=({onClose:r})=>e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Search Inventory Items"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Select items for your checklist with advanced filtering"})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(C,{path:ae,size:1.5})})]}),xb=({searchQuery:r,onSearchChange:t,onSearch:s})=>{const n=a=>{a.key==="Enter"&&s()};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{path:uc,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search items...",value:r,onChange:a=>t(a.target.value),onKeyPress:n,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]"})]}),e.jsx("button",{onClick:s,className:"w-full mt-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] transition-colors",children:"Search"})]})};var pb=Object.defineProperty,hb=Object.defineProperties,gb=Object.getOwnPropertyDescriptors,Il=Object.getOwnPropertySymbols,fb=Object.prototype.hasOwnProperty,bb=Object.prototype.propertyIsEnumerable,Pl=(r,t,s)=>t in r?pb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,yb=(r,t)=>{for(var s in t||(t={}))fb.call(t,s)&&Pl(r,s,t[s]);if(Il)for(var s of Il(t))bb.call(t,s)&&Pl(r,s,t[s]);return r},vb=(r,t)=>hb(r,gb(t));const jb=({filters:r,onFiltersChange:t,onClearFilters:s,categories:n,showFilters:a,onToggleFilters:i})=>{const c=(o,l)=>{t(vb(yb({},r),{[o]:l}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900",children:[e.jsx(C,{path:$r,size:1}),e.jsx("span",{children:"Filters"}),e.jsx(C,{path:mc,size:1,className:`transform transition-transform ${a?"rotate-180":""}`})]})}),e.jsx(Bs,{children:a&&e.jsxs(me.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{id:"category-filter",value:r.category,onChange:o=>c("category",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"",children:"All Categories"}),n.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"min-quantity-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Quantity"}),e.jsx("input",{id:"min-quantity-filter",type:"number",value:r.reorder_point,onChange:o=>c("reorder_point",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"max-quantity-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Quantity"}),e.jsx("input",{id:"max-quantity-filter",type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"∞"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry-status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Status"}),e.jsxs("select",{id:"expiry-status-filter",value:r.expiryDate,onChange:o=>c("expiryDate",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"",children:"All Items"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"expiring-soon",children:"Expiring Soon (30 days)"}),e.jsx("option",{value:"valid",children:"Valid"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsxs("select",{id:"sort-by-filter",value:r.sortBy,onChange:o=>c("sortBy",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"quantity",children:"Quantity"}),e.jsx("option",{value:"expiration",children:"Expiration"}),e.jsx("option",{value:"unit_cost",children:"Unit Cost"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-direction-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Direction"}),e.jsxs("select",{id:"sort-direction-filter",value:r.sortDirection,onChange:o=>c("sortDirection",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"asc",children:"Ascending"}),e.jsx("option",{value:"desc",children:"Descending"})]})]})]}),e.jsx("button",{onClick:s,className:"w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Clear Filters"})]})})]})},wb=({selectedItems:r})=>e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Selected Items"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.length," item",r.length!==1?"s":""," ","selected"]}),r.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[r.slice(0,3).map(t=>e.jsx("div",{className:"text-xs text-gray-600 truncate",children:t.name},t.id)),r.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",r.length-3," more"]})]})]}),Nb=({item:r,isSelected:t,onToggle:s})=>{const n=tb(r),a=i=>{var c;return(c=r.data)==null?void 0:c[i]};return e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`border rounded-lg p-4 cursor-pointer transition-all ${t?"border-[#4ECDC4] bg-[#4ECDC4]/5":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>s(r),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:r.name}),t&&e.jsx("span",{className:"px-2 py-1 text-xs bg-[#4ECDC4] text-white rounded-full",children:"Selected"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:Rs,size:.8}),e.jsx("span",{children:r.category})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:jr,size:.8}),e.jsx("span",{children:r.location})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"font-medium",children:"Quantity:"}),e.jsxs("span",{children:[r.quantity||0," ",String(a("unit")||"units")]})]})]}),e.jsxs("div",{className:"space-y-1",children:[a("manufacturer")?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:xc,size:.8}),e.jsx("span",{children:String(a("manufacturer"))})]}):null,a("supplier")?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:pc,size:.8}),e.jsx("span",{children:String(a("supplier"))})]}):null,a("expiration")||r.expiryDate?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:ze,size:.8}),e.jsxs("span",{children:["Expires:"," ",sb(String(a("expiration")||r.expiryDate||""))]})]}):null]})]}),n&&e.jsxs("div",{className:`mt-2 inline-block px-2 py-1 text-xs rounded-full ${n.bgColor} ${n.color}`,children:[n.status==="expired"&&"Expired",n.status==="expiring-soon"&&"Expiring Soon",n.status==="valid"&&"Valid"]})]})})})},Cb=({inventoryItems:r,selectedItems:t,onItemToggle:s,isLoading:n,error:a})=>e.jsxs("div",{className:"w-2/3 p-6 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Search Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:n?"Searching...":`${r.length} items found`})]})}),a&&e.jsxs("div",{className:"flex items-center space-x-2 text-red-500 mb-4",children:[e.jsx(C,{path:ce,size:1}),e.jsx("span",{children:a})]}),n&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:Or,size:1,className:"animate-spin text-[#4ECDC4]"}),e.jsx("span",{className:"text-gray-600",children:"Searching inventory..."})]})}),!n&&!a&&e.jsx("div",{className:"space-y-3",children:r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{path:Rs,size:3,className:"mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No items found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria."})]}):r.map(i=>{const c=t.some(o=>o.id===i.id);return e.jsx(Nb,{item:i,isSelected:c,onToggle:s},i.id)})})]}),Sb=({isOpen:r,onClose:t,onSelectItems:s,selectedItems:n=[]})=>{const{searchQuery:a,showFilters:i,filters:c,localSelectedItems:o,inventoryItems:l,isLoading:d,error:x,categories:m,locations:p,statuses:f,setSearchQuery:g,setShowFilters:v,setFilters:j,handleClearFilters:h,handleItemToggle:y,handleConfirmSelection:b,handleSearch:_}=ub({isOpen:r,selectedItems:n,onSelectItems:s,onClose:t});return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(me.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsx(mb,{onClose:t}),e.jsxs("div",{className:"flex h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 p-6 overflow-y-auto",children:[e.jsx(xb,{searchQuery:a,onSearchChange:g,onSearch:_}),e.jsx(jb,{filters:c,onFiltersChange:j,onClearFilters:h,categories:m,locations:p,statuses:f,showFilters:i,onToggleFilters:()=>v(!i)}),e.jsx(wb,{selectedItems:o})]}),e.jsx(Cb,{inventoryItems:l,selectedItems:o,onItemToggle:y,isLoading:d,error:x})]}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsxs("button",{onClick:b,disabled:o.length===0,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Confirm Selection (",o.length,")"]})})]})}):null};var _b=Object.defineProperty,Tb=Object.defineProperties,kb=Object.getOwnPropertyDescriptors,Dl=Object.getOwnPropertySymbols,Ib=Object.prototype.hasOwnProperty,Pb=Object.prototype.propertyIsEnumerable,El=(r,t,s)=>t in r?_b(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Kt=(r,t)=>{for(var s in t||(t={}))Ib.call(t,s)&&El(r,s,t[s]);if(Dl)for(var s of Dl(t))Pb.call(t,s)&&El(r,s,t[s]);return r},Qt=(r,t)=>Tb(r,kb(t)),Ol=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Db=({selectedChecklist:r,onAddItem:t,onUpdateItem:s,onDeleteItem:n,onGenerateAIItemSuggestions:a,showAIItemSuggestions:i,isGeneratingSuggestions:c,aiItemSuggestions:o,onApplyAIItemSuggestion:l,onCloseAISuggestions:d,showSuccessMessage:x})=>{const[m,p]=u.useState(!1),[f,g]=u.useState([]),[v,j]=u.useState(!1),[h,y]=u.useState(null),[b,_]=u.useState({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),[P,$]=u.useState(!1),D=()=>{b.title&&b.instructions&&r&&(t({title:b.title,instructions:b.instructions,requiredInventory:f.map(O=>({id:O.id,name:O.name||"",required:1,available:O.quantity||0,used:0,unit:"unit"})),sdsId:b.sdsId||void 0}),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([]),j(!1))},w=O=>{b.title&&b.instructions&&r&&(s(O,{title:b.title,instructions:b.instructions,requiredInventory:f.map(A=>({id:A.id,name:A.name||"",required:1,available:A.quantity||0,used:0,unit:"unit"})),sdsId:b.sdsId||void 0}),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([]),y(null))},T=O=>{var A;y(O.id),_({title:O.title,instructions:O.instructions,inventoryItemIds:((A=O.requiredInventory)==null?void 0:A.map(R=>R.id))||[],sdsId:O.sdsId||""});const B=(O.requiredInventory||[]).map(R=>({id:R.id,facility_id:null,name:R.name,quantity:R.available,data:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:null,category:null,status:null,location:null,supplier:null,cost:null,vendor:null,warranty:null,maintenance_schedule:null,next_due:null,service_provider:null,assigned_to:null,notes:null,tool_id:null,supply_id:null,equipment_id:null,hardware_id:null,p2_status:null,serial_number:null,manufacturer:null,image_url:null,tags:null,favorite:null,tracked:null,barcode:null,sku:null,description:null,current_phase:null,is_active:null,unit:null,expiration:null,purchase_date:null,last_serviced:null,last_updated:null}));g(B)},k=O=>{g(O)},S=(O,A)=>Ol(null,null,function*(){if(O.trim()){$(!0);try{try{const B=yield Os.askAI(`Generate detailed instructions for checklist item "${O}" in the ${A||(r==null?void 0:r.category)} category. Provide step-by-step instructions that are clear and actionable.`,{module:"checklist-item-form",facilityId:"unknown",userId:"unknown"});_(R=>Qt(Kt({},R),{instructions:B}))}catch(B){console.warn("AI service failed, using fallback description:",B);const R=yield E(O,A||(r==null?void 0:r.category));_(Q=>Qt(Kt({},Q),{instructions:R}))}}catch(B){console.error("Error generating AI description:",B),_(R=>Qt(Kt({},R),{instructions:`Complete ${O.toLowerCase()} following established procedures and safety protocols.`}))}finally{$(!1)}}}),I=O=>{if(_(A=>Qt(Kt({},A),{title:O})),O.length>=5&&!b.instructions){const A=setTimeout(()=>{S(O)},1e3);return()=>clearTimeout(A)}return()=>{}},E=(O,A)=>Ol(null,null,function*(){return yield new Promise(R=>setTimeout(R,800)),{setup:`Perform ${O.toLowerCase()} according to facility protocols. Ensure all equipment is properly prepared and safety measures are in place.`,patient:`Complete ${O.toLowerCase()} with patient safety as the priority. Follow infection control protocols and maintain patient privacy.`,weekly:`Conduct thorough ${O.toLowerCase()} as part of weekly maintenance schedule. Document all activities and report any issues.`,public:`Execute ${O.toLowerCase()} in public areas following facility standards. Maintain professional appearance and ensure accessibility.`,deep:`Perform intensive ${O.toLowerCase()} using specialized equipment and procedures. Follow all safety protocols and containment measures.`}[A]||`Complete ${O.toLowerCase()} following established procedures and safety protocols.`});return e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium",children:"Checklist Items"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:a,disabled:c,className:"flex items-center px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-400 transition-colors",title:"Get AI suggestions for checklist items",children:[e.jsx(C,{path:hc,size:.8,className:"mr-1"}),c?"Generating...":"AI Suggestions"]}),e.jsxs("button",{onClick:()=>{j(!0),y(null),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([])},className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:He,size:1,className:"mr-2"}),"Add Item"]})]})]}),i&&e.jsxs("div",{className:"mb-4 p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-purple-800 flex items-center",children:[e.jsx(C,{path:ys,size:.8,className:"mr-1"}),"AI Item Suggestions"]}),e.jsx("button",{onClick:d,className:"text-purple-600 hover:text-purple-800",children:e.jsx(C,{path:ae,size:.8})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:o.map((O,A)=>e.jsxs("div",{className:"border border-purple-200 rounded-lg p-3 bg-white",children:[e.jsx("h6",{className:"font-medium text-purple-800 mb-1",children:O.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:O.instructions}),O.suggestedInventory.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Suggested: "}),e.jsx("span",{className:"text-xs text-purple-600",children:O.suggestedInventory.join(", ")})]}),e.jsx("button",{onClick:()=>l(O),className:"w-full px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:"Use This Item"})]},A))})]}),x&&e.jsx("div",{className:"mb-4 p-3 border border-green-200 rounded-lg bg-green-50",children:e.jsxs("div",{className:"flex items-center text-green-800",children:[e.jsx(C,{path:Ue,size:.8,className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:x})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[r.items.map(O=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-800",children:O.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:O.instructions}),O.requiredInventory&&O.requiredInventory.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Required: "}),O.requiredInventory.map(A=>A.name).join(", ")]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[e.jsx("button",{onClick:()=>T(O),className:"p-1 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx(C,{path:rs,size:.8})}),e.jsx("button",{onClick:()=>n(O.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:Dt,size:.8})})]})]})},O.id)),r.items.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No items added yet. Click "Add Item" to get started.'})]}),v&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsx("h5",{className:"font-medium mb-3",children:h?"Edit Item":"Add New Item"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"item-title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Item Title"}),e.jsx("input",{id:"item-title",type:"text",value:b.title,onChange:O=>I(O.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"e.g., Clean and sanitize surfaces"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:["Instructions",P&&e.jsxs("span",{className:"ml-2 text-xs text-blue-600 flex items-center",children:[e.jsx(C,{path:ys,size:.6,className:"mr-1 animate-pulse"}),"AI generating..."]})]}),b.title&&!P&&e.jsxs("button",{type:"button",onClick:()=>S(b.title),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center",title:"Generate AI description",children:[e.jsx(C,{path:ys,size:.6,className:"mr-1"}),"AI Generate"]})]}),e.jsx("textarea",{value:b.instructions,onChange:O=>_(Qt(Kt({},b),{instructions:O.target.value})),className:`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] ${P?"bg-blue-50 border-blue-200":""}`,rows:3,placeholder:P?"AI is generating instructions...":"Detailed instructions for this task...",disabled:P})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"inventory-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Required Inventory"}),e.jsx("button",{id:"inventory-select",onClick:()=>p(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-left focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:f.length>0?`${f.length} item(s) selected`:"Click to select required inventory items"}),f.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:f.map(O=>e.jsxs("div",{className:"text-sm text-gray-600",children:["• ",O.name]},O.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{j(!1),y(null),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([])},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:()=>h?w(h):D(),className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac]",children:h?"Update Item":"Add Item"})]})]})]}),e.jsx(Sb,{isOpen:m,onClose:()=>p(!1),onSelectItems:k,selectedItems:f})]})};var Eb=Object.defineProperty,Ob=Object.defineProperties,$b=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,Ab=Object.prototype.hasOwnProperty,Rb=Object.prototype.propertyIsEnumerable,Al=(r,t,s)=>t in r?Eb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Bb=(r,t)=>{for(var s in t||(t={}))Ab.call(t,s)&&Al(r,s,t[s]);if($l)for(var s of $l(t))Rb.call(t,s)&&Al(r,s,t[s]);return r},Fb=(r,t)=>Ob(r,$b(t)),Rl=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Xv=()=>{const{checklists:r,updateChecklist:t,deleteChecklist:s,publishChecklist:n,addItemToChecklist:a,updateChecklistItem:i,deleteChecklistItem:c}=Gn(),[o,l]=u.useState(!1),[d,x]=u.useState(null),[m,p]=u.useState(!1),f=B=>{if(d)t(d.id,B);else{const{addChecklist:R}=Gn.getState();R(Fb(Bb({},B),{title:B.title||"New Checklist",items:[],status:"draft"}))}x(null),l(!1)},g=()=>{d&&(n(d.id),x(null))},v=B=>{x(B)},j=()=>{l(!1),x(null)},h=B=>{if(d){a(d.id,B);const R=r.find(Q=>Q.id===d.id);R&&x(R)}},y=(B,R)=>{d&&i(d.id,B,R)},b=B=>{d&&c(d.id,B)},[_,P]=u.useState(!1),[$,D]=u.useState(!1),[w,T]=u.useState([]),[k,S]=u.useState(null),I=()=>Rl(null,null,function*(){if(d){D(!0);try{try{const B=yield Os.askAI(`Generate 5-7 detailed checklist items for "${d.title}" in the ${d.category} category. Each item should include title, detailed instructions, and suggested inventory requirements.`,{module:"checklist-management",facilityId:"unknown",userId:"unknown"}),R=O(B);T(R),P(!0)}catch(B){console.warn("AI service failed, using fallback suggestions:",B);const R=yield A(d.category);T(R),P(!0)}}catch(B){console.error("Error generating AI item suggestions:",B);const R=yield A(d.category);T(R),P(!0)}finally{D(!1)}}}),E=B=>{if(!d)return;a(d.id,{title:B.title,instructions:B.instructions,requiredInventory:[],sdsId:void 0});const R=r.find(Q=>Q.id===d.id);R&&x(R),P(!1),S(`✅ Added "${B.title}" to checklist`),setTimeout(()=>S(null),3e3)},O=B=>{try{const R=B.match(/\[[\s\S]*\]/);if(R){const H=JSON.parse(R[0]);if(Array.isArray(H))return H.map(V=>{var X;return{title:V.title||V.name||"Untitled Item",instructions:V.instructions||((X=V.data)==null?void 0:X.description)||V.steps||"No instructions provided",suggestedInventory:Array.isArray(V.suggestedInventory)?V.suggestedInventory:Array.isArray(V.inventory)?V.inventory:Array.isArray(V.requirements)?V.requirements:[]}})}const Q=B.split(`
`).filter(H=>H.trim()),q=[];let M=null;for(const H of Q)if(H.match(/^\d+\./))M&&q.push(M),M={title:H.replace(/^\d+\.\s*/,"").trim(),instructions:"",suggestedInventory:[]};else if(M&&H.trim())if(H.toLowerCase().includes("inventory")||H.toLowerCase().includes("supplies")){const V=H.match(/[^:]+:\s*(.+)/);V&&(M.suggestedInventory=V[1].split(",").map(X=>X.trim()))}else M.instructions+=(M.instructions?" ":"")+H.trim();return M&&q.push(M),q.length>0?q:[{title:"AI-generated item",instructions:B.substring(0,200)+"...",suggestedInventory:[]}]}catch(R){return console.error("Error parsing AI response:",R),[{title:"AI-generated item",instructions:B.substring(0,200)+"...",suggestedInventory:[]}]}},A=B=>Rl(null,null,function*(){return yield new Promise(Q=>setTimeout(Q,1500)),[{title:"Surface Disinfection",instructions:"Use EPA-approved disinfectant wipes. Clean all high-touch surfaces including door handles, light switches, and equipment controls. Allow 3-5 minutes contact time for proper disinfection.",suggestedInventory:["Disinfectant Wipes","Nitrile Gloves","Safety Goggles"]},{title:"Equipment Sanitization",instructions:"Clean all medical equipment with appropriate cleaning agents. Pay special attention to patient contact surfaces. Verify equipment is operational after cleaning.",suggestedInventory:["Equipment Cleaning Solution","Microfiber Cloths","Alcohol Wipes"]},{title:"Supply Restocking",instructions:"Check all supply levels and restock as needed. Verify expiration dates on all items. Ensure emergency supplies are readily accessible.",suggestedInventory:["Various Medical Supplies","Storage Containers","Labeling Materials"]},{title:"Safety Equipment Check",instructions:"Verify all safety equipment is present and functional. Test emergency systems and alarms. Check fire extinguishers and emergency exits.",suggestedInventory:["Safety Equipment","Testing Tools","Documentation Forms"]},{title:"Quality Control Verification",instructions:"Perform final quality control check. Verify all cleaning standards have been met. Document completion and any issues found.",suggestedInventory:["Quality Control Checklist","Documentation Forms","Camera for Documentation"]}]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>p(!m),className:"flex items-center text-xl font-semibold text-gray-800 hover:text-gray-600 transition-colors",children:[e.jsx(C,{path:m?pt:Et,size:1.2,className:"mr-2"}),"Checklist Management",e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",r.length," total)"]})]}),e.jsxs("button",{onClick:()=>{l(!0),x(null)},className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:He,size:1,className:"mr-2"}),"Add Checklist"]})]}),m&&e.jsx(eb,{checklists:r,onEditChecklist:v,onDeleteChecklist:s})]}),(d||o)&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto scrollbar-hide",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:o?"Add New Checklist":`Edit: ${d==null?void 0:d.title}`}),e.jsx("button",{onClick:j,className:"p-1 text-gray-500 hover:text-gray-700",children:e.jsx(C,{path:ae,size:1.2})})]}),e.jsx(X0,{selectedChecklist:d,isAddingChecklist:o,onCancel:j,onSaveDraft:f,onPublish:g}),d&&e.jsx(Db,{selectedChecklist:d,onAddItem:h,onUpdateItem:y,onDeleteItem:b,onGenerateAIItemSuggestions:I,showAIItemSuggestions:_,isGeneratingSuggestions:$,aiItemSuggestions:w,onApplyAIItemSuggestion:E,onCloseAISuggestions:()=>P(!1),showSuccessMessage:k})]})})]})},Mb={RATE_LIMIT:{MAX_ATTEMPTS:5,LOCKOUT_DURATION_MINUTES:15,WINDOW_SIZE_MINUTES:15},VALIDATION:{DEBOUNCE_MS:500},THRESHOLDS:{MIN_PASSWORD_LENGTH:8,MAX_LOGIN_ATTEMPTS:5},PASSWORD_STRENGTH:{MIN_LENGTH:8,GOOD_LENGTH:12,EXCELLENT_LENGTH:16,MAX_SCORE:5}},Ki=r=>(Object.keys(r).forEach(t=>{typeof r[t]=="object"&&r[t]!==null&&Ki(r[t])}),Object.freeze(r));Ki(Mb);const Zv=(r,t)=>{if(!r||typeof r!="string")return null;const s=r.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim();return t==="email"?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?s:null:t==="password"&&s.length<8?null:s},ej=r=>{const t=[];return!r||typeof r!="string"?{isSuspicious:!1,threats:t}:(/('|"|;|--|\/\*|\*\/|union|select|insert|update|delete|drop|create|alter)/i.test(r)&&t.push("Potential SQL injection detected"),/<script|javascript:|on\w+\s*=|vbscript:|expression\(/i.test(r)&&t.push("Potential XSS attack detected"),/\||&|;|`|\$\(|eval\(|exec\(/i.test(r)&&t.push("Potential command injection detected"),{isSuspicious:t.length>0,threats:t})},Pr=(r=32)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";if(typeof crypto!="undefined"&&crypto.getRandomValues){const n=new Uint8Array(r);crypto.getRandomValues(n);for(let a=0;a<r;a++)s+=t[n[a]%t.length]}else for(let n=0;n<r;n++)s+=t.charAt(Math.floor(Math.random()*t.length));return s},mr={generateToken:()=>Pr(32),storeToken:r=>{try{typeof window!="undefined"&&localStorage.setItem("csrf_token",r)}catch(t){}},getStoredToken:()=>{try{return typeof window!="undefined"?localStorage.getItem("csrf_token"):null}catch(r){return null}},validateToken:(r,t)=>{if(!r||!t)return!1;const s=r===t;return s},setHttpOnlyCookie:r=>{mr.storeToken(r)},refreshToken:()=>{const r=mr.generateToken();return mr.storeToken(r),r},clearToken:()=>{try{typeof window!="undefined"&&localStorage.removeItem("csrf_token")}catch(r){}}};var Lb=Object.defineProperty,zb=Object.defineProperties,Ub=Object.getOwnPropertyDescriptors,Bl=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,Hb=Object.prototype.propertyIsEnumerable,Fl=(r,t,s)=>t in r?Lb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ml=(r,t)=>{for(var s in t||(t={}))qb.call(t,s)&&Fl(r,s,t[s]);if(Bl)for(var s of Bl(t))Hb.call(t,s)&&Fl(r,s,t[s]);return r},Ll=(r,t)=>zb(r,Ub(t)),zl=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const tj=()=>{const[r,t]=u.useState({}),[s,n]=u.useState("");u.useEffect(()=>{const c=Pr(32);n(c),typeof sessionStorage!="undefined"&&sessionStorage.setItem("oauth_state",c)},[]);const a=c=>zl(null,null,function*(){try{if(t(m=>Ll(Ml({},m),{[c]:!0})),!s)throw new Error("OAuth state not initialized");const o=c==="microsoft"?"azure":c,l=Pr(128),d=yield i(l);typeof sessionStorage!="undefined"&&(sessionStorage.setItem("oauth_code_verifier",l),sessionStorage.setItem("oauth_provider",c));const{error:x}=yield K.auth.signInWithOAuth({provider:o,options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{access_type:"offline",prompt:"consent",state:s,code_challenge:d,code_challenge_method:"S256"}}});if(x)throw console.error(`OAuth login error with ${c}:`,x),x;$c()&&console.log(`[SECURITY] OAuth login initiated with ${c}:`,{provider:o,state:s,codeChallenge:d,timestamp:new Date().toISOString()})}catch(o){console.error(`Failed to login with ${c}:`,o),typeof sessionStorage!="undefined"&&(sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),sessionStorage.removeItem("oauth_state")),alert(`Failed to login with ${c}. Please try again.`)}finally{t(o=>Ll(Ml({},o),{[c]:!1}))}}),i=c=>zl(null,null,function*(){try{const l=new TextEncoder().encode(c),d=yield crypto.subtle.digest("SHA-256",l),x=Array.from(new Uint8Array(d));return btoa(String.fromCharCode(...x)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(o){return console.error("Failed to generate PKCE code challenge:",o),c.substring(0,43)}});return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>a("google"),disabled:r.google||!s,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.google?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):e.jsx(So,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"ml-2",children:"Google"})]}),e.jsxs("button",{type:"button",onClick:()=>a("microsoft"),disabled:r.microsoft||!s,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.microsoft?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):e.jsx(_o,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"ml-2",children:"Microsoft"})]})]})]})};var Vb=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Wb=()=>{const r=Es(),{setAuthToken:t,setSessionExpiry:s}=Br();return u.useEffect(()=>{Vb(null,null,function*(){var a,i,c,o,l,d,x,m,p,f,g,v;try{const h=new URLSearchParams(window.location.search).get("state"),y=sessionStorage.getItem("oauth_state");if(h&&y&&h!==y){console.error("OAuth state mismatch - possible CSRF attack"),r("/login?error=invalid_state");return}const{data:b,error:_}=yield K.auth.getSession();if(_){console.error("Auth callback error:",_),r("/login?error=auth_failed");return}if(b.session){if(console.log("OAuth authentication successful, setting up user session"),t(b.session.access_token),s(b.session.expires_at?new Date(b.session.expires_at*1e3).toISOString():""),localStorage.setItem("authToken",b.session.access_token),localStorage.setItem("sessionExpiry",b.session.expires_at?new Date(b.session.expires_at*1e3).toISOString():""),localStorage.setItem("currentUser",JSON.stringify(b.session.user)),(a=b.session)!=null&&a.user)try{const P=((i=b.session.user.app_metadata)==null?void 0:i.provider)||"unknown";console.log("OAuth provider detected:",P);const{data:$,error:D}=yield K.from("users").select("*").eq("id",b.session.user.id).single();if(D&&D.code!=="PGRST116"&&console.warn("Error checking user profile:",D),$){const T=(((m=b.session.user.user_metadata)==null?void 0:m.full_name)||((p=b.session.user.user_metadata)==null?void 0:p.name)||((f=b.session.user.user_metadata)==null?void 0:f.display_name)||`${$.first_name||""} ${$.last_name||""}`.trim()).trim().split(" "),k=T[0]||"",S=T.slice(1).join(" ")||"",I={email:b.session.user.email,first_name:k,last_name:S,avatar_url:((g=b.session.user.user_metadata)==null?void 0:g.avatar_url)||((v=b.session.user.user_metadata)==null?void 0:v.picture)||$.avatar_url,provider:P,updated_at:new Date().toISOString()},{error:E}=yield K.from("users").update(I).eq("id",b.session.user.id);E?console.warn("Failed to update user profile:",E):console.log("Updated existing user profile:",I)}else{const T=(((c=b.session.user.user_metadata)==null?void 0:c.full_name)||((o=b.session.user.user_metadata)==null?void 0:o.name)||((l=b.session.user.user_metadata)==null?void 0:l.display_name)||"").trim().split(" "),k=T[0]||"",S=T.slice(1).join(" ")||"",I={id:b.session.user.id,email:b.session.user.email,first_name:k,last_name:S,role:"user",facility_id:si.getDefaultFacilityId(),avatar_url:((d=b.session.user.user_metadata)==null?void 0:d.avatar_url)||((x=b.session.user.user_metadata)==null?void 0:x.picture)||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:E}=yield K.from("users").insert(I);E?console.warn("Failed to create user profile:",E):console.log("Created new user profile for OAuth user:",I)}}catch(P){console.warn("Error handling user profile:",P)}sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),console.log("OAuth user session established, redirecting to home"),r("/home")}else console.log("No session found, redirecting to login"),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),r("/login")}catch(j){console.error("Unexpected error in auth callback:",j),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),r("/login?error=unexpected")}})},[r,t,s]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-teal-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Completing authentication..."})]})})},sj=Object.freeze(Object.defineProperty({__proto__:null,default:Wb},Symbol.toStringTag,{value:"Module"})),Gb=r=>{switch(r){case"bi-test":return Ee;case"bi-failure":return ce;case"cycle-complete":case"cycle-completed":return Se;case"cycle-started":return Ns;case"tool-quarantine":return mi;case"regulatory-notification":return Xr;case"tool-200-scans":return fc;case"bath-1-change":case"bath-2-change":return gc;case"autoclave-cycle-started":return Ns;case"tool-problem-flagged":return xt;case"batch-id-created":return Rs;case"incident-resolution":return Se;default:return Xr}},Kb=({activities:r})=>{const t=r.length>10,s=t?"400px":"auto";return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center justify-between",children:[e.jsx("span",{children:"Recent Activity"}),t&&e.jsxs("span",{className:"text-xs text-gray-500 font-normal",children:[r.length," activities"]})]}),e.jsx("div",{className:"space-y-3 overflow-y-auto pr-2",style:{maxHeight:s,scrollbarWidth:"thin",scrollbarColor:"#cbd5e0 #f7fafc"},children:r.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 ${n.color} rounded-lg flex items-center justify-center`,children:e.jsx(C,{path:Gb(n.type),size:.8,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:n.title}),e.jsx("p",{className:"text-xs text-gray-500",children:n.time})]})]}),n.toolCount&&e.jsxs("span",{className:"text-xs text-gray-500",children:[n.toolCount," tools"]})]},a))})]})},Qb=Object.freeze(Object.defineProperty({__proto__:null,RecentActivity:Kb},Symbol.toStringTag,{value:"Module"})),Yb=({recentTests:r,nextTestDue:t,refreshBIResults:s})=>{const n=i=>{switch(i){case"pass":return"text-green-600";case"fail":return"text-red-600";case"skip":return"text-gray-600";case"in-progress":return"text-yellow-600";default:return"text-gray-600"}},a=i=>{switch(i){case"pass":return Se;case"fail":return ce;case"skip":return Ee;case"in-progress":return Ee;default:return Ee}};return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:Ee,size:1,className:"text-orange-600"}),"BI Test Results"]}),s&&e.jsxs("button",{onClick:s,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",title:"Refresh BI Results",children:[e.jsx(C,{path:ns,size:.7}),"Refresh"]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:ze,size:.8,className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Next Test Due"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t?Qc(t):"Not scheduled"}),t&&e.jsx("p",{className:"text-xs text-gray-500",children:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Recent Results"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.length," tests"]})]}),r.length>0?r.map((i,c)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:a(i.status),size:.8,className:n(i.status)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:i.status.toUpperCase()}),e.jsx("p",{className:"text-xs text-gray-500",children:i.date.toLocaleDateString()})]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Tool ",i.toolId]})]},c)):e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(C,{path:Ee,size:1.5,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No recent BI tests"}),e.jsx("p",{className:"text-xs mt-1",children:"Try refreshing if you just completed a test"})]})]})]})},Jb=Object.freeze(Object.defineProperty({__proto__:null,BITestResults:Yb},Symbol.toStringTag,{value:"Module"})),Xb=({totalTools:r,activeTools:t,completedToday:s})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Tool Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{path:Me,size:1,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Total Tools"}),e.jsx("p",{className:"text-xs text-gray-500",children:"In system"})]})]}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:r})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{path:Ns,size:1,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"In Cycle"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Currently processing"})]})]}),e.jsx("span",{className:"text-lg font-semibold text-blue-600",children:t})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{path:Se,size:1,className:"text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Completed Today"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sterilized tools"})]})]}),e.jsx("span",{className:"text-lg font-semibold text-green-600",children:s})]})]})]}),Zb=Object.freeze(Object.defineProperty({__proto__:null,ToolStatus:Xb},Symbol.toStringTag,{value:"Module"}));var ey=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const ty=({show:r,onClose:t})=>{const[s,n]=u.useState(null),[a,i]=u.useState(!1),[c,o]=u.useState(null),[l,d]=u.useState(!1),[x,m]=u.useState(null),[p,f]=u.useState(0),{activeTab:g}=We(),v=()=>{const _=`${(()=>{const w="barcode,name,category,location,quantity,status,purchaseDate,vendor,cost,notes";switch(g){case"tools":return`${w},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,assignedTo`;case"supplies":return`${w},expirationDate,reorderPoint,minimumStock`;case"equipment":return`${w},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,serialNumber`;case"officeHardware":return`${w},warranty,serialNumber,assignedTo`;default:return w}})()}
123456789,${g.slice(0,-1)} Name,${g},Location,1,Available,2024-01-01,Vendor Name,100.00,Notes`,P=new Blob([_],{type:"text/csv"}),$=window.URL.createObjectURL(P),D=document.createElement("a");D.href=$,D.download=`${g}_template.csv`,document.body.appendChild(D),D.click(),document.body.removeChild(D),window.URL.revokeObjectURL($)},j=b=>{var _;const P=(_=b.target.files)==null?void 0:_[0];P&&P.type==="text/csv"&&(n(P),o(null),d(!1))},h=(b,_)=>{var P;const $=[];return(!((P=b.data)!=null&&P.barcode)||String(b.data.barcode).trim()==="")&&$.push(`Row ${_}: Barcode is required`),(!b.name||String(b.name).trim()==="")&&$.push(`Row ${_}: Name is required`),b.quantity&&(isNaN(Number(b.quantity))||Number(b.quantity)<0)&&$.push(`Row ${_}: Quantity must be a positive number`),b.unit_cost&&(isNaN(parseFloat(String(b.unit_cost)))||parseFloat(String(b.unit_cost))<0)&&$.push(`Row ${_}: Cost must be a positive number`),$},y=()=>ey(null,null,function*(){if(s){i(!0),o(null),d(!1),m(null),f(0);try{const _=(yield s.text()).split(`
`),P=_[0].split(",").map(U=>U.trim()),$=P.findIndex(U=>U.toLowerCase().includes("barcode")),D=P.findIndex(U=>U.toLowerCase().includes("name")),w=P.findIndex(U=>U.toLowerCase().includes("category")),T=P.findIndex(U=>U.toLowerCase().includes("location")),k=P.findIndex(U=>U.toLowerCase().includes("quantity")),S=P.findIndex(U=>U.toLowerCase().includes("status")),I=P.findIndex(U=>U.toLowerCase().includes("purchasedate")),E=P.findIndex(U=>U.toLowerCase().includes("vendor")),O=P.findIndex(U=>U.toLowerCase().includes("cost")),A=P.findIndex(U=>U.toLowerCase().includes("warranty")),B=P.findIndex(U=>U.toLowerCase().includes("maintenanceschedule")),R=P.findIndex(U=>U.toLowerCase().includes("lastserviced")),Q=P.findIndex(U=>U.toLowerCase().includes("nextdue")),q=P.findIndex(U=>U.toLowerCase().includes("serviceprovider")),M=P.findIndex(U=>U.toLowerCase().includes("assignedto")),H=P.findIndex(U=>U.toLowerCase().includes("notes"));if($===-1||D===-1)throw new Error("CSV must contain barcode and name columns");const V=[],X=[];for(let U=1;U<_.length;U++){const de=_[U].trim();if(!de)continue;const se=de.split(",").map(tt=>tt.trim());if(se.length<P.length)continue;const et={id:`csv-${Date.now()}-${U}`,name:se[D],category:w!==-1?se[w]:g,location:T!==-1?se[T]:"Unknown",quantity:k!==-1&&parseInt(se[k])||1,status:S!==-1?se[S]:"Available",unit_cost:O!==-1&&parseFloat(se[O])||0,updated_at:new Date().toISOString(),data:{barcode:se[$],purchaseDate:I!==-1?se[I]:new Date().toISOString().split("T")[0],vendor:E!==-1?se[E]:"",warranty:A!==-1?se[A]:"",maintenanceSchedule:B!==-1?se[B]:"",lastServiced:R!==-1?se[R]:"",nextDue:Q!==-1?se[Q]:"",serviceProvider:q!==-1?se[q]:"",assignedTo:M!==-1?se[M]:"",notes:H!==-1?se[H]:"Imported via CSV upload"}},Ke=h(et,U+1);X.push(...Ke),Ke.length===0&&V.push(et)}if(X.length>0){m({success:!1,message:`Validation failed for ${X.length} items`,importedCount:0,failedCount:X.length,errors:X});return}let ie=0,te=0;const Ge=[];for(let U=0;U<V.length;U++){try{const de=V[U];if(de&&de.id&&de.name)yield bs.addInventoryItem(de),ie++;else throw new Error("Invalid item data")}catch(de){te++,Ge.push(`Row ${U+2}: ${de instanceof Error?de.message:"Import failed"}`)}f((U+1)/V.length*100)}const Ze={success:te===0,message:te===0?`Successfully imported ${ie} items`:`Imported ${ie} items, ${te} failed`,importedCount:ie,failedCount:te,errors:Ge};m(Ze),d(te===0),te===0&&setTimeout(()=>{n(null),d(!1),m(null),f(0),t()},3e3)}catch(b){o(b instanceof Error?b.message:"Failed to upload CSV")}finally{i(!1)}}});return e.jsxs(je,{show:r,onHide:t,centered:!0,backdrop:"static",size:"lg",children:[e.jsx(je.Header,{closeButton:!0,className:"pb-2",children:e.jsxs(je.Title,{className:"text-lg",children:["Import ",g.charAt(0).toUpperCase()+g.slice(1)," CSV"]})}),e.jsxs(je.Body,{className:"py-3 pb-6",children:[e.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[e.jsx(C,{path:As,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 1: Download Template"]})}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Get the CSV template with all required columns for ",g," ","data."]}),e.jsxs("button",{onClick:v,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center",children:[e.jsx(C,{path:Ne,size:.8,className:"mr-2"}),"Download Template"]})]})]}),e.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[e.jsx(C,{path:Cs,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 2: Upload CSV"]})}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Upload your filled CSV file to import ",g," into the database."]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"csv-file-input",className:"block text-xs font-medium text-gray-700 mb-1",children:"Select CSV File"}),e.jsx("input",{id:"csv-file-input",type:"file",accept:".csv",onChange:j,className:"form-control py-1 px-2 text-sm"})]}),s&&e.jsxs("p",{className:"text-sm text-green-600 mb-2",children:["✓ Selected: ",s.name]}),c&&e.jsxs("p",{className:"text-sm text-red-600 mb-2",children:["✗ ",c]}),l&&e.jsx("p",{className:"text-sm text-green-600 mb-2",children:"✓ Items uploaded successfully!"}),a&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[Math.round(p),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-[#4ECDC4] h-2 rounded-full transition-all duration-300",style:{width:`${p}%`}})})]}),x&&e.jsxs("div",{className:`p-3 rounded-lg border ${x.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(C,{path:x.success?Se:ce,size:1,className:`mr-2 ${x.success?"text-green-600":"text-red-600"}`}),e.jsx("span",{className:`font-medium ${x.success?"text-green-800":"text-red-800"}`,children:x.message})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Imported: ",x.importedCount," items"]}),e.jsxs("p",{children:["Failed: ",x.failedCount," items"]})]}),x.errors.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Errors:"}),e.jsxs("div",{className:"max-h-20 overflow-y-auto text-xs text-red-600",children:[x.errors.slice(0,5).map((b,_)=>e.jsxs("div",{children:["• ",b]},_)),x.errors.length>5&&e.jsxs("div",{children:["... and ",x.errors.length-5," more errors"]})]})]})]})]})]})]}),e.jsxs(je.Footer,{className:"pt-2",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors duration-200",children:"Cancel"}),e.jsxs("button",{onClick:y,disabled:!s||a,className:"px-4 py-2 bg-[#4ECDC4] hover:bg-[#3db8b0] text-white rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[e.jsx(C,{path:Cs,size:.8,className:"mr-2"}),a?"Importing...":`Import ${g.charAt(0).toUpperCase()+g.slice(1)}`]})]})]})},sy=Object.freeze(Object.defineProperty({__proto__:null,default:ty},Symbol.toStringTag,{value:"Module"})),Lr=()=>{const{currentUser:r,getUserDisplayName:t}=$e(),{trackedItems:s,trackingData:n,toggleTrackedItem:a}=We(),{availableTools:i}=W(),[c,o]=u.useState([]),[l,d]=u.useState([]),[x,m]=u.useState([]),[p,f]=u.useState({totalTracked:0,highPriority:0,mediumPriority:0,lowPriority:0,pendingNotifications:0}),g=u.useCallback(()=>t()||(r==null?void 0:r.email)||"Unknown Doctor",[t,r]),v=u.useCallback(()=>{const k=g(),S=ue.getTrackedToolsForDoctor(k);o(S)},[g]),j=u.useCallback(()=>{const k=g(),S=ue.getPendingNotifications(k),I=ue.getAllNotifications(k);d(S),m(I)},[g]),h=u.useCallback(()=>{const k=ue.getTrackingStats();f(k)},[]),y=u.useCallback((k,S="medium",I)=>{const E=r?g():"Test Doctor";ue.trackTool(k,E,S,I),a(k,E),v(),h()},[r,g,a,v,h]),b=u.useCallback(k=>{const S=r?g():"Test Doctor";ue.untrackTool(k,S),a(k,S),v(),h()},[r,g,a,v,h]),_=u.useCallback(k=>{ue.acknowledgeNotification(k),j(),h()},[j,h]),P=u.useCallback(()=>{ue.clearExpiredNotifications(),j(),h()},[j,h]),$=u.useCallback(k=>ue.getPriorityQueue(k),[]),D=u.useCallback(k=>ue.isToolTracked(k),[]),w=u.useCallback(k=>ue.getToolTrackers(k),[]),T=u.useCallback(k=>ue.subscribeToStatusChanges(k),[]);return u.useEffect(()=>ue.subscribeToStatusChanges((S,I,E)=>{if(E==="available"||E==="complete"){const O=g();ue.getToolTrackers(S).find(R=>R.doctorName===O)&&b(S)}j(),h()}),[j,h,g,b]),u.useEffect(()=>{const S=setInterval(()=>{i.forEach(I=>{const E=I.currentPhase||I.status||"";ue.isToolTracked(I.id)&&ue.monitorToolStatusChange(I.id,"",E)})},5e3);return()=>clearInterval(S)},[i]),u.useEffect(()=>{(()=>{const S=g();ue.getPendingNotifications(S).forEach(E=>{const O=i.find(A=>A.id===E.toolId);O&&E.toolName!==O.name&&(E.toolName=O.name,E.message=`Your tracked tool "${O.name}" is now available! You have first priority to claim it.`)})})()},[i,g]),!s||!n||!i?(console.warn("useTrackedTools: Missing required store data"),{trackedTools:c,pendingNotifications:l,allNotifications:x,trackingStats:p,trackTool:y,untrackTool:b,acknowledgeNotification:_,clearExpiredNotifications:P,getPriorityQueue:$,isToolTracked:D,getToolTrackers:w,subscribeToStatusChanges:T}):{trackedTools:c,pendingNotifications:l,allNotifications:x,trackingStats:p,trackTool:y,untrackTool:b,acknowledgeNotification:_,clearExpiredNotifications:P,getPriorityQueue:$,isToolTracked:D,getToolTrackers:w,subscribeToStatusChanges:T}},Ul=r=>{switch(r){case"high":return xt;case"medium":return qe;case"low":return mt;default:return qe}},xr=r=>{switch(r){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},ql=({isOpen:r,onClose:t,className:s=""})=>{const{getAllItems:n}=Ri(),{trackedTools:a,trackTool:i,untrackTool:c,getPriorityQueue:o}=Lr(),[l,d]=u.useState(""),[x,m]=u.useState("all"),[p,f]=u.useState("medium"),[g,v]=u.useState(null),h=n().filter(D=>{var w,T;return((w=D.data)==null?void 0:w.toolId)||((T=D.data)==null?void 0:T.supplyId)}).filter(D=>{const w=(D.name||"").toLowerCase().includes(l.toLowerCase())||(D.category||"").toLowerCase().includes(l.toLowerCase())||D.data&&typeof D.data=="object"&&"barcode"in D.data&&typeof D.data.barcode=="string"&&D.data.barcode||"".toLowerCase().includes(l.toLowerCase()),T=a.some(S=>S.toolId===D.id),k=D.status==="available"||D.status==="complete"||D.status==="clean";switch(x){case"tracked":return w&&T;case"available":return w&&k;case"unavailable":return w&&!k;default:return w}}),y=D=>a.some(w=>w.toolId===D),b=D=>a.find(w=>w.toolId===D),_=D=>{y(D)?c(D):i(D,p)},P=(D,w)=>{y(D)&&(c(D),i(D,w))},$=D=>{const w=D.toLowerCase();return["available","complete","clean"].includes(w)?"bg-green-100 text-green-800":["dirty","in_cycle","bath1","bath2","airDry","autoclave"].includes(w)?"bg-yellow-100 text-yellow-800":["failed","problem","maintenance"].includes(w)?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`bg-white rounded-xl shadow-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-hidden ${s}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Track Tools & Supplies"}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors","aria-label":"Close modal",children:e.jsx(le,{path:ae,size:1.5})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-3",children:"Select Priority Level"}),e.jsx("div",{className:"flex gap-3",children:["high","medium","low"].map(D=>e.jsxs("button",{onClick:()=>f(D),className:`flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-colors ${p===D?`${xr(D)} border-current`:"border-gray-300 text-gray-600 hover:border-gray-400"}`,children:[e.jsx(le,{path:Ul(D),size:1}),e.jsx("span",{className:"capitalize font-medium",children:D})]},D))}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[p==="high"&&"High priority: You will be notified immediately when the tool becomes available.",p==="medium"&&"Medium priority: You will be notified when the tool becomes available (default).",p==="low"&&"Low priority: You will be notified when the tool becomes available, but others may have higher priority."]})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search tools and supplies...",value:l,onChange:D=>d(D.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none"})}),e.jsx("div",{className:"flex gap-2",children:["all","tracked","available","unavailable"].map(D=>e.jsx("button",{onClick:()=>m(D),className:`px-4 py-2 rounded-lg border transition-colors capitalize ${x===D?"bg-blue-500 text-white border-blue-500":"border-gray-300 text-gray-600 hover:border-gray-400"}`,children:D},D))})]}),e.jsx("div",{className:"overflow-y-auto max-h-96",children:e.jsx("div",{className:"grid gap-4",children:h.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{path:Pt,size:3,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No items found matching your criteria"})]}):h.map(D=>{const w=y(D.id),T=b(D.id),k=o(D.id);return e.jsx("div",{className:`p-4 border rounded-lg transition-colors ${w?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:D.name||""}),e.jsx("span",{className:"text-sm text-gray-500",children:D.category||""}),D.data&&typeof D.data=="object"&&"barcode"in D.data&&typeof D.data.barcode=="string"&&e.jsx("span",{className:"text-xs text-gray-400 font-mono",children:D.data.barcode})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${$(D.status||"")}`,children:D.status||""}),w&&T&&e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full flex items-center gap-1 ${xr(T.priority)}`,children:[e.jsx(le,{path:Ul(T.priority),size:.8}),T.priority]})]}),w&&k.length>1&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{onClick:()=>v(g===D.id?null:D.id),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(le,{path:g===D.id?pi:Pt,size:.8}),"Show priority queue (",k.length," ","waiting)"]}),g===D.id&&e.jsxs("div",{className:"mt-2 p-2 bg-white rounded border text-xs",children:[e.jsx("div",{className:"font-medium mb-1",children:"Priority Queue:"}),k.map((S,I)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:I===0?"font-medium text-green-600":"text-gray-600",children:[I+1,". ",S.doctorName]}),e.jsx("span",{className:`px-1 py-0.5 rounded text-xs ${xr(S.priority)}`,children:S.priority})]},`${S.doctorName}-${S.timestamp}`))]})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:w?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>_(D.id),className:"px-3 py-1 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded transition-colors",children:"Untrack"}),T&&e.jsxs("select",{value:T.priority,onChange:S=>P(D.id,S.target.value),className:"px-2 py-1 text-xs border rounded focus:outline-none",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}):e.jsxs("button",{onClick:()=>_(D.id),className:"px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(le,{path:Ue,size:1}),"Track"]})})]})},D.id)})})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[a.length," item",a.length!==1?"s":""," ","currently tracked"]}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded-lg transition-colors",children:"Close"})]})]})}):null},ry=Object.freeze(Object.defineProperty({__proto__:null,EnhancedTrackModal:ql,default:ql},Symbol.toStringTag,{value:"Module"})),Qi=Z.memo(({className:r=""})=>{const[t,s]=u.useState([]),[n,a]=u.useState([]),[i,c]=u.useState("all"),[o,l]=u.useState(!1);u.useEffect(()=>{const f=()=>{const v=ts.getNotificationHistory();s(v),a(v)};f();const g=setInterval(f,5e3);return()=>clearInterval(g)},[]),u.useEffect(()=>{setTimeout(()=>{a(i==="all"?t:t.filter(f=>f.type===i))},0)},[t,i]);const d=f=>{switch(f){case"tool_available":return Se;case"position_changed":case"queue_update":return qe;case"tool_unavailable":return ce;default:return qe}},x=f=>{switch(f){case"tool_available":return"text-green-500";case"position_changed":case"queue_update":return"text-blue-500";case"tool_unavailable":return"text-orange-500";default:return"text-gray-500"}},m=f=>{if(f.title.includes("🔥"))return"bg-red-50 border-red-200";if(f.title.includes("⚡"))return"bg-yellow-50 border-yellow-200";if(f.title.includes("📋"))return"bg-gray-50 border-gray-200";switch(f.type){case"tool_available":return"bg-green-50 border-green-200";case"position_changed":case"queue_update":return"bg-blue-50 border-blue-200";case"tool_unavailable":return"bg-orange-50 border-orange-200";default:return"bg-gray-50 border-gray-200"}},p=()=>{ts.clearNotificationHistory(),s([]),a([])};return o?e.jsxs("div",{className:`fixed bottom-4 right-4 w-96 max-h-96 bg-white rounded-lg shadow-xl border ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(C,{path:Zr,size:1.2,className:"mr-2 text-blue-500"}),"Notification History"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:p,className:"text-sm text-gray-500 hover:text-gray-700",title:"Clear history",children:"Clear"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:bc,size:1,className:"text-gray-500"}),e.jsxs("select",{value:i,onChange:f=>c(f.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"tool_available",children:"Tool Available"}),e.jsx("option",{value:"position_changed",children:"Position Changed"}),e.jsx("option",{value:"queue_update",children:"Queue Update"}),e.jsx("option",{value:"tool_unavailable",children:"Tool Unavailable"})]})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:n.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(C,{path:mt,size:2,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No notifications in history"})]}):e.jsx("div",{className:"p-2 space-y-2",children:n.map(f=>e.jsx("div",{className:`${m(f)} border rounded-lg p-3 text-sm`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(C,{path:d(f.type),size:1,className:`${x(f.type)} mr-2 mt-0.5`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:f.title}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:f.message}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:new Date(f.timestamp).toLocaleString()}),e.jsx("span",{className:"text-xs text-gray-500",children:f.toolName})]})]})]})},f.id))})})]}):e.jsxs("button",{onClick:()=>l(!0),className:`font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1 min-w-fit whitespace-nowrap bg-white hover:bg-gray-50 text-gray-700 ${r}`,title:"View notification history",children:[e.jsx(C,{path:Zr,size:1,className:"mr-2","aria-hidden":"true"}),"History",t.length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:t.length})]})});Qi.displayName="NotificationHistory";const Yi=Z.memo(({filters:r,showFilters:t,setShowFilters:s,onToggleTrackedFilter:n})=>{const a=u.useRef(null),i=u.useRef(null),c=(o,l)=>{var d,x;switch(o.key){case"ArrowRight":o.preventDefault(),l==="filter"&&n&&((d=i.current)==null||d.focus());break;case"ArrowLeft":o.preventDefault(),l==="tracked"&&n&&((x=a.current)==null||x.focus());break;case"Enter":case" ":{o.preventDefault(),l==="filter"?s(!t):l==="tracked"&&n&&n();break}case"Escape":{o.preventDefault(),t&&s(!1);const m=o.currentTarget.closest('[role="toolbar"]');m&&m.focus();break}}};return u.useEffect(()=>{if(t){const o=document.querySelector("#expanded-filters-panel input");o&&o.focus()}},[t]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2 overflow-x-hidden",role:"toolbar","aria-label":"Inventory filtering controls",tabIndex:-1,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(gr,{ref:a,variant:"outline-secondary",className:"font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",onClick:()=>s(!t),onKeyDown:o=>c(o,"filter"),"aria-expanded":t,"aria-controls":"expanded-filters-panel","aria-label":`${t?"Hide":"Show"} advanced filters`,tabIndex:0,children:[e.jsx(C,{path:$r,size:1,className:"mr-2","aria-hidden":"true"}),"Filters"]}),n&&e.jsxs(gr,{ref:i,variant:"outline-secondary",className:`font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1 min-w-fit whitespace-nowrap ${r.showTrackedOnly?"bg-[#4ECDC4] text-white border-[#4ECDC4]":""}`,onClick:n,onKeyDown:o=>c(o,"tracked"),"aria-pressed":r.showTrackedOnly,"aria-label":`${r.showTrackedOnly?"Hide":"Show"} tracked items only`,tabIndex:0,children:[e.jsx(C,{path:Pt,size:1,className:"mr-2","aria-hidden":"true"}),"Tracked Only"]}),e.jsx(Qi,{})]})})})});Yi.displayName="InventoryFilters";const ay=({activeTab:r,filters:t,setCategoryFilter:s,setLocationFilter:n,setSearchQuery:a,onToggleFavoritesFilter:i})=>{const{mergeMode:c,setMergeMode:o,selectedItems:l,clearSelectedItems:d}=We(),{getActiveRooms:x}=Ms(),m=x(),p=()=>{c?(d(),o(!1)):o(!0)},f=()=>{if(l.length<2){alert("Please select at least 2 items to merge");return}console.log("Merging items:",Array.from(l))};return e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"search-input",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Search"}),e.jsx("input",{id:"search-input",type:"text",placeholder:"Search inventory...",className:"form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.searchQuery||"",onChange:g=>a(g.target.value)})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"location-search-input",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Filter by Location"}),e.jsx("input",{id:"location-search-input",type:"text",placeholder:"Filter by location...",className:"form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.location||"",onChange:g=>n(g.target.value)})]}),r==="tools"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Tools",children:"Tools"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tools-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"tools-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:es,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tools-merge-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Actions"}),c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[l.length," selected"]}),e.jsx("button",{onClick:f,disabled:l.length<2,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm disabled:bg-gray-300",children:"Merge Selected"}),e.jsx("button",{onClick:p,className:"px-3 py-1 bg-gray-500 text-white rounded text-sm",children:"Cancel"})]}):e.jsxs("button",{id:"tools-merge-filter-btn",onClick:p,className:"flex items-center gap-2 px-3 py-2 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors",children:[e.jsx(C,{path:yc,size:.8}),e.jsx("span",{className:"text-sm",children:"Merge Duplicates"})]})]})]}),r==="supplies"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supply-category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"supply-category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Supplies",children:"Supplies"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supply-location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"supply-location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supplies-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"supplies-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:es,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]})]}),r==="equipment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"equipment-category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"equipment-category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Equipment",children:"Equipment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"equipment-location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"equipment-location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"equipment-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"equipment-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:es,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]})]}),r==="officeHardware"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hardware-category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"hardware-category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Office Hardware",children:"Office Hardware"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hardware-location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"hardware-location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hardware-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"hardware-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:es,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]})]})]})},ny="_tableContainer_18z7q_2",ly="_table_18z7q_2",iy="_tableHeader_18z7q_26",oy="_tableHeaderCell_18z7q_34",cy="_tableCell_18z7q_45",dy="_tableRow_18z7q_90",uy="_selectedRow_18z7q_104",my="_actionGroup_18z7q_124",xy="_actionButton_18z7q_133",py="_editButton_18z7q_166",hy="_deleteButton_18z7q_177",gy="_trackButton_18z7q_188",fy="_tracked_18z7q_203",by="_virtualizedList_18z7q_240",yy="_virtualizedOverlay_18z7q_249",vy="_virtualizedBody_18z7q_262",jy="_virtualizedRow_18z7q_268",G={tableContainer:ny,table:ly,tableHeader:iy,tableHeaderCell:oy,tableCell:cy,tableRow:dy,selectedRow:uy,actionGroup:my,actionButton:xy,editButton:py,deleteButton:hy,trackButton:gy,tracked:fy,virtualizedList:by,virtualizedOverlay:yy,virtualizedBody:vy,virtualizedRow:jy},wy="_tooltipContainer_7fsb9_2",Ny="_tooltipContent_7fsb9_7",Cy="_tooltipArrow_7fsb9_35",pr={tooltipContainer:wy,tooltipContent:Ny,tooltipArrow:Cy},zr=Z.memo(u.forwardRef(({item:r,activeTab:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,isTracked:c=!1},o)=>{const{favorites:l,toggleFavorite:d,openDeleteModal:x}=We(),{getToolTrackers:m}=Lr(),p=l.includes(r.id),f=m(r.id),g=f.length,j=f.some(S=>S.doctorName==="Current Doctor")?f.findIndex(S=>S.doctorName==="Current Doctor")+1:0,h=S=>{s(S)},y=u.useRef(null),b=u.useRef(null),_=u.useRef(null),P=u.useRef(null);u.useImperativeHandle(o,()=>({focusEdit:()=>{var S;return(S=y.current)==null?void 0:S.focus()},focusFavorite:()=>{var S;return(S=b.current)==null?void 0:S.focus()},focusTrack:()=>{var S;return(S=_.current)==null?void 0:S.focus()},focusDelete:()=>{var S;return(S=P.current)==null?void 0:S.focus()}}));const $=(S,I)=>{if(S.key==="Enter"||S.key===" ")switch(S.preventDefault(),I){case"edit":s(r);break;case"favorite":d(r.id);break;case"track":i==null||i(r);break;case"delete":T();break}},D=()=>{i==null||i(r)},w=()=>{a?a(r.id):d(r.id)},T=()=>{x(r)},k=c?`Stop tracking (You are ${j}/${g} in queue)`:`Start tracking (${g} in queue)`;return e.jsx("td",{className:G.tableCell,children:e.jsxs("div",{className:G.actionGroup,children:[e.jsxs("button",{ref:y,onClick:()=>h(r),onKeyDown:S=>$(S,"edit"),className:`${G.actionButton} ${G.editButton} text-xs px-2 py-0.5 flex items-center`,"aria-label":`Edit ${r.name||"item"}`,tabIndex:0,children:[e.jsx("svg",{className:"inline-block mr-1",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16","aria-hidden":"true",children:e.jsx("path",{d:"M15.502 1.94a1.5 1.5 0 0 1 0 2.12l-1.439 1.439-2.12-2.12 1.439-1.439a1.5 1.5 0 0 1 2.12 0zm-2.561 2.561-9.193 9.193a.5.5 0 0 0-.121.196l-1 3a.5.5 0 0 0 .633.633l3-1a.5.5 0 0 0 .196-.12l9.193-9.194-2.12-2.12z"})}),"Edit"]}),t==="tools"&&e.jsx("button",{ref:b,onClick:w,onKeyDown:S=>$(S,"favorite"),className:`${G.actionButton} ${p?"!text-yellow-500 !bg-yellow-50 !border-yellow-200 hover:!text-yellow-600":"text-gray-400 hover:text-yellow-500 hover:bg-yellow-50"} transition-colors duration-200`,"aria-label":`${p?"Remove from":"Add to"} favorites`,"aria-pressed":p,tabIndex:0,children:e.jsx(C,{path:es,size:.8,className:p?"fill-current":"","aria-hidden":"true"})}),(t==="tools"||t==="supplies")&&e.jsxs("div",{className:pr.tooltipContainer,children:[e.jsxs("button",{ref:_,onClick:D,onKeyDown:S=>$(S,"track"),className:`${G.actionButton} ${G.trackButton} ${c?G.tracked:""} relative`,"aria-label":k,"aria-pressed":c,tabIndex:0,children:[e.jsx(C,{path:Pt,size:1.2,"aria-hidden":"true"}),g>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:g})]}),e.jsxs("div",{className:pr.tooltipContent,children:[k,e.jsx("div",{className:pr.tooltipArrow})]})]}),e.jsxs("button",{ref:P,onClick:T,onKeyDown:S=>$(S,"delete"),className:`${G.actionButton} ${G.deleteButton} text-xs px-2 py-0.5 flex items-center`,"aria-label":`Delete ${r.name||"item"}`,tabIndex:0,children:[e.jsxs("svg",{className:"inline-block mr-1",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16","aria-hidden":"true",children:[e.jsx("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"}),e.jsx("path",{fillRule:"evenodd",d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"})]}),"Delete"]})]})})}));zr.displayName="TableActions";const Ji=Z.memo(({item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})=>{const{mergeMode:o,selectedItems:l,toggleItemSelection:d}=We(),x=()=>{o&&d(r.id)},m=l.includes(r.id),p=u.useMemo(()=>{var f;const g=e.jsxs("td",{className:G.tableCell,children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),r.data&&typeof r.data=="object"&&"description"in r.data&&typeof r.data.description=="string"&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:r.data.description})]},"name"),v=e.jsx("td",{className:G.tableCell,children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:r.category})},"category"),j=e.jsx("td",{className:G.tableCell,children:e.jsx("span",{className:`font-medium ${(r.quantity||0)<10?"text-red-600":"text-gray-900"}`,children:r.quantity||0})},"quantity"),h=e.jsxs("td",{className:G.tableCell,children:["$",(r.unit_cost||0).toFixed(2)]},"price"),y=[g];if(c!=="tools"&&y.push(v),c==="supplies")y.push(e.jsx("td",{className:G.tableCell,children:r.location||"N/A"},"location"));else if(c==="tools"){const _=r.status||"N/A",P=r.data&&typeof r.data=="object"&&"p2Status"in r.data&&typeof r.data.p2Status=="string"?r.data.p2Status==="P2":r.p2_status==="P2"||!1;y.push(e.jsx("td",{className:G.tableCell,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_==="active"?"bg-green-100 text-green-800":_==="inactive"?"bg-red-100 text-red-800":_==="p2"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:_.toUpperCase()}),P&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"P2"})]})},"status"))}c!=="tools"&&y.push(j),y.push(h);const b=e.jsx("td",{className:G.tableCell,children:(f=r.scanned_location)!=null?f:e.jsx("span",{className:"text-gray-400",children:"Unassigned"})},"location");return y.push(b),y},[r,c]);return e.jsxs("tr",{className:`${G.tableRow} ${m?G.selectedRow:""}`,tabIndex:0,onClick:x,style:{cursor:o?"pointer":"default"},children:[p,e.jsx(zr,{item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})]})});Ji.displayName="TableRow";const Ur=Z.memo(({columns:r,activeTab:t})=>e.jsx("thead",{className:G.tableHeader,children:e.jsxs("tr",{children:[r.map(s=>t==="tools"&&(s==="category"||s==="quantity")?null:e.jsx("th",{className:`${G.tableHeaderCell} text-gray-500 inventory-table-header`,scope:"col","aria-label":s.toLowerCase(),style:{color:"#6b7280"},children:s},s)),e.jsx("th",{className:`${G.tableHeaderCell} text-gray-500 inventory-table-header`,scope:"col","aria-label":"Item actions",style:{color:"#6b7280"},children:"Actions"})]})}));Ur.displayName="TableHeader";const Dr=Z.memo(({currentPage:r,totalPages:t,onPageChange:s})=>e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-4",role:"navigation","aria-label":"Table pagination",children:[e.jsx("button",{onClick:()=>s(Math.max(1,r-1)),disabled:r===1,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to previous page","aria-disabled":r===1,tabIndex:0,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700","aria-label":`Page ${r} of ${t}`,children:["Page ",r," of ",t]}),e.jsx("button",{onClick:()=>s(Math.min(t,r+1)),disabled:r===t,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to next page","aria-disabled":r===t,tabIndex:0,children:"Next"})]}));Dr.displayName="TablePagination";const Xi=Z.memo(({item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})=>{const o=u.useMemo(()=>{const l=e.jsxs("div",{className:G.tableCell,children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),r.data&&typeof r.data=="object"&&"description"in r.data&&typeof r.data.description=="string"&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:r.data.description})]},"name"),d=e.jsx("div",{className:G.tableCell,children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:r.category})},"category"),x=e.jsx("td",{className:G.tableCell,children:e.jsx("span",{className:`font-medium ${(r.quantity||0)<10?"text-red-600":"text-gray-900"}`,children:r.quantity||0})},"quantity"),m=e.jsxs("td",{className:G.tableCell,children:["$",(r.unit_cost||0).toFixed(2)]},"price"),p=[l];return c!=="tools"&&p.push(d),c==="supplies"?p.push(e.jsx("div",{className:G.tableCell,children:r.location||"N/A"},"location")):c==="tools"&&p.push(e.jsx("div",{className:G.tableCell,children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":r.status==="inactive"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status})},"status")),p.push(x,m),p},[r,c]);return e.jsxs("div",{className:`${G.tableRow} ${G.virtualizedRow}`,children:[o,e.jsx("div",{className:G.tableCell,children:e.jsx(zr,{item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})})]})});Xi.displayName="VirtualizedTableRow";const Zi=Z.memo(({data:r,columns:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,isTracked:c,activeTab:o,itemHeight:l=80,maxHeight:d=600})=>{const x=u.useCallback(({index:p,style:f})=>{const g=r[p];return g?e.jsx("div",{style:f,children:e.jsx(Xi,{item:g,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,isTracked:c?c(g.id):!1,activeTab:o})}):null},[r,s,n,a,i,c,o]),m=u.useMemo(()=>e.jsx(To,{height:Math.min(d,r.length*l),itemCount:r.length,itemSize:l,width:"100%",className:G.virtualizedList,children:x}),[r.length,l,d,x]);return e.jsx("div",{className:G.tableContainer,children:e.jsxs("div",{className:G.tableWrapper,children:[e.jsxs("table",{className:G.table,role:"table","aria-label":"Inventory items table",children:[e.jsx(Ur,{columns:t,activeTab:o}),e.jsx("tbody",{className:G.virtualizedBody})]}),e.jsx("div",{className:G.virtualizedOverlay,children:m})]})})});Zi.displayName="VirtualizedInventoryTable";const eo=Z.memo(({data:r,columns:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,showTrackedOnly:c=!1,showFavoritesOnly:o=!1,itemsPerPage:l=3,currentPage:d=1,onPageChange:x,activeTab:m})=>{const p=r.length>100,{favorites:f}=We(),{trackTool:g,untrackTool:v,isToolTracked:j}=Lr(),{totalPages:h,paginatedData:y}=u.useMemo(()=>{let P=r;c&&(P=P.filter(k=>j(k.id))),o&&(P=P.filter(k=>f.includes(k.id)));const $=Math.max(1,Math.ceil(P.length/l)),D=(d-1)*l,w=D+l,T=P.slice(D,w);return{totalPages:$,paginatedData:T}},[r,c,o,f,j,l,d]),b=u.useCallback(P=>{j(P.id)?v(P.id):g(P.id,"medium",P.name),i&&i(P)},[j,v,g,i]),_=u.useCallback(P=>j(P),[j]);return p?e.jsxs("div",{className:`${G.tableContainer} inventory-table`,children:[e.jsx(Zi,{data:y,columns:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:b,isTracked:_,activeTab:m,itemHeight:80,maxHeight:600}),x&&e.jsx(Dr,{currentPage:d,totalPages:h,onPageChange:x})]}):e.jsxs("div",{className:`${G.tableContainer} inventory-table`,children:[e.jsx("div",{className:G.tableWrapper,children:e.jsxs("table",{className:G.table,role:"table","aria-label":"Inventory items table",children:[e.jsx(Ur,{columns:t,activeTab:m}),e.jsx("tbody",{children:y.map(P=>e.jsx(Ji,{item:P,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:b,isTracked:_(P.id),activeTab:m},P.id))})]})}),x&&e.jsx(Dr,{currentPage:d,totalPages:h,onPageChange:x})]})});eo.displayName="BaseInventoryTable";const Sy=r=>r==="tools"||r==="supplies",_y=r=>Sy(r),Ty=r=>{const t=["Name","Category","Quantity","Price"];switch(r){case"supplies":return["Name","Category","Location","Quantity","Price"];case"tools":return["Name","Status","Price","Location"];case"equipment":case"officeHardware":default:return[...t,"Location"]}},to=Z.memo(({activeTab:r,filteredData:t,filteredSuppliesData:s,filteredEquipmentData:n,filteredOfficeHardwareData:a,handleEditClick:i,handleDeleteItem:c,handleToggleFavorite:o,onTrackToggle:l,showTrackedOnly:d=!1,showFavoritesOnly:x=!1,itemsPerPage:m})=>{const p=u.useMemo(()=>{switch(r){case"tools":return t;case"supplies":return s;case"equipment":return n;case"officeHardware":return a;default:return t}},[r,t,s,n,a]),f=u.useMemo(()=>Ty(r),[r]);return e.jsx("div",{className:"overflow-x-auto",children:e.jsx(eo,{data:p,columns:f,onEdit:i,onDelete:c,onToggleFavorite:o,onTrackToggle:l,showTrackedOnly:d,showFavoritesOnly:x,itemsPerPage:m,currentPage:1,onPageChange:()=>{},activeTab:r})})});to.displayName="InventoryTables";class ky extends Z.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("Table Error Boundary caught an error:",t,s)}render(){if(this.state.hasError){const t=this.props.fallback;return t?e.jsx(t,{error:this.state.error}):e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Table Error"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:"Something went wrong with the table display. Please refresh the page."}),this.state.error&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-red-600 text-sm cursor-pointer",children:"Error Details"}),e.jsx("pre",{className:"text-xs text-red-500 mt-1 overflow-auto",children:this.state.error.message})]})]})}return this.props.children}}var Iy=Object.defineProperty,Hl=Object.getOwnPropertySymbols,Py=Object.prototype.hasOwnProperty,Dy=Object.prototype.propertyIsEnumerable,Vl=(r,t,s)=>t in r?Iy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,hr=(r,t)=>{for(var s in t||(t={}))Py.call(t,s)&&Vl(r,s,t[s]);if(Hl)for(var s of Hl(t))Dy.call(t,s)&&Vl(r,s,t[s]);return r};const so=Z.memo(({onEdit:r,onDelete:t,onClone:s,items:n})=>{const{activeTab:a,showFilters:i,setShowFilters:c,searchQuery:o,setSearchQuery:l,categoryFilter:d,setCategoryFilter:x,locationFilter:m,setLocationFilter:p,showTrackedOnly:f,setShowTrackedOnly:g,showFavoritesOnly:v,setShowFavoritesOnly:j,itemsPerPage:h,favorites:y,toggleFavorite:b,openAddModal:_}=We(),{tools:P,supplies:$,equipment:D,officeHardware:w}=Ri(),T=Z.useMemo(()=>({searchQuery:o,category:d,location:m,showTrackedOnly:f,showFavoritesOnly:v}),[o,d,m,f,v]),k=Z.useMemo(()=>({filters:T,showFilters:i,setShowFilters:c,setSearchQuery:l,onToggleTrackedFilter:()=>{_y(a)&&g(!f)}}),[T,i,c,l,a,f,g]),S=Z.useMemo(()=>({activeTab:a,filters:{searchQuery:o,category:d,location:m,showFavoritesOnly:v},setCategoryFilter:x,setLocationFilter:p,setSearchQuery:l,onToggleFavoritesFilter:()=>{j(!v)}}),[a,o,d,m,v,x,p,l,j]),I=Z.useMemo(()=>{const A={search:o,category:d,location:m},B=os.applyFilters(P,A),R=os.applyFilters($,A),Q=os.applyFilters(D,A),q=os.applyFilters(w,A);return{activeTab:a,filteredData:B,filteredSuppliesData:R,filteredEquipmentData:Q,filteredOfficeHardwareData:q,handleEditClick:r,handleDeleteItem:t,handleCloneItem:s,handleToggleFavorite:b,showTrackedOnly:f,showFavoritesOnly:v,itemsPerPage:h,favorites:y}},[a,P,$,D,w,o,d,m,r,t,s,b,f,v,h,y]),E=()=>{switch(a){case"tools":return"Tools Table";case"supplies":return"Supplies Table";case"equipment":return"Equipment Table";case"officeHardware":return"Office Hardware Table";default:return"Inventory Table"}},O=()=>{switch(a){case"tools":return"Manage your tools inventory items";case"supplies":return"Manage your supplies inventory items";case"equipment":return"Manage your equipment inventory items";case"officeHardware":return"Manage your office hardware inventory items";default:return"Manage your inventory items"}};return e.jsxs("div",{role:"region","aria-label":`${a} inventory table section`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:E()}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:O()})]}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-[#4ECDC4] hover:bg-[#3db8b0] text-white rounded-lg font-medium flex items-center gap-2 transition-colors duration-200 shadow-sm hover:shadow-md","aria-label":"Add new item to inventory",children:[e.jsx(C,{path:He,size:1}),"Add Item"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Yi,hr({},k))}),i&&e.jsx("div",{id:"expanded-filters-panel",children:e.jsx(ay,hr({},S))}),e.jsx(ky,{children:e.jsx(to,hr({},I))})]})});so.displayName="InventoryTableSection";const rj=Object.freeze(Object.defineProperty({__proto__:null,default:so},Symbol.toStringTag,{value:"Module"})),St={tools:{icon:"#9333ea",bgColor:"bg-purple-100"},value:{icon:"#16a34a",bgColor:"bg-green-100"},maintenance:{icon:"#ea580c",bgColor:"bg-orange-100"}},Ey=({data:r})=>{var t,s,n,a;const{tools:i,supplies:c,equipment:o,officeHardware:l}=r||{},d=(t=i==null?void 0:i.length)!=null?t:0,x=(s=c==null?void 0:c.length)!=null?s:0,m=(n=o==null?void 0:o.length)!=null?n:0,p=(a=l==null?void 0:l.length)!=null?a:0,f=d+x+m+p;if(u.useEffect(()=>{r&&console.log("📊 InventoryInsightsCard received data:",r)},[r]),u.useEffect(()=>{r&&f!==d+x+m+p&&console.error("🚨 Count mismatch detected!",{totalItemsCount:f,sumOfCategories:d+x+m+p,difference:f-(d+x+m+p)})},[f,d,x,m,p,r]),!r||!r.tools||!r.supplies||!r.equipment||!r.officeHardware)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"No inventory data available"})});const g=(r.tools.reduce((b,_)=>b+(_.unit_cost||0),0)||0)+(r.supplies.reduce((b,_)=>b+(_.unit_cost||0)*(_.quantity||1),0)||0)+(r.equipment.reduce((b,_)=>b+(_.unit_cost||0),0)||0)+(r.officeHardware.reduce((b,_)=>b+(_.unit_cost||0),0)||0),v=r.equipment.filter(b=>{var _,P;if("status"in b&&b.status==="Maintenance")return!0;if("lastServiced"in b&&((_=b.data)!=null&&_.lastServiced)){const $=new Date(b.data.lastServiced),D=new Date;return D.setMonth(D.getMonth()-6),$<D}if("warranty"in b&&((P=b.data)!=null&&P.warranty)){const $=new Date(b.data.warranty),D=new Date;return D.setDate(D.getDate()+30),$<=D&&$>new Date}return!1}).length,j=f>0?Math.min(f/50*100,100):0,h=g>0?Math.min(g/1e4*100,100):0,y=v>0?Math.min(v/10*100,100):0;return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-3",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Inventory insights and statistics",children:[e.jsxs("h3",{className:"text-base font-semibold mb-3 flex items-center text-[#5b5b5b]",children:[e.jsx(C,{path:ea,size:1.1,color:"#4ECDC4",className:"mr-2","aria-hidden":"true"}),"Inventory Insights"]}),e.jsxs("div",{className:"space-y-3",role:"list","aria-label":"Inventory metrics",children:[e.jsxs("div",{role:"listitem",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1 group relative",children:[e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx("div",{className:`${St.tools.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:ea,size:.8,color:St.tools.icon,"aria-hidden":"true"})}),"Total Items"]}),e.jsxs("span",{className:"font-semibold cursor-help",title:`Tools: ${d} • Supplies: ${x} • Equipment: ${m} • Office Hardware: ${p}`,"aria-label":`Total items: ${f}. Full breakdown: ${d} tools, ${x} supplies, ${m} equipment, ${p} office hardware`,children:[f,f!==d+x+m+p&&e.jsx("span",{className:"text-xs text-red-500 ml-1",children:"⚠️"})]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-md shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["Tools: ",d," • Supplies: ",x," • Equipment:"," ",m," • Office Hardware: ",p,e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":j,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Total items progress: ${j}%`,children:e.jsx("div",{className:"bg-purple-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${j}%`}})})]}),e.jsxs("div",{role:"listitem",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1 group relative",children:[e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx("div",{className:`${St.value.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:vc,size:.8,color:St.value.icon,"aria-hidden":"true"})}),"Total Value"]}),e.jsxs("span",{className:"font-semibold cursor-help",title:"Cumulative value of all inventory items","aria-label":`Total inventory value: $${g.toLocaleString()}`,children:["$",g.toLocaleString()]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-md shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["Cumulative value of all inventory items",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":h,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Total value progress: ${h}%`,children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${h}%`}})})]}),e.jsxs("div",{role:"listitem",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1 group relative",children:[e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx("div",{className:`${St.maintenance.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:Ar,size:.8,color:St.maintenance.icon,"aria-hidden":"true"})}),"Maintenance Due (30 days)"]}),e.jsx("span",{className:"font-semibold cursor-help",title:"Equipment due for maintenance or with expiring warranty in next 30 days","aria-label":`Items requiring maintenance in next 30 days: ${v}`,children:v}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-md shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["Equipment due for maintenance or with expiring warranty in next 30 days",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":y,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Maintenance due progress: ${y}%`,children:e.jsx("div",{className:"bg-orange-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${y}%`}})})]})]})]})},aj=Object.freeze(Object.defineProperty({__proto__:null,default:Ey},Symbol.toStringTag,{value:"Module"}));var Oy=Object.defineProperty,$y=Object.defineProperties,Ay=Object.getOwnPropertyDescriptors,Wl=Object.getOwnPropertySymbols,Ry=Object.prototype.hasOwnProperty,By=Object.prototype.propertyIsEnumerable,Gl=(r,t,s)=>t in r?Oy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Fy=(r,t)=>{for(var s in t||(t={}))Ry.call(t,s)&&Gl(r,s,t[s]);if(Wl)for(var s of Wl(t))By.call(t,s)&&Gl(r,s,t[s]);return r},My=(r,t)=>$y(r,Ay(t));const Ly={tools:{icon:"#9333ea",bgColor:"bg-purple-100",textColor:"text-purple-600",selectedBgColor:"bg-purple-50"},supplies:{icon:"#16a34a",bgColor:"bg-green-100",textColor:"text-green-600",selectedBgColor:"bg-green-50"},equipment:{icon:"#ea580c",bgColor:"bg-orange-100",textColor:"text-orange-600",selectedBgColor:"bg-orange-50"},officeHardware:{icon:"#3b82f6",bgColor:"bg-blue-100",textColor:"text-blue-600",selectedBgColor:"bg-blue-50"}},zy=({onCategoryChange:r,counts:t})=>{const[s,n]=u.useState([{label:"Tools",icon:jc,selected:!0,tabId:"tools"},{label:"Supplies",icon:Rs,selected:!1,tabId:"supplies"},{label:"Equipment",icon:wc,selected:!1,tabId:"equipment"},{label:"Office Hardware",icon:Nc,selected:!1,tabId:"officeHardware"}]),a=u.useRef([]),i=(o,l)=>{n(s.map(d=>My(Fy({},d),{selected:d.label===o}))),r(l)},c=(o,l)=>{var d,x,m,p;switch(o.key){case"ArrowDown":{o.preventDefault();const f=(l+1)%s.length;(d=a.current[f])==null||d.focus();break}case"ArrowUp":{o.preventDefault();const f=l===0?s.length-1:l-1;(x=a.current[f])==null||x.focus();break}case"Home":{o.preventDefault(),(m=a.current[0])==null||m.focus();break}case"End":{o.preventDefault(),(p=a.current[s.length-1])==null||p.focus();break}case"Enter":case" ":{o.preventDefault();const f=s[l];i(f.label,f.tabId);break}}};return u.useEffect(()=>{var o;const l=s.findIndex(d=>d.selected);l!==-1&&((o=a.current[l])==null||o.focus())},[s]),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-3",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Inventory category selection",children:[e.jsxs("h3",{className:"text-base font-semibold mb-3 flex items-center text-[#5b5b5b]",children:[e.jsx(C,{path:Cc,size:1.1,color:"#4ECDC4",className:"mr-2","aria-hidden":"true"}),"Categories"]}),e.jsx("div",{className:"space-y-2",role:"tablist","aria-label":"Inventory categories",children:s.map((o,l)=>{const d=Ly[o.tabId];return e.jsxs("button",{ref:x=>a.current[l]=x,onClick:()=>i(o.label,o.tabId),onKeyDown:x=>c(x,l),className:`w-full px-3 py-1.5 rounded-lg text-left flex items-center text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1 ${o.selected?`${d.selectedBgColor} ${d.textColor}`:"text-gray-600 hover:bg-gray-100"}`,tabIndex:0,role:"tab","aria-selected":o.selected,"aria-label":`${o.label} category${o.selected?" (currently selected)":""}`,children:[e.jsx("div",{className:`${d.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:o.icon,size:.9,color:d.icon,"aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1 flex justify-between items-center",children:[e.jsx("span",{children:o.label}),t&&e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${o.selected?"bg-white bg-opacity-30":"bg-gray-200 text-gray-600"}`,children:t[o.tabId]||0})]})]},o.label)})})]})},nj=Object.freeze(Object.defineProperty({__proto__:null,default:zy},Symbol.toStringTag,{value:"Module"}));var Uy=Object.defineProperty,qy=Object.defineProperties,Hy=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,Vy=Object.prototype.hasOwnProperty,Wy=Object.prototype.propertyIsEnumerable,Ql=(r,t,s)=>t in r?Uy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Pe=(r,t)=>{for(var s in t||(t={}))Vy.call(t,s)&&Ql(r,s,t[s]);if(Kl)for(var s of Kl(t))Wy.call(t,s)&&Ql(r,s,t[s]);return r},De=(r,t)=>qy(r,Hy(t));const Gy=()=>{const[r,t]=u.useState([]),[s,n]=u.useState(!1),[a,i]=u.useState("medium"),[c,o]=u.useState("ui"),[l,d]=u.useState({title:"",description:"",steps:[""],expected:"",actual:"",environment:navigator.userAgent,reporter:"User"}),x=u.useCallback(h=>{const y=De(Pe({},h),{id:`bug-${Date.now()}-${Math.random()}`,timestamp:new Date,status:"open"});t(b=>[y,...b]),n(!1),d({title:"",description:"",steps:[""],expected:"",actual:"",environment:navigator.userAgent,reporter:"User"})},[]),m=u.useCallback((h,y)=>{t(b=>b.map(_=>_.id===h?De(Pe({},_),{status:y}):_))},[]),p=u.useCallback(()=>{const h=JSON.stringify(r,null,2),y=new Blob([h],{type:"application/json"}),b=URL.createObjectURL(y),_=document.createElement("a");_.href=b,_.download=`bug-reports-${new Date().toISOString().split("T")[0]}.json`,_.click(),URL.revokeObjectURL(b)},[r]),f=u.useCallback(h=>{if(h.preventDefault(),!l.title||!l.description){alert("Please fill in all required fields");return}x({title:l.title,description:l.description,severity:a,category:c,steps:l.steps.filter(y=>y.trim()),expected:l.expected,actual:l.actual,environment:l.environment,reporter:l.reporter,attachments:[]})},[l,a,c,x]),g=u.useCallback(()=>{d(h=>De(Pe({},h),{steps:[...h.steps,""]}))},[]),v=u.useCallback(h=>{d(y=>De(Pe({},y),{steps:y.steps.filter((b,_)=>_!==h)}))},[]),j=u.useCallback((h,y)=>{d(b=>De(Pe({},b),{steps:b.steps.map((_,P)=>P===h?y:_)}))},[]);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Bug Tracker"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:[e.jsx(C,{path:ta,size:1}),"Report Bug"]}),e.jsxs("button",{onClick:p,disabled:r.length===0,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(C,{path:As,size:1}),"Export"]})]})]}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900",children:"Report New Bug"}),e.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Bug Title *"}),e.jsx("input",{id:"bug-title",type:"text",value:l.title,onChange:h=>d(y=>De(Pe({},y),{title:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"Brief description of the bug",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-severity",className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity"}),e.jsxs("select",{id:"bug-severity",value:a,onChange:h=>i(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-category",className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{id:"bug-category",value:c,onChange:h=>o(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[e.jsx("option",{value:"ui",children:"UI/UX"}),e.jsx("option",{value:"functionality",children:"Functionality"}),e.jsx("option",{value:"performance",children:"Performance"}),e.jsx("option",{value:"accessibility",children:"Accessibility"}),e.jsx("option",{value:"data",children:"Data"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-environment",className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),e.jsx("input",{id:"bug-environment",type:"text",value:l.environment,onChange:h=>d(y=>De(Pe({},y),{environment:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"Browser, OS, etc."})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{id:"bug-description",value:l.description,onChange:h=>d(y=>De(Pe({},y),{description:h.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"Detailed description of the bug",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-steps",className:"block text-sm font-medium text-gray-700 mb-2",children:"Steps to Reproduce"}),l.steps.map((h,y)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 w-6",children:[y+1,"."]}),e.jsx("input",{id:`bug-step-${y}`,type:"text",value:h,onChange:b=>j(y,b.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:`Step ${y+1}`}),l.steps.length>1&&e.jsx("button",{type:"button",onClick:()=>v(y),className:"p-2 text-red-400 hover:text-red-600",children:e.jsx(C,{path:ae,size:.8})})]},y)),e.jsx("button",{type:"button",onClick:g,className:"text-sm text-[#4ECDC4] hover:text-[#3db8b0] underline",children:"+ Add Step"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-expected",className:"block text-sm font-medium text-gray-700 mb-2",children:"Expected Behavior"}),e.jsx("textarea",{id:"bug-expected",value:l.expected,onChange:h=>d(y=>De(Pe({},y),{expected:h.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"What should happen?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-actual",className:"block text-sm font-medium text-gray-700 mb-2",children:"Actual Behavior"}),e.jsx("textarea",{id:"bug-actual",value:l.actual,onChange:h=>d(y=>De(Pe({},y),{actual:h.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"What actually happens?"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Submit Bug Report"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Bug Reports"}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[r.map(h=>e.jsxs("div",{className:`p-4 rounded-lg border ${h.severity==="critical"?"bg-red-50 border-red-200":h.severity==="high"?"bg-orange-50 border-orange-200":h.severity==="medium"?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:h.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:h.description})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${h.severity==="critical"?"bg-red-100 text-red-800":h.severity==="high"?"bg-orange-100 text-orange-800":h.severity==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:h.severity}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${h.status==="open"?"bg-red-100 text-red-800":h.status==="investigating"?"bg-yellow-100 text-yellow-800":h.status==="fixing"?"bg-blue-100 text-blue-800":h.status==="testing"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:h.status})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[h.category," • ",h.reporter]}),e.jsx("span",{children:h.timestamp.toLocaleDateString()})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Status:"}),e.jsxs("select",{value:h.status,onChange:y=>m(h.id,y.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"investigating",children:"Investigating"}),e.jsx("option",{value:"fixing",children:"Fixing"}),e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})]})]},h.id)),r.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(C,{path:ta,size:2,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{children:"No bug reports yet. Report a bug to get started."})]})]})]})]})},Ky=({isOpen:r,onClose:t,errorContext:s="login",technicalReport:n})=>{const[a,i]=u.useState("support");if(!r)return null;const c=l=>{l.target===l.currentTarget&&t()},o=l=>{l.key==="Escape"&&t()};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"support-contact-title",children:[e.jsx("button",{className:"absolute inset-0 w-full h-full",onClick:c,onKeyDown:o,tabIndex:-1,"aria-label":"Close dialog"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{id:"support-contact-title",className:"text-xl font-semibold text-gray-900",children:"Get Help"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ko,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsxs("button",{onClick:()=>i("admin"),className:`py-4 px-1 border-b-2 font-medium text-sm ${a==="admin"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ei,{className:"w-4 h-4 inline mr-2"}),"Administrator"]}),e.jsxs("button",{onClick:()=>i("support"),className:`py-4 px-1 border-b-2 font-medium text-sm ${a==="support"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ti,{className:"w-4 h-4 inline mr-2"}),"Technical Support"]}),e.jsxs("button",{onClick:()=>i("bug"),className:`py-4 px-1 border-b-2 font-medium text-sm ${a==="bug"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(Io,{className:"w-4 h-4 inline mr-2"}),"Report Bug"]})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[a==="admin"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"Contact Your System Administrator"}),e.jsx("p",{className:"text-blue-800 mb-4",children:"For login issues, account access problems, or user management questions, please contact your system administrator."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-blue-700",children:e.jsx("strong",{children:"Common Administrator Issues:"})}),e.jsxs("ul",{className:"text-sm text-blue-700 list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Account not found or disabled"}),e.jsx("li",{children:"Password reset requests"}),e.jsx("li",{children:"Permission or role changes"}),e.jsx("li",{children:"Account lockouts"}),e.jsx("li",{children:"User profile updates"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"How to Contact:"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Contact your IT department or system administrator directly. They have access to user management tools and can resolve account-related issues."})]})]}),a==="support"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-orange-900 mb-2",children:"Contact Technical Support"}),e.jsx("p",{className:"text-orange-800 mb-4",children:"For technical issues, system errors, or application problems, please contact our technical support team."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-orange-700",children:e.jsx("strong",{children:"Common Technical Issues:"})}),e.jsxs("ul",{className:"text-sm text-orange-700 list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"System performance problems"}),e.jsx("li",{children:"Connection or network errors"}),e.jsx("li",{children:"Application crashes or freezes"}),e.jsx("li",{children:"Data synchronization issues"}),e.jsx("li",{children:"Browser compatibility problems"})]})]})]}),n&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Technical Report"}),e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"Please include this technical report when contacting support:"}),e.jsx("div",{className:"bg-white border border-gray-300 rounded p-3",children:e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap overflow-x-auto",children:n})})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Support Information:"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Error Context:"})," ",s]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Timestamp:"})," ",new Date().toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Browser:"})," ",navigator.userAgent]})]})]})]}),a==="bug"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Report a Bug"}),e.jsx("p",{className:"text-gray-600",children:"Use the bug tracker below to report issues, suggest improvements, or provide feedback about the application."})]}),e.jsx(Gy,{})]})]}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4 bg-gray-50",children:e.jsx("div",{className:"flex justify-end space-x-3",children:e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Close"})})})]})]})},gs={INVALID_CREDENTIALS:"Invalid email or password. Please check your credentials and try again.",NETWORK_ERROR:"Unable to connect to the server. Please check your internet connection and try again.",INTERNAL_ERROR:"An internal error occurred. Our technical team has been notified. Please try again later.",UNEXPECTED_ERROR:"An unexpected error occurred. Please try again or contact technical support if the problem persists."},ve={AUTH:"auth",NETWORK:"network",VALIDATION:"validation",SYSTEM:"system",UNKNOWN:"unknown"},Yt={ADMIN:"admin",SUPPORT:"support",RETRY:"retry"},Jt={LOW:"low",MEDIUM:"medium",HIGH:"high"},Xt={[ve.AUTH]:Yt.ADMIN,[ve.NETWORK]:Yt.SUPPORT,[ve.VALIDATION]:Yt.RETRY,[ve.SYSTEM]:Yt.SUPPORT,[ve.UNKNOWN]:Yt.SUPPORT};var Qy=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Yl=({error:r,context:t="login",onRetry:s,onDismiss:n})=>{const[a,i]=u.useState(!1),[c,o]=u.useState(!1),[l,d]=u.useState(!1),m=u.useCallback(y=>{const b=typeof y=="string"?y:y.message,_=b.toLowerCase();return _.includes("unauthorized")||_.includes("invalid credentials")||_.includes("authentication failed")||_.includes("invalid email")||_.includes("password")||_.includes("login")||_.includes("401")||_.includes("403")?{type:ve.AUTH,title:"Login Issue",message:gs.INVALID_CREDENTIALS,action:Xt[ve.AUTH],severity:Jt.MEDIUM}:_.includes("network")||_.includes("connection")||_.includes("timeout")||_.includes("fetch")||_.includes("http")||_.includes("server")||_.includes("500")||_.includes("502")||_.includes("503")||_.includes("504")?{type:ve.NETWORK,title:"Connection Problem",message:gs.NETWORK_ERROR,action:Xt[ve.NETWORK],severity:Jt.HIGH}:_.includes("database")||_.includes("internal")||_.includes("system")||_.includes("service")||_.includes("unexpected")||_.includes("error")?{type:ve.SYSTEM,title:"System Issue",message:gs.INTERNAL_ERROR,action:Xt[ve.SYSTEM],severity:Jt.HIGH}:_.includes("required")||_.includes("invalid")||_.includes("format")||_.includes("validation")?{type:ve.VALIDATION,title:"Please Check Your Input",message:b,action:Xt[ve.VALIDATION],severity:Jt.LOW}:{type:ve.UNKNOWN,title:"Something Went Wrong",message:gs.UNEXPECTED_ERROR,action:Xt[ve.UNKNOWN],severity:Jt.MEDIUM}},[])(r),p=u.useCallback(()=>{const y={timestamp:new Date().toISOString(),context:t,error:{message:typeof r=="string"?r:r.message,stack:typeof r=="object"&&r.stack?r.stack:void 0},userAgent:navigator.userAgent,url:window.location.href,category:m};return JSON.stringify(y,null,2)},[r,t,m]),f=u.useCallback(()=>Qy(null,null,function*(){try{const y=p();yield navigator.clipboard.writeText(y),o(!0),setTimeout(()=>o(!1),2e3)}catch(y){ye.error("Failed to copy technical report:",y)}}),[p]),g=u.useCallback(()=>{try{Vo.reportError(typeof r=="string"?new Error(r):r,void 0,{context:t,category:m.type}),ye.info("Error reported to service")}catch(y){ye.error("Failed to report error:",y)}},[r,t,m.type]),v=y=>{switch(y){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},j=y=>{switch(y){case"admin":return e.jsx(ei,{className:"w-5 h-5"});case"support":return e.jsx(ti,{className:"w-5 h-5"});case"retry":return e.jsx(ws,{className:"w-5 h-5"});default:return e.jsx(ws,{className:"w-5 h-5"})}},h=y=>{switch(y){case"admin":return"Contact Administrator";case"support":return"Contact Support";case"retry":return"Try Again";default:return"Get Help"}};return e.jsxs("div",{className:`rounded-lg border p-4 ${v(m.severity)}`,children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:j(m.action)}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium",children:m.title}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx("p",{children:m.message})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[m.action==="retry"&&s&&e.jsx("button",{onClick:s,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Try Again"}),(m.action==="admin"||m.action==="support")&&e.jsx("button",{onClick:()=>{g(),d(!0)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:h(m.action)}),e.jsxs("button",{onClick:()=>i(!a),className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[a?"Hide":"Show"," Technical Details"]})]}),a&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-100 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Technical Report"}),e.jsx("button",{onClick:f,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-gray-600 hover:text-gray-800",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Xl,{className:"w-3 h-3 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Po,{className:"w-3 h-3 mr-1"}),"Copy Report"]})})]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap overflow-x-auto",children:p()})]}),n&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:n,className:"text-sm text-gray-500 hover:text-gray-700",children:"Dismiss"})})]})]}),e.jsx(Ky,{isOpen:l,onClose:()=>d(!1),errorContext:t,technicalReport:a?p():void 0})]})},lj=Object.freeze(Object.defineProperty({__proto__:null,UserFriendlyErrorHandler:Yl,default:Yl},Symbol.toStringTag,{value:"Module"}));export{Uv as $,Vv as A,W as B,dm as C,Dv as D,Bc as E,Gv as F,Kv as G,Qv as H,Pv as I,Wv as J,Yv as K,um as L,Xv as M,zp as N,_v as O,Av as P,sf as Q,Jv as R,xv as S,uv as T,qv as U,Mv as V,Rv as W,Lv as X,zv as Y,Bv as Z,Ve as _,Tt as a,Fv as a0,gv as a1,vv as a2,yv as a3,wv as a4,jv as a5,qm as a6,Nv as a7,dt as a8,Cv as a9,aj as aA,nj as aB,lj as aC,bv as aa,fv as ab,kc as ac,hv as ad,pv as ae,Sv as af,av as ag,nv as ah,sv as ai,lv as aj,tv as ak,cv as al,ov as am,dv as an,$v as ao,Ms as ap,cg as aq,Gn as ar,Ev as as,mv as at,Mi as au,Ec as av,iv as aw,Iv as ax,sj as ay,rj as az,Ah as b,le as c,Ri as d,Tv as e,kv as f,$e as g,Br as h,tj as i,mr as j,$c as k,Mb as l,Zv as m,ej as n,Ss as o,Sr as p,ye as q,Gc as r,K as s,rv as t,We as u,Ov as v,Dc as w,Rr as x,Hv as y,cr as z};
