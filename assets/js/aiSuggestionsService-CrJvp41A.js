import{s as c}from"./login-CtXU169Q.js";import"./utils-DSBVV_PW.js";import"./vendor-DoALFvsH.js";import"./data-73RVSc-N.js";import"./ui-DETUEJ2B.js";var y=Object.defineProperty,m=Object.defineProperties,v=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,h=(i,r,e)=>r in i?y(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e,O=(i,r)=>{for(var e in r||(r={}))S.call(r,e)&&h(i,e,r[e]);if(f)for(var e of f(r))w.call(r,e)&&h(i,e,r[e]);return i},k=(i,r)=>m(i,v(r)),l=(i,r,e)=>new Promise((t,n)=>{var o=a=>{try{u(e.next(a))}catch(d){n(d)}},_=a=>{try{u(e.throw(a))}catch(d){n(d)}},u=a=>a.done?t(a.value):Promise.resolve(a.value).then(o,_);u((e=e.apply(i,r)).next())});class E{getAILearningInsights(r){return l(this,null,function*(){try{const{data:e}=yield c.from("users").select("facility_id").eq("id",r).single(),{data:t,error:n}=yield c.from("ai_learning_insights").select("*").eq("user_id",r).eq("facility_id",e==null?void 0:e.facility_id).single();if((n==null?void 0:n.code)!=="PGRST116")throw n;return t||null}catch(e){return console.error("Error fetching AI learning insights:",e),null}})}getAIContentRecommendations(r,e=5){return l(this,null,function*(){try{const{data:t,error:n}=yield c.from("ai_content_recommendations").select("*").eq("user_id",r).gte("recommendation_score",70).order("recommendation_score",{ascending:!1}).limit(e);if(n)throw n;return t?(t||[]).map(o=>{var _;return{id:o.id,user_id:o.user_id,content_id:o.content_id,recommendation_score:o.recommendation_score,recommendation_reason:o.recommendation_reason||o.reasoning||"",confidence_level:o.confidence_level||0,user_context:o.user_context,content_context:o.content_context,tags:(_=o.data)==null?void 0:_.tags,is_displayed:o.is_displayed,is_clicked:o.is_clicked,is_completed:o.is_completed||!1,display_count:o.display_count,click_through_rate:o.click_through_rate||0,completion_rate:o.completion_rate||0,user_feedback_rating:o.user_feedback_rating||0,model_version:o.model_version||"1.0.0",feature_vector:o.feature_vector||[],algorithm_used:o.algorithm_used||"default",created_at:o.created_at,expires_at:o.expires_at||new Date(Date.now()+720*60*60*1e3).toISOString()}}):[]}catch(t){return console.error("Error fetching AI content recommendations:",t),[]}})}trackRecommendationInteraction(r,e,t){return l(this,null,function*(){try{const n={};switch(e){case"displayed":n.is_displayed=!0;break;case"clicked":n.is_clicked=!0;break;case"completed":n.is_completed=!0;break}const{error:o}=yield c.from("ai_content_recommendations").update(n).eq("id",r).eq("user_id",t);if(o)throw o;return!0}catch(n){return console.error("Error tracking recommendation interaction:",n),!1}})}storeAILearningInsights(r,e){return l(this,null,function*(){try{const{error:t}=yield c.from("ai_learning_insights").upsert(k(O({user_id:r},e),{last_ai_analysis:new Date().toISOString(),updated_at:new Date().toISOString()}));if(t)throw t;return!0}catch(t){return console.error("Error storing AI learning insights:",t),!1}})}storeAIContentRecommendation(r,e,t){return l(this,null,function*(){try{const{error:n}=yield c.from("ai_content_recommendations").insert({user_id:r,content_id:e,recommendation_score:t.recommendation_score,recommendation_reason:t.recommendation_reason,confidence_level:t.confidence_level,user_context:t.user_context?JSON.stringify(t.user_context):null,content_context:t.content_context?JSON.stringify(t.content_context):null,tags:t.tags,is_displayed:t.is_displayed,is_clicked:t.is_clicked,is_completed:t.is_completed,display_count:t.display_count,click_through_rate:t.click_through_rate,completion_rate:t.completion_rate,user_feedback_rating:t.user_feedback_rating,model_version:t.model_version,algorithm_used:t.algorithm_used,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(n)throw n;return!0}catch(n){return console.error("Error storing AI content recommendation:",n),!1}})}getLearningAnalytics(r){return l(this,null,function*(){try{const{data:e,error:t}=yield c.from("knowledge_hub_user_progress").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(50);if(t)throw t;return e?(e||[]).map(n=>({id:n.id,user_id:n.user_id,content_id:n.content_id,progress_status:n.progress_status||"not_started",content_type:n.content_type,time_spent_minutes:n.time_spent_minutes,completed_at:void 0})):[]}catch(e){return console.error("Error fetching learning analytics:",e),[]}})}storeLearningSessionAnalytics(r){return l(this,null,function*(){try{const{data:{user:e}}=yield c.auth.getUser();if(!e)return!1;const t=e,{error:n}=yield c.from("ai_learning_analytics").insert({user_id:t.id,session_start:r.session_start,content_items_accessed:r.content_items_accessed,learning_path_progress:r.learning_path_progress?JSON.stringify(r.learning_path_progress):null,learning_patterns:r.learning_patterns?JSON.stringify(r.learning_patterns):null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(n)throw n;return!0}catch(e){return console.error("Error storing learning session analytics:",e),!1}})}generateLearningInsights(r){return l(this,null,function*(){try{const e=yield this.getLearningAnalytics(r);if(!e||e.length===0)return null;const t=this.analyzeLearningPatterns(e);return yield this.storeAILearningInsights(r,t),t}catch(e){return console.error("Error generating learning insights:",e),null}})}analyzeLearningPatterns(r){const e=r.filter(s=>s.progress_status==="completed"),t=r.length,n=e.length,o=t>0?n/t*100:0,_=r.reduce((s,p)=>{const g=p.content_type||"Unknown";return s[g]=(s[g]||0)+1,s},{}),u=Object.entries(_).sort(([,s],[,p])=>p-s).slice(0,3).map(([s])=>s),a=e.filter(s=>s.time_spent_minutes),d=a.length>0?Math.round(a.reduce((s,p)=>s+(p.time_spent_minutes||0),0)/a.length):30;return{learning_efficiency_score:Math.round(o),preferred_content_categories:u,optimal_study_duration:d,next_learning_milestone:this.predictNextMilestone(r),skill_gaps:this.identifySkillGaps(r),ai_confidence_score:.8,model_version:"v1.0"}}predictNextMilestone(r){const e=r.filter(t=>t.progress_status==="completed");return e.length===0?"Complete your first course":e.length<3?"Complete 3 courses to build foundation":e.length<10?"Complete 10 courses for intermediate level":"Achieve advanced certification"}identifySkillGaps(r){const e=[],t=new Set(r.filter(n=>n.progress_status==="completed").map(n=>n.content_type));return t.has("procedure")||e.push("Clinical Procedures"),t.has("policy")||e.push("Healthcare Policies"),t.has("learning_pathway")||e.push("Structured Learning Paths"),e}}export{E as AISuggestionsService};
