import{j as e}from"./utils-DSBVV_PW.js";import{a as m,j as H,u as R}from"./vendor-DoALFvsH.js";import{s as N,u as F}from"./login-em2Hs6UG.js";import"./data-73RVSc-N.js";import"./ui-CbhfWbfq.js";var E=(r,t,s)=>new Promise((d,o)=>{var a=n=>{try{i(s.next(n))}catch(u){o(u)}},c=n=>{try{i(s.throw(n))}catch(u){o(u)}},i=n=>n.done?d(n.value):Promise.resolve(n.value).then(a,c);i((s=s.apply(r,t)).next())});const _={getCourse(r){return E(this,null,function*(){const{data:t,error:s}=yield N.from("knowledge_hub_content").select("*").eq("id",r).single();if(s)throw s;return{id:t.id,title:t.title,description:t.description||"",tags:t.tags||[],estimated_duration:t.estimated_duration,status:t.status,knowledge_hub_modules:[{id:`${t.id}-module-1`,title:"Main Content",position:1,knowledge_hub_lessons:[{id:t.id,title:t.title,content:t.content||{body:t.description||""},position:1,estimated_duration:t.estimated_duration}]}]}})},markLessonComplete(r,t){return E(this,null,function*(){try{const{error:s}=yield N.from("knowledge_hub_user_progress").upsert({user_id:r,lesson_id:t,status:"completed",progress:100,completed_at:new Date().toISOString()},{onConflict:"user_id,lesson_id"});if(s)throw s;const{data:d,error:o}=yield N.from("knowledge_hub_content").select("id, title, difficulty_level, estimated_duration").eq("id",t).single();if(o)throw o;const a=(d==null?void 0:d.difficulty_level)==="advanced"?3:(d==null?void 0:d.difficulty_level)==="intermediate"?2:1,c=d!=null&&d.estimated_duration?Math.min(d.estimated_duration/30,3):1,i=Math.round(25*a*c),{data:n}=yield N.from("home_challenge_completions").select("id").eq("user_id",r).eq("challenge_id",t).maybeSingle();if(n)return console.log("⚠️ XP already awarded for this lesson."),{success:!0,pointsEarned:0};const{error:u}=yield N.from("home_challenge_completions").insert({id:crypto.randomUUID(),user_id:r,challenge_id:t,points_earned:i,completed_at:new Date().toISOString(),created_at:new Date().toISOString()});if(u)throw u;const{error:j}=yield N.rpc("increment_user_xp",{user_id_input:r,xp_increment:i});return j&&console.warn("⚠️ Failed to sync XP to global stats:",j.message),console.log(`🏆 ${i} XP awarded for lesson ${t}`),{success:!0,pointsEarned:i}}catch(s){return console.error("Error marking lesson complete and awarding XP:",s),{success:!1,pointsEarned:0}}})},getUserProgress(r,t){return E(this,null,function*(){const{data:s,error:d}=yield N.from("knowledge_hub_user_progress").select("*").eq("user_id",r).eq("lesson_id",t);if(d)throw d;const o=s.length>0?1:0,a=1,c=o>0?100:0;return{completedLessons:o,totalLessons:a,progressPercent:c}})},resumeCourse(r,t){return E(this,null,function*(){return t})}};var O=(r,t,s)=>new Promise((d,o)=>{var a=n=>{try{i(s.next(n))}catch(u){o(u)}},c=n=>{try{i(s.throw(n))}catch(u){o(u)}},i=n=>n.done?d(n.value):Promise.resolve(n.value).then(a,c);i((s=s.apply(r,t)).next())});function G(r,t){const[s,d]=m.useState(null),[o,a]=m.useState({completedLessons:0,totalLessons:0,progressPercent:0}),[c,i]=m.useState(!1),[n,u]=m.useState(null),j=m.useCallback(()=>O(null,null,function*(){var f,p;if(r){i(!0),u(null);try{const x=yield _.getCourse(r),L={id:x.id,title:x.title,description:x.description,lessons:((f=x.knowledge_hub_modules)==null?void 0:f.map(b=>{var w,P;return{id:b.id,title:b.title,content:((w=b.knowledge_hub_lessons)==null?void 0:w.map(y=>y.content).join(" "))||"",duration:((P=b.knowledge_hub_lessons)==null?void 0:P.reduce((y,M)=>y+(M.estimated_duration||0),0))||0,isCompleted:!1}}))||[],totalDuration:x.estimated_duration||0,difficulty:"beginner",category:((p=x.tags)==null?void 0:p[0])||"General",instructor:"System",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(d(L),t){const b=yield _.getUserProgress(t,r);a(b)}}catch(x){u(x instanceof Error?x.message:"An error occurred")}finally{i(!1)}}}),[r,t]),C=m.useCallback(f=>O(null,null,function*(){try{const p=yield _.markLessonComplete(t,f);p.success&&p.pointsEarned>0&&console.log(`🎉 Earned ${p.pointsEarned} XP for completing lesson!`);const x=yield _.getUserProgress(t,r);a(x)}catch(p){console.error("❌ Error marking lesson complete:",p instanceof Error?p.message:"Unknown error")}}),[t,r]),k=m.useCallback(()=>O(null,null,function*(){try{return yield _.resumeCourse(t,r)}catch(f){return console.error("❌ Error resuming course:",f instanceof Error?f.message:"Unknown error"),null}}),[t,r]);return m.useEffect(()=>{j()},[j]),{course:s,progress:o,isLoading:c,error:n,loadCourse:j,markLessonComplete:C,resumeLesson:k}}var K=Object.defineProperty,Y=Object.defineProperties,J=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,U=(r,t,s)=>t in r?K(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,I=(r,t)=>{for(var s in t||(t={}))Q.call(t,s)&&U(r,s,t[s]);if(W)for(var s of W(t))Z.call(t,s)&&U(r,s,t[s]);return r},ee=(r,t)=>Y(r,J(t)),S=(r,t,s)=>new Promise((d,o)=>{var a=n=>{try{i(s.next(n))}catch(u){o(u)}},c=n=>{try{i(s.throw(n))}catch(u){o(u)}},i=n=>n.done?d(n.value):Promise.resolve(n.value).then(a,c);i((s=s.apply(r,t)).next())});function oe(){var r,t;const{courseId:s}=H(),d=R(),{currentUser:o}=F(),{course:a,progress:c,isLoading:i,error:n,markLessonComplete:u,resumeLesson:j}=G(s||"",(o==null?void 0:o.id)||""),C=100,[k,f]=m.useState(null),[p,x]=m.useState({}),[L,b]=m.useState(null),[w,P]=m.useState(0),[y,M]=m.useState(0),[D,V]=m.useState(0),[$,X]=m.useState(!1),B=m.useRef(0);if(m.useEffect(()=>{const l=()=>S(null,null,function*(){try{const{data:h,error:g}=yield N.from("home_challenge_completions").select("points_earned").eq("user_id",o==null?void 0:o.id);if(g)throw g;const q=(h==null?void 0:h.reduce((z,A)=>z+(A.points_earned||0),0))||0;P(q)}catch(h){console.error("Error fetching total XP:",h)}});o!=null&&o.id&&l()},[o==null?void 0:o.id,L]),m.useEffect(()=>{if(w>=0){const l=Math.floor(w/C),h=w%C;M(l),V(h),l>B.current&&(X(!0),B.current=l,setTimeout(()=>X(!1),2e3))}},[w]),m.useEffect(()=>{var l,h,g;!a||!c||console.log("✅ CourseViewer hydrated:",{courseTitle:a.title,moduleCount:(h=(l=a.lessons)==null?void 0:l.length)!=null?h:0,progressPercent:(g=c.progressPercent)!=null?g:0})},[a,c]),i)return e.jsx("div",{className:"p-6",children:"Loading course..."});if(n)return e.jsxs("div",{className:"p-6 text-red-600",children:["Error: ",n]});if(!a)return e.jsx("div",{className:"p-6",children:"No course found."});const v=((r=a.lessons)==null?void 0:r.find(l=>l.id===k))||null,T=l=>x(h=>ee(I({},h),{[l]:!h[l]}));return e.jsxs("div",{className:"flex flex-col h-screen bg-white",children:[e.jsxs("header",{className:"flex items-center justify-between border-b border-gray-200 px-6 py-4 bg-gradient-to-r from-slate-50 to-gray-50 shadow-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-teal rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:a.title}),e.jsxs("p",{className:"text-sm text-slate-600 font-medium",children:[c.progressPercent,"% complete"]})]})]}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[c.completedLessons,"/",c.totalLessons," lessons"]})]}),e.jsx("div",{className:"w-full h-3 bg-slate-200 rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-3 bg-teal rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${c.progressPercent}%`}})})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-3 py-1.5 rounded-full shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),e.jsxs("span",{className:"text-sm font-semibold",children:["Level ",y]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-1.5 rounded-full border border-blue-200",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsxs("span",{className:"text-sm font-medium",children:[w," XP"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[D," XP to next level"]})]}),c.completedLessons>0&&!k&&e.jsxs("div",{className:"mt-4 p-4 bg-teal/10 border border-teal/20 rounded-xl shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-teal/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-teal",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M15 14h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"Resume where you left off"}),e.jsx("p",{className:"text-sm text-teal font-medium",children:a.title})]})]}),e.jsx("button",{onClick:()=>S(null,null,function*(){const l=yield j();l&&f(l)}),className:"text-sm font-medium text-white bg-teal hover:bg-teal-hover px-4 py-2 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md",children:"Continue Learning"})]})]}),e.jsxs("button",{onClick:()=>d("/knowledge-hub"),className:"flex items-center gap-2 text-slate-600 hover:text-slate-800 px-4 py-2 rounded-lg hover:bg-white/50 transition-all duration-200 border border-slate-200 hover:border-slate-300 shadow-sm hover:shadow-md",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"font-medium",children:"Back to Knowledge Hub"})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("aside",{className:"w-80 border-r border-slate-200 bg-slate-50 overflow-y-auto shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Course Content"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Navigate through the learning modules"})]}),e.jsx("nav",{className:"space-y-3",children:(t=a.lessons)==null?void 0:t.map(l=>e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:[e.jsxs("button",{onClick:()=>T(l.id),className:"w-full text-left p-4 hover:bg-slate-50 transition-colors duration-200 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-900",children:l.title}),e.jsx("p",{className:"text-xs text-slate-500",children:"1 lesson"})]})]}),e.jsx("div",{className:"w-6 h-6 bg-slate-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-slate-600 text-sm font-medium",children:p[l.id]?"−":"+"})})]}),e.jsx("div",{className:"border-t border-slate-100 bg-slate-50/50",children:e.jsx("div",{className:"p-2 space-y-1",children:(()=>{const h=l.isCompleted,g=l.id===k;return e.jsxs("button",{onClick:()=>f(l.id),className:`w-full text-left p-3 rounded-lg transition-all duration-200 flex items-center justify-between group ${g?"bg-teal/10 border border-teal/20 shadow-sm":h?"bg-green-50 hover:bg-green-100 border border-green-200":"hover:bg-white hover:shadow-sm border border-transparent hover:border-slate-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${g?"bg-teal/20":h?"bg-green-100":"bg-slate-100"}`,children:h?e.jsx("svg",{className:"w-3 h-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("div",{className:`w-2 h-2 rounded-full ${g?"bg-teal":"bg-slate-400"}`})}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:`text-sm font-medium ${g?"text-teal":h?"text-green-800 line-through":"text-slate-700"}`,children:l.title}),l.estimated_duration&&e.jsxs("p",{className:"text-xs text-slate-500 mt-0.5",children:[l.estimated_duration," min"]})]})]}),h&&e.jsx("div",{className:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]},l.id)})()})})]},l.id))})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-white",children:v?e.jsxs("div",{className:"max-w-4xl mx-auto p-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-teal/20 rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-teal",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:v.title}),v.duration&&e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Estimated time: ",v.duration," ","minutes"]})]})]})}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"p-8",children:e.jsx("article",{className:"prose prose-slate max-w-none",children:v.content&&typeof v.content=="string"?e.jsx("div",{dangerouslySetInnerHTML:{__html:v.content}}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No content available"}),e.jsx("p",{className:"text-slate-600",children:"This lesson doesn't have any content yet."})]})})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("svg",{className:"w-10 h-10 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Select a lesson to begin learning"}),e.jsx("p",{className:"text-slate-600",children:"Choose a lesson from the sidebar to start your learning journey."})]})})})]}),v&&e.jsx("footer",{className:"sticky bottom-0 border-t border-slate-200 bg-white/95 backdrop-blur-sm shadow-lg",children:e.jsx("div",{className:"max-w-4xl mx-auto px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("div",{className:"w-2 h-2 bg-teal rounded-full"}),e.jsxs("span",{children:["Currently viewing:"," ",e.jsx("span",{className:"font-medium text-slate-900",children:v.title})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>S(null,null,function*(){const l=yield _.markLessonComplete((o==null?void 0:o.id)||"",v.id);l.success&&l.pointsEarned>0&&(b(l.pointsEarned),setTimeout(()=>b(null),2e3)),yield u(v.id),alert("Lesson marked complete!")}),className:"flex items-center gap-2 px-6 py-3 bg-teal hover:bg-teal-hover text-white font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow-md",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Mark Complete"]}),e.jsxs("button",{onClick:()=>S(null,null,function*(){const l=yield j();l&&f(l)}),className:"flex items-center gap-2 px-6 py-3 bg-teal/10 hover:bg-teal/20 text-teal font-medium rounded-lg transition-all duration-200 border border-teal/20 hover:border-teal/30",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})}),"Next Lesson"]})]})]})})}),L&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg animate-fade-in-out z-[9999]",children:["+",L," XP"]}),$&&e.jsxs("div",{className:"fixed bottom-16 left-1/2 -translate-x-1/2 bg-green-600 text-white px-5 py-2 rounded-full shadow-xl animate-fade-in-out z-[9999]",children:["🎉 Level Up! You're now Level ",y]})]})}export{oe as default};
