import{s as u}from"./login-C1ujRpW7.js";import"./utils-DSBVV_PW.js";import"./vendor-DoALFvsH.js";import"./data-73RVSc-N.js";import"./ui-DETUEJ2B.js";const v=t=>typeof t=="object"&&t!==null&&"id"in t&&typeof t.id=="string",m=t=>typeof t=="object"&&t!==null&&("data"in t||"error"in t),q=t=>typeof t=="object"&&t!==null&&"eventType"in t&&"table"in t&&typeof t.table=="string";var P=Object.defineProperty,E=Object.defineProperties,w=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,I=(t,e,r)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R=(t,e)=>{for(var r in e||(e={}))O.call(e,r)&&I(t,r,e[r]);if(g)for(var r of g(e))C.call(e,r)&&I(t,r,e[r]);return t},S=(t,e)=>E(t,w(e)),y=(t,e,r)=>new Promise((s,o)=>{var l=a=>{try{n(r.next(a))}catch(c){o(c)}},i=a=>{try{n(r.throw(a))}catch(c){o(c)}},n=a=>a.done?s(a.value):Promise.resolve(a.value).then(l,i);n((r=r.apply(t,e)).next())});class k{constructor(){this.tableName="inventory_items"}getAllItems(e){return y(this,null,function*(){var r,s,o,l;try{const{data:{user:i},error:n}=yield u.auth.getUser();let a=null;!n&&i&&(a=((r=i.user_metadata)==null?void 0:r.facility_id)||null);const c=u.from(this.tableName).select((e==null?void 0:e.select)||"*").order(((s=e==null?void 0:e.orderBy)==null?void 0:s.column)||"created_at",{ascending:(l=(o=e==null?void 0:e.orderBy)==null?void 0:o.ascending)!=null?l:!1});a&&c.eq("facility_id",a),e!=null&&e.limit&&c.limit(e.limit),e!=null&&e.offset&&c.range(e.offset,e.offset+(e.limit||10)-1),e!=null&&e.filters&&Object.entries(e.filters).forEach(([_,d])=>{d!=null&&c.eq(_,d)});const f=yield c;if(!m(f))return{success:!1,error:"Invalid response format from Supabase",processedCount:0,errorCount:1};if(f.error)return{success:!1,error:f.error.message,processedCount:0,errorCount:1};const b=f.data||[],p=[];let h=0;for(const _ of b)if(v(_)){const d=this.transformRowToInventoryItem(_);d.success&&d.data?p.push(d.data):h++}else h++;return{success:!0,data:p,processedCount:p.length,errorCount:h}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error occurred",processedCount:0,errorCount:1}}})}getItemById(e){return y(this,null,function*(){var r;try{const{data:{user:s},error:o}=yield u.auth.getUser();let l=null;!o&&s&&(l=((r=s.user_metadata)==null?void 0:r.facility_id)||null);const i=u.from(this.tableName).select("*").eq("id",e);l&&i.eq("facility_id",l);const n=yield i.single();if(!m(n))return{success:!1,error:"Invalid response format from Supabase"};if(n.error)return{success:!1,error:n.error.message};const a=n.data;return!a||!v(a)?{success:!1,error:"Item not found or invalid format"}:this.transformRowToInventoryItem(a)}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}})}createItem(e){return y(this,null,function*(){var r;try{const{data:{user:s},error:o}=yield u.auth.getUser();let l=null;!o&&s&&(l=((r=s.user_metadata)==null?void 0:r.facility_id)||null);const i=S(R({},e),{facility_id:l||e.facility_id}),n=yield u.from(this.tableName).insert([i]).select().single();if(!m(n))return{success:!1,error:"Invalid response format from Supabase"};if(n.error)return{success:!1,error:n.error.message};const a=n.data;return!a||!v(a)?{success:!1,error:"Failed to create item or invalid response format"}:this.transformRowToInventoryItem(a)}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}})}updateItem(e,r){return y(this,null,function*(){var s;try{const{data:{user:o},error:l}=yield u.auth.getUser();let i=null;!l&&o&&(i=((s=o.user_metadata)==null?void 0:s.facility_id)||null);const n=u.from(this.tableName).update(r).eq("id",e);i&&n.eq("facility_id",i);const a=yield n.select().single();if(!m(a))return{success:!1,error:"Invalid response format from Supabase"};if(a.error)return{success:!1,error:a.error.message};const c=a.data;return!c||!v(c)?{success:!1,error:"Item not found or invalid response format"}:this.transformRowToInventoryItem(c)}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error occurred"}}})}deleteItem(e){return y(this,null,function*(){var r;try{const{data:{user:s},error:o}=yield u.auth.getUser();let l=null;!o&&s&&(l=((r=s.user_metadata)==null?void 0:r.facility_id)||null);const i=u.from(this.tableName).delete().eq("id",e);l&&i.eq("facility_id",l);const n=yield i;return m(n)?n.error?{success:!1,error:n.error.message}:{success:!0}:{success:!1,error:"Invalid response format from Supabase"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}})}subscribeToChanges(e,r){const s=u.channel("inventory_changes").on("postgres_changes",{event:(r==null?void 0:r.event)||"*",schema:(r==null?void 0:r.schema)||"public",table:(r==null?void 0:r.table)||this.tableName,filter:r==null?void 0:r.filter},o=>{q(o)?e(o):console.warn("Received invalid realtime payload:",o)}).subscribe();return()=>{u.removeChannel(s)}}transformRowToInventoryItem(e){try{return{success:!0,data:{id:e.id,facility_id:e.facility_id,name:e.name,quantity:e.quantity,data:e.data,created_at:e.created_at,updated_at:e.updated_at,reorder_level:e.reorder_level,reorder_point:e.reorder_point,status:e.status,expiration_date:e.expiration_date,unit_cost:e.unit_cost,category:e.category}}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to transform row to inventory item"}}}transformInventoryItemToRow(e){return{facility_id:e.facility_id,name:e.name,quantity:e.quantity,data:e.data,reorder_level:e.reorder_level,reorder_point:e.reorder_point,status:e.status,expiration_date:e.expiration_date,unit_cost:e.unit_cost,category:e.category}}}export{k as TypedSupabaseAdapter};
