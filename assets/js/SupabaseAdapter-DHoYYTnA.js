const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/main-FsBT3Y_8.js","assets/js/utils-DSBVV_PW.js","assets/js/vendor-DoALFvsH.js","assets/js/login-em2Hs6UG.js","assets/js/data-73RVSc-N.js","assets/js/ui-CbhfWbfq.js","assets/js/errors-CsB9ZK3e.js","assets/css/main-DtMVykw2.css"])))=>i.map(i=>d[i]);
import{s as m,_ as y}from"./login-em2Hs6UG.js";import{X as w,Y as o}from"./main-FsBT3Y_8.js";import{I as u}from"./inventoryTransformers-ChLO0ufi.js";import{TypedSupabaseAdapter as I}from"./TypedSupabaseAdapter-Du7ADJcB.js";import"./utils-DSBVV_PW.js";import"./vendor-DoALFvsH.js";import"./data-73RVSc-N.js";import"./ui-CbhfWbfq.js";import"./errors-CsB9ZK3e.js";var g=Object.defineProperty,p=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,f=(s,t,e)=>t in s?g(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,v=(s,t)=>{for(var e in t||(t={}))E.call(t,e)&&f(s,e,t[e]);if(p)for(var e of p(t))b.call(t,e)&&f(s,e,t[e]);return s},i=(s,t,e)=>new Promise((r,n)=>{var a=l=>{try{c(e.next(l))}catch(h){n(h)}},d=l=>{try{c(e.throw(l))}catch(h){n(h)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,d);c((e=e.apply(s,t)).next())});class O{constructor(t){this.isInitialized=!1,this.lastError=null,this.lastSyncTime=null,this.pendingChanges=!1,this.cachedItems=null,this.cacheTimestamp=0,this.CACHE_DURATION=5e3,this.client=null,this.initPromise=null,this.getClient=()=>i(this,null,function*(){return this.client?this.client:(this.initPromise||(this.initPromise=i(this,null,function*(){const e=m,{error:r}=yield e.from("inventory_items").select("id").limit(1);return r?console.warn("SupabaseAdapter.ts:test ❌ Probe failed",r.message||r):console.log("Supabase client initialized successfully"),this.client=e,e})),this.initPromise)}),this.getAllItems=e=>i(this,null,function*(){const r=Date.now();if(this.cachedItems&&r-this.cacheTimestamp<this.CACHE_DURATION)return this.cachedItems;let n=e==null?void 0:e.facilityId;if(!n){const{FacilityService:d}=yield y(()=>import("./main-FsBT3Y_8.js").then(c=>c.Z),__vite__mapDeps([0,1,2,3,4,5,6,7]));n=yield d.getCurrentFacilityId()}const a=yield this.typedAdapter.getAllItems({filters:{facility_id:n}});if(!a.success||!a.data)throw console.warn("Failed to get inventory items:",a.error),new Error(a.error||"Failed to get inventory items");return this.cachedItems=a.data,this.cacheTimestamp=Date.now(),a.data}),this.config=t,this.typedAdapter=new I}initialize(){return i(this,null,function*(){if(!this.isInitialized){if(!w())throw new Error("Supabase is not properly configured");this.isInitialized=!0,this.testConnectionAsync()}})}testConnectionAsync(){return i(this,null,function*(){try{const t=yield o.getItems();t.error?console.warn("⚠️ Supabase connection test failed:",t.error):console.log("Supabase connection test passed")}catch(t){console.warn("⚠️ Supabase connection test failed:",t)}})}getItemsByCategory(t){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const e=yield this.typedAdapter.getAllItems({filters:{_category:t}});if(!e.success||!e.data)throw new Error(e.error||"Failed to get items by category");return e.data||[]}catch(e){throw new Error(`Failed to get items by category: ${e instanceof Error?e.message:"Unknown error"}`)}})}getFilteredItems(t,e){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const r=yield this.typedAdapter.getAllItems({filters:v({search:t},e)});if(!r.success||!r.data)throw new Error(r.error||"Failed to get filtered items");return r.data||[]}catch(r){throw new Error(`Failed to get filtered items: ${r instanceof Error?r.message:"Unknown error"}`)}})}getCategories(){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{return(yield o.getCategories())||[]}catch(t){throw new Error(`Failed to get categories: ${t instanceof Error?t.message:"Unknown error"}`)}})}fetchCategories(){return i(this,null,function*(){return this.getCategories()})}updateInventoryItem(t,e){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const r=u.transformToSupabase(e);return yield o.updateItem(t,r)}catch(r){throw new Error(`Failed to update inventory item: ${r instanceof Error?r.message:"Unknown error"}`)}})}deleteInventoryItem(t){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{yield o.deleteItem(t)}catch(e){throw new Error(`Failed to delete inventory item: ${e instanceof Error?e.message:"Unknown error"}`)}})}isConnected(){return this.isInitialized}getMetadata(){return{name:"Supabase Adapter",version:"1.0.0",description:"Supabase-based inventory data adapter",capabilities:{supportsRead:!0,supportsWrite:!0,supportsDelete:!0,supportsRealTime:!0,supportsOffline:!1,supportsBatch:!1},config:this.config}}fetchAllInventoryData(){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const t=yield this.getAllItems();return{data:t,error:null,count:t.length}}catch(t){const e=t instanceof Error?t.message:"Unknown error occurred";return{data:[],error:e,count:0}}})}fetchInventoryItems(){return i(this,null,function*(){return this.getAllItems()||[]})}addInventoryItem(t){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const e=u.transformToSupabase(t);return yield o.createItem(e)}catch(e){throw new Error(`Failed to add inventory item: ${e instanceof Error?e.message:"Unknown error"}`)}})}addCategory(t){return i(this,null,function*(){return t})}deleteCategory(t){return i(this,null,function*(){})}batchAddItems(t){return i(this,null,function*(){const e=[];for(const r of t)try{const n=yield this.addInventoryItem(r);e.push(n)}catch(n){throw this.lastError=n,n}return e})}batchUpdateItems(t){return i(this,null,function*(){const e=[];for(const r of t)try{const n=yield this.updateInventoryItem(r.id,r.item);e.push(n)}catch(n){throw this.lastError=n,n}return e})}batchDeleteItems(t){return i(this,null,function*(){for(const e of t)try{yield this.deleteInventoryItem(e)}catch(r){throw this.lastError=r,r}})}sync(){return i(this,null,function*(){try{this.lastSyncTime=new Date,this.pendingChanges=!1}catch(t){throw this.lastError=t,t}})}getLastSyncTime(){return this.lastSyncTime}hasPendingChanges(){return this.pendingChanges}getLastError(){return this.lastError}clearError(){this.lastError=null}disconnect(){return i(this,null,function*(){this.isInitialized=!1,this.lastError=null})}fetchData(){return i(this,null,function*(){this.isInitialized||(yield this.initialize())})}createItem(t){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const e=u.transformToSupabase(t);return yield o.createItem(e)}catch(e){throw new Error(`Failed to create inventory item: ${e instanceof Error?e.message:"Unknown error"}`)}})}updateItem(t,e){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const r=u.transformToSupabase(e);return yield o.updateItem(t,r)}catch(r){throw new Error(`Failed to update inventory item: ${r instanceof Error?r.message:"Unknown error"}`)}})}deleteItem(t){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{yield o.deleteItem(t)}catch(e){throw new Error(`Failed to delete inventory item: ${e instanceof Error?e.message:"Unknown error"}`)}})}getAnalyticsData(){return i(this,null,function*(){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{const t=yield o.getAnalytics();return{totalItems:t.totalItems,activeItems:t.activeItems,totalValue:t.totalValue,categories:t.categories}}catch(t){throw new Error(`Failed to get analytics data: ${t instanceof Error?t.message:"Unknown error"}`)}})}transformToInventoryItems(t){return t.map(e=>u.transformFromSupabase(e))}subscribeToChanges(t){if(!this.isInitialized)throw new Error("Supabase adapter not initialized");try{return this.typedAdapter.subscribeToChanges(e=>{t&&t(e)},{event:"*"})}catch(e){return console.error("❌ Failed to set up real-time subscription in SupabaseAdapter:",e),()=>{}}}getConfig(){return this.config}clearCache(){this.cachedItems=null,this.cacheTimestamp=0}isReady(){return this.isInitialized}}export{O as SupabaseAdapter};
