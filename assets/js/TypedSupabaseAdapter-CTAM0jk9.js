import{s as u}from"./login-CScPvZaJ.js";import"./utils-5cl0BHpv.js";import"./vendor-DVtBqAv5.js";import"./data-Djiu4445.js";import"./ui-C2vLYFVP.js";const v=t=>typeof t=="object"&&t!==null&&"id"in t&&typeof t.id=="string",y=t=>typeof t=="object"&&t!==null&&("data"in t||"error"in t),q=t=>typeof t=="object"&&t!==null&&"eventType"in t&&"table"in t&&typeof t.table=="string";var P=Object.defineProperty,E=Object.defineProperties,O=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,I=(t,e,r)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,S=(t,e)=>{for(var r in e||(e={}))C.call(e,r)&&I(t,r,e[r]);if(g)for(var r of g(e))R.call(e,r)&&I(t,r,e[r]);return t},U=(t,e)=>E(t,O(e)),_=(t,e,r)=>new Promise((a,o)=>{var l=s=>{try{n(r.next(s))}catch(c){o(c)}},i=s=>{try{n(r.throw(s))}catch(c){o(c)}},n=s=>s.done?a(s.value):Promise.resolve(s.value).then(l,i);n((r=r.apply(t,e)).next())});class k{constructor(){this.tableName="inventory_items"}getAllItems(e){return _(this,null,function*(){var r,a,o,l;try{const{data:{user:i},error:n}=yield u.auth.getUser();let s=null;!n&&i&&(s=((r=i.user_metadata)==null?void 0:r.facility_id)||null);const c=u.from(this.tableName).select((e==null?void 0:e.select)||"*").order(((a=e==null?void 0:e.orderBy)==null?void 0:a.column)||"created_at",{ascending:(l=(o=e==null?void 0:e.orderBy)==null?void 0:o.ascending)!=null?l:!1});s&&c.eq("facility_id",s),e!=null&&e.limit&&c.limit(e.limit),e!=null&&e.offset&&c.range(e.offset,e.offset+(e.limit||10)-1),e!=null&&e.filters&&Object.entries(e.filters).forEach(([m,d])=>{d!=null&&(m==="location"?c.ilike("scanned_location",`%${d}%`):c.eq(m,d))});const f=yield c;if(!y(f))return{success:!1,error:"Invalid response format from Supabase",processedCount:0,errorCount:1};if(f.error)return{success:!1,error:f.error.message,processedCount:0,errorCount:1};const b=f.data||[],p=[];let h=0;for(const m of b)if(v(m)){const d=this.transformRowToInventoryItem(m);d.success&&d.data?p.push(d.data):h++}else h++;return{success:!0,data:p,processedCount:p.length,errorCount:h}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error occurred",processedCount:0,errorCount:1}}})}getItemById(e){return _(this,null,function*(){var r;try{const{data:{user:a},error:o}=yield u.auth.getUser();let l=null;!o&&a&&(l=((r=a.user_metadata)==null?void 0:r.facility_id)||null);const i=u.from(this.tableName).select("*").eq("id",e);l&&i.eq("facility_id",l);const n=yield i.single();if(!y(n))return{success:!1,error:"Invalid response format from Supabase"};if(n.error)return{success:!1,error:n.error.message};const s=n.data;return!s||!v(s)?{success:!1,error:"Item not found or invalid format"}:this.transformRowToInventoryItem(s)}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}})}createItem(e){return _(this,null,function*(){var r;try{const{data:{user:a},error:o}=yield u.auth.getUser();let l=null;!o&&a&&(l=((r=a.user_metadata)==null?void 0:r.facility_id)||null);const i=U(S({},e),{facility_id:l||e.facility_id}),n=yield u.from(this.tableName).insert([i]).select().single();if(!y(n))return{success:!1,error:"Invalid response format from Supabase"};if(n.error)return{success:!1,error:n.error.message};const s=n.data;return!s||!v(s)?{success:!1,error:"Failed to create item or invalid response format"}:this.transformRowToInventoryItem(s)}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}})}updateItem(e,r){return _(this,null,function*(){var a;try{const{data:{user:o},error:l}=yield u.auth.getUser();let i=null;!l&&o&&(i=((a=o.user_metadata)==null?void 0:a.facility_id)||null);const n=u.from(this.tableName).update(r).eq("id",e);i&&n.eq("facility_id",i);const s=yield n.select().single();if(!y(s))return{success:!1,error:"Invalid response format from Supabase"};if(s.error)return{success:!1,error:s.error.message};const c=s.data;return!c||!v(c)?{success:!1,error:"Item not found or invalid response format"}:this.transformRowToInventoryItem(c)}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error occurred"}}})}deleteItem(e){return _(this,null,function*(){var r;try{const{data:{user:a},error:o}=yield u.auth.getUser();let l=null;!o&&a&&(l=((r=a.user_metadata)==null?void 0:r.facility_id)||null);const i=u.from(this.tableName).delete().eq("id",e);l&&i.eq("facility_id",l);const n=yield i;return y(n)?n.error?{success:!1,error:n.error.message}:{success:!0}:{success:!1,error:"Invalid response format from Supabase"}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}})}subscribeToChanges(e,r){const a=u.channel("inventory_changes").on("postgres_changes",{event:(r==null?void 0:r.event)||"*",schema:(r==null?void 0:r.schema)||"public",table:(r==null?void 0:r.table)||this.tableName,filter:r==null?void 0:r.filter},o=>{q(o)?e(o):console.warn("Received invalid realtime payload:",o)}).subscribe();return()=>{u.removeChannel(a)}}transformRowToInventoryItem(e){try{return{success:!0,data:{id:e.id,facility_id:e.facility_id,name:e.name,quantity:e.quantity,data:e.data,created_at:e.created_at,updated_at:e.updated_at,reorder_level:e.reorder_level,reorder_point:e.reorder_point,status:e.status,expiration_date:e.expiration_date,unit_cost:e.unit_cost,category:e.category,archived:e.archived,archived_at:e.archived_at,archived_by:e.archived_by,archive_reason:e.archive_reason}}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to transform row to inventory item"}}}transformInventoryItemToRow(e){return{facility_id:e.facility_id,name:e.name,quantity:e.quantity,data:e.data,reorder_level:e.reorder_level,reorder_point:e.reorder_point,status:e.status,expiration_date:e.expiration_date,unit_cost:e.unit_cost,category:e.category}}}export{k as TypedSupabaseAdapter};
