import{s as o}from"./login-CgiYf71G.js";import{J as l}from"./main-Ccza29P3.js";import"./utils-5cl0BHpv.js";import"./vendor-DVtBqAv5.js";import"./data-Djiu4445.js";import"./ui-C2vLYFVP.js";import"./errors-BMV5cHgT.js";var c=(d,e,r)=>new Promise((s,t)=>{var n=a=>{try{i(r.next(a))}catch(h){t(h)}},u=a=>{try{i(r.throw(a))}catch(h){t(h)}},i=a=>a.done?s(a.value):Promise.resolve(a.value).then(n,u);i((r=r.apply(d,e)).next())});class _{static signIn(e){return c(this,arguments,function*({email:r,password:s}){try{const{data:t,error:n}=yield o.auth.signInWithPassword({email:r,password:s});if(n)throw n;if(t&&t.user&&t.user.id){const{data:u,error:i}=yield o.from("users").select("*").eq("id",t.user.id).single();return i&&console.warn("Failed to fetch user profile:",i),{user:u,session:t.session,error:null}}return{user:null,session:null,error:"No user data received"}}catch(t){return{user:null,session:null,error:l(t).message}}})}static signUp(e){return c(this,arguments,function*({email:r,password:s,fullName:t,role:n="user"}){try{const{data:u,error:i}=yield o.auth.signUp({email:r,password:s,options:{data:{full_name:t,role:n}}});if(i)throw i;if(u.user){const a=t.trim().split(" "),h=a[0]||"",p=a.slice(1).join(" ")||"",f={id:u.user.id,email:u.user.email,first_name:h,last_name:p,role:n,facility_id:"default"},{error:m}=yield o.from("users").insert(f);return m&&console.warn("Failed to create user profile:",m),{user:f,session:u.session,error:null}}return{user:null,session:null,error:"No user data received"}}catch(u){return{user:null,session:null,error:l(u).message}}})}static signOut(){return c(this,null,function*(){try{const{error:e}=yield o.auth.signOut();if(e)throw e;return{error:null}}catch(e){return{error:l(e).message}}})}static getCurrentUser(){return c(this,null,function*(){try{const{data:{user:e},error:r}=yield o.auth.getUser();if(r)throw r;if(!e)return{user:null,session:null,error:null};const{data:{session:s}}=yield o.auth.getSession();if(!s)return{user:null,session:null,error:"No active session"};const{data:t,error:n}=yield o.from("users").select("*").eq("id",e.id).single();return n&&console.warn("Failed to fetch user profile:",n),{user:t,session:null,error:null}}catch(e){return{user:null,session:null,error:l(e).message}}})}static getSession(){return c(this,null,function*(){try{const{data:{session:e},error:r}=yield o.auth.getSession();if(r)throw r;return{session:e,error:null}}catch(e){return{session:null,error:l(e).message}}})}static updateProfile(e,r){return c(this,null,function*(){try{const{data:s,error:t}=yield o.from("users").update(r).eq("id",e).select().single();if(t)throw t;return{user:s,error:null}}catch(s){return{user:null,error:l(s).message}}})}static resetPassword(e){return c(this,null,function*(){try{const{error:r}=yield o.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/reset-password`});if(r)throw r;return{error:null}}catch(r){return{error:l(r).message}}})}static updatePassword(e){return c(this,null,function*(){try{const{error:r}=yield o.auth.updateUser({password:e});if(r)throw r;return{error:null}}catch(r){return{error:l(r).message}}})}static onAuthStateChange(e){return o.auth.onAuthStateChange((r,s)=>{e(r,s)})}}export{_ as SupabaseAuthService};
