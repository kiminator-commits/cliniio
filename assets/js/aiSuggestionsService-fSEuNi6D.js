import{s as c}from"./components-CQ0__InY.js";import"./react-vendor-QwocJJ0l.js";import"./data-vendor-74w85Vz1.js";import"./vendor-B35QfyBG.js";import"./services-TvYZC6AJ.js";import"./inventory-pages-Clxt543p.js";import"./ui-vendor-mgcSnJSc.js";import"./utils-vendor-DPZjRVl3.js";import"./knowledgehub-pages-BPCkPWE6.js";var y=Object.defineProperty,m=Object.defineProperties,v=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,h=(s,t,e)=>t in s?y(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,O=(s,t)=>{for(var e in t||(t={}))S.call(t,e)&&h(s,e,t[e]);if(f)for(var e of f(t))w.call(t,e)&&h(s,e,t[e]);return s},I=(s,t)=>m(s,v(t)),_=(s,t,e)=>new Promise((r,n)=>{var i=a=>{try{d(e.next(a))}catch(u){n(u)}},l=a=>{try{d(e.throw(a))}catch(u){n(u)}},d=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,l);d((e=e.apply(s,t)).next())});class D{getAILearningInsights(t){return _(this,null,function*(){try{const{data:e}=yield c.from("users").select("facility_id").eq("id",t).single(),{data:r,error:n}=yield c.from("ai_learning_insights").select("*").eq("user_id",t).eq("facility_id",e==null?void 0:e.facility_id).single();if((n==null?void 0:n.code)!=="PGRST116")throw n;return r||null}catch(e){return console.error("Error fetching AI learning insights:",e),null}})}getAIContentRecommendations(t,e=5){return _(this,null,function*(){try{const{data:r,error:n}=yield c.from("ai_content_recommendations").select("*").eq("user_id",t).gte("recommendation_score",70).order("recommendation_score",{ascending:!1}).limit(e);if(n)throw n;return r?(r||[]).map(i=>{var l;return{id:i.id,user_id:i.user_id,content_id:i.content_id,recommendation_score:i.recommendation_score,recommendation_reason:i.recommendation_reason||i.reasoning||"",confidence_level:i.confidence_level||0,user_context:i.user_context,content_context:i.content_context,tags:(l=i.data)==null?void 0:l.tags,is_displayed:i.is_displayed,is_clicked:i.is_clicked,is_completed:i.is_completed||!1,display_count:i.display_count,click_through_rate:i.click_through_rate||0,completion_rate:i.completion_rate||0,user_feedback_rating:i.user_feedback_rating||0,model_version:i.model_version||"1.0.0",feature_vector:i.feature_vector||[],algorithm_used:i.algorithm_used||"default",created_at:i.created_at,expires_at:i.expires_at||new Date(Date.now()+720*60*60*1e3).toISOString()}}):[]}catch(r){return console.error("Error fetching AI content recommendations:",r),[]}})}trackRecommendationInteraction(t,e,r){return _(this,null,function*(){try{const n={};switch(e){case"displayed":n.is_displayed=!0;break;case"clicked":n.is_clicked=!0;break;case"completed":n.is_completed=!0;break}const{error:i}=yield c.from("ai_content_recommendations").update(n).eq("id",t).eq("user_id",r);if(i)throw i;return!0}catch(n){return console.error("Error tracking recommendation interaction:",n),!1}})}storeAILearningInsights(t,e){return _(this,null,function*(){try{const{error:r}=yield c.from("ai_learning_insights").upsert(I(O({user_id:t},e),{last_ai_analysis:new Date().toISOString(),updated_at:new Date().toISOString()}));if(r)throw r;return!0}catch(r){return console.error("Error storing AI learning insights:",r),!1}})}storeAIContentRecommendation(t,e,r){return _(this,null,function*(){try{const{error:n}=yield c.from("ai_content_recommendations").insert({user_id:t,content_id:e,recommendation_score:r.recommendation_score,recommendation_reason:r.recommendation_reason,confidence_level:r.confidence_level,user_context:r.user_context?JSON.stringify(r.user_context):null,content_context:r.content_context?JSON.stringify(r.content_context):null,tags:r.tags,is_displayed:r.is_displayed,is_clicked:r.is_clicked,is_completed:r.is_completed,display_count:r.display_count,click_through_rate:r.click_through_rate,completion_rate:r.completion_rate,user_feedback_rating:r.user_feedback_rating,model_version:r.model_version,algorithm_used:r.algorithm_used,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(n)throw n;return!0}catch(n){return console.error("Error storing AI content recommendation:",n),!1}})}getLearningAnalytics(t){return _(this,null,function*(){try{const{data:e,error:r}=yield c.from("knowledge_hub_user_progress").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(50);if(r)throw r;return e?(e||[]).map(n=>({id:n.id,user_id:n.user_id,content_id:n.content_id,progress_status:n.progress_status||"not_started",content_type:n.content_type,time_spent_minutes:n.time_spent_minutes,completed_at:void 0})):[]}catch(e){return console.error("Error fetching learning analytics:",e),[]}})}storeLearningSessionAnalytics(t){return _(this,null,function*(){try{const{data:{user:e}}=yield c.auth.getUser();if(!e)return!1;const{data:r,error:n}=yield c.from("users").select("facility_id").eq("id",e.id).single();if(n||!(r!=null&&r.facility_id))return console.error("Missing facility_id in user profile"),!1;const i=e,{error:l}=yield c.from("ai_learning_analytics").insert({user_id:i.id,facility_id:r.facility_id,session_start:new Date(t.session_start).toISOString(),content_items_accessed:t.content_items_accessed,learning_path_progress:t.learning_path_progress?JSON.stringify(t.learning_path_progress):null,learning_patterns:t.learning_patterns?JSON.stringify(t.learning_patterns):null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(l)throw l;return!0}catch(e){return console.error("Error storing learning session analytics:",e),!1}})}generateLearningInsights(t){return _(this,null,function*(){try{const e=yield this.getLearningAnalytics(t);if(!e||e.length===0)return null;const r=this.analyzeLearningPatterns(e);return yield this.storeAILearningInsights(t,r),r}catch(e){return console.error("Error generating learning insights:",e),null}})}analyzeLearningPatterns(t){const e=t.filter(o=>o.progress_status==="completed"),r=t.length,n=e.length,i=r>0?n/r*100:0,l=t.reduce((o,p)=>{const g=p.content_type||"Unknown";return o[g]=(o[g]||0)+1,o},{}),d=Object.entries(l).sort(([,o],[,p])=>p-o).slice(0,3).map(([o])=>o),a=e.filter(o=>o.time_spent_minutes),u=a.length>0?Math.round(a.reduce((o,p)=>o+(p.time_spent_minutes||0),0)/a.length):30;return{learning_efficiency_score:Math.round(i),preferred_content_categories:d,optimal_study_duration:u,next_learning_milestone:this.predictNextMilestone(t),skill_gaps:this.identifySkillGaps(t),ai_confidence_score:.8,model_version:"v1.0"}}predictNextMilestone(t){const e=t.filter(r=>r.progress_status==="completed");return e.length===0?"Complete your first course":e.length<3?"Complete 3 courses to build foundation":e.length<10?"Complete 10 courses for intermediate level":"Achieve advanced certification"}identifySkillGaps(t){const e=[],r=new Set(t.filter(n=>n.progress_status==="completed").map(n=>n.content_type));return r.has("procedure")||e.push("Clinical Procedures"),r.has("policy")||e.push("Healthcare Policies"),r.has("learning_pathway")||e.push("Structured Learning Paths"),e}}export{D as AISuggestionsService};
