const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/redisClient.server-BIA10qmq.js","assets/js/utils-DSBVV_PW.js","assets/js/vendor-DoALFvsH.js","assets/js/data-73RVSc-N.js","assets/js/ui-CbhfWbfq.js","assets/js/errors-CsB9ZK3e.js"])))=>i.map(i=>d[i]);
var f=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});import{j as d}from"./utils-DSBVV_PW.js";import{g as ls,b as cs,a as j,R as Bt,u as us}from"./vendor-DoALFvsH.js";import{c as ds}from"./data-73RVSc-N.js";import{G as C}from"./ui-CbhfWbfq.js";const hs="modulepreload",fs=function(s){return"/"+s},qt={},te=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=a(t.map(c=>{if(c=fs(c),c in qt)return;qt[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":hs,u||(g.as="script"),g.crossOrigin="",g.href=c,l&&g.setAttribute("nonce",l),document.head.appendChild(g),u)return new Promise((v,_)=>{g.addEventListener("load",v),g.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},gs=s=>{let e;return s?e=s:typeof fetch=="undefined"?e=(...t)=>te(()=>f(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>Oe);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class $t extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class ps extends $t{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zt extends $t{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Vt extends $t{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var yt;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(yt||(yt={}));var ms=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};class vs{constructor(e,{headers:t={},customFetch:r,region:n=yt.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=gs(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ms(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let l={},{region:a}=t;a||(a=this.region);const c=new URL(`${this.url}/${e}`);a&&a!=="any"&&(l["x-region"]=a,c.searchParams.set("forceFunctionRegion",a));let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob!="undefined"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(l["Content-Type"]="text/plain",u=o):typeof FormData!="undefined"&&o instanceof FormData?u=o:(l["Content-Type"]="application/json",u=JSON.stringify(o)));const h=yield this.fetch(c.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:u}).catch(S=>{throw new ps(S)}),g=h.headers.get("x-relay-error");if(g&&g==="true")throw new zt(h);if(!h.ok)throw new Vt(h);let v=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),_;return v==="application/json"?_=yield h.json():v==="application/octet-stream"?_=yield h.blob():v==="text/event-stream"?_=h:v==="multipart/form-data"?_=yield h.formData():_=yield h.text(),{data:_,error:null,response:h}}catch(n){return{data:null,error:n,response:n instanceof Vt||n instanceof zt?n.context:void 0}}})}}var N={},fe={},ge={},pe={},me={},ve={},_s=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("unable to locate global object")},Pe=_s();const ys=Pe.fetch,Ar=Pe.fetch.bind(Pe),Ir=Pe.Headers,ws=Pe.Request,bs=Pe.Response,Oe=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ir,Request:ws,Response:bs,default:Ar,fetch:ys},Symbol.toStringTag,{value:"Module"})),Ss=ls(Oe);var We={},Ht;function Rr(){if(Ht)return We;Ht=1,Object.defineProperty(We,"__esModule",{value:!0});class s extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return We.default=s,We}var Wt;function $r(){if(Wt)return ve;Wt=1;var s=ve&&ve.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ve,"__esModule",{value:!0});const e=s(Ss),t=s(Rr());class r{constructor(i){var o,l;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(o=i.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=i.signal,this.isMaybeSingle=(l=i.isMaybeSingle)!==null&&l!==void 0?l:!1,i.fetch?this.fetch=i.fetch:typeof fetch=="undefined"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=new Headers(this.headers),this.headers.set(i,o),this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const l=this.fetch;let a=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(c=>f(this,null,function*(){var u,h,g,v;let _=null,S=null,w=null,b=c.status,y=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=yield c.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?S=k:S=JSON.parse(k))}const p=(h=this.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),T=(g=c.headers.get("content-range"))===null||g===void 0?void 0:g.split("/");p&&T&&T.length>1&&(w=parseInt(T[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(S)&&(S.length>1?(_={code:"PGRST116",details:`Results contain ${S.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},S=null,w=null,b=406,y="Not Acceptable"):S.length===1?S=S[0]:S=null)}else{const p=yield c.text();try{_=JSON.parse(p),Array.isArray(_)&&c.status===404&&(S=[],_=null,b=200,y="OK")}catch(T){c.status===404&&p===""?(b=204,y="No Content"):_={message:p}}if(_&&this.isMaybeSingle&&(!((v=_==null?void 0:_.details)===null||v===void 0)&&v.includes("0 rows"))&&(_=null,b=200,y="OK"),_&&this.shouldThrowOnError)throw new t.default(_)}return{error:_,data:S,count:w,status:b,statusText:y}}));return this.shouldThrowOnError||(a=a.catch(c=>{var u,h,g;return{error:{message:`${(u=c==null?void 0:c.name)!==null&&u!==void 0?u:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(h=c==null?void 0:c.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(g=c==null?void 0:c.code)!==null&&g!==void 0?g:""}`},data:null,count:null,status:0,statusText:""}})),a.then(i,o)}returns(){return this}overrideTypes(){return this}}return ve.default=r,ve}var Gt;function Lr(){if(Gt)return me;Gt=1;var s=me&&me.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(me,"__esModule",{value:!0});const e=s($r());class t extends e.default{select(n){let i=!1;const o=(n!=null?n:"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:i=!0,nullsFirst:o,foreignTable:l,referencedTable:a=l}={}){const c=a?`${a}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${n}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:o=i}={}){const l=typeof o=="undefined"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${n}`),this}range(n,i,{foreignTable:o,referencedTable:l=o}={}){const a=typeof l=="undefined"?"offset":`${l}.offset`,c=typeof l=="undefined"?"limit":`${l}.limit`;return this.url.searchParams.set(a,`${n}`),this.url.searchParams.set(c,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:i=!1,settings:o=!1,buffers:l=!1,wal:a=!1,format:c="text"}={}){var u;const h=[n?"analyze":null,i?"verbose":null,o?"settings":null,l?"buffers":null,a?"wal":null].filter(Boolean).join("|"),g=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${g}"; options=${h};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return me.default=t,me}var Kt;function Lt(){if(Kt)return pe;Kt=1;var s=pe&&pe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(pe,"__esModule",{value:!0});const e=s(Lr());class t extends e.default{eq(n,i){return this.url.searchParams.append(n,`eq.${i}`),this}neq(n,i){return this.url.searchParams.append(n,`neq.${i}`),this}gt(n,i){return this.url.searchParams.append(n,`gt.${i}`),this}gte(n,i){return this.url.searchParams.append(n,`gte.${i}`),this}lt(n,i){return this.url.searchParams.append(n,`lt.${i}`),this}lte(n,i){return this.url.searchParams.append(n,`lte.${i}`),this}like(n,i){return this.url.searchParams.append(n,`like.${i}`),this}likeAllOf(n,i){return this.url.searchParams.append(n,`like(all).{${i.join(",")}}`),this}likeAnyOf(n,i){return this.url.searchParams.append(n,`like(any).{${i.join(",")}}`),this}ilike(n,i){return this.url.searchParams.append(n,`ilike.${i}`),this}ilikeAllOf(n,i){return this.url.searchParams.append(n,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(n,i){return this.url.searchParams.append(n,`ilike(any).{${i.join(",")}}`),this}is(n,i){return this.url.searchParams.append(n,`is.${i}`),this}in(n,i){const o=Array.from(new Set(i)).map(l=>typeof l=="string"&&new RegExp("[,()]").test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`in.(${o})`),this}contains(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cs.{${i.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(i)}`),this}containedBy(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cd.{${i.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(i)}`),this}rangeGt(n,i){return this.url.searchParams.append(n,`sr.${i}`),this}rangeGte(n,i){return this.url.searchParams.append(n,`nxl.${i}`),this}rangeLt(n,i){return this.url.searchParams.append(n,`sl.${i}`),this}rangeLte(n,i){return this.url.searchParams.append(n,`nxr.${i}`),this}rangeAdjacent(n,i){return this.url.searchParams.append(n,`adj.${i}`),this}overlaps(n,i){return typeof i=="string"?this.url.searchParams.append(n,`ov.${i}`):this.url.searchParams.append(n,`ov.{${i.join(",")}}`),this}textSearch(n,i,{config:o,type:l}={}){let a="";l==="plain"?a="pl":l==="phrase"?a="ph":l==="websearch"&&(a="w");const c=o===void 0?"":`(${o})`;return this.url.searchParams.append(n,`${a}fts${c}.${i}`),this}match(n){return Object.entries(n).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(n,i,o){return this.url.searchParams.append(n,`not.${i}.${o}`),this}or(n,{foreignTable:i,referencedTable:o=i}={}){const l=o?`${o}.or`:"or";return this.url.searchParams.append(l,`(${n})`),this}filter(n,i,o){return this.url.searchParams.append(n,`${i}.${o}`),this}}return pe.default=t,pe}var Jt;function Nr(){if(Jt)return ge;Jt=1;var s=ge&&ge.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ge,"__esModule",{value:!0});const e=s(Lt());class t{constructor(n,{headers:i={},schema:o,fetch:l}){this.url=n,this.headers=new Headers(i),this.schema=o,this.fetch=l}select(n,{head:i=!1,count:o}={}){const l=i?"HEAD":"GET";let a=!1;const c=(n!=null?n:"*").split("").map(u=>/\s/.test(u)&&!a?"":(u==='"'&&(a=!a),u)).join("");return this.url.searchParams.set("select",c),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:i,defaultToNull:o=!0}={}){var l;const a="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const c=n.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(n,{onConflict:i,ignoreDuplicates:o=!1,count:l,defaultToNull:a=!0}={}){var c;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),l&&this.headers.append("Prefer",`count=${l}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const h=n.reduce((g,v)=>g.concat(Object.keys(v)),[]);if(h.length>0){const g=[...new Set(h)].map(v=>`"${v}"`);this.url.searchParams.set("columns",g.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(n,{count:i}={}){var o;const l="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:n}={}){var i;const o="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return ge.default=t,ge}var Yt;function ks(){if(Yt)return fe;Yt=1;var s=fe&&fe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(fe,"__esModule",{value:!0});const e=s(Nr()),t=s(Lt());class r{constructor(i,{headers:o={},schema:l,fetch:a}={}){this.url=i,this.headers=new Headers(o),this.schemaName=l,this.fetch=a}from(i){const o=new URL(`${this.url}/${i}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new r(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:l=!1,get:a=!1,count:c}={}){var u;let h;const g=new URL(`${this.url}/rpc/${i}`);let v;l||a?(h=l?"HEAD":"GET",Object.entries(o).filter(([S,w])=>w!==void 0).map(([S,w])=>[S,Array.isArray(w)?`{${w.join(",")}}`:`${w}`]).forEach(([S,w])=>{g.searchParams.append(S,w)})):(h="POST",v=o);const _=new Headers(this.headers);return c&&_.set("Prefer",`count=${c}`),new t.default({method:h,url:g,headers:_,schema:this.schemaName,body:v,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return fe.default=r,fe}var Zt;function xs(){if(Zt)return N;Zt=1;var s=N&&N.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(N,"__esModule",{value:!0}),N.PostgrestError=N.PostgrestBuilder=N.PostgrestTransformBuilder=N.PostgrestFilterBuilder=N.PostgrestQueryBuilder=N.PostgrestClient=void 0;const e=s(ks());N.PostgrestClient=e.default;const t=s(Nr());N.PostgrestQueryBuilder=t.default;const r=s(Lt());N.PostgrestFilterBuilder=r.default;const n=s(Lr());N.PostgrestTransformBuilder=n.default;const i=s($r());N.PostgrestBuilder=i.default;const o=s(Rr());return N.PostgrestError=o.default,N.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},N}var Ts=xs();const Es=cs(Ts),{PostgrestClient:js,PostgrestQueryBuilder:Po,PostgrestFilterBuilder:Oo,PostgrestTransformBuilder:Ao,PostgrestBuilder:Io,PostgrestError:Ro}=Es;class Cs{static detectEnvironment(){var e;if(typeof WebSocket!="undefined")return{type:"native",constructor:WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocket!="undefined")return{type:"native",constructor:globalThis.WebSocket};if(typeof global!="undefined"&&typeof global.WebSocket!="undefined")return{type:"native",constructor:global.WebSocket};if(typeof globalThis!="undefined"&&typeof globalThis.WebSocketPair!="undefined"&&typeof globalThis.WebSocket=="undefined")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis!="undefined"&&globalThis.EdgeRuntime||typeof navigator!="undefined"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process!="undefined"){const t=process.versions;if(t&&t.node){const r=t.node,n=parseInt(r.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket!="undefined"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch(e){return!1}}}const Ps="2.15.5",Os=`realtime-js/${Ps}`,As="1.0.0",wt=1e4,Is=1e3,Rs=100;var Ne;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Ne||(Ne={}));var $;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})($||($={}));var z;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(z||(z={}));var bt;(function(s){s.websocket="websocket"})(bt||(bt={}));var de;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(de||(de={}));class $s{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(e.slice(o,o+n));o=o+n;const a=r.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:a,payload:c}}}class Dr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var O;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(O||(O={}));const Qt=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Ls(o,s,e,n),i),{})},Ls=(s,e,t,r)=>{const n=e.find(l=>l.name===s),i=n==null?void 0:n.type,o=t[s];return i&&!r.includes(i)?Ur(i,o):St(o)},Ur=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return Ms(e,t)}switch(s){case O.bool:return Ns(e);case O.float4:case O.float8:case O.int2:case O.int4:case O.int8:case O.numeric:case O.oid:return Ds(e);case O.json:case O.jsonb:return Us(e);case O.timestamp:return Fs(e);case O.abstime:case O.date:case O.daterange:case O.int4range:case O.int8range:case O.money:case O.reltime:case O.text:case O.time:case O.timestamptz:case O.timetz:case O.tsrange:case O.tstzrange:return St(e);default:return St(e)}},St=s=>s,Ns=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Ds=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},Us=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},Ms=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const o=s.slice(1,t);try{i=JSON.parse("["+o+"]")}catch(l){i=o?o.split(","):[]}return i.map(l=>Ur(e,l))}return s},Fs=s=>typeof s=="string"?s.replace(" ","T"):s,Mr=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class at{constructor(e,t,r={},n=wt){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Xt;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Xt||(Xt={}));class De{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=De.syncState(this.state,n,i,o),this.pendingDiffs.forEach(a=>{this.state=De.syncDiff(this.state,a,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=De.syncDiff(this.state,n,i,o),l())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),o=this.transformState(t),l={},a={};return this.map(i,(c,u)=>{o[c]||(a[c]=u)}),this.map(o,(c,u)=>{const h=i[c];if(h){const g=u.map(w=>w.presence_ref),v=h.map(w=>w.presence_ref),_=u.filter(w=>v.indexOf(w.presence_ref)<0),S=h.filter(w=>g.indexOf(w.presence_ref)<0);_.length>0&&(l[c]=_),S.length>0&&(a[c]=S)}else l[c]=u}),this.syncDiff(i,{joins:l,leaves:a},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(l,a)=>{var c;const u=(c=e[l])!==null&&c!==void 0?c:[];if(e[l]=this.cloneDeep(a),u.length>0){const h=e[l].map(v=>v.presence_ref),g=u.filter(v=>h.indexOf(v.presence_ref)<0);e[l].unshift(...g)}r(l,u,a)}),this.map(o,(l,a)=>{let c=e[l];if(!c)return;const u=a.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[l]=c,n(l,c,a),c.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var er;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(er||(er={}));var Ue;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Ue||(Ue={}));var K;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(K||(K={}));class Nt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=$.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new at(this,z.join,this.params,this.timeout),this.rejoinTimer=new Dr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=$.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=$.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=$.errored,this.rejoinTimer.scheduleTimeout())}),this._on(z.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new De(this),this.broadcastEndpointURL=Mr(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==$.closed){const{config:{broadcast:o,presence:l,private:a}}=this.params,c=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(v=>v.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[Ue.PRESENCE]&&this.bindings[Ue.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},g={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:c,private:a};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(v=>e==null?void 0:e(K.CHANNEL_ERROR,v)),this._onClose(()=>e==null?void 0:e(K.CLOSED)),this.updateJoinPayload(Object.assign({config:g},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",_=>f(this,[_],function*({postgres_changes:v}){var S;if(this.socket.setAuth(),v===void 0){e==null||e(K.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,b=(S=w==null?void 0:w.length)!==null&&S!==void 0?S:0,y=[];for(let m=0;m<b;m++){const p=w[m],{filter:{event:T,schema:k,table:P,filter:M}}=p,R=v&&v[m];if(R&&R.event===T&&R.schema===k&&R.table===P&&R.filter===M)y.push(Object.assign(Object.assign({},p),{id:R.id}));else{this.unsubscribe(),this.state=$.errored,e==null||e(K.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(K.SUBSCRIBED);return}})).receive("error",v=>{this.state=$.errored,e==null||e(K.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(K.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(r){return f(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return f(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this.state===$.joined&&e===Ue.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}send(r){return f(this,arguments,function*(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:l}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:l,private:this.private}]})};try{const u=yield this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return yield(i=u.body)===null||i===void 0?void 0:i.cancel(),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var l,a,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(l=this.params)===null||l===void 0?void 0:l.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&o("ok"),u.receive("ok",()=>o("ok")),u.receive("error",()=>o("error")),u.receive("timeout",()=>o("timed out"))})})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=$.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(z.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new at(this,z.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=$.closed,this.bindings={}}_fetchWithTimeout(e,t,r){return f(this,null,function*(){const n=new AbortController,i=setTimeout(()=>n.abort(),r),o=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new at(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Rs){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const o=e.toLocaleLowerCase(),{close:l,error:a,leave:c,join:u}=z;if(r&&[l,a,c,u].indexOf(o)>=0&&r!==this._joinRef())return;let g=this._onMessage(o,t,r);if(t&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(v=>{var _,S,w;return((_=v.filter)===null||_===void 0?void 0:_.event)==="*"||((w=(S=v.filter)===null||S===void 0?void 0:S.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(v=>v.callback(g,r)):(i=this.bindings[o])===null||i===void 0||i.filter(v=>{var _,S,w,b,y,m;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in v){const p=v.id,T=(_=v.filter)===null||_===void 0?void 0:_.event;return p&&((S=t.ids)===null||S===void 0?void 0:S.includes(p))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const p=(y=(b=v==null?void 0:v.filter)===null||b===void 0?void 0:b.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return p==="*"||p===((m=t==null?void 0:t.event)===null||m===void 0?void 0:m.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===o}).map(v=>{if(typeof g=="object"&&"ids"in g){const _=g.data,{schema:S,table:w,commit_timestamp:b,type:y,errors:m}=_;g=Object.assign(Object.assign({},{schema:S,table:w,commit_timestamp:b,eventType:y,new:{},old:{},errors:m}),this._getPayloadRecords(_))}v.callback(g,r)})}_isClosed(){return this.state===$.closed}_isJoined(){return this.state===$.joined}_isJoining(){return this.state===$.joining}_isLeaving(){return this.state===$.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Nt.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(z.close,{},e)}_onError(e){this._on(z.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=$.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Qt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Qt(e.columns,e.old_record)),t}}const lt=()=>{},Ge={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Bs=[1e3,2e3,5e3,1e4],qs=1e4,zs=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Vs{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=wt,this.transport=null,this.heartbeatIntervalMs=Ge.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=lt,this.ref=0,this.reconnectTimer=null,this.logger=lt,this.conn=null,this.sendBuffer=[],this.serializer=new $s,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let i;return n?i=n:typeof fetch=="undefined"?i=(...o)=>te(()=>f(this,null,function*(){const{default:l}=yield Promise.resolve().then(()=>Oe);return{default:l}}),void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${bt.websocket}`,this.httpEndpoint=Mr(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Cs.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:As}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t!=null?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return f(this,null,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return f(this,null,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ne.connecting:return de.Connecting;case Ne.open:return de.Open;case Ne.closing:return de.Closing;default:return de.Closed}}isConnected(){return this.connectionState()===de.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===r);if(n)return n;{const i=new Nt(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:n,ref:i}=e,o=()=>{this.encode(e,l=>{var a;(a=this.conn)===null||a===void 0||a.send(l)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e=null){return f(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return f(this,null,function*(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Is,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ge.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:i,ref:o}=t,l=o?`(${o})`:"",a=i.status||"";this.log("receive",`${a} ${r} ${n} ${l}`.trim(),i),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(z.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([zs],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}_performAuth(e=null){return f(this,null,function*(){let t;e?t=e:this.accessToken?t=yield this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:Os};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(z.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return f(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Dr(()=>f(this,null,function*(){setTimeout(()=>f(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),Ge.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,i,o,l,a,c,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:wt,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:Ge.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:lt,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(a=e==null?void 0:e.reconnectAfterMs)!==null&&a!==void 0?a:(h=>Bs[h-1]||qs),this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:((h,g)=>g(JSON.stringify(h))),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window!="undefined"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Dt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function L(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class Hs extends Dt{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class kt extends Dt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ws=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};const Fr=s=>{let e;return s?e=s:typeof fetch=="undefined"?e=(...t)=>te(()=>f(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>Oe);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Gs=()=>Ws(void 0,void 0,void 0,function*(){return typeof Response=="undefined"?(yield te(()=>Promise.resolve().then(()=>Oe),void 0)).Response:Response}),xt=s=>{if(Array.isArray(s))return s.map(t=>xt(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=xt(r)}),e},Ks=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)};var he=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};const ct=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Js=(s,e,t)=>he(void 0,void 0,void 0,function*(){const r=yield Gs();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{const i=s.status||500,o=(n==null?void 0:n.statusCode)||i+"";e(new Hs(ct(n),i,o))}).catch(n=>{e(new kt(ct(n),n))}):e(new kt(ct(s),s))}),Ys=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"||!r?n:(Ks(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r)):n.body=r,e!=null&&e.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function ze(s,e,t,r,n,i){return he(this,void 0,void 0,function*(){return new Promise((o,l)=>{s(t,Ys(e,r,n,i)).then(a=>{if(!a.ok)throw a;return r!=null&&r.noResolveJson?a:a.json()}).then(a=>o(a)).catch(a=>Js(a,l,r))})})}function st(s,e,t,r){return he(this,void 0,void 0,function*(){return ze(s,"GET",e,t,r)})}function H(s,e,t,r,n){return he(this,void 0,void 0,function*(){return ze(s,"POST",e,r,n,t)})}function Tt(s,e,t,r,n){return he(this,void 0,void 0,function*(){return ze(s,"PUT",e,r,n,t)})}function Zs(s,e,t,r){return he(this,void 0,void 0,function*(){return ze(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Br(s,e,t,r,n){return he(this,void 0,void 0,function*(){return ze(s,"DELETE",e,r,n,t)})}var U=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};const Qs={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},tr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Xs{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Fr(n)}uploadOrUpdate(e,t,r,n){return U(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},tr),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const a=o.metadata;typeof Blob!="undefined"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,a&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield(e=="PUT"?Tt:H)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(L(i))return{data:null,error:i};throw i}})}upload(e,t,r){return U(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return U(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let a;const c=Object.assign({upsert:tr.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob!="undefined"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",c.cacheControl),a.append("",r)):typeof FormData!="undefined"&&r instanceof FormData?(a=r,a.append("cacheControl",c.cacheControl)):(a=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield Tt(this.fetch,l.toString(),a,{headers:u});return{data:{path:i,fullPath:h.Key},error:null}}catch(a){if(L(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return U(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield H(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new Dt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(r){if(L(r))return{data:null,error:r};throw r}})}update(e,t,r){return U(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return U(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}copy(e,t,r){return U(this,void 0,void 0,function*(){try{return{data:{path:(yield H(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return U(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield H(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return U(this,void 0,void 0,function*(){try{const n=yield H(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}download(e,t){return U(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)!="undefined"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield st(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(L(l))return{data:null,error:l};throw l}})}info(e){return U(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield st(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:xt(r),error:null}}catch(r){if(L(r))return{data:null,error:r};throw r}})}exists(e){return U(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Zs(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(L(r)&&r instanceof kt){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const l=typeof(t==null?void 0:t.transform)!="undefined"?"render/image":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});a!==""&&n.push(a);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${c}`)}}}remove(e){return U(this,void 0,void 0,function*(){try{return{data:yield Br(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}list(e,t,r){return U(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Qs),t),{prefix:e||""});return{data:yield H(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}listV2(e,t){return U(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield H(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(L(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer!="undefined"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const en="2.11.1",tn={"X-Client-Info":`storage-js/${en}`};var _e=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};class rn{constructor(e,t={},r,n){const i=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},tn),t),this.fetch=Fr(r)}listBuckets(){return _e(this,void 0,void 0,function*(){try{return{data:yield st(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(L(e))return{data:null,error:e};throw e}})}getBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield st(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return _e(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(L(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return _e(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(L(r))return{data:null,error:r};throw r}})}emptyBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield Br(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}}class sn extends rn{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new Xs(this.url,this.headers,e,this.fetch)}}const nn="2.57.2";let $e="";typeof Deno!="undefined"?$e="deno":typeof document!="undefined"?$e="web":typeof navigator!="undefined"&&navigator.product==="ReactNative"?$e="react-native":$e="node";const on={"X-Client-Info":`supabase-js-${$e}/${nn}`},an={headers:on},ln={schema:"public"},cn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},un={};var dn=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};const hn=s=>{let e;return s?e=s:typeof fetch=="undefined"?e=Ar:e=fetch,(...t)=>e(...t)},fn=()=>typeof Headers=="undefined"?Ir:Headers,gn=(s,e,t)=>{const r=hn(t),n=fn();return(i,o)=>dn(void 0,void 0,void 0,function*(){var l;const a=(l=yield e())!==null&&l!==void 0?l:s;let c=new n(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",s),c.has("Authorization")||c.set("Authorization",`Bearer ${a}`),r(i,Object.assign(Object.assign({},o),{headers:c}))})};var pn=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};function mn(s){return s.endsWith("/")?s:s+"/"}function vn(s,e){var t,r;const{db:n,auth:i,realtime:o,global:l}=s,{db:a,auth:c,realtime:u,global:h}=e,g={db:Object.assign(Object.assign({},a),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>pn(this,void 0,void 0,function*(){return""})};return s.accessToken?g.accessToken=s.accessToken:delete g.accessToken,g}const qr="2.71.1",xe=30*1e3,Et=3,ut=Et*xe,_n="http://localhost:9999",yn="supabase.auth.token",wn={"X-Client-Info":`gotrue-js/${qr}`},jt="X-Supabase-Api-Version",zr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Sn=600*1e3;class Ut extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function x(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class kn extends Ut{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function xn(s){return x(s)&&s.name==="AuthApiError"}class Vr extends Ut{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class re extends Ut{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class X extends re{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Tn(s){return x(s)&&s.name==="AuthSessionMissingError"}class Ke extends re{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Je extends re{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ye extends re{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function En(s){return x(s)&&s.name==="AuthImplicitGrantRedirectError"}class rr extends re{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ct extends re{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function dt(s){return x(s)&&s.name==="AuthRetryableFetchError"}class sr extends re{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Pt extends re{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nr=` 	
\r=`.split(""),jn=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<nr.length;e+=1)s[nr[e].charCodeAt(0)]=-2;for(let e=0;e<nt.length;e+=1)s[nt[e].charCodeAt(0)]=e;return s})();function ir(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(nt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(nt[r]),e.queuedBits-=6}}function Hr(s,e,t){const r=jn[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function or(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{On(o,r,t)};for(let o=0;o<s.length;o+=1)Hr(s.charCodeAt(o),n,i);return e.join("")}function Cn(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Pn(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Cn(r,e)}}function On(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if((s>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function An(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)Hr(s.charCodeAt(n),t,r);return new Uint8Array(e)}function In(s){const e=[];return Pn(s,t=>e.push(t)),new Uint8Array(e)}function Rn(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return s.forEach(n=>ir(n,t,r)),ir(null,t,r),e.join("")}function $n(s){return Math.round(Date.now()/1e3)+s}function Ln(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const q=()=>typeof window!="undefined"&&typeof document!="undefined",ie={tested:!1,writable:!1},Wr=()=>{if(!q())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch(e){return!1}if(ie.tested)return ie.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),ie.tested=!0,ie.writable=!0}catch(e){ie.tested=!0,ie.writable=!1}return ie.writable};function Nn(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch(r){}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Gr=s=>{let e;return s?e=s:typeof fetch=="undefined"?e=(...t)=>te(()=>f(null,null,function*(){const{default:r}=yield Promise.resolve().then(()=>Oe);return{default:r}}),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Dn=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Te=(s,e,t)=>f(null,null,function*(){yield s.setItem(e,JSON.stringify(t))}),oe=(s,e)=>f(null,null,function*(){const t=yield s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(r){return t}}),Z=(s,e)=>f(null,null,function*(){yield s.removeItem(e)});class ot{constructor(){this.promise=new ot.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ot.promiseConstructor=Promise;function ht(s){const e=s.split(".");if(e.length!==3)throw new Pt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!bn.test(e[r]))throw new Pt("JWT not in base64url format");return{header:JSON.parse(or(e[0])),payload:JSON.parse(or(e[1])),signature:An(e[2]),raw:{header:e[0],payload:e[1]}}}function Un(s){return f(this,null,function*(){return yield new Promise(e=>{setTimeout(()=>e(null),s)})})}function Mn(s,e){return new Promise((r,n)=>{f(null,null,function*(){for(let i=0;i<1/0;i++)try{const o=yield s(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){n(o);return}}})})}function Fn(s){return("0"+s.toString(16)).substr(-2)}function Bn(){const e=new Uint32Array(56);if(typeof crypto=="undefined"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,Fn).join("")}function qn(s){return f(this,null,function*(){const t=new TextEncoder().encode(s),r=yield crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")})}function zn(s){return f(this,null,function*(){if(!(typeof crypto!="undefined"&&typeof crypto.subtle!="undefined"&&typeof TextEncoder!="undefined"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=yield qn(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function ye(s,e,t=!1){return f(this,null,function*(){const r=Bn();let n=r;t&&(n+="/PASSWORD_RECOVERY"),yield Te(s,`${e}-code-verifier`,n);const i=yield zn(r);return[i,r===i?"plain":"s256"]})}const Vn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Hn(s){const e=s.headers.get(jt);if(!e||!e.match(Vn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(t){return null}}function Wn(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function Gn(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Kn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function we(s){if(!Kn.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ft(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ar(s){return JSON.parse(JSON.stringify(s))}var Jn=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const ue=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Yn=[502,503,504];function lr(s){return f(this,null,function*(){var e;if(!Dn(s))throw new Ct(ue(s),0);if(Yn.includes(s.status))throw new Ct(ue(s),s.status);let t;try{t=yield s.json()}catch(i){throw new Vr(ue(i),i)}let r;const n=Hn(s);if(n&&n.getTime()>=zr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new sr(ue(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new X}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new sr(ue(t),s.status,t.weak_password.reasons);throw new kn(ue(t),s.status||500,r)})}const Zn=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};function E(s,e,t,r){return f(this,null,function*(){var n;const i=Object.assign({},r==null?void 0:r.headers);i[jt]||(i[jt]=zr["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",a=yield Qn(s,e,t+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(a):{data:Object.assign({},a),error:null}})}function Qn(s,e,t,r,n,i){return f(this,null,function*(){const o=Zn(e,r,n,i);let l;try{l=yield s(t,Object.assign({},o))}catch(a){throw console.error(a),new Ct(ue(a),0)}if(l.ok||(yield lr(l)),r!=null&&r.noResolveJson)return l;try{return yield l.json()}catch(a){yield lr(a)}})}function G(s){var e;let t=null;ri(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=$n(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function cr(s){const e=G(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function ee(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function Xn(s){return{data:s,error:null}}function ei(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,o=Jn(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},a=Object.assign({},o);return{data:{properties:l,user:a},error:null}}function ti(s){return s}function ri(s){return s.access_token&&s.refresh_token&&s.expires_in}const gt=["global","local","others"];var si=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class ni{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Gr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r){return f(this,arguments,function*(e,t=gt[0]){if(gt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${gt.join(", ")}`);try{return yield E(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}inviteUserByEmail(r){return f(this,arguments,function*(e,t={}){try{return yield E(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ee})}catch(n){if(x(n))return{data:{user:null},error:n};throw n}})}generateLink(e){return f(this,null,function*(){try{const{options:t}=e,r=si(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),yield E(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:ei,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(x(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return f(this,null,function*(){try{return yield E(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ee})}catch(t){if(x(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return f(this,null,function*(){var t,r,n,i,o,l,a;try{const c={nextPage:null,lastPage:0,total:0},u=yield E(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:ti});if(u.error)throw u.error;const h=yield u.json(),g=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(a=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&a!==void 0?a:[];return v.length>0&&(v.forEach(_=>{const S=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(_.split(";")[1].split("=")[1]);c[`${w}Page`]=S}),c.total=parseInt(g)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(x(c))return{data:{users:[]},error:c};throw c}})}getUserById(e){return f(this,null,function*(){we(e);try{return yield E(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ee})}catch(t){if(x(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return f(this,null,function*(){we(e);try{return yield E(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ee})}catch(r){if(x(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return f(this,null,function*(){we(e);try{return yield E(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ee})}catch(r){if(x(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return f(this,null,function*(){we(e.userId);try{const{data:t,error:r}=yield E(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(x(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return f(this,null,function*(){we(e.userId),we(e.id);try{return{data:yield E(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}}function ur(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function ii(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(s){typeof self!="undefined"&&(self.globalThis=self)}}const be={debug:!!(globalThis&&Wr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Kr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class oi extends Kr{}function ai(s,e,t){return f(this,null,function*(){be.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),be.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},n=>f(null,null,function*(){if(n){be.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return yield t()}finally{be.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw be.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new oi(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(be.debug)try{const i=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield t()}})))})}ii();const li={url:_n,storageKey:yn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:wn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function dr(s,e,t){return f(this,null,function*(){return yield t()})}const Se={};class qe{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=qe.nextInstanceID,qe.nextInstanceID+=1,this.instanceID>0&&q()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},li),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new ni({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Gr(n.fetch),this.lock=n.lock||dr,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:q()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ai:this.lock=dr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Wr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ur(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=ur(this.memoryStorage)),q()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",i=>f(this,null,function*(){this._debug("received broadcast notification from other tab or client",i),yield this._notifyAllSubscribers(i.data.event,i.data.session,!1)}))}this.initialize()}get jwks(){var e,t;return(t=(e=Se[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Se[this.storageKey]=Object.assign(Object.assign({},Se[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Se[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Se[this.storageKey]=Object.assign(Object.assign({},Se[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${qr}) ${new Date().toISOString()}`,...e),this}initialize(){return f(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=f(this,null,function*(){return yield this._acquireLock(-1,()=>f(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return f(this,null,function*(){var e;try{const t=Nn(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":(yield this._isPKCECallback(t))&&(r="pkce"),q()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=yield this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),En(i)){const a=(e=i.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:i}}return yield this._removeSession(),{error:i}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),yield this._saveSession(o),setTimeout(()=>f(this,null,function*(){l==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",o):yield this._notifyAllSubscribers("SIGNED_IN",o)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return x(t)?{error:t}:{error:new Vr("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return f(this,null,function*(){var t,r,n;try{const i=yield E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:G}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const a=o.session,c=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(i){if(x(i))return{data:{user:null,session:null},error:i};throw i}})}signUp(e){return f(this,null,function*(){var t,r,n;try{let i;if("email"in e){const{email:u,password:h,options:g}=e;let v=null,_=null;this.flowType==="pkce"&&([v,_]=yield ye(this.storage,this.storageKey)),i=yield E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:u,password:h,data:(t=g==null?void 0:g.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:v,code_challenge_method:_},xform:G})}else if("phone"in e){const{phone:u,password:h,options:g}=e;i=yield E(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},channel:(n=g==null?void 0:g.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:G})}else throw new Je("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const a=o.session,c=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(i){if(x(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(e){return f(this,null,function*(){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=yield E(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:cr})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=yield E(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:cr})}else throw new Je("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ke}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return f(this,null,function*(){var t,r,n,i;return yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})})}exchangeCodeForSession(e){return f(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>f(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return f(this,null,function*(){const{chain:t}=e;if(t==="solana")return yield this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)})}signInWithSolana(e){return f(this,null,function*(){var t,r,n,i,o,l,a,c,u,h,g,v;let _,S;if("message"in e)_=e.message,S=e.signature;else{const{chain:w,wallet:b,statement:y,options:m}=e;let p;if(q())if(typeof b=="object")p=b;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))p=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(m!=null&&m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");p=b}const T=new URL((t=m==null?void 0:m.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in p&&p.signIn){const k=yield p.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},m==null?void 0:m.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),y?{statement:y}:null));let P;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")P=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)P=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)_=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),S=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in p)||typeof p.signMessage!="function"||!("publicKey"in p)||typeof p!="object"||!p.publicKey||!("toBase58"in p.publicKey)||typeof p.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${T.host} wants you to sign in with your Solana account:`,p.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${T.href}`,`Issued At: ${(n=(r=m==null?void 0:m.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=m==null?void 0:m.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...!((o=m==null?void 0:m.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...!((l=m==null?void 0:m.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...!((a=m==null?void 0:m.signInWithSolana)===null||a===void 0)&&a.nonce?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...!((c=m==null?void 0:m.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...!((h=(u=m==null?void 0:m.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...m.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const k=yield p.signMessage(new TextEncoder().encode(_),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");S=k}}try{const{data:w,error:b}=yield E(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:Rn(S)},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:G});if(b)throw b;return!w||!w.session||!w.user?{data:{user:null,session:null},error:new Ke}:(w.session&&(yield this._saveSession(w.session),yield this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:Object.assign({},w),error:b})}catch(w){if(x(w))return{data:{user:null,session:null},error:w};throw w}})}_exchangeCodeForSession(e){return f(this,null,function*(){const t=yield oe(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t!=null?t:"").split("/");try{const{data:i,error:o}=yield E(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:G});if(yield Z(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ke}:(i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n!=null?n:null}),error:o})}catch(i){if(x(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}})}signInWithIdToken(e){return f(this,null,function*(){try{const{options:t,provider:r,token:n,access_token:i,nonce:o}=e,l=yield E(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:G}),{data:a,error:c}=l;return c?{data:{user:null,session:null},error:c}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Ke}:(a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:c})}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return f(this,null,function*(){var t,r,n,i,o;try{if("email"in e){const{email:l,options:a}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=yield ye(this.storage,this.storageKey));const{error:h}=yield E(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(r=a==null?void 0:a.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:a}=e,{data:c,error:u}=yield E(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=a==null?void 0:a.data)!==null&&n!==void 0?n:{},create_user:(i=a==null?void 0:a.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(o=a==null?void 0:a.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Je("You must provide either an email or phone number.")}catch(l){if(x(l))return{data:{user:null,session:null},error:l};throw l}})}verifyOtp(e){return f(this,null,function*(){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=yield E(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:G});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const a=o.session,c=o.user;return a!=null&&a.access_token&&(yield this._saveSession(a),yield this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(n){if(x(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithSSO(e){return f(this,null,function*(){var t,r,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=yield ye(this.storage,this.storageKey)),yield E(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Xn})}catch(i){if(x(i))return{data:null,error:i};throw i}})}reauthenticate(){return f(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return f(this,null,function*(){try{return yield this._useSession(e=>f(this,null,function*(){const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new X;const{error:n}=yield E(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}}))}catch(e){if(x(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return f(this,null,function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:o}=yield E(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:o,error:l}=yield E(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Je("You must provide either an email or phone number and a type")}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return f(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){return this._useSession(t=>f(this,null,function*(){return t}))}))})}_acquireLock(e,t){return f(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=f(this,null,function*(){return yield r,yield t()});return this.pendingInLock.push(f(this,null,function*(){try{yield n}catch(i){}})),n}return yield this.lock(`lock:${this.storageKey}`,e,()=>f(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push(f(this,null,function*(){try{yield r}catch(n){}})),yield r;this.pendingInLock.length;){const n=[...this.pendingInLock];yield Promise.all(n),this.pendingInLock.splice(0,n.length)}return yield r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return f(this,null,function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}})}__loadSession(){return f(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=yield oe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ut:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=yield oe(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=ft()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(a,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,c,u))})}return{data:{session:e},error:null}}const{session:n,error:i}=yield this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return f(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return f(this,null,function*(){try{return e?yield E(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ee}):yield this._useSession(t=>f(this,null,function*(){var r,n,i;const{data:o,error:l}=t;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new X}:yield E(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:ee})}))}catch(t){if(x(t))return Tn(t)&&(yield this._removeSession(),yield Z(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}})}updateUser(r){return f(this,arguments,function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){return yield this._updateUser(e,t)}))})}_updateUser(r){return f(this,arguments,function*(e,t={}){try{return yield this._useSession(n=>f(this,null,function*(){const{data:i,error:o}=n;if(o)throw o;if(!i.session)throw new X;const l=i.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=yield ye(this.storage,this.storageKey));const{data:u,error:h}=yield E(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:l.access_token,xform:ee});if(h)throw h;return l.user=u.user,yield this._saveSession(l),yield this._notifyAllSubscribers("USER_UPDATED",l),{data:{user:l.user},error:null}}))}catch(n){if(x(n))return{data:{user:null},error:n};throw n}})}setSession(e){return f(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return f(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new X;const t=Date.now()/1e3;let r=t,n=!0,i=null;const{payload:o}=ht(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{session:l,error:a}=yield this._callRefreshToken(e.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:a}=yield this._getUser(e.access_token);if(a)throw a;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(x(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return f(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return f(this,null,function*(){try{return yield this._useSession(t=>f(this,null,function*(){var r;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new X;const{session:n,error:i}=yield this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromURL(e,t){return f(this,null,function*(){try{if(!q())throw new Ye("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ye(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new rr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ye("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new rr("No code detected.");const{data:y,error:m}=yield this._exchangeCodeForSession(e.code);if(m)throw m;const p=new URL(window.location.href);return p.searchParams.delete("code"),window.history.replaceState(window.history.state,"",p.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:l,expires_at:a,token_type:c}=e;if(!i||!l||!o||!c)throw new Ye("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let g=u+h;a&&(g=parseInt(a));const v=g-u;v*1e3<=xe&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${h}s`);const _=g-h;u-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,g,u):u-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,g,u);const{data:S,error:w}=yield this._getUser(i);if(w)throw w;const b={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:g,refresh_token:o,token_type:c,user:S.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(r){if(x(r))return{data:{session:null,redirectType:null},error:r};throw r}})}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}_isPKCECallback(e){return f(this,null,function*(){const t=yield oe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)})}signOut(){return f(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return f(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>f(this,null,function*(){var r;const{data:n,error:i}=t;if(i)return{error:i};const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=yield this.admin.signOut(o,e);if(l&&!(xn(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(yield this._removeSession(),yield Z(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){const t=Ln(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),f(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){this._emitInitialSession(t)}))}),{data:{subscription:r}}}_emitInitialSession(e){return f(this,null,function*(){return yield this._useSession(t=>f(this,null,function*(){var r,n;try{const{data:{session:i},error:o}=t;if(o)throw o;yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){yield(n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}}))})}resetPasswordForEmail(r){return f(this,arguments,function*(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=yield ye(this.storage,this.storageKey,!0));try{return yield E(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(x(o))return{data:null,error:o};throw o}})}getUserIdentities(){return f(this,null,function*(){var e;try{const{data:t,error:r}=yield this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}linkIdentity(e){return f(this,null,function*(){var t;try{const{data:r,error:n}=yield this._useSession(i=>f(this,null,function*(){var o,l,a,c,u;const{data:h,error:g}=i;if(g)throw g;const v=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return yield E(this.fetch,"GET",v,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})}));if(n)throw n;return q()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(x(r))return{data:{provider:e.provider,url:null},error:r};throw r}})}unlinkIdentity(e){return f(this,null,function*(){try{return yield this._useSession(t=>f(this,null,function*(){var r,n;const{data:i,error:o}=t;if(o)throw o;return yield E(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})}))}catch(t){if(x(t))return{data:null,error:t};throw t}})}_refreshAccessToken(e){return f(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield Mn(n=>f(this,null,function*(){return n>0&&(yield Un(200*Math.pow(2,n-1))),this._debug(t,"refreshing attempt",n),yield E(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:G})}),(n,i)=>{const o=200*Math.pow(2,n);return i&&dt(i)&&Date.now()+o-r<xe})}catch(r){if(this._debug(t,"error",r),x(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return f(this,null,function*(){const r=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),q()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){return f(this,null,function*(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=yield oe(this.storage,this.storageKey);if(n&&this.userStorage){let o=yield oe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},yield Te(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:ft()}else if(n&&!n.user&&!n.user){const o=yield oe(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,yield Z(this.storage,this.storageKey+"-user"),yield Te(this.storage,this.storageKey,n)):n.user=ft()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&(yield this._removeSession());return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ut;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${ut}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=yield this._callRefreshToken(n.refresh_token);o&&(console.error(o),dt(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=yield this._getUser(n.access_token);!l&&(o!=null&&o.user)?(n.user=o.user,yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else yield this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}})}_callRefreshToken(e){return f(this,null,function*(){var t,r;if(!e)throw new X;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new ot;const{data:i,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new X;yield this._saveSession(i.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),x(i)){const o={session:null,error:i};return dt(i)||(yield this._removeSession()),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}})}_notifyAllSubscribers(e,t,r=!0){return f(this,null,function*(){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(l=>f(this,null,function*(){try{yield l.callback(e,t)}catch(a){i.push(a)}}));if(yield Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}})}_saveSession(e){return f(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&(yield Te(this.userStorage,this.storageKey+"-user",{user:t.user}));const n=Object.assign({},t);delete n.user;const i=ar(n);yield Te(this.storage,this.storageKey,i)}else{const n=ar(t);yield Te(this.storage,this.storageKey,n)}})}_removeSession(){return f(this,null,function*(){this._debug("#_removeSession()"),yield Z(this.storage,this.storageKey),yield Z(this.storage,this.storageKey+"-code-verifier"),yield Z(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Z(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&q()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return f(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),xe);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno!="undefined"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(()=>f(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return f(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return f(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return f(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return f(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>f(this,null,function*(){try{const e=Date.now();try{return yield this._useSession(t=>f(this,null,function*(){const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/xe);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${xe}ms, refresh threshold is ${Et} ticks`),n<=Et&&(yield this._callRefreshToken(r.refresh_token))}))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(e.isAcquireTimeout||e instanceof Kr)this._debug("auto refresh token tick lock not available");else throw e}})}_handleVisibilityChange(){return f(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!q()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>f(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return f(this,null,function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>f(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t,r){return f(this,null,function*(){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=yield ye(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`})}_unenroll(e){return f(this,null,function*(){try{return yield this._useSession(t=>f(this,null,function*(){var r;const{data:n,error:i}=t;return i?{data:null,error:i}:yield E(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(x(t))return{data:null,error:t};throw t}})}_enroll(e){return f(this,null,function*(){try{return yield this._useSession(t=>f(this,null,function*(){var r,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:c}=yield E(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((n=a==null?void 0:a.totp)===null||n===void 0)&&n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(t){if(x(t))return{data:null,error:t};throw t}})}_verify(e){return f(this,null,function*(){return this._acquireLock(-1,()=>f(this,null,function*(){try{return yield this._useSession(t=>f(this,null,function*(){var r;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:l}=yield E(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})}))}catch(t){if(x(t))return{data:null,error:t};throw t}}))})}_challenge(e){return f(this,null,function*(){return this._acquireLock(-1,()=>f(this,null,function*(){try{return yield this._useSession(t=>f(this,null,function*(){var r;const{data:n,error:i}=t;return i?{data:null,error:i}:yield E(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})}))}catch(t){if(x(t))return{data:null,error:t};throw t}}))})}_challengeAndVerify(e){return f(this,null,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return f(this,null,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}})}_getAuthenticatorAssuranceLevel(){return f(this,null,function*(){return this._acquireLock(-1,()=>f(this,null,function*(){return yield this._useSession(e=>f(this,null,function*(){var t,r;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=ht(n.access_token);let l=null;o.aal&&(l=o.aal);let a=l;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const u=o.amr||[];return{data:{currentLevel:l,nextLevel:a,currentAuthenticationMethods:u},error:null}}))}))})}fetchJwk(r){return f(this,arguments,function*(e,t={keys:[]}){let n=t.keys.find(a=>a.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+Sn>i)return n;const{data:o,error:l}=yield E(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(l)throw l;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=i,n=o.keys.find(a=>a.kid===e),!n)?null:n})}getClaims(r){return f(this,arguments,function*(e,t={}){try{let n=e;if(!n){const{data:_,error:S}=yield this.getSession();if(S||!_.session)return{data:null,error:S};n=_.session.access_token}const{header:i,payload:o,signature:l,raw:{header:a,payload:c}}=ht(n);t!=null&&t.allowExpired||Wn(o.exp);const u=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:yield this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:_}=yield this.getUser(n);if(_)throw _;return{data:{claims:o,header:i,signature:l},error:null}}const h=Gn(i.alg),g=yield crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!(yield crypto.subtle.verify(h,g,l,In(`${a}.${c}`))))throw new Pt("Invalid JWT signature");return{data:{claims:o,header:i,signature:l},error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}}qe.nextInstanceID=0;const ci=qe;class ui extends ci{constructor(e){super(e)}}var di=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(u){try{c(r.next(u))}catch(h){o(h)}}function a(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(l,a)}c((r=r.apply(s,e||[])).next())})};class hi{constructor(e,t,r){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=mn(e),a=new URL(l);this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const c=`sb-${a.hostname.split(".")[0]}-auth-token`,u={db:ln,realtime:un,auth:Object.assign(Object.assign({},cn),{storageKey:c}),global:an},h=vn(r!=null?r:{},u);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(g,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=gn(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new js(new URL("rest/v1",a).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new sn(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new vs(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return di(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:i,storageKey:o,flowType:l,lock:a,debug:c},u,h){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ui({url:this.authUrl.href,headers:Object.assign(Object.assign({},g),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:i,flowType:l,lock:a,debug:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Vs(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const fi=(s,e,t)=>new hi(s,e,t);function gi(){if(typeof window!="undefined"||typeof process=="undefined")return!1;const s=process.version;if(s==null)return!1;const e=s.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}gi()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const pi="",mi="";console.debug=()=>{},console.info=()=>{},console.warn=()=>{};const A=fi(pi,mi,{auth:{persistSession:!0,autoRefreshToken:!0}}),vi=s=>(s?console.info(` Using facility scope: ${s}`):console.warn(" Missing facilityId  using default Supabase client"),A),_i=Object.freeze(Object.defineProperty({__proto__:null,getScopedClient:vi,supabase:A},Symbol.toStringTag,{value:"Module"})),Ot={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},yi=()=>"INFO";let At=yi();const V=s=>Ot[s]<=Ot[At],I={error:(s,...e)=>{V("ERROR")&&console.error(s,...e)},warn:(s,...e)=>{V("WARN")&&console.warn(s,...e)},info:(s,...e)=>{V("INFO")&&console.info(s,...e)},debug:(s,...e)=>{V("DEBUG")&&console.log(s,...e)},verbose:(s,...e)=>{V("VERBOSE")&&console.log(s,...e)},perf:(s,...e)=>{V("DEBUG")&&console.log(`[PERF] ${s}`,...e)},security:(s,...e)=>{V("INFO")&&console.log(`[SECURITY] ${s}`,...e)},audit:(s,...e)=>{V("INFO")&&console.log(`[AUDIT] ${s}`,...e)},realtime:(s,...e)=>{V("DEBUG")&&console.log(s,...e)},getLevel:()=>At,setLevel:s=>{Ot[s]!==void 0&&(At=s,console.log(` Logger level changed to: ${s}`))},isEnabled:s=>V(s)};var tt={};const Ee=(s,e="")=>{if(typeof process!="undefined"&&(process!=null&&tt)&&s in tt)return tt[s];if(typeof window!="undefined"&&window.env&&s in window.env)return window.env[s];if(e===void 0)throw new Error(`Missing required env var: ${s}`);return e},Me=()=>{var s;return typeof process!="undefined"&&((s=process==null?void 0:tt)==null?void 0:s.NODE_ENV)==="development"},$o=()=>typeof window!="undefined";class je{constructor(){}static getInstance(){return je.instance||(je.instance=new je),je.instance}getDefaultFacilityId(){const e=Ee("VITE_DEFAULT_FACILITY_ID","");if(e)return e;throw new Error("VITE_DEFAULT_FACILITY_ID environment variable must be set in production")}isValidFacilityId(e){return!e||e.trim()===""?!1:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}getOAuthFacilityConfig(){return{facility_id:this.getDefaultFacilityId()}}}const wi=je.getInstance();var pt=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const Jr=j.createContext(void 0),Lo=({children:s})=>{const[e,t]=j.useState(null),[r,n]=j.useState(!1),[i,o]=j.useState(!1),[l,a]=j.useState(!1),[c,u]=j.useState(0),h=1800*1e3,g=()=>e?!e.name||e.name.trim()===""?e.email||"Unknown User":e.name:"Unknown User",v=b=>{console.log(" UserContext: handleSetCurrentUser called with:",b?`${b.name} (${b.email})`:"null"),t(b),b?(localStorage.setItem("currentUser",JSON.stringify(b)),u(Date.now())):(localStorage.removeItem("currentUser"),u(0))},_=j.useCallback(()=>pt(null,null,function*(){if(r)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log(" UserContext: No auth token found, skipping refreshUserData");return}console.log(" UserContext: Starting refreshUserData...");const y=Date.now();if(e&&y-c<h){I.info(" UserContext: Using cached user data"),a(!0);return}try{n(!0),I.info(" UserContext: Starting user data refresh...");const{data:{session:m}}=yield A.auth.getSession();if(!m){I.info(" UserContext: No active Supabase session, skipping refresh"),a(!0);return}const p=new Promise((k,P)=>{setTimeout(()=>P(new Error("User data fetch timeout")),5e3)}),T=pt(null,null,function*(){var k,P;const M=Date.now(),{data:{user:R},error:se}=yield A.auth.getUser();if(se){console.error(" UserContext: Auth error:",se);return}if(!R){I.info(" UserContext: No authenticated user found");return}I.info(" UserContext: Found authenticated user:",R.id);const Y=Date.now()-M;I.info(` UserContext: Auth fetch took ${Y}ms`);const Ae=Date.now(),{data:D,error:ne}=yield A.from("users").select("*").eq("id",R.id).single();if(ne){if(console.error(" UserContext: Failed to fetch user profile:",ne),ne.code==="PGRST116"){console.log(" UserContext: Creating missing user profile...");const{error:Ie}=yield A.from("users").insert({id:R.id,email:R.email,first_name:R.email.split("@")[0],last_name:"",role:"user",facility_id:wi.getDefaultFacilityId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(Ie){console.error(" UserContext: Failed to create user profile:",Ie);return}console.log(" UserContext: User profile created successfully");const{data:B}=yield A.from("users").select("*").eq("id",R.id).single();if(B){const He={id:B.id,name:`${B.first_name||""} ${B.last_name||""}`.trim()||((k=B.email)==null?void 0:k.split("@")[0])||"User",email:B.email,role:B.role,avatar_url:B.avatar_url,facility_id:B.facility_id};v(He);return}}return}const Ft=Date.now()-Ae;if(I.info(` UserContext: Profile fetch took ${Ft}ms`),I.info(` UserContext: Total fetch time: ${Date.now()-M}ms`),D){const Ie={id:D.id,name:`${D.first_name||""} ${D.last_name||""}`.trim()||((P=D.email)==null?void 0:P.split("@")[0])||"User",email:D.email,role:D.role,avatar_url:D.avatar_url,facility_id:D.facility_id},B={admin:"Administrator",manager:"Manager",user:"User",viewer:"Viewer"},He=typeof D.role=="string"?D.role:"user";Ie.role=B[He]||He,t(Ie),u(y)}});yield Promise.race([T,p])}catch(m){m instanceof Error&&m.message.includes("timeout")&&I.warn(" UserContext: User data fetch timed out, this may indicate database performance issues"),console.error(" UserContext: Error refreshing user data:",m)}finally{n(!1),a(!0)}}),[r,e,c,h]),S=j.useCallback(()=>{console.log(" UserContext: Starting clearUserData..."),I.info(" UserContext: Clearing all user data on logout"),t(null),o(!1),a(!1),u(0),n(!1),["currentUser","userProfile","userData","user_preferences","sb-user","user_data"].forEach(m=>{const p=localStorage.getItem(m);p&&(console.log(` Clearing localStorage.${m}:`,p.substring(0,100)+"..."),localStorage.removeItem(m))}),["currentUser","userProfile","userData","user_preferences","user_id","user_email","user_role"].forEach(m=>{const p=sessionStorage.getItem(m);p&&(console.log(` Clearing sessionStorage.${m}:`,p.substring(0,100)+"..."),sessionStorage.removeItem(m))}),console.log(" UserContext: clearUserData completed"),I.info(" UserContext: All user data cleared successfully")},[]),w=j.useCallback(()=>pt(null,null,function*(){if(i||r)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log(" UserContext: No auth token found, skipping initializeUserContext");return}I.info(" UserContext: Starting user data refresh..."),yield _(),o(!0)}),[i,r,_]);return d.jsx(Jr.Provider,{value:{currentUser:e,setCurrentUser:v,getUserDisplayName:g,refreshUserData:_,initializeUserContext:w,clearUserData:S,isLoading:r},children:s})},bi=()=>{const s=j.useContext(Jr);if(!s)throw new Error("useUser must be used within a UserProvider");return s};var Ce=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});function Si(){return Ce(this,null,function*(){var s,e,t,r;try{const{data:{user:n},error:i}=yield A.auth.getUser();return{userId:(s=n==null?void 0:n.id)!=null?s:null,facilityId:(t=(e=n==null?void 0:n.user_metadata)==null?void 0:e.facility_id)!=null?t:null,authError:(r=i==null?void 0:i.message)!=null?r:null}}catch(n){return{userId:null,facilityId:null,authError:"context_fetch_failed"}}})}function Ze(s,e,t,r){return Ce(this,null,function*(){try{const n=yield Si(),i={type:s,severity:e,message:t,user_id:n.userId,facility_id:n.facilityId,context:r!=null?r:null,created_at:new Date().toISOString()},{error:o}=yield A.from("app_events").insert([i]);return o?((Ee("NODE_ENV")==="development"||Ee("MODE")==="development")&&console.warn(" observabilityService: insert failed (likely missing table)",o.message),{success:!1,error:o.message}):{success:!0}}catch(n){return(Ee("NODE_ENV")==="development"||Ee("MODE")==="development")&&console.warn(" observabilityService: unexpected error",n instanceof Error?n.message:String(n)),{success:!1,error:String(n)}}})}const ki={logSecurityEvent(s,e,t){return Ce(this,null,function*(){return Ze(s,"warning",e,t)})},logCritical(s,e){return Ce(this,null,function*(){return Ze("app.error","critical",s,e)})},logError(s,e){return Ce(this,null,function*(){return Ze("app.error","error",s,e)})},logInfo(s,e,t){return Ce(this,null,function*(){return Ze(s,"info",e,t)})}};var xi=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});class Ti extends Bt.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){return xi(this,null,function*(){console.error(" Global Error Boundary caught:",e,t),this.props.onError&&this.props.onError(e,t),yield ki.logCritical("Global React component crash",{error:e.message,stack:e.stack,componentStack:t.componentStack})})}render(){if(this.state.hasError){if(this.props.fallback){if(Bt.isValidElement(this.props.fallback))return this.props.fallback;{const e=this.props.fallback;return d.jsx(e,{error:this.state.error,errorInfo:void 0})}}return d.jsxs("div",{className:"p-6 text-center text-red-700 bg-red-50 rounded-xl",children:[d.jsx("h2",{className:"font-semibold mb-2",children:"Something went wrong."}),d.jsx("p",{className:"text-sm opacity-75",children:"The team has been notified and is investigating."})]})}return this.props.children}}function No(s){return C({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"},child:[]}]})(s)}function Do(s){return C({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M425.7 256c-16.9 0-32.8-9-41.4-23.4L320 126l-64.2 106.6c-8.7 14.5-24.6 23.5-41.5 23.5-4.5 0-9-.6-13.3-1.9L64 215v178c0 14.7 10 27.5 24.2 31l216.2 54.1c10.2 2.5 20.9 2.5 31 0L551.8 424c14.2-3.6 24.2-16.4 24.2-31V215l-137 39.1c-4.3 1.3-8.8 1.9-13.3 1.9zm212.6-112.2L586.8 41c-3.1-6.2-9.8-9.8-16.7-8.9L320 64l91.7 152.1c3.8 6.3 11.4 9.3 18.5 7.3l197.9-56.5c9.9-2.9 14.7-13.9 10.2-23.1zM53.2 41L1.7 143.8c-4.6 9.2.3 20.2 10.1 23l197.9 56.5c7.1 2 14.7-1 18.5-7.3L320 64 69.8 32.1c-6.9-.8-13.5 2.7-16.6 8.9z"},child:[]}]})(s)}function Uo(s){return C({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M256.47 216.77l86.73 109.18s-16.6 102.36-76.57 150.12C206.66 523.85 0 510.19 0 510.19s3.8-23.14 11-55.43l94.62-112.17c3.97-4.7-.87-11.62-6.65-9.5l-60.4 22.09c14.44-41.66 32.72-80.04 54.6-97.47 59.97-47.76 163.3-40.94 163.3-40.94zM636.53 31.03l-19.86-25c-5.49-6.9-15.52-8.05-22.41-2.56l-232.48 177.8-34.14-42.97c-5.09-6.41-15.14-5.21-18.59 2.21l-25.33 54.55 86.73 109.18 58.8-12.45c8-1.69 11.42-11.2 6.34-17.6l-34.09-42.92 232.48-177.8c6.89-5.48 8.04-15.53 2.55-22.44z"},child:[]}]})(s)}function Mo(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M511.988 288.9c-.478 17.43-15.217 31.1-32.653 31.1H424v16c0 21.864-4.882 42.584-13.6 61.145l60.228 60.228c12.496 12.497 12.496 32.758 0 45.255-12.498 12.497-32.759 12.496-45.256 0l-54.736-54.736C345.886 467.965 314.351 480 280 480V236c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v244c-34.351 0-65.886-12.035-90.636-32.108l-54.736 54.736c-12.498 12.497-32.759 12.496-45.256 0-12.496-12.497-12.496-32.758 0-45.255l60.228-60.228C92.882 378.584 88 357.864 88 336v-16H32.666C15.23 320 .491 306.33.013 288.9-.484 270.816 14.028 256 32 256h56v-58.745l-46.628-46.628c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0L141.255 160h229.489l54.627-54.627c12.498-12.497 32.758-12.497 45.256 0 12.496 12.497 12.496 32.758 0 45.255L424 197.255V256h56c17.972 0 32.484 14.816 31.988 32.9zM257 0c-61.856 0-112 50.144-112 112h224C369 50.144 318.856 0 257 0z"},child:[]}]})(s)}function Fo(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(s)}function Bo(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z"},child:[]}]})(s)}function ae(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(s)}function qo(s){return C({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(s)}function zo(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(s)}function Vo(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(s)}function Ho(s){return C({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"},child:[]}]})(s)}function Wo(s){return C({attr:{viewBox:"0 0 288 512"},child:[{tag:"path",attr:{d:"M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"},child:[]}]})(s)}function Go(s){return C({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(s)}function Mt(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(s)}function Ko(s){return C({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(s)}function Jo(s){return C({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M216 23.86c0-23.8-30.65-32.77-44.15-13.04C48 191.85 224 200 224 288c0 35.63-29.11 64.46-64.85 63.99-35.17-.45-63.15-29.77-63.15-64.94v-85.51c0-21.7-26.47-32.23-41.43-16.5C27.8 213.16 0 261.33 0 320c0 105.87 86.13 192 192 192s192-86.13 192-192c0-170.29-168-193-168-296.14z"},child:[]}]})(s)}function Yo(s){return C({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M437.2 403.5L320 215V64h8c13.3 0 24-10.7 24-24V24c0-13.3-10.7-24-24-24H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h8v151L10.8 403.5C-18.5 450.6 15.3 512 70.9 512h306.2c55.7 0 89.4-61.5 60.1-108.5zM137.9 320l48.2-77.6c3.7-5.2 5.8-11.6 5.8-18.4V64h64v160c0 6.9 2.2 13.2 5.8 18.4l48.2 77.6h-172z"},child:[]}]})(s)}function Zo(s){return C({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(s)}function Ei(s){return C({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(s)}function Qo(s){return C({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},child:[]}]})(s)}function Xo(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(s)}function ea(s){return C({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(s)}function ta(s){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M501.1 395.7L384 278.6c-23.1-23.1-57.6-27.6-85.4-13.9L192 158.1V96L64 0 0 64l96 128h62.1l106.6 106.6c-13.6 27.8-9.2 62.3 13.9 85.4l117.1 117.1c14.6 14.6 38.2 14.6 52.7 0l52.7-52.7c14.5-14.6 14.5-38.2 0-52.7zM331.7 225c28.3 0 54.9 11 74.9 31l19.4 19.4c15.8-6.9 30.8-16.5 43.8-29.5 37.1-37.1 49.7-89.3 37.9-136.7-2.2-9-13.5-12.1-20.1-5.5l-74.4 74.4-67.9-11.3L334 98.9l74.4-74.4c6.6-6.6 3.4-17.9-5.7-20.2-47.4-11.7-99.6.9-136.6 37.9-28.5 28.5-41.9 66.1-41.2 103.6l82.1 82.1c8.1-1.9 16.5-2.9 24.7-2.9zm-103.9 82l-56.7-56.7L18.7 402.8c-25 25-25 65.5 0 90.5s65.5 25 90.5 0l123.6-123.6c-7.6-19.9-9.9-41.6-5-62.7zM64 472c-13.2 0-24-10.8-24-24 0-13.3 10.7-24 24-24s24 10.7 24 24c0 13.2-10.7 24-24 24z"},child:[]}]})(s)}function ra(s){return C({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 35.7 22.5 72.4 61.9 100.7 31.5 22.7 69.8 37.1 110 41.7C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6c40.3-4.6 78.6-19 110-41.7 39.3-28.3 61.9-65 61.9-100.7V88c0-13.3-10.7-24-24-24zM99.3 192.8C74.9 175.2 64 155.6 64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-15.1-5.2-29.2-12.4-41.7-21.4zM512 144c0 16.1-17.7 36.1-35.3 48.8-12.5 9-26.7 16.2-41.8 21.4 7-25 11.8-53.6 12.8-86.2H512v16z"},child:[]}]})(s)}function sa(s){return C({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(s)}function ji(s){return C({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(s)}function na(s){return C({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(s)}var Q=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});class Yr{constructor(e={}){const t=Ee("VITE_SUPABASE_URL",""),r=e.baseUrl||(t?`${t}/functions/v1/auth-login-simple`:"/api/auth-login-simple");this.config={baseUrl:r,timeout:e.timeout||3e4,retryAttempts:e.retryAttempts||3}}generateCSRFToken(){const e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}storeCSRFToken(e){try{sessionStorage.setItem("csrf_token",e)}catch(t){console.warn("Failed to store CSRF token:",t)}}getStoredCSRFToken(){try{return sessionStorage.getItem("csrf_token")}catch(e){return console.warn("Failed to retrieve CSRF token:",e),null}}validateCSRFToken(e,t){return t?e===t:!1}secureLogin(e){return Q(this,null,function*(){const t=performance.now();try{console.log(" Using direct Supabase authentication");const r=A,{data:n,error:i}=yield r.auth.signInWithPassword({email:e.email.trim().toLowerCase(),password:e.password});if(i)throw new Error(i.message);if(!n.user||!n.session)throw new Error("Authentication failed - no user or session returned");const l={success:!0,data:{accessToken:n.session.access_token,refreshToken:n.session.refresh_token,expiresIn:n.session.expires_in,user:{id:n.user.id,email:n.user.email,role:"user"}}};return Me()&&console.log(`[PERF] SecureAuthService: Direct Supabase login completed in ${(performance.now()-t).toFixed(2)}ms`),l}catch(r){return console.error(`[AUTH] Login failed for ${e.email}:`,r),{success:!1,error:r instanceof Error?r.message:"Authentication failed"}}})}makeSecureRequest(e){return Q(this,null,function*(){const t=new AbortController,r=setTimeout(()=>t.abort(),this.config.timeout);try{const n=yield fetch(this.config.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e),signal:t.signal,credentials:"same-origin"});if(clearTimeout(r),!n.ok){const o=yield n.json().catch(()=>({}));if(n.status===429)return{success:!1,error:o.message||"Too many login attempts. Please try again later.",rateLimitInfo:o.rateLimitInfo};if(n.status===401)return{success:!1,error:o.message||"Invalid email or password"};throw new Error(o.message||`HTTP ${n.status}: ${n.statusText}`)}return yield n.json()}catch(n){throw clearTimeout(r),n.name==="AbortError"?new Error("Request timeout. Please check your connection and try again."):n}})}storeTokens(e){try{sessionStorage.setItem("access_token",e.accessToken),sessionStorage.setItem("refresh_token",e.refreshToken),sessionStorage.setItem("token_expires",(Date.now()+e.expiresIn*1e3).toString()),A.auth.setSession({access_token:e.accessToken,refresh_token:e.refreshToken})}catch(t){throw console.error("Failed to store authentication tokens:",t),new Error("Failed to store authentication tokens")}}validateStoredToken(){return Q(this,null,function*(){try{const e=sessionStorage.getItem("access_token"),t=sessionStorage.getItem("token_expires");return!e||!t?!1:Date.now()>parseInt(t)?yield this.refreshToken():!0}catch(e){return console.error("Token validation failed:",e),!1}})}refreshToken(){return Q(this,null,function*(){try{const e=sessionStorage.getItem("refresh_token");if(!e)return!1;const{data:t,error:r}=yield A.auth.refreshSession({refresh_token:e});return r||!t.session?(yield this.clearTokens(),!1):(this.storeTokens({accessToken:t.session.access_token,refreshToken:t.session.refresh_token,expiresIn:t.session.expires_in}),!0)}catch(e){return console.error("Token refresh failed:",e),yield this.clearTokens(),!1}})}clearTokens(){return Q(this,null,function*(){try{sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),sessionStorage.removeItem("token_expires"),sessionStorage.removeItem("csrf_token"),yield A.auth.signOut()}catch(e){console.error("Failed to clear tokens:",e)}})}getCurrentUser(){return Q(this,null,function*(){try{if(!(yield this.validateStoredToken()))return null;const{data:{user:t}}=yield A.auth.getUser();return t}catch(e){return console.error("Failed to get current user:",e),null}})}validateToken(e){return Q(this,null,function*(){try{if(e){const{data:t,error:r}=yield A.auth.getUser(e);return!r&&!!t.user}else return yield this.validateStoredToken()}catch(t){return console.error("Token validation failed:",t),!1}})}logout(){return Q(this,null,function*(){try{yield this.clearTokens(),console.log("[AUTH] Logout completed successfully")}catch(e){throw console.error("[AUTH] Logout error:",e),e}})}}new Yr;const J=({className:s="",children:e})=>d.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${s}`,"aria-label":"Loading content",role:"status",children:e}),ia=({className:s=""})=>d.jsxs("div",{className:`bg-white rounded-lg shadow-sm p-6 ${s}`,children:[d.jsx(J,{className:"h-4 w-3/4 mb-4"}),d.jsx(J,{className:"h-8 w-1/2 mb-2"}),d.jsx(J,{className:"h-3 w-full mb-1"}),d.jsx(J,{className:"h-3 w-2/3"})]}),oa=({rows:s=5,columns:e=4})=>d.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[d.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:d.jsx("div",{className:"flex space-x-4",children:Array.from({length:e}).map((t,r)=>d.jsx(J,{className:"h-4 flex-1"},`header-${r}`))})}),d.jsx("div",{className:"divide-y divide-gray-200",children:Array.from({length:s}).map((t,r)=>d.jsx("div",{className:"px-6 py-4",children:d.jsx("div",{className:"flex space-x-4",children:Array.from({length:e}).map((n,i)=>d.jsx(J,{className:"h-4 flex-1"},`cell-${r}-${i}`))})},`row-${r}`))})]}),aa=()=>d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex space-x-2",children:[d.jsx(J,{className:"h-10 flex-1"}),d.jsx(J,{className:"h-10 w-20"})]}),d.jsx("div",{className:"flex space-x-2",children:Array.from({length:4}).map((s,e)=>d.jsx(J,{className:"h-8 w-16"},e))})]}),Ci=({size:s="md"})=>{const e={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return d.jsx("div",{className:"flex justify-center items-center p-4",children:d.jsx("div",{className:`animate-spin rounded-full border-4 border-t-transparent border-blue-500 ${e[s]}`,role:"status","aria-label":"Loading"})})};var hr={},It=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});let rt=null;const it=typeof window!="undefined",Pi=()=>It(null,null,function*(){if(!it)try{const{createClient:s}=yield te(()=>import("./redisClient.server-BIA10qmq.js"),__vite__mapDeps([0,1,2,3,4]));rt=s}catch(s){}});it||Pi();class Oi{constructor(e){this.client=null,this.isConnected=!1,this.config=e}connect(){return It(this,null,function*(){if(!this.isConnected){if(it){I.warn("Redis not available in browser environment, using in-memory fallback");return}if(rt||(yield new Promise(e=>setTimeout(e,100))),!rt){I.warn("Redis not available, using in-memory fallback");return}try{this.client=rt({socket:{host:this.config.host,port:this.config.port,reconnectStrategy:e=>e>10?(I.error("Redis connection failed after 10 retries"),new Error("Redis connection failed")):Math.min(e*100,3e3)},password:this.config.password,database:this.config.db||0}),this.client.on("error",e=>{I.error("Redis client error:",e),this.isConnected=!1}),this.client.on("connect",()=>{I.info("Redis client connected"),this.isConnected=!0}),this.client.on("disconnect",()=>{I.warn("Redis client disconnected"),this.isConnected=!1}),yield this.client.connect()}catch(e){throw I.error("Failed to connect to Redis:",e),e}}})}disconnect(){return It(this,null,function*(){this.client&&this.isConnected&&(yield this.client.disconnect(),this.isConnected=!1)})}getClient(){if(!this.client||!this.isConnected)throw new Error("Redis client not connected");return this.client}isHealthy(){return it?!1:this.isConnected&&this.client!==null}}const Qe=(s,e)=>typeof process!="undefined"&&hr&&hr[s]||e,Ai={host:Qe("REDIS_HOST","localhost"),port:parseInt(Qe("REDIS_PORT","6379")),password:Qe("REDIS_PASSWORD",""),db:parseInt(Qe("REDIS_DB","0")),retryDelayOnFailover:100,maxRetriesPerRequest:3},le=new Oi(Ai);var Ii=Object.defineProperty,fr=Object.getOwnPropertySymbols,Ri=Object.prototype.hasOwnProperty,$i=Object.prototype.propertyIsEnumerable,gr=(s,e,t)=>e in s?Ii(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ce=(s,e)=>{for(var t in e||(e={}))Ri.call(e,t)&&gr(s,t,e[t]);if(fr)for(var t of fr(e))$i.call(e,t)&&gr(s,t,e[t]);return s},Xe=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});class Ve{constructor(e){this.fallbackCache=new Map,this.cleanupInterval=null,this.config=ce({blockDurationMs:e.windowMs*2},e),this.startCleanupInterval()}checkRateLimit(e,t){return Xe(this,null,function*(){const r=ce(ce({},this.config),t),n=`${r.keyPrefix}:${e}`,i=Date.now(),o=i-r.windowMs;try{if(le.isHealthy())return yield this.checkRedisRateLimit(n,r,i,o)}catch(l){I.warn("Redis rate limiting failed, falling back to in-memory:",l)}return this.checkInMemoryRateLimit(n,r,i)})}checkRedisRateLimit(e,t,r,n){return Xe(this,null,function*(){const i=le.getClient(),o=i.multi();o.zRemRangeByScore(e,"-inf",n),o.zCard(e),o.zAdd(e,{score:r,member:`${r}-${Math.random()}`}),o.expire(e,Math.ceil(t.windowMs/1e3));const l=`${e}:blocked`;o.get(l);const a=yield o.exec();if(!a||a.length<4)throw new Error("Redis pipeline execution failed");const c=a[1],u=a[4];if(u){const h=parseInt(u);if(r<h)return{allowed:!1,remaining:0,resetTime:h,retryAfter:Math.ceil((h-r)/1e3)};yield i.del(l)}if(c>=t.maxRequests){if(t.blockDurationMs){const h=r+t.blockDurationMs;yield i.setEx(l,Math.ceil(t.blockDurationMs/1e3),h.toString())}return{allowed:!1,remaining:0,resetTime:r+t.windowMs,retryAfter:Math.ceil(t.windowMs/1e3)}}return{allowed:!0,remaining:t.maxRequests-c-1,resetTime:r+t.windowMs}})}checkInMemoryRateLimit(e,t,r){const n=this.fallbackCache.get(e);n&&n.resetTime<r&&this.fallbackCache.delete(e);const i=this.fallbackCache.get(e)||{count:0,resetTime:r+t.windowMs,blocked:!1};return i.blocked&&i.blockUntil&&r<i.blockUntil?{allowed:!1,remaining:0,resetTime:i.blockUntil,retryAfter:Math.ceil((i.blockUntil-r)/1e3)}:(i.resetTime<r&&(i.count=0,i.resetTime=r+t.windowMs,i.blocked=!1,delete i.blockUntil),i.count>=t.maxRequests?(t.blockDurationMs&&(i.blocked=!0,i.blockUntil=r+t.blockDurationMs),this.fallbackCache.set(e,i),{allowed:!1,remaining:0,resetTime:i.resetTime,retryAfter:Math.ceil(t.windowMs/1e3)}):(i.count++,this.fallbackCache.set(e,i),{allowed:!0,remaining:t.maxRequests-i.count,resetTime:i.resetTime}))}resetRateLimit(e,t){return Xe(this,null,function*(){const n=`${ce(ce({},this.config),t).keyPrefix}:${e}`;try{if(le.isHealthy()){const i=le.getClient();yield i.del(n),yield i.del(`${n}:blocked`)}}catch(i){I.warn("Failed to reset Redis rate limit:",i)}this.fallbackCache.delete(n)})}getRateLimitStatus(e,t){return Xe(this,null,function*(){const r=ce(ce({},this.config),t),n=`${r.keyPrefix}:${e}`,i=Date.now(),o=i-r.windowMs;try{if(le.isHealthy()){const a=le.getClient(),c=`${n}:blocked`,u=yield a.get(c);if(u){const g=parseInt(u);if(i<g)return{allowed:!1,remaining:0,resetTime:g,retryAfter:Math.ceil((g-i)/1e3)}}const h=yield a.zCount(n,o,"+inf");return{allowed:h<r.maxRequests,remaining:Math.max(0,r.maxRequests-h),resetTime:i+r.windowMs}}}catch(a){I.warn("Failed to get Redis rate limit status:",a)}const l=this.fallbackCache.get(n);return!l||l.resetTime<i?{allowed:!0,remaining:r.maxRequests,resetTime:i+r.windowMs}:l.blocked&&l.blockUntil&&i<l.blockUntil?{allowed:!1,remaining:0,resetTime:l.blockUntil,retryAfter:Math.ceil((l.blockUntil-i)/1e3)}:{allowed:l.count<r.maxRequests,remaining:Math.max(0,r.maxRequests-l.count),resetTime:l.resetTime}})}startCleanupInterval(){this.cleanupInterval=setInterval(()=>{const e=Date.now();for(const[t,r]of Array.from(this.fallbackCache.entries()))r.resetTime<e&&this.fallbackCache.delete(t)},6e4)}getStats(){return{fallbackCacheSize:this.fallbackCache.size,redisHealthy:le.isHealthy(),config:this.config}}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.fallbackCache.clear()}}new Ve({maxRequests:100,windowMs:60*1e3,keyPrefix:"api",blockDurationMs:300*1e3});new Ve({maxRequests:5,windowMs:900*1e3,keyPrefix:"auth",blockDurationMs:1800*1e3});new Ve({maxRequests:20,windowMs:60*1e3,keyPrefix:"ai",blockDurationMs:120*1e3});new Ve({maxRequests:30,windowMs:60*1e3,keyPrefix:"general"});var Li=Object.defineProperty,Ni=Object.defineProperties,Di=Object.getOwnPropertyDescriptors,pr=Object.getOwnPropertySymbols,Ui=Object.prototype.hasOwnProperty,Mi=Object.prototype.propertyIsEnumerable,mr=(s,e,t)=>e in s?Li(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,vr=(s,e)=>{for(var t in e||(e={}))Ui.call(e,t)&&mr(s,t,e[t]);if(pr)for(var t of pr(e))Mi.call(e,t)&&mr(s,t,e[t]);return s},_r=(s,e)=>Ni(s,Di(e)),Fi=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const Fe=ds((s,e)=>{var t,r,n,i,o,l,a,c,u,h,g;const v=(r=(t=localStorage.getItem("authToken"))!=null?t:sessionStorage.getItem("authToken"))!=null?r:null,_=(i=(n=localStorage.getItem("tokenExpiry"))!=null?n:sessionStorage.getItem("tokenExpiry"))!=null?i:null,S=(l=(o=localStorage.getItem("csrfToken"))!=null?o:sessionStorage.getItem("csrfToken"))!=null?l:null,w=parseInt((c=(a=localStorage.getItem("failedAttempts"))!=null?a:sessionStorage.getItem("failedAttempts"))!=null?c:"0"),b=parseInt((h=(u=localStorage.getItem("lastLoginAttempt"))!=null?u:sessionStorage.getItem("lastLoginAttempt"))!=null?h:"0"),y=(p,T,k=!1)=>{setTimeout(()=>{try{(k?localStorage:sessionStorage).setItem(p,T)}catch(P){console.warn(`Failed to save ${p} to ${k?"localStorage":"sessionStorage"}:`,P)}},0)},m=()=>{const p=new Uint8Array(32);return crypto.getRandomValues(p),btoa(String.fromCharCode.apply(null,Array.from(p))).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)};return{formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,otp:"",stage:"credentials"},errors:{},loading:!1,sessionExpiry:(g=localStorage.getItem("sessionExpiry"))!=null?g:null,authToken:v,tokenExpiry:_,csrfToken:S||m(),lastLoginAttempt:b||null,failedAttempts:w,isSecureMode:!0,setField:(p,T)=>s(k=>({formData:_r(vr({},k.formData),{[p]:T})})),setErrors:p=>s({errors:p}),setLoading:p=>s({loading:p}),setStage:p=>s(T=>({formData:_r(vr({},T.formData),{stage:p})})),setSessionExpiry:p=>{y("sessionExpiry",p),s({sessionExpiry:p})},setAuthToken:(p,T,k=!1)=>{y("authToken",p,k),y("tokenExpiry",T,k),s({authToken:p,tokenExpiry:T}),e().resetFailedAttempts()},reset:()=>Fi(null,null,function*(){localStorage.removeItem("authToken"),localStorage.removeItem("tokenExpiry"),localStorage.removeItem("sessionExpiry"),localStorage.removeItem("csrfToken"),localStorage.removeItem("failedAttempts"),localStorage.removeItem("lastLoginAttempt"),localStorage.removeItem("currentUser"),localStorage.removeItem("userProfile"),localStorage.removeItem("userData"),localStorage.removeItem("user_preferences"),localStorage.removeItem("sb-user"),localStorage.removeItem("user_data"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("tokenExpiry"),sessionStorage.removeItem("sessionExpiry"),sessionStorage.removeItem("csrfToken"),sessionStorage.removeItem("failedAttempts"),sessionStorage.removeItem("lastLoginAttempt"),sessionStorage.removeItem("currentUser"),sessionStorage.removeItem("userProfile"),sessionStorage.removeItem("userData"),sessionStorage.removeItem("user_preferences"),sessionStorage.removeItem("user_id"),sessionStorage.removeItem("user_email"),sessionStorage.removeItem("user_role");try{const{supabase:p}=yield te(()=>Promise.resolve().then(()=>_i),void 0);yield p.auth.signOut()}catch(p){console.error("Failed to clear Supabase session:",p)}s({formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,otp:"",stage:"credentials"},errors:{},loading:!1,sessionExpiry:null,authToken:null,tokenExpiry:null,csrfToken:m(),lastLoginAttempt:null,failedAttempts:0,isSecureMode:!0})}),setCSRFToken:p=>{y("csrfToken",p),s({csrfToken:p})},incrementFailedAttempts:()=>{const p=e().failedAttempts+1,T=Date.now();y("failedAttempts",p.toString()),y("lastLoginAttempt",T.toString()),s({failedAttempts:p,lastLoginAttempt:T})},resetFailedAttempts:()=>{localStorage.removeItem("failedAttempts"),localStorage.removeItem("lastLoginAttempt"),s({failedAttempts:0,lastLoginAttempt:null})},setSecureMode:p=>{s({isSecureMode:p})},isTokenExpired:()=>{const{tokenExpiry:p}=e();return p?new Date(p)<=new Date:!0},getRemainingSessionTime:()=>{const{tokenExpiry:p}=e();if(!p)return 0;const T=new Date(p),k=new Date;return Math.max(0,T.getTime()-k.getTime())}}}),la=Object.freeze(Object.defineProperty({__proto__:null,useLoginStore:Fe},Symbol.toStringTag,{value:"Module"}));var Bi=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const mt=(s,e)=>Bi(null,null,function*(){try{console.log("Analytics Event:",{eventName:s,properties:e,timestamp:new Date})}catch(t){console.warn("Failed to track analytics event:",t)}}),et={rememberMe:"Remember me",rememberDevice:"Remember device"},F={PROGRESS_STEPS:{IDLE:"idle",CONNECTING:"connecting",AUTHENTICATING:"authenticating",VERIFYING:"verifying",SUCCESS:"success"},REDIRECT_DELAY_MS:1e3,MIN_PASSWORD_LENGTH:6,OTP_LENGTH:6},Zr={unexpectedError:"An unexpected error occurred. Please try again.",offline:"You are currently offline. Please check your internet connection."};var ke=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const Qr=class Le{constructor(){this.STORAGE_KEY="cliniio_trusted_devices",this.DEVICE_NAME_KEY="cliniio_device_name"}static getInstance(){return Le.instance||(Le.instance=new Le),Le.instance}generateDeviceFingerprint(){try{const e=document.createElement("canvas"),t=e.getContext("2d");t&&(t.textBaseline="top",t.font="14px Arial",t.fillText("Device fingerprint",2,2));const r=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");return btoa(r).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}catch(e){return"unknown_device"}}getDeviceName(){const e=localStorage.getItem(this.DEVICE_NAME_KEY);if(e)return e;const t=navigator.userAgent;let r="Unknown Device";return t.includes("Windows")?r="Windows Device":t.includes("Mac")?r="Mac Device":t.includes("Linux")?r="Linux Device":t.includes("Android")?r="Android Device":(t.includes("iPhone")||t.includes("iPad"))&&(r="iOS Device"),t.includes("Chrome")?r+=" (Chrome)":t.includes("Firefox")?r+=" (Firefox)":t.includes("Safari")?r+=" (Safari)":t.includes("Edge")&&(r+=" (Edge)"),localStorage.setItem(this.DEVICE_NAME_KEY,r),r}storeTrustedDevice(e,t){return ke(this,null,function*(){try{const r=this.getDeviceName(),{error:n}=yield A.from("trusted_devices").upsert({user_id:e,device_fingerprint:t,device_name:r,last_used:new Date().toISOString(),is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});return n?(console.error("Failed to store trusted device:",n),!1):(this.storeDeviceLocally(t,r),!0)}catch(r){return console.error("Error storing trusted device:",r),!1}})}isDeviceTrusted(e){return ke(this,null,function*(){try{const t=this.generateDeviceFingerprint(),{data:r,error:n}=yield A.from("trusted_devices").select("id, last_used, is_active").eq("user_id",e).eq("device_fingerprint",t).eq("is_active",!0).single();return n||!r?!1:(yield this.updateLastUsed(r.id),!0)}catch(t){return console.error("Error checking trusted device:",t),!1}})}getTrustedDevices(e){return ke(this,null,function*(){try{const{data:t,error:r}=yield A.from("trusted_devices").select("*").eq("user_id",e).eq("is_active",!0).order("last_used",{ascending:!1});return r?(console.error("Failed to get trusted devices:",r),[]):t||[]}catch(t){return console.error("Error getting trusted devices:",t),[]}})}removeTrustedDevice(e){return ke(this,null,function*(){try{const{error:t}=yield A.from("trusted_devices").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e);return t?(console.error("Failed to remove trusted device:",t),!1):!0}catch(t){return console.error("Error removing trusted device:",t),!1}})}updateLastUsed(e){return ke(this,null,function*(){try{yield A.from("trusted_devices").update({last_used:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e)}catch(t){console.error("Error updating last used:",t)}})}storeDeviceLocally(e,t){try{const r={fingerprint:e,name:t,timestamp:new Date().toISOString()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r))}catch(r){console.error("Error storing device locally:",r)}}getLocalDeviceInfo(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e),r=new Date(Date.now()-720*60*60*1e3);return new Date(t.timestamp)<r?(localStorage.removeItem(this.STORAGE_KEY),null):t}catch(e){return console.error("Error getting local device info:",e),null}}clearAllTrustedDevices(e){return ke(this,null,function*(){try{const{error:t}=yield A.from("trusted_devices").update({is_active:!1,updated_at:new Date().toISOString()}).eq("user_id",e);return t?(console.error("Failed to clear trusted devices:",t),!1):(localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.DEVICE_NAME_KEY),!0)}catch(t){return console.error("Error clearing trusted devices:",t),!1}})}};Qr.instance=null;let qi=Qr;const vt=qi.getInstance();var zi=Object.defineProperty,Vi=Object.defineProperties,Hi=Object.getOwnPropertyDescriptors,yr=Object.getOwnPropertySymbols,Wi=Object.prototype.hasOwnProperty,Gi=Object.prototype.propertyIsEnumerable,wr=(s,e,t)=>e in s?zi(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ki=(s,e)=>{for(var t in e||(e={}))Wi.call(e,t)&&wr(s,t,e[t]);if(yr)for(var t of yr(e))Gi.call(e,t)&&wr(s,t,e[t]);return s},Ji=(s,e)=>Vi(s,Hi(e)),Yi=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const Xr=()=>{const s=us(),{refreshUserData:e}=bi(),{formData:t,errors:r,loading:n,setField:i,setErrors:o,setLoading:l,setAuthToken:a,csrfToken:c,incrementFailedAttempts:u,resetFailedAttempts:h,isSecureMode:g}=Fe(),[v,_]=j.useState(""),S=j.useCallback(y=>m=>{const p=y==="rememberMe"||y==="rememberDevice"?m.target.checked:m.target.value;i(y,p),r[y]&&o(Ji(Ki({},r),{[y]:""}))},[r,i,o]),w=(y,m,p,T,k=!1,P=!1)=>Yi(null,null,function*(){var M;if(!n){if(o({}),l(!0),g&&!p()){o({submit:"Security validation failed. Please refresh the page and try again."}),l(!1);return}try{mt("attempt",{email:y,timestamp:new Date().toISOString()});const R=!1;if(P)try{console.log(" Checking if device is already trusted...")}catch(Ae){console.warn("Failed to check trusted device:",Ae)}const Y=yield new Yr().secureLogin({email:y,password:m,rememberMe:k});if(Y.success&&Y.data){_(F.PROGRESS_STEPS.VERIFYING);const Ae=new Date(Date.now()+Y.data.expiresIn*1e3).toISOString();a(Y.data.accessToken,Ae,k);try{yield e()}catch(D){console.warn("Failed to refresh user data:",D)}if(P)try{const D=vt.generateDeviceFingerprint(),ne=(M=Y.data.user)==null?void 0:M.id;ne&&((yield vt.isDeviceTrusted(ne))?console.log(" Device already trusted"):(yield vt.storeTrustedDevice(ne,D),console.log(" Device marked as trusted")))}catch(D){console.warn("Failed to store trusted device:",D)}mt("success",{email:y,timestamp:new Date().toISOString()}),T("login_success",y),h(),_(F.PROGRESS_STEPS.SUCCESS),setTimeout(()=>{s("/home")},F.REDIRECT_DELAY_MS)}else throw new Error(Y.error||"Authentication failed")}catch(R){console.error("Secure login error:",R),u();const se=R instanceof Error?R.message:Zr.unexpectedError;o({submit:se}),mt("failure",{email:y,error:se,timestamp:new Date().toISOString()}),T("login_failure",y,se)}finally{l(!1),_("")}}}),b=j.useCallback(()=>{console.log("Forgot password clicked")},[]);return{formData:t,errors:r,loading:n,loadingStep:v,handleChange:S,handleSubmit:w,handleForgotPassword:b}},Zi=()=>d.jsxs(d.Fragment,{children:[d.jsx("h1",{className:"mt-6 text-center text-3xl font-extrabold text-gray-500",children:"Welcome to Cliniio"}),d.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to your account"})]});function Qi(s){return C({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(s)}function Xi(s){return C({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 32h214.6v214.6H0V32zm233.4 0H448v214.6H233.4V32zM0 265.4h214.6V480H0V265.4zm233.4 0H448V480H233.4V265.4z"},child:[]}]})(s)}const Be={RATE_LIMIT:{MAX_ATTEMPTS:5,LOCKOUT_DURATION_MINUTES:15,WINDOW_SIZE_MINUTES:15},VALIDATION:{DEBOUNCE_MS:500},THRESHOLDS:{MIN_PASSWORD_LENGTH:8,MAX_LOGIN_ATTEMPTS:5},PASSWORD_STRENGTH:{MIN_LENGTH:8,GOOD_LENGTH:12,EXCELLENT_LENGTH:16,MAX_SCORE:5}},es=s=>(Object.keys(s).forEach(e=>{typeof s[e]=="object"&&s[e]!==null&&es(s[e])}),Object.freeze(s));es(Be);const br=(s,e)=>{if(!s||typeof s!="string")return null;const t=s.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim();return e==="email"?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?t:null:e==="password"&&t.length<8?null:t},Sr=s=>{const e=[];return!s||typeof s!="string"?{isSuspicious:!1,threats:e}:(/('|"|;|--|\/\*|\*\/|union|select|insert|update|delete|drop|create|alter)/i.test(s)&&e.push("Potential SQL injection detected"),/<script|javascript:|on\w+\s*=|vbscript:|expression\(/i.test(s)&&e.push("Potential XSS attack detected"),/\||&|;|`|\$\(|eval\(|exec\(/i.test(s)&&e.push("Potential command injection detected"),{isSuspicious:e.length>0,threats:e})},Rt=(s=32)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";if(typeof crypto!="undefined"&&crypto.getRandomValues){const r=new Uint8Array(s);crypto.getRandomValues(r);for(let n=0;n<s;n++)t+=e[r[n]%e.length]}else for(let r=0;r<s;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},W={generateToken:()=>Rt(32),storeToken:s=>{try{typeof window!="undefined"&&localStorage.setItem("csrf_token",s)}catch(e){}},getStoredToken:()=>{try{return typeof window!="undefined"?localStorage.getItem("csrf_token"):null}catch(s){return null}},validateToken:(s,e)=>{if(!s||!e)return!1;const t=s===e;return t},setHttpOnlyCookie:s=>{W.storeToken(s)},refreshToken:()=>{const s=W.generateToken();return W.storeToken(s),s},clearToken:()=>{try{typeof window!="undefined"&&localStorage.removeItem("csrf_token")}catch(s){}}};var eo=Object.defineProperty,to=Object.defineProperties,ro=Object.getOwnPropertyDescriptors,kr=Object.getOwnPropertySymbols,so=Object.prototype.hasOwnProperty,no=Object.prototype.propertyIsEnumerable,xr=(s,e,t)=>e in s?eo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Tr=(s,e)=>{for(var t in e||(e={}))so.call(e,t)&&xr(s,t,e[t]);if(kr)for(var t of kr(e))no.call(e,t)&&xr(s,t,e[t]);return s},Er=(s,e)=>to(s,ro(e)),jr=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const io=()=>{const[s,e]=j.useState({}),[t,r]=j.useState("");j.useEffect(()=>{const o=Rt(32);r(o),typeof sessionStorage!="undefined"&&sessionStorage.setItem("oauth_state",o)},[]);const n=o=>jr(null,null,function*(){try{if(e(h=>Er(Tr({},h),{[o]:!0})),!t)throw new Error("OAuth state not initialized");const l=o==="microsoft"?"azure":o,a=Rt(128),c=yield i(a);typeof sessionStorage!="undefined"&&(sessionStorage.setItem("oauth_code_verifier",a),sessionStorage.setItem("oauth_provider",o));const{error:u}=yield A.auth.signInWithOAuth({provider:l,options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{access_type:"offline",prompt:"consent",state:t,code_challenge:c,code_challenge_method:"S256"}}});if(u)throw console.error(`OAuth login error with ${o}:`,u),u;Me()&&console.log(`[SECURITY] OAuth login initiated with ${o}:`,{provider:l,state:t,codeChallenge:c,timestamp:new Date().toISOString()})}catch(l){console.error(`Failed to login with ${o}:`,l),typeof sessionStorage!="undefined"&&(sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),sessionStorage.removeItem("oauth_state")),alert(`Failed to login with ${o}. Please try again.`)}finally{e(l=>Er(Tr({},l),{[o]:!1}))}}),i=o=>jr(null,null,function*(){try{const a=new TextEncoder().encode(o),c=yield crypto.subtle.digest("SHA-256",a),u=Array.from(new Uint8Array(c));return btoa(String.fromCharCode(...u)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(l){return console.error("Failed to generate PKCE code challenge:",l),o.substring(0,43)}});return d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-300"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.jsxs("button",{type:"button",onClick:()=>n("google"),disabled:s.google||!t,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.google?d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):d.jsx(Qi,{className:"h-4 w-4 text-red-500"}),d.jsx("span",{className:"ml-2",children:"Google"})]}),d.jsxs("button",{type:"button",onClick:()=>n("microsoft"),disabled:s.microsoft||!t,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.microsoft?d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):d.jsx(Xi,{className:"h-4 w-4 text-blue-500"}),d.jsx("span",{className:"ml-2",children:"Microsoft"})]})]})]})},oo=()=>d.jsx(io,{}),ts=({formData:s,handleChange:e,disabled:t=!1})=>{const r=j.useRef(null),[n,i]=j.useState(!1);j.useEffect(()=>{r.current&&!t&&r.current.focus()},[t]);const o=c=>c.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.trim())?null:"Please enter a valid email address":"Email is required",l=c=>{e("email")(c),i(!0)},a=n?o(s.email):null;return d.jsxs("div",{children:[d.jsx("span",{id:"emailHelp",className:"sr-only",children:"Enter your email address."}),d.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email"}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(ji,{className:"h-5 w-5 text-gray-400"})}),d.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,disabled:t,"aria-label":"Email address","aria-describedby":"emailHelp",className:`appearance-none rounded-lg relative block w-full px-3 py-3 pl-10 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 focus:z-10 sm:text-sm transition-colors duration-200 ${a?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`,placeholder:"Email address",value:s.email,onChange:l,onBlur:()=>i(!0),ref:r})]}),a&&d.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[d.jsx(Mt,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),d.jsx("p",{className:"text-sm text-red-600",children:a})]})]})},rs=({password:s})=>{const t=(n=>{let i=0;const o={length:n.length>=8,lowercase:/[a-z]/.test(n),uppercase:/[A-Z]/.test(n),numbers:/\d/.test(n),symbols:/[!@#$%^&*(),.?":{}|<>]/.test(n),noRepeating:!/(.)\1{2,}/.test(n),noSequential:!/(?:abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|012|123|234|345|456|567|678|789)/i.test(n)};return o.length&&(i+=2),o.lowercase&&(i+=1),o.uppercase&&(i+=1),o.numbers&&(i+=1),o.symbols&&(i+=1),o.noRepeating&&(i+=1),o.noSequential&&(i+=1),n.length>=12&&(i+=1),n.length>=16&&(i+=1),i>=8?{level:"Excellent",score:i,color:"text-emerald-600",bgColor:"bg-emerald-500",barColor:"bg-emerald-500"}:i>=6?{level:"Strong",score:i,color:"text-green-600",bgColor:"bg-green-500",barColor:"bg-green-500"}:i>=4?{level:"Good",score:i,color:"text-yellow-600",bgColor:"bg-yellow-500",barColor:"bg-yellow-500"}:i>=2?{level:"Fair",score:i,color:"text-orange-600",bgColor:"bg-orange-500",barColor:"bg-orange-500"}:{level:"Weak",score:i,color:"text-red-600",bgColor:"bg-red-500",barColor:"bg-red-500"}})(s),r=10;return s.length===0?null:d.jsxs("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength"}),d.jsx("span",{className:`text-sm font-semibold ${t.color}`,children:t.level})]}),d.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:d.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ease-out ${t.barColor}`,style:{width:`${t.score/r*100}%`}})}),d.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-3",children:[d.jsxs("span",{children:["Score: ",t.score,"/",r]}),d.jsxs("span",{className:t.color,children:[Math.round(t.score/r*100),"%"]})]}),d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[s.length>=8?d.jsx(ae,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):d.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),d.jsx("span",{className:`text-xs ${s.length>=8?"text-green-700":"text-gray-500"}`,children:"At least 8 characters"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[/[a-z]/.test(s)?d.jsx(ae,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):d.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),d.jsx("span",{className:`text-xs ${/[a-z]/.test(s)?"text-green-700":"text-gray-500"}`,children:"Lowercase letter"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[/[A-Z]/.test(s)?d.jsx(ae,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):d.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),d.jsx("span",{className:`text-xs ${/[A-Z]/.test(s)?"text-green-700":"text-gray-500"}`,children:"Uppercase letter"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[/\d/.test(s)?d.jsx(ae,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):d.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),d.jsx("span",{className:`text-xs ${/\d/.test(s)?"text-green-700":"text-gray-500"}`,children:"Number"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[/[!@#$%^&*(),.?":{}|<>]/.test(s)?d.jsx(ae,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):d.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),d.jsx("span",{className:`text-xs ${/[!@#$%^&*(),.?":{}|<>]/.test(s)?"text-green-700":"text-gray-500"}`,children:"Special character"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[s.length>=12?d.jsx(ae,{className:"w-3 h-3 text-green-500 flex-shrink-0"}):d.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}),d.jsx("span",{className:`text-xs ${s.length>=12?"text-green-700":"text-gray-500"}`,children:"At least 12 characters (bonus)"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[/(.)\1{2,}/.test(s)?d.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300"}):d.jsx(ae,{className:"w-3 h-3 text-green-500 flex-shrink-0"}),d.jsx("span",{className:`text-xs ${/(.)\1{2,}/.test(s)?"text-gray-500":"text-green-700"}`,children:"No repeating characters"})]})]}),t.score<6&&d.jsx("div",{className:"mt-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:d.jsxs("div",{className:"flex items-start space-x-2",children:[d.jsx("svg",{className:"w-4 h-4 text-amber-500 mt-0.5 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),d.jsxs("span",{children:[d.jsx("strong",{children:"Tip:"})," Try adding uppercase letters, numbers, and special characters to make your password stronger."]})]})})]})},ss=({formData:s,handleChange:e,disabled:t=!1,showStrengthIndicator:r=!1})=>{const[n,i]=j.useState(!1),o=c=>c?c.length<8?"Password must be at least 8 characters long":null:"Password is required",l=c=>{e("password")(c),i(!0)},a=n?o(s.password):null;return d.jsxs("div",{children:[d.jsx("span",{id:"passwordHelp",className:"sr-only",children:"Enter your account password."}),d.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(Ei,{className:"h-5 w-5 text-gray-400"})}),d.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,disabled:t,"aria-label":"Password","aria-describedby":"passwordHelp",className:`appearance-none rounded-lg relative block w-full px-3 py-3 pl-10 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 focus:z-10 sm:text-sm transition-colors duration-200 ${a?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`,placeholder:"Password",value:s.password,onChange:l,onBlur:()=>i(!0)})]}),r&&d.jsx(rs,{password:s.password}),a&&d.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[d.jsx(Mt,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),d.jsx("p",{className:"text-sm text-red-600",children:a})]})]})},ns=({formData:s,handleChange:e,disabled:t=!1})=>d.jsx("div",{className:"flex items-center justify-between",children:d.jsxs("div",{className:"flex flex-col space-y-2",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",disabled:t,"aria-label":et.rememberMe,checked:s.rememberMe,onChange:e("rememberMe"),className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${t?"opacity-50 cursor-not-allowed":""}`}),d.jsx("label",{htmlFor:"remember-me",className:`ml-2 block text-sm transition-colors duration-200 ${t?"text-gray-500":"text-gray-900"}`,children:et.rememberMe})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"remember-device",name:"remember-device",type:"checkbox",disabled:t,"aria-label":et.rememberDevice,checked:s.rememberDevice,onChange:e("rememberDevice"),className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${t?"opacity-50 cursor-not-allowed":""}`}),d.jsx("label",{htmlFor:"remember-device",className:`ml-2 block text-sm transition-colors duration-200 ${t?"text-gray-500":"text-gray-900"}`,children:et.rememberDevice})]})]})}),is=({formData:s,handleChange:e,disabled:t=!1})=>{const[r,n]=j.useState(!1),i=a=>a?a.length!==6?"Verification code must be 6 digits":/^\d{6}$/.test(a)?null:"Verification code must contain only numbers":"Verification code is required",o=a=>{e("otp")(a),n(!0)},l=r?i(s.otp||""):null;return s.stage!=="otp"?null:d.jsxs("div",{children:[d.jsx("label",{htmlFor:"otp",className:"sr-only",children:"One-time code"}),d.jsx("input",{id:"otp",name:"otp",type:"text",maxLength:6,disabled:t,placeholder:"Enter 6-digit code",value:s.otp||"",onChange:o,onBlur:()=>n(!0),className:`appearance-none rounded-lg relative block w-full px-3 py-3 border placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:border-blue-500 sm:text-sm transition-colors duration-200 ${l?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300"} ${t?"opacity-50 cursor-not-allowed bg-gray-100":""}`}),l&&d.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[d.jsx(Mt,{className:"h-4 w-4 text-red-400 flex-shrink-0"}),d.jsx("p",{className:"text-sm text-red-600",children:l})]})]})},os=({warnings:s=[]})=>j.useMemo(()=>!s||s.length===0?null:d.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"flex-shrink-0",children:d.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:d.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),d.jsxs("div",{className:"ml-3",children:[d.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Security Warning"}),d.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:d.jsx("ul",{className:"list-disc pl-5 space-y-1",children:s.map((t,r)=>d.jsx("li",{children:t},r))})})]})]})}),[s]),as=({isOnline:s=!0})=>s?null:d.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"flex-shrink-0",children:d.jsx("svg",{className:"h-5 w-5 text-amber-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),d.jsx("div",{className:"flex-1",children:d.jsx("p",{className:"text-sm text-amber-800 font-medium",children:Zr.offline})})]})});var ao=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const lo=j.lazy(()=>te(()=>import("./errors-CsB9ZK3e.js").then(s=>s.bj),__vite__mapDeps([5,1,2,4]))),co=()=>d.jsx("div",{className:"rounded-lg border p-4 bg-red-50 border-red-200",children:d.jsx("div",{className:"flex items-center",children:d.jsx("div",{className:"text-sm text-red-800",children:"Loading error handler..."})})}),Cr=()=>{const{formData:s,errors:e,loading:t,handleChange:r,handleSubmit:n,handleForgotPassword:i}=Xr(),{csrfToken:o,isSecureMode:l}=Fe(),a=c=>ao(null,null,function*(){if(c.preventDefault(),!s.email.trim()||!s.password.trim())return;const u=s.email.trim().toLowerCase(),h=s.password;yield n(u,h,()=>l?!!o&&o.length>0:!0,(_,S,w)=>{console.log(`[SECURITY] ${_} for user: ${S}`,w?`Reason: ${w}`:"")},s.rememberMe,s.rememberDevice)});return d.jsx(Ti,{children:d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsx(Zi,{}),d.jsxs("form",{className:"mt-8 space-y-6",onSubmit:a,children:[l&&o&&d.jsx("input",{type:"hidden",name:"csrfToken",value:o}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(ts,{formData:s,handleChange:r,disabled:t}),d.jsx(ss,{formData:s,handleChange:r,disabled:t,showStrengthIndicator:!1}),d.jsx(ns,{formData:s,handleChange:r,disabled:t})]}),s.stage==="otp"&&d.jsx(is,{formData:s,handleChange:r,disabled:t}),d.jsx(os,{}),d.jsx(as,{}),e.submit&&d.jsx(j.Suspense,{fallback:d.jsx(co,{}),children:d.jsx(lo,{error:e.submit,context:"login",onRetry:()=>{Fe.getState().setErrors({})},onDismiss:()=>{Fe.getState().setErrors({})}})}),d.jsx("div",{children:d.jsx("button",{type:"submit",disabled:t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#4ECDC4] hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#4ECDC4] disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Sign in"})}),d.jsx("div",{className:"text-center",children:d.jsx("button",{type:"button",onClick:i,className:"text-sm text-blue-600 hover:text-blue-500 focus:outline-none focus:underline",children:"Forgot your password?"})})]}),d.jsx(oo,{})]})})})},uo=()=>d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"mt-4 inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[d.jsx("svg",{className:"w-3 h-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Secure Login Enabled"]})}),ho=({loading:s,loadingStep:e})=>{const t=r=>{switch(r){case F.PROGRESS_STEPS.CONNECTING:return"progress-bar-25";case F.PROGRESS_STEPS.AUTHENTICATING:return"progress-bar-50";case F.PROGRESS_STEPS.VERIFYING:return"progress-bar-75";case F.PROGRESS_STEPS.SUCCESS:return"progress-bar-100";default:return"progress-bar-0"}};return!s||e===F.PROGRESS_STEPS.IDLE?null:d.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"flex-shrink-0",children:d.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[d.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),d.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[e===F.PROGRESS_STEPS.CONNECTING&&"Connecting to server...",e===F.PROGRESS_STEPS.AUTHENTICATING&&"Authenticating credentials...",e===F.PROGRESS_STEPS.VERIFYING&&"Verifying session...",e===F.PROGRESS_STEPS.SUCCESS&&"Login successful! Redirecting..."]}),d.jsx("div",{className:"mt-2 w-full bg-blue-200 rounded-full h-2",children:d.jsx("div",{className:`bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out ${t(e)}`})})]})]})})},fo=({loading:s,loadingStep:e})=>s?d.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-600",children:[d.jsx(Ci,{size:"sm"}),d.jsx("span",{children:e||"Processing..."})]}):null;var go=Object.defineProperty,Pr=Object.getOwnPropertySymbols,po=Object.prototype.hasOwnProperty,mo=Object.prototype.propertyIsEnumerable,Or=(s,e,t)=>e in s?go(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Re=(s,e)=>{for(var t in e||(e={}))po.call(e,t)&&Or(s,t,e[t]);if(Pr)for(var t of Pr(e))mo.call(e,t)&&Or(s,t,e[t]);return s},_t=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const vo={maxAttempts:Be.RATE_LIMIT.MAX_ATTEMPTS,lockoutDuration:Be.RATE_LIMIT.LOCKOUT_DURATION_MINUTES,windowSize:Be.RATE_LIMIT.WINDOW_SIZE_MINUTES};class _o{constructor(e={}){this.config=Re(Re({},vo),e),this.distributedLimiter=new Ve({maxRequests:this.config.maxAttempts,windowMs:this.config.windowSize*60*1e3,keyPrefix:"auth",blockDurationMs:this.config.lockoutDuration*60*1e3})}checkRateLimit(e){return _t(this,null,function*(){try{const t=yield this.distributedLimiter.checkRateLimit(e);if(!t.allowed)return{isLocked:!0,remainingAttempts:0,lockoutTime:t.resetTime,error:`Too many failed attempts. Please try again in ${t.retryAfter||0} seconds.`};const{data:r,error:n}=yield A.from("login_attempts").select("*").eq("email",e).gte("attempted_at",new Date(Date.now()-this.config.windowSize*60*1e3).toISOString()).order("attempted_at",{ascending:!1}),o=(r||[]).filter(l=>!l.success);if(o.length>=this.config.maxAttempts){const l=o[0],a=new Date(l.attempted_at);if(a.setMinutes(a.getMinutes()+this.config.lockoutDuration),a>new Date)return{isLocked:!0,remainingAttempts:0,lockoutTime:a.getTime(),error:"Account temporarily locked due to repeated failed attempts. Please try again later."}}return{isLocked:!1,remainingAttempts:t.remaining}}catch(t){return{isLocked:!1,remainingAttempts:this.config.maxAttempts}}})}recordAttempt(e,t,r){return _t(this,null,function*(){try{const{error:n}=yield A.from("login_attempts").insert({email:e,success:t,attempted_at:new Date().toISOString(),ip_address:r||"unknown",user_agent:navigator.userAgent})}catch(n){}})}resetRateLimit(e){return _t(this,null,function*(){try{yield this.distributedLimiter.resetRateLimit(e);const{error:t}=yield A.from("login_attempts").delete().eq("email",e)}catch(t){}})}getConfig(){return Re({},this.config)}updateConfig(e){this.config=Re(Re({},this.config),e)}}const yo=new _o;const wo=s=>{try{console.log("[AUDIT]",s)}catch(e){}};function bo(s,e){const t=j.useRef();return j.useCallback((...n)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{s(...n)},e)},[s,e])}var So=(s,e,t)=>new Promise((r,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},o=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((t=t.apply(s,e)).next())});const ko=()=>{const[s,e]=j.useState(""),[t,r]=j.useState([]),[n,i]=j.useState(null),[o,l]=j.useState(!1);j.useEffect(()=>{const y=setTimeout(()=>{const m=W.getStoredToken();if(m)e(m);else{const p=W.generateToken();e(p),W.storeToken(p)}},0);return()=>clearTimeout(y)},[]);const a=(b,y)=>{Me()&&console.warn(`[SECURITY] ${b}:`,y);const m=Me()?y:{event_type:b,timestamp:new Date().toISOString(),has_details:Object.keys(y).length>0};wo({event:"security_event",timestamp:new Date().toISOString(),metadata:m})};j.useEffect(()=>{(()=>{const y=window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";l(y),!y&&!Me()&&a("non_https_connection",{protocol:window.location.protocol,hostname:window.location.hostname})})()},[]);const c=(b,y)=>{const m=[];if(b.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b.trim())||m.push("Please enter a valid email address."),y?y.length<6&&m.push("Password must be at least 6 characters long."):m.push("Password must be at least 6 characters long."),m.length>0)return{isValid:!1,email:b.trim(),password:y,errors:m};const p=br(b,"email"),T=br(y,"password");if(!p||!T)return{isValid:!1,email:p,password:T,errors:["Invalid email or password format"]};const k=Sr(p),P=Sr(T),M=[...k.threats,...P.threats];return M.length>0?(r(M),a("suspicious_input_detected",{email:p,threats:M}),{isValid:!1,email:p,password:T,errors:M}):(r([]),{isValid:!0,email:p,password:T,errors:[]})},u=bo(((b,y)=>c(b,y)),Be.VALIDATION.DEBOUNCE_MS),h=(b,y)=>c(b,y),g=b=>{const y=W.getStoredToken(),m=W.validateToken(b,y||"");if(!m){a("csrf_validation_failed",{providedToken:b,storedToken:y});const p=W.refreshToken();e(p)}return m},v=b=>So(null,null,function*(){try{const y=yield yo.checkRateLimit(b);return i(y),y.isLocked&&a("rate_limit_exceeded",{email:b,lockoutTime:y.lockoutTime}),y}catch(y){return console.error("Rate limit check failed:",y),{isLocked:!1,remainingAttempts:5}}}),_=()=>{r([])},S=()=>{W.clearToken(),e("")},w=j.useMemo(()=>{const b=t.length>0;return(n==null?void 0:n.isLocked)||!1?"locked":b?"warning":"secure"},[t,n]);return{csrfToken:s,securityWarnings:t,rateLimitInfo:n,isHttps:o,validateInputs:h,debouncedValidateInputs:u,validateCsrfToken:g,checkRateLimit:v,clearSecurityWarnings:_,clearCsrfToken:S,logSecurityEvent:a,getSecurityStatus:w}},ca=Object.freeze(Object.defineProperty({__proto__:null,CheckboxFields:ns,EmailField:ts,LoadingIndicator:fo,LoginPage:Cr,LoginProgressIndicator:ho,OfflineWarning:as,OtpField:is,PasswordField:ss,PasswordStrengthIndicator:rs,SecurityStatusIndicator:uo,SecurityWarnings:os,default:Cr,useLoginForm:Xr,useLoginSecurity:ko},Symbol.toStringTag,{value:"Module"}));export{na as A,Xo as B,ia as C,Ve as D,Ti as E,ea as F,Jo as G,Bo as H,ra as I,Fe as J,aa as K,Ci as L,vi as M,wi as N,$o as O,_i as P,la as Q,ca as R,Yr as S,oa as T,Lo as U,te as _,sa as a,ta as b,Mo as c,ae as d,Ho as e,Ko as f,Ee as g,Zo as h,Yo as i,Do as j,Uo as k,I as l,No as m,Fo as n,ki as o,Vo as p,ji as q,le as r,A as s,Me as t,bi as u,qo as v,Go as w,zo as x,Wo as y,Qo as z};
