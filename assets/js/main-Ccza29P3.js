const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/DistributedFacilityCache-DYqKeGgr.js","assets/js/login-CgiYf71G.js","assets/js/utils-5cl0BHpv.js","assets/js/vendor-DVtBqAv5.js","assets/js/data-Djiu4445.js","assets/js/ui-C2vLYFVP.js","assets/js/errors-BMV5cHgT.js","assets/js/authService-B9mj5ZCR.js","assets/js/TypedSupabaseAdapter-DJ9oE_b3.js","assets/js/SupabaseAdapter-7V6bNiYh.js","assets/js/inventoryTransformers-DOQvqmz5.js","assets/js/StaticDataAdapter-UKgpxBMN.js","assets/js/taskService-CY3Cvzc4.js","assets/js/aiTimeSavingsService-BGInQY2r.js","assets/js/homeMetricsService-B6TcB_5y.js","assets/js/homeSterilizationIntegration-QD1Y8JMp.js","assets/js/homeIntegrationService-Bc05rlN6.js","assets/js/InventoryServiceFactory-DPkVKHhf.js","assets/js/errorHandlingService-C6IddxfG.js","assets/js/settingsService-C5iKJBtU.js","assets/js/cleaningScheduleService-DS4nGG-h.js","assets/js/duplicatePreventionService-KgIY4Bki.js","assets/js/RecentActivity-DqTdtKMX.js","assets/js/BITestResults-DPyUKF8L.js","assets/js/ToolStatus-C_Mut_7j.js","assets/js/UploadBarcodeModal-BU05CzBS.js","assets/js/EnhancedTrackModal-9-SjMYXF.js","assets/js/useTrackedTools-DjXMslGR.js","assets/js/InventoryTableSection-BPAc0S6b.js","assets/css/InventoryTableSection-B4OH_j2L.css","assets/js/InventoryInsightsCard-QliZSKJ5.js","assets/js/CategoriesCard-BcMGllG7.js","assets/js/LibraryFilters-hT-W97ru.js","assets/js/LibraryHeader-ButSr6o-.js","assets/js/aiSuggestionsService-DbFZ1FuS.js","assets/js/ScannerPage-BduD6R5y.js","assets/js/ScannerPage-BR1FBpy6.js","assets/js/ScannerPage-MY8KBI34.js","assets/js/index-BlRRmNha.js","assets/js/index-Z2_bziUK.js","assets/js/index-CUvgBSxn.js","assets/js/index-DExgsR84.js","assets/js/AuthCallback-DmfVM3Uf.js","assets/js/HelpArticlePage-LqcqqjxR.js","assets/css/HelpArticlePage-04dAlKem.css"])))=>i.map(i=>d[i]);
var zf=Object.defineProperty,Bf=Object.defineProperties;var qf=Object.getOwnPropertyDescriptors;var Ds=Object.getOwnPropertySymbols;var Ko=Object.prototype.hasOwnProperty,Qo=Object.prototype.propertyIsEnumerable;var Go=(n,e,t)=>e in n?zf(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,re=(n,e)=>{for(var t in e||(e={}))Ko.call(e,t)&&Go(n,t,e[t]);if(Ds)for(var t of Ds(e))Qo.call(e,t)&&Go(n,t,e[t]);return n},Te=(n,e)=>Bf(n,qf(e));var Xe=(n,e)=>{var t={};for(var r in n)Ko.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Ds)for(var r of Ds(n))e.indexOf(r)<0&&Qo.call(n,r)&&(t[r]=n[r]);return t};var As=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});import{j as a,c as $r,A as Pa,m as Ye,n as or}from"./utils-5cl0BHpv.js";import{c as Uf,b as xo,a as h,R as X,d as Da,N as bo,e as js,u as In,L as dh,f as mn,B as Hf,h as Vf,i as _e}from"./vendor-DVtBqAv5.js";import{_ as L,s as _,o as eo,g as cr,u as Mr,l as O,h as Wf,i as Gf,j as Kf,k as Qf,m as Yf,n as Jf,p as Xf,q as Zf,S as eg,D as Os,r as ot,E as Es,L as tg,t as rg,v as ng,w as sg,x as ag,y as ig,z as og,A as lg,B as Yo,f as cg,d as dg,C as _s,G as ug,H as mg,I as hg,J as Jo,T as uh,K as pg,U as fg}from"./login-CgiYf71G.js";import{c as Et,u as gg,Q as yg,a as vg}from"./data-Djiu4445.js";import{I as N,m as Aa,a as mh,b as pt,c as Le,d as xn,e as xs,f as kr,g as _g,h as bs,i as Ft,j as xg,k as hh,l as Lt,n as to,o as ph,p as fh,q as gh,r as jn,s as bg,t as ro,u as yh,v as bn,w as wg,x as Sg,y as Cg,z as Xo,A as ws,B as Ig,C as ya,D as jg,E as Oa,F as vh,G as wn,H as Eg,J as wo,K as So,L as _h,M as Tg,N as xh,O as Sa,P as bh,Q as ut,R as Sn,S as wh,T as Ng,U as Sh,V as kg,W as Ca,X as Pg,Y as Dg,Z as no,_ as Ag,$ as Og,a0 as Co,a1 as Rg,a2 as $g,a3 as Ch,a4 as Mg,a5 as Fg,a6 as Lg,a7 as zg,a8 as Ih,a9 as jh,aa as Ka,ab as Bg,ac as qg,ad as Ug,ae as Io,af as Hg,ag as Zo,ah as Vg,ai as Wg,aj as Ss,ak as Eh,al as Gg,am as Kg,an as el,ao as tl,ap as Qg,aq as Yg}from"./errors-BMV5cHgT.js";import{G as Jg,a as Xg}from"./ui-C2vLYFVP.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Rs={},rl;function Zg(){if(rl)return Rs;rl=1;var n=Uf();return Rs.createRoot=n.createRoot,Rs.hydrateRoot=n.hydrateRoot,Rs}var ey=Zg();const ty=xo(ey),Th=h.createContext(void 0),ry=({children:n})=>{const[e,t]=X.useState("/"),[r,s]=X.useState(!0),i=X.useCallback(()=>{s(!0)},[]),l=X.useCallback(()=>{s(!1)},[]);return a.jsx(Th.Provider,{value:{currentPath:e,setCurrentPath:t,isDrawerOpen:r,openDrawer:i,closeDrawer:l},children:n})},Nh=()=>{const n=h.useContext(Th);if(!n)throw new Error("useNavigation must be used within NavigationProvider");return n};var Vr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ht{static getCurrentFacilityId(){return Vr(this,null,function*(){try{const{distributedFacilityCache:e}=yield L(()=>import("./DistributedFacilityCache-DYqKeGgr.js"),__vite__mapDeps([0,1,2,3,4,5,6])),{supabase:t}=yield L(()=>Promise.resolve().then(()=>ol),void 0),{data:{user:r},error:s}=yield t.auth.getUser();if(s||!r)return console.error("Failed to get current user:",s),"550e8400-e29b-41d4-a716-446655440000";const i=yield e.getFacility(`facility:${r.id}`);if(i)return i.id;const{data:l,error:c}=yield t.from("users").select("facility_id").eq("id",r.id).single();if(c||!(l!=null&&l.facility_id)){console.error("Failed to get current facility ID:",c);const o={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:"2024-01-01T00:00:00.000Z",updatedAt:"2024-01-01T00:00:00.000Z"};return yield e.setFacility(`facility:${r.id}`,o),"550e8400-e29b-41d4-a716-446655440000"}try{const o=yield ht.getFacilityById(l.facility_id);return yield e.setFacility(`facility:${r.id}`,o),l.facility_id}catch(o){console.error("Facility not found:",o);const d={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:"2024-01-01T00:00:00.000Z",updatedAt:"2024-01-01T00:00:00.000Z"};return yield e.setFacility(`facility:${r.id}`,d),"550e8400-e29b-41d4-a716-446655440000"}}catch(e){return console.error("Failed to get current facility ID:",e),"550e8400-e29b-41d4-a716-446655440000"}})}static getFacility(e){return Vr(this,null,function*(){return{id:e,name:"Test Facility",type:"hospital",isActive:!0,createdAt:"2024-01-01T00:00:00.000Z",updatedAt:"2024-01-01T00:00:00.000Z"}})}static getFacilityById(e){return Vr(this,null,function*(){return{id:e,name:"Test Facility",type:"hospital",isActive:!0,createdAt:"2024-01-01T00:00:00.000Z",updatedAt:"2024-01-01T00:00:00.000Z"}})}static getAllFacilities(e){return Vr(this,null,function*(){try{const{supabase:t}=yield L(()=>Promise.resolve().then(()=>ol),void 0),r=(e==null?void 0:e.page)||1,s=(e==null?void 0:e.limit)||50,i=(r-1)*s,l=i+s-1,{data:c,error:o,count:d}=yield t.from("facilities").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(i,l);if(o)throw o;const u=Math.ceil((d||0)/s);return{data:(c||[]).map(p=>({id:p.id,name:p.name,type:p.type,isActive:p.is_active,createdAt:p.created_at,updatedAt:p.updated_at})),total:d||0,page:r,limit:s,totalPages:u,hasNext:r<u,hasPrev:r>1}}catch(t){throw console.error("Failed to get all facilities:",t),t}})}static getCurrentUserId(){return Vr(this,null,function*(){return"user-123"})}static validateFacilityId(e){return!!(e&&e.length>0&&e!=="default-facility-id")}static clearCache(){return Vr(this,null,function*(){try{const{distributedFacilityCache:e}=yield L(()=>import("./DistributedFacilityCache-DYqKeGgr.js"),__vite__mapDeps([0,1,2,3,4,5,6]));yield e.clearAll()}catch(e){console.error("Failed to clear facility cache:",e)}})}}const It=Object.freeze(Object.defineProperty({__proto__:null,FacilityService:ht},Symbol.toStringTag,{value:"Module"}));var ny=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const kh=h.createContext(void 0),sy=({children:n})=>{const[e,t]=h.useState(null),[r,s]=h.useState(!0),[i,l]=h.useState(null),c=()=>(e==null?void 0:e.id)||null,o=()=>ny(null,null,function*(){var d;try{s(!0),l(null);const u=yield ht.getCurrentFacilityId();if(!u)throw new Error("No facility ID available - user not authenticated");const m=yield ht.getFacility(u);t(m),localStorage.setItem("currentFacility",JSON.stringify(m))}catch(u){if(console.warn("⚠️ Facility context error, using development fallback:",u),typeof window!="undefined"&&((d=window.location)==null?void 0:d.hostname)==="localhost"){console.warn("Using dev facility fallback in development/test mode");const p={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0};t(p),localStorage.setItem("currentFacility",JSON.stringify(p)),l(null)}else throw new Error("FacilityContext failed to resolve facility ID — no fallback allowed in production.")}finally{s(!1)}});return h.useEffect(()=>{if(typeof window!="undefined"&&window.location.pathname==="/login"){s(!1);return}o().catch(d=>{l(d.message)})},[]),a.jsx(kh.Provider,{value:{currentFacility:e,setCurrentFacility:t,getCurrentFacilityId:c,isLoading:r,error:i,refreshFacility:o},children:n})},Ph=()=>{const n=h.useContext(kh);if(!n)throw new Error("useFacility must be used within a FacilityProvider");return n};var ay=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const He=({children:n})=>{const e=Da(),[t,r]=h.useState(!0),[s,i]=h.useState(!1);return h.useEffect(()=>{let l=!1;return ay(null,null,function*(){try{const{data:{user:o},error:d}=yield _.auth.getUser();l||(d||!o?(console.warn("⚠️ ProtectedRoute: blocked due to invalid session"),i(!1),r(!1),yield eo.logSecurityEvent("security.protected_route_blocked","Blocked unauthenticated access attempt",{error:d==null?void 0:d.message,hasUser:!!o})):(i(!0),r(!1)))}catch(o){console.error("❌ ProtectedRoute session validation failed:",o),l||(i(!1),r(!1),yield eo.logSecurityEvent("security.protected_route_blocked","Protected route validation failed",{error:o instanceof Error?o.message:String(o)}))}}),()=>{l=!0}},[]),t?null:s?a.jsx(a.Fragment,{children:n}):a.jsx(bo,{to:"/login",state:{from:e},replace:!0})};var ft=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Qa{static getAvailableKits(e){return ft(this,null,function*(){const{data:t,error:r}=yield _.from("bi_test_kits").select("*").eq("facility_id",e).eq("status","active").gt("quantity",0).gt("expiry_date",new Date().toISOString().split("T")[0]).order("expiry_date",{ascending:!0});if(r)throw new Error(`Failed to get available BI test kits: ${r.message}`);return(t||[]).map(s=>({id:s.id,facility_id:s.facility_id,name:s.name,manufacturer:s.manufacturer,lot_number:s.lot_number,serial_number:s.serial_number||void 0,barcode:s.barcode||void 0,expiry_date:s.expiry_date,incubation_time_minutes:s.incubation_time_minutes,incubation_temperature_celsius:s.incubation_temperature_celsius,quantity:s.quantity,min_quantity:s.min_quantity,max_quantity:s.max_quantity,location:s.location||void 0,status:s.status,supplier:s.supplier||void 0,cost:s.cost||void 0,notes:s.notes||void 0,created_at:s.created_at,updated_at:s.updated_at,created_by:s.created_by||void 0,updated_by:s.updated_by||void 0}))})}static getKitById(e){return ft(this,null,function*(){const{data:t,error:r}=yield _.from("bi_test_kits").select("*").eq("id",e).single();if(r)throw new Error(`Failed to get BI test kit: ${r.message}`);if(!t)throw new Error("BI test kit not found");const s=t;return{id:s.id,facility_id:s.facility_id,name:s.name,manufacturer:s.manufacturer,lot_number:s.lot_number,serial_number:s.serial_number||void 0,barcode:s.barcode||void 0,expiry_date:s.expiry_date,incubation_time_minutes:s.incubation_time_minutes,incubation_temperature_celsius:s.incubation_temperature_celsius,quantity:s.quantity,min_quantity:s.min_quantity,max_quantity:s.max_quantity,location:s.location||void 0,status:s.status,supplier:s.supplier||void 0,cost:s.cost||void 0,notes:s.notes||void 0,created_at:s.created_at,updated_at:s.updated_at,created_by:s.created_by||void 0,updated_by:s.updated_by||void 0}})}static createKit(e){return ft(this,null,function*(){const t={facility_id:e.facility_id,name:e.name,manufacturer:e.manufacturer,lot_number:e.lot_number,serial_number:e.serial_number,barcode:e.barcode,expiry_date:e.expiry_date,incubation_time_minutes:e.incubation_time_minutes,incubation_temperature_celsius:e.incubation_temperature_celsius,quantity:e.quantity,min_quantity:e.min_quantity,max_quantity:e.max_quantity,location:e.location,status:e.status,supplier:e.supplier,cost:e.cost,notes:e.notes,created_by:e.created_by,updated_by:e.updated_by},{data:r,error:s}=yield _.from("bi_test_kits").insert(t).select().single();if(s)throw new Error(`Failed to create BI test kit: ${s.message}`);if(!r)throw new Error("No data returned from BI test kit creation");const i=r;return{id:i.id,facility_id:i.facility_id,name:i.name,manufacturer:i.manufacturer,lot_number:i.lot_number,serial_number:i.serial_number||void 0,barcode:i.barcode||void 0,expiry_date:i.expiry_date,incubation_time_minutes:i.incubation_time_minutes,incubation_temperature_celsius:i.incubation_temperature_celsius,quantity:i.quantity,min_quantity:i.min_quantity,max_quantity:i.max_quantity,location:i.location||void 0,status:i.status,supplier:i.supplier||void 0,cost:i.cost||void 0,notes:i.notes||void 0,created_at:i.created_at,updated_at:i.updated_at,created_by:i.created_by||void 0,updated_by:i.updated_by||void 0}})}static useKit(e){return ft(this,null,function*(){const{data:t,error:r}=yield _.from("bi_test_kits").select("quantity").eq("id",e).single();if(r||!t)throw new Error(`Failed to fetch BI test kit: ${(r==null?void 0:r.message)||"Kit not found"}`);const s=t;if(s.quantity<=0)throw new Error("BI test kit quantity is already 0");const{error:i}=yield _.from("bi_test_kits").update({quantity:s.quantity-1,updated_at:new Date().toISOString()}).eq("id",e);if(i)throw new Error(`Failed to update BI test kit quantity: ${i.message}`)})}static decrementKitQuantity(e){return ft(this,null,function*(){return this.useKit(e)})}static getCurrentTestConditions(){return ft(this,null,function*(){const{data:{user:e},error:t}=yield _.auth.getUser();if(t||!e)throw new Error("User not authenticated");const{data:r,error:s}=yield _.from("users").select("facility_id").eq("id",e.id).single();if(s||!r)throw new Error("User facility not found");const i=r;return{room_temperature_celsius:22,humidity_percent:45,equipment_used:"Standard Incubator",operator_id:e.id,facility_id:i.facility_id,test_date:new Date().toISOString(),environmental_notes:"Standard laboratory conditions"}})}static getFailureReason(){return ft(this,null,function*(){const e="Positive growth detected during incubation period";try{const t=yield this.getCurrentTestConditions();return`${e}. Test conducted at ${t.room_temperature_celsius}°C for standard incubation period.`}catch(t){return console.error(t),e}})}static getSkipReason(){return ft(this,null,function*(){return"Test skipped by operator - reason documented in compliance notes"})}static getComplianceNotes(){return ft(this,null,function*(){const e="BI test passed successfully - sterilization process validated";try{const t=yield this.getCurrentTestConditions();return`${e}. Test conditions: ${t.room_temperature_celsius}°C, standard incubation period.`}catch(t){return console.error(t),e}})}static checkKitInventory(e){return ft(this,null,function*(){const{data:t,error:r}=yield _.from("bi_test_kits").select("quantity, expiry_date, status").eq("facility_id",e);if(r)throw new Error(`Failed to check kit inventory: ${r.message}`);const s=t||[],i=s.filter(d=>d.status==="active"&&d.quantity>0&&new Date(d.expiry_date)>new Date).reduce((d,u)=>d+u.quantity,0),l=s.filter(d=>new Date(d.expiry_date)<=new Date).length,c=i<5,o=[];return c&&o.push("Order additional BI test kits to maintain adequate inventory"),l>0&&o.push(`Dispose of ${l} expired BI test kit(s)`),{available:i,low_stock:c,expired_count:l,recommendations:o}})}}var iy=Object.defineProperty,oy=Object.defineProperties,ly=Object.getOwnPropertyDescriptors,nl=Object.getOwnPropertySymbols,cy=Object.prototype.hasOwnProperty,dy=Object.prototype.propertyIsEnumerable,sl=(n,e,t)=>e in n?iy(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,uy=(n,e)=>{for(var t in e||(e={}))cy.call(e,t)&&sl(n,t,e[t]);if(nl)for(var t of nl(e))dy.call(e,t)&&sl(n,t,e[t]);return n},my=(n,e)=>oy(n,ly(e)),Wr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class En{static createBITestResult(e){return Wr(this,null,function*(){try{const r=new Date().toISOString().split("T")[0].replace(/-/g,""),s=Date.now().toString().slice(-6),i=`BI-${r}-${s}`,l={facility_id:e.facility_id,operator_id:e.operator_id,cycle_id:e.cycle_id||"00000000-0000-0000-0000-000000000000",test_number:i,test_date:e.test_date||new Date().toISOString(),result:e.result,bi_lot_number:e.bi_lot_number,bi_expiry_date:e.bi_expiry_date,incubation_time_minutes:e.incubation_time_minutes,incubation_temperature_celsius:e.incubation_temperature_celsius,test_conditions:e.test_conditions,failure_reason:e.failure_reason,skip_reason:e.skip_reason,compliance_notes:e.compliance_notes};console.log("🔍 Inserting BI test data:",JSON.stringify(l,null,2));const{data:c,error:o}=yield _.from("bi_test_results").insert(l).select().single();if(o)throw console.error("❌ Database error details:",o),o;if(!c||typeof c!="object")throw new Error("Invalid test result data");const d=c;return{id:d.id,facility_id:d.facility_id,operator_id:d.operator_id||void 0,cycle_id:d.cycle_id||void 0,test_number:d.test_number,test_date:d.test_date,result:d.result,status:d.status,bi_lot_number:d.bi_lot_number||void 0,bi_expiry_date:d.bi_expiry_date||void 0,incubation_time_minutes:d.incubation_time_minutes||void 0,incubation_temperature_celsius:d.incubation_temperature_celsius||void 0,test_conditions:d.test_conditions||{},failure_reason:d.failure_reason||void 0,skip_reason:d.skip_reason||void 0,compliance_notes:d.compliance_notes||void 0,audit_signature:d.audit_signature||void 0,created_at:d.created_at,updated_at:d.updated_at}}catch(t){throw console.error("Failed to create BI test result:",t),t}})}static updateBITestResult(e,t){return Wr(this,null,function*(){const{data:r,error:s}=yield _.from("bi_test_results").update(my(uy({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();if(s)throw new Error(`Failed to update BI test result: ${s.message}`);if(!r)throw new Error("No data returned from BI test result update");const i=r;return{id:i.id,facility_id:i.facility_id,operator_id:i.operator_id||void 0,cycle_id:i.cycle_id||void 0,test_number:i.test_number,test_date:i.test_date,result:i.result,status:i.status,bi_lot_number:i.bi_lot_number||void 0,bi_expiry_date:i.bi_expiry_date||void 0,incubation_time_minutes:i.incubation_time_minutes||void 0,incubation_temperature_celsius:i.incubation_temperature_celsius||void 0,test_conditions:i.test_conditions||{},failure_reason:i.failure_reason||void 0,skip_reason:i.skip_reason||void 0,compliance_notes:i.compliance_notes||void 0,audit_signature:i.audit_signature||void 0,created_at:i.created_at,updated_at:i.updated_at}})}static getBITestResults(){return Wr(this,arguments,function*(e={}){let t=_.from("bi_test_results").select(`
        *,
        facilities(name, facility_code),
        operators(name, role),
        sterilization_cycles(cycle_number, cycle_type)
      `).order("test_date",{ascending:!1});e.facility_id&&(t=t.eq("facility_id",e.facility_id)),e.operator_id&&(t=t.eq("operator_id",e.operator_id)),e.cycle_id&&(t=t.eq("cycle_id",e.cycle_id)),e.result&&(t=t.eq("result",e.result)),e.status&&(t=t.eq("status",e.status)),e.start_date&&(t=t.gte("test_date",e.start_date)),e.end_date&&(t=t.lte("test_date",e.end_date)),e.limit&&(t=t.limit(e.limit)),e.offset&&(t=t.range(e.offset,e.offset+(e.limit||10)-1));const{data:r,error:s}=yield t;if(s)throw new Error(`Failed to fetch BI test results: ${s.message}`);return(r||[]).map(i=>({id:i.id,facility_id:i.facility_id,operator_id:i.operator_id||void 0,cycle_id:i.cycle_id||void 0,test_number:i.test_number,test_date:i.test_date,result:i.result,status:i.status,bi_lot_number:i.bi_lot_number||void 0,bi_expiry_date:i.bi_expiry_date||void 0,incubation_time_minutes:i.incubation_time_minutes||void 0,incubation_temperature_celsius:i.incubation_temperature_celsius||void 0,test_conditions:i.test_conditions||{},failure_reason:i.failure_reason||void 0,skip_reason:i.skip_reason||void 0,compliance_notes:i.compliance_notes||void 0,audit_signature:i.audit_signature||void 0,created_at:i.created_at,updated_at:i.updated_at}))})}static getBITestResult(e){return Wr(this,null,function*(){try{const{data:t,error:r}=yield _.from("bi_test_results").select("*").eq("id",e).single();if(r){if(r.code==="PGRST116")return null;throw r}if(!t||typeof t!="object")return null;const s=t;return{id:s.id,facility_id:s.facility_id,operator_id:s.operator_id||void 0,cycle_id:s.cycle_id||void 0,test_number:s.test_number,test_date:s.test_date,result:s.result,status:s.status,bi_lot_number:s.bi_lot_number||void 0,bi_expiry_date:s.bi_expiry_date||void 0,incubation_time_minutes:s.incubation_time_minutes||void 0,incubation_temperature_celsius:s.incubation_temperature_celsius||void 0,test_conditions:s.test_conditions||{},failure_reason:s.failure_reason||void 0,skip_reason:s.skip_reason||void 0,compliance_notes:s.compliance_notes||void 0,audit_signature:s.audit_signature||void 0,created_at:s.created_at,updated_at:s.updated_at}}catch(t){throw console.error("Failed to get BI test result:",t),t}})}static deleteBITestResult(e){return Wr(this,null,function*(){const{error:t}=yield _.from("bi_test_results").delete().eq("id",e);if(t)throw new Error(`Failed to delete BI test result: ${t.message}`)})}static generateTestNumber(e){return Wr(this,null,function*(){const t=new Date,r=t.toISOString().split("T")[0].replace(/-/g,""),{count:s,error:i}=yield _.from("bi_test_results").select("*",{count:"exact",head:!0}).eq("facility_id",e).gte("test_date",t.toISOString().split("T")[0]).lt("test_date",new Date(t.getTime()+1440*60*1e3).toISOString().split("T")[0]);if(i)throw new Error(`Failed to generate test number: ${i.message}`);return`BI-${r}-${String((s!=null?s:0)+1).padStart(3,"0")}`})}}var Gr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Ts={getBIPassRate(n){return Gr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("id").eq("facility_id",n).eq("result","pass");return t?{data:null,error:t}:{data:e.length,error:null}})},getBIPassRateAnalytics(n){return Gr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",n);if(t)return{data:null,error:t};const r=e.length,s=e.filter(l=>l.result==="pass").length,i=r>0?s/r*100:0;return{data:{totalTests:r,passedTests:s,passRate:i,facilityId:n},error:null}})},getOperatorPerformance(n,e){return Gr(this,null,function*(){const{data:t,error:r}=yield _.from("bi_test_results").select("*").eq("facility_id",n).eq("operator_id",e);return r?{data:null,error:r}:{data:t,error:null}})},getBITestAnalytics(n){return Gr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",n);return t?{data:null,error:t}:{data:{totalTests:e.length,passedTests:e.filter(s=>s.result==="pass").length,failedTests:e.filter(s=>s.result==="fail").length,facilityId:n},error:null}})},getAITrainingData(n){return Gr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",n);return t?{data:null,error:t}:{data:e.map(s=>({id:s.id,facilityId:s.facility_id,operatorId:s.operator_id,result:s.result,timestamp:s.created_at,features:{incubationTemperature:s.incubation_temperature_celsius,incubationTime:s.incubation_time_minutes,testConditions:s.test_conditions,status:s.status}})),error:null}})},getPredictiveAnalyticsData(n){return Gr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",n).order("created_at",{ascending:!1}).limit(100);if(t)return{data:null,error:t};const r=e.length,s=e.slice(0,30),i=s.length>0?s.filter(c=>c.result==="pass").length/s.length*100:0;return{data:{facilityId:n,totalTests:r,recentPassRate:i,trendAnalysis:{isImproving:i>80,riskLevel:i<70?"high":i<85?"medium":"low"},recommendations:i<70?["Review sterilization procedures","Check equipment calibration","Retrain operators"]:i<85?["Monitor trends closely","Consider preventive maintenance"]:["Maintain current procedures"]},error:null}})}};var hr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class qt{static getFacilities(){return hr(this,null,function*(){return[{id:"default-facility",name:"Default Facility",facility_code:"DF001",address:void 0,contact_email:void 0,contact_phone:void 0,compliance_requirements:{},settings:{},is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]})}static getOperators(e){return hr(this,null,function*(){const{data:t,error:r}=yield _.from("users").select("*").eq("facility_id",e).eq("is_active",!0).order("first_name");if(r)throw new Error(`Failed to fetch operators: ${r.message}`);return(t||[]).map(s=>{var i,l,c,o,d;return{id:s.id||"",facility_id:s.facility_id,user_id:s.id||void 0,name:s.full_name||`${s.first_name||""} ${s.last_name||""}`.trim(),email:s.email||void 0,role:((i=s.preferences)==null?void 0:i.role)||"operator",certification_number:((l=s.preferences)==null?void 0:l.certification_number)||void 0,certification_expiry:((c=s.preferences)==null?void 0:c.certification_expiry)||void 0,permissions:((o=s.preferences)==null?void 0:o.permissions)||{},performance_metrics:((d=s.preferences)==null?void 0:d.performance_metrics)||{},is_active:s.is_active||!1,created_at:s.created_at||"",updated_at:s.updated_at||""}})})}static getSterilizationCycles(e,t=50){return hr(this,null,function*(){const r=`${e}-${t}`,s=this.cache.get(r);if(s&&Date.now()-s.timestamp<this.CACHE_DURATION)return s.data;const{data:i,error:l}=yield _.from("sterilization_cycles").select("id, cycle_number, start_time, end_time, status, parameters, tools").eq("facility_id",e).order("start_time",{ascending:!1}).limit(t);if(l)throw new Error(`Failed to fetch sterilization cycles: ${l.message}`);const c=(i||[]).map(o=>({id:o.id,facility_id:o.facility_id||"",operator_id:o.operator_id||void 0,cycle_number:o.cycle_number||"",cycle_type:o.cycle_type||"standard",status:o.status||"pending",start_time:o.start_time||"",end_time:o.end_time||void 0,phases:o.parameters||[],tools:o.tools||[],cycle_parameters:o.parameters||{},environmental_factors:o.results||{},notes:o.notes||void 0,created_at:o.created_at||"",updated_at:o.updated_at||""}));return this.cache.set(r,{data:c,timestamp:Date.now()}),c})}static createSterilizationCycle(e){return hr(this,null,function*(){const t=yield this.generateCycleNumber(e.facility_id),r={id:crypto.randomUUID(),facility_id:e.facility_id,operator_id:e.operator_id||"",cycle_type:e.cycle_type||"standard",cycle_number:t,start_time:new Date().toISOString(),status:e.status||"pending",parameters:e.cycle_parameters||{},results:e.environmental_factors||{},tools:e.tools||[],notes:e.notes,autoclave_id:"default-autoclave",tool_batch_id:"default-batch"},{data:s,error:i}=yield _.from("sterilization_cycles").insert(r).select().single();if(i)throw new Error(`Failed to create sterilization cycle: ${i.message}`);if(!s)throw new Error("No data returned from sterilization cycle creation");const l=s;return{id:l.id,facility_id:l.facility_id||"",operator_id:l.operator_id||void 0,cycle_number:l.cycle_number||"",cycle_type:l.cycle_type||"standard",status:l.status||"pending",start_time:l.start_time||"",end_time:l.end_time||void 0,phases:l.tools||[],tools:l.tools||[],cycle_parameters:l.parameters||{},environmental_factors:l.results||{},notes:l.notes||void 0,created_at:l.created_at||"",updated_at:l.updated_at||""}})}static getEquipment(e){return hr(this,null,function*(){return[]})}static getComplianceAudits(e){return hr(this,null,function*(){const{data:t,error:r}=yield _.from("audit_logs").select("*").eq("facility_id",e).order("created_at",{ascending:!1});if(r)throw new Error(`Failed to fetch compliance audits: ${r.message}`);return(t||[]).map(s=>{var i,l,c,o,d,u,m,p,f;return{id:s.id||"",facility_id:s.facility_id||"",audit_type:((i=s.metadata)==null?void 0:i.audit_type)||"daily",audit_date:s.created_at,auditor_id:(l=s.user_id)!=null?l:"system",audit_scope:((c=s.metadata)==null?void 0:c.audit_scope)||{},findings:((o=s.metadata)==null?void 0:o.findings)||[],compliance_score:((d=s.metadata)==null?void 0:d.compliance_score)||void 0,recommendations:((u=s.metadata)==null?void 0:u.recommendations)||void 0,corrective_actions:((m=s.metadata)==null?void 0:m.corrective_actions)||[],follow_up_date:((p=s.metadata)==null?void 0:p.follow_up_date)||void 0,status:((f=s.metadata)==null?void 0:f.status)||"pending",created_at:s.created_at,updated_at:s.updated_at||""}})})}static generateCycleNumber(e){return hr(this,null,function*(){const t=new Date,r=t.toISOString().split("T")[0].replace(/-/g,""),{count:s,error:i}=yield _.from("sterilization_cycles").select("*",{count:"exact",head:!0}).eq("facility_id",e).gte("start_time",t.toISOString().split("T")[0]).lt("start_time",new Date(t.getTime()+1440*60*1e3).toISOString().split("T")[0]);if(i)throw new Error(`Failed to generate cycle number: ${i.message}`);return`CYCLE-${r}-${String((s!=null?s:0)+1).padStart(3,"0")}`})}}qt.cache=new Map;qt.CACHE_DURATION=300*1e3;var al,il;const hy=(al=void 0)!=null?al:"",py=(il=void 0)!=null?il:"",Dh=()=>({url:hy,anonKey:py}),jt=()=>{function n(){let r=cr("VITE_SUPABASE_URL",""),s=cr("VITE_SUPABASE_ANON_KEY","");if(!r||!s){const i=Dh();r=i.url,s=i.anonKey}return{supabaseUrl:r,supabaseAnonKey:s}}const{supabaseUrl:e,supabaseAnonKey:t}=n();return!!(e&&t&&e!=="https://mock.supabase.co")},fy=()=>{function n(){let t=cr("VITE_SUPABASE_URL",""),r=cr("VITE_SUPABASE_ANON_KEY","");if(!t||!r){const s=Dh();t=s.url,r=s.anonKey}return{supabaseUrl:t,supabaseAnonKey:r}}const{supabaseUrl:e}=n();return e||""},Ah=n=>typeof n=="string"?new Error(n):n!=null&&n.message?new Error(n.message):typeof n=="object"&&"error_description"in n&&n.error_description?new Error(n.error_description):new Error("An unexpected error occurred with Supabase"),ol=Object.freeze(Object.defineProperty({__proto__:null,getSupabaseUrl:fy,handleSupabaseError:Ah,isSupabaseConfigured:jt,supabase:_},Symbol.toStringTag,{value:"Module"}));class Ia{static subscribe(e,t,r){r!=null&&r.event;const s=_.channel(e).on("postgres_changes",{event:"*",schema:"public"},t).subscribe();return this.subscriptions.push(s),()=>{this.unsubscribe(s)}}static unsubscribe(e){e&&typeof e=="object"&&"unsubscribe"in e&&e.unsubscribe(),this.subscriptions=this.subscriptions.filter(t=>t!==e)}static forceCleanup(){this.subscriptions.forEach(e=>{e&&typeof e=="object"&&"unsubscribe"in e&&e.unsubscribe()}),this.subscriptions=[]}static getStats(){return{activeChannels:this.subscriptions.length,totalChannels:this.subscriptions.length,totalSubscribers:this.subscriptions.length,tableSubscribers:{},subscriptions:this.subscriptions,performance:{isHealthy:this.subscriptions.length<50,warnings:this.subscriptions.length>30?["High subscription count"]:[],recommendations:this.subscriptions.length>20?["Consider cleanup"]:[]}}}static cleanup(){this.forceCleanup()}static globalCleanup(){this.forceCleanup()}static nuclearCleanup(){console.warn("☢️ NUCLEAR CLEANUP: Force-disconnecting all realtime connections"),this.forceCleanup()}}Ia.subscriptions=[];class Oh{static subscribeToBITestChanges(e){if(!jt()){console.warn("⚠️ Supabase not configured, skipping BI test subscription");return}try{return Ia.subscribe("bi_test_results",e,{event:"*"})}catch(t){return console.error("❌ Failed to subscribe to BI test changes:",t),null}}static subscribeToCycleChanges(e){if(!jt()){console.warn("⚠️ Supabase not configured, skipping cycle subscription");return}try{return Ia.subscribe("sterilization_cycles",e,{event:"*"})}catch(t){return console.error("❌ Failed to subscribe to cycle changes:",t),null}}}class pe{}pe.createBITestResult=En.createBITestResult;pe.updateBITestResult=En.updateBITestResult;pe.getBITestResults=En.getBITestResults;pe.getBITestResult=En.getBITestResult;pe.deleteBITestResult=En.deleteBITestResult;pe.getBIPassRateAnalytics=Ts.getBIPassRateAnalytics;pe.getOperatorPerformance=Ts.getOperatorPerformance;pe.getBITestAnalytics=Ts.getBITestAnalytics;pe.getAITrainingData=Ts.getAITrainingData;pe.getPredictiveAnalyticsData=Ts.getPredictiveAnalyticsData;pe.getFacilities=qt.getFacilities;pe.getOperators=qt.getOperators;pe.getSterilizationCycles=qt.getSterilizationCycles;pe.createSterilizationCycle=qt.createSterilizationCycle;pe.getEquipment=qt.getEquipment;pe.getComplianceAudits=qt.getComplianceAudits;pe.subscribeToBITestChanges=Oh.subscribeToBITestChanges;pe.subscribeToCycleChanges=Oh.subscribeToCycleChanges;const ll=n=>{if(!n)return null;const e=localStorage.getItem("officeHoursSettings");if(!e)return cl(n,{workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},startHour:8,endHour:17});const t=JSON.parse(e);return cl(n,t)},cl=(n,e)=>{const t=new Date(n);return t.setHours(t.getHours()+24),gy(t,e)},gy=(n,e)=>{const t=new Date(n),r=t.getDay(),s=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i=s[r];if(!e.workingDays[i]){let o=1;for(;o<=7;){const d=new Date(t);d.setDate(d.getDate()+o);const u=d.getDay(),m=s[u];if(e.workingDays[m])return t.setDate(t.getDate()+o),t.setHours(e.startHour,0,0,0),t;o++}}const c=t.getHours();if(c<e.startHour)t.setHours(e.startHour,0,0,0);else if(c>=e.endHour){let o=1;for(;o<=7;){const d=new Date(t);d.setDate(d.getDate()+o);const u=d.getDay(),m=s[u];if(e.workingDays[m])return t.setDate(t.getDate()+o),t.setHours(e.startHour,0,0,0),t;o++}}return t},LR=n=>{const e=new Date,t=n.getTime()-e.getTime(),r=Math.ceil(t/(1e3*60*60*24));return r===0?"Today":r===1?"Tomorrow":r<7?n.toLocaleDateString("en-US",{weekday:"long"}):n.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};var yy=Object.defineProperty,vy=Object.defineProperties,_y=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,xy=Object.prototype.hasOwnProperty,by=Object.prototype.propertyIsEnumerable,ul=(n,e,t)=>e in n?yy(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Pn=(n,e)=>{for(var t in e||(e={}))xy.call(e,t)&&ul(n,t,e[t]);if(dl)for(var t of dl(e))by.call(e,t)&&ul(n,t,e[t]);return n},Dn=(n,e)=>vy(n,_y(e)),Ya=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const wy=n=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null,setBiTestCompleted:e=>n({biTestCompleted:e}),setBiTestDate:e=>n({biTestDate:e}),recordBITestResult:e=>Ya(null,null,function*(){console.log("🔬 recordBITestResult called with:",e);try{const{data:{user:t},error:r}=yield _.auth.getUser();if(r||!t)throw new Error("User not authenticated");const s="550e8400-e29b-41d4-a716-446655440000",i={facility_id:s};let l=[],c=null,o=null;try{l=yield Qa.getAvailableKits(i.facility_id),l.length>0&&(c=l[0],o=yield Qa.getCurrentTestConditions())}catch(m){console.error(m),c={id:"default-kit",facility_id:i.facility_id,name:"Default BI Kit",manufacturer:"Default Manufacturer",lot_number:"DEFAULT-001",expiry_date:new Date(Date.now()+365*24*60*60*1e3).toISOString(),incubation_time_minutes:60,incubation_temperature_celsius:37,quantity:1,min_quantity:1,max_quantity:100,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},o={room_temperature_celsius:22,humidity_percent:45,equipment_used:"Default Equipment",operator:t.id,operator_id:t.id,facility_id:i.facility_id,test_date:new Date().toISOString()}}const d={facility_id:s,operator:t.id,test_date:new Date().toISOString(),result:e.status==="pending"?"pass":e.status,bi_lot_number:(c==null?void 0:c.lot_number)||"",bi_expiry_date:(c==null?void 0:c.expiry_date)||null,incubation_time_minutes:(c==null?void 0:c.incubation_time_minutes)||60,incubation_temperature_celsius:(c==null?void 0:c.incubation_temperature_celsius)||37,test_conditions:o||void 0,failure_reason:e.status==="fail"?"BI test failed":void 0,skip_reason:e.status==="skip"?"BI test skipped":void 0,compliance_notes:e.status==="pass"?"BI test passed":void 0},u=yield pe.createBITestResult(d);if(c&&c.id!=="default-kit")try{yield Qa.decrementKitQuantity(c.id)}catch(m){console.error(m)}return n(m=>{const p=ll(e.date),f={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:e.passed?"BI Test Passed":"BI Test Failed",time:e.date,toolCount:1,color:e.passed?"bg-green-500":"bg-red-500"},g=Dn(Pn({},e),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});return{biTestCompleted:e.passed,biTestDate:e.date.toISOString(),biTestResults:[...m.biTestResults,g],lastBITestDate:e.date.toISOString(),nextBITestDue:p,biTestPassed:e.passed,activityLog:[f,...m.activityLog].slice(0,20)}}),u}catch(t){throw console.error("Error recording BI test result:",t),n(r=>{const s=ll(e.date),i={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:e.passed?"BI Test Passed":"BI Test Failed",time:e.date,toolCount:1,color:e.passed?"bg-green-500":"bg-red-500"},l=Dn(Pn({},e),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});return{biTestCompleted:e.passed,biTestDate:e.date.toISOString(),biTestResults:[...r.biTestResults,l],lastBITestDate:e.date.toISOString(),nextBITestDue:s,biTestPassed:e.passed,activityLog:[i,...r.activityLog].slice(0,20)}}),t}}),setNextBITestDue:e=>n({nextBITestDue:e}),setLastBITestDate:e=>n({lastBITestDate:e}),setBiTestPassed:e=>n({biTestPassed:e}),setBiTestOptedOut:e=>n({biTestOptedOut:e}),addActivity:e=>n(t=>({activityLog:[Dn(Pn({},e),{id:e.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),...t.activityLog].slice(0,20)})),activateBIFailure:e=>n(()=>({biFailureActive:!0,biFailureDetails:{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,failure_date:new Date,affected_tools_count:e.affectedToolsCount,affected_batch_ids:e.affectedBatchIds,detected_by_operator_id:e.operator,facility_id:"unknown",incident_number:`BI-${Date.now()}`,severity_level:"high",status:"active",resolution_notes:null,resolved_at:null,resolved_by:null}})),deactivateBIFailure:()=>n(()=>({biFailureActive:!1,biFailureDetails:null})),loadBIFailureIncidents:e=>Ya(null,null,function*(){try{const{data:t,error:r}=yield _.from("bi_failure_incidents").select("*").eq("facility_id",e).eq("status","resolved").gte("resolved_at",new Date(Date.now()-2592e6).toISOString()).order("resolved_at",{ascending:!1}).limit(20);if(r){console.error("Failed to load BI failure incidents:",r);return}n(s=>{const i=new Set(s.activityLog.map(o=>o.id)),l=[];(t||[]).forEach(o=>{var d;const u=`bi-incident-resolved-${o.id}`;i.has(u)||l.push({id:u,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date(String(o.resolved_at||o.updated_at)),toolCount:((d=o.metadata)==null?void 0:d.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:o.id,operatorId:o.resolved_by_operator,resolutionNotes:o.resolution_notes}})});const c=[...l,...s.activityLog].sort((o,d)=>new Date(d.time).getTime()-new Date(o.time).getTime()).slice(0,20);return Dn(Pn({},s),{activityLog:c})})}catch(t){console.error("Error loading BI failure incidents:",t)}}),loadBITestResults:e=>Ya(null,null,function*(){try{const{data:t,error:r}=yield _.from("bi_test_results").select("*").eq("facility_id",e).order("test_date",{ascending:!1}).limit(50);if(r){console.error("Failed to load BI test results:",r);return}const s=(t||[]).map(i=>({id:String(i.id),facility_id:String(i.facility_id),test_number:String(i.test_number),test_date:String(i.test_date),result:String(i.result),status:String(i.result),operator:String(i.operator),cycle_id:String(i.cycle_id),bi_lot_number:String(i.bi_lot_number),bi_expiry_date:String(i.bi_expiry_date),incubation_time_minutes:Number(i.incubation_time_minutes),incubation_temperature_celsius:Number(i.incubation_temperature_celsius),test_conditions:i.test_conditions||{},failure_reason:String(i.failure_reason),skip_reason:String(i.skip_reason),compliance_notes:String(i.compliance_notes),date:new Date(String(i.test_date)),toolId:String(i.test_number||"default-tool"),passed:i.result==="pass",notes:String(i.compliance_notes||i.failure_reason||i.skip_reason),created_at:String(i.created_at),updated_at:String(i.updated_at)}));n(i=>{const l=new Set(i.activityLog.map(d=>d.id)),c=[];s.forEach(d=>{const u=`bi-test-${d.id}`;l.has(u)||c.push({id:u,type:"bi-test",title:d.passed?"BI Test Passed":"BI Test Failed",time:new Date(String(d.test_date)),toolCount:1,color:d.passed?"bg-green-500":"bg-red-500",metadata:{testNumber:String(d.test_number),operatorId:d.operator}})});const o=[...c,...i.activityLog].sort((d,u)=>new Date(u.time).getTime()-new Date(d.time).getTime()).slice(0,20);return Dn(Pn({},i),{biTestResults:s,activityLog:o})})}catch(t){console.error("Error loading BI test results:",t)}}),syncBIFailureFromDatabase:e=>n({biFailureActive:e.status==="active",biFailureDetails:e.status==="active"?{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,facility_id:"",incident_number:"",failure_date:e.failure_date,affected_tools_count:e.affected_tools_count,affected_batch_ids:e.affected_batch_ids,detected_by_operator_id:e.detected_by_operator||"System Alert",severity_level:"medium",status:e.status||"active",regulatory_notification_required:!1,regulatory_notification_sent:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}:null}),resetBIState:()=>n(()=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null}))});var ml=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Sy=n=>({enforceCi:!1,enforceBi:!1,allowOverrides:!0,loading:!1,fetchComplianceSettings:e=>ml(null,null,function*(){var t,r,s;n({loading:!0});const{data:i,error:l}=yield _.from("facility_compliance_settings").select("enforce_ci, enforce_bi, allow_overrides").eq("facility_id",e).maybeSingle();l?console.error("Failed to fetch compliance settings:",l.message):n(i?{enforceCi:(t=i.enforce_ci)!=null?t:!1,enforceBi:(r=i.enforce_bi)!=null?r:!1,allowOverrides:(s=i.allow_overrides)!=null?s:!0}:{enforceCi:!1,enforceBi:!1,allowOverrides:!0}),n({loading:!1})}),updateComplianceSettings:(e,t)=>ml(null,null,function*(){var r,s,i;const{error:l}=yield _.from("facility_compliance_settings").upsert({facility_id:e,enforce_ci:t.enforceCi,enforce_bi:t.enforceBi,allow_overrides:t.allowOverrides,updated_at:new Date().toISOString()},{onConflict:"facility_id"});l?console.error("Failed to update compliance settings:",l.message):n({enforceCi:(r=t.enforceCi)!=null?r:!1,enforceBi:(s=t.enforceBi)!=null?s:!1,allowOverrides:(i=t.allowOverrides)!=null?i:!0})})}),Cy=(n,e)=>{if(n.duration<=0)throw new Error(`${e} has invalid duration`);if(n.temperature!==void 0&&(n.temperature<30||n.temperature>150))throw new Error(`${e} has unsafe temperature`);if(n.pressure!==void 0&&(n.pressure<5||n.pressure>30))throw new Error(`${e} has unsafe pressure`)},we={bath1:{name:"Bath 1",duration:1,temperature:60,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},bath2:{name:"Bath 2",duration:1,temperature:65,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},drying:{name:"Drying",duration:1,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},autoclave:{name:"Autoclave",duration:1,temperature:121,pressure:15,requiresCI:!0,requiresBI:!0,requiresCiStrip:!0,requiresBiTest:!0}};Object.entries(we).forEach(([n,e])=>{Cy(e,n)});const Rh={bath1:{label:we.bath1.name,duration:we.bath1.duration*60},bath2:{label:we.bath2.name,duration:we.bath2.duration*60},drying:{label:we.drying.name,duration:we.drying.duration*60},autoclave:{label:we.autoclave.name,duration:we.autoclave.duration*60}},Iy=()=>{const e=new Date().toISOString().split("T")[0].replace(/-/g,""),t=`cycle_count_${e}`,s=parseInt(localStorage.getItem(t)||"0")+1;return localStorage.setItem(t,s.toString()),`CYCLE-${e}-${String(s).padStart(3,"0")}`},so=n=>{const e=`cycle_${Date.now()}`,t=Iy();return{id:e,cycleNumber:t,phases:[],tools:[],operator:n,startTime:new Date,completedAt:null}},jy=(n,e,t,r=[])=>({id:n,name:e,duration:t,tools:r,isActive:!1,startTime:null,endTime:null,status:"pending"}),Ey=n=>({bath1:{name:we.bath1.name,duration:we.bath1.duration*60},bath2:{name:we.bath2.name,duration:we.bath2.duration*60},drying:{name:we.drying.name,duration:we.drying.duration*60},autoclave:{name:we.autoclave.name,duration:we.autoclave.duration*60}})[n],Ty=n=>{const e=["bath1","bath2","drying","autoclave"],t=e.indexOf(n);return e[t+1]||null},ao=n=>n.phases.some(e=>e.id==="autoclave");var Ny=Object.defineProperty,ky=Object.defineProperties,Py=Object.getOwnPropertyDescriptors,hl=Object.getOwnPropertySymbols,Dy=Object.prototype.hasOwnProperty,Ay=Object.prototype.propertyIsEnumerable,pl=(n,e,t)=>e in n?Ny(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Wt=(n,e)=>{for(var t in e||(e={}))Dy.call(e,t)&&pl(n,t,e[t]);if(hl)for(var t of hl(e))Ay.call(e,t)&&pl(n,t,e[t]);return n},Gt=(n,e)=>ky(n,Py(e)),Oy=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Ry=(n,e,t)=>({setCurrentCycle:r=>n(s=>Gt(Wt({},s),{currentCycle:r})),setError:r=>n(s=>Gt(Wt({},s),{error:r})),startNewCycle:r=>{const s=so(r);n(i=>Gt(Wt({},i),{currentCycle:s}))},addToolToCycle:r=>{n(s=>{const i=s.currentCycle;if(!i){const l=so("Current Operator");return l.tools=[r],e(),Gt(Wt({},s),{currentCycle:l})}if(!i.tools.includes(r)){const l=Gt(Wt({},i),{tools:[...i.tools,r]});return e(),Gt(Wt({},s),{currentCycle:l})}return s})},loadCycles:r=>Oy(null,null,function*(){try{const i=(yield qt.getSterilizationCycles(r)).map(l=>({id:l.id,cycleNumber:l.cycle_number,phases:Array.isArray(l.phases)?l.phases.map(c=>({id:c.id,name:c.name,duration:c.duration,tools:Array.isArray(c.tools)?c.tools.map(o=>String(o)):[],isActive:c.isActive,startTime:c.startTime?new Date(c.startTime):null,endTime:c.endTime?new Date(c.endTime):null,status:c.status})):[],tools:Array.isArray(l.tools)?l.tools.map(c=>c.id):[],operator:l.operator_id||"Unknown",startTime:l.start_time?new Date(l.start_time):new Date,completedAt:l.end_time||null,batchId:l.cycle_number}));n(l=>Gt(Wt({},l),{cycles:i}))}catch(s){console.error("Failed to load sterilization cycles:",s),n(i=>Gt(Wt({},i),{error:s instanceof Error?s.message:"Failed to load cycles"}))}})});var $y=Object.defineProperty,My=Object.defineProperties,Fy=Object.getOwnPropertyDescriptors,fl=Object.getOwnPropertySymbols,Ly=Object.prototype.hasOwnProperty,zy=Object.prototype.propertyIsEnumerable,gl=(n,e,t)=>e in n?$y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ne=(n,e)=>{for(var t in e||(e={}))Ly.call(e,t)&&gl(n,t,e[t]);if(fl)for(var t of fl(e))zy.call(e,t)&&gl(n,t,e[t]);return n},ke=(n,e)=>My(n,Fy(e));const By=(n,e,t)=>({addPhaseToCycle:(r,s,i)=>{n(l=>{if(!l.currentCycle){const p=e().availableTools.filter(g=>g.currentPhase==="bath1").map(g=>g.id),f=so("Current Operator");return f.tools=p,ke(Ne({},l),{currentCycle:f})}if(l.currentCycle.phases.find(m=>m.id===r))return l;const o=jy(r,s,i,[...l.currentCycle.tools]),d=[...l.currentCycle.phases,o],u=ke(Ne({},l.currentCycle),{phases:d});return ke(Ne({},l),{currentCycle:u})})},startPhase:r=>{n(s=>{if(!s.currentCycle)return s;const i=s.currentCycle.phases.map(l=>l.id===r?ke(Ne({},l),{isActive:!0,startTime:new Date,status:"active"}):l);return ke(Ne({},s),{currentCycle:ke(Ne({},s.currentCycle),{phases:i})})})},completePhase:r=>{n(s=>{if(!s.currentCycle)return s;const i=s.currentCycle.phases.map(l=>l.id===r?ke(Ne({},l),{isActive:!1,endTime:new Date,status:"completed"}):l);return ke(Ne({},s),{currentCycle:ke(Ne({},s.currentCycle),{phases:i})})})},pausePhase:r=>{n(s=>{if(!s.currentCycle)return s;const i=s.currentCycle.phases.map(l=>l.id===r?ke(Ne({},l),{isActive:!1,status:"paused"}):l);return ke(Ne({},s),{currentCycle:ke(Ne({},s.currentCycle),{phases:i})})})},resetPhase:r=>{n(s=>{if(!s.currentCycle)return s;const i=s.currentCycle.phases.map(l=>l.id===r?ke(Ne({},l),{isActive:!1,startTime:null,endTime:null,status:"pending"}):l);return ke(Ne({},s),{currentCycle:ke(Ne({},s.currentCycle),{phases:i})})})}});var qy=Object.defineProperty,Uy=Object.defineProperties,Hy=Object.getOwnPropertyDescriptors,yl=Object.getOwnPropertySymbols,Vy=Object.prototype.hasOwnProperty,Wy=Object.prototype.propertyIsEnumerable,vl=(n,e,t)=>e in n?qy(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$s=(n,e)=>{for(var t in e||(e={}))Vy.call(e,t)&&vl(n,t,e[t]);if(yl)for(var t of yl(e))Wy.call(e,t)&&vl(n,t,e[t]);return n},Ms=(n,e)=>Uy(n,Hy(e));const Gy=(n,e,t)=>({moveToolToNextPhase:r=>{n(s=>{if(!s.currentCycle)return s;const i=s.currentCycle.phases.find(m=>m.tools.includes(r)&&m.isActive);if(!i)return s;const l=Ty(i.id);if(!l){const m=e();return m.incrementToolCycleCount&&m.incrementToolCycleCount(r),s}const c=e(),o=c.availableTools.find(m=>m.id===r);if(o!=null&&o.isP2Status&&l==="autoclave")return c.incrementToolCycleCount&&c.incrementToolCycleCount(r),s;let d=s.currentCycle.phases.find(m=>m.id===l);if(!d){const m=Ey(l);m&&(d={id:l,name:m.name,duration:m.duration,tools:[],isActive:!1,startTime:null,endTime:null,status:"pending"})}if(!d)return s;const u=s.currentCycle.phases.map(m=>m.id===i.id?Ms($s({},m),{tools:m.tools.filter(p=>p!==r)}):m.id===l?Ms($s({},m),{tools:[...m.tools,r]}):m);return s.currentCycle.phases.find(m=>m.id===l)||u.push(d),Ms($s({},s),{currentCycle:Ms($s({},s.currentCycle),{phases:u})})})}}),Ky=n=>{let e=100,t=null;if(n.length>0){const r=new Date;r.setDate(r.getDate()-30);const s=n.filter(c=>c.date>=r),i=s.filter(c=>c.passed===!1),l=s.filter(c=>!c.passed&&c.date<r);if(s.length>0){const c=s.filter(o=>o.passed===!0).length;e=Math.round(c/s.length*100),i.length>0&&(t={direction:"down",value:`${i.length} failure(s) this month`})}else l.length>0&&(t={direction:"warning",value:`${l.length} test(s) missed this month`})}return{rate:e,trend:t}},Qy=n=>{const e=new Date;e.setDate(e.getDate()-7);const t=new Date;t.setDate(t.getDate()-14);const r=n.filter(c=>new Date(c.startTime)>=e&&ao(c)),s=n.filter(c=>{const o=new Date(c.startTime);return o>=t&&o<e&&ao(c)}),i=r.length,l=s.length;if(l>0){const c=Math.round((i-l)/l*100);return{direction:c>=0?"up":"down",value:`${c>=0?"+":""}${c}% from last week`}}else if(i>0)return{direction:"up",value:"New this week"};return null},Yy=(n,e)=>{const t=new Date;t.setDate(t.getDate()-30);const r=e.filter(l=>{const c=l.currentPhase==="complete"||l.currentPhase==="available",o=l.startTime&&l.endTime,d=o&&new Date(l.endTime)>=t,u=o&&new Date(l.endTime).getTime()-new Date(l.startTime).getTime()>1800*1e3;return c&&o&&d&&u});if(r.length===0)return 0;const s=r.reduce((l,c)=>{const o=new Date(c.startTime),u=new Date(c.endTime).getTime()-o.getTime();return l+u},0);return Math.round(s/r.length/(1e3*60))},Jy=(n,e,t,r,s)=>{const i={cycleCompletionRate:.2,timeEfficiency:.15,resourceUtilization:.15,qualityMetrics:.15,throughputEfficiency:.1,inventoryEfficiency:.15},l=new Date;l.setDate(l.getDate()-7);const c=new Date;c.setDate(c.getDate()-14);const o=n.filter(I=>new Date(I.startTime)>=l&&ao(I)),d=o.length,u=o.filter(I=>I.completedAt!==null).length,m=d>0?u/d*100:0,p=60,f=Math.max(0,Math.min(100,(p-Math.abs(t-p))/p*100)),g=o.reduce((I,T)=>I+T.tools.length,0),y=d>0?g/d:0,x=Math.max(0,Math.min(100,y/7*100)),b=e,k=d/7,E=Math.max(0,Math.min(100,k/2.5*100));let $=0;const w=m*i.cycleCompletionRate+f*i.timeEfficiency+x*i.resourceUtilization+b*i.qualityMetrics+E*i.throughputEfficiency+$*i.inventoryEfficiency,S=n.filter(I=>{const T=new Date(I.startTime);return T>=c&&T<l});let A=null;if(S.length>0){const T=S.filter(B=>B.completedAt!==null).length/S.length*100*i.cycleCompletionRate+80,j=w-T,M=Math.round(j/T*100);A={direction:j>=0?"up":"down",value:`${j>=0?"+":""}${M}% from last week`}}return{score:Math.round(w),trend:A,breakdown:{sterilization:{completionRate:m,timeEfficiency:f,resourceUtilization:x,qualityScore:b,throughputEfficiency:E},inventory:{efficiency:$,lowStockItems:0,totalItems:0,expiringItems:0,accuracy:100}}}},Xy=(n,e,t,r)=>{const{rate:s,trend:i}=Ky(t),l=Qy(n),c=Yy(n,e),o=Jy(n,s,c),d=new Date;d.setDate(d.getDate()-30);const u=n.filter(g=>{const y=new Date(g.startTime);return!isNaN(y.getTime())&&y>=d}),m=u.length,p=u.filter(g=>g.completedAt!==null).length,f=l&&l.direction!=="warning"?{direction:l.direction,value:l.value}:null;return{totalCycles:m,completedCycles:p,averageCycleTime:c,biPassRate:s,biPassRateTrend:i,cycleTrend:f,efficiencyScore:o}};var Zy=Object.defineProperty,ev=Object.defineProperties,tv=Object.getOwnPropertyDescriptors,_l=Object.getOwnPropertySymbols,rv=Object.prototype.hasOwnProperty,nv=Object.prototype.propertyIsEnumerable,xl=(n,e,t)=>e in n?Zy(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ja=(n,e)=>{for(var t in e||(e={}))rv.call(e,t)&&xl(n,t,e[t]);if(_l)for(var t of _l(e))nv.call(e,t)&&xl(n,t,e[t]);return n},sv=(n,e)=>ev(n,tv(e));const av=(n,e,t)=>{const r=Ry(n,e),s=By(n,e),i=Gy(n,e);return sv(Ja(Ja(Ja({currentCycle:null,cycles:[],error:null},r),s),i),{getCycleStats:()=>{const l=e();return Xy(l.cycles||[],l.availableTools||[],l.biTestResults||[])}})},iv=n=>({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:"",setModalOpen:e=>n({isModalOpen:e}),setShowAnalyticsModal:e=>n({showAnalyticsModal:e}),setShowCleaningLogModal:e=>n({showCleaningLogModal:e}),setShowBITestModal:e=>n({showBITestModal:e}),setShowBatchCodeModal:e=>n({showBatchCodeModal:e}),setWorkflowType:e=>n({workflowType:e}),setScannedData:e=>n({scannedData:e}),resetUIState:()=>n({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:""})});var ov=Object.defineProperty,lv=Object.defineProperties,cv=Object.getOwnPropertyDescriptors,bl=Object.getOwnPropertySymbols,dv=Object.prototype.hasOwnProperty,uv=Object.prototype.propertyIsEnumerable,wl=(n,e,t)=>e in n?ov(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,mv=(n,e)=>{for(var t in e||(e={}))dv.call(e,t)&&wl(n,t,e[t]);if(bl)for(var t of bl(e))uv.call(e,t)&&wl(n,t,e[t]);return n},hv=(n,e)=>lv(n,cv(e));const $h=(n,e)=>({availableTools:[],toolsInCycle:[],setAvailableTools:t=>{n({availableTools:t})},addToolToCycle:t=>{const r=e().availableTools.find(s=>s.id===t);r&&n(s=>({toolsInCycle:[...s.toolsInCycle,r]}))},clearCycle:()=>{n({toolsInCycle:[]})},incrementToolCycleCount:t=>{n(r=>({availableTools:r.availableTools.map(s=>s.id===t?hv(mv({},s),{cycleCount:s.cycleCount+1}):s)}))},checkToolReplacementNeeded:t=>{const r=e().availableTools.find(s=>s.id===t);return r?r.cycleCount>=(r.maxCycles||200):!1},getToolCycleCount:t=>{const r=e().availableTools.find(s=>s.id===t);return r?r.cycleCount:0}}),Mh=(n,e,t)=>({}),Fh=(n,e)=>({currentBatchId:null,batchedToolIds:[],currentCycle:null,setCurrentBatchId:t=>n({currentBatchId:t}),addToolToBatch:t=>n({batchedToolIds:[...e().batchedToolIds,t]}),resetBatch:()=>n({currentBatchId:null,batchedToolIds:[]})});var pv=Object.defineProperty,Sl=Object.getOwnPropertySymbols,fv=Object.prototype.hasOwnProperty,gv=Object.prototype.propertyIsEnumerable,Cl=(n,e,t)=>e in n?pv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xa=(n,e)=>{for(var t in e||(e={}))fv.call(e,t)&&Cl(n,t,e[t]);if(Sl)for(var t of Sl(e))gv.call(e,t)&&Cl(n,t,e[t]);return n};const yv=(n,e,t)=>Xa(Xa(Xa({},$h(n,e)),Mh()),Fh(n,e));var vv=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const _v=n=>({lastGeneratedCode:null,generatedCodes:[],generateBatchCode:(e,t)=>vv(null,null,function*(){const r=t===1,s=new Date,i=s.toISOString().slice(0,10).replace(/-/g,""),l=s.toISOString().slice(11,17).replace(/:/g,""),c=Math.random().toString(36).substring(2,5).toUpperCase(),o=`${i}-${l}-${c}`,d={code:o,generatedAt:s,operator:e,toolCount:t,isSingleTool:r};return n(u=>({lastGeneratedCode:d,generatedCodes:[...u.generatedCodes,d]})),o}),validateBatchCode:e=>/^\d{8}-\d{4}-[A-Z0-9]{3}$/.test(e),getBatchByCode:(e,t)=>t.find(r=>r.batchCode===e)||null});var xv=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class bv{static generateBatchCode(e,t){return xv(this,null,function*(){try{const r=new Date().toISOString().slice(0,10).replace(/-/g,""),s=e.slice(0,3).toUpperCase(),i=t.toString().padStart(2,"0");return{batchCode:`${s}${r}${i}`,success:!0}}catch(r){return{batchCode:"",success:!1,error:r instanceof Error?r.message:"Unknown error"}}})}}var wv=Object.defineProperty,Sv=Object.defineProperties,Cv=Object.getOwnPropertyDescriptors,Il=Object.getOwnPropertySymbols,Iv=Object.prototype.hasOwnProperty,jv=Object.prototype.propertyIsEnumerable,jl=(n,e,t)=>e in n?wv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,An=(n,e)=>{for(var t in e||(e={}))Iv.call(e,t)&&jl(n,t,e[t]);if(Il)for(var t of Il(e))jv.call(e,t)&&jl(n,t,e[t]);return n},On=(n,e)=>Sv(n,Cv(e)),El=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Ev=(n,e)=>({currentBatch:null,batches:[],batchHistory:[],batchLoading:!1,createBatch:(t,r)=>El(null,null,function*(){n({batchLoading:!0});try{const s=`batch_${Date.now()}`,i={id:s,batchCode:"",createdAt:new Date,createdBy:t,status:"creating",tools:[],packageInfo:{packageType:"",packageSize:""},sterilizationInfo:{},facility_id:"default-facility",auditTrail:[{id:`audit_${Date.now()}`,timestamp:new Date,action:"created",operator:t,details:`Batch created in ${r?"batch":"single tool"} mode`}]};return n(l=>({currentBatch:i,batches:[...l.batches,i],batchLoading:!1})),s}catch(s){throw n({batchLoading:!1}),s}}),addToolToBatch:t=>{const{currentBatch:r}=e();if(r&&!r.tools.includes(t)){const s=On(An({},r),{tools:[...r.tools,t],auditTrail:[...r.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_added",operator:r.createdBy,details:`Tool ${t} added to batch`,metadata:{toolId:t}}]});n(i=>({currentBatch:s,batches:i.batches.map(l=>l.id===r.id?s:l)}))}},removeToolFromBatch:t=>{const{currentBatch:r}=e();if(!r)return;const s=On(An({},r),{tools:r.tools.filter(i=>i!==t),auditTrail:[...r.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_removed",operator:r.createdBy,details:`Tool ${t} removed from batch`,metadata:{toolId:t}}]});n(i=>({currentBatch:s,batches:i.batches.map(l=>l.id===r.id?s:l)}))},finalizeBatch:t=>El(null,null,function*(){const{currentBatch:r}=e();if(!r)throw new Error("No current batch to finalize");n({batchLoading:!0});try{const s=yield bv.generateBatchCode(r.createdBy,r.tools.length);if(!s.success)throw new Error(s.error||"Failed to generate batch code");const i=s.batchCode,l=On(An({},r),{batchCode:i,status:"ready",packageInfo:t,auditTrail:[...r.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"ready_for_autoclave",operator:r.createdBy,details:`Batch finalized with code ${i}`,metadata:{batchCode:i,packageInfo:t}}]});n(c=>({currentBatch:l,batches:c.batches.map(o=>o.id===r.id?l:o),batchHistory:[...c.batchHistory,l],batchLoading:!1}))}catch(s){throw n({batchLoading:!1}),s}}),updateBatchStatus:(t,r)=>{n(s=>{var i;return{batches:s.batches.map(l=>l.id===t?On(An({},l),{status:r,auditTrail:[...l.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:r==="in_autoclave"?"autoclave_started":r==="completed"?"autoclave_completed":"tool_added",operator:l.createdBy,details:`Batch status updated to ${r}`,metadata:{status:r}}]}):l),currentBatch:((i=s.currentBatch)==null?void 0:i.id)===t?On(An({},s.currentBatch),{status:r}):s.currentBatch}})},getBatchById:t=>{const{batches:r,batchHistory:s}=e();return[...r,...s].find(i=>i.id===t)||null},getBatchesByStatus:t=>{const{batches:r,batchHistory:s}=e();return[...r,...s].filter(i=>i.status===t)},clearCurrentBatch:()=>n({currentBatch:null}),setBatchLoading:t=>n({batchLoading:t})});var Tv=Object.defineProperty,Tl=Object.getOwnPropertySymbols,Nv=Object.prototype.hasOwnProperty,kv=Object.prototype.propertyIsEnumerable,Nl=(n,e,t)=>e in n?Tv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Za=(n,e)=>{for(var t in e||(e={}))Nv.call(e,t)&&Nl(n,t,e[t]);if(Tl)for(var t of Tl(e))kv.call(e,t)&&Nl(n,t,e[t]);return n};const Pv=(n,e)=>({currentSession:null,startPackagingSession:(t,r)=>{const s={id:crypto.randomUUID(),operatorName:t,facilityId:r,scannedTools:[],startedAt:new Date().toISOString()};n({currentSession:s})},addToolToSession:t=>{const r=e().currentSession;r&&(r.scannedTools.includes(t)||(r.scannedTools.push(t),n({currentSession:Za({},r)})))},removeToolFromSession:t=>{const r=e().currentSession;r&&(r.scannedTools=r.scannedTools.filter(s=>s!==t),n({currentSession:Za({},r)}))},generateBatchId:()=>`PKG-${Math.floor(1e3+Math.random()*9e3)}`,assignBatchIdToSession:t=>{const r=e().currentSession;r&&(r.currentBatchId=t,n({currentSession:Za({},r)}))},endPackagingSession:()=>{n({currentSession:null})},resetPackagingSession:()=>{n({currentSession:null})}});var Dv=Object.defineProperty,Av=Object.defineProperties,Ov=Object.getOwnPropertyDescriptors,kl=Object.getOwnPropertySymbols,Rv=Object.prototype.hasOwnProperty,$v=Object.prototype.propertyIsEnumerable,Pl=(n,e,t)=>e in n?Dv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Rn=(n,e)=>{for(var t in e||(e={}))Rv.call(e,t)&&Pl(n,t,e[t]);if(kl)for(var t of kl(e))$v.call(e,t)&&Pl(n,t,e[t]);return n},ei=(n,e)=>Av(n,Ov(e));const Dl={gravity:{name:"Gravity",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35},prevacuum:{name:"Pre-vacuum",temperature:132,pressure:30,sterilizeTime:4,dryTime:15,totalTime:19},flash:{name:"Flash",temperature:132,pressure:30,sterilizeTime:3,dryTime:0,totalTime:3},custom:{name:"Custom",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35}},Mv={autoclaveHasPrinter:!1,receiptRetentionMonths:12},Fv=n=>({cycleSettings:Dl,defaultCycleType:"gravity",allowCustomCycles:!1,autoclaveReceiptSettings:Mv,updateCycleSettings:(e,t)=>{n(r=>({cycleSettings:ei(Rn({},r.cycleSettings),{[e]:Rn(Rn({},r.cycleSettings[e]),t)})}))},setDefaultCycleType:e=>{n({defaultCycleType:e})},setAllowCustomCycles:e=>{n({allowCustomCycles:e})},setAutoclaveHasPrinter:e=>{n(t=>({autoclaveReceiptSettings:ei(Rn({},t.autoclaveReceiptSettings),{autoclaveHasPrinter:e})}))},setReceiptRetentionMonths:e=>{n(t=>({autoclaveReceiptSettings:ei(Rn({},t.autoclaveReceiptSettings),{receiptRetentionMonths:e})}))},resetCycleSettings:()=>{n({cycleSettings:Dl,defaultCycleType:"gravity",allowCustomCycles:!1})}});var Lv=Object.defineProperty,zv=Object.defineProperties,Bv=Object.getOwnPropertyDescriptors,Al=Object.getOwnPropertySymbols,qv=Object.prototype.hasOwnProperty,Uv=Object.prototype.propertyIsEnumerable,Ol=(n,e,t)=>e in n?Lv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Hv=(n,e)=>{for(var t in e||(e={}))qv.call(e,t)&&Ol(n,t,e[t]);if(Al)for(var t of Al(e))Uv.call(e,t)&&Ol(n,t,e[t]);return n},Vv=(n,e)=>zv(n,Bv(e)),Pe=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Wv=n=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,setBiTestCompleted:e=>n({biTestCompleted:e}),setBiTestDate:e=>n({biTestDate:e}),recordBITestResult:e=>Pe(null,null,function*(){const t=Vv(Hv({},e),{id:`bi-test-${Date.now()}`});n(r=>({biTestResults:[...r.biTestResults,t],biTestCompleted:!0,biTestDate:new Date().toISOString(),biTestPassed:e.passed}))}),setNextBITestDue:e=>n({nextBITestDue:e}),setLastBITestDate:e=>n({lastBITestDate:e}),setBiTestPassed:e=>n({biTestPassed:e}),setBiTestOptedOut:e=>n({biTestOptedOut:e}),setBiTestInProgress:e=>n({biTestInProgress:e}),resetBIState:()=>n({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1}),activateBIFailure:()=>Pe(null,null,function*(){}),deactivateBIFailure:()=>Pe(null,null,function*(){}),updateBIFailureStatus:()=>Pe(null,null,function*(){}),resolveBIFailure:()=>Pe(null,null,function*(){}),getBIFailureHistory:()=>Pe(null,null,function*(){}),addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>Pe(null,null,function*(){}),setEnforceBI:()=>Pe(null,null,function*(){}),setEnforceCI:()=>Pe(null,null,function*(){}),setAllowOverrides:()=>Pe(null,null,function*(){}),toggleEnforceBI:()=>Pe(null,null,function*(){}),toggleEnforceCI:()=>Pe(null,null,function*(){}),loadComplianceSettings:()=>Pe(null,null,function*(){}),syncWithSupabase:()=>Pe(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>Pe(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})});var Gv=Object.defineProperty,Kv=Object.defineProperties,Qv=Object.getOwnPropertyDescriptors,Rl=Object.getOwnPropertySymbols,Yv=Object.prototype.hasOwnProperty,Jv=Object.prototype.propertyIsEnumerable,$l=(n,e,t)=>e in n?Gv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ml=(n,e)=>{for(var t in e||(e={}))Yv.call(e,t)&&$l(n,t,e[t]);if(Rl)for(var t of Rl(e))Jv.call(e,t)&&$l(n,t,e[t]);return n},Fl=(n,e)=>Kv(n,Qv(e)),De=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Xv=(n,e)=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,activateBIFailure:t=>De(null,null,function*(){n({biFailureLoading:!0,biFailureError:null});try{const r={id:`bi-failure-${Date.now()}`,incident_number:`BI-${Date.now()}`,failure_date:new Date().toISOString(),affected_tools_count:t.affectedToolsCount,affected_batch_ids:t.affectedBatchIds,failure_reason:t.failureReason,severity_level:t.severity||"medium",status:"active",detected_by_operator_id:t.operator,regulatory_notification_sent:!1,regulatory_notification_date:void 0,facility_id:"default-facility",regulatory_notification_required:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};n({biFailureActive:!0,biFailureDetails:r,biFailureHistory:[...e().biFailureHistory,r],biFailureLoading:!1})}catch(r){n({biFailureError:r instanceof Error?r.message:"Failed to activate BI failure",biFailureLoading:!1})}}),deactivateBIFailure:()=>De(null,null,function*(){n({biFailureLoading:!0});try{n({biFailureActive:!1,biFailureDetails:null,biFailureLoading:!1})}catch(t){n({biFailureError:t instanceof Error?t.message:"Failed to deactivate BI failure",biFailureLoading:!1})}}),updateBIFailureStatus:t=>De(null,null,function*(){n({biFailureLoading:!0});try{const r=e().biFailureDetails;if(r){const s=Fl(Ml({},r),{status:t,updated_at:new Date().toISOString()});n({biFailureDetails:s,biFailureActive:t==="active",biFailureLoading:!1})}}catch(r){n({biFailureError:r instanceof Error?r.message:"Failed to update BI failure status",biFailureLoading:!1})}}),resolveBIFailure:()=>De(null,null,function*(){n({biFailureLoading:!0});try{const t=e().biFailureDetails;if(t){const r=Fl(Ml({},t),{status:"resolved",updated_at:new Date().toISOString()});n({biFailureDetails:r,biFailureActive:!1,biFailureLoading:!1})}}catch(t){n({biFailureError:t instanceof Error?t.message:"Failed to resolve BI failure",biFailureLoading:!1})}}),getBIFailureHistory:()=>De(null,null,function*(){n({biFailureLoading:!0});try{n({biFailureLoading:!1})}catch(t){n({biFailureError:t instanceof Error?t.message:"Failed to get BI failure history",biFailureLoading:!1})}}),setBiTestCompleted:()=>{},setBiTestDate:()=>{},recordBITestResult:()=>De(null,null,function*(){}),setNextBITestDue:()=>{},setLastBITestDate:()=>{},setBiTestPassed:()=>{},setBiTestOptedOut:()=>{},setBiTestInProgress:()=>{},resetBIState:()=>{},addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>De(null,null,function*(){}),setEnforceBI:()=>De(null,null,function*(){}),setEnforceCI:()=>De(null,null,function*(){}),setAllowOverrides:()=>De(null,null,function*(){}),toggleEnforceBI:()=>De(null,null,function*(){}),toggleEnforceCI:()=>De(null,null,function*(){}),loadComplianceSettings:()=>De(null,null,function*(){}),syncWithSupabase:()=>De(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>De(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})}),Zv=n=>{const{biTestPassed:e,nextBITestDue:t,biTestOptedOut:r,enforceBI:s}=n;if(!s||r)return{isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"};const i=new Date,l=t?Math.ceil((t.getTime()-i.getTime())/(1e3*60*60*24)):0;let c;return e?l<0?c="overdue":l<=3?c="due-soon":c="compliant":c="failed",{isCompliant:c==="compliant",nextTestDue:t,daysUntilDue:l,status:c}},e_=n=>{const{biFailureDetails:e}=n;return e&&e.severity_level||"low"},t_=n=>{const{activityLog:e}=n,t=new Date,r=new Date(t.getTime()-1440*60*1e3),s=e.filter(c=>c.time>r).length,i=e.filter(c=>c.type==="bi-test").length,l=e.filter(c=>c.type==="bi-failure").length;return{totalActivities:e.length,recentActivities:s,biTestCount:i,failureCount:l}};class he extends Error{constructor(e,t,r="medium",s=!1,i){super(e),this.code=t,this.severity=r,this.retryable=s,this.details=i,this.name="BIFailureError"}}const K={MISSING_FACILITY_ID:"MISSING_FACILITY_ID",INVALID_TOOLS_COUNT:"INVALID_TOOLS_COUNT",MISSING_BATCH_IDS:"MISSING_BATCH_IDS",VALIDATION_ERROR:"VALIDATION_ERROR"};var r_=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class z{static handleDatabaseError(e,t,r){this.logError("DATABASE_ERROR",e,t,r);const s=e;throw(s==null?void 0:s.code)==="PGRST116"?new he(`Database connection error during ${t}: ${s.message||"Unknown error"}`,"DATABASE_CONNECTION_ERROR","critical",!0):(s==null?void 0:s.code)==="23505"?new he(`Duplicate record error during ${t}: ${s.message||"Unknown error"}`,"DUPLICATE_RECORD_ERROR","high",!1):(s==null?void 0:s.code)==="23503"?new he(`Foreign key constraint error during ${t}: ${s.message||"Unknown error"}`,"FOREIGN_KEY_ERROR","high",!1):new he(`Database error during ${t}: ${(s==null?void 0:s.message)||"Unknown error"}`,"DATABASE_ERROR","critical",!0)}static handleNetworkError(e,t,r){var s;this.logError("NETWORK_ERROR",e,t,r);const i=e;throw(i==null?void 0:i.code)==="NETWORK_ERROR"||(s=i==null?void 0:i.message)!=null&&s.includes("network")?new he(`Network connection failed during ${t}: ${i.message||"Unknown error"}`,"NETWORK_ERROR","high",!0):(i==null?void 0:i.code)==="PGRST116"?new he(`Database connection timeout during ${t}: ${i.message||"Unknown error"}`,"DATABASE_TIMEOUT_ERROR","critical",!0):new he(`Network error during ${t}: ${(i==null?void 0:i.message)||"Unknown error"}`,"NETWORK_ERROR","high",!0)}static handleValidationError(e,t,r="medium"){throw this.logError("VALIDATION_ERROR",{message:e,code:t},"validation"),new he(e,t,r,!1)}static handleAuthorizationError(e,t,r){this.logError("AUTHORIZATION_ERROR",e,t,r);const s=e;throw new he(`Authorization error during ${t}: ${(s==null?void 0:s.message)||"Access denied"}`,"AUTHORIZATION_ERROR","high",!1)}static handleCriticalError(e,t,r){var s,i,l;this.logError("CRITICAL_ERROR",e,t,r);const c=e;throw(c==null?void 0:c.code)==="CRITICAL_ERROR"||(s=c==null?void 0:c.message)!=null&&s.includes("critical")?new he(`Critical error during ${t}: ${c.message||"System failure"}`,"CRITICAL_ERROR","critical",!1):(c==null?void 0:c.code)==="HIGH_PRIORITY"||(i=c==null?void 0:c.message)!=null&&i.includes("high")?new he(`High priority error during ${t}: ${c.message||"High priority issue"}`,"HIGH_PRIORITY_ERROR","high",!1):(c==null?void 0:c.code)==="MEDIUM_PRIORITY"||(l=c==null?void 0:c.message)!=null&&l.includes("medium")?new he(`Medium priority error during ${t}: ${c.message||"Medium priority issue"}`,"MEDIUM_PRIORITY_ERROR","medium",!1):new he(`Critical error during ${t}: ${(c==null?void 0:c.message)||"Unknown critical error"}`,"CRITICAL_ERROR","critical",!1)}static createStandardizedError(e,t,r="UNKNOWN_ERROR"){const s=e;return new he((s==null?void 0:s.message)||`Unknown error during ${t}`,r,"medium",!0,{name:(s==null?void 0:s.name)||"UnknownError",message:(s==null?void 0:s.message)||"No message",code:(s==null?void 0:s.code)||"NO_CODE",operation:t,stack:s==null?void 0:s.stack})}static logError(e,t,r,s){if(this.errorCount++,this.errorCount>this.MAX_ERRORS){console.warn("Maximum error count reached, stopping error logging");return}const i={type:e,operation:r,timestamp:new Date().toISOString(),context:s,error:t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t};console.error("BIFailureErrorHandler:",i),t instanceof Error&&(this.lastError=t)}static getLastError(){return this.lastError}static reset(){this.lastError=null,this.errorCount=0}static isRetryableError(e){var t,r,s;if(e instanceof he)return e.retryable;const i=e;return!!((i==null?void 0:i.code)==="NETWORK_ERROR"||(t=i==null?void 0:i.message)!=null&&t.includes("network")||(r=i==null?void 0:i.message)!=null&&r.includes("timeout")||(i==null?void 0:i.code)==="PGRST116"||(s=i==null?void 0:i.message)!=null&&s.includes("connection"))}static handleUnexpectedError(e,t){this.logError("UNEXPECTED_ERROR",e,t);const r=e;throw new he(`Unexpected error during ${t}: ${(r==null?void 0:r.message)||"Unknown error"}`,"UNEXPECTED_ERROR","critical",!1)}static withRetry(e,t,r=3,s=1e3){return r_(this,null,function*(){let i=null;for(let l=1;l<=r;l++)try{return yield e()}catch(c){if(i=this.createStandardizedError(c,t),!this.isRetryableError(c)||l===r)throw i;yield new Promise(o=>setTimeout(o,s*l))}throw i||new he(`Operation failed after ${r} attempts: ${t}`,"MAX_RETRIES_EXCEEDED","critical",!1)})}}z.lastError=null;z.errorCount=0;z.MAX_ERRORS=100;class Tt{static validateCreateIncidentParams(e){e.facility_id||z.handleValidationError("Facility ID is required",K.MISSING_FACILITY_ID,"critical"),e.affected_tools_count<0&&z.handleValidationError("Affected tools count cannot be negative",K.INVALID_TOOLS_COUNT,"high"),(!Array.isArray(e.affected_batch_ids)||e.affected_batch_ids.length===0)&&z.handleValidationError("At least one affected batch ID is required",K.MISSING_BATCH_IDS,"critical");for(const t of e.affected_batch_ids)(!t||typeof t!="string"||t.trim().length===0)&&z.handleValidationError("Invalid batch ID format",K.VALIDATION_ERROR,"high");e.severity_level&&!["low","medium","high","critical"].includes(e.severity_level)&&z.handleValidationError("Invalid severity level. Must be one of: low, medium, high, critical",K.VALIDATION_ERROR,"medium"),this.isValidUUID(e.facility_id)||z.handleValidationError("Invalid facility ID format",K.VALIDATION_ERROR,"high"),e.detected_by_operator_id&&!this.isValidUUID(e.detected_by_operator_id)&&z.handleValidationError("Invalid operator ID format",K.VALIDATION_ERROR,"medium")}static validateResolveIncidentParams(e){e.incidentId||z.handleValidationError("Incident ID is required",K.VALIDATION_ERROR,"critical"),e.resolvedByOperatorId||z.handleValidationError("Resolving operator ID is required",K.VALIDATION_ERROR,"critical"),this.isValidUUID(e.incidentId)||z.handleValidationError("Invalid incident ID format",K.VALIDATION_ERROR,"high"),this.isValidUUID(e.resolvedByOperatorId)||z.handleValidationError("Invalid operator ID format",K.VALIDATION_ERROR,"high"),e.resolutionNotes&&e.resolutionNotes.length>1e4&&z.handleValidationError("Resolution notes cannot exceed 10,000 characters",K.VALIDATION_ERROR,"medium")}static validateQuarantineToolsParams(e){e.incidentId||z.handleValidationError("Incident ID is required",K.VALIDATION_ERROR,"critical"),e.quarantinedByOperatorId||z.handleValidationError("Quarantining operator ID is required",K.VALIDATION_ERROR,"critical"),(!Array.isArray(e.tools)||e.tools.length===0)&&z.handleValidationError("At least one tool must be specified for quarantine",K.VALIDATION_ERROR,"high");for(const t of e.tools)t.tool_id||z.handleValidationError("Tool ID is required for each tool",K.VALIDATION_ERROR,"high"),this.isValidUUID(t.tool_id)||z.handleValidationError("Invalid tool ID format",K.VALIDATION_ERROR,"high");this.isValidUUID(e.incidentId)||z.handleValidationError("Invalid incident ID format",K.VALIDATION_ERROR,"high"),this.isValidUUID(e.quarantinedByOperatorId)||z.handleValidationError("Invalid operator ID format",K.VALIDATION_ERROR,"high")}static validateRecordToolUsageParams(e){e.facilityId||z.handleValidationError("Facility ID is required",K.MISSING_FACILITY_ID,"critical"),e.toolId||z.handleValidationError("Tool ID is required",K.VALIDATION_ERROR,"critical"),e.patientId||z.handleValidationError("Patient ID is required",K.VALIDATION_ERROR,"critical"),this.isValidUUID(e.facilityId)||z.handleValidationError("Invalid facility ID format",K.VALIDATION_ERROR,"high"),this.isValidUUID(e.toolId)||z.handleValidationError("Invalid tool ID format",K.VALIDATION_ERROR,"high"),this.isValidUUID(e.patientId)||z.handleValidationError("Invalid patient ID format",K.VALIDATION_ERROR,"high"),e.operatorId&&!this.isValidUUID(e.operatorId)&&z.handleValidationError("Invalid operator ID format",K.VALIDATION_ERROR,"medium"),e.procedureNotes&&e.procedureNotes.length>5e3&&z.handleValidationError("Procedure notes cannot exceed 5,000 characters",K.VALIDATION_ERROR,"medium")}static validateFacilityId(e){e||z.handleValidationError("Facility ID is required",K.MISSING_FACILITY_ID,"high"),this.isValidUUID(e)||z.handleValidationError("Invalid facility ID format",K.VALIDATION_ERROR,"high")}static validateIncidentId(e){e||z.handleValidationError("Incident ID is required",K.VALIDATION_ERROR,"critical"),this.isValidUUID(e)||z.handleValidationError("Invalid incident ID format",K.VALIDATION_ERROR,"high")}static validateDateRange(e,t){const r=new Date(e),s=new Date(t);isNaN(r.getTime())&&z.handleValidationError("Invalid start date format",K.VALIDATION_ERROR,"medium"),isNaN(s.getTime())&&z.handleValidationError("Invalid end date format",K.VALIDATION_ERROR,"medium"),r>s&&z.handleValidationError("Start date cannot be after end date",K.VALIDATION_ERROR,"medium");const i=new Date;i.setFullYear(i.getFullYear()-5),r<i&&z.handleValidationError("Start date cannot be more than 5 years ago",K.VALIDATION_ERROR,"medium")}static isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}static validateBusinessRules(e){e.affected_tools_count>1e4&&z.handleValidationError("Affected tools count seems unreasonably high. Please verify the data.",K.VALIDATION_ERROR,"medium"),new Set(e.affected_batch_ids).size!==e.affected_batch_ids.length&&z.handleValidationError("Duplicate batch IDs are not allowed",K.VALIDATION_ERROR,"medium"),e.failure_reason&&e.failure_reason.length>2e3&&z.handleValidationError("Failure reason cannot exceed 2,000 characters",K.VALIDATION_ERROR,"medium")}}var n_=Object.defineProperty,Ll=Object.getOwnPropertySymbols,s_=Object.prototype.hasOwnProperty,a_=Object.prototype.propertyIsEnumerable,zl=(n,e,t)=>e in n?n_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Bl=(n,e)=>{for(var t in e||(e={}))s_.call(e,t)&&zl(n,t,e[t]);if(Ll)for(var t of Ll(e))a_.call(e,t)&&zl(n,t,e[t]);return n},xe=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class va{static createIncident(e){return xe(this,null,function*(){try{Tt.validateCreateIncidentParams(e),Tt.validateBusinessRules(e);const t=yield z.withRetry(()=>xe(null,null,function*(){const{data:r,error:s}=yield _.from("bi_failure_incidents").insert({facility_id:e.facility_id,cycle_id:e.bi_test_result_id,user_id:e.detected_by_operator_id,incident_type:e.incident_type||"bi_failure",severity:e.severity||"medium",description:e.description||"BI test failure incident",failure_reason:e.failure_reason,status:"open",detected_at:new Date().toISOString(),metadata:{affected_tools_count:e.affected_tools_count,affected_batch_ids:e.affected_batch_ids,notes:e.notes}}).select().single();if(s)throw s;if(!r)throw new Error("No data returned from incident creation");return r}),"create BI failure incident");if(t&&e.lastSuccessfulBIDate)try{yield this.identifyExposureWindowTools(t.id,e.lastSuccessfulBIDate),console.log("Exposure window tools identified for incident:",t.incident_number)}catch(r){global.__TESTING__||console.error("Error identifying exposure window tools:",r)}return{id:t.id,facility_id:t.facility_id,bi_test_result_id:t.bi_test_result_id||"",incident_number:t.incident_number,failure_date:t.failure_date||new Date().toISOString(),detected_by_operator_id:t.detected_by_operator_id||"",affected_tools_count:e.affected_tools_count,affected_batch_ids:e.affected_batch_ids,failure_reason:e.failure_reason||"",severity_level:e.severity_level||"medium",status:"active",regulatory_notification_required:!1,regulatory_notification_sent:!1,created_at:t.created_at,updated_at:t.updated_at}}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;z.handleUnexpectedError(t,"create BI failure incident")}})}static getActiveIncidents(e){return xe(this,null,function*(){Tt.validateFacilityId(e);try{const{data:t}=yield z.withRetry(()=>xe(null,null,function*(){const r=yield _.from("bi_failure_incidents").select("*").eq("facility_id",e).in("status",["active","in_resolution"]).order("failure_date",{ascending:!1});if(r.error)throw r.error;return r}),"get active BI failure incidents");return(t!=null?t:[]).map(r=>({id:r.id,facility_id:r.facility_id,bi_test_result_id:r.bi_test_result_id||"",incident_number:r.incident_number,failure_date:r.failure_date||new Date().toISOString(),detected_by_operator_id:r.detected_by_operator_id||"",affected_tools_count:r.affected_tools_count||0,affected_batch_ids:r.affected_batch_ids||[],failure_reason:r.failure_reason||"",severity_level:r.severity_level||"medium",status:r.status||"active",regulatory_notification_required:r.regulatory_notification_required||!1,regulatory_notification_sent:r.regulatory_notification_sent||!1,created_at:r.created_at,updated_at:r.updated_at}))}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;z.handleUnexpectedError(t,"get active BI failure incidents")}})}static getIncidentById(e,t){return xe(this,null,function*(){Tt.validateIncidentId(e);try{const{data:r}=yield z.withRetry(()=>xe(null,null,function*(){const s=yield _.from("bi_failure_incidents").select("*").eq("id",e).eq("facility_id",t).single();if(s.error){if(s.error.code==="PGRST116")return{data:null,error:null};throw s.error}return s}),"get BI failure incident by ID");return r?{id:r.id,facility_id:r.facility_id,bi_test_result_id:r.bi_test_result_id||"",incident_number:r.incident_number,failure_date:r.failure_date||new Date().toISOString(),detected_by_operator_id:r.detected_by_operator_id||"",affected_tools_count:r.affected_tools_count||0,affected_batch_ids:r.affected_batch_ids||[],failure_reason:r.failure_reason||"",severity_level:r.severity_level||"medium",status:r.status||"active",regulatory_notification_required:r.regulatory_notification_required||!1,regulatory_notification_sent:r.regulatory_notification_sent||!1,created_at:r.created_at,updated_at:r.updated_at}:null}catch(r){if(r instanceof Error&&r.name==="BIFailureError")throw r;z.handleUnexpectedError(r,"get BI failure incident by ID")}})}static resolveIncident(e){return xe(this,null,function*(){Tt.validateResolveIncidentParams(e);try{return!!(yield z.withRetry(()=>xe(null,null,function*(){const{data:r,error:s}=yield _.from("bi_failure_incidents").update({status:"resolved",resolved_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e.incidentId).select("id").single();return s&&z.handleDatabaseError(s,"resolve BI failure incident"),r}),"resolve BI failure incident"))}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;z.handleUnexpectedError(t,"resolve BI failure incident")}})}static updateIncidentStatus(e,t,r,s){return xe(this,null,function*(){Tt.validateIncidentId(e);try{const{data:i}=yield z.withRetry(()=>xe(null,null,function*(){const l=yield _.from("bi_failure_incidents").update(Bl({status:r,updated_at:new Date().toISOString()},s&&{updated_by_operator_id:s})).eq("id",e).eq("facility_id",t).select("id").single();if(l.error)throw l.error;return l}),"update incident status");return!!i}catch(i){if(i instanceof Error&&i.name==="BIFailureError")throw i;z.handleUnexpectedError(i,"update incident status")}})}static deleteIncident(e,t,r){return xe(this,null,function*(){Tt.validateIncidentId(e);try{const{data:s}=yield z.withRetry(()=>xe(null,null,function*(){const i=yield _.from("bi_failure_incidents").update(Bl({status:"closed",updated_at:new Date().toISOString()},r&&{deleted_by_operator_id:r})).eq("id",e).eq("facility_id",t).select("id").single();if(i.error)throw i.error;return i}),"delete BI failure incident");return!!s}catch(s){if(s instanceof Error&&s.name==="BIFailureError")throw s;z.handleUnexpectedError(s,"delete BI failure incident")}})}static getIncidentHistory(e,t,r,s=100){return xe(this,null,function*(){Tt.validateFacilityId(e),t&&r&&Tt.validateDateRange(t,r);try{let i=_.from("bi_failure_incidents").select("*").eq("facility_id",e).order("failure_date",{ascending:!1}).limit(s);t&&(i=i.gte("failure_date",t)),r&&(i=i.lte("failure_date",r));const{data:l}=yield z.withRetry(()=>xe(null,null,function*(){const c=yield i;if(c.error)throw c.error;return c}),"get incident history");return(l!=null?l:[]).map(c=>({id:c.id,facility_id:c.facility_id,bi_test_result_id:c.bi_test_result_id||"",incident_number:c.incident_number,failure_date:c.failure_date||new Date().toISOString(),detected_by_operator_id:c.detected_by_operator_id||"",affected_tools_count:c.affected_tools_count||0,affected_batch_ids:c.affected_batch_ids||[],failure_reason:c.failure_reason||"",severity_level:c.severity_level||"medium",status:c.status||"active",regulatory_notification_required:c.regulatory_notification_required||!1,regulatory_notification_sent:c.regulatory_notification_sent||!1,created_at:c.created_at,updated_at:c.updated_at}))}catch(i){if(i instanceof Error&&i.name==="BIFailureError")throw i;z.handleUnexpectedError(i,"get incident history")}})}static identifyExposureWindowTools(e,t){return xe(this,null,function*(){var r;try{const{data:s,error:i}=yield z.withRetry(()=>xe(null,null,function*(){return yield _.rpc("identify_exposure_window_tools",{p_incident_id:e,p_last_successful_bi_date:t.toISOString()})}),"identify exposure window tools");return i&&z.handleDatabaseError(i,"identify exposure window tools"),(r=parseInt(s))!=null?r:0}catch(s){if(s instanceof Error&&s.name==="BIFailureError")throw s;z.handleUnexpectedError(s,"identify exposure window tools")}})}static getCurrentFacilityId(){return xe(this,null,function*(){var e,t;try{const{data:{session:r}}=yield _.auth.getSession(),s=(t=(e=r==null?void 0:r.user)==null?void 0:e.app_metadata)==null?void 0:t.facility_id;if(!s)throw new Error("No authenticated facility ID found.");return s}catch(r){throw console.error("Failed to get current facility ID:",r),new Error("No authenticated facility ID found.")}})}}var i_=Object.defineProperty,o_=Object.defineProperties,l_=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,c_=Object.prototype.hasOwnProperty,d_=Object.prototype.propertyIsEnumerable,Ul=(n,e,t)=>e in n?i_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,pr=(n,e)=>{for(var t in e||(e={}))c_.call(e,t)&&Ul(n,t,e[t]);if(ql)for(var t of ql(e))d_.call(e,t)&&Ul(n,t,e[t]);return n},Kr=(n,e)=>o_(n,l_(e)),Nt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const u_=(n,e,t)=>Kr(pr(pr({},Wv(n)),Xv(n,e)),{addActivity:r=>{const s=Kr(pr({},r),{id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});n(i=>({activityLog:[s,...i.activityLog].slice(0,50)}))},clearActivityLog:()=>n({activityLog:[]}),loadActivityLog:()=>Nt(null,null,function*(){n({activityLogLoading:!0});try{const r=yield ht.getCurrentFacilityId();if(!r)throw new Error("No facility ID available");const{data:s,error:i}=yield _.from("bi_activity_log").select("*").eq("facility_id",r).order("created_at",{ascending:!1}).limit(100);if(i)throw i;const l=(s||[]).map(c=>({id:c.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:c.type||"general",title:c.title||"Activity",time:new Date(c.created_at||new Date().toISOString()),color:c.color||"blue",description:(c.data&&typeof c.data=="object"&&"description"in c.data?c.data.description:"")||"",metadata:c.metadata||{}}));n({activityLog:l,activityLogLoading:!1})}catch(r){console.error("Failed to load activity log:",r),n({activityLogLoading:!1,syncError:"Failed to load activity log"})}}),setEnforceBI:r=>Nt(null,null,function*(){n({enforceBI:r}),e().addPendingChange({type:"settings",data:{enforceBI:r}}),yield e().syncWithSupabase()}),setEnforceCI:r=>Nt(null,null,function*(){n({enforceCI:r}),e().addPendingChange({type:"settings",data:{enforceCI:r}}),yield e().syncWithSupabase()}),setAllowOverrides:r=>Nt(null,null,function*(){n({allowOverrides:r}),e().addPendingChange({type:"settings",data:{allowOverrides:r}}),yield e().syncWithSupabase()}),toggleEnforceBI:()=>Nt(null,null,function*(){const{enforceBI:r}=e();yield e().setEnforceBI(!r)}),toggleEnforceCI:()=>Nt(null,null,function*(){const{enforceCI:r}=e();yield e().setEnforceCI(!r)}),loadComplianceSettings:()=>Nt(null,null,function*(){var r,s,i,l;n({complianceSettingsLoading:!0});try{const c=yield ht.getCurrentFacilityId();if(!c)throw new Error("No facility ID available");const{data:o,error:d}=yield _.from("facilities").select("settings").eq("id",c).single();if(d&&d.code!=="PGRST116")throw d;const u=(r=o==null?void 0:o.settings)!=null?r:{},m=(s=u.enforce_bi)!=null?s:!1,p=(i=u.enforce_ci)!=null?i:!1,f=(l=u.allow_overrides)!=null?l:!1;n({enforceBI:!!m,enforceCI:!!p,allowOverrides:!!f,complianceSettingsLoading:!1})}catch(c){console.error("Failed to load compliance settings:",c),n({complianceSettingsLoading:!1,syncError:"Failed to load compliance settings"})}}),syncWithSupabase:()=>Nt(null,null,function*(){n({isSyncing:!0,syncError:null});try{const r=yield ht.getCurrentFacilityId();if(!r)throw new Error("No facility ID available");const{pendingChanges:s}=e();for(const i of s)try{switch(i.type){case"bi-test":i.data&&typeof i.data=="object"&&(yield En.createBITestResult(Kr(pr({},i.data),{facility_id:r,result:"pass"})));break;case"bi-failure":i.data&&typeof i.data=="object"&&(yield va.createIncident(Kr(pr({},i.data),{facility_id:r,affected_tools_count:0,affected_batch_ids:[]})));break;case"settings":if(i.data&&typeof i.data=="object"){const l=i.data,{data:c,error:o}=yield _.from("facilities").select("settings").eq("id",r).single();if(o)throw o;const d=(c==null?void 0:c.settings)||{},u=Kr(pr({},d),{enforce_bi:l.enforceBI,enforce_ci:l.enforceCI,allow_overrides:l.allowOverrides}),{error:m}=yield _.from("facilities").update({settings:u,updated_at:new Date().toISOString()}).eq("id",r);if(m)throw m}break}}catch(l){console.error(`Failed to sync ${i.type}:`,l)}n({isSyncing:!1,lastSyncTime:new Date,pendingChanges:[]})}catch(r){console.error("Sync failed:",r),n({isSyncing:!1,syncError:"Sync failed"})}}),syncBIFailureFromDatabase:r=>{const s=r;n({biFailureActive:s.status==="active",biFailureDetails:s.status==="active"?{id:s.id,incident_number:s.incident_number,failure_date:s.failure_date,affected_tools_count:s.affected_tools_count,affected_batch_ids:s.affected_batch_ids,failure_reason:s.failure_reason,severity_level:s.severity_level,status:s.status,detected_by_operator_id:s.detected_by_operator_id,regulatory_notification_sent:s.regulatory_notification_sent||!1,regulatory_notification_date:s.regulatory_notification_date,facility_id:s.facility_id||"",regulatory_notification_required:s.regulatory_notification_required||!1,created_at:s.created_at||new Date().toISOString(),updated_at:s.updated_at||new Date().toISOString()}:null})},addPendingChange:r=>{n(s=>({pendingChanges:[...s.pendingChanges,Kr(pr({},r),{id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date})]}))},clearPendingChanges:()=>n({pendingChanges:[]}),retryFailedSync:()=>Nt(null,null,function*(){yield e().syncWithSupabase()}),addOptimisticUpdate:(r,s)=>{const{optimisticUpdates:i}=e();i.set(r,s),n({optimisticUpdates:new Map(i)})},removeOptimisticUpdate:r=>{const{optimisticUpdates:s}=e();s.delete(r),n({optimisticUpdates:new Map(s)})},clearOptimisticUpdates:()=>n({optimisticUpdates:new Map}),saveStateToLocalStorage:()=>{const r=e(),s={biTestCompleted:r.biTestCompleted,biTestDate:r.biTestDate,biTestResults:r.biTestResults,nextBITestDue:r.nextBITestDue,lastBITestDate:r.lastBITestDate,biTestPassed:r.biTestPassed,biTestOptedOut:r.biTestOptedOut,enforceBI:r.enforceBI,enforceCI:r.enforceCI,allowOverrides:r.allowOverrides,lastSyncTime:r.lastSyncTime};try{localStorage.setItem("biWorkflowState",JSON.stringify(s))}catch(i){console.error(i)}},loadStateFromLocalStorage:()=>{try{const r=localStorage.getItem("biWorkflowState");if(r){const s=JSON.parse(r);n({biTestCompleted:s.biTestCompleted||!1,biTestDate:s.biTestDate||null,biTestResults:s.biTestResults||[],nextBITestDue:s.nextBITestDue?new Date(s.nextBITestDue):null,lastBITestDate:s.lastBITestDate||null,biTestPassed:s.biTestPassed||!1,biTestOptedOut:s.biTestOptedOut||!1,enforceBI:s.enforceBI!==void 0?s.enforceBI:!0,enforceCI:s.enforceCI!==void 0?s.enforceCI:!0,allowOverrides:s.allowOverrides||!1,lastSyncTime:s.lastSyncTime?new Date(s.lastSyncTime):null})}}catch(r){console.error(r)}},clearLocalStorage:()=>{try{localStorage.removeItem("biWorkflowState")}catch(r){console.error(r)}},getBIComplianceStatus:()=>Zv(e()),getBIFailureRiskLevel:()=>e_(e()),getActivitySummary:()=>t_(e())});var m_=Object.defineProperty,Hl=Object.getOwnPropertySymbols,h_=Object.prototype.hasOwnProperty,p_=Object.prototype.propertyIsEnumerable,Vl=(n,e,t)=>e in n?m_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ve=(n,e)=>{for(var t in e||(e={}))h_.call(e,t)&&Vl(n,t,e[t]);if(Hl)for(var t of Hl(e))p_.call(e,t)&&Vl(n,t,e[t]);return n};const ne=Et()((...n)=>Ve(Ve(Ve(Ve(Ve(Ve(Ve(Ve(Ve(Ve(Ve(Ve(Ve({},wy(...n)),Sy(...n)),av(...n)),iv(...n)),yv(...n)),Fh(...n)),_v(...n)),Ev(...n)),$h(...n)),Mh(...n)),Pv(...n)),Fv(...n)),u_(...n)));var io=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Wl=(n,e)=>{const t=document.createElement("div");if(t.className=`
    fixed top-4 right-4 z-[10000] bg-white border-l-4 border-green-500 
    shadow-lg rounded-lg p-4 max-w-md transform transition-all duration-300 
    animate-slide-in-right
  `,t.style.cssText=`
    animation: slideInRight 0.3s ease-out;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  `,t.innerHTML=`
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div class="ml-3 flex-1">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-gray-800">${n}</h3>
          <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="ml-2 text-gray-400 hover:text-gray-600">
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
        <p class="mt-1 text-sm text-gray-600">${e}</p>
      </div>
    </div>
  `,!document.getElementById("cliniio-notification-styles")){const r=document.createElement("style");r.id="cliniio-notification-styles",r.textContent=`
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(r)}document.body.appendChild(t),setTimeout(()=>{t.parentElement&&(t.style.transform="translateX(100%)",t.style.opacity="0",setTimeout(()=>{t.parentElement&&t.remove()},300))},5e3)},Gl=()=>io(null,null,function*(){try{const{SupabaseAuthService:n}=yield L(()=>import("./authService-B9mj5ZCR.js"),__vite__mapDeps([7,1,2,3,4,5,6])),{user:e,error:t}=yield n.getCurrentUser();if(t&&console.warn("Auth service error:",t),e!=null&&e.id)return e.id;const r=sessionStorage.getItem("currentOperatorId")||localStorage.getItem("currentOperatorId");if(r)return r;throw console.error("No operator ID found in production. User may not be authenticated."),new Error("User not authenticated - no operator ID available")}catch(n){throw console.error("Failed to get operator ID:",n),new Error("Authentication required - unable to get operator ID")}}),f_=({onClose:n,onSuccess:e})=>{const{biFailureDetails:t,deactivateBIFailure:r}=ne(),[s,i]=h.useState(!1),[l,c]=h.useState(null),[o,d]=h.useState(!1),[u,m]=h.useState(""),p=h.useCallback(()=>io(null,null,function*(){i(!0),c(null);try{const w=yield Gl();if(!t)throw new Error("No BI failure incident to resolve");const S=sessionStorage.getItem("currentBIFailureIncidentId");if(S){const A=yield va.resolveIncident({incidentId:S,resolvedByOperatorId:w,resolutionNotes:u});console.log("✅ BI Failure Resolution completed:",{incidentId:S,resolvedByOperatorId:w,resolutionNotes:u,timestamp:new Date().toISOString()}),Wl("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const I=ne.getState();I.loadBITestResults&&(I.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("🔄 Refreshed BI test results after incident resolution"))},1e3)}else{const A="550e8400-e29b-41d4-a716-446655440000",{data:I,error:T}=yield _.from("bi_failure_incidents").insert({facility_id:A,user_id:w,incident_type:"bi_test_failure",severity:"high",status:"open",description:"BI Test Failure - Contamination Detected",failure_reason:"Biological indicator test failed, indicating sterilization failure",metadata:{affected_tools_count:(t==null?void 0:t.affected_tools_count)||1,affected_batch_ids:(t==null?void 0:t.affected_batch_ids)||["DEFAULT-BATCH"]}}).select().single();if(T)throw new Error(`Failed to create incident: ${T.message}`);const j=yield va.resolveIncident({incidentId:I.id,resolvedByOperatorId:w,resolutionNotes:u}),M=ne.getState();M.addActivity&&M.addActivity({id:`bi-incident-resolved-${I.id}`,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date,toolCount:(t==null?void 0:t.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:I.id,operatorId:w,resolutionNotes:u}}),Wl("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const B=ne.getState();B.loadBITestResults&&(B.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("🔄 Refreshed BI test results after incident resolution"))},1e3),console.log("✅ BI Failure Resolution completed:",{incidentId:I.id,resolvedByOperatorId:w,resolutionNotes:u,timestamp:new Date().toISOString()}),sessionStorage.setItem("currentBIFailureIncidentId",I.id)}r(),e(),n()}catch(w){if(console.error("Failed to resolve BI failure incident:",w),w instanceof he)c({message:w.message,code:w.code,severity:w.severity,retryable:w.retryable});else if(w&&typeof w=="object"&&"name"in w&&w.name==="BIFailureError"&&"message"in w&&"code"in w&&"severity"in w&&"retryable"in w){const S=w;c({message:S.message,code:S.code,severity:S.severity,retryable:S.retryable})}else c({message:w instanceof Error?w.message:"An unexpected error occurred",severity:"high",retryable:!1})}finally{i(!1)}}),[u,r,e,n,t]),f=h.useCallback(w=>io(null,null,function*(){i(!0),c(null);try{const S=yield Gl(),A={facility_id:w.facilityId,detected_by_operator_id:S,affected_tools_count:w.affected_tools_count,affected_batch_ids:w.affectedBatchIds,failure_reason:w.failureReason,severity_level:w.severityLevel||"high"};return yield va.createIncident(A)}catch(S){throw console.error("Failed to create BI failure incident:",S),S instanceof he?c({message:S.message,code:S.code,severity:S.severity,retryable:S.retryable}):c({message:S instanceof Error?S.message:"Failed to create incident",severity:"high",retryable:!1}),S}finally{i(!1)}}),[]),g=h.useCallback(()=>{c(null),p()},[p]),y=h.useCallback(()=>{c(null),d(!1),n()},[n]),v=h.useCallback(w=>{w.target===w.currentTarget&&y()},[y]),x=h.useCallback(w=>{w.key==="Escape"&&y()},[y]),b=h.useCallback(()=>{d(w=>!w)},[]),C=h.useCallback(w=>{m(w)},[]),k=h.useCallback(()=>"mdiAlertCircle",[]),P=h.useCallback(w=>{switch(w){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},[]),E=h.useCallback(()=>s||!t,[s,t]),$=h.useCallback(()=>s?"Resolving...":"Confirm Resolution",[s]);return{isLoading:s,error:l,showExposureReport:o,resolutionNotes:u,biFailureDetails:t,handleResolve:p,createIncident:f,handleRetry:g,handleClose:y,handleBackdropClick:v,handleKeyDown:x,toggleExposureReport:b,updateResolutionNotes:C,getErrorIcon:k,getErrorColor:P,isResolveButtonDisabled:E,getResolveButtonText:$}},g_=({isSubmitting:n,onClose:e,onMinimize:t})=>{const r=()=>{n||e()},s=i=>{i.key==="Enter"&&!n&&r()};return a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(N,{path:Aa,size:1.5,className:"text-red-500"}),a.jsxs("div",{children:[a.jsx("h2",{id:"bi-failure-modal-title",className:"text-xl font-semibold text-gray-900",children:"BI Failure Resolution Workflow"}),a.jsx("p",{id:"bi-failure-modal-description",className:"text-sm text-gray-600",children:"Complete these steps to resolve the BI failure"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[t&&a.jsx("button",{onClick:t,disabled:n,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${n?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Minimize workflow to banner",title:"Minimize to continue working on other tasks",children:a.jsx(N,{path:mh,size:1.2})}),a.jsx("button",{onClick:r,onKeyDown:s,disabled:n,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${n?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Close modal","aria-describedby":"bi-failure-modal-description",children:a.jsx(N,{path:pt,size:1.2})})]})]})},jo=()=>{const{biTestResults:n,cycles:e,currentCycle:t,availableTools:r}=ne();return h.useMemo(()=>{if(!n||!Array.isArray(n))return{lastPassedDate:null,affectedCycles:[],affectedTools:[],totalToolsAffected:0,totalCyclesAffected:0,totalSterilizationEvents:0,toolsUsedMultipleTimes:0,uniqueOperators:[],dateRange:null,toolsByCategory:{},hasCurrentCycleAffected:!1};const s=n.filter(C=>C.passed).sort((C,k)=>new Date(k.date).getTime()-new Date(C.date).getTime())[0],i=s?new Date(s.date):null,l=t?[...e,t]:e,c=i?l.filter(C=>new Date(C.startTime)>i):l,o=c.flatMap(C=>C.tools.map(k=>k)),d=new Map;o.forEach(C=>{d.set(C,(d.get(C)||0)+1)});const m=Array.from(d.keys()).map(C=>r.find(P=>P.id===C)||{id:C,name:`Tool ${C}`,barcode:C,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:void 0,status:"available"}),p=m.length,f=c.length,g=o.length,y=m.filter(C=>(d.get(C.id)||0)>1).length,v=[...new Set(c.map(C=>C.operator).filter(C=>typeof C=="string"))],x=c.length>0?{start:new Date(Math.min(...c.map(C=>new Date(C.startTime).getTime()))),end:new Date(Math.max(...c.map(C=>new Date(C.startTime).getTime())))}:null,b=m.reduce((C,k)=>{const P=k.category||"Unknown";return C[P]=(C[P]||0)+1,C},{});return{lastPassedDate:i,affectedCycles:c,affectedTools:m,totalToolsAffected:p,totalCyclesAffected:f,totalSterilizationEvents:g,toolsUsedMultipleTimes:y,uniqueOperators:v,dateRange:x,toolsByCategory:b,hasCurrentCycleAffected:!!(t&&(!i||new Date(t.startTime)>i))}},[n,e,t,r])},y_=({biFailureDetails:n})=>{var e,t,r,s,i;const l=jo();return l.affectedCycles&&l.affectedCycles.map(c=>c.batchId).filter(c=>!!c),n?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(N,{path:Le,size:1.2,className:"text-red-500"}),a.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),a.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4 p-3 bg-white rounded-lg border border-red-100",children:[a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"flex items-center justify-center mb-1",children:[a.jsx(N,{path:xn,size:1,className:"text-red-500 mr-1"}),a.jsx("span",{className:"text-xs font-medium text-red-700",children:"Cycles"})]}),a.jsx("div",{className:"text-lg font-bold text-red-800",children:l.totalCyclesAffected})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"flex items-center justify-center mb-1",children:[a.jsx(N,{path:xs,size:1,className:"text-red-500 mr-1"}),a.jsx("span",{className:"text-xs font-medium text-red-700",children:"Batches"})]}),a.jsx("div",{className:"text-lg font-bold text-red-800",children:((e=n.affectedBatchIds)==null?void 0:e.length)||0})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"flex items-center justify-center mb-1",children:[a.jsx(N,{path:kr,size:1,className:"text-red-500 mr-1"}),a.jsx("span",{className:"text-xs font-medium text-red-700",children:"Tools"})]}),a.jsx("div",{className:"text-lg font-bold text-red-800",children:n.affectedToolsCount||0})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"flex items-center justify-center mb-1",children:[a.jsx(N,{path:_g,size:1,className:"text-red-600 mr-1"}),a.jsx("span",{className:"text-xs font-medium text-red-700",children:"Multi-Use"})]}),a.jsx("div",{className:"text-lg font-bold text-red-800",children:l.toolsUsedMultipleTimes})]})]}),a.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:kr,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Affected Tools:"})," ",n.affectedToolsCount||0," tools are currently quarantined"]})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:xn,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Failure Date:"})," ",n.date?n.date.toLocaleDateString():"Unknown date"]})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:xn,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Risk Window:"})," ",l.dateRange?a.jsxs("span",{className:"font-mono text-xs",children:[l.dateRange.start.toLocaleDateString()," →"," ",l.dateRange.end.toLocaleDateString()]}):"All cycles (no previous passed BI test)"]})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:xs,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Affected Batches:"})," ",(((t=n.affectedBatchIds)==null?void 0:t.length)||0)>0?a.jsxs("span",{className:"font-mono text-xs",children:[(r=n.affectedBatchIds)==null?void 0:r.slice(0,3).join(", "),(((s=n.affectedBatchIds)==null?void 0:s.length)||0)>3&&` +${(((i=n.affectedBatchIds)==null?void 0:i.length)||0)-3} more`]}):"No batch IDs available"]})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:kr,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Operator:"})," ",n.operator]})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:kr,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Tools by Category:"})," ",a.jsx("span",{className:"text-xs",children:l.toolsByCategory?Object.entries(l.toolsByCategory).map(([c,o])=>`${c}: ${o}`).join(", "):"No tools categorized"})]})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:Le,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Contamination Scope:"})," ",l.totalSterilizationEvents," total sterilization events in risk window."," ",l.toolsUsedMultipleTimes>0&&a.jsxs("span",{className:"text-red-600 font-medium",children:[l.toolsUsedMultipleTimes," tools used multiple times (require extra attention)"]})]})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(N,{path:Le,size:.8,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("strong",{children:"Detected By:"})," ",n.operator," •"," ",a.jsx("strong",{children:"Date:"})," ",(()=>{try{return n.date?n.date instanceof Date?n.date.toLocaleDateString():new Date(n.date).toLocaleDateString():"Unknown date"}catch(c){return console.error("Date formatting error:",c),"Invalid date"}})()]})]})]})]}):a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(N,{path:Le,size:1.2,className:"text-red-500"}),a.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),a.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Affected Tools:"})," 0 tools are currently quarantined"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Failure Date:"})," Unknown date"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Affected Batches:"})," No batch IDs available"]})]})]})};var v_=Object.defineProperty,__=Object.defineProperties,x_=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,b_=Object.prototype.hasOwnProperty,w_=Object.prototype.propertyIsEnumerable,Ql=(n,e,t)=>e in n?v_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Yl=(n,e)=>{for(var t in e||(e={}))b_.call(e,t)&&Ql(n,t,e[t]);if(Kl)for(var t of Kl(e))w_.call(e,t)&&Ql(n,t,e[t]);return n},Jl=(n,e)=>__(n,x_(e)),S_=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const C_=({onToggleExposureReport:n})=>{const{currentUser:e,initializeUserContext:t}=Mr();h.useEffect(()=>{e||t()},[e,t]);const[r,s]=h.useState([]),[i,l]=h.useState(!1),[c,o]=h.useState(null);h.useEffect(()=>{const v=()=>{l(!0);const b=sessionStorage.getItem("biFailureWorkflowState");if(b)try{const C=JSON.parse(b);s(C),console.log("📋 Restored workflow state from session storage")}catch(C){console.error("Failed to parse saved workflow state:",C),x()}else x();l(!1)},x=()=>{s([{step_id:"quarantine",status:"in_progress"},{step_id:"re-sterilization",status:"pending"},{step_id:"new-bi-test",status:"pending"},{step_id:"documentation",status:"pending"}])};v()},[]);const d=v=>S_(null,null,function*(){if(!e){console.error("No current user available - currentUser:",e);return}const x=e.id||e.email||"unknown-user",b=r.findIndex(C=>C.step_id===v);if(b===-1){console.error(`Step ${v} not found`);return}try{const C=[...r];C[b]=Jl(Yl({},C[b]),{status:"completed",completed_by_user_id:x,completed_at:new Date().toISOString(),notes:`Completed by ${e.email}`}),b+1<C.length&&(C[b+1]=Jl(Yl({},C[b+1]),{status:"in_progress"})),s(C),sessionStorage.setItem("biFailureWorkflowState",JSON.stringify(C)),console.log(`✅ Step ${v} completed by ${e.email||"unknown user"}`)}catch(C){console.error(`Failed to complete step ${v}:`,C),o(`Failed to complete step: ${C instanceof Error?C.message:"Unknown error"}`)}}),u=v=>{const x=r.find(b=>b.step_id===v);return(x==null?void 0:x.status)||"pending"},m=v=>{const x=r.find(b=>b.step_id===v);return(x==null?void 0:x.status)==="in_progress"},p=v=>{const x=r.find(b=>b.step_id===v);return{completedBy:x==null?void 0:x.completed_by_user_id,completedAt:x==null?void 0:x.completed_at,notes:x==null?void 0:x.notes}},f=[{id:"quarantine",title:"Quarantine All Affected Tools",description:"Ensure all tools from affected batches are properly quarantined",icon:xs,isInteractive:!0},{id:"re-sterilization",title:"Re-sterilize All Quarantined Tools",description:"Re-sterilize all affected tools using proper protocols",icon:bs,isInteractive:!0},{id:"new-bi-test",title:"Perform New BI Test",description:"Conduct a new biological indicator test to verify sterilization",icon:bs,isInteractive:!0},{id:"documentation",title:"Complete Documentation",description:"Document all actions taken and results obtained",icon:Ft,isInteractive:!0}],g=v=>{switch(v){case"completed":return"text-green-600 bg-green-50 border-green-200";case"in_progress":return"text-blue-600 bg-blue-50 border-blue-200";case"pending":return"text-gray-600 bg-gray-50 border-gray-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},y=v=>{switch(v){case"completed":return"Completed";case"in_progress":return"In Progress";case"pending":return"Pending";default:return"Unknown"}};return i?a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),a.jsxs("div",{className:"text-center py-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading workflow progress..."})]})]}):c?a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(N,{path:Le,size:1.2,className:"text-red-500 mr-2"}),a.jsx("p",{className:"text-red-700",children:c})]})})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),a.jsx("div",{className:"space-y-3",children:f.map(v=>{const x=u(v.id),b=x==="completed",C=x==="pending",k=m(v.id),P=p(v.id);return a.jsx("div",{className:`border rounded-lg p-4 ${C?"text-gray-400 bg-gray-50 border-gray-200":g(x)}`,children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(N,{path:v.icon,size:1.2,className:"mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("h4",{className:"font-medium",children:v.title}),a.jsx("div",{className:"flex items-center space-x-2",children:k?a.jsxs("button",{onClick:()=>d(v.id),className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-xs font-medium",children:[a.jsx(N,{path:xg,size:.8}),a.jsx("span",{children:"Mark Complete"})]}):b?a.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-white bg-opacity-75",children:y(x)}):C?a.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-200 text-gray-500",children:"Waiting for previous step"}):null})]}),a.jsx("p",{className:"text-sm opacity-90",children:v.description}),v.isInteractive&&b&&a.jsx("div",{className:"mt-2 text-xs opacity-75",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("span",{children:["✅ Completed by:"," ",P.completedBy||"Unknown"]}),a.jsxs("span",{children:["🕒"," ",P.completedAt?new Date(P.completedAt).toLocaleString():"Unknown time"]})]})})]})]})},v.id)})}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(N,{path:hh,size:1.2,className:"text-blue-500"}),a.jsx("span",{className:"font-medium text-blue-800",children:"Exposure Tracking"})]}),a.jsx("button",{onClick:n,onKeyDown:v=>v.key==="Enter"&&n(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium","aria-label":"View exposure report",children:"View Exposure Report"})]})})]})},I_=({error:n,onRetry:e,getErrorColor:t})=>{if(!n)return null;const r=()=>{e()},s=i=>{i.key==="Enter"&&n.retryable&&r()};return a.jsx("div",{className:`border rounded-lg p-4 ${t(n.severity)}`,children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(N,{path:Le,size:1.2,className:"mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h4",{className:"font-medium",children:[n.severity==="critical"&&"Critical Error",n.severity==="high"&&"High Priority Error",n.severity==="medium"&&"Error",n.severity==="low"&&"Warning"]}),n.code&&a.jsxs("span",{className:"text-xs font-mono bg-white bg-opacity-75 px-2 py-1 rounded",children:["Error Code: ",n.code]})]}),a.jsx("p",{className:"text-sm mb-3",children:n.message}),n.retryable&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("button",{onClick:r,onKeyDown:s,className:"inline-flex items-center space-x-1 px-3 py-1.5 text-sm font-medium bg-white bg-opacity-75 hover:bg-opacity-90 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-current","aria-label":"Retry the operation",children:[a.jsx(N,{path:Lt,size:.9}),a.jsx("span",{children:"Retry"})]}),a.jsx("span",{className:"text-xs opacity-75",children:"This error may be temporary. You can try again."})]}),!n.retryable&&a.jsx("p",{className:"text-xs opacity-75",children:"This error requires manual intervention. Please contact your supervisor."})]})]})})},j_=({isLoading:n,isResolveButtonDisabled:e,resolveButtonText:t,resolutionNotes:r,onResolve:s,onCancel:i,onUpdateNotes:l})=>{const c=m=>{l(m.target.value)},o=()=>{e||s()},d=()=>{n||i()},u=m=>{m.key==="Enter"&&(m.ctrlKey||m.metaKey)&&!e&&(m.preventDefault(),o()),m.key==="Escape"&&!n&&d()};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"resolution-notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Notes"}),a.jsx("textarea",{id:"resolution-notes",value:r,onChange:c,onKeyDown:u,disabled:n,rows:4,className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${n?"bg-gray-100 cursor-not-allowed":"bg-white"}`,placeholder:"Document the steps taken to resolve this BI failure incident...","aria-describedby":"resolution-notes-help"}),a.jsx("p",{id:"resolution-notes-help",className:"mt-1 text-sm text-gray-500",children:"Include details about re-sterilization parameters, new BI test results, and any corrective actions taken."})]}),a.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[a.jsx("button",{onClick:d,disabled:n,className:`px-4 py-2 text-sm font-medium rounded-md border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${n?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,"aria-label":"Cancel resolution",children:"Cancel"}),a.jsx("button",{onClick:o,disabled:e,className:`px-4 py-2 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${e?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,"aria-label":"Resolve BI failure incident",children:t})]}),a.jsx("div",{className:"text-xs text-gray-500 text-center",children:a.jsxs("p",{children:[a.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Ctrl+Enter"})," ","to resolve •"," ",a.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel"]})})]})};var Xl=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Lh={getLastSuccessfulBIDate(n){return Xl(this,null,function*(){try{const{data:e,error:t}=yield _.from("bi_incidents").select("completed_at").eq("facility_id",n).eq("status","passed").order("completed_at",{ascending:!1}).limit(1).single();return t?(console.warn("No previous successful BI found or query failed:",t.message),null):(e==null?void 0:e.completed_at)||null}catch(e){return console.error("Error fetching lastSuccessfulBIDate:",e),null}})},getToolsInExposureWindow(n,e){return Xl(this,null,function*(){var t;try{const{data:{user:r},error:s}=yield _.auth.getUser();if(s||!r)return console.error("Unauthorized: cannot fetch exposure tools."),[];const i=(t=r.user_metadata)==null?void 0:t.facility_id;if(!i)return console.error("Missing facility_id — cannot scope exposure query."),[];let l=n;l||(l=(yield Lh.getLastSuccessfulBIDate(i))||new Date(Date.now()-10080*60*1e3).toISOString());const c=e||new Date().toISOString(),{data:o,error:d}=yield _.from("sterilization_tools").select("id, name, last_used_at, status").eq("facility_id",i).gte("last_used_at",l).lte("last_used_at",c);if(d)throw new Error(d.message);return console.info(`✅ Exposure window computed: ${l} → ${c} (${(o==null?void 0:o.length)||0} tools)`),o||[]}catch(r){return console.error("Error computing exposure window:",r),[]}})}};class E_{constructor(){this.cache=new Map,this.ttlMs=300*1e3}get(e){const t=this.cache.get(e);return t?Date.now()>t.expiresAt?(this.cache.delete(e),null):t.data:null}set(e,t,r){const s=r!=null?r:this.ttlMs;this.cache.set(e,{data:t,expiresAt:Date.now()+s})}clear(e){e?this.cache.delete(e):this.cache.clear()}get size(){return this.cache.size}}const ja=new E_;var T_=Object.defineProperty,N_=Object.defineProperties,k_=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertySymbols,P_=Object.prototype.hasOwnProperty,D_=Object.prototype.propertyIsEnumerable,ec=(n,e,t)=>e in n?T_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,A_=(n,e)=>{for(var t in e||(e={}))P_.call(e,t)&&ec(n,t,e[t]);if(Zl)for(var t of Zl(e))D_.call(e,t)&&ec(n,t,e[t]);return n},O_=(n,e)=>N_(n,k_(e)),st=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const _a=Et((n,e)=>({incidents:[],initError:null,setIncidents:t=>n({incidents:t}),setInitError:t=>n({initError:t}),subscribe:()=>{console.info("📡 Subscribing to realtime BI updates…");const t=_.channel("bi_incident_updates").on("postgres_changes",{event:"*",schema:"public",table:"bi_incidents"},()=>st(null,null,function*(){const{data:r,error:s}=yield _.from("bi_incidents").select("*").order("created_at",{ascending:!1});if(s){console.error("Error refreshing BI data:",s);return}e().setIncidents(r)})).subscribe();window.__bi_channel__=t},unsubscribe:()=>{const t=window.__bi_channel__;t&&(console.info("🛑 Unsubscribing from realtime BI updates"),_.removeChannel(t),window.__bi_channel__=null)}}));function R_(){return st(this,null,function*(){var n;const e=_a.getState().setInitError;try{const{data:{user:t},error:r}=yield _.auth.getUser();if(r||!t)throw new Error("Unauthorized: no authenticated user for BI init");const s=((n=t.user_metadata)==null?void 0:n.facility_id)||"",i=`bi_incidents:${s}`,l=ja.get(i);if(l){console.info("🧠 Loaded BI incidents from cache:",l.length),_a.getState().setIncidents(l),e(null);return}const{data:c,error:o}=yield _.from("bi_incidents").select("*").eq("facility_id",s).order("created_at",{ascending:!1});if(o)throw new Error(o.message);_a.getState().setIncidents(c||[]),ja.set(i,c||[]),e(null),console.info(`✅ Cached ${(c==null?void 0:c.length)||0} BI incidents for ${s}`)}catch(t){const r={message:t instanceof Error?t.message:String(t),at:new Date().toISOString()};e(r),yield eo.logSecurityEvent("security.bi_init_failed",r.message,{timestamp:r.at});try{const s=new CustomEvent("bi:init:error",{detail:r});window.dispatchEvent(s)}catch(s){}window.__BI_INIT_ERROR__=r,console.error("❌ BI initialization failed:",r.message)}})}const $_={createIncident(n){return st(this,null,function*(){var e;if(!n.affected_batch_ids||!Array.isArray(n.affected_batch_ids)||n.affected_batch_ids.length===0)throw new Error("At least one affected batch ID is required");const{data:{user:t}}=yield _.auth.getUser();if(!t)return{error:"Unauthorized"};const{data:r,error:s}=yield _.from("bi_incidents").insert([O_(A_({},n),{created_by:t.id,facility_id:((e=t.user_metadata)==null?void 0:e.facility_id)||null})]).select().single();return s?{error:s.message}:{data:r}})},resolveIncident(n,e){return st(this,null,function*(){const{data:{user:t}}=yield _.auth.getUser();if(!t)return{error:"Unauthorized"};const{data:r,error:s}=yield _.from("bi_incidents").update({status:"resolved",resolution:e,resolved_by:t.id,resolved_at:new Date().toISOString()}).eq("id",n).select().single();return s?{error:s.message}:{data:r}})},fetchActivityLogs(n=50){return st(this,null,function*(){var e;try{const{data:{user:t},error:r}=yield _.auth.getUser();if(r||!t)return console.error("Unauthorized: cannot fetch BI activity logs without a valid user."),[];const s=(e=t.user_metadata)==null?void 0:e.facility_id;if(!s)return console.error("Missing facility_id for BI activity logs."),[];const{data:i,error:l}=yield _.from("bi_activity_logs").select("*").eq("facility_id",s).order("created_at",{ascending:!1}).limit(n);return l?(console.error("Error fetching BI activity logs:",l.message),[]):(console.info(`✅ Loaded ${i.length} BI activity log entries`),i||[])}catch(t){return console.error("Unexpected BI log fetch error:",t),[]}})},identifyExposureWindowTools(n,e){return st(this,null,function*(){try{const t=yield Lh.getToolsInExposureWindow(n,e);return console.info(`✅ Identified ${t.length} tools in exposure window.`),t}catch(t){return console.error("Error identifying exposure window tools:",t instanceof Error?t.message:String(t)),[]}})},getActiveIncidents(n){return st(this,null,function*(){try{const{data:e,error:t}=yield _.from("bi_failure_incidents").select("*").eq("facility_id",n).eq("status","active");if(t)throw t;return e||[]}catch(e){return console.error("Error fetching active incidents:",e),[]}})},getAnalyticsSummary(n,e){return st(this,null,function*(){try{return{totalIncidents:0,resolvedIncidents:0,averageResolutionTime:0,facilityId:n,timeRange:e}}catch(t){return console.error("Error fetching analytics summary:",t),null}})},sendRegulatoryNotification(n,e){return st(this,null,function*(){try{return console.log(`Sending ${e} notification for incident ${n}`),{success:!0,message:"Notification sent"}}catch(t){return console.error("Error sending regulatory notification:",t),{success:!1,message:"Failed to send notification"}}})},generatePatientExposureReport(n){return st(this,null,function*(){try{return{incidentNumber:`BI-FAIL-${n}`,exposureSummary:{totalPatientsExposed:15,highRiskPatients:3,mediumRiskPatients:7,lowRiskPatients:5},riskBreakdown:{high:3,medium:7,low:5},exposureDetails:[{patientId:"P001",riskLevel:"high",exposureDate:"2024-01-15",procedures:["Surgery A","Surgery B"]},{patientId:"P002",riskLevel:"medium",exposureDate:"2024-01-15",procedures:["Surgery C"]}],recommendations:["Immediate patient notification required","Enhanced monitoring for high-risk patients","Review sterilization protocols"],generatedAt:new Date().toISOString(),generatedBy:"system"}}catch(e){throw console.error("Error generating patient exposure report:",e),new Error("Failed to generate patient exposure report")}})},generateIncidentNumber(n){return st(this,null,function*(){try{const{data:e,error:t}=yield _.from("bi_failure_incidents").select("incident_number").eq("facility_id",n).order("created_at",{ascending:!1}).limit(1);if(t)throw t;const r=e==null?void 0:e[0],i=(r!=null&&r.incident_number?parseInt(r.incident_number.split("-").pop()||"0"):0)+1;return`BI-FAIL-${n}-${i.toString().padStart(3,"0")}`}catch(e){throw console.error("Error generating incident number:",e),e}})},subscribeToBIFailureUpdates(n){return st(this,null,function*(){try{return console.log(`Subscribing to BI failure updates for facility: ${n}`),Promise.resolve()}catch(e){throw console.error("Error subscribing to BI failure updates:",e),e}})}};var M_=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const zh={exportExposureReport(n="csv"){return M_(this,null,function*(){var e;try{const{data:{user:t},error:r}=yield _.auth.getUser();if(r||!t)throw new Error("Unauthorized: no authenticated user.");const s=(e=t.user_metadata)==null?void 0:e.facility_id;if(!s)throw new Error("Missing facility_id.");const{data:i,error:l}=yield _.from("patient_exposure_reports").select("*").eq("facility_id",s).order("created_at",{ascending:!1});if(l)throw new Error(l.message);if(!i||i.length===0)throw new Error("No exposure data available.");if(n==="csv"){const c=Object.keys(i[0]),o=[c.join(","),...i.map(m=>c.map(p=>{var f;return JSON.stringify((f=m[p])!=null?f:"")}).join(","))],d=new Blob([o.join(`
`)],{type:"text/csv"}),u=document.createElement("a");u.href=URL.createObjectURL(d),u.download=`exposure_report_${s}.csv`,u.click(),console.info("✅ Exposure report exported to CSV")}else if(n==="pdf"){const c=window.open("","_blank");if(c){const o=`
            <html>
              <head><title>Exposure Report</title></head>
              <body>
                <h2>Patient Exposure Report</h2>
                <table border="1" cellspacing="0" cellpadding="5">
                  <thead><tr>${Object.keys(i[0]).map(d=>`<th>${d}</th>`).join("")}</tr></thead>
                  <tbody>
                    ${i.map(d=>`<tr>${Object.values(d).map(u=>`<td>${u!=null?u:""}</td>`).join("")}</tr>`).join("")}
                  </tbody>
                </table>
                <script>window.print()<\/script>
              </body>
            </html>`;c.document.write(o),c.document.close()}console.info("🖨️ Exposure report opened in print view")}}catch(t){console.error("❌ Export failed:",t instanceof Error?t.message:String(t)),alert(`Export failed: ${t instanceof Error?t.message:String(t)}`)}})}};var Bh=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const F_=()=>Bh(null,null,function*(){try{const{biFailureDetails:n}=ne.getState(),e=sessionStorage.getItem("currentBIFailureIncidentId");if(e)return e;if(n){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const s=Math.random()*16|0;return(r==="x"?s:s&3|8).toString(16)});return sessionStorage.setItem("currentBIFailureIncidentId",t),t}return null}catch(n){return console.error("Failed to get current incident ID:",n),null}}),tc=()=>{zh.exportExposureReport("pdf")},rc=()=>{zh.exportExposureReport("csv")},L_=({isOpen:n,onClose:e,incidentId:t})=>{const[r,s]=h.useState(null),[i,l]=h.useState(!1),[c,o]=h.useState(null),d=h.useCallback(()=>Bh(null,null,function*(){l(!0),o(null);try{const f=t||(yield F_());if(!f)throw new Error("No incident ID available for exposure report");const g=yield $_.generatePatientExposureReport(f);s(g)}catch(f){o(f instanceof Error?f.message:"Failed to load exposure report")}finally{l(!1)}}),[t]);h.useEffect(()=>{n&&d()},[n,d]);const u=()=>{s(null),o(null),e()},m=f=>{f.target===f.currentTarget&&u()},p=f=>{f.key==="Escape"&&u()};return n?js.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:m,onKeyDown:p,role:"button",tabIndex:0,"aria-label":"Close modal backdrop",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto scrollbar-hide",role:"dialog","aria-labelledby":"exposure-report-title","aria-describedby":"exposure-report-description",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(N,{path:hh,size:1.5,className:"text-blue-500"}),a.jsxs("div",{children:[a.jsx("h2",{id:"exposure-report-title",className:"text-xl font-semibold text-gray-900",children:"Exposure Report"}),a.jsx("p",{id:"exposure-report-description",className:"text-sm text-gray-600",children:'Tools scanned dirty in "IN USE" rooms during BI failure risk window'})]})]}),a.jsx("button",{onClick:u,onKeyDown:f=>f.key==="Enter"&&u(),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close exposure report",children:a.jsx(N,{path:pt,size:1.2})})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[i&&a.jsxs("div",{className:"flex items-center justify-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),a.jsx("span",{className:"ml-3 text-gray-600",children:"Loading exposure report..."})]}),c&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(N,{path:Le,size:1.2,className:"text-red-500"}),a.jsxs("span",{className:"text-red-800",children:["Error: ",c]})]})}),r&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid grid-cols-1 gap-4",children:a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(N,{path:Aa,size:1.2,className:"text-red-500"}),a.jsx("span",{className:"font-medium text-red-800",children:'"IN USE" Rooms with Tool Contamination'})]}),a.jsx("p",{className:"text-2xl font-bold text-red-900 mb-3",children:r.totalRoomsAffected||0}),a.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[a.jsx("p",{className:"font-medium",children:"Risk Window Analysis:"}),a.jsx("p",{children:'This count shows tools that were used between the last passed BI test and the failed BI test. The tools have been traced to the rooms that were marked "IN USE" and scanned for use, taking them from a clean to dirty status.'}),a.jsx("p",{className:"font-medium text-red-800",children:"⚠️ Important:"}),a.jsx("p",{children:"These tools could have been cycled through the autoclave many times before a failed BI was identified. It is important to validate this list against your patient records software to initiate a patient trace and contact plan (if in your policies and procedures)."})]})]})}),r.roomDetails&&r.roomDetails.length>0?a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Room Exposure Analysis"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:'Tools scanned dirty in "IN USE" rooms during risk window'})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time/Date"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Room"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Associated Tools Scanned"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.roomDetails.map((f,g)=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"font-medium",children:new Date(String(f.roomUsedDate)).toLocaleDateString()}),a.jsx("div",{className:"text-xs text-gray-500",children:new Date(String(f.roomUsedDate)).toLocaleTimeString()})]})}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"font-medium",children:String(f.roomName)}),a.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",String(f.roomId)]})]})}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length>0?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length," tool",f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length!==1?"s":""," ","scanned dirty"]}),a.jsx("div",{className:"flex flex-wrap gap-1",children:f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.map((y,v)=>a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:String(y)},v))})]}):a.jsx("span",{className:"text-gray-400 italic",children:"No tools scanned"})})]},g))})]})})]}):a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(N,{path:to,size:1.2,className:"text-green-500"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-green-800",children:"No Room Exposure Found"}),a.jsxs("div",{className:"text-green-700 space-y-2",children:[a.jsx("p",{children:'Based on tool scans, it looks as though no tools that were autoclaved after the passed BI and before the failed BI have been initiated in the "dirty tool" status.'}),a.jsx("p",{className:"font-medium text-green-800",children:"This would indicate that there is no patient tracing needed."}),a.jsx("p",{className:"text-sm",children:"However, if your team is not scanning consistently, this data could be inaccurate."})]})]})]})}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{onClick:rc,onKeyDown:f=>f.key==="Enter"&&rc(),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Export exposure report",children:[a.jsx(N,{path:ph,size:1}),a.jsx("span",{children:"Export Report"})]}),a.jsxs("button",{onClick:tc,onKeyDown:f=>f.key==="Enter"&&tc(),className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Print exposure report",children:[a.jsx(N,{path:fh,size:1}),a.jsx("span",{children:"Print Report"})]})]}),a.jsx("button",{onClick:u,onKeyDown:f=>f.key==="Enter"&&u(),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})]})]})]})]})}),document.body):null};var z_=Object.defineProperty,B_=Object.defineProperties,q_=Object.getOwnPropertyDescriptors,nc=Object.getOwnPropertySymbols,U_=Object.prototype.hasOwnProperty,H_=Object.prototype.propertyIsEnumerable,sc=(n,e,t)=>e in n?z_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,V_=(n,e)=>{for(var t in e||(e={}))U_.call(e,t)&&sc(n,t,e[t]);if(nc)for(var t of nc(e))H_.call(e,t)&&sc(n,t,e[t]);return n},W_=(n,e)=>B_(n,q_(e));const G_=({isOpen:n,onClose:e,onMinimize:t,isMinimized:r=!1})=>{const{isLoading:s,error:i,showExposureReport:l,resolutionNotes:c,biFailureDetails:o,handleResolve:d,handleRetry:u,handleClose:m,handleBackdropClick:p,handleKeyDown:f,toggleExposureReport:g,updateResolutionNotes:y,getErrorColor:v,isResolveButtonDisabled:x,getResolveButtonText:b}=f_({onClose:e,onSuccess:()=>{}});return n?js.createPortal(a.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 p-4",style:{paddingTop:"12rem"},onClick:p,role:"button",tabIndex:0,"aria-label":"Close modal by clicking outside",onKeyDown:C=>{if(C.key==="Enter"||C.key===" "){C.preventDefault();const k=W_(V_({},C),{target:C.currentTarget,currentTarget:C.currentTarget,nativeEvent:C.nativeEvent,bubbles:!0,cancelable:!0,button:0});p(k)}},children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-y-auto transform translate-y-16 scrollbar-hide",role:"dialog","aria-labelledby":"bi-failure-modal-title","aria-describedby":"bi-failure-modal-description",onKeyDown:f,children:[a.jsx(g_,{isSubmitting:s,onClose:m,onMinimize:t}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx(y_,{biFailureDetails:o?{date:typeof o.failure_date=="string"?new Date(o.failure_date):o.failure_date instanceof Date?o.failure_date:new Date,affectedToolsCount:o.affected_tools_count,affectedBatchIds:o.affected_batch_ids,operator:o.detected_by_operator_id}:null}),a.jsx(C_,{showExposureReport:l,onToggleExposureReport:g}),a.jsx(I_,{error:i,onRetry:u,getErrorColor:v}),a.jsx(j_,{isLoading:s,isResolveButtonDisabled:x(),resolveButtonText:b(),resolutionNotes:c,onResolve:d,onCancel:m,onUpdateNotes:y})]})]}),l&&a.jsx(L_,{isOpen:l,onClose:g,incidentId:o==null?void 0:o.id})]}),document.body):null},K_=({isOpen:n,onClose:e})=>a.jsx(G_,{isOpen:n,onClose:e}),Q_=({onDismiss:n})=>{const[e,t]=h.useState(!1),[r,s]=h.useState(!1),{biFailureActive:i,biFailureDetails:l}=ne(),{currentUser:c}=Mr();return i?a.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[9999] bg-red-600 text-white shadow-lg",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[a.jsx("div",{className:"p-1 bg-red-700 rounded-lg flex-shrink-0",children:a.jsx(N,{path:Le,size:1.2,className:"text-white"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h3",{className:"text-lg font-bold",children:"🚨 TOOL RECALL: BI TEST FAILURE"}),a.jsx("span",{className:"text-sm bg-red-700 px-2 py-1 rounded",children:l!=null&&l.failure_date&&typeof l.failure_date=="string"?new Date(l.failure_date).toLocaleDateString():l!=null&&l.failure_date&&l.failure_date instanceof Date?l.failure_date.toLocaleDateString():"Today"})]}),a.jsxs("p",{className:"text-sm text-red-100 mt-1",children:[a.jsx("strong",{children:"CRITICAL:"})," All tools sterilized since the last successful BI test must be quarantined immediately. Check packaging for affected batch numbers."]})]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:()=>{t(!0),s(!1)},className:"flex items-center gap-2 bg-red-700 hover:bg-red-800 px-3 py-1 rounded-lg transition-colors",title:r?"Resume workflow":"View resolution workflow",children:[a.jsx(N,{path:gh,size:1,className:"text-white"}),a.jsx("span",{className:"text-sm font-medium",children:r?"Resume Workflow":"Resolution Workflow"})]}),(l==null?void 0:l.affected_tools_count)!==void 0&&a.jsxs("div",{className:"flex items-center gap-2 bg-red-700 px-3 py-1 rounded-lg",children:[a.jsx(N,{path:xs,size:1,className:"text-white"}),a.jsxs("span",{className:"text-sm font-medium",children:[l.affected_tools_count," tools affected"]})]}),n&&a.jsx("button",{onClick:n,className:"p-1 hover:bg-red-700 rounded-lg transition-colors",title:"Dismiss banner",children:a.jsx(N,{path:pt,size:1.2,className:"text-white"})})]})]}),a.jsx(K_,{isOpen:e,onClose:()=>t(!1)})]}):null},Y_=({onDismiss:n})=>{const e=Da();return e.pathname==="/login"||e.pathname.startsWith("/auth")?null:a.jsx(Q_,{onDismiss:n})};var J_=Object.defineProperty,X_=Object.defineProperties,Z_=Object.getOwnPropertyDescriptors,ac=Object.getOwnPropertySymbols,e0=Object.prototype.hasOwnProperty,t0=Object.prototype.propertyIsEnumerable,ic=(n,e,t)=>e in n?J_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,oc=(n,e)=>{for(var t in e||(e={}))e0.call(e,t)&&ic(n,t,e[t]);if(ac)for(var t of ac(e))t0.call(e,t)&&ic(n,t,e[t]);return n},lc=(n,e)=>X_(n,Z_(e));class r0{constructor(){this.notifications=[],this.notificationHistory=[],this.listeners=[]}addNotification(e){const t=lc(oc({},e),{id:`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date});this.notifications.unshift(t),this.notifyListeners(),setTimeout(()=>{this.removeNotification(t.id)},5e3)}removeNotification(e){const t=this.notifications.find(r=>r.id===e);t&&(this.notificationHistory.push(lc(oc({},t),{timestamp:new Date})),this.notificationHistory.length>100&&(this.notificationHistory=this.notificationHistory.slice(-100))),this.notifications=this.notifications.filter(r=>r.id!==e),this.notifyListeners()}clearAll(){this.notifications=[],this.notifyListeners()}getNotifications(){return[...this.notifications]}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){this.listeners.forEach(e=>e([...this.notifications]))}notifyToolAvailable(e,t,r,s,i){let l="Tool Tracking Started",c=`You're now tracking ${t}`;r&&s&&(c=`You're tracking ${t}. Position: ${r} of ${s}`,i==="high"?(l="🔥 High Priority Tracking Started",c=`HIGH PRIORITY: ${c}`):i==="medium"?l="⚡ Medium Priority Tracking Started":i==="low"&&(l="📋 Low Priority Tracking Started")),this.addNotification({type:"tool_available",title:l,message:c,toolId:e,toolName:t,action:{label:"View Queue",onClick:()=>{console.log(`View queue for tool ${e}`)}}})}notifyPositionChanged(e,t,r,s){this.addNotification({type:"position_changed",title:"Queue Update",message:`You moved up! You're now #${r} of ${s} tracking ${t}.`,toolId:e,toolName:t,action:{label:"View Queue",onClick:()=>{console.log(`View queue for tool ${e}`)}}})}notifyToolUnavailable(e,t,r,s){const i=r&&s?`${t} is no longer available. You were #${r} of ${s} in queue.`:`${t} is no longer available.`;this.addNotification({type:"tool_unavailable",title:"Tool Unavailable",message:i,toolId:e,toolName:t,action:{label:"Stop Tracking",onClick:()=>{console.log(`Stop tracking tool ${e}`)}}})}notifyQueueUpdate(e,t,r,s){this.addNotification({type:"queue_update",title:"Queue Update",message:`Queue updated: You're #${r} of ${s} tracking ${t}.`,toolId:e,toolName:t})}testNotification(){this.notifyToolAvailable("test-tool-123","Test Surgical Scissors",2,5)}getNotificationHistory(){return[...this.notificationHistory].reverse()}clearNotificationHistory(){this.notificationHistory=[]}getNotificationsByType(e){return this.notificationHistory.filter(t=>t.type===e)}getNotificationsForTool(e){return this.notificationHistory.filter(t=>t.toolId===e)}}const Pr=new r0,n0=({notification:n})=>{const[e,t]=h.useState(!0);h.useEffect(()=>{const c=setTimeout(()=>{t(!1),setTimeout(()=>{Pr.removeNotification(n.id)},300)},5e3);return()=>clearTimeout(c)},[n.id]);const r=()=>{t(!1),setTimeout(()=>{Pr.removeNotification(n.id)},300)},s=()=>{switch(n.type){case"tool_available":return jn;case"position_changed":case"queue_update":return to;case"tool_unavailable":return Le;default:return to}},i=()=>{switch(n.type){case"tool_available":return"text-green-500";case"position_changed":case"queue_update":return"text-blue-500";case"tool_unavailable":return"text-orange-500";default:return"text-gray-500"}},l=()=>{switch(n.type){case"tool_available":return n.title.includes("🔥")?"bg-red-50 border-red-200":n.title.includes("⚡")?"bg-yellow-50 border-yellow-200":n.title.includes("📋")?"bg-gray-50 border-gray-200":"bg-green-50 border-green-200";case"position_changed":case"queue_update":return"bg-blue-50 border-blue-200";case"tool_unavailable":return"bg-orange-50 border-orange-200";default:return"bg-gray-50 border-gray-200"}};return a.jsx("div",{className:`
        ${l()}
        border rounded-lg shadow-lg p-4 mb-3 max-w-sm w-full
        transform transition-all duration-300 ease-in-out
        ${e?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(N,{path:s(),size:1.2,className:i()})}),a.jsxs("div",{className:"ml-3 flex-1",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900",children:n.title}),a.jsx("p",{className:"mt-1 text-sm text-gray-600",children:n.message}),n.action&&a.jsx("button",{onClick:n.action.onClick,className:"mt-2 text-sm font-medium text-blue-600 hover:text-blue-500",children:n.action.label})]}),a.jsx("button",{onClick:r,className:"ml-4 flex-shrink-0 text-gray-400 hover:text-gray-600",children:a.jsx(N,{path:pt,size:1})})]})})},s0=()=>{const[n,e]=h.useState([]);return h.useEffect(()=>Pr.subscribe(e),[]),n.length===0?null:a.jsx("div",{className:"fixed top-4 right-4 z-[9999] max-w-sm",children:n.map(t=>a.jsx(n0,{notification:t},t.id))})};var a0=Object.defineProperty,cc=Object.getOwnPropertySymbols,i0=Object.prototype.hasOwnProperty,o0=Object.prototype.propertyIsEnumerable,dc=(n,e,t)=>e in n?a0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,l0=(n,e)=>{for(var t in e||(e={}))i0.call(e,t)&&dc(n,t,e[t]);if(cc)for(var t of cc(e))o0.call(e,t)&&dc(n,t,e[t]);return n};class Ra{static subscribe(e,t,r={}){const s=this.getChannelKey(e,r);if(!this.subscriptions.has(s)){if(!jt())return console.warn("⚠️ Supabase not configured, skipping real-time subscription"),()=>{};try{const l=_.channel(s).on("postgres_changes",l0({event:r.event||"*",schema:"public",table:e},r.filter&&{filter:r.filter}),c=>{const o=this.channelSubscribers.get(s);o&&o.forEach(d=>d(c))}).subscribe();this.subscriptions.set(s,l),this.channelSubscribers.set(s,new Set),console.log(`✅ Created shared realtime channel: ${s}`)}catch(l){return console.error(`❌ Failed to create realtime channel ${s}:`,l),()=>{}}}const i=this.channelSubscribers.get(s);return i.add(t),console.log(`📡 Added subscriber to ${s} (total: ${i.size})`),()=>{this.unsubscribe(s,t)}}static unsubscribe(e,t){const r=this.channelSubscribers.get(e);if(r&&(r.delete(t),r.size===0)){const s=this.subscriptions.get(e);s&&(_.removeChannel(s),this.subscriptions.delete(e),this.channelSubscribers.delete(e),console.log(`🔕 Cleaned up channel: ${e}`))}}static getChannelKey(e,t){const r=[e];return t.event&&t.event!=="*"&&r.push(t.event),t.filter&&r.push(t.filter),r.join("_")}static getStats(){return{activeChannels:this.subscriptions.size,totalSubscribers:Array.from(this.channelSubscribers.values()).reduce((e,t)=>e+t.size,0),tableSubscribers:Object.fromEntries(Array.from(this.channelSubscribers.entries()).map(([e,t])=>[e,t.size]))}}static cleanup(){this.subscriptions.forEach(e=>{_.removeChannel(e)}),this.subscriptions.clear(),this.channelSubscribers.clear(),console.log("🧹 Cleaned up all realtime subscriptions")}static nuclearCleanup(){console.log("🧹 Force cleaning up all realtime connections"),this.cleanup()}}Ra.subscriptions=new Map;Ra.channelSubscribers=new Map;class qh{static initialize(){if(this.isInitialized){O.realtime("🔄 SimpleRealtimeAutoOptimizer already initialized");return}O.realtime("🚀 SimpleRealtimeAutoOptimizer: Initialized (simplified)"),this.isInitialized=!0}static forceRestart(){O.realtime("🔄 SimpleRealtimeAutoOptimizer: Force restart (simplified)")}static getStatus(){return{isInitialized:this.isInitialized,optimizationStatus:{isRunning:!0,interval:"simplified",mode:"simplified"}}}static immediateNuclearCleanup(){O.realtime("🧹 SimpleRealtimeAutoOptimizer: Immediate cleanup"),Ra.cleanup()}}qh.isInitialized=!1;qh.initialize();class Uh{static startOptimization(){if(this.isOptimizing){O.realtime("🔄 SimpleRealtimeOptimizer already running");return}this.isOptimizing=!0,O.realtime("🚀 Started simplified realtime optimization")}static stopOptimization(){this.isOptimizing=!1,O.realtime("⏹️ Stopped simplified realtime optimization")}static getStatus(){return{isRunning:this.isOptimizing,interval:this.isOptimizing?"simplified":"inactive",mode:this.isOptimizing?"simplified":"inactive"}}static emergencyCleanup(){O.realtime("🧹 Emergency cleanup (simplified)"),Ra.cleanup()}}Uh.isOptimizing=!1;setTimeout(()=>{O.realtime("🚀 Auto-starting simplified realtime optimization..."),Uh.startOptimization()},2e3);var c0=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const d0=({isOpen:n,onOpen:e,onClose:t,hasComplianceIssues:r=!1})=>{const{currentUser:s,getUserDisplayName:i,isLoading:l,clearUserData:c}=Mr(),[o,d]=h.useState(!1),u=h.useRef(null),m=In(),f=Da().pathname;if(l)return a.jsx("div",{className:"bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen w-16 sm:w-20 md:w-20",children:a.jsx("div",{className:"flex-1 pt-4 flex justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[#4ECDC4]"})})});const g=v=>{m(v)},y=[{path:"/home",icon:Wf,label:"Home"},{path:"/sterilization",icon:Gf,label:"Sterilization"},{path:"/inventory",icon:Kf,label:"Inventory"},{path:"/environmental-clean",icon:Qf,label:"Environmental Clean"},{path:"/knowledge-hub",icon:Yf,label:"Knowledge Hub"},{path:"/intelligence",icon:Jf,label:"Intelligence"},{path:"/settings",icon:Xf,label:"Settings"}];return a.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen ${n?"w-full sm:w-64 md:w-64":"w-16 sm:w-20 md:w-20"}`,children:[a.jsxs("div",{className:"flex-1 pt-4 overflow-y-auto",children:[n?a.jsxs("div",{className:"px-4 sm:px-6 pb-6 flex justify-between items-center",children:[a.jsx("div",{className:"relative",children:a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[#4ECDC4]",children:"Cliniio"})}),a.jsx("button",{onClick:t,onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),t())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Collapse navigation menu (Press Enter or Space)",title:"Collapse menu (Enter/Space)",tabIndex:0,children:a.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 12H5"})})})]}):a.jsx("div",{className:"px-4 sm:px-6 pb-6 flex justify-center items-center",children:a.jsx("button",{onClick:e,onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),e())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Expand navigation menu (Press Enter or Space)",title:"Expand menu (Enter/Space)",tabIndex:0,children:a.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5l7 7-7 7"})})})}),a.jsx("nav",{children:y.map(({path:v,icon:x,label:b})=>a.jsxs("button",{onClick:()=>g(v),className:`flex items-center transition-colors duration-200 w-full text-left touch-manipulation relative ${n?"px-4 sm:px-6 py-4":"px-3 sm:px-4 py-4 justify-center"} ${f===v?"bg-[#4ECDC4] bg-opacity-10 border-r-4 border-[#4ECDC4] text-[#4ECDC4]":"text-[#5b5b5b] hover:bg-gray-50 hover:text-[#4ECDC4]"}`,"aria-label":n?b:`${b} page`,title:n?void 0:b,children:[a.jsx(x,{size:20,className:`${n?"mr-4":""} ${f===v?"text-[#4ECDC4]":"text-gray-400"}`,"aria-hidden":"true"}),n&&a.jsxs("div",{className:"flex items-center justify-between w-full",children:[a.jsx("span",{className:`font-medium whitespace-nowrap ${f===v?"text-[#4ECDC4]":"text-[#5b5b5b]"}`,children:b}),v==="/settings"&&r&&a.jsx("div",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold ml-2",children:"!"})]}),!n&&v==="/settings"&&r&&a.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold",children:"!"})]},v))})]}),a.jsx("div",{className:`${n?"p-3 sm:p-4":"p-1"} border-t border-gray-200 bg-white sticky bottom-0`,children:a.jsxs("div",{className:"relative",children:[a.jsxs("button",{ref:u,className:`flex items-center space-x-4 w-full text-left ${n?"mb-4":"justify-center mb-2"}`,onClick:()=>d(v=>!v),onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&d(x=>!x)},"aria-expanded":o,"aria-haspopup":"true","aria-label":n?`User menu for ${s?i():"User"}`:"User profile menu",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4ECDC4] flex items-center justify-center overflow-hidden",children:s!=null&&s.avatar_url?a.jsx("img",{src:s.avatar_url,alt:"Profile",className:"w-8 h-8 rounded-full object-cover",onLoad:()=>console.log("Avatar image loaded successfully in DrawerMenu"),onError:v=>console.error("Avatar image failed to load in DrawerMenu:",v)}):a.jsx(Zf,{size:20,className:"text-white"})}),n&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-700",children:i()}),a.jsx("p",{className:"text-xs text-gray-500",children:(s==null?void 0:s.role)||"User"})]})]}),o&&n&&a.jsx("div",{role:"menu","aria-labelledby":"user-menu",style:{position:"absolute",bottom:56,left:0,background:"white",borderRadius:8,boxShadow:"0 2px 16px rgba(0,0,0,0.15)",minWidth:180,zIndex:100,padding:12,textAlign:"center"},children:a.jsx("button",{role:"menuitem",className:"px-4 py-2 bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] w-full",onClick:()=>c0(null,null,function*(){console.log("🚪 DrawerMenu: Logout button clicked");try{console.log("🚪 DrawerMenu: Starting logout process..."),console.log("🚪 DrawerMenu: Calling clearUserData()..."),c(),yield new Promise(b=>setTimeout(b,100)),console.log("🚪 DrawerMenu: Calling login store reset()...");const{useLoginStore:v}=yield L(()=>import("./login-CgiYf71G.js").then(b=>b.Q),__vite__mapDeps([1,2,3,4,5]));yield v.getState().reset(),console.log("🚪 DrawerMenu: Calling auth service logout()..."),yield new eg().logout(),console.log("🚪 DrawerMenu: Logout successful, navigating to login"),m("/login"),d(!1),console.log("🔄 DrawerMenu: Reloading page for clean state..."),window.location.reload()}catch(v){console.error("🚪 DrawerMenu: Logout failed:",v),m("/login"),d(!1),console.log("🔄 DrawerMenu: Reloading page after logout error..."),window.location.reload()}}),children:"Logout"})})]})})]})},u0=()=>{const n=Da();return{getCurrentContext:()=>{const t=n.pathname;return t.includes("/sterilization")?"sterilization":t.includes("/inventory")?"inventory":t.includes("/environmental-clean")?"environmental-clean":t.includes("/home")?"home":"general"}}},m0=n=>{const e=In(),{getCurrentContext:t}=u0(),[r,s]=h.useState(null),[i,l]=h.useState(null),[c,o]=h.useState(new Set),[d,u]=h.useState(new Set),[m,p]=h.useState(new Set),[f,g]=h.useState(new Set),y=t();return{selectedHelpType:r,expandedMetrics:c,expandedTasks:d,expandedGamification:m,expandedRelevant:f,currentContext:y,handleOptionClick:w=>{w.action==="ai-chat"?s("ai-chat"):w.action==="context-help"?s("context-help"):w.action==="cliniio-help"?s("cliniio-help"):w.action==="product-feedback"?s("product-feedback"):w.action==="page"&&w.path?(e(w.path),n()):w.action==="modal"&&alert(`${w.title} - Coming soon! This will open a focused help interface.`)},handleBack:()=>{i?(s(i),l(null)):s(null)},handleFeedbackSuccess:()=>{s("cliniio-help")},toggleMetricSection:w=>{o(S=>{const A=new Set(S);return A.has(w)?A.delete(w):A.add(w),A})},toggleTaskSection:w=>{u(S=>{const A=new Set(S);return A.has(w)?A.delete(w):A.add(w),A})},toggleGamificationSection:w=>{p(S=>{const A=new Set(S);return A.has(w)?A.delete(w):A.add(w),A})},toggleRelevantSection:w=>{g(S=>{const A=new Set(S);return A.has(w)?A.delete(w):A.add(w),A})},setHelpType:w=>{l(r),s(w)}}},uc=({onOptionClick:n})=>{const e=[{id:"ai-assistant",icon:a.jsx("span",{children:"🤖"}),title:"AI Assistant",description:"Get AI-powered help and answers",action:"ai-chat"},{id:"cliniio-help",icon:a.jsx("span",{children:"💬"}),title:"Cliniio Help",description:"General help and support",action:"cliniio-help"},{id:"context-help",icon:a.jsx("span",{children:"📚"}),title:"Relevant Information",description:"Standards and protocols for your current task",action:"context-help"},{id:"product-feedback",icon:a.jsx("span",{children:"💡"}),title:"Product Feedback",description:"Report bugs or suggest improvements",action:"product-feedback"}];return a.jsx("div",{className:"p-4 space-y-3",children:e.map(t=>a.jsx("button",{onClick:()=>n(t),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:t.icon}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors text-sm",children:t.title}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]})},t.id))})};var h0=Object.defineProperty,mc=Object.getOwnPropertySymbols,p0=Object.prototype.hasOwnProperty,f0=Object.prototype.propertyIsEnumerable,hc=(n,e,t)=>e in n?h0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Fs=(n,e)=>{for(var t in e||(e={}))p0.call(e,t)&&hc(n,t,e[t]);if(mc)for(var t of mc(e))f0.call(e,t)&&hc(n,t,e[t]);return n},$n=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Eo{constructor(e={}){this.config=Fs({maxRequests:100,windowMs:60*1e3,burstLimit:10,retryDelay:1e3,maxRetries:3},e),this.generalLimiter=new Os({maxRequests:this.config.maxRequests,windowMs:this.config.windowMs,keyPrefix:"ai_general",blockDurationMs:this.config.windowMs}),this.burstLimiter=new Os({maxRequests:this.config.burstLimit,windowMs:10*1e3,keyPrefix:"ai_burst",blockDurationMs:30*1e3})}checkRateLimit(e,t=!1){return $n(this,null,function*(){try{if(t){const s=yield this.burstLimiter.checkRateLimit(e);if(!s.allowed)return{allowed:!1,remaining:0,resetTime:s.resetTime,retryAfter:s.retryAfter,burstRemaining:0}}const r=yield this.generalLimiter.checkRateLimit(e);return{allowed:r.allowed,remaining:r.remaining,resetTime:r.resetTime,retryAfter:r.retryAfter,burstRemaining:t?yield this.getBurstRemaining(e):void 0}}catch(r){return O.error("AI rate limit check failed:",r),{allowed:!0,remaining:this.config.maxRequests,resetTime:Date.now()+this.config.windowMs}}})}recordRequest(e,t=!1){return $n(this,null,function*(){try{t&&(yield this.burstLimiter.checkRateLimit(e)),yield this.generalLimiter.checkRateLimit(e)}catch(r){O.error("AI rate limit recording failed:",r)}})}getBurstRemaining(e){return $n(this,null,function*(){try{return(yield this.burstLimiter.getRateLimitStatus(e)).remaining}catch(t){return O.error("Failed to get burst remaining:",t),this.config.burstLimit}})}resetRateLimit(e){return $n(this,null,function*(){try{yield Promise.all([this.generalLimiter.resetRateLimit(e),this.burstLimiter.resetRateLimit(e)])}catch(t){O.error("Failed to reset AI rate limits:",t)}})}getStatus(e){return $n(this,null,function*(){try{const[t,r]=yield Promise.all([this.generalLimiter.getRateLimitStatus(e),this.burstLimiter.getRateLimitStatus(e)]);return{general:{allowed:t.allowed,remaining:t.remaining,resetTime:t.resetTime,retryAfter:t.retryAfter},burst:{allowed:r.allowed,remaining:r.remaining,resetTime:r.resetTime,retryAfter:r.retryAfter}}}catch(t){return O.error("Failed to get AI rate limit status:",t),{general:{allowed:!0,remaining:this.config.maxRequests,resetTime:Date.now()+this.config.windowMs},burst:{allowed:!0,remaining:this.config.burstLimit,resetTime:Date.now()+10*1e3}}}})}updateConfig(e){this.config=Fs(Fs({},this.config),e),this.generalLimiter=new Os({maxRequests:this.config.maxRequests,windowMs:this.config.windowMs,keyPrefix:"ai_general",blockDurationMs:this.config.windowMs}),this.burstLimiter=new Os({maxRequests:this.config.burstLimit,windowMs:10*1e3,keyPrefix:"ai_burst",blockDurationMs:30*1e3}),O.info("AI rate limiter configuration updated",e)}getConfigs(){return Fs({},this.config)}getStats(){return{general:this.generalLimiter.getStats(),burst:this.burstLimiter.getStats(),config:this.config}}isHealthy(){try{const e=this.generalLimiter.getStats(),t=this.burstLimiter.getStats();return e.redisHealthy||t.redisHealthy}catch(e){return O.error("Health check failed:",e),!1}}}const oo=new Eo({maxRequests:50,windowMs:60*1e3,burstLimit:5,retryDelay:2e3,maxRetries:3});new Eo({maxRequests:20,windowMs:60*1e3,burstLimit:3,retryDelay:3e3,maxRetries:2});new Eo({maxRequests:10,windowMs:300*1e3,burstLimit:2,retryDelay:5e3,maxRetries:1});var g0=Object.defineProperty,pc=Object.getOwnPropertySymbols,y0=Object.prototype.hasOwnProperty,v0=Object.prototype.propertyIsEnumerable,fc=(n,e,t)=>e in n?g0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ti=(n,e)=>{for(var t in e||(e={}))y0.call(e,t)&&fc(n,t,e[t]);if(pc)for(var t of pc(e))v0.call(e,t)&&fc(n,t,e[t]);return n},Ls=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class _0{constructor(e={}){this.queue=[],this.processing=!1,this.activeRequests=0,this.processingInterval=null,this.results=new Map,this.config=ti({maxConcurrent:5,batchSize:3,processingInterval:1e3,retryDelay:2e3},e)}addRequest(e,t,r){return Ls(this,arguments,function*(s,i,l,c={}){const o={id:`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,service:s,identifier:i,operation:l,priority:c.priority||0,maxRetries:c.maxRetries||3,timeout:c.timeout||3e4,createdAt:new Date,metadata:c.metadata};return this.queue.push(o),this.queue.sort((d,u)=>u.priority-d.priority),O.debug(`Added request to queue: ${o.id} (priority: ${o.priority})`),this.processing||this.startProcessing(),this.waitForCompletion(o.id)})}startProcessing(){this.processing||(this.processing=!0,this.processingInterval=setInterval(()=>{this.processQueue()},this.config.processingInterval),O.info("AI request queue processing started"))}stopProcessing(){this.processingInterval&&(clearInterval(this.processingInterval),this.processingInterval=null),this.processing=!1,O.info("AI request queue processing stopped")}processQueue(){return Ls(this,null,function*(){if(this.activeRequests>=this.config.maxConcurrent||this.queue.length===0)return;const e=this.queue.splice(0,this.config.batchSize);for(const t of e){if(this.activeRequests>=this.config.maxConcurrent){this.queue.unshift(...e.slice(e.indexOf(t)));break}this.processRequest(t)}})}processRequest(e){return Ls(this,null,function*(){this.activeRequests++;try{O.debug(`Processing request: ${e.id}`);const t=yield oo.checkRateLimit(e.identifier);if(!t.allowed)throw new Error(`Rate limit exceeded. Retry after ${t.retryAfter}ms`);const r=yield e.operation();yield oo.recordRequest(e.identifier),this.storeResult(e.id,{success:!0,data:r})}catch(t){O.error(`Request ${e.id} failed:`,t),e.maxRetries>0?(e.maxRetries--,this.queue.push(e),O.debug(`Retrying request ${e.id} (${e.maxRetries} retries left)`)):this.storeResult(e.id,{success:!1,error:t instanceof Error?t.message:"Unknown error"})}finally{this.activeRequests--}})}waitForCompletion(e){return Ls(this,null,function*(){return new Promise((t,r)=>{const s=()=>{const i=this.getResult(e);i?i.success?t(i.data):r(new Error(i.error)):setTimeout(s,100)};s()})})}storeResult(e,t){this.results.set(e,t)}getResult(e){return this.results.get(e)}getStats(){return{queueLength:this.queue.length,activeRequests:this.activeRequests,processing:this.processing,config:this.config}}clearQueue(){this.queue=[],this.results.clear(),O.info("AI request queue cleared")}updateConfig(e){this.config=ti(ti({},this.config),e),O.info("AI request queue configuration updated:",this.config)}}const zs=new _0;var Mn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class x0{constructor(e="cliniio"){this.cache=new Map,this.namespace=e}getKey(e){return`${this.namespace}:${e}`}get(e){return Mn(this,null,function*(){try{const t=this.cache.get(this.getKey(e));return t&&t.expires>Date.now()?t.value:(t&&this.cache.delete(this.getKey(e)),null)}catch(t){return O.error("In-memory cache get error:",t),null}})}set(e,t){return Mn(this,arguments,function*(r,s,i={}){try{const l=i.ttl||300,c=Date.now()+l*1e3;this.cache.set(this.getKey(r),{value:s,expires:c})}catch(l){O.error("In-memory cache set error:",l)}})}del(e){return Mn(this,null,function*(){try{this.cache.delete(this.getKey(e))}catch(t){O.error("In-memory cache delete error:",t)}})}exists(e){return Mn(this,null,function*(){try{const t=this.cache.get(this.getKey(e));return t?t.expires>Date.now():!1}catch(t){return O.error("In-memory cache exists error:",t),!1}})}clear(){return Mn(this,null,function*(){try{this.cache.clear()}catch(e){O.error("In-memory cache clear error:",e)}})}cleanup(){const e=Date.now();for(const[t,r]of Array.from(this.cache.entries()))r.expires<=e&&this.cache.delete(t)}getStats(){return{size:this.cache.size,isRedis:!1}}}var Fn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class b0{constructor(e="cliniio"){this.namespace=e,this.fallbackCache=new x0(e)}getKey(e){return`${this.namespace}:${e}`}get(e){return Fn(this,null,function*(){try{if(ot.isHealthy()){const r=yield ot.getClient().get(this.getKey(e));return r?JSON.parse(r):null}else return yield this.fallbackCache.get(e)}catch(t){return O.error("Cache get error:",t),yield this.fallbackCache.get(e)}})}set(e,t){return Fn(this,arguments,function*(r,s,i={}){try{if(ot.isHealthy()){const l=ot.getClient(),c=i.ttl||300;yield l.setEx(this.getKey(r),c,JSON.stringify(s))}else yield this.fallbackCache.set(r,s,i)}catch(l){O.error("Cache set error:",l),yield this.fallbackCache.set(r,s,i)}})}del(e){return Fn(this,null,function*(){try{ot.isHealthy()?yield ot.getClient().del(this.getKey(e)):yield this.fallbackCache.del(e)}catch(t){O.error("Cache delete error:",t),yield this.fallbackCache.del(e)}})}exists(e){return Fn(this,null,function*(){try{return ot.isHealthy()?(yield ot.getClient().exists(this.getKey(e)))===1:yield this.fallbackCache.exists(e)}catch(t){return O.error("Cache exists error:",t),yield this.fallbackCache.exists(e)}})}clear(){return Fn(this,null,function*(){try{if(ot.isHealthy()){const e=ot.getClient(),t=yield e.keys(this.getKey("*"));t.length>0&&(yield e.del(t))}else yield this.fallbackCache.clear()}catch(e){O.error("Cache clear error:",e),yield this.fallbackCache.clear()}})}cleanup(){this.fallbackCache.cleanup()}getStats(){return{size:this.fallbackCache.getStats().size,isRedis:ot.isHealthy()}}}var Ln=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class w0{constructor(){this.DEFAULT_TTL=3600,this.hitCounts=new Map,this.cache=new b0("ai_responses")}generateCacheKey(e){const{service:t,operation:r,parameters:s,userId:i,facilityId:l}=e,c=this.hashObject(s);let o=`${t}:${r}:${c}`;return i&&(o+=`:user:${i}`),l&&(o+=`:facility:${l}`),o}get(e){return Ln(this,null,function*(){try{const t=this.generateCacheKey(e),r=yield this.cache.get(t);if(r){const s=this.hitCounts.get(t)||0;return this.hitCounts.set(t,s+1),O.debug(`AI cache hit for ${e.service}:${e.operation}`),r.data}return null}catch(t){return O.error("Error getting from AI cache:",t),null}})}set(e,t){return Ln(this,arguments,function*(r,s,i={}){try{const l=this.generateCacheKey(r),c=i.ttl||this.DEFAULT_TTL,o={data:s,timestamp:Date.now(),hitCount:0,metadata:{service:r.service,operation:r.operation,userId:r.userId,facilityId:r.facilityId}};yield this.cache.set(l,o,{ttl:c}),O.debug(`AI response cached for ${r.service}:${r.operation}`)}catch(l){O.error("Error setting AI cache:",l)}})}executeWithCache(e,t){return Ln(this,arguments,function*(r,s,i={}){const l=yield this.get(r);if(l!==null)return l;const c=yield s();return yield this.set(r,c,i),c})}invalidate(e){return Ln(this,null,function*(){try{O.info("Invalidating AI cache for pattern:",e),yield this.cache.clear()}catch(t){O.error("Error invalidating AI cache:",t)}})}getStats(){return{totalEntries:this.hitCounts.size,hitCounts:Object.fromEntries(this.hitCounts),cacheStats:this.cache.getStats()}}clear(){return Ln(this,null,function*(){try{yield this.cache.clear(),this.hitCounts.clear(),O.info("AI response cache cleared")}catch(e){O.error("Error clearing AI cache:",e)}})}hashObject(e){const t=JSON.stringify(e,Object.keys(e).sort());return this.simpleHash(t)}simpleHash(e){let t=0;for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);t=(t<<5)-t+s,t=t&t}return Math.abs(t).toString(36)}}const Bs=new w0;var S0=Object.defineProperty,gc=Object.getOwnPropertySymbols,C0=Object.prototype.hasOwnProperty,I0=Object.prototype.propertyIsEnumerable,yc=(n,e,t)=>e in n?S0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ri=(n,e)=>{for(var t in e||(e={}))C0.call(e,t)&&yc(n,t,e[t]);if(gc)for(var t of gc(e))I0.call(e,t)&&yc(n,t,e[t]);return n},Qr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class j0{constructor(e={}){this.pendingRequests=[],this.activeBatches=0,this.batchTimer=null,this.config=ri({maxBatchSize:10,maxWaitTime:2e3,maxConcurrentBatches:3,priorityThreshold:5},e)}addRequest(e){return Qr(this,arguments,function*(t,r={}){const s={id:`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,operation:t,priority:r.priority||0,metadata:r.metadata};return this.pendingRequests.push(s),this.pendingRequests.sort((i,l)=>l.priority-i.priority),O.debug(`Added request to batch queue: ${s.id} (priority: ${s.priority})`),this.batchTimer||this.startBatchTimer(),this.waitForCompletion(s.id)})}startBatchTimer(){this.batchTimer=setTimeout(()=>{this.processBatches(),this.batchTimer=null},this.config.maxWaitTime)}processBatches(){return Qr(this,null,function*(){if(this.activeBatches>=this.config.maxConcurrentBatches){this.startBatchTimer();return}const e=this.pendingRequests.filter(r=>r.priority<this.config.priorityThreshold);if(e.length===0)return;const t=this.createBatches(e);for(const r of t){if(this.activeBatches>=this.config.maxConcurrentBatches)break;this.processBatch(r)}this.pendingRequests.length>0&&this.startBatchTimer()})}createBatches(e){const t=[];for(let r=0;r<e.length;r+=this.config.maxBatchSize){const s=e.slice(r,r+this.config.maxBatchSize);t.push(s)}return t}processBatch(e){return Qr(this,null,function*(){this.activeBatches++;try{O.debug(`Processing batch of ${e.length} requests`),e.forEach(i=>{const l=this.pendingRequests.findIndex(c=>c.id===i.id);l!==-1&&this.pendingRequests.splice(l,1)});const t=Date.now(),r=e.map(i=>Qr(this,null,function*(){const l=Date.now();try{const c=yield i.operation(),o=Date.now()-l;this.storeResult(i.id,{id:i.id,success:!0,data:c,duration:o})}catch(c){const o=Date.now()-l;this.storeResult(i.id,{id:i.id,success:!1,error:c instanceof Error?c.message:"Unknown error",duration:o})}}));yield Promise.all(r);const s=Date.now()-t;O.debug(`Batch completed in ${s}ms`)}catch(t){O.error("Batch processing failed:",t),e.forEach(r=>{this.storeResult(r.id,{id:r.id,success:!1,error:"Batch processing failed",duration:0})})}finally{this.activeBatches--}})}waitForCompletion(e){return Qr(this,null,function*(){return new Promise((t,r)=>{const s=()=>{const i=this.getResult(e);i?i.success?t(i.data):r(new Error(i.error)):setTimeout(s,50)};s()})})}storeResult(e,t){this.results=this.results||new Map,this.results.set(e,t)}getResult(e){return this.results=this.results||new Map,this.results.get(e)}getStats(){return{pendingRequests:this.pendingRequests.length,activeBatches:this.activeBatches,config:this.config}}updateConfig(e){this.config=ri(ri({},this.config),e),O.info("AI request batcher configuration updated:",this.config)}clearPending(){this.pendingRequests=[],this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),O.info("AI request batcher cleared")}forceProcess(){return Qr(this,null,function*(){this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),yield this.processBatches()})}}const zn=new j0;var E0=Object.defineProperty,T0=Object.defineProperties,N0=Object.getOwnPropertyDescriptors,vc=Object.getOwnPropertySymbols,k0=Object.prototype.hasOwnProperty,P0=Object.prototype.propertyIsEnumerable,_c=(n,e,t)=>e in n?E0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ni=(n,e)=>{for(var t in e||(e={}))k0.call(e,t)&&_c(n,t,e[t]);if(vc)for(var t of vc(e))P0.call(e,t)&&_c(n,t,e[t]);return n},D0=(n,e)=>T0(n,N0(e));class hn{constructor(){this.serviceMetrics={},this.alerts=[],this.requestTimes=[],this.MAX_REQUEST_TIMES=1e3,this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,cacheHitRate:0,rateLimitHits:0,queueLength:0,activeRequests:0,lastUpdated:new Date}}static getInstance(){return hn.instance||(hn.instance=new hn),hn.instance}recordRequest(e,t,r,s=!1,i=!1){const l=new Date;this.metrics.totalRequests++,t?this.metrics.successfulRequests++:this.metrics.failedRequests++,s?this.metrics.cacheHitRate=(this.metrics.cacheHitRate*(this.metrics.totalRequests-1)+1)/this.metrics.totalRequests:this.metrics.cacheHitRate=this.metrics.cacheHitRate*(this.metrics.totalRequests-1)/this.metrics.totalRequests,i&&this.metrics.rateLimitHits++,this.requestTimes.push(r),this.requestTimes.length>this.MAX_REQUEST_TIMES&&this.requestTimes.shift(),this.metrics.averageResponseTime=this.calculateAverageResponseTime(),this.serviceMetrics[e]||(this.serviceMetrics[e]={requests:0,successes:0,failures:0,avgResponseTime:0,lastRequest:l});const c=this.serviceMetrics[e];c.requests++,c.lastRequest=l,t?c.successes++:c.failures++,c.avgResponseTime=(c.avgResponseTime*(c.requests-1)+r)/c.requests,this.metrics.lastUpdated=l,this.checkAlerts(e,t,r)}updateQueueMetrics(e,t){this.metrics.queueLength=e,this.metrics.activeRequests=t,this.metrics.lastUpdated=new Date}getMetrics(){return ni({},this.metrics)}getServiceMetrics(){return ni({},this.serviceMetrics)}getAlerts(){return[...this.alerts]}clearOldAlerts(e=1440*60*1e3){const t=new Date(Date.now()-e);this.alerts=this.alerts.filter(r=>r.timestamp>t)}getHealthStatus(){const e=[],t=[],r=this.metrics.totalRequests>0?this.metrics.failedRequests/this.metrics.totalRequests:0;r>.1&&(e.push(`High error rate: ${(r*100).toFixed(1)}%`),t.push("Investigate failed requests and improve error handling")),this.metrics.averageResponseTime>5e3&&(e.push(`Slow response time: ${this.metrics.averageResponseTime.toFixed(0)}ms`),t.push("Optimize AI operations and consider caching")),this.metrics.queueLength>50&&(e.push(`High queue length: ${this.metrics.queueLength}`),t.push("Increase processing capacity or optimize request handling")),this.metrics.cacheHitRate<.3&&(e.push(`Low cache hit rate: ${(this.metrics.cacheHitRate*100).toFixed(1)}%`),t.push("Improve caching strategy and cache more responses"));let s="healthy";return e.length>0&&(s=e.length>2?"critical":"warning"),{status:s,issues:e,recommendations:t}}calculateAverageResponseTime(){return this.requestTimes.length===0?0:this.requestTimes.reduce((e,t)=>e+t,0)/this.requestTimes.length}checkAlerts(e,t,r){if(!t){const s=this.serviceMetrics[e];if(s&&s.requests>10){const i=s.failures/s.requests;i>.2&&this.addAlert({type:"high_error_rate",severity:"critical",message:`High error rate for ${e}: ${(i*100).toFixed(1)}%`,metadata:{service:e,errorRate:i}})}}r>1e4&&this.addAlert({type:"slow_response",severity:"warning",message:`Slow response time for ${e}: ${r}ms`,metadata:{service:e,responseTime:r}}),this.metrics.queueLength>100&&this.addAlert({type:"high_queue_length",severity:"critical",message:`High queue length: ${this.metrics.queueLength}`,metadata:{queueLength:this.metrics.queueLength}}),this.metrics.rateLimitHits>10&&this.addAlert({type:"rate_limit_exceeded",severity:"warning",message:`Rate limit exceeded ${this.metrics.rateLimitHits} times`,metadata:{rateLimitHits:this.metrics.rateLimitHits}})}addAlert(e){const t=D0(ni({},e),{id:`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date});this.alerts.push(t),O.warn(`AI Performance Alert: ${t.message}`,t)}resetMetrics(){this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,cacheHitRate:0,rateLimitHits:0,queueLength:0,activeRequests:0,lastUpdated:new Date},this.serviceMetrics={},this.alerts=[],this.requestTimes=[],O.info("AI monitoring metrics reset")}}const Bn=hn.getInstance();var A0=Object.defineProperty,O0=Object.defineProperties,R0=Object.getOwnPropertyDescriptors,xc=Object.getOwnPropertySymbols,$0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,bc=(n,e,t)=>e in n?A0(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,F0=(n,e)=>{for(var t in e||(e={}))$0.call(e,t)&&bc(n,t,e[t]);if(xc)for(var t of xc(e))M0.call(e,t)&&bc(n,t,e[t]);return n},L0=(n,e)=>O0(n,R0(e)),qs=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Dr{constructor(){}static getInstance(){return Dr.instance||(Dr.instance=new Dr),Dr.instance}execute(e,t,r){return qs(this,null,function*(){const s=Date.now();let i=!1,l=!1,c,o;try{if(e.useCache!==!1){const u={service:e.service,operation:e.operation,parameters:(r==null?void 0:r.parameters)||{},userId:r==null?void 0:r.userId,facilityId:r==null?void 0:r.facilityId},m=yield Bs.get(u);m!==null&&(i=!0,c=m,l=!0,O.debug(`AI operation served from cache: ${e.service}:${e.operation}`))}if(!i&&(e.useBatching!==!1&&(e.priority||0)<5?c=yield zn.addRequest(t,{priority:e.priority,metadata:e.metadata}):c=yield zs.addRequest(e.service,(r==null?void 0:r.userId)||"anonymous",t,{priority:e.priority,maxRetries:e.maxRetries,timeout:e.timeout,metadata:e.metadata}),l=!0,e.useCache!==!1&&c)){const u={service:e.service,operation:e.operation,parameters:(r==null?void 0:r.parameters)||{},userId:r==null?void 0:r.userId,facilityId:r==null?void 0:r.facilityId};yield Bs.set(u,c,{ttl:e.cacheTtl})}const d=Date.now()-s;return Bn.recordRequest(e.service,l,d,i,!1),{success:l,data:c,error:o,fromCache:i,responseTime:d,metadata:e.metadata}}catch(d){const u=Date.now()-s;return o=d instanceof Error?d.message:"Unknown error",l=!1,Bn.recordRequest(e.service,l,u,i,!1),O.error(`AI operation failed: ${e.service}:${e.operation}`,d),{success:l,data:c,error:o,fromCache:i,responseTime:u,metadata:e.metadata}}})}executeBatch(e){return qs(this,null,function*(){const t=e.map(({config:r,operation:s,context:i})=>this.execute(r,s,i));return Promise.all(t)})}getStats(){return{monitoring:Bn.getMetrics(),queue:zs.getStats(),cache:Bs.getStats(),batcher:zn.getStats(),rateLimiter:oo.getConfigs()}}getHealthStatus(){const e=Bn.getHealthStatus(),t=this.getStats();return L0(F0({},e),{metrics:t})}reset(){return qs(this,null,function*(){yield Bs.clear(),zs.clearQueue(),zn.clearPending(),Bn.resetMetrics(),O.info("AI service reset completed")})}updateConfig(e){e.queue&&zs.updateConfig(e.queue),e.batcher&&zn.updateConfig(e.batcher),O.info("AI service configuration updated")}forceProcess(){return qs(this,null,function*(){yield zn.forceProcess(),O.info("AI service force processing completed")})}}Dr.getInstance();var z0=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const B0="undefined/functions/v1/openai";function Hh(n){return z0(this,arguments,function*({prompt:e,context:t=""}){throw console.warn("askCliniioAI() is deprecated. Use UnifiedAIService.askAI() instead."),B0?new Error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY"):new Error("Missing NEXT_PUBLIC_SUPABASE_URL")})}var si=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class q0{constructor(e){this.facilityId=e}getLearningInsights(){return si(this,null,function*(){try{const e=[],{data:t}=yield _.from("learning_ai_personalized_recommendations").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);t&&t.forEach(l=>{e.push({type:"personalized_recommendation",title:"Personalized Learning Recommendations",description:`${l.recommended_content.length} content items recommended for user ${l.user_id}`,confidence:l.confidence_score||0,recommendations:l.recommendation_reasoning||[],data:l,created_at:l.created_at,facility_id:this.facilityId,priority:this.getPriorityFromConfidence(l.confidence_score),actionable:!0,id:l.id||`recommendation-${Date.now()}`})});const{data:r}=yield _.from("learning_ai_skill_gap_analysis").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);r&&r.forEach(l=>{const c=Object.keys(l.skill_gaps);e.push({type:"skill_gap_analysis",title:"Skill Gap Analysis",description:`${c.length} skill gaps identified for user ${l.user_id}`,confidence:l.confidence_score||0,recommendations:l.learning_recommendations||[],data:l,created_at:l.created_at,facility_id:this.facilityId,priority:this.getPriorityFromGapCount(c.length),actionable:!0,id:l.id||`skillgap-${Date.now()}`})});const{data:s}=yield _.from("learning_ai_path_optimization").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);s&&s.forEach(l=>{e.push({type:"learning_path_optimization",title:"Learning Path Optimized",description:`Path efficiency score: ${(l.path_efficiency_score*100).toFixed(1)}% for user ${l.user_id}`,confidence:l.confidence_score||0,recommendations:l.optimization_factors||[],data:l,created_at:l.created_at,facility_id:this.facilityId,priority:this.getPriorityFromEfficiency(l.path_efficiency_score),actionable:!0,id:l.id||`pathopt-${Date.now()}`})});const{data:i}=yield _.from("learning_ai_performance_prediction").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);return i&&i.forEach(l=>{e.push({type:"performance_prediction",title:"Performance Prediction",description:`Predicted performance: ${(l.predicted_performance*100).toFixed(1)}% for content ${l.user_id}`,confidence:l.confidence_score||0,recommendations:l.performance_factors||[],data:l,created_at:l.created_at,facility_id:this.facilityId,priority:this.getPriorityFromPerformance(l.predicted_performance),actionable:!0,id:l.id||`perfpred-${Date.now()}`})}),e}catch(e){return console.error("Error getting learning insights:",e),[]}})}getHistoricalLearningData(){return si(this,null,function*(){try{const{data:e}=yield _.from("user_learning_progress").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(30);return e?e.map(t=>({date:t.created_at,user_id:t.user_id,content_id:t.content_id,progress_percentage:t.completion_rate,time_spent:t.session_duration,score:t.satisfaction_score,engagement_score:this.calculateEngagementScore(t)})):Array.from({length:30},(t,r)=>({date:new Date(Date.now()-r*24*60*60*1e3).toISOString(),user_id:`user-${Math.floor(Math.random()*10)+1}`,content_id:`content-${Math.floor(Math.random()*20)+1}`,progress_percentage:Math.random()*100,time_spent:Math.floor(Math.random()*120)+15,score:Math.random()>.3?Math.random()*40+60:void 0,engagement_score:Math.random()*.4+.6}))}catch(e){return console.error("Error getting historical learning data:",e),[]}})}getLearningCostData(){return si(this,null,function*(){try{const{data:e}=yield _.from("learning_costs").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(1).single();if(e){const t=e;return{content_creation_costs:t.content_creation_costs,platform_costs:t.platform_costs,assessment_costs:t.assessment_costs,certification_costs:t.certification_costs,total_cost:t.total_cost}}return{content_creation_costs:15e3,platform_costs:5e3,assessment_costs:3e3,certification_costs:2e3,total_cost:25e3}}catch(e){return console.error("Error getting learning cost data:",e),{content_creation_costs:15e3,platform_costs:5e3,assessment_costs:3e3,certification_costs:2e3,total_cost:25e3}}})}calculateLearningEfficiency(e,t,r){const s=e*r/(t/60);return Math.min(s,1)}calculateEngagementScore(e){const t=e.time_spent_minutes||0,r=e.progress_percentage||0,s=e.attempts||1,i=Math.min(t/60,1),l=r/100,c=Math.max(0,1-(s-1)*.1);return i*.4+l*.4+c*.2}calculateRetentionRate(e,t){if(e.length!==t.length)return 0;const r=e.map((s,i)=>t[i]/s);return r.reduce((s,i)=>s+i,0)/r.length}calculateSkillProgression(e){const t={};return Object.entries(e).forEach(([r,s])=>{if(s.length<2){t[r]="stable";return}const i=s.slice(0,Math.ceil(s.length/2)),l=s.slice(Math.ceil(s.length/2)),c=i.reduce((u,m)=>u+m,0)/i.length,o=l.reduce((u,m)=>u+m,0)/l.length,d=c-o;d>.1?t[r]="improving":d<-.1?t[r]="declining":t[r]="stable"}),t}calculateLearningVelocity(e,t){return e/(t/7)}calculateKnowledgeDecayRate(e,t,r){if(r===0)return 0;const s=t/e;return s<=0?1:-Math.log(s)/r}calculateAdaptiveDifficultyAdjustment(e,t,r){const i=(e-t)*.1;return Math.max(0,Math.min(1,r+i))}detectLearningPatterns(e){const t=e.map(g=>g.content_id.split("-")[0]),r=e.map(g=>new Date(g.date).getHours()),s=t.reduce((g,y)=>(g[y]=(g[y]||0)+1,g),{}),i=Object.entries(s).sort(([,g],[,y])=>y-g).slice(0,3).map(([g])=>g),l=r.reduce((g,y)=>(g[y]=(g[y]||0)+1,g),{}),c=Object.entries(l).sort(([,g],[,y])=>y-g).slice(0,2).map(([g])=>`${g}:00`),o=Array.from(new Set(e.map(g=>g.date.split("T")[0]))).sort();let d=0,u=1;for(let g=1;g<o.length;g++){const y=new Date(o[g-1]);(new Date(o[g]).getTime()-y.getTime())/(1e3*60*60*24)===1?u++:(d=Math.max(d,u),u=1)}d=Math.max(d,u);const m=e.map(g=>g.progress_percentage),p=m.reduce((g,y)=>g+y,0)/m.length;let f="intermediate";return p>90?f="advanced":p<60&&(f="beginner"),{preferredContentTypes:i,optimalStudyTimes:c,learningStreaks:d,difficultyPreferences:f}}getPriorityFromConfidence(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}getPriorityFromGapCount(e){return e>=5?"critical":e>=3?"high":e>=1?"medium":"low"}getPriorityFromEfficiency(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}getPriorityFromPerformance(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}}var Us={},gt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class $a{constructor(e){this.facilityId=e}processPersonalizedRecommendationsWithAI(){return gt(this,null,function*(){return{recommended_content:["infection_control_basics","sterilization_protocols_advanced","environmental_cleaning_standards"],recommendation_reasoning:["Based on your role as environmental services technician","Addresses identified skill gaps in infection control","Builds on your completed sterilization fundamentals course"],confidence_scores:[.92,.85,.78],learning_path_suggestions:["Complete infection control basics first","Then proceed to advanced sterilization protocols","Finish with environmental cleaning standards"],skill_development_areas:["Infection control protocols","Advanced sterilization techniques","Environmental monitoring"],estimated_completion_time:120,difficulty_progression:["beginner","intermediate","advanced"],alternative_recommendations:["safety_protocols_fundamentals","equipment_maintenance_basics"],confidence_score:.87}})}processSkillGapAnalysisWithAI(){return gt(this,null,function*(){return{current_skills:{basic_cleaning:.8,safety_protocols:.6,infection_control:.4,equipment_operation:.7,documentation:.5},required_skills:{basic_cleaning:.9,safety_protocols:.9,infection_control:.8,equipment_operation:.8,documentation:.8,advanced_sterilization:.7,environmental_monitoring:.6},skill_gaps:{infection_control:.4,documentation:.3,advanced_sterilization:.7,environmental_monitoring:.6},gap_priorities:["infection_control","advanced_sterilization","environmental_monitoring","documentation"],learning_recommendations:["Complete infection control certification course","Take advanced sterilization protocols training","Enroll in environmental monitoring workshop","Practice documentation best practices"],skill_development_plan:["Week 1-2: Infection control fundamentals","Week 3-4: Advanced sterilization techniques","Week 5-6: Environmental monitoring protocols","Week 7-8: Documentation and reporting"],estimated_learning_time:160,confidence_score:.82}})}processLearningPathOptimizationWithAI(){return gt(this,null,function*(){return{optimized_learning_path:["safety_fundamentals","infection_control_basics","sterilization_protocols","environmental_cleaning_standards","advanced_sterilization_techniques","quality_assurance_protocols"],path_efficiency_score:.88,estimated_total_time:180,difficulty_progression:["beginner","beginner","intermediate","intermediate","advanced","advanced"],prerequisite_mapping:{infection_control_basics:["safety_fundamentals"],sterilization_protocols:["infection_control_basics"],environmental_cleaning_standards:["sterilization_protocols"],advanced_sterilization_techniques:["environmental_cleaning_standards"],quality_assurance_protocols:["advanced_sterilization_techniques"]},alternative_paths:[["safety_fundamentals","equipment_operation","sterilization_protocols"],["safety_fundamentals","documentation_basics","infection_control_basics"]],optimization_factors:["Prerequisite knowledge alignment","Learning curve optimization","Time efficiency","Skill progression logic"],confidence_score:.85}})}processPerformancePredictionWithAI(){return gt(this,null,function*(){return{predicted_performance:.82,predicted_completion_time:45,success_probability:.78,risk_factors:["Limited experience with advanced sterilization","Time constraints for study sessions","Complex technical concepts in later modules"],improvement_suggestions:["Allocate additional study time for complex topics","Seek hands-on practice opportunities","Connect with experienced colleagues for guidance","Break down complex topics into smaller sessions"],study_recommendations:["Study in 30-minute focused sessions","Review prerequisite materials before starting","Take practice quizzes regularly","Join study groups for peer learning"],confidence_score:.79}})}processAdaptiveDifficultyWithAI(){return gt(this,null,function*(){return{recommended_difficulty:"intermediate",difficulty_adjustment:.2,learning_curve_analysis:"User shows strong grasp of fundamentals but needs more practice with intermediate concepts",adaptation_reasoning:["High performance on basic safety protocols (95% accuracy)","Moderate performance on infection control (78% accuracy)","Struggling with advanced sterilization concepts (65% accuracy)","Consistent engagement and completion rates"],performance_indicators:{quiz_accuracy:.78,completion_rate:.92,engagement_time:.85,retention_score:.73},next_difficulty_target:"advanced",confidence_score:.81}})}processEngagementAnalysisWithAI(){return gt(this,null,function*(){return{engagement_score:.76,engagement_trends:{video_content:.85,interactive_quizzes:.78,text_reading:.65,simulations:.92},engagement_factors:["Interactive content increases engagement","Visual learning materials are preferred","Practical simulations maintain interest","Short, focused sessions work best"],disengagement_triggers:["Long text-heavy modules","Complex technical jargon without explanation","Lack of immediate feedback","Repetitive content format"],improvement_suggestions:["Increase use of interactive simulations","Break down text content into smaller chunks","Add more visual aids and diagrams","Provide immediate feedback on quizzes"],optimal_learning_times:["Morning sessions (9-11 AM)","Afternoon sessions (2-4 PM)"],content_preferences:["Video demonstrations","Interactive simulations","Case study examples","Hands-on practice exercises"],confidence_score:.83}})}processRetentionPredictionWithAI(){return gt(this,null,function*(){return{retention_probability:.72,knowledge_decay_rate:.15,review_recommendations:["Review infection control protocols weekly","Practice sterilization procedures monthly","Take refresher quizzes every 2 weeks","Attend hands-on workshops quarterly"],reinforcement_schedule:["Week 1: Initial review of key concepts","Week 2: Practice quiz on fundamentals","Month 1: Comprehensive review session","Month 3: Advanced application practice"],retention_factors:["Regular practice and application","Immediate feedback on performance","Spaced repetition of key concepts","Real-world application opportunities"],forgetting_risk_areas:["Complex sterilization parameters","Specific compliance requirements","Equipment operation procedures","Emergency response protocols"],confidence_score:.77}})}processLearningAnalyticsWithAI(){return gt(this,null,function*(){return{learning_efficiency_score:.81,preferred_content_categories:["interactive_simulations","video_demonstrations","case_studies","hands_on_practice"],optimal_study_duration:30,learning_patterns:{peak_performance_hours:"9-11 AM, 2-4 PM",preferred_session_length:"25-35 minutes",break_frequency:"every 45 minutes",review_preference:"immediate after completion"},progress_trends:{completion_rate:"increasing",quiz_accuracy:"stable",engagement_level:"improving",retention_rate:"declining"},performance_metrics:{overall_completion:.88,quiz_average:.82,engagement_score:.76,retention_rate:.68},insights:["User performs best with interactive content","Morning sessions show higher engagement","Retention drops after 2 weeks without review","Case studies improve practical application"],recommendations:["Schedule more interactive content","Implement spaced repetition for retention","Add more case study examples","Optimize study session timing"],confidence_score:.84}})}buildPersonalizedRecommendationPrompt(e,t,r){return`Generate personalized learning recommendations based on:
  User Profile: ${e}
  Learning History: ${t}
  Skill Gaps: ${r}
  
  Please provide:
  1. Recommended content based on role and interests
  2. Reasoning for each recommendation
  3. Confidence scores for recommendations
  4. Learning path suggestions
  5. Skill development areas to focus on
  6. Estimated completion time
  7. Difficulty progression
  8. Alternative recommendations`}buildSkillGapAnalysisPrompt(e,t,r){return`Analyze skill gaps based on:
  Current Skills: ${e}
  Required Skills: ${t}
  Role Requirements: ${r}
  
  Please provide:
  1. Current skill levels assessment
  2. Required skill levels for role
  3. Identified skill gaps with priority levels
  4. Learning recommendations to address gaps
  5. Skill development plan with timeline
  6. Estimated learning time required
  7. Confidence score for analysis`}buildLearningPathOptimizationPrompt(e,t,r){return`Optimize learning path based on:
  User Goals: ${e}
  Available Content: ${t}
  Constraints: ${r}
  
  Please provide:
  1. Optimized learning path sequence
  2. Path efficiency score
  3. Estimated total completion time
  4. Difficulty progression through path
  5. Prerequisite mapping
  6. Alternative path options
  7. Optimization factors considered
  8. Confidence score for optimization`}buildPerformancePredictionPrompt(e,t,r){return`Predict learning performance based on:
  User Profile: ${e}
  Content Information: ${t}
  Historical Performance: ${r}
  
  Please provide:
  1. Predicted performance score
  2. Predicted completion time
  3. Success probability
  4. Risk factors that may impact performance
  5. Improvement suggestions
  6. Study recommendations
  7. Confidence score for prediction`}executeWithRetry(e,t=3,r=100){return gt(this,null,function*(){const{OptimizedRetryService:s}=yield L(()=>Promise.resolve().then(()=>vp),void 0);return yield s.executeWithRetry(e,{maxRetries:t,baseDelay:r,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return gt(this,null,function*(){const r=new Promise((s,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,r])})}selectModelForTask(e){switch(e){case"recommendation":return"gpt-4";case"skill_gap":return"gpt-4";case"path_optimization":return"gpt-4";case"performance_prediction":return"gpt-4";case"adaptive_difficulty":return"gpt-4";case"engagement_analysis":return"gpt-4";case"retention_prediction":return"gpt-4";case"learning_analytics":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:Us.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:Us.GOOGLE_AI_API_BASE_URL||"https://generativelanguage.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro"},azure:{baseUrl:Us.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:Us.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}}const U0={ai_enabled:!1,ai_version:"1.0.0",personalized_recommendations:!1,skill_gap_analysis:!1,learning_path_optimization:!1,performance_prediction:!1,adaptive_difficulty:!1,learning_analytics_enabled:!1,behavior_tracking:!1,progress_prediction:!1,engagement_metrics:!1,retention_analysis:!1,ai_confidence_threshold:.8,recommendation_limit:5,data_retention_days:365,model_version:"v1.0",data_sharing_enabled:!1,local_ai_processing_enabled:!1,encrypted_data_transmission:!0,ai_model_training:!1},H0={NO_DATA_FOUND:"PGRST116"},on={DIFFICULTY_LEVEL:"beginner",USER_ROLE:"user",DEPARTMENT:"general",EXPERIENCE_LEVEL:"entry",LEARNING_STYLE:"visual",TIME_AVAILABILITY:30},V0={LEARNING_PROGRESS_DATA:100};function W0(n){var e,t,r,s,i,l,c,o,d,u,m;return{id:(e=n.id)!=null?e:"",user_id:(t=n.user_id)!=null?t:"",role:(r=n.role)!=null?r:on.USER_ROLE,department:(s=n.department)!=null?s:on.DEPARTMENT,experience_level:(i=n.experience_level)!=null?i:on.EXPERIENCE_LEVEL,skill_areas:(l=n.skill_areas)!=null?l:[],learning_goals:(c=n.learning_goals)!=null?c:[],preferred_learning_style:(o=n.preferred_learning_style)!=null?o:on.LEARNING_STYLE,time_availability:(d=n.time_availability)!=null?d:on.TIME_AVAILABILITY,last_updated:(m=(u=n.updated_at)!=null?u:n.created_at)!=null?m:""}}function nr(n){return Date.now()-n}function G0(n){return Array.isArray(n)?n.join("; "):n}function K0(n){return n.split("; ").filter(e=>e.trim().length>0)}function Rt(){return new Date().toISOString()}var Q0=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Y0{constructor(e){this.facilityId=e,this.providerService=new $a(e)}generatePersonalizedRecommendations(e){return Q0(this,null,function*(){var t,r,s,i,l,c,o,d,u,m,p,f,g;try{const y=Date.now(),v=yield this.providerService.processPersonalizedRecommendationsWithAI(),x=nr(y),b={facility_id:this.facilityId,user_id:e,recommended_content:v.recommended_content,recommendation_reasoning:v.recommendation_reasoning,confidence_scores:v.confidence_scores,learning_path_suggestions:v.learning_path_suggestions,skill_development_areas:v.skill_development_areas,estimated_completion_time:v.estimated_completion_time,difficulty_progression:v.difficulty_progression,alternative_recommendations:v.alternative_recommendations,confidence_score:v.confidence_score,processing_time_ms:x,created_at:Rt()},C={facility_id:b.facility_id,user_id:b.user_id,recommended_content:b.recommended_content,recommendation_reasoning:G0(b.recommendation_reasoning),confidence_scores:b.confidence_scores,learning_path_suggestions:b.learning_path_suggestions,skill_development_areas:b.skill_development_areas,estimated_completion_time:b.estimated_completion_time,difficulty_progression:b.difficulty_progression,alternative_recommendations:b.alternative_recommendations,confidence_score:b.confidence_score,processing_time_ms:b.processing_time_ms,created_at:b.created_at},{data:k,error:P}=yield _.from("learning_ai_personalized_recommendations").insert(C).select().single();if(P)return console.error("Error saving personalized recommendation result:",P),null;if(!k)return null;const E=k;return{id:(t=E.id)!=null?t:"",facility_id:(r=E.facility_id)!=null?r:"",user_id:(s=E.user_id)!=null?s:"",recommended_content:(i=E.recommended_content)!=null?i:[],recommendation_reasoning:K0(E.recommendation_reasoning),confidence_scores:(l=E.confidence_scores)!=null?l:[],learning_path_suggestions:(c=E.learning_path_suggestions)!=null?c:[],skill_development_areas:(o=E.skill_development_areas)!=null?o:[],estimated_completion_time:(d=E.estimated_completion_time)!=null?d:0,difficulty_progression:(u=E.difficulty_progression)!=null?u:[],alternative_recommendations:(m=E.alternative_recommendations)!=null?m:[],confidence_score:(p=E.confidence_score)!=null?p:0,processing_time_ms:(f=E.processing_time_ms)!=null?f:0,created_at:(g=E.created_at)!=null?g:""}}catch(y){return console.error("Error generating personalized recommendations:",y),null}})}}var J0=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class X0{constructor(e){this.facilityId=e,this.providerService=new $a(e)}analyzeSkillGaps(e){return J0(this,null,function*(){var t,r,s,i,l,c,o,d,u,m,p,f,g;try{const y=Date.now(),v=yield this.providerService.processSkillGapAnalysisWithAI(),x=nr(y),b={facility_id:this.facilityId,user_id:e,current_skills:v.current_skills,required_skills:v.required_skills,skill_gaps:v.skill_gaps,gap_priorities:v.gap_priorities,learning_recommendations:v.learning_recommendations,skill_development_plan:v.skill_development_plan,estimated_learning_time:v.estimated_learning_time,confidence_score:v.confidence_score,processing_time_ms:x,created_at:Rt()},C={facility_id:b.facility_id,user_id:b.user_id,current_skills:b.current_skills,required_skills:b.required_skills,skill_gaps:b.skill_gaps,gap_priorities:b.gap_priorities,learning_recommendations:b.learning_recommendations,skill_development_plan:b.skill_development_plan,estimated_learning_time:b.estimated_learning_time,confidence_score:b.confidence_score,processing_time_ms:b.processing_time_ms,created_at:b.created_at},{data:k,error:P}=yield _.from("learning_ai_skill_gap_analysis").insert(C).select().single();if(P)return console.error("Error saving skill gap analysis result:",P),null;if(!k)return null;const E=k;return{id:(t=E.id)!=null?t:"",facility_id:(r=E.facility_id)!=null?r:"",user_id:(s=E.user_id)!=null?s:"",current_skills:(i=E.current_skills)!=null?i:{},required_skills:(l=E.required_skills)!=null?l:{},skill_gaps:(c=E.skill_gaps)!=null?c:{},gap_priorities:(o=E.gap_priorities)!=null?o:[],learning_recommendations:(d=E.learning_recommendations)!=null?d:[],skill_development_plan:(u=E.skill_development_plan)!=null?u:[],estimated_learning_time:(m=E.estimated_learning_time)!=null?m:0,confidence_score:(p=E.confidence_score)!=null?p:0,processing_time_ms:(f=E.processing_time_ms)!=null?f:0,created_at:(g=E.created_at)!=null?g:""}}catch(y){return console.error(y),console.error("Error analyzing skill gaps"),null}})}}var Z0=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ex{constructor(e){this.facilityId=e,this.providerService=new $a(e)}optimizeLearningPath(e){return Z0(this,null,function*(){var t,r,s,i,l,c,o,d,u,m,p,f,g;try{const y=Date.now(),v=yield this.providerService.processLearningPathOptimizationWithAI(),x=nr(y),b={facility_id:this.facilityId,user_id:e,optimized_learning_path:v.optimized_learning_path,path_efficiency_score:v.path_efficiency_score,estimated_total_time:v.estimated_total_time,difficulty_progression:v.difficulty_progression,prerequisite_mapping:v.prerequisite_mapping,alternative_paths:v.alternative_paths,optimization_factors:v.optimization_factors,confidence_score:v.confidence_score,processing_time_ms:x,created_at:Rt()},C={facility_id:b.facility_id,user_id:b.user_id,optimized_learning_path:b.optimized_learning_path,path_efficiency_score:b.path_efficiency_score,estimated_total_time:b.estimated_total_time,difficulty_progression:b.difficulty_progression,prerequisite_mapping:b.prerequisite_mapping,alternative_paths:b.alternative_paths,optimization_factors:b.optimization_factors,confidence_score:b.confidence_score,processing_time_ms:b.processing_time_ms,created_at:b.created_at},{data:k,error:P}=yield _.from("learning_ai_path_optimization").insert(C).select().single();if(P)return console.error("Error saving learning path optimization result:",P),null;if(!k)return null;const E=k;return{id:(t=E.id)!=null?t:"",facility_id:(r=E.facility_id)!=null?r:"",user_id:(s=E.user_id)!=null?s:"",optimized_learning_path:(i=E.optimized_learning_path)!=null?i:[],path_efficiency_score:(l=E.path_efficiency_score)!=null?l:0,estimated_total_time:(c=E.estimated_total_time)!=null?c:0,difficulty_progression:(o=E.difficulty_progression)!=null?o:[],prerequisite_mapping:(d=E.prerequisite_mapping)!=null?d:{},alternative_paths:(u=E.alternative_paths)!=null?u:[],optimization_factors:(m=E.optimization_factors)!=null?m:[],confidence_score:(p=E.confidence_score)!=null?p:0,processing_time_ms:(f=E.processing_time_ms)!=null?f:0,created_at:(g=E.created_at)!=null?g:""}}catch(y){return console.error("Error optimizing learning path:",y),null}})}}var qn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class tx{constructor(e){this.facilityId=e,this.providerService=new $a(e)}predictPerformance(e,t){return qn(this,null,function*(){var r,s,i,l,c,o,d,u,m,p;try{const f=Date.now(),g=yield this.providerService.processPerformancePredictionWithAI(),y=nr(f),v={facility_id:this.facilityId,user_id:e,content_id:t,predicted_performance:g.predicted_performance,predicted_completion_time:g.predicted_completion_time,success_probability:g.success_probability,risk_factors:g.risk_factors,improvement_suggestions:g.improvement_suggestions,study_recommendations:g.study_recommendations,confidence_score:g.confidence_score,processing_time_ms:y,created_at:Rt()},x={facility_id:v.facility_id,user_id:v.user_id,content_id:v.content_id,predicted_performance:v.predicted_performance,confidence_score:v.confidence_score,improvement_suggestions:v.improvement_suggestions,predicted_completion_time:v.predicted_completion_time,processing_time_ms:v.processing_time_ms,created_at:v.created_at},{data:b,error:C}=yield _.from("learning_ai_performance_prediction").insert(x).select().single();if(C)return console.error("Error saving performance prediction result:",C),null;if(!b)return null;const k=b;return{id:(r=k.id)!=null?r:"",facility_id:(s=k.facility_id)!=null?s:"",user_id:(i=k.user_id)!=null?i:"",content_id:(l=k.content_id)!=null?l:"",predicted_performance:(c=k.predicted_performance)!=null?c:0,predicted_completion_time:(o=k.predicted_completion_time)!=null?o:0,success_probability:0,risk_factors:[],improvement_suggestions:(d=k.improvement_suggestions)!=null?d:[],study_recommendations:[],confidence_score:(u=k.confidence_score)!=null?u:0,processing_time_ms:(m=k.processing_time_ms)!=null?m:0,created_at:(p=k.created_at)!=null?p:""}}catch(f){return console.error("Error predicting performance:",f),null}})}adjustDifficulty(e,t){return qn(this,null,function*(){var r,s,i,l,c,o,d;try{const u=Date.now(),m=yield this.providerService.processAdaptiveDifficultyWithAI(),p=nr(u),f={facility_id:this.facilityId,user_id:e,content_id:t,recommended_difficulty:m.recommended_difficulty,difficulty_adjustment:m.difficulty_adjustment,learning_curve_analysis:m.learning_curve_analysis,adaptation_reasoning:m.adaptation_reasoning,performance_indicators:m.performance_indicators,next_difficulty_target:m.next_difficulty_target,confidence_score:m.confidence_score,processing_time_ms:p,created_at:Rt()},g={facility_id:f.facility_id,user_id:f.user_id,content_id:f.content_id,recommended_difficulty:f.recommended_difficulty,difficulty_adjustment:f.difficulty_adjustment,learning_curve_analysis:f.learning_curve_analysis,adaptation_reasoning:f.adaptation_reasoning,performance_indicators:f.performance_indicators,next_difficulty_target:f.next_difficulty_target,confidence_score:f.confidence_score,processing_time_ms:f.processing_time_ms,created_at:f.created_at},{data:y,error:v}=yield _.from("learning_ai_adaptive_difficulty").insert(g).select().single();if(v)return console.error("Error saving adaptive difficulty result:",v),null;if(!y)return null;const x=y;return{recommended_difficulty:(r=x.recommended_difficulty)!=null?r:on.DIFFICULTY_LEVEL,difficulty_adjustment:(s=x.difficulty_adjustment)!=null?s:0,learning_curve_analysis:(i=x.learning_curve_analysis)!=null?i:"",adaptation_reasoning:(l=x.adaptation_reasoning)!=null?l:[],performance_indicators:(c=x.performance_indicators)!=null?c:{},next_difficulty_target:(o=x.next_difficulty_target)!=null?o:"",confidence_score:(d=x.confidence_score)!=null?d:0}}catch(u){return console.error("Error adjusting difficulty:",u),null}})}analyzeEngagement(e){return qn(this,null,function*(){var t,r,s,i,l,c,o,d;try{const u=Date.now(),m=yield this.providerService.processEngagementAnalysisWithAI(),p=nr(u),f={facility_id:this.facilityId,user_id:e,engagement_score:m.engagement_score,engagement_trends:m.engagement_trends,engagement_factors:m.engagement_factors,disengagement_triggers:m.disengagement_triggers,improvement_suggestions:m.improvement_suggestions,optimal_learning_times:m.optimal_learning_times,content_preferences:m.content_preferences,confidence_score:m.confidence_score,processing_time_ms:p,created_at:Rt()},g={facility_id:f.facility_id,user_id:f.user_id,engagement_score:f.engagement_score,engagement_trends:f.engagement_trends,engagement_factors:f.engagement_factors,disengagement_triggers:f.disengagement_triggers,improvement_suggestions:f.improvement_suggestions,optimal_learning_times:f.optimal_learning_times,content_preferences:f.content_preferences,confidence_score:f.confidence_score,processing_time_ms:f.processing_time_ms,created_at:f.created_at},{data:y,error:v}=yield _.from("learning_ai_engagement_analysis").insert(g).select().single();if(v)return console.error("Error saving engagement analysis result:",v),null;if(!y)return null;const x=y;return{engagement_score:(t=x.engagement_score)!=null?t:0,engagement_trends:(r=x.engagement_trends)!=null?r:{},engagement_factors:(s=x.engagement_factors)!=null?s:[],disengagement_triggers:(i=x.disengagement_triggers)!=null?i:[],improvement_suggestions:(l=x.improvement_suggestions)!=null?l:[],optimal_learning_times:(c=x.optimal_learning_times)!=null?c:[],content_preferences:(o=x.content_preferences)!=null?o:[],confidence_score:(d=x.confidence_score)!=null?d:0}}catch(u){return console.error("Error analyzing engagement:",u),null}})}predictRetention(e){return qn(this,null,function*(){var t,r,s,i,l,c,o;try{const d=Date.now(),u=yield this.providerService.processRetentionPredictionWithAI(),m=nr(d),p={facility_id:this.facilityId,user_id:e,retention_probability:u.retention_probability,knowledge_decay_rate:u.knowledge_decay_rate,review_recommendations:u.review_recommendations,reinforcement_schedule:u.reinforcement_schedule,retention_factors:u.retention_factors,forgetting_risk_areas:u.forgetting_risk_areas,confidence_score:u.confidence_score,processing_time_ms:m,created_at:Rt()},f={facility_id:p.facility_id,user_id:p.user_id,retention_probability:p.retention_probability,knowledge_decay_rate:p.knowledge_decay_rate,review_recommendations:p.review_recommendations,reinforcement_schedule:p.reinforcement_schedule,retention_factors:p.retention_factors,forgetting_risk_areas:p.forgetting_risk_areas,confidence_score:p.confidence_score,processing_time_ms:p.processing_time_ms,created_at:p.created_at},{data:g,error:y}=yield _.from("learning_ai_retention_prediction").insert(f).select().single();if(y)return console.error("Error saving retention prediction result:",y),null;if(!g)return null;const v=g;return{retention_probability:(t=v.retention_probability)!=null?t:0,knowledge_decay_rate:(r=v.knowledge_decay_rate)!=null?r:0,review_recommendations:(s=v.review_recommendations)!=null?s:[],reinforcement_schedule:(i=v.reinforcement_schedule)!=null?i:[],retention_factors:(l=v.retention_factors)!=null?l:[],forgetting_risk_areas:(c=v.forgetting_risk_areas)!=null?c:[],confidence_score:(o=v.confidence_score)!=null?o:0}}catch(d){return console.error("Error predicting retention:",d),null}})}generateLearningAnalytics(e){return qn(this,null,function*(){var t,r,s,i,l,c,o,d,u;try{const m=Date.now(),p=yield this.providerService.processLearningAnalyticsWithAI(),f=nr(m),g={facility_id:this.facilityId,user_id:e,learning_efficiency_score:p.learning_efficiency_score,preferred_content_categories:p.preferred_content_categories,optimal_study_duration:p.optimal_study_duration,learning_patterns:p.learning_patterns,progress_trends:p.progress_trends,performance_metrics:p.performance_metrics,insights:p.insights,recommendations:p.recommendations,confidence_score:p.confidence_score,processing_time_ms:f,created_at:Rt()},y={facility_id:g.facility_id,user_id:g.user_id,learning_efficiency_score:g.learning_efficiency_score,preferred_content_categories:g.preferred_content_categories,optimal_study_duration:g.optimal_study_duration,learning_patterns:g.learning_patterns,progress_trends:g.progress_trends,performance_metrics:g.performance_metrics,insights:g.insights,recommendations:g.recommendations,confidence_score:g.confidence_score,processing_time_ms:g.processing_time_ms,created_at:g.created_at},{data:v,error:x}=yield _.from("learning_ai_analytics").insert(y).select().single();if(x)return console.error("Error saving learning analytics result:",x),null;if(!v)return null;const b=v;return{learning_efficiency_score:(t=b.learning_efficiency_score)!=null?t:0,preferred_content_categories:(r=b.preferred_content_categories)!=null?r:[],optimal_study_duration:(s=b.optimal_study_duration)!=null?s:0,learning_patterns:(i=b.learning_patterns)!=null?i:{},progress_trends:(l=b.progress_trends)!=null?l:{},performance_metrics:(c=b.performance_metrics)!=null?c:{},insights:(o=b.insights)!=null?o:[],recommendations:(d=b.recommendations)!=null?d:[],confidence_score:(u=b.confidence_score)!=null?u:0}}catch(m){return console.error("Error generating learning analytics:",m),null}})}}var rx=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function Vh(n){return rx(this,arguments,function*({facilityId:e,userId:t,module:r,action:s,details:i}){try{const{error:l}=yield _.from("security_audit_log").insert([{facility_id:e,user_id:t,object_schema:"public",object_table:"ai_settings",action:s,event_context:{module:r,details:i,source:"frontend"},happened_at:new Date().toISOString()}]);l?console.error("❌ Audit log insert failed:",l):console.log("✅ Audit event logged:",r,s)}catch(l){console.error("❌ Unexpected audit log failure:",l)}})}var Ma=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function nx(n){return Ma(this,null,function*(){try{const{data:e,error:t}=yield _.from("ai_settings").select("*").eq("facility_id",n).eq("module","learning").single();return t?(t.code===H0.NO_DATA_FOUND||console.warn("Error loading learning AI settings:",t),null):e?e.settings:null}catch(e){return console.warn("Error loading learning AI settings:",e),null}})}function sx(n,e){return Ma(this,null,function*(){try{const t={facility_id:n,module:"learning",settings:e,updated_at:Rt()},{error:r}=yield _.from("ai_settings").upsert(t,{onConflict:"facility_id,module"});return r?(console.error("Error saving learning AI settings:",r),!1):(!r&&t&&(yield Vh({facilityId:n,userId:"system",module:"learning",action:"UPDATE",details:t})),!0)}catch(t){return console.error(t),console.error("Error saving learning AI settings"),!1}})}function ax(n,e){return Ma(this,null,function*(){try{const{data:t,error:r}=yield _.from("learning_progress").select("*").eq("facility_id",n).eq("user_id",e).order("created_at",{ascending:!1}).limit(V0.LEARNING_PROGRESS_DATA);return r?(console.error("Error getting learning progress data:",r),[]):t||[]}catch(t){return console.error("Error getting learning progress data:",t),[]}})}function ix(n,e){return Ma(this,null,function*(){try{const{data:t,error:r}=yield _.from("user_profiles").select("*").eq("user_id",e).eq("facility_id",n).single();return r?(console.error("Error getting user profile:",r),null):t?W0(t):null}catch(t){return console.error("Error getting user profile:",t),null}})}function Kt(n,e){return ox(n,e)===!0}function ox(n,e){return e.split(".").reduce((t,r)=>t==null?void 0:t[r],n)}var Ae=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class lx{constructor(e){this.facilityId=e,this.analyticsService=new q0(e),this.recommendationService=new Y0(e),this.knowledgeGapService=new X0(e),this.pathwayAnalysisService=new ex(e),this.evaluationService=new tx(e)}initialize(){return Ae(this,null,function*(){try{return(yield this.loadSettings())!==null}catch(e){return console.error(e),console.error("Failed to initialize LearningAIService"),!1}})}loadSettings(){return Ae(this,null,function*(){return yield nx(this.facilityId)})}saveSettings(e){return Ae(this,null,function*(){return yield sx(this.facilityId,e)})}initializeSettings(){return Ae(this,null,function*(){try{const e=U0;return yield this.saveSettings(e)}catch(e){return console.error(e),console.error("Error initializing learning AI settings"),!1}})}generatePersonalizedRecommendations(e){return Ae(this,null,function*(){try{const t=yield this.loadSettings();if(!Kt(t,"personalized_recommendations"))throw new Error("Personalized recommendations AI is not enabled");return yield this.recommendationService.generatePersonalizedRecommendations(e)}catch(t){return console.error("Error generating personalized recommendations:",t),null}})}analyzeSkillGaps(e){return Ae(this,null,function*(){try{const t=yield this.loadSettings();if(!Kt(t,"skill_gap_analysis"))throw new Error("Skill gap analysis AI is not enabled");return yield this.knowledgeGapService.analyzeSkillGaps(e)}catch(t){return console.error(t),console.error("Error analyzing skill gaps"),null}})}optimizeLearningPath(e){return Ae(this,null,function*(){try{const t=yield this.loadSettings();if(!Kt(t,"learning_path_optimization"))throw new Error("Learning path optimization AI is not enabled");return yield this.pathwayAnalysisService.optimizeLearningPath(e)}catch(t){return console.error("Error optimizing learning path:",t),null}})}predictPerformance(e,t){return Ae(this,null,function*(){try{const r=yield this.loadSettings();if(!Kt(r,"performance_prediction"))throw new Error("Performance prediction AI is not enabled");return yield this.evaluationService.predictPerformance(e,t)}catch(r){return console.error("Error predicting performance:",r),null}})}adjustDifficulty(e,t){return Ae(this,null,function*(){try{const r=yield this.loadSettings();if(!Kt(r,"adaptive_difficulty"))throw new Error("Adaptive difficulty AI is not enabled");return yield this.evaluationService.adjustDifficulty(e,t)}catch(r){return console.error("Error adjusting difficulty:",r),null}})}analyzeEngagement(e){return Ae(this,null,function*(){try{const t=yield this.loadSettings();if(!Kt(t,"engagement_metrics"))throw new Error("Engagement analysis AI is not enabled");return yield this.evaluationService.analyzeEngagement(e)}catch(t){return console.error("Error analyzing engagement:",t),null}})}predictRetention(e){return Ae(this,null,function*(){try{const t=yield this.loadSettings();if(!Kt(t,"retention_analysis"))throw new Error("Retention prediction AI is not enabled");return yield this.evaluationService.predictRetention(e)}catch(t){return console.error("Error predicting retention:",t),null}})}generateLearningAnalytics(e){return Ae(this,null,function*(){try{const t=yield this.loadSettings();if(!Kt(t,"learning_analytics_enabled"))throw new Error("Learning analytics AI is not enabled");return yield this.evaluationService.generateLearningAnalytics(e)}catch(t){return console.error("Error generating learning analytics:",t),null}})}getLearningInsights(){return Ae(this,null,function*(){return this.analyticsService.getLearningInsights()})}getLearningProgressData(e){return Ae(this,null,function*(){return yield ax(this.facilityId,e)})}getUserProfile(e){return Ae(this,null,function*(){return yield ix(this.facilityId,e)})}}var ai=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class To{constructor(e){this.facilityId=e}getInventoryInsights(){return ai(this,null,function*(){try{const e=[],{data:t}=yield _.from("inventory_ai_barcode_analysis").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);t&&t.forEach(s=>{e.push({type:"barcode_analysis",title:"Barcode Quality Assessment",description:`Barcode ${s.barcode_value} analyzed with ${(s.confidence_score*100).toFixed(1)}% confidence`,confidence:s.confidence_score||0,recommendations:s.recommendations||[],data:s,timestamp:s.created_at,priority:s.confidence_score<.7?"critical":s.confidence_score<.85?"high":"medium",id:s.id||`barcode-${Date.now()}`,actionable:!0})});const{data:r}=yield _.from("inventory_ai_demand_forecasting").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);return r&&r.forEach(s=>{e.push({type:"demand_forecast",title:"Demand Forecast",description:`${s.forecast_period} forecast: ${s.predicted_demand} units predicted`,confidence:s.confidence_score||0,recommendations:s.recommendations||[],data:s,timestamp:s.created_at,priority:s.confidence_score<.7?"critical":s.confidence_score<.85?"high":"medium",id:s.id||`forecast-${Date.now()}`,actionable:!0})}),e}catch(e){return console.error("Error getting inventory insights:",e),[]}})}getHistoricalInventoryData(){return ai(this,null,function*(){return Array.from({length:30},(e,t)=>({date:new Date(Date.now()-t*24*60*60*1e3).toISOString(),quantity:Math.floor(Math.random()*20)+10,transaction_type:"usage"}))})}getInventoryCostData(){return ai(this,null,function*(){return{purchasing_costs:8e3,storage_costs:4e3,transportation_costs:3e3,total_cost:15e3}})}detectBarcodeType(e){return e?e.length===13?"ean13":e.length===12?"upc":e.length===8?"ean8":"code128":"unknown"}assessBarcodeQuality(e){return e>=.9?"excellent":e>=.8?"good":e>=.7?"fair":"poor"}calculateInventoryTurns(e,t){return t===0?0:e/t}calculateStockoutRisk(e,t,r,s){const i=(e-s)/t;return i<=0?1:i<=r?.8:i<=r*1.5?.5:.2}calculateSafetyStock(e,t,r){const s=this.getZScore(r);return Math.ceil(e*t*s*.1)}calculateReorderPoint(e,t,r){return Math.ceil(e*t+r)}getZScore(e){return{.8:.84,.85:1.04,.9:1.28,.95:1.65,.99:2.33}[e]||1.28}}var wc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class cx{constructor(e){this.facilityId=e}processImageWithAI(){return wc(this,null,function*(){return{confidence:.85,damage_detected:!1,damage_types:[],objects:["Surgical Scissors","Forceps"],confidence_scores:[.92,.88],classification:"medical_instruments",category:"surgical_tools",quality:"Good",condition:"Excellent",damage_description:null,recommendations:["Items appear to be in good condition","No visible damage detected"]}})}analyzeBarcodeWithAI(e){return wc(this,null,function*(){return{confidence:.95,damage_detected:!1,damage_types:[],objects:["Barcode Item"],confidence_scores:[.95],classification:"barcode_item",category:"scannable_item",quality:"Excellent",condition:"Good",damage_description:null,recommendations:["Barcode successfully read"]}})}}var ii=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class dx{constructor(e){this.facilityId=e}generateDemandForecastWithAI(){return ii(this,null,function*(){return[{predicted_demand:150,confidence_interval_lower:120,confidence_interval_upper:180,seasonal_factors:{winter:1.2,summer:.8},trend_analysis:"increasing",influencing_factors:["seasonal demand","market trends"],confidence_score:.85,accuracy_metrics:{mape:.13,rmse:12.5},recommendations:["Increase stock levels by 20%","Monitor demand closely"]},{predicted_demand:75,confidence_interval_lower:65,confidence_interval_upper:85,seasonal_factors:{winter:1,summer:1},trend_analysis:"stable",influencing_factors:["consistent demand","stable market"],confidence_score:.9,accuracy_metrics:{mape:.08,rmse:6.2},recommendations:["Maintain current stock levels","Focus on cost optimization"]}]})}generateStockoutRiskAnalysis(){return ii(this,null,function*(){return{highRiskItems:["item_001","item_003"],mediumRiskItems:["item_002"],lowRiskItems:["item_004","item_005"],overallRiskScore:.65}})}generateMaintenancePredictions(){return ii(this,null,function*(){return{urgentMaintenance:["equipment_001"],scheduledMaintenance:["equipment_002","equipment_003"],preventiveMaintenance:["equipment_004","equipment_005"]}})}}var oi=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ux{constructor(e){this.facilityId=e}generateCostOptimizationWithAI(){return oi(this,null,function*(){return{current_cost:1e5,optimized_cost:85e3,cost_savings:15e3,savings_percentage:15,optimization_factors:{supplier_consolidation:.4,inventory_turnover:.3,storage_efficiency:.3},recommended_actions:["Consolidate suppliers for bulk discounts","Implement just-in-time inventory","Optimize storage layout"],implementation_timeline:"6 months",risk_assessment:"low",confidence_score:.88,roi_estimate:300}})}generateSmartCategorizationWithAI(){return oi(this,null,function*(){return{suggested_category:"Surgical Instruments",suggested_subcategory:"Cutting Tools",category_confidence_score:.92,alternative_categories:["Medical Tools","Surgical Equipment"],categorization_reasoning:["Items are sharp cutting instruments","Commonly used in surgical procedures","Similar material composition"],form_fill_suggestions:{category:"Surgical Instruments",subcategory:"Cutting Tools",material:"Stainless Steel"},workflow_recommendations:["Store in sterile environment","Regular sharpening required","Handle with care"],confidence_score:.92}})}generateInventoryOptimizationRecommendations(){return oi(this,null,function*(){return{reorderPoints:{item_001:50,item_002:25,item_003:75},safetyStock:{item_001:20,item_002:10,item_003:30},maxStockLevels:{item_001:200,item_002:100,item_003:300}}})}}var kt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class No{constructor(e){this.facilityId=e,this.imageProcessingService=new cx(e),this.forecastingService=new dx(e),this.optimizationService=new ux(e)}processImageWithAI(){return kt(this,null,function*(){return yield this.imageProcessingService.processImageWithAI()})}analyzeBarcodeWithAI(e){return kt(this,null,function*(){return yield this.imageProcessingService.analyzeBarcodeWithAI(e)})}generateDemandForecastWithAI(){return kt(this,null,function*(){return yield this.forecastingService.generateDemandForecastWithAI()})}generateStockoutRiskAnalysis(){return kt(this,null,function*(){return yield this.forecastingService.generateStockoutRiskAnalysis()})}generateMaintenancePredictions(){return kt(this,null,function*(){return yield this.forecastingService.generateMaintenancePredictions()})}generateCostOptimizationWithAI(){return kt(this,null,function*(){return yield this.optimizationService.generateCostOptimizationWithAI()})}generateSmartCategorizationWithAI(){return kt(this,null,function*(){return yield this.optimizationService.generateSmartCategorizationWithAI()})}generateInventoryOptimizationRecommendations(){return kt(this,null,function*(){return yield this.optimizationService.generateInventoryOptimizationRecommendations()})}getComprehensiveAIInsights(){return kt(this,null,function*(){const e=yield this.generateDemandForecastWithAI(),t=yield this.generateStockoutRiskAnalysis(),r=yield this.generateMaintenancePredictions();return{demandForecast:e,stockoutRisk:t,maintenancePredictions:r,costTrends:{trend:"decreasing",percentageChange:-5.2,confidence:.85},seasonalPatterns:{patterns:["Q4 peak","Summer dip"],confidence:.78}}})}}const li=.85,mx=2160*60*60*1e3,Hs=365*24*60*60*1e3,hx="30_days",px=10,fx=5,gx="maintenance-1",yx=[{month:"Jan",cost:1e3,trend:"stable"},{month:"Feb",cost:1200,trend:"increasing"}],Wh="Uncategorized",ko="Unknown",vx="Unknown Equipment",Un={csv:"text/csv",excel:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf",json:"application/json",default:"text/plain"},_x="good",xx="good",bx=["Increase inventory levels for low stock items.","Review maintenance schedules."],wx="low";var Sc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Sx{constructor(e){this.facilityId=e,this.providerService=new No(e)}generateCostOptimization(e){return Sc(this,null,function*(){try{const t=Date.now(),r=yield this.providerService.generateCostOptimizationWithAI(),s=Date.now()-t,i={facility_id:this.facilityId,optimization_type:e,current_cost:r.current_cost,optimized_cost:r.optimized_cost,cost_savings:r.cost_savings,savings_percentage:r.savings_percentage,optimization_factors:r.optimization_factors,recommended_actions:r.recommended_actions,implementation_timeline:r.implementation_timeline,risk_assessment:r.risk_assessment,confidence_score:r.confidence_score,processing_time_ms:s,data_analysis_period:hx,roi_estimate:r.roi_estimate},{data:l,error:c}=yield _.from("inventory_ai_cost_optimization").insert(i).select().single();return c?(console.error("Error saving cost optimization:",c),null):l}catch(t){return console.error("Error generating cost optimization:",t),null}})}categorizeItem(e,t){return Sc(this,null,function*(){try{const r=Date.now(),s=yield this.providerService.generateSmartCategorizationWithAI(),i=Date.now()-r,l={facility_id:this.facilityId,suggested_category:s.suggested_category,suggested_subcategory:s.suggested_subcategory,category_confidence_score:s.category_confidence_score,alternative_categories:s.alternative_categories,categorization_reasoning:s.categorization_reasoning,form_fill_suggestions:s.form_fill_suggestions,workflow_recommendations:s.workflow_recommendations,confidence_score:s.confidence_score,processing_time_ms:i,input_data_type:t,learning_feedback:!1,user_acceptance:void 0},{data:c,error:o}=yield _.from("inventory_ai_smart_categorization").insert(l).select().single();return o?(console.error("Error saving smart categorization:",o),null):c}catch(r){return console.error("Error categorizing item:",r),null}})}}var Cc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Cx{constructor(e){this.facilityId=e,this.analyticsService=new To(e),this.providerService=new No(e)}analyzeBarcode(e,t){return Cc(this,null,function*(){try{const r=Date.now(),s=yield this.providerService.processImageWithAI(),i=Date.now()-r,l={facility_id:this.facilityId,barcode_value:t,barcode_type:this.analyticsService.detectBarcodeType(t),quality_rating:this.analyticsService.assessBarcodeQuality(s.confidence),readability_score:s.confidence||li,damage_detected:s.damage_detected||!1,damage_types:s.damage_types||[],confidence_score:s.confidence||li,processing_time_ms:i,image_file_path:"placeholder_path",ai_insights:s,recommendations:s.recommendations||[]},{data:c,error:o}=yield _.from("inventory_ai_barcode_analysis").insert(l).select().single();return o?(console.error("Error saving barcode analysis:",o),null):c}catch(r){return console.error("Error analyzing barcode:",r),null}})}analyzeImage(e){return Cc(this,null,function*(){try{const t=Date.now(),r=yield this.providerService.processImageWithAI(),s=Date.now()-t,i={facility_id:this.facilityId,recognized_objects:r.objects||[],object_confidence_scores:r.confidence_scores||[],item_classification:r.classification,category_suggestion:r.category,quality_assessment:r.quality||_x,damage_detected:r.damage_detected||!1,damage_description:r.damage_description||void 0,condition_rating:r.condition||xx,confidence_score:r.confidence||li,processing_time_ms:s,image_file_path:"placeholder_path",ai_insights:r,recommendations:r.recommendations||[]},{data:l,error:c}=yield _.from("inventory_ai_image_recognition").insert(i).select().single();return c?(console.error("Error saving image recognition:",c),null):l}catch(t){return console.error("Error analyzing image:",t),null}})}}function Ix(n){return n.reduce((e,t)=>{const r=t.category||Wh;return e[r]||(e[r]=0),e[r]=e[r]+1,e},{})}function jx(n){return n.reduce((e,t)=>{const r=t.category||Wh;return e[r]=(e[r]||0)+(t.amount||0),e},{})}function Ex(n){return n.reduce((e,t)=>{const r=t.type||ko;return e[r]=(e[r]||0)+1,e},{})}function Tx(n){return n.filter(e=>{var t;return(e.quantity||0)<(((t=e.data)==null?void 0:t.min_quantity)||0)}).map(e=>{var t;return{id:e.id||"",name:e.name||"",current_stock:e.quantity||0,reorder_point:((t=e.data)==null?void 0:t.min_quantity)||0}})}function Nx(n){return n.sort((e,t)=>(t.value||0)-(e.value||0)).slice(0,px).map(e=>({id:e.id||"",name:e.name||"",value:e.value||0,category:e.category||ko}))}function kx(n){return n.slice(0,fx).map(e=>({id:gx,equipment_name:e.equipment_name||vx,due_date:e.due_date||new Date().toISOString(),type:e.type||ko}))}function Px(n){return n.reduce((e,t)=>e+(t.amount||0),0)}function Dx(){return yx}function Ax(n){return{totalValue:n.totalItems,riskLevel:wx,recommendations:bx}}function Ox(n){if(Array.isArray(n)){const e=Object.keys(n[0]||{}),t=[e.join(",")];for(const r of n){const s=e.map(i=>JSON.stringify(r[i]||""));t.push(s.join(","))}return t.join(`
`)}return JSON.stringify(n)}function Rx(n){switch(n){case"csv":return Un.csv;case"excel":return Un.excel;case"pdf":return Un.pdf;case"json":return Un.json;default:return Un.default}}var fr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class $x{constructor(e){this.facilityId=e}exportAnalyticsReport(e,t,r){return fr(this,null,function*(){try{const s=Date.now();let i={};switch(e){case"inventory":i=yield this.generateInventoryReport();break;case"predictive":i={};break;case"cost":i=yield this.generateCostReport();break;case"maintenance":i=yield this.generateMaintenanceReport();break;case"comprehensive":i=yield this.generateComprehensiveReport();break}const l=yield this.formatReportData(i,t),{error:c}=yield _.from("inventory_ai_exports").insert({facility_id:this.facilityId,report_type:e,export_format:t,date_range:r,processing_time_ms:Date.now()-s,exported_at:new Date().toISOString()});return c&&console.error("Error saving export record:",c),{success:!0,data:l,downloadUrl:yield this.generateDownloadUrl(l,t)}}catch(s){return console.error("Error exporting analytics report:",s),{success:!1,error:s instanceof Error?s.message:"Export failed"}}})}generateInventoryReport(){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("inventory_items").select("*").eq("facility_id",this.facilityId),r=e.filter(s=>s.facility_id===this.facilityId);return{totalItems:(r==null?void 0:r.length)||0,categories:Ix(r||[]),lowStockItems:Tx(r||[]),highValueItems:Nx(r||[])}})}generateCostReport(){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("inventory_costs").select("*").eq("facility_id",this.facilityId);return t?(console.error("Error getting inventory costs for cost report:",t),{totalCosts:0,costByCategory:{},costTrends:[]}):{totalCosts:Px(e||[]),costByCategory:jx(e||[]),costTrends:Dx()}})}generateMaintenanceReport(){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("equipment_maintenance").select("*").eq("facility_id",this.facilityId);return t?(console.error("Error getting equipment maintenance for maintenance report:",t),{totalMaintenance:0,maintenanceByType:{},upcomingMaintenance:[]}):{totalMaintenance:(e==null?void 0:e.length)||0,maintenanceByType:Ex(e||[]),upcomingMaintenance:kx(e||[])}})}generateComprehensiveReport(){return fr(this,null,function*(){const[e,t,r]=yield Promise.all([this.generateInventoryReport(),this.generateCostReport(),this.generateMaintenanceReport()]);return{inventory:e,predictive:{},cost:t,maintenance:r,summary:Ax(e)}})}formatReportData(e,t){return fr(this,null,function*(){switch(t){case"json":return JSON.stringify(e,null,2);case"csv":return Ox(e);case"excel":return e;case"pdf":return e;default:return e}})}generateDownloadUrl(e,t){return fr(this,null,function*(){const r=new Blob([JSON.stringify(e)],{type:Rx(t)});return URL.createObjectURL(r)})}}var ci=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Mx{constructor(e){this.facilityId=e}generateDemandForecast(e,t,r){return ci(this,null,function*(){try{const s=Date.now(),i=r||(yield this.getHistoricalInventoryData()),l=yield this.generateForecastWithAI(i,t),c=Date.now()-s;return{inventory_item_id:e,forecast_period:t,forecast_date:new Date().toISOString(),predicted_demand:l.predicted_demand,confidence_interval_lower:l.confidence_interval_lower,confidence_interval_upper:l.confidence_interval_upper,seasonal_factors:l.seasonal_factors,trend_analysis:l.trend_analysis,influencing_factors:l.influencing_factors,confidence_score:this.calculateConfidence(i,l),model_id:"default",processing_time_ms:c,facility_id:this.facilityId}}catch(s){throw console.error("Error generating demand forecast:",s),new Error(`Failed to generate forecast: ${s instanceof Error?s.message:"Unknown error"}`)}})}getHistoricalInventoryData(){return ci(this,null,function*(){return[]})}generateForecastWithAI(e,t){return ci(this,null,function*(){return{predicted_demand:0,confidence_interval_lower:0,confidence_interval_upper:0,seasonal_factors:{},trend_analysis:"stable",influencing_factors:[],confidence_score:.8,accuracy_metrics:{},recommendations:[]}})}calculateConfidence(e,t){return Math.min(.95,Math.max(.1,t.confidence_score||.8))}}var Ic=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Fx{constructor(e){this.facilityId=e}analyzeForecastAccuracy(e,t){return Ic(this,null,function*(){try{const r=this.calculateOverallAccuracy(e,t),s=this.identifyTrends(e),i=this.generateRecommendations(e,t);return{accuracy:r,trends:s,recommendations:i}}catch(r){throw console.error("Error analyzing forecast accuracy:",r),new Error(`Failed to analyze accuracy: ${r instanceof Error?r.message:"Unknown error"}`)}})}generateForecastReport(e){return Ic(this,null,function*(){try{const t=this.generateSummary(e),r=this.extractKeyInsights(e),s=this.identifyRiskFactors(e);return{summary:t,keyInsights:r,riskFactors:s}}catch(t){throw console.error("Error generating forecast report:",t),new Error(`Failed to generate report: ${t instanceof Error?t.message:"Unknown error"}`)}})}calculateOverallAccuracy(e,t){return .85}identifyTrends(e){return["Increasing demand","Seasonal patterns"]}generateRecommendations(e,t){return["Increase stock for high-demand items","Optimize ordering schedule"]}generateSummary(e){return"Generated forecasts with average confidence"}extractKeyInsights(e){return["High confidence in short-term forecasts","Seasonal patterns detected"]}identifyRiskFactors(e){return["Low historical data","High variability in demand"]}}var Hn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Lx{constructor(e){this.facilityId=e,this.coreService=new Mx(e),this.analyticsService=new Fx(e)}generateDemandForecast(e,t,r){return Hn(this,null,function*(){return yield this.coreService.generateDemandForecast(e,t,r)})}analyzeForecastAccuracy(e,t){return Hn(this,null,function*(){return yield this.analyticsService.analyzeForecastAccuracy(e,t)})}generateForecastReport(e){return Hn(this,null,function*(){return yield this.analyticsService.generateForecastReport(e)})}generateBatchForecasts(e,t){return Hn(this,null,function*(){const r=[];for(const s of e)try{const i=yield this.generateDemandForecast(s,t);r.push(i)}catch(i){console.error(`Error generating forecast for item ${s}:`,i)}return r})}getForecastingInsights(){return Hn(this,null,function*(){return{totalForecasts:0,averageAccuracy:.85,topTrends:["Seasonal patterns","Demand variability"]}})}}var jc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class zx{constructor(e){this.facilityId=e,this.analyticsService=new To(e),this.forecastingService=new Lx(e),this.providerService=new No(e)}generateDemandForecast(e,t){return jc(this,null,function*(){try{const r=yield this.analyticsService.getHistoricalInventoryData(),s=yield this.forecastingService.generateDemandForecast(e,t,r),{data:i,error:l}=yield _.from("inventory_ai_demand_forecasting").insert(s).select().single();return l?(console.error("Error saving demand forecast:",l),null):i}catch(r){return console.error("Error generating demand forecast:",r),null}})}getPredictiveAnalytics(){return jc(this,null,function*(){try{const e=Date.now(),{data:t,error:r}=yield _.from("inventory_transactions").select("*").eq("facility_id",this.facilityId).gte("created_at",new Date(Date.now()-Hs).toISOString());if(r)return console.error("Error getting inventory transactions:",r),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};const s=new Date(Date.now()-mx);(t||[]).filter(v=>v.created_at&&new Date(v.created_at)>=s).sort((v,x)=>new Date(x.created_at||"").getTime()-new Date(v.created_at||"").getTime());const{data:l,error:c}=yield _.from("equipment_maintenance").select("*").eq("facility_id",this.facilityId).gte("created_at",new Date(Date.now()-Hs).toISOString());if(c)return console.error("Error getting equipment maintenance:",c),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};const o=new Date(Date.now()-Hs);(l||[]).filter(v=>v.created_at&&new Date(v.created_at)>=o).sort((v,x)=>new Date(x.created_at||"").getTime()-new Date(v.created_at||"").getTime());const{data:u,error:m}=yield _.from("inventory_costs").select("*").eq("facility_id",this.facilityId).gte("created_at",new Date(Date.now()-Hs).toISOString());if(m)return console.error("Error getting inventory costs:",m),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};(u||[]).filter(v=>v.created_at&&new Date(v.created_at)>=o).sort((v,x)=>new Date(x.created_at||"").getTime()-new Date(v.created_at||"").getTime());const f=yield this.providerService.generateDemandForecastWithAI(),g=Date.now()-e,{error:y}=yield _.from("inventory_ai_predictive_analytics").insert({facility_id:this.facilityId,predictions_data:f,processing_time_ms:g,generated_at:new Date().toISOString()});return y&&console.error("Error saving predictive analytics:",y),{demandForecast:f.map(v=>({itemId:"unknown",itemName:"Unknown Item",predictedDemand:v.predicted_demand||0,confidence:v.confidence_score||.8,timeframe:"30 days",factors:v.influencing_factors||[]})),stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]}}catch(e){throw console.error("Error generating predictive analytics:",e),e}})}}var di=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Bx={low_stock_threshold:10,prediction_accuracy_threshold:.85,ai_model_version:"1.0.0"};class qx{constructor(e){this.facilityId=e}loadSettings(){return di(this,null,function*(){try{const{data:e,error:t}=yield _.from("inventory_items").select("facility_id").eq("facility_id",this.facilityId).limit(1);return t?(console.error("Error loading AI settings:",t),null):{id:"default",facility_id:this.facilityId,ai_enabled:!0,ai_version:"1.0.0",computer_vision_enabled:!0,barcode_scanning_enabled:!0,image_recognition_enabled:!0,quality_assessment_enabled:!0,damage_detection_enabled:!0,inventory_counting_enabled:!0,predictive_analytics_enabled:!0,demand_forecasting_enabled:!0,maintenance_prediction_enabled:!0,cost_optimization_enabled:!0,seasonal_analysis_enabled:!0,cycle_optimization_enabled:!0,smart_categorization_enabled:!0,auto_classification_enabled:!0,smart_form_filling_enabled:!0,intelligent_workflow_enabled:!0,quality_assurance_enabled:!0,compliance_monitoring_enabled:!0,audit_trail_enhancement_enabled:!0,risk_assessment_enabled:!0,scanner_intelligence_enabled:!0,multi_format_barcode_support:!0,smart_validation_enabled:!0,error_prevention_enabled:!0,real_time_monitoring_enabled:!0,anomaly_detection_enabled:!0,ai_confidence_threshold:.85,ai_data_retention_days:30,ai_model_training:!1,predictive_maintenance_enabled:!0,smart_notifications_enabled:!0,real_time_processing_enabled:!0,data_sharing_enabled:!1,local_ai_processing_enabled:!0,encrypted_data_transmission:!0,auto_optimization_enabled:!0,performance_monitoring:!0,resource_optimization:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}catch(e){return console.error("Error loading AI settings:",e),null}})}saveSettings(e){return di(this,null,function*(){try{return console.log("Saving AI settings:",e),!0}catch(t){return console.error("Error saving AI settings:",t),!1}})}initializeSettings(){return di(this,null,function*(){try{const e=Bx;return yield this.saveSettings(e)}catch(e){return console.error("Error initializing AI settings:",e),!1}})}}var lt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Ux{constructor(e){this.facilityId=e,this.analyticsService=new To(e),this.forecastingService=new zx(e),this.optimizationService=new Sx(e),this.riskAnalysisService=new Cx(e),this.costAnalyticsService=new $x(e),this.supabaseProvider=new qx(e)}getInventoryInsights(){return lt(this,null,function*(){return this.analyticsService.getInventoryInsights()})}loadSettings(){return lt(this,null,function*(){return yield this.supabaseProvider.loadSettings()})}saveSettings(e){return lt(this,null,function*(){return yield this.supabaseProvider.saveSettings(e)})}initializeSettings(){return lt(this,null,function*(){return yield this.supabaseProvider.initializeSettings()})}analyzeBarcode(e,t){return lt(this,null,function*(){try{const r=yield this.loadSettings();if(!(r!=null&&r.barcode_scanning_enabled))throw new Error("Barcode scanning AI is not enabled");return yield this.riskAnalysisService.analyzeBarcode(e,t)}catch(r){return console.error("Error analyzing barcode:",r),null}})}analyzeImage(e){return lt(this,null,function*(){try{const t=yield this.loadSettings();if(!(t!=null&&t.image_recognition_enabled))throw new Error("Image recognition AI is not enabled");return yield this.riskAnalysisService.analyzeImage(e)}catch(t){return console.error("Error analyzing image:",t),null}})}generateDemandForecast(e,t){return lt(this,null,function*(){try{const r=yield this.loadSettings();if(!(r!=null&&r.demand_forecasting_enabled))throw new Error("Demand forecasting AI is not enabled");return yield this.forecastingService.generateDemandForecast(e,t)}catch(r){return console.error("Error generating demand forecast:",r),null}})}generateCostOptimization(e){return lt(this,null,function*(){try{const t=yield this.loadSettings();if(!(t!=null&&t.cost_optimization_enabled))throw new Error("Cost optimization AI is not enabled");return yield this.optimizationService.generateCostOptimization(e)}catch(t){return console.error("Error generating cost optimization:",t),null}})}categorizeItem(e,t){return lt(this,null,function*(){try{const r=yield this.loadSettings();if(!(r!=null&&r.smart_categorization_enabled))throw new Error("Smart categorization AI is not enabled");return yield this.optimizationService.categorizeItem(e,t)}catch(r){return console.error("Error categorizing item:",r),null}})}getPredictiveAnalytics(){return lt(this,null,function*(){try{const e=yield this.loadSettings();if(!(e!=null&&e.predictive_analytics_enabled))throw new Error("Predictive analytics AI is not enabled");return yield this.forecastingService.getPredictiveAnalytics()}catch(e){throw console.error("Error generating predictive analytics:",e),e}})}exportAnalyticsReport(e,t,r){return lt(this,null,function*(){try{const s=yield this.loadSettings();if(!(s!=null&&s.predictive_analytics_enabled))throw new Error("Analytics export is not enabled");return yield this.costAnalyticsService.exportAnalyticsReport(e,t,r)}catch(s){return console.error("Error exporting analytics report:",s),{success:!1,error:s instanceof Error?s.message:"Export failed"}}})}}var Ec=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Hx{constructor(e){this.settings=null,this.facilityId=e}loadSettings(){return Ec(this,null,function*(){try{const{data:e,error:t}=yield _.from("ai_settings").select("*").eq("facility_id",this.facilityId).eq("module","sterilization").single();return t?(console.error("Error loading AI settings:",t),null):(this.settings=e.settings,e.settings)}catch(e){return console.error("Error loading AI settings:",e),null}})}saveSettings(e){return Ec(this,null,function*(){try{const t={facility_id:this.facilityId,module:"sterilization",settings:e,updated_at:new Date().toISOString()},{error:r}=yield _.from("ai_settings").upsert(t,{onConflict:"facility_id,module"});return r?(console.error("Error saving AI settings:",r),!1):(!r&&t&&(yield Vh({facilityId:this.facilityId,userId:"system",module:"sterilization",action:"UPDATE",details:t})),yield this.loadSettings(),!0)}catch(t){return console.error("Error saving AI settings:",t),!1}})}isFeatureEnabled(e){var t;return(t=this.settings)!=null&&t.ai_enabled?this.settings[e]===!0:!1}getCurrentSettings(){return this.settings}getOpenAIKey(){var e;return((e=this.settings)==null?void 0:e.openai_api_key_encrypted)||cr("VITE_OPENAI_API_KEY")}isComputerVisionEnabled(){return this.isFeatureEnabled("computer_vision_enabled")}isToolConditionAssessmentEnabled(){return this.isFeatureEnabled("tool_condition_assessment")}isBarcodeQualityDetectionEnabled(){return this.isFeatureEnabled("barcode_quality_detection")}isToolTypeRecognitionEnabled(){return this.isFeatureEnabled("tool_type_recognition")}isPredictiveAnalyticsEnabled(){return this.isFeatureEnabled("predictive_analytics_enabled")}isCycleOptimizationEnabled(){return this.isFeatureEnabled("cycle_optimization")}isIntelligentWorkflowSelectionEnabled(){return this.isFeatureEnabled("intelligent_workflow_selection")}isAutomatedProblemDetectionEnabled(){return this.isFeatureEnabled("automated_problem_detection")}isRealTimeMonitoringEnabled(){return this.isFeatureEnabled("real_time_monitoring_enabled")}isComplianceMonitoringEnabled(){return this.isFeatureEnabled("compliance_monitoring")}isBiologicalIndicatorAnalysisEnabled(){return this.isFeatureEnabled("biological_indicator_analysis")}getConfidenceThreshold(){var e;return((e=this.settings)==null?void 0:e.ai_confidence_threshold)||.8}getDataRetentionDays(){var e;return((e=this.settings)==null?void 0:e.ai_data_retention_days)||365}}function Vx(){try{const n=localStorage.getItem("currentUser");if(n){const e=JSON.parse(n);return(e==null?void 0:e.id)||null}return null}catch(n){return console.warn("Failed to get user ID from storage:",n),null}}function bt(n){const e=Vx();return e||n||null}var Tc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class J{static callOpenAI(e,t){return Tc(this,null,function*(){var r,s;if(!t)throw new Error("OpenAI API key not configured");try{const i=yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are a healthcare AI specialist for Cliniio, specializing in sterilization facility management, medical instrument analysis, and compliance workflows. Provide accurate, actionable insights based on the data provided."},{role:"user",content:e}],temperature:.3,max_tokens:1e3})});if(!i.ok)throw new Error(`OpenAI API error: ${i.status} ${i.statusText}`);return((s=(r=(yield i.json()).choices[0])==null?void 0:r.message)==null?void 0:s.content)||"AI analysis completed but no response received"}catch(i){throw console.error("OpenAI API call failed:",i),new Error("AI analysis failed")}})}static testConnection(e){return Tc(this,null,function*(){try{return{success:!0,response:yield this.callOpenAI("Hello! This is a test message from Cliniio sterilization AI service. Please respond with a brief confirmation that you are working.",e)}}catch(t){return{success:!1,response:"",error:t instanceof Error?t.message:"Unknown error"}}})}static parseConditionFromAI(e){return e.includes("excellent")||e.includes("perfect")?"excellent":e.includes("good")||e.includes("acceptable")?"good":e.includes("fair")||e.includes("adequate")?"fair":e.includes("poor")||e.includes("unacceptable")?"poor":e.includes("damaged")||e.includes("broken")?"damaged":"good"}static parseWearLevelFromAI(e){return e.includes("minimal")||e.includes("new")?"minimal":e.includes("moderate")||e.includes("normal")?"moderate":e.includes("significant")||e.includes("worn")?"significant":e.includes("critical")||e.includes("severe")?"critical":"moderate"}static parseCleaningQualityFromAI(e){return e.includes("excellent")||e.includes("clean")?"excellent":e.includes("good")||e.includes("acceptable")?"good":e.includes("fair")||e.includes("adequate")?"fair":e.includes("poor")||e.includes("dirty")?"poor":"good"}static parseDamageFromAI(e){return e.includes("damage")||e.includes("broken")||e.includes("cracked")}static parseDamageTypesFromAI(e){const t=[];return e.includes("crack")&&t.push("crack"),e.includes("scratch")&&t.push("scratch"),e.includes("rust")&&t.push("rust"),e.includes("bend")&&t.push("bent"),t}static parseBarcodeQualityFromAI(e){return e.includes("excellent")||e.includes("clear")?"excellent":e.includes("good")||e.includes("readable")?"good":e.includes("fair")||e.includes("acceptable")?"fair":e.includes("poor")||e.includes("unreadable")?"poor":"good"}static parseToolTypeFromAI(e){return e.includes("handpiece")?"Dental Handpiece":e.includes("scalpel")?"Surgical Scalpel":e.includes("forceps")?"Surgical Forceps":e.includes("scissors")?"Surgical Scissors":"Medical Instrument"}static parseToolCategoryFromAI(e){return e.includes("dental")?"Dental Instruments":e.includes("surgical")?"Surgical Instruments":e.includes("ophthalmic")?"Ophthalmic Instruments":"General Medical Instruments"}static parseRiskLevel(e){return e.includes("high")||e.includes("critical")?"high":e.includes("medium")||e.includes("moderate")?"medium":"low"}static parseComplianceScore(e){return e.includes("excellent")||e.includes("100%")?.95:e.includes("good")||e.includes("90%")?.9:e.includes("fair")||e.includes("80%")?.8:.75}static generateRecommendations(e){const t=[];return e.includes("clean")&&t.push("Ensure thorough cleaning before sterilization"),e.includes("inspect")&&t.push("Perform detailed visual inspection"),e.includes("maintenance")&&t.push("Schedule maintenance check"),t.length===0&&t.push("Tool appears in good condition"),t}static generateBarcodeRecommendations(e){const t=[];return e.includes("poor")&&t.push("Replace barcode label"),e.includes("fair")&&t.push("Clean barcode surface"),e.includes("good")&&t.push("Monitor for degradation"),t}static generateToolSuggestions(e){const t=[];return e.includes("high-speed")&&t.push("High-speed handpiece - requires special sterilization cycle"),e.includes("delicate")&&t.push("Delicate instrument - handle with care"),e.includes("sharp")&&t.push("Sharp instrument - use protective packaging"),t}static parseOptimizationSuggestions(e){const t=[];return e.includes("temperature")&&t.push("Optimize temperature settings"),e.includes("duration")&&t.push("Adjust cycle duration"),e.includes("grouping")&&t.push("Improve tool grouping"),t.length===0&&t.push("Review cycle parameters"),t}static parseRecommendedParameters(e){const t={};return e.includes("temperature")&&(t.temperature=134),e.includes("duration")&&(t.duration=20),e.includes("pressure")&&(t.pressure=30),t}static parseRecommendedWorkflow(e){return e.includes("clean")?"clean":e.includes("dirty")?"dirty":e.includes("problem")?"problem":e.includes("packaging")?"packaging":"dirty"}static parseWorkflowReasoning(){return["Tool condition assessment completed","Historical usage patterns analyzed","Sterilization requirements verified"]}static parseAlternativeWorkflows(){return[{workflow:"clean",confidence:.75,reasoning:"Alternative cleaning approach"}]}static parseIssues(e){const t=[];return e.includes("wear")&&t.push("Tool wear detected"),e.includes("damage")&&t.push("Potential damage"),e.includes("maintenance")&&t.push("Maintenance needed"),t}static parseRiskFactors(e){const t=[];return e.includes("temperature")&&t.push("Temperature variations"),e.includes("pressure")&&t.push("Pressure fluctuations"),e.includes("time")&&t.push("Timing issues"),t}static parseRequiredActions(e){const t=[];return e.includes("document")&&t.push("Document variations"),e.includes("investigate")&&t.push("Investigate causes"),e.includes("correct")&&t.push("Correct procedures"),t}static parseAuditRecommendations(e){const t=[];return e.includes("review")&&t.push("Review procedures"),e.includes("monitor")&&t.push("Monitor parameters"),e.includes("train")&&t.push("Staff training"),t}static parseBIValidation(e){return e.includes("pass")||e.includes("success")?!0:(e.includes("fail")||e.includes("failure"),!1)}}var Wx=Object.defineProperty,Gx=Object.defineProperties,Kx=Object.getOwnPropertyDescriptors,Nc=Object.getOwnPropertySymbols,Qx=Object.prototype.hasOwnProperty,Yx=Object.prototype.propertyIsEnumerable,kc=(n,e,t)=>e in n?Wx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Jx=(n,e)=>{for(var t in e||(e={}))Qx.call(e,t)&&kc(n,t,e[t]);if(Nc)for(var t of Nc(e))Yx.call(e,t)&&kc(n,t,e[t]);return n},Xx=(n,e)=>Gx(n,Kx(e)),gr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});let Zx=class{constructor(e){this.facilityId=e}recordMetric(e){return gr(this,null,function*(){try{const t=Xx(Jx({facility_id:this.facilityId},e),{created_at:new Date().toISOString()}),{data:r,error:s}=yield _.from("ai_performance_metrics").insert(t).select("id").single();return s?(console.error("Error recording performance metric:",s),null):r.id}catch(t){return console.error("Error recording performance metric:",t),null}})}getPerformanceSummary(e="day",t){return gr(this,null,function*(){try{const r=this.getStartDate(e);let s=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",r.toISOString());t&&(s=s.eq("service_name",t));const{data:i,error:l}=yield s;return l?(console.error("Error fetching performance metrics:",l),this.getDefaultPerformanceSummary()):this.calculatePerformanceSummary(i||[])}catch(r){return console.error("Error getting performance summary:",r),this.getDefaultPerformanceSummary()}})}getServicePerformance(e="day"){return gr(this,null,function*(){try{const t=this.getStartDate(e),{data:r,error:s}=yield _.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",t.toISOString());return s?(console.error("Error fetching service performance:",s),[]):this.calculateServicePerformance(r||[])}catch(t){return console.error("Error getting service performance:",t),[]}})}getDetailedMetrics(e){return gr(this,null,function*(){try{const t=this.getStartDate(e.timeRange||"day");let r=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",t.toISOString()).order("created_at",{ascending:!1});e.serviceName&&(r=r.eq("service_name",e.serviceName)),e.operationName&&(r=r.eq("operation_name",e.operationName)),e.success!==void 0&&(r=r.eq("success",e.success)),e.limit&&(r=r.limit(e.limit));const{data:s,error:i}=yield r;return i?(console.error("Error fetching detailed metrics:",i),[]):s}catch(t){return console.error("Error getting detailed metrics:",t),[]}})}getPerformanceTrends(e="month",t){return gr(this,null,function*(){try{const r=this.getStartDate(e),s=this.getInterval(e);let i=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",r.toISOString()).order("created_at",{ascending:!0});t&&(i=i.eq("service_name",t));const{data:l,error:c}=yield i;return c?(console.error("Error fetching performance trends:",c),{dates:[],processingTimes:[],successRates:[],operationCounts:[]}):this.calculateTrends(l||[],s)}catch(r){return console.error("Error getting performance trends:",r),{dates:[],processingTimes:[],successRates:[],operationCounts:[]}}})}getOptimizationRecommendations(){return gr(this,null,function*(){try{const e=yield this.getPerformanceSummary("week"),t=[];return e.averageProcessingTime>5e3&&t.push("Consider optimizing AI model selection or reducing input complexity"),e.p95ProcessingTime>1e4&&t.push("Investigate performance bottlenecks in AI service calls"),e.successRate<.9&&t.push("Review error patterns and improve error handling"),e.errorRate>.1&&t.push("Implement retry mechanisms and fallback strategies"),e.performanceTrend==="degrading"&&t.push("Monitor system resources and consider scaling AI services"),t.length===0&&t.push("Performance is within acceptable ranges - continue monitoring"),t}catch(e){return console.error("Error getting optimization recommendations:",e),["Unable to generate recommendations at this time"]}})}cleanupOldMetrics(e=90){return gr(this,null,function*(){try{const t=new Date(Date.now()-e*24*60*60*1e3),{data:r,error:s}=yield _.from("ai_performance_metrics").delete().lt("created_at",t.toISOString()).eq("facility_id",this.facilityId).select("id");return s?(console.error("Error cleaning up old metrics:",s),0):(r==null?void 0:r.length)||0}catch(t){return console.error("Error cleaning up old metrics:",t),0}})}getStartDate(e){const t=new Date;switch(e){case"hour":return new Date(t.getTime()-3600*1e3);case"day":return new Date(t.getTime()-1440*60*1e3);case"week":return new Date(t.getTime()-10080*60*1e3);case"month":return new Date(t.getTime()-720*60*60*1e3);case"quarter":return new Date(t.getTime()-2160*60*60*1e3);default:return new Date(t.getTime()-1440*60*1e3)}}getInterval(e){switch(e){case"week":return 1440*60*1e3;case"month":return 1440*60*1e3;case"quarter":return 10080*60*1e3;default:return 1440*60*1e3}}calculatePerformanceSummary(e){if(e.length===0)return this.getDefaultPerformanceSummary();const t=e.map(y=>y.processing_time_ms).filter(y=>y>0),r=e.filter(y=>y.success),s=e.filter(y=>!y.success),i=t.sort((y,v)=>y-v),l=e.length,c=r.length/l,o=t.reduce((y,v)=>y+v,0)/t.length,d=i[Math.floor(i.length/2)],u=i[Math.floor(i.length*.95)],m=i[Math.floor(i.length*.99)],p=e.slice(-10),f=p.reduce((y,v)=>y+v.processing_time_ms,0)/p.length,g=f<o*.9?"improving":f>o*1.1?"degrading":"stable";return{totalOperations:l,successRate:c,averageProcessingTime:o,medianProcessingTime:d,p95ProcessingTime:u,p99ProcessingTime:m,totalErrors:s.length,errorRate:s.length/l,performanceTrend:g,recommendations:this.generateRecommendations(e)}}calculateServicePerformance(e){const t=new Map;return e.forEach(r=>{t.has(r.service_name)||t.set(r.service_name,[]),t.get(r.service_name).push(r)}),Array.from(t.entries()).map(([r,s])=>{var i;const l=s.map(y=>y.processing_time_ms).filter(y=>y>0),c=s.filter(y=>y.success),o=((i=s[0])==null?void 0:i.created_at)||"",d=s.length,u=c.length/d,m=l.length>0?l.reduce((y,v)=>y+v,0)/l.length:0,p=Math.max(0,100-m/100),f=u*100,g=Math.round((p+f)/2);return{serviceName:r,operationCount:d,successRate:u,averageTime:m,totalErrors:s.filter(y=>!y.success).length,lastOperation:o,performanceScore:g}}).sort((r,s)=>s.performanceScore-r.performanceScore)}calculateTrends(e,t){const r=new Date,s=new Map;for(let l=0;l<10;l++){const o=new Date(r.getTime()-l*t).toISOString().split("T")[0];s.set(o,{times:[],success:0,total:0})}e.forEach(l=>{const c=new Date(l.created_at).toISOString().split("T")[0],o=s.get(c);o&&(o.times.push(l.processing_time_ms),o.total++,l.success&&o.success++)});const i=Array.from(s.entries()).sort(([l],[c])=>l.localeCompare(c));return{dates:i.map(([l])=>l),processingTimes:i.map(([,l])=>l.times.length>0?l.times.reduce((c,o)=>c+o,0)/l.times.length:0),successRates:i.map(([,l])=>l.total>0?l.success/l.total:0),operationCounts:i.map(([,l])=>l.total)}}generateRecommendations(e){const t=[];if(e.length===0)return["No performance data available for recommendations"];const r=e.reduce((i,l)=>i+l.processing_time_ms,0)/e.length,s=e.filter(i=>i.success).length/e.length;return r>5e3&&t.push("Consider optimizing AI model selection for faster processing"),s<.9&&t.push("Review error patterns and implement better error handling"),t.length===0&&t.push("Performance is within acceptable ranges"),t}getDefaultPerformanceSummary(){return{totalOperations:0,successRate:0,averageProcessingTime:0,medianProcessingTime:0,p95ProcessingTime:0,p99ProcessingTime:0,totalErrors:0,errorRate:0,performanceTrend:"stable",recommendations:["No performance data available"]}}};var Vn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class eb{constructor(e){this.analysisStartTime=0,this.facilityId=e,this.performanceMetrics=new Zx(e)}analyzeToolCondition(e,t,r){return Vn(this,null,function*(){this.analysisStartTime=Date.now();try{let s;t?s=`Analyze medical instrument data for tool ID: ${e}. Provide general condition assessment, wear level estimation, cleaning quality recommendations, and damage detection guidance based on best practices for medical instrument sterilization.`:s=`Analyze medical instrument data for tool ID: ${e}. Provide general condition assessment, wear level estimation, cleaning quality recommendations, and damage detection guidance based on best practices for medical instrument sterilization.`;const i=yield J.callOpenAI(s,r||""),l={success:!0,toolId:e,condition:J.parseConditionFromAI(i),wearLevel:J.parseWearLevelFromAI(i),cleaningQuality:J.parseCleaningQualityFromAI(i),damageDetected:J.parseDamageFromAI(i),damageTypes:J.parseDamageTypesFromAI(i),confidence:.8,recommendations:J.generateRecommendations(i)},c=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"analyzeToolCondition",processing_time_ms:c,success:!0,input_size_bytes:(t==null?void 0:t.size)||0,ai_model_used:"gpt-4",confidence_score:l.confidence,user_id:bt()||void 0}),yield this.saveToolAssessment(l),l}catch(s){const i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"analyzeToolCondition",processing_time_ms:i,success:!1,error_message:s instanceof Error?s.message:"Unknown error",user_id:bt()||void 0}),console.error("Tool condition analysis failed:",s),{success:!1,condition:"good",wearLevel:"moderate",cleaningQuality:"good",damageDetected:!1,confidence:.5,recommendations:["Analysis failed - manual inspection recommended"],error:s instanceof Error?s.message:"Unknown error"}}})}detectBarcodeQuality(e,t){return Vn(this,null,function*(){this.analysisStartTime=Date.now();try{let r;e?r=yield J.callOpenAI("Provide general guidance on barcode quality assessment for medical instruments. Include best practices for barcode readability, common issues, and maintenance recommendations.",t||""):r=yield J.callOpenAI("Provide general guidance on barcode quality assessment for medical instruments. Include best practices for barcode readability, common issues, and maintenance recommendations.",t||"");const s=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectBarcodeQuality",processing_time_ms:s,success:!0,input_size_bytes:(e==null?void 0:e.size)||0,ai_model_used:"gpt-4",confidence_score:.9,user_id:bt()||void 0}),{success:!0,quality:J.parseBarcodeQualityFromAI(r),confidence:.9,recommendations:J.generateBarcodeRecommendations(r)}}catch(r){const s=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectBarcodeQuality",processing_time_ms:s,success:!1,error_message:r instanceof Error?r.message:"Unknown error",user_id:bt()||void 0}),console.error("Barcode quality detection failed:",r),{success:!1,quality:"fair",confidence:.5,recommendations:["Analysis failed - manual verification recommended"]}}})}identifyToolType(e,t){return Vn(this,null,function*(){this.analysisStartTime=Date.now();try{let r;return e?r=yield J.callOpenAI("Provide comprehensive guidance on medical instrument classification and sterilization requirements. Include common instrument types, categories, sterilization cycles, and best practices for healthcare facilities.",t||""):r=yield J.callOpenAI("Provide comprehensive guidance on medical instrument classification and sterilization requirements. Include common instrument types, categories, sterilization cycles, and best practices for healthcare facilities.",t||""),{success:!0,toolType:J.parseToolTypeFromAI(r),category:J.parseToolCategoryFromAI(r),confidence:.8,suggestions:J.generateToolSuggestions(r)}}catch(r){return console.error("Tool type identification failed:",r),{success:!1,confidence:.5,suggestions:["Identification failed - manual classification needed"]}}})}detectPotentialProblems(e,t,r){return Vn(this,null,function*(){this.analysisStartTime=Date.now();try{const s=yield J.callOpenAI(`Analyze tool data for potential problems: ${JSON.stringify(t)}. Identify risks and provide recommendations.`,r||""),i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectPotentialProblems",processing_time_ms:i,success:!0,ai_model_used:"gpt-4",confidence_score:.8,user_id:bt()||void 0}),{success:!0,problemsDetected:s.includes("problem")||s.includes("risk"),riskLevel:J.parseRiskLevel(s),issues:J.parseIssues(s),recommendations:J.generateRecommendations(s)}}catch(s){const i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectPotentialProblems",processing_time_ms:i,success:!1,error_message:s instanceof Error?s.message:"Unknown error",user_id:bt()||void 0}),console.error("Problem detection failed:",s),{success:!1,problemsDetected:!1,riskLevel:"low",issues:[],recommendations:["Analysis failed - manual inspection recommended"]}}})}saveToolAssessment(e){return Vn(this,null,function*(){try{const t={facility_id:this.facilityId,tool_id:e.toolId,cycle_id:null,condition_rating:e.condition,wear_level:e.wearLevel,cleaning_quality:e.cleaningQuality,damage_detected:e.damageDetected,damage_types:e.damageTypes||[],confidence_score:e.confidence,model_id:null,processing_time_ms:Date.now()-this.analysisStartTime,image_file_path:null,ai_insights:{recommendations:e.recommendations},created_by:bt()},{data:r,error:s}=yield _.from("sterilization_ai_tool_assessments").insert(t).select("id").single();return s?(console.error("Error saving tool assessment:",s),null):r.id}catch(t){return console.error("Error saving tool assessment:",t),null}})}}var Vs=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class tb{constructor(e){this.facilityId=e}getCycleOptimization(e,t){return Vs(this,null,function*(){try{const{data:r}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).eq("status","completed").order("created_at",{ascending:!1}).limit(100);if(!r||r.length===0)throw new Error("No historical cycle data available");const s=yield J.callOpenAI(`Analyze sterilization cycle data for optimization. Historical cycles: ${JSON.stringify(r)}. Provide efficiency improvements and parameter recommendations.`,t||""),i={cycleId:e,currentEfficiency:this.calculateCurrentEfficiency(r),predictedEfficiency:this.calculatePredictedEfficiency(r),optimizationSuggestions:J.parseOptimizationSuggestions(s),estimatedTimeSavings:this.calculateTimeSavings(),recommendedParameters:J.parseRecommendedParameters(s),confidence:.85};return yield this.saveCycleOptimization(i),i}catch(r){throw console.error("Cycle optimization failed:",r),new Error("Cycle optimization analysis failed")}})}getWorkflowSuggestion(e,t,r){return Vs(this,null,function*(){try{const{data:s}=yield _.from("tools").select("*").eq("id",e).eq("facility_id",this.facilityId).single();if(!s)throw new Error("Tool not found");const i=yield J.callOpenAI(`Recommend sterilization workflow for tool: ${JSON.stringify(s)}. History: ${JSON.stringify(t)}. Consider tool type, condition, and usage patterns.`,r||""),l={toolId:e,recommendedWorkflow:J.parseRecommendedWorkflow(i),confidence:this.calculateWorkflowConfidence(s,t),reasoning:J.parseWorkflowReasoning(),alternativeWorkflows:J.parseAlternativeWorkflows()};return yield this.saveWorkflowSuggestion(l),l}catch(s){throw console.error("Workflow suggestion failed:",s),new Error("Workflow suggestion failed")}})}calculateCurrentEfficiency(e){if(!e||e.length===0)return .75;const t=e.reduce((r,s)=>r+(s.duration_minutes||0),0)/e.length;return Math.max(.5,Math.min(1,1-(t-20)/100))}calculatePredictedEfficiency(e){const t=this.calculateCurrentEfficiency(e);return Math.min(1,t+.15)}calculateTimeSavings(){return Math.floor(Math.random()*15)+5}calculateWorkflowConfidence(e,t){let r=.5;return e.condition==="excellent"&&(r+=.2),t.usage_count<100&&(r+=.1),Math.min(r,.95)}saveCycleOptimization(e){return Vs(this,null,function*(){try{const t={facility_id:this.facilityId,cycle_id:e.cycleId,current_efficiency:e.currentEfficiency,predicted_efficiency:e.predictedEfficiency,estimated_time_savings:e.estimatedTimeSavings,recommended_parameters:e.recommendedParameters,confidence_score:e.confidence,model_id:null,processing_time_ms:0,optimization_factors:{},created_by:null};yield _.from("sterilization_ai_cycle_optimizations").insert(t)}catch(t){console.error("Error saving cycle optimization:",t)}})}saveWorkflowSuggestion(e){return Vs(this,null,function*(){try{const t={facility_id:this.facilityId,tool_id:e.toolId,recommended_workflow:e.recommendedWorkflow,confidence_score:e.confidence,reasoning:e.reasoning,alternative_workflows:e.alternativeWorkflows,model_id:null,processing_time_ms:0,tool_history_data:{},created_by:null};yield _.from("sterilization_ai_workflow_suggestions").insert(t)}catch(t){console.error("Error saving workflow suggestion:",t)}})}}var Qt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class rb{constructor(e){this.facilityId=e}getPredictiveAnalytics(e){return Qt(this,null,function*(){try{const{data:t}=yield _.from("autoclave_equipment").select("*").eq("facility_id",this.facilityId),{data:r}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).eq("status","completed").order("created_at",{ascending:!1}).limit(50),s=`
        Analyze sterilization data for predictive insights:
        Equipment: ${JSON.stringify(t)}
        Recent cycles: ${JSON.stringify(r)}
        
        Provide:
        1. Equipment maintenance predictions
        2. Cycle efficiency trends
        3. Quality metrics analysis
        4. Risk factors and recommendations
      `,i=yield J.callOpenAI(s,e||"");return this.parsePredictiveAnalytics(i,t)}catch(t){throw console.error("Predictive analytics failed:",t),new Error("Predictive analytics failed")}})}getRealTimeInsights(){return Qt(this,null,function*(){try{const{data:e}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).gte("created_at",new Date(Date.now()-864e5).toISOString()),t=[];if(e&&e.length>0){const s=yield this.analyzeCycleEfficiency(e);s&&t.push(s)}const{data:r}=yield _.from("autoclave_equipment").select("*").eq("facility_id",this.facilityId);if(r&&r.length>0){const s=yield this.analyzeEquipmentMaintenance(r);s&&t.push(s)}return t}catch(e){return console.error("Real-time insights failed:",e),[]}})}getHistoricalTrends(e){return Qt(this,null,function*(){try{const t=new Date,r=new Date;switch(e){case"week":r.setDate(t.getDate()-7);break;case"month":r.setMonth(t.getMonth()-1);break;case"quarter":r.setMonth(t.getMonth()-3);break;case"year":r.setFullYear(t.getFullYear()-1);break}const{data:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).gte("created_at",r.toISOString()).lte("created_at",t.toISOString()).order("created_at",{ascending:!0});if(!s||s.length===0)throw new Error("No historical data available");const i=this.calculateTrends(s),l=this.generateTrendInsights(i),c=this.generateTrendPredictions(i);return{success:!0,trends:i,insights:l,predictions:c}}catch(t){return console.error("Historical trends analysis failed:",t),{success:!1,trends:{efficiency:[],quality:[],duration:[],temperature:[]},insights:["Analysis failed"],predictions:["Unable to generate predictions"]}}})}parsePredictiveAnalytics(e,t){return{equipmentMaintenance:(t==null?void 0:t.map(r=>({equipmentId:r.id,nextMaintenanceDue:new Date(Date.now()+720*60*60*1e3).toISOString(),riskLevel:"medium",predictedIssues:["Calibration needed","Wear detection"]})))||[],cycleEfficiency:{trend:"improving",factors:["Optimized parameters","Better tool grouping"],recommendations:["Continue current practices","Monitor performance"]},qualityMetrics:{currentQuality:.94,predictedQuality:.96,riskFactors:["Temperature variations"],improvementActions:["Standardize procedures"]}}}analyzeCycleEfficiency(e){return Qt(this,null,function*(){try{const t=this.calculateCurrentEfficiency(e);return t<.8?{id:`efficiency-${Date.now()}`,type:"efficiency_improvement",title:"Cycle Efficiency Improvement Opportunity",description:`Current efficiency is ${(t*100).toFixed(1)}%. Optimization could improve this by 15-20%.`,confidence:.85,priority:"medium",actionable:!0,recommendations:["Review cycle parameters","Optimize tool grouping","Analyze temperature settings"],data:{currentEfficiency:t,potentialEfficiency:t+.15},created_at:new Date().toISOString(),facility_id:this.facilityId,severity:"medium",category:"efficiency",timestamp:new Date().toISOString()}:null}catch(t){return console.error("Cycle efficiency analysis failed:",t),null}})}analyzeEquipmentMaintenance(e){return Qt(this,null,function*(){try{const t=e.filter(r=>(new Date(r.last_maintenance).getTime()-Date.now())/(1e3*60*60*24)<=14);return t.length>0?{id:`maintenance-${Date.now()}`,type:"maintenance_prediction",title:"Equipment Maintenance Due Soon",description:`${t.length} piece(s) of equipment require maintenance within 2 weeks.`,confidence:.9,priority:"high",actionable:!0,recommendations:["Schedule maintenance","Review maintenance logs","Check calibration status"],data:{equipmentCount:t.length,daysUntilMaintenance:14},created_at:new Date().toISOString(),facility_id:this.facilityId,severity:"high",category:"maintenance",timestamp:new Date().toISOString()}:null}catch(t){return console.error("Equipment maintenance analysis failed:",t),null}})}calculateCurrentEfficiency(e){if(!e||e.length===0)return .75;const t=e.reduce((r,s)=>{var i;return r+((i=s.duration_minutes)!=null?i:0)},0)/e.length;return Math.max(.5,Math.min(1,1-(t-20)/100))}calculateTrends(e){const t=[],r=[],s=[],i=[];return e.forEach((l,c)=>{var o,d;t.push(.75+c*.02+Math.random()*.1),r.push(.9+c*.01+Math.random()*.05),s.push((o=l.duration_minutes)!=null?o:20),i.push((d=l.temperature)!=null?d:134)}),{efficiency:t,quality:r,duration:s,temperature:i}}generateTrendInsights(e){const t=[];if(e.efficiency.length>1){const r=e.efficiency[e.efficiency.length-1]-e.efficiency[0];r>.1&&t.push(`Efficiency has improved ${(r*100).toFixed(1)}% over the period`)}return e.quality.length>1&&e.quality.reduce((s,i)=>s+i,0)/e.quality.length>.95&&t.push("Quality metrics remain consistently high"),t}generateTrendPredictions(e){const t=[];if(e.efficiency.length>1){const r=e.efficiency[e.efficiency.length-1],s=Math.min(1,r+.05);t.push(`Efficiency expected to reach ${(s*100).toFixed(1)}% by end of quarter`)}return e.quality.length>1&&t.push("Quality metrics likely to maintain 96%+ levels"),t}exportAnalyticsReport(e,t,r){return Qt(this,null,function*(){try{const s=Date.now();let i={};switch(e){case"insights":i={insights:yield this.getRealTimeInsights()};break;case"predictive":i={predictive:yield this.getPredictiveAnalytics()};break;case"historical":i=yield this.getHistoricalTrends("month");break;case"comprehensive":{const[o,d,u]=yield Promise.all([this.getRealTimeInsights(),this.getPredictiveAnalytics(),this.getHistoricalTrends("month")]);i={insights:o,predictive:d,historical:u};break}}const l=yield this.formatReportData(i,t),{error:c}=yield _.from("sterilization_ai_exports").insert({facility_id:this.facilityId,report_type:e,export_format:t,date_range:r,processing_time_ms:Date.now()-s,exported_at:new Date().toISOString()});return c&&console.error("Error saving export record:",c),{success:!0,data:l,downloadUrl:yield this.generateDownloadUrl(l,t)}}catch(s){return console.error("Error exporting analytics report:",s),{success:!1,error:s instanceof Error?s.message:"Export failed"}}})}formatReportData(e,t){return Qt(this,null,function*(){switch(t){case"json":return JSON.stringify(e,null,2);case"csv":return this.convertToCSV(e);case"excel":return this.convertToExcel(e);case"pdf":return this.convertToPDF(e);default:return e}})}generateDownloadUrl(e,t){return Qt(this,null,function*(){const r=new Blob([JSON.stringify(e)],{type:this.getMimeType(t)});return URL.createObjectURL(r)})}getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"pdf":return"application/pdf";case"json":return"application/json";default:return"text/plain"}}convertToCSV(e){if(Array.isArray(e)){const t=Object.keys(e[0]||{}),r=[t.join(",")];for(const s of e){const i=t.map(l=>{var c;return JSON.stringify((c=s[l])!=null?c:"")});r.push(i.join(","))}return r.join(`
`)}return JSON.stringify(e)}convertToExcel(e){return e}convertToPDF(e){return e}}var Pc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class nb{constructor(e){this.facilityId=e}analyzeCompliance(e,t){return Pc(this,null,function*(){try{const{data:r}=yield _.from("sterilization_cycles").select("*").eq("id",e).single();if(!r)throw new Error("Cycle not found");const s=yield J.callOpenAI(`Analyze sterilization cycle for compliance: ${JSON.stringify(r)}. Check for regulatory requirements and audit recommendations.`,t||"");return{cycleId:e,complianceScore:J.parseComplianceScore(s),riskFactors:J.parseRiskFactors(s),requiredActions:J.parseRequiredActions(s),auditRecommendations:J.parseAuditRecommendations(s),regulatoryUpdates:this.parseRegulatoryUpdates()}}catch(r){throw console.error("Compliance analysis failed:",r),new Error("Compliance analysis failed")}})}validateBiologicalIndicators(e,t){return Pc(this,null,function*(){try{const r=yield J.callOpenAI(`Analyze biological indicator data: ${JSON.stringify(e)}. Determine if sterilization conditions were properly achieved.`,t||"");return{valid:J.parseBIValidation(r),confidence:.95,recommendations:["Continue current sterilization parameters","Monitor for any trend changes","Schedule next validation per protocol"]}}catch(r){return console.error("BI validation failed:",r),{valid:!1,confidence:.5,recommendations:["Manual validation required"]}}})}parseRegulatoryUpdates(){return["New FDA guidelines effective Q1 2025","Updated AAMI standards for autoclave validation"]}}var Se=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class sb{constructor(e){this.facilityId=e,this.settingsManager=new Hx(e),this.analysisServices=new eb(e),this.optimizationServices=new tb(e),this.analyticsServices=new rb(e),this.complianceServices=new nb(e)}initialize(){return Se(this,null,function*(){try{return(yield this.settingsManager.loadSettings())!==null}catch(e){return console.error("Failed to initialize SterilizationAIService:",e),!1}})}loadSettings(){return Se(this,null,function*(){return this.settingsManager.loadSettings()})}saveSettings(e){return Se(this,null,function*(){return this.settingsManager.saveSettings(e)})}analyzeToolCondition(e,t){return Se(this,null,function*(){if(!this.settingsManager.isToolConditionAssessmentEnabled())throw new Error("Tool condition assessment is not enabled");const r=this.settingsManager.getOpenAIKey();return this.analysisServices.analyzeToolCondition(e,t,r)})}detectBarcodeQuality(e){return Se(this,null,function*(){if(!this.settingsManager.isBarcodeQualityDetectionEnabled())throw new Error("Barcode quality detection is not enabled");const t=this.settingsManager.getOpenAIKey();return this.analysisServices.detectBarcodeQuality(e,t)})}identifyToolType(e){return Se(this,null,function*(){if(!this.settingsManager.isToolTypeRecognitionEnabled())throw new Error("Tool type recognition is not enabled");const t=this.settingsManager.getOpenAIKey();return this.analysisServices.identifyToolType(e,t)})}getCycleOptimization(e){return Se(this,null,function*(){if(!this.settingsManager.isCycleOptimizationEnabled())throw new Error("Cycle optimization is not enabled");const t=this.settingsManager.getOpenAIKey();return this.optimizationServices.getCycleOptimization(e,t)})}getWorkflowSuggestion(e,t){return Se(this,null,function*(){if(!this.settingsManager.isIntelligentWorkflowSelectionEnabled())throw new Error("Intelligent workflow selection is not enabled");const r=this.settingsManager.getOpenAIKey();return this.optimizationServices.getWorkflowSuggestion(e,t,r)})}getPredictiveAnalytics(){return Se(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Predictive analytics is not enabled");const e=this.settingsManager.getOpenAIKey();return this.analyticsServices.getPredictiveAnalytics(e)})}getRealTimeInsights(){return Se(this,null,function*(){if(!this.settingsManager.isRealTimeMonitoringEnabled())throw new Error("Real-time monitoring is not enabled");return this.analyticsServices.getRealTimeInsights()})}getHistoricalTrends(e){return Se(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Predictive analytics is not enabled");return this.analyticsServices.getHistoricalTrends(e)})}exportAnalyticsReport(e,t,r){return Se(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Analytics export is not enabled");return this.analyticsServices.exportAnalyticsReport(e,t,r)})}detectPotentialProblems(e,t){return Se(this,null,function*(){if(!this.settingsManager.isAutomatedProblemDetectionEnabled())throw new Error("Automated problem detection is not enabled");const r=this.settingsManager.getOpenAIKey();return this.analysisServices.detectPotentialProblems(e,t,r)})}analyzeCompliance(e){return Se(this,null,function*(){if(!this.settingsManager.isComplianceMonitoringEnabled())throw new Error("Compliance monitoring is not enabled");const t=this.settingsManager.getOpenAIKey();return this.complianceServices.analyzeCompliance(e,t)})}validateBiologicalIndicators(e){return Se(this,null,function*(){if(!this.settingsManager.isBiologicalIndicatorAnalysisEnabled())throw new Error("Biological indicator analysis is not enabled");const t=this.settingsManager.getOpenAIKey();return this.complianceServices.validateBiologicalIndicators(e,t)})}testChatGPT4Connection(){return Se(this,null,function*(){const e=this.settingsManager.getOpenAIKey();return e?J.testConnection(e):{success:!1,response:"",error:"OpenAI API key not configured"}})}isFeatureEnabled(e){return this.settingsManager.isFeatureEnabled(e)}getCurrentSettings(){return this.settingsManager.getCurrentSettings()}getConfidenceThreshold(){return this.settingsManager.getConfidenceThreshold()}getDataRetentionDays(){return this.settingsManager.getDataRetentionDays()}}var Ws={},yt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ab{constructor(e){this.facilityId=e}processPredictiveCleaningWithAI(){return yt(this,null,function*(){return{predicted_cleaning_date:new Date(Date.now()+2880*60*1e3).toISOString(),confidence_score:.85,urgency_level:"medium",cleaning_type:"routine",estimated_duration:45,required_resources:["cleaning_supplies","staff_2","equipment_standard"],risk_factors:["high_traffic_area","recent_contamination"],optimization_suggestions:["Schedule during low-traffic hours","Use eco-friendly cleaning products","Implement double-cleaning for high-risk areas"]}})}processContaminationPredictionWithAI(){return yt(this,null,function*(){return{contamination_probability:.25,predicted_contamination_type:"bacterial",risk_factors:["high_occupancy","inadequate_ventilation","recent_illness"],prevention_measures:["Increase cleaning frequency","Improve ventilation","Implement additional disinfection protocols"],early_warning_signs:["Increased moisture levels","Unusual odors","Staff illness reports"],confidence_score:.78}})}processResourceOptimizationWithAI(){return yt(this,null,function*(){return{current_usage:{cleaning_supplies:100,staff_hours:40,equipment_usage:8,water_usage:200,energy_consumption:150},optimized_usage:{cleaning_supplies:85,staff_hours:35,equipment_usage:7,water_usage:180,energy_consumption:135},savings_percentage:15,cost_savings:2500,efficiency_improvement:20,recommended_actions:["Implement smart scheduling to reduce staff hours","Use concentrated cleaning products to reduce supply usage","Optimize equipment usage patterns","Install water-efficient cleaning systems"],implementation_timeline:"2-4 weeks",risk_assessment:"low",confidence_score:.82}})}processSmartSchedulingWithAI(){return yt(this,null,function*(){return{optimal_cleaning_time:"2024-09-04T14:00:00Z",staff_recommendations:["experienced_cleaner_1","trainee_cleaner_2"],resource_requirements:["standard_cleaning_kit","disinfection_spray","mop_bucket"],conflict_avoidance:["Avoid patient visiting hours","Schedule around maintenance windows","Coordinate with other departments"],efficiency_score:.88,cost_optimization:.75,quality_assurance:["Pre-cleaning inspection","Post-cleaning verification","Quality checklist completion"],confidence_score:.85}})}processRiskAssessmentWithAI(){return yt(this,null,function*(){return{overall_risk_score:.35,risk_categories:{contamination:.4,compliance:.2,safety:.3,efficiency:.5},risk_factors:["High-traffic areas with increased contamination risk","Aging equipment requiring maintenance","Staff training gaps in new protocols","Inconsistent cleaning schedules"],mitigation_strategies:["Implement enhanced cleaning protocols for high-risk areas","Schedule preventive maintenance for aging equipment","Provide additional staff training on new protocols","Standardize cleaning schedules across all areas"],priority_actions:["Immediate: Schedule equipment maintenance","Short-term: Implement enhanced cleaning protocols","Medium-term: Comprehensive staff training program"],confidence_score:.79}})}processTrendAnalysisWithAI(){return yt(this,null,function*(){return{analysis_type:"cleaning_efficiency",trend_direction:"improving",trend_strength:.7,key_insights:["Cleaning efficiency has improved 15% over the past quarter","Resource usage optimization is showing positive results","Quality scores are consistently above target thresholds"],contributing_factors:["Implementation of new cleaning protocols","Staff training improvements","Better scheduling optimization","Upgraded cleaning equipment"],recommendations:["Continue current optimization strategies","Expand successful protocols to other areas","Monitor for potential plateau effects","Consider additional technology investments"],confidence_score:.84}})}processAnomalyDetectionWithAI(){return yt(this,null,function*(){return{anomaly_type:"resource_spike",severity:"medium",description:"Unusual increase in cleaning supply usage detected in Room 204",detected_at:new Date().toISOString(),normal_range:{daily_usage:"10-15 units",weekly_usage:"70-105 units"},actual_value:{daily_usage:"25 units",weekly_usage:"175 units"},potential_causes:["Increased contamination requiring additional cleaning","Equipment malfunction causing waste","Staff training issue with proper usage","Room usage pattern changes"],recommended_actions:["Investigate room conditions and usage patterns","Check equipment functionality","Review staff training records","Implement usage monitoring for this area"],confidence_score:.76}})}processQualityAssuranceWithAI(){return yt(this,null,function*(){return{quality_score:.87,quality_metrics:{cleanliness:.92,compliance:.85,efficiency:.88,safety:.9},quality_trends:{cleanliness_trend:"improving",compliance_trend:"stable",efficiency_trend:"improving",safety_trend:"stable"},improvement_areas:["Documentation completeness","Staff training consistency","Equipment maintenance scheduling"],best_practices:["Standardized cleaning protocols","Regular quality inspections","Staff feedback integration","Continuous improvement processes"],compliance_status:"compliant",audit_recommendations:["Maintain current quality standards","Focus on documentation improvements","Schedule regular compliance reviews","Implement additional quality checkpoints"],confidence_score:.83}})}buildPredictiveCleaningPrompt(e,t){return`Analyze the following room and historical cleaning data:
    Room Data: ${e}
    Historical Data: ${t}
    
    Please provide:
    1. Predicted optimal cleaning date
    2. Confidence score for prediction
    3. Urgency level assessment
    4. Recommended cleaning type
    5. Estimated duration
    6. Required resources
    7. Risk factors to consider
    8. Optimization suggestions`}buildContaminationPredictionPrompt(e,t){return`Analyze contamination risk based on:
    Room Data: ${e}
    Environmental Data: ${t}
    
    Please provide:
    1. Contamination probability score
    2. Predicted contamination type
    3. Risk factors identified
    4. Prevention measures
    5. Early warning signs to monitor
    6. Confidence score for prediction`}buildResourceOptimizationPrompt(e,t){return`Optimize resource usage based on:
    Current Usage: ${e}
    Cost Data: ${t}
    
    Please provide:
    1. Current vs optimized usage comparison
    2. Savings percentage and cost reduction
    3. Efficiency improvement metrics
    4. Recommended actions
    5. Implementation timeline
    6. Risk assessment
    7. Confidence score for optimization`}buildSmartSchedulingPrompt(e,t,r){return`Create optimal cleaning schedule based on:
    Room Data: ${e}
    Staff Availability: ${t}
    Constraints: ${r}
    
    Please provide:
    1. Optimal cleaning time
    2. Staff recommendations
    3. Resource requirements
    4. Conflict avoidance strategies
    5. Efficiency and cost optimization scores
    6. Quality assurance measures
    7. Confidence score for scheduling`}executeWithRetry(e,t=3,r=100){return yt(this,null,function*(){const{OptimizedRetryService:s}=yield L(()=>Promise.resolve().then(()=>vp),void 0);return yield s.executeWithRetry(e,{maxRetries:t,baseDelay:r,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return yt(this,null,function*(){const r=new Promise((s,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,r])})}selectModelForTask(e){switch(e){case"predictive_cleaning":return"gpt-4";case"contamination_prediction":return"gpt-4";case"resource_optimization":return"gpt-4";case"smart_scheduling":return"gpt-4";case"risk_assessment":return"gpt-4";case"trend_analysis":return"gpt-4";case"anomaly_detection":return"gpt-4";case"quality_assurance":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:Ws.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:Ws.GOOGLE_AI_API_BASE_URL||"https://generativelanguage.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro"},azure:{baseUrl:Ws.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:Ws.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}}var ui=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ib{constructor(e){this.facilityId=e}getEnvironmentalInsights(){return ui(this,null,function*(){try{return[]}catch(e){return console.error("Error getting environmental insights:",e),[]}})}getHistoricalCleaningData(){return ui(this,null,function*(){try{const{data:e}=yield _.from("environmental_cleans_enhanced").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(30);return e?e.map(t=>({date:t.created_at,room_id:t.room_id,cleaning_type:t.session_type||"routine",duration:this.calculateDuration(t.created_at,t.created_at),quality_score:t.cleaning_quality_score||.8,resources_used:{cleaning_supplies:5,staff_hours:1,equipment_usage:1,water_usage:20,energy_consumption:10}})):[]}catch(e){return console.error("Error getting historical cleaning data:",e),[]}})}calculateDuration(e,t){if(!e||!t)return 30;const r=new Date(e),i=new Date(t).getTime()-r.getTime();return Math.max(Math.floor(i/(1e3*60)),1)}getEnvironmentalCleaningCostData(){return ui(this,null,function*(){try{return{staff_costs:12e3,supply_costs:3e3,equipment_costs:2e3,utility_costs:1500,total_cost:18500}}catch(e){return console.error("Error getting environmental cleaning cost data:",e),{staff_costs:12e3,supply_costs:3e3,equipment_costs:2e3,utility_costs:1500,total_cost:18500}}})}calculateCleaningEfficiency(e,t,r){const s=this.calculateResourceUsageFactor(r),i=e/(t*s);return Math.min(i,1)}calculateResourceUsageFactor(e){const t=e.staff_hours||1,r=e.cleaning_supplies||1,s=e.equipment_usage||1;return(t*.4+r*.3+s*.3)/10}calculateContaminationRisk(e,t,r,s){const i=(Date.now()-new Date(r).getTime())/864e5;let l=.1;l+={operating_room:.3,icu:.25,patient_room:.15,common_area:.1,storage:.05}[e]||.1,l+=t*.2,i>7?l+=.3:i>3&&(l+=.15);const o=s.humidity||50,d=s.temperature||20;return o>70&&(l+=.1),d>25&&(l+=.05),Math.min(l,1)}calculateCostSavings(e,t){const r=e-t,s=r/e*100;return{savings:r,percentage:s}}calculateQualityTrend(e){if(e.length<2)return"stable";const t=e.slice(0,Math.ceil(e.length/2)),r=e.slice(Math.ceil(e.length/2)),s=t.reduce((c,o)=>c+o,0)/t.length,i=r.reduce((c,o)=>c+o,0)/r.length,l=s-i;return l>.05?"improving":l<-.05?"declining":"stable"}calculateResourceEfficiency(e,t){const r=Object.values(e).reduce((i,l)=>i+l,0),s=Object.values(t).reduce((i,l)=>i+l,0);return r===0?0:(r-s)/r*100}detectAnomalies(e,t=2){if(e.length<3)return[];const r=e.reduce((l,c)=>l+c,0)/e.length,s=e.reduce((l,c)=>l+Math.pow(c-r,2),0)/e.length,i=Math.sqrt(s);return e.map((l,c)=>({index:c,value:l,deviation:Math.abs(l-r)/i})).filter(l=>l.deviation>t)}getPriorityFromUrgency(e){switch(e){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low";default:return"medium"}}getPriorityFromProbability(e){return e>=.8?"critical":e>=.6?"high":e>=.4?"medium":"low"}getPriorityFromSavings(e){return e>=30?"critical":e>=20?"high":e>=10?"medium":"low"}getPriorityFromSeverity(e){switch(e){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low";default:return"medium"}}}var Oe=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ob{constructor(e){this.facilityId=e,this.providerService=new ab(e),this.analyticsService=new ib(e)}initialize(){return Oe(this,null,function*(){try{return(yield this.loadSettings())!==null}catch(e){return console.error(e),console.error("Failed to initialize EnvironmentalAIService"),!1}})}loadSettings(){return Oe(this,null,function*(){return null})}saveSettings(e){return Oe(this,null,function*(){return!1})}initializeSettings(){return Oe(this,null,function*(){return!1})}generatePredictiveCleaning(e){return Oe(this,null,function*(){return null})}predictContamination(e){return Oe(this,null,function*(){return null})}optimizeResources(e){return Oe(this,null,function*(){return null})}generateSmartSchedule(e){return Oe(this,null,function*(){return null})}assessRisk(e){return Oe(this,null,function*(){return null})}analyzeTrends(e){return Oe(this,null,function*(){return null})}detectAnomalies(e){return Oe(this,null,function*(){return null})}assessQuality(e){return Oe(this,null,function*(){return null})}getEnvironmentalInsights(){return Oe(this,null,function*(){return this.analyticsService.getEnvironmentalInsights()})}getHistoricalCleaningData(){return Oe(this,null,function*(){try{const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(100);return t?(console.error("Error getting historical cleaning data:",t),[]):(e==null?void 0:e.map(s=>({id:s.id,facility_id:s.facility_id,room_id:s.room_id,room_name:s.room_name,cleaning_type:s.cleaning_type,status:s.status,started_time:s.started_time,completed_time:s.completed_time,created_at:s.created_at,updated_at:s.updated_at})))||[]}catch(e){return console.error("Error getting historical cleaning data:",e),[]}})}getRoomData(e){return Oe(this,null,function*(){var t,r,s,i,l,c,o,d;try{const{data:u,error:m}=yield _.from("environmental_cleans_enhanced").select("*").eq("id",e).eq("facility_id",this.facilityId).single();if(m)return console.error("Error getting room data:",m),null;const p=u;return{id:p.id,room_id:p.id,room_name:(t=p.room_name)!=null?t:"Unknown Room",room_type:(r=p.room_type)!=null?r:"unknown",last_cleaned:(s=p.last_cleaned)!=null?s:new Date().toISOString(),cleaning_frequency:(i=p.cleaning_frequency)!=null?i:1,priority_level:(l=p.priority_level)!=null?l:"medium",contamination_risk:(c=p.contamination_risk)!=null?c:.5,usage_pattern:(o=p.usage_pattern)!=null?o:{},maintenance_status:(d=p.maintenance_status)!=null?d:"good"}}catch(u){return console.error("Error getting room data:",u),null}})}isFeatureEnabled(e,t){return this.getNestedProperty(e,t)===!0}getNestedProperty(e,t){return t.split(".").reduce((r,s)=>r==null?void 0:r[s],e)}}var Ce=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Ns{static askAI(e,t){return Ce(this,null,function*(){return Hh({prompt:e,context:t})})}static executeOptimizedAI(e,t,r){return Ce(this,null,function*(){return Dr.getInstance().execute(e,t,r)})}static getLearningAI(e){return this.learningAIInstance||(this.learningAIInstance=new lx(e)),this.learningAIInstance}static getLearningRecommendations(e,t){return Ce(this,null,function*(){return this.getLearningAI(e).generatePersonalizedRecommendations(t)})}static analyzeSkillGaps(e,t){return Ce(this,null,function*(){return this.getLearningAI(e).analyzeSkillGaps(t)})}static optimizeLearningPath(e,t){return Ce(this,null,function*(){return this.getLearningAI(e).optimizeLearningPath(t)})}static getInventoryAI(e){return this.inventoryAIInstance||(this.inventoryAIInstance=new Ux(e)),this.inventoryAIInstance}static analyzeBarcode(e,t){return Ce(this,null,function*(){return this.getInventoryAI(e).analyzeBarcode(t)})}static performImageRecognition(e,t){return Ce(this,null,function*(){return this.getInventoryAI(e).analyzeImage(t)})}static generateDemandForecast(e,t,r){return Ce(this,null,function*(){return this.getInventoryAI(e).generateDemandForecast(t,r)})}static generateCostOptimization(e,t){return Ce(this,null,function*(){return this.getInventoryAI(e).generateCostOptimization(t)})}static getSterilizationAI(e){return this.sterilizationAIInstance||(this.sterilizationAIInstance=new sb(e)),this.sterilizationAIInstance}static getSterilizationInsights(e){return Ce(this,null,function*(){return this.getSterilizationAI(e).getRealTimeInsights()})}static getSterilizationPredictiveAnalytics(e){return Ce(this,null,function*(){return this.getSterilizationAI(e).getPredictiveAnalytics()})}static getSterilizationRealTimeInsights(e){return Ce(this,null,function*(){return this.getSterilizationAI(e).getRealTimeInsights()})}static getSterilizationHistoricalTrends(e,t){return Ce(this,null,function*(){return this.getSterilizationAI(e).getHistoricalTrends(t)})}static getEnvironmentalAI(e){return this.environmentalAIInstance||(this.environmentalAIInstance=new ob(e)),this.environmentalAIInstance}static analyzeEnvironmentalData(e,t){return Ce(this,null,function*(){return this.getEnvironmentalAI(e).generatePredictiveCleaning(t)})}static generateEnvironmentalInsights(e){return Ce(this,null,function*(){return this.getEnvironmentalAI(e).getEnvironmentalInsights()})}static initializeServices(e){return Ce(this,null,function*(){try{yield this.getLearningAI(e).initialize(),yield this.getInventoryAI(e).initializeSettings(),yield this.getEnvironmentalAI(e).initialize(),console.log(`[UnifiedAIService] All AI services initialized for facility: ${e}`)}catch(t){throw console.error("[UnifiedAIService] Failed to initialize AI services:",t),t}})}static getServiceStatus(){return{learningAI:!!this.learningAIInstance,inventoryAI:!!this.inventoryAIInstance,sterilizationAI:!!this.sterilizationAIInstance,environmentalAI:!!this.environmentalAIInstance}}static clearInstances(){this.learningAIInstance=null,this.inventoryAIInstance=null,this.sterilizationAIInstance=null,this.environmentalAIInstance=null}}Ns.learningAIInstance=null;Ns.inventoryAIInstance=null;Ns.sterilizationAIInstance=null;Ns.environmentalAIInstance=null;var lb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const cb=({currentContext:n,onBack:e})=>{const[t,r]=h.useState([{role:"assistant",content:"Hello! I'm your Cliniio AI assistant. How can I help you today?"}]),[s,i]=h.useState(""),[l,c]=h.useState(!1),o=()=>lb(null,null,function*(){if(!s.trim()||l)return;const u=s.trim();i(""),r(m=>[...m,{role:"user",content:u}]),c(!0);try{const m=yield Ns.askAI(u,`User is on ${n} page and asking for help. Only answer questions related to ${n}.`);r(p=>[...p,{role:"assistant",content:m}])}catch(m){console.error(m),r(p=>[...p,{role:"assistant",content:"Sorry, I encountered an error. Please try again."}])}finally{c(!1)}}),d=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),o())};return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"AI Assistant"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Ask me anything about Cliniio"})]})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 scrollbar-hide",children:[t.map((u,m)=>a.jsx("div",{className:`flex ${u.role==="user"?"justify-end":"justify-start"}`,children:a.jsx("div",{className:`max-w-xs px-4 py-2 rounded-lg ${u.role==="user"?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-800"}`,children:a.jsx("p",{className:"text-sm",children:u.content})})},m)),l&&a.jsx("div",{className:"flex justify-start",children:a.jsx("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),a.jsx("div",{className:"border-t border-gray-200 p-4 bg-white",children:a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("input",{type:"text",value:s,onChange:u=>i(u.target.value),onKeyPress:d,placeholder:"Ask me anything...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",disabled:l}),a.jsx("button",{onClick:o,disabled:!s.trim()||l,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx("span",{className:"text-sm",children:"Send"})})]})})]})};var Wn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class db{getArticlesByCategory(e){return Wn(this,null,function*(){try{const{data:t,error:r}=yield _.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count, is_published").eq("category",e).eq("is_published",!0).order("priority",{ascending:!0}).order("created_at",{ascending:!1});return r?(console.error("Error fetching help articles:",r),[]):t||[]}catch(t){return console.error("Error fetching help articles:",t),[]}})}getArticleBySlug(e){return Wn(this,null,function*(){try{const{data:t,error:r}=yield _.from("help_articles").select("*").eq("slug",e).eq("is_published",!0).single();return r?(console.error("Error fetching help article:",r),null):t}catch(t){return console.error("Error fetching help article:",t),null}})}incrementViewCount(e){return Wn(this,null,function*(){try{const{data:t}=yield _.from("help_articles").select("view_count").eq("slug",e).single();t&&(yield _.from("help_articles").update({view_count:t.view_count+1,last_viewed_at:new Date().toISOString()}).eq("slug",e))}catch(t){console.error("Error incrementing view count:",t)}})}getFeaturedArticles(e=3){return Wn(this,null,function*(){try{const{data:t,error:r}=yield _.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count, is_published").eq("is_published",!0).eq("is_featured",!0).order("priority",{ascending:!0}).order("view_count",{ascending:!1}).limit(e);return r?(console.error("Error fetching featured articles:",r),[]):t||[]}catch(t){return console.error("Error fetching featured articles:",t),[]}})}searchArticles(e,t){return Wn(this,null,function*(){try{let r=_.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count, is_published").eq("is_published",!0).or(`title.ilike.%${e}%,excerpt.ilike.%${e}%`);t&&(r=r.eq("category",t));const{data:s,error:i}=yield r.order("priority",{ascending:!0}).order("view_count",{ascending:!1});return i?(console.error("Error searching help articles:",i),[]):s||[]}catch(r){return console.error("Error searching help articles:",r),[]}})}}const Fa=new db;var ub=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const mb=({currentContext:n,expandedRelevant:e,onToggleRelevantSection:t,onBack:r})=>{const[s,i]=h.useState([]),[l,c]=h.useState(!0);h.useEffect(()=>{ub(null,null,function*(){try{console.log("🔍 Loading relevant information articles...");const p=yield Fa.getArticlesByCategory("relevant-information");console.log("📋 Found articles:",p),i(p)}catch(p){console.error("Error loading relevant information articles:",p)}finally{c(!1)}})},[]);const o=m=>{window.open(`/help/article/${m}`,"_blank")},d=[{id:"canadian-standards",title:"🇨🇦 Canadian Standards",color:"blue",content:a.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[a.jsx("li",{children:"• CSA Z314.2-19 - Decontamination of Reusable Medical Devices"}),a.jsx("li",{children:"• CSA Z314.3-19 - Steam Sterilization in Health Care Facilities"}),a.jsx("li",{children:"• Health Canada SOR/98-282 - Medical Device Regulations"}),a.jsx("li",{children:"• Public Health Agency of Canada - Routine Practices and Additional Precautions"}),a.jsx("li",{children:"• Ontario Health - Infection Prevention and Control Guidelines"}),a.jsx("li",{children:"• BC Centre for Disease Control - Healthcare-Associated Infection Prevention"}),a.jsx("li",{children:"• Alberta Health Services - Sterilization and Reprocessing Standards"}),a.jsx("li",{children:"• Quebec Health - Hygiene Practices in Healthcare Facilities"})]})},{id:"us-standards",title:"🇺🇸 US Standards",color:"green",content:a.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[a.jsx("li",{children:"• AAMI ST79:2017 - Comprehensive Guide to Steam Sterilization"}),a.jsx("li",{children:"• AAMI ST91:2021 - Flexible Endoscope Reprocessing"}),a.jsx("li",{children:"• CDC Guidelines - Disinfection and Sterilization in Healthcare Facilities"}),a.jsx("li",{children:"• FDA Regulations - Medical Device Reprocessing Standards"}),a.jsx("li",{children:"• Joint Commission - Healthcare Accreditation Standards"}),a.jsx("li",{children:"• OSHA Guidelines - Workplace Safety and Chemical Handling"}),a.jsx("li",{children:"• ANSI/AAMI Standards - Sterilization Validation and Monitoring"})]})},{id:"international-standards",title:"🌍 International Standards",color:"purple",content:a.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[a.jsx("li",{children:"• ISO 15883 - Washer-disinfectors"}),a.jsx("li",{children:"• ISO 17665 - Steam sterilization"}),a.jsx("li",{children:"• ISO 13485 - Medical Device Quality Management"}),a.jsx("li",{children:"• ISO 9001 - Quality Management Systems"}),a.jsx("li",{children:"• WHO Guidelines - Infection Prevention and Control"}),a.jsx("li",{children:"• ASTM Standards - Material Testing and Validation"}),a.jsx("li",{children:"• IAC Standards - Infection Prevention and Control"}),a.jsx("li",{children:"• APIC Guidelines - Healthcare-Associated Infection Prevention"})]})}],u=m=>{const p=e.has(m.id),g={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[m.color];return a.jsxs("div",{className:`${g.bg} ${g.border} border rounded-lg overflow-hidden`,children:[a.jsxs("button",{onClick:()=>t(m.id),className:`w-full p-3 text-left flex items-center justify-between ${g.hover} transition-colors`,children:[a.jsx("h5",{className:`font-medium ${g.text}`,children:m.title}),a.jsx("span",{className:`${g.icon} text-lg transition-transform duration-200`,children:p?"−":"+"})]}),p&&a.jsxs("div",{className:"px-3 pb-3",children:[m.content,m.slug&&a.jsx("div",{className:"mt-3",children:a.jsxs("button",{onClick:()=>o(m.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[a.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},m.id)};if(n==="home"||n==="general"){if(l)return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=s.length>0?s.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:a.jsx("div",{className:"space-y-2",children:a.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about standards and compliance.'})})})):d;return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),a.jsx("p",{className:"text-xs text-gray-500",children:s.length>0?`${s.length} help articles available`:"Standards and compliance reference"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:s.length>0?"Help Articles":"Comprehensive Standards Reference"}),m.map(u)]})})]})}return n==="sterilization"?a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"BI Testing"}),a.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[a.jsx("li",{children:"• Biological indicator testing protocols"}),a.jsx("li",{children:"• Testing frequency requirements"}),a.jsx("li",{children:"• Result interpretation and documentation"}),a.jsx("li",{children:"• Quality assurance procedures"})]})]}),a.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Sterilization Workflow"}),a.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[a.jsx("li",{children:"• Pre-cleaning and inspection protocols"}),a.jsx("li",{children:"• Proper packaging and loading techniques"}),a.jsx("li",{children:"• Sterilization cycle parameters"}),a.jsx("li",{children:"• Post-sterilization handling procedures"})]})]}),a.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Reporting and Compliance"}),a.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[a.jsx("li",{children:"• Documentation requirements"}),a.jsx("li",{children:"• Regulatory compliance standards"}),a.jsx("li",{children:"• Audit preparation and procedures"}),a.jsx("li",{children:"• Quality management systems"})]})]})]})]}):a.jsx("div",{className:"text-center text-gray-500 py-8",children:a.jsx("p",{children:"General information and standards will be displayed here based on your current page."})})};var Dc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const hb={submitFeedback(n){return Dc(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return{success:!1,error:"User not authenticated"};const{error:t}=yield _.from("product_feedback").insert([{type:n.type,title:n.title,description:n.description,priority:n.priority,user_id:e.id,contact_email:n.email,page_url:window.location.href,user_agent:navigator.userAgent,browser_info:{language:navigator.language,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled}}]);return t?(console.error("Error submitting feedback:",t),{success:!1,error:t.message}):{success:!0}}catch(e){return console.error("Error submitting feedback:",e),{success:!1,error:e instanceof Error?e.message:"An unknown error occurred"}}})},getFeedbackHistory(){return Dc(this,null,function*(){try{const{data:{user:n}}=yield _.auth.getUser();if(!n)return{data:[],error:"User not authenticated"};const{data:e,error:t}=yield _.from("product_feedback").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});return t?(console.error("Error fetching feedback history:",t),{data:[],error:t.message}):{data:e||[]}}catch(n){return console.error("Error fetching feedback history:",n),{data:[],error:"Failed to fetch feedback history"}}})}};var pb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const fb=()=>{const[n,e]=h.useState(""),[t,r]=h.useState(""),[s,i]=h.useState(""),[l,c]=h.useState("medium"),[o,d]=h.useState(""),[u,m]=h.useState(!1);return{feedbackType:n,setFeedbackType:e,feedbackTitle:t,setFeedbackTitle:r,feedbackDescription:s,setFeedbackDescription:i,feedbackPriority:l,setFeedbackPriority:c,feedbackEmail:o,setFeedbackEmail:d,isSubmittingFeedback:u,handleFeedbackSubmit:g=>pb(null,null,function*(){g.preventDefault(),m(!0);try{const y={type:n,title:t,description:s,priority:l,email:o},v=yield hb.submitFeedback(y);return v.success?(e(""),r(""),i(""),c("medium"),d(""),alert("Thank you for your feedback! We'll review it and get back to you if needed."),!0):(console.error("Error submitting feedback:",v.error),alert("There was an error submitting your feedback. Please try again."),!1)}catch(y){return console.error("Error submitting feedback:",y),alert("There was an error submitting your feedback. Please try again."),!1}finally{m(!1)}}),resetFeedbackForm:()=>{e(""),r(""),i(""),c("medium"),d("")}}};var gb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const yb=({onBack:n,onSuccess:e})=>{const{feedbackType:t,setFeedbackType:r,feedbackTitle:s,setFeedbackTitle:i,feedbackDescription:l,setFeedbackDescription:c,feedbackPriority:o,setFeedbackPriority:d,feedbackEmail:u,setFeedbackEmail:m,isSubmittingFeedback:p,handleFeedbackSubmit:f}=fb(),g=y=>gb(null,null,function*(){(yield f(y))&&e()});return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Product Feedback"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Help us improve Cliniio"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:a.jsx("span",{className:"text-white text-2xl",children:"💡"})}),a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Share Your Feedback"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Help us make Cliniio better for everyone"})]}),a.jsxs("form",{onSubmit:g,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"feedbackType",className:"block text-sm font-medium text-gray-700 mb-2",children:"Feedback Type *"}),a.jsxs("select",{id:"feedbackType",value:t,onChange:y=>r(y.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0,children:[a.jsx("option",{value:"",children:"Select feedback type"}),a.jsx("option",{value:"bug",children:"Bug Report"}),a.jsx("option",{value:"feature",children:"Feature Request"}),a.jsx("option",{value:"improvement",children:"Improvement Suggestion"}),a.jsx("option",{value:"other",children:"Other"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"feedbackTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),a.jsx("input",{id:"feedbackTitle",type:"text",value:s,onChange:y=>i(y.target.value),placeholder:"Brief description of your feedback",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"feedbackDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),a.jsx("textarea",{id:"feedbackDescription",value:l,onChange:y=>c(y.target.value),placeholder:"Please provide detailed information...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"feedbackPriority",className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),a.jsxs("select",{id:"feedbackPriority",value:o,onChange:y=>d(y.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"}),a.jsx("option",{value:"critical",children:"Critical"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"feedbackEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email (optional)"}),a.jsx("input",{id:"feedbackEmail",type:"email",value:u,onChange:y=>m(y.target.value),placeholder:"your.email@facility.com",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"We'll only use this to follow up on your feedback"})]}),a.jsx("button",{type:"submit",disabled:p,className:"w-full bg-[#4ECDC4] text-white py-3 px-4 rounded-lg hover:bg-[#4ECDC4]/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:p?"Submitting...":"Submit Feedback"})]})]})})]})},vb=({onBack:n})=>{const[e,t]=h.useState(new Set([0])),[r,s]=h.useState(null),i=c=>{t(o=>{const d=new Set(o);return d.has(c)?(d.delete(c),r===c&&s(null)):(d.add(c),s(c)),d})},l=()=>{s(null)};return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Onboarding Tour"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Step-by-step guide to using the Home page"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:a.jsx("span",{className:"text-white text-2xl",children:"🎯"})}),a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Welcome to Cliniio!"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Let's take a quick tour of your Home page"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>i(0),className:"w-full p-4 text-left flex items-center justify-between hover:bg-blue-100 transition-colors",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"1"}),a.jsx("h5",{className:"font-medium text-blue-800",children:"Daily Tasks & Progress"})]}),a.jsx("span",{className:"text-blue-600 text-lg transition-transform duration-200",children:e.has(0)?"−":"+"})]}),e.has(0)&&a.jsxs("div",{className:"px-4 pb-4",children:[a.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"The main area shows your daily tasks and responsibilities. Each task card displays what needs to be done and your progress."}),a.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3 text-xs text-blue-600",children:[a.jsx("strong",{children:"Try it:"})," Look for task cards with checkboxes. Click on a checkbox to mark a task as complete and earn points!"]}),a.jsxs("button",{onClick:()=>s(r===0?null:0),className:"mt-3 w-full bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600 transition-colors",children:["🎯"," ",r===0?"Hide arrow":"Show me where this is"]})]})]}),a.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>i(1),className:"w-full p-4 text-left flex items-center justify-between hover:bg-green-100 transition-colors",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"2"}),a.jsx("h5",{className:"font-medium text-green-800",children:"Quick Action Buttons"})]}),a.jsx("span",{className:"text-green-600 text-lg transition-transform duration-200",children:e.has(1)?"−":"+"})]}),e.has(1)&&a.jsxs("div",{className:"px-4 pb-4",children:[a.jsx("p",{className:"text-sm text-green-700 mb-3",children:"At the top of your Home page, you'll find quick access buttons for important features and your performance stats."}),a.jsxs("div",{className:"bg-white border border-green-200 rounded p-3 text-xs text-green-600",children:[a.jsx("strong",{children:"Try it:"}),' Click on the purple "Stats" button to see your performance metrics, or the amber "Leaderboard" to check your ranking.']}),a.jsxs("button",{onClick:()=>s(r===1?null:1),className:"mt-3 w-full bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 transition-colors",children:["🎯"," ",r===1?"Hide arrow":"Show me where this is"]})]})]}),a.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>i(2),className:"w-full p-4 text-left flex items-center justify-between hover:bg-purple-100 transition-colors",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"3"}),a.jsx("h5",{className:"font-medium text-purple-800",children:"Gamification & Points"})]}),a.jsx("span",{className:"text-purple-600 text-lg transition-transform duration-200",children:e.has(2)?"−":"+"})]}),e.has(2)&&a.jsxs("div",{className:"px-4 pb-4",children:[a.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Notice the points and progress indicators? Cliniio makes work fun by rewarding your achievements and tracking your progress."}),a.jsxs("div",{className:"bg-white border border-purple-500 rounded p-3 text-xs text-purple-600",children:[a.jsx("strong",{children:"Try it:"})," Complete a task and watch your points increase. Check your progress in the Stats section to see your growth."]}),a.jsxs("button",{onClick:()=>s(r===2?null:2),className:"mt-3 w-full bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600 transition-colors",children:["🎯"," ",r===2?"Hide arrow":"Show me where this is"]})]})]}),a.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>i(3),className:"w-full p-4 text-left flex items-center justify-between hover:bg-amber-100 transition-colors",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"4"}),a.jsx("h5",{className:"font-medium text-amber-800",children:"Performance Metrics"})]}),a.jsx("span",{className:"text-amber-600 text-lg transition-transform duration-200",children:e.has(3)?"−":"+"})]}),e.has(3)&&a.jsxs("div",{className:"px-4 pb-4",children:[a.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Below your tasks, you'll see cards showing your time savings, cost savings, AI efficiency, and team performance."}),a.jsxs("div",{className:"bg-white border border-amber-200 rounded p-3 text-xs text-amber-600",children:[a.jsx("strong",{children:"Try it:"})," Review your metrics to see how you're performing. These update automatically as you complete tasks."]}),a.jsxs("button",{onClick:()=>s(r===3?null:3),className:"mt-3 w-full bg-amber-500 text-white px-3 py-2 rounded text-sm hover:bg-amber-600 transition-colors",children:["🎯"," ",r===3?"Hide arrow":"Show me where this is"]})]})]}),a.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>i(4),className:"w-full p-4 text-left flex items-center justify-between hover:bg-teal-100 transition-colors",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"5"}),a.jsx("h5",{className:"font-medium text-teal-800",children:"Help & Support"})]}),a.jsx("span",{className:"text-teal-600 text-lg transition-transform duration-200",children:e.has(4)?"−":"+"})]}),e.has(4)&&a.jsxs("div",{className:"px-4 pb-4",children:[a.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"That floating help button (🛟) you used to get here is always available when you need assistance with any feature."}),a.jsxs("div",{className:"bg-white border border-teal-200 rounded p-3 text-xs text-teal-600",children:[a.jsx("strong",{children:"Remember:"})," You can access help from anywhere in Cliniio. Just look for the floating button!"]}),a.jsxs("button",{onClick:()=>s(r===4?null:4),className:"mt-3 w-full bg-teal-500 text-white px-3 py-2 rounded text-sm hover:bg-teal-600 transition-colors",children:["🎯"," ",r===4?"Hide arrow":"Show me where this is"]})]})]})]}),a.jsx("div",{className:"bg-[#4ECDC4] border border-[#4ECDC4] rounded-lg p-4 text-center",children:a.jsxs("div",{className:"text-white",children:[a.jsx("h5",{className:"font-medium text-lg mb-2",children:"🎉 You're All Set!"}),a.jsx("p",{className:"text-sm text-white text-opacity-90 mb-3",children:"You now know the basics of navigating your Home page. Feel free to explore and try things out!"}),a.jsx("button",{onClick:n,className:"px-4 py-2 bg-white text-[#4ECDC4] rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Finish Tour"})]})})]})}),r!==null&&a.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[r===0&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"absolute left-1/4 top-1/3 z-50",children:[a.jsx("div",{className:"bg-blue-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"📋 Daily Tasks"}),a.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-blue-500 ml-4"})]})}),r===1&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"absolute right-1/4 top-20 z-50",children:[a.jsx("div",{className:"bg-green-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"⚡ Quick Actions"}),a.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-green-500 ml-4"})]})}),r===2&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"absolute left-1/4 top-1/4 z-50",children:[a.jsx("div",{className:"bg-purple-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"🏆 Points & Progress"}),a.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-purple-500 ml-4"})]})}),r===3&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"absolute left-1/4 bottom-1/4 z-50",children:[a.jsx("div",{className:"bg-amber-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"📊 Performance Metrics"}),a.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-amber-500 ml-4"})]})}),r===4&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"absolute bottom-20 right-20 z-50",children:[a.jsx("div",{className:"bg-teal-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"🛟 Help Button"}),a.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-teal-500 ml-4"})]})}),a.jsx("button",{onClick:l,className:"absolute top-4 right-4 bg-white text-gray-700 px-3 py-2 rounded-lg shadow-lg pointer-events-auto hover:bg-gray-100 transition-colors border border-gray-200 z-50",children:"✕ Close"})]})]})},_b=({currentContext:n,onBack:e,onSetHelpType:t})=>a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Cliniio Help"}),a.jsx("p",{className:"text-xs text-gray-500",children:n==="home"?"Help for Home page":"General help and support"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:n==="home"?a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Home Page Help"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:()=>t("performance-metrics"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:a.jsx("span",{className:"text-lg",children:"📊"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Performance Metrics"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Understanding your dashboard metrics"})]})]})}),a.jsx("button",{onClick:()=>t("task-management"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:a.jsx("span",{className:"text-lg",children:"✅"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Task Management"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Managing daily tasks and workflows"})]})]})}),a.jsx("button",{onClick:()=>t("gamification"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:a.jsx("span",{className:"text-lg",children:"🏆"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Gamification System"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How points, levels, and streaks work"})]})]})}),a.jsx("button",{onClick:()=>t("ai-features"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:a.jsx("span",{className:"text-lg",children:"🤖"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"AI Features"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How AI improves your workflow"})]})]})})]})]}):n==="sterilization"?a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:()=>t("bi-testing"),className:"bg-blue-50 border border-blue-200 rounded-lg p-3 w-full text-left hover:bg-blue-100 transition-colors",children:a.jsx("h5",{className:"font-medium text-blue-800",children:"🧪 BI Testing"})}),a.jsx("button",{onClick:()=>t("sterilization-workflow"),className:"bg-green-50 border border-green-200 rounded-lg p-3 w-full text-left hover:bg-green-100 transition-colors",children:a.jsx("h5",{className:"font-medium text-green-800",children:"✂️ Sterilization Workflow"})}),a.jsx("button",{onClick:()=>t("reporting-compliance"),className:"bg-purple-50 border border-purple-200 rounded-lg p-3 w-full text-left hover:bg-purple-100 transition-colors",children:a.jsx("h5",{className:"font-medium text-purple-800",children:"📊 Reporting and Compliance"})})]})]}):a.jsx("div",{className:"text-center text-gray-500 py-8",children:a.jsx("p",{children:"Help content coming soon for this page."})})})]});var xb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const bb=({onBack:n,expandedMetrics:e,onToggleMetricSection:t,onSetHelpType:r})=>{const[s,i]=h.useState([]),[l,c]=h.useState(!0);h.useEffect(()=>{xb(null,null,function*(){try{console.log("🔍 Loading performance metrics articles...");const f=yield Fa.getArticlesByCategory("performance-metrics");console.log("📊 Found articles:",f),console.log("📊 Articles count:",f.length),console.log("📊 Articles details:",f.map(g=>({slug:g.slug,title:g.title,published:g.is_published}))),i(f)}catch(f){console.error("❌ Error loading performance metrics articles:",f)}finally{c(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"time-savings",title:"Time Savings",color:"blue",content:a.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[a.jsx("li",{children:"• Shows hours saved through AI assistance"}),a.jsx("li",{children:"• Daily and monthly tracking"}),a.jsx("li",{children:"• Compares AI vs. manual task completion"}),a.jsx("li",{children:"• Real-time updates as tasks complete"})]})},{id:"cost-savings",title:"Cost Savings",color:"green",content:a.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[a.jsx("li",{children:"• Calculates dollar impact of AI efficiency"}),a.jsx("li",{children:"• Includes error prevention and compliance savings"}),a.jsx("li",{children:"• Uses facility-specific hourly rates"}),a.jsx("li",{children:"• Projects annual savings with growth factors"})]})},{id:"team-performance",title:"Team Performance",color:"purple",content:a.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[a.jsx("li",{children:"• Skills: Based on AI task completion rates"}),a.jsx("li",{children:"• Inventory: Real-time accuracy from actual data"}),a.jsx("li",{children:"• Sterilization: Performance from cycle data"}),a.jsx("li",{children:"• Helps identify training needs"})]})}],u=p=>{const f=e.has(p.id),y={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return a.jsxs("div",{className:`${y.bg} ${y.border} border rounded-lg overflow-hidden`,children:[a.jsxs("button",{onClick:()=>t(p.id),className:`w-full p-3 text-left flex items-center justify-between ${y.hover} transition-colors`,children:[a.jsx("h5",{className:`font-medium ${y.text}`,children:p.title}),a.jsx("span",{className:`${y.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&a.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&a.jsx("div",{className:"mt-3",children:a.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[a.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(l)return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>r("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=s.length>0?s.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:a.jsx("div",{className:"space-y-2",children:a.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about this performance metric.'})})})):d;return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>r("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),a.jsx("p",{className:"text-xs text-gray-500",children:s.length>0?`${s.length} help articles available`:"Understanding your dashboard metrics"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:s.length>0?"Help Articles":"Dashboard Metrics Explained"}),m.map(u)]})})]})};var wb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Sb=({onBack:n,onSetHelpType:e,expandedTasks:t,onToggleTaskSection:r})=>{const[s,i]=h.useState([]),[l,c]=h.useState(!0);h.useEffect(()=>{wb(null,null,function*(){try{console.log("🔍 Loading task management articles...");const f=yield Fa.getArticlesByCategory("task-management");console.log("📋 Found articles:",f),i(f)}catch(f){console.error("Error loading task management articles:",f)}finally{c(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"task-categories",title:"📋 Task Categories",color:"blue",content:a.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[a.jsx("li",{children:"• Sterilization: Autoclave cycles and BI tests"}),a.jsx("li",{children:"• Inventory: Stock checks and ordering"}),a.jsx("li",{children:"• Environmental: Cleaning schedules and compliance"}),a.jsx("li",{children:"• Quality: Documentation and audits"})]})},{id:"task-completion",title:"✅ Task Completion",color:"green",content:a.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[a.jsx("li",{children:"• Click checkboxes to mark tasks complete"}),a.jsx("li",{children:"• Earn points for each completed task"}),a.jsx("li",{children:"• Track progress throughout the day"}),a.jsx("li",{children:"• Maintain streaks for consistency"})]})},{id:"workflow-tips",title:"💡 Workflow Tips",color:"purple",content:a.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[a.jsx("li",{children:"• Use filters to focus on specific task types"}),a.jsx("li",{children:"• Prioritize high-impact tasks first"}),a.jsx("li",{children:"• Set reminders for time-sensitive items"}),a.jsx("li",{children:"• Review completed tasks for quality"})]})}],u=p=>{const f=t.has(p.id),y={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return a.jsxs("div",{className:`${y.bg} ${y.border} border rounded-lg overflow-hidden`,children:[a.jsxs("button",{onClick:()=>r(p.id),className:`w-full p-3 text-left flex items-center justify-between ${y.hover} transition-colors`,children:[a.jsx("h5",{className:`font-medium ${y.text}`,children:p.title}),a.jsx("span",{className:`${y.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&a.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&a.jsx("div",{className:"mt-3",children:a.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[a.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(l)return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=s.length>0?s.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:a.jsx("div",{className:"space-y-2",children:a.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about task management.'})})})):d;return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),a.jsx("p",{className:"text-xs text-gray-500",children:s.length>0?`${s.length} help articles available`:"Managing daily tasks and workflows"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:s.length>0?"Help Articles":"Daily Task Management"}),m.map(u)]})})]})};var Cb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Ib=({onBack:n,onSetHelpType:e,expandedGamification:t,onToggleGamificationSection:r})=>{const[s,i]=h.useState([]),[l,c]=h.useState(!0);h.useEffect(()=>{Cb(null,null,function*(){try{console.log("🔍 Loading gamification articles...");const f=yield Fa.getArticlesByCategory("gamification");console.log("🎮 Found articles:",f),i(f)}catch(f){console.error("Error loading gamification articles:",f)}finally{c(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"point-system",title:"⭐ Point System",color:"blue",content:a.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[a.jsx("li",{children:"• Complete tasks to earn points"}),a.jsx("li",{children:"• Points vary by task difficulty and impact"}),a.jsx("li",{children:"• Bonus points for maintaining streaks"}),a.jsx("li",{children:"• Level up as you accumulate points"})]})},{id:"streaks-consistency",title:"🔥 Streaks & Consistency",color:"green",content:a.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[a.jsx("li",{children:"• Daily streaks increase your multiplier"}),a.jsx("li",{children:"• Perfect days earn bonus rewards"}),a.jsx("li",{children:"• Streaks reset on missed days"}),a.jsx("li",{children:"• Long streaks unlock special achievements"})]})},{id:"level-progression",title:"📊 Level Progression",color:"purple",content:a.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[a.jsx("li",{children:"• Multiple skill-based sub-levels"}),a.jsx("li",{children:"• Sterilization, inventory, and environmental"}),a.jsx("li",{children:"• Rank against other users"}),a.jsx("li",{children:"• Unlock new features as you progress"})]})}],u=p=>{const f=t.has(p.id),y={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return a.jsxs("div",{className:`${y.bg} ${y.border} border rounded-lg overflow-hidden`,children:[a.jsxs("button",{onClick:()=>r(p.id),className:`w-full p-3 text-left flex items-center justify-between ${y.hover} transition-colors`,children:[a.jsx("h5",{className:`font-medium ${y.text}`,children:p.title}),a.jsx("span",{className:`${y.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&a.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&a.jsx("div",{className:"mt-3",children:a.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[a.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(l)return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=s.length>0?s.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:a.jsx("div",{className:"space-y-2",children:a.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about gamification.'})})})):d;return a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),a.jsx("p",{className:"text-xs text-gray-500",children:s.length>0?`${s.length} help articles available`:"How points, levels, and streaks work"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:s.length>0?"Help Articles":"Earning and Progress"}),m.map(u)]})})]})},jb=({onBack:n})=>a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"AI Features"}),a.jsx("p",{className:"text-xs text-gray-500",children:"How AI improves your workflow"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"AI-Powered Assistance"}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Smart Task Generation"}),a.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[a.jsx("li",{children:"• AI creates relevant daily tasks"}),a.jsx("li",{children:"• Adapts to your facility's needs"}),a.jsx("li",{children:"• Suggests optimal task sequences"}),a.jsx("li",{children:"• Learns from your preferences"})]})]}),a.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Optimization"}),a.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[a.jsx("li",{children:"• Real-time efficiency monitoring"}),a.jsx("li",{children:"• Predictive maintenance alerts"}),a.jsx("li",{children:"• Resource optimization suggestions"}),a.jsx("li",{children:"• Compliance risk mitigation"})]})]}),a.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Intelligent Insights"}),a.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[a.jsx("li",{children:"• Data-driven recommendations"}),a.jsx("li",{children:"• Trend analysis and forecasting"}),a.jsx("li",{children:"• Best practice suggestions"}),a.jsx("li",{children:"• Continuous improvement tips"})]})]})]})})]}),Eb=({onBack:n})=>a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"New Features"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Discover what's new in Cliniio"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"What's New in Cliniio"}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Latest Updates"}),a.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[a.jsx("li",{children:"• Enhanced AI assistance capabilities"}),a.jsx("li",{children:"• Improved task management system"}),a.jsx("li",{children:"• New gamification features"}),a.jsx("li",{children:"• Enhanced reporting and analytics"})]})]}),a.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Improvements"}),a.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[a.jsx("li",{children:"• Faster page loading times"}),a.jsx("li",{children:"• Better mobile responsiveness"}),a.jsx("li",{children:"• Improved accessibility features"}),a.jsx("li",{children:"• Enhanced security measures"})]})]}),a.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Coming Soon"}),a.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[a.jsx("li",{children:"• Advanced workflow automation"}),a.jsx("li",{children:"• Integration with external systems"}),a.jsx("li",{children:"• Enhanced mobile app features"}),a.jsx("li",{children:"• More customization options"})]})]})]})})]}),Tb=({onBack:n})=>a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Sterilization Workflow"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Sterilization processes and procedures"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsx("div",{className:"text-center text-gray-500 py-8",children:a.jsx("p",{children:"Sterilization workflow content coming soon."})})})]}),Nb=({onBack:n})=>a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"Reporting and Compliance"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Documentation and regulatory compliance procedures"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsx("div",{className:"text-center text-gray-500 py-8",children:a.jsx("p",{children:"Reporting and compliance content coming soon."})})})]}),kb=({onBack:n})=>a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:"BI Testing"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Biological indicator testing protocols"})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:a.jsx("div",{className:"text-center text-gray-500 py-8",children:a.jsx("p",{children:"BI testing content coming soon."})})})]}),Pb=({selectedHelpType:n,currentContext:e,expandedMetrics:t,expandedTasks:r,expandedGamification:s,expandedRelevant:i,onOptionClick:l,onBack:c,onFeedbackSuccess:o,onToggleMetricSection:d,onToggleTaskSection:u,onToggleGamificationSection:m,onToggleRelevantSection:p,onSetHelpType:f})=>{if(!n)return a.jsx(uc,{onOptionClick:l});switch(n){case"ai-chat":return a.jsx(cb,{currentContext:e,onBack:c});case"context-help":return a.jsx(mb,{currentContext:e,expandedRelevant:i,onToggleRelevantSection:p,onBack:c});case"product-feedback":return a.jsx(yb,{onBack:c,onSuccess:o});case"onboarding":return a.jsx(vb,{onBack:c});case"cliniio-help":return a.jsx(_b,{currentContext:e,onBack:c,onSetHelpType:f});case"performance-metrics":return a.jsx(bb,{onBack:c,expandedMetrics:t,onToggleMetricSection:d,onSetHelpType:f});case"task-management":return a.jsx(Sb,{onBack:c,onSetHelpType:f,expandedTasks:r,onToggleTaskSection:u});case"gamification":return a.jsx(Ib,{onBack:c,onSetHelpType:f,expandedGamification:s,onToggleGamificationSection:m});case"ai-features":return a.jsx(jb,{onBack:c});case"new-features":return a.jsx(Eb,{onBack:c});case"bi-testing":return a.jsx(kb,{onBack:c});case"sterilization-workflow":return a.jsx(Tb,{onBack:c});case"reporting-compliance":return a.jsx(Nb,{onBack:c});default:return a.jsx(uc,{onOptionClick:l})}},Db=({isDrawerOpen:n,onClose:e})=>{const{selectedHelpType:t,expandedMetrics:r,expandedTasks:s,expandedGamification:i,expandedRelevant:l,currentContext:c,handleOptionClick:o,handleBack:d,handleFeedbackSuccess:u,toggleMetricSection:m,toggleTaskSection:p,toggleGamificationSection:f,toggleRelevantSection:g,setHelpType:y}=m0(e),v=()=>a.jsx(Pb,{selectedHelpType:t,currentContext:c,expandedMetrics:r,expandedTasks:s,expandedGamification:i,expandedRelevant:l,onOptionClick:o,onBack:d,onFeedbackSuccess:u,onToggleMetricSection:m,onToggleTaskSection:p,onToggleGamificationSection:f,onToggleRelevantSection:g,onSetHelpType:y});return n?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:e,onKeyDown:x=>x.key==="Escape"&&e(),role:"button",tabIndex:0,"aria-label":"Close help drawer"}),a.jsxs("div",{className:"fixed top-0 right-0 h-screen w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out flex flex-col",children:[a.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-[#4ECDC4] text-white",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:a.jsx("span",{className:"text-white text-sm font-bold",children:"?"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold",children:"Help & Support"}),a.jsx("p",{className:"text-xs text-white text-opacity-90",children:"Choose how you'd like to get help"})]})]})}),v()]})]}):null},Ab=()=>{const[n,e]=h.useState(!1),t=()=>{e(!n)},r=()=>{e(!1)};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:a.jsx("button",{onClick:t,className:"w-14 h-14 bg-transparent text-gray-700 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 relative flex items-center justify-center","aria-label":"Get AI help and assistance",title:"AI Help & Assistant",children:a.jsx("span",{className:"text-6xl",children:"🛟"})})}),a.jsx(Db,{isDrawerOpen:n,onClose:r})]})};var Ob=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const ks=({children:n,hasComplianceIssues:e})=>{const{isDrawerOpen:t,openDrawer:r,closeDrawer:s}=Nh(),[i,l]=h.useState(!1);h.useEffect(()=>{function o(){return Ob(this,null,function*(){try{const{data:u,error:m}=yield _.from("audit_flags").select("id").eq("resolved",!1).limit(1);m||l(u&&u.length>0)}catch(u){console.error("Failed to check compliance issues:",u)}})}o();const d=()=>{setTimeout(()=>{o()},1e3)};return window.addEventListener("complianceIssueResolved",d),()=>window.removeEventListener("complianceIssueResolved",d)},[]);const c=e!==void 0?e:i;return a.jsx(Es,{children:a.jsxs(h.Suspense,{fallback:a.jsx(tg,{size:"lg"}),children:[a.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-blue-50 to-teal-50",children:[a.jsx(d0,{isOpen:t,onOpen:r,onClose:s,hasComplianceIssues:c}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"pt-6",children:n})})]}),a.jsx(Ab,{})]})})},mi=["Welcome back, sterilization superstar! ✨","Hey there, inventory rockstar! 🎸","The clinic's MVP is back in action! 🏆","Welcome to another day of medical excellence! 🌟","Ready to tackle some sterilization challenges? 💪","Back in the clinic and ready to shine! ✨","Time to make those tools gleam! ✨","Welcome back! The tools missed you! 🔧","Let's make today spotlessly successful! ✨","Ready to master the medical inventory? 📋","The sterilization superstar has arrived! 🌟","Let's make those tools SHINE today! ✨","Welcome back to your sterilization kingdom! 👑","Ready to conquer today's challenge? Let's do this! 🏅","Another day, another challenge to crush! 🚀","Your daily challenge awaits—show it who's boss! 💪","Inventory hero reporting for duty! 📦","Let's keep those supplies in tip-top shape! 🗂️","Inventory wizardry in progress—abracadabra! 🧙‍♂️","Time to check off those tasks like a pro! ✅","Taskmaster mode: activated! 🕹️","Let's make that to-do list disappear! ✨","Sparkle squad, assemble! 🧽","Let's make every room shine bright! 💡","Clean team, ready for action! 🦸‍♀️","Knowledge quest begins now! 📚","Time to level up your skills! 🎮","Learning legend in the house! 🏆"],Rb=()=>{const[n,e]=h.useState(mi[0]);return h.useEffect(()=>{const t=Math.floor(Math.random()*mi.length);setTimeout(()=>{e(mi[t])},0)},[]),a.jsx("h1",{className:"text-xl md:text-2xl font-bold text-[#5b5b5b] mb-2",children:n})},Gh=({content:n,children:e,className:t=""})=>{const[r,s]=h.useState(!1);return a.jsxs("div",{className:`relative inline-block ${t}`,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[e,r&&a.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50",children:a.jsx("div",{className:"bg-white text-gray-700 text-xs font-medium px-3 py-2 rounded-lg shadow-lg border border-gray-200 text-center whitespace-pre-line",children:n})})]})},$b=[{icon:bg,bg:"teal",label:"Cumulative Stats",description:`Performance
Statistics`},{icon:ro,bg:"purple",label:"Leaderboard",description:`Team
Rankings`},{icon:yh,bg:"blue",label:"Daily Challenge",description:`Daily
Challenge`}],Mb=({onStatsClick:n,onLeaderboardClick:e,onChallengeClick:t})=>{const r=(s,i)=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),i==null||i())};return a.jsxs("header",{className:"mb-6 pl-8","aria-label":"Dashboard header","data-testid":"nav-bar",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Rb,{}),a.jsx("nav",{className:"flex gap-4 pr-8",role:"navigation","aria-label":"Dashboard actions",children:$b.map(s=>{const i=s.label==="Cumulative Stats"?n:s.label==="Leaderboard"?e:s.label==="Daily Challenge"?t:void 0;return a.jsx(Gh,{content:s.description,children:a.jsx("button",{className:`rounded-xl w-12 h-12 flex items-center justify-center transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 ${s.label==="Cumulative Stats"?"bg-purple-100 focus:ring-purple-500":s.label==="Leaderboard"?"bg-amber-100 focus:ring-amber-500":"bg-blue-100 focus:ring-blue-500"}`,"aria-label":`${s.label}: ${s.description}`,onClick:i,onKeyDown:l=>r(l,i),tabIndex:0,children:a.jsx(N,{path:s.icon,size:1.1,"aria-hidden":"true",color:s.label==="Cumulative Stats"?"#9333ea":s.label==="Leaderboard"?"#d97706":"#2563eb"})})},s.label)})})]}),a.jsx("p",{className:"text-sm text-gray-500",role:"status","aria-live":"polite",children:"Here's your impact and progress for today."})]})},Qe={NAV_BAR_MARGIN_TOP:4,NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:24,NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED:72,COLORS:{PRIMARY:"#4ECDC4",PRIMARY_BG:"teal-100",BORDER:"teal-400",BG_GRADIENT:{FROM:"blue-50",TO:"teal-50"}},SPACING:{PADDING:6,MARGIN_TOP:6},BORDER:{LEFT_WIDTH:4},taskCard:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50",sectionBox:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50"},Fb=n=>{const e=n?Qe.NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:Qe.NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED,t=Qe.NAV_BAR_MARGIN_TOP;return{navBarMarginLeft:e,navBarMarginTop:t}};function Lb(){return $r(Qe.sectionBox,"mb-4")}function hi(){return $r(Qe.taskCard,"mb-4")}const zb={info:(...n)=>console.info("[Cliniio]",...n),error:(...n)=>console.error("[Cliniio]",...n),warn:(...n)=>console.warn("[Cliniio]",...n)};var Bb=Object.defineProperty,Ac=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,Ub=Object.prototype.propertyIsEnumerable,Oc=(n,e,t)=>e in n?Bb(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Rc=(n,e)=>{for(var t in e||(e={}))qb.call(e,t)&&Oc(n,t,e[t]);if(Ac)for(var t of Ac(e))Ub.call(e,t)&&Oc(n,t,e[t]);return n};const Po=Et(n=>({totalScore:0,availablePoints:0,showFilters:!1,showLeaderboardModal:!1,showStatsModal:!1,showChallengeModal:!1,leaderboardUsers:[],tasks:[],gamificationData:{totalScore:0,level:1,totalPoints:0,streak:0,rank:100,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}},drawerOpen:!0,loading:!1,taskError:null,setTotalScore:e=>n({totalScore:e}),setAvailablePoints:e=>n({availablePoints:e}),setShowFilters:e=>n({showFilters:e}),setShowLeaderboardModal:e=>n({showLeaderboardModal:e}),setShowStatsModal:e=>n({showStatsModal:e}),setShowChallengeModal:e=>n({showChallengeModal:e}),setLeaderboardUsers:e=>n({leaderboardUsers:e}),setTasks:e=>n({tasks:e}),setGamificationData:e=>n({gamificationData:e}),updateGamificationData:e=>{rg()&&(typeof e!="object"||e===null)&&zb.warn("[DEV] updateGamificationData called with invalid input:",e),n(t=>({gamificationData:Rc(Rc({},t.gamificationData),e)}))},setDrawerOpen:e=>n({drawerOpen:e}),setLoading:e=>n({loading:e}),setTaskError:e=>n({taskError:e})}));var $c=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Kh={fetchStats(){return $c(this,null,function*(){const{data:{user:n},error:e}=yield _.auth.getUser();if(e||!n)return console.error("Stats fetch blocked — no authenticated user"),null;const{data:t,error:r}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(r||!(t!=null&&t.facility_id))return console.error("Missing facility_id in user profile"),null;const s=t.facility_id,{data:i,error:l}=yield _.from("user_stats").select("*").eq("facility_id",s).eq("user_id",n.id).single();return l?(console.error("Error fetching stats:",l),null):i})},fetchCumulativeStats(){return $c(this,null,function*(){const{data:{user:n},error:e}=yield _.auth.getUser();return e||!n?(console.error("Cumulative stats fetch blocked — no authenticated user"),{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}):{toolsSterilized:23,inventoryChecks:15,perfectDays:7,totalTasks:12,completedTasks:8,currentStreak:3,bestStreak:12,totalPoints:450,challengesCompleted:5,totalChallenges:8}})}};var Hb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Qh=()=>{const[n,e]=h.useState({toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}),[t,r]=h.useState(!0),[s,i]=h.useState(null),l=h.useCallback(()=>Hb(null,null,function*(){try{r(!0),i(null);const o=yield Kh.fetchCumulativeStats();e(o)}catch(o){console.error("Error fetching cumulative stats:",o),i(o instanceof Error?o.message:"Failed to fetch stats")}finally{r(!1)}}),[]);h.useEffect(()=>{l()},[l]);const c=h.useCallback(()=>{l()},[l]);return{stats:n,loading:t,error:s,refreshStats:c}},Vb=({isOpen:n,onClose:e,gamificationData:t})=>{const{stats:r,loading:s,error:i,refreshStats:l}=Qh(),c=(t==null?void 0:t.stats)||{toolsSterilized:r.toolsSterilized,inventoryChecks:r.inventoryChecks,perfectDays:r.perfectDays,totalTasks:r.totalTasks,completedTasks:r.completedTasks,currentStreak:r.currentStreak,bestStreak:r.bestStreak};return a.jsx(Pa,{children:n&&a.jsx(Ye.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:a.jsxs(Ye.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:o=>o.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:a.jsx(N,{path:bn,size:.9,className:"text-white"})}),a.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:"Cumulative Stats"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:l,disabled:s,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg disabled:opacity-50",title:"Refresh stats",children:a.jsx(N,{path:Lt,size:.9,className:s?"animate-spin":""})}),a.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg",children:a.jsx(N,{path:pt,size:.9})})]})]}),i&&a.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[a.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Stats"}),a.jsx("div",{className:"text-red-500 text-xs mt-1",children:i})]}),a.jsxs("div",{className:"space-y-3",children:[s&&a.jsxs("div",{className:"text-center py-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4] mx-auto"}),a.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading stats..."})]}),!s&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-[#4ECDC4] bg-opacity-10 p-3 rounded-xl",children:[a.jsx("div",{className:"mb-0.5 text-[#4ECDC4] font-semibold text-sm",children:"Tools Sterilized"}),a.jsx("div",{className:"text-2xl font-bold text-[#4ECDC4]",children:c.toolsSterilized}),a.jsx("div",{className:"text-xs text-[#4ECDC4] mt-0.5",children:"That's impressive!"})]}),a.jsxs("div",{className:"bg-blue-50 p-3 rounded-xl",children:[a.jsx("div",{className:"mb-0.5 text-blue-600 font-semibold text-sm",children:"Inventory Checks"}),a.jsx("div",{className:"text-2xl font-bold text-blue-700",children:c.inventoryChecks}),a.jsx("div",{className:"text-xs text-blue-500 mt-0.5",children:"Always organized!"})]}),a.jsxs("div",{className:"bg-green-50 p-3 rounded-xl",children:[a.jsx("div",{className:"mb-0.5 text-green-600 font-semibold text-sm",children:"Perfect Days"}),a.jsx("div",{className:"text-2xl font-bold text-green-700",children:c.perfectDays}),a.jsx("div",{className:"text-xs text-green-500 mt-0.5",children:"Zero errors!"})]}),a.jsxs("div",{className:"bg-purple-50 p-3 rounded-xl",children:[a.jsx("div",{className:"mb-0.5 text-purple-600 font-semibold text-sm",children:"Task Completion"}),a.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[c.totalTasks>0?Math.round(c.completedTasks/c.totalTasks*100):0,"%"]}),a.jsxs("div",{className:"text-xs text-purple-500 mt-0.5",children:[c.completedTasks," / ",c.totalTasks," tasks completed"]})]}),a.jsxs("div",{className:"bg-amber-50 p-3 rounded-xl",children:[a.jsx("div",{className:"mb-0.5 text-amber-600 font-semibold text-sm",children:"Current Streak"}),a.jsx("div",{className:"text-2xl font-bold text-amber-700",children:c.currentStreak}),a.jsxs("div",{className:"text-xs text-amber-500 mt-0.5",children:["Best streak: ",c.bestStreak]})]})]})]})]})})})};var Wb=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Gb=({isOpen:n,onClose:e,gamificationData:t,loading:r=!1,error:s=null})=>{const[i,l]=h.useState("All"),[c,o]=h.useState([]);h.useEffect(()=>{Wb(null,null,function*(){try{let m=_.from("user_gamification_stats").select("user_id, total_xp, category");i!=="All"&&(m=m.eq("category",i.toLowerCase()));const{data:p,error:f}=yield m.order("total_xp",{ascending:!1}).limit(10);if(f)throw f;o(p||[])}catch(m){console.error("Error fetching leaderboard:",m)}})},[i]);const d={rank:(t==null?void 0:t.rank)||1,topUsers:(t==null?void 0:t.topUsers)||[]};return a.jsx(Pa,{children:n&&a.jsx(Ye.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:a.jsxs(Ye.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-6 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:u=>u.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-3 bg-blue-500 rounded-xl",children:a.jsx(N,{path:ro,size:1,className:"text-white"})}),a.jsx("h2",{className:"ml-3 text-xl font-bold text-[#5b5b5b]",children:"Office Leaderboard"})]}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:a.jsx(N,{path:pt,size:1})})]}),a.jsxs("div",{className:"flex items-center justify-between mb-4 bg-blue-50 p-3 rounded-lg",children:[a.jsx("div",{className:"text-blue-700 font-medium",children:"Your Rank"}),a.jsxs("div",{className:"flex items-center",children:[a.jsxs("span",{className:"text-xl font-bold text-blue-700 mr-1",children:["#",d.rank]}),a.jsx("span",{className:"text-blue-500 text-sm",children:"/15"})]})]}),s&&a.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[a.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Leaderboard"}),a.jsx("div",{className:"text-red-500 text-xs mt-1",children:s})]}),a.jsx("div",{className:"flex gap-2 mb-4 justify-center",children:["All","Learning","Cleaning","Challenges"].map(u=>a.jsx("button",{onClick:()=>l(u),className:`px-3 py-1 rounded-full text-sm font-medium border transition ${i===u?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-100"}`,children:u},u))}),a.jsxs("div",{className:"space-y-3",children:[r&&a.jsxs("div",{className:"text-center py-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),a.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading leaderboard..."})]}),!r&&!s&&d.topUsers.map((u,m)=>a.jsxs(Ye.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:m*.2+.2},className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-semibold",children:u.avatar}),m===0&&a.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center",children:a.jsx(N,{path:ro,size:.4,className:"text-white"})})]}),a.jsxs("div",{className:"ml-3",children:[a.jsx("div",{className:"text-sm font-semibold text-gray-700",children:u.full_name}),a.jsxs("div",{className:"text-xs text-gray-500",children:["Rank #",m+1]})]})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-lg font-bold text-[#4ECDC4]",children:u.score}),a.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"pts"})]})]},u.id||u.full_name))]})]})})})},Kb=X.memo(Gb),Do={TASKS:"Daily Operations Tasks",STATS:"Stats Overview",CHALLENGES:"Today's Challenge"};var Qb=Object.defineProperty,Yb=Object.defineProperties,Jb=Object.getOwnPropertyDescriptors,Mc=Object.getOwnPropertySymbols,Xb=Object.prototype.hasOwnProperty,Zb=Object.prototype.propertyIsEnumerable,Fc=(n,e,t)=>e in n?Qb(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ew=(n,e)=>{for(var t in e||(e={}))Xb.call(e,t)&&Fc(n,t,e[t]);if(Mc)for(var t of Mc(e))Zb.call(e,t)&&Fc(n,t,e[t]);return n},tw=(n,e)=>Yb(n,Jb(e)),pi=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Lc={createChallenge(n){return pi(this,null,function*(){try{const{data:{user:e},error:t}=yield _.auth.getUser();if(t||!e)throw new Error("Unauthorized: no authenticated user.");const{data:r,error:s}=yield _.from("users").select("facility_id, role").eq("id",e.id).single();if(s||!(r!=null&&r.facility_id))throw new Error("Missing facility context.");const i=r.facility_id,l=r.role||"staff";if(!["admin","manager"].includes(l))throw new Error("Forbidden: insufficient permissions to create challenges.");const o={title:n.title,description:n.description||"",points:n.points||0,facility_id:i,created_by:e.id,created_at:new Date().toISOString()},{data:d,error:u}=yield _.from("home_challenges").insert([o]).select().single();if(u)throw new Error(u.message);return console.info(`✅ Challenge created by ${l}:`,d.title),{success:!0,data:d}}catch(e){return console.error("❌ Challenge creation failed:",e instanceof Error?e.message:String(e)),{success:!1,error:e instanceof Error?e.message:String(e)}}})},fetchUserChallenges(){return pi(this,null,function*(){try{const{data:{user:n},error:e}=yield _.auth.getUser();if(e||!n)return console.warn("⚠️ No authenticated user, returning empty challenges"),[];const{data:t,error:r}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(r||!(t!=null&&t.facility_id))return console.warn("⚠️ Missing facility context, returning empty challenges"),[];const s=t.facility_id,i=`challenges_and_completions:${s}`,l=ja.get(i);if(l)return console.info("🧠 Loaded challenges from cache:",l.length),l;const[c,o]=yield Promise.all([_.from("home_challenges").select("*").eq("facility_id",s).order("created_at",{ascending:!1}),_.from("home_challenge_completions").select("challenge_id, user_id, completed_at").eq("facility_id",s).eq("user_id",n.id)]);if(c.error)throw new Error(c.error.message);if(o.error)throw new Error(o.error.message);const d=c.data||[],u=o.data||[],m=d.map(p=>{var f;return tw(ew({},p),{isCompleted:u.some(g=>g.challenge_id===p.id),completedAt:((f=u.find(g=>g.challenge_id===p.id))==null?void 0:f.completed_at)||null})});return ja.set(i,m),console.info(`✅ Cached ${m.length} merged challenges for ${s}`),m}catch(n){return console.error("❌ Failed to fetch challenges:",n instanceof Error?n.message:String(n)),[]}})},completeChallenge(n){return pi(this,null,function*(){var e,t;try{const{data:{user:r},error:s}=yield _.auth.getUser();if(s||!r)throw new Error("Unauthorized: no authenticated user.");let i=((e=r.user_metadata)==null?void 0:e.facility_id)||((t=r.app_metadata)==null?void 0:t.facility_id);if(!i){const{data:d,error:u}=yield _.from("users").select("facility_id").eq("id",r.id).single();if(u||!(d!=null&&d.facility_id))throw new Error("Missing facility context.");i=d.facility_id}const{data:l,error:c}=yield _.from("challenge_completions").select("id").eq("challenge_id",n.challenge_id).eq("user_id",r.id).eq("facility_id",i).single();if(c&&c.code!=="PGRST116")throw new Error(c.message);if(l)return console.warn("Challenge already completed by user"),!0;const{error:o}=yield _.from("home_challenge_completions").insert([{challenge_id:n.challenge_id,user_id:r.id,facility_id:i,points_earned:n.points_earned,completed_at:new Date().toISOString()}]);if(o)throw new Error(o.message);return console.info(`✅ Challenge ${n.challenge_id} completed by user ${r.id}`),!0}catch(r){return console.error("❌ Challenge completion failed:",r instanceof Error?r.message:String(r)),!1}})}};var rw=Object.defineProperty,nw=Object.defineProperties,sw=Object.getOwnPropertyDescriptors,zc=Object.getOwnPropertySymbols,aw=Object.prototype.hasOwnProperty,iw=Object.prototype.propertyIsEnumerable,Bc=(n,e,t)=>e in n?rw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ow=(n,e)=>{for(var t in e||(e={}))aw.call(e,t)&&Bc(n,t,e[t]);if(zc)for(var t of zc(e))iw.call(e,t)&&Bc(n,t,e[t]);return n},lw=(n,e)=>nw(n,sw(e)),qc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const cw={knowledge:"bg-blue-100 text-blue-800",process:"bg-purple-100 text-purple-800",quality:"bg-green-100 text-green-800",collaboration:"bg-orange-100 text-orange-800",daily:"bg-gray-100 text-gray-800",team:"bg-pink-100 text-pink-800"},dw={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"},uw=({isOpen:n,onClose:e,onChallengeComplete:t})=>{const[r,s]=h.useState("all"),[i,l]=h.useState("all"),[c,o]=h.useState("pending"),[d,u]=h.useState([]),[m,p]=h.useState(!0);h.useEffect(()=>{qc(null,null,function*(){try{p(!0);const C=(yield Lc.fetchUserChallenges()).map(k=>({id:k.id,title:k.title,description:k.description,category:k.category,difficulty:k.difficulty,points:k.points,timeEstimate:k.time_estimate,completed:k.isCompleted||!1}));u(C)}catch(b){console.error("Error loading challenges:",b)}finally{p(!1)}})},[]);const f=[{id:"knowledge",icon:wg,label:"Knowledge"},{id:"process",icon:Sg,label:"Process"},{id:"quality",icon:Cg,label:"Quality"},{id:"collaboration",icon:Xo,label:"Collaboration"},{id:"daily",icon:ws,label:"Daily"},{id:"team",icon:Xo,label:"Team"}],g=[{id:"easy",label:"Easy",color:"text-green-500"},{id:"medium",label:"Medium",color:"text-yellow-500"},{id:"hard",label:"Hard",color:"text-red-500"}],y=d.filter(x=>{const b=r==="all"||x.category===r,C=i==="all"||x.difficulty===i,k=c==="all"||c==="pending"&&!x.completed||c==="completed"&&x.completed;return b&&C&&k}),v=x=>qc(null,null,function*(){try{(yield Lc.completeChallenge({challenge_id:x.id,points_earned:x.points}))?(u(C=>C.map(k=>k.id===x.id?lw(ow({},k),{completed:!0}):k)),t(x.points)):console.error("Failed to complete challenge")}catch(b){console.error("Error completing challenge:",b)}});return a.jsx(Pa,{children:n&&a.jsx(Ye.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:a.jsxs(Ye.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto scrollbar-hide",onClick:x=>x.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:a.jsx(N,{path:yh,size:.9,className:"text-white"})}),a.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:Do.CHALLENGES})]}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:a.jsx(N,{path:pt,size:.9})})]}),a.jsxs("div",{className:"mb-4 flex gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Category"}),a.jsxs("select",{value:r,onChange:x=>s(x.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[a.jsx("option",{value:"all",children:"All Categories"}),f.map(x=>a.jsx("option",{value:x.id,children:x.label},x.id))]})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Difficulty"}),a.jsxs("select",{value:i,onChange:x=>l(x.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[a.jsx("option",{value:"all",children:"All Difficulties"}),g.map(x=>a.jsx("option",{value:x.id,children:x.label},x.id))]})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Status"}),a.jsxs("select",{value:c,onChange:x=>o(x.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[a.jsx("option",{value:"all",children:"All Challenges"}),a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"completed",children:"Completed"})]})]})]}),a.jsx("div",{className:"space-y-3",children:m?a.jsx("div",{className:"text-center py-8",children:a.jsx("div",{className:"text-gray-500",children:"Loading challenges..."})}):y.length===0?a.jsx("div",{className:"text-center py-8",children:a.jsx("div",{className:"text-gray-500",children:"No challenges available"})}):y.map(x=>a.jsx("div",{className:`p-3 rounded-lg border ${x.completed?"bg-gray-50 border-gray-200":"bg-white border-gray-200 hover:border-[#4ECDC4]"}`,children:a.jsx("div",{className:"flex justify-between items-start",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${cw[x.category]}`,children:x.category}),a.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${dw[x.difficulty]}`,children:x.difficulty}),a.jsx("span",{className:"text-xs text-gray-500",children:x.timeEstimate})]}),a.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-0.5",children:x.title}),a.jsx("p",{className:"text-xs text-gray-600 mb-2",children:x.description}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("span",{className:"text-xs font-medium text-[#4ECDC4]",children:[x.points," points"]}),!x.completed&&a.jsx("button",{onClick:()=>v(x),className:"px-3 py-1 bg-[#4ECDC4] text-white text-xs rounded-lg hover:bg-[#38b2ac] transition-colors",children:"Complete"}),x.completed&&a.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[a.jsx(N,{path:Ig,size:.8,className:"mr-1"}),"Completed"]})]})]})})},x.id))})]})})})};var Uc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const mw={fetchLeaderboard(){return Uc(this,null,function*(){var n;const{data:{user:e},error:t}=yield _.auth.getUser();if(t||!e)return console.error("Leaderboard fetch blocked — no authenticated user"),[];const{data:r,error:s}=yield _.from("leaderboard").select("*").eq("facility_id",((n=e.user_metadata)==null?void 0:n.facility_id)||"").order("points",{ascending:!1});return s?(console.error("Error fetching leaderboard:",s),[]):r||[]})},fetchLeaderboardData(){return Uc(this,null,function*(){return this.fetchLeaderboard()})}},hw=({isStatsOpen:n,onStatsClose:e,isLeaderboardOpen:t,onLeaderboardClose:r,isChallengeOpen:s,onChallengeClose:i,gamificationData:l,leaderboardRank:c,leaderboardTopUsers:o,leaderboardLoading:d=!1,leaderboardError:u=null})=>{const[m,p]=h.useState({rank:c,topUsers:o}),[f,g]=h.useState(!1),[y,v]=h.useState(null);h.useEffect(()=>{t&&o.length===0&&(setTimeout(()=>{g(!0),v(null)},0),mw.fetchLeaderboardData().then(b=>{p({rank:1,topUsers:(b==null?void 0:b.map(C=>({id:C.user_id,name:C.user_name||"Anonymous",score:C.points||0,avatar:"👤"})))||[]})}).catch(b=>{v(b.message||"Failed to load leaderboard")}).finally(()=>{g(!1)}))},[t,o.length]);const x={stats:l.stats||{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}};return a.jsxs(a.Fragment,{children:[n&&a.jsx(Vb,{isOpen:n,onClose:e,gamificationData:x}),a.jsx(Kb,{isOpen:t,onClose:r,gamificationData:m,loading:f,error:y}),a.jsx(uw,{isOpen:s,onClose:i,onChallengeComplete:b=>{console.log("Challenge completed with points:",b)}})]})};function pw({leaderboardData:n}){const{showStatsModal:e,setShowStatsModal:t,showLeaderboardModal:r,setShowLeaderboardModal:s,showChallengeModal:i,setShowChallengeModal:l,gamificationData:c}=Po(),o=h.useMemo(()=>n.users||[],[n.users]),d=h.useMemo(()=>!o||o.length===0?[]:o.slice().sort((p,f)=>f.score-p.score).slice(0,3),[o]),u=h.useMemo(()=>n.userRank||1,[n.userRank]),m=h.useMemo(()=>!n.users||n.users.length===0?[]:d.map(p=>({id:p.id,name:p.full_name||"Anonymous",score:p.score||0,rank:p.rank,avatar:p.avatar||"👤"})),[d,n.users]);return a.jsx(hw,{isStatsOpen:e,onStatsClose:()=>t(!1),isLeaderboardOpen:r,onLeaderboardClose:()=>s(!1),isChallengeOpen:i,onChallengeClose:()=>l(!1),gamificationData:c,leaderboardRank:u,leaderboardTopUsers:m,leaderboardLoading:!1,leaderboardError:null})}var fw=Object.defineProperty,Hc=Object.getOwnPropertySymbols,gw=Object.prototype.hasOwnProperty,yw=Object.prototype.propertyIsEnumerable,Vc=(n,e,t)=>e in n?fw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,vw=(n,e)=>{for(var t in e||(e={}))gw.call(e,t)&&Vc(n,t,e[t]);if(Hc)for(var t of Hc(e))yw.call(e,t)&&Vc(n,t,e[t]);return n};const Ge={maxTasksPerUser:3,enabledCategories:["equipment","compliance","operational","safety"],priorityThresholds:{low:1,medium:2,high:3,urgent:4},priorityWeights:{low:1,medium:2,high:3,urgent:4},rolePreferences:{technician:["equipment","compliance"],operator:["operational","compliance"],cleaning_staff:["compliance"],inventory_manager:["operational"],supervisor:["safety","operational"]},timeConstraints:{maxTaskDuration:120,minTaskDuration:5},autoAssignment:!0,aiSensitivity:"medium",aiEnabled:!0},_w={urgent:4,high:3,medium:2,low:1},xw={equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]};function bw(n){var e,t,r,s,i,l,c,o,d,u,m,p,f,g,y,v;return{maxTasksPerUser:(e=n.maxTasksPerUser)!=null?e:Ge.maxTasksPerUser,enabledCategories:(t=n.enabledCategories)!=null?t:Ge.enabledCategories,priorityThresholds:{low:(s=(r=n.priorityThresholds)==null?void 0:r.low)!=null?s:Ge.priorityThresholds.low,medium:(l=(i=n.priorityThresholds)==null?void 0:i.medium)!=null?l:Ge.priorityThresholds.medium,high:(o=(c=n.priorityThresholds)==null?void 0:c.high)!=null?o:Ge.priorityThresholds.high,urgent:(u=(d=n.priorityThresholds)==null?void 0:d.urgent)!=null?u:Ge.priorityThresholds.urgent},priorityWeights:(m=n.priorityWeights)!=null?m:Ge.priorityWeights,rolePreferences:(p=n.rolePreferences)!=null?p:Ge.rolePreferences,timeConstraints:(f=n.timeConstraints)!=null?f:Ge.timeConstraints,autoAssignment:(g=n.autoAssignment)!=null?g:Ge.autoAssignment,aiSensitivity:(y=n.aiSensitivity)!=null?y:Ge.aiSensitivity,aiEnabled:(v=n.aiEnabled)!=null?v:Ge.aiEnabled}}function Wc(n){return _w[n]}function Yh(n,e){const t=xw[e];return t?t.includes(n):!0}function fi(){return vw({},Ge)}var Gs=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ww{calculateLevel(e){return e<100?1:e<250?2:e<500?3:e<750?4:e<1e3?5:Math.floor(Math.log(e/100)/Math.log(1.5))+5}calculatePointsToNextLevel(e,t){const r=this.getLevelThreshold(e+1);return Math.max(0,r-t)}getLevelThreshold(e){return e<=1?0:e<=5?[0,100,250,500,750,1e3][e-1]:Math.floor(100*Math.pow(1.5,e-5))}calculateUserRank(e,t){return Gs(this,null,function*(){try{const{data:r,error:s}=yield _.from("home_challenge_completions").select("user_id, points_earned").eq("facility_id",t);if(s)return console.error("Error fetching facility users for ranking:",s),{rank:1,percentile:100};const i=new Map;r==null||r.forEach(u=>{const m=u.user_id,p=u.points_earned;i.set(m,(i.get(m)||0)+p)});const l=Array.from(i.entries()).sort(([,u],[,m])=>m-u),c=l.findIndex(([u])=>u===e),o=c===-1?l.length:c+1,d=Math.round((1-(o-1)/l.length)*100);return{rank:o,percentile:d}}catch(r){return console.error("Error calculating user rank:",r),{rank:1,percentile:100}}})}updateGamificationData(e){return Gs(this,null,function*(){try{const{data:t,error:r}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e.userId).eq("facility_id",e.facilityId);if(r)throw console.error("Error fetching user completions:",r),r;const s=(t||[]).reduce((m,p)=>m+p.points_earned,0),i=this.calculateLevel(s),l=i+1,c=this.calculatePointsToNextLevel(i,s),{rank:o,percentile:d}=yield this.calculateUserRank(e.userId,e.facilityId),u={currentLevel:i,nextLevel:l,pointsToNextLevel:c,totalPoints:s,rank:o,rankPercentile:d};return O.info("Gamification update:",{userId:e.userId,pointsEarned:e.pointsEarned,totalPoints:s,currentLevel:i,rank:o,taskTitle:e.taskTitle}),u}catch(t){throw console.error("Error updating gamification data:",t),t}})}checkLevelUp(e,t,r){return Gs(this,null,function*(){try{const{data:s,error:i}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e).eq("facility_id",t);if(i)return console.error("Error fetching user completions for level check:",i),!1;const l=(s||[]).reduce((d,u)=>d+u.points_earned,0),c=this.calculateLevel(r);return this.calculateLevel(l)>c}catch(s){return console.error("Error checking level up:",s),!1}})}getGamificationSummary(e,t){return Gs(this,null,function*(){try{const{data:r,error:s}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e).eq("facility_id",t);if(s)throw console.error("Error fetching gamification summary:",s),s;const i=(r||[]).reduce((m,p)=>m+p.points_earned,0),l=this.calculateLevel(i),c=l+1,o=this.calculatePointsToNextLevel(l,i),{rank:d,percentile:u}=yield this.calculateUserRank(e,t);return{currentLevel:l,nextLevel:c,pointsToNextLevel:o,totalPoints:i,rank:d,rankPercentile:u}}catch(r){throw console.error("Error getting gamification summary:",r),r}})}}const Sw=new ww;var Cw=Object.defineProperty,Gc=Object.getOwnPropertySymbols,Iw=Object.prototype.hasOwnProperty,jw=Object.prototype.propertyIsEnumerable,Kc=(n,e,t)=>e in n?Cw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Jh=(n,e)=>{for(var t in e||(e={}))Iw.call(e,t)&&Kc(n,t,e[t]);if(Gc)for(var t of Gc(e))jw.call(e,t)&&Kc(n,t,e[t]);return n},La=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function Yt(){return`gap-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Ew(){return`task-${Date.now()}-${Math.random()}`}function Tw(){return`ai-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Nw(n,e){return La(this,null,function*(){try{for(const t of n)for(const r of t.tasks){const{error:s}=yield _.from("home_daily_operations_tasks").insert({facility_id:e,title:r.title,description:r.description,completed:!1,points:r.points,type:r.type,category:r.category,priority:r.priority,due_date:r.dueDate,estimated_duration:r.estimatedDuration,status:"pending",assigned_to:t.userId,created_by:bt(t.userId)||t.userId,created_at:r.createdAt,updated_at:r.updatedAt});s&&console.error("Error creating daily task:",s)}}catch(t){throw console.error("Error creating daily tasks:",t),t}})}function kw(n){return La(this,null,function*(){const{data:e,error:t}=yield _.from("home_daily_operations_tasks").select("*").eq("assigned_to",n).eq("status","pending").order("priority",{ascending:!1}).order("due_date",{ascending:!0});if(t)throw t;return(e||[]).map(r=>Jh({id:r.id},r))})}function Pw(n){return La(this,null,function*(){const{data:e,error:t}=yield _.from("home_daily_operations_tasks").select("*").eq("facility_id",n).eq("status","pending").order("priority",{ascending:!1}).order("due_date",{ascending:!0});if(t)throw t;return(e||[]).map(r=>Jh({id:r.id},r))})}function Dw(n,e){return La(this,null,function*(){try{const{data:t,error:r}=yield _.from("home_daily_operations_tasks").select("points, facility_id, title, category").eq("id",n).single();if(r||!t)throw new Error(`Task not found: ${(r==null?void 0:r.message)||"Unknown error"}`);const s=t.points||0,{error:i}=yield _.from("home_daily_operations_tasks").update({completed:!0,status:"completed",completed_by:e,completed_at:new Date().toISOString()}).eq("id",n);if(i)throw new Error(`Failed to complete task: ${i.message}`);if(s>0){const{error:l}=yield _.from("home_challenge_completions").insert({challenge_id:n,user_id:e,facility_id:t.facility_id,points_earned:s,completion_type:"daily_task",task_title:t.title,task_category:t.category});if(l)console.error("Failed to award points for task completion:",l);else{console.log(`Awarded ${s} points for completing task: ${t.title}`);try{const c=yield Sw.updateGamificationData({userId:e,facilityId:t.facility_id,pointsEarned:s,taskTitle:t.title,taskCategory:t.category});c.currentLevel>1&&console.log(`🎉 Level up! User ${e} reached level ${c.currentLevel}`),console.log("Gamification updated:",{level:c.currentLevel,totalPoints:c.totalPoints,rank:c.rank,pointsToNextLevel:c.pointsToNextLevel})}catch(c){console.error("Error updating gamification data:",c)}}}}catch(t){throw console.error("Error completing daily task:",t),t}})}var Me=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function Aw(){return Me(this,null,function*(){const{data:{user:n}}=yield _.auth.getUser();if(!n)throw new Error("User not authenticated");return n.id})}function Ze(){return Me(this,null,function*(){const{data:{user:n}}=yield _.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:e,error:t}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(t||!e)throw new Error("Failed to get user facility");return e.facility_id})}const At={getToolByBarcode(n){return Me(this,null,function*(){const e=yield Ze(),{data:t,error:r}=yield _.from("tools").select("*").eq("barcode",n).eq("facility_id",e).maybeSingle();return r?(console.error("ToolService.getToolByBarcode error:",r),null):t})},getToolsByStatus(n){return Me(this,null,function*(){const e=yield Ze(),{data:t,error:r}=yield _.from("tools").select("*").eq("status",n).eq("facility_id",e);return r?(console.error("ToolService.getToolsByStatus error:",r),[]):t||[]})},updateToolStatus(n,e){return Me(this,null,function*(){if(n.startsWith("mock-tool-"))return console.log("🧪 Skipping database update for mock tool:",n),{id:n,status:e,updated_at:new Date().toISOString()};const t={status:e,facility_id:yield Ze(),updated_at:new Date().toISOString()},{data:r,error:s}=yield _.from("tools").update(t).eq("id",n).select().single();if(s)throw s;return r})},getToolByBarcodeAndStatus(n,e){return Me(this,null,function*(){if(n==="TEST-CLEAN-001"&&e==="clean")return console.log("🧪 Using mock tool data for testing Clean Tool workflow"),{id:"mock-tool-test-clean-001",barcode:"TEST-CLEAN-001",tool_type:"surgical_scissors",tool_name:"Test Surgical Scissors",status:"clean",facility_id:"550e8400-e29b-41d4-a716-446655440000",current_cycle_id:"00000000-0000-0000-0000-000000000000",location:"Sterilization Room",sterilization_count:0,notes:"Mock tool for testing Clean Tool workflow",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),latitude:null,longitude:null,gps_accuracy:null,location_timestamp:null,maintenance_due_date:null,metadata:null,model:"Test Model",manufacturer:"Test Manufacturer",serial_number:"TEST-001",is_p2_tool:!1};const t=yield Ze(),{data:r,error:s}=yield _.from("tools").select("id, tool_name, barcode, facility_id, current_cycle_id, status, is_p2_tool").eq("barcode",n).eq("status",e).eq("facility_id",t).single();if(s)throw s;return r})},getToolsByFacilityAndStatus(n,e){return Me(this,null,function*(){const{data:t,error:r}=yield _.from("tools").select("id, tool_name, barcode, facility_id, current_cycle_id, status, is_p2_tool").eq("facility_id",n).eq("status",e);if(r)throw r;return t})},getToolsByStatuses(n){return Me(this,null,function*(){const e=yield Ze(),{data:t,error:r}=yield _.from("tools").select("id, tool_name, barcode, facility_id, current_cycle_id, status, is_p2_tool").in("status",n).eq("facility_id",e);if(r)throw r;return t})},updateToolsStatus(n,e){return Me(this,null,function*(){const t={status:e,facility_id:yield Ze(),updated_at:new Date().toISOString()},{data:r,error:s}=yield _.from("tools").update(t).in("id",n).select();if(s)throw s;return r!=null?r:[]})},updateToolsCyclePhase(n,e,t,r){return Me(this,null,function*(){const s={status:e,facility_id:yield Ze(),updated_at:new Date().toISOString()},{data:i,error:l}=yield _.from("tools").update(s).in("id",n).select();if(l)throw l;return i!=null?i:[]})},clearCycleAssignment(n,e){return Me(this,null,function*(){const t=n.filter(c=>c.startsWith("mock-tool-")),r=n.filter(c=>!c.startsWith("mock-tool-"));if(t.length>0&&console.log("🧪 Skipping database update for mock tools:",t),r.length===0)return t.map(c=>({id:c,status:e,current_cycle_id:"00000000-0000-0000-0000-000000000000",current_phase:null,updated_at:new Date().toISOString()}));const s={status:e,facility_id:yield Ze(),updated_at:new Date().toISOString()},{data:i,error:l}=yield _.from("tools").update(s).in("id",r).select();if(l)throw l;return i!=null?i:[]})},markAsSterilized(n){return Me(this,null,function*(){if(n.startsWith("mock-tool-"))return console.log("🧪 Skipping database update for mock tool:",n),{id:n,last_sterilized:new Date().toISOString(),updated_at:new Date().toISOString()};const e={facility_id:yield Ze(),updated_at:new Date().toISOString()},{data:t,error:r}=yield _.from("tools").update(e).eq("id",n).select().single();if(r)throw r;return t})},updateToolPhase(n,e){return Me(this,null,function*(){const t={facility_id:yield Ze(),updated_at:new Date().toISOString()},{data:r,error:s}=yield _.from("tools").update(t).eq("id",n).select().single();if(s)throw s;return r})},touchTools(n){return Me(this,null,function*(){const e={facility_id:yield Ze(),updated_at:new Date().toISOString()},{data:t,error:r}=yield _.from("tools").update(e).in("id",n).select();if(r)throw r;return t!=null?t:[]})},persistProblemTool(n,e,t){return Me(this,null,function*(){if(n.startsWith("mock-tool-"))return console.log("🧪 Skipping database update for mock tool:",n),{id:n,status:"problem",updated_at:new Date().toISOString()};const r=yield Ze(),s=yield Aw(),i={status:"problem",facility_id:r,updated_at:new Date().toISOString(),notes:t?`PROBLEM: ${e} - ${t}`:`PROBLEM: ${e}`},{data:l,error:c}=yield _.from("tools").update(i).eq("id",n).select().single();if(c)throw c;yield this.clearCycleAssignment([n],"problem");const{error:o}=yield _.from("audit_logs").insert({id:crypto.randomUUID(),module:"sterilization",table_name:"tools",action:"tool_marked_problem",record_id:n,user_id:s,facility_id:r,old_values:{status:"available"},new_values:{status:"problem",notes:i.notes},metadata:{problem_type:e,problem_notes:t,timestamp:new Date().toISOString()},created_at:new Date().toISOString()});return o&&console.error("Failed to log problem tool audit event:",o),yield _.from("inventory_items").update({is_available:!1}).eq("tool_id",n).eq("facility_id",r),l})}};var gi=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Qc{static applyFilters(e,t){if(!t)return e;let r=e;return t.category&&(r=r.eq("category",t.category)),t.status&&(r=r.eq("status",t.status)),t.location&&(r=r.eq("location",t.location)),t.search&&(r=r.or(`name.ilike.%${t.search}%,category.ilike.%${t.search}%`)),r}static applyFiltersToTable(e,t,r){return gi(this,null,function*(){const{data:{user:s},error:i}=yield e.auth.getUser();if(i||!s)throw new Error("User not authenticated");const{data:l,error:c}=yield e.from("users").select("facility_id").eq("id",s.id).single();if(c||!(l!=null&&l.facility_id))throw new Error("User facility not found");const o=l.facility_id,u=e.from(t).select(`
      id,
      name,
      category,
      quantity,
      unit_cost,
      reorder_point,
      expiration_date,
      data,
      created_at,
      updated_at
    `,{count:"exact"}).eq("facility_id",o);return this.applyFilters(u,r)})}static applyFiltersToSelect(e,t,r,s){const i=e.from(t).select(r,{count:"exact"});return this.applyFilters(i,s)}static applyFiltersToSingle(e,t,r){return e.from(t).select("*").eq("id",r).single()}static applyFiltersToCategories(e,t){return gi(this,null,function*(){const{data:{user:r},error:s}=yield e.auth.getUser();if(s||!r)throw new Error("User not authenticated");const{data:i,error:l}=yield e.from("users").select("facility_id").eq("id",r.id).single();if(l||!(i!=null&&i.facility_id))throw new Error("User facility not found");const c=i.facility_id;return e.from(t).select("category").eq("facility_id",c).not("category","is",null)})}static applyFiltersToLocations(e,t){return gi(this,null,function*(){const{data:{user:r},error:s}=yield e.auth.getUser();if(s||!r)throw new Error("User not authenticated");const{data:i,error:l}=yield e.from("users").select("facility_id").eq("id",r.id).single();if(l||!(i!=null&&i.facility_id))throw new Error("User facility not found");const c=i.facility_id;return e.from(t).select("location").eq("facility_id",c).not("location","is",null)})}static extractUniqueValues(e,t){return Array.from(new Set((e==null?void 0:e.map(r=>r[t]))||[]))}static buildSearchQuery(e,t=["name","category"]){return t.map(r=>`${r}.ilike.%${e}%`).join(",")}static validateFilters(e){if(!e)return!0;if(e.search&&e.search.trim().length<2)return!1;const t=["active","inactive","p2","n/a"];return!(e.status&&!t.includes(e.status))}static getFilterSummary(e){if(!e)return"no filters";const t=[];return e.category&&t.push(`category: ${e.category}`),e.status&&t.push(`status: ${e.status}`),e.location&&t.push(`location: ${e.location}`),e.search&&t.push(`search: "${e.search}"`),t.length>0?t.join(", "):"no filters"}}class ze{static handleError(e,t){throw console.error(`❌ ${t} failed:`,e),e&&typeof e=="object"&&"message"in e?Ah(e):new Error(`${t} failed: ${e}`)}static handleResponse(e,t){return e.error&&this.handleError(e.error,t),e.data}static logStart(e,t){}static logSuccess(e,t){}static logFailure(e,t){console.error(`❌ ${e} failed:`,t)}}var Ow=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function Rw(){return Ow(this,null,function*(){return yield L(()=>import("./TypedSupabaseAdapter-DJ9oE_b3.js"),__vite__mapDeps([8,1,2,3,4,5]))})}var vt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const $w=n=>n instanceof Error?n:typeof n=="object"&&n!==null&&"message"in n?new Error(String(n.message)):new Error("Unknown Supabase error occurred");class je{static getTypedAdapter(){return vt(this,null,function*(){const{TypedSupabaseAdapter:e}=yield Rw();return new e})}static getItems(e){return vt(this,null,function*(){const t="Fetching inventory items";Qc.getFilterSummary(e);try{if(!Qc.validateFilters(e))throw new Error("Invalid filter parameters");const s=yield(yield this.getTypedAdapter()).getAllItems({filters:e,orderBy:{column:"created_at",ascending:!1}});if(!s.success||!Array.isArray(s.data))throw new Error(s.error||"Failed to fetch inventory items");const i=s.data;return ze.logSuccess(t,`${i.length} items`),{data:i,error:null,count:s.processedCount}}catch(r){throw console.error("❌ InventoryCrudOperations.getItems failed:",r),ze.logFailure(t,r),r}})}static getItemById(e){return vt(this,null,function*(){const t=`Fetching inventory item by ID: ${e}`;try{const s=yield(yield this.getTypedAdapter()).getItemById(e);if(!s.success||!s.data)throw new Error(s.error||"Failed to fetch inventory item");const i=s.data;return ze.logSuccess(t,i.name||"Unknown"),i}catch(r){throw ze.logFailure(t,r),r}})}static createItem(e){return vt(this,null,function*(){var t,r,s,i,l,c;const o=`Creating inventory item: ${e.name}`;try{const u=yield(yield this.getTypedAdapter()).createItem({facility_id:e.facility_id||"",name:e.name||"",quantity:(t=e.quantity)!=null?t:void 0,data:(r=e.data)!=null?r:void 0,reorder_point:(s=e.reorder_point)!=null?s:void 0,expiration_date:(i=e.expiration_date)!=null?i:void 0,unit_cost:(l=e.unit_cost)!=null?l:void 0,category:(c=e.category)!=null?c:void 0});if(!u.success||!u.data)throw new Error(u.error||"Failed to create inventory item");return ze.logSuccess(o,u.data.name||"Unknown"),u.data}catch(d){throw ze.logFailure(o,d),d}})}static updateItem(e,t){return vt(this,null,function*(){var r,s,i,l,c,o,d;try{const m=yield(yield this.getTypedAdapter()).updateItem(e,{name:(r=t.name)!=null?r:void 0,quantity:(s=t.quantity)!=null?s:void 0,data:(i=t.data)!=null?i:void 0,reorder_point:(l=t.reorder_point)!=null?l:void 0,expiration_date:(c=t.expiration_date)!=null?c:void 0,unit_cost:(o=t.unit_cost)!=null?o:void 0,category:(d=t.category)!=null?d:void 0});if(!m.success||!m.data)throw new Error(m.error||"Failed to update inventory item");return m.data}catch(u){throw console.error("❌ Failed to update item in Supabase:",u),u}})}static deleteItem(e){return vt(this,null,function*(){const t=`Deleting inventory item: ${e}`;try{const s=yield(yield this.getTypedAdapter()).deleteItem(e);if(!s.success)throw new Error(s.error||"Failed to delete inventory item");ze.logSuccess(t,`Deleted ${e}`)}catch(r){throw ze.logFailure(t,r),r}})}static archiveItem(e,t){return vt(this,null,function*(){const r=`Archiving inventory item: ${e}`;try{const{data:{user:s}}=yield _.auth.getUser();if(!s)throw new Error("User not authenticated");const l=yield(yield this.getTypedAdapter()).updateItem(e,{archived:!0,archived_at:new Date().toISOString(),archived_by:s.id,archive_reason:t||"User requested deletion"});if(!l.success)throw new Error(l.error||"Failed to archive inventory item");ze.logSuccess(r,`Archived ${e}`)}catch(s){throw ze.logFailure(r,s),s}})}static getCategories(){return vt(this,null,function*(){const e="Fetching inventory categories";try{const r=yield(yield this.getTypedAdapter()).getAllItems();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch categories");const s=Array.from(new Set(r.data.map(i=>i.category).filter(i=>!!i)));return ze.logSuccess(e,`${s.length} categories`),s}catch(t){throw ze.logFailure(e,t),t}})}static getLocations(){return vt(this,null,function*(){const e="Fetching inventory locations";try{const r=yield(yield this.getTypedAdapter()).getAllItems();if(!r.success||!r.data)throw new Error(r.error||"Failed to fetch locations");const s=Array.from(new Set(r.data.map(i=>{const l=i.data;return l==null?void 0:l.location}).filter(i=>!!i)));return ze.logSuccess(e,`${s.length} locations`),s}catch(t){throw ze.logFailure(e,t),t}})}static getAnalytics(){return vt(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),r=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:s,error:i}=yield _.from("inventory_items").select("*").eq("facility_id",r);if(i)throw console.error("❌ Error fetching analytics from Supabase:",i),$w(i);const l=s||[],c=l.length,o=l.length,d=l.reduce((m,p)=>m+(p.unit_cost||0),0),u={};return l.forEach(m=>{const p=m.category;p&&(u[p]=(u[p]||0)+1)}),{totalItems:c,activeItems:o,totalValue:d,categories:u}}catch(e){throw console.error("❌ Failed to fetch analytics from Supabase:",e),e}})}}var za=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function Mw(n){return za(this,null,function*(){try{const{data:e,error:t}=yield _.from("suppliers").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getSuppliersByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting suppliers by facility:",e),{data:null,error:e}}})}function Fw(n){return za(this,null,function*(){try{const{data:e,error:t}=yield _.from("inventory_transactions").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getInventoryTransactionsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory transactions by facility:",e),{data:null,error:e}}})}function Lw(n){return za(this,null,function*(){try{const{data:e,error:t}=yield _.from("inventory_costs").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getInventoryCostsByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting inventory costs by facility:",e),{data:null,error:e}}})}function zw(n){return za(this,null,function*(){try{const{data:e,error:t}=yield _.from("equipment_maintenance").select("*").eq("facility_id",n);return t?(console.error("InventoryActionService getEquipmentMaintenanceByFacility error:",t),{data:null,error:t}):{data:e,error:null}}catch(e){return console.error("Error getting equipment maintenance by facility:",e),{data:null,error:e}}})}function Xh(n){const e=[];return(!n.name||n.name.trim().length===0)&&e.push("Name is required"),(!n.category||n.category.trim().length===0)&&e.push("Category is required"),(!n.location||n.location.trim().length===0)&&e.push("Location is required"),n.quantity!==void 0&&n.quantity<0&&e.push("Quantity cannot be negative"),n.quantity!==void 0&&n.quantity<0&&e.push("Minimum quantity cannot be negative"),n.quantity!==void 0&&n.quantity<0&&e.push("Maximum quantity cannot be negative"),n.quantity!==void 0&&n.quantity!==void 0&&n.quantity>n.quantity&&e.push("Minimum quantity cannot be greater than maximum quantity"),n.cost!==void 0&&n.cost<0&&e.push("Cost cannot be negative"),n.expiration_date&&new Date(n.expiration_date)<new Date&&e.push("Expiration date cannot be in the past"),n.serialNumber&&n.serialNumber.trim().length===0&&e.push("Serial number cannot be empty"),n.barcode&&n.barcode.trim().length===0&&e.push("Barcode cannot be empty"),{isValid:e.length===0,errors:e}}function Ea(n){var e,t,r,s,i,l,c;const o={name:(e=n.name)==null?void 0:e.trim(),description:(t=n.description)==null?void 0:t.trim(),category:(r=n.category)==null?void 0:r.trim(),location:(s=n.location)==null?void 0:s.trim(),status:n.status||"available",quantity:n.quantity||0,cost:n.cost||0,supplier:(i=n.supplier)==null?void 0:i.trim(),serialNumber:(l=n.serialNumber)==null?void 0:l.trim(),barcode:(c=n.barcode)==null?void 0:c.trim(),expiration_date:n.expiration_date,lastUpdated:new Date().toISOString()};return Object.keys(o).forEach(d=>{o[d]===void 0&&delete o[d]}),o}var Bw=Object.defineProperty,qw=Object.defineProperties,Uw=Object.getOwnPropertyDescriptors,Yc=Object.getOwnPropertySymbols,Hw=Object.prototype.hasOwnProperty,Vw=Object.prototype.propertyIsEnumerable,Jc=(n,e,t)=>e in n?Bw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ww=(n,e)=>{for(var t in e||(e={}))Hw.call(e,t)&&Jc(n,t,e[t]);if(Yc)for(var t of Yc(e))Vw.call(e,t)&&Jc(n,t,e[t]);return n},Gw=(n,e)=>qw(n,Uw(e)),ve=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function Zh(n){return ve(this,null,function*(){try{return(yield je.getItems(n)).data||[]}catch(e){throw console.error("Error getting items:",e),new Error("Failed to get items")}})}function ep(n){return ve(this,null,function*(){try{return yield je.getItemById(n)}catch(e){throw console.error("Error getting item by ID:",e),new Error("Failed to get item by ID")}})}function Ao(n){return ve(this,null,function*(){try{return(yield je.getItems({category:n})).data||[]}catch(e){throw console.error("Error getting items by category:",e),new Error("Failed to get items by category")}})}function tp(n){return ve(this,null,function*(){try{return(yield je.getItems({location:n})).data||[]}catch(e){throw console.error("Error getting items by location:",e),new Error("Failed to get items by location")}})}function rp(n){return ve(this,null,function*(){try{return(yield je.getItems({status:n})).data||[]}catch(e){throw console.error("Error getting items by status:",e),new Error("Failed to get items by status")}})}function np(n){return ve(this,null,function*(){try{return(yield je.getItems({search:n})).data||[]}catch(e){throw console.error("Error searching items:",e),new Error("Failed to search items")}})}function sp(){return ve(this,null,function*(){try{return(yield je.getItems({})).data||[]}catch(n){throw console.error("Error getting low stock items:",n),new Error("Failed to get low stock items")}})}function ap(n=30){return ve(this,null,function*(){try{return(yield je.getItems({})).data||[]}catch(e){throw console.error("Error getting expiring items:",e),new Error("Failed to get expiring items")}})}function ip(n){return ve(this,null,function*(){try{const e=Ea(n);return yield je.createItem(e)}catch(e){throw console.error("Error creating item:",e),new Error("Failed to create item")}})}function Ta(n,e){return ve(this,null,function*(){try{if(!n)throw new Error("Item ID is required");const t=Ea(e);return yield je.updateItem(n,t)}catch(t){throw console.error("Error updating item:",t),new Error("Failed to update item")}})}function Na(n){return ve(this,null,function*(){try{if(!n)throw new Error("Item ID is required");yield je.deleteItem(n)}catch(e){throw console.error("Error deleting item:",e),new Error("Failed to delete item")}})}function op(n){return ve(this,null,function*(){try{if(!n)throw new Error("Item ID is required");return yield je.updateItem(n,{status:"archived",lastUpdated:new Date().toISOString()})}catch(e){throw console.error("Error archiving item:",e),new Error("Failed to archive item")}})}function lp(n){return ve(this,null,function*(){try{if(!n)throw new Error("Item ID is required");const e=yield je.getItemById(n);if(!e)throw new Error("Original item not found");const t=Gw(Ww({},e),{name:`${e.name} (Copy)`,id:void 0,lastUpdated:void 0});return yield je.createItem(t)}catch(e){throw console.error("Error duplicating item:",e),new Error("Failed to duplicate item")}})}function cp(n,e){return ve(this,null,function*(){try{const r=(yield Ao(n)).map(l=>je.updateItem(l.id,e));return{updatedCount:(yield Promise.allSettled(r)).filter(l=>l.status==="fulfilled").length}}catch(t){throw console.error("Error in bulk update by category:",t),new Error("Failed to bulk update items by category")}})}function dp(n){return ve(this,null,function*(){try{return yield Mw(n)}catch(e){throw console.error("Error getting suppliers by facility:",e),new Error("Failed to get suppliers by facility")}})}function up(n){return ve(this,null,function*(){try{return yield Fw(n)}catch(e){throw console.error("Error getting inventory transactions by facility:",e),new Error("Failed to get inventory transactions by facility")}})}function mp(n){return ve(this,null,function*(){try{return yield Lw(n)}catch(e){throw console.error("Error getting inventory costs by facility:",e),new Error("Failed to get inventory costs by facility")}})}function hp(n){return ve(this,null,function*(){try{return yield zw(n)}catch(e){throw console.error("Error getting equipment maintenance by facility:",e),new Error("Failed to get equipment maintenance by facility")}})}const BR=Object.freeze(Object.defineProperty({__proto__:null,archiveItem:op,bulkUpdateItemsByCategory:cp,createItem:ip,deleteItem:Na,duplicateItem:lp,getEquipmentMaintenanceByFacilityDb:hp,getExpiringItems:ap,getInventoryCostsByFacilityDb:mp,getInventoryTransactionsByFacilityDb:up,getItemById:ep,getItems:Zh,getItemsByCategory:Ao,getItemsByLocation:tp,getItemsByStatus:rp,getLowStockItems:sp,getSuppliersByFacilityDb:dp,searchItems:np,updateItem:Ta},Symbol.toStringTag,{value:"Module"}));class tr{static generateCacheKey(e,t){var r,s;const i=e.length+"_"+((r=e[0])==null?void 0:r.id)+"_"+((s=e[e.length-1])==null?void 0:s.id),l=JSON.stringify(t);return`${i}_${l}`}static getCachedResult(e){return this.EXPORT_CACHE.get(e)}static hasCachedResult(e){return this.EXPORT_CACHE.has(e)}static cacheExportResult(e,t){if(this.EXPORT_CACHE.size>=this.CACHE_MAX_SIZE){const r=this.EXPORT_CACHE.keys().next().value;r&&this.EXPORT_CACHE.delete(r)}this.EXPORT_CACHE.set(e,t)}static getCacheStats(){return{size:this.EXPORT_CACHE.size,maxSize:this.CACHE_MAX_SIZE}}static clearCache(){this.EXPORT_CACHE.clear()}static removeCachedResult(e){return this.EXPORT_CACHE.delete(e)}}tr.EXPORT_CACHE=new Map;tr.CACHE_MAX_SIZE=100;var Xc=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Zc{static standardExport(e,t){return Xc(this,null,function*(){switch(t.format){case"csv":return this.generateCSV(e,t);case"json":return this.generateJSON(e,t);case"excel":return yield this.generateExcel(e,t);default:throw new Error(`Unsupported export format: ${t.format}`)}})}static standardExportTransformed(e,t){return this.generateCSVFromTransformed(e,t,!0)}static generateCSV(e,t){const r=t.customFields||this.getDefaultCSVFields();let s="";t.includeHeaders&&(s+=r.map(i=>this.escapeCSVField(i)).join(",")+`
`);for(const i of e){const l=r.map(c=>{const o=this.getFieldValue(i,c);return this.escapeCSVField(o)});s+=l.join(",")+`
`}return s}static generateJSON(e,t){const r=t.customFields||this.getDefaultJSONFields(),s=e.map(i=>{const l={};for(const c of r)l[c]=this.getFieldValue(i,c);return l});return JSON.stringify(s,null,2)}static generateExcel(e,t){return Xc(this,null,function*(){const r=this.generateCSV(e,t);return new Blob([r],{type:"text/csv;charset=utf-8;"})})}static generateCSVFromTransformed(e,t,r){const s=t.customFields||[];let i="";r&&t.includeHeaders&&(i+=s.map(l=>this.escapeCSVField(l)).join(",")+`
`);for(const l of e){const c=s.map(o=>{const d=l[o]||"";return this.escapeCSVField(String(d))});i+=c.join(",")+`
`}return i}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r!==null&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}}class sr{static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory;return(e==null?void 0:e.usedJSHeapSize)||0}return 0}static getMemoryStats(){const e=this.getMemoryUsage();let t;if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const r=performance.memory;t=r==null?void 0:r.jsHeapSizeLimit}return{current:e,limit:t}}static isMemoryUsageHigh(e){const t=this.getMemoryUsage(),r=e||this.DEFAULT_MAX_MEMORY;return t>r}static forceGarbageCollection(){typeof window!="undefined"&&"gc"in window&&typeof window.gc=="function"&&window.gc()}static getDefaultMaxMemory(){return this.DEFAULT_MAX_MEMORY}}sr.DEFAULT_MAX_MEMORY=50*1024*1024;var ed=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class lo{static streamingExport(e,t){return ed(this,null,function*(){const r=t.chunkSize||this.DEFAULT_CHUNK_SIZE,s=[];for(let i=0;i<e.length;i+=r){const l=e.slice(i,i+r);sr.isMemoryUsageHigh(t.maxMemoryUsage)&&sr.forceGarbageCollection();let c;switch(t.format){case"csv":c=this.generateCSVChunk(l,t,i===0);break;case"json":c=this.generateJSONChunk(l,t,i===0,i+r>=e.length);break;default:throw new Error(`Streaming not supported for format: ${t.format}`)}s.push(c),i%(r*10)===0&&(yield new Promise(o=>setTimeout(o,0)))}return s.join("")})}static streamingExportTransformed(e,t){return ed(this,null,function*(){const r=[],s=t.chunkSize||this.DEFAULT_CHUNK_SIZE;for(let i=0;i<e.length;i+=s){const l=e.slice(i,i+s),c=this.generateCSVFromTransformed(l,t,i===0);r.push(c),i%(s*10)===0&&(yield new Promise(o=>setTimeout(o,0)))}return r.join("")})}static generateCSVChunk(e,t,r){const s=t.customFields||this.getDefaultCSVFields();let i="";r&&t.includeHeaders&&(i+=s.map(l=>this.escapeCSVField(l)).join(",")+`
`);for(const l of e){const c=s.map(o=>{const d=this.getFieldValue(l,o);return this.escapeCSVField(d)});i+=c.join(",")+`
`}return i}static generateJSONChunk(e,t,r,s){const i=t.customFields||this.getDefaultJSONFields();let l="";r&&(l+=`[
`);const c=e.map(o=>{const d={};for(const u of i)d[u]=this.getFieldValue(o,u);return d});return l+=c.map(o=>"  "+JSON.stringify(o)).join(`,
`),s?l+=`
]`:l+=`,
`,l}static generateCSVFromTransformed(e,t,r){const s=t.customFields||[];let i="";r&&t.includeHeaders&&(i+=s.map(l=>this.escapeCSVField(l)).join(",")+`
`);for(const l of e){const c=s.map(o=>{const d=l[o]||"";return this.escapeCSVField(String(d))});i+=c.join(",")+`
`}return i}static getDefaultCSVFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","lastUpdated"]}static getDefaultJSONFields(){return["id","item","category","location","status","quantity","cost","vendor","purchaseDate","warranty","maintenanceSchedule","lastServiced","nextDue","serviceProvider","assignedTo","notes","lastUpdated"]}static getFieldValue(e,t){const r=e[t];return r==null?"":typeof r=="object"?JSON.stringify(r):r&&typeof r=="object"&&r!==null&&r instanceof Date?r.toISOString().split("T")[0]:String(r)}static escapeCSVField(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}lo.DEFAULT_CHUNK_SIZE=1e3;class Gn{static createDownloadUrl(e,t){const r=typeof e=="string"?new Blob([e],{type:"text/plain"}):e,s=URL.createObjectURL(r),i=document.createElement("a");return i.href=s,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>URL.revokeObjectURL(s),1e3),s}static getDataSize(e){return typeof e=="string"?new Blob([e]).size:e.size}static getDateString(){return new Date().toISOString().split("T")[0]}static generateFileName(e,t){const r=this.getDateString();return`${e}_${r}.${t}`}static revokeUrl(e){URL.revokeObjectURL(e)}}class Kn{static validateExportOptions(e){const t=[];return(!e.format||!["csv","json","excel"].includes(e.format))&&t.push("Invalid export format. Must be csv, json, or excel."),e.customFields&&!Array.isArray(e.customFields)&&t.push("Custom fields must be an array of strings."),e.chunkSize!==void 0&&(e.chunkSize<1||e.chunkSize>1e4)&&t.push("Chunk size must be between 1 and 10000."),e.maxMemoryUsage!==void 0&&e.maxMemoryUsage<1024*1024&&t.push("Max memory usage must be at least 1MB."),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to export."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateTemplate(e){const t=[];if(e||t.push("Template is required."),e&&typeof e=="object"&&"format"in e){const r=e.format;["csv","json","excel"].includes(r)||t.push("Template format must be csv, json, or excel.")}return{isValid:t.length===0,errors:t}}}var td=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class pp{static exportItems(e){return td(this,arguments,function*(t,r={format:"csv",includeHeaders:!0}){const s=Date.now(),i=sr.getMemoryUsage();try{const l=Kn.validateItems(t);if(!l.isValid)throw new Error(l.errors.join(", "));const c=Kn.validateExportOptions(r);if(!c.isValid)throw new Error(c.errors.join(", "));const o=tr.generateCacheKey(t,r);if(tr.hasCachedResult(o))return console.log("Export cache hit"),tr.getCachedResult(o);let d;r.enableStreaming&&t.length>this.DEFAULT_CHUNK_SIZE?d=yield lo.streamingExport(t,r):d=yield Zc.standardExport(t,r);const u=Gn.generateFileName("inventory_export",r.format),m=Gn.createDownloadUrl(d,u),p=Date.now(),f=sr.getMemoryUsage(),g={success:!0,fileName:u,dataSize:Gn.getDataSize(d),itemCount:t.length,format:r.format,downloadUrl:m,processingTime:p-s,memoryUsage:f-i};return tr.cacheExportResult(o,g),g}catch(l){throw console.error("Export failed:",l),new Error(`Export failed: ${l instanceof Error?l.message:"Unknown error"}`)}})}static exportWithTemplate(e,t){return td(this,null,function*(){const r=Date.now(),s=sr.getMemoryUsage();try{const i=Kn.validateItems(e);if(!i.isValid)throw new Error(i.errors.join(", "));const l=Kn.validateTemplate(t);if(!l.isValid)throw new Error(l.errors.join(", "));if(!e||e.length===0)throw new Error("No items to export");const{InventoryExportTemplateService:c}=yield L(()=>import("./inventoryExportTemplateService-B91rpcBB.js"),[]),o=c.applyTemplate(e,t),d=c.generateFileName(t),u={format:t.format,includeHeaders:t.includeHeaders,dateFormat:t.dateFormat,customFields:t.fields.map(y=>String(y.key)),enableStreaming:e.length>this.DEFAULT_CHUNK_SIZE,chunkSize:this.DEFAULT_CHUNK_SIZE};let m;u.enableStreaming?m=yield lo.streamingExportTransformed(o,u):m=Zc.standardExportTransformed(o,u);const p=Gn.createDownloadUrl(m,d),f=Date.now(),g=sr.getMemoryUsage();return{success:!0,fileName:d,dataSize:Gn.getDataSize(m),itemCount:o.length,format:t.format,downloadUrl:p,processingTime:f-r,memoryUsage:g-s}}catch(i){throw console.error("Template export failed:",i),new Error(`Template export failed: ${i instanceof Error?i.message:"Unknown error"}`)}})}static validateExportOptions(e){return Kn.validateExportOptions(e)}static getCacheStats(){return tr.getCacheStats()}static clearCache(){tr.clearCache()}static getMemoryStats(){return sr.getMemoryStats()}static getDefaultChunkSize(){return this.DEFAULT_CHUNK_SIZE}}pp.DEFAULT_CHUNK_SIZE=1e3;class Kw{constructor(){this.cache={data:null,timestamp:0,ttl:300*1e3,hits:0,misses:0,evictions:0}}get(){return this.cache.data&&Date.now()-this.cache.timestamp<this.cache.ttl?(this.cache.hits++,this.cache.data):(this.cache.misses++,null)}set(e){this.cache.data=e,this.cache.timestamp=Date.now()}clear(){this.cache.data&&this.cache.evictions++,this.cache.data=null,this.cache.timestamp=0}getStats(){return{hits:this.cache.hits,misses:this.cache.misses,size:this.cache.data?JSON.stringify(this.cache.data).length:0,lastUpdated:new Date(this.cache.timestamp).toISOString(),updated_at:new Date(this.cache.timestamp).toISOString()}}isValid(){return!!(this.cache.data&&Date.now()-this.cache.timestamp<this.cache.ttl)}}var rd=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Q{static handleOperation(e,t){return rd(this,null,function*(){try{return yield t()}catch(r){throw console.error(`❌ ${e} failed:`,r),r}})}static executeWithRetry(e,t,r=3){return rd(this,null,function*(){let s=null;for(let i=1;i<=r;i++)try{return yield t()}catch(l){if(s=l instanceof Error?l:new Error("Unknown error"),i===r)throw l;console.warn(`Retry attempt ${i}/${r} for operation: ${e}`),yield new Promise(c=>setTimeout(c,1e3*i))}throw s||new Error("Operation failed after all retry attempts")})}static delay(e){return new Promise(t=>setTimeout(t,e))}}class Oo{constructor(){this.cacheManagers=new Map}static getInstance(){return this.instance||(this.instance=new Oo),this.instance}registerCacheManager(e,t){this.cacheManagers.set(e,t),console.log(`📝 Registered cache manager: ${e}`)}unregisterCacheManager(e){this.cacheManagers.delete(e),console.log(`📝 Unregistered cache manager: ${e}`)}onInvalidation(){console.log("📝 Cache invalidation listener registered (simplified)")}offInvalidation(){console.log("📝 Cache invalidation listener removed (simplified)")}invalidatePattern(e){console.log(`🧹 Invalidating cache pattern: ${e}`),this.cacheManagers.forEach((t,r)=>{(r.includes(e)||e==="all")&&(t.invalidatePattern?t.invalidatePattern(e):t.clearCache())})}invalidateKey(e){console.log(`🧹 Invalidating cache key: ${e}`),this.cacheManagers.forEach(t=>{t.invalidateKey&&t.invalidateKey(e)})}invalidateRelated(e,t){console.log(`🧹 Invalidating related caches for operation: ${e}${t?` (${t})`:""}`),e.startsWith("inventory:")?this.invalidatePattern("inventory"):e.startsWith("knowledge:")?this.invalidatePattern("knowledge"):e.startsWith("cleaning:")?this.invalidatePattern("cleaning"):(e==="user:login"||e==="user:logout"||e==="app:refresh")&&this.clearAllCaches()}clearAllCaches(){console.log("🧹 Clearing all caches"),this.cacheManagers.forEach(e=>{e.clearCache()})}getRegisteredManagers(){return Array.from(this.cacheManagers.keys())}isRegistered(e){return this.cacheManagers.has(e)}}const ye=Oo.getInstance();var Qw=Object.defineProperty,nd=Object.getOwnPropertySymbols,Yw=Object.prototype.hasOwnProperty,Jw=Object.prototype.propertyIsEnumerable,sd=(n,e,t)=>e in n?Qw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Qn=(n,e)=>{for(var t in e||(e={}))Yw.call(e,t)&&sd(n,t,e[t]);if(nd)for(var t of nd(e))Jw.call(e,t)&&sd(n,t,e[t]);return n},Ks=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class me{static initialize(){this.flushInterval=setInterval(()=>{this.flushQueues()},3e4),this.setupErrorHandlers(),console.log("Monitoring service initialized")}static logEvent(e,t,r,s="info",i){const l={category:e,action:t,level:s,message:r,metadata:i,timestamp:new Date().toISOString()};this.eventQueue.push(l),s==="error"&&this.flushQueues()}static trackMetric(e,t,r,s,i){const l={name:e,value:t,unit:r,category:s,timestamp:new Date().toISOString(),metadata:i};this.metricQueue.push(l),this.metricQueue.length>=this.MAX_BATCH_SIZE&&this.flushQueues()}static reportError(e,t,r){const s={error:e,context:t,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),metadata:r};this.errorQueue.push(s),console.error(`[ERROR] ${t}:`,e,r),this.flushQueues()}static trackUserAction(e,t,r){this.logEvent(t,e,`User performed ${e}`,"info",r)}static trackApiCall(e,t,r,s,i){this.trackMetric("api_call_duration",r,"ms","api",Qn({endpoint:e,method:t,status:s},i)),r>1e3&&this.logEvent("api","slow_request",`Slow API call: ${t} ${e} took ${r}ms`,"warn",Qn({endpoint:e,method:t,duration:r,status:s},i)),s>=400&&this.logEvent("api","failed_request",`Failed API call: ${t} ${e} returned ${s}`,"error",Qn({endpoint:e,method:t,status:s},i))}static trackPageView(e,t){this.logEvent("navigation","page_view",`User viewed ${e}`,"info",Qn({page:e},t))}static trackFeatureUsage(e,t,r){this.logEvent("feature",t,`Feature used: ${e}`,"info",Qn({feature:e},r))}static flushQueues(){return Ks(this,null,function*(){try{if(!jt()){console.warn("⚠️ Supabase not configured, skipping monitoring queue flush");return}this.eventQueue.length>0&&(yield this.flushEvents()),this.metricQueue.length>0&&(yield this.flushMetrics()),this.errorQueue.length>0&&(yield this.flushErrors())}catch(e){console.error("Failed to flush monitoring queues:",e)}})}static flushEvents(){return Ks(this,null,function*(){const e=this.eventQueue.splice(0,this.MAX_BATCH_SIZE);console.log("📊 Monitoring: Would flush",e.length,"events (disabled for debugging)");const{data:{user:t}}=yield _.auth.getUser();let r=null;if(t){const{data:s}=yield _.from("users").select("facility_id").eq("id",t.id).single();r=(s==null?void 0:s.facility_id)||null}console.log("📊 Monitoring: User context:",{userId:t==null?void 0:t.id,facilityId:r,eventsQueued:this.eventQueue.length})})}static flushMetrics(){return Ks(this,null,function*(){const e=this.metricQueue.splice(0,this.MAX_BATCH_SIZE),{data:{user:t}}=yield _.auth.getUser();let r=null;if(t){const{data:i}=yield _.from("users").select("facility_id").eq("id",t.id).single();r=(i==null?void 0:i.facility_id)||null}const{error:s}=yield _.from("monitoring_performance_metrics").insert(e.map(i=>({metric_name:i.name,metric_value:i.value,facility_id:r||"default",created_at:i.timestamp})));s&&(console.error("Failed to flush performance metrics:",s),this.metricQueue.unshift(...e))})}static flushErrors(){return Ks(this,null,function*(){const e=this.errorQueue.splice(0,this.MAX_BATCH_SIZE),{data:{user:t}}=yield _.auth.getUser();let r=null;if(t){const{data:i}=yield _.from("users").select("facility_id").eq("id",t.id).single();r=(i==null?void 0:i.facility_id)||null}const{error:s}=yield _.from("error_reports").insert(e.map(i=>({error_message:i.error instanceof Error?i.error.message:i.error,error_stack:i.error instanceof Error?i.error.stack:void 0,context:i.context,user_agent:i.userAgent,metadata:i.metadata,user_id:(t==null?void 0:t.id)||null,facility_id:r,created_at:i.timestamp})));s&&(console.error("Failed to flush error reports:",s),this.errorQueue.unshift(...e))})}static setupErrorHandlers(){window.addEventListener("unhandledrejection",e=>{this.reportError(e.reason,"unhandled_promise_rejection",{promise:e.promise})}),window.addEventListener("error",e=>{this.reportError(e.error||new Error(e.message),"javascript_error",{filename:e.filename,lineno:e.lineno,colno:e.colno})})}static cleanup(){this.flushInterval&&(clearInterval(this.flushInterval),this.flushInterval=null),this.flushQueues()}}me.MAX_BATCH_SIZE=50;me.eventQueue=[];me.metricQueue=[];me.errorQueue=[];me.flushInterval=null;const se=me.logEvent.bind(me);me.trackMetric.bind(me);me.reportError.bind(me);const ie=me.trackUserAction.bind(me);me.trackApiCall.bind(me);me.trackPageView.bind(me);me.trackFeatureUsage.bind(me);typeof window!="undefined"&&me.initialize();var Xw=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class H{static trackEvent(e,t){return Xw(this,null,function*(){try{console.log("Analytics Event:",{eventName:e,properties:t,timestamp:new Date})}catch(r){console.warn("Failed to track analytics event:",r)}})}}var Zw=Object.defineProperty,eS=Object.defineProperties,tS=Object.getOwnPropertyDescriptors,ad=Object.getOwnPropertySymbols,rS=Object.prototype.hasOwnProperty,nS=Object.prototype.propertyIsEnumerable,id=(n,e,t)=>e in n?Zw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,sS=(n,e)=>{for(var t in e||(e={}))rS.call(e,t)&&id(n,t,e[t]);if(ad)for(var t of ad(e))nS.call(e,t)&&id(n,t,e[t]);return n},aS=(n,e)=>eS(n,tS(e)),et=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function iS(n){return zt.categorizeItems(n)}function oS(n){return zt.withNormalizedCategory(n)}class zt{constructor(e,t){this.adapter=e,this.adapterType=t}static normalizeCategory(e){const t=e.toLowerCase().trim();return t.includes("mask")||t.includes("glove")||t.includes("gown")||t.includes("supply")?"Supplies":t.includes("scalpel")||t.includes("forceps")||t.includes("tool")||t.includes("instrument")?"Tools":t.includes("chair")||t.includes("autoclave")||t.includes("machine")||t.includes("equipment")?"Equipment":t.includes("computer")||t.includes("printer")||t.includes("office")||t.includes("hardware")?"Office Hardware":"Tools"}static categorizeItems(e){const t=[],r=[],s=[],i=[];return e.forEach(l=>{switch(this.normalizeCategory(String(l.category||""))){case"Tools":t.push(l);break;case"Supplies":r.push(l);break;case"Equipment":s.push(l);break;case"Office Hardware":i.push(l);break;default:t.push(l);break}}),{tools:t,supplies:r,equipment:s,officeHardware:i}}static withNormalizedCategory(e){return e.map(t=>aS(sS({},t),{category:this.normalizeCategory(t.category)}))}addCategory(e){return et(this,null,function*(){return{success:yield Q.handleOperation("addCategory",()=>et(this,null,function*(){return yield this.adapter.addCategory(e),ye.invalidateRelated("inventory:categories",e),se("inventory","category_created",`Category created: ${e}`,"info",{category:e,adapterType:this.adapterType}),ie("create_category","inventory",{category:e}),H.trackEvent("inventory_category_created",{category:e,adapterType:this.adapterType}),!0})),error:null}})}deleteCategory(e){return et(this,null,function*(){return{success:yield Q.handleOperation("deleteCategory",()=>et(this,null,function*(){return yield this.adapter.deleteCategory(e),ye.invalidateRelated("inventory:categories",e),se("inventory","category_deleted",`Category deleted: ${e}`,"info",{category:e,adapterType:this.adapterType}),ie("delete_category","inventory",{category:e}),H.trackEvent("inventory_category_deleted",{category:e,adapterType:this.adapterType}),!0})),error:null}})}getCategories(){return et(this,null,function*(){return{data:yield Q.handleOperation("getCategories",()=>et(this,null,function*(){return yield this.adapter.fetchCategories()})),error:null}})}getNormalizedCategories(){return et(this,null,function*(){return{data:yield Q.handleOperation("getNormalizedCategories",()=>et(this,null,function*(){const r=(yield this.adapter.fetchCategories()).map(s=>zt.normalizeCategory(s));return Array.from(new Set(r))})),error:null}})}getCategoryStats(){return et(this,null,function*(){return{data:yield Q.handleOperation("getCategoryStats",()=>et(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(s=>{const i=zt.normalizeCategory(s.category||"");r[i]=(r[i]||0)+1}),r})),error:null}})}static validateCategoryName(e){const t=[];return(!e||e.trim()==="")&&t.push("Category name is required"),e.length>100&&t.push("Category name must be less than 100 characters"),/^[a-zA-Z0-9\s\-_]+$/.test(e)||t.push("Category name contains invalid characters"),{isValid:t.length===0,errors:t}}static getCategorySuggestions(e){const t=e.toLowerCase(),r=[];return(t.includes("mask")||t.includes("glove")||t.includes("gown"))&&r.push("Supplies"),(t.includes("scalpel")||t.includes("forceps")||t.includes("tool"))&&r.push("Tools"),(t.includes("chair")||t.includes("autoclave")||t.includes("machine"))&&r.push("Equipment"),(t.includes("computer")||t.includes("printer")||t.includes("office"))&&r.push("Office Hardware"),r.length===0&&r.push("Tools","Supplies","Equipment","Office Hardware"),r}mergeCategories(e,t){return et(this,null,function*(){return{success:yield Q.handleOperation("mergeCategories",()=>et(this,null,function*(){const i=(yield this.adapter.fetchInventoryItems()).filter(o=>o.category===e);for(const o of i)yield this.adapter.updateInventoryItem(o.id,{category:t});return(yield this.adapter.fetchInventoryItems()).some(o=>o.category===e)||(yield this.adapter.deleteCategory(e)),se("inventory","category_merged",`Category merged: ${e} -> ${t}`,"info",{sourceCategory:e,targetCategory:t,itemsUpdated:i.length,adapterType:this.adapterType}),ie("merge_category","inventory",{sourceCategory:e,targetCategory:t,itemsUpdated:i.length}),H.trackEvent("inventory_category_merged",{sourceCategory:e,targetCategory:t,itemsUpdated:i.length,adapterType:this.adapterType}),!0})),error:null}})}}var lS=Object.defineProperty,cS=Object.defineProperties,dS=Object.getOwnPropertyDescriptors,od=Object.getOwnPropertySymbols,uS=Object.prototype.hasOwnProperty,mS=Object.prototype.propertyIsEnumerable,ld=(n,e,t)=>e in n?lS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,hS=(n,e)=>{for(var t in e||(e={}))uS.call(e,t)&&ld(n,t,e[t]);if(od)for(var t of od(e))mS.call(e,t)&&ld(n,t,e[t]);return n},pS=(n,e)=>cS(n,dS(e)),fe=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class fS{constructor(e,t){this.adapter=e,this.adapterType=t}fetchInventoryItems(){return fe(this,null,function*(){return yield Q.handleOperation("fetchInventoryItems",()=>fe(this,null,function*(){return yield this.adapter.fetchInventoryItems()}))})}getItemById(e){return fe(this,null,function*(){return yield Q.handleOperation("getItemById",()=>fe(this,null,function*(){return{data:(yield this.adapter.fetchInventoryItems()).find(i=>i.id===e)||null,error:null}}))})}createItem(e){return fe(this,null,function*(){return{data:yield Q.handleOperation("createItem",()=>fe(this,null,function*(){const r=yield this.adapter.addInventoryItem(e);return ye.invalidateRelated("inventory:create",r.id),se("inventory","item_created",`Inventory item created: ${e.name||e.item}`,"info",{itemId:r.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),ie("create_item","inventory",{itemId:r.id,itemName:e.name||e.item,category:e.category}),H.trackEvent("inventory_item_created",{itemId:r.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),r})),error:null}})}updateItem(e,t){return fe(this,null,function*(){return{data:yield Q.handleOperation("updateItem",()=>fe(this,null,function*(){const s=yield this.adapter.updateInventoryItem(e,t);return ye.invalidateRelated("inventory:update",e),se("inventory","item_updated",`Inventory item updated: ${e}`,"info",{itemId:e,updates:Object.keys(t),adapterType:this.adapterType}),ie("update_item","inventory",{itemId:e,updates:Object.keys(t)}),H.trackEvent("inventory_item_updated",{itemId:e,updates:Object.keys(t).join(","),adapterType:this.adapterType}),s})),error:null}})}deleteItem(e){return fe(this,null,function*(){return{success:yield Q.handleOperation("deleteItem",()=>fe(this,null,function*(){return yield this.adapter.deleteInventoryItem(e),ye.invalidateRelated("inventory:delete",e),se("inventory","item_deleted",`Inventory item deleted: ${e}`,"info",{itemId:e,adapterType:this.adapterType}),ie("delete_item","inventory",{itemId:e}),H.trackEvent("inventory_item_deleted",{itemId:e,adapterType:this.adapterType}),!0})),error:null}})}addInventoryItem(e){return fe(this,null,function*(){return yield Q.handleOperation("addInventoryItem",()=>fe(this,null,function*(){const r=yield this.adapter.addInventoryItem(e);return ye.invalidateRelated("inventory:create",e.id),se("inventory","item_created",`Inventory item created: ${e.name||e.item}`,"info",{itemId:e.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),ie("create_item","inventory",{itemId:e.id,itemName:e.name||e.item,category:e.category}),H.trackEvent("inventory_item_created",{itemId:e.id,itemName:e.name||e.item,category:e.category,adapterType:this.adapterType}),r}))})}static validateItemData(e){const t=[];return!e.name&&!e.item&&t.push("Item name is required"),e.category||t.push("Category is required"),e.quantity!==void 0&&e.quantity<0&&t.push("Quantity must be non-negative"),e.minimumStock!==void 0&&e.minimumStock<0&&t.push("Minimum stock must be non-negative"),e.location&&e.location.length>200&&t.push("Location must be less than 200 characters"),e.description&&e.description.length>1e3&&t.push("Description must be less than 1000 characters"),{isValid:t.length===0,errors:t}}duplicateItem(e,t){return fe(this,null,function*(){return{data:yield Q.handleOperation("duplicateItem",()=>fe(this,null,function*(){const s=yield this.getItemById(e);if(!s.data)throw new Error("Original item not found");const i=pS(hS({},s.data),{name:t||`${s.data.name} (Copy)`,id:""}),l=yield this.adapter.addInventoryItem(i);return ye.invalidateRelated("inventory:create",l.id),se("inventory","item_duplicated",`Inventory item duplicated: ${e} -> ${l.id}`,"info",{originalItemId:e,newItemId:l.id,adapterType:this.adapterType}),ie("duplicate_item","inventory",{originalItemId:e,newItemId:l.id}),H.trackEvent("inventory_item_duplicated",{originalItemId:e,newItemId:l.id,adapterType:this.adapterType}),l})),error:null}})}archiveItem(e,t){return fe(this,null,function*(){return{data:yield Q.handleOperation("archiveItem",()=>fe(this,null,function*(){const s=yield this.adapter.updateInventoryItem(e,{status:"archived",archiveReason:t});return ye.invalidateRelated("inventory:update",e),se("inventory","item_archived",`Inventory item archived: ${e}`,"info",{itemId:e,reason:t,adapterType:this.adapterType}),ie("archive_item","inventory",{itemId:e,reason:t}),H.trackEvent("inventory_item_archived",{itemId:e,reason:t,adapterType:this.adapterType}),s})),error:null}})}restoreItem(e){return fe(this,null,function*(){return{data:yield Q.handleOperation("restoreItem",()=>fe(this,null,function*(){const r=yield this.adapter.updateInventoryItem(e,{status:"active",archiveReason:null});return ye.invalidateRelated("inventory:update",e),se("inventory","item_restored",`Inventory item restored: ${e}`,"info",{itemId:e,adapterType:this.adapterType}),ie("restore_item","inventory",{itemId:e}),H.trackEvent("inventory_item_restored",{itemId:e,adapterType:this.adapterType}),r})),error:null}})}}var Be=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class gS{constructor(e,t){this.adapter=e,this.adapterType=t}bulkCreateItems(e){return Be(this,null,function*(){return yield Q.handleOperation("bulkCreateItems",()=>Be(this,null,function*(){const r=[],s=[];let i=0,l=0;for(const c of e)try{const o=yield this.adapter.addInventoryItem(c);r.push(o),ye.invalidateRelated("inventory:create",o.id),i++}catch(o){s.push(`Failed to create item ${c.name||c.item}: ${o instanceof Error?o.message:"Unknown error"}`),l++}return se("inventory","bulk_items_created",`Bulk created ${i} items, ${l} failed`,"info",{totalItems:e.length,successCount:i,errorCount:l,adapterType:this.adapterType}),ie("bulk_create_items","inventory",{totalItems:e.length,successCount:i,errorCount:l}),H.trackEvent("inventory_bulk_items_created",{totalItems:e.length,successCount:i,errorCount:l,adapterType:this.adapterType}),{success:l===0,processedCount:e.length,successCount:i,errorCount:l,errors:s,data:r}}))})}bulkUpdateItems(e){return Be(this,null,function*(){return yield Q.handleOperation("bulkUpdateItems",()=>Be(this,null,function*(){const r=[],s=[];let i=0,l=0;for(const c of e)try{const o=yield this.adapter.updateInventoryItem(c.id,c.updates);r.push(o),ye.invalidateRelated("inventory:update",c.id),i++}catch(o){s.push(`Failed to update item ${c.id}: ${o instanceof Error?o.message:"Unknown error"}`),l++}return se("inventory","bulk_items_updated",`Bulk updated ${i} items, ${l} failed`,"info",{totalItems:e.length,successCount:i,errorCount:l,adapterType:this.adapterType}),ie("bulk_update_items","inventory",{totalItems:e.length,successCount:i,errorCount:l}),H.trackEvent("inventory_bulk_items_updated",{totalItems:e.length,successCount:i,errorCount:l,adapterType:this.adapterType}),{success:l===0,processedCount:e.length,successCount:i,errorCount:l,errors:s,data:r}}))})}bulkDeleteItems(e){return Be(this,null,function*(){return yield Q.handleOperation("bulkDeleteItems",()=>Be(this,null,function*(){const r=[];let s=0,i=0;for(const l of e)try{yield this.adapter.deleteInventoryItem(l),ye.invalidateRelated("inventory:delete",l),s++}catch(c){r.push(`Failed to delete item ${l}: ${c instanceof Error?c.message:"Unknown error"}`),i++}return se("inventory","bulk_items_deleted",`Bulk deleted ${s} items, ${i} failed`,"info",{totalItems:e.length,successCount:s,errorCount:i,adapterType:this.adapterType}),ie("bulk_delete_items","inventory",{totalItems:e.length,successCount:s,errorCount:i}),H.trackEvent("inventory_bulk_items_deleted",{totalItems:e.length,successCount:s,errorCount:i,adapterType:this.adapterType}),{success:i===0,processedCount:e.length,successCount:s,errorCount:i,errors:r,data:[]}}))})}bulkArchiveItems(e,t){return Be(this,null,function*(){return yield Q.handleOperation("bulkArchiveItems",()=>Be(this,null,function*(){const s=[],i=[];let l=0,c=0;for(const o of e)try{const d=yield this.adapter.updateInventoryItem(o,{status:"archived",archiveReason:t});s.push(d),ye.invalidateRelated("inventory:update",o),l++}catch(d){i.push(`Failed to archive item ${o}: ${d instanceof Error?d.message:"Unknown error"}`),c++}return se("inventory","bulk_items_archived",`Bulk archived ${l} items, ${c} failed`,"info",{totalItems:e.length,successCount:l,errorCount:c,reason:t,adapterType:this.adapterType}),ie("bulk_archive_items","inventory",{totalItems:e.length,successCount:l,errorCount:c,reason:t}),H.trackEvent("inventory_bulk_items_archived",{totalItems:e.length,successCount:l,errorCount:c,reason:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:l,errorCount:c,errors:i,data:s}}))})}bulkRestoreItems(e){return Be(this,null,function*(){return yield Q.handleOperation("bulkRestoreItems",()=>Be(this,null,function*(){const r=[],s=[];let i=0,l=0;for(const c of e)try{const o=yield this.adapter.updateInventoryItem(c,{status:"active",archiveReason:null});r.push(o),ye.invalidateRelated("inventory:update",c),i++}catch(o){s.push(`Failed to restore item ${c}: ${o instanceof Error?o.message:"Unknown error"}`),l++}return se("inventory","bulk_items_restored",`Bulk restored ${i} items, ${l} failed`,"info",{totalItems:e.length,successCount:i,errorCount:l,adapterType:this.adapterType}),ie("bulk_restore_items","inventory",{totalItems:e.length,successCount:i,errorCount:l}),H.trackEvent("inventory_bulk_items_restored",{totalItems:e.length,successCount:i,errorCount:l,adapterType:this.adapterType}),{success:l===0,processedCount:e.length,successCount:i,errorCount:l,errors:s,data:r}}))})}bulkChangeCategory(e,t){return Be(this,null,function*(){return yield Q.handleOperation("bulkChangeCategory",()=>Be(this,null,function*(){const s=[],i=[];let l=0,c=0;for(const o of e)try{const d=yield this.adapter.updateInventoryItem(o,{category:t});s.push(d),ye.invalidateRelated("inventory:update",o),l++}catch(d){i.push(`Failed to change category for item ${o}: ${d instanceof Error?d.message:"Unknown error"}`),c++}return se("inventory","bulk_category_changed",`Bulk changed category for ${l} items, ${c} failed`,"info",{totalItems:e.length,successCount:l,errorCount:c,newCategory:t,adapterType:this.adapterType}),ie("bulk_change_category","inventory",{totalItems:e.length,successCount:l,errorCount:c,newCategory:t}),H.trackEvent("inventory_bulk_category_changed",{totalItems:e.length,successCount:l,errorCount:c,newCategory:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:l,errorCount:c,errors:i,data:s}}))})}bulkChangeLocation(e,t){return Be(this,null,function*(){return yield Q.handleOperation("bulkChangeLocation",()=>Be(this,null,function*(){const s=[],i=[];let l=0,c=0;for(const o of e)try{const d=yield this.adapter.updateInventoryItem(o,{});s.push(d),ye.invalidateRelated("inventory:update",o),l++}catch(d){i.push(`Failed to change location for item ${o}: ${d instanceof Error?d.message:"Unknown error"}`),c++}return se("inventory","bulk_location_changed",`Bulk changed location for ${l} items, ${c} failed`,"info",{totalItems:e.length,successCount:l,errorCount:c,newLocation:t,adapterType:this.adapterType}),ie("bulk_change_location","inventory",{totalItems:e.length,successCount:l,errorCount:c,newLocation:t}),H.trackEvent("inventory_bulk_location_changed",{totalItems:e.length,successCount:l,errorCount:c,newLocation:t,adapterType:this.adapterType}),{success:c===0,processedCount:e.length,successCount:l,errorCount:c,errors:i,data:s}}))})}static validateBulkOperationData(e,t){const r=[];switch((!t||t.length===0)&&r.push("No data provided for bulk operation"),t.length>1e3&&r.push("Bulk operation limited to 1000 items maximum"),e){case"create":t.forEach((s,i)=>{if(!s||typeof s!="object"){r.push(`Item ${i+1}: Invalid item data`);return}const l=s;!l.name&&!l.item&&r.push(`Item ${i+1}: Name is required`),l.category||r.push(`Item ${i+1}: Category is required`)});break;case"update":t.forEach((s,i)=>{if(!s||typeof s!="object"){r.push(`Update ${i+1}: Invalid update data`);return}const l=s;l.id||r.push(`Update ${i+1}: ID is required`),l.updates||r.push(`Update ${i+1}: Updates object is required`)});break;case"delete":case"archive":case"restore":t.forEach((s,i)=>{(typeof s!="string"||!s.trim())&&r.push(`ID ${i+1}: Valid ID is required`)});break}return{isValid:r.length===0,errors:r}}}var tt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class yS{constructor(e){this.adapter=e}searchItems(e){return tt(this,null,function*(){return yield Q.handleOperation("searchItems",()=>tt(this,null,function*(){return{data:(yield this.adapter.fetchInventoryItems()).filter(i=>{var l,c,o,d;return((l=i.name)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((o=(c=i.data)==null?void 0:c.description)==null?void 0:o.toString().toLowerCase().includes(e.toLowerCase()))||((d=i.category)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))}),error:null}}))})}getFilteredItems(e){return tt(this,null,function*(){return yield Q.handleOperation("getFilteredItems",()=>tt(this,null,function*(){let s=yield this.adapter.fetchInventoryItems();if(e.category&&(s=s.filter(i=>i.category===e.category)),e.status&&(s=s.filter(i=>i.status===e.status)),e.location&&(s=s.filter(i=>i.location===e.location)),e.searchQuery){const i=e.searchQuery.toLowerCase();s=s.filter(l=>{var c,o,d;return((c=l.name)==null?void 0:c.toLowerCase().includes(i))||((d=(o=l.data)==null?void 0:o.description)==null?void 0:d.toString().toLowerCase().includes(i))})}return e.minQuantity!==void 0&&(s=s.filter(i=>(i.quantity||0)>=e.minQuantity)),e.maxQuantity!==void 0&&(s=s.filter(i=>(i.quantity||0)<=e.maxQuantity)),e.dateRange&&(s=s.filter(i=>{const l=new Date(i.lastUpdated||i.created_at);return l>=e.dateRange.start&&l<=e.dateRange.end})),e.tags&&e.tags.length>0&&(s=s.filter(i=>{var l;const c=((l=i.data)==null?void 0:l.tags)||[];return e.tags.some(o=>c.includes(o))})),{data:s,error:null}}))})}advancedSearch(e){return tt(this,arguments,function*(t,r={}){return yield Q.handleOperation("advancedSearch",()=>tt(this,null,function*(){let l=yield this.adapter.fetchInventoryItems();if(t.category&&(l=l.filter(o=>o.category===t.category)),t.status&&(l=l.filter(o=>o.status===t.status)),t.location&&(l=l.filter(o=>o.location===t.location)),t.searchQuery){const o=t.searchQuery.toLowerCase();l=l.filter(d=>{var u,m,p,f;return((u=d.name)==null?void 0:u.toLowerCase().includes(o))||((p=(m=d.data)==null?void 0:m.description)==null?void 0:p.toString().toLowerCase().includes(o))||((f=d.category)==null?void 0:f.toLowerCase().includes(o))})}t.minQuantity!==void 0&&(l=l.filter(o=>(o.quantity||0)>=t.minQuantity)),t.maxQuantity!==void 0&&(l=l.filter(o=>(o.quantity||0)<=t.maxQuantity)),t.dateRange&&(l=l.filter(o=>{const d=new Date(o.lastUpdated||o.created_at);return d>=t.dateRange.start&&d<=t.dateRange.end})),t.tags&&t.tags.length>0&&(l=l.filter(o=>{var d;const u=((d=o.data)==null?void 0:d.tags)||[];return t.tags.some(m=>u.includes(m))})),r.includeArchived||(l=l.filter(o=>o.status!=="archived")),r.sortBy&&(l=this.sortItems(l,r.sortBy,r.sortOrder||"asc"));const c=l.length;if(r.limit||r.offset){const o=r.offset||0,d=r.limit?o+r.limit:l.length;l=l.slice(o,d)}return{data:l,total:c,filters:t,options:r,error:null}}))})}searchByNormalizedCategory(e){return tt(this,arguments,function*(t,r={}){return yield Q.handleOperation("searchByNormalizedCategory",()=>tt(this,null,function*(){let c=(yield this.adapter.fetchInventoryItems()).filter(d=>zt.normalizeCategory(d.category||"")===t);r.includeArchived||(c=c.filter(d=>d.status!=="archived")),r.sortBy&&(c=this.sortItems(c,r.sortBy,r.sortOrder||"asc"));const o=c.length;if(r.limit||r.offset){const d=r.offset||0,u=r.limit?d+r.limit:c.length;c=c.slice(d,u)}return{data:c,total:o,filters:{category:t},options:r,error:null}}))})}getSearchSuggestions(e,t=10){return tt(this,null,function*(){return(yield Q.handleOperation("getSearchSuggestions",()=>tt(this,null,function*(){const s=yield this.adapter.fetchInventoryItems(),i=new Set;if(!e||e.trim()==="")return[];const l=e.toLowerCase();return s.forEach(c=>{var o;c.name&&c.name.toLowerCase().includes(l)&&i.add(c.name),c.category&&c.category.toLowerCase().includes(l)&&i.add(c.category),c.location&&c.location.toLowerCase().includes(l)&&i.add(c.location);const d=(o=c.data)==null?void 0:o.description;d&&d.toLowerCase().includes(l)&&d.split(/\s+/).filter(m=>m.toLowerCase().includes(l)&&m.length>2).forEach(m=>i.add(m))}),Array.from(i).slice(0,t)})))||[]})}getLocations(){return tt(this,null,function*(){return{data:yield Q.handleOperation("getLocations",()=>tt(this,null,function*(){const t=yield this.adapter.fetchInventoryItems();return Array.from(new Set(t.map(s=>s.location).filter(Boolean)))})),error:null}})}sortItems(e,t,r){return e.sort((s,i)=>{let l,c;switch(t){case"name":l=s.name||"",c=i.name||"";break;case"category":l=s.category||"",c=i.category||"";break;case"location":l=s.location||"",c=i.location||"";break;case"quantity":l=s.quantity||0,c=i.quantity||0;break;case"lastUpdated":l=new Date(s.lastUpdated||s.created_at),c=new Date(i.lastUpdated||i.created_at);break;default:l=s.name||"",c=i.name||""}return l<c?r==="asc"?-1:1:l>c?r==="asc"?1:-1:0})}static validateSearchFilters(e){const t=[];return e.minQuantity!==void 0&&e.maxQuantity!==void 0&&e.minQuantity>e.maxQuantity&&t.push("Minimum quantity cannot be greater than maximum quantity"),e.dateRange&&e.dateRange.start>e.dateRange.end&&t.push("Start date cannot be after end date"),e.searchQuery&&e.searchQuery.length>100&&t.push("Search query must be less than 100 characters"),{isValid:t.length===0,errors:t}}static validateSearchOptions(e){const t=[];e.limit!==void 0&&e.limit<1&&t.push("Limit must be greater than 0"),e.limit!==void 0&&e.limit>1e3&&t.push("Limit cannot exceed 1000"),e.offset!==void 0&&e.offset<0&&t.push("Offset must be non-negative");const r=["name","category","location","quantity","lastUpdated"];e.sortBy&&!r.includes(e.sortBy)&&t.push(`Invalid sort field. Must be one of: ${r.join(", ")}`);const s=["asc","desc"];return e.sortOrder&&!s.includes(e.sortOrder)&&t.push(`Invalid sort order. Must be one of: ${s.join(", ")}`),{isValid:t.length===0,errors:t}}}var vS=Object.defineProperty,_S=Object.defineProperties,xS=Object.getOwnPropertyDescriptors,cd=Object.getOwnPropertySymbols,bS=Object.prototype.hasOwnProperty,wS=Object.prototype.propertyIsEnumerable,dd=(n,e,t)=>e in n?vS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Yn=(n,e)=>{for(var t in e||(e={}))bS.call(e,t)&&dd(n,t,e[t]);if(cd)for(var t of cd(e))wS.call(e,t)&&dd(n,t,e[t]);return n},SS=(n,e)=>_S(n,xS(e));class CS{constructor(e){this.adapterType=e}trackItemCreated(e,t,r){const s={properties:{itemId:e,itemName:t,category:r,adapterType:this.adapterType}};this.logEvent("inventory","item_created",`Inventory item created: ${t}`,"info",s.properties),this.trackUserAction("create_item","inventory",{itemId:e,itemName:t,category:r}),this.trackAnalyticsEvent("inventory_item_created",s.properties)}trackItemUpdated(e,t){const r={properties:{itemId:e,updates:t,adapterType:this.adapterType}};this.logEvent("inventory","item_updated",`Inventory item updated: ${e}`,"info",r.properties),this.trackUserAction("update_item","inventory",{itemId:e,updates:t}),this.trackAnalyticsEvent("inventory_item_updated",r.properties)}trackItemDeleted(e){const t={properties:{itemId:e,adapterType:this.adapterType}};this.logEvent("inventory","item_deleted",`Inventory item deleted: ${e}`,"info",t.properties),this.trackUserAction("delete_item","inventory",{itemId:e}),this.trackAnalyticsEvent("inventory_item_deleted",t.properties)}trackCategoryCreated(e){const t={properties:{category:e,adapterType:this.adapterType}};this.logEvent("inventory","category_created",`Category created: ${e}`,"info",t.properties),this.trackUserAction("create_category","inventory",{category:e}),this.trackAnalyticsEvent("inventory_category_created",t.properties)}trackCategoryDeleted(e){const t={properties:{category:e,adapterType:this.adapterType}};this.logEvent("inventory","category_deleted",`Category deleted: ${e}`,"info",t.properties),this.trackUserAction("delete_category","inventory",{category:e}),this.trackAnalyticsEvent("inventory_category_deleted",t.properties)}trackBulkOperation(e,t,r,s,i){const l={properties:Yn({totalItems:t,successCount:r,errorCount:s,adapterType:this.adapterType},i)};this.logEvent("inventory",`bulk_${e}`,`Bulk ${e}: ${r} successful, ${s} failed`,"info",l.properties),this.trackUserAction(`bulk_${e}`,"inventory",Yn({totalItems:t,successCount:r,errorCount:s},i)),this.trackAnalyticsEvent(`inventory_bulk_${e}`,l.properties)}trackSearch(e,t,r){const s={properties:{query:e,resultCount:t,filters:r,adapterType:this.adapterType}};this.logEvent("inventory","search_performed",`Search: "${e}" returned ${t} results`,"info",s.properties),this.trackUserAction("search_items","inventory",{query:e,resultCount:t,filters:r}),this.trackAnalyticsEvent("inventory_search",s.properties)}trackFilter(e,t){const r={properties:{filters:e,resultCount:t,adapterType:this.adapterType}};this.logEvent("inventory","filter_applied",`Filter applied, returned ${t} results`,"info",r.properties),this.trackUserAction("filter_items","inventory",{filters:e,resultCount:t}),this.trackAnalyticsEvent("inventory_filter",r.properties)}trackItemDuplicated(e,t){const r={properties:{originalItemId:e,newItemId:t,adapterType:this.adapterType}};this.logEvent("inventory","item_duplicated",`Item duplicated: ${e} -> ${t}`,"info",r.properties),this.trackUserAction("duplicate_item","inventory",{originalItemId:e,newItemId:t}),this.trackAnalyticsEvent("inventory_item_duplicated",r.properties)}trackItemArchived(e,t){const r={properties:{itemId:e,reason:t,adapterType:this.adapterType}};this.logEvent("inventory","item_archived",`Item archived: ${e}`,"info",r.properties),this.trackUserAction("archive_item","inventory",{itemId:e,reason:t}),this.trackAnalyticsEvent("inventory_item_archived",r.properties)}trackItemRestored(e){const t={properties:{itemId:e,adapterType:this.adapterType}};this.logEvent("inventory","item_restored",`Item restored: ${e}`,"info",t.properties),this.trackUserAction("restore_item","inventory",{itemId:e}),this.trackAnalyticsEvent("inventory_item_restored",t.properties)}trackCategoryMerged(e,t,r){const s={properties:{sourceCategory:e,targetCategory:t,itemsUpdated:r,adapterType:this.adapterType}};this.logEvent("inventory","category_merged",`Category merged: ${e} -> ${t}`,"info",s.properties),this.trackUserAction("merge_category","inventory",{sourceCategory:e,targetCategory:t,itemsUpdated:r}),this.trackAnalyticsEvent("inventory_category_merged",s.properties)}trackAdapterInitialized(e){const t={properties:{adapterType:e}};this.logEvent("inventory","adapter_initialized",`Adapter initialized: ${e}`,"info",t.properties),this.trackUserAction("initialize_adapter","inventory",{adapterType:e}),this.trackAnalyticsEvent("inventory_adapter_initialized",t.properties)}trackError(e,t,r){const s={properties:Yn({operation:e,errorMessage:t.message,errorStack:t.stack,adapterType:this.adapterType},r)};this.logEvent("inventory","error_occurred",`Error in ${e}: ${t.message}`,"error",s.properties),this.trackUserAction("error_occurred","inventory",Yn({operation:e,errorMessage:t.message},r)),this.trackAnalyticsEvent("inventory_error",s.properties)}trackPerformance(e,t,r){const s={properties:{operation:e,duration:t,itemCount:r,adapterType:this.adapterType}};this.logEvent("inventory","performance_metric",`${e} took ${t}ms`,"info",s.properties),this.trackUserAction("performance_metric","inventory",{operation:e,duration:t,itemCount:r}),this.trackAnalyticsEvent("inventory_performance",s.properties)}logEvent(e,t,r,s,i){se(e,t,r,s,i)}trackUserAction(e,t,r){ie(e,t,r)}trackAnalyticsEvent(e,t){H.trackEvent(e,t)}createCustomEvent(e,t,r,s,i,l){return{eventType:e,category:t,action:r,label:s,value:i,properties:SS(Yn({},l),{adapterType:this.adapterType})}}trackCustomEvent(e){this.logEvent(e.category,e.action,e.label||e.action,"info",e.properties),this.trackUserAction(e.action,e.category,e.properties),this.trackAnalyticsEvent(e.eventType,e.properties)}}var IS=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function jS(){return IS(this,null,function*(){return yield L(()=>import("./SupabaseAdapter-7V6bNiYh.js"),__vite__mapDeps([9,1,2,3,4,5,10,8,6]))})}var ES=Object.defineProperty,TS=Object.defineProperties,NS=Object.getOwnPropertyDescriptors,ud=Object.getOwnPropertySymbols,kS=Object.prototype.hasOwnProperty,PS=Object.prototype.propertyIsEnumerable,md=(n,e,t)=>e in n?ES(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,hd=(n,e)=>{for(var t in e||(e={}))kS.call(e,t)&&md(n,t,e[t]);if(ud)for(var t of ud(e))PS.call(e,t)&&md(n,t,e[t]);return n},DS=(n,e)=>TS(n,NS(e)),Jn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class AS{constructor(e,t){this.isInitialized=!1,this.lastError=null,this.lastSyncTime=null,this.pendingChanges=!1,this.config=e,this.metadata=DS(hd({},t),{config:e})}getMetadata(){return hd({},this.metadata)}batchAddItems(e){return Jn(this,null,function*(){const t=[];for(const r of e)try{const s=yield this.addInventoryItem(r);t.push(s)}catch(s){throw this.setError(s),s}return t})}batchUpdateItems(e){return Jn(this,null,function*(){const t=[];for(const r of e)try{const s=yield this.updateInventoryItem(r.id,r.item);t.push(s)}catch(s){throw this.setError(s),s}return t})}batchDeleteItems(e){return Jn(this,null,function*(){for(const t of e)try{yield this.deleteInventoryItem(t)}catch(r){throw this.setError(r),r}})}sync(){return Jn(this,null,function*(){try{this.lastSyncTime=new Date,this.pendingChanges=!1}catch(e){throw this.setError(e),e}})}getLastSyncTime(){return this.lastSyncTime}hasPendingChanges(){return this.pendingChanges}getLastError(){return this.lastError}clearError(){this.lastError=null}disconnect(){return Jn(this,null,function*(){this.isInitialized=!1,this.lastError=null})}setError(e){this.lastError=e,console.error(`[${this.metadata.name}] Error:`,e)}setPendingChanges(){this.pendingChanges=!0}validateInitialization(){if(!this.isInitialized)throw new Error(`Adapter ${this.metadata.name} is not initialized. Call initialize() first.`)}}var OS=Object.defineProperty,RS=Object.defineProperties,$S=Object.getOwnPropertyDescriptors,pd=Object.getOwnPropertySymbols,MS=Object.prototype.hasOwnProperty,FS=Object.prototype.propertyIsEnumerable,fd=(n,e,t)=>e in n?OS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Qs=(n,e)=>{for(var t in e||(e={}))MS.call(e,t)&&fd(n,t,e[t]);if(pd)for(var t of pd(e))FS.call(e,t)&&fd(n,t,e[t]);return n},gd=(n,e)=>RS(n,$S(e)),_t=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const We={INVENTORY_DATA:"inventory_data",CATEGORIES:"inventory_categories",LAST_SYNC:"inventory_last_sync",PENDING_CHANGES:"inventory_pending_changes"};class LS extends AS{constructor(e={type:"localStorage"}){const t={supportsRead:!0,supportsWrite:!0,supportsDelete:!0,supportsRealTime:!1,supportsOffline:!0,supportsBatch:!0};super(e,{name:"LocalStorageAdapter",version:"1.0.0",description:"Adapter for localStorage-based inventory data",capabilities:t}),this.storage=window.localStorage}initialize(){return _t(this,null,function*(){try{if(!this.storage)throw new Error("localStorage is not available");this.storage.getItem(We.INVENTORY_DATA)||(yield this.initializeDefaultData()),this.isInitialized=!0,this.lastSyncTime=this.getLastSyncTimeFromStorage(),this.pendingChanges=this.getPendingChangesFromStorage()}catch(e){throw this.setError(e),e}})}isConnected(){return this.isInitialized&&!!this.storage}fetchAllInventoryData(){return _t(this,null,function*(){this.validateInitialization();const e=this.getInventoryDataFromStorage(),t=[];return t.push(...e.tools),t.push(...e.supplies),t.push(...e.equipment),t.push(...e.officeHardware),{data:t,error:null,count:t.length}})}fetchInventoryItems(){return _t(this,null,function*(){this.validateInitialization();const e=this.getInventoryDataFromStorage(),t=[];return t.push(...e.tools),t.push(...e.supplies),t.push(...e.equipment),t.push(...e.officeHardware),t})}fetchCategories(){return _t(this,null,function*(){this.validateInitialization();const e=this.storage.getItem(We.CATEGORIES);return e?JSON.parse(e):this.getDefaultCategories()})}addInventoryItem(e){return _t(this,null,function*(){this.validateInitialization();const t=this.getInventoryDataFromStorage(),r=gd(Qs({},e),{id:this.generateId(),createdAt:new Date().toISOString()}),s=(r.category||"").toLowerCase();return s.includes("tool")||s.includes("instrument")?t.tools.push(r):s.includes("supply")||s.includes("consumable")?t.supplies.push(r):s.includes("equipment")||s.includes("device")?t.equipment.push(r):t.officeHardware.push(r),this.saveInventoryDataToStorage(t),this.setPendingChanges(),this.updateLastSyncTime(),r})}updateInventoryItem(e,t){return _t(this,null,function*(){this.validateInitialization();const r=this.getInventoryDataFromStorage(),s=gd(Qs({},t),{id:e,lastUpdated:new Date().toISOString()}),i=[r.tools,r.supplies,r.equipment,r.officeHardware];let l=!1;for(const c of i){const o=c.findIndex(d=>this.getItemId(d)===e);if(o!==-1){c[o]=Qs(Qs({},c[o]),s),l=!0;break}}if(!l)throw new Error(`Item with id ${e} not found`);return this.saveInventoryDataToStorage(r),this.setPendingChanges(),this.updateLastSyncTime(),s})}deleteInventoryItem(e){return _t(this,null,function*(){this.validateInitialization();const t=this.getInventoryDataFromStorage(),r=[t.tools,t.supplies,t.equipment,t.officeHardware];let s=!1;for(const i of r){const l=i.findIndex(c=>this.getItemId(c)===e);if(l!==-1){i.splice(l,1),s=!0;break}}if(!s)throw new Error(`Item with id ${e} not found`);this.saveInventoryDataToStorage(t),this.setPendingChanges(),this.updateLastSyncTime()})}addCategory(e){return _t(this,null,function*(){this.validateInitialization();const t=yield this.fetchCategories();return t.includes(e)||(t.push(e),this.storage.setItem(We.CATEGORIES,JSON.stringify(t)),this.setPendingChanges(),this.updateLastSyncTime()),e})}deleteCategory(e){return _t(this,null,function*(){this.validateInitialization();const t=yield this.fetchCategories(),r=t.indexOf(e);r!==-1&&(t.splice(r,1),this.storage.setItem(We.CATEGORIES,JSON.stringify(t)),this.setPendingChanges(),this.updateLastSyncTime())})}getInventoryDataFromStorage(){const e=this.storage.getItem(We.INVENTORY_DATA);return e?JSON.parse(e):{tools:[],supplies:[],equipment:[],officeHardware:[],categories:this.getDefaultCategories(),isLoading:!1,error:null}}saveInventoryDataToStorage(e){this.storage.setItem(We.INVENTORY_DATA,JSON.stringify(e))}getLastSyncTimeFromStorage(){const e=this.storage.getItem(We.LAST_SYNC);return e?new Date(e):null}getPendingChangesFromStorage(){const e=this.storage.getItem(We.PENDING_CHANGES);return e?JSON.parse(e):!1}updateLastSyncTime(){this.lastSyncTime=new Date,this.storage.setItem(We.LAST_SYNC,this.lastSyncTime.toISOString())}setPendingChanges(){this.pendingChanges=!0,this.storage.setItem(We.PENDING_CHANGES,JSON.stringify(!0))}initializeDefaultData(){return _t(this,null,function*(){const e={tools:[],supplies:[],equipment:[],officeHardware:[],categories:this.getDefaultCategories(),isLoading:!1,error:null};this.saveInventoryDataToStorage(e),this.storage.setItem(We.CATEGORIES,JSON.stringify(this.getDefaultCategories())),this.storage.setItem(We.LAST_SYNC,new Date().toISOString()),this.storage.setItem(We.PENDING_CHANGES,JSON.stringify(!1))})}generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getItemId(e){if(e.data&&typeof e.data=="object"&&e.data!==null){const t=e.data;if(t.toolId&&typeof t.toolId=="string")return t.toolId;if(t.supplyId&&typeof t.supplyId=="string")return t.supplyId;if(t.equipmentId&&typeof t.equipmentId=="string")return t.equipmentId;if(t.hardwareId&&typeof t.hardwareId=="string")return t.hardwareId}return e.id||this.generateId()}getDefaultCategories(){return["Surgical Instruments","Medical Supplies","Equipment","Office Hardware","Consumables","Disposables","Tools","Devices"]}}var zS=Object.defineProperty,yd=Object.getOwnPropertySymbols,BS=Object.prototype.hasOwnProperty,qS=Object.prototype.propertyIsEnumerable,vd=(n,e,t)=>e in n?zS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ys=(n,e)=>{for(var t in e||(e={}))BS.call(e,t)&&vd(n,t,e[t]);if(yd)for(var t of yd(e))qS.call(e,t)&&vd(n,t,e[t]);return n},Xn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class US{constructor(e){this.registry={},this.defaultAdapter=null,this.config={defaultAdapter:e.defaultAdapter||"localStorage",adapters:Ys({},e.adapters),fallbackAdapter:e.fallbackAdapter||"supabase"}}createAdapter(e,t){return Xn(this,null,function*(){if(this.registry[e])return this.registry[e];let r;switch(e){case"static":{const{StaticDataAdapter:s}=yield L(()=>import("./StaticDataAdapter-UKgpxBMN.js"),__vite__mapDeps([11,1,2,3,4,5,6]));r=new s(t||{type:"static"});break}case"localStorage":{r=new LS(t||this.config.adapters.localStorage);break}case"api":{const{ApiAdapter:s,isApiAdapterConfig:i}=yield L(()=>import("./ApiAdapter-C2mXMyRJ.js"),[]),l=t||this.config.adapters.api;if(!l)throw new Error("API adapter configuration is required");if(!i(l))throw new Error("API adapter requires baseUrl configuration");r=new s(l);break}case"supabase":{const{SupabaseAdapter:s}=yield jS(),i=t||this.config.adapters.supabase;if(!i)throw new Error("Supabase adapter configuration is required");r=new s(i);break}default:throw new Error(`Unknown adapter type: ${e}`)}return yield r.initialize(),this.registerAdapter(e,r),r})}getAdapter(e){return this.registry[e]||null}registerAdapter(e,t){this.registry[e]=t,e===this.config.defaultAdapter&&(this.defaultAdapter=t)}unregisterAdapter(e){const t=this.registry[e];t&&(t.disconnect().catch(console.error),delete this.registry[e],this.defaultAdapter===t&&(this.defaultAdapter=null))}initializeDefaultAdapter(){return Xn(this,null,function*(){if(this.defaultAdapter)return this.defaultAdapter;try{const e=yield this.createAdapter(this.config.defaultAdapter);return this.defaultAdapter=e,e}catch(e){if(console.error(e),console.error(`Failed to initialize default adapter (${this.config.defaultAdapter}):`),this.config.fallbackAdapter&&this.config.fallbackAdapter!==this.config.defaultAdapter)try{const t=yield this.createAdapter(this.config.fallbackAdapter);return this.defaultAdapter=t,t}catch(t){throw console.error(`Failed to initialize fallback adapter (${this.config.fallbackAdapter}):`,t),new Error("No available adapters could be initialized")}throw new Error("No available adapters could be initialized")}})}getAvailableAdapters(){return Object.keys(this.registry)}getAdapterMetadata(e){const t=this.registry[e];return t?t.getMetadata():null}updateConfig(e){this.config=Ys(Ys({},this.config),e)}getConfig(){return Ys({},this.config)}switchDefaultAdapter(e){return Xn(this,null,function*(){if(!["localStorage","api","supabase"].includes(e))throw new Error(`Invalid adapter type: ${e}`);return this.config.defaultAdapter=e,this.defaultAdapter=null,this.initializeDefaultAdapter()})}getBestAvailableAdapter(){return Xn(this,null,function*(){try{return yield this.initializeDefaultAdapter()}catch(e){console.error(e);const t=["supabase","localStorage"];for(const r of t)try{return yield this.createAdapter(r)}catch(s){console.warn(`Failed to create adapter ${r}:`,s);continue}throw new Error("No adapters are available")}})}cleanup(){return Xn(this,null,function*(){const e=Object.values(this.registry).map(t=>t.disconnect().catch(console.error));yield Promise.all(e),this.registry={},this.defaultAdapter=null})}}const pn=new US({defaultAdapter:"supabase",adapters:{supabase:{type:"supabase"},localStorage:{type:"localStorage"}},fallbackAdapter:"localStorage"});var ge=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class HS{constructor(e,t){this.adapter=e,this.adapterType=t}getInventoryStats(){return ge(this,null,function*(){return{data:yield Q.handleOperation("getInventoryStats",()=>ge(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={totalItems:t.length,categories:Array.from(new Set(t.map(i=>i.category))).length,locations:Array.from(new Set(t.map(i=>i.location))).length,activeItems:t.filter(i=>i.status==="active").length,maintenanceItems:t.filter(i=>i.status==="maintenance").length,inactiveItems:t.filter(i=>i.status==="inactive").length,retiredItems:t.filter(i=>i.status==="retired").length,archivedItems:t.filter(i=>i.status==="archived").length,lowStockItems:t.filter(i=>{const l=i.quantity||0,c=i.minimumStock||0;return l>0&&l<=c}).length,outOfStockItems:t.filter(i=>(i.quantity||0)===0).length,normalizedCategories:{tools:0,supplies:0,equipment:0,officeHardware:0},statusDistribution:{},categoryDistribution:{},locationDistribution:{},averageQuantity:0};t.forEach(i=>{const l=zt.normalizeCategory(i.category||"");r.normalizedCategories[l.toLowerCase().replace(" ","")]++}),t.forEach(i=>{const l=i.status||"unknown";r.statusDistribution[l]=(r.statusDistribution[l]||0)+1}),t.forEach(i=>{const l=i.category||"unknown";r.categoryDistribution[l]=(r.categoryDistribution[l]||0)+1}),t.forEach(i=>{const l=i.location||"unknown";r.locationDistribution[l]=(r.locationDistribution[l]||0)+1});const s=t.reduce((i,l)=>i+(l.quantity||0),0);return r.averageQuantity=t.length>0?s/t.length:0,r})),error:null}})}getCategoryStats(){return ge(this,null,function*(){return{data:yield Q.handleOperation("getCategoryStats",()=>ge(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(s=>{const i=zt.normalizeCategory(s.category||"");r[i]=(r[i]||0)+1}),r})),error:null}})}getStatusStats(){return ge(this,null,function*(){return{data:yield Q.handleOperation("getStatusStats",()=>ge(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(s=>{const i=s.status||"unknown";r[i]=(r[i]||0)+1}),r})),error:null}})}getLocationStats(){return ge(this,null,function*(){return{data:yield Q.handleOperation("getLocationStats",()=>ge(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r={};return t.forEach(s=>{const i=s.location||"unknown";r[i]=(r[i]||0)+1}),r})),error:null}})}getStockLevelStats(){return ge(this,null,function*(){return{data:yield Q.handleOperation("getStockLevelStats",()=>ge(this,null,function*(){const t=yield this.adapter.fetchInventoryItems();let r=0,s=0,i=0,l=0;return t.forEach(c=>{const o=c.quantity||0,d=c.minimumStock||0,u=c.maximumStock||1/0;o===0?i++:o<=d?s++:o>=u?l++:r++}),{inStock:r,lowStock:s,outOfStock:i,overStock:l}})),error:null}})}getTrendingItems(e=10){return ge(this,null,function*(){return{data:yield Q.handleOperation("getTrendingItems",()=>ge(this,null,function*(){const r=yield this.adapter.fetchInventoryItems(),s={};return r.forEach(l=>{s[l.id]=(s[l.id]||0)+1}),r.sort((l,c)=>new Date(c.lastUpdated||c.created_at).getTime()-new Date(l.lastUpdated||l.created_at).getTime()).slice(0,e).map(l=>({id:l.id,name:l.name||l.item||"Unknown",category:l.category||"Unknown",lastUpdated:l.lastUpdated||l.created_at,updateCount:s[l.id]||1}))})),error:null}})}getCurrentAdapterType(){return this.adapterType}getAdapterMetadata(){return pn.getAdapterMetadata(this.adapterType)||null}getAvailableAdapters(){return pn.getAvailableAdapters()}getAdapterCapabilities(){const e=this.getAdapterMetadata();return(e==null?void 0:e.capabilities)||[]}supportsOperation(e){const t=this.getAdapterMetadata();return(t==null?void 0:t.supportedOperations.includes(e))||!1}getPerformanceMetrics(){return ge(this,null,function*(){return{data:yield Q.handleOperation("getPerformanceMetrics",()=>ge(null,null,function*(){return{averageResponseTime:150,totalOperations:1e3,errorRate:.02,cacheHitRate:.85}})),error:null}})}getDataQualityMetrics(){return ge(this,null,function*(){return{data:yield Q.handleOperation("getDataQualityMetrics",()=>ge(this,null,function*(){const t=yield this.adapter.fetchInventoryItems(),r=[];let s=0,i=0;t.forEach(d=>{["name","category","status"].forEach(m=>{i++,d[m]?s++:r.push(`Missing ${m} for item ${d.id}`)}),d.quantity!==void 0&&d.minimumStock!==void 0&&(d.quantity<0&&r.push(`Negative quantity for item ${d.id}`),d.minimumStock<0&&r.push(`Negative minimum stock for item ${d.id}`))});const l=i>0?s/i:0,c=1-r.length/t.length,o=1-r.filter(d=>d.includes("consistency")).length/t.length;return{completeness:l,accuracy:Math.max(0,c),consistency:Math.max(0,o),issues:r}})),error:null}})}generateInventoryReport(){return ge(this,null,function*(){return{data:yield Q.handleOperation("generateInventoryReport",()=>ge(this,null,function*(){const[t,r,s,i,l]=yield Promise.all([this.getInventoryStats(),this.getCategoryStats(),this.getStatusStats(),this.getLocationStats(),this.getStockLevelStats()]),c=[];return t.data&&(t.data.lowStockItems>0&&c.push(`Consider restocking ${t.data.lowStockItems} low stock items`),t.data.outOfStockItems>0&&c.push(`Urgent: ${t.data.outOfStockItems} items are out of stock`),t.data.archivedItems>t.data.totalItems*.1&&c.push("Consider cleaning up archived items")),{summary:t.data,categoryBreakdown:r.data||{},statusBreakdown:s.data||{},locationBreakdown:i.data||{},stockLevels:l.data||{inStock:0,lowStock:0,outOfStock:0,overStock:0},recommendations:c,generatedAt:new Date().toISOString()}})),error:null}})}}var de=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class VS{constructor(){this.currentAdapter=null,this.adapterType="static",this.initialized=!1,this.categoryProvider=null,this.itemCrudProvider=null,this.bulkOperationsProvider=null,this.searchFilterProvider=null,this.analyticsProvider=null,this.statsProvider=null}get isInitialized(){return this.initialized}initialize(e,t){return de(this,null,function*(){this.initialized||(this.currentAdapter=e,this.adapterType=t,typeof this.currentAdapter.initialize=="function"&&(yield this.currentAdapter.initialize()),this.categoryProvider=new zt(e,t),this.itemCrudProvider=new fS(e,t),this.bulkOperationsProvider=new gS(e,t),this.searchFilterProvider=new yS(e),this.analyticsProvider=new CS(t),this.statsProvider=new HS(e,t),this.initialized=!0,console.info("[InventoryRepository] Initialized successfully."))})}getAdapter(){if(!this.initialized||!this.currentAdapter)throw new Error("Inventory repository not initialized. Must call initialize() first.");return this.currentAdapter}fetchInventoryItems(){return de(this,null,function*(){return this.itemCrudProvider.fetchInventoryItems()})}getAllItems(){return de(this,null,function*(){return this.itemCrudProvider.fetchInventoryItems()})}fetchAllInventoryData(){return de(this,null,function*(){const e=yield Q.handleOperation("fetchAllInventoryData",()=>de(this,null,function*(){const r=yield this.getAdapter().fetchAllInventoryData(),s=r.data||[],i=oS(s),l=iS(i),c=new Set,o=new Set;[l.tools,l.supplies,l.equipment,l.officeHardware].forEach(u=>{u.forEach(m=>{c.has(m.id)&&o.add(m.id),c.add(m.id)})}),o.size>0&&console.warn(`Found ${o.size} duplicate item IDs:`,Array.from(o));const d=Array.from(new Set(i.map(u=>u.category).filter(Boolean)));return{tools:l.tools,supplies:l.supplies,equipment:l.equipment,officeHardware:l.officeHardware,categories:d,isLoading:!1,error:r.error}}));return{tools:e.tools||[],supplies:e.supplies||[],equipment:e.equipment||[],officeHardware:e.officeHardware||[],categories:e.categories,isLoading:e.isLoading,error:e.error}})}getItemById(e){return de(this,null,function*(){return this.itemCrudProvider.getItemById(e)})}createItem(e){return de(this,null,function*(){return this.itemCrudProvider.createItem(e)})}updateItem(e,t){return de(this,null,function*(){return this.itemCrudProvider.updateItem(e,t)})}deleteItem(e){return de(this,null,function*(){return this.itemCrudProvider.deleteItem(e)})}addInventoryItem(e){return de(this,null,function*(){return this.itemCrudProvider.addInventoryItem(e)})}addCategory(e){return de(this,null,function*(){return this.categoryProvider.addCategory(e)})}deleteCategory(e){return de(this,null,function*(){return this.categoryProvider.deleteCategory(e)})}bulkCreateItems(e){return de(this,null,function*(){return this.bulkOperationsProvider.bulkCreateItems(e)})}bulkUpdateItems(e){return de(this,null,function*(){return this.bulkOperationsProvider.bulkUpdateItems(e)})}bulkDeleteItems(e){return de(this,null,function*(){return this.bulkOperationsProvider.bulkDeleteItems(e)})}searchItems(e){return de(this,null,function*(){return this.searchFilterProvider.searchItems(e)})}getFilteredItems(e){return de(this,null,function*(){return this.searchFilterProvider.getFilteredItems(e)})}getCategories(){return de(this,null,function*(){return this.categoryProvider.getCategories()})}getLocations(){return de(this,null,function*(){return this.searchFilterProvider.getLocations()})}getInventoryStats(){return de(this,null,function*(){const e=yield this.statsProvider.getInventoryStats();return{data:e.data,error:e.error}})}getCurrentAdapterType(){return this.statsProvider.getCurrentAdapterType()}getAdapterMetadata(){return this.statsProvider.getAdapterMetadata()}getAvailableAdapters(){return this.statsProvider.getAvailableAdapters()}}const WS=n=>{var e,t,r,s;return((e=n.data)==null?void 0:e.toolId)||((t=n.data)==null?void 0:t.supplyId)||((r=n.data)==null?void 0:r.equipmentId)||((s=n.data)==null?void 0:s.hardwareId)||n.toolId||n.supplyId||n.equipmentId||n.hardwareId||n.id},GS=(n,e)=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t};function KS(){return{itemName:"",category:"",id:"",location:"",status:"active",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const _d=()=>({general:!0,purchase:!1,maintenance:!1,usage:!1}),QS=n=>{var e;return{itemName:n.name||n.item||"",category:n.category||"",id:WS(n),location:n.location||"",status:n.status||"",quantity:n.quantity||1,unitCost:n.unit_cost||0,minimumQuantity:n.reorder_point||0,maximumQuantity:((e=n.data)==null?void 0:e.maximumQuantity)||0,supplier:n.supplier||"",updated_at:n.updated_at||new Date().toISOString(),createdAt:n.created_at||new Date().toISOString()}};var YS=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class JS{constructor(){this.currentAdapter=null,this.adapterType="static",this.initialized=!1}initialize(){return YS(this,null,function*(){this.initialized||(this.currentAdapter=yield pn.initializeDefaultAdapter(),this.adapterType=pn.getConfig().defaultAdapter,this.initialized=!0)})}getAdapter(){if(!this.currentAdapter)throw new Error("Inventory service facade not initialized. Call initialize() first.");return this.currentAdapter}getCurrentAdapterType(){return this.adapterType}getAdapterMetadata(){return pn.getAdapterMetadata(this.adapterType)}getAvailableAdapters(){return pn.getAvailableAdapters()}}const XS={realtime:{get enabled(){return jt()}}};var ZS=Object.defineProperty,eC=Object.defineProperties,tC=Object.getOwnPropertyDescriptors,xd=Object.getOwnPropertySymbols,rC=Object.prototype.hasOwnProperty,nC=Object.prototype.propertyIsEnumerable,bd=(n,e,t)=>e in n?ZS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,wd=(n,e)=>{for(var t in e||(e={}))rC.call(e,t)&&bd(n,t,e[t]);if(xd)for(var t of xd(e))nC.call(e,t)&&bd(n,t,e[t]);return n},Sd=(n,e)=>eC(n,tC(e)),xt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class fn{constructor(){this.isConnected=!1,this.connectionTestPromise=null}static getInstance(){return fn.instance||(fn.instance=new fn),fn.instance}testConnection(){return xt(this,null,function*(){return this.connectionTestPromise?this.connectionTestPromise:(this.connectionTestPromise=this.performConnectionTest(),this.connectionTestPromise)})}performConnectionTest(){return xt(this,null,function*(){if(!jt())return console.warn("Supabase not configured, connection test skipped"),!1;try{const{error:e}=yield _.from("inventory_items").select("count").limit(1);return e?(console.error("❌ Supabase connection test failed:",e),this.isConnected=!1,!1):(this.isConnected=!0,!0)}catch(e){return console.error("❌ Supabase connection test error:",e),this.isConnected=!1,!1}})}getAnalytics(){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");return je.getAnalytics()})}getCategories(){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{data:t,error:r}=yield _.from("inventory_items").select("category").not("category","is",null);if(r)throw new Error(`Failed to fetch categories: ${r.message}`);return Array.from(new Set((t==null?void 0:t.map(i=>i.category).filter(Boolean))||[]))}catch(t){throw console.error("❌ Error fetching categories:",t),t}})}getLocations(){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{error:t}=yield _.from("inventory_items").select("location").not("location","is",null);if(t)throw new Error(`Failed to fetch locations: ${t.message}`);return[]}catch(t){throw console.error("❌ Error fetching locations:",t),t}})}getItems(e){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{let r=_.from("inventory_items").select("*",{count:"exact"});e!=null&&e.category&&(r=r.eq("category",e.category)),e!=null&&e.limit&&(r=r.limit(e.limit)),e!=null&&e.offset&&(r=r.range(e.offset,e.offset+(e.limit||10)-1));const{data:s,error:i,count:l}=yield r;if(i)throw new Error(`Failed to fetch items: ${i.message}`);return{data:s||[],count:l||0,error:null}}catch(r){return console.error("❌ Error fetching items:",r),{data:[],count:0,error:r instanceof Error?r.message:"Unknown error"}}})}subscribeToChanges(e){if(!XS.realtime.enabled)return()=>{};try{return Ia.subscribe("inventory_items",e,{event:"*"})}catch(t){return console.error("❌ Failed to set up real-time subscription:",t),()=>{}}}resetConnectionTest(){this.connectionTestPromise=null,this.isConnected=!1}getConnectionStatus(){return{isConnected:this.isConnected,isConfigured:jt()}}getItemById(e){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{data:r,error:s}=yield _.from("inventory_items").select("*").eq("id",e).single();if(s){if(s.code==="PGRST116")return null;throw new Error(`Failed to fetch item: ${s.message}`)}return r}catch(r){throw console.error("❌ Error fetching item by ID:",r),r}})}createItem(e){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const r=Sd(wd({},e),{data:e.data}),{data:s,error:i}=yield _.from("inventory_items").insert(r).select().single();if(i)throw new Error(`Failed to create item: ${i.message}`);return s}catch(r){throw console.error("❌ Error creating item:",r),r}})}updateItem(e,t){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const s=Sd(wd({},t),{data:t.data}),{data:i,error:l}=yield _.from("inventory_items").update(s).eq("id",e).select().single();if(l)throw new Error(`Failed to update item: ${l.message}`);return i}catch(s){throw console.error("❌ Error updating item:",s),s}})}deleteItem(e){return xt(this,null,function*(){if(!(yield this.testConnection()))throw new Error("Supabase connection not available");try{const{error:r}=yield _.from("inventory_items").delete().eq("id",e);if(r)throw new Error(`Failed to delete item: ${r.message}`)}catch(r){throw console.error("❌ Error deleting item:",r),r}})}}const sC=fn.getInstance();function aC(n,e=3e5){const t=new Date(Date.now()-e),r=n.filter(l=>l.timestamp>t);if(r.length===0)return{avg:0,min:0,max:0,count:0,p95:0,p99:0};const s=r.map(l=>l.value).sort((l,c)=>l-c);return{avg:s.reduce((l,c)=>l+c,0)/s.length,min:s[0],max:s[s.length-1],count:s.length,p95:s[Math.floor(s.length*.95)],p99:s[Math.floor(s.length*.99)]}}function iC(n,e){let t=!1,r="warning";switch(e.operator){case"gt":t=n.value>e.warning,r=n.value>e.critical?"critical":"warning";break;case"lt":t=n.value<e.warning,r=n.value<e.critical?"critical":"warning";break;case"gte":t=n.value>=e.warning,r=n.value>=e.critical?"critical":"warning";break;case"lte":t=n.value<=e.warning,r=n.value<=e.critical?"critical":"warning";break;case"eq":t=n.value===e.warning,r=n.value===e.critical?"critical":"warning";break}return{shouldAlert:t,severity:r}}function oC(n,e=3e5){const t=[],r=new Date(Date.now()-e),s=n.filter(p=>p.timestamp>r);if(s.length<2)return t;const i=s.map(p=>p.value),l=i.slice(0,Math.floor(i.length/2)),c=i.slice(Math.floor(i.length/2)),o=l.reduce((p,f)=>p+f,0)/l.length,u=(c.reduce((p,f)=>p+f,0)/c.length-o)/o*100;let m="stable";return Math.abs(u)>10&&(m=u<0?"improving":"degrading"),t.push({metric:s[0].name,trend:m,changePercent:Math.round(u*100)/100,period:`${Math.round(e/6e4)} minutes`}),t}function lC(n,e,t){let r=100;n>1e3&&(r-=20),e>5&&(r-=30),t>500*1024*1024&&(r-=20);let s="healthy";return r<50?s="critical":r<80&&(s="degraded"),{score:Math.max(0,r),status:s}}function cC(n){const e=n.filter(l=>l.status==="fail").length,t=n.filter(l=>l.status==="warn").length,r=n.length;let s="healthy";e>0?s=e>r/2?"critical":"degraded":t>0&&(s="degraded");const i=Math.max(0,100-e*50-t*25);return{status:s,score:i}}function dC(){return`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function uC(n,e,t,r){return`${n} ${e} ${t} (current: ${r})`}function mC(n){return Date.now()-n.getTime()<3e5}function hC(n,e=60){return n/e}function Cd(n,e=50){return n.substring(0,e)}function pC(n){return Math.round(n/1024/1024)}function fC(n,e=200){return n<e*1024*1024}class gC{constructor(){this.alerts=[],this.alertSubscribers=[]}createAlert(e,t,r){const i={id:dC(),metric:e.name,value:e.value,threshold:t.warning,severity:r,message:uC(e.name,t.operator,t.warning,e.value),timestamp:new Date,resolved:!1};this.alerts.find(c=>c.metric===i.metric&&c.severity===i.severity&&!c.resolved&&mC(c.timestamp))||(this.alerts.push(i),O.warn(`Performance alert: ${i.message}`,i),this.notifyAlertSubscribers(i))}getActiveAlerts(){return this.alerts.filter(e=>!e.resolved)}resolveAlert(e){const t=this.alerts.find(r=>r.id===e);t&&(t.resolved=!0,t.resolvedAt=new Date,O.info(`Alert resolved: ${e}`,t))}subscribeToAlerts(e){return this.alertSubscribers.push(e),()=>{const t=this.alertSubscribers.indexOf(e);t>-1&&this.alertSubscribers.splice(t,1)}}notifyAlertSubscribers(e){this.alertSubscribers.forEach(t=>{try{t(e)}catch(r){O.error("Error in alert subscriber:",r)}})}logMetricRecorded(e,t,r,s,i){O.debug(`Performance metric recorded: ${e}=${t}${r}`,{tags:s,metadata:i})}logThresholdsUpdated(e){O.info("Performance thresholds updated",{thresholds:e})}logSnapshotCaptured(e,t,r){Math.random()<.2&&O.debug("Performance snapshot captured",{timestamp:e,metricsCount:t,alertsCount:r})}logSnapshotError(e){O.error("Failed to capture performance snapshot:",e)}logMonitoringDisabled(){console.log("Performance monitoring disabled in development mode")}logDatabaseCheckError(e){console.error(e)}logMemoryCheckError(e){console.error(e)}}const mt=new gC;var fp=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function yC(n,e){const t=e.filter(r=>r.metric===n.name);for(const r of t){const{shouldAlert:s,severity:i}=iC(n,r);s&&mt.createAlert(n,r,i)}}function vC(){return[{metric:"response_time",warning:1e3,critical:5e3,operator:"gt"},{metric:"component_mount_time",warning:1e3,critical:3e3,operator:"gt"},{metric:"authentication_time",warning:2e3,critical:5e3,operator:"gt"},{metric:"data_fetch_time",warning:2e3,critical:5e3,operator:"gt"},{metric:"navigation_time",warning:1e3,critical:3e3,operator:"gt"},{metric:"error_rate",warning:5,critical:10,operator:"gt"},{metric:"memory_usage",warning:200*1024*1024,critical:500*1024*1024,operator:"gt"}]}function _C(){return()=>fp(null,null,function*(){try{const n=Date.now();return{name:"database",status:"pass",message:"Database connection healthy",duration:Date.now()-n}}catch(n){return mt.logDatabaseCheckError(n),{name:"database",status:"fail",message:"Database connection failed",duration:0}}})}function xC(n){return()=>fp(null,null,function*(){try{const e=n("memory_usage");return{name:"memory",status:fC(e.avg)?"pass":"warn",message:`Memory usage: ${pC(e.avg)}MB`,duration:0}}catch(e){return mt.logMemoryCheckError(e),{name:"memory",status:"fail",message:"Memory check failed",duration:0}}})}function bC(n,e,t){const r={timestamp:new Date,metrics:new Map,health:n,alerts:e};for(const[s,i]of Array.from(t.entries()))if(i.length>0){const l=i[i.length-1];r.metrics.set(s,l.value)}return r}function wC(n){const e=n("response_time").avg,t=n("error_rate").avg,r=n("memory_usage").avg,{score:s,status:i}=lC(e,t,r);return{status:i,score:s,checks:[],metrics:{cpu:0,memory:r,responseTime:e,errorRate:t,throughput:n("throughput").avg},lastUpdated:new Date}}function SC(n,e,t){const r=[];n.status==="critical"&&r.push({type:"critical",title:"System Critical",description:"System is in critical state with multiple failures",impact:"high",recommendations:["Check system resources immediately","Review error logs for root cause","Consider scaling resources"]});const s=e("response_time")[0];s&&s.trend==="degrading"&&r.push({type:"warning",title:"Response Time Degradation",description:`Response time has increased by ${s.changePercent}%`,impact:"medium",recommendations:["Optimize database queries","Check for memory leaks","Review caching strategies"]});const i=e("memory_usage")[0];i&&i.trend==="degrading"&&r.push({type:"warning",title:"Memory Usage Increasing",description:`Memory usage has increased by ${i.changePercent}%`,impact:"medium",recommendations:["Check for memory leaks","Optimize data structures","Consider garbage collection tuning"]});const l=t("response_time").avg;return l>1e3&&r.push({type:"optimization",title:"Response Time Optimization",description:`Average response time is ${l.toFixed(2)}ms`,impact:"low",recommendations:["Implement response caching","Optimize API endpoints","Consider CDN implementation"]}),r}var CC=Object.defineProperty,IC=Object.defineProperties,jC=Object.getOwnPropertyDescriptors,Id=Object.getOwnPropertySymbols,EC=Object.prototype.hasOwnProperty,TC=Object.prototype.propertyIsEnumerable,jd=(n,e,t)=>e in n?CC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ct=(n,e)=>{for(var t in e||(e={}))EC.call(e,t)&&jd(n,t,e[t]);if(Id)for(var t of Id(e))TC.call(e,t)&&jd(n,t,e[t]);return n},NC=(n,e)=>IC(n,jC(e)),yi=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class gn{constructor(){this.metrics=new Map,this.thresholds=[],this.healthChecks=[],this.MAX_METRICS_PER_TYPE=1e3,this.performanceHistory=new Map,this.monitoringInterval=null,this.isMonitoring=!1,this.initializeDefaultThresholds(),this.initializeHealthChecks(),this.startContinuousMonitoring()}static getInstance(){return gn.instance||(gn.instance=new gn),gn.instance}recordMetric(e,t,r,s={},i){const l={name:e,value:t,unit:r,timestamp:new Date,tags:s,metadata:i};this.metrics.has(e)||this.metrics.set(e,[]);const c=this.metrics.get(e);c.push(l),c.length>this.MAX_METRICS_PER_TYPE&&c.splice(0,c.length-this.MAX_METRICS_PER_TYPE),yC(l,this.thresholds),mt.logMetricRecorded(e,t,r,s,i)}recordResponseTime(e,t,r={}){this.recordMetric("response_time",t,"ms",ct({operation:e},r))}recordErrorRate(e,t,r={}){this.recordMetric("error_rate",t,"percent",ct({service:e},r))}recordThroughput(e,t,r=60,s={}){const i=hC(t,r);this.recordMetric("throughput",i,"ops/sec",ct({operation:e,period:r.toString()},s))}recordMemoryUsage(e,t,r={}){this.recordMetric("memory_usage",t,"bytes",ct({type:e},r))}recordDatabaseQuery(e,t,r,s={}){this.recordMetric("db_query_duration",t,"ms",ct({query:Cd(e)},s)),this.recordMetric("db_query_rows",r,"count",ct({query:Cd(e)},s))}recordComponentMount(e,t,r={}){this.recordMetric("component_mount_time",t,"ms",ct({component:e},r))}recordAuthentication(e,t,r={}){this.recordMetric("authentication_time",e,"ms",ct({success:t.toString()},r))}recordDataFetch(e,t,r,s={}){this.recordMetric("data_fetch_time",t,"ms",ct({operation:e,success:r.toString()},s))}recordNavigation(e,t,r,s={}){this.recordMetric("navigation_time",r,"ms",ct({from:e,to:t},s))}getMetrics(e,t=100){return(this.metrics.get(e)||[]).slice(-t)}getAllMetrics(){return new Map(this.metrics)}getAggregatedMetrics(e,t=3e5){const r=this.metrics.get(e)||[];return aC(r,t)}getSystemHealth(){return yi(this,null,function*(){const e=yield Promise.all(this.healthChecks.map(c=>yi(this,null,function*(){const o=Date.now();try{const d=yield c();return NC(ct({},d),{duration:Date.now()-o})}catch(d){return{name:"unknown",status:"fail",message:d instanceof Error?d.message:"Unknown error",duration:Date.now()-o}}}))),{status:t,score:r}=cC(e),s=this.getAggregatedMetrics("response_time").avg,i=this.getAggregatedMetrics("error_rate").avg,l=this.getAggregatedMetrics("throughput").avg;return{status:t,score:r,checks:e,metrics:{cpu:0,memory:this.getAggregatedMetrics("memory_usage").avg,responseTime:s,errorRate:i,throughput:l},lastUpdated:new Date}})}getActiveAlerts(){return mt.getActiveAlerts()}resolveAlert(e){mt.resolveAlert(e)}addHealthCheck(e){this.healthChecks.push(e)}setThresholds(e){this.thresholds=e,mt.logThresholdsUpdated(e)}initializeDefaultThresholds(){this.thresholds=vC()}initializeHealthChecks(){this.addHealthCheck(_C()),this.addHealthCheck(xC(e=>this.getAggregatedMetrics(e)))}startContinuousMonitoring(){if(this.isMonitoring)return;const e=cr("NODE_ENV")==="development"||cr("MODE")==="development",t=cr("VITE_ENABLE_PERFORMANCE_MONITORING")==="true";if(e&&!t){mt.logMonitoringDisabled();return}this.isMonitoring=!0,this.monitoringInterval=setInterval(()=>{this.capturePerformanceSnapshot()},12e4)}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null),this.isMonitoring=!1}capturePerformanceSnapshot(){return yi(this,null,function*(){try{const e=yield this.getSystemHealth(),t=this.getActiveAlerts(),r=bC(e,t,this.metrics),s="performance_snapshot";this.performanceHistory.has(s)||this.performanceHistory.set(s,[]);const i=this.performanceHistory.get(s);i.push(r),i.length>100&&i.splice(0,i.length-100),mt.logSnapshotCaptured(r.timestamp,r.metrics.size,t.length)}catch(e){mt.logSnapshotError(e)}})}getPerformanceTrends(e,t=3e5){const r=this.metrics.get(e)||[];return oC(r,t)}getPerformanceInsights(){const e=this.getSystemHealthSync();return SC(e,t=>this.getPerformanceTrends(t),t=>this.getAggregatedMetrics(t))}subscribeToAlerts(e){return mt.subscribeToAlerts(e)}getPerformanceHistory(e){return e?this.performanceHistory.get(e)||[]:this.performanceHistory.get("performance_snapshot")||[]}getSystemHealthSync(){return wC(e=>this.getAggregatedMetrics(e))}}const oe=gn.getInstance();var Yr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class kC{constructor(e,t){this.repository=e,this.adapterManager=t}getItemById(e){return Yr(this,null,function*(){return yield this.repository.getItemById(e)})}createItem(e){return Yr(this,null,function*(){var t,r;const s=performance.now();try{const i=yield this.repository.createItem(e);yield H.trackEvent("inventory_item_created",{itemId:(t=i.data)==null?void 0:t.id,category:e.category,adapterType:this.adapterManager.getCurrentAdapterType()});const l=performance.now()-s;return oe.recordResponseTime("inventory_item_create",l,{itemId:(r=i.data)==null?void 0:r.id}),i}catch(i){throw yield H.trackEvent("inventory_item_create_error",{error:i instanceof Error?i.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),i}})}updateItem(e,t){return Yr(this,null,function*(){const r=performance.now();try{const s=yield this.repository.updateItem(e,t);yield H.trackEvent("inventory_item_updated",{itemId:e,updatedFields:Object.keys(t).join(","),adapterType:this.adapterManager.getCurrentAdapterType()});const i=performance.now()-r;return oe.recordResponseTime("inventory_item_update",i,{itemId:e}),s}catch(s){throw yield H.trackEvent("inventory_item_update_error",{itemId:e,error:s instanceof Error?s.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),s}})}deleteItem(e){return Yr(this,null,function*(){const t=performance.now();try{const r=yield this.repository.deleteItem(e);yield H.trackEvent("inventory_item_deleted",{itemId:e,adapterType:this.adapterManager.getCurrentAdapterType()});const s=performance.now()-t;return oe.recordResponseTime("inventory_item_delete",s,{itemId:e}),r}catch(r){throw yield H.trackEvent("inventory_item_delete_error",{itemId:e,error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}addInventoryItem(e){return Yr(this,null,function*(){return yield this.repository.addInventoryItem(e)})}validateItem(e){return Yr(this,null,function*(){const t=[];return(!e.name||e.name.trim()==="")&&t.push("Item name is required"),(!e.category||e.category.trim()==="")&&t.push("Category is required"),(!e.location||e.location.trim()==="")&&t.push("Location is required"),e.quantity!==void 0&&e.quantity<0&&t.push("Quantity must be non-negative"),{isValid:t.length===0,errors:t}})}}var Zn=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class PC{constructor(e,t){this.repository=e,this.adapterManager=t}searchItems(e,t){return Zn(this,null,function*(){var r,s;const i=performance.now();try{const l=yield this.repository.searchItems(e);yield H.trackEvent("inventory_search",{query:e,resultCount:((r=l.data)==null?void 0:r.length)||0,adapterType:this.adapterManager.getCurrentAdapterType()});const c=performance.now()-i;return oe.recordResponseTime("inventory_search",c,{query:e,resultCount:String(((s=l.data)==null?void 0:s.length)||0)}),l}catch(l){throw yield H.trackEvent("inventory_search_error",{query:e,error:l instanceof Error?l.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),l}})}getFilteredItems(e,t,r){return Zn(this,null,function*(){var s;const i=performance.now();try{const l=yield this.repository.getFilteredItems(e,t,r);yield H.trackEvent("inventory_filter",{filterCount:Object.keys(e).length,resultCount:((s=l.data)==null?void 0:s.length)||0,adapterType:this.adapterManager.getCurrentAdapterType()});const c=performance.now()-i;return oe.recordResponseTime("inventory_filter",c,{filterCount:Object.keys(e).length.toString()}),l}catch(l){throw yield H.trackEvent("inventory_filter_error",{filters:e,error:l instanceof Error?l.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),l}})}fetchInventoryItems(){return Zn(this,null,function*(){return yield this.repository.fetchInventoryItems()})}getAllItems(){return Zn(this,null,function*(){return yield this.repository.getAllItems()})}refreshData(){return Zn(this,null,function*(){const e=performance.now();try{const t=yield this.repository.refreshData();yield H.trackEvent("inventory_refresh",{adapterType:this.adapterManager.getCurrentAdapterType()});const r=performance.now()-e;return oe.recordResponseTime("inventory_refresh",r,{}),t}catch(t){throw yield H.trackEvent("inventory_refresh_error",{error:t instanceof Error?t.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),t}})}}var vi=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class DC{constructor(e,t){this.repository=e,this.adapterManager=t}bulkCreateItems(e){return vi(this,null,function*(){const t=performance.now();try{const r=yield this.repository.bulkCreateItems(e);yield H.trackEvent("inventory_bulk_create",{itemCount:e.length,successCount:r.successCount,errorCount:r.errorCount,adapterType:this.adapterManager.getCurrentAdapterType()});const s=performance.now()-t;return oe.recordResponseTime("inventory_bulk_create",s,{itemCount:e.length.toString()}),r}catch(r){throw yield H.trackEvent("inventory_bulk_create_error",{itemCount:e.length,error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}bulkUpdateItems(e){return vi(this,null,function*(){const t=performance.now();try{const r=yield this.repository.bulkUpdateItems(e);yield H.trackEvent("inventory_bulk_update",{updateCount:e.length,successCount:r.successCount,errorCount:r.errorCount,adapterType:this.adapterManager.getCurrentAdapterType()});const s=performance.now()-t;return oe.recordResponseTime("inventory_bulk_update",s,{updateCount:e.length.toString()}),r}catch(r){throw yield H.trackEvent("inventory_bulk_update_error",{updateCount:e.length,error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}bulkDeleteItems(e){return vi(this,null,function*(){const t=performance.now();try{const r=yield this.repository.bulkDeleteItems(e);yield H.trackEvent("inventory_bulk_delete",{itemCount:e.length,successCount:r.successCount,errorCount:r.errorCount,adapterType:this.adapterManager.getCurrentAdapterType()});const s=performance.now()-t;return oe.recordResponseTime("inventory_bulk_delete",s,{itemCount:e.length.toString()}),r}catch(r){throw yield H.trackEvent("inventory_bulk_delete_error",{itemCount:e.length,error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}}var Js=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class AC{constructor(e,t){this.repository=e,this.adapterManager=t}addCategory(e){return Js(this,null,function*(){const t=performance.now();try{const r=yield this.repository.addCategory(e);yield H.trackEvent("inventory_category_added",{category:e,adapterType:this.adapterManager.getCurrentAdapterType()});const s=performance.now()-t;return oe.recordResponseTime("inventory_category_add",s,{category:e}),r}catch(r){throw yield H.trackEvent("inventory_category_add_error",{category:e,error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}deleteCategory(e){return Js(this,null,function*(){const t=performance.now();try{const r=yield this.repository.deleteCategory(e);yield H.trackEvent("inventory_category_deleted",{category:e,adapterType:this.adapterManager.getCurrentAdapterType()});const s=performance.now()-t;return oe.recordResponseTime("inventory_category_delete",s,{category:e}),r}catch(r){throw yield H.trackEvent("inventory_category_delete_error",{category:e,error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}getCategories(){return Js(this,null,function*(){var e;const t=performance.now();try{const r=yield this.repository.getCategories(),s=performance.now()-t;return oe.recordResponseTime("inventory_categories_fetch",s,{categoryCount:((e=r.data)==null?void 0:e.length)||0}),r}catch(r){throw yield H.trackEvent("inventory_categories_fetch_error",{error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}getLocations(){return Js(this,null,function*(){var e;const t=performance.now();try{const r=yield this.repository.getLocations(),s=performance.now()-t;return oe.recordResponseTime("inventory_locations_fetch",s,{locationCount:((e=r.data)==null?void 0:e.length)||0}),r}catch(r){throw yield H.trackEvent("inventory_locations_fetch_error",{error:r instanceof Error?r.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),r}})}}var _i=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class OC{constructor(e,t){this.repository=e,this.adapterManager=t}getInventoryStats(){return _i(this,null,function*(){const e=performance.now();try{const t=yield this.repository.getAllItems(),r={totalItems:t.length,categoriesCount:new Set(t.map(i=>i.category)).size,locationsCount:new Set(t.map(i=>i.location)).size,lowStockItems:t.filter(i=>(i.quantity||0)<10).length,expiredItems:t.filter(i=>i.expiration_date?new Date(i.expiration_date)<new Date:!1).length,lastUpdated:new Date},s=performance.now()-e;return oe.recordResponseTime("inventory_stats_calculate",s,{totalItems:r.totalItems}),r}catch(t){throw yield H.trackEvent("inventory_stats_error",{error:t instanceof Error?t.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),t}})}getItemHistory(){return _i(this,null,function*(){const e=performance.now();try{const t=yield this.repository.getItemHistory(),r=performance.now()-e;return oe.recordResponseTime("inventory_history_fetch",r,{historyCount:t.length}),t}catch(t){throw yield H.trackEvent("inventory_history_error",{error:t instanceof Error?t.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),t}})}refresh(){return _i(this,null,function*(){const e=performance.now();try{yield this.repository.refreshData();const t=performance.now()-e;return oe.recordResponseTime("inventory_refresh",t,{}),{success:!0,error:null}}catch(t){return yield H.trackEvent("inventory_refresh_error",{error:t instanceof Error?t.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}})}}var RC=Object.defineProperty,Ed=Object.getOwnPropertySymbols,$C=Object.prototype.hasOwnProperty,MC=Object.prototype.propertyIsEnumerable,Td=(n,e,t)=>e in n?RC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,FC=(n,e)=>{for(var t in e||(e={}))$C.call(e,t)&&Td(n,t,e[t]);if(Ed)for(var t of Ed(e))MC.call(e,t)&&Td(n,t,e[t]);return n},Z=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const gp=class Ke{constructor(){this.cacheManager=new Kw,this.repository=new VS,this.adapterManager=new JS,this.isInitialized=!1,this.initializationPromise=null,ye.isRegistered("inventory_service")||ye.registerCacheManager("inventory_service",this),this.coreService=new kC(this.repository,this.adapterManager),this.searchService=new PC(this.repository,this.adapterManager),this.bulkService=new DC(this.repository,this.adapterManager),this.categoryManagementService=new AC(this.repository,this.adapterManager),this.statsService=new OC(this.repository,this.adapterManager)}static getInstance(){return Ke.instance||(Ke.instance=new Ke),Ke.instance}static initialize(){return Z(this,null,function*(){yield Ke.getInstance().initialize()})}static createItem(e){return Z(this,null,function*(){return Ke.getInstance().createItem(e)})}static updateItem(e,t){return Z(this,null,function*(){return Ke.getInstance().updateItem(e,t)})}static deleteItem(e){return Z(this,null,function*(){return Ke.getInstance().deleteItem(e)})}static getItem(e){return Z(this,null,function*(){return Ke.getInstance(),Ke.getItem(e)})}static getAllItems(e){return Z(this,null,function*(){return Ke.getInstance().getAllItems(e)})}getInstanceId(){return`instance_${this===Ke.instance?"SINGLETON":"NEW"}`}initialize(){return Z(this,null,function*(){const e=performance.now();if(!this.isInitialized){if(this.initializationPromise){yield this.initializationPromise;return}this.initializationPromise=Z(this,null,function*(){try{yield this.adapterManager.initialize(),yield this.repository.initialize(this.adapterManager.getAdapter(),this.adapterManager.getCurrentAdapterType()),this.isInitialized=!0;const t=performance.now()-e;oe.recordResponseTime("inventory_service_initialization",t,{service:"InventoryServiceFacade",operation:"initialize"})}finally{this.initializationPromise=null}}),yield this.initializationPromise}})}isReady(){return this.isInitialized}fetchInventoryItems(){return Z(this,null,function*(){return yield this.searchService.fetchInventoryItems()})}fetchAllInventoryData(){return Z(this,null,function*(){const e=performance.now();try{const t=yield this.searchService.fetchInventoryItems(),r=yield this.statsService.getInventoryStats(),s={tools:t.filter(l=>l.category==="Tools"),supplies:t.filter(l=>l.category==="Supplies"),equipment:t.filter(l=>l.category==="Equipment"),officeHardware:t.filter(l=>l.category==="Office Hardware"),categories:Array.from(new Set(t.map(l=>l.category).filter(Boolean))),isLoading:!1,error:null},i=performance.now()-e;return oe.recordResponseTime("inventory_fetch_all_data",i,{itemCount:t.length.toString()}),s}catch(t){throw yield H.trackEvent("inventory_fetch_all_data_error",{error:t instanceof Error?t.message:"Unknown error",adapterType:this.adapterManager.getCurrentAdapterType()}),t}})}getAllItems(e,t){return Z(this,null,function*(){try{const r=yield this.searchService.getAllItems();return{data:r,count:Array.isArray(r)?r.length:0,error:null}}catch(r){return{data:[],count:0,error:r instanceof Error?r.message:"Unknown error"}}})}getItemById(e){return Z(this,null,function*(){return yield this.coreService.getItemById(e)})}createItem(e){return Z(this,null,function*(){return yield this.coreService.createItem(e)})}updateItem(e,t){return Z(this,null,function*(){return yield this.coreService.updateItem(e,t)})}deleteItem(e){return Z(this,null,function*(){return yield this.coreService.deleteItem(e)})}addInventoryItem(e){return Z(this,null,function*(){return yield this.coreService.addInventoryItem(e)})}addCategory(e){return Z(this,null,function*(){const t=yield this.categoryManagementService.addCategory(e);return{success:t.success,error:t.error||null}})}deleteCategory(e){return Z(this,null,function*(){const t=yield this.categoryManagementService.deleteCategory(e);return{success:t.success,error:t.error||null}})}bulkCreateItems(e){return Z(this,null,function*(){return yield this.bulkService.bulkCreateItems(e)})}bulkUpdateItems(e){return Z(this,null,function*(){return yield this.bulkService.bulkUpdateItems(e)})}bulkDeleteItems(e){return Z(this,null,function*(){return yield this.bulkService.bulkDeleteItems(e)})}searchItems(e){return Z(this,null,function*(){return yield this.searchService.searchItems(e)})}getFilteredItems(e,t,r){return Z(this,null,function*(){return yield this.searchService.getFilteredItems(e,t,r)})}getCategories(){return Z(this,null,function*(){return yield this.categoryManagementService.getCategories()})}getLocations(){return Z(this,null,function*(){return yield this.categoryManagementService.getLocations()})}getInventoryStats(){return Z(this,null,function*(){try{const e=yield this.statsService.getInventoryStats();return{data:{totalItems:e.totalItems,categoriesCount:e.categoriesCount,locationsCount:e.locationsCount,lowStockItems:e.lowStockItems,expiredItems:e.expiredItems,lastUpdated:e.lastUpdated},error:null}}catch(e){return{data:null,error:e instanceof Error?e.message:"Unknown error"}}})}refresh(){return Z(this,null,function*(){return yield this.statsService.refresh()})}validateItem(e){return Z(this,null,function*(){return yield this.coreService.validateItem(e)})}getItemHistory(){return Z(this,null,function*(){return yield this.statsService.getItemHistory()})}updateInventoryItem(e,t){return Z(this,null,function*(){const r=yield this.coreService.updateItem(e,t);if(r.data)return r.data;throw new Error(r.error||"Failed to update item")})}deleteInventoryItem(e){return Z(this,null,function*(){const t=yield this.coreService.deleteItem(e);if(!t.success)throw new Error(t.error||"Failed to delete item")})}refreshData(){return Z(this,null,function*(){return yield this.searchService.refreshData()})}switchAdapter(e){return Z(this,null,function*(){const t=performance.now();try{const r={success:!0,error:null},s=performance.now()-t;return oe.recordResponseTime("inventory_adapter_switch",s,{adapterType:e}),r}catch(r){throw yield H.trackEvent("inventory_adapter_switch_error",{adapterType:e,error:r instanceof Error?r.message:"Unknown error"}),r}})}transformDataForModal(e){return e.map(t=>FC({},t))}clearCache(){this.cacheManager.clear()}getCacheStats(){const e=this.cacheManager.getStats();return{hits:e.hits,misses:e.misses,size:e.size,updated_at:e.updated_at}}getCurrentAdapterType(){return this.adapterManager.getCurrentAdapterType()}getAdapterMetadata(){const e=this.adapterManager.getAdapterMetadata();return e&&typeof e=="object"?{type:e.type||"static",name:e.name||"Unknown",version:e.version||"1.0.0",capabilities:e.capabilities||[]}:{type:"static",name:"Default Adapter",version:"1.0.0",capabilities:[]}}subscribeToChanges(e){return sC.subscribeToChanges(t=>{this.clearCache(),H.trackEvent("inventory_realtime_update",{source:"facade",payload_type:typeof t,adapter_type:this.adapterManager.getCurrentAdapterType()}),e(t)})}};gp.instance=null;let LC=gp;const Mt=LC.getInstance();var zC=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class xi{static readFileContent(e){return zC(this,null,function*(){return new Promise((t,r)=>{const s=new globalThis.FileReader;s.onload=i=>{var l;const c=(l=i.target)==null?void 0:l.result;typeof c=="string"?t(c):r(new Error("Failed to read file as text"))},s.onerror=()=>r(new Error("Failed to read file")),s.readAsText(e)})})}static validateFileFormat(e,t){var r;const s=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();switch(t){case"csv":return s==="csv";case"json":return s==="json";default:return!1}}static getFileSizeMB(e){return e.size/(1024*1024)}}var BC=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class qC{static parseContent(e,t){return BC(this,null,function*(){switch(t.format){case"csv":return this.parseCSV(e,t);case"json":return this.parseJSON(e);default:throw new Error(`Unsupported format: ${t.format}`)}})}static parseCSV(e,t){const r=e.split(`
`).filter(l=>l.trim());if(r.length===0)return[];const s=r[0].split(",").map(l=>l.trim().replace(/"/g,""));return(t.hasHeaders?r.slice(1):r).map(l=>{const c=l.split(",").map(d=>d.trim().replace(/"/g,"")),o={};return s.forEach((d,u)=>{const m=c[u];if(m){const p=this.mapFieldName(d,t.customFieldMapping);p&&(o[p]=this.convertValue(m,p))}}),o})}static parseJSON(e){try{const t=JSON.parse(e);return Array.isArray(t)?t:[t]}catch(t){throw new Error("Invalid JSON format")}}static mapFieldName(e,t){return t&&t[e]?t[e]:{name:"itemName",item_name:"itemName","item name":"itemName",category:"category",location:"location",status:"status",quantity:"quantity",qty:"quantity",unit_cost:"unitCost","unit cost":"unitCost",cost:"unitCost",min_quantity:"minimumQuantity","min qty":"minimumQuantity",max_quantity:"maximumQuantity","max qty":"maximumQuantity",supplier:"supplier",barcode:"barcode",sku:"sku",description:"description",notes:"notes"}[e.toLowerCase()]||null}static convertValue(e,t){if(["quantity","unitCost","minimumQuantity","maximumQuantity"].includes(t)){const r=parseFloat(e);return isNaN(r)?0:r}return["isTracked","isFavorite"].includes(t)?e.toLowerCase()==="true"||e==="1":e}}var Nd=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class yp{static validateItems(e,t=!1){return Nd(this,null,function*(){if(t)return{isValid:!0,errors:[],warnings:[],validItems:e,invalidItems:[]};const r=[],s=[],i=[],l=[];for(const c of e){const o=[],d=[];(!c.name||c.name.trim()==="")&&o.push("Item name is required"),(!c.category||c.category.trim()==="")&&o.push("Category is required"),(!c.location||c.location.trim()==="")&&o.push("Location is required"),c.quantity!==void 0&&(isNaN(c.quantity)||c.quantity<0)&&o.push("Quantity must be a positive number"),c.unit_cost!==void 0&&(isNaN(c.unit_cost)||c.unit_cost<0)&&o.push("Unit cost must be a positive number"),c.reorder_point!==void 0&&(isNaN(c.reorder_point)||c.reorder_point<0)&&o.push("Reorder point must be a positive number"),c.quantity!==void 0&&c.reorder_point!==void 0&&c.quantity<c.reorder_point&&d.push("Quantity is below reorder point"),c.quantity!==void 0&&c.reorder_point!==void 0&&c.quantity<c.reorder_point&&d.push("Quantity is below reorder point"),c.name&&c.name.length>100&&d.push("Item name is very long"),o.length>0?(l.push({item:c,errors:o}),r.push(...o.map(u=>`${c.name||"Unknown item"}: ${u}`))):i.push(c),s.push(...d.map(u=>`${c.name||"Unknown item"}: ${u}`))}return{isValid:l.length===0,errors:r,warnings:s,validItems:i,invalidItems:l}})}static checkForDuplicate(e,t){return Nd(this,null,function*(){if(e.barcode){const r=t.find(s=>s.barcode===e.barcode);if(r)return r}if(e.sku){const r=t.find(s=>s.sku===e.sku);if(r)return r}if(e.name&&e.location){const r=t.find(s=>{var i,l;return((i=s.name)==null?void 0:i.toLowerCase())===e.name.toLowerCase()&&((l=s.location)==null?void 0:l.toLowerCase())===e.location.toLowerCase()});if(r)return r}return null})}}var UC=Object.defineProperty,kd=Object.getOwnPropertySymbols,HC=Object.prototype.hasOwnProperty,VC=Object.prototype.propertyIsEnumerable,Pd=(n,e,t)=>e in n?UC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Dd=(n,e)=>{for(var t in e||(e={}))HC.call(e,t)&&Pd(n,t,e[t]);if(kd)for(var t of kd(e))VC.call(e,t)&&Pd(n,t,e[t]);return n},WC=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class GC{static processImport(e,t,r){return WC(this,null,function*(){let s=0,i=0,l=0;const c=[],o=[];for(const d of e)try{const u=yield yp.checkForDuplicate(d,r);if(u)switch(t.duplicateHandling){case"skip":l++,o.push(`Skipped duplicate item: ${d.name}`);continue;case"update":{const m=Dd(Dd({},u),d);yield Mt.updateItem(m.id,m),s++;break}case"create":default:yield Mt.createItem(d),s++;break}else yield Mt.createItem(d),s++}catch(u){i++,c.push(`Failed to import ${d.name}: ${u instanceof Error?u.message:"Unknown error"}`)}return{success:i===0,importedCount:s,failedCount:i,skippedCount:l,errors:c,warnings:o,fileName:""}})}}var KC=Object.defineProperty,QC=Object.defineProperties,YC=Object.getOwnPropertyDescriptors,Ad=Object.getOwnPropertySymbols,JC=Object.prototype.hasOwnProperty,XC=Object.prototype.propertyIsEnumerable,Od=(n,e,t)=>e in n?KC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ZC=(n,e)=>{for(var t in e||(e={}))JC.call(e,t)&&Od(n,t,e[t]);if(Ad)for(var t of Ad(e))XC.call(e,t)&&Od(n,t,e[t]);return n},eI=(n,e)=>QC(n,YC(e)),tI=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class rI{static importItems(e){return tI(this,arguments,function*(t,r={format:"csv",hasHeaders:!0}){try{if(!xi.validateFileFormat(t,r.format))throw new Error(`Invalid file format. Expected ${r.format} file.`);if(xi.getFileSizeMB(t)>10)throw new Error("File size exceeds 10MB limit");const i=yield xi.readFileContent(t),l=yield qC.parseContent(i,r);if(l.length===0)return{success:!0,importedCount:0,failedCount:0,skippedCount:0,errors:[],warnings:["No items found in file"],fileName:t.name};const c=yield yp.validateItems(l,r.skipValidation);if(!c.isValid)return{success:!1,importedCount:0,failedCount:c.invalidItems.length,skippedCount:0,errors:c.errors,warnings:c.warnings,fileName:t.name};const o=yield Mt.getAllItems(),d=yield GC.processImport(c.validItems,r,o);return eI(ZC({},d),{fileName:t.name,warnings:[...d.warnings,...c.warnings]})}catch(s){return{success:!1,importedCount:0,failedCount:0,skippedCount:0,errors:[s instanceof Error?s.message:"Unknown error occurred"],warnings:[],fileName:t.name}}})}static getSupportedFormats(){return["csv","json"]}static getMaxFileSizeMB(){return 10}}class Ie{static initializeMetrics(e,t){const r={startTime:Date.now(),totalItems:t.totalItems,processedItems:0,failedItems:0,averageProcessingTime:0,peakMemoryUsage:0,averageMemoryUsage:0,processingRate:0,cacheHitRate:0,concurrentWorkers:t.maxConcurrentWorkers};return this.performanceMetrics.set(e,r),r}static updateMetrics(e,t){const r=this.performanceMetrics.get(e);r&&(Object.assign(r,t),this.performanceMetrics.set(e,r))}static finalizeMetrics(e){const t=this.performanceMetrics.get(e);return t&&(t.endTime=Date.now(),t.averageProcessingTime=t.processedItems>0?(t.endTime-t.startTime)/t.processedItems:0,t.peakMemoryUsage=Math.max(...this.memoryUsageHistory),t.averageMemoryUsage=this.memoryUsageHistory.length>0?this.memoryUsageHistory.reduce((r,s)=>r+s,0)/this.memoryUsageHistory.length:0,t.processingRate=this.calculateProcessingRate(t.startTime,t.processedItems),t.cacheHitRate=this.calculateCacheHitRate(),this.performanceMetrics.set(e,t)),t}static getPerformanceMetrics(e){return this.performanceMetrics.get(e)}static getAllPerformanceMetrics(){return Array.from(this.performanceMetrics.values())}static clearPerformanceMetrics(){this.performanceMetrics.clear()}static getMemoryUsage(){if(typeof performance!="undefined"&&"memory"in performance&&performance.memory){const e=performance.memory,t=(e==null?void 0:e.usedJSHeapSize)||0;return this.memoryUsageHistory.push(t),t}return 0}static calculateProcessingRate(e,t){if(t===0)return 0;const r=(Date.now()-e)/1e3;return Math.round(t/r)}static calculateCacheHitRate(){return 0}static calculateEstimatedTime(e,t,r){if(t===0)return;const s=Date.now()-e,i=t/s,l=r-t;return Math.round(l/i)}static clearMemoryHistory(){this.memoryUsageHistory=[]}static generateOperationId(){return`bulk-op-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}Ie.performanceMetrics=new Map;Ie.memoryUsageHistory=[];class yn{static initializeCache(e=this.DEFAULT_CACHE_SIZE){this.operationCache.clear();const t=this.operationCache.set.bind(this.operationCache);this.operationCache.set=(r,s)=>{if(this.operationCache.size>=e){const i=this.operationCache.keys().next().value;i&&this.operationCache.delete(i)}return t(r,s)}}static getCachedResult(e){return this.operationCache.get(e)}static hasCachedResult(e){return this.operationCache.has(e)}static cacheResult(e,t){this.operationCache.set(e,t)}static getCacheStats(){return{size:this.operationCache.size,hitRate:this.calculateCacheHitRate()}}static clearCache(){this.operationCache.clear()}static calculateCacheHitRate(){return 0}}yn.operationCache=new Map;yn.DEFAULT_CACHE_SIZE=1e3;var bi=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class xa{static createWorkerPool(e=this.DEFAULT_MAX_WORKERS){return Array.from({length:e},()=>()=>bi(this,null,function*(){return Promise.resolve()}))}static cleanupWorkerPool(e){e.length=0}static processBatchConcurrent(e,t,r,s,i){return bi(this,null,function*(){const l=e.map(d=>bi(null,null,function*(){var u,m;try{const p=yield t(d);return(u=i.onSuccess)==null||u.call(i,p,d),p}catch(p){const f=p instanceof Error?p.message:"Unknown error";throw(m=i.onError)==null||m.call(i,f,d),p}})),c=Math.min(r.length,l.length),o=this.chunkArray(l,c);for(const d of o)yield Promise.allSettled(d)})}static chunkArray(e,t){const r=[];for(let s=0;s<e.length;s+=t)r.push(e.slice(s,s+t));return r}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}}xa.DEFAULT_MAX_WORKERS=4;var nI=Object.defineProperty,sI=Object.defineProperties,aI=Object.getOwnPropertyDescriptors,Rd=Object.getOwnPropertySymbols,iI=Object.prototype.hasOwnProperty,oI=Object.prototype.propertyIsEnumerable,$d=(n,e,t)=>e in n?nI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lI=(n,e)=>{for(var t in e||(e={}))iI.call(e,t)&&$d(n,t,e[t]);if(Rd)for(var t of Rd(e))oI.call(e,t)&&$d(n,t,e[t]);return n},cI=(n,e)=>sI(n,aI(e));class yr{static createProgress(e,t,r,s,i,l,c,o){const d=Ie.getMemoryUsage(),u=Ie.calculateProcessingRate(c,t),m=Ie.calculateEstimatedTime(c,t,e);return{total:e,completed:t,failed:r,inProgress:s,percentage:Math.round(t/e*100),currentBatch:i,totalBatches:l,estimatedTimeRemaining:m,errors:[],memoryUsage:d,processingRate:u,concurrentWorkers:o}}static updateProgressWithErrors(e,t){return cI(lI({},e),{errors:t.slice(-10)})}static notifyProgress(e,t){e==null||e(t)}static notifyError(e,t,r){e==null||e(t,r)}static notifySuccess(e,t,r){e==null||e(t,r)}static notifyMemoryWarning(e,t,r){e==null||e(t,r)}static isMemoryUsageHigh(e,t,r=.8){return e>t*r}}var dI=Object.defineProperty,uI=Object.defineProperties,mI=Object.getOwnPropertyDescriptors,Md=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,pI=Object.prototype.propertyIsEnumerable,Fd=(n,e,t)=>e in n?dI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ln=(n,e)=>{for(var t in e||(e={}))hI.call(e,t)&&Fd(n,t,e[t]);if(Md)for(var t of Md(e))pI.call(e,t)&&Fd(n,t,e[t]);return n},cn=(n,e)=>uI(n,mI(e));const dn={QUICK:{maxRetries:1,baseDelay:100,maxDelay:200,backoffStrategy:"fixed"},STANDARD:{maxRetries:3,baseDelay:100,maxDelay:1e3,backoffStrategy:"linear"},NETWORK:{maxRetries:5,baseDelay:200,maxDelay:2e3,backoffStrategy:"exponential"},CRITICAL:{maxRetries:5,baseDelay:500,maxDelay:5e3,backoffStrategy:"exponential"},BACKGROUND:{maxRetries:2,baseDelay:1e3,maxDelay:5e3,backoffStrategy:"linear"}},ar={NETWORK_ONLY:n=>{const e=n.message.toLowerCase();return e.includes("network")||e.includes("timeout")||e.includes("fetch")||e.includes("connection")},TEMPORARY_ONLY:n=>{const e=n.message.toLowerCase();return e.includes("rate limit")||e.includes("temporary")||e.includes("busy")||e.includes("unavailable")},NETWORK_AND_TEMPORARY:n=>ar.NETWORK_ONLY(n)||ar.TEMPORARY_ONLY(n),ALL:()=>!0,NONE:()=>!1},es={UI_OPERATION:cn(ln({},dn.QUICK),{retryCondition:ar.NETWORK_ONLY}),DATA_FETCH:cn(ln({},dn.STANDARD),{retryCondition:ar.NETWORK_AND_TEMPORARY}),API_CALL:cn(ln({},dn.NETWORK),{retryCondition:ar.NETWORK_AND_TEMPORARY}),AUTH:cn(ln({},dn.CRITICAL),{retryCondition:ar.NETWORK_AND_TEMPORARY}),BACKGROUND_TASK:cn(ln({},dn.BACKGROUND),{retryCondition:ar.ALL})};cn(ln({},dn.BACKGROUND),{retryCondition:ar.NETWORK_AND_TEMPORARY,syncInterval:3e4,maxConcurrentSyncs:3});var fI=Object.defineProperty,Ld=Object.getOwnPropertySymbols,gI=Object.prototype.hasOwnProperty,yI=Object.prototype.propertyIsEnumerable,zd=(n,e,t)=>e in n?fI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Bd=(n,e)=>{for(var t in e||(e={}))gI.call(e,t)&&zd(n,t,e[t]);if(Ld)for(var t of Ld(e))yI.call(e,t)&&zd(n,t,e[t]);return n},Jr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class dr{static executeWithRetry(e){return Jr(this,arguments,function*(t,r={}){const s=performance.now(),i=Bd(Bd({},this.DEFAULT_CONFIG),r);let l,c=0;for(let d=0;d<=i.maxRetries;d++){c=d+1;try{const u=yield t(),m=performance.now()-s;return oe.recordResponseTime("retry_operation_success",m,{service:"OptimizedRetryService",operation:"executeWithRetry",attempts:c.toString(),strategy:i.backoffStrategy}),{success:!0,data:u,attempts:c,totalDuration:m}}catch(u){if(l=u,d===i.maxRetries||i.retryCondition&&!i.retryCondition(l))break;const m=this.calculateDelay(d,i),p=i.jitter?m+Math.random()*100:m;console.warn(`[OptimizedRetryService] Operation failed (attempt ${c}/${i.maxRetries+1}): ${l.message}. Retrying in ${p.toFixed(0)}ms...`),yield this.sleep(p)}}const o=performance.now()-s;return oe.recordErrorRate("retry_operation_failure",100,{service:"OptimizedRetryService",operation:"executeWithRetry",attempts:c.toString(),strategy:i.backoffStrategy,error:l.message}),{success:!1,error:l,attempts:c,totalDuration:o}})}static calculateDelay(e,t){let r;switch(t.backoffStrategy){case"linear":r=t.baseDelay*(e+1);break;case"exponential":r=t.baseDelay*Math.pow(2,e);break;case"fixed":r=t.baseDelay;break;default:r=t.baseDelay}return Math.min(r,t.maxDelay)}static sleep(e){return new Promise(t=>setTimeout(t,e))}static quickRetry(e){return Jr(this,null,function*(){const t=yield this.executeWithRetry(e,es.UI_OPERATION);if(!t.success)throw t.error;return t.data})}static standardRetry(e){return Jr(this,null,function*(){const t=yield this.executeWithRetry(e,es.DATA_FETCH);if(!t.success)throw t.error;return t.data})}static networkRetry(e){return Jr(this,null,function*(){const t=yield this.executeWithRetry(e,es.API_CALL);if(!t.success)throw t.error;return t.data})}static authRetry(e){return Jr(this,null,function*(){const t=yield this.executeWithRetry(e,es.AUTH);if(!t.success)throw t.error;return t.data})}static backgroundRetry(e){return Jr(this,null,function*(){const t=yield this.executeWithRetry(e,es.BACKGROUND_TASK);if(!t.success)throw t.error;return t.data})}}dr.DEFAULT_CONFIG={maxRetries:3,baseDelay:100,maxDelay:1e3,backoffStrategy:"linear",jitter:!0};const vI=dr.quickRetry,_I=dr.standardRetry,xI=dr.networkRetry,bI=dr.authRetry,wI=dr.backgroundRetry,vp=Object.freeze(Object.defineProperty({__proto__:null,OptimizedRetryService:dr,authRetry:bI,backgroundRetry:wI,networkRetry:xI,quickRetry:vI,standardRetry:_I},Symbol.toStringTag,{value:"Module"}));var wi=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class qd{static withRetry(e,t=3,r=100,s){return wi(this,null,function*(){const i=yield dr.executeWithRetry(e,{maxRetries:t,baseDelay:r,backoffStrategy:"linear",retryCondition:l=>(s==null||s(i.attempts,l),!0)});if(!i.success)throw i.error;return i.data})}static delay(e){return new Promise(t=>setTimeout(t,e))}static processItemsWithRetry(e,t){return wi(this,arguments,function*(r,s,i={}){const{maxRetries:l=3,delay:c=1e3,enableRetry:o=!0}=i,d=[],u=[],m=[],p=r.map((f,g)=>wi(this,null,function*(){try{let y;return o?y=yield this.withRetry(()=>s(f),l,c,(v,x)=>{console.warn(`Retrying item ${g+1} (attempt ${v}): ${x.message}`)}):y=yield s(f),d.push(y),{success:!0,result:y,item:f}}catch(y){const v=y instanceof Error?y.message:"Unknown error";return m.push(`Item ${g+1}: ${v}`),u.push(f),{success:!1,error:v,item:f}}}));return yield Promise.allSettled(p),{results:d,failed:u,errors:m}})}}class Xs{static validateConfig(e){const t=[];return e.batchSize!==void 0&&(e.batchSize<1||e.batchSize>1e3)&&t.push("Batch size must be between 1 and 1000"),e.delayBetweenBatches!==void 0&&e.delayBetweenBatches<0&&t.push("Delay between batches must be non-negative"),e.maxConcurrentWorkers!==void 0&&(e.maxConcurrentWorkers<1||e.maxConcurrentWorkers>16)&&t.push("Max concurrent workers must be between 1 and 16"),e.cacheSize!==void 0&&(e.cacheSize<1||e.cacheSize>1e4)&&t.push("Cache size must be between 1 and 10000"),e.memoryLimit!==void 0&&e.memoryLimit<1024*1024&&t.push("Memory limit must be at least 1MB"),{isValid:t.length===0,errors:t}}static validateItems(e){const t=[];return(!e||e.length===0)&&t.push("No items to process."),Array.isArray(e)||t.push("Items must be an array."),{isValid:t.length===0,errors:t}}static validateOperation(e){const t=[];return(!e||typeof e!="function")&&t.push("Operation must be a function."),{isValid:t.length===0,errors:t}}}class SI{static formatProgress(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches} • ${e.percentage}% complete`;let s;if(e.estimatedTimeRemaining){const l=Math.floor(e.estimatedTimeRemaining/6e4),c=Math.floor(e.estimatedTimeRemaining%6e4/1e3);s=l>0?`${l}m ${c}s remaining`:`${c}s remaining`}let i;if(e.processingRate&&e.memoryUsage){const l=Math.round(e.memoryUsage/1048576);i=`${e.processingRate} items/sec • ${l}MB RAM • ${e.concurrentWorkers} workers`}return{status:t,details:r,timeRemaining:s,performance:i}}static formatProgressSimple(e){return`${e.completed}/${e.total} (${e.percentage}%)`}static formatProgressDetailed(e){const t=`${e.completed}/${e.total} items processed`,r=`Batch ${e.currentBatch}/${e.totalBatches}`,s=`${e.percentage}% complete`;let i=`${t} • ${r} • ${s}`;if(e.estimatedTimeRemaining){const l=Math.floor(e.estimatedTimeRemaining/6e4),c=Math.floor(e.estimatedTimeRemaining%6e4/1e3),o=l>0?`${l}m ${c}s remaining`:`${c}s remaining`;i+=` • ${o}`}return e.processingRate&&(i+=` • ${e.processingRate} items/sec`),i}}var ts=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ur{static processBulkOperation(e,t){return ts(this,arguments,function*(r,s,i={}){const{batchSize:l=this.DEFAULT_BATCH_SIZE,delayBetweenBatches:c=this.DEFAULT_DELAY,maxConcurrentWorkers:o=this.DEFAULT_MAX_WORKERS,enableCaching:d=!0,cacheSize:u=this.DEFAULT_CACHE_SIZE,memoryLimit:m=this.DEFAULT_MEMORY_LIMIT,onProgress:p,onError:f,onSuccess:g,onMemoryWarning:y}=i,v=Xs.validateItems(r);if(!v.isValid)throw new Error(v.errors.join(", "));const x=Xs.validateConfig(i);if(!x.isValid)throw new Error(x.errors.join(", "));const b=Xs.validateOperation(s);if(!b.isValid)throw new Error(b.errors.join(", "));const C=Ie.generateOperationId(),k=Ie.initializeMetrics(C,{totalItems:r.length,maxConcurrentWorkers:o});d&&yn.initializeCache(u);const P=[],E=[],$=[],w=Math.ceil(r.length/l),S=Date.now(),A=xa.createWorkerPool(o);try{for(let I=0;I<w;I++){const T=Ie.getMemoryUsage();yr.isMemoryUsageHigh(T,m,this.MEMORY_WARNING_THRESHOLD)&&yr.notifyMemoryWarning(y,T,m);const j=I*l,M=Math.min(j+l,r.length),B=r.slice(j,M);yield xa.processBatchConcurrent(B,s,A,d,{onError:(V,q)=>{$.push(`Item ${B.indexOf(q)+1}: ${V}`),E.push(q),Ie.updateMetrics(C,{failedItems:k.failedItems+1}),yr.notifyError(f,V,q.id||"unknown")},onSuccess:(V,q)=>{P.push(V),Ie.updateMetrics(C,{processedItems:k.processedItems+1}),yr.notifySuccess(g,V,q.id||"unknown")}});const G=P.length,Y=E.length,R=B.length,D=r.length,U=yr.createProgress(D,G,Y,R,I+1,w,S,o),F=yr.updateProgressWithErrors(U,$);yr.notifyProgress(p,F),I<w-1&&c>0&&(yield qd.delay(c))}return Ie.finalizeMetrics(C),{results:P,failed:E,errors:$,metrics:Ie.getPerformanceMetrics(C)}}finally{xa.cleanupWorkerPool(A),yn.clearCache(),Ie.clearMemoryHistory()}})}static simpleBulkOperation(e,t){return ts(this,null,function*(){const r=[],s=[],i=[],l=e.map((c,o)=>ts(null,null,function*(){try{const d=yield t(c);return r.push(d),{success:!0,result:d,item:c}}catch(d){const u=d instanceof Error?d.message:"Unknown error";return i.push(`Item ${o+1}: ${u}`),s.push(c),{success:!1,error:u,item:c}}}));return yield Promise.allSettled(l),{results:r,failed:s,errors:i}})}static simpleBulkOperationWithRetry(e,t,r){return ts(this,null,function*(){return qd.processItemsWithRetry(e,t,r)})}static standardBulkOperation(e,t,r){return ts(this,null,function*(){const s=[],i=[],l=[];for(let c=0;c<e.length;c++){try{const o=yield t(e[c]);s.push(o)}catch(o){const d=o instanceof Error?o.message:"Unknown error";l.push(`Item ${c+1}: ${d}`),i.push(e[c])}r==null||r(c+1,e.length)}return{results:s,failed:i,errors:l}})}static validateConfig(e){return Xs.validateConfig(e)}static formatProgress(e){return SI.formatProgress(e)}static getPerformanceMetrics(e){return Ie.getPerformanceMetrics(e)}static getAllPerformanceMetrics(){return Ie.getAllPerformanceMetrics()}static clearPerformanceMetrics(){Ie.clearPerformanceMetrics()}static getCacheStats(){return yn.getCacheStats()}static clearCache(){yn.clearCache()}static getDefaultBatchSize(){return this.DEFAULT_BATCH_SIZE}static getDefaultDelay(){return this.DEFAULT_DELAY}static getDefaultMaxWorkers(){return this.DEFAULT_MAX_WORKERS}static getDefaultCacheSize(){return this.DEFAULT_CACHE_SIZE}static getDefaultMemoryLimit(){return this.DEFAULT_MEMORY_LIMIT}}ur.DEFAULT_BATCH_SIZE=50;ur.DEFAULT_DELAY=100;ur.DEFAULT_MAX_WORKERS=4;ur.DEFAULT_CACHE_SIZE=1e3;ur.DEFAULT_MEMORY_LIMIT=100*1024*1024;ur.MEMORY_WARNING_THRESHOLD=.8;var CI=Object.defineProperty,II=Object.defineProperties,jI=Object.getOwnPropertyDescriptors,Ud=Object.getOwnPropertySymbols,EI=Object.prototype.hasOwnProperty,TI=Object.prototype.propertyIsEnumerable,Hd=(n,e,t)=>e in n?CI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_p=(n,e)=>{for(var t in e||(e={}))EI.call(e,t)&&Hd(n,t,e[t]);if(Ud)for(var t of Ud(e))TI.call(e,t)&&Hd(n,t,e[t]);return n},xp=(n,e)=>II(n,jI(e)),Je=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Fr=(n,e)=>{console.log(`Analytics Event: ${n}`,e)};function NI(n,e,t){return Je(this,null,function*(){try{const r=Xh(n);if(!r.isValid)throw new Error(r.errors.join(", "));const s=yield ip(n);e(s)}catch(r){t(r instanceof Error?r.message:"Failed to create item")}})}function kI(n,e,t,r){return Je(this,null,function*(){try{if(!n)throw new Error("Item ID is required");const s=Xh(e);if(!s.isValid)throw new Error(s.errors.join(", "));const i=yield Ta(n,e);t(i)}catch(s){r(s instanceof Error?s.message:"Failed to update item")}})}function PI(n,e,t){return Je(this,null,function*(){try{if(!n)throw new Error("Item ID is required");yield Na(n),se("inventory","item_deleted",`Inventory item deleted: ${n}`,"info",{itemId:n,deletionMethod:"single_item"}),ie("delete_item","inventory",{itemId:n,deletionMethod:"single_item"}),Fr("inventory_item_deleted",{itemId:n,deletionMethod:"single_item"}),e()}catch(r){t(r instanceof Error?r.message:"Failed to delete item")}})}function DI(n,e,t,r,s){return Je(this,null,function*(){try{if(!e||e.length===0)throw new Error("No items selected for bulk operation");let i;switch(n){case"delete":i=yield MI(e,t==null?void 0:t.progressConfig);break;case"update":if(!(t!=null&&t.updateData))throw new Error("Update data is required for bulk update operation");i=yield FI(e,t.updateData,t.progressConfig);break;case"export":if(!(t!=null&&t.exportOptions))throw new Error("Export options are required for bulk export operation");i=yield LI(e,t.exportOptions);break;default:throw new Error(`Unsupported bulk operation: ${n}`)}return r==null||r(i),i}catch(i){const l=i instanceof Error?i.message:"Bulk operation failed";throw s==null||s(l),new Error(l)}})}function AI(n,e,t,r){return Je(this,null,function*(){try{if(!n)throw new Error("No file selected for import");const s=e||{validateData:!0,skipDuplicates:!0,createMissingCategories:!0},i=zI(s);if(!i.isValid)throw new Error(`Invalid import options: ${i.errors.join(", ")}`);const l=yield rI.importItems(n,s);return se("inventory","bulk_import_completed",`Bulk import completed: ${l.importedCount} items imported`,"info",{fileName:l.fileName,importedCount:l.importedCount,failedCount:l.failedCount,skippedCount:l.skippedCount,errors:l.errors.length,warnings:l.warnings.length}),t==null||t(l),l}catch(s){console.error("Bulk import failed:",s);const i=s instanceof Error?s.message:"Bulk import failed";throw r==null||r(i),new Error(i)}})}function OI(n,e,t){return Je(this,null,function*(){try{if(!n)throw new Error("Item ID is required");const r=yield lp(n);se("inventory","item_duplicated",`Inventory item duplicated: ${n}`,"info",{originalItemId:n,duplicatedItemId:r.id}),ie("duplicate_item","inventory",{originalItemId:n,duplicatedItemId:r.id}),Fr("inventory_item_duplicated",{originalItemId:n,duplicatedItemId:r.id}),e(r)}catch(r){t(r instanceof Error?r.message:"Failed to duplicate item")}})}function RI(n,e,t){return Je(this,null,function*(){try{if(!n)throw new Error("Item ID is required");const r=yield op(n);se("inventory","item_archived",`Inventory item archived: ${n}`,"info",{itemId:n,archiveMethod:"single_item"}),ie("archive_item","inventory",{itemId:n,archiveMethod:"single_item"}),Fr("inventory_item_archived",{itemId:n,archiveMethod:"single_item"}),e(r)}catch(r){t(r instanceof Error?r.message:"Failed to archive item")}})}function $I(n,e){return Je(this,null,function*(){try{const t=yield cp(n,e);return se("inventory","bulk_update_by_category_completed",`Bulk update by category completed: ${t.updatedCount} items updated`,"info",{category:n,updatedCount:t.updatedCount}),ie("bulk_update_by_category","inventory",{category:n,updatedCount:t.updatedCount}),Fr("inventory_bulk_update_by_category_completed",{category:n,updatedCount:t.updatedCount}),t}catch(t){throw console.error("Error in bulk update by category:",t),new Error("Failed to bulk update items by category")}})}function MI(n,e){return Je(this,null,function*(){try{if(e){const{results:t,failed:r,errors:s,metrics:i}=yield ur.processBulkOperation(n,l=>Je(null,null,function*(){return yield Na(l)}),xp(_p({},e),{enableCaching:!0,maxConcurrentWorkers:4,memoryLimit:104857600,onMemoryWarning:(l,c)=>{console.warn(`Memory usage high: ${Math.round(l/1048576)}MB / ${Math.round(c/1048576)}MB`)}}));return console.log("Bulk deletion completed with performance metrics:",{total:n.length,successful:t.length,failed:r.length,errors:s.length,processingTime:i.averageProcessingTime,memoryUsage:i.peakMemoryUsage,processingRate:i.processingRate}),{deletedCount:t.length}}else{const r=(yield Promise.allSettled(n.map(s=>Na(s)))).filter(s=>s.status==="fulfilled").length;return se("inventory","bulk_deletion_completed",`Bulk deletion completed: ${r}/${n.length} items`,"info",{totalItems:n.length,deletedCount:r,failedCount:n.length-r,deletionMethod:"bulk_operation"}),ie("bulk_delete_items","inventory",{totalItems:n.length,deletedCount:r,failedCount:n.length-r}),Fr("inventory_bulk_deletion_completed",{totalItems:n.length,deletedCount:r,failedCount:n.length-r,deletionMethod:"bulk_operation"}),{deletedCount:r}}}catch(t){throw console.error("Error in bulk deletion:",t),new Error("Bulk deletion failed")}})}function FI(n,e,t){return Je(this,null,function*(){try{if(t){const{results:r,failed:s,errors:i,metrics:l}=yield ur.processBulkOperation(n,c=>Je(null,null,function*(){return yield Ta(c,Ea(e))}),xp(_p({},t),{enableCaching:!0,maxConcurrentWorkers:4,memoryLimit:104857600,onMemoryWarning:(c,o)=>{console.warn(`Memory usage high: ${Math.round(c/1048576)}MB / ${Math.round(o/1048576)}MB`)}}));return console.log("Bulk update completed with performance metrics:",{total:n.length,successful:r.length,failed:s.length,errors:i.length,processingTime:l.averageProcessingTime,memoryUsage:l.peakMemoryUsage,processingRate:l.processingRate}),{updatedCount:r.length}}else{const s=(yield Promise.allSettled(n.map(i=>Ta(i,Ea(e))))).filter(i=>i.status==="fulfilled").length;return se("inventory","bulk_update_completed",`Bulk update completed: ${s}/${n.length} items`,"info",{totalItems:n.length,updatedCount:s,failedCount:n.length-s,updateMethod:"bulk_operation"}),ie("bulk_update_items","inventory",{totalItems:n.length,updatedCount:s,failedCount:n.length-s}),Fr("inventory_bulk_update_completed",{totalItems:n.length,updatedCount:s,failedCount:n.length-s,updateMethod:"bulk_operation"}),{updatedCount:s}}}catch(r){throw console.error("Error in bulk update:",r),new Error("Bulk update failed")}})}function LI(n,e){return Je(this,null,function*(){try{const t=yield pp.exportItems(n,e);return se("inventory","bulk_export_completed",`Bulk export completed: ${n.length} items exported`,"info",{totalItems:n.length,exportFormat:e.format,exportMethod:"bulk_operation"}),ie("bulk_export_items","inventory",{totalItems:n.length,exportFormat:e.format}),Fr("inventory_bulk_export_completed",{totalItems:n.length,exportFormat:e.format,exportMethod:"bulk_operation"}),console.log("Bulk export completed with performance metrics:",{totalItems:n.length,exportFormat:e.format,exportMethod:"bulk_operation"}),{exportedCount:n.length}}catch(t){throw console.error("Error in bulk export:",t),new Error("Bulk export failed")}})}function zI(n){const e=[];return typeof n.validateData!="boolean"&&e.push("validateData must be a boolean"),typeof n.skipDuplicates!="boolean"&&e.push("skipDuplicates must be a boolean"),typeof n.createMissingCategories!="boolean"&&e.push("createMissingCategories must be a boolean"),{isValid:e.length===0,errors:e}}var ue=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Cs{static handleCreateItem(e,t,r){return ue(this,null,function*(){return NI(e,t,r)})}static handleUpdateItem(e,t,r,s){return ue(this,null,function*(){return kI(e,t,r,s)})}static handleDeleteItem(e,t,r){return ue(this,null,function*(){return PI(e,t,r)})}static handleBulkOperation(e,t,r,s,i){return ue(this,null,function*(){return DI(e,t,r,s,i)})}static handleBulkImport(e,t,r,s){return ue(this,null,function*(){return AI(e,t,r,s)})}static handleDuplicateItem(e,t,r){return ue(this,null,function*(){return OI(e,t,r)})}static handleArchiveItem(e,t,r){return ue(this,null,function*(){return RI(e,t,r)})}static getItems(e){return ue(this,null,function*(){return Zh(e)})}static getItemById(e){return ue(this,null,function*(){return ep(e)})}static getItemsByCategory(e){return ue(this,null,function*(){return Ao(e)})}static getItemsByLocation(e){return ue(this,null,function*(){return tp(e)})}static getItemsByStatus(e){return ue(this,null,function*(){return rp(e)})}static searchItems(e){return ue(this,null,function*(){return np(e)})}static getLowStockItems(){return ue(this,null,function*(){return sp()})}static getExpiringItems(e=30){return ue(this,null,function*(){return ap(e)})}static bulkUpdateItemsByCategory(e,t){return ue(this,null,function*(){return $I(e,t)})}static getSuppliersByFacility(e){return ue(this,null,function*(){return yield dp(e)})}static getInventoryTransactionsByFacility(e){return ue(this,null,function*(){return yield up(e)})}static getInventoryCostsByFacility(e){return ue(this,null,function*(){return yield mp(e)})}static getEquipmentMaintenanceByFacility(e){return ue(this,null,function*(){return yield hp(e)})}}var rt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class BI{scanOperationalGaps(e){return rt(this,null,function*(){const t=[],r=yield this.scanEquipmentMaintenance(e);t.push(...r);const s=yield this.scanComplianceGaps(e);t.push(...s);const i=yield this.scanOperationalIssues(e);t.push(...i);const l=yield this.scanSafetyGaps(e);return t.push(...l),t})}scanEquipmentMaintenance(e){return rt(this,null,function*(){const t=[],r=new Date;try{const s=yield this.scanAutoclaveMaintenance(e,r);t.push(...s);const i=yield this.scanToolMaintenance(e);t.push(...i)}catch(s){console.error("Error scanning equipment maintenance:",s)}return t})}scanAutoclaveMaintenance(e,t){return rt(this,null,function*(){const r=[],{data:s,error:i}=yield _.from("autoclaves").select("*").eq("facility_id",e).eq("status","active");if(i)throw i;return s==null||s.forEach(l=>{const c=l;c.next_maintenance&&new Date(c.next_maintenance)<=t&&r.push({id:Yt(),type:"equipment",priority:"high",title:`Autoclave Maintenance Due: ${c.autoclave_name}`,description:`Maintenance is due for autoclave ${c.autoclave_name}. Schedule maintenance to ensure proper operation.`,category:"equipment",dueDate:c.next_maintenance,estimatedPoints:75,estimatedDuration:120,assignedRole:"technician",facilityId:e,metadata:{autoclaveId:c.id,equipmentType:"autoclave"}}),c.calibration_due&&new Date(c.calibration_due)<=t&&r.push({id:Yt(),type:"compliance",priority:"urgent",title:`Autoclave Calibration Due: ${c.autoclave_name}`,description:`Calibration is due for autoclave ${c.autoclave_name}. This is critical for compliance.`,category:"compliance",dueDate:c.calibration_due,estimatedPoints:100,estimatedDuration:60,assignedRole:"technician",facilityId:e,metadata:{autoclaveId:c.id,equipmentType:"autoclave"}})}),r})}scanToolMaintenance(e){return rt(this,null,function*(){const t=[],r=yield At.getToolsByFacilityAndStatus(e,"problem");return r==null||r.forEach(s=>{t.push({id:Yt(),type:"equipment",priority:"medium",title:`Tool Maintenance Required: ${s.name||s.id}`,description:`Tool ${s.name||s.id} requires maintenance. Check condition and repair if possible.`,category:"equipment",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:50,estimatedDuration:45,assignedRole:"technician",facilityId:e,metadata:{toolId:s.id,toolName:s.name||s.id}})}),t})}scanComplianceGaps(e){return rt(this,null,function*(){const t=[],r=new Date;try{const s=yield this.scanBITests(e,r);t.push(...s);const i=yield this.scanCleaningTasks(e,r);t.push(...i)}catch(s){console.error("Error scanning compliance gaps:",s)}return t})}scanBITests(e,t){return rt(this,null,function*(){const r=[],{data:s,error:i}=yield _.from("biological_indicator_tests").select("*").eq("facility_id",e).eq("status","pending").lte("due_date",t.toISOString().split("T")[0]);if(i)throw i;return s==null||s.forEach(l=>{const c=l;r.push({id:Yt(),type:"compliance",priority:"urgent",title:"Daily BI Test Required",description:"Daily Biological Indicator test is required for sterilization compliance.",category:"compliance",dueDate:c.due_date,estimatedPoints:80,estimatedDuration:30,assignedRole:"operator",facilityId:e,metadata:{biTestId:c.id,testType:"daily_bi"}})}),r})}scanCleaningTasks(e,t){return rt(this,null,function*(){const r=[],{data:s,error:i}=yield _.from("cleaning_tasks").select("*").eq("facility_id",e).eq("status","pending").lte("due_date",t.toISOString());if(i)throw i;return s==null||s.forEach(l=>{const c=l;r.push({id:Yt(),type:"compliance",priority:c.priority==="critical"?"urgent":"high",title:`Cleaning Task Overdue: ${c.name}`,description:`Cleaning task "${c.name}" is overdue. Complete to maintain compliance.`,category:"compliance",dueDate:c.due_date,estimatedPoints:60,estimatedDuration:c.estimated_duration_minutes||60,assignedRole:"cleaning_staff",facilityId:e,metadata:{taskId:c.id,taskName:c.name,location:c.location}})}),r})}scanOperationalIssues(e){return rt(this,null,function*(){const t=[];try{const r=yield this.scanStuckTools(e);t.push(...r);const s=yield this.scanLowInventory(e);t.push(...s)}catch(r){console.error("Error scanning operational issues:",r)}return t})}scanStuckTools(e){return rt(this,null,function*(){const t=[],r=["bath1","bath2","airDry","autoclave"],i=(yield Promise.all(r.map(l=>At.getToolsByFacilityAndStatus(e,l)))).flat();return i==null||i.forEach(l=>{t.push({id:Yt(),type:"operational",priority:"medium",title:`Tool Stuck in Phase: ${l.name||l.id}`,description:`Tool ${l.name||l.id} appears to be stuck in ${l.status} phase. Check workflow status.`,category:"operational",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:40,estimatedDuration:30,assignedRole:"operator",facilityId:e,metadata:{toolId:l.id,toolName:l.name||l.id,currentPhase:l.status}})}),t})}scanLowInventory(e){return rt(this,null,function*(){const t=[],s=(yield Cs.getItems()).filter(i=>{var l,c;return i.facility_id===e&&(i.quantity||0)<(((l=i.data)==null?void 0:l.min_quantity)||0)&&((c=i.data)==null?void 0:c.isActive)===!0});return s==null||s.forEach(i=>{var l;t.push({id:Yt(),type:"operational",priority:"high",title:`Low Stock Alert: ${i.name}`,description:`Inventory item ${i.name} is running low. Current quantity: ${i.quantity}.`,category:"operational",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:35,estimatedDuration:20,assignedRole:"inventory_manager",facilityId:e,metadata:{itemId:i.id,itemName:i.name,currentQuantity:i.quantity,minQuantity:(l=i.data)==null?void 0:l.min_quantity}})}),t})}scanSafetyGaps(e){return rt(this,null,function*(){const t=[];try{const r=yield this.scanFailedCycles(e);t.push(...r)}catch(r){console.error("Error scanning safety gaps:",r)}return t})}scanFailedCycles(e){return rt(this,null,function*(){const t=[],{data:r,error:s}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e).eq("status","failed").gte("created_at",new Date(Date.now()-6048e5).toISOString());if(s)throw s;return r==null||r.forEach(i=>{const l=i;t.push({id:Yt(),type:"safety",priority:"high",title:`Investigate Failed Cycle: ${l.id}`,description:`Sterilization cycle ${l.id} failed and requires investigation to prevent future failures.`,category:"safety",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:70,estimatedDuration:90,assignedRole:"supervisor",facilityId:e,metadata:{cycleId:l.id,failureReason:l.failure_reason}})}),t})}getGapStatistics(e){const t=e.length,r=e.reduce((d,u)=>(d[u.type]=(d[u.type]||0)+1,d),{}),s=e.reduce((d,u)=>(d[u.priority]=(d[u.priority]||0)+1,d),{}),i=e.reduce((d,u)=>(d[u.category]=(d[u.category]||0)+1,d),{}),l=e.reduce((d,u)=>(d[u.assignedRole]=(d[u.assignedRole]||0)+1,d),{}),c=t>0?e.reduce((d,u)=>d+u.estimatedPoints,0)/t:0,o=e.reduce((d,u)=>d+u.estimatedDuration,0);return{total:t,byType:r,byPriority:s,byCategory:i,byRole:l,averagePoints:c,totalEstimatedDuration:o}}filterGaps(e,t){return e.filter(r=>!(t.type&&r.type!==t.type||t.priority&&r.priority!==t.priority||t.category&&r.category!==t.category||t.assignedRole&&r.assignedRole!==t.assignedRole||t.facilityId&&r.facilityId!==t.facilityId))}sortGapsByPriority(e){const t={urgent:4,high:3,medium:2,low:1};return e.sort((r,s)=>{const i=(t[s.priority]||0)-(t[r.priority]||0);return i!==0?i:new Date(r.dueDate).getTime()-new Date(s.dueDate).getTime()})}getGapsDueToday(e){const t=new Date().toISOString().split("T")[0];return e.filter(r=>r.dueDate<=t)}getOverdueGaps(e){const t=new Date().toISOString().split("T")[0];return e.filter(r=>r.dueDate<t)}}var qI=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class UI{assignTasksWithAI(e,t,r){return qI(this,null,function*(){try{const s=this.prepareAnalysisData(e,t,r),i=yield Hh({prompt:this.buildAIPrompt(s),context:"Daily Operations Task Assignment"});return this.parseAITaskAssignments(i,e,t,r)}catch(s){return console.error("AI task assignment failed, using fallback logic:",s),this.fallbackTaskAssignment(e,t,r)}})}prepareAnalysisData(e,t,r){return{operationalGaps:e,availableUsers:t,configuration:r,facilityContext:{totalGaps:e.length,gapTypes:e.reduce((s,i)=>(s[i.type]=(s[i.type]||0)+1,s),{}),priorityDistribution:e.reduce((s,i)=>(s[i.priority]=(s[i.priority]||0)+1,s),{})}}}buildAIPrompt(e){return`Analyze the following operational gaps and assign tasks to users optimally:

Operational Gaps: ${JSON.stringify(e.operationalGaps,null,2)}
Available Users: ${JSON.stringify(e.availableUsers,null,2)}
Configuration: ${JSON.stringify(e.configuration,null,2)}
Facility Context: ${JSON.stringify(e.facilityContext,null,2)}

Please provide a JSON response with task assignments that:
1. Respects max tasks per user (${e.configuration.maxTasksPerUser})
2. Prioritizes urgent and high priority tasks
3. Matches user roles to task categories
4. Balances workload across users
5. Considers task priority and estimated duration

Return ONLY valid JSON in this exact format:
[
  {
    "userId": "user_id_here",
    "tasks": [
      {
        "gapId": "gap_id_here"
      }
    ]
  }
]

Each task should reference a gapId from the operational gaps. Do not include any explanatory text, only the JSON array.`}parseAITaskAssignments(e,t,r,s){try{const i=e.match(/\[[\s\S]*\]/);if(!i)return console.warn("No JSON array found in AI response, using fallback"),this.fallbackTaskAssignment(t,r,s);const l=JSON.parse(i[0]);if(!Array.isArray(l))return console.warn("AI response is not an array, using fallback"),this.fallbackTaskAssignment(t,r,s);const c=[],o=new Map(r.map(u=>[u.id,u])),d=new Map(t.map(u=>[u.id,u]));for(const u of l){if(!u.userId||!Array.isArray(u.tasks))continue;if(!o.get(u.userId)){console.warn(`User ${u.userId} not found, skipping assignment`);continue}const p=[];for(const f of u.tasks){if(!f.gapId)continue;const g=d.get(f.gapId);g&&p.push({id:Tw(),title:g.title,description:g.description,category:g.category,priority:g.priority,points:g.estimatedPoints,estimatedDuration:g.estimatedDuration,dueDate:g.dueDate,type:g.type,assignedRole:g.assignedRole,facilityId:g.facilityId,metadata:g.metadata,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}p.length>0&&c.push({userId:u.userId,tasks:p})}return c.length>0?c:(console.warn("AI parsing produced no valid assignments, using fallback"),this.fallbackTaskAssignment(t,r,s))}catch(i){return console.error("Error parsing AI response:",i),this.fallbackTaskAssignment(t,r,s)}}fallbackTaskAssignment(e,t,r){const s=[],i=[...e].sort((c,o)=>Wc(o.priority)-Wc(c.priority)),l=new Map;for(const c of i){const o=t.filter(u=>(l.get(u.id)||0)<r.maxTasksPerUser);if(o.length===0)break;const d=this.findBestUserMatch(c,o);if(d){const u=l.get(d.id)||0;l.set(d.id,u+1);let m=s.find(p=>p.userId===d.id);m||(m={userId:d.id,tasks:[]},s.push(m)),m.tasks.push({id:Ew(),title:c.title,description:c.description,category:c.category,priority:c.priority,points:c.estimatedPoints,dueDate:c.dueDate,type:c.type,estimatedDuration:c.estimatedDuration,assignedRole:c.assignedRole,facilityId:c.facilityId,metadata:c.metadata,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}}return s}findBestUserMatch(e,t){if(e.assignedRole){const s=t.find(i=>i.role===e.assignedRole);if(s)return s}const r=t.filter(s=>Yh(s.role,e.category));return r.length>0?r[0]:t[0]||null}validateTaskAssignments(e,t){const r=[],s=[];return e.forEach((i,l)=>{var c;i.userId||r.push(`Assignment ${l+1}: Missing userId`),(!i.tasks||i.tasks.length===0)&&s.push(`Assignment ${l+1}: No tasks assigned`),i.tasks&&i.tasks.length>t.maxTasksPerUser&&r.push(`Assignment ${l+1}: Exceeds max tasks per user (${i.tasks.length} > ${t.maxTasksPerUser})`),(c=i.tasks)==null||c.forEach((o,d)=>{o.title||r.push(`Assignment ${l+1}, Task ${d+1}: Missing title`),o.category||r.push(`Assignment ${l+1}, Task ${d+1}: Missing category`),o.priority||r.push(`Assignment ${l+1}, Task ${d+1}: Missing priority`),o.points<=0&&s.push(`Assignment ${l+1}, Task ${d+1}: Zero or negative points`),o.estimatedDuration<=0&&s.push(`Assignment ${l+1}, Task ${d+1}: Zero or negative duration`)})}),{isValid:r.length===0,errors:r,warnings:s}}getAssignmentStatistics(e){const t=e.length,r=e.reduce((d,u)=>d+u.tasks.length,0),s=t>0?r/t:0,i={},l={};let c=0,o=0;return e.forEach(d=>{d.tasks.forEach(u=>{i[u.priority]=(i[u.priority]||0)+1,l[u.category]=(l[u.category]||0)+1,c+=u.points,o+=u.estimatedDuration})}),{totalAssignments:t,totalTasks:r,averageTasksPerUser:s,tasksByPriority:i,tasksByCategory:l,totalPoints:c,totalEstimatedDuration:o}}optimizeTaskAssignments(e,t){const r=new Map;e.forEach(l=>{const c={taskCount:l.tasks.length,totalPoints:l.tasks.reduce((o,d)=>o+d.points,0),totalDuration:l.tasks.reduce((o,d)=>o+d.estimatedDuration,0)};r.set(l.userId,c)});const s=[...e];return Array.from(r.entries()).filter(([l,c])=>c.taskCount>t.maxTasksPerUser).map(([l,c])=>l).forEach(l=>{const c=s.find(u=>u.userId===l);if(!c)return;const o=c.tasks.slice(t.maxTasksPerUser);c.tasks=c.tasks.slice(0,t.maxTasksPerUser);const d=s.filter(u=>u.tasks.length<t.maxTasksPerUser&&u.userId!==l);o.forEach(u=>{if(d.length>0){const m=d[0];m.tasks.push(u);const p=d.findIndex(f=>f.userId===m.userId);p>=0&&m.tasks.length>=t.maxTasksPerUser&&d.splice(p,1)}})}),s}exportTaskAssignments(e){return JSON.stringify(e,null,2)}importTaskAssignments(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,assignments:[],errors:["Invalid format: expected array of assignments"]};const r=[];return t.forEach((s,i)=>{s.userId||r.push(`Assignment ${i+1}: Missing userId`),(!s.tasks||!Array.isArray(s.tasks))&&r.push(`Assignment ${i+1}: Missing or invalid tasks array`)}),{success:r.length===0,assignments:t,errors:r}}catch(t){return{success:!1,assignments:[],errors:["Invalid JSON format"]}}}}var Zs=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class HI{getFacilityUsers(e){return Zs(this,null,function*(){const{data:t,error:r}=yield _.from("users").select("id, full_name, role, department, is_active, facility_id").eq("facility_id",e).eq("is_active",!0);if(r)throw r;return(t||[]).map(s=>{const i=s;return{id:i.id,role:i.role,full_name:i.full_name,department:i.department,is_active:i.is_active,facility_id:i.facility_id}})})}getUsersByRole(e,t){return Zs(this,null,function*(){return(yield this.getFacilityUsers(e)).filter(s=>s.role===t)})}getUsersByDepartment(e,t){return Zs(this,null,function*(){return(yield this.getFacilityUsers(e)).filter(s=>s.department===t)})}getAvailableRoles(){return[{role:"technician",description:"Equipment maintenance and repair specialist",capabilities:["equipment_maintenance","tool_repair","calibration"],compatibleCategories:["equipment","compliance"]},{role:"operator",description:"Daily operations and sterilization specialist",capabilities:["sterilization","daily_operations","bi_testing"],compatibleCategories:["operational","compliance"]},{role:"cleaning_staff",description:"Environmental cleaning and sanitation specialist",capabilities:["environmental_cleaning","sanitization","compliance"],compatibleCategories:["compliance","operational"]},{role:"inventory_manager",description:"Inventory management and supply specialist",capabilities:["inventory_management","supply_ordering","stock_control"],compatibleCategories:["operational"]},{role:"supervisor",description:"Operations oversight and safety specialist",capabilities:["safety_investigation","quality_control","oversight"],compatibleCategories:["safety","operational"]},{role:"manager",description:"Facility management and coordination",capabilities:["facility_management","coordination","planning"],compatibleCategories:["operational","safety","compliance"]}]}isRoleCompatibleWithCategory(e,t){const s=this.getAvailableRoles().find(i=>i.role===e);return s?s.compatibleCategories.includes(t):!1}getRoleCapabilities(e){const r=this.getAvailableRoles().find(s=>s.role===e);return(r==null?void 0:r.capabilities)||[]}findBestUserMatch(e,t,r){if(e.assignedRole){const i=t.find(l=>l.role===e.assignedRole);if(i)return i}const s=t.filter(i=>this.isRoleCompatibleWithCategory(i.role,e.category));return s.length>0?r?s.reduce((i,l)=>{const c=r.get(i.id),o=r.get(l.id);return c?o&&o.utilization<c.utilization?l:i:l}):s[0]:r&&t.length>0?t.reduce((i,l)=>{const c=r.get(i.id),o=r.get(l.id);return c?o&&o.utilization<c.utilization?l:i:l}):t[0]||null}calculateUserWorkload(e,t,r,s,i=5){const l=i,c=l>0?t/l*100:0;return{userId:e,currentTasks:t,totalPoints:r,totalDuration:s,capacity:l,utilization:c}}getUserWorkloadStatistics(e,t){const r=e.length;let s=0,i=0,l=0;const c={},o={low:0,medium:0,high:0};e.forEach(u=>{const m=t.get(u.id);m&&(s+=m.utilization,m.utilization>100?i++:m.utilization<50&&l++,m.utilization<50?o.low++:m.utilization<=80?o.medium++:o.high++,c[u.role]=(c[u.role]||0)+m.utilization)});const d=r>0?s/r:0;return{totalUsers:r,averageUtilization:d,overloadedUsers:i,underutilizedUsers:l,workloadByRole:c,workloadDistribution:o}}getUsersWithCapacity(e,t,r){return e.filter(s=>{const i=t.get(s.id);return!i||i.currentTasks<r})}getOverloadedUsers(e,t,r){return e.filter(s=>{const i=t.get(s.id);return i&&i.currentTasks>r})}balanceWorkload(e,t,r){const s=[],i=this.getOverloadedUsers(e,t,r),l=this.getUsersWithCapacity(e,t,r);return i.length>0&&(l.length>0?s.push({type:"redistribute",description:`Redistribute tasks from ${i.length} overloaded users to ${l.length} users with capacity`,priority:"high"}):s.push({type:"add_user",description:"All users are at capacity. Consider adding more staff or increasing capacity limits",priority:"high"})),Array.from(t.values()).reduce((o,d)=>o+d.utilization,0)/t.size>90&&s.push({type:"reduce_tasks",description:"Overall utilization is very high. Consider reducing task load or adding resources",priority:"medium"}),{recommendations:s,canBalance:l.length>0}}getUserPerformanceMetrics(e,t){return Zs(this,null,function*(){return(yield this.getFacilityUsers(e)).map(s=>({userId:s.id,userName:s.full_name,role:s.role,tasksCompleted:0,averageCompletionTime:0,pointsEarned:0,efficiency:0}))})}validateUserData(e){const t=[];(!e.id||e.id.trim()==="")&&t.push("User ID is required"),(!e.role||e.role.trim()==="")&&t.push("User role is required"),(!e.full_name||e.full_name.trim()==="")&&t.push("Full name is required"),(!e.facility_id||e.facility_id.trim()==="")&&t.push("Facility ID is required");const r=this.getAvailableRoles();return e.role&&!r.find(s=>s.role===e.role)&&t.push(`Invalid role: ${e.role}`),{isValid:t.length===0,errors:t}}exportUserData(e){return JSON.stringify(e,null,2)}importUserData(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,users:[],errors:["Invalid format: expected array of users"]};const r=[];return t.forEach((s,i)=>{const l=this.validateUserData(s);l.isValid||r.push(`User ${i+1}: ${l.errors.join(", ")}`)}),{success:r.length===0,users:t,errors:r}}catch(t){return{success:!1,users:[],errors:["Invalid JSON format"]}}}}var VI=Object.defineProperty,WI=Object.defineProperties,GI=Object.getOwnPropertyDescriptors,Vd=Object.getOwnPropertySymbols,KI=Object.prototype.hasOwnProperty,QI=Object.prototype.propertyIsEnumerable,Wd=(n,e,t)=>e in n?VI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,YI=(n,e)=>{for(var t in e||(e={}))KI.call(e,t)&&Wd(n,t,e[t]);if(Vd)for(var t of Vd(e))QI.call(e,t)&&Wd(n,t,e[t]);return n},JI=(n,e)=>WI(n,GI(e));const Gd={inventory_items:{defaultLimit:50,maxLimit:200,maxOffset:1e4,allowedOrderByFields:["created_at","updated_at","name","category","quantity"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},sterilization_cycles:{defaultLimit:100,maxLimit:500,maxOffset:5e3,allowedOrderByFields:["start_time","created_at","cycle_number","status"],defaultOrderBy:"start_time",defaultOrderDirection:"desc"},audit_logs:{defaultLimit:100,maxLimit:500,maxOffset:2e3,allowedOrderByFields:["created_at","action","module"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},users:{defaultLimit:100,maxLimit:500,maxOffset:2e3,allowedOrderByFields:["created_at","email","role"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},admin_task_config:{defaultLimit:20,maxLimit:100,maxOffset:1e3,allowedOrderByFields:["facility_id","created_at","updated_at"],defaultOrderBy:"facility_id",defaultOrderDirection:"asc"},default:{defaultLimit:50,maxLimit:200,maxOffset:5e3,allowedOrderByFields:["created_at","id"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"}};function Ba(n={},e="default"){const t=Gd[e]||Gd.default;let r=n.limit||t.defaultLimit;r<=0&&(r=t.defaultLimit),r>t.maxLimit&&(O.warn(`Query limit ${r} exceeds maximum ${t.maxLimit} for table ${e}, capping to maximum`),r=t.maxLimit);let s=n.offset||0;s<0&&(s=0),s>t.maxOffset&&(O.warn(`Query offset ${s} exceeds maximum ${t.maxOffset} for table ${e}, capping to maximum`),s=t.maxOffset);let i=n.orderBy||t.defaultOrderBy;t.allowedOrderByFields.includes(i)||(O.warn(`Order by field '${i}' not allowed for table ${e}, using default '${t.defaultOrderBy}'`),i=t.defaultOrderBy);const l=n.orderDirection||t.defaultOrderDirection;return["asc","desc"].includes(l)||O.warn(`Invalid order direction '${l}' for table ${e}, using default '${t.defaultOrderDirection}'`),JI(YI({},n),{limit:r,offset:s,orderBy:i,orderDirection:l})}function XI(n,e={},t="default"){const r=Ba(e,t);return{query:n.limit(r.limit).range(r.offset,r.offset+r.limit-1),offset:r.offset,limit:r.limit}}function ZI(n,e={},t="default"){const r=Ba(e,t);return n.order(r.orderBy,{ascending:r.orderDirection==="asc"})}function ej(n,e,t={},r="default"){const s=Ba(t,r),i=Math.ceil(e/s.limit),l=Math.floor(s.offset/s.limit)+1;return{data:n,total:e,page:l,limit:s.limit,totalPages:i,hasNext:l<i,hasPrev:l>1}}function tj(n,e){return["id","created_at","updated_at"].join(", ")}function rj(n,e={},t="default"){const r=Ba(e,t),s=ZI(n,r,t),{query:i}=XI(s,r,t);return{query:i,safeOptions:r,warnings:[]}}var nj=Object.defineProperty,sj=Object.defineProperties,aj=Object.getOwnPropertyDescriptors,Kd=Object.getOwnPropertySymbols,ij=Object.prototype.hasOwnProperty,oj=Object.prototype.propertyIsEnumerable,Qd=(n,e,t)=>e in n?nj(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lj=(n,e)=>{for(var t in e||(e={}))ij.call(e,t)&&Qd(n,t,e[t]);if(Kd)for(var t of Kd(e))oj.call(e,t)&&Qd(n,t,e[t]);return n},cj=(n,e)=>sj(n,aj(e)),Jt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Si{static getConfig(e){return Jt(this,null,function*(){try{const{data:t,error:r}=yield _.from("admin_task_config").select("id, facility_id, max_tasks_per_user, enabled_categories, priority_thresholds, auto_assignment, ai_sensitivity, ai_confidence_threshold, max_ai_processing_time_ms, workload_balancing_enabled, max_concurrent_tasks_per_user, role_category_mapping, task_notifications_enabled, notification_channels, compliance_tracking_enabled, audit_logging_enabled, task_optimization_enabled, predictive_assignment_enabled, created_by, updated_by, created_at, updated_at").eq("facility_id",e).single();if(r){if(r.code==="PGRST116")return O.info(`No admin config found for facility ${e}, creating default`),yield this.createDefaultConfig(e);throw r}return this.mapDatabaseToConfig(t)}catch(t){throw O.error("Error getting admin task config:",t),new Error("Failed to retrieve admin task configuration")}})}static updateConfig(e,t){return Jt(this,null,function*(){return this.upsertConfig(e,t)})}static upsertConfig(e,t){return Jt(this,null,function*(){try{const r=bw(t),s=bt(),i={facility_id:e,max_tasks_per_user:r.maxTasksPerUser,enabled_categories:r.enabledCategories,priority_thresholds:r.priorityThresholds,auto_assignment:r.autoAssignment,ai_sensitivity:r.aiSensitivity,ai_confidence_threshold:.75,max_ai_processing_time_ms:3e4,workload_balancing_enabled:!0,max_concurrent_tasks_per_user:5,role_category_mapping:{equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]},task_notifications_enabled:!0,notification_channels:["email","in_app"],compliance_tracking_enabled:!0,audit_logging_enabled:!0,task_optimization_enabled:!0,predictive_assignment_enabled:!0,updated_by:s},{data:l,error:c}=yield _.from("admin_task_config").upsert(i,{onConflict:"facility_id",ignoreDuplicates:!1}).select("*").single();if(c)throw c;return O.info(`Admin task config updated for facility ${e}`),this.mapDatabaseToConfig(l)}catch(r){throw O.error("Error upserting admin task config:",r),new Error("Failed to save admin task configuration")}})}static createDefaultConfig(e){return Jt(this,null,function*(){try{const t=bt(),r={facility_id:e,max_tasks_per_user:3,enabled_categories:["equipment","compliance","operational","safety"],priority_thresholds:{low:1,medium:2,high:3,urgent:4},auto_assignment:!0,ai_sensitivity:"medium",ai_confidence_threshold:.75,max_ai_processing_time_ms:3e4,workload_balancing_enabled:!0,max_concurrent_tasks_per_user:5,role_category_mapping:{equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]},task_notifications_enabled:!0,notification_channels:["email","in_app"],compliance_tracking_enabled:!0,audit_logging_enabled:!0,task_optimization_enabled:!0,predictive_assignment_enabled:!0,created_by:t,updated_by:t},{data:s,error:i}=yield _.from("admin_task_config").insert(r).select("*").single();if(i)throw i;return O.info(`Default admin task config created for facility ${e}`),this.mapDatabaseToConfig(s)}catch(t){throw O.error("Error creating default admin task config:",t),new Error("Failed to create default admin task configuration")}})}static deleteConfig(e){return Jt(this,null,function*(){try{const{error:t}=yield _.from("admin_task_config").delete().eq("facility_id",e);if(t)throw t;O.info(`Admin task config deleted for facility ${e}`)}catch(t){throw O.error("Error deleting admin task config:",t),new Error("Failed to delete admin task configuration")}})}static mapDatabaseToConfig(e){var t;return{maxTasksPerUser:e.max_tasks_per_user,enabledCategories:e.enabled_categories||[],priorityThresholds:e.priority_thresholds||{low:1,medium:2,high:3,urgent:4},priorityWeights:e.priority_weights||{low:1,medium:2,high:3,urgent:4},rolePreferences:e.role_category_mapping||{},timeConstraints:e.time_constraints||{maxTaskDuration:120,minTaskDuration:5},autoAssignment:e.auto_assignment,aiSensitivity:e.ai_sensitivity||"medium",aiEnabled:(t=e.ai_enabled)!=null?t:!0}}static getAllConfigs(){return Jt(this,arguments,function*(e={}){try{const{orderBy:t="facility_id",orderDirection:r="asc"}=e,{query:s,safeOptions:i,warnings:l}=rj(_.from("admin_task_config"),cj(lj({},e),{orderBy:t,orderDirection:r}),"admin_task_config"),c=s.select(tj("admin_task_config"),{count:"exact"}),{data:o,error:d,count:u}=yield c;if(d)throw d;return l.length>0&&O.warn("Admin config query warnings:",l),ej(o||[],u||0,i,"admin_task_config")}catch(t){throw O.error("Error getting all admin task configs:",t),new Error("Failed to retrieve admin task configurations")}})}static getConfigHistory(e){return Jt(this,null,function*(){try{const{data:t,error:r}=yield _.from("admin_task_config").select("*").eq("facility_id",e).order("updated_at",{ascending:!1});if(r)throw r;return(t||[]).map(s=>({id:s.id,config:this.mapDatabaseToConfig(s),updatedAt:new Date(s.updated_at),updatedBy:s.updated_by||"Unknown",changes:[]}))}catch(t){return O.error("Error getting configuration history:",t),[]}})}static hasConfig(e){return Jt(this,null,function*(){try{const{count:t,error:r}=yield _.from("admin_task_config").select("*",{count:"exact",head:!0}).eq("facility_id",e);if(r)throw r;return(t||0)>0}catch(t){return O.error("Error checking admin task config existence:",t),!1}})}}var dj=Object.defineProperty,uj=Object.defineProperties,mj=Object.getOwnPropertyDescriptors,Yd=Object.getOwnPropertySymbols,hj=Object.prototype.hasOwnProperty,pj=Object.prototype.propertyIsEnumerable,Jd=(n,e,t)=>e in n?dj(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ea=(n,e)=>{for(var t in e||(e={}))hj.call(e,t)&&Jd(n,t,e[t]);if(Yd)for(var t of Yd(e))pj.call(e,t)&&Jd(n,t,e[t]);return n},ta=(n,e)=>uj(n,mj(e)),ra=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class fj{getAdminTaskConfig(e){return ra(this,null,function*(){try{if(!e){const{FacilityService:t}=yield L(()=>Promise.resolve().then(()=>It),void 0);e=yield t.getCurrentFacilityId()}return yield Si.getConfig(e)}catch(t){return console.warn("Failed to get admin config from database, using default:",t),fi()}})}updateAdminTaskConfig(e,t){return ra(this,null,function*(){try{return yield Si.updateConfig(e,t)}catch(r){throw console.error("Failed to update admin config:",r),r}})}resetToDefaults(e){return ra(this,null,function*(){const t=fi();return yield this.updateAdminTaskConfig(e,t)})}validateConfig(e){const t=[],r=[];if(e.maxTasksPerUser!==void 0&&(e.maxTasksPerUser<1&&t.push("Max tasks per user must be at least 1"),e.maxTasksPerUser>20&&r.push("Max tasks per user is very high, may impact user productivity")),e.priorityWeights){const s=e.priorityWeights;s.urgent!==void 0&&s.urgent<1&&t.push("Urgent priority weight must be at least 1"),s.high!==void 0&&s.high<1&&t.push("High priority weight must be at least 1"),s.medium!==void 0&&s.medium<1&&t.push("Medium priority weight must be at least 1"),s.low!==void 0&&s.low<1&&t.push("Low priority weight must be at least 1"),s.urgent&&s.high&&s.urgent<=s.high&&r.push("Urgent priority weight should be higher than high priority"),s.high&&s.medium&&s.high<=s.medium&&r.push("High priority weight should be higher than medium priority"),s.medium&&s.low&&s.medium<=s.low&&r.push("Medium priority weight should be higher than low priority")}if(e.rolePreferences&&Object.entries(e.rolePreferences).forEach(([s,i])=>{Array.isArray(i)?i.forEach(l=>{Yh(s,l)||r.push(`Role ${s} may not be compatible with category ${l}`)}):t.push(`Role preferences for ${s} must be an array`)}),e.timeConstraints){const s=e.timeConstraints;s.maxTaskDuration!==void 0&&s.maxTaskDuration<5&&t.push("Max task duration must be at least 5 minutes"),s.minTaskDuration!==void 0&&s.minTaskDuration<1&&t.push("Min task duration must be at least 1 minute"),s.maxTaskDuration&&s.minTaskDuration&&s.maxTaskDuration<=s.minTaskDuration&&t.push("Max task duration must be greater than min task duration")}return{isValid:t.length===0,errors:t,warnings:r}}getConfigurationRecommendations(e,t){const r=[];if(t&&(t.taskCompletionRate<.8&&r.push({category:"performance",title:"Low Task Completion Rate",description:`Current completion rate is ${(t.taskCompletionRate*100).toFixed(1)}%. Consider reducing max tasks per user or improving task assignment.`,priority:"high",suggestedValue:Math.max(1,e.maxTasksPerUser-1)}),t.averageTasksPerUser>e.maxTasksPerUser*.9&&r.push({category:"workload",title:"High User Workload",description:`Users are consistently at ${(t.averageTasksPerUser/e.maxTasksPerUser*100).toFixed(1)}% capacity. Consider increasing max tasks or adding more users.`,priority:"medium",suggestedValue:e.maxTasksPerUser+1}),t.averageTaskDuration>120&&r.push({category:"performance",title:"Long Task Duration",description:`Average task duration is ${t.averageTaskDuration} minutes. Consider breaking down complex tasks or adjusting time estimates.`,priority:"medium"})),e.priorityWeights){const s=e.priorityWeights;s.urgent&&s.high&&s.urgent<=s.high&&r.push({category:"priority",title:"Priority Weight Ordering",description:"Urgent priority weight should be higher than high priority to ensure proper task prioritization.",priority:"medium",suggestedValue:ta(ea({},s),{urgent:s.high+1})})}return(!e.rolePreferences||Object.keys(e.rolePreferences).length===0)&&r.push({category:"role",title:"Missing Role Preferences",description:"No role preferences configured. Consider setting up role-category mappings for better task assignment.",priority:"low",suggestedValue:{technician:["equipment","compliance"],operator:["operational","compliance"],cleaning_staff:["compliance"],inventory_manager:["operational"],supervisor:["safety","operational"]}}),r}getDefaultConfigForFacilityType(e){const t=fi();switch(e){case"small":return ta(ea({},t),{maxTasksPerUser:3,priorityWeights:{urgent:10,high:7,medium:4,low:1}});case"medium":return ta(ea({},t),{maxTasksPerUser:5,priorityWeights:{urgent:12,high:8,medium:5,low:2}});case"large":return ta(ea({},t),{maxTasksPerUser:7,priorityWeights:{urgent:15,high:10,medium:6,low:3}});default:return t}}exportConfig(e){return JSON.stringify(e,null,2)}importConfig(e){try{const t=JSON.parse(e),r=this.validateConfig(t);return{success:r.isValid,config:r.isValid?t:null,errors:r.errors}}catch(t){return{success:!1,config:null,errors:["Invalid JSON format"]}}}getConfigurationHistory(e){return ra(this,null,function*(){try{return yield Si.getConfigHistory(e)}catch(t){return console.error("Failed to get configuration history:",t),[]}})}compareConfigurations(e,t){const r=[];return new Set([...Object.keys(e),...Object.keys(t)]).forEach(i=>{const l=e[i],c=t[i];l===void 0&&c!==void 0?r.push({field:i,oldValue:void 0,newValue:c,type:"added"}):l!==void 0&&c===void 0?r.push({field:i,oldValue:l,newValue:void 0,type:"removed"}):JSON.stringify(l)!==JSON.stringify(c)&&r.push({field:i,oldValue:l,newValue:c,type:"modified"})}),{changes:r,hasChanges:r.length>0}}getConfigurationSummary(e){var t;const r=e.priorityWeights?Object.keys(e.priorityWeights).length:0,s=e.rolePreferences?Object.keys(e.rolePreferences).length:0,i=!!e.timeConstraints,l=e.aiEnabled!==!1;let c="simple";return(r>2||s>3||i)&&(c="moderate"),(r>3||s>5||i&&((t=e.timeConstraints)!=null&&t.maxTaskDuration))&&(c="complex"),{maxTasksPerUser:e.maxTasksPerUser,priorityCount:r,rolePreferencesCount:s,timeConstraintsEnabled:i,aiEnabled:l,complexity:c}}}var qa=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const gj=new BI,yj=new UI,vj=new HI,_j=new fj;function xj(n){return qa(this,null,function*(){return gj.scanOperationalGaps(n)})}function bj(n){return qa(this,null,function*(){return vj.getFacilityUsers(n)})}function wj(n){return qa(this,null,function*(){return _j.getAdminTaskConfig(n)})}function Sj(n,e,t){return qa(this,null,function*(){return yj.assignTasksWithAI(n,e,t)})}var rs=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Cj{generateDailyTasks(e){return rs(this,null,function*(){try{const t=yield xj(e);if(t.length===0)return console.log("No operational gaps found for daily tasks"),[];const r=yield bj(e),s=yield wj(),i=yield Sj(t,r,s);return yield Nw(i,e),i}catch(t){throw console.error("Error generating daily tasks:",t),new Error(`Failed to generate daily tasks: ${t instanceof Error?t.message:"Unknown error"}`)}})}getUserDailyTasks(e){return rs(this,null,function*(){return kw(e)})}getFacilityDailyTasks(e){return rs(this,null,function*(){return Pw(e)})}completeDailyTask(e,t){return rs(this,null,function*(){return Dw(e,t)})}updateDailyTask(e,t){return rs(this,null,function*(){try{const{data:{user:r}}=yield _.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:s,error:i}=yield _.from("users").select("facility_id").eq("id",r.id).single();if(i||!(s!=null&&s.facility_id))throw new Error("User facility not found");const l={updated_at:new Date().toISOString()};t.title!==void 0&&(l.title=t.title),t.description!==void 0&&(l.description=t.description),t.category!==void 0&&(l.category=t.category),t.difficulty!==void 0&&(l.difficulty=t.difficulty),t.points!==void 0&&(l.points=t.points),t.timeEstimate!==void 0&&(l.time_estimate=t.timeEstimate),t.isCompleted!==void 0&&(l.is_completed=t.isCompleted);const{data:c,error:o}=yield _.from("home_challenges").update(l).eq("id",e).eq("facility_id",s.facility_id).select().single();if(o)throw new Error(`Failed to update task: ${o.message}`);return{id:c.id,title:c.title,description:c.description||"",category:c.category,difficulty:c.difficulty,points:c.points,timeEstimate:c.time_estimate,isCompleted:c.is_completed||!1,completedAt:c.completed_at||null,pointsEarned:c.points_earned||0,createdAt:c.created_at,updatedAt:c.updated_at}}catch(r){throw console.error("Error updating daily task:",r),r}})}}const bp=new Cj,Ct=({path:n,size:e=24,color:t="currentColor",className:r})=>a.jsx(ya.Icon,{path:n,size:e,color:t,className:r}),Ij=({currentPage:n,totalPages:e,onPageChange:t,onNextPage:r,onPreviousPage:s,hasNextPage:i,hasPreviousPage:l,isLoading:c=!1,className:o=""})=>{if(e<=1)return null;const d=()=>{const u=[];if(e<=5)for(let p=1;p<=e;p++)u.push(p);else if(n<=3){for(let p=1;p<=4;p++)u.push(p);u.push("..."),u.push(e)}else if(n>=e-2){u.push(1),u.push("...");for(let p=e-3;p<=e;p++)u.push(p)}else{u.push(1),u.push("...");for(let p=n-1;p<=n+1;p++)u.push(p);u.push("..."),u.push(e)}return u};return a.jsxs("div",{className:`flex items-center justify-center space-x-2 ${o}`,children:[a.jsxs("button",{onClick:s,disabled:!l||c,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${l&&!c?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:[a.jsx(Ct,{path:jg,size:16,className:"mr-1"}),"Previous"]}),a.jsx("div",{className:"flex items-center space-x-1",children:d().map((u,m)=>a.jsx(X.Fragment,{children:u==="..."?a.jsx("span",{className:"px-3 py-2 text-sm text-gray-500",children:"..."}):a.jsx("button",{onClick:()=>t(u),disabled:c,className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${u===n?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"} ${c?"cursor-not-allowed":""}`,children:u})},m))}),a.jsxs("button",{onClick:r,disabled:!i||c,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${i&&!c?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:["Next",a.jsx(Ct,{path:Oa,size:16,className:"ml-1"})]}),a.jsxs("div",{className:"ml-4 text-sm text-gray-500",children:["Page ",n," of ",e]})]})},jj=({onLoadMore:n,hasMore:e,isLoading:t,className:r="",buttonText:s="Load More",loadingText:i="Loading..."})=>e?a.jsx("div",{className:`flex justify-center ${r}`,children:a.jsx("button",{onClick:n,disabled:t,className:"flex items-center px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t?a.jsxs(a.Fragment,{children:[a.jsx(Ct,{path:vh,size:16,className:"animate-spin mr-2"}),i]}):a.jsxs(a.Fragment,{children:[s,a.jsx(Ct,{path:wn,size:16,className:"ml-2"})]})})}):null;var Ej=Object.defineProperty,Tj=Object.defineProperties,Nj=Object.getOwnPropertyDescriptors,Xd=Object.getOwnPropertySymbols,kj=Object.prototype.hasOwnProperty,Pj=Object.prototype.propertyIsEnumerable,Zd=(n,e,t)=>e in n?Ej(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ci=(n,e)=>{for(var t in e||(e={}))kj.call(e,t)&&Zd(n,t,e[t]);if(Xd)for(var t of Xd(e))Pj.call(e,t)&&Zd(n,t,e[t]);return n},Ii=(n,e)=>Tj(n,Nj(e)),Dj=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Aj=({task:n,isOpen:e,onClose:t,onSave:r})=>{const[s,i]=h.useState({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),[l,c]=h.useState({}),[o,d]=h.useState(!1),[u,m]=h.useState(null);h.useEffect(()=>{n&&(i({title:n.title||"",description:n.description||"",priority:n.priority||"medium",dueDate:n.dueDate?new Date(n.dueDate).toISOString().split("T")[0]:"",status:n.status||"pending"}),c({}),m(null))},[n]),h.useEffect(()=>{e||(i({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),c({}),m(null),d(!1))},[e]);const p=h.useCallback(()=>{const v={};if(s.title.trim()?s.title.trim().length<3?v.title="Title must be at least 3 characters long":s.title.trim().length>100&&(v.title="Title must be less than 100 characters"):v.title="Title is required",s.description.trim().length>500&&(v.description="Description must be less than 500 characters"),s.dueDate){const x=new Date(s.dueDate),b=new Date;b.setHours(0,0,0,0),x<b&&(v.dueDate="Due date cannot be in the past")}return c(v),Object.keys(v).length===0},[s]),f=h.useCallback((v,x)=>{i(b=>Ii(Ci({},b),{[v]:x})),l[v]&&c(b=>Ii(Ci({},b),{[v]:void 0}))},[l]),g=h.useCallback(v=>Dj(null,null,function*(){if(v.preventDefault(),!!n&&p()){d(!0),m(null);try{const x=Ii(Ci({},n),{title:s.title.trim(),description:s.description.trim()||void 0,priority:s.priority,dueDate:s.dueDate||new Date().toISOString(),status:s.status});yield r(n.id,x),t()}catch(x){m(x instanceof Error?x.message:"Failed to save task")}finally{d(!1)}}}),[n,s,p,r,t]),y=h.useCallback(()=>{o||t()},[o,t]);return h.useEffect(()=>{const v=x=>{x.key==="Escape"&&e&&!o&&t()};if(e)return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[e,o,t]),!e||!n?null:a.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:y,onKeyDown:v=>{v.key==="Escape"&&y()},role:"button",tabIndex:0,"aria-label":"Close modal"}),a.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:a.jsxs("div",{className:"relative w-full max-w-md transform overflow-hidden rounded-lg bg-white shadow-xl transition-all",children:[a.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Task"}),a.jsx("button",{onClick:y,disabled:o,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50","aria-label":"Close modal",children:a.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),a.jsxs("form",{onSubmit:g,className:"px-6 py-4",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),a.jsx("input",{type:"text",id:"title",value:s.title,onChange:v=>f("title",v.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.title?"border-red-300":"border-gray-300"}`,placeholder:"Enter task title",disabled:o}),l.title&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.title})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),a.jsx("textarea",{id:"description",value:s.description,onChange:v=>f("description",v.target.value),rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.description?"border-red-300":"border-gray-300"}`,placeholder:"Enter task description (optional)",disabled:o}),l.description&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.description}),a.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[s.description.length,"/500 characters"]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),a.jsxs("select",{id:"priority",value:s.priority,onChange:v=>f("priority",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o,children:[a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"}),a.jsx("option",{value:"urgent",children:"Urgent"})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),a.jsx("input",{type:"date",id:"dueDate",value:s.dueDate,onChange:v=>f("dueDate",v.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.dueDate?"border-red-300":"border-gray-300"}`,disabled:o}),l.dueDate&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.dueDate})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),a.jsxs("select",{id:"status",value:s.status,onChange:v=>f("status",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o,children:[a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"completed",children:"Completed"})]})]}),u&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsx("p",{className:"text-sm text-red-800",children:u})}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{type:"button",onClick:y,disabled:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:o?"Saving...":"Save Changes"})]})]})]})})]})};var Oj=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Rj=({tasks:n,onTaskComplete:e,onTaskUpdate:t})=>{const[r,s]=h.useState(1),[i,l]=h.useState(null),[c,o]=h.useState(null),[d,u]=h.useState(!1),m=10,p=h.useCallback(I=>{if(!I.dueDate)return!1;const T=new Date(I.dueDate);return(new Date().getTime()-T.getTime())/(1e3*60*60)<=24},[]),f=h.useCallback(I=>{const T="task-item border rounded-lg p-4 mb-2",j=p(I);return $r(T,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":j,"shadow-sm":!j})},[p]),g=h.useMemo(()=>Array.isArray(n)?n:[],[n]),y=h.useMemo(()=>g.filter(I=>I.status!=="completed"),[g]),v=h.useMemo(()=>Math.max(1,Math.ceil(y.length/m)),[y.length,m]),x=h.useMemo(()=>(r-1)*m,[r,m]),b=h.useMemo(()=>x+m,[x,m]),C=h.useMemo(()=>y.slice(x,b),[y,x,b]),k=h.useCallback(I=>{l(T=>T===I?null:I)},[]),P=h.useCallback(I=>{o(I),u(!0)},[]),E=h.useCallback((I,T)=>Oj(null,null,function*(){if(t)try{yield t(I,T),u(!1),o(null)}catch(j){console.error("Failed to update task:",j)}}),[t]),$=h.useCallback(()=>{u(!1),o(null)},[]),w=h.useCallback(()=>{s(I=>Math.max(1,I-1))},[]),S=h.useCallback(()=>{s(I=>Math.min(v,I+1))},[v]),A=h.useMemo(()=>C.map(I=>a.jsxs("div",{className:f(I),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>k(I.id),className:"text-gray-400 hover:text-gray-600","aria-label":i===I.id?"Collapse task details":"Expand task details",children:a.jsx("span",{className:`transform transition-transform ${i===I.id?"rotate-90":""}`,children:"▶"})}),a.jsx("span",{className:"font-medium",children:I.title}),p(I)&&a.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("span",{className:"text-sm font-semibold text-[#4ECDC4] bg-[#4ECDC4] bg-opacity-10 px-2 py-1 rounded-full",children:["+",I.points||0," pts"]}),a.jsx("button",{onClick:()=>P(I),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Edit"}),e&&a.jsx("button",{onClick:()=>e(I.id,I.points||0),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Complete"})]})]}),i===I.id&&a.jsxs("div",{className:"mt-3 pt-3 border-t",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:I.description}),a.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[a.jsxs("div",{children:["Priority: ",I.priority]}),a.jsxs("div",{children:["Status: ",I.status]}),a.jsxs("div",{children:["Points: ",I.points||0]}),I.dueDate&&a.jsxs("div",{children:["Due: ",new Date(I.dueDate).toLocaleDateString()]})]})]})]},I.id)),[C,i,k,P,e,f,p]);return y.length===0?a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No tasks available"}):a.jsxs("div",{className:"space-y-4",children:[A,v>1&&a.jsxs("div",{className:"flex items-center justify-between pt-4",children:[a.jsx("button",{onClick:w,disabled:r===1,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",r," of ",v]}),a.jsx("button",{onClick:S,disabled:r===v,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),a.jsx(Aj,{task:c,isOpen:d,onClose:$,onSave:E})]})},$j={COMPLETE:"Complete"};var Mj=Object.defineProperty,Fj=Object.defineProperties,Lj=Object.getOwnPropertyDescriptors,eu=Object.getOwnPropertySymbols,zj=Object.prototype.hasOwnProperty,Bj=Object.prototype.propertyIsEnumerable,tu=(n,e,t)=>e in n?Mj(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xr=(n,e)=>{for(var t in e||(e={}))zj.call(e,t)&&tu(n,t,e[t]);if(eu)for(var t of eu(e))Bj.call(e,t)&&tu(n,t,e[t]);return n},na=(n,e)=>Fj(n,Lj(e)),qj=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Uj=n=>({id:n.id,title:n.title,description:n.description,status:n.status,priority:n.priority==="urgent"?"high":n.priority||"medium",due_date:n.dueDate,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),user_id:"",facility_id:"",completed:n.completed}),wp=X.memo(({onTaskComplete:n,onTaskUpdate:e,tasks:t,itemHeight:r=120,containerHeight:s=600})=>{const[i,l]=h.useState(null),[c,o]=h.useState(null),[d,u]=h.useState({}),[m,p]=h.useState(0),f=h.useRef(null),g=h.useCallback(j=>{if(!j.dueDate)return!1;const M=new Date(j.dueDate);return(new Date().getTime()-M.getTime())/(1e3*60*60)<=24},[]),y=h.useCallback(j=>{const M="rounded-xl border border-gray-200 p-4 bg-white mx-2",B=g(j);return $r(M,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":B,"shadow-sm":!B})},[g]),v=h.useMemo(()=>Array.isArray(t)?t:[],[t]),x=h.useMemo(()=>v.filter(j=>j.status!=="completed"),[v]),b=Math.ceil(s/r),C=Math.floor(m/r),k=Math.min(C+b+2,x.length),P=h.useMemo(()=>x.slice(C,k),[x,C,k]),E=x.length*r,$=h.useCallback(j=>{p(j.currentTarget.scrollTop)},[]),w=h.useCallback(j=>{l(M=>M===j?null:j)},[]),S=h.useCallback(j=>{o(j.id),u(j)},[]),A=h.useCallback(()=>{o(null),u({})},[]),I=h.useCallback(()=>qj(null,null,function*(){if(c)try{const j=x.find(R=>R.id===c);if(!j){console.error("Task not found for editing");return}const M=Xr(Xr({},j),d),B=Uj(M),{createTaskService:G}=yield L(()=>import("./taskService-CY3Cvzc4.js"),__vite__mapDeps([12,1,2,3,4,5]));yield G().updateTask(B),e&&e(c,M),o(null),u({})}catch(j){console.error("Failed to save task:",j)}}),[c,x,d,e]),T=h.useMemo(()=>P.map((j,M)=>{const G=(C+M)*r;return a.jsx("div",{className:"absolute w-full",style:{top:G,height:r},children:a.jsxs("div",{className:y(j),children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("button",{onClick:()=>w(j.id),className:"mt-1 text-gray-400 hover:text-gray-600","aria-label":i===j.id?"Collapse task details":"Expand task details",children:a.jsx(ng,{className:`transform transition-transform ${i===j.id?"rotate-90":""}`})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"font-semibold text-gray-800",children:j.title}),g(j)&&a.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),a.jsx("div",{className:"text-sm text-gray-500",children:`${j.category||"General"} - ${j.type||"Training"} - Due: ${j.dueDate||"N/A"}`})]})]}),a.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[a.jsxs("span",{className:"text-violet-600 font-semibold",children:["+",j.points," pts"]}),a.jsx("button",{onClick:()=>n==null?void 0:n(j.id,j.points||0),className:"rounded-full border border-green-500 text-green-500 text-sm px-3 py-1 hover:bg-green-50","aria-label":`Complete task: ${j.title}`,"data-testid":`task-checkbox-${j.id}`,children:$j.COMPLETE})]})]}),i===j.id&&a.jsxs(a.Fragment,{children:[a.jsx("hr",{className:"my-3"}),a.jsxs("div",{className:"text-sm space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:`category-${j.id}`,className:"block text-gray-600 font-medium mb-1",children:"Category"}),c===j.id?a.jsx("input",{id:`category-${j.id}`,type:"text",value:d.category||"",onChange:Y=>u(na(Xr({},d),{category:Y.target.value})),className:"w-full px-3 py-2 border rounded-md"}):a.jsx("div",{className:"text-gray-700",children:j.category||"General"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:`type-${j.id}`,className:"block text-gray-600 font-medium mb-1",children:"Type"}),c===j.id?a.jsx("input",{id:`type-${j.id}`,type:"text",value:d.type||"",onChange:Y=>u(na(Xr({},d),{type:Y.target.value})),className:"w-full px-3 py-2 border rounded-md"}):a.jsx("div",{className:"text-gray-700",children:j.type||"Training"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:`dueDate-${j.id}`,className:"block text-gray-600 font-medium mb-1",children:"Due Date"}),c===j.id?a.jsx("input",{id:`dueDate-${j.id}`,type:"date",value:d.dueDate||"",onChange:Y=>u(na(Xr({},d),{dueDate:Y.target.value})),className:"w-full px-3 py-2 border rounded-md"}):a.jsx("div",{className:"text-gray-700",children:j.dueDate||"N/A"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:`points-${j.id}`,className:"block text-gray-600 font-medium mb-1",children:"Points"}),c===j.id?a.jsx("input",{id:`points-${j.id}`,type:"number",value:d.points||0,onChange:Y=>u(na(Xr({},d),{points:parseInt(Y.target.value)})),className:"w-full px-3 py-2 border rounded-md"}):a.jsxs("div",{className:"text-gray-700",children:[j.points||0," points"]})]})]}),a.jsx("div",{className:"mt-4 space-y-4",children:a.jsx("div",{className:"flex justify-between items-center",children:a.jsx("div",{className:"flex items-center space-x-2",children:a.jsxs("button",{onClick:()=>S(j),className:"rounded-full border border-violet-500 text-violet-500 text-sm px-3 py-1 hover:bg-violet-50","aria-label":`Edit task: ${j.title}`,children:[a.jsx(sg,{className:"inline-block mr-1"}),"Edit"]})})})}),c===j.id&&a.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[a.jsx("button",{onClick:A,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),a.jsx("button",{onClick:I,className:"px-4 py-2 bg-violet-600 text-white rounded-md hover:bg-violet-700",children:"Save"})]})]})]})]})},j.id)}),[P,C,r,i,c,d,w,n,S,A,I,y,g]);return a.jsx("div",{ref:f,className:"relative overflow-auto",style:{height:s},onScroll:$,children:a.jsx("div",{style:{height:E,position:"relative"},children:T})})});wp.displayName="VirtualizedTasksList";const ru={categories:[{value:"operations",label:"Operations"},{value:"maintenance",label:"Maintenance"},{value:"safety",label:"Safety"}],types:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}]},Hj=({selectedCategory:n,selectedType:e,onCategoryChange:t,onTypeChange:r})=>a.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:n,onChange:s=>t(s.target.value),children:[a.jsx("option",{value:"",children:"Category"}),ru.categories.map(s=>a.jsx("option",{value:s.value,children:s.label},s.value))]}),a.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:e,onChange:s=>r(s.target.value),children:[a.jsx("option",{value:"",children:"Type"}),ru.types.map(s=>a.jsx("option",{value:s.value,children:s.label},s.value))]}),a.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",children:[a.jsx("option",{value:"",children:"Due Date"}),a.jsx("option",{value:"today",children:"Today"}),a.jsx("option",{value:"tomorrow",children:"Tomorrow"}),a.jsx("option",{value:"this_week",children:"This Week"})]})]})}),Vj=(n,e,t)=>{if(!n||n.length===0)return[];let r=n;return e&&(r=r.filter(s=>s.category===e)),t&&(r=r.filter(s=>s.type===t)),r},Wj=({tasks:n,onTaskComplete:e,onTaskUpdate:t,availablePoints:r,showFilters:s,onToggleFilters:i,selectedCategory:l,selectedType:c,onCategoryChange:o,onTypeChange:d,isLoading:u=!1})=>{const m=h.useMemo(()=>{if(n)return Vj(n,l,c)},[n,l,c]),p=h.useMemo(()=>m&&m.length>50,[m]);return u?a.jsx("div",{className:`${hi()} h-full`,"data-testid":"tasks-list",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),a.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((f,g)=>a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),a.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]},g))})]})}):n?a.jsxs("div",{className:`${hi()} h-full`,"data-testid":"tasks-list",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`bg-${Qe.COLORS.PRIMARY_BG} rounded-md p-1`,children:a.jsx(N,{path:Eg,size:1,color:Qe.COLORS.PRIMARY})}),a.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:Do.TASKS})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"px-3 py-2 text-sm font-semibold bg-[#4ECDC4] bg-opacity-10 text-[#4ECDC4] border border-[#4ECDC4] border-opacity-30 rounded-lg",children:["📊 Total Available: ",r," Points"]}),a.jsxs("button",{onClick:i,className:"p-2 bg-[#4ECDC4] hover:bg-[#38b2ac] rounded-lg text-white flex items-center transition-colors duration-200",children:[a.jsx(N,{path:wo,size:.8}),a.jsx("span",{className:"ml-1 text-sm hidden sm:inline-block",children:"Filter"})]})]})]}),s&&a.jsx(Hj,{selectedCategory:l,selectedType:c,onCategoryChange:o,onTypeChange:d}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto h-full",children:p?a.jsx(wp,{tasks:m,onTaskComplete:e,onTaskUpdate:t,itemHeight:120,containerHeight:600}):a.jsx(Rj,{tasks:m,onTaskComplete:e,onTaskUpdate:t})})]}):a.jsx("div",{className:`${hi()} h-full`,"data-testid":"tasks-list",children:a.jsx("div",{className:"flex items-center justify-center h-full",children:a.jsxs("div",{className:"text-gray-500 text-center",children:[a.jsx("div",{className:"text-lg font-medium mb-2",children:"No tasks available"}),a.jsx("div",{className:"text-sm",children:"Tasks will appear here when they become available."})]})})})},Gj=h.memo(Wj),Kj=({message:n="Something went wrong."})=>a.jsx("div",{role:"alert","aria-live":"assertive",className:"text-sm text-red-600 mt-2",children:n});function Qj({loading:n,tasks:e,taskError:t}){return n?null:t?a.jsx(Kj,{message:"Some tasks may not be available due to a loading error."}):(!e||e.length===0,null)}const Sp=X.memo(({tasks:n,loading:e,taskError:t,storeAvailablePoints:r,storeShowFilters:s,setStoreShowFilters:i,selectedCategory:l,selectedType:c,onCategoryChange:o,onTypeChange:d,onTaskToggle:u,onTaskUpdate:m})=>a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx(Qj,{loading:e,tasks:n,taskError:t}),a.jsx(Es,{children:a.jsx("div",{className:"flex-1",children:a.jsx(Gj,{tasks:n,onTaskComplete:u,onTaskUpdate:m,availablePoints:r,showFilters:s,onToggleFilters:()=>i(!s),selectedCategory:l,selectedType:c,onCategoryChange:o,onTypeChange:d})})})]}));Sp.displayName="HomeTasksSection";const Yj=({data:n})=>a.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("span",{className:"bg-blue-100 rounded-md p-2 mr-3",children:a.jsx(ag,{size:20,className:"text-[#2563eb]"})}),a.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Time Savings"})]}),a.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Day)"}),a.jsxs("span",{className:"text-base text-blue-900 text-right",children:[n.daily," hrs"]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Month)"}),a.jsxs("span",{className:"text-base text-blue-900 text-right",children:[n.monthly," hrs"]})]})]})]}),Jj=({data:n={monthly:0,annual:0}})=>a.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("span",{className:"bg-green-100 rounded-md p-2 mr-3",children:a.jsx(ig,{size:20,className:"text-green-800"})}),a.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Cost Savings"})]}),a.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Monthly Savings"}),a.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(n.monthly||0).toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Annual Savings"}),a.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(n.annual||0).toLocaleString()]})]})]})]});var Pt=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Xj{constructor(){this.baselineData=null,this.lastUpdate=0,this.UPDATE_INTERVAL=120*1e3,this.cachedMetrics=null}getAIImpactMetrics(){return Pt(this,null,function*(){try{const e=Date.now();if(e-this.lastUpdate<this.UPDATE_INTERVAL)return this.getCachedMetrics();this.baselineData||(this.baselineData=yield this.getBaselineData());const t=yield this.calculateRealTimeMetrics();return this.cacheMetrics(t),this.lastUpdate=e,t}catch(e){return console.error("Error getting AI impact metrics:",e),this.getDefaultMetrics()}})}calculateRealTimeMetrics(){return Pt(this,null,function*(){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());new Date(t.getTime()-t.getDay()*24*60*60*1e3);const r=new Date(e.getFullYear(),e.getMonth(),1),{FacilityService:s}=yield L(()=>Promise.resolve().then(()=>It),void 0),i=yield s.getCurrentFacilityId(),{data:l}=yield _.from("ai_task_performance").select("*").eq("facility_id",i).gte("completed_at",r.toISOString()),{data:c}=yield _.from("ai_challenge_completions").select("*").eq("facility_id",i).gte("completed_at",r.toISOString()),o=yield this.calculateProactiveManagement(l||[],c||[]),{aiTimeSavingsService:d}=yield L(()=>import("./aiTimeSavingsService-BGInQY2r.js"),__vite__mapDeps([13,1,2,3,4,5])),u=yield d.getAITimeSavings(),m={daily:u.daily_time_saved,weekly:Math.round(u.daily_time_saved*7),monthly:u.monthly_time_saved,total:u.monthly_time_saved,percentage:0},{aiCostCalculationService:p}=yield L(()=>Promise.resolve().then(()=>Zj),void 0),f=yield p.calculateCostSavings(m,l||[]),g=yield this.calculateEfficiencyGains(l||[]);return{timeSavings:m,proactiveManagement:o,costSavings:f,efficiencyGains:g,realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:new Date(Date.now()+this.UPDATE_INTERVAL).toISOString(),dataFreshness:Math.floor((Date.now()-this.lastUpdate)/6e4)}}})}calculateTimeSavings(e,t,r,s){return Pt(this,null,function*(){var i;const c=e.filter(v=>new Date(v.completed_at)>=t).reduce((v,x)=>v+(x.time_saved||0),0),d=e.filter(v=>new Date(v.completed_at)>=r).reduce((v,x)=>v+(x.time_saved||0),0),u=e.filter(v=>new Date(v.completed_at)>=s),m=u.reduce((v,x)=>v+(x.time_saved||0),0),p=e.reduce((v,x)=>v+(x.time_saved||0),0),f=((i=this.baselineData)==null?void 0:i.preAITaskDuration)||30,g=u.length>0?u.reduce((v,x)=>v+x.actual_duration,0)/u.length:f,y=f>0?Math.round((f-g)/f*100):0;return{daily:c,weekly:d,monthly:m,total:p,percentage:Math.max(0,Math.min(100,y))}})}calculateProactiveManagement(e,t){return Pt(this,null,function*(){const r=new Date;r.setHours(r.getHours()+2);const s=e.filter(f=>new Date(f.completed_at)<r).length,i=e.filter(f=>f.estimated_duration&&f.actual_duration&&f.actual_duration<f.estimated_duration).length,l=e.length,c=e.filter(f=>f.estimated_duration&&f.actual_duration&&f.actual_duration<=f.estimated_duration).length,o=l>0?Math.round(c/l*100):100,d=e.filter(f=>f.difficulty==="high"||f.difficulty==="urgent").length,u=l>0?Math.round((l-d)/l*100):100,m=t.filter(f=>f.quality_score&&f.quality_score>=4).length,p=t.length>0?Math.round(m/t.length*100):100;return{issuesPrevented:s,earlyInterventions:i,complianceScore:o,riskMitigation:u,predictiveAccuracy:p}})}calculateEfficiencyGains(e){return Pt(this,null,function*(){const t=e.length,r=e.filter(d=>d.completed_at).length,s=t>0?Math.round(r/t*100):100,i=e.length>0?e.reduce((d,u)=>d+(u.efficiency_score||0),0)/e.length:100,l=Math.round(i),c=yield this.calculateResourceOptimization(),o=yield this.calculateWorkflowStreamlining();return{taskCompletionRate:s,qualityImprovement:l,resourceOptimization:c,workflowStreamlining:o}})}calculateResourceOptimization(){return Pt(this,null,function*(){try{const{FacilityService:e}=yield L(()=>Promise.resolve().then(()=>It),void 0),t=yield e.getCurrentFacilityId(),{data:r}=yield _.from("sterilization_cycles").select("tools").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString());if(!r||r.length===0)return 85;const i=r.reduce((o,d)=>{var u;return o+(((u=d.tools)==null?void 0:u.length)||0)},0)/r.length,l={min:6,max:8},c=i>=l.min&&i<=l.max?100:Math.max(0,100-Math.abs(i-7)*10);return Math.round(c)}catch(e){return console.error(e),console.error("Error calculating resource optimization"),85}})}calculateWorkflowStreamlining(){return Pt(this,null,function*(){try{const{FacilityService:e}=yield L(()=>Promise.resolve().then(()=>It),void 0),t=yield e.getCurrentFacilityId(),{data:r}=yield _.from("home_daily_operations_tasks").select("estimated_duration, actual_duration").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString());if(!r||r.length===0)return 80;const s=r.map(l=>!l.estimated_duration||!l.actual_duration?100:Math.max(0,Math.min(100,l.estimated_duration/l.actual_duration*100))),i=s.reduce((l,c)=>l+c,0)/s.length;return Math.round(i)}catch(e){return console.error("Error calculating workflow streamlining:",e),80}})}getBaselineData(){return Pt(this,null,function*(){try{return{preAITaskDuration:45,preAICompletionRate:75,preAIErrorRate:15,preAICostPerTask:33.75,implementationDate:"2024-01-01"}}catch(e){return console.error("Error getting baseline data:",e),{preAITaskDuration:45,preAICompletionRate:75,preAIErrorRate:15,preAICostPerTask:33.75,implementationDate:"2024-01-01"}}})}cacheMetrics(e){this.cachedMetrics=e}getCachedMetrics(){return this.cachedMetrics||this.getDefaultMetrics()}getDefaultMetrics(){return{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:100,riskMitigation:100,predictiveAccuracy:100},costSavings:{daily:0,monthly:0,annual:0,roi:0},efficiencyGains:{taskCompletionRate:100,qualityImprovement:100,resourceOptimization:85,workflowStreamlining:80},realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:new Date(Date.now()+this.UPDATE_INTERVAL).toISOString(),dataFreshness:0}}}getAIInsights(){return Pt(this,null,function*(){try{const e=yield this.getAIImpactMetrics(),{aiReportingService:t}=yield L(()=>Promise.resolve().then(()=>tE),void 0);return yield t.getAIInsights(e)}catch(e){return console.error("Error getting AI insights:",e),["AI system is actively monitoring facility operations"]}})}}const nu=new Xj;var Zr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Cp{calculateCostSavings(e,t){return Zr(this,null,function*(){try{const r=yield this.getFacilityCosts(),s=this.calculateDirectTimeSavings(e,r.hourlyRate),i=yield this.calculateIndirectCostSavings(t,r),l=yield this.calculateErrorPreventionSavings(t,r),c=yield this.calculateComplianceSavings(),o=yield this.calculateResourceOptimizationSavings(),d=s.daily+i.daily+l.daily+c.daily+o.daily,u=s.monthly+i.monthly+l.monthly+c.monthly+o.monthly,m=1e4,p=u*12,f=m>0?p/m*100:0;return{daily:Math.round(d*100)/100,monthly:Math.round(u*100)/100,annual:Math.round(p*100)/100,roi:Math.round(f*100)/100}}catch(r){return console.error("Error calculating cost savings:",r),this.calculateBasicCostSavings(e)}})}getFacilityCosts(){return Zr(this,null,function*(){try{const{FacilityService:e}=yield L(()=>Promise.resolve().then(()=>It),void 0),t=yield e.getCurrentFacilityId(),{data:r}=yield _.from("facilities").select("hourly_rate, type, staff_count").eq("id",t).single();return{hourlyRate:(r==null?void 0:r.hourly_rate)||45,facilityType:(r==null?void 0:r.facility_type)||"general",staffCount:(r==null?void 0:r.staff_count)||10}}catch(e){return console.error(e),{hourlyRate:45,facilityType:"general",staffCount:10}}})}calculateDirectTimeSavings(e,t){return{daily:e.daily/60*t,monthly:e.monthly/60*t}}calculateIndirectCostSavings(e,t){return Zr(this,null,function*(){const s=t.hourlyRate*t.staffCount*.3*.5,i=s*22;return{daily:s,monthly:i}})}calculateErrorPreventionSavings(e,t){return Zr(this,null,function*(){try{const{FacilityService:r}=yield L(()=>Promise.resolve().then(()=>It),void 0),s=yield r.getCurrentFacilityId(),{data:i}=yield _.from("quality_incidents").select("cost_impact, severity").eq("facility_id",s).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString());if(!i||i.length===0){const o=t.facilityType==="dental"?150:200;return{daily:o*.1,monthly:o*2}}const c=i.reduce((o,d)=>o+(d.cost_impact||0),0)*.4;return{daily:c/30,monthly:c}}catch(r){console.error(r);const s=200;return{daily:s*.1,monthly:s*2}}})}calculateComplianceSavings(){return Zr(this,null,function*(){return{daily:600/30,monthly:600}})}calculateResourceOptimizationSavings(){return Zr(this,null,function*(){try{const{FacilityService:e}=yield L(()=>Promise.resolve().then(()=>It),void 0),t=yield e.getCurrentFacilityId(),{data:r}=yield _.from("inventory_items").select("unit_cost, quantity, reorder_point").eq("facility_id",t),{data:s}=yield _.from("sterilization_cycles").select("tools, cycle_time").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString()),i=(r==null?void 0:r.filter(d=>d.quantity<d.reorder_point))||[],l=i?i.reduce((d,u)=>d+u.unit_cost*.1,0):100,c=s?s.reduce((d,u)=>d+u.cycle_time*.15,0):50,o=l+c;return{daily:o/30,monthly:o}}catch(e){return console.error(e),{daily:5,monthly:150}}})}calculateBasicCostSavings(e){const r=e.daily/60*45,s=e.monthly/60*45,i=s*12;return{daily:Math.round(r*100)/100,monthly:Math.round(s*100)/100,annual:Math.round(i*100)/100,roi:0}}}const Ip=new Cp,Zj=Object.freeze(Object.defineProperty({__proto__:null,AICostCalculationService:Cp,aiCostCalculationService:Ip},Symbol.toStringTag,{value:"Module"}));var eE=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class jp{getAIInsights(e){return eE(this,null,function*(){try{const t=[];return e.timeSavings.daily>120&&t.push(`🚀 AI saved ${Math.round(e.timeSavings.daily/60)} hours today!`),e.costSavings.monthly>1e3&&t.push(`💰 AI generated $${e.costSavings.monthly} in monthly savings`),e.proactiveManagement.issuesPrevented>5&&t.push(`🛡️ AI prevented ${e.proactiveManagement.issuesPrevented} potential issues this week`),e.costSavings.roi>50&&t.push(`📈 AI ROI: ${e.costSavings.roi}% - Excellent investment!`),t}catch(t){return console.error("Error getting AI insights:",t),["AI system is actively monitoring facility operations"]}})}generateAIImpactReport(e){return`
AI Impact Report - ${new Date().toLocaleDateString()}
================================================

TIME SAVINGS
------------
Daily: ${Math.round(e.timeSavings.daily/60)} hours (${Math.round(e.timeSavings.daily)} minutes)
Weekly: ${Math.round(e.timeSavings.weekly/60)} hours (${Math.round(e.timeSavings.weekly)} minutes)
Monthly: ${Math.round(e.timeSavings.monthly/60)} hours (${Math.round(e.timeSavings.monthly)} minutes)
Total: ${Math.round(e.timeSavings.total/60)} hours (${Math.round(e.timeSavings.total)} minutes)
Improvement: ${e.timeSavings.percentage}%

PROACTIVE MANAGEMENT
-------------------
Issues Prevented: ${e.proactiveManagement.issuesPrevented}
Early Interventions: ${e.proactiveManagement.earlyInterventions}
Compliance Score: ${e.proactiveManagement.complianceScore}%
Risk Mitigation: ${e.proactiveManagement.riskMitigation}%
Predictive Accuracy: ${e.proactiveManagement.predictiveAccuracy}%

COST SAVINGS
------------
Daily: $${e.costSavings.daily}
Monthly: $${e.costSavings.monthly}
Annual: $${e.costSavings.annual}
ROI: ${e.costSavings.roi}%

EFFICIENCY GAINS
----------------
Task Completion Rate: ${e.efficiencyGains.taskCompletionRate}%
Quality Improvement: ${e.efficiencyGains.qualityImprovement}%
Resource Optimization: ${e.efficiencyGains.resourceOptimization}%
Workflow Streamlining: ${e.efficiencyGains.workflowStreamlining}%

REAL-TIME UPDATES
-----------------
Last Updated: ${new Date(e.realTimeUpdates.lastUpdated).toLocaleString()}
Next Update: ${new Date(e.realTimeUpdates.nextUpdate).toLocaleString()}
Data Freshness: ${e.realTimeUpdates.dataFreshness} minutes
`.trim()}generateExecutiveSummary(e){return`
AI Implementation Executive Summary
==================================

KEY HIGHLIGHTS
--------------
• AI has saved ${Math.round(e.timeSavings.monthly/60)} hours this month
• Generated $${e.costSavings.monthly} in monthly cost savings
• Achieved ${e.costSavings.roi}% ROI on AI investment
• Prevented ${e.proactiveManagement.issuesPrevented} potential issues

PERFORMANCE METRICS
-------------------
• Time Efficiency: ${e.timeSavings.percentage}% improvement
• Cost Reduction: $${e.costSavings.annual} annual savings
• Compliance: ${e.proactiveManagement.complianceScore}% score
• Quality: ${e.efficiencyGains.qualityImprovement}% improvement

RECOMMENDATIONS
---------------
• Continue AI implementation across all departments
• Monitor ROI trends for investment decisions
• Expand proactive management capabilities
• Leverage efficiency gains for strategic planning

Generated: ${new Date().toLocaleString()}
`.trim()}generatePerformanceBreakdown(e){return{timeAnalysis:{dailyBreakdown:{hours:Math.round(e.timeSavings.daily/60),minutes:Math.round(e.timeSavings.daily),percentage:e.timeSavings.percentage},weeklyBreakdown:{hours:Math.round(e.timeSavings.weekly/60),minutes:Math.round(e.timeSavings.weekly)},monthlyBreakdown:{hours:Math.round(e.timeSavings.monthly/60),minutes:Math.round(e.timeSavings.monthly)}},costAnalysis:{savings:{daily:e.costSavings.daily,monthly:e.costSavings.monthly,annual:e.costSavings.annual},roi:e.costSavings.roi,investment:1e4},efficiencyAnalysis:{completion:e.efficiencyGains.taskCompletionRate,quality:e.efficiencyGains.qualityImprovement,resources:e.efficiencyGains.resourceOptimization,workflow:e.efficiencyGains.workflowStreamlining},proactiveAnalysis:{issues:e.proactiveManagement.issuesPrevented,interventions:e.proactiveManagement.earlyInterventions,compliance:e.proactiveManagement.complianceScore,risk:e.proactiveManagement.riskMitigation,accuracy:e.proactiveManagement.predictiveAccuracy},metadata:{generated:new Date().toISOString(),lastUpdated:e.realTimeUpdates.lastUpdated,nextUpdate:e.realTimeUpdates.nextUpdate,dataFreshness:e.realTimeUpdates.dataFreshness}}}}const ba=new jp,tE=Object.freeze(Object.defineProperty({__proto__:null,AIReportingService:jp,aiReportingService:ba},Symbol.toStringTag,{value:"Module"}));var ji=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Ep{getAIImpactMetrics(){return ji(this,null,function*(){return yield nu.getAIImpactMetrics()})}getAIInsights(){return ji(this,null,function*(){return yield nu.getAIInsights()})}generateAIImpactReport(e){return ba.generateAIImpactReport(e)}generateExecutiveSummary(e){return ba.generateExecutiveSummary(e)}generatePerformanceBreakdown(e){return ba.generatePerformanceBreakdown(e)}calculateCostSavings(e,t){return ji(this,null,function*(){return yield Ip.calculateCostSavings(e,t)})}}const Tp=new Ep,rE=Object.freeze(Object.defineProperty({__proto__:null,AIImpactMeasurementService:Ep,aiImpactMeasurementService:Tp},Symbol.toStringTag,{value:"Module"}));var nE=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const sE=({timeframe:n="daily",aiImpactMetrics:e})=>{const[t,r]=h.useState(null),[s,i]=h.useState(!0);if(h.useEffect(()=>{if(e){console.log("🤖 EnhancedAiEfficiencyCard: Using pre-loaded AI metrics:",e),r(e),i(!1);return}console.log("🤖 EnhancedAiEfficiencyCard: No pre-loaded metrics, fetching independently...");const u=()=>nE(null,null,function*(){try{i(!0);const p=yield Tp.getAIImpactMetrics();r(p)}catch(p){console.error("Error fetching AI metrics:",p)}finally{i(!1)}});u();const m=setInterval(u,120*1e3);return()=>clearInterval(m)},[e]),s)return a.jsx("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:a.jsxs("div",{className:"animate-pulse",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"bg-purple-200 rounded-md p-2 mr-3 w-10 h-10"}),a.jsx("div",{className:"h-5 bg-gray-200 rounded w-32"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})});const l=t||{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},costSavings:{daily:0,monthly:0,annual:0,roi:0}},c=()=>{const u=(()=>{switch(n){case"daily":return l.timeSavings.daily;case"weekly":return l.timeSavings.weekly;case"monthly":return l.timeSavings.monthly;default:return l.timeSavings.daily}})();return console.log("🕒 EnhancedAiEfficiencyCard: getTimeframeValue:",{timeframe:n,timeSavings:l.timeSavings,returnedValue:u}),u},o=u=>{console.log("⏰ EnhancedAiEfficiencyCard: formatTime called with:",u);const m=(()=>{if(u<60)return`${u} m`;const p=Math.floor(u/60),f=u%60;return f>0?`${p}h ${f} m`:`${p}h`})();return console.log("⏰ EnhancedAiEfficiencyCard: formatTime result:",m),m},d=u=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(u);return a.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"bg-purple-200 rounded-md p-2 mr-3",children:a.jsx(og,{size:20,className:"text-purple-900"})}),a.jsx("div",{children:a.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"AI & Process Efficiency"})})]}),a.jsx("div",{className:"flex items-center text-xs text-gray-400"})]}),a.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-left text-gray-500",children:"Time Saved"}),a.jsx("span",{className:"text-base text-right text-gray-700",children:o(c())})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-left text-gray-500",children:"Cost Saved"}),a.jsx("span",{className:"text-base text-right text-gray-700",children:d(n==="weekly"?l.costSavings.monthly/4:l.costSavings[n]||0)})]})]})]})},aE=({data:n})=>a.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("span",{className:"bg-yellow-200 rounded-md p-2 mr-3",children:a.jsx(lg,{size:20,className:"text-yellow-900"})}),a.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Team Performance"})]}),a.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Skills"}),a.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[n.skills,"%"]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Inventory Efficiency"}),a.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[n.inventory,"%"]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Sterilization Efficiency"}),a.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[n.sterilization,"%"]})]})]})]});function iE(n){return Jg({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"},child:[]}]})(n)}const oE=({metrics:n={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0}},aiImpactMetrics:e})=>{var t,r,s,i,l,c,o,d,u;const[m]=h.useState("daily");return console.log("📊 PerformanceMetrics: Received metrics:",n),console.log("🤖 PerformanceMetrics: Received aiImpactMetrics:",e),console.log("👥 PerformanceMetrics: Team performance data:",n.teamPerformance),e&&console.log("🔍 aiImpactMetrics structure:",{timeSavings:e.timeSavings,costSavings:e.costSavings,keys:Object.keys(e)}),a.jsxs("div",{className:"bg-white rounded-lg p-4 pt-2",children:[a.jsx("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"bg-teal-100 rounded-md p-1",children:a.jsx(iE,{size:24,color:"#4ECDC4"})}),a.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:"Performance Metrics"})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(Yj,{data:n.timeSaved,timeframe:m}),a.jsx(Jj,{data:n.costSavings}),a.jsx(sE,{timeframe:m,showInsights:!1,aiImpactMetrics:e?{timeSavings:{daily:((t=e.timeSavings)==null?void 0:t.daily)||0,weekly:((r=e.timeSavings)==null?void 0:r.weekly)||0,monthly:((s=e.timeSavings)==null?void 0:s.monthly)||0,total:((i=e.timeSavings)==null?void 0:i.total)||0,percentage:((l=e.timeSavings)==null?void 0:l.percentage)||0},costSavings:{daily:((c=e.costSavings)==null?void 0:c.daily)||0,monthly:((o=e.costSavings)==null?void 0:o.monthly)||0,annual:((d=e.costSavings)==null?void 0:d.annual)||0,roi:((u=e.costSavings)==null?void 0:u.roi)||0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:0,riskMitigation:0,predictiveAccuracy:0},efficiencyGains:{taskCompletionRate:0,qualityImprovement:0,resourceOptimization:0,workflowStreamlining:0},realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:"",dataFreshness:100}}:null}),a.jsx(aE,{data:n.teamPerformance,timeframe:m})]})]})};function lE(){return a.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 shadow-sm mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"BI Indicator Dashboard"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Biological indicator results will be displayed here once available."})]})}function cE(){return a.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50 shadow-sm mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CI Indicator Dashboard"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Chemical indicator results will be displayed here once available."})]})}const dE=({biData:n,ciData:e,performanceMetrics:t,aiImpactMetrics:r})=>a.jsxs("div",{className:Lb(),"data-testid":"metrics-section",children:[a.jsx(oE,{metrics:t,aiImpactMetrics:r}),n&&a.jsx(lE,{}),e&&a.jsx(cE,{})]}),uE=h.memo(dE);var mE=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const hE=({onRefresh:n,className:e="",size:t="md"})=>{const[r,s]=h.useState(!1),[i,l]=h.useState(null),[c,o]=h.useState("idle"),d={sm:"w-6 h-6 text-sm",md:"w-8 h-8 text-base",lg:"w-10 h-10 text-lg"},u=()=>mE(null,null,function*(){if(!r){s(!0),o("idle");try{yield n(),l(new Date),o("success"),setTimeout(()=>o("idle"),2e3)}catch(g){console.error("Refresh failed:",g),o("error"),setTimeout(()=>o("idle"),3e3)}finally{s(!1)}}}),m=()=>{if(r)return a.jsx(Yo,{className:"animate-spin"});switch(c){case"success":return a.jsx(dg,{className:"text-green-500"});case"error":return a.jsx(cg,{className:"text-red-500"});default:return a.jsx(Yo,{})}},p=()=>r?"Refreshing...":c==="success"?"Updated successfully":c==="error"?"Refresh failed":i?`Last updated: ${i.toLocaleTimeString()}`:"Refresh",f=()=>r?"Refreshing performance metrics":c==="success"?"Performance metrics updated successfully":c==="error"?"Failed to refresh performance metrics - try again":i?`Refresh performance metrics - Last updated: ${i.toLocaleTimeString()}`:"Refresh performance metrics (PRN)";return a.jsx(Gh,{content:p(),children:a.jsx("button",{onClick:u,disabled:r,className:`
          ${d[t]}
          flex items-center justify-center
          bg-white hover:bg-gray-50
          border border-gray-200 hover:border-gray-300
          rounded-lg shadow-sm hover:shadow-md
          transition-all duration-200
          disabled:opacity-50 disabled:cursor-not-allowed
          ${e}
        `,"aria-label":f(),children:m()})})};var ns=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class pE{constructor(){this.cache=null,this.CACHE_DURATION=1440*60*1e3,this.lastLogTime=0}fetchAndCacheMetricsOnLogin(){return ns(this,null,function*(){try{O.debug("PerformanceMetricsCache: Fetching metrics on login...");const{homeMetricsService:e}=yield L(()=>import("./homeMetricsService-B6TcB_5y.js"),__vite__mapDeps([14,1,2,3,4,5,13,6])),{homeSterilizationIntegration:t}=yield L(()=>import("./homeSterilizationIntegration-QD1Y8JMp.js"),__vite__mapDeps([15,1,2,3,4,5,6])),{homeIntegrationService:r}=yield L(()=>import("./homeIntegrationService-Bc05rlN6.js"),__vite__mapDeps([16,1,2,3,4,5])),{FacilityService:s}=yield L(()=>Promise.resolve().then(()=>It),void 0),i=yield s.getCurrentFacilityId();if(!i)return O.debug("PerformanceMetricsCache: No facility ID, skipping cache"),null;const[l,c,o,d]=yield Promise.allSettled([e.getHomeMetrics(),t.getSterilizationMetrics(),r.getAllMetrics(),L(()=>Promise.resolve().then(()=>rE),void 0).then(p=>p.aiImpactMeasurementService.getAIImpactMetrics())]);console.log("🔍 PerformanceMetricsCache: AI Metrics result:",l),console.log("🔍 PerformanceMetricsCache: Sterilization result:",c),console.log("🔍 PerformanceMetricsCache: Integration result:",o),console.log("🔍 PerformanceMetricsCache: AI Impact result:",d);const u={aiMetrics:l.status==="fulfilled"?l.value:null,sterilizationMetrics:c.status==="fulfilled"?c.value:null,integrationMetrics:o.status==="fulfilled"?o.value:null,aiImpactMetrics:d.status==="fulfilled"?d.value:null,timestamp:Date.now(),facilityId:i};this.cache=u;try{localStorage.setItem("performanceMetricsCache",JSON.stringify(u))}catch(p){O.debug("PerformanceMetricsCache: Could not store in localStorage")}const m=Date.now();return m-this.lastLogTime>1e3&&(O.debug("PerformanceMetricsCache: Metrics cached successfully for facility:",i),this.lastLogTime=m),u}catch(e){return console.error("PerformanceMetricsCache: Error fetching metrics on login:",e),null}})}getCachedMetrics(){return ns(this,null,function*(){if(this.cache&&(yield this.isCacheValid(this.cache)))return this.cache;try{const e=localStorage.getItem("performanceMetricsCache");if(e){const t=JSON.parse(e);if(yield this.isCacheValid(t))return this.cache=t,t}}catch(e){O.debug("PerformanceMetricsCache: Could not read from localStorage:",e)}return null})}refreshMetrics(){return ns(this,null,function*(){return O.debug("PerformanceMetricsCache: Manual refresh requested"),this.cache=null,localStorage.removeItem("performanceMetricsCache"),yield this.fetchAndCacheMetricsOnLogin()})}isCacheValid(e){return ns(this,null,function*(){const r=Date.now()-e.timestamp;if(r>this.CACHE_DURATION)return O.debug("PerformanceMetricsCache: Cache expired (age:",r,"ms)"),!1;try{if((yield ht.getCurrentFacilityId())!==e.facilityId)return O.debug("PerformanceMetricsCache: Facility changed, cache invalid"),!1}catch(s){}return!0})}clearCache(){this.cache=null,localStorage.removeItem("performanceMetricsCache"),O.debug("PerformanceMetricsCache: Cache cleared")}getCacheStatus(){return ns(this,null,function*(){const e=yield this.getCachedMetrics();return e?{hasCache:!0,age:Date.now()-e.timestamp,facilityId:e.facilityId}:{hasCache:!1}})}}const co=new pE;var fE=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const gE=X.memo(function({loading:e=!1,aiMetrics:t,sterilizationMetrics:r,integrationMetrics:s,aiImpactMetrics:i}){const l=()=>fE(null,null,function*(){try{co.clearCache(),yield co.fetchAndCacheMetricsOnLogin(),window.location.reload()}catch(d){throw console.error("Failed to refresh metrics:",d),d}}),c=h.useMemo(()=>{var d,u,m;return{timeSaved:(t==null?void 0:t.timeSaved)||{daily:0,monthly:0},aiTimeSaved:(t==null?void 0:t.aiTimeSaved)||{daily:0,monthly:0},costSavings:(t==null?void 0:t.costSavings)||{monthly:0,annual:0},aiEfficiency:(t==null?void 0:t.aiEfficiency)||{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:((d=t==null?void 0:t.teamPerformance)==null?void 0:d.skills)||0,inventory:((u=t==null?void 0:t.teamPerformance)==null?void 0:u.inventory)||0,sterilization:((m=t==null?void 0:t.teamPerformance)==null?void 0:m.sterilization)||0}}},[t]);return e&&!(t||r||s)?a.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})}):a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute top-4 right-4 z-10",children:a.jsx(hE,{onRefresh:l,size:"sm",className:"shadow-md"})}),a.jsx(h.Suspense,{fallback:a.jsx(_s,{}),children:a.jsx(Es,{children:a.jsx(uE,{biData:void 0,ciData:void 0,performanceMetrics:c,aiImpactMetrics:i})})})]})}),yE=({points:n})=>{const e=Math.max(0,n||0);return a.jsx("div",{className:"text-xl font-bold text-[#4ECDC4]",children:e})},vE=({streakCount:n})=>{const e=Math.max(0,n||0);return a.jsxs("div",{className:"text-sm text-orange-500 font-medium",children:["🔥 ",e,"-day streak"]})},_E=({level:n})=>{const e=Math.max(1,n||1);return a.jsx("span",{className:"text-xl font-bold text-[#4ECDC4]",children:e})},xE=({gamificationData:n={streak:0,level:1,rank:100,totalScore:0,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}}})=>a.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2","aria-label":Do.STATS,"aria-live":"polite","data-testid":"gamification-stats",children:a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center p-1 pr-8",children:[a.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:a.jsx(ug,{size:20,className:"text-[#4ECDC4]"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Current Streak"}),a.jsx("div",{className:"flex items-baseline",children:a.jsx(vE,{streakCount:n.streak})})]})]}),a.jsxs("div",{className:"flex items-center p-1",children:[a.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:a.jsx(mg,{size:20,className:"text-[#4ECDC4]"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Level"}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx(_E,{level:n.level}),a.jsx("div",{className:"ml-2 px-2 py-0.5 bg-blue-100 rounded-full",children:a.jsxs("span",{className:"text-xs font-semibold text-blue-600",children:["Top ",n.rank,"%"]})})]})]})]}),a.jsxs("div",{className:"flex items-center p-1 pl-8",children:[a.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:a.jsx(hg,{size:20,className:"text-[#4ECDC4]"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Points"}),a.jsx("div",{className:"flex items-baseline",children:a.jsx(yE,{points:n.totalScore})})]})]})]})}),Ei={DEFAULT_RANK:100,DEFAULT_LEVEL:1,DEFAULT_SCORE:0},Np=X.memo(({gamificationData:n})=>{const{stats:e,loading:t}=Qh(),{updateGamificationData:r}=Po(),i=!(n&&typeof n.streak=="number"&&typeof n.level=="number"&&typeof n.rank=="number"&&typeof n.totalScore=="number"&&n.streak>=0&&n.level>=1&&n.rank>=1&&n.totalScore>=0)||t,l=h.useMemo(()=>{const c=Math.max(0,(n==null?void 0:n.streak)||0),o=Math.max(1,(n==null?void 0:n.level)||Ei.DEFAULT_LEVEL),d=Math.max(1,(n==null?void 0:n.rank)||Ei.DEFAULT_RANK),u=Math.max(0,(n==null?void 0:n.totalScore)||Ei.DEFAULT_SCORE);return{streak:c,level:o,rank:d,totalScore:u,stats:{toolsSterilized:e.toolsSterilized||0,inventoryChecks:e.inventoryChecks||0,perfectDays:e.perfectDays||0,totalTasks:e.totalTasks||0,completedTasks:e.completedTasks||0,currentStreak:e.currentStreak||c,bestStreak:e.bestStreak||0}}},[n==null?void 0:n.streak,n==null?void 0:n.level,n==null?void 0:n.rank,n==null?void 0:n.totalScore,e]);return h.useEffect(()=>{!i&&l&&r(l)},[l,i,r]),i?a.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2",children:a.jsx("div",{className:"animate-pulse",children:a.jsxs("div",{className:"flex items-center justify-between p-1",children:[a.jsxs("div",{className:"flex items-center p-1",children:[a.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 mb-1"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]}),a.jsxs("div",{className:"flex items-center p-1",children:[a.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-8 mr-2"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]})]}),a.jsxs("div",{className:"flex items-center p-1 pl-8",children:[a.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),a.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]})]})]})})}):a.jsx(xE,{gamificationData:l})});Np.displayName="HomeGamificationSection";const kp=X.memo(({gamificationData:n,tasks:e,loading:t,taskError:r,storeAvailablePoints:s,storeShowFilters:i,setStoreShowFilters:l,selectedCategory:c,selectedType:o,onCategoryChange:d,onTypeChange:u,onTaskToggle:m,onTaskUpdate:p,aiMetrics:f,sterilizationMetrics:g,integrationMetrics:y,aiImpactMetrics:v})=>{const x=h.useMemo(()=>$r("flex flex-col lg:flex-row gap-6",`mt-${Qe.SPACING.MARGIN_TOP}`),[]),b=h.useMemo(()=>$r(`p-${Qe.SPACING.PADDING}`),[]);return a.jsx("div",{className:b,children:a.jsxs("div",{className:"space-y-6",children:[a.jsx(Np,{gamificationData:n}),a.jsxs("div",{className:x,children:[a.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:a.jsx(Sp,{tasks:e,loading:t,taskError:r,storeAvailablePoints:s,storeShowFilters:i,setStoreShowFilters:l,selectedCategory:c,selectedType:o,onCategoryChange:d,onTypeChange:u,onTaskToggle:m,onTaskUpdate:p})}),a.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:a.jsx(gE,{loading:t,aiMetrics:f,sterilizationMetrics:g,integrationMetrics:y,aiImpactMetrics:v})})]})]})})});kp.displayName="HomeContentLayout";var sa=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Pp=X.memo(({homeData:n})=>{const[e,t]=h.useState(!1),[r,s]=h.useState(!1),[i,l]=h.useState(""),[c,o]=h.useState(""),d=h.useMemo(()=>n.tasks||[],[n.tasks]),u=d.length,[m,p]=h.useState(1),g=Math.ceil(u/10),y=m<g,v=h.useCallback(()=>{y&&p(D=>D+1)},[y]),x=h.useCallback(()=>{m>1&&p(D=>D-1)},[m]),b=h.useCallback(D=>{D>=1&&D<=g&&p(D)},[g]),C=h.useCallback(D=>sa(null,null,function*(){console.log("Completing task:",D)}),[]),k=h.useCallback(()=>sa(null,null,function*(){console.log("Refreshing tasks...")}),[]),P=!1,E=null,{aiMetrics:$={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:w={},integrationMetrics:S={},aiImpactMetrics:A=null}=n||{},I=h.useMemo(()=>d.map(D=>({id:D.id,title:D.title,description:D.description||"",completed:D.isCompleted,points:D.points,type:D.category,category:D.category,priority:"medium",dueDate:D.createdAt,status:D.isCompleted?"completed":"pending"})),[d]),T=h.useMemo(()=>d.reduce((D,U)=>D+(U.points||0),0),[d]),j=h.useMemo(()=>(F=>F&&typeof F=="object"&&F!==null&&"streak"in F&&typeof F.streak=="number"&&Number(F.streak)>=0&&"level"in F&&typeof F.level=="number"&&Number(F.level)>=1&&"rank"in F&&typeof F.rank=="number"&&Number(F.rank)>=1&&"totalScore"in F&&typeof F.totalScore=="number"&&Number(F.totalScore)>=0)(n.gamificationData)?n.gamificationData:{streak:0,level:5,rank:1,totalScore:Math.max(0,T||0)},[n.gamificationData,T]),M=h.useCallback(D=>{t(D)},[]);h.useCallback(()=>{},[]);const B=h.useCallback(D=>{l(D)},[]),G=h.useCallback(D=>{o(D)},[]),Y=h.useCallback((D,U)=>sa(null,null,function*(){try{const{FacilityService:F}=yield L(()=>Promise.resolve().then(()=>It),void 0);if(!(yield F.getCurrentFacilityId()))throw new Error("No authenticated facility for task toggle");yield C(D),U&&U>0&&console.log(`Task completed! Awarded ${U} points.`)}catch(F){console.error("Error toggling task:",F)}}),[C]),R=h.useCallback((D,U)=>sa(null,null,function*(){try{const F={title:U.title,description:U.description,category:U.category,points:U.points||0,isCompleted:U.status==="completed"};yield bp.updateDailyTask(D,F),yield k(),console.log("Task updated successfully:",D)}catch(F){throw console.error("Failed to update task:",F),F}}),[k]);return a.jsxs("div",{className:"home-content","data-testid":"home-content",children:[a.jsx(kp,{gamificationData:j,tasks:I,loading:P,taskError:E,storeAvailablePoints:T,storeShowFilters:r,setStoreShowFilters:s,selectedCategory:i,selectedType:c,onCategoryChange:B,onTypeChange:G,onTaskToggle:Y,onTaskUpdate:R,aiMetrics:$||void 0,sterilizationMetrics:w||void 0,integrationMetrics:S||void 0,aiImpactMetrics:A||void 0}),g>1&&a.jsxs("div",{className:"mt-8 mb-4",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"paginationStyle",checked:!e,onChange:()=>M(!1),className:"mr-2"}),"Pagination"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"paginationStyle",checked:e,onChange:()=>M(!0),className:"mr-2"}),"Load More"]})]})}),e?a.jsx(jj,{onLoadMore:v,hasMore:y,isLoading:P,className:"mb-4"}):a.jsx(Ij,{currentPage:m,totalPages:g,onPageChange:b,onNextPage:v,onPreviousPage:x,hasNextPage:y,hasPreviousPage:m>1,isLoading:P,className:"mb-4"})]})]})});Pp.displayName="HomeContent";var bE=Object.defineProperty,wE=Object.defineProperties,SE=Object.getOwnPropertyDescriptors,su=Object.getOwnPropertySymbols,CE=Object.prototype.hasOwnProperty,IE=Object.prototype.propertyIsEnumerable,au=(n,e,t)=>e in n?bE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,jE=(n,e)=>{for(var t in e||(e={}))CE.call(e,t)&&au(n,t,e[t]);if(su)for(var t of su(e))IE.call(e,t)&&au(n,t,e[t]);return n},EE=(n,e)=>wE(n,SE(e));function TE({homeData:n}){const{setShowStatsModal:e,setShowLeaderboardModal:t,setShowChallengeModal:r}=Po(),{isDrawerOpen:s}=Nh(),{navBarMarginLeft:i,navBarMarginTop:l}=Fb(s),c=h.useRef(null),o=h.useCallback(()=>e(!0),[e]),d=h.useCallback(()=>t(!0),[t]),u=h.useCallback(()=>r(!0),[r]);return a.jsx(Es,{children:a.jsxs(ks,{children:[a.jsxs("div",{className:$r("h-screen bg-gradient-to-br hide-scrollbar overflow-hidden",`from-${Qe.COLORS.BG_GRADIENT.FROM}`,`to-${Qe.COLORS.BG_GRADIENT.TO}`),"aria-label":"Cliniio Home Dashboard","data-testid":"home-layout",children:[a.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white text-black p-2 z-50 rounded shadow-lg","aria-label":"Skip to main content",children:"Skip to main content"}),a.jsxs("main",{className:`flex-1 border-l-${Qe.BORDER.LEFT_WIDTH} border-${Qe.COLORS.BORDER} pt-6 overflow-hidden`,role:"main",id:"main-content",ref:c,tabIndex:-1,"aria-label":"Main content area",children:[a.jsx("div",{style:{marginLeft:i,marginTop:l},className:"flex-shrink-0","aria-label":"Dashboard header container",children:a.jsx(Mb,{onStatsClick:o,onLeaderboardClick:d,onChallengeClick:u})}),a.jsx("div",{style:{marginLeft:i},className:"flex-1 overflow-y-auto hide-scrollbar",role:"region","aria-label":"Dashboard content",children:a.jsx(Pp,{homeData:n})})]})]}),a.jsx(pw,{leaderboardData:EE(jE({},n.leaderboardData),{users:[],userRank:1})})]})})}var NE=Object.defineProperty,kE=Object.defineProperties,PE=Object.getOwnPropertyDescriptors,iu=Object.getOwnPropertySymbols,DE=Object.prototype.hasOwnProperty,AE=Object.prototype.propertyIsEnumerable,ou=(n,e,t)=>e in n?NE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lu=(n,e)=>{for(var t in e||(e={}))DE.call(e,t)&&ou(n,t,e[t]);if(iu)for(var t of iu(e))AE.call(e,t)&&ou(n,t,e[t]);return n},cu=(n,e)=>kE(n,PE(e)),OE=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Ti=[{id:"demo-1",title:"Complete Daily Safety Checklist",description:"Review and complete the facility safety checklist",category:"Safety",difficulty:"Easy",points:50,timeEstimate:"15 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-2",title:"Update Inventory Records",description:"Verify and update current inventory levels",category:"Inventory",difficulty:"Medium",points:75,timeEstimate:"30 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-3",title:"Review Sterilization Protocols",description:"Ensure all sterilization equipment is properly maintained",category:"Sterilization",difficulty:"Hard",points:100,timeEstimate:"45 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],ss={aiMetrics:{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:{cyclesCompleted:0,successRate:"0%",equipmentStatus:"No Data"},integrationMetrics:{systemHealth:"No Data",uptime:"0%",lastSync:"Never"}},RE=()=>{const{currentFacility:n,isLoading:e}=Ph(),[t,r]=h.useState({tasks:[],aiMetrics:null,aiImpactMetrics:null,sterilizationMetrics:null,integrationMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!0,error:null}),s=h.useCallback(()=>OE(null,null,function*(){try{r(b=>cu(lu({},b),{loading:!0,error:null}));let i;if(n!=null&&n.id)i=n.id;else{if(e)return;i="550e8400-e29b-41d4-a716-446655440000"}const[l,c,o]=yield Promise.allSettled([bp.getFacilityDailyTasks(i),co.fetchAndCacheMetricsOnLogin(),Kh.fetchCumulativeStats()]),d=yield Promise.resolve([]);console.log("🔍 useHomeDataLoader: Promise.allSettled results:",{allDailyTasks:l.status,freshMetrics:c.status,gamificationStats:o.status,leaderboardData:"skipped"});const u=l.status==="fulfilled"?l.value:Ti,m=c.status==="fulfilled"&&c.value?c.value:null,p=(m==null?void 0:m.aiMetrics)||{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},f=(m==null?void 0:m.sterilizationMetrics)||ss.sterilizationMetrics,g=(m==null?void 0:m.integrationMetrics)||ss.integrationMetrics,y={id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},v=o.status==="fulfilled"&&o.value?(()=>{const b=o.value,C=d.status==="fulfilled"&&d.values?d.values:{userRank:1,totalUsers:1},k=Math.max(0,b.currentStreak||0),P=Math.max(0,b.totalPoints||0),E=Math.max(1,C.userRank||1),$=Math.max(1,C.totalUsers||1),w=E/$;let S;return w<=.1?S=Math.max(10,Math.floor(10+(.1-w)*50)):w<=.25?S=Math.max(7,Math.floor(7+(.25-w)*20)):w<=.5?S=Math.max(5,Math.floor(5+(.5-w)*8)):S=Math.max(1,Math.floor(1+(1-w)*4)),{streak:k,level:S,rank:E,totalScore:P}})():null,x=u.length>0?u.map(b=>"difficulty"in b&&"timeEstimate"in b?b:{id:b.id,title:b.title,description:b.description||"",category:b.category,difficulty:b.priority||"medium",points:b.points,timeEstimate:`${b.estimated_duration||30} min`,isCompleted:b.completed||!1,completedAt:b.completed_at||null,pointsEarned:b.completed?b.points:0,createdAt:b.created_at||b.due_date||new Date().toISOString(),updatedAt:b.updated_at||new Date().toISOString()}):Ti;r({tasks:x,aiMetrics:p,sterilizationMetrics:f,integrationMetrics:g,aiImpactMetrics:(m==null?void 0:m.aiImpactMetrics)||null,leaderboardData:y,gamificationData:v,loading:!1,error:null}),console.log("🚀 Home data loaded (with fallbacks if needed):",{tasks:x.length,aiMetrics:!!p,sterilizationMetrics:!!f,integrationMetrics:!!g})}catch(i){console.error("Critical error loading home data, using all fallbacks:",i),r({tasks:Ti,aiMetrics:cu(lu({},ss.aiMetrics),{costSavings:{monthly:0,annual:0},teamPerformance:{skills:0,inventory:0,sterilization:0}}),sterilizationMetrics:ss.sterilizationMetrics,integrationMetrics:ss.integrationMetrics,aiImpactMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",points:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!1,error:null})}}),[n,e]);return h.useEffect(()=>{if(!e){const i=setTimeout(()=>{s()},0);return()=>clearTimeout(i)}},[e,s]),t},du=({size:n="lg",message:e="Data Compilation In Progress..."})=>{const t={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},r={sm:"text-sm",md:"text-base",lg:"text-lg"};return a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-6",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`${t[n]} animate-bounce`,children:a.jsx("div",{className:"text-6xl",children:"🚀"})}),a.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:a.jsx("div",{className:"w-1 h-8 bg-gradient-to-t from-orange-400 to-transparent animate-pulse"})})]}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("h3",{className:`font-semibold text-gray-700 ${r[n]}`,children:e}),a.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Preparing your dashboard for takeoff..."})]}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})};function $E(){const{currentUser:n,isLoading:e}=Mr(),t=Jo(l=>l.authToken),r=Jo(l=>l.isTokenExpired),s=RE();return!!!(n&&t&&!r())&&!e?a.jsx(bo,{to:"/login",replace:!0}):e||!n?a.jsx(du,{size:"lg",message:"Verifying Authentication..."}):s.loading?a.jsx(du,{size:"lg",message:"Data Compilation In Progress..."}):a.jsx(TE,{homeData:s})}const ME=h.createContext(null),Ni={didCatch:!1,error:null};class Cn extends h.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Ni}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,r,s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];(t=(r=this.props).onReset)===null||t===void 0||t.call(r,{args:i,reason:"imperative-api"}),this.setState(Ni)}}componentDidCatch(e,t){var r,s;(r=(s=this.props).onError)===null||r===void 0||r.call(s,e,t)}componentDidUpdate(e,t){const{didCatch:r}=this.state,{resetKeys:s}=this.props;if(r&&t.error!==null&&FE(e.resetKeys,s)){var i,l;(i=(l=this.props).onReset)===null||i===void 0||i.call(l,{next:s,prev:e.resetKeys,reason:"keys"}),this.setState(Ni)}}render(){const{children:e,fallbackRender:t,FallbackComponent:r,fallback:s}=this.props,{didCatch:i,error:l}=this.state;let c=e;if(i){const o={error:l,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")c=t(o);else if(r)c=h.createElement(r,o);else if(s!==void 0)c=s;else throw l}return h.createElement(ME.Provider,{value:{didCatch:i,error:l,resetErrorBoundary:this.resetErrorBoundary}},c)}}function FE(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n.length!==e.length||n.some((t,r)=>!Object.is(t,e[r]))}const aa=({title:n,value:e,icon:t,iconBgColor:r,gradientFrom:s,gradientTo:i,borderColor:l,textColor:c,valueColor:o,trend:d})=>a.jsxs("div",{className:`bg-gradient-to-br from-${s} to-${i} p-4 rounded-lg border border-${l}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:`text-sm font-medium ${c}`,children:n}),a.jsx("p",{className:`text-2xl font-bold ${o}`,children:e})]}),a.jsx("div",{className:`p-2 ${r} rounded-lg`,children:a.jsx(N,{path:t,size:1.5,className:"text-white"})})]}),d&&a.jsxs("div",{className:`mt-2 flex items-center text-xs ${c}`,children:[a.jsx(N,{path:d.direction==="up"?So:d.direction==="down"?_h:Aa,size:.8,className:"mr-1"}),a.jsx("span",{children:d.value})]})]}),LE=({score:n,trend:e})=>{const t=()=>e?e.direction==="up"?"text-green-600":"text-red-600":"text-gray-500",r=()=>e?e.direction==="up"?So:_h:bn;return a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-3 mt-4 mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"bg-blue-500 p-1.5 rounded-lg mr-3",children:a.jsx(N,{path:bn,size:1,className:"text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-base font-semibold text-blue-800",children:"Overall Efficiency Trend"}),a.jsxs("p",{className:"text-xl font-bold text-blue-900",children:[n,"%"]})]})]}),e&&a.jsxs("div",{className:`flex items-center text-sm font-medium ${t()}`,children:[a.jsx(N,{path:r(),size:.9,className:"mr-1"}),a.jsx("span",{children:e.value})]})]}),!e&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"No trend data available yet. Complete more cycles to see performance trends."})]})};function zE(n,e){let t;try{t=n()}catch(s){return}return{getItem:s=>{var i;const l=o=>o===null?null:JSON.parse(o,void 0),c=(i=t.getItem(s))!=null?i:null;return c instanceof Promise?c.then(l):l(c)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const uo=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(r){return uo(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return uo(r)(t)}}}},BE=(n,e)=>(t,r,s)=>{let i=re({storage:zE(()=>localStorage),partialize:y=>y,version:0,merge:(y,v)=>re(re({},v),y)},e),l=!1;const c=new Set,o=new Set;let d=i.storage;if(!d)return n((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},r,s);const u=()=>{const y=i.partialize(re({},r()));return d.setItem(i.name,{state:y,version:i.version})},m=s.setState;s.setState=(y,v)=>(m(y,v),u());const p=n((...y)=>(t(...y),u()),r,s);s.getInitialState=()=>p;let f;const g=()=>{var y,v;if(!d)return;l=!1,c.forEach(b=>{var C;return b((C=r())!=null?C:p)});const x=((v=i.onRehydrateStorage)==null?void 0:v.call(i,(y=r())!=null?y:p))||void 0;return uo(d.getItem.bind(d))(i.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==i.version){if(i.migrate){const C=i.migrate(b.state,b.version);return C instanceof Promise?C.then(k=>[!0,k]):[!0,C]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var C;const[k,P]=b;if(f=i.merge(P,(C=r())!=null?C:p),t(f,!0),k)return u()}).then(()=>{x==null||x(f,void 0),f=r(),l=!0,o.forEach(b=>b(f))}).catch(b=>{x==null||x(void 0,b)})};return s.persist={setOptions:y=>{i=re(re({},i),y),y.storage&&(d=y.storage)},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>l,onHydrate:y=>(c.add(y),()=>{c.delete(y)}),onFinishHydration:y=>(o.add(y),()=>{o.delete(y)})},i.skipHydration||g(),f||p},Ua=BE;var qE=Object.defineProperty,uu=Object.getOwnPropertySymbols,UE=Object.prototype.hasOwnProperty,HE=Object.prototype.propertyIsEnumerable,mu=(n,e,t)=>e in n?qE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ki=(n,e)=>{for(var t in e||(e={}))UE.call(e,t)&&mu(n,t,e[t]);if(uu)for(var t of uu(e))HE.call(e,t)&&mu(n,t,e[t]);return n};class vn{constructor(){this.metrics=new Map,this.callHistory=[],this.thresholds={maxResponseTime:5e3,maxErrorRate:10,maxCallsPerMinute:100},this.startCleanupInterval()}static getInstance(){return vn.instance||(vn.instance=new vn),vn.instance}startCall(e,t){const r=`${e}.${t}.${Date.now()}`,s={serviceName:e,methodName:t,startTime:Date.now()};return this.callHistory.push(s),r}endCall(e,t,r){const s=this.callHistory.find(i=>`${i.serviceName}.${i.methodName}.${i.startTime}`===e);if(!s){console.warn(`[ServiceMonitor] Call ${e} not found`);return}s.endTime=Date.now(),s.success=t,s.error=r,s.responseTime=s.endTime-s.startTime,this.updateMetrics(s)}updateMetrics(e){const t=e.serviceName,r=this.metrics.get(t)||{serviceName:t,totalCalls:0,successfulCalls:0,failedCalls:0,averageResponseTime:0,lastCallTime:0,errorRate:0,uptime:0};if(r.totalCalls++,e.success?r.successfulCalls++:r.failedCalls++,e.responseTime){const i=r.averageResponseTime*(r.totalCalls-1)+e.responseTime;r.averageResponseTime=i/r.totalCalls}r.errorRate=r.failedCalls/r.totalCalls*100,r.lastCallTime=e.endTime||e.startTime;const s=this.callHistory.find(i=>i.serviceName===t);s&&(r.uptime=e.endTime-s.startTime),this.metrics.set(t,r),this.checkPerformanceIssues(r)}checkPerformanceIssues(e){const t=[];e.averageResponseTime>this.thresholds.maxResponseTime&&t.push(`High response time: ${e.averageResponseTime}ms (threshold: ${this.thresholds.maxResponseTime}ms)`),e.errorRate>this.thresholds.maxErrorRate&&t.push(`High error rate: ${e.errorRate.toFixed(2)}% (threshold: ${this.thresholds.maxErrorRate}%)`);const r=this.getCallsLastMinute(e.serviceName);r>this.thresholds.maxCallsPerMinute&&t.push(`High call frequency: ${r} calls/minute (threshold: ${this.thresholds.maxCallsPerMinute})`),t.length>0&&(console.warn(`[ServiceMonitor] Performance issues detected for ${e.serviceName}:`,t),this.alertPerformanceIssues(e.serviceName,t))}getCallsLastMinute(e){const t=Date.now()-6e4;return this.callHistory.filter(r=>r.serviceName===e&&r.startTime>t).length}alertPerformanceIssues(e,t){console.error(`[ServiceMonitor] ALERT: ${e} has performance issues:`,t)}getServiceMetrics(e){return this.metrics.get(e)||null}getAllMetrics(){return Array.from(this.metrics.values())}getTopPerformingServices(e=5){return this.getAllMetrics().sort((t,r)=>t.errorRate-r.errorRate).slice(0,e)}getServicesWithIssues(){return this.getAllMetrics().filter(e=>e.errorRate>this.thresholds.maxErrorRate||e.averageResponseTime>this.thresholds.maxResponseTime)}updateThresholds(e){this.thresholds=ki(ki({},this.thresholds),e),console.log("[ServiceMonitor] Performance thresholds updated:",this.thresholds)}getThresholds(){return ki({},this.thresholds)}startCleanupInterval(){setInterval(()=>{this.cleanupOldCalls()},3e5)}cleanupOldCalls(){const e=Date.now()-36e5,t=this.callHistory.length;this.callHistory=this.callHistory.filter(s=>s.startTime>e);const r=t-this.callHistory.length;r>0&&console.log(`[ServiceMonitor] Cleaned up ${r} old call records`)}resetMetrics(){this.metrics.clear(),this.callHistory=[],console.log("[ServiceMonitor] All metrics reset")}exportMetrics(){return{metrics:this.getAllMetrics(),callHistory:[...this.callHistory],thresholds:this.getThresholds(),exportTime:Date.now()}}}const at=vn.getInstance();class VE{constructor(e,t){this.serviceName=e,this.originalService=t,this.wrapMethods()}wrapMethods(){const e=Object.getPrototypeOf(this.originalService);Object.getOwnPropertyNames(e).forEach(r=>{if(typeof e[r]=="function"&&r!=="constructor"){const s=e[r];e[r]=(...i)=>{const l=at.startCall(this.serviceName,r);try{const c=s.apply(this.originalService,i);return c&&typeof c.then=="function"?c.then(o=>(at.endCall(l,!0),o)).catch(o=>{throw at.endCall(l,!1,o instanceof Error?o.message:String(o)),o}):(at.endCall(l,!0),c)}catch(c){throw at.endCall(l,!1,c instanceof Error?c.message:String(c)),c}}}})}getService(){return this.originalService}}function WE(n,e){return new VE(n,e).getService()}var vr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Dp=class un{constructor(){this.services=new Map,this.serviceFactories=new Map,this.registerDefaultServices()}static getInstance(){return un.instance||(un.instance=new un),un.instance}register(e,t){this.serviceFactories.set(e,t)}get(e){if(!this.services.has(e)){const t=this.serviceFactories.get(e);if(!t)throw new Error(`Service '${e}' not registered`);const r=performance.now();try{const s=t(),i=WE(e,s);this.services.set(e,i);const l=performance.now()-r;oe.recordResponseTime("service_creation",l,{service:e,operation:"create"});const c=at.startCall("ServiceRegistry","createService");at.endCall(c,!0)}catch(s){const i=performance.now()-r;throw oe.recordErrorRate("service_creation",100,{service:e,operation:"create",error:s instanceof Error?s.message:"Unknown error"}),console.error(`[ServiceRegistry] Failed to create service '${e}' after ${i.toFixed(2)}ms:`,s),s}}return this.services.get(e)}has(e){return this.services.has(e)}remove(e){return this.services.delete(e)}getServiceNames(){return Array.from(this.services.keys())}getPerformanceMetrics(){return at.getAllMetrics()}getServicePerformanceMetrics(e){return at.getServiceMetrics(e)}getServicesWithPerformanceIssues(){return at.getServicesWithIssues()}getTopPerformingServices(e=5){return at.getTopPerformingServices(e)}exportPerformanceData(){return at.exportMetrics()}clear(){this.services.clear()}reset(){this.services.clear(),this.serviceFactories.clear(),un.instance=null}registerDefaultServices(){this.register("performanceMonitor",()=>oe),this.register("inventoryService",()=>vr(this,null,function*(){const{getInventoryService:e}=yield L(()=>import("./InventoryServiceFactory-DPkVKHhf.js"),__vite__mapDeps([17,2,3,1,4,5,6]));return e()})),this.register("errorHandling",()=>vr(this,null,function*(){const{ErrorHandlingService:e}=yield L(()=>import("./errorHandlingService-C6IddxfG.js"),__vite__mapDeps([18,1,2,3,4,5]));return e.getInstance()})),this.register("settings",()=>vr(this,null,function*(){const{SettingsService:e}=yield L(()=>import("./settingsService-C5iKJBtU.js"),__vite__mapDeps([19,1,2,3,4,5,6]));return e.getInstance()})),this.register("usageTracking",()=>vr(this,null,function*(){const{usageTrackingService:e}=yield L(()=>Promise.resolve().then(()=>lA),void 0);return e})),this.register("learningProgress",()=>vr(this,null,function*(){return(yield L(()=>Promise.resolve().then(()=>nR),void 0)).default.getInstance()})),this.register("cleaningSchedule",()=>vr(this,null,function*(){const{cleaningScheduleService:e}=yield L(()=>import("./cleaningScheduleService-DS4nGG-h.js"),__vite__mapDeps([20,1,2,3,4,5]));return e})),this.register("duplicatePrevention",()=>vr(this,null,function*(){const{duplicatePreventionService:e}=yield L(()=>import("./duplicatePreventionService-KgIY4Bki.js"),__vite__mapDeps([21,1,2,3,4,5,6]));return e}))}};Dp.instance=null;let GE=Dp;const Xt=GE.getInstance();var KE=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class QE{static getInventoryService(){return KE(this,null,function*(){return Xt.get("inventoryService")})}static getErrorHandlingService(){return Xt.get("errorHandling")}static getSettingsService(){return Xt.get("settings")}static getPerformanceMonitor(){return Xt.get("performanceMonitor")}static getUsageTrackingService(){return Xt.get("usageTracking")}static getLearningProgressService(){return Xt.get("learningProgress")}static getCleaningScheduleService(){return Xt.get("cleaningSchedule")}static getDuplicatePreventionService(){return Xt.get("duplicatePrevention")}}const as=QE.getInventoryService;var is=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Pi=(...n)=>console.log("[useCentralizedInventoryData]",...n);let wa=!1;const Or=Et()(Ua((n,e)=>({data:null,isLoading:!0,error:null,items:[],tools:[],supplies:[],equipment:[],officeHardware:[],getTools:()=>e().tools,getSupplies:()=>e().supplies,getEquipment:()=>e().equipment,getOfficeHardware:()=>e().officeHardware,getCategories:()=>{const t=e();return Array.from(new Set([...t.tools.map(r=>r.category).filter(r=>r!==null),...t.supplies.map(r=>r.category).filter(r=>r!==null),...t.equipment.map(r=>r.category).filter(r=>r!==null),...t.officeHardware.map(r=>r.category).filter(r=>r!==null)]))},getFilteredData:t=>is(null,null,function*(){const s=yield(yield as()).fetchInventoryItems();return!s||!Array.isArray(s)?[]:s.filter(i=>{var l,c;return((l=i.name)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((c=i.category)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))})}),getFilteredSuppliesData:t=>is(null,null,function*(){return(yield(yield as()).fetchInventoryItems()).filter(i=>{var l,c;return i.category==="Supplies"&&(((l=i.name)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((c=i.category)==null?void 0:c.toLowerCase().includes(t.toLowerCase())))})}),getFilteredEquipmentData:t=>is(null,null,function*(){return(yield(yield as()).fetchInventoryItems()).filter(i=>{var l,c;return i.category==="Equipment"&&(((l=i.name)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((c=i.category)==null?void 0:c.toLowerCase().includes(t.toLowerCase())))})}),getFilteredOfficeHardwareData:t=>is(null,null,function*(){return(yield(yield as()).fetchInventoryItems()).filter(i=>{var l,c;return i.category==="Office Hardware"&&(((l=i.name)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((c=i.category)==null?void 0:c.toLowerCase().includes(t.toLowerCase())))})}),refreshData:()=>is(null,null,function*(){var t,r,s,i,l,c,o,d,u,m,p,f,g,y,v,x,b,C,k;if(wa){console.log("[useCentralizedInventoryData] Data fetch already in progress, skipping...");return}wa=!0,n({isLoading:!0,error:null});try{let P=0;const E=2,$=25;for(;P<E;)try{const S=yield(yield as()).fetchAllInventoryData(),A=[...(t=S==null?void 0:S.tools)!=null?t:[],...(r=S==null?void 0:S.supplies)!=null?r:[],...(s=S==null?void 0:S.equipment)!=null?s:[],...(i=S==null?void 0:S.officeHardware)!=null?i:[]];console.log("[useCentralizedInventoryData] Setting state with data:",{allItems:A.length,tools:((l=S==null?void 0:S.tools)==null?void 0:l.length)||0,supplies:((c=S==null?void 0:S.supplies)==null?void 0:c.length)||0,equipment:((o=S==null?void 0:S.equipment)==null?void 0:o.length)||0,officeHardware:((d=S==null?void 0:S.officeHardware)==null?void 0:d.length)||0}),n({items:A,tools:(u=S==null?void 0:S.tools)!=null?u:[],supplies:(m=S==null?void 0:S.supplies)!=null?m:[],equipment:(p=S==null?void 0:S.equipment)!=null?p:[],officeHardware:(f=S==null?void 0:S.officeHardware)!=null?f:[],data:S,error:null,isLoading:!1}),Pi("✅ single-source applied",{counts:{all:A.length,tools:((g=S==null?void 0:S.tools)!=null?g:[]).length,supplies:((y=S==null?void 0:S.supplies)!=null?y:[]).length,equipment:((v=S==null?void 0:S.equipment)!=null?v:[]).length,officeHardware:((x=S==null?void 0:S.officeHardware)!=null?x:[]).length}});break}catch(w){if(P++,P>=E)Pi("❌ facade fetch failed after all retries; clearing state",String((b=w==null?void 0:w.message)!=null?b:w)),n({items:[],tools:[],supplies:[],equipment:[],officeHardware:[],error:String((C=w==null?void 0:w.message)!=null?C:w),isLoading:!1});else{Pi(`⚠️ Facade fetch attempt ${P} failed, retrying...`,String((k=w==null?void 0:w.message)!=null?k:w));const S=$*(P+1);yield new Promise(A=>setTimeout(A,S))}}}finally{wa=!1}}),clearError:()=>n({error:null}),inventoryData:[],suppliesData:[],equipmentData:[],officeHardwareData:[]}),{name:"centralized-inventory-store",partialize:n=>({tools:n.tools,supplies:n.supplies,equipment:n.equipment,officeHardware:n.officeHardware,items:n.items,data:n.data})})),YE=()=>{const n=Or(r=>r.refreshData),e=Or(r=>r.isLoading),t=Or(r=>r.data);return X.useEffect(()=>{if(!e&&!t&&!wa){const r=setTimeout(()=>{n()},0);return()=>clearTimeout(r)}},[n,e,t]),{refreshData:n,isLoading:e}};var Di=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const JE=()=>{const{getCycleStats:n,biTestResults:e,nextBITestDue:t,activityLog:r,availableTools:s,loadBITestResults:i,loadBIFailureIncidents:l}=ne(),{tools:c}=Or(),[o,d]=h.useState([]),[u,m]=h.useState([]),[p,f]=h.useState(!1),[g,y]=h.useState(null),[v,x]=h.useState(!1),b=!c||c.length===0,C=h.useCallback(()=>Di(null,null,function*(){try{console.log("🔄 Manually refreshing BI results...");const S="550e8400-e29b-41d4-a716-446655440000";yield i(S),yield l(S),console.log("✅ BI results refreshed successfully")}catch(S){console.error("❌ Failed to refresh BI results:",S)}}),[i,l]);h.useEffect(()=>{const S=()=>Di(null,null,function*(){try{const M="550e8400-e29b-41d4-a716-446655440000";yield i(M),yield l(M)}catch(M){console.error("Failed to load BI activities:",M)}});S();const A=new Date,I=new Date(A);I.setDate(I.getDate()+1),I.setHours(0,0,0,0);const T=I.getTime()-A.getTime(),j=setTimeout(()=>{S(),setInterval(S,1440*60*1e3)},T);return()=>clearTimeout(j)},[i,l]);const k=h.useMemo(()=>{const S=c.length;if(b)return{totalTools:S,activeTools:0,completedToday:0};const A=s.filter(j=>j.currentPhase&&j.currentPhase!=="complete"&&j.currentPhase!=="failed").length,I=new Date,T=s.filter(j=>{if(!j.endTime)return!1;const B=new Date(j.endTime).toDateString()===I.toDateString(),G=j.currentPhase==="complete";return B&&G}).length;return{totalTools:S,activeTools:A,completedToday:T}},[s,c,b]),P=h.useMemo(()=>(console.log("🔍 recentBITests filter:",{isLoading:b,biTestResultsLength:(e==null?void 0:e.length)||0,biTestResults:(e==null?void 0:e.length)>0?e.slice(0,3).map(S=>({status:S.status,date:S.date,passed:S.passed,id:S.id})):"none"}),b||!e||e.length===0?[]:e.filter(S=>{const A=new Date;return A.setDate(A.getDate()-7),new Date(S.date)>=A}).sort((S,A)=>new Date(A.date).getTime()-new Date(S.date).getTime()).slice(0,5)),[e,b]),E=h.useMemo(()=>b||!r||r.length===0?[]:r.map(S=>{var A;const I=XE(S.time);return{id:S.id,type:S.type,title:S.title,description:(A=S.data)==null?void 0:A.description,time:I,toolCount:S.toolCount,color:S.color,operatorId:S.operatorId,metadata:S.metadata}}),[r,b]),$=h.useCallback(()=>Di(null,null,function*(){d([]),m([]),f(!1),x(!0),y(null)}),[]);return h.useEffect(()=>{!b&&s&&e&&r&&!v&&setTimeout(()=>{$().catch(S=>{console.warn("AI insights generation failed (non-blocking):",S)})},0)},[b,s,e,r,$,v]),b?{stats:{totalCycles:0,completedCycles:0,averageCycleTime:0,biPassRate:100,efficiencyScore:{score:0,trend:null},cycleTrend:null,biPassRateTrend:null},additionalMetrics:k,recentBITests:P,nextBITestDue:null,recentActivities:E,aiInsights:[],aiForecasts:[],isAiLoading:!1,aiError:null,generateAIInsights:$,isLoading:!0}:{stats:n(),additionalMetrics:k,recentBITests:P,nextBITestDue:t,refreshBIResults:C,recentActivities:E,aiInsights:o,aiForecasts:u,isAiLoading:p,aiError:g,generateAIInsights:$,isLoading:!1}};function XE(n){const t=new Date().getTime()-new Date(n).getTime(),r=Math.floor(t/6e4);if(r<1)return"just now";if(r<60)return`${r} minute${r===1?"":"s"} ago`;const s=Math.floor(r/60);if(s<24)return`${s} hour${s===1?"":"s"} ago`;const i=Math.floor(s/24);return`${i} day${i===1?"":"s"} ago`}var Ai=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ZE{static scanToolForCleanWorkflow(e,t){return Ai(this,null,function*(){try{let r;try{if(r=yield At.getToolByBarcodeAndStatus(e,"clean"),!r)return{success:!1,message:`Tool with barcode "${e}" not found or not available for sterilization.`}}catch(o){return{success:!1,message:`Tool with barcode "${e}" not found or not available for sterilization.`}}if(r.current_cycle_id&&!r.id.startsWith("mock-tool-")){const{data:o}=yield _.from("sterilization_cycles").select("status").eq("id",r.current_cycle_id).single();if((o==null?void 0:o.status)!=="completed")return{success:!1,message:`Tool "${r.tool_name}" is not ready for clean workflow. Current cycle status: ${(o==null?void 0:o.status)||"unknown"}`}}const s=yield At.updateToolStatus(r.id,"dirty");yield At.clearCycleAssignment([r.id],"dirty"),yield At.markAsSterilized(r.id);const i={user_id:t,facility_id:r.facility_id,module:"sterilization",action:"tool_scanned_clean_workflow",table_name:"sterilization_tools",record_id:r.id,old_values:{status:"available",current_cycle_id:r.current_cycle_id},new_values:{status:"in_cycle",current_cycle_id:null},metadata:{barcode:e,workflow:"clean",previous_phase:"complete",new_phase:"dirty"}};yield _.from("audit_logs").insert(i);const l=s,c={id:l.id,name:l.tool_name,barcode:l.barcode,category:l.category||"general",type:l.tool_type,currentPhase:"failed",status:l.status,location:l.location,cycleCount:l.sterilization_count||0,lastSterilized:l.last_sterilized,notes:l.notes,is_p2_tool:l.is_p2_tool};return{success:!0,message:`Successfully scanned tool "${l.tool_name}" and marked as dirty. Ready for sterilization.`,tool:c}}catch(r){return console.error("Error scanning tool for clean workflow:",r),{success:!1,message:"An unexpected error occurred while scanning the tool."}}})}static scanToolForProblemWorkflow(e,t,r,s){return Ai(this,null,function*(){try{const{data:i,error:l}=yield _.from("tools").select("*").eq("barcode",e).single();if(l||!i)return{success:!1,message:`Tool with barcode "${e}" not found in system.`};const c=i;let o=null;if(c.current_cycle_id){const{data:g}=yield _.from("sterilization_cycles").select("*").eq("id",c.current_cycle_id).single();o=g}const d=yield At.updateToolStatus(c.id,"problem");yield At.clearCycleAssignment([c.id],"problem");const{error:u}=yield _.from("tools").update({updated_at:new Date().toISOString(),notes:`PROBLEM: ${t} - ${r}`}).eq("id",c.id);if(u)return console.error("Failed to update tool status:",u),{success:!1,message:"Failed to update tool status. Please try again."};const m={user_id:s,facility_id:c.facility_id,module:"sterilization",action:"tool_scanned_problem_workflow",table_name:"sterilization_tools",record_id:c.id,old_values:{status:c.status,current_cycle_id:c.current_cycle_id,sterilization_count:c.sterilization_count,last_sterilized:c.last_sterilized},new_values:{status:"quarantine",current_cycle_id:null,notes:`PROBLEM: ${t} - ${r}`},metadata:{barcode:e,workflow:"problem",problem_type:t,problem_notes:r,previous_phase:"clean_workflow_scan",new_phase:"quarantine",last_cycle_id:c.current_cycle_id,last_cycle_status:o==null?void 0:o.status,last_cycle_completed:o==null?void 0:o.completed_at,sterilization_count_at_problem:c.sterilization_count,process_improvement_flag:!0,inspection_quality_issue:t.includes("damage")||t.includes("inspection"),cleaning_quality_issue:t.includes("cleaning")||t.includes("contamination")}};yield _.from("audit_logs").insert(m);const p=d,f={id:p.id,name:p.tool_name,barcode:p.barcode,category:p.category||"general",type:p.tool_type,currentPhase:"quarantine",status:p.status,location:p.location,cycleCount:p.sterilization_count||0,lastSterilized:p.last_sterilized,notes:p.notes,is_p2_tool:p.is_p2_tool};return{success:!0,message:`Tool "${p.tool_name}" marked as problem (${t}). Process improvement data collected.`,tool:f}}catch(i){return console.error("Error scanning tool for problem workflow:",i),{success:!1,message:"An unexpected error occurred while processing the problem tool."}}})}static getAvailableTools(e){return Ai(this,null,function*(){try{return(yield At.getToolsByFacilityAndStatus(e,"clean")).sort((s,i)=>(s.name||"").localeCompare(i.name||"")).map(s=>{const i=s;return{id:i.id,name:i.tool_name,barcode:i.barcode,category:i.category||"general",type:i.tool_type,currentPhase:i.current_cycle_id?"complete":"available",status:i.status,location:i.location,cycleCount:i.sterilization_count||0,lastSterilized:i.last_sterilized,notes:i.notes}})}catch(t){return console.error("Error fetching available tools:",t),[]}})}}var hu=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const eT=()=>{const{currentUser:n}=Mr(),{getCurrentFacilityId:e,isLoading:t}=Ph(),{availableTools:r,setAvailableTools:s,loadCycles:i}=ne(),[l,c]=h.useState(!1),[o,d]=h.useState(!1),[u,m]=h.useState(null);return h.useEffect(()=>{hu(null,null,function*(){if(!(l||t)){if(!n){console.log("⏳ Waiting for user authentication...");return}try{d(!0),m(null);const f=e();if(!f)throw new Error("User facility not found");const g=yield ZE.getAvailableTools(f);s(g),yield i(f),c(!0)}catch(f){console.error("Failed to initialize sterilization store:",f),m(f instanceof Error?f.message:"Unknown error")}finally{d(!1)}}})},[n,l,s,i,e,t]),h.useEffect(()=>{if(l)return;hu(null,null,function*(){try{m(null);const f=e();if(!f){console.log("⚠️ No facility ID available, skipping sterilization initialization");return}yield i(f),c(!0),console.log("✅ Sterilization analytics initialized successfully")}catch(f){console.error("Failed to initialize sterilization analytics:",f),m(f instanceof Error?f.message:"Unknown error")}})},[l,i,e]),{isInitialized:l,isLoading:o,error:u,hasData:r.length>0}},tT=h.lazy(()=>L(()=>import("./RecentActivity-DqTdtKMX.js"),__vite__mapDeps([22,2,3,6,1,4,5])).then(n=>({default:n.RecentActivity}))),rT=h.lazy(()=>L(()=>import("./BITestResults-DPyUKF8L.js"),__vite__mapDeps([23,2,3,6,1,4,5])).then(n=>({default:n.BITestResults}))),nT=h.lazy(()=>L(()=>import("./ToolStatus-C_Mut_7j.js"),__vite__mapDeps([24,2,3,6,1,4,5])).then(n=>({default:n.ToolStatus}))),Oi=()=>a.jsxs("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-32 bg-gray-200 rounded-lg mb-4"}),a.jsx("div",{className:"h-24 bg-gray-200 rounded-lg"})]}),sT=()=>{var n,e;const[t,r]=h.useState(!0),{isLoading:s,error:i}=eT(),{stats:l,additionalMetrics:c,recentBITests:o,nextBITestDue:d,recentActivities:u,refreshBIResults:m}=JE();return h.useEffect(()=>{const p=setTimeout(()=>{r(!0)},100);return()=>clearTimeout(p)},[]),s||!t?a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:bn,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),a.jsx("div",{className:"text-sm text-gray-500",children:i?"Error loading data":"Loading..."})]}),i&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm",children:i}),a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((p,f)=>a.jsx("div",{className:"h-24 bg-gray-200 rounded"},f))}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[...Array(3)].map((p,f)=>a.jsx("div",{className:"h-32 bg-gray-200 rounded"},f))})]})]}):a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:bn,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]}),a.jsx(LE,{score:((n=l.efficiencyScore)==null?void 0:n.score)||0,trend:(e=l.efficiencyScore)==null?void 0:e.trend}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[a.jsx(aa,{title:"Total Cycles",value:l.totalCycles,icon:Tg,iconBgColor:"bg-blue-500",gradientFrom:"blue-50",gradientTo:"blue-100",borderColor:"blue-200",textColor:"text-blue-600",valueColor:"text-blue-800",trend:l.cycleTrend}),a.jsx(aa,{title:"Completed Cycles",value:l.completedCycles,icon:jn,iconBgColor:"bg-green-500",gradientFrom:"green-50",gradientTo:"green-100",borderColor:"green-200",textColor:"text-green-600",valueColor:"text-green-800",trend:l.cycleTrend}),a.jsx(aa,{title:"Tool Turnaround Time",value:`${Math.round(l.averageCycleTime)} min`,icon:xh,iconBgColor:"bg-purple-500",gradientFrom:"purple-50",gradientTo:"purple-100",borderColor:"purple-200",textColor:"text-purple-600",valueColor:"text-purple-800",trend:{direction:"down",value:"Target: <60 min"}}),a.jsx(aa,{title:"BI Pass Rate",value:`${Math.round(l.biPassRate)}%`,icon:Sa,iconBgColor:"bg-orange-500",gradientFrom:"orange-50",gradientTo:"orange-100",borderColor:"orange-200",textColor:"text-orange-600",valueColor:"text-orange-800",trend:l.biPassRateTrend})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx(h.Suspense,{fallback:a.jsx(Oi,{}),children:a.jsx(tT,{activities:u})}),a.jsx(h.Suspense,{fallback:a.jsx(Oi,{}),children:a.jsx(rT,{recentTests:o,nextTestDue:d,refreshBIResults:m})}),a.jsx(h.Suspense,{fallback:a.jsx(Oi,{}),children:a.jsx(nT,{totalTools:c.totalTools,activeTools:c.activeTools,completedToday:c.completedToday})})]})]})},aT=({quarantineData:n})=>a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(N,{path:xs,size:1,className:"text-gray-600"}),a.jsx("h3",{className:"font-medium text-gray-800",children:"Quarantine Summary"})]}),n.lastPassedDate&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(N,{path:Lt,size:.8,className:"text-blue-600"}),a.jsx("h4",{className:"font-medium text-blue-800 text-sm",children:"Last Successful BI Test"})]}),a.jsxs("p",{className:"text-xs text-blue-700",children:[a.jsx("strong",{children:"Date:"})," ",n.lastPassedDate.toLocaleDateString()," at"," ",n.lastPassedDate.toLocaleTimeString()]})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[a.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[a.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.totalToolsAffected}),a.jsx("div",{className:"text-gray-600",children:"Tools Affected"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[a.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.totalCyclesAffected}),a.jsx("div",{className:"text-gray-600",children:"Cycles Affected"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[a.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n.uniqueOperators.length}),a.jsx("div",{className:"text-gray-600",children:"Operators Involved"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.hasCurrentCycleAffected?"Yes":"No"}),a.jsx("div",{className:"text-gray-600",children:"Current Cycle Affected"})]})]}),n.dateRange&&a.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(N,{path:bh,size:.8,className:"text-yellow-600"}),a.jsx("h4",{className:"font-medium text-yellow-800 text-sm",children:"Affected Date Range"})]}),a.jsxs("p",{className:"text-xs text-yellow-700",children:[a.jsx("strong",{children:"From:"})," ",n.dateRange.start.toLocaleDateString()," ",a.jsx("strong",{children:"To:"})," ",n.dateRange.end.toLocaleDateString()]})]}),Object.keys(n.toolsByCategory).length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[a.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Tools by Category:"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:Object.entries(n.toolsByCategory).map(([e,t])=>a.jsxs("div",{className:"flex justify-between items-center bg-gray-50 px-2 py-1 rounded",children:[a.jsx("span",{className:"text-gray-600",children:e}),a.jsx("span",{className:"font-semibold text-gray-800",children:t})]},e))})]})]}),iT=({affectedCycles:n})=>n.length===0?null:a.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[a.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Cycles:"}),a.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:a.jsxs("div",{className:"space-y-2 text-xs",children:[n.slice(0,5).map((e,t)=>a.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium text-gray-800",children:e.cycleNumber||`Cycle ${t+1}`}),a.jsxs("div",{className:"text-gray-500",children:[new Date(e.startTime).toLocaleDateString()," -"," ",e.operator]})]}),a.jsxs("div",{className:"text-right text-xs text-gray-500",children:[a.jsxs("div",{children:[e.tools.length," tools"]}),a.jsxs("div",{children:[e.phases.length," phases"]})]})]})},e.id)),n.length>5&&a.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",n.length-5," more cycles affected"]})]})})]});var ps=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function os(){return ps(this,null,function*(){const{data:{user:n}}=yield _.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:e,error:t}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(t||!e)throw new Error("Failed to get user facility");return e.facility_id})}class oT{static getBatchInfoForTool(e){return ps(this,null,function*(){try{const{data:t,error:r}=yield _.from("sterilization_batches").select("*").eq("id",e).order("created_at",{ascending:!1}).limit(1).single();if(r||!t)return null;const s=t;let i;if(s.cycle_id){const d=yield os(),{data:u,error:m}=yield _.from("sterilization_cycles").select("cycle_name").eq("id",s.cycle_id).eq("facility_id",d).single();!m&&u&&(i=u.cycle_name)}const{data:l,error:c}=yield _.from("users").select("name").eq("id",s.requested_by).single(),o=c?"Unknown":(l==null?void 0:l.full_name)||"Unknown";return{batchId:s.id,batchName:s.batch_name,cycleId:s.cycle_id,cycleName:i,status:s.status,totalItems:s.total_items,createdBy:o,createdAt:new Date(s.created_at),completedAt:s.completed_at?new Date(s.completed_at):void 0}}catch(t){return console.error("Error getting batch info for tool:",t),null}})}static getBatchInfoForTools(e){return ps(this,null,function*(){try{if(e.length===0)return[];const{data:t,error:r}=yield _.from("sterilization_batches").select("*").in("id",e).order("created_at",{ascending:!1});if(r||!t)return[];const s=yield os(),{data:i,error:l}=yield _.from("tools").select("id, tool_name, barcode, last_sterilized, sterilization_count").in("id",e).eq("facility_id",s);if(l||!i)return[];const c=new Map(i.map(m=>[m.id,{name:m.tool_name,barcode:m.barcode,lastSterilized:m.last_sterilized,cycleCount:m.sterilization_count}])),o=t,d=Array.from(new Set(o.map(m=>m.cycle_id).filter(Boolean))),u=new Map;if(d.length>0){const m=yield os(),{data:p,error:f}=yield _.from("sterilization_cycles").select("id, cycle_name").in("id",d).eq("facility_id",m);!f&&p&&p.forEach(g=>{u.set(g.id,g.cycle_name)})}return o.map(m=>{const p=c.get(m.id);return{toolId:m.id,toolName:(p==null?void 0:p.name)||"Unknown Tool",barcode:(p==null?void 0:p.barcode)||"Unknown",batchId:m.id,batchName:m.batch_name,cycleId:m.cycle_id,cycleName:m.cycle_id?u.get(m.cycle_id):void 0,status:m.status,lastSterilized:p!=null&&p.lastSterilized?new Date(p.lastSterilized):void 0,cycleCount:(p==null?void 0:p.cycleCount)||0}})}catch(t){return console.error("Error getting batch info for tools:",t),[]}})}static getCurrentBatchFromCycle(e){return ps(this,null,function*(){try{const t=yield os(),{data:r,error:s}=yield _.from("tools").select("current_cycle_id, tool_name").eq("id",e).eq("facility_id",t).single(),i=r;if(s||!r||!i.current_cycle_id)return null;const{data:l,error:c}=yield _.from("sterilization_cycles").select("*").eq("id",i.current_cycle_id).eq("facility_id",t).single();if(c||!l)return null;const{data:o,error:d}=yield _.from("sterilization_batches").select("*").eq("cycle_id",i.current_cycle_id).single(),u=l;if(d||!o)return{batchId:`VIRTUAL-${i.current_cycle_id}`,batchName:`Cycle ${u.cycle_name||u.id}`,cycleId:i.current_cycle_id,cycleName:u.cycle_name,status:u.status,totalItems:1,createdBy:"System",createdAt:new Date(u.start_time),completedAt:u.end_time?new Date(u.end_time):void 0};const m=o,{data:p,error:f}=yield _.from("users").select("name").eq("id",m.requested_by).single(),g=p,y=f?"Unknown":(g==null?void 0:g.full_name)||"Unknown";return{batchId:m.id,batchName:m.batch_name,cycleId:m.cycle_id||void 0,cycleName:u.cycle_name,status:m.status,totalItems:m.total_items,createdBy:y,createdAt:new Date(m.created_at),completedAt:m.completed_at?new Date(m.completed_at):void 0}}catch(t){return console.error("Error getting current batch from cycle:",t),null}})}static generateBatchIdFromCycleData(e){try{if(e.cycleId)return`BATCH-${e.cycleId}`;if(e.lastSterilized){const t=new Date(e.lastSterilized);return`BATCH-${t.getFullYear()}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}-${e.id.slice(-4)}`}return e.currentCycleId?`BATCH-${e.currentCycleId}`:null}catch(t){return console.error("Failed to generate batch ID from cycle data:",t),null}}static getMostRecentBatchForTool(e){return ps(this,null,function*(){try{let t=yield this.getBatchInfoForTool(e);if(t||(t=yield this.getCurrentBatchFromCycle(e),t))return t;const r=yield os(),{data:s,error:i}=yield _.from("tools").select("tool_name, last_sterilized, sterilization_count").eq("id",e).eq("facility_id",r).single();if(i||!s)return null;const l=s;if(l.last_sterilized){const c=new Date(l.last_sterilized);return{batchId:`VIRTUAL-${e}`,batchName:`Last Sterilization - ${l.tool_name}`,status:"completed",totalItems:1,createdBy:"System",createdAt:c,completedAt:c}}return null}catch(t){return console.error("Error getting most recent batch for tool:",t),null}})}}var Ap=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const lT=n=>Ap(null,null,function*(){try{const e=yield oT.getMostRecentBatchForTool(n);return e||null}catch(e){return console.error("Failed to get batch info for tool:",e),null}}),cT=({affectedTools:n})=>{const{availableTools:e}=ne(),[t,r]=h.useState(new Map),[s,i]=h.useState(!1);h.useEffect(()=>{Ap(null,null,function*(){if(n.length!==0){i(!0);try{const o=new Map;for(const d of n){const u=yield lT(d.id);u&&o.set(d.id,u)}r(o)}catch(o){console.error("Failed to load batch info:",o)}finally{i(!1)}}})},[n]);const l=c=>{const o=e.find(d=>d.id===c);return o?{id:o.id,name:o.name,barcode:o.barcode,category:o.category,type:o.type||"Unknown",cycleCount:o.cycleCount||0,lastSterilized:o.lastSterilized,status:o.status,cycleId:o.cycleId}:{id:c,name:`Tool ${c}`,barcode:c,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:null,status:"unknown",cycleId:void 0}};return n.length===0?null:a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mt-4",children:[a.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Tool Details:"}),a.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200 max-h-32 overflow-hidden",children:a.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:a.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs",children:[n.slice(0,6).map((c,o)=>{const d=l(c.id),u=t.get(c.id),m=(u==null?void 0:u.batchName)||"Batch Info Pending",p=u==null?void 0:u.cycleName,f=u==null?void 0:u.status,g=[`Tool: ${d.name}`,`Barcode: ${d.barcode}`,`Category: ${d.category}`,`Type: ${d.type}`,`Cycle Count: ${d.cycleCount}`,`Status: ${d.status}`,`Batch: ${m}`,...p?[`Cycle: ${p}`]:[],...f?[`Batch Status: ${f}`]:[]].join(`
`);return a.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700 hover:bg-gray-200 transition-colors cursor-help",title:g,children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium text-gray-800",children:d.name}),a.jsxs("div",{className:"text-gray-500 text-xs",children:["#",d.barcode]}),a.jsx("div",{className:"text-orange-600 text-xs font-medium",children:s?"Loading Batch...":`Batch: ${m}`}),p&&a.jsxs("div",{className:"text-blue-600 text-xs",children:["Cycle: ",p]})]}),a.jsxs("div",{className:"text-right text-xs text-gray-500",children:[a.jsx("div",{children:d.category}),a.jsxs("div",{children:["Cycles: ",d.cycleCount]}),f&&a.jsx("div",{className:`text-xs ${f==="completed"?"text-green-600":f==="failed"?"text-red-600":f==="in_cycle"?"text-blue-600":"text-gray-600"}`,children:f})]})]})},o)}),n.length>6&&a.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",n.length-6," more tools affected"]})]})})})]}),a.jsx("div",{className:"mt-2 text-xs text-gray-600",children:a.jsxs("p",{children:[a.jsx("strong",{children:"Note:"})," Hover over tools for detailed information. All tools must be quarantined and re-sterilized."]})})]})},dT=({totalToolsAffected:n})=>a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Required Actions"}),a.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),a.jsxs("span",{children:["Quarantine all ",n," affected tools immediately"]})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),a.jsx("span",{children:"Re-sterilize all quarantined tools"})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),a.jsx("span",{children:"Perform a new BI test after re-sterilization"})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),a.jsx("span",{children:"Contact supervisor for incident documentation"})]})]})]}),uT=({operatorName:n,totalToolsAffected:e,totalCyclesAffected:t})=>a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(N,{path:bh,size:1,className:"text-gray-600"}),a.jsx("span",{className:"font-medium text-gray-700",children:"Operator Confirmation"})]}),a.jsxs("p",{className:"text-sm text-gray-600",children:[a.jsx("strong",{children:n}),", by confirming this BI test failure, you acknowledge that:"]}),a.jsxs("ul",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[a.jsxs("li",{children:["• All ",e," affected tools will be quarantined"]}),a.jsxs("li",{children:["• ",t," sterilization cycles are affected"]}),a.jsx("li",{children:"• A compliance incident report will be generated"}),a.jsx("li",{children:"• Re-sterilization procedures must be followed"})]})]}),mT=({onCancel:n})=>a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-red-50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:a.jsx(N,{path:ut,size:1.5,className:"text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-red-800",children:"BI Test Failure - Critical Alert"}),a.jsx("p",{className:"text-sm text-red-600",children:"Sterilization process failure detected"})]})]}),a.jsx("button",{onClick:n,className:"p-2 hover:bg-red-100 rounded-lg transition-colors",children:a.jsx(N,{path:pt,size:1,className:"text-red-600"})})]}),hT=()=>a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(N,{path:Le,size:1.2,className:"text-red-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-red-800 mb-2",children:"Immediate Action Required"}),a.jsx("p",{className:"text-sm text-red-700",children:"A Biological Indicator test failure indicates that the sterilization process may not have been effective. All tools processed since the last successful BI test must be quarantined and re-sterilized."})]})]})}),pT=({isOpen:n,onConfirm:e,onCancel:t,operatorName:r})=>{const s=jo();return n?js.createPortal(a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:t,onKeyDown:i=>{i.key==="Escape"&&t()},role:"button",tabIndex:0,"aria-label":"Close modal"}),a.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[a.jsx(mT,{onCancel:t}),a.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto bi-modal-scrollbar-hide",children:[a.jsx(hT,{}),a.jsx(aT,{quarantineData:s}),a.jsx(iT,{affectedCycles:s.affectedCycles}),a.jsx(cT,{affectedTools:s.affectedTools}),a.jsx(dT,{totalToolsAffected:s.totalToolsAffected}),a.jsx(uT,{operatorName:r,totalToolsAffected:s.totalToolsAffected,totalCyclesAffected:s.totalCyclesAffected})]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[a.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:e,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Confirm BI Test Failure"})]})]})]}),document.body):null},fT=({isVisible:n,onComplete:e,onOptOut:t,onDismiss:r})=>{const[s,i]=h.useState(!1),[l,c]=h.useState(null),{currentCycle:o,enforceBI:d}=ne(),u=jo();if(!n||!d)return null;const m=g=>{if(g==="fail"){c(g),i(!0);return}const y={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:g==="pass",date:new Date,status:g,operator:(o==null?void 0:o.operator)||"Operator"};g==="skip"&&t(),e(y)},p=()=>{if(i(!1),l){const g={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:!1,date:new Date,status:"fail",operator:(o==null?void 0:o.operator)||"Operator"},{activateBIFailure:y}=ne.getState(),v=u.totalToolsAffected,x=u.affectedCycles.map(b=>b.batchId).filter(b=>!!b);y({affectedToolsCount:v,affectedBatchIds:x,operator:(o==null?void 0:o.operator)||"Operator"}),e(g)}c(null)},f=()=>{i(!1),c(null)};return a.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 mb-4 rounded-r-lg shadow-sm",children:[a.jsx("div",{className:"flex items-start justify-between",children:a.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[a.jsx("div",{className:"p-2 bg-orange-100 rounded-lg flex-shrink-0",children:a.jsx(N,{path:Sa,size:1.2,className:"text-orange-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("h3",{className:"text-lg font-semibold text-orange-800",children:"Daily BI Test Required"}),a.jsxs("span",{className:"text-sm text-orange-600",children:["(",new Date().toLocaleDateString(),")"]})]}),a.jsx("p",{className:"text-orange-700 text-sm mb-3",children:"Please complete the daily Biological Indicator test to ensure sterilization compliance."}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:()=>m("pass"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-green-300 hover:border-green-500 bg-green-50 hover:bg-green-100 text-green-800 transition-colors",children:[a.jsx(N,{path:jn,size:1,className:"text-green-600"}),a.jsx("span",{className:"text-sm font-medium",children:"PASS"})]}),a.jsxs("button",{onClick:()=>m("fail"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-red-300 hover:border-red-500 bg-red-50 hover:bg-red-100 text-red-800 transition-colors",children:[a.jsx(N,{path:Le,size:1,className:"text-red-600"}),a.jsx("span",{className:"text-sm font-medium",children:"FAIL"})]}),a.jsxs("button",{onClick:()=>m("skip"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-gray-300 hover:border-gray-500 bg-gray-50 hover:bg-gray-100 text-gray-800 transition-colors",children:[a.jsx(N,{path:Sa,size:1,className:"text-gray-600"}),a.jsx("span",{className:"text-sm font-medium",children:"SKIP"})]})]})]})]})}),a.jsx(pT,{isOpen:s,onConfirm:p,onCancel:f,operatorName:(o==null?void 0:o.operator)||"Operator"})]})},gT=n=>{if(!n)return!0;const e=new Date().toDateString();return new Date(n).toDateString()!==e};class _r{static getTabs(){return[{id:"timers",label:"Phase Timers",icon:Sn},{id:"analytics",label:"Analytics",icon:bn},{id:"logs",label:"Cleaning Logs",icon:Ft}]}static getCycleProgressInfo(e){const t=e.phases.some(s=>s.status==="active"),r=e.phases.map(s=>({id:s.id,name:s.name,status:s.status,toolCount:s.tools.length,statusColor:this.getPhaseStatusColor(s.status)}));return{hasActivePhase:t,phaseStatuses:r}}static getPhaseStatusColor(e){switch(e){case"completed":return"bg-green-500";case"active":return"bg-blue-500";case"failed":return"bg-red-500";default:return"bg-gray-300"}}static validateOperatorName(e){return e.trim().length>0}static getTabButtonClasses(e){return e?"bg-[#4ECDC4] text-white shadow-md":"text-gray-600 hover:text-[#4ECDC4] hover:bg-gray-50"}static getStartCycleButtonState(e){const t=!this.validateOperatorName(e),r=this.validateOperatorName(e)?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-gray-300 text-gray-500 cursor-not-allowed";return{disabled:t,className:r}}static shouldShowNoCycleMessage(e){return!e}static shouldShowActiveCycleInfo(e){return e.phases.some(t=>t.status==="active")}}const yT=()=>{const{currentCycle:n}=ne();h.useRef(performance.now());const e=h.useMemo(()=>_r.getTabs(),[]),t=h.useMemo(()=>n?_r.getCycleProgressInfo(n):null,[n]),r=h.useCallback(o=>_r.validateOperatorName(o),[]),s=h.useCallback(o=>_r.getTabButtonClasses(o),[]),i=h.useCallback(o=>_r.getStartCycleButtonState(o),[]),l=h.useCallback(()=>_r.shouldShowNoCycleMessage(n),[n]),c=h.useCallback(()=>n?_r.shouldShowActiveCycleInfo(n):!1,[n]);return h.useMemo(()=>{},[]),{tabs:e,cycleProgressInfo:t,validateOperatorName:r,getTabButtonClasses:s,getStartCycleButtonState:i,shouldShowNoCycleMessage:l,shouldShowActiveCycleInfo:c}},vT=()=>{const[n,e]=h.useState("timers"),[t,r]=h.useState(!1),[s,i]=h.useState(""),l=h.useCallback(p=>{(p==="timers"||p==="analytics"||p==="logs")&&e(p)},[]),c=h.useCallback(p=>{i(p.target.value)},[]),o=h.useCallback(p=>{p.key},[]),d=h.useCallback(()=>{r(!1),i("")},[]),u=h.useCallback(()=>{r(!0)},[]),m=h.useCallback(()=>{i("")},[]);return{activeTab:n,showNewCycleModal:t,operatorName:s,handleTabChange:l,handleOperatorNameChange:c,handleOperatorNameKeyPress:o,handleCloseNewCycleModal:d,openNewCycleModal:u,resetOperatorName:m}},Op=h.memo(()=>a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Sterilization Management"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"Manage sterilization cycles, track tools, and monitor performance"})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow p-6 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsx("span",{className:"text-gray-600",children:"Tool Scanner"}),a.jsxs(dh,{to:"/sterilization/scanner",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center gap-2",children:[a.jsx(N,{path:wh,size:1}),"Scan Tool"]})]})]}));Op.displayName="DashboardHeader";var _T=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class nt{static fetchCleaningLogs(){return _T(this,null,function*(){try{const{data:e,error:t}=yield _.from("sterilization_cycles").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching sterilization cycles:",t),t;return(e||[]).map(s=>({id:s.id,room_id:s.id,room_name:`Cycle ${s.id.slice(0,8)}`,status:s.status||"in_progress",cleaning_type:"sterilization",scheduled_time:s.start_time,started_time:s.start_time,completed_time:s.end_time,operator_id:s.operator_id,notes:"",checklist_items:[],completed_items:[],failed_items:[],created_at:s.created_at,updated_at:s.updated_at}))}catch(e){return console.error("Failed to fetch sterilization cycles:",e),[]}})}static filterCleaningLogs(e,t){return e.filter(r=>{let s=!1;t.status==="all"?s=!0:t.status==="in_progress"?s=r.status==="pending"||r.status==="in_progress":s=r.status===t.status;const i=!t.date||new Date(r.created_at).toDateString()===new Date(t.date).toDateString();return s&&i})}static calculateStats(e){return{totalCycles:e.length,completed:e.filter(t=>t.status==="completed").length,failed:e.filter(t=>t.status==="failed").length,totalTools:e.length}}static getStatusColor(e){switch(e){case"completed":return{color:"text-green-600 bg-green-100"};case"verified":return{color:"text-blue-600 bg-blue-100"};case"failed":return{color:"text-red-600 bg-red-100"};case"in_progress":return{color:"text-yellow-600 bg-yellow-100"};case"pending":return{color:"text-gray-600 bg-gray-100"};case"cancelled":return{color:"text-orange-600 bg-orange-100"};default:return{color:"text-gray-600 bg-gray-100"}}}static formatDuration(e,t){if(!t)return"In Progress";const r=new Date(e),i=new Date(t).getTime()-r.getTime(),l=Math.floor(i/(1e3*60)),c=Math.floor(l/60),o=l%60;return`${c}h ${o}m`}static getBITestResultsForCycle(e,t){return e.filter(r=>{const s=new Date(t);return new Date(r.date).toDateString()===s.toDateString()})}static getBITestResultColor(e){return e==="pass"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}static formatTestTime(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static getCleaningTypeDisplayName(e){switch(e){case"routine":return"Routine";case"deep_clean":return"Deep Clean";case"emergency":return"Emergency";case"post_procedure":return"Post Procedure";default:return e}}static getQualityScoreDisplay(e){return e?`${Math.round(e*100)}%`:"N/A"}static getComplianceScoreDisplay(e){return e?`${Math.round(e*100)}%`:"N/A"}static exportToCSV(e){if(!e||e.length===0){alert("No data to export");return}try{const t=["Cycle ID","Room Name","Status","Cleaning Type","Scheduled Time","Started Time","Completed Time","Operator ID","Notes","Created At","Updated At"],r=e.map(o=>[o.id,o.room_name,o.status,o.cleaning_type,o.scheduled_time||"",o.started_time||"",o.completed_time||"",o.operator_id||"",o.notes||"",o.created_at,o.updated_at]),s=[t.join(","),...r.map(o=>o.map(d=>`"${d}"`).join(","))].join(`
`),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),l=window.URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download=`cleaning_logs_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l)}catch(t){console.error("Failed to export cleaning logs:",t),alert("Failed to export data. Please try again.")}}}var xT=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const bT=({filterStatus:n,filterDate:e})=>{const{biTestResults:t}=ne(),[r,s]=h.useState([]),[i,l]=h.useState(!0),[c,o]=h.useState(null);h.useEffect(()=>{xT(null,null,function*(){try{l(!0),o(null);const P=yield nt.fetchCleaningLogs();s(P)}catch(P){console.error("Failed to fetch cleaning logs:",P),o("Failed to load cleaning logs")}finally{l(!1)}})},[]);const d=h.useMemo(()=>{const k={status:n,date:e};return nt.filterCleaningLogs(r,k)},[r,n,e]),u=h.useMemo(()=>nt.calculateStats(d),[d]);return{filteredLogs:d,stats:u,loading:i,error:c,getStatusColor:k=>nt.getStatusColor(k).color,formatDuration:(k,P)=>nt.formatDuration(k,P),getBITestResultsForCycle:k=>nt.getBITestResultsForCycle(t,k),getBITestResultColor:k=>nt.getBITestResultColor(k),formatTestTime:k=>nt.formatTestTime(k),getCleaningTypeDisplayName:k=>nt.getCleaningTypeDisplayName(k),getQualityScoreDisplay:k=>nt.getQualityScoreDisplay(k),getComplianceScoreDisplay:k=>nt.getComplianceScoreDisplay(k),exportLogs:()=>{nt.exportToCSV(d)}}},wT=()=>{const[n,e]=h.useState(null),[t,r]=h.useState("all"),[s,i]=h.useState(""),{filteredLogs:l,stats:c,loading:o,error:d,getStatusColor:u,formatDuration:m,getBITestResultsForCycle:p,getBITestResultColor:f,formatTestTime:g,getQualityScoreDisplay:y,getComplianceScoreDisplay:v,exportLogs:x}=bT({filterStatus:t,filterDate:s});return o?a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx(N,{path:vh,size:2,className:"animate-spin text-[#4ECDC4] mr-3"}),a.jsx("span",{className:"text-gray-600",children:"Loading cleaning logs..."})]})}):d?a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx(N,{path:Le,size:2,className:"text-red-500 mr-3"}),a.jsx("span",{className:"text-red-600",children:d})]})}):a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:Ft,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Cleaning Log Tracker"]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[a.jsx(N,{path:ph,size:1}),"Export"]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Filter"}),a.jsxs("select",{id:"status-filter",value:t,onChange:b=>r(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[a.jsx("option",{value:"all",children:"All Statuses"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"completed",children:"Completed"}),a.jsx("option",{value:"failed",children:"Failed"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Filter"}),a.jsx("input",{id:"date-filter",type:"date",value:s,onChange:b=>i(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{r("all"),i("")},className:"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear Filters"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[a.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-green-600",children:"Completed"}),a.jsx("p",{className:"text-2xl font-bold text-green-800",children:c.completed})]}),a.jsx(N,{path:jn,size:1.5,className:"text-green-500"})]})}),a.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-red-600",children:"Failed"}),a.jsx("p",{className:"text-2xl font-bold text-red-800",children:c.failed})]}),a.jsx(N,{path:Le,size:1.5,className:"text-red-500"})]})}),a.jsx("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Cycles"}),a.jsx("p",{className:"text-2xl font-bold text-purple-800",children:c.totalTools})]}),a.jsx(N,{path:kr,size:1.5,className:"text-purple-500"})]})})]}),a.jsx("div",{className:"space-y-4",children:l.length===0?a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No sterilization cycles found for the selected filters."}):l.map(b=>a.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:b.room_name}),a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u(b.status)}`,children:b.status.toUpperCase()}),a.jsx("span",{className:"text-sm text-gray-500",children:"Sterilization Cycle"})]}),a.jsxs("button",{onClick:()=>e(n===b.id?null:b.id),className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(N,{path:Ng,size:1}),n===b.id?"Hide":"View"," Details"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(N,{path:xn,size:1}),a.jsxs("span",{children:["Scheduled:"," ",new Date(b.scheduled_time).toLocaleDateString()]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(N,{path:xh,size:1}),a.jsxs("span",{children:["Duration:"," ",m(b.started_time||b.scheduled_time,b.completed_time)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(N,{path:Sh,size:1}),a.jsxs("span",{children:["Room ID: ",b.room_id]})]})]}),n===b.id&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Quality Metrics"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Quality Score:"}),a.jsx("span",{className:"font-medium",children:y(b.quality_score)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Compliance Score:"}),a.jsx("span",{className:"font-medium",children:v(b.compliance_score)})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Timeline"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Scheduled:"}),a.jsx("span",{children:new Date(b.scheduled_time).toLocaleString()})]}),b.started_time&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Started:"}),a.jsx("span",{children:new Date(b.started_time).toLocaleString()})]}),b.completed_time&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Completed:"}),a.jsx("span",{children:new Date(b.completed_time).toLocaleString()})]})]})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center gap-2",children:[a.jsx(N,{path:Sa,size:1}),"BI Test Results"]}),a.jsxs("div",{className:"space-y-2",children:[p(b.created_at).map((C,k)=>a.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${f(C.passed?"pass":"fail")}`,children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{children:C.passed?"PASS":"FAIL"}),a.jsx("span",{children:g(new Date(C.date))})]})},k)),p(b.created_at).length===0&&a.jsx("p",{className:"text-sm text-gray-500",children:"No BI tests for this date"})]})]})]})]},b.id))})]})};var ST=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function CT(n){return ST(this,null,function*(){var e;const{assignedLocation:t,toolsCount:r}=n;if(!t||t.trim()==="")return{status:"unassigned",confidence:1,reasoning:"No location assigned to batch"};if(r===0)return{status:"unassigned",confidence:1,reasoning:"No tools in batch to assign location"};try{const{data:{user:s}}=yield _.auth.getUser(),i=(e=s==null?void 0:s.user_metadata)==null?void 0:e.facility_id;if(!i)return{status:"invalid_location",confidence:.8,reasoning:"Cannot validate location without facility context"};const{data:l,error:c}=yield _.from("rooms").select("id, name").eq("facility_id",i).ilike("name",`%${t}%`).limit(1);return c||!l||l.length===0?{status:"invalid_location",confidence:.9,reasoning:`Location "${t}" not found in facility`}:{status:"valid",confidence:1,reasoning:`Location "${t}" validated successfully`}}catch(s){return console.error("Location validation failed:",s),{status:"invalid_location",confidence:.3,reasoning:"Location validation error occurred"}}})}var IT=Object.defineProperty,jT=Object.defineProperties,ET=Object.getOwnPropertyDescriptors,pu=Object.getOwnPropertySymbols,TT=Object.prototype.hasOwnProperty,NT=Object.prototype.propertyIsEnumerable,fu=(n,e,t)=>e in n?IT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ae=(n,e)=>{for(var t in e||(e={}))TT.call(e,t)&&fu(n,t,e[t]);if(pu)for(var t of pu(e))NT.call(e,t)&&fu(n,t,e[t]);return n},ce=(n,e)=>jT(n,ET(e)),kT=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Ro=Et((n,e)=>({timers:{},overexposed:!1,intervals:{},startTimer:(t,r,s)=>{const i=e().intervals[t];i&&clearInterval(i),n(c=>({timers:ce(ae({},c.timers),{[t]:{id:t,timeRemaining:s?s.timeRemaining:t==="drying"?0:r,elapsedTime:s?s.elapsedTime:0,duration:r,isRunning:!0,overexposed:!1}})}));const l=setInterval(()=>{const c=e().timers[t];if(c&&c.isRunning)if(t==="drying"){const o=c.elapsedTime+1;n(d=>({timers:ce(ae({},d.timers),{[t]:ce(ae({},c),{elapsedTime:o})})}))}else{const o=c.elapsedTime+1;if(c.timeRemaining>0){const d=c.timeRemaining-1;n(u=>({timers:ce(ae({},u.timers),{[t]:ce(ae({},c),{timeRemaining:d,elapsedTime:o,overexposed:!1})})}))}else{const d=t==="bath1"||t==="bath2",u=d?c.elapsedTime-c.duration:0;n(m=>({timers:ce(ae({},m.timers),{[t]:ce(ae({},c),{timeRemaining:0,elapsedTime:o,overexposed:d&&u>0})}),overexposed:d&&u>0||m.overexposed})),t==="autoclave"&&c.elapsedTime===c.duration&&e().triggerRoomAssignment()}}},1e3);n(c=>({intervals:ce(ae({},c.intervals),{[t]:l})}))},pauseTimer:t=>{const r=e().intervals[t];r&&(clearInterval(r),n(s=>{const i=ae({},s.intervals);return delete i[t],{intervals:i}})),n(s=>({timers:ce(ae({},s.timers),{[t]:s.timers[t]?ce(ae({},s.timers[t]),{isRunning:!1}):s.timers[t]})}))},resetTimer:t=>{const r=e().intervals[t];r&&(clearInterval(r),n(s=>{const i=ae({},s.intervals);return delete i[t],{intervals:i}})),n(s=>({timers:ce(ae({},s.timers),{[t]:s.timers[t]?ce(ae({},s.timers[t]),{timeRemaining:t==="drying"?0:s.timers[t].duration,elapsedTime:0,isRunning:!1,overexposed:!1}):s.timers[t]})}))},updateTimer:(t,r)=>{n(s=>({timers:ce(ae({},s.timers),{[t]:s.timers[t]?ce(ae({},s.timers[t]),{timeRemaining:r}):s.timers[t]})}))},getTimer:t=>e().timers[t],resumeTimer:t=>{const r=e().timers[t];if(!r)return;const s=e().intervals[t];s&&clearInterval(s),n(l=>({timers:ce(ae({},l.timers),{[t]:ce(ae({},r),{isRunning:!0})})}));const i=setInterval(()=>{const l=e().timers[t];if(l&&l.isRunning)if(t==="drying"){const c=l.elapsedTime+1;n(o=>({timers:ce(ae({},o.timers),{[t]:ce(ae({},l),{elapsedTime:c})})}))}else{const c=l.elapsedTime+1;if(l.timeRemaining>0){const o=l.timeRemaining-1;n(d=>({timers:ce(ae({},d.timers),{[t]:ce(ae({},l),{timeRemaining:o,elapsedTime:c,overexposed:!1})})}))}else{const o=t==="bath1"||t==="bath2",d=o?l.elapsedTime-l.duration:0;n(u=>({timers:ce(ae({},u.timers),{[t]:ce(ae({},l),{timeRemaining:0,elapsedTime:c,overexposed:o&&d>0})}),overexposed:o&&d>0||u.overexposed})),t==="autoclave"&&l.elapsedTime===l.duration&&e().triggerRoomAssignment()}}},1e3);n(l=>({intervals:ce(ae({},l.intervals),{[t]:i})}))},setOverexposed:t=>{n({overexposed:t})},triggerRoomAssignment:()=>{const t=document.createElement("div");t.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",t.innerHTML=`
      <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h2 class="text-lg font-semibold mb-4">Room Assignment Required</h2>
        <p class="text-sm text-gray-600 mb-4">Autoclave cycle completed. Please scan the location barcode where these tools will be stored.</p>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Location Barcode</label>
            <input 
              id="locationBarcode" 
              type="text" 
              placeholder="Scan or enter location barcode" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div class="flex space-x-3">
            <button 
              id="assignLocation" 
              class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              Assign Location
            </button>
            <button 
              id="skipLocation" 
              class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500"
            >
              Skip
            </button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(t);const r=t.querySelector("#assignLocation"),s=t.querySelector("#skipLocation"),i=t.querySelector("#locationBarcode"),l=()=>kT(null,null,function*(){const o=i.value.trim();if(!o){alert("Please enter a location barcode");return}try{const d=localStorage.getItem("currentBatchId");if(!d){alert("No active batch found");return}const u=yield CT({batchId:d,toolsCount:1,assignedLocation:o});if(u.status==="invalid_location"){alert(`Invalid location: ${u.reasoning}`);return}const{supabase:m}=yield L(()=>import("./login-CgiYf71G.js").then(p=>p.P),__vite__mapDeps([1,2,3,4,5]));yield m.from("sterilization_batches").update({location_barcode:o}).eq("id",d),yield m.from("inventory_items").update({scanned_location:o}).eq("batch_id",d),alert(`✅ Location ${o} assigned successfully`),document.body.removeChild(t)}catch(d){console.error("Error assigning location:",d),alert("Error assigning location. Please try again.")}}),c=()=>{document.body.removeChild(t)};r==null||r.addEventListener("click",l),s==null||s.addEventListener("click",c),setTimeout(()=>i==null?void 0:i.focus(),100)}})),PT={unwrapped:{name:"Unwrapped",temp:"132°C (270°F)",sterilizeTime:3,dryTime:30,totalTime:15,duration:900},pouches:{name:"Pouches",temp:"132°C (270°F)",sterilizeTime:5,dryTime:30,totalTime:17,duration:1020},packs:{name:"Packs",temp:"121°C (250°F)",sterilizeTime:30,dryTime:30,totalTime:40,duration:2400},handpieces:{name:"Handpieces",temp:"132°C (270°F)",sterilizeTime:6,dryTime:30,totalTime:16,duration:960}},DT=()=>"pouches";var AT=Object.defineProperty,OT=Object.defineProperties,RT=Object.getOwnPropertyDescriptors,gu=Object.getOwnPropertySymbols,$T=Object.prototype.hasOwnProperty,MT=Object.prototype.propertyIsEnumerable,yu=(n,e,t)=>e in n?AT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,vu=(n,e)=>{for(var t in e||(e={}))$T.call(e,t)&&yu(n,t,e[t]);if(gu)for(var t of gu(e))MT.call(e,t)&&yu(n,t,e[t]);return n},_u=(n,e)=>OT(n,RT(e));const FT=()=>{const{timers:n,startTimer:e,pauseTimer:t,resetTimer:r,resumeTimer:s}=Ro(),{currentCycle:i,setCurrentCycle:l}=ne(),c=h.useCallback((u,m)=>{e(u,m)},[e]),o=h.useCallback(u=>{const m=n[u];m!=null&&m.isRunning?t(u):m&&s(u)},[n,t,s]),d=h.useCallback(u=>{if(console.log("🛑 Cancelling timer for phase:",u),t(u),r(u),i){console.log("🛑 Clearing tools from cycle. Current tools:",i.tools);const m=_u(vu({},i),{tools:[],phases:i.phases.map(p=>_u(vu({},p),{tools:[],isActive:!1,status:"pending",startTime:null,endTime:null}))});l(m),console.log("✅ Cycle cleared, tools removed. Workflow can be restarted.")}},[t,r,i,l]);return{handleStartTimer:c,handlePauseTimer:o,handleStopTimer:d}};var LT=Object.defineProperty,zT=Object.defineProperties,BT=Object.getOwnPropertyDescriptors,xu=Object.getOwnPropertySymbols,qT=Object.prototype.hasOwnProperty,UT=Object.prototype.propertyIsEnumerable,bu=(n,e,t)=>e in n?LT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,HT=(n,e)=>{for(var t in e||(e={}))qT.call(e,t)&&bu(n,t,e[t]);if(xu)for(var t of xu(e))UT.call(e,t)&&bu(n,t,e[t]);return n},VT=(n,e)=>zT(n,BT(e));class WT{constructor(){this.events=[],this.MAX_EVENTS=1e4}recordEvent(e){const t=VT(HT({},e),{id:`analytics_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString()});this.events.push(t),this.events.length>this.MAX_EVENTS&&(this.events=this.events.slice(-this.MAX_EVENTS)),console.log("📊 Analytics Event:",t)}recordTrackStarted(e,t,r,s,i,l){this.recordEvent({eventType:"track_started",toolId:e,toolName:t,doctorName:r,priority:s,metadata:{queuePosition:i,totalInQueue:l}})}recordTrackStopped(e,t,r,s,i){this.recordEvent({eventType:"track_stopped",toolId:e,toolName:t,doctorName:r,priority:s,metadata:{waitTime:i}})}recordToolAvailable(e,t,r,s,i){this.recordEvent({eventType:"tool_available",toolId:e,toolName:t,doctorName:r,priority:s,metadata:{waitTime:i}})}recordToolClaimed(e,t,r,s,i){this.recordEvent({eventType:"tool_claimed",toolId:e,toolName:t,doctorName:r,priority:s,metadata:{waitTime:i}})}recordQueuePositionChanged(e,t,r,s,i,l,c){this.recordEvent({eventType:"queue_position_changed",toolId:e,toolName:t,doctorName:r,priority:s,metadata:{queuePosition:i,totalInQueue:c,previousPosition:l}})}getAnalyticsSummary(e){let t=this.events;e&&(t=this.events.filter(f=>{const g=new Date(f.timestamp);return g>=e.start&&g<=e.end}));const r=t.length,s=new Set(t.map(f=>f.toolId)).size,i=new Set(t.map(f=>f.doctorName)).size,l=t.filter(f=>{var g;return(g=f.metadata)==null?void 0:g.waitTime}),c=l.length>0?l.reduce((f,g)=>{var y;return f+(((y=g.metadata)==null?void 0:y.waitTime)||0)},0)/l.length:0,o=new Map;t.forEach(f=>{if(f.eventType==="track_started"){const g=o.get(f.toolId)||{toolName:f.toolName,count:0};g.count++,o.set(f.toolId,g)}});const d=Array.from(o.entries()).map(([f,g])=>({toolId:f,toolName:g.toolName,trackingCount:g.count})).sort((f,g)=>g.trackingCount-f.trackingCount).slice(0,10),u={high:t.filter(f=>f.priority==="high").length,medium:t.filter(f=>f.priority==="medium").length,low:t.filter(f=>f.priority==="low").length},m=Array.from({length:24},(f,g)=>({hour:g,count:t.filter(y=>new Date(y.timestamp).getHours()===g).length})),p=Array.from({length:30},(f,g)=>{const y=new Date;y.setDate(y.getDate()-g);const v=y.toISOString().split("T")[0];return{date:v,count:t.filter(x=>x.timestamp.split("T")[0]===v).length}}).reverse();return{totalTrackingEvents:r,uniqueToolsTracked:s,uniqueUsersTracking:i,averageQueueWaitTime:c,mostTrackedTools:d,trackingByPriority:u,trackingByHour:m,trackingByDay:p}}getToolAnalytics(e){return this.events.filter(t=>t.toolId===e)}getUserAnalytics(e){return this.events.filter(t=>t.doctorName===e)}clearOldEvents(e=30){const t=new Date;t.setDate(t.getDate()-e),this.events=this.events.filter(r=>new Date(r.timestamp)>t)}}const Ri=new WT;class GT{constructor(){this.statusCallbacks=[],this.toolStatuses=new Map,this.monitoringInterval=null,this.MONITORING_INTERVAL=3e4}startMonitoring(){this.monitoringInterval||(console.log("🔄 Starting real-time tool status monitoring..."),this.monitoringInterval=setInterval(()=>{this.checkToolStatuses()},this.MONITORING_INTERVAL))}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null,console.log("⏹️ Stopped real-time tool status monitoring"))}subscribe(e){return this.statusCallbacks.push(e),()=>{const t=this.statusCallbacks.indexOf(e);t>-1&&this.statusCallbacks.splice(t,1)}}checkToolStatuses(){const e=Array.from(this.toolStatuses.keys());if(e.length===0){[{id:"demo-tool-1",name:"Surgical Scissors",status:"available"},{id:"demo-tool-2",name:"Forceps",status:"in_use"},{id:"demo-tool-3",name:"Scalpel",status:"unavailable"}].forEach(r=>{this.toolStatuses.set(r.id,r.status)});return}e.forEach(t=>{if(Math.random()<.05){const r=this.toolStatuses.get(t),s=this.getRandomStatus(r);s!==r&&this.handleStatusChange(t,r,s)}})}getRandomStatus(e){const r=["available","unavailable","in_use","maintenance"].filter(s=>s!==e);return r[Math.floor(Math.random()*r.length)]}handleStatusChange(e,t,r){this.toolStatuses.set(e,r);const s={toolId:e,toolName:`Tool ${e.slice(0,8)}...`,oldStatus:t,newStatus:r,timestamp:new Date().toISOString(),reason:this.getStatusChangeReason(t,r)};(t==="unavailable"||r==="unavailable"||t==="maintenance"||r==="maintenance")&&console.log("📊 Tool status changed:",s),this.statusCallbacks.forEach(i=>{try{i(s)}catch(l){console.error("Error in status change callback:",l)}})}getStatusChangeReason(e,t){var r;return((r={available:{in_use:"Tool was checked out",unavailable:"Tool was removed from inventory",maintenance:"Tool sent for maintenance"},in_use:{available:"Tool was returned",unavailable:"Tool was damaged during use",maintenance:"Tool requires maintenance after use"},unavailable:{available:"Tool was repaired and returned",in_use:"Tool was checked out despite being unavailable",maintenance:"Tool sent for repair"},maintenance:{available:"Maintenance completed successfully",unavailable:"Tool requires replacement after maintenance",in_use:"Tool checked out after maintenance"}}[e])==null?void 0:r[t])||"Status changed"}triggerStatusChange(e,t,r){const s=this.toolStatuses.get(e)||"available",i={toolId:e,toolName:r||`Tool ${e.slice(0,8)}...`,oldStatus:s,newStatus:t,timestamp:new Date().toISOString(),reason:this.getStatusChangeReason(s,t)};this.toolStatuses.set(e,t),this.statusCallbacks.forEach(l=>{try{l(i)}catch(c){console.error("Error in status change callback:",c)}})}getToolStatus(e){return this.toolStatuses.get(e)}getAllToolStatuses(){return new Map(this.toolStatuses)}isMonitoring(){return this.monitoringInterval!==null}}const Rp=new GT,KT=Object.freeze(Object.defineProperty({__proto__:null,realTimeStatusMonitor:Rp},Symbol.toStringTag,{value:"Module"}));var ia=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class QT{constructor(){this.SYNC_INTERVAL=3e4,this.syncInterval=null,this.pendingSyncs=new Map}startAutoSync(){this.syncInterval||(console.log("🔄 Starting automatic database synchronization..."),this.syncInterval=setInterval(()=>{this.syncAllPendingChanges()},this.SYNC_INTERVAL))}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null,console.log("⏹️ Stopped automatic database synchronization"))}queueSync(e){const t=`${e.toolId}-${e.doctorName}`;this.pendingSyncs.set(t,e),console.log("📝 Queued sync for:",{toolId:e.toolId,doctorName:e.doctorName,priority:e.priority,status:e.status})}syncAllPendingChanges(){return ia(this,null,function*(){if(this.pendingSyncs.size===0)return{success:!0,syncedCount:0};console.log(`🔄 Syncing ${this.pendingSyncs.size} pending changes...`);try{const e=yield this.performDatabaseSync(Array.from(this.pendingSyncs.values()));return e.success?(this.pendingSyncs.clear(),console.log(`✅ Successfully synced ${e.syncedCount} changes`)):console.error("❌ Database sync failed:",e.error),e}catch(e){return console.error("❌ Database sync error:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}})}performDatabaseSync(e){return ia(this,null,function*(){yield new Promise(r=>setTimeout(r,1e3));const t=Math.random()>.1;return{success:t,syncedCount:e.length,error:t?void 0:"Simulated database error"}})}syncImmediate(e){return ia(this,null,function*(){try{const t=yield this.performDatabaseSync([e]);if(t.success){const r=`${e.toolId}-${e.doctorName}`;this.pendingSyncs.delete(r)}return t}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}})}getPendingSyncCount(){return this.pendingSyncs.size}getPendingSyncs(){return Array.from(this.pendingSyncs.values())}clearPendingSyncs(){this.pendingSyncs.clear(),console.log("🗑️ Cleared all pending syncs")}isAutoSyncRunning(){return this.syncInterval!==null}forceSync(){return ia(this,null,function*(){return console.log("🔄 Force syncing all pending changes..."),yield this.syncAllPendingChanges()})}}const $i=new QT;var YT=Object.defineProperty,JT=Object.defineProperties,XT=Object.getOwnPropertyDescriptors,wu=Object.getOwnPropertySymbols,ZT=Object.prototype.hasOwnProperty,eN=Object.prototype.propertyIsEnumerable,Su=(n,e,t)=>e in n?YT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,tN=(n,e)=>{for(var t in e||(e={}))ZT.call(e,t)&&Su(n,t,e[t]);if(wu)for(var t of wu(e))eN.call(e,t)&&Su(n,t,e[t]);return n},rN=(n,e)=>JT(n,XT(e));class nN{constructor(){this.notifications=[],this.priorityQueue=[],this.statusChangeCallbacks=[],Rp.subscribe(this.handleToolStatusChange.bind(this)),$i.startAutoSync()}trackTool(e,t,r="medium",s){const i=this.priorityQueue.findIndex(d=>d.toolId===e&&d.doctorName===t);i>=0?this.priorityQueue[i]=rN(tN({},this.priorityQueue[i]),{timestamp:new Date().toISOString(),priority:r,status:"waiting"}):this.priorityQueue.push({toolId:e,doctorName:t,timestamp:new Date().toISOString(),priority:r,status:"waiting"}),this.syncWithDatabase(e,!0);const l=this.getToolTrackers(e).length,c=this.getQueuePosition(e,t);console.log("🔔 Tool tracked:",{toolId:e,totalInQueue:l,queuePosition:c,doctorName:t});const o=s||`Tool ${e}`;Pr.notifyToolAvailable(e,o,c,l,r),Ri.recordTrackStarted(e,o,t,r,c,l)}untrackTool(e,t){const r=this.priorityQueue.findIndex(s=>s.toolId===e&&s.doctorName===t);if(r>=0){const s=this.getToolTrackers(e),i=this.priorityQueue[r];this.priorityQueue.splice(r,1),this.notifyQueuePositionChanges(e,s,i.doctorName);const l=this.priorityQueue.some(c=>c.toolId===e);this.syncWithDatabase(e,l),Ri.recordTrackStopped(e,`Tool ${e}`,t,i.priority)}}notifyQueuePositionChanges(e,t,r){const s=this.getToolTrackers(e);t.forEach((i,l)=>{i.doctorName!==r&&s.findIndex(c=>c.doctorName===i.doctorName)})}isToolTracked(e){return this.priorityQueue.some(t=>t.toolId===e)}getToolTrackers(e){return this.priorityQueue.filter(t=>t.toolId===e).sort((t,r)=>{const s={high:3,medium:2,low:1},i=s[r.priority]-s[t.priority];return i!==0?i:new Date(t.timestamp).getTime()-new Date(r.timestamp).getTime()})}monitorToolStatusChange(e,t,r){(r==="available"||r==="complete")&&this.handleToolBecameAvailable(e),t==="available"&&(r==="in_use"||r==="sterilizing")&&this.handleToolBecameUnavailable(e,`Tool ${e}`),this.statusChangeCallbacks.forEach(s=>s(e,t,r))}handleToolBecameAvailable(e){const t=this.getToolTrackers(e);if(t.length===0)return;const r={high:3,medium:2,low:1},s=[...t].sort((c,o)=>r[o.priority]-r[c.priority]),i=s[0];if(i&&i.status==="waiting"){const c=`Tool ${e}`;Pr.notifyToolAvailable(e,c,1,t.length);const o={id:`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,toolId:e,toolName:c,doctorName:i.doctorName,timestamp:new Date().toISOString(),status:"pending",priority:i.priority,message:"Your tracked tool is now available! You have first priority to claim it."};this.notifications.push(o),i.status="notified"}s.map(c=>c.doctorName===i.doctorName?i:c).forEach(c=>{const o=this.priorityQueue.findIndex(d=>d.toolId===e&&d.doctorName===c.doctorName);o>=0&&(this.priorityQueue[o]=c)})}acknowledgeNotification(e){const t=this.notifications.find(r=>r.id===e);if(t){t.status="acknowledged";const r=this.priorityQueue.find(s=>s.toolId===t.toolId&&s.doctorName===t.doctorName);r&&(r.status="claimed")}}getPendingNotifications(e){return this.notifications.filter(t=>t.doctorName===e&&t.status==="pending")}getAllNotifications(e){return this.notifications.filter(t=>t.doctorName===e)}clearExpiredNotifications(){const e=new Date(Date.now()-864e5);this.notifications=this.notifications.filter(t=>{const r=new Date(t.timestamp)<e;return r&&t.status==="pending"&&(t.status="expired"),!r})}subscribeToStatusChanges(e){return this.statusChangeCallbacks.push(e),()=>{const t=this.statusChangeCallbacks.indexOf(e);t>=0&&this.statusChangeCallbacks.splice(t,1)}}isCleanStatus(e){const t=e.toLowerCase();return["clean","active"].includes(t)}getPriorityQueue(e){return this.priorityQueue.filter(t=>t.toolId===e).sort((t,r)=>{const s={high:3,medium:2,low:1},i=s[r.priority]-s[t.priority];return i!==0?i:new Date(t.timestamp).getTime()-new Date(r.timestamp).getTime()})}getTrackedToolsForDoctor(e){return this.priorityQueue.filter(t=>t.doctorName===e)}syncWithDatabase(e,t){const r=this.getToolTrackers(e);if(t&&r.length>0)r.forEach(s=>{const i={toolId:e,doctorName:s.doctorName,priority:s.priority,timestamp:s.timestamp,status:s.status};$i.queueSync(i)});else{const s={toolId:e,doctorName:"system",priority:"medium",timestamp:new Date().toISOString(),status:"expired"};$i.queueSync(s)}console.log(`📝 Queued database sync for tool ${e}: ${t?"tracked":"untracked"}`)}getQueuePosition(e,t){const r=this.getToolTrackers(e),s={high:3,medium:2,low:1},l=[...r].sort((c,o)=>{const d=s[o.priority]-s[c.priority];return d!==0?d:new Date(c.timestamp).getTime()-new Date(o.timestamp).getTime()}).findIndex(c=>c.doctorName===t);return l>=0?l+1:0}getTrackingStats(){const e=this.priorityQueue.length,t=this.priorityQueue.filter(l=>l.priority==="high").length,r=this.priorityQueue.filter(l=>l.priority==="medium").length,s=this.priorityQueue.filter(l=>l.priority==="low").length,i=this.notifications.filter(l=>l.status==="pending").length;return{totalTracked:e,highPriority:t,mediumPriority:r,lowPriority:s,pendingNotifications:i}}handleToolStatusChange(e){const t=this.getToolTrackers(e.toolId);t.length!==0&&(console.log("🔄 Tool status changed:",{toolId:e.toolId,toolName:e.toolName,oldStatus:e.oldStatus,newStatus:e.newStatus,trackers:t.length}),e.newStatus==="available"&&e.oldStatus!=="available"?this.handleToolBecameAvailable(e.toolId):e.newStatus==="unavailable"&&e.oldStatus==="available"?this.handleToolBecameUnavailable(e.toolId,e.toolName):e.newStatus==="in_use"&&e.oldStatus==="available"&&this.handleToolWasCheckedOut(e.toolId,e.toolName),Ri.recordToolAvailable(e.toolId,e.toolName,"Test Doctor","medium",void 0))}handleToolBecameUnavailable(e,t){const r=this.getToolTrackers(e);r.forEach(s=>{Pr.notifyToolUnavailable(e,t,void 0,r.length)})}handleToolWasCheckedOut(e,t){const r=this.getToolTrackers(e);r.forEach(s=>{Pr.notifyToolUnavailable(e,t,void 0,r.length)})}}const Cu=new nN,sN=()=>{const{startTimer:n,pauseTimer:e,resetTimer:t}=Ro(),{currentCycle:r,moveToolToNextPhase:s,updateToolStatus:i,addActivity:l}=ne(),{currentUser:c}=Mr();return{handleMoveToNextPhase:h.useCallback(d=>{if(console.log(`🔄 Starting phase transition from ${d}`),!c){console.log("❌ User authentication required for phase transitions"),alert("Please log in to perform sterilization phase transitions");return}if(!r){console.log("❌ No active cycle found");return}const u=r.tools.some(g=>{const y=ne.getState().availableTools.find(v=>v.id===g);return y==null?void 0:y.isP2Status});if(d==="drying"&&u){console.log("✅ Completing P2 Status tools after drying phase"),r.tools.forEach(g=>{const y=ne.getState().availableTools.find(v=>v.id===g);if(y!=null&&y.isP2Status){const v=ne.getState();v.incrementToolCycleCount&&v.incrementToolCycleCount(g),console.log(`Tool ${g} status updated to complete`),Cu.monitorToolStatusChange(g,"drying","complete"),console.log(`✅ P2 Status tool ${y.name} completed and cycle count incremented`)}}),e(d),t(d);return}const m=["bath1","bath2","airDry","autoclave"],p=m.indexOf(d),f=m[p+1];if(f){console.log(`🔄 Moving tools from ${d} to ${f}`),r.tools.forEach(y=>{const v=ne.getState().availableTools.find(x=>x.id===y);v&&(s(y),console.log(`Tool ${y} status updated to ${f}`),console.log(`✅ Moved tool ${v.name} from ${d} to ${f}`))}),e(d),t(d);const g=Rh[f];g&&n(f,g.duration),console.log(`✅ Phase transition completed: ${d} → ${f}`)}else{console.log("✅ Completing all tools after autoclave phase");const g=[];r.tools.forEach(y=>{const v=ne.getState().availableTools.find(x=>x.id===y);if(v){const x=ne.getState();x.incrementToolCycleCount&&x.incrementToolCycleCount(y),console.log(`Tool ${y} status updated to complete`),Cu.monitorToolStatusChange(y,"autoclave","available"),g.push(v),console.log(`✅ Tool ${v.name} completed sterilization cycle and marked as available`)}}),g.length>0&&(l({id:`cycle-${r.cycleNumber}-${Date.now()}`,type:"cycle-complete",title:`Cycle ${r.cycleNumber} Completed`,time:new Date,toolCount:g.length,color:"bg-green-500"}),console.log(`✅ Activity logged: Cycle ${r.cycleNumber} completed with ${g.length} tools`)),e(d),t(d)}},[c,r,n,e,t,s,l])}},lr=n=>{const e=Math.floor(n/3600),t=Math.floor(n%3600/60),r=n%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},aN=(n,e)=>n?"bg-red-100 text-red-700 border border-red-200":e?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-600",iN=(n,e)=>n?"OVEREXPOSED":e?"ACTIVE":"INACTIVE",oN=(n,e,t,r)=>{var s;if(!n)return e==="drying"?"00:00:00":lr(t);if(e==="drying")return lr(r);if((e==="bath1"||e==="bath2")&&n.overexposed&&n.elapsedTime){const l=n.elapsedTime-t;return`+${lr(l)}`}return lr((s=n.timeRemaining)!=null?s:0)},lN=({phaseId:n,phaseConfig:e,timer:t,duration:r,elapsedTime:s,isExpanded:i,onToggleExpanded:l})=>{var c;const{currentCycle:o}=ne(),d=(c=t==null?void 0:t.timeRemaining)!=null?c:r,u=(t==null?void 0:t.isRunning)||!1,m=(t==null?void 0:t.overexposed)||!1,p=o==null?void 0:o.tools.some(f=>{const g=ne.getState().availableTools.find(y=>y.id===f);return g==null?void 0:g.isP2Status});return a.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:l,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&l()},role:"button",tabIndex:0,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-[#5b5b5b]",children:e.label}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${aN(m,u)}`,children:iN(m,u)}),n==="drying"&&p&&a.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 border border-blue-200",children:"P2 STATUS"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:`text-2xl font-mono font-bold ${m?"text-red-600":"text-[#5b5b5b]"}`,children:oN(t,n,r,s)}),a.jsx("div",{className:"text-xs text-gray-500",children:t?`${t.elapsedTime?`${Math.floor(t.elapsedTime/60)}:${(t.elapsedTime%60).toString().padStart(2,"0")}`:"00:00"} elapsed`:"Ready"})]}),a.jsx(N,{path:i?kg:wn,size:1,className:"text-gray-400"})]})]}),n!=="drying"&&a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 relative",children:a.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${m?"bg-red-500":"bg-[#4ECDC4]"}`,style:{width:`${d/r*100}%`}})}),a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:m&&(n==="bath1"||n==="bath2")?`100% + ${lr(s-r)} overexposed`:`${Math.round((r-d)/r*100)}% complete`})]})]})},cN=({phaseId:n,timer:e,onPauseTimer:t,onStopTimer:r,onMoveToNextPhase:s})=>{const{currentCycle:i}=ne(),l=(e==null?void 0:e.isRunning)||!1,c=e&&e.timeRemaining===0,o=i&&i.tools.length>0,d=i==null?void 0:i.tools.some(m=>{const p=ne.getState().availableTools.find(f=>f.id===m);return p==null?void 0:p.isP2Status}),u=o&&(n==="bath1"&&c||n==="bath2"&&e||n==="drying"&&e||n==="autoclave"&&c);return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex gap-3",children:[n==="bath1"&&e?a.jsxs("button",{onClick:()=>t(n),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${l?"bg-gray-500 text-white hover:bg-gray-600":"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200"}`,children:[a.jsx(N,{path:l?Ca:Sn,size:.8,className:"mr-2"}),l?"Pause":"Resume"]}):n==="bath1"?a.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via workflow"}):e?a.jsxs("button",{onClick:()=>t(n),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${l?"bg-gray-500 text-white hover:bg-gray-600":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,children:[a.jsx(N,{path:l?Ca:Sn,size:.8,className:"mr-2"}),l?"Pause":"Resume"]}):a.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via previous phase"}),a.jsx("button",{onClick:()=>r(n),className:"px-4 py-2 bg-red-100 text-red-700 border border-red-300 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Cancel"})]}),u&&a.jsx("div",{className:"mt-2",children:a.jsx("button",{onClick:()=>s(n),className:"w-full px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:n==="drying"&&d?"Complete P2 Status Tools":n==="autoclave"?"Complete All Tools":"Move to Next Phase"})})]})},dN=({selectedCycle:n,onCycleSelect:e})=>a.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Select Cycle Type:"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(PT).map(([t,r])=>a.jsxs("button",{onClick:()=>e(t),className:`p-3 text-xs rounded-lg border transition-all duration-200 ${n===t?"bg-[#4ECDC4] text-white border-[#4ECDC4] shadow-sm":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-[#4ECDC4]"}`,children:[a.jsx("div",{className:"font-medium",children:r.name}),a.jsx("div",{className:"text-xs opacity-75",children:r.temp}),a.jsxs("div",{className:"text-xs opacity-75",children:[r.totalTime," min"]})]},t))})]}),uN=({duration:n,isRunning:e,timer:t})=>a.jsxs("div",{className:"text-xs text-gray-500 space-y-1 bg-gray-50 p-3 rounded-lg",children:[a.jsxs("div",{children:["Duration: ",lr(n||0)]}),a.jsxs("div",{children:["Status: ",e?"Running":"Stopped"]}),t&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:["Remaining: ",lr(t.timeRemaining||0)]}),a.jsxs("div",{children:["Elapsed: ",lr(t.elapsedTime||0)]})]})]}),mN=()=>{const n=ne(s=>s.currentCycle),e=ne(s=>s.availableTools),r=h.useMemo(()=>(n==null?void 0:n.tools)||[],[n==null?void 0:n.tools]).map(s=>e.find(i=>i.id===s)).filter(s=>s!==void 0);return a.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(N,{path:kr,size:.8,className:"text-gray-500"}),a.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Tools in Phase"})]}),(n==null?void 0:n.cycleNumber)&&a.jsx("span",{className:"text-xs text-gray-500 font-mono bg-white px-2 py-1 rounded border",children:n.cycleNumber})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:r.length>0?r.map(s=>a.jsx("span",{className:"px-2 py-1 bg-white text-xs text-gray-600 rounded border",children:s.name},s.id)):a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-xs text-gray-500 rounded border",children:"No tools in cycle"})})]})},$p=h.memo(({className:n=""})=>{const{timers:e}=Ro(),[t,r]=h.useState(null),[s,i]=h.useState(DT()),{handlePauseTimer:l,handleStopTimer:c}=FT(),{handleMoveToNextPhase:o}=sN(),d=p=>{r(t===p?null:p)},u=p=>{c(p),r(null)},m=p=>{o(p),r(null)};return a.jsxs("div",{className:`space-y-4 ${n}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"Sterilization Timers"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Individual phase timers for concurrent cycles"})]}),a.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-[#4ECDC4] text-white rounded-full",children:"Phase Timers"})]}),a.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(Rh).map(([p,f])=>{var g;const y=e[p],v=f.duration,x=t===p,b=(g=y==null?void 0:y.elapsedTime)!=null?g:0;return a.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-300 ${y!=null&&y.isRunning||p==="bath1"?"shadow-[0_0_25px_rgba(78,205,196,0.5)] border-[#4ECDC4] ring-2 ring-[#4ECDC4] ring-opacity-30":""}`,children:[a.jsx(lN,{phaseId:p,phaseConfig:f,timer:y,duration:v,elapsedTime:b,isExpanded:x,onToggleExpanded:()=>d(p)}),x&&a.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[a.jsx(mN,{}),p==="autoclave"&&a.jsx(dN,{selectedCycle:s,onCycleSelect:i}),a.jsx(cN,{phaseId:p,timer:y,onPauseTimer:l,onStopTimer:u,onMoveToNextPhase:m}),a.jsx(uN,{duration:v||0,isRunning:(y==null?void 0:y.isRunning)||!1,timer:y})]})]},p)})})]})});$p.displayName="TimerDisplay";const hN=h.memo(function({activeTab:e,tabs:t,SterilizationAnalyticsComponent:r,onTabChange:s,getTabButtonClasses:i}){return a.jsxs("div",{className:"bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsx("div",{className:"border-b border-gray-200",children:a.jsx("div",{className:"flex flex-wrap gap-2 p-4",children:t.map(l=>a.jsxs("button",{onClick:()=>s(l.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${i(e===l.id)}`,children:[a.jsx(N,{path:l.icon,size:.8}),l.label]},l.id))})}),a.jsxs("div",{className:"p-6",children:[e==="timers"&&a.jsx($p,{}),e==="analytics"&&a.jsx(a.Fragment,{children:r&&a.jsx(r,{})}),e==="logs"&&a.jsx(h.Suspense,{fallback:a.jsx(_s,{}),children:a.jsx(wT,{})})]})]})}),pN=({isOpen:n,operatorName:e,onOperatorNameChange:t,onOperatorNameKeyPress:r,onStartCycle:s,onClose:i,getStartCycleButtonState:l})=>n?js.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999]",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},children:a.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Start New Sterilization Cycle"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator Name"}),a.jsx("input",{id:"operator-name",type:"text",value:e,onChange:t,placeholder:"Enter operator name...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",onKeyPress:r})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:s,disabled:l(e).disabled,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${l(e).className}`,children:"Start Cycle"}),a.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"})]})]})]})}),document.body):null;var fN=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const gN=({isOpen:n,onClose:e})=>{const{lastGeneratedCode:t,setShowBatchCodeModal:r}=ne(),[s,i]=h.useState(!1);h.useEffect(()=>{n||r(!1)},[n,r]);const l=()=>{r(!1),e()},c=()=>fN(null,null,function*(){if(t!=null&&t.code)try{yield navigator.clipboard.writeText(t.code),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error(d)}}),o=()=>{const d=window.open("","_blank");d&&t&&(d.document.write(`
        <html>
          <head>
            <title>Batch Code - ${t.code}</title>
            <style>
              body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
              .batch-code { font-size: 48px; font-weight: bold; margin: 20px 0; }
              .info { font-size: 16px; margin: 10px 0; }
              .instructions { text-align: left; margin: 20px 0; }
              @media print { body { margin: 0; } }
            </style>
          </head>
          <body>
            <h1>Batch Code</h1>
            <div class="batch-code">${t.code}</div>
            <div class="info">
              <p><strong>Generated:</strong> ${t.generatedAt.toLocaleString()}</p>
              <p><strong>Operator:</strong> ${t.operator}</p>
              <p><strong>Tools:</strong> ${t.toolCount}</p>
            </div>
            <div class="instructions">
              <h3>Instructions:</h3>
              <ol>
                <li>Write this batch code clearly on the package</li>
                <li>Add today's date</li>
                <li>Add your name (${t.operator})</li>
                <li>Place package in autoclave</li>
              </ol>
            </div>
          </body>
        </html>
      `),d.document.close(),d.print())};return!n||!t?null:a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Ct,{path:Pg,size:1.5,className:"text-purple-600"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Batch Code Generated"})]}),a.jsx("button",{onClick:l,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(Ct,{path:pt,size:1.5})})]}),a.jsxs("div",{className:"text-center mb-6",children:[a.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-4",children:[a.jsx("p",{className:"text-sm text-purple-600 mb-2",children:"Your Batch Code"}),a.jsx("div",{className:"text-3xl font-bold text-purple-800 font-mono tracking-wider",children:t.code})]}),a.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Generated:"})," ",t.generatedAt.toLocaleString()]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Operator:"})," ",t.operator]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Tools:"})," ",t.toolCount]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Type:"})," ",t.isSingleTool?"Single Tool":"Batch"]})]})]}),a.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Instructions"}),a.jsxs("ol",{className:"text-sm text-blue-700 space-y-2",children:[a.jsxs("li",{className:"flex items-start",children:[a.jsx("span",{className:"font-bold mr-2",children:"1."}),a.jsx("span",{children:"Write this batch code clearly on the package"})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx("span",{className:"font-bold mr-2",children:"2."}),a.jsxs("span",{children:["Add today's date: ",new Date().toLocaleDateString()]})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx("span",{className:"font-bold mr-2",children:"3."}),a.jsxs("span",{children:["Add your name: ",t.operator]})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx("span",{className:"font-bold mr-2",children:"4."}),a.jsx("span",{children:"Place package in autoclave for sterilization"})]})]})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[a.jsx(Ct,{path:Dg,size:1}),a.jsx("span",{children:s?"Copied!":"Copy Code"})]}),a.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[a.jsx(Ct,{path:fh,size:1}),a.jsx("span",{children:"Print"})]})]}),a.jsx("div",{className:"mt-4",children:a.jsx("button",{onClick:l,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Done"})}),a.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:a.jsxs("p",{className:"text-sm text-yellow-800",children:[a.jsx("strong",{children:"Important:"})," This batch code is now tracked in the system. If a BI failure occurs, all tools in this batch will be affected."]})})]})})},Mp=h.memo(({SterilizationAnalyticsComponent:n})=>{const{startNewCycle:e,recordBITestResult:t,lastBITestDate:r,biTestOptedOut:s,setBiTestOptedOut:i,enforceBI:l,showBatchCodeModal:c,setShowBatchCodeModal:o}=ne(),{initError:d,subscribe:u,unsubscribe:m}=_a(),{tabs:p,validateOperatorName:f,getTabButtonClasses:g,getStartCycleButtonState:y}=yT(),{activeTab:v,showNewCycleModal:x,operatorName:b,handleTabChange:C,handleOperatorNameChange:k,handleCloseNewCycleModal:P,resetOperatorName:E}=vT();h.useEffect(()=>(R_(),u(),()=>{m()}),[u,m]),h.useEffect(()=>{let T=null,j=!0;function M(){j&&(gT(r),T=setTimeout(M,3e5))}return M(),()=>{j=!1,T&&(clearTimeout(T),T=null)}},[r]);const $=h.useCallback(T=>{t(T)},[t]),w=h.useCallback(()=>{f(b)&&(e(b.trim()),P(),E())},[b,e,f,P,E]),S=h.useCallback(()=>{i(!0)},[i]);h.useCallback(()=>{},[]);const A=h.useMemo(()=>{if(!l||s)return!1;const T=new Date().toDateString();return(r?new Date(r).toDateString():null)!==T},[l,s,r]),I=h.useCallback(T=>{T.key==="Enter"&&w()},[w]);return a.jsxs("div",{className:"space-y-6",children:[a.jsx(fT,{isVisible:A,onComplete:$,onOptOut:S}),d&&a.jsxs("div",{className:"bg-red-100 text-red-700 text-sm p-2 rounded-md",children:["BI Initialization Failed: ",d.message]}),a.jsx(Op,{}),a.jsx(hN,{activeTab:v,tabs:p,SterilizationAnalyticsComponent:n,onTabChange:C,getTabButtonClasses:g}),a.jsx(pN,{isOpen:x,operatorName:b,onOperatorNameChange:k,onOperatorNameKeyPress:I,onClose:P,onStartCycle:w,getStartCycleButtonState:y}),a.jsx(gN,{isOpen:c,onClose:()=>o(!1)})]})});Mp.displayName="SterilizationDashboard";const Iu=()=>a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}),Fp=h.memo(()=>a.jsx(Cn,{FallbackComponent:Iu,children:a.jsx(ks,{children:a.jsx("div",{className:"p-6 space-y-6",children:a.jsx(Cn,{FallbackComponent:Iu,children:a.jsx(Mp,{SterilizationAnalyticsComponent:sT})})})})}));Fp.displayName="Sterilization";const yN=({children:n})=>a.jsx("div",{className:"space-y-6",children:n}),vN=({children:n})=>a.jsx(a.Fragment,{children:n});var Mi={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var ju;function _N(){return ju||(ju=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var i="",l=0;l<arguments.length;l++){var c=arguments[l];c&&(i=s(i,r(c)))}return i}function r(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var l="";for(var c in i)e.call(i,c)&&i[c]&&(l=s(l,c));return l}function s(i,l){return l?i?i+" "+l:i+l:i}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(Mi)),Mi.exports}var xN=_N();const it=xo(xN);function bN(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function mo(n,e){return mo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},mo(n,e)}function wN(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,mo(n,e)}const SN=["xxl","xl","lg","md","sm","xs"],CN="xs",$o=h.createContext({prefixes:{},breakpoints:SN,minBreakpoint:CN}),{Consumer:qR,Provider:UR}=$o;function Lr(n,e){const{prefixes:t}=h.useContext($o);return n||t[e]||e}function IN(){const{dir:n}=h.useContext($o);return n==="rtl"}function Ha(n){return n&&n.ownerDocument||document}function jN(n){var e=Ha(n);return e&&e.defaultView||window}function EN(n,e){return jN(n).getComputedStyle(n,e)}var TN=/([A-Z])/g;function NN(n){return n.replace(TN,"-$1").toLowerCase()}var kN=/^ms-/;function oa(n){return NN(n).replace(kN,"-ms-")}var PN=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function DN(n){return!!(n&&PN.test(n))}function Rr(n,e){var t="",r="";if(typeof e=="string")return n.style.getPropertyValue(oa(e))||EN(n).getPropertyValue(oa(e));Object.keys(e).forEach(function(s){var i=e[s];!i&&i!==0?n.style.removeProperty(oa(s)):DN(s)?r+=s+"("+i+") ":t+=oa(s)+": "+i+";"}),r&&(t+="transform: "+r+";"),n.style.cssText+=";"+t}var AN=Xg();const Fi=xo(AN),Eu={disabled:!1},Lp=X.createContext(null);var ON=function(e){return e.scrollTop},fs="unmounted",jr="exited",rr="entering",Tr="entered",ho="exiting",Ut=(function(n){wN(e,n);function e(r,s){var i;i=n.call(this,r,s)||this;var l=s,c=l&&!l.isMounting?r.enter:r.appear,o;return i.appearStatus=null,r.in?c?(o=jr,i.appearStatus=rr):o=Tr:r.unmountOnExit||r.mountOnEnter?o=fs:o=jr,i.state={status:o},i.nextCallback=null,i}e.getDerivedStateFromProps=function(s,i){var l=s.in;return l&&i.status===fs?{status:jr}:null};var t=e.prototype;return t.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},t.componentDidUpdate=function(s){var i=null;if(s!==this.props){var l=this.state.status;this.props.in?l!==rr&&l!==Tr&&(i=rr):(l===rr||l===Tr)&&(i=ho)}this.updateStatus(!1,i)},t.componentWillUnmount=function(){this.cancelNextCallback()},t.getTimeouts=function(){var s=this.props.timeout,i,l,c;return i=l=c=s,s!=null&&typeof s!="number"&&(i=s.exit,l=s.enter,c=s.appear!==void 0?s.appear:l),{exit:i,enter:l,appear:c}},t.updateStatus=function(s,i){if(s===void 0&&(s=!1),i!==null)if(this.cancelNextCallback(),i===rr){if(this.props.unmountOnExit||this.props.mountOnEnter){var l=this.props.nodeRef?this.props.nodeRef.current:mn.findDOMNode(this);l&&ON(l)}this.performEnter(s)}else this.performExit();else this.props.unmountOnExit&&this.state.status===jr&&this.setState({status:fs})},t.performEnter=function(s){var i=this,l=this.props.enter,c=this.context?this.context.isMounting:s,o=this.props.nodeRef?[c]:[mn.findDOMNode(this),c],d=o[0],u=o[1],m=this.getTimeouts(),p=c?m.appear:m.enter;if(!s&&!l||Eu.disabled){this.safeSetState({status:Tr},function(){i.props.onEntered(d)});return}this.props.onEnter(d,u),this.safeSetState({status:rr},function(){i.props.onEntering(d,u),i.onTransitionEnd(p,function(){i.safeSetState({status:Tr},function(){i.props.onEntered(d,u)})})})},t.performExit=function(){var s=this,i=this.props.exit,l=this.getTimeouts(),c=this.props.nodeRef?void 0:mn.findDOMNode(this);if(!i||Eu.disabled){this.safeSetState({status:jr},function(){s.props.onExited(c)});return}this.props.onExit(c),this.safeSetState({status:ho},function(){s.props.onExiting(c),s.onTransitionEnd(l.exit,function(){s.safeSetState({status:jr},function(){s.props.onExited(c)})})})},t.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},t.safeSetState=function(s,i){i=this.setNextCallback(i),this.setState(s,i)},t.setNextCallback=function(s){var i=this,l=!0;return this.nextCallback=function(c){l&&(l=!1,i.nextCallback=null,s(c))},this.nextCallback.cancel=function(){l=!1},this.nextCallback},t.onTransitionEnd=function(s,i){this.setNextCallback(i);var l=this.props.nodeRef?this.props.nodeRef.current:mn.findDOMNode(this),c=s==null&&!this.props.addEndListener;if(!l||c){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var o=this.props.nodeRef?[this.nextCallback]:[l,this.nextCallback],d=o[0],u=o[1];this.props.addEndListener(d,u)}s!=null&&setTimeout(this.nextCallback,s)},t.render=function(){var s=this.state.status;if(s===fs)return null;var i=this.props,l=i.children;i.in,i.mountOnEnter,i.unmountOnExit,i.appear,i.enter,i.exit,i.timeout,i.addEndListener,i.onEnter,i.onEntering,i.onEntered,i.onExit,i.onExiting,i.onExited,i.nodeRef;var c=bN(i,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return X.createElement(Lp.Provider,{value:null},typeof l=="function"?l(s,c):X.cloneElement(X.Children.only(l),c))},e})(X.Component);Ut.contextType=Lp;Ut.propTypes={};function en(){}Ut.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:en,onEntering:en,onEntered:en,onExit:en,onExiting:en,onExited:en};Ut.UNMOUNTED=fs;Ut.EXITED=jr;Ut.ENTERING=rr;Ut.ENTERED=Tr;Ut.EXITING=ho;function RN(n){return n.code==="Escape"||n.keyCode===27}function $N(){const n=h.version.split(".");return{major:+n[0],minor:+n[1],patch:+n[2]}}function Va(n){if(!n||typeof n=="function")return null;const{major:e}=$N();return e>=19?n.props.ref:n.ref}const Tn=!!(typeof window!="undefined"&&window.document&&window.document.createElement);var po=!1,fo=!1;try{var Li={get passive(){return po=!0},get once(){return fo=po=!0}};Tn&&(window.addEventListener("test",Li,Li),window.removeEventListener("test",Li,!0))}catch(n){}function zp(n,e,t,r){if(r&&typeof r!="boolean"&&!fo){var s=r.once,i=r.capture,l=t;!fo&&s&&(l=t.__once||function c(o){this.removeEventListener(e,c,i),t.call(this,o)},t.__once=l),n.addEventListener(e,l,po?r:i)}n.addEventListener(e,t,r)}function go(n,e,t,r){var s=r&&typeof r!="boolean"?r.capture:r;n.removeEventListener(e,t,s),t.__once&&n.removeEventListener(e,t.__once,s)}function ka(n,e,t,r){return zp(n,e,t,r),function(){go(n,e,t,r)}}function MN(n,e,t,r){if(r===void 0&&(r=!0),n){var s=document.createEvent("HTMLEvents");s.initEvent(e,t,r),n.dispatchEvent(s)}}function FN(n){var e=Rr(n,"transitionDuration")||"",t=e.indexOf("ms")===-1?1e3:1;return parseFloat(e)*t}function LN(n,e,t){t===void 0&&(t=5);var r=!1,s=setTimeout(function(){r||MN(n,"transitionend",!0)},e+t),i=ka(n,"transitionend",function(){r=!0},{once:!0});return function(){clearTimeout(s),i()}}function Bp(n,e,t,r){t==null&&(t=FN(n)||0);var s=LN(n,t,r),i=ka(n,"transitionend",e);return function(){s(),i()}}function Tu(n,e){const t=Rr(n,e)||"",r=t.indexOf("ms")===-1?1e3:1;return parseFloat(t)*r}function zN(n,e){const t=Tu(n,"transitionDuration"),r=Tu(n,"transitionDelay"),s=Bp(n,i=>{i.target===n&&(s(),e(i))},t+r)}function BN(n){n.offsetHeight}const Nu=n=>!n||typeof n=="function"?n:e=>{n.current=e};function qN(n,e){const t=Nu(n),r=Nu(e);return s=>{t&&t(s),r&&r(s)}}function qp(n,e){return h.useMemo(()=>qN(n,e),[n,e])}function UN(n){return n&&"setState"in n?mn.findDOMNode(n):n!=null?n:null}const Up=X.forwardRef((m,u)=>{var p=m,{onEnter:n,onEntering:e,onEntered:t,onExit:r,onExiting:s,onExited:i,addEndListener:l,children:c,childRef:o}=p,d=Xe(p,["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children","childRef"]);const f=h.useRef(null),g=qp(f,o),y=w=>{g(UN(w))},v=w=>S=>{w&&f.current&&w(f.current,S)},x=h.useCallback(v(n),[n]),b=h.useCallback(v(e),[e]),C=h.useCallback(v(t),[t]),k=h.useCallback(v(r),[r]),P=h.useCallback(v(s),[s]),E=h.useCallback(v(i),[i]),$=h.useCallback(v(l),[l]);return a.jsx(Ut,Te(re({ref:u},d),{onEnter:x,onEntered:C,onEntering:b,onExit:k,onExited:E,onExiting:P,addEndListener:$,nodeRef:f,children:typeof c=="function"?(w,S)=>c(w,Te(re({},S),{ref:y})):X.cloneElement(c,{ref:y})}))});Up.displayName="TransitionWrapper";function HN(n){const e=h.useRef(n);return h.useEffect(()=>{e.current=n},[n]),e}function yo(n){const e=HN(n);return h.useCallback(function(...t){return e.current&&e.current(...t)},[e])}const VN=(n=>h.forwardRef((e,t)=>a.jsx("div",Te(re({},e),{ref:t,className:it(e.className,n)}))));function WN(n){const e=h.useRef(n);return h.useEffect(()=>{e.current=n},[n]),e}function Nr(n){const e=WN(n);return h.useCallback(function(...t){return e.current&&e.current(...t)},[e])}function GN(){const n=h.useRef(!0),e=h.useRef(()=>n.current);return h.useEffect(()=>(n.current=!0,()=>{n.current=!1}),[]),e.current}function KN(n){const e=h.useRef(null);return h.useEffect(()=>{e.current=n}),e.current}const QN=typeof global!="undefined"&&global.navigator&&global.navigator.product==="ReactNative",YN=typeof document!="undefined",ku=YN||QN?h.useLayoutEffect:h.useEffect,JN=["as","disabled"];function XN(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function ZN(n){return!n||n.trim()==="#"}function Hp({tagName:n,disabled:e,href:t,target:r,rel:s,role:i,onClick:l,tabIndex:c=0,type:o}){n||(t!=null||r!=null||s!=null?n="a":n="button");const d={tagName:n};if(n==="button")return[{type:o||"button",disabled:e},d];const u=p=>{if((e||n==="a"&&ZN(t))&&p.preventDefault(),e){p.stopPropagation();return}l==null||l(p)},m=p=>{p.key===" "&&(p.preventDefault(),u(p))};return n==="a"&&(t||(t="#"),e&&(t=void 0)),[{role:i!=null?i:"button",disabled:void 0,tabIndex:e?void 0:c,href:t,target:n==="a"?r:void 0,"aria-disabled":e||void 0,rel:n==="a"?s:void 0,onClick:u,onKeyDown:m},d]}const ek=h.forwardRef((n,e)=>{let{as:t,disabled:r}=n,s=XN(n,JN);const[i,{tagName:l}]=Hp(Object.assign({tagName:t,disabled:r},s));return a.jsx(l,Object.assign({},s,i,{ref:e}))});ek.displayName="Button";const tk={[rr]:"show",[Tr]:"show"},Mo=h.forwardRef((l,i)=>{var c=l,{className:n,children:e,transitionClasses:t={},onEnter:r}=c,s=Xe(c,["className","children","transitionClasses","onEnter"]);const o=re({in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1},s),d=h.useCallback((u,m)=>{BN(u),r==null||r(u,m)},[r]);return a.jsx(Up,Te(re({ref:i,addEndListener:zN},o),{onEnter:d,childRef:Va(e),children:(u,m)=>h.cloneElement(e,Te(re({},m),{className:it("fade",n,e.props.className,tk[u],t[u])}))}))});Mo.displayName="Fade";const rk={"aria-label":Fi.string,onClick:Fi.func,variant:Fi.oneOf(["white"])},Fo=h.forwardRef((i,s)=>{var l=i,{className:n,variant:e,"aria-label":t="Close"}=l,r=Xe(l,["className","variant","aria-label"]);return a.jsx("button",re({ref:s,type:"button",className:it("btn-close",e&&`btn-close-${e}`,n),"aria-label":t},r))});Fo.displayName="CloseButton";Fo.propTypes=rk;const Is=h.forwardRef((d,o)=>{var u=d,{as:n,bsPrefix:e,variant:t="primary",size:r,active:s=!1,disabled:i=!1,className:l}=u,c=Xe(u,["as","bsPrefix","variant","size","active","disabled","className"]);const m=Lr(e,"btn"),[p,{tagName:f}]=Hp(re({tagName:n,disabled:i},c)),g=f;return a.jsx(g,Te(re(re({},p),c),{ref:o,disabled:i,className:it(l,m,s&&"active",t&&`${m}-${t}`,r&&`${m}-${r}`,c.href&&i&&"disabled")}))});Is.displayName="Button";function nk(n){const e=h.useRef(n);return e.current=n,e}function sk(n){const e=nk(n);h.useEffect(()=>()=>e.current(),[])}var ak=Function.prototype.bind.call(Function.prototype.call,[].slice);function tn(n,e){return ak(n.querySelectorAll(e))}function Pu(n,e){if(n.contains)return n.contains(e);if(n.compareDocumentPosition)return n===e||!!(n.compareDocumentPosition(e)&16)}const ik="data-rr-ui-";function ok(n){return`${ik}${n}`}const Vp=h.createContext(Tn?window:void 0);Vp.Provider;function Lo(){return h.useContext(Vp)}const Du=n=>!n||typeof n=="function"?n:e=>{n.current=e};function lk(n,e){const t=Du(n),r=Du(e);return s=>{t&&t(s),r&&r(s)}}function zo(n,e){return h.useMemo(()=>lk(n,e),[n,e])}var la;function Au(n){if((!la&&la!==0||n)&&Tn){var e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.width="50px",e.style.height="50px",e.style.overflow="scroll",document.body.appendChild(e),la=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return la}function ck(){return h.useState(null)}function zi(n){n===void 0&&(n=Ha());try{var e=n.activeElement;return!e||!e.nodeName?null:e}catch(t){return n.body}}function dk(n){const e=h.useRef(n);return e.current=n,e}function uk(n){const e=dk(n);h.useEffect(()=>()=>e.current(),[])}function mk(n=document){const e=n.defaultView;return Math.abs(e.innerWidth-n.documentElement.clientWidth)}const Ou=ok("modal-open");class Bo{constructor({ownerDocument:e,handleContainerOverflow:t=!0,isRTL:r=!1}={}){this.handleContainerOverflow=t,this.isRTL=r,this.modals=[],this.ownerDocument=e}getScrollbarWidth(){return mk(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(e){}removeModalAttributes(e){}setContainerStyle(e){const t={overflow:"hidden"},r=this.isRTL?"paddingLeft":"paddingRight",s=this.getElement();e.style={overflow:s.style.overflow,[r]:s.style[r]},e.scrollBarWidth&&(t[r]=`${parseInt(Rr(s,r)||"0",10)+e.scrollBarWidth}px`),s.setAttribute(Ou,""),Rr(s,t)}reset(){[...this.modals].forEach(e=>this.remove(e))}removeContainerStyle(e){const t=this.getElement();t.removeAttribute(Ou),Object.assign(t.style,e.style)}add(e){let t=this.modals.indexOf(e);return t!==-1||(t=this.modals.length,this.modals.push(e),this.setModalAttributes(e),t!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),t}remove(e){const t=this.modals.indexOf(e);t!==-1&&(this.modals.splice(t,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(e))}isTopModal(e){return!!this.modals.length&&this.modals[this.modals.length-1]===e}}const Bi=(n,e)=>Tn?n==null?(e||Ha()).body:(typeof n=="function"&&(n=n()),n&&"current"in n&&(n=n.current),n&&("nodeType"in n||n.getBoundingClientRect)?n:null):null;function hk(n,e){const t=Lo(),[r,s]=h.useState(()=>Bi(n,t==null?void 0:t.document));if(!r){const i=Bi(n);i&&s(i)}return h.useEffect(()=>{},[e,r]),h.useEffect(()=>{const i=Bi(n);i!==r&&s(i)},[n,r]),r}function pk({children:n,in:e,onExited:t,mountOnEnter:r,unmountOnExit:s}){const i=h.useRef(null),l=h.useRef(e),c=Nr(t);h.useEffect(()=>{e?l.current=!0:c(i.current)},[e,c]);const o=zo(i,Va(n)),d=h.cloneElement(n,{ref:o});return e?d:s||!l.current&&r?null:d}const fk=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function gk(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function yk(n){let{onEnter:e,onEntering:t,onEntered:r,onExit:s,onExiting:i,onExited:l,addEndListener:c,children:o}=n,d=gk(n,fk);const u=h.useRef(null),m=zo(u,Va(o)),p=k=>P=>{k&&u.current&&k(u.current,P)},f=h.useCallback(p(e),[e]),g=h.useCallback(p(t),[t]),y=h.useCallback(p(r),[r]),v=h.useCallback(p(s),[s]),x=h.useCallback(p(i),[i]),b=h.useCallback(p(l),[l]),C=h.useCallback(p(c),[c]);return Object.assign({},d,{nodeRef:u},e&&{onEnter:f},t&&{onEntering:g},r&&{onEntered:y},s&&{onExit:v},i&&{onExiting:x},l&&{onExited:b},c&&{addEndListener:C},{children:typeof o=="function"?(k,P)=>o(k,Object.assign({},P,{ref:m})):h.cloneElement(o,{ref:m})})}const vk=["component"];function _k(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}const xk=h.forwardRef((n,e)=>{let{component:t}=n,r=_k(n,vk);const s=yk(r);return a.jsx(t,Object.assign({ref:e},s))});function bk({in:n,onTransition:e}){const t=h.useRef(null),r=h.useRef(!0),s=Nr(e);return ku(()=>{if(!t.current)return;let i=!1;return s({in:n,element:t.current,initial:r.current,isStale:()=>i}),()=>{i=!0}},[n,s]),ku(()=>(r.current=!1,()=>{r.current=!0}),[]),t}function wk({children:n,in:e,onExited:t,onEntered:r,transition:s}){const[i,l]=h.useState(!e);e&&i&&l(!1);const c=bk({in:!!e,onTransition:d=>{const u=()=>{d.isStale()||(d.in?r==null||r(d.element,d.initial):(l(!0),t==null||t(d.element)))};Promise.resolve(s(d)).then(u,m=>{throw d.in||l(!0),m})}}),o=zo(c,Va(n));return i&&!e?null:h.cloneElement(n,{ref:o})}function Ru(n,e,t){return n?a.jsx(xk,Object.assign({},t,{component:n})):e?a.jsx(wk,Object.assign({},t,{transition:e})):a.jsx(pk,Object.assign({},t))}const Sk=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function Ck(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}let qi;function Ik(n){return qi||(qi=new Bo({ownerDocument:n==null?void 0:n.document})),qi}function jk(n){const e=Lo(),t=n||Ik(e),r=h.useRef({dialog:null,backdrop:null});return Object.assign(r.current,{add:()=>t.add(r.current),remove:()=>t.remove(r.current),isTopModal:()=>t.isTopModal(r.current),setDialogRef:h.useCallback(s=>{r.current.dialog=s},[]),setBackdropRef:h.useCallback(s=>{r.current.backdrop=s},[])})}const Wp=h.forwardRef((n,e)=>{let{show:t=!1,role:r="dialog",className:s,style:i,children:l,backdrop:c=!0,keyboard:o=!0,onBackdropClick:d,onEscapeKeyDown:u,transition:m,runTransition:p,backdropTransition:f,runBackdropTransition:g,autoFocus:y=!0,enforceFocus:v=!0,restoreFocus:x=!0,restoreFocusOptions:b,renderDialog:C,renderBackdrop:k=le=>a.jsx("div",Object.assign({},le)),manager:P,container:E,onShow:$,onHide:w=()=>{},onExit:S,onExited:A,onExiting:I,onEnter:T,onEntering:j,onEntered:M}=n,B=Ck(n,Sk);const G=Lo(),Y=hk(E),R=jk(P),D=GN(),U=KN(t),[F,V]=h.useState(!t),q=h.useRef(null);h.useImperativeHandle(e,()=>R,[R]),Tn&&!U&&t&&(q.current=zi(G==null?void 0:G.document)),t&&F&&V(!1);const W=Nr(()=>{if(R.add(),Nn.current=ka(document,"keydown",Ht),Br.current=ka(document,"focus",()=>setTimeout(Ee),!0),$&&$(),y){var le,Ps;const Ur=zi((le=(Ps=R.dialog)==null?void 0:Ps.ownerDocument)!=null?le:G==null?void 0:G.document);R.dialog&&Ur&&!Pu(R.dialog,Ur)&&(q.current=Ur,R.dialog.focus())}}),ee=Nr(()=>{if(R.remove(),Nn.current==null||Nn.current(),Br.current==null||Br.current(),x){var le;(le=q.current)==null||le.focus==null||le.focus(b),q.current=null}});h.useEffect(()=>{!t||!Y||W()},[t,Y,W]),h.useEffect(()=>{F&&ee()},[F,ee]),uk(()=>{ee()});const Ee=Nr(()=>{if(!v||!D()||!R.isTopModal())return;const le=zi(G==null?void 0:G.document);R.dialog&&le&&!Pu(R.dialog,le)&&R.dialog.focus()}),zr=Nr(le=>{le.target===le.currentTarget&&(d==null||d(le),c===!0&&w())}),Ht=Nr(le=>{o&&RN(le)&&R.isTopModal()&&(u==null||u(le),le.defaultPrevented||w())}),Br=h.useRef(),Nn=h.useRef(),Ga=(...le)=>{V(!0),A==null||A(...le)};if(!Y)return null;const kn=Object.assign({role:r,ref:R.setDialogRef,"aria-modal":r==="dialog"?!0:void 0},B,{style:i,className:s,tabIndex:-1});let qr=C?C(kn):a.jsx("div",Object.assign({},kn,{children:h.cloneElement(l,{role:"document"})}));qr=Ru(m,p,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!t,onExit:S,onExiting:I,onExited:Ga,onEnter:T,onEntering:j,onEntered:M,children:qr});let Vt=null;return c&&(Vt=k({ref:R.setBackdropRef,onClick:zr}),Vt=Ru(f,g,{in:!!t,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:Vt})),a.jsx(a.Fragment,{children:mn.createPortal(a.jsxs(a.Fragment,{children:[Vt,qr]}),Y)})});Wp.displayName="Modal";const Ek=Object.assign(Wp,{Manager:Bo});function Tk(n,e){return n.classList?n.classList.contains(e):(" "+(n.className.baseVal||n.className)+" ").indexOf(" "+e+" ")!==-1}function Nk(n,e){n.classList?n.classList.add(e):Tk(n,e)||(typeof n.className=="string"?n.className=n.className+" "+e:n.setAttribute("class",(n.className&&n.className.baseVal||"")+" "+e))}function $u(n,e){return n.replace(new RegExp("(^|\\s)"+e+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function kk(n,e){n.classList?n.classList.remove(e):typeof n.className=="string"?n.className=$u(n.className,e):n.setAttribute("class",$u(n.className&&n.className.baseVal||"",e))}const rn={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class Pk extends Bo{adjustAndStore(e,t,r){const s=t.style[e];t.dataset[e]=s,Rr(t,{[e]:`${parseFloat(Rr(t,e))+r}px`})}restore(e,t){const r=t.dataset[e];r!==void 0&&(delete t.dataset[e],Rr(t,{[e]:r}))}setContainerStyle(e){super.setContainerStyle(e);const t=this.getElement();if(Nk(t,"modal-open"),!e.scrollBarWidth)return;const r=this.isRTL?"paddingLeft":"paddingRight",s=this.isRTL?"marginLeft":"marginRight";tn(t,rn.FIXED_CONTENT).forEach(i=>this.adjustAndStore(r,i,e.scrollBarWidth)),tn(t,rn.STICKY_CONTENT).forEach(i=>this.adjustAndStore(s,i,-e.scrollBarWidth)),tn(t,rn.NAVBAR_TOGGLER).forEach(i=>this.adjustAndStore(s,i,e.scrollBarWidth))}removeContainerStyle(e){super.removeContainerStyle(e);const t=this.getElement();kk(t,"modal-open");const r=this.isRTL?"paddingLeft":"paddingRight",s=this.isRTL?"marginLeft":"marginRight";tn(t,rn.FIXED_CONTENT).forEach(i=>this.restore(r,i)),tn(t,rn.STICKY_CONTENT).forEach(i=>this.restore(s,i)),tn(t,rn.NAVBAR_TOGGLER).forEach(i=>this.restore(s,i))}}let Ui;function Dk(n){return Ui||(Ui=new Pk(n)),Ui}const Gp=h.forwardRef((i,s)=>{var l=i,{className:n,bsPrefix:e,as:t="div"}=l,r=Xe(l,["className","bsPrefix","as"]);return e=Lr(e,"modal-body"),a.jsx(t,re({ref:s,className:it(n,e)},r))});Gp.displayName="ModalBody";const Kp=h.createContext({onHide(){}}),qo=h.forwardRef((u,d)=>{var m=u,{bsPrefix:n,className:e,contentClassName:t,centered:r,size:s,fullscreen:i,children:l,scrollable:c}=m,o=Xe(m,["bsPrefix","className","contentClassName","centered","size","fullscreen","children","scrollable"]);n=Lr(n,"modal");const p=`${n}-dialog`,f=typeof i=="string"?`${n}-fullscreen-${i}`:`${n}-fullscreen`;return a.jsx("div",Te(re({},o),{ref:d,className:it(p,e,s&&`${n}-${s}`,r&&`${p}-centered`,c&&`${p}-scrollable`,i&&f),children:a.jsx("div",{className:it(`${n}-content`,t),children:l})}))});qo.displayName="ModalDialog";const Qp=h.forwardRef((i,s)=>{var l=i,{className:n,bsPrefix:e,as:t="div"}=l,r=Xe(l,["className","bsPrefix","as"]);return e=Lr(e,"modal-footer"),a.jsx(t,re({ref:s,className:it(n,e)},r))});Qp.displayName="ModalFooter";const Yp=h.forwardRef((c,l)=>{var o=c,{closeLabel:n="Close",closeVariant:e,closeButton:t=!1,onHide:r,children:s}=o,i=Xe(o,["closeLabel","closeVariant","closeButton","onHide","children"]);const d=h.useContext(Kp),u=yo(()=>{d==null||d.onHide(),r==null||r()});return a.jsxs("div",Te(re({ref:l},i),{children:[s,t&&a.jsx(Fo,{"aria-label":n,variant:e,onClick:u})]}))});Yp.displayName="AbstractModalHeader";const Jp=h.forwardRef((l,i)=>{var c=l,{bsPrefix:n,className:e,closeLabel:t="Close",closeButton:r=!1}=c,s=Xe(c,["bsPrefix","className","closeLabel","closeButton"]);return n=Lr(n,"modal-header"),a.jsx(Yp,Te(re({ref:i},s),{className:it(e,n),closeLabel:t,closeButton:r}))});Jp.displayName="ModalHeader";const Ak=VN("h4"),Xp=h.forwardRef((i,s)=>{var l=i,{className:n,bsPrefix:e,as:t=Ak}=l,r=Xe(l,["className","bsPrefix","as"]);return e=Lr(e,"modal-title"),a.jsx(t,re({ref:s,className:it(n,e)},r))});Xp.displayName="ModalTitle";function Ok(n){return a.jsx(Mo,Te(re({},n),{timeout:null}))}function Rk(n){return a.jsx(Mo,Te(re({},n),{timeout:null}))}const Zp=h.forwardRef((Y,G)=>{var R=Y,{bsPrefix:n,className:e,style:t,dialogClassName:r,contentClassName:s,children:i,dialogAs:l=qo,"data-bs-theme":c,"aria-labelledby":o,"aria-describedby":d,"aria-label":u,show:m=!1,animation:p=!0,backdrop:f=!0,keyboard:g=!0,onEscapeKeyDown:y,onShow:v,onHide:x,container:b,autoFocus:C=!0,enforceFocus:k=!0,restoreFocus:P=!0,restoreFocusOptions:E,onEntered:$,onExit:w,onExiting:S,onEnter:A,onEntering:I,onExited:T,backdropClassName:j,manager:M}=R,B=Xe(R,["bsPrefix","className","style","dialogClassName","contentClassName","children","dialogAs","data-bs-theme","aria-labelledby","aria-describedby","aria-label","show","animation","backdrop","keyboard","onEscapeKeyDown","onShow","onHide","container","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","onEntered","onExit","onExiting","onEnter","onEntering","onExited","backdropClassName","manager"]);const[D,U]=h.useState({}),[F,V]=h.useState(!1),q=h.useRef(!1),W=h.useRef(!1),ee=h.useRef(null),[Ee,zr]=ck(),Ht=qp(G,zr),Br=yo(x),Nn=IN();n=Lr(n,"modal");const Ga=h.useMemo(()=>({onHide:Br}),[Br]);function kn(){return M||Dk({isRTL:Nn})}function qr(te){if(!Tn)return;const Hr=kn().getScrollbarWidth()>0,Wo=te.scrollHeight>Ha(te).documentElement.clientHeight;U({paddingRight:Hr&&!Wo?Au():void 0,paddingLeft:!Hr&&Wo?Au():void 0})}const Vt=yo(()=>{Ee&&qr(Ee.dialog)});sk(()=>{go(window,"resize",Vt),ee.current==null||ee.current()});const le=()=>{q.current=!0},Ps=te=>{q.current&&Ee&&te.target===Ee.dialog&&(W.current=!0),q.current=!1},Ur=()=>{V(!0),ee.current=Bp(Ee.dialog,()=>{V(!1)})},Pf=te=>{te.target===te.currentTarget&&Ur()},Df=te=>{if(f==="static"){Pf(te);return}if(W.current||te.target!==te.currentTarget){W.current=!1;return}x==null||x()},Af=te=>{g?y==null||y(te):(te.preventDefault(),f==="static"&&Ur())},Of=(te,Hr)=>{te&&qr(te),A==null||A(te,Hr)},Rf=te=>{ee.current==null||ee.current(),w==null||w(te)},$f=(te,Hr)=>{I==null||I(te,Hr),zp(window,"resize",Vt)},Mf=te=>{te&&(te.style.display=""),T==null||T(te),go(window,"resize",Vt)},Ff=h.useCallback(te=>a.jsx("div",Te(re({},te),{className:it(`${n}-backdrop`,j,!p&&"show")})),[p,j,n]),Vo=re(re({},t),D);Vo.display="block";const Lf=te=>a.jsx("div",Te(re({role:"dialog"},te),{style:Vo,className:it(e,n,F&&`${n}-static`,!p&&"show"),onClick:f?Df:void 0,onMouseUp:Ps,"data-bs-theme":c,"aria-label":u,"aria-labelledby":o,"aria-describedby":d,children:a.jsx(l,Te(re({},B),{onMouseDown:le,className:r,contentClassName:s,children:i}))}));return a.jsx(Kp.Provider,{value:Ga,children:a.jsx(Ek,{show:m,ref:Ht,backdrop:f,container:b,keyboard:!0,autoFocus:C,enforceFocus:k,restoreFocus:P,restoreFocusOptions:E,onEscapeKeyDown:Af,onShow:v,onHide:x,onEnter:Of,onEntering:$f,onEntered:$,onExit:Rf,onExiting:S,onExited:Mf,manager:kn(),transition:p?Ok:void 0,backdropTransition:p?Rk:void 0,renderBackdrop:Ff,renderDialog:Lf})})});Zp.displayName="Modal";const St=Object.assign(Zp,{Body:Gp,Header:Jp,Title:Xp,Footer:Qp,Dialog:qo,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),$k=()=>a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",role:"banner","aria-label":"Inventory management header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Inventory Management"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage your inventory items and equipment"})]}),a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Item scanner controls",children:[a.jsx("span",{className:"text-gray-600",children:"Item Scanner"}),a.jsx(dh,{to:"/inventory/scanner",children:a.jsx(Is,{variant:"success",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1","aria-label":"Scan new inventory item using barcode scanner",tabIndex:0,children:"Inventory Scanner"})})]})})]}),Mk=()=>a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})});var Fk=Object.defineProperty,Lk=Object.defineProperties,zk=Object.getOwnPropertyDescriptors,Mu=Object.getOwnPropertySymbols,Bk=Object.prototype.hasOwnProperty,qk=Object.prototype.propertyIsEnumerable,Fu=(n,e,t)=>e in n?Fk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Uk=(n,e)=>{for(var t in e||(e={}))Bk.call(e,t)&&Fu(n,t,e[t]);if(Mu)for(var t of Mu(e))qk.call(e,t)&&Fu(n,t,e[t]);return n},Hk=(n,e)=>Lk(n,zk(e));const Lu=()=>{YE();const n=Or(),{tools:e,supplies:t,equipment:r,officeHardware:s}=n,i=[...e,...t,...r,...s],l=i.map(c=>{var o;return Hk(Uk({},c),{category:(o=c.category)!=null?o:"uncategorized"})});return{allItems:i,itemsWithCategory:l,tools:e,supplies:t,equipment:r,officeHardware:s,totalUniqueItems:e.length+t.length+r.length+s.length,refreshData:n.refreshData,getAllItems:()=>i,getItemsByCategory:c=>{switch(c){case"tools":return e;case"supplies":return t;case"equipment":return r;case"officeHardware":return s;default:return[]}}}};var Vk=Object.defineProperty,zu=Object.getOwnPropertySymbols,Wk=Object.prototype.hasOwnProperty,Gk=Object.prototype.propertyIsEnumerable,Bu=(n,e,t)=>e in n?Vk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qu=(n,e)=>{for(var t in e||(e={}))Wk.call(e,t)&&Bu(n,t,e[t]);if(zu)for(var t of zu(e))Gk.call(e,t)&&Bu(n,t,e[t]);return n},Kk=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Qk=n=>({items:[],categories:[],selectedItems:[],isLoading:!1,isCategoriesLoading:!1,setItems:e=>n({items:e,inventoryItems:e}),setCategories:e=>n({categories:e}),addItem:e=>n(t=>({items:[...t.items,e],inventoryItems:[...t.items,e]})),updateItem:(e,t)=>n(r=>{const s=r.items.map(i=>i.id===e?qu(qu({},i),t):i);return{items:s,inventoryItems:s}}),deleteItem:e=>n(t=>{const r=t.items.filter(s=>s.id!==e);return{items:r,inventoryItems:r}}),addCategory:e=>n(t=>({categories:[...t.categories,e]})),removeCategory:e=>n(t=>({categories:t.categories.filter(r=>r!==e)})),setSelectedItems:e=>n({selectedItems:e}),setLoading:e=>n({isLoading:e}),setCategoriesLoading:e=>n({isCategoriesLoading:e}),setInventoryLoading:e=>n({isLoading:e}),refreshInventoryData:()=>Kk(null,null,function*(){console.log("Refreshing inventory data...")}),getFilteredItems:()=>[],getUniqueCategories:()=>[],inventoryItems:[]});var Yk=Object.defineProperty,Jk=Object.defineProperties,Xk=Object.getOwnPropertyDescriptors,Uu=Object.getOwnPropertySymbols,Zk=Object.prototype.hasOwnProperty,eP=Object.prototype.propertyIsEnumerable,Hu=(n,e,t)=>e in n?Yk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,tP=(n,e)=>{for(var t in e||(e={}))Zk.call(e,t)&&Hu(n,t,e[t]);if(Uu)for(var t of Uu(e))eP.call(e,t)&&Hu(n,t,e[t]);return n},rP=(n,e)=>Jk(n,Xk(e));const nP=n=>({activeTab:"tools",showFilters:!1,showTrackedOnly:!1,showFavoritesOnly:!1,expandedSections:{general:!0,purchase:!1,maintenance:!1,usage:!1},showFiltersPanel:!1,showAnalytics:!0,showBulkActions:!1,mergeMode:!1,selectedItems:[],trackedItems:new Set,trackingData:new Map,setActiveTab:e=>n({activeTab:e}),setShowFilters:e=>n({showFilters:e}),setShowTrackedOnly:e=>n({showTrackedOnly:e}),setShowFavoritesOnly:e=>n({showFavoritesOnly:e}),setExpandedSections:e=>n({expandedSections:e}),toggleExpandedSection:e=>n(t=>({expandedSections:rP(tP({},t.expandedSections),{[e]:!t.expandedSections[e]})})),setShowFiltersPanel:e=>n({showFiltersPanel:e}),setShowAnalytics:e=>n({showAnalytics:e}),setShowBulkActions:e=>n({showBulkActions:e}),toggleTrackedItem:(e,t)=>n(r=>{const s=new Set(r.trackedItems),i=new Map(r.trackingData);return s.has(e)?(s.delete(e),i.delete(e)):(s.add(e),i.set(e,{doctor:t,timestamp:new Date().toISOString()})),{trackedItems:s,trackingData:i}}),setTrackedItems:e=>n({trackedItems:e}),setTrackingData:e=>n({trackingData:e}),setMergeMode:e=>n({mergeMode:e,selectedItems:e?[]:[]}),toggleItemSelection:e=>n(t=>{const r=[...t.selectedItems],s=r.indexOf(e);return s>-1?r.splice(s,1):r.push(e),{selectedItems:r}}),clearSelectedItems:()=>n({selectedItems:[]}),selectAllItems:e=>n({selectedItems:[...e]})}),sP=n=>({showAddModal:!1,showTrackModal:!1,showUploadBarcodeModal:!1,showScanModal:!1,showDeleteModal:!1,itemToDelete:null,scanMode:null,scannedItems:[],setShowAddModal:e=>n({showAddModal:e}),setShowTrackModal:e=>n({showTrackModal:e}),setShowUploadBarcodeModal:e=>n({showUploadBarcodeModal:e}),setShowScanModal:e=>n({showScanModal:e}),setShowDeleteModal:e=>n({showDeleteModal:e}),setItemToDelete:e=>n({itemToDelete:e}),openDeleteModal:e=>n({showDeleteModal:!0,itemToDelete:e}),closeDeleteModal:()=>n({showDeleteModal:!1,itemToDelete:null}),setScanMode:e=>n({scanMode:e}),addScannedItem:e=>n(t=>({scannedItems:[...t.scannedItems,e]})),removeScannedItem:e=>n(t=>({scannedItems:t.scannedItems.filter(r=>r!==e)})),resetScannedItems:()=>n({scannedItems:[]}),openAddModal:()=>n({showAddModal:!0}),closeAddModal:()=>n({showAddModal:!1}),openTrackModal:()=>n({showTrackModal:!0}),closeTrackModal:()=>n({showTrackModal:!1}),openUploadBarcodeModal:()=>n({showUploadBarcodeModal:!0}),closeUploadBarcodeModal:()=>n({showUploadBarcodeModal:!1}),toggleUploadBarcodeModal:()=>n(e=>({showUploadBarcodeModal:!e.showUploadBarcodeModal})),openScanModal:()=>n({showScanModal:!0}),closeScanModal:()=>n({showScanModal:!1})}),aP=()=>{try{const n=localStorage.getItem("cliniio-favorites");return n?JSON.parse(n):[]}catch(n){return console.warn("Failed to load favorites from localStorage:",n),[]}},Vu=n=>{try{localStorage.setItem("cliniio-favorites",JSON.stringify(n))}catch(e){console.warn("Failed to save favorites to localStorage:",e)}},iP=n=>({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",favorites:aP(),showFavoritesOnly:!1,sortField:"name",sortDirection:"asc",setSearchQuery:e=>n({searchQuery:e,searchTerm:e}),setSearchTerm:e=>n({searchTerm:e,searchQuery:e}),setCategoryFilter:e=>n({categoryFilter:e}),setLocationFilter:e=>n({locationFilter:e}),setStatusFilter:e=>n({statusFilter:e}),setActiveFilter:e=>n({activeFilter:e}),setFavorites:e=>{n({favorites:e}),Vu(e)},toggleFavorite:e=>n(t=>{const r=t.favorites.includes(e)?t.favorites.filter(s=>s!==e):[...t.favorites,e];return Vu(r),{favorites:r}}),setShowFavoritesOnly:e=>n({showFavoritesOnly:e}),setSortField:e=>n({sortField:e}),setSortDirection:e=>n({sortDirection:e}),clearFilters:()=>n({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:""}),resetFilters:()=>n({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",sortField:"name",sortDirection:"asc",showFavoritesOnly:!1}),clearSearch:()=>n({searchQuery:"",searchTerm:""})});var oP=Object.defineProperty,lP=Object.defineProperties,cP=Object.getOwnPropertyDescriptors,Wu=Object.getOwnPropertySymbols,dP=Object.prototype.hasOwnProperty,uP=Object.prototype.propertyIsEnumerable,Gu=(n,e,t)=>e in n?oP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Hi=(n,e)=>{for(var t in e||(e={}))dP.call(e,t)&&Gu(n,t,e[t]);if(Wu)for(var t of Wu(e))uP.call(e,t)&&Gu(n,t,e[t]);return n},mP=(n,e)=>lP(n,cP(e));function Ku(){return{id:"",itemName:"",category:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:0,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const hP=(n,e)=>({formData:Ku(),isEditMode:!1,isDirty:!1,isCloned:!1,setFormData:t=>n({formData:t,isDirty:!1}),mergeFormData:t=>{console.log("🔍 mergeFormData called with:",t),n(r=>({formData:Hi(Hi({},r.formData),t),isDirty:!0}))},updateField:(t,r)=>n(s=>({formData:mP(Hi({},s.formData),{[t]:r}),isDirty:!0})),resetForm:()=>n({formData:Ku(),isEditMode:!1,isDirty:!1,isCloned:!1}),setEditMode:t=>n({isEditMode:t}),setIsCloned:t=>n({isCloned:t}),markAsDirty:()=>n({isDirty:!0}),markAsClean:()=>n({isDirty:!1}),openEditModal:t=>{var r;const{setFormData:s,setEditMode:i}=e(),l={id:t.id,itemName:t.name||t.item||"",category:t.category||"",location:t.location||"",status:t.status||"",quantity:t.quantity||1,unitCost:t.unit_cost||0,minimumQuantity:t.reorder_point||0,maximumQuantity:((r=t.data)==null?void 0:r.maximumQuantity)||0,supplier:t.supplier||"",barcode:t.barcode||"",sku:t.sku||"",description:t.description||"",notes:t.notes||"",updated_at:t.updated_at||new Date().toISOString(),createdAt:t.created_at||new Date().toISOString()};s(l),i(!0)},closeEditModal:()=>{const{resetForm:t}=e();t()}}),pP=n=>({currentPage:1,itemsPerPage:10,totalItems:0,setCurrentPage:e=>n({currentPage:e}),setItemsPerPage:e=>n({itemsPerPage:e,currentPage:1}),setTotalItems:e=>n({totalItems:e}),nextPage:()=>n(e=>{const t=Math.ceil(e.totalItems/e.itemsPerPage);return{currentPage:Math.min(e.currentPage+1,t)}}),previousPage:()=>n(e=>({currentPage:Math.max(e.currentPage-1,1)})),goToPage:e=>n(t=>{const r=Math.ceil(t.totalItems/t.itemsPerPage);return{currentPage:Math.max(1,Math.min(e,r))}}),resetPagination:()=>n({currentPage:1}),get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)},get startIndex(){return(this.currentPage-1)*this.itemsPerPage},get endIndex(){return Math.min(this.startIndex+this.itemsPerPage,this.totalItems)},get pagination(){return{currentPage:this.currentPage,pageSize:this.itemsPerPage}}});var fP=Object.defineProperty,Qu=Object.getOwnPropertySymbols,gP=Object.prototype.hasOwnProperty,yP=Object.prototype.propertyIsEnumerable,Yu=(n,e,t)=>e in n?fP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,vP=(n,e)=>{for(var t in e||(e={}))gP.call(e,t)&&Yu(n,t,e[t]);if(Qu)for(var t of Qu(e))yP.call(e,t)&&Yu(n,t,e[t]);return n};const _P=n=>({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1,setAnalyticsData:e=>n({analyticsData:e}),setLoadingAnalytics:e=>n({isLoadingAnalytics:e}),updateAnalytics:()=>{n(()=>({isLoadingAnalytics:!0})),setTimeout(()=>{n(e=>({isLoadingAnalytics:!1,analyticsData:vP({},e.analyticsData)}))},1e3)},resetAnalytics:()=>n({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1})});var xP=Object.defineProperty,Ju=Object.getOwnPropertySymbols,bP=Object.prototype.hasOwnProperty,wP=Object.prototype.propertyIsEnumerable,Xu=(n,e,t)=>e in n?xP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,xr=(n,e)=>{for(var t in e||(e={}))bP.call(e,t)&&Xu(n,t,e[t]);if(Ju)for(var t of Ju(e))wP.call(e,t)&&Xu(n,t,e[t]);return n};const SP=Et()((...n)=>xr(xr(xr(xr(xr(xr(xr({},Qk(...n)),nP(...n)),sP(...n)),iP(...n)),hP(...n)),pP(...n)),_P(...n))),Bt=()=>SP();function CP({scanMode:n,scannedItems:e,currentScannedItemIndex:t,setCurrentScannedItemIndex:r,resetScannedItems:s,handleCloseAddModal:i,handleOpenAddItemModalWithBarcode:l}){const c=h.useCallback(()=>{if(n==="add"&&e.length>0){const d=t+1;d<e.length?(r(d),l(e[d])):(r(0),s())}},[n,e,t,r,s,i,l]),o=h.useCallback(()=>{if(n==="add"&&e.length>0){const d=e[t],u=d.split("-"),m=u.length>=3?u.slice(2).join("-"):d;return{current:t+1,total:e.length,currentItemName:m}}},[n,e,t]);return{handleAddItemModalClosed:c,getProgressInfo:o}}const IP=n=>{var e;if(!n)return null;const t=n.split("-");if(t.length>=3){const r=((e=t[0])==null?void 0:e.toUpperCase())||"",s=t[1]||"",i=t.slice(2).join("-");let l="tools";if(r==="TOOL")l="tools";else if(r==="SUPPLY")l="supplies";else if(r==="EQUIP")l="equipment";else if(r==="HARDWARE")l="officeHardware";else if(r==="INV"){const c=i.toLowerCase();c.includes("scissors")||c.includes("forceps")||c.includes("scalpel")?l="tools":c.includes("bandage")||c.includes("gauze")||c.includes("tape")?l="supplies":c.includes("monitor")||c.includes("machine")||c.includes("device")?l="equipment":l="tools"}return{itemId:s,itemName:i,category:l}}return n.length>0?{itemId:n||"",itemName:n||"",category:"tools"}:null},ef=n=>{if(!n)return{item:"",category:"",toolId:"",location:"",cost:0,p2Status:"clean",barcode:""};const e=IP(n);return e?{item:e.itemName,category:e.category,toolId:e.itemId,location:"",cost:0,p2Status:"clean",barcode:n}:{item:n,category:"tools",toolId:n,location:"",cost:0,p2Status:"clean",barcode:n}},tf=n=>{const e=ef(n);return{itemName:e.item,category:e.category,id:e.toolId,location:e.location,purchaseDate:"",vendor:"",cost:e.cost.toString(),warranty:"",maintenanceSchedule:"",lastServiced:"",nextDue:"",serviceProvider:"",assignedTo:"",status:e.p2Status,quantity:"1",notes:"",barcode:e.barcode}},rf=n=>({id:n.id,itemName:n.itemName,category:n.category,location:n.location,status:n.status,quantity:parseInt(n.quantity)||1,unitCost:parseFloat(n.cost)||0,minimumQuantity:0,maximumQuantity:999,supplier:n.vendor,barcode:n.barcode,sku:"",description:"",notes:n.notes,updated_at:new Date().toISOString(),createdAt:n.purchaseDate||new Date().toISOString()}),jP=n=>({id:n.toolId,itemName:n.item,category:n.category,location:n.location,status:n.p2Status,quantity:1,unitCost:n.cost,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:n.barcode,sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}),EP=()=>{const{scanMode:n,scannedItems:e,setScanMode:t,resetScannedItems:r,setShowScanModal:s,formData:i,setFormData:l,isEditMode:c}=Bt(),[o,d]=h.useState(0),u=h.useCallback((f,g)=>{const y=ef(g),v=jP(y);l(v),f()},[l]),{getProgressInfo:m}=CP({scanMode:n,scannedItems:e,currentScannedItemIndex:o,setCurrentScannedItemIndex:d,resetScannedItems:r,handleCloseAddModal:()=>{},handleOpenAddItemModalWithBarcode:f=>u(()=>{},f)}),p=h.useCallback(()=>{t(null),r(),s(!0)},[t,r,s]);return{scanMode:n,scannedItems:e,currentScannedItemIndex:o,storeFormData:i,isEditMode:c,handleScanClick:p,handleOpenAddItemModalWithBarcode:u,getProgressInfo:m,setFormData:l,setScanMode:t,resetScannedItems:r,setShowScanModal:s}};function TP(){const n=h.useRef(null),e=h.useRef(new Set),[t,r]=h.useState(!1),s=h.useRef(!1);h.useEffect(()=>{if(!s.current)try{console.log("🔔 Setting up real-time inventory subscription via useInventoryRealtimeUpdates");const o=Mt.subscribeToChanges(()=>{console.log("Inventory changes detected")});return n.current=o,s.current=!0,setTimeout(()=>{r(!0)},0),()=>{n.current&&typeof n.current=="function"&&(n.current(),n.current=null),r(!1),s.current=!1}}catch(o){console.error("❌ Failed to set up real-time subscription in useInventoryRealtimeUpdates:",o),setTimeout(()=>{r(!1)},0),s.current=!1;return}},[]);const i=h.useCallback(o=>(e.current.add(o),()=>{e.current.delete(o)}),[]),l=h.useCallback(o=>{e.current.delete(o)},[]),c=h.useCallback(()=>{e.current.forEach(o=>{try{o()}catch(d){console.error("Error in refresh callback:",d)}})},[]);return{registerRefreshCallback:i,unregisterRefreshCallback:l,triggerRefresh:c,isSubscribed:t}}function NP({openAddModal:n,closeAddModal:e,setEditMode:t,resetForm:r,setExpandedSections:s,setFormData:i}){const l=h.useCallback(()=>{n(),t(!1),s(_d())},[n,t,s]),c=h.useCallback(()=>{e(),s(_d())},[e,r,s]),o=h.useCallback(d=>{let u;const m=d.data;m!=null&&m.toolId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{toolId:m.toolId,p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:m!=null&&m.supplyId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{supplyId:m.supplyId,expiration:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:m!=null&&m.equipmentId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{equipmentId:m.equipmentId,lastServiced:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:m!=null&&m.hardwareId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{hardwareId:m.hardwareId,warranty:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null}:u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{toolId:"",p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location,supplier:null,cost:null,vendor:null,warranty:null,tool_id:null,description:null,barcode:null,sku:null,serial_number:null,manufacturer:null,last_serviced:null,unit:null,notes:null,tags:null,image_url:null,is_active:null,tracked:null,favorite:null,purchase_date:null,last_updated:null,current_phase:null,p2_status:null,supply_id:null,equipment_id:null,hardware_id:null,service_provider:null,assigned_to:null,maintenance_schedule:null,next_due:null,expiration:null},i(QS(u)),t(!0),n()},[i,t,n]);return{handleShowAddModal:l,handleCloseAddModal:c,handleEditClick:o}}const kP=({expandedSections:n,setExpandedSections:e,mergeFormData:t})=>({handleFormChangeWrapper:(s,i)=>{if(console.log("🛠 handleFormChangeWrapper invoked. Field:",s,"Value:",i,"mergeFormData type:",typeof t),typeof t!="function"){console.error("❌ mergeFormData is not a function inside useInventoryFormHandlers!");return}t(s==="category"?{category:i}:{[s]:i})},handleToggleSection:s=>{e(n.includes(s)?n.filter(i=>i!==s):[...n,s])}});function PP(n,e){return{handleToggleFavorite:h.useCallback(r=>{const s=GS(new Set(n),r);e(Array.from(s))},[n,e])}}const DP=()=>{const n=Or(),e=h.useMemo(()=>[...n.tools,...n.supplies,...n.equipment,...n.officeHardware],[n.tools,n.supplies,n.equipment,n.officeHardware]);return{getAllItems:()=>e,getItemsByCategory:t=>e.filter(s=>{var i;return((i=s.category)==null?void 0:i.toLowerCase())===t.toLowerCase()}),getFilteredItems:n.getFilteredData,getCategories:n.getCategories,fetchData:n.refreshData,inventoryData:e}},AP=()=>{const{showAddModal:n,showTrackModal:e,showUploadBarcodeModal:t,showScanModal:r,openAddModal:s,closeAddModal:i,openTrackModal:l,closeTrackModal:c,openUploadBarcodeModal:o,closeUploadBarcodeModal:d,openScanModal:u,closeScanModal:m,formData:p,setFormData:f,mergeFormData:g,updateField:y,isEditMode:v,setEditMode:x,expandedSections:b,setExpandedSections:C,resetForm:k}=Bt(),P=h.useCallback(()=>{x(!1),k(),s()},[x,k,s]),E=h.useCallback(M=>{x(!0),f(M),s()},[x,f,s]),$=h.useCallback(()=>{i(),x(!1),k()},[i,x,k]),w=h.useCallback(()=>{l()},[l]),S=h.useCallback(()=>{c()},[c]),A=h.useCallback(()=>{o()},[o]),I=h.useCallback(()=>{d()},[d]),T=h.useCallback(()=>{u()},[u]),j=h.useCallback(()=>{m()},[m]);return{showAddModal:n,showTrackModal:e,showUploadBarcodeModal:t,showScanModal:r,formData:p,isEditMode:v,expandedSections:b,openAddModal:P,openEditModal:E,openTrackModal:w,openUploadBarcodeModal:A,openScanModal:T,closeAddModal:$,closeTrackModal:S,closeUploadBarcodeModal:I,closeScanModal:j,setFormData:f,mergeFormData:g,updateField:y,setExpandedSections:C}};var OP=Object.defineProperty,RP=Object.defineProperties,$P=Object.getOwnPropertyDescriptors,Zu=Object.getOwnPropertySymbols,MP=Object.prototype.hasOwnProperty,FP=Object.prototype.propertyIsEnumerable,em=(n,e,t)=>e in n?OP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ls=(n,e)=>{for(var t in e||(e={}))MP.call(e,t)&&em(n,t,e[t]);if(Zu)for(var t of Zu(e))FP.call(e,t)&&em(n,t,e[t]);return n},cs=(n,e)=>RP(n,$P(e)),LP=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const nf=()=>{const n=AP(),{refreshData:e}=Or(),{searchQuery:t,setSearchQuery:r,favorites:s,setFavorites:i,trackedItems:l,trackingData:c,toggleTrackedItem:o}=Bt(),d=h.useCallback((w,S)=>{console.log(`🔄 Form field changed: ${w} = "${S}"`),console.log("📝 Current form data before update:",n.formData),console.log("🔍 Calling updateField with:",w,S),n.updateField(w,S),console.log("📝 Form data after update should be updated in store")},[n]),u=h.useCallback(w=>{n.setExpandedSections(cs(ls({},n.expandedSections),{[w]:!n.expandedSections[w]}))},[n]),m=h.useCallback(w=>{const A=(T=>{if(!T)return 0;if(typeof T=="number")return T;const j=T.toString().replace(/[$,\s]/g,""),M=parseFloat(j);return isNaN(M)?0:M})(w.unitCost);console.log(`💰 Cost parsing: "${w.unitCost}" -> ${A}`);const I={name:w.itemName||"",category:w.category||"",location:w.location||"",status:w.status||"Active",quantity:w.quantity||1,unit_cost:A,facility_id:"unknown",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:(typeof w.reorder_point=="number"?w.reorder_point:0)||0,expiration_date:(typeof w.expiry_date=="string"?w.expiry_date:"")||"",supplier:(typeof w.supplier=="string"?w.supplier:"")||"",cost:A,vendor:(typeof w.supplier=="string"?w.supplier:"")||"",warranty:(typeof w.warranty=="string"?w.warranty:"")||"",maintenance_schedule:"",next_due:"",service_provider:"",assigned_to:"",notes:w.notes||"",tool_id:"",supply_id:"",equipment_id:"",hardware_id:"",p2_status:"",serial_number:(typeof w.serialNumber=="string"?w.serialNumber:"")||"",manufacturer:(typeof w.manufacturer=="string"?w.manufacturer:"")||"",image_url:"",tags:[],favorite:!1,tracked:!0,barcode:w.barcode||"",sku:w.sku||"",description:w.description||"",current_phase:"Active",is_active:!0,unit:"",expiration:(typeof w.expiry_date=="string"?w.expiry_date:"")||"",purchase_date:(typeof w.purchaseDate=="string"?w.purchaseDate:"")||"",last_serviced:"",last_updated:new Date().toISOString(),data:{warranty:w.warranty||"",notes:w.notes||"",purchaseDate:w.purchaseDate||"",supplier:w.supplier||"",manufacturer:w.manufacturer||"",expiry_date:w.expiry_date||"",assetTag:w.assetTag||"",brand:w.brand||"",model:w.model||"",serialNumber:w.serialNumber||"",barcode:w.barcode||"",sku:w.sku||"",description:w.description||"",tags:[],imageUrl:"",isActive:!0,tracked:!0,favorite:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),currentPhase:"Active",p2Status:"",toolId:"",supplyId:"",equipmentId:"",hardwareId:"",serviceProvider:"",assignedTo:""}};return console.log("📦 Converted item to save:",I),I},[]),p=h.useCallback(()=>LP(null,null,function*(){try{console.log("🔄 Starting save process..."),console.log("📝 Form data:",n.formData);const w=m(cs(ls({},n.formData),{name:n.formData.itemName,category:n.formData.category,quantity:n.formData.quantity,location:n.formData.location,manufacturer:n.formData.manufacturer,supplier:n.formData.supplier,expiry_date:n.formData.expiry_date}));if(console.log("💾 Item to save:",w),n.isEditMode){if(n.formData.id){console.log("✏️ Updating existing item...");const S=yield Mt.updateItem(n.formData.id,w);if(console.log("✅ Update response:",S),S.error)throw new Error(`Update failed: ${S.error}`);if(S.data){console.log("✅ Item updated successfully:",S.data);const I=(T=>{var j,M,B,G,Y,R,D,U,F,V,q,W,ee;return{itemName:T.name||T.item||"",category:T.category||"",id:T.id||"",location:T.location||"",createdAt:((j=T.data)==null?void 0:j.purchaseDate)||new Date().toISOString(),supplier:T.supplier||"",unit_cost:T.unit_cost||0,notes:((M=T.data)==null?void 0:M.notes)||"",updated_at:((B=T.data)==null?void 0:B.lastServiced)||new Date().toISOString(),status:T.status||"",quantity:T.quantity||1,reorder_point:T.reorder_point||0,barcode:((G=T.data)==null?void 0:G.barcode)||"",sku:((Y=T.data)==null?void 0:Y.sku)||"",description:((R=T.data)==null?void 0:R.description)||"",unitCost:T.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((D=T.data)==null?void 0:D.warranty)||"",purchaseDate:((U=T.data)==null?void 0:U.purchaseDate)||"",expiry_date:((F=T.data)==null?void 0:F.expiry_date)||"",assetTag:((V=T.data)==null?void 0:V.assetTag)||"",brand:((q=T.data)==null?void 0:q.brand)||"",model:((W=T.data)==null?void 0:W.model)||"",serialNumber:((ee=T.data)==null?void 0:ee.serialNumber)||"",manufacturer:T.manufacturer||""}})(S.data);n.setFormData(I)}else throw new Error("Update succeeded but no data returned")}}else{console.log("➕ Creating new item...");const S=yield Mt.createItem(w);if(console.log("✅ Create response:",S),S.error)throw new Error(`Create failed: ${S.error}`);if(!S.data)throw new Error("Create succeeded but no data returned")}console.log("✅ Item saved successfully!"),console.log("🔄 Refreshing inventory data..."),yield e(),console.log("✅ Inventory data refreshed!"),console.log("🧹 Clearing analytics cache..."),Mt.clearCache(),console.log("✅ Analytics cache cleared!")}catch(w){console.error("❌ Failed to save item:",w)}}),[n,m,e]),f=h.useCallback(()=>{},[]),g=h.useCallback(w=>{const S=new Set(s);S.has(w)?S.delete(w):S.add(w),i(Array.from(S))},[s,i]),y=h.useCallback((w,S)=>{o(w,S)},[o]),v=h.useCallback(w=>{r(w)},[r]),x=h.useCallback(w=>{const A=(I=>{var T,j,M,B,G,Y,R,D,U,F,V,q,W;return{itemName:I.name||I.item||"",category:I.category||"",id:I.id||"",location:I.location||"",createdAt:((T=I.data)==null?void 0:T.purchaseDate)||new Date().toISOString(),supplier:I.supplier||"",unit_cost:I.unit_cost||0,notes:((j=I.data)==null?void 0:j.notes)||"",updated_at:((M=I.data)==null?void 0:M.lastServiced)||new Date().toISOString(),status:I.status||"",quantity:I.quantity||1,reorder_point:I.reorder_point||0,barcode:((B=I.data)==null?void 0:B.barcode)||"",sku:((G=I.data)==null?void 0:G.sku)||"",description:((Y=I.data)==null?void 0:Y.description)||"",unitCost:I.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((R=I.data)==null?void 0:R.warranty)||"",purchaseDate:((D=I.data)==null?void 0:D.purchaseDate)||"",expiry_date:((U=I.data)==null?void 0:U.expiry_date)||"",assetTag:((F=I.data)==null?void 0:F.assetTag)||"",brand:((V=I.data)==null?void 0:V.brand)||"",model:((q=I.data)==null?void 0:q.model)||"",serialNumber:((W=I.data)==null?void 0:W.serialNumber)||"",manufacturer:I.manufacturer||""}})(w);n.openEditModal(A)},[n]),b=h.useCallback(()=>{n.openAddModal()},[n]),C=h.useCallback(w=>{console.log("🔄 Cloning item:",w);const A=(T=>{var j,M,B,G,Y,R,D,U,F,V,q,W,ee;return{itemName:T.name||T.item||"",category:T.category||"",id:T.id||"",location:T.location||"",createdAt:((j=T.data)==null?void 0:j.purchaseDate)||new Date().toISOString(),supplier:T.supplier||"",unit_cost:T.unit_cost||0,notes:((M=T.data)==null?void 0:M.notes)||"",updated_at:((B=T.data)==null?void 0:B.lastServiced)||new Date().toISOString(),status:T.status||"",quantity:T.quantity||1,reorder_point:T.reorder_point||0,barcode:((G=T.data)==null?void 0:G.barcode)||"",sku:((Y=T.data)==null?void 0:Y.sku)||"",description:((R=T.data)==null?void 0:R.description)||"",unitCost:T.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((D=T.data)==null?void 0:D.warranty)||"",purchaseDate:((U=T.data)==null?void 0:U.purchaseDate)||"",expiry_date:((F=T.data)==null?void 0:F.expiry_date)||"",assetTag:((V=T.data)==null?void 0:V.assetTag)||"",brand:((q=T.data)==null?void 0:q.brand)||"",model:((W=T.data)==null?void 0:W.model)||"",serialNumber:((ee=T.data)==null?void 0:ee.serialNumber)||"",manufacturer:T.manufacturer||""}})(w),I=cs(ls({},A),{id:"",barcode:"",itemName:`${A.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("📋 Cloned form data:",I),n.setFormData(I),n.openAddModal()},[n]),k=h.useCallback(()=>{console.log("🔄 Cloning current form data");const w=n.formData,S=cs(ls({},w),{id:"",barcode:"",sku:"",itemName:`${w.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("📋 Cloned form data:",S),n.closeAddModal(),n.setFormData(S),n.openAddModal()},[n]),P=h.useCallback(()=>{n.openTrackModal()},[n]),E=h.useCallback(()=>{n.openUploadBarcodeModal()},[n]),$=h.useCallback(()=>{n.openScanModal()},[n]);return cs(ls({},n),{handleFormChange:d,toggleSection:u,handleSaveItem:p,handleDeleteItem:f,handleEditItem:x,handleAddItem:b,handleCloneItem:C,handleCloneCurrentForm:k,openAddModal:b,handleTrackItem:y,handleSearchChange:v,handleOpenTrackModal:P,handleOpenUploadBarcodeModal:E,handleOpenScanModal:$,toggleFavorite:g,searchQuery:t,favorites:s,trackedItems:l,trackingData:c})};var zP=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const sf=()=>{const n=Bt(),{formData:e,setFormData:t,isEditMode:r,setEditMode:s,favorites:i,setFavorites:l,expandedSections:c,setExpandedSections:o,openAddModal:d,closeAddModal:u,setActiveTab:m,showTrackedOnly:p,setShowTrackedOnly:f,showFavoritesOnly:g,setShowFavoritesOnly:y,searchQuery:v,setSearchQuery:x}=n,b=n.mergeFormData;typeof b!="function"&&console.error("❌ mergeFormData is NOT a function! Store might not be wired correctly."),DP();const{handleToggleSection:C,handleFormChangeWrapper:k}=kP({expandedSections:c,setExpandedSections:o,mergeFormData:b}),{handleToggleFavorite:P}=PP(i,l),{handleCloneItem:E}=nf(),{handleShowAddModal:$,handleCloseAddModal:w}=NP({openAddModal:d,closeAddModal:u,setEditMode:s,resetForm:()=>{},setExpandedSections:o,setFormData:t}),S=h.useCallback(R=>R,[]),A=h.useCallback(R=>R,[]),I=h.useCallback(R=>{m(R)},[m]),T=h.useCallback(()=>{f(!p)},[p,f]),j=h.useCallback(()=>{y(!g)},[g,y]),M=h.useCallback(R=>x(R),[x]),B=h.useCallback(R=>{const D={itemName:R.name||R.item||"",category:R.category||"",id:R.id,location:R.location||"",createdAt:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.purchaseDate:null)||new Date().toISOString(),supplier:R.supplier||"",unit_cost:R.unit_cost||0,unitCost:R.unit_cost||0,notes:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.notes:null)||"",updated_at:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.lastServiced:null)||new Date().toISOString(),status:R.status||"",quantity:R.quantity||1,reorder_point:R.reorder_point||0,minimumQuantity:0,maximumQuantity:999,barcode:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.barcode:null)||"",sku:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.sku:null)||"",description:(R.data&&typeof R.data=="object"&&R.data!==null?R.data.description:null)||""};t(D),s(!0),d()},[t,s,d]),G=h.useCallback(()=>zP(null,null,function*(){if(!e)return;const R={name:e.itemName||"",category:e.category||"",location:e.location||"",status:e.status||"active",quantity:e.quantity||0,unit_cost:e.unitCost||0,description:e.description||"",notes:e.notes||"",supplier:e.supplier||"",barcode:e.barcode||"",sku:e.sku||"",updated_at:new Date().toISOString()};try{r&&e.id?yield Cs.handleUpdateItem(e.id,R,()=>console.log("Item updated successfully"),D=>console.error("Update failed:",D)):yield Cs.handleCreateItem(R,()=>console.log("Item created successfully"),D=>console.error("Creation failed:",D)),w()}catch(D){console.error("❌ Inventory save failed",D)}}),[e,r,w]),Y=h.useMemo(()=>[],[]);return{showTrackedOnly:p,showFavoritesOnly:g,searchQuery:v,expandedSections:c,favorites:i,filteredTools:Y,isEditMode:r,handleShowAddModal:$,handleCloseAddModal:w,handleEditItem:B,handleCloneItem:E,handleToggleTrackedFilter:T,handleToggleFavoritesFilter:j,onCategoryChange:I,setSearchTerm:M,handleSave:G,handleToggleSection:C,handleFormChangeWrapper:k,handleToggleFavorite:P,getStatusBadge:S,getStatusText:A}},BP=h.createContext(void 0),qP=n=>{const e=KS(),t="itemName"in n?n.itemName:n.name||n.item||"",r=n.category,s=n.id,i=n.location||"",l=n.unit_cost,c=typeof l=="number"?l.toString()||"0":l||"0",o=n.status||"";return{itemName:String(t||e.itemName||""),category:String(r||e.category||""),id:String(s||e.id||""),location:String(i||e.location||""),status:String(o||e.status),quantity:Number((n==null?void 0:n.quantity)||e.quantity),unitCost:Number(c),minimumQuantity:0,maximumQuantity:Number(e.maximumQuantity),supplier:String((n==null?void 0:n.supplier)||e.supplier||""),barcode:String((n==null?void 0:n.barcode)||e.barcode||""),sku:String((n==null?void 0:n.sku)||e.sku||""),description:String((n==null?void 0:n.description)||e.description||""),notes:String((n==null?void 0:n.notes)||e.notes||""),updated_at:String((n==null?void 0:n.updated_at)||e.updated_at||new Date().toISOString()),createdAt:String((n==null?void 0:n.createdAt)||e.createdAt||new Date().toISOString())}},tm={ADD_ITEM:{id:"add-item-modal",title:"Add New Item",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!0,className:"inventory-modal"},SCAN_ITEM:{id:"scan-item-modal",title:"Scan Items",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!1,className:"scan-modal"}},af=[{id:"general",title:"General Information",defaultExpanded:!0,fields:[{name:"itemName",label:"Item Name",type:"text",required:!0,placeholder:"Enter item name"},{name:"category",label:"Category",type:"select",required:!0,options:[{value:"tools",label:"Tools"},{value:"supplies",label:"Supplies"},{value:"equipment",label:"Equipment"},{value:"officeHardware",label:"Office Hardware"}]},{name:"id",label:"ID / Serial #",type:"text",required:!0,placeholder:"Enter ID or serial number"},{name:"location",label:"Location",type:"location",required:!0}]},{id:"purchase",title:"Purchase Information",defaultExpanded:!1,fields:[{name:"purchaseDate",label:"Purchase Date",type:"date",required:!1},{name:"vendor",label:"Vendor",type:"text",required:!1,placeholder:"Enter vendor name"},{name:"unitCost",label:"Cost",type:"text",required:!0,placeholder:"Enter cost (e.g., $25.99, 15.50)"},{name:"warranty",label:"Warranty",type:"text",required:!1,placeholder:"Enter warranty information"}]},{id:"maintenance",title:"Maintenance Information",defaultExpanded:!1,fields:[{name:"maintenanceSchedule",label:"Maintenance Schedule",type:"text",required:!1,placeholder:"Enter maintenance schedule"},{name:"lastServiced",label:"Last Serviced",type:"date",required:!1},{name:"nextDue",label:"Next Due",type:"date",required:!1},{name:"serviceProvider",label:"Service Provider",type:"text",required:!1,placeholder:"Enter service provider"}]},{id:"usage",title:"Usage Information",defaultExpanded:!1,fields:[{name:"assignedTo",label:"Assigned To",type:"text",required:!1,placeholder:"Enter assigned person"},{name:"status",label:"Status",type:"select",required:!1,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"p2",label:"P2"},{value:"n/a",label:"N/A"}]},{name:"isP2Status",label:"P2 Tool",type:"select",required:!1,options:[{value:"false",label:"No"},{value:"true",label:"Yes"}]},{name:"quantity",label:"Quantity",type:"number",required:!0,placeholder:"Enter quantity",validation:{min:0}},{name:"notes",label:"Notes",type:"textarea",required:!1,placeholder:"Additional notes"}]}],UP=(n,e=!1)=>{const t={};for(const r of af)for(const s of r.fields)if(!(s.name==="id"&&!e)&&(s.required&&!n[s.name]&&(t[s.name]=`${s.label} is required`),s.validation&&n[s.name])){const i=n[s.name];s.validation.min!==void 0&&Number(i)<s.validation.min&&(t[s.name]=`${s.label} must be at least ${s.validation.min}`),s.validation.max!==void 0&&Number(i)>s.validation.max&&(t[s.name]=`${s.label} must be at most ${s.validation.max}`),s.validation.pattern&&typeof i=="string"&&(new RegExp(s.validation.pattern).test(i)||(t[s.name]=s.validation.message||`${s.label} format is invalid`))}return t};var HP=Object.defineProperty,VP=Object.defineProperties,WP=Object.getOwnPropertyDescriptors,rm=Object.getOwnPropertySymbols,GP=Object.prototype.hasOwnProperty,KP=Object.prototype.propertyIsEnumerable,nm=(n,e,t)=>e in n?HP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ca=(n,e)=>{for(var t in e||(e={}))GP.call(e,t)&&nm(n,t,e[t]);if(rm)for(var t of rm(e))KP.call(e,t)&&nm(n,t,e[t]);return n},da=(n,e)=>VP(n,WP(e));const QP=()=>{const[n,e]=h.useState({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1}),t=()=>{if(!navigator.geolocation){e(s=>da(ca({},s),{error:"Geolocation is not supported by this browser.",isLoading:!1}));return}e(s=>da(ca({},s),{isLoading:!0,error:null})),navigator.geolocation.getCurrentPosition(s=>{e({latitude:s.coords.latitude,longitude:s.coords.longitude,accuracy:s.coords.accuracy,error:null,isLoading:!1})},s=>{let i="Unknown error occurred";switch(s.code){case s.PERMISSION_DENIED:i="Location access denied. Please enable location services.";break;case s.POSITION_UNAVAILABLE:i="Location information unavailable.";break;case s.TIMEOUT:i="Location request timed out.";break}e(l=>da(ca({},l),{error:i,isLoading:!1}))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},r=()=>{e({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1})};return da(ca({},n),{getCurrentLocation:t,clearLocation:r})};var YP=Object.defineProperty,JP=Object.defineProperties,XP=Object.getOwnPropertyDescriptors,sm=Object.getOwnPropertySymbols,ZP=Object.prototype.hasOwnProperty,eD=Object.prototype.propertyIsEnumerable,am=(n,e,t)=>e in n?YP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Vi=(n,e)=>{for(var t in e||(e={}))ZP.call(e,t)&&am(n,t,e[t]);if(sm)for(var t of sm(e))eD.call(e,t)&&am(n,t,e[t]);return n},im=(n,e)=>JP(n,XP(e));const Uo=Et()(Ua((n,e)=>({rooms:[],addRoom:t=>{const r=im(Vi({},t),{id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});n(s=>({rooms:[...s.rooms,r]}))},updateRoom:(t,r)=>{n(s=>({rooms:s.rooms.map(i=>i.id===t?im(Vi(Vi({},i),r),{updatedAt:new Date().toISOString()}):i)}))},deleteRoom:t=>{n(r=>({rooms:r.rooms.filter(s=>s.id!==t)}))},getActiveRooms:()=>e().rooms.filter(t=>t.isActive),getRoomsByDepartment:t=>e().rooms.filter(r=>r.department===t&&r.isActive),getRoomByBarcode:t=>e().rooms.find(r=>r.barcode===t&&r.isActive)}),{name:"room-storage"})),tD=Object.freeze(Object.defineProperty({__proto__:null,useRoomStore:Uo},Symbol.toStringTag,{value:"Module"}));var rD=Object.defineProperty,nD=Object.defineProperties,sD=Object.getOwnPropertyDescriptors,om=Object.getOwnPropertySymbols,aD=Object.prototype.hasOwnProperty,iD=Object.prototype.propertyIsEnumerable,lm=(n,e,t)=>e in n?rD(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,oD=(n,e)=>{for(var t in e||(e={}))aD.call(e,t)&&lm(n,t,e[t]);if(om)for(var t of om(e))iD.call(e,t)&&lm(n,t,e[t]);return n},lD=(n,e)=>nD(n,sD(e));const cD=(n,e)=>{const r=n.latitude*Math.PI/180,s=e.latitude*Math.PI/180,i=(e.latitude-n.latitude)*Math.PI/180,l=(e.longitude-n.longitude)*Math.PI/180,c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(s)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},dD=(n,e,t=100)=>{const r=e.filter(l=>l.gpsCoordinates&&l.isActive);if(r.length===0)return null;let s=null,i=1/0;return r.forEach(l=>{if(l.gpsCoordinates){const c=cD(n,l.gpsCoordinates);c<i&&c<=t&&(i=c,s=lD(oD({},l),{distance:Math.round(c)}))}}),s},HR=n=>`${n.latitude.toFixed(6)}, ${n.longitude.toFixed(6)}`,uD=n=>n<1e3?`${Math.round(n)}m`:`${(n/1e3).toFixed(1)}km`,mD=({value:n,onChange:e,placeholder:t="Select location or use GPS",className:r=""})=>{const[s,i]=h.useState(!1),[l,c]=h.useState("room"),{getCurrentLocation:o,latitude:d,longitude:u,accuracy:m,isLoading:p}=QP(),{getActiveRooms:f}=Uo(),g=f(),[y,v]=h.useState(null),x=E=>{c(E),v(null),E==="gps"?o():E==="manual"&&e("")},b=E=>{e(E),i(!1)},C=()=>{if(d&&u){const E=dD({latitude:d,longitude:u},g,50);if(E)v({room:E,distance:E.distance||0}),e(E.name);else{const $=`GPS: ${d.toFixed(6)}, ${u.toFixed(6)}`;e($),v(null)}i(!1)}},k=E=>{e(E.target.value)},P=()=>l==="gps"&&d&&u?`GPS: ${d.toFixed(6)}, ${u.toFixed(6)}`:n;return a.jsxs("div",{className:`relative ${r}`,children:[a.jsxs("div",{className:"flex flex-col space-y-2",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("button",{type:"button",onClick:()=>x("room"),className:`px-3 py-1 text-xs rounded-md transition-colors ${l==="room"?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[a.jsx(N,{path:no,size:.8,className:"inline mr-1"}),"Room"]}),a.jsxs("button",{type:"button",onClick:()=>x("gps"),className:`px-3 py-1 text-xs rounded-md transition-colors ${l==="gps"?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[a.jsx(N,{path:Ag,size:.8,className:"inline mr-1"}),"GPS"]}),a.jsx("button",{type:"button",onClick:()=>x("manual"),className:`px-3 py-1 text-xs rounded-md transition-colors ${l==="manual"?"bg-purple-100 text-purple-700 border border-purple-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:"Manual"})]}),l==="room"&&a.jsxs("div",{className:"relative",children:[a.jsxs("button",{type:"button",onClick:()=>i(!s),className:"w-full px-3 py-2 text-left border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("span",{className:n?"text-gray-900":"text-gray-500",children:n||t}),a.jsx(N,{path:wn,size:1,className:"float-right mt-1"})]}),s&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:g.length>0?g.map(E=>a.jsxs("button",{type:"button",onClick:()=>b(E.name),className:"w-full px-3 py-2 text-left hover:bg-gray-100 focus:outline-none focus:bg-gray-100",children:[a.jsx("div",{className:"font-medium text-gray-900",children:E.name}),a.jsxs("div",{className:"text-sm text-gray-500",children:[E.department," • ",E.floor]})]},E.id)):a.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No rooms available"})})]}),l==="gps"&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("button",{type:"button",onClick:o,disabled:p,className:"w-full px-3 py-2 text-sm bg-green-100 text-green-700 border border-green-300 rounded-md hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:p?"Getting location...":"Get Current Location"}),y&&a.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsxs("div",{className:"font-medium flex items-center",children:[a.jsx(N,{path:no,size:.8,className:"mr-1"}),"Smart Room Detection"]}),a.jsxs("div",{className:"mt-1",children:["Suggested:"," ",a.jsx("span",{className:"font-medium",children:y.room.name})]}),a.jsxs("div",{className:"text-xs text-blue-600",children:["Distance: ",uD(y.distance)]})]})}),d&&u&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsxs("div",{children:["Latitude: ",d.toFixed(6)]}),a.jsxs("div",{children:["Longitude: ",u.toFixed(6)]}),m&&a.jsxs("div",{children:["Accuracy: ±",Math.round(m),"m"]})]}),a.jsx("button",{type:"button",onClick:C,className:"w-full px-3 py-2 text-sm bg-blue-100 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:y?"Use Suggested Room":"Use GPS Coordinates"})]})]}),l==="manual"&&a.jsx("input",{type:"text",value:n,onChange:k,placeholder:"Enter location manually",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n&&a.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Current location: ",P()]})]})},hD=({field:n,value:e,onChange:t})=>{var r,s,i;const l=c=>{t(c.target.value)};switch(n.type){case"text":return a.jsx("input",{type:"text",className:"form-control py-1 px-2 text-sm",placeholder:n.placeholder,value:e||"",onChange:l,required:n.required});case"number":return a.jsx("input",{type:"number",className:"form-control py-1 px-2 text-sm",placeholder:n.placeholder,value:e||"",onChange:l,required:n.required,min:(r=n.validation)==null?void 0:r.min,max:(s=n.validation)==null?void 0:s.max});case"date":return a.jsx("input",{type:"date",className:"form-control py-1 px-2 text-sm",value:e||"",onChange:l,required:n.required});case"select":return a.jsxs("select",{className:"form-select py-1 px-2 text-sm",value:e||"",onChange:l,required:n.required,children:[a.jsxs("option",{value:"",children:["Select ",n.label.toLowerCase()]}),(i=n.options)==null?void 0:i.map(c=>a.jsx("option",{value:c.value,children:c.label},c.value))]});case"textarea":return a.jsx("textarea",{className:"form-control py-1 px-2 text-sm",placeholder:n.placeholder,rows:2,value:e||"",onChange:l,required:n.required});case"location":return a.jsx(mD,{value:e||"",onChange:t});default:return null}},pD=({section:n,expanded:e,onToggle:t,formData:r,handleFormChange:s})=>a.jsxs("div",{className:"mb-3 border border-gray-200 rounded-lg",children:[a.jsxs("button",{type:"button",onClick:t,className:"w-full p-3 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors rounded-t-lg",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-800",children:n.title}),a.jsx(N,{path:e?wn:Oa,size:1,className:"text-gray-600"})]}),e&&a.jsx("div",{className:"p-3 border-t border-gray-200",children:a.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.fields.map(i=>i.name==="quantity"&&r.category==="tools"?null:a.jsxs("div",{children:[a.jsx("label",{htmlFor:`modal-${i.name}`,className:"block text-xs font-medium text-gray-700 mb-1",children:i.label}),a.jsx(hD,{field:i,value:r[i.name]||"",onChange:l=>s(i.name,l)})]},i.name))})})]}),cm=({modalConfig:n,show:e,onHide:t,formData:r,isEditMode:s,isCloned:i=!1,expandedSections:l,toggleSection:c,handleFormChange:o,onSave:d,onClone:u,progressInfo:m,sections:p,children:f})=>{const g=i?"Cloned Edit Item":s?"Edit Item":n.title;return a.jsxs(St,{show:e,onHide:t,size:n.size,centered:n.centered,backdrop:n.backdrop,keyboard:n.keyboard,scrollable:n.scrollable,className:n.className,children:[a.jsx(St.Header,{closeButton:!0,children:a.jsxs(St.Title,{className:"flex items-center gap-3",children:[g,m&&a.jsxs("div",{className:"text-sm text-gray-500 font-normal",children:["(",m.current," of ",m.total,")"," ",m.currentItemName]})]})}),i&&a.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mx-4 mt-2",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),a.jsxs("div",{className:"ml-3",children:[a.jsxs("p",{className:"text-sm text-yellow-700",children:[a.jsx("strong",{children:"Database Safety Alert:"})," Please update the following fields before saving:"]}),a.jsxs("ul",{className:"mt-2 text-sm text-yellow-700 list-disc list-inside",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"ID/Serial #"})," - Must be unique"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Barcode"})," - Must be unique"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"SKU"})," - Must be unique"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Item Name"}),' - Currently shows "(Copy)" suffix']})]})]})]})}),a.jsxs(St.Body,{className:"max-h-[70vh] overflow-y-auto",children:[m&&a.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Processing scanned items: ",m.current," of"," ",m.total]}),a.jsxs("span",{className:"text-xs text-blue-600",children:[Math.round(m.current/m.total*100),"% complete"]})]}),a.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${m.current/m.total*100}%`}})})]}),a.jsx("div",{style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:a.jsxs("form",{id:"inventory-form",onSubmit:y=>{y.preventDefault(),d&&d()},children:[p==null?void 0:p.map(y=>a.jsx(pD,{section:y,expanded:l[y.id]||!1,onToggle:()=>c(y.id),formData:r,handleFormChange:o},y.id)),f]})})]}),a.jsxs(St.Footer,{className:"pt-2",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:u,className:"bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Clone"}),a.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Cancel"})]}),d&&a.jsx("button",{type:"submit",form:"inventory-form",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:s?"Update Item":"Save Item"})]})]})},fD=h.lazy(()=>L(()=>import("./UploadBarcodeModal-BU05CzBS.js"),__vite__mapDeps([25,2,3,6,1,4,5])));h.lazy(()=>L(()=>import("./EnhancedTrackModal-9-SjMYXF.js"),__vite__mapDeps([26,2,3,6,1,4,5,27])));const gD=()=>{const{showAddModal:n,showUploadBarcodeModal:e,showScanModal:t,closeAddModal:r,closeUploadBarcodeModal:s,closeScanModal:i,formData:l,isEditMode:c,expandedSections:o,handleFormChange:d,toggleSection:u,handleSaveItem:m,handleCloneCurrentForm:p}=nf(),f=()=>{console.log("🔍 Save button clicked!"),console.log("📝 Current form data:",l),console.log("🔍 Is edit mode:",c);const y=UP(l,c);if(console.log("🔍 Validation errors:",y),Object.keys(y).length===0)console.log("✅ Validation passed, calling handleSaveItem..."),m();else{console.error("❌ Validation errors:",y);return}},g=y=>{u(y)};return a.jsxs(a.Fragment,{children:[a.jsx(cm,{modalConfig:tm.ADD_ITEM,show:n,onHide:r,formData:l,isEditMode:c,expandedSections:o,toggleSection:g,handleFormChange:d,onSave:f,onClone:p,sections:af}),a.jsx(h.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center p-4",children:"Loading..."}),children:a.jsx(fD,{show:e,onClose:s})}),t&&a.jsx(cm,{modalConfig:tm.SCAN_ITEM,show:t,onHide:i,formData:{itemName:"",category:"",id:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()},isEditMode:!1,expandedSections:{general:!1,purchase:!1,maintenance:!1,usage:!1},toggleSection:()=>{},handleFormChange:()=>{},children:a.jsxs("div",{className:"text-center p-4",children:[a.jsx("h4",{children:"Scan Items"}),a.jsx("p",{children:"Scan modal content would be implemented here"})]})})]})},yD=({isEditMode:n,formData:e,progressInfo:t})=>(sf(),a.jsx(gD,{}));var vD=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const dm={analyzeScan(n){return vD(this,null,function*(){const{barcode:e,mode:t,userId:r,facilityId:s}=n;if(!e)return{recommendation:"Invalid barcode",confidence:1};try{yield _.from("ai_scan_audit").insert([{barcode:e,mode:t,user_id:r||null,facility_id:s||null,event_context:n}])}catch(i){}return{recommendation:t==="add"?"Confirm inventory addition and set expiry date.":t==="use"?"Deduct from stock and log usage.":"Flag anomalies for review.",confidence:.85}})}};var _D=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const xD=(n,e="success")=>{switch(e){case"success":or.success(n);break;case"warning":or(n,{icon:"⚠️",style:{background:"#fef3c7",color:"#92400e"}});break;case"error":or.error(n);break;default:or(n)}},bD=({scanMode:n,onScan:e})=>{const[t,r]=h.useState([]),{openAddModal:s,closeScanModal:i,setFormData:l,setEditMode:c,inventoryItems:o,refreshInventoryData:d}=Bt(),u=h.useCallback(f=>{const g=o.find(y=>{var v;return((v=y.data)==null?void 0:v.barcode)===f||y.id===f});if(g)console.log("Item already exists:",g),xD(`Item "${g.name}" already exists in inventory.`,"warning");else{const y=tf(f),v=rf(y);l(v),c(!1),i(),s()}},[o,l,c,i,s]),m=h.useCallback(f=>_D(null,null,function*(){var g;try{const{data:y,error:v}=yield _.from("inventory_items").select("*").eq("barcode",f).single();if(v||!y){or.error("Item not found in inventory.");return}const x=Math.max(((g=y.quantity)!=null?g:1)-1,0),{error:b}=yield _.from("inventory_items").update({quantity:x}).eq("id",y.id);if(b){or.error("Failed to update inventory.");return}yield _.from("inventory_usage").insert([{barcode:f,item_id:y.id,facility_id:y.facility_id,user_id:y.user_id||null,action:"use",timestamp:new Date().toISOString()}]),dm.analyzeScan({barcode:f,mode:"use",timestamp:new Date().toISOString()}).catch(()=>{}),or.success(`${y.name||"Item"} used successfully.`)}catch(y){console.error("Error in handleUseInventoryWorkflow:",y),or.error("Unexpected error using item.")}}),[]),p=h.useCallback(f=>{if(r(g=>[...g,f]),e)try{e(f)}catch(g){console.error("Error in onScan callback:",g)}n==="use"?m(f):n==="add"&&u(f),dm.analyzeScan({barcode:f,mode:n,timestamp:new Date().toISOString()}).catch(()=>{})},[n,u,m,e]);return{scannedBarcodes:t,handleBarcodeScan:p}},wD=({scanMode:n,onClose:e})=>a.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsxs("h3",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(Ct,{path:wh,size:1.2,className:"text-[#4ECDC4] mr-3"}),n?"Inventory Scanner":"Scan Inventory"]})}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(Ct,{path:pt,size:1.2})})]}),SD=n=>n==="add"?"Add Inventory":"Use Inventory",CD=n=>`${n} item${n!==1?"s":""}`,ID=({scanMode:n,scannedItems:e,onSelectMode:t,onClearScannedItems:r,onRemoveScannedItem:s})=>n?a.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[a.jsx("h4",{className:"font-medium mb-2",children:"Scanner Active"}),a.jsx("div",{className:"bg-black h-32 rounded-lg flex items-center justify-center",children:a.jsx("div",{className:"text-white text-sm",children:"Camera Scanner"})})]}),e.length>0&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("h4",{className:"font-medium",children:["Scanned Items (",CD(e.length),")"]}),a.jsx("button",{onClick:()=>{r&&r()},className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Clear All"})]}),a.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 hide-scrollbar",children:e.map(i=>a.jsxs("div",{className:"bg-gray-50 p-2 rounded text-sm flex items-center justify-between",children:[a.jsx("span",{className:"flex-1",children:i}),a.jsx("button",{onClick:()=>{s&&s(i)},className:"ml-2 p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors duration-200",title:"Remove item",children:a.jsx(ya.Icon,{path:Co,size:.8})})]},i))})]})]})}):a.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Select the type of inventory operation you want to perform:"}),a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:a.jsxs("p",{className:"text-yellow-800 text-xs",children:["💡 ",a.jsx("strong",{children:"Tip:"}),' For items without barcodes, use the "Add Item" button in the appropriate category table.']})}),a.jsx("button",{onClick:()=>t("add"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:a.jsx(ya.Icon,{path:Og,size:1.2,className:"text-green-600"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("h4",{className:"font-semibold text-green-800 text-sm",children:"Add Inventory"}),a.jsx("p",{className:"text-xs text-green-600",children:"Scan barcode to add new items. If no barcode exists, you can add one manually."})]})]})}),a.jsx("button",{onClick:()=>t("use"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:a.jsx(ya.Icon,{path:mh,size:1.2,className:"text-blue-600"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("h4",{className:"font-semibold text-blue-800 text-sm",children:"Use Inventory"}),a.jsx("p",{className:"text-xs text-blue-600",children:"Scan barcode to remove items from inventory when they are used."})]})]})})]})});var um=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const jD=({scanMode:n,scannedItems:e,onSelectMode:t})=>{const{openAddModal:r,closeScanModal:s,setFormData:i,setEditMode:l,inventoryItems:c}=Bt(),o=()=>um(null,null,function*(){if(n==="add"&&e.length>0){const d=e[0];if(c.find(f=>f.data&&typeof f.data=="object"&&f.data!==null&&"barcode"in f.data&&typeof f.data.barcode=="string"&&f.data.barcode===d||f.id===d)){alert(`Item with barcode ${d} already exists in inventory.`);return}const m=tf(d),p=rf(m);i(p),l(!1),s(),r()}else if(n==="use"&&e.length>0){const d=e.map(f=>um(null,null,function*(){const g=c.find(y=>{var v;return((v=y.data)==null?void 0:v.barcode)===f||y.id===f});if(g)try{return yield Mt.deleteItem(g.id),console.log("Successfully removed item from inventory:",g.name),{success:!0,item:g}}catch(y){return console.error("Failed to remove item:",g.name,y),{success:!1,item:g,error:y}}else return console.log("Item not found in inventory:",f),{success:!1,item:null,error:"Item not found"}})),u=yield Promise.all(d),m=u.filter(f=>f.success).length,p=u.filter(f=>!f.success).length;m>0&&alert(`Successfully removed ${m} item(s) from inventory.`),p>0&&alert(`Failed to remove ${p} item(s). Please check the console for details.`),s()}});return n?a.jsx("div",{className:"p-6 border-t border-gray-200",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>o().catch(console.error),className:"flex-1 bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#4ECDC4] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:SD(n)}),a.jsx("button",{onClick:()=>t("add"),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200",children:"Back"})]})}):null},ED=({scanMode:n,scannedItems:e,onClose:t,onSelectMode:r,onScan:s,onProcess:i,onClearScannedItems:l,onOpenAddItemModal:c,onRemoveScannedItem:o})=>{bD({scanMode:n,onScan:s});const d=a.jsx(Pa,{children:a.jsx(Ye.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999] p-4",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},onClick:t,children:a.jsxs(Ye.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl overflow-hidden w-full max-w-md shadow-2xl max-h-[90vh] flex flex-col",onClick:u=>u.stopPropagation(),children:[a.jsx(wD,{scanMode:n,onClose:t}),a.jsx(ID,{scanMode:n,scannedItems:e,onSelectMode:r,onClearScannedItems:l,onRemoveScannedItem:o}),a.jsx(jD,{scanMode:n,scannedItems:e,onSelectMode:r,onProcess:i,onClose:t,onOpenAddItemModal:c})]})})});return js.createPortal(d,document.body)};function TD(){return a.jsx("div",{className:"text-red-600 text-sm p-4",children:"⚠️ Something went wrong loading the Scan Modal. Please refresh or try again later."})}const ND=()=>{const{showScanModal:n,scanMode:e,scannedItems:t,resetScannedItems:r,setScanMode:s,setShowScanModal:i,addScannedItem:l,removeScannedItem:c}=Bt(),o=()=>{r(),s(null),i(!1)};return n?a.jsx(ED,{scanMode:e,scannedItems:t,onClose:o,onSelectMode:s,onScan:l,onProcess:()=>{},onClearScannedItems:r,onOpenAddItemModal:()=>{},onRemoveScannedItem:c}):null};function kD(){return a.jsx(Cn,{FallbackComponent:TD,children:a.jsx(ND,{})})}const Ho=({show:n,onClose:e,title:t,children:r,footer:s,size:i="lg"})=>a.jsxs(St,{show:n,onHide:e,centered:!0,size:i,"aria-modal":"true",role:"dialog",children:[t&&a.jsx(St.Header,{closeButton:!0,className:"bg-gray-50 border-b border-gray-200",children:a.jsx(St.Title,{className:"text-xl font-semibold text-gray-800",children:t})}),a.jsx(St.Body,{className:"p-4",children:r}),s&&a.jsx(St.Footer,{className:"bg-gray-50 border-t border-gray-200 px-4 py-3",children:s})]}),PD=({show:n,onClose:e,onConfirm:t,item:r,isLoading:s=!1,activeTab:i="tools"})=>{if(!r)return null;const l=()=>{t()},c=()=>{e()};return a.jsx(Ho,{show:n,onClose:e,title:"Confirm Archive",size:"lg",footer:a.jsxs("div",{className:"flex gap-3 justify-end",children:[a.jsx("button",{onClick:c,disabled:s,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md font-medium transition-colors duration-200 disabled:opacity-50",children:"Cancel"}),a.jsx("button",{onClick:l,disabled:s,className:"px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-md font-medium transition-colors duration-200 disabled:opacity-50 flex items-center gap-2",children:s?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Archiving..."]}):a.jsxs(a.Fragment,{children:[a.jsx(N,{path:Co,size:.8}),"Archive"]})})]}),children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:a.jsx(N,{path:Aa,size:1.2,className:"text-red-600"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:['Archive "',r.name,'"?']}),a.jsx("p",{className:"text-gray-600 mb-4",children:"This will archive the item from the active inventory. The item will be hidden but preserved for audit purposes and compliance requirements."}),a.jsx("div",{className:"bg-gray-50 rounded-md p-3",children:a.jsxs("div",{className:"text-sm text-gray-700",children:[a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"font-medium",children:"Item:"}),a.jsx("span",{children:r.name})]}),a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"font-medium",children:"Category:"}),a.jsx("span",{children:r.category})]}),a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"font-medium",children:"Location:"}),a.jsx("span",{children:r.location})]}),i!=="tools"&&r.quantity!==void 0&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"font-medium",children:"Quantity:"}),a.jsx("span",{children:r.quantity})]})]})})]})]})})};var mm=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const DD=h.lazy(()=>L(()=>import("./InventoryTableSection-BPAc0S6b.js"),__vite__mapDeps([28,2,3,6,1,4,5,27,29]))),AD=h.lazy(()=>L(()=>import("./InventoryInsightsCard-QliZSKJ5.js"),__vite__mapDeps([30,2,3,6,1,4,5]))),OD=h.lazy(()=>L(()=>import("./CategoriesCard-BcMGllG7.js"),__vite__mapDeps([31,2,3,6,1,4,5]))),RD=()=>{const{refreshData:n}=Lu(),{registerRefreshCallback:e}=TP();X.useEffect(()=>e(()=>{console.log("🔄 InventoryDashboard received real-time update, refreshing data..."),n()}),[n,e]);const{tools:t,supplies:r,equipment:s,officeHardware:i}=Lu(),{getProgressInfo:l}=EP(),{formData:c,activeTab:o,showDeleteModal:d,itemToDelete:u,closeDeleteModal:m,showTrackedOnly:p,setShowTrackedOnly:f}=Bt(),g=h.useMemo(()=>qP(c),[c]),{expandedSections:y,handleCloseAddModal:v,handleSave:x,handleToggleSection:b,handleFormChangeWrapper:C,handleEditItem:k,handleCloneItem:P,isEditMode:E}=sf(),{setActiveTab:$}=Bt(),w=h.useMemo(()=>{switch(o){case"tools":return t||[];case"supplies":return r||[];case"equipment":return s||[];case"officeHardware":return i||[];default:return t||[]}},[o,t,r,s,i]),S={showTrackedOnly:p,showFavoritesOnly:!1,handleShowAddModal:()=>{},handleCloseAddModal:v,handleToggleTrackedFilter:()=>f(!p),handleToggleFavoritesFilter:()=>{},onCategoryChange:j=>$(j),searchTerm:"",expandedSections:y,favorites:[],filteredTools:[],setSearchTerm:()=>{},handleToggleFavorite:()=>{},handleSave:x,handleToggleSection:b,handleFormChangeWrapper:C,getStatusBadge:j=>j,getStatusText:j=>j},A=j=>mm(null,null,function*(){try{yield Cs.handleDeleteItem(j.id,()=>{console.log("Item deleted successfully"),n()},M=>{console.error("Failed to delete item:",M)})}catch(M){console.error("Error in delete handler:",M)}}),I=()=>mm(null,null,function*(){if(u)try{yield Cs.handleArchiveItem(u.id,()=>{console.log("Item archived successfully"),m(),n()},j=>{console.error("Failed to archive item:",j)})}catch(j){console.error("Error in archive handler:",j)}}),T={tools:t,supplies:r,equipment:s,officeHardware:i};return X.useEffect(()=>{console.log("🏠 InventoryDashboard insights data:",{tools:(t==null?void 0:t.length)||0,supplies:(r==null?void 0:r.length)||0,equipment:(s==null?void 0:s.length)||0,officeHardware:(i==null?void 0:i.length)||0,total:((t==null?void 0:t.length)||0)+((r==null?void 0:r.length)||0)+((s==null?void 0:s.length)||0)+((i==null?void 0:i.length)||0)})},[t,r,s,i]),a.jsx(BP.Provider,{value:S,children:a.jsx(Cn,{fallback:a.jsx(Mk,{}),children:a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx($k,{}),a.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[a.jsxs("div",{className:"flex flex-col gap-4 lg:w-1/4 pl-4",children:[a.jsx(h.Suspense,{fallback:a.jsx(_s,{}),children:a.jsx(AD,{data:T})}),a.jsx(h.Suspense,{fallback:a.jsx(_s,{}),children:a.jsx(OD,{onCategoryChange:j=>$(j),counts:{tools:(t==null?void 0:t.length)||0,supplies:(r==null?void 0:r.length)||0,equipment:(s==null?void 0:s.length)||0,officeHardware:(i==null?void 0:i.length)||0}})})]}),a.jsx("div",{className:"flex-1 pr-4",children:a.jsx(h.Suspense,{fallback:a.jsx(uh,{rows:8,columns:5}),children:a.jsx("div",{className:"bg-white rounded-lg shadow p-6 w-full max-w-full flex flex-col min-h-fit",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"inventory table and controls",children:a.jsx(DD,{onEdit:k,onDelete:A,onClone:P,items:w})})})})]}),a.jsx(yD,{isEditMode:E,formData:g,progressInfo:l()}),a.jsx(kD,{}),a.jsx(PD,{show:d,onClose:m,onConfirm:I,item:u,activeTab:o})]})})})};function $D(){function n({children:t}){return a.jsx(yN,{children:a.jsx(ks,{children:a.jsx(vN,{children:t})})})}function e(){return a.jsx(RD,{})}return{ProviderTree:n,PageContent:e}}function MD(){const{ProviderTree:n,PageContent:e}=$D();return a.jsx(n,{children:a.jsx(e,{})})}const FD=()=>a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}),LD=({error:n,resetErrorBoundary:e})=>{const r=(s=>s.message.includes("fetch")||s.message.includes("network")?{title:"Connection Error",description:"Unable to connect to the server. Please check your internet connection.",suggestion:"Try refreshing the page or check your network connection.",severity:"warning"}:s.message.includes("permission")||s.message.includes("unauthorized")?{title:"Access Denied",description:"You don't have permission to access this feature.",suggestion:"Contact your administrator if you believe this is an error.",severity:"error"}:s.message.includes("timeout")?{title:"Request Timeout",description:"The request took too long to complete.",suggestion:"Try again in a moment. If the problem persists, contact support.",severity:"warning"}:{title:"Unexpected Error",description:"Something went wrong while loading the Environmental Clean module.",suggestion:"Try refreshing the page. If the problem continues, contact support.",severity:"error"})(n);return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:a.jsx("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${r.severity==="error"?"bg-red-100":"bg-yellow-100"}`,children:a.jsx(N,{path:Le,size:2,className:r.severity==="error"?"text-red-600":"text-yellow-600"})}),a.jsx("h2",{className:`text-xl font-semibold mb-2 ${r.severity==="error"?"text-red-600":"text-yellow-600"}`,children:r.title}),a.jsx("p",{className:"text-gray-700 mb-4 leading-relaxed",children:r.description}),a.jsxs("details",{className:"mb-4 text-left",children:[a.jsxs("summary",{className:"cursor-pointer text-sm text-gray-500 hover:text-gray-700 flex items-center justify-center",children:[a.jsx(N,{path:Rg,size:.8,className:"mr-1"}),"Technical Details"]}),a.jsxs("div",{className:"mt-2 p-3 bg-gray-100 rounded text-xs font-mono text-gray-600 break-all",children:[n.message,n.stack&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[a.jsx("div",{className:"text-xs text-gray-500",children:"Stack trace:"}),a.jsx("div",{className:"mt-1",children:n.stack})]})]})]}),a.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["💡 ",r.suggestion]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[a.jsxs("button",{onClick:e,className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[a.jsx(N,{path:Lt,size:.8,className:"mr-2"}),"Try Again"]}),a.jsxs("button",{onClick:()=>window.location.href="/",className:"flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[a.jsx(N,{path:$g,size:.8,className:"mr-2"}),"Go Home"]})]}),a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:a.jsxs("p",{className:"text-xs text-gray-500",children:["Still having trouble? Contact support at"," ",a.jsx("a",{href:"mailto:support@cliniio.com",className:"text-blue-600 hover:underline",children:"support@cliniio.com"})]})})]})})})};var zD=Object.defineProperty,BD=Object.defineProperties,qD=Object.getOwnPropertyDescriptors,hm=Object.getOwnPropertySymbols,UD=Object.prototype.hasOwnProperty,HD=Object.prototype.propertyIsEnumerable,pm=(n,e,t)=>e in n?zD(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,VD=(n,e)=>{for(var t in e||(e={}))UD.call(e,t)&&pm(n,t,e[t]);if(hm)for(var t of hm(e))HD.call(e,t)&&pm(n,t,e[t]);return n},WD=(n,e)=>BD(n,qD(e)),vo=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const GD=(n,e)=>{let t;return(...r)=>{clearTimeout(t),t=setTimeout(()=>n(...r),e)}},fm=new Map,KD=1e3,QD=(n,e,t)=>{const r=`${n}:${e}:${JSON.stringify(t)}`,s=Date.now(),i=fm.get(r);return i&&s-i<KD?!0:(fm.set(r,s),!1)},ir={log:GD((...n)=>vo(null,null,function*(){const[e,t,r]=n;if(QD(e,t,r)){console.log("Skipping duplicate audit event:",{category:e,action:t});return}try{if(!jt()){console.warn("⚠️ Supabase not configured, skipping audit event logging");return}const s=yield ht.getCurrentFacilityId(),{data:{user:i}}=yield _.auth.getUser(),l=(i==null?void 0:i.id)||crypto.randomUUID(),{error:c}=yield _.from("audit_logs").insert({id:crypto.randomUUID(),module:e,table_name:e,action:t,record_id:null,user_id:l,facility_id:s,metadata:WD(VD({},r),{category:e,timestamp:new Date().toISOString()}),created_at:new Date().toISOString()});c?console.error("Failed to log audit event:",c):console.log("Audit event logged:",{category:e,action:t})}catch(s){console.error("Error logging audit event:",s)}}),100),logProblemToolAction:(n,e,t,r,s)=>vo(null,null,function*(){const{error:i}=yield _.from("audit_logs").insert({event_type:"tool_problem_flagged",tool_id:n,facility_id:t,user_id:e,previous_status:r,new_status:"problem",details:s||null,happened_at:new Date().toISOString()});i&&console.error("Audit log insert failed:",i);try{if(!jt()){console.warn("⚠️ Supabase not configured, skipping problem tool audit logging");return}const{error:l}=yield _.from("audit_logs").insert({id:crypto.randomUUID(),module:"sterilization",table_name:"tools",action:"tool_problem_action",record_id:n,user_id:e,facility_id:t,old_values:{status:r},new_values:{status:"problem"},metadata:{problem_notes:s,timestamp:new Date().toISOString()},created_at:new Date().toISOString()});l?console.error("Failed to log problem tool action:",l):console.log("Problem tool action logged:",n)}catch(l){console.error("Error logging problem tool action:",l)}})};function VR(n,e,t,r){return vo(this,null,function*(){yield _.from("audit_logs").insert({event_type:"RECEIPT_UPLOADED",receipt_id:n,batch_id:e,operator_name:t,facility_id:r,happened_at:new Date().toISOString()})})}class Zt extends Error{constructor(e,t,r,s){super(e),this.code=t,this.statusCode=r,this.details=s,this.name="EnvironmentalCleanServiceError"}}const br={NETWORK_ERROR:"Unable to connect to the server. Please check your internet connection.",TIMEOUT_ERROR:"The request took too long to complete. Please try again.",UNAUTHORIZED:"You don't have permission to perform this action. Please contact your administrator.",NOT_FOUND:"The requested resource was not found.",VALIDATION_ERROR:"The provided data is invalid. Please check your input and try again.",SERVER_ERROR:"A server error occurred. Please try again later.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again."},$t=(n,e)=>{if(n instanceof Zt)return n;const t=n instanceof Error?n.message:String(n);return t.includes("fetch")||t.includes("network")||t.includes("ENOTFOUND")?new Zt(br.NETWORK_ERROR,"NETWORK_ERROR",void 0,{originalError:t,context:e}):t.includes("timeout")||t.includes("ETIMEDOUT")?new Zt(br.TIMEOUT_ERROR,"TIMEOUT_ERROR",void 0,{originalError:t,context:e}):t.includes("401")||t.includes("unauthorized")?new Zt(br.UNAUTHORIZED,"UNAUTHORIZED",401,{originalError:t,context:e}):t.includes("404")||t.includes("not found")?new Zt(br.NOT_FOUND,"NOT_FOUND",404,{originalError:t,context:e}):t.includes("422")||t.includes("validation")?new Zt(br.VALIDATION_ERROR,"VALIDATION_ERROR",422,{originalError:t,context:e}):t.includes("500")||t.includes("server error")?new Zt(br.SERVER_ERROR,"SERVER_ERROR",500,{originalError:t,context:e}):new Zt(br.UNKNOWN_ERROR,"UNKNOWN_ERROR",void 0,{originalError:t,context:e})},Wi=n=>({pending:"Dirty",in_progress:"In Progress",completed:"Clean",verified:"Clean",clean:"Clean",failed:"Supervisor",cancelled:"Out of Service",dirty:"Dirty"})[n]||"Dirty",gm=n=>({Dirty:"dirty","In Progress":"in_progress",Clean:"clean","Out of Service":"cancelled",Supervisor:"pending",Isolation:"failed",Quarantine:"failed",Maintenance:"pending","Equipment Failure":"failed","Patient Occupied":"pending","Discharge Cleaning":"pending",Unassigned:"pending","Audit Required":"pending"})[n]||"dirty";var Er=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const nn=()=>Er(null,null,function*(){return yield ht.getCurrentFacilityId()});class sn{static fetchRooms(){return Er(this,null,function*(){try{const e=yield nn(),t=_.from("environmental_cleans_enhanced").select(`
          id,
          room_id,
          room_name,
          status,
          cleaning_type,
          scheduled_time,
          completed_time,
          quality_score,
          compliance_score,
          created_at,
          updated_at
        `).eq("facility_id",e),{data:r,error:s}=yield t.order("scheduled_time",{ascending:!1});if(s)throw s;return(r!=null?r:[]).map(l=>{var c,o,d,u,m;const p=Wi(l.status);return{id:l.room_id||l.id,name:l.room_name||`Room ${l.room_id||l.id}`,status:p,metadata:{cleaningType:(c=l.cleaning_type)!=null?c:"",qualityScore:(o=l.quality_score)!=null?o:0,complianceScore:(d=l.compliance_score)!=null?d:0,scheduledTime:(u=l.scheduled_time)!=null?u:"",completedTime:(m=l.completed_time)!=null?m:void 0},createdAt:l.created_at,updatedAt:l.updated_at}})}catch(e){return console.warn("Environmental Clean rooms fetch failed, falling back to static data:",e),[{id:"room-1",name:"Operating Room 1",status:"pending",metadata:{cleaningType:"surgical",qualityScore:95,complianceScore:98,scheduledTime:new Date().toISOString(),completedTime:void 0},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"room-2",name:"Recovery Room A",status:"in_progress",metadata:{cleaningType:"standard",qualityScore:87,complianceScore:92,scheduledTime:new Date().toISOString(),completedTime:void 0},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"room-3",name:"ICU Room 3",status:"completed",metadata:{cleaningType:"intensive",qualityScore:99,complianceScore:100,scheduledTime:new Date().toISOString(),completedTime:new Date().toISOString()},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}})}static updateRoomStatus(e,t){return Er(this,null,function*(){try{const r=yield nn(),s=_.from("environmental_cleans_enhanced").update({status:gm(t),updated_at:new Date().toISOString()}).eq("room_id",e).eq("facility_id",r),{error:i}=yield s;if(i)throw i;ir.log("environmental_clean","room_status_updated",{roomId:e,status:t,timestamp:new Date().toISOString()})}catch(r){const s=$t(r,"updateRoomStatus");throw console.error("❌ Failed to update room status:",s),s}})}static createEnvironmentalClean(e){return Er(this,null,function*(){var t,r,s,i;try{const l=yield nn(),c={room_id:(t=e.id)!=null?t:"",room_name:(r=e.name)!=null?r:"",status:"pending",cleaning_type:"routine",scheduled_time:new Date().toISOString(),checklist_items:[],completed_items:[],failed_items:[],facility_id:l},{data:o,error:d}=yield _.from("environmental_cleans_enhanced").insert(c).select().single();if(d||!o)throw d!=null?d:new Error("Insert failed");const u={id:o.room_id,name:o.room_name||`Room ${o.room_id}`,status:Wi(o.status),metadata:{cleaningType:(s=o.cleaning_type)!=null?s:"",scheduledTime:(i=o.scheduled_time)!=null?i:""},createdAt:o.created_at,updatedAt:o.updated_at};return ir.log("environmental_clean","room_created",{roomId:u.id,roomName:u.name}),u}catch(l){const c=$t(l,"createEnvironmentalClean");throw console.error("❌ Failed to create environmental clean:",c),c}})}static updateEnvironmentalClean(e,t){return Er(this,null,function*(){var r,s,i,l,c;try{const o=yield nn(),d={updated_at:new Date().toISOString()};t.name&&(d.room_name=t.name),t.status&&(d.status=gm(t.status));const u=_.from("environmental_cleans_enhanced").update(d).eq("room_id",e).eq("facility_id",o),{data:m,error:p}=yield u.select().single();if(p||!m)throw p!=null?p:new Error("Update failed");const f={id:m.room_id,name:m.room_name||`Room ${m.room_id}`,status:Wi(m.status),metadata:{cleaningType:(r=m.cleaning_type)!=null?r:"",qualityScore:(s=m.quality_score)!=null?s:0,complianceScore:(i=m.compliance_score)!=null?i:0,scheduledTime:(l=m.scheduled_time)!=null?l:"",completedTime:(c=m.completed_time)!=null?c:void 0},createdAt:m.created_at,updatedAt:m.updated_at};return ir.log("environmental_clean","room_updated",{roomId:f.id,roomName:f.name}),f}catch(o){const d=$t(o,"updateEnvironmentalClean");throw console.error("❌ Failed to update environmental clean:",d),d}})}static deleteEnvironmentalClean(e){return Er(this,null,function*(){try{const t=yield nn(),r=_.from("environmental_cleans_enhanced").delete().eq("room_id",e).eq("facility_id",t),{error:s}=yield r;if(s)throw s;ir.log("environmental_clean","room_deleted",{roomId:e})}catch(t){const r=$t(t,"deleteEnvironmentalClean");throw console.error("❌ Failed to delete environmental clean:",r),r}})}static completeRoomCleaning(e){return Er(this,null,function*(){try{if(!e)throw new Error("Room ID is required");const t=yield nn(),r=_.from("environmental_cleans_enhanced").update({status:"completed",completed_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("room_id",e).eq("facility_id",t),{error:s}=yield r;if(s)throw s;ir.log("environmental_clean","room_cleaning_completed",{roomId:e,timestamp:new Date().toISOString()})}catch(t){const r=$t(t,"completeRoomCleaning");throw console.error("❌ Error completing room cleaning:",r),r}})}}var ua=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ma{static fetchAnalytics(){return ua(this,null,function*(){try{console.log("📊 Fetching analytics from Supabase...");const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("status, completed_time, scheduled_time, created_at");if(t)throw t;const r=e||[],s=r.length,i=r.filter(x=>x.status==="clean"||x.status==="completed"||x.status==="verified").length,l=r.filter(x=>x.status==="dirty"||x.status==="pending").length,c=r.filter(x=>x.status==="in_progress").length,o=r.filter(x=>x.status==="biohazard").length,d=r.filter(x=>x.status==="theft").length,u=r.filter(x=>x.status==="low_inventory").length,m=r.filter(x=>x.status==="out_of_service").length,p=r.filter(x=>x.status==="public_areas").length,f=s>0?Math.round(i/s*100):0,g=r.filter(x=>x.completed_time&&x.scheduled_time);let y=0;if(g.length>0){const x=g.reduce((b,C)=>{const k=new Date(C.scheduled_time).getTime(),P=new Date(C.completed_time).getTime();return b+(P-k)},0);y=Math.round(x/g.length/(1e3*60))}const v={totalRooms:s,cleanRooms:i,dirtyRooms:l,inProgressRooms:c,biohazardRooms:o,theftRooms:d,lowInventoryRooms:u,outOfServiceRooms:m,publicAreas:p,cleaningEfficiency:f,averageCleaningTime:y,lastUpdated:new Date().toISOString()};return console.log("✅ Analytics fetched successfully:",v),v}catch(e){throw console.error("❌ Error fetching analytics:",e),e}})}static getRoomCountsByStatus(){return ua(this,null,function*(){try{console.log("📊 Fetching room counts from Supabase...");const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("status");if(t)throw t;const r=e||[],s={completed:r.filter(i=>i.status==="clean"||i.status==="completed").length,pending:r.filter(i=>i.status==="dirty"||i.status==="pending").length,in_progress:r.filter(i=>i.status==="in_progress").length,failed:r.filter(i=>i.status==="failed").length,cancelled:r.filter(i=>i.status==="cancelled").length,verified:r.filter(i=>i.status==="verified").length};return console.log("✅ Room counts fetched successfully:",s),s}catch(e){throw console.error("❌ Error getting room counts by status:",e),e}})}static getRecentlyCompletedCleanings(e=10){return ua(this,null,function*(){try{const{data:t,error:r}=yield _.from("environmental_cleans_enhanced").select("room_name, completed_time, cleaner_id").eq("status","clean").not("completed_time","is",null).order("completed_time",{ascending:!1}).limit(e);if(r)throw r;return(t||[]).map(l=>({room:l.room_name||"Unknown Room",cleanedAt:l.completed_time,cleanedBy:l.cleaner_id?`Cleaner ${l.cleaner_id}`:"System"}))}catch(t){throw console.error("❌ Error getting recently completed cleanings:",t),t}})}static getCleaningEfficiencyTrends(e=7){return ua(this,null,function*(){try{const t=new Date;t.setDate(t.getDate()-e);const{data:r,error:s}=yield _.from("environmental_cleans_enhanced").select("status, completed_time, scheduled_time, created_at").gte("created_at",t.toISOString()).order("created_at",{ascending:!1});if(s)throw s;const i=r||[],l={};return i.forEach(c=>{const o=new Date(c.created_at).toISOString().split("T")[0];l[o]||(l[o]={completed:0,total:0,efficiency:0}),l[o].total++,(c.status==="completed"||c.status==="verified")&&l[o].completed++}),Object.keys(l).forEach(c=>{const o=l[c];o.efficiency=o.total>0?Math.round(o.completed/o.total*100):0}),l}catch(t){throw console.error("❌ Error getting cleaning efficiency trends:",t),t}})}}var YD=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class JD{static fetchChecklists(){return YD(this,null,function*(){try{console.log("🔍 Fetching environmental cleaning checklists...");const{data:e,error:t}=yield _.from("environmental_cleaning_task_categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw console.error("❌ Supabase error:",t),t;return console.log("✅ Checklists fetched successfully:",(e==null?void 0:e.length)||0,"records"),(e||[]).map(r=>{var s,i,l,c;return{id:r.id,name:r.name,description:(s=r.data)==null?void 0:s.description,items:[],isActive:!!((i=r.is_active)==null||i),createdAt:String((l=r.created_at)!=null?l:new Date().toISOString()),updatedAt:String((c=r.updated_at)!=null?c:new Date().toISOString())}})}catch(e){throw console.error("❌ Error fetching checklists:",e),$t(e,"fetchChecklists")}})}}var ym=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class vm{static fetchRecentlyCleanedRooms(e=10){return ym(this,null,function*(){try{const{data:t,error:r}=yield _.from("environmental_cleans_enhanced").select(`
          room_name,
          completed_time,
          cleaner_id
        `).eq("status","clean").not("completed_time","is",null).order("completed_time",{ascending:!1}).limit(e);if(r)throw console.error("❌ Supabase error:",r),r;return(t||[]).map(i=>({room:i.room_name||"Unknown Room",cleanedAt:i.completed_time,cleanedBy:i.cleaner_id?`Cleaner ${i.cleaner_id}`:"System"}))}catch(t){console.error("❌ Raw error in fetchRecentlyCleanedRooms:",t);const r=$t(t,"fetchRecentlyCleanedRooms");throw console.error("❌ Failed to fetch recently cleaned rooms:",r),r}})}static scanRoomBarcode(e){return ym(this,null,function*(){try{if(!e||e.trim()==="")return{success:!1,message:"Please enter a valid barcode"};const{useRoomStore:t}=yield L(()=>Promise.resolve().then(()=>tD),void 0),s=t.getState().getRoomByBarcode(e.trim());return s?(ir.log("environmental_clean","room_scan",{barcode:e,roomId:s.id,roomName:s.name}),{success:!0,room:{id:s.barcode||s.id,name:s.name,status:"dirty"},message:`Successfully scanned room: ${s.name}`}):{success:!1,message:`Room with barcode "${e}" not found. Please check the barcode or add the room in Settings.`}}catch(t){return console.error("❌ Error scanning room barcode:",t),{success:!1,message:"An error occurred while scanning the barcode. Please try again."}}})}}var XD=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class ZD{static batchEnvironmentalCleanAction(e){return XD(this,arguments,function*({ids:t,action:r}){try{const s={updated_at:new Date().toISOString()};switch(r){case"mark_completed":s.status="completed",s.completed_time=new Date().toISOString();break;case"mark_in_progress":s.status="in_progress",s.started_time=new Date().toISOString();break;case"mark_verified":s.status="verified",s.verified_time=new Date().toISOString();break;default:throw new Error(`Unknown action: ${r}`)}const{error:i}=yield _.from("environmental_cleans_enhanced").update(s).in("room_id",t);if(i)throw i;return ir.log("environmental_clean","batch_action",{action:r,roomIds:t,count:t.length}),{success:!0}}catch(s){const i=$t(s,"batchEnvironmentalCleanAction");throw console.error("❌ Failed to perform batch action:",i),i}})}}var eA=Object.defineProperty,tA=Object.defineProperties,rA=Object.getOwnPropertyDescriptors,_m=Object.getOwnPropertySymbols,nA=Object.prototype.hasOwnProperty,sA=Object.prototype.propertyIsEnumerable,xm=(n,e,t)=>e in n?eA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,aA=(n,e)=>{for(var t in e||(e={}))nA.call(e,t)&&xm(n,t,e[t]);if(_m)for(var t of _m(e))sA.call(e,t)&&xm(n,t,e[t]);return n},iA=(n,e)=>tA(n,rA(e));class _n{constructor(){this.usageData=new Map,this.STORAGE_KEY="inventory_usage_data",this.loadUsageData()}static getInstance(){return _n.instance||(_n.instance=new _n),_n.instance}loadUsageData(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e),r=Object.fromEntries(Object.entries(t).map(([s,i])=>{const l=i;return[s,iA(aA({},l),{lastUsed:new Date(l.lastUsed)})]}));this.usageData=new Map(Object.entries(r))}}catch(e){console.error(e),console.warn("Failed to load usage data:")}}saveUsageData(){try{const e=Object.fromEntries(this.usageData);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error(e),console.warn("Failed to save usage data:")}}getOrCreateUsageData(e){const t=this.usageData.get(e);if(!t){const r={itemId:e,usageCount:0,lastUsed:new Date,searchCount:0,favoriteCount:0,trackCount:0};return this.usageData.set(e,r),r}return t}trackItemView(e){const t=this.getOrCreateUsageData(e);t.usageCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemSearch(e){const t=this.getOrCreateUsageData(e);t.searchCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemFavorite(e){const t=this.getOrCreateUsageData(e);t.favoriteCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemTrack(e){const t=this.getOrCreateUsageData(e);t.trackCount+=1,t.lastUsed=new Date,this.saveUsageData()}calculateSmartScore(e){const t=this.usageData.get(e);if(!t)return 0;const r=new Date;let s;try{s=t.lastUsed instanceof Date?t.lastUsed:new Date(t.lastUsed),isNaN(s.getTime())&&(s=new Date)}catch(c){console.error(c),s=new Date}const i=(r.getTime()-s.getTime())/(1e3*60*60*24);let l=t.usageCount*10;return i<=7&&(l+=50),l+=t.searchCount*5,l+=t.favoriteCount*20,l+=t.trackCount*15,i>30&&(l*=.8),Math.round(l)}getSmartRanking(e){return[...e].sort((t,r)=>{var s,i,l,c,o,d,u,m;const p=t.toolId||t.supplyId||t.equipmentId||t.hardwareId||((s=t.data)==null?void 0:s.toolId)||((i=t.data)==null?void 0:i.supplyId)||((l=t.data)==null?void 0:l.equipmentId)||((c=t.data)==null?void 0:c.hardwareId)||"",f=r.toolId||r.supplyId||r.equipmentId||r.hardwareId||((o=r.data)==null?void 0:o.toolId)||((d=r.data)==null?void 0:d.supplyId)||((u=r.data)==null?void 0:u.equipmentId)||((m=r.data)==null?void 0:m.hardwareId)||"",g=this.calculateSmartScore(p);return this.calculateSmartScore(f)-g})}getUsageStats(){return Object.fromEntries(this.usageData)}clearUsageData(){this.usageData.clear(),localStorage.removeItem(this.STORAGE_KEY)}}const oA=_n.getInstance(),lA=Object.freeze(Object.defineProperty({__proto__:null,usageTrackingService:oA},Symbol.toStringTag,{value:"Module"}));var Re=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class Fe{static addAuditLog(e,t,r){return Re(this,null,function*(){try{yield _.from("environmental_clean_audit").insert({action:e,room_id:t,user_id:r,timestamp:new Date().toISOString()})}catch(s){console.error("Audit log failed:",s)}})}static fetchRooms(){return Re(this,null,function*(){return sn.fetchRooms()})}static fetchChecklists(){return Re(this,null,function*(){return JD.fetchChecklists()})}static updateRoomStatus(e,t){return Re(this,null,function*(){return sn.updateRoomStatus(e,t)})}static completeRoomCleaning(e){return Re(this,null,function*(){return sn.completeRoomCleaning(e)})}static fetchAnalytics(){return Re(this,null,function*(){return ma.fetchAnalytics()})}static getRoomCountsByStatus(){return Re(this,null,function*(){return ma.getRoomCountsByStatus()})}static getRecentlyCompletedCleanings(e=10){return Re(this,null,function*(){return ma.getRecentlyCompletedCleanings(e)})}static getCleaningEfficiencyTrends(e=7){return Re(this,null,function*(){return ma.getCleaningEfficiencyTrends(e)})}static fetchRecentlyCleanedRooms(e=10){return Re(this,null,function*(){return vm.fetchRecentlyCleanedRooms(e)})}static scanRoomBarcode(e){return Re(this,null,function*(){return vm.scanRoomBarcode(e)})}static createEnvironmentalClean(e){return Re(this,null,function*(){return sn.createEnvironmentalClean(e)})}static updateEnvironmentalClean(e,t){return Re(this,null,function*(){return sn.updateEnvironmentalClean(e,t)})}static deleteEnvironmentalClean(e){return Re(this,null,function*(){return sn.deleteEnvironmentalClean(e)})}static batchEnvironmentalCleanAction(e){return Re(this,arguments,function*({ids:t,action:r}){return ZD.batchEnvironmentalCleanAction({ids:t,action:r})})}}Fe.supabase=_;var ha=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const of=()=>{const[n,e]=h.useState([]),[t,r]=h.useState([]),[s,i]=h.useState(null),[l,c]=h.useState(!1),[o,d]=h.useState(null),u=(y,v)=>{const x=$t(y,v);d(x.message),console.error(`❌ ${v} failed:`,x)},m=h.useCallback(()=>ha(null,null,function*(){try{c(!0),d(null);const y=yield Fe.fetchRooms();e(y)}catch(y){u(y,"fetchRooms")}finally{c(!1)}}),[]),p=h.useCallback(()=>ha(null,null,function*(){try{c(!0),d(null);const y=yield Fe.fetchChecklists();r(y)}catch(y){u(y,"fetchChecklists")}finally{c(!1)}}),[]),f=h.useCallback(()=>ha(null,null,function*(){try{c(!0),d(null);const y=yield Fe.fetchAnalytics();i(y)}catch(y){u(y,"fetchAnalytics")}finally{c(!1)}}),[]),g=h.useCallback(()=>ha(null,null,function*(){Promise.all([m(),p(),f()]).catch(y=>{console.error("Background data refresh failed:",y)})}),[m,p,f]);return h.useEffect(()=>{const y=setTimeout(()=>{g()},0);return()=>clearTimeout(y)},[g]),{rooms:n,checklists:t,analytics:s,loading:l,error:o,fetchRooms:m,fetchChecklists:p,fetchAnalytics:f,refreshData:g}};function cA(n=[]){const[e,t]=h.useState(""),[r,s]=h.useState("all"),[i,l]=h.useState(1),c=20,o=h.useMemo(()=>n.filter(g=>{const y=e===""||g.id.toLowerCase().includes(e.toLowerCase())||g.status.toLowerCase().includes(e.toLowerCase()),v=r==="all"||g.status===r;return y&&v}),[n,e,r]),d=Math.ceil(o.length/c),u=h.useMemo(()=>{const g=(i-1)*c;return o.slice(g,g+c)},[o,i]),m=h.useCallback(g=>{t(g),l(1)},[]),p=h.useCallback(g=>{s(g),l(1)},[]),f=h.useCallback(g=>{l(g)},[]);return{searchTerm:e,status:r,paginatedItems:u,onSearchChange:m,onStatusChange:p,currentPage:i,totalPages:d,onPageChange:f}}var dA=Object.defineProperty,uA=Object.defineProperties,mA=Object.getOwnPropertyDescriptors,bm=Object.getOwnPropertySymbols,hA=Object.prototype.hasOwnProperty,pA=Object.prototype.propertyIsEnumerable,wm=(n,e,t)=>e in n?dA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Sm=(n,e)=>{for(var t in e||(e={}))hA.call(e,t)&&wm(n,t,e[t]);if(bm)for(var t of bm(e))pA.call(e,t)&&wm(n,t,e[t]);return n},Cm=(n,e)=>uA(n,mA(e)),fA=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function gA(){return gg({mutationFn:n=>fA(null,null,function*(){try{const e=new Date().toISOString(),t=n.operator||"Unknown Operator",r=Cm(Sm({},n),{timestamp:e,operator:t,module:"environmental_clean",category:"environmental_clean"}),s=[Promise.resolve().then(()=>{try{ir.log("environmental_clean",n.action,Cm(Sm({},n.item),{operator:t,roomId:n.roomId,status:n.status,metadata:n.metadata,timestamp:e}))}catch(l){console.warn("Audit logger failed:",l)}})];return Promise.allSettled(s).catch(()=>{}),{success:!0,auditId:`EC-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:e}}catch(e){return console.error("❌ Failed to log Environmental Clean audit:",e),console.warn("⚠️ Audit logging failed, using console fallback:",n),{success:!1,error:e instanceof Error?e.message:"Unknown audit error"}}}),retry:2,retryDelay:1e3,onMutate:()=>{},onError:n=>{console.error("❌ Environmental Clean audit failed:",n)},onSuccess:n=>{}})}const yA=({onScan:n})=>a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Environmental Clean"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage room cleaning workflows and maintain compliance standards."})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsx("span",{className:"text-gray-600",children:"Room Scanner"}),a.jsx(Is,{variant:"success",onClick:n,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Scan Room"})]})]}),Ot={borderLeftColor:"rgba(78, 205, 196, 0.5)",primaryIconColor:"#4ECDC4",defaultBorderColor:"border-gray-200"},lf={error:{light:"#fee2e2"},info:{light:"#dbeafe"}},vs=n=>e=>{e.key==="Enter"&&(e.preventDefault(),n())},cf=n=>e=>{e.key===" "&&(e.preventDefault(),n())},df=(n,e,t=0)=>{const[r,s]=h.useState(t),i=h.useCallback(l=>{switch(l.key){case"ArrowDown":l.preventDefault(),s(c=>(c+1)%n.length);break;case"ArrowUp":l.preventDefault(),s(c=>(c-1+n.length)%n.length);break;case"Home":l.preventDefault(),s(0);break;case"End":l.preventDefault(),s(n.length-1);break;case"Enter":case" ":l.preventDefault(),e(n[r],r);break}},[n,r,e]);return{selectedIndex:r,setSelectedIndex:s,handleKeyDown:i}},vA=(n,e,t)=>{const r=h.useCallback(s=>{if(n)switch(s.key){case"Escape":e();break}},[n,e,t]);return h.useEffect(()=>(document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)),[r]),{handleKeyDown:r}},_A=(n,e)=>e?`${n} ${e}`:n,xA=n=>{if(!n||typeof n!="object")return!1;const e=n;return typeof e.id=="string"&&typeof e.name=="string"&&typeof e.status=="string"},bA=n=>typeof n=="string";var wA=Object.defineProperty,SA=Object.defineProperties,CA=Object.getOwnPropertyDescriptors,Im=Object.getOwnPropertySymbols,IA=Object.prototype.hasOwnProperty,jA=Object.prototype.propertyIsEnumerable,jm=(n,e,t)=>e in n?wA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Em=(n,e)=>{for(var t in e||(e={}))IA.call(e,t)&&jm(n,t,e[t]);if(Im)for(var t of Im(e))jA.call(e,t)&&jm(n,t,e[t]);return n},Tm=(n,e)=>SA(n,CA(e)),wr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const EA=Et((n,e)=>({rooms:[],checklists:[],analytics:{totalRooms:0,cleanRooms:0,dirtyRooms:0,inProgressRooms:0,cleaningEfficiency:0,averageCleaningTime:0,lastUpdated:new Date().toISOString()},isLoading:!1,error:null,setRooms:t=>{const r=t.filter(s=>xA(s));r.length!==t.length&&console.warn("Some rooms were filtered out due to invalid data"),n({rooms:r})},setChecklists:t=>{n({checklists:t})},setAnalytics:t=>{n({analytics:t})},setLoading:t=>{n({isLoading:t})},setError:t=>{n({error:t})},fetchRooms:()=>wr(null,null,function*(){const{setLoading:t,setError:r,setRooms:s}=e();try{t(!0),r(null);const i=yield Fe.fetchRooms();s(i),console.log("✅ Fetched rooms from service:",i.length)}catch(i){const l=i instanceof Error?i.message:"Failed to fetch rooms";r(l),console.error("❌ Failed to fetch rooms:",i)}finally{t(!1)}}),fetchChecklists:()=>wr(null,null,function*(){const{setLoading:t,setError:r,setChecklists:s}=e();try{t(!0),r(null);const i=yield Fe.fetchChecklists();s(i),console.log("✅ Fetched checklists from service:",i.length)}catch(i){const l=i instanceof Error?i.message:"Failed to fetch checklists";r(l),console.error("❌ Failed to fetch checklists:",i)}finally{t(!1)}}),fetchAnalytics:()=>wr(null,null,function*(){const{setLoading:t,setError:r,setAnalytics:s}=e();try{t(!0),r(null);const i=yield Fe.fetchAnalytics();s(i),console.log("✅ Fetched analytics from service")}catch(i){const l=i instanceof Error?i.message:"Failed to fetch analytics";r(l),console.error("❌ Failed to fetch analytics:",i)}finally{t(!1)}}),updateRoomStatus:(t,r)=>wr(null,null,function*(){const{setError:s,rooms:i,setRooms:l}=e();try{if(!t)throw new Error("Room ID is required");if(!bA(r))throw new Error("Invalid status type");yield Fe.updateRoomStatus(t,r);const c=i.map(o=>o.id===t?Tm(Em({},o),{status:r}):o);l(c),yield Fe.addAuditLog("status_update",t,"system"),console.log("✅ Updated room status:",t,r)}catch(c){const o=c instanceof Error?c.message:"Failed to update room status";throw s(o),console.error("❌ Failed to update room status:",c),c}}),completeRoomCleaning:t=>wr(null,null,function*(){const{setError:r,rooms:s,setRooms:i}=e();try{if(!t)throw new Error("Room ID is required");yield Fe.completeRoomCleaning(t);const l=s.map(c=>c.id===t?Tm(Em({},c),{status:"clean"}):c);i(l),yield Fe.addAuditLog("complete_cleaning",t,"system"),console.log("✅ Completed room cleaning:",t)}catch(l){const c=l instanceof Error?l.message:"Failed to complete room cleaning";throw r(c),console.error("❌ Failed to complete room cleaning:",l),l}}),scanRoomBarcode:t=>wr(null,null,function*(){try{if(!t||t.trim()==="")return{success:!1,message:"Please enter a valid barcode"};const r=yield Fe.scanRoomBarcode(t);if(r.success&&r.room){const{rooms:s,setRooms:i}=e();s.find(c=>c.id===r.room.id)||i([...s,r.room]),yield Fe.addAuditLog("room_scan",r.room.id,"system")}return r}catch(r){return console.error("❌ Error scanning barcode:",r),{success:!1,message:"An error occurred while scanning the barcode. Please try again."}}}),showStatusModal:!1,isScanModalOpen:!1,selectedIds:[],selectedRoom:null,selectedStatus:null,searchTerm:"",filterStatus:"",setShowStatusModal:t=>n({showStatusModal:t}),setSelectedRoom:t=>n({selectedRoom:t}),setSelectedStatus:t=>n({selectedStatus:t}),toggleSelectedId:t=>{const{selectedIds:r}=e(),s=r.includes(t)?r.filter(i=>i!==t):[...r,t];n({selectedIds:s})},clearSelectedIds:()=>n({selectedIds:[]}),setSearchTerm:t=>n({searchTerm:t}),setFilterStatus:t=>n({filterStatus:t}),openScanModal:()=>n({isScanModalOpen:!0}),closeScanModal:()=>n({isScanModalOpen:!1}),lastAuditTimestamp:null,setLastAudit:t=>n({lastAuditTimestamp:t}),addAuditLog:(t,r)=>wr(null,null,function*(){const s=new Date().toISOString(),{setLastAudit:i}=e();i(s),console.log("🔍 [ENVIRONMENTAL CLEAN AUDIT]",{action:t,metadata:r,timestamp:s})})}));var TA=Object.defineProperty,NA=Object.defineProperties,kA=Object.getOwnPropertyDescriptors,Nm=Object.getOwnPropertySymbols,PA=Object.prototype.hasOwnProperty,DA=Object.prototype.propertyIsEnumerable,km=(n,e,t)=>e in n?TA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,AA=(n,e)=>{for(var t in e||(e={}))PA.call(e,t)&&km(n,t,e[t]);if(Nm)for(var t of Nm(e))DA.call(e,t)&&km(n,t,e[t]);return n},OA=(n,e)=>NA(n,kA(e)),RA=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const uf=h.createContext(void 0);function mf(){const n=h.useContext(uf);if(!n)throw new Error("useRoomStatus must be used within a RoomStatusProvider");return n}const $A=({children:n})=>{const{rooms:e}=EA(),[t,r]=h.useState([]),[s,i]=h.useState([]);h.useEffect(()=>{const m=e.map(f=>({id:f.id,status:f.status,name:f.name,metadata:f.metadata})),p=setTimeout(()=>{r(m)},0);return()=>clearTimeout(p)},[e]),h.useEffect(()=>{RA(null,null,function*(){try{const p=yield Fe.fetchRecentlyCleanedRooms(10);i(p)}catch(p){console.error("Failed to fetch recently cleaned rooms:",p)}})},[]);const l=h.useCallback((m,p)=>{if(r(f=>f.map(g=>g.id===m?OA(AA({},g),{status:p}):g)),p==="Clean"){const f=e.find(v=>v.id===m),y={room:f?f.name:`Room ${m}`,cleanedAt:new Date().toISOString(),cleanedBy:"Current User"};i(v=>[y,...v.slice(0,9)])}},[e]),c=h.useCallback(()=>t.filter(m=>m.status==="Clean").length,[t]),o=h.useCallback(()=>t.filter(m=>m.status==="Dirty").length,[t]),d=h.useCallback(()=>{const m=t.length,p=c();return m>0?Math.round(p/m*100):0},[t,c]),u={rooms:t,recentlyCleanedRooms:s,updateRoomStatus:l,getCleanRoomsCount:c,getDirtyRoomsCount:o,getEfficiency:d};return a.jsx(uf.Provider,{value:u,children:n})};var MA=Object.defineProperty,FA=Object.defineProperties,LA=Object.getOwnPropertyDescriptors,Pm=Object.getOwnPropertySymbols,zA=Object.prototype.hasOwnProperty,BA=Object.prototype.propertyIsEnumerable,Dm=(n,e,t)=>e in n?MA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ds=(n,e)=>{for(var t in e||(e={}))zA.call(e,t)&&Dm(n,t,e[t]);if(Pm)for(var t of Pm(e))BA.call(e,t)&&Dm(n,t,e[t]);return n},Gi=(n,e)=>FA(n,LA(e)),Sr=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Ki=8,pa=4,qA=Et()(Ua((n,e)=>({statusTypes:[],isLoading:!1,error:null,fetchStatusTypes:()=>Sr(null,null,function*(){n({isLoading:!0,error:null});try{n({statusTypes:[{id:"1",name:"Available",color:"#10B981",icon:"check-circle",description:"Item is available and ready for use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"2",name:"In Use",color:"#6B7280",icon:"pause-circle",description:"Item is currently in use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"3",name:"Maintenance",color:"#F59E0B",icon:"wrench",description:"Item requires maintenance",isDefault:!0,isCore:!0,isPublished:!0,category:"maintenance",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{id:"4",name:"Critical",color:"#EF4444",icon:"exclamation-triangle",description:"Item has critical issues",isDefault:!0,isCore:!0,isPublished:!0,category:"critical",requiresVerification:!0,autoTransition:!1,alertLevel:"critical"}],isLoading:!1})}catch(t){console.error("❌ Error fetching status types:",t),n({error:t instanceof Error?t.message:"Failed to fetch status types",isLoading:!1})}}),refreshStatusTypes:()=>Sr(null,null,function*(){yield e().fetchStatusTypes()}),getCoreStatusTypes:()=>e().statusTypes.filter(t=>t.isCore),getPublishedStatusTypes:()=>e().statusTypes.filter(t=>t.isPublished),getCustomStatusTypes:()=>e().statusTypes.filter(t=>!t.isCore),getStatusTypesByCategory:t=>e().statusTypes.filter(r=>r.category===t),getAllStatusTypes:()=>e().statusTypes,addStatusType:t=>Sr(null,null,function*(){try{const r=e(),s=r.getCustomStatusTypes();if(s.length>=pa)throw new Error(`Maximum of ${pa} custom statuses allowed. You currently have ${s.length} custom statuses.`);if(r.statusTypes.length>=Ki)throw new Error(`Maximum of ${Ki} total statuses allowed. You currently have ${r.statusTypes.length} statuses.`);const i=Gi(ds({id:Date.now().toString()},t),{isCore:!1,isPublished:!1});n(l=>({statusTypes:[...l.statusTypes,i]}))}catch(r){throw console.error("Error adding status type:",r),r}}),updateStatusType:(t,r)=>Sr(null,null,function*(){const s=e().statusTypes.find(i=>i.id===t);if(s&&s.isCore){console.warn("Cannot update core status types");return}try{n(i=>({statusTypes:i.statusTypes.map(l=>l.id===t?ds(ds({},l),r):l)}))}catch(i){throw console.error("Error updating status type:",i),i}}),deleteStatusType:t=>Sr(null,null,function*(){const r=e().statusTypes.find(s=>s.id===t);if(r&&r.isCore){console.warn("Cannot delete core status types");return}try{n(s=>({statusTypes:s.statusTypes.filter(i=>i.id!==t)}))}catch(s){throw console.error("Error deleting status type:",s),s}}),publishStatusType:t=>Sr(null,null,function*(){const r=e().statusTypes.find(s=>s.id===t);if(r&&r.isCore){console.warn("Core status types are always published");return}try{n(s=>({statusTypes:s.statusTypes.map(i=>i.id===t?Gi(ds({},i),{isPublished:!0}):i)}))}catch(s){throw console.error("Error publishing status type:",s),s}}),unpublishStatusType:t=>Sr(null,null,function*(){const r=e().statusTypes.find(s=>s.id===t);if(r&&r.isCore){console.warn("Cannot unpublish core status types");return}try{n(s=>({statusTypes:s.statusTypes.map(i=>i.id===t?Gi(ds({},i),{isPublished:!1}):i)}))}catch(s){throw console.error("Error unpublishing status type:",s),s}}),getStatusTypeById:t=>e().statusTypes.find(r=>r.id===t),getStatusTypeByName:t=>e().statusTypes.find(r=>r.name===t),getCategories:()=>{const t=new Set(e().statusTypes.map(r=>r.category).filter(Boolean));return Array.from(t).filter(r=>r!==void 0).sort()},getStatusCountInfo:()=>{const t=e(),r=t.getCoreStatusTypes(),s=t.getCustomStatusTypes();return{total:t.statusTypes.length,core:r.length,custom:s.length,maxCustom:pa}},canAddCustomStatus:()=>{const t=e();return t.getCustomStatusTypes().length<pa&&t.statusTypes.length<Ki}}),{name:"status-types-storage",partialize:()=>({})})),hf=()=>{const n=qA();return h.useEffect(()=>{n.statusTypes.length===0&&!n.isLoading&&n.fetchStatusTypes()},[n]),n},pf=()=>({iconMap:{default:ut,broom:Ih,"progress-clock":zg,"check-circle":jn,biohazard:Lg,"shield-alert":ut,"package-variant":Fg,wrench:Mg,"office-building":Ch,"account-supervisor":ut,"shield-lock":ut,"shield-cross":ut,"help-circle":ut,"alert-circle":ut,account:ut,"clipboard-check":ut},colorMap:{"#16a34a":"#16a34a","#dc2626":"#dc2626","#ca8a04":"#ca8a04","#9333ea":"#9333ea","#4b5563":"#4b5563","#b45309":"#b45309","#047857":"#047857","#8B5CF6":"#8B5CF6","#EA580C":"#EA580C","#9CA3AF":"#9CA3AF","#059669":"#059669","#3B82F6":"#3B82F6","#F59E0B":"#F59E0B"},bgColorMap:{"#16a34a":"bg-green-100","#dc2626":"bg-red-100","#ca8a04":"bg-yellow-100","#9333ea":"bg-purple-100","#4b5563":"bg-gray-100","#b45309":"bg-amber-100","#047857":"bg-emerald-100","#8B5CF6":"bg-purple-100","#EA580C":"bg-amber-100","#9CA3AF":"bg-gray-100","#059669":"bg-green-100","#3B82F6":"bg-blue-100","#F59E0B":"bg-amber-100"},borderColorMap:{"#16a34a":"border-green-500","#dc2626":"border-red-500","#ca8a04":"border-yellow-500","#9333ea":"border-purple-500","#4b5563":"border-gray-500","#b45309":"border-amber-500","#047857":"border-emerald-500","#8B5CF6":"border-purple-500","#EA580C":"border-amber-500","#9CA3AF":"border-gray-500","#059669":"border-green-500","#3B82F6":"border-blue-500","#F59E0B":"border-amber-500"},bgColorSelectedMap:{"#16a34a":"bg-green-50","#dc2626":"bg-red-50","#ca8a04":"bg-yellow-50","#9333ea":"bg-purple-50","#4b5563":"bg-gray-50","#b45309":"bg-amber-50","#047857":"bg-emerald-50","#8B5CF6":"bg-purple-50","#EA580C":"bg-amber-50","#9CA3AF":"bg-gray-50","#059669":"bg-green-50","#3B82F6":"bg-blue-50","#F59E0B":"bg-amber-50"},textColorMap:{"#16a34a":"text-green-600","#dc2626":"text-red-600","#ca8a04":"text-yellow-600","#9333ea":"text-purple-600","#4b5563":"text-gray-600","#b45309":"text-amber-600","#047857":"text-emerald-600","#8B5CF6":"text-purple-600","#EA580C":"text-amber-600","#9CA3AF":"text-gray-600","#059669":"text-green-600","#3B82F6":"text-blue-600","#F59E0B":"text-amber-600"}}),UA=(n,e)=>e[n]||ut,HA=(n,e)=>e[n]||"bg-gray-100",VA=(n,e)=>e[n]||"text-gray-600",WA=()=>{const{getCoreStatusTypes:n,getPublishedStatusTypes:e,statusTypes:t,isLoading:r}=hf(),s=pf();return h.useMemo(()=>{const i=n(),l=e(),c=m=>m.map(p=>{const f=s.iconMap[p.icon]||s.iconMap.default;return{value:p.id,name:p.name,bgColor:s.bgColorMap[p.color]||s.bgColorMap.default,bgColorSelected:s.bgColorSelectedMap[p.color]||s.bgColorSelectedMap.default,borderColor:s.borderColorMap[p.color]||s.borderColorMap.default,color:s.colorMap[p.color]||s.colorMap.default,icon:f,isCore:p.isCore||!1}}),o=c(i),d=c(l),u=[...o];return d.forEach(m=>{u.find(p=>p.value===m.value)||u.push(m)}),u},[n,e,s.bgColorMap,s.bgColorSelectedMap,s.borderColorMap,s.colorMap,s.iconMap])},GA=()=>{const{getCoreStatusTypes:n,getPublishedStatusTypes:e}=hf(),t=pf();return h.useMemo(()=>{const r=n(),s=e();return[...r,...s.filter(l=>!l.isCore)].map(l=>({status:l.name,icon:UA(l.icon,t.iconMap),color:l.color,bgColor:HA(l.color,t.bgColorMap),textColor:VA(l.color,t.textColorMap),isCore:l.isCore}))},[n,e,t.bgColorMap,t.iconMap,t.textColorMap])},KA=(n,e)=>n.filter(t=>t.status===e).length,QA=(n,e)=>{var t,r;if(n.name)return{name:n.name,department:((t=n.metadata)==null?void 0:t.department)||"",floor:((r=n.metadata)==null?void 0:r.floor)||""};const s=e.find(i=>(i.barcode||i.id)===n.id);return{name:s?s.name:`Room ${n.id}`,department:s&&s.department||"",floor:s&&s.floor||""}},YA=({isOpen:n,onClose:e,onUpdate:t,currentStatus:r})=>{const[s,i]=h.useState([]);vA(n,e);const l=WA(),{selectedIndex:c,handleKeyDown:o}=df(l,m=>{const p=m.value;i(f=>f.includes(p)?f.filter(g=>g!==p):[...f,p])},0),d=m=>{i(p=>p.includes(m)?p.filter(f=>f!==m):[...p,m])},u=()=>{t(s),e()};return n?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"status-modal-title","aria-describedby":"status-modal-description",children:a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",role:"document",children:[a.jsx("h3",{id:"status-modal-title",className:"text-lg font-semibold mb-4",children:"Update Room Status"}),a.jsx("div",{id:"status-modal-description",className:"sr-only",children:"Select room statuses using arrow keys to navigate and Enter or Space to select. Use Tab to move between options."}),a.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",role:"grid","aria-label":"Status options",onKeyDown:o,tabIndex:0,children:l.map((m,p)=>a.jsx("button",{className:`p-3 rounded-lg border transition-colors focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] ${s.includes(m.value)?`${m.bgColor} ${m.borderColor}`:r===m.value?`${m.borderColor} ${m.bgColorSelected}`:Ot.defaultBorderColor} ${c===p?"ring-2 ring-[#4ECDC4]":""}`,onClick:()=>d(m.value),onKeyDown:f=>{vs(()=>d(m.value))(f),cf(()=>d(m.value))(f)},role:"gridcell","aria-selected":s.includes(m.value),tabIndex:c===p?0:-1,"aria-label":_A("Select status",m.name),children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(N,{path:m.icon,size:.8,color:m.color,"aria-hidden":"true"}),a.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[a.jsx("span",{className:"truncate",children:m.name}),m.isCore&&a.jsx(N,{path:jh,size:.5,className:"text-gray-200 flex-shrink-0 ml-1",title:"Core status - always available"})]})]})},m.value))}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:e,onKeyDown:vs(e),className:"px-4 py-2 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 rounded","aria-label":"Cancel status update",children:"Cancel"}),a.jsx("button",{onClick:u,onKeyDown:vs(u),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":"Update room status",children:"Update"})]})]})}):null},JA=({status:n,icon:e,color:t,bgColor:r,textColor:s,isCore:i,roomCount:l,onClick:c,isSelected:o})=>a.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200 shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-0.5 cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] min-h-[80px] min-w-[80px] relative group",onClick:c,role:"gridcell",tabIndex:o?0:-1,"aria-label":`${n} rooms: ${l} rooms`,title:n,onKeyDown:d=>{vs(c)(d),cf(c)(d)},children:[a.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-white text-gray-800 text-xs rounded border border-gray-300 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[n,a.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-300"})]}),a.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[a.jsx("div",{className:`${r} rounded-full p-2 mb-2`,children:a.jsx(N,{path:e,size:1,color:t,"aria-hidden":"true"})}),a.jsx("div",{className:`text-2xl font-bold ${s}`,children:l})]}),i&&a.jsx("div",{className:"absolute top-1 right-1",children:a.jsx(N,{path:jh,size:.6,className:"text-gray-300",title:"Core status - always available"})})]}),XA=({status:n,rooms:e,onUpdateStatus:t})=>{const{getActiveRooms:r}=Uo(),s=r(),i=e.filter(l=>l.status===n);return a.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",role:"region","aria-label":`${n} rooms details`,children:[a.jsxs("h3",{className:"text-lg font-medium mb-3",children:[n," Rooms"]}),a.jsxs("div",{className:"space-y-2",children:[i.map(l=>{const{name:c,department:o,floor:d}=QA(l,s);return a.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-sm font-medium",children:c}),(o||d)&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[o&&a.jsx("span",{children:o}),o&&d&&a.jsx("span",{children:" • "}),d&&a.jsx("span",{children:d})]})]}),a.jsx("button",{onClick:()=>t(l.id),onKeyDown:vs(()=>t(l.id)),className:"text-xs text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded ml-2","aria-label":`Update status for ${c}`,children:"Update Status"})]},l.id)}),i.length===0&&a.jsx("p",{className:"text-sm text-gray-500",children:"No rooms with this status"})]})]})},ZA=()=>{const{rooms:n,updateRoomStatus:e}=mf(),[t,r]=h.useState(null),[s,i]=h.useState(null),[l,c]=h.useState(!1),o=GA(),d=g=>{r(t===g?null:g)},{selectedIndex:u,handleKeyDown:m}=df(o,g=>d(g.status),0),p=(g,y)=>{if(y.length>0){const v=y[0];e(g,v)}},f=g=>{i(g),c(!0)};return a.jsxs("div",{id:"room-status-summary",className:"bg-white rounded-lg shadow p-6 mb-6 relative",style:{borderLeft:`4px solid ${Ot.borderLeftColor}`},role:"region","aria-label":"Room status summary",children:[a.jsxs("h2",{className:"text-xl font-semibold mb-4 text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:no,size:1.1,color:Ot.primaryIconColor,className:"mr-2"}),"Room Status Summary"]}),a.jsx("div",{className:"grid grid-cols-4 gap-4",role:"grid","aria-label":"Status summary cards",onKeyDown:m,tabIndex:0,children:o.map((g,y)=>a.jsx(JA,{status:g.status,icon:g.icon,color:g.color,bgColor:g.bgColor,textColor:g.textColor,isCore:g.isCore,roomCount:KA(n,g.status),onClick:()=>d(g.status),isSelected:u===y,index:y},g.status))}),t&&a.jsx(XA,{status:t,rooms:n,onUpdateStatus:f}),a.jsx(YA,{isOpen:l,onClose:()=>c(!1),onUpdate:g=>{s&&p(s,g)},currentStatus:t||"Available"})]})},eO=()=>a.jsx("div",{className:"flex-1",children:a.jsx(ZA,{})});var Am=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function tO(){const[n,e]=h.useState({totalRooms:0,cleanRooms:0,dirtyRooms:0,inProgressRooms:0,cleaningEfficiency:0,averageCleaningTime:0,lastUpdated:new Date().toISOString()}),[t,r]=h.useState(!0),[s,i]=h.useState(null),l=h.useCallback(()=>Am(null,null,function*(){try{r(!0),i(null);const o=yield Fe.fetchAnalytics();e(o)}catch(o){i("Failed to load analytics"),console.error("Error fetching analytics:",o)}finally{r(!1)}}),[]),c=h.useCallback(()=>Am(null,null,function*(){yield l()}),[l]);return h.useEffect(()=>{l()},[l]),{analytics:n,isLoading:t,error:s,refreshAnalytics:c}}const rO=()=>{const{analytics:n,isLoading:e,error:t,refreshAnalytics:r}=tO();return e?a.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${Ot.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:Ka,size:1.1,color:Ot.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:a.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})}),a.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:a.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})}),a.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:a.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})})]})]}):t?a.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${Ot.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:Ka,size:1.1,color:Ot.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),a.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Refresh analytics",children:a.jsx(N,{path:Lt,size:.8,className:"text-gray-600"})})]}),a.jsx("div",{className:"text-red-600 text-sm text-center py-4",children:t})]}):a.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${Ot.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:Ka,size:1.1,color:Ot.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),a.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Refresh analytics",children:a.jsx(N,{path:Lt,size:.8,className:"text-gray-600"})})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2",role:"group","aria-label":"Analytics metrics",children:[a.jsxs("div",{className:"p-2 bg-green-100 rounded-lg text-center",role:"status","aria-label":`Clean rooms: ${n.cleanRooms}`,children:[a.jsx("h3",{className:"text-sm text-green-700 font-medium mb-1",children:"Clean Rooms"}),a.jsx("p",{className:"text-xl font-bold text-green-700",children:n.cleanRooms})]}),a.jsxs("div",{className:"p-2 bg-orange-100 rounded-lg text-center",role:"status","aria-label":`Dirty rooms: ${n.dirtyRooms}`,children:[a.jsx("h3",{className:"text-sm text-orange-700 font-medium mb-1",children:"Dirty Rooms"}),a.jsx("p",{className:"text-xl font-bold text-orange-700",children:n.dirtyRooms})]}),a.jsxs("div",{className:"p-2 bg-purple-100 rounded-lg text-center",role:"status","aria-label":`Efficiency: ${n.cleaningEfficiency}%`,children:[a.jsx("h3",{className:"text-sm text-purple-700 font-medium mb-1",children:"Efficiency"}),a.jsxs("p",{className:"text-xl font-bold text-purple-700",children:[n.cleaningEfficiency,"%"]})]})]}),a.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-center",children:["Last updated: ",new Date(n.lastUpdated).toLocaleTimeString()]})]})};var nO=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const sO=()=>{const{recentlyCleanedRooms:n}=mf(),{refreshData:e}=of(),t=h.useRef(null),r=!1,s=()=>{t.current&&(t.current.scrollTop=0)},i=()=>nO(null,null,function*(){try{yield e()}catch(l){console.error("Error refreshing cleaned rooms:",l)}});return a.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6 relative",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsxs("div",{className:"sticky top-0 bg-white pb-1 flex justify-between items-center",children:[a.jsxs("h2",{className:"text-lg font-semibold mb-1 text-[#5b5b5b] flex items-center",children:[a.jsx(N,{path:ws,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Recently Cleaned Rooms"]}),a.jsx("button",{onClick:i,className:"p-1 text-gray-500 hover:text-[#4ECDC4] transition-colors",title:"Refresh data",disabled:r,children:a.jsx(N,{path:Lt,size:.8,className:""})})]}),a.jsx("div",{className:"overflow-y-auto [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",style:{maxHeight:"120px"},ref:t,children:n.length===0?a.jsx("p",{className:"text-gray-500 text-sm py-1",children:"No rooms cleaned recently"}):a.jsx("div",{className:"space-y-1",children:n.map((l,c)=>a.jsx("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg relative",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"relative",children:a.jsxs("span",{className:"font-medium text-gray-700 cursor-help hover:text-brand-primary transition-colors group",children:[l.room,a.jsxs("div",{className:"hidden group-hover:block absolute left-0 top-full mt-1 bg-white rounded-lg shadow-xl border border-gray-200 p-3 w-64 z-50",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(N,{path:Sh,size:.8,color:"#4ECDC4"}),a.jsx("span",{className:"font-medium text-gray-800",children:l.cleanedBy})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(N,{path:ws,size:.8,color:"#4ECDC4"}),a.jsx("span",{className:"text-sm text-gray-600",children:new Date(l.cleanedAt).toLocaleString()})]})]})]})}),a.jsx(N,{path:jn,size:.8,color:"#4ECDC4"})]})},c))})}),a.jsx("button",{onClick:s,className:"absolute bottom-2 right-2 p-1.5 bg-brand-primary text-white rounded-full shadow-md hover:bg-brand-primary transition-colors",title:"Scroll to most recent",children:a.jsx(N,{path:Bg,size:.8,className:"opacity-70"})})]})},aO=()=>a.jsxs("div",{className:"flex-1",children:[a.jsx(rO,{}),a.jsx("div",{className:"mt-4",children:a.jsx(sO,{})})]});var iO=Object.defineProperty,oO=Object.defineProperties,lO=Object.getOwnPropertyDescriptors,Om=Object.getOwnPropertySymbols,cO=Object.prototype.hasOwnProperty,dO=Object.prototype.propertyIsEnumerable,Rm=(n,e,t)=>e in n?iO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Cr=(n,e)=>{for(var t in e||(e={}))cO.call(e,t)&&Rm(n,t,e[t]);if(Om)for(var t of Om(e))dO.call(e,t)&&Rm(n,t,e[t]);return n},an=(n,e)=>oO(n,lO(e));class uO{constructor(e=[]){this.checklists=[],this.checklists=e}getAllChecklists(){return[...this.checklists]}getChecklistById(e){return this.checklists.find(t=>t.id===e)}getChecklistsByCategory(e){return this.checklists.filter(t=>t.category===e)}getPublishedChecklistsByCategory(e){return this.checklists.filter(t=>t.category===e&&t.status==="published")}getChecklistsByStatus(e){return this.checklists.filter(t=>t.status===e)}addChecklist(e){const t=an(Cr({},e),{status:"draft",id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});return this.checklists.push(t),t}updateChecklist(e,t){const r=this.checklists.findIndex(i=>i.id===e);if(r===-1)return null;const s=an(Cr(Cr({},this.checklists[r]),t),{updatedAt:new Date().toISOString()});return this.checklists[r]=s,s}deleteChecklist(e){const t=this.checklists.findIndex(r=>r.id===e);return t===-1?!1:(this.checklists.splice(t,1),!0)}publishChecklist(e){return this.updateChecklist(e,{status:"published",updatedAt:new Date().toISOString()})}unpublishChecklist(e){return this.updateChecklist(e,{status:"draft",updatedAt:new Date().toISOString()})}duplicateChecklist(e,t){const r=this.getChecklistById(e);if(!r)return null;const s=an(Cr({},r),{id:this.generateId(),title:t||`${r.title} (Copy)`,status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:r.items.map(i=>an(Cr({},i),{id:this.generateId(),completed:!1,skipped:!1}))});return this.checklists.push(s),s}getChecklistStatistics(){const e=this.checklists.length,t=this.checklists.filter(c=>c.status==="published").length,r=this.checklists.filter(c=>c.status==="draft").length,s=this.checklists.reduce((c,o)=>(c[o.category]=(c[o.category]||0)+1,c),{}),i=this.checklists.reduce((c,o)=>c+o.items.length,0),l=e>0?i/e:0;return{total:e,published:t,draft:r,byCategory:s,averageItemsPerChecklist:l,totalItems:i}}searchChecklists(e){const t=e.toLowerCase();return this.checklists.filter(r=>r.title.toLowerCase().includes(t)||r.items.some(s=>s.title.toLowerCase().includes(t)||s.instructions.toLowerCase().includes(t)))}filterChecklists(e){return this.checklists.filter(t=>!(e.category&&t.category!==e.category||e.status&&t.status!==e.status||e.hasScheduling!==void 0&&!!(t.autoSchedule||t.scheduleFrequency)!==e.hasScheduling||e.minItems!==void 0&&t.items.length<e.minItems||e.maxItems!==void 0&&t.items.length>e.maxItems))}sortChecklists(e,t,r="asc"){return[...e].sort((s,i)=>{let l=0;switch(t){case"title":l=s.title.localeCompare(i.title);break;case"createdAt":l=new Date(s.createdAt).getTime()-new Date(i.createdAt).getTime();break;case"updatedAt":l=new Date(s.updatedAt).getTime()-new Date(i.updatedAt).getTime();break;case"category":l=s.category.localeCompare(i.category);break;case"status":l=s.status.localeCompare(i.status);break}return r==="desc"?-l:l})}exportChecklists(e){const t=e?this.checklists.filter(r=>e.includes(r.id)):this.checklists;return JSON.stringify(t,null,2)}importChecklists(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,imported:[],errors:["Invalid format: expected array of checklists"]};const r=[],s=[];return t.forEach((i,l)=>{const c=this.validateChecklist(i);if(!c.isValid)r.push(`Checklist ${l+1}: ${c.errors.join(", ")}`);else{const o=an(Cr({},i),{id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:i.items.map(d=>an(Cr({},d),{id:this.generateId()}))});s.push(o)}}),s.length>0&&this.checklists.push(...s),{success:r.length===0,imported:s,errors:r}}catch(t){return{success:!1,imported:[],errors:["Invalid JSON format"]}}}validateChecklist(e){const t=[];return(!e.title||e.title.trim()==="")&&t.push("Title is required"),e.category?["setup","patient","weekly","public","deep","environmental_cleaning"].includes(e.category)||t.push(`Invalid category: ${e.category}`):t.push("Category is required"),!e.items||!Array.isArray(e.items)?t.push("Items array is required"):e.items.length===0&&t.push("At least one item is required"),{isValid:t.length===0,errors:t}}getDefaultChecklists(){return[{id:"treatment-room-setup",title:"Treatment Room Setup",category:"setup",status:"published",items:[{id:"clean-surfaces",title:"Clean and sanitize all surfaces with CaviWipes",instructions:"Use 2 wipes per surface. Allow to air dry for 3 minutes.",requiredInventory:[{id:"caviwipes-001",name:"CaviWipes",required:2,available:100,used:0,unit:"wipes"}],sdsId:"caviwipes-sds",skipped:!1,completed:!1},{id:"restock-supplies",title:"Restock Treatment Room Supplies",instructions:"Verify all supplies are present and in date",requiredInventory:[{id:"gloves-001",name:"Nitrile Gloves",required:10,available:500,used:0,unit:"pairs"},{id:"gauze-001",name:"Sterile Gauze",required:5,available:200,used:0,unit:"packs"},{id:"alcohol-001",name:"Alcohol Swabs",required:10,available:300,used:0,unit:"swabs"}],skipped:!1,completed:!1}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}setChecklists(e){this.checklists=[...e]}clearChecklists(){this.checklists=[]}}var mO=Object.defineProperty,hO=Object.defineProperties,pO=Object.getOwnPropertyDescriptors,$m=Object.getOwnPropertySymbols,fO=Object.prototype.hasOwnProperty,gO=Object.prototype.propertyIsEnumerable,Mm=(n,e,t)=>e in n?mO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,dt=(n,e)=>{for(var t in e||(e={}))fO.call(e,t)&&Mm(n,t,e[t]);if($m)for(var t of $m(e))gO.call(e,t)&&Mm(n,t,e[t]);return n},Dt=(n,e)=>hO(n,pO(e));class yO{addItemToChecklist(e,t,r){const s=Dt(dt({},r),{id:this.generateId()});return e.map(i=>i.id===t?Dt(dt({},i),{items:[...i.items,s],updatedAt:new Date().toISOString()}):i)}updateChecklistItem(e,t,r,s){return e.map(i=>i.id===t?Dt(dt({},i),{items:i.items.map(l=>l.id===r?dt(dt({},l),s):l),updatedAt:new Date().toISOString()}):i)}deleteChecklistItem(e,t,r){return e.map(s=>s.id===t?Dt(dt({},s),{items:s.items.filter(i=>i.id!==r),updatedAt:new Date().toISOString()}):s)}getItemById(e,t,r){const s=e.find(i=>i.id===t);return s&&s.items.find(i=>i.id===r)||null}completeItem(e,t,r){return this.updateChecklistItem(e,t,r,{completed:!0,skipped:!1})}skipItem(e,t,r){return this.updateChecklistItem(e,t,r,{skipped:!0,completed:!1})}resetItem(e,t,r){return this.updateChecklistItem(e,t,r,{completed:!1,skipped:!1})}moveItemUp(e,t,r){return e.map(s=>{if(s.id!==t)return s;const i=[...s.items],l=i.findIndex(c=>c.id===r);return l<=0?s:([i[l],i[l-1]]=[i[l-1],i[l]],Dt(dt({},s),{items:i,updatedAt:new Date().toISOString()}))})}moveItemDown(e,t,r){return e.map(s=>{if(s.id!==t)return s;const i=[...s.items],l=i.findIndex(c=>c.id===r);return l===-1||l>=i.length-1?s:([i[l],i[l+1]]=[i[l+1],i[l]],Dt(dt({},s),{items:i,updatedAt:new Date().toISOString()}))})}moveItemToPosition(e,t,r,s){return e.map(i=>{if(i.id!==t)return i;const l=[...i.items],c=l.findIndex(d=>d.id===r);if(c===-1)return i;const[o]=l.splice(c,1);return l.splice(s,0,o),Dt(dt({},i),{items:l,updatedAt:new Date().toISOString()})})}duplicateItem(e,t,r){const s=this.getItemById(e,t,r);if(!s)return e;const i=Dt(dt({},s),{id:this.generateId(),title:`${s.title} (Copy)`,completed:!1,skipped:!1});return e.map(l=>l.id===t?Dt(dt({},l),{items:[...l.items,i],updatedAt:new Date().toISOString()}):l)}getItemStatistics(e){let t=0,r=0,s=0,i=0,l=0;e.forEach(d=>{d.items.forEach(u=>{t++,u.completed&&r++,u.skipped&&s++,u.requiredInventory&&u.requiredInventory.length>0&&i++,u.sdsId&&l++})});const c=t-r-s,o=t>0?r/t*100:0;return{totalItems:t,completedItems:r,skippedItems:s,pendingItems:c,completionRate:o,itemsWithInventory:i,itemsWithSDS:l}}getChecklistCompletionStatus(e){const t=e.items.length,r=e.items.filter(o=>o.completed).length,s=e.items.filter(o=>o.skipped).length,i=t-r-s,l=t>0?r/t*100:0;return{totalItems:t,completedItems:r,skippedItems:s,pendingItems:i,completionRate:l,isFullyCompleted:r===t}}validateItem(e){const t=[];return(!e.title||e.title.trim()==="")&&t.push("Title is required"),(!e.instructions||e.instructions.trim()==="")&&t.push("Instructions are required"),e.requiredInventory&&Array.isArray(e.requiredInventory)&&e.requiredInventory.forEach((r,s)=>{(!r.id||r.id.trim()==="")&&t.push(`Inventory item ${s+1}: ID is required`),(!r.name||r.name.trim()==="")&&t.push(`Inventory item ${s+1}: Name is required`),r.required<=0&&t.push(`Inventory item ${s+1}: Required quantity must be greater than 0`),r.available<0&&t.push(`Inventory item ${s+1}: Available quantity cannot be negative`),r.used<0&&t.push(`Inventory item ${s+1}: Used quantity cannot be negative`),r.used>r.available&&t.push(`Inventory item ${s+1}: Used quantity cannot exceed available quantity`)}),{isValid:t.length===0,errors:t}}searchItems(e,t){const r=t.toLowerCase(),s=[];return e.forEach(i=>{i.items.forEach(l=>{var c;l.title.toLowerCase().includes(r)?s.push({checklist:i,item:l,matchType:"title"}):l.instructions.toLowerCase().includes(r)?s.push({checklist:i,item:l,matchType:"instructions"}):(c=l.requiredInventory)!=null&&c.some(o=>o.name.toLowerCase().includes(r))&&s.push({checklist:i,item:l,matchType:"inventory"})})}),s}filterItems(e,t){const r=[];return e.forEach(s=>{t.category&&s.category!==t.category||s.items.forEach(i=>{t.completed!==void 0&&i.completed!==t.completed||t.skipped!==void 0&&i.skipped!==t.skipped||t.hasInventory!==void 0&&!!(i.requiredInventory&&i.requiredInventory.length>0)!==t.hasInventory||t.hasSDS!==void 0&&!!i.sdsId!==t.hasSDS||r.push({checklist:s,item:i})})}),r}sortItems(e,t,r="asc"){return[...e].sort((s,i)=>{var l,c;let o=0;switch(t){case"title":o=s.item.title.localeCompare(i.item.title);break;case"completed":o=(s.item.completed?1:0)-(i.item.completed?1:0);break;case"skipped":o=(s.item.skipped?1:0)-(i.item.skipped?1:0);break;case"inventoryCount":{const d=((l=s.item.requiredInventory)==null?void 0:l.length)||0,u=((c=i.item.requiredInventory)==null?void 0:c.length)||0;o=d-u;break}}return r==="desc"?-o:o})}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}}const Ir=new uO,Qi=new yO,vO=Et()(Ua((n,e)=>({checklists:Ir.getDefaultChecklists(),addChecklist:t=>{const r=Ir.addChecklist(t);n(s=>({checklists:[...s.checklists,r]}))},updateChecklist:(t,r)=>{n(s=>{const i=Ir.updateChecklist(t,r);return i?{checklists:s.checklists.map(l=>l.id===t?i:l)}:s})},deleteChecklist:t=>{n(r=>Ir.deleteChecklist(t)?{checklists:r.checklists.filter(i=>i.id!==t)}:r)},addItemToChecklist:(t,r)=>{n(s=>({checklists:Qi.addItemToChecklist(s.checklists,t,r)}))},updateChecklistItem:(t,r,s)=>{n(i=>({checklists:Qi.updateChecklistItem(i.checklists,t,r,s)}))},deleteChecklistItem:(t,r)=>{n(s=>({checklists:Qi.deleteChecklistItem(s.checklists,t,r)}))},getChecklistsByCategory:t=>Ir.getChecklistsByCategory(t),publishChecklist:t=>{n(r=>{const s=Ir.publishChecklist(t);return s?{checklists:r.checklists.map(i=>i.id===t?s:i)}:r})},getPublishedChecklistsByCategory:t=>Ir.getPublishedChecklistsByCategory(t)}),{name:"checklist-storage"}));var _O=Object.defineProperty,xO=Object.defineProperties,bO=Object.getOwnPropertyDescriptors,Fm=Object.getOwnPropertySymbols,wO=Object.prototype.hasOwnProperty,SO=Object.prototype.propertyIsEnumerable,Lm=(n,e,t)=>e in n?_O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Yi=(n,e)=>{for(var t in e||(e={}))wO.call(e,t)&&Lm(n,t,e[t]);if(Fm)for(var t of Fm(e))SO.call(e,t)&&Lm(n,t,e[t]);return n},Ji=(n,e)=>xO(n,bO(e));const CO=()=>{const[n,e]=h.useState(null),[t,r]=h.useState(null),[s,i]=h.useState("checklists"),[l,c]=h.useState(""),[o,d]=h.useState(null),[u,m]=h.useState("all"),[p,f]=h.useState(new Set),[g,y]=h.useState({}),[v,x]=h.useState(!1),[b,C]=h.useState(""),[k,P]=h.useState([]),[E,$]=h.useState([]),w=F=>{e(F),r(null),x(!0)},S=F=>{r(F)},A=()=>{e(null),r(null),x(!1)};return{selectedCategory:n,selectedChecklist:t,activeTab:s,searchQuery:l,selectedSDS:o,sdsCategory:u,bypassedItems:p,adjustedQuantities:g,showModal:v,notes:b,stolenItems:k,prnItems:E,setSelectedCategory:e,setSelectedChecklist:r,setActiveTab:i,setSearchQuery:c,setSelectedSDS:d,setSdsCategory:m,setShowModal:x,setNotes:C,handleCategoryClick:w,handleChecklistSelect:S,handleCloseModal:A,handleMarkComplete:()=>{A()},handleBypassItem:F=>{f(V=>{const q=new Set(V);return q.has(F)?q.delete(F):q.add(F),q})},handleAdjustQuantity:(F,V,q)=>{y(W=>Ji(Yi({},W),{[`${F}-${V}`]:(W[`${F}-${V}`]||0)+q}))},handleAddStolenItem:()=>{P([...k,{item:"",quantity:1,notes:""}])},handleAddPrnItem:()=>{$([...E,{item:"",quantity:1,reason:""}])},handleUpdateStolenItem:(F,V,q)=>{const W=[...k];W[F]=Ji(Yi({},W[F]),{[V]:q}),P(W)},handleUpdatePrnItem:(F,V,q)=>{const W=[...E];W[F]=Ji(Yi({},W[F]),{[V]:q}),$(W)},clearStolenItems:()=>{P([])},clearPrnItems:()=>{$([])},clearNotes:()=>{C("")}}},IO=()=>{const[n,e]=h.useState(!1),[t,r]=h.useState(""),s=h.useRef(null),i=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("Speech recognition is not supported in this browser. Please use Chrome or Edge.");return}const o=window.SpeechRecognition||window.webkitSpeechRecognition,d=new o;d.continuous=!0,d.interimResults=!0,d.lang="en-US",d.addEventListener("start",()=>{e(!0),r("")}),d.onresult=u=>{let m="",p="";for(let f=u.resultIndex;f<u.results.length;f++){const g=u.results[f][0].transcript;u.results[f].isFinal?m+=g:p+=g}r(m+p)},d.onerror=u=>{console.error("Speech recognition error:",u.error),e(!1),u.error==="no-speech"&&alert("No speech detected. Please try again.")},d.onend=()=>{e(!1)},s.current=d,d.start()},l=()=>{s.current&&(s.current.stop(),s.current=null),e(!1)},c=o=>{t.trim()&&(o(t),r(""))};return h.useEffect(()=>()=>{s.current&&s.current.stop()},[]),{isListening:n,transcript:t,startSpeechRecognition:i,stopSpeechRecognition:l,applyTranscriptToNotes:c}},jO=[{id:"setup",title:"Setup/Take Down",iconColor:"#FF6B6B",icon:kr},{id:"patient",title:"Per Patient",iconColor:"#4ECDC4",icon:qg},{id:"weekly",title:"Weekly",iconColor:"#45B7D1",icon:Ug},{id:"public",title:"Public Spaces",iconColor:"#96CEB4",icon:Ch},{id:"deep",title:"Deep Clean",iconColor:"#FF9F1C",icon:Ih}],EO=[{id:"1",name:"Bleach SDS",category:"Cleaning",lastUpdated:"2024-03-20",url:"/sds/bleach.pdf",sections:[]},{id:"2",name:"Disinfectant SDS",category:"Cleaning",lastUpdated:"2024-03-19",url:"/sds/disinfectant.pdf",sections:[]},{id:"3",name:"Hand Sanitizer SDS",category:"Sanitization",lastUpdated:"2024-03-18",url:"/sds/hand-sanitizer.pdf",sections:[]}],TO=({activeTab:n,onTabChange:e})=>a.jsx("div",{className:"flex justify-between items-center mb-6",children:a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("button",{className:`pb-2 px-1 font-medium flex items-center ${n==="checklists"?"text-[#5b5b5b] border-b-2 border-[#4ECDC4]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>e("checklists"),type:"button",children:[a.jsx(N,{path:gh,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Cleaning Checklists"]}),a.jsxs("button",{className:`pb-2 px-1 font-medium flex items-center ${n==="sds"?"text-[#5b5b5b] border-b-2 border-[#4ECDC4]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>e("sds"),type:"button",children:[a.jsx(N,{path:Ft,size:1.1,color:"#4ECDC4",className:"mr-2"}),"SDS Sheets"]})]})}),NO=({categories:n,selectedCategory:e,onCategoryClick:t})=>a.jsx("div",{className:"p-6",children:a.jsx("div",{role:"tablist","aria-label":"Cleaning Category Tabs",className:"grid grid-cols-5 gap-4",children:n.map(r=>a.jsxs("button",{role:"tab","aria-selected":(e==null?void 0:e.id)===r.id,"aria-controls":`panel-${r.id}`,id:`tab-${r.id}`,onClick:()=>t(r),className:`flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors w-full ${(e==null?void 0:e.id)===r.id?"bg-brand-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[a.jsx(N,{path:r.icon,size:1.2,color:r.iconColor}),a.jsx("span",{children:r.title})]},r.id))})}),ff=({item:n,bypassedItems:e,adjustedQuantities:t,onBypassItem:r,onAdjustQuantity:s,onViewSDS:i})=>a.jsx("div",{className:"border-b border-gray-200 py-3",children:a.jsx("div",{className:"flex items-start justify-between",children:a.jsxs("div",{className:"flex-1 px-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("h3",{className:"text-lg font-medium text-[#5b5b5b]",children:n.title}),a.jsx("button",{onClick:()=>r(n.id),className:`ml-4 px-3 py-1 text-sm rounded-full transition-colors ${e.has(n.id)?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"}`,type:"button",children:e.has(n.id)?"Not Needed":"Mark Not Needed"})]}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n.instructions}),n.inventoryItems&&a.jsxs("div",{className:"mt-2",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Required Items:"}),a.jsx("ul",{className:"mt-1 space-y-1",children:n.inventoryItems.map(l=>{const c=t[`${n.id}-${l.id}`]||0,o=l.requiredQuantity+c;return a.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[a.jsx("span",{className:"w-32",children:l.name}),a.jsx("span",{className:"mx-2",children:"•"}),a.jsxs("span",{children:["Required: ",o]}),a.jsx("span",{className:"mx-2",children:"•"}),a.jsxs("span",{children:["Available: ",l.currentStock]}),l.status&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"mx-2",children:"•"}),a.jsxs("span",{children:["Status: ",l.status]})]}),a.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[a.jsx("button",{onClick:()=>s(n.id,l.id,-1),className:"px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",type:"button",children:"-"}),a.jsx("button",{onClick:()=>s(n.id,l.id,1),className:"px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",type:"button",children:"+"})]})]},l.id)})})]}),n.sds&&a.jsx("div",{className:"mt-2",children:a.jsxs("button",{onClick:()=>i(n.sds),className:"inline-flex items-center text-sm text-[#4ECDC4] hover:text-[#3db8b0]",type:"button",children:[a.jsx(N,{path:Ft,size:1,className:"mr-1"}),"View SDS Sheet"]})})]})})}),kO=({selectedCategory:n,selectedChecklist:e,bypassedItems:t,adjustedQuantities:r,onCategoryClick:s,onChecklistSelect:i,onBypassItem:l,onAdjustQuantity:c,onViewSDS:o,onMarkComplete:d,getChecklistsForCategory:u})=>a.jsxs(a.Fragment,{children:[a.jsx(NO,{categories:jO,selectedCategory:n,onCategoryClick:s}),n&&a.jsxs("div",{role:"tabpanel",id:`panel-${n.id}`,"aria-labelledby":`tab-${n.id}`,className:"p-6 bg-white rounded-lg shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:`${n.iconColor}20`},children:a.jsx(N,{path:n.icon,size:1.5,color:n.iconColor})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n.title})]}),a.jsxs("div",{className:"space-y-4",children:[!e&&a.jsxs("div",{className:"space-y-4",children:[u(n.id).map(m=>a.jsxs("div",{onClick:()=>i(m),onKeyDown:p=>p.key==="Enter"&&i(m),className:"w-full text-left p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",role:"button",tabIndex:0,"aria-label":`Select ${m.title} checklist`,children:[a.jsx("h3",{className:"font-medium text-[#5b5b5b]",children:m.title}),m.description&&a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:m.description})]},m.id)),u(n.id).length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{children:"No published checklists available for this category."}),a.jsx("p",{className:"text-sm mt-1",children:"Create and publish checklists in Settings to see them here."})]})]}),e&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium text-[#5b5b5b]",children:e.title}),a.jsx("div",{className:"space-y-2",children:e.items.map(m=>a.jsx(ff,{item:m,bypassedItems:t,adjustedQuantities:r,onBypassItem:l,onAdjustQuantity:c,onViewSDS:o},m.id))}),a.jsx("div",{className:"mt-6 flex justify-end",children:a.jsx("button",{onClick:d,className:"bg-[#4ECDC4] text-white px-4 py-2 rounded-lg hover:bg-[#3db8b0] transition-colors",type:"button",children:"Mark All Complete"})})]})]})]})]}),PO=({searchQuery:n,sdsCategory:e,filteredSDSSheets:t,onTabChange:r,onSearchQueryChange:s,onSdsCategoryChange:i,onSDSSelect:l})=>a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>r("checklists"),onKeyDown:c=>c.key==="Escape"&&r("checklists"),role:"dialog","aria-label":"SDS Sheets Modal",children:a.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",role:"document",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(N,{path:Ft,size:1.2,color:"#4ECDC4",className:"mr-2"}),a.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"SDS Sheets"})]}),a.jsx("button",{onClick:()=>r("checklists"),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close SDS Sheets",type:"button",children:a.jsx(N,{path:pt,size:1.2,color:"#5b5b5b"})})]}),a.jsxs("div",{className:"flex gap-2 mb-4",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx("input",{type:"text",placeholder:"Search SDS sheets...",value:n,onChange:c=>s(c.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]"}),a.jsx(N,{path:Io,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),a.jsxs("select",{value:e,onChange:c=>i(c.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[a.jsx("option",{value:"all",children:"All Categories"}),a.jsx("option",{value:"Cleaning",children:"Cleaning"}),a.jsx("option",{value:"Sanitization",children:"Sanitization"})]})]}),a.jsx("div",{className:"space-y-2",children:t.map(c=>a.jsxs("div",{onClick:()=>l(c),onKeyDown:o=>o.key==="Enter"&&l(c),className:"w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",role:"button",tabIndex:0,"aria-label":`Select ${c.name} SDS sheet`,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-medium text-[#5b5b5b]",children:c.name}),a.jsx("span",{className:"text-sm text-gray-500",children:"•"}),a.jsx("p",{className:"text-sm text-gray-500",children:c.category})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-gray-500",children:c.lastUpdated}),a.jsx(N,{path:Ft,size:1,color:"#4ECDC4"})]})]},c.id))})]})}),DO=({stolenItems:n,onAddStolenItem:e,onUpdateStolenItem:t,onClearStolenItems:r})=>a.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Reported Stolen Items"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:r,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear All"}),a.jsx("button",{onClick:e,className:`px-3 py-1 ${lf.error.light} text-red-600 rounded-md hover:bg-red-100 text-sm`,children:"+ Add Stolen Item"})]})]}),n.map((s,i)=>{var l;return a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"text",placeholder:"Item",value:s.item,onChange:c=>t(i,"item",c.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),a.jsx("input",{type:"number",placeholder:"Qty",value:s.quantity,onChange:c=>t(i,"quantity",parseInt(c.target.value)||0),className:"w-20 px-3 py-2 border border-gray-300 rounded-md"}),a.jsx("input",{type:"text",placeholder:"Notes",value:(l=s.data)==null?void 0:l.notes,onChange:c=>t(i,"notes",c.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"})]},i)})]}),AO=({prnItems:n,onAddPrnItem:e,onUpdatePrnItem:t,onClearPrnItems:r})=>a.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"PRN Cleaning Items"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:r,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear All"}),a.jsx("button",{onClick:e,className:`px-3 py-1 ${lf.info.light} text-blue-600 rounded-md hover:bg-blue-100 text-sm`,children:"+ Add PRN Item"})]})]}),n.map((s,i)=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"text",placeholder:"Item",value:s.item,onChange:l=>t(i,"item",l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),a.jsx("input",{type:"number",placeholder:"Qty",value:s.quantity,onChange:l=>t(i,"quantity",parseInt(l.target.value)||0),className:"w-20 px-3 py-2 border border-gray-300 rounded-md"}),a.jsx("input",{type:"text",placeholder:"Reason",value:s.reason,onChange:l=>t(i,"reason",l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"})]},i))]}),OO=({notes:n,isListening:e,transcript:t,onNotesChange:r,onClearNotes:s,onStartSpeechRecognition:i,onStopSpeechRecognition:l,onApplyTranscriptToNotes:c})=>a.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Notes"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:s,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear Notes"}),a.jsxs("button",{onClick:e?l:i,className:`px-3 py-1 rounded-md text-sm flex items-center gap-1 ${e?"bg-red-100 text-red-600 hover:bg-red-200":"bg-blue-100 text-blue-600 hover:bg-blue-200"}`,children:[a.jsx(N,{path:e?Hg:Zo,size:.8}),e?"Stop Dictation":"Start Dictation"]})]})]}),e&&a.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("span",{className:"text-sm font-medium text-blue-800 flex items-center",children:[a.jsx(N,{path:Zo,size:.8,className:"mr-1 animate-pulse"}),"Listening... Speak now"]}),a.jsx("button",{onClick:()=>c(r),disabled:!t.trim(),className:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add to Notes"})]}),a.jsx("div",{className:"text-sm text-blue-700 min-h-[2rem]",children:t||"Waiting for speech..."})]}),a.jsx("textarea",{value:n,onChange:o=>r(o.target.value),placeholder:"Add any additional notes here... Use the dictation button to speak your notes!",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md"})]}),RO=({showModal:n,selectedCategory:e,selectedChecklist:t,bypassedItems:r,adjustedQuantities:s,stolenItems:i,prnItems:l,notes:c,isListening:o,transcript:d,onClose:u,onChecklistSelect:m,onSetSelectedChecklist:p,onBypassItem:f,onAdjustQuantity:g,onViewSDS:y,onAddStolenItem:v,onUpdateStolenItem:x,onClearStolenItems:b,onAddPrnItem:C,onUpdatePrnItem:k,onClearPrnItems:P,onNotesChange:E,onClearNotes:$,onStartSpeechRecognition:w,onStopSpeechRecognition:S,onApplyTranscriptToNotes:A,getChecklistsForCategory:I})=>a.jsx(Ho,{show:n,onClose:u,title:(e==null?void 0:e.title)||"Select Checklist",footer:a.jsx("div",{className:"flex justify-end w-full",children:a.jsx("button",{onClick:u,className:"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 font-medium py-2 px-4 rounded-md transition-colors",children:"Close"})}),children:t?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:t.title}),a.jsxs("button",{onClick:()=>p(null),className:"text-sm text-gray-600 hover:text-gray-800 flex items-center",children:[a.jsx(N,{path:Vg,size:1,className:"mr-1"}),"Back to Lists"]})]}),a.jsx("div",{className:"bg-white rounded-lg border border-gray-200 divide-y divide-gray-200",children:t.items.map(T=>a.jsx(ff,{item:T,bypassedItems:r,adjustedQuantities:s,onBypassItem:f,onAdjustQuantity:g,onViewSDS:y},T.id))}),a.jsx(DO,{stolenItems:i,onAddStolenItem:v,onUpdateStolenItem:x,onClearStolenItems:b}),a.jsx(AO,{prnItems:l,onAddPrnItem:C,onUpdatePrnItem:k,onClearPrnItems:P}),a.jsx(OO,{notes:c,isListening:o,transcript:d,onNotesChange:E,onClearNotes:$,onStartSpeechRecognition:w,onStopSpeechRecognition:S,onApplyTranscriptToNotes:A})]}):a.jsxs("div",{className:"space-y-3",children:[e&&I(e.id).map(T=>a.jsxs("div",{onClick:()=>m(T),onKeyDown:j=>j.key==="Enter"&&m(T),className:"w-full p-3 text-left bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer",role:"button",tabIndex:0,"aria-label":`Select ${T.title} checklist`,children:[a.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-1",children:T.title}),a.jsx("p",{className:"text-sm text-gray-600",children:T.description})]},T.id)),e&&I(e.id).length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{children:"No published checklists available for this category."}),a.jsx("p",{className:"text-sm mt-1",children:"Create and publish checklists in Settings to see them here."})]})]})}),$O=({selectedSDS:n,onClose:e})=>a.jsx(Ho,{show:!!n,onClose:e,title:"Safety Data Sheet",children:n&&a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:n.name}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:n.name}),a.jsx("div",{className:"flex flex-wrap gap-2",children:n.sections.map(t=>a.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm",children:t},t))})]})})}),MO=()=>{const{getPublishedChecklistsByCategory:n}=vO(),{selectedCategory:e,selectedChecklist:t,activeTab:r,searchQuery:s,selectedSDS:i,sdsCategory:l,bypassedItems:c,adjustedQuantities:o,showModal:d,notes:u,stolenItems:m,prnItems:p,setSelectedChecklist:f,setActiveTab:g,setSearchQuery:y,setSelectedSDS:v,setSdsCategory:x,setNotes:b,handleCategoryClick:C,handleChecklistSelect:k,handleCloseModal:P,handleMarkComplete:E,handleBypassItem:$,handleAdjustQuantity:w,handleAddStolenItem:S,handleAddPrnItem:A,handleUpdateStolenItem:I,handleUpdatePrnItem:T,clearStolenItems:j,clearPrnItems:M,clearNotes:B}=CO(),{isListening:G,transcript:Y,startSpeechRecognition:R,stopSpeechRecognition:D,applyTranscriptToNotes:U}=IO(),F=q=>n(q).map(ee=>({id:ee.id,title:ee.title,description:`Published checklist with ${ee.items.length} items`,items:ee.items.map(Ee=>{var zr;return{id:Ee.id,title:Ee.title,instructions:Ee.instructions,inventoryItems:(zr=Ee.requiredInventory)==null?void 0:zr.map(Ht=>({id:Ht.id,name:Ht.name,currentStock:Ht.available,requiredQuantity:Ht.required,category:"Cleaning Supplies"})),completed:Ee.completed||!1}})})),V=EO.filter(q=>{const W=q.name.toLowerCase().includes(s.toLowerCase()),ee=l==="all"||q.category===l;return W&&ee});return a.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsx(TO,{activeTab:r,onTabChange:q=>g(q)}),r==="checklists"&&a.jsx(kO,{selectedCategory:e,selectedChecklist:t,bypassedItems:c,adjustedQuantities:o,onCategoryClick:C,onChecklistSelect:k,onBypassItem:$,onAdjustQuantity:w,onViewSDS:v,onMarkComplete:E,getChecklistsForCategory:F}),r==="sds"&&a.jsx(PO,{searchQuery:s,sdsCategory:l,filteredSDSSheets:V,onTabChange:q=>g(q),onSearchQueryChange:y,onSdsCategoryChange:x,onSDSSelect:q=>v(q)}),a.jsx(RO,{showModal:d,selectedCategory:e,selectedChecklist:t,bypassedItems:c,adjustedQuantities:o,stolenItems:m,prnItems:p,notes:u,isListening:G,transcript:Y,onClose:P,onChecklistSelect:k,onSetSelectedChecklist:f,onBypassItem:$,onAdjustQuantity:w,onViewSDS:v,onAddStolenItem:S,onUpdateStolenItem:I,onClearStolenItems:j,onAddPrnItem:A,onUpdatePrnItem:T,onClearPrnItems:M,onNotesChange:b,onClearNotes:B,onStartSpeechRecognition:R,onStopSpeechRecognition:D,onApplyTranscriptToNotes:U,getChecklistsForCategory:F}),a.jsx($O,{selectedSDS:i,onClose:()=>v(null)})]})},FO=()=>a.jsx("div",{children:a.jsx(MO,{})}),LO=X.memo(({clean:n})=>a.jsxs("div",{className:"p-4 border rounded-lg shadow-sm",children:[a.jsxs("h3",{className:"font-medium text-gray-900",children:["Room ",n.id]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",n.status]})]}));LO.displayName="EnvironmentalCleanItem";const zO=()=>{const n=In(),[e]=h.useState(!1),t=gA(),r=h.useRef(t);h.useEffect(()=>{r.current=t},[t]);const{rooms:s}=of(),{searchTerm:i,status:l,onSearchChange:c,onStatusChange:o}=cA(s);h.useEffect(()=>{r.current.mutate({action:"view_page"})},[]),h.useEffect(()=>{l&&l!=="all"&&r.current.mutate({action:"filter_status",item:{status:l}})},[l]);const d=()=>{console.log("🔍 Navigating to scanner page..."),n("/environmental-clean/scanner")};return a.jsx($A,{children:a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx(yA,{isScanning:e,onScan:d,searchTerm:i,onSearchTermChange:c,selectedStatus:l,onStatusChange:o}),a.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[a.jsx(eO,{}),a.jsx(aO,{})]}),a.jsx(FO,{})]})})]})})};var zm=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const BO={startSession(n){return zm(this,arguments,function*({module:e,metadata:t={}}){const{data:{user:r},error:s}=yield _.auth.getUser();if(s||!r)return console.error("WorkflowService.startSession: No authenticated user found."),null;const{data:i,error:l}=yield _.from("workflow_sessions").insert([{operator_id:r.id,module:e,status:"active",metadata:t}]).select().single();return l?(console.error("WorkflowService.startSession failed:",l.message),null):i})},endSession(n){return zm(this,null,function*(){if(!n){console.warn("WorkflowService.endSession called with no sessionId.");return}const{error:e}=yield _.from("workflow_sessions").update({status:"completed",ended_at:new Date().toISOString()}).eq("id",n);e?console.error("WorkflowService.endSession failed:",e.message):console.info(`Workflow session ${n} successfully closed.`)})}};var qO=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function UO(){const[n,e]=h.useState(null);return h.useEffect(()=>{qO(null,null,function*(){try{const r=yield BO.startSession({module:"environmental_clean"});r!=null&&r.id&&e(r.id)}catch(r){console.error("Failed to start workflow session:",r)}})},[]),a.jsx(Cn,{FallbackComponent:FD,children:a.jsx(ks,{children:a.jsx(Cn,{FallbackComponent:LD,children:a.jsx(zO,{})})})})}const HO=({children:n})=>a.jsx("div",{children:n}),Xi=`
⚠️ Deprecated: Old Knowledge Hub mock data files were removed.
This placeholder prevents accidental imports. All Knowledge Hub data now comes directly from Supabase.
`;var VO=Object.defineProperty,Bm=Object.getOwnPropertySymbols,WO=Object.prototype.hasOwnProperty,GO=Object.prototype.propertyIsEnumerable,qm=(n,e,t)=>e in n?VO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,fa=(n,e)=>{for(var t in e||(e={}))WO.call(e,t)&&qm(n,t,e[t]);if(Bm)for(var t of Bm(e))GO.call(e,t)&&qm(n,t,e[t]);return n},ga=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class $e{static getCategoryCount(e,t){return e.filter(r=>r.category===t).length}static updateContentInList(e,t,r){return e.map(s=>s.id===t?fa(fa({},s),r):s)}static removeContentFromList(e,t){return e.filter(r=>r.id!==t)}static performContentUpdate(e,t){return ga(this,null,function*(){try{return console.warn(Xi),fa({id:e},t)}catch(r){return console.error(r),fa({id:e},t)}})}static performContentDeletion(e){return ga(this,null,function*(){try{const{supabase:t}=yield L(()=>import("./login-CgiYf71G.js").then(s=>s.P),__vite__mapDeps([1,2,3,4,5])),{error:r}=yield t.from("knowledge_hub_content").delete().eq("id",e);if(r)throw new Error(`Failed to delete content: ${r.message}`);console.log(`✅ Successfully deleted content item: ${e}`)}catch(t){throw console.error("Error deleting content:",t),t}})}static performContentStatusUpdate(e,t){return ga(this,null,function*(){try{return console.warn(Xi),{id:e,status:t}}catch(r){return console.error(r),{id:e,status:t}}})}static performContentFetch(){return ga(this,null,function*(){try{return console.warn(Xi),[]}catch(e){return console.error(e),[]}})}static createError(e){return new Error(e)}static getErrorMessage(e){return e instanceof Error?e.message:"An unknown error occurred"}}var gs=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const KO=()=>gs(null,null,function*(){try{const{data:n,error:e}=yield _.from("knowledge_hub_content").select("*").order("created_at",{ascending:!1});return e?(console.error("❌ Failed to fetch Knowledge Hub content:",e.message),[]):(console.log(`✅ Loaded ${(n==null?void 0:n.length)||0} Knowledge Hub items from Supabase`),n||[])}catch(n){return console.error("❌ Unexpected error fetching Knowledge Hub content:",n),[]}}),gf=h.createContext(void 0),QO=({children:n})=>{const[e,t]=h.useState([]),[r,s]=h.useState(null),[i,l]=h.useState(!1),[c,o]=h.useState(null),[d,u]=h.useState(null),[m,p]=h.useState(null),f=h.useCallback(()=>gs(null,null,function*(){try{l(!0),o(null);const P=yield KO();if(t(P),s(P),!d&&P.length>0){const E=P[0].category;u(E)}_.auth.getUser().then(E=>{var $;($=E==null?void 0:E.data)!=null&&$.user}).catch(E=>{console.warn("Supabase auth not available:",E)})}catch(P){const E=$e.getErrorMessage(P);o($e.createError(E)),console.error("❌ KnowledgeHub: Error fetching content:",P)}finally{l(!1)}}),[]);h.useEffect(()=>{const P=setTimeout(()=>{f()},0);return()=>clearTimeout(P)},[f]);const g=h.useCallback((P,E)=>gs(null,null,function*(){try{l(!0),o(null);const $=yield $e.performContentUpdate(P,E);return t(w=>$e.updateContentInList(w,P,$)),!0}catch($){const w=$e.getErrorMessage($);return o($e.createError(w)),!1}finally{l(!1)}}),[]),y=h.useCallback(P=>gs(null,null,function*(){try{return l(!0),o(null),yield $e.performContentDeletion(P),t(E=>$e.removeContentFromList(E,P)),!0}catch(E){const $=$e.getErrorMessage(E);return o($e.createError($)),!1}finally{l(!1)}}),[]),v=h.useCallback(P=>$e.getCategoryCount(e,P),[e]),x=h.useCallback((P,E)=>gs(null,null,function*(){try{l(!0),o(null);const $=yield $e.performContentStatusUpdate(P,E);return t(w=>$e.updateContentInList(w,P,$)),!0}catch($){const w=$e.getErrorMessage($);return o($e.createError(w)),!1}finally{l(!1)}}),[]),b=h.useCallback(()=>{p(null)},[]),C=h.useCallback(P=>{u(P);const E=e.filter($=>$.category===P);s(E)},[e]),k={content:e,selectedContent:r,selectedCategory:d,isLoading:i,error:c,validationError:m,setSelectedCategory:C,getCategoryCount:v,refetchContent:f,deleteContent:y,updateContentStatus:x,updateContent:g,clearValidationError:b};return a.jsx(gf.Provider,{value:k,children:n})},mr=()=>{const n=h.useContext(gf);if(n===void 0)throw new Error("useSimplifiedKnowledgeHub must be used within a SimplifiedKnowledgeHubProvider");return n};var YO=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const be=(n,e="")=>typeof n=="string"&&n.trim()!==""?n:e,Um=(n,e=0)=>typeof n=="number"&&!isNaN(n)?n:e,Hm=(n,e=!1)=>typeof n=="boolean"?n:e,JO=n=>Array.isArray(n)?n.filter(e=>typeof e=="string"):[],XO=n=>Array.isArray(n)?n.filter(e=>typeof e=="object"&&e!==null):[];function ZO(){return YO(this,null,function*(){var n;try{const{data:{user:e},error:t}=yield _.auth.getUser();let r=null;!t&&e&&(r=((n=e.user_metadata)==null?void 0:n.facility_id)||null);const s=_.from("courses").select("*");r&&s.eq("facility_id",r);const{data:i,error:l}=yield s.order("created_at",{ascending:!1});return l?(console.error("Error fetching content items:",l),[]):(i||[]).map(c=>{var o,d;return{id:be(c.id),title:be(c.title),category:be(c.content_type),status:be(c.status),description:be((o=c.data)==null?void 0:o.description),tags:JO((d=c.data)==null?void 0:d.tags),domain:be(c.domain),contentType:be(c.content_type),type:be(c.type),createdAt:be(c.created_at),lastUpdated:be(c.updated_at),publishedAt:be(c.published_at)||void 0,archivedAt:be(c.archived_at)||void 0,estimatedDuration:Um(c.estimated_duration)||void 0,difficultyLevel:be(c.difficulty_level),department:be(c.department)||void 0,authorId:be(c.author_id)||void 0,assignedBy:be(c.assigned_by)||void 0,isRepeat:Hm(c.is_repeat),isActive:Hm(c.is_active),content:c.content||{},media:XO(c.media),dueDate:be(c.due_date)||new Date().toISOString().split("T")[0],progress:Um(c.progress)}})}catch(e){return console.error("Error in getAllContentItems:",e),[]}})}var e1=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const t1=()=>{const[n,e]=h.useState([]),[t,r]=h.useState(!1),[s,i]=h.useState(null),l=()=>e1(null,null,function*(){try{r(!0),i(null);const o=(yield ZO()).filter(d=>d.lastUpdated).sort((d,u)=>new Date(u.lastUpdated).getTime()-new Date(d.lastUpdated).getTime()).slice(0,10).map(d=>({id:d.id,title:d.title||"Untitled",type:d.category||"Unknown",updated_at:d.lastUpdated}));e(o)}catch(c){console.error("Failed to load recent updates:",c),i(c instanceof Error?c.message:"An error occurred")}finally{r(!1)}});return h.useEffect(()=>{l()},[]),a.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[a.jsx(N,{path:ws,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Recent Activity"]}),a.jsx("button",{onClick:l,disabled:t,className:"p-1 text-gray-500 hover:text-[#4ECDC4] transition-colors",title:"Refresh activity",children:a.jsx(N,{path:Lt,size:.8,className:t?"animate-spin":""})})]}),a.jsx("div",{className:"space-y-2",children:t?a.jsxs("div",{className:"flex items-center justify-center py-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#4ECDC4]"}),a.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading..."})]}):s?a.jsx("div",{className:"text-red-500 text-sm py-2 px-2 bg-red-50 rounded",children:"Error loading activity. Please try refreshing."}):n.length===0?a.jsxs("div",{className:"text-center py-6",children:[a.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"No recent activity"}),a.jsx("p",{className:"text-xs text-gray-400",children:"Activity will appear here as you interact with content"})]}):n.map(c=>a.jsxs("div",{className:"border-b pb-2 last:border-b-0",children:[a.jsx("div",{className:"font-medium text-sm text-gray-900",children:c.title}),a.jsxs("div",{className:"text-xs text-gray-500",children:[c.type," —"," ",new Date(c.updated_at).toLocaleDateString()]})]},c.id))})]})};class us{static filterByCategory(e,t){return!e||!Array.isArray(e)?[]:e.filter(r=>r.category===t)}static filterContent(e,t){let r=[...e];if(t.searchQuery.trim()){const s=t.searchQuery.toLowerCase();r=r.filter(i=>{var l,c,o,d;return i.title.toLowerCase().includes(s)||((c=(l=i.data)==null?void 0:l.description)==null?void 0:c.toLowerCase().includes(s))||((d=(o=i.data)==null?void 0:o.tags)==null?void 0:d.some(u=>u.toLowerCase().includes(s)))})}return t.selectedDomain&&t.selectedDomain!=="All"&&(r=r.filter(s=>s.domain===t.selectedDomain)),t.selectedContentType&&t.selectedContentType!=="All"&&(r=r.filter(s=>s.contentType===t.selectedContentType)),r}static getCategoryCount(e,t){return!e||!Array.isArray(e)?0:e.filter(r=>r.category===t).length}static getUniqueDomains(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(r=>r.domain).filter(r=>!!r));return Array.from(t).sort()}static getUniqueContentTypes(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(r=>r.contentType).filter(r=>!!r));return Array.from(t).sort()}}const yf=({content:n,selectedCategory:e,filterOptions:t})=>{const r=h.useMemo(()=>!n||!Array.isArray(n)?[]:us.filterByCategory(n,e||""),[n,e]),s=h.useMemo(()=>us.filterContent(r,t),[r,t]),i=h.useMemo(()=>n?us.getUniqueDomains(n):[],[n]),l=h.useMemo(()=>n?us.getUniqueContentTypes(n):[],[n]);return{categoryItems:r,filteredItems:s,uniqueDomains:i,uniqueContentTypes:l,getCategoryCount:o=>n?us.getCategoryCount(n,o):0}},r1={Courses:{icon:"#9333ea",bgColor:"bg-purple-100",textColor:"text-purple-600",selectedBgColor:"bg-purple-50"},"Learning Pathways":{icon:"#16a34a",bgColor:"bg-green-100",textColor:"text-green-600",selectedBgColor:"bg-green-50"},Procedures:{icon:"#ea580c",bgColor:"bg-orange-100",textColor:"text-orange-600",selectedBgColor:"bg-orange-50"},Policies:{icon:"#3b82f6",bgColor:"bg-blue-100",textColor:"text-blue-600",selectedBgColor:"bg-blue-50"}},n1=()=>{const{selectedCategory:n,setSelectedCategory:e,content:t}=mr(),{getCategoryCount:r}=yf({content:t,selectedCategory:n,filterOptions:{searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""}}),s=[{id:"Courses",icon:Ss},{id:"Learning Pathways",icon:Eh},{id:"Procedures",icon:Ft},{id:"Policies",icon:bs}];return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center mb-4",children:[a.jsx(N,{path:Wg,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Categories"]}),a.jsx("div",{className:"space-y-2",children:s.map(i=>{const l=r1[i.id];return a.jsxs("button",{onClick:()=>e(i.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors flex items-center justify-between ${n===i.id?`${l.selectedBgColor} ${l.textColor}`:"text-[#5b5b5b] hover:bg-gray-100"}`,children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:`${l.bgColor} rounded-full p-1 mr-2`,children:a.jsx(N,{path:i.icon,size:.9,color:l.icon,"aria-hidden":"true"})}),i.id]}),a.jsx("span",{className:"text-sm text-gray-500",children:r(i.id)})]},i.id)})})]})};class s1{static determineRenderState(e,t,r){const{isLoading:s,error:i}=e;return{shouldShowLoading:s,shouldShowError:!!i,shouldShowEmpty:!s&&!i&&(!t||r.length===0),shouldShowContent:!s&&!i&&!!t&&r.length>0}}static getTagColor(e){switch(e){case"Required":return"bg-red-100 text-red-800";case"Optional":return"bg-blue-100 text-blue-800";case"New":return"bg-green-100 text-green-800";case"Updated":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}}static getStatusColor(e){switch(e){case"Not Started":return"bg-gray-100 text-gray-700";case"In Progress":return"bg-blue-100 text-blue-700";case"Completed":return"bg-green-100 text-green-700";default:return"bg-gray-100 text-gray-700"}}static formatTimeAgo(e){const t=new Date,r=new Date(e),s=Math.floor((t.getTime()-r.getTime())/(1e3*60*60));if(s<1)return"Just now";if(s<24)return`${s} hours ago`;const i=Math.floor(s/24);if(i<7)return`${i} days ago`;const l=Math.floor(i/7);return l<4?`${l} weeks ago`:`${Math.floor(i/30)} months ago`}}const a1=({uiState:n,selectedCategory:e,categoryItems:t})=>h.useMemo(()=>s1.determineRenderState(n,e,t),[n,e,t]),vf=({selectedCategory:n})=>a.jsx("div",{className:"mt-4",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-gray-50",children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:n==="Courses"?"Course Name":n==="Learning Pathways"?"Pathway Name":n==="Procedures"?"Procedure Name":n==="Policies"?"Policy Name":"Content Name"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:n==="Courses"?"Status":n==="Learning Pathways"?"Courses":n==="Procedures"?"Department":"Category"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:n==="Courses"?"Due Date":n==="Learning Pathways"?"Status":"Last Updated"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:n==="Courses"||n==="Learning Pathways"?"Progress":"Status"}),a.jsx("th",{className:"w-10 px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:n?"No content available in this category.":"Select a category to view content."})})})]})})}),ys=()=>a.jsx(uh,{rows:5,columns:4}),i1=({error:n,onRetry:e})=>a.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[a.jsx(N,{path:Le,size:2,color:"#ef4444",className:"mb-2"}),a.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Failed to load content"}),a.jsx("p",{className:"text-gray-500 text-sm mb-4",children:n.message}),a.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#3db8b0] transition",children:[a.jsx(N,{path:Lt,size:.8}),"Retry"]})]}),o1=({category:n})=>{const e=h.useMemo(()=>{switch(n){case"Courses":return Ss;case"Learning Pathways":return Eh;case"Procedures":return Ft;case"Policies":return bs;default:return Ss}},[n]);return a.jsx(N,{path:e,size:1.1,color:"#4ECDC4",className:"mr-2"})},l1=({category:n,isLoading:e})=>a.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(o1,{category:n}),n||"All Categories",e&&a.jsx("div",{className:"ml-2 animate-spin rounded-full h-4 w-4 border-b-2 border-[#4ECDC4]"})]}),c1=({category:n,items:e,onStartContent:t,CoursesTable:r,LearningPathwaysTable:s,ProceduresTable:i,PoliciesTable:l})=>h.useMemo(()=>{switch(n){case"Courses":return a.jsx(h.Suspense,{fallback:a.jsx(ys,{}),children:a.jsx(r,{items:e,onStartContent:t})});case"Learning Pathways":return a.jsx(h.Suspense,{fallback:a.jsx(ys,{}),children:a.jsx(s,{items:e,onStartContent:t})});case"Procedures":return a.jsx(h.Suspense,{fallback:a.jsx(ys,{}),children:a.jsx(i,{items:e,onStartContent:t})});case"Policies":return a.jsx(h.Suspense,{fallback:a.jsx(ys,{}),children:a.jsx(l,{items:e,onStartContent:t})});default:return a.jsx(vf,{selectedCategory:n})}},[n,e,t,r,s,i,l]),d1=({pagination:n,onPageChange:e})=>{const{totalItems:t,totalPages:r,currentPage:s}=n;return t===0?null:a.jsxs("div",{className:"flex justify-center items-center mt-4 gap-4",role:"navigation","aria-label":"Table pagination",children:[a.jsx("button",{onClick:()=>e(Math.max(1,s-1)),disabled:s===1,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to previous page","aria-disabled":s===1,tabIndex:0,children:"Previous"}),a.jsxs("span",{className:"text-sm text-gray-700","aria-label":`Page ${s} of ${r}`,children:["Page ",s," of ",r]}),a.jsx("button",{onClick:()=>e(Math.min(r,s+1)),disabled:s===r,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to next page","aria-disabled":s===r,tabIndex:0,children:"Next"})]})},u1=({item:n,isExpanded:e,onToggleExpansion:t,onDelete:r,onStartContent:s,progressDisplay:i,dueDateDisplay:l,actionButton:c,columnWidths:o})=>{var d,u;if(!n)return console.warn("TableRow: item prop is undefined or null"),null;const m=()=>{n!=null&&n.id&&t(n.id)},p=()=>{n!=null&&n.id&&r(n.id)},f=()=>{s&&(n!=null&&n.id)&&s(n.id)};try{return a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.content)||"auto"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:m,className:"p-1 hover:bg-gray-200 rounded",children:a.jsx(N,{path:e?wn:Oa,size:.8,className:"text-gray-500"})}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-gray-900 leading-tight",children:n!=null&&n.title&&n.title.length>40?a.jsxs(a.Fragment,{children:[a.jsx("div",{children:n.title.substring(0,40)}),a.jsx("div",{className:"text-sm text-gray-600",children:n.title.substring(40)})]}):(n==null?void 0:n.title)||"Untitled"})})]})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.progress)||"auto"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:`h-2 rounded-full ${((i==null?void 0:i.percentage)||0)===0?"bg-gray-400":((i==null?void 0:i.percentage)||0)===100?"bg-[#10B981]":"bg-[#4ECDC4]"}`,style:{width:`${(i==null?void 0:i.percentage)||0}%`}})})}),a.jsx("span",{className:"text-sm text-gray-600 min-w-[3rem]",children:(i==null?void 0:i.text)||"0%"})]})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.startDate)||"auto"},children:((i==null?void 0:i.percentage)||0)>0&&(n!=null&&n.lastUpdated)?a.jsx("span",{className:"text-sm text-gray-700",children:(()=>{try{return new Date(n.lastUpdated).toLocaleDateString()}catch(g){return console.error(g),"Invalid date"}})()}):a.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.assigned)||"auto"},children:a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("span",{className:`text-lg font-medium ${((i==null?void 0:i.percentage)||0)>0?"text-[#10B981]":"text-gray-400"}`,children:((i==null?void 0:i.percentage)||0)>0?"✓":"✗"})})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.actions)||"auto"},children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:f,disabled:(c==null?void 0:c.disabled)||!1,className:`w-8 h-8 rounded flex items-center justify-center transition-colors ${(c==null?void 0:c.variant)==="primary"?"bg-[#4ECDC4] text-white hover:bg-[#3DB8B0] disabled:bg-gray-300":(c==null?void 0:c.variant)==="secondary"?"bg-[#5B5B5B] text-white hover:bg-[#4A4A4A] disabled:bg-gray-300":"bg-[#EF4444] text-white hover:bg-[#DC2626] disabled:bg-gray-300"} disabled:cursor-not-allowed`,title:((i==null?void 0:i.percentage)||0)===100?"View":((i==null?void 0:i.percentage)||0)>0?"Resume":"Start",children:a.jsx(N,{path:((i==null?void 0:i.percentage)||0)===100?Gg:((i==null?void 0:i.percentage)||0)>0?Ca:Sn,size:.8})}),a.jsx("button",{onClick:p,className:"w-8 h-8 text-[#EF4444] hover:bg-red-50 rounded flex items-center justify-center transition-colors",title:"Delete",children:a.jsx(N,{path:Co,size:.8})})]})})]}),e&&a.jsx("tr",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-[#4ECDC4]",children:a.jsx("td",{colSpan:5,className:"px-4 py-4",children:a.jsxs("div",{className:"space-y-4 animate-in slide-in-from-top-2 duration-300",children:[(n==null?void 0:n.description)&&a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(N,{path:wn,size:.8,className:"text-[#4ECDC4]"}),a.jsx("h4",{className:"font-semibold text-gray-900",children:"Description"})]}),a.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:(d=n.data)==null?void 0:d.description})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${n.difficultyLevel==="advanced"?"bg-red-500":n.difficultyLevel==="intermediate"?"bg-yellow-500":"bg-green-500"}`}),a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Difficulty"})]}),a.jsx("p",{className:"text-xs text-gray-600 capitalize",children:n.difficultyLevel||"Beginner"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(N,{path:xn,size:.7,className:"text-[#4ECDC4]"}),a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Duration"})]}),a.jsx("p",{className:"text-xs text-gray-600",children:n.estimatedDuration?`${n.estimatedDuration} minutes`:"Not specified"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(N,{path:xn,size:.7,className:"text-[#4ECDC4]"}),a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Due Date"})]}),a.jsx("span",{className:`text-xs ${(l==null?void 0:l.color)||"text-gray-600"}`,children:(l==null?void 0:l.text)||"No due date"})]})]}),((u=n==null?void 0:n.data)==null?void 0:u.tags)&&n.data.tags.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"Tags"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:n.data.tags.map((g,y)=>a.jsxs("span",{className:"px-2 py-1 text-xs bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-800 rounded-full border border-blue-200 font-medium",children:["#",g]},y))})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Progress"}),a.jsx("span",{className:"text-xs font-medium text-gray-600",children:(i==null?void 0:i.text)||"0%"})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ease-out ${((i==null?void 0:i.percentage)||0)===0?"bg-gray-400":((i==null?void 0:i.percentage)||0)===100?"bg-gradient-to-r from-green-500 to-green-600":"bg-gradient-to-r from-[#4ECDC4] to-[#3DB8B0]"}`,style:{width:`${(i==null?void 0:i.percentage)||0}%`}})})]})]})})})]})}catch(g){return console.error("Error rendering TableRow:",g),a.jsx("tr",{className:"border-b border-gray-200",children:a.jsxs("td",{colSpan:5,className:"px-4 py-3 text-center text-red-600",children:["Error loading row data. Please refresh the page."," ",g instanceof Error?g.message:"Unknown error"]})})}},m1=n=>{const e=_f(n),t=h1(e),r=`${e}%`;return{percentage:e,color:t,text:r}},_f=n=>{if(n.progress!==void 0)return Math.round(n.progress);switch(n.status){case"draft":return 0;case"published":return 25;case"review":return 75;case"archived":return 100;default:return 0}},h1=n=>n>=100?"bg-green-500":n>=75?"bg-blue-500":n>=50?"bg-yellow-500":n>=25?"bg-orange-500":"bg-red-500",p1=(n,e)=>{const t=e[n];if(!t)return{text:"Not started",color:"text-gray-500",isOverdue:!1};const s=t<new Date;return{text:xf(t),color:s?"text-red-600":"text-gray-700",isOverdue:s}},f1=(n,e)=>{const t=e[n];if(!t)return{text:"No due date",color:"text-gray-500",isOverdue:!1};const s=t<new Date;return{text:xf(t),color:s?"text-red-600":"text-gray-700",isOverdue:s}},g1=(n,e)=>{const t=_f(n);return t===100?{text:"Completed",icon:Ca,onClick:()=>{},disabled:!0,variant:"secondary"}:t>0?{text:"Resume",icon:Sn,onClick:()=>e==null?void 0:e(n.id),disabled:!1,variant:"primary"}:{text:"Start",icon:Sn,onClick:()=>e==null?void 0:e(n.id),disabled:!1,variant:"primary"}},xf=n=>{const e=new Date,t=Math.abs(e.getTime()-n.getTime()),r=Math.ceil(t/(1e3*60*60*24));return r===0?"Today":r===1?n<e?"Yesterday":"Tomorrow":r<7?`${r} days ${n<e?"ago":"from now"}`:n.toLocaleDateString()},y1=(n,e,t)=>{const r=Math.ceil(n/t),s=(e-1)*t,i=s+t;return{totalItems:n,totalPages:r,startIndex:s,endIndex:i,currentPage:e,pageSize:t}};var v1=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Wa=({items:n,onDelete:e,onStartContent:t})=>{const{updateContentStatus:r,refetchContent:s}=mr(),[i,l]=h.useState(new Set),[c]=h.useState({}),[o]=h.useState({}),[d,u]=h.useState(1),[m,p]=h.useState(10),[f]=h.useState({content:500,progress:150,startDate:140,assigned:120,actions:120}),g=n,y=h.useMemo(()=>y1(g.length,d,m),[g.length,d,m]),v=h.useMemo(()=>{const P=y.startIndex,E=y.endIndex;return g.slice(P,E)},[g,y.startIndex,y.endIndex]),x=P=>{u(P)},b=P=>{const E=new Set(i);E.has(P)?E.delete(P):E.add(P),l(E)},C=P=>v1(null,null,function*(){try{e(P),yield s()}catch(E){console.error("Failed to delete item:",E)}}),k=P=>{t&&t(P)};return a.jsxs("div",{className:"overflow-hidden",children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Content"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map(P=>{const E=m1(P),$=p1(P.id,c),w=f1(P.id,o),S=g1(P,k);return a.jsx(u1,{item:P,isExpanded:i.has(P.id),onToggleExpansion:b,onDelete:C,onStartContent:k,progressDisplay:E,startDateDisplay:$,dueDateDisplay:w,actionButton:S,columnWidths:f},P.id)})})]})}),a.jsx(d1,{pagination:y,onPageChange:x})]})},bf=X.memo(({items:n,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:r}=mr(),s=n&&n.length>0?n:[];return a.jsx(Wa,{items:s,type:"courses",onDelete:t,onStatusUpdate:r,onStartContent:e})});bf.displayName="CoursesTable";const wf=X.memo(({items:n,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:r}=mr(),s=n.length>0?n:[];return a.jsx(Wa,{items:s,type:"learning-pathways",onDelete:t,onStatusUpdate:r,onStartContent:e})});wf.displayName="LearningPathwaysTable";const Sf=X.memo(({items:n,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:r}=mr(),s=n&&n.length>0?n:[];return a.jsx(Wa,{items:s,type:"procedures",onDelete:t,onStatusUpdate:r,onStartContent:e})});Sf.displayName="ProceduresTable";const Cf=X.memo(({items:n,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:r}=mr(),s=n&&n.length>0?n:[];return a.jsx(Wa,{items:s,type:"policies",onDelete:t,onStatusUpdate:r,onStartContent:e})});Cf.displayName="PoliciesTable";var _1=Object.defineProperty,x1=Object.defineProperties,b1=Object.getOwnPropertyDescriptors,Vm=Object.getOwnPropertySymbols,w1=Object.prototype.hasOwnProperty,S1=Object.prototype.propertyIsEnumerable,Wm=(n,e,t)=>e in n?_1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Gm=(n,e)=>{for(var t in e||(e={}))w1.call(e,t)&&Wm(n,t,e[t]);if(Vm)for(var t of Vm(e))S1.call(e,t)&&Wm(n,t,e[t]);return n},Km=(n,e)=>x1(n,b1(e));const C1=({onFiltersChange:n,selectedCategory:e,onCategoryChange:t,statusOptions:r,difficultyOptions:s,durationOptions:i})=>{const[l,c]=h.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),[o,d]=h.useState(!1),u=h.useCallback((x,b)=>{const C=Km(Gm({},l),{[x]:b});c(C),n(C)},[l,n]),m=h.useCallback(x=>{const b=x.target.value,C=Km(Gm({},l),{searchQuery:b});c(C),n(C)},[l,n]),p=h.useCallback(x=>{t(x.target.value)},[t]),f=h.useCallback(()=>{d(!o)},[o]),g=h.useCallback(()=>{const x={searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"};c(x),n(x)},[n]),y=[{value:"all",label:"All Categories"},{value:"Courses",label:"Courses"},{value:"Policies",label:"Policies"},{value:"Procedures",label:"Procedures"},{value:"Learning Pathways",label:"Learning Pathways"}],v=[{value:"title",label:"Title"},{value:"date",label:"Date"},{value:"progress",label:"Progress"},{value:"difficulty",label:"Difficulty"},{value:"duration",label:"Duration"}];return a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2 overflow-x-hidden",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(N,{path:Io,size:1,className:"text-gray-400"})}),a.jsx("input",{type:"text",placeholder:"Search all content...",value:l.searchQuery,onChange:m,className:"form-control w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsx("div",{className:"lg:w-48",children:a.jsx("select",{value:e,onChange:p,className:"form-select",children:y.map(x=>a.jsx("option",{value:x.value,children:x.label},x.value))})}),a.jsxs(Is,{variant:"outline-secondary",className:"font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",onClick:f,"aria-expanded":o,"aria-controls":"expanded-filters-panel","aria-label":`${o?"Hide":"Show"} advanced filters`,children:[a.jsx(N,{path:wo,size:1,className:"mr-2","aria-hidden":"true"}),"Filters"]}),a.jsxs(Is,{variant:"outline-secondary",className:"font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",onClick:()=>u("sortOrder",l.sortOrder==="asc"?"desc":"asc"),children:[a.jsx(N,{path:Kg,size:1,className:"mr-2"}),l.sortOrder==="asc"?"↑":"↓"]})]}),o&&a.jsxs("div",{id:"expanded-filters-panel",className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 flex flex-wrap gap-3",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full",children:[a.jsxs("div",{className:"sm:w-32",children:[a.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Status"}),a.jsxs("select",{id:"status-filter",className:"form-select",value:l.statusFilter,onChange:x=>u("statusFilter",x.target.value),children:[a.jsx("option",{value:"all",children:"All Statuses"}),r.map(x=>a.jsx("option",{value:x,children:x},x))]})]}),a.jsxs("div",{className:"sm:w-32",children:[a.jsx("label",{htmlFor:"difficulty-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Difficulty"}),a.jsxs("select",{id:"difficulty-filter",className:"form-select",value:l.difficultyFilter,onChange:x=>u("difficultyFilter",x.target.value),children:[a.jsx("option",{value:"all",children:"All Levels"}),s.map(x=>a.jsx("option",{value:x,children:x},x))]})]}),a.jsxs("div",{className:"sm:w-40",children:[a.jsx("label",{htmlFor:"duration-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Duration"}),a.jsxs("select",{id:"duration-filter",className:"form-select",value:l.durationFilter,onChange:x=>u("durationFilter",x.target.value),children:[a.jsx("option",{value:"all",children:"Any Duration"}),i.map(x=>a.jsx("option",{value:x,children:x},x))]})]}),a.jsxs("div",{className:"sm:w-32",children:[a.jsx("label",{htmlFor:"sort-by-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Sort By"}),a.jsx("select",{id:"sort-by-filter",className:"form-select",value:l.sortBy,onChange:x=>u("sortBy",x.target.value),children:v.map(x=>a.jsx("option",{value:x.value,children:x.label},x.value))})]})]}),a.jsx("div",{className:"flex justify-end w-full",children:a.jsx("button",{onClick:g,className:"inline-flex items-center px-3 py-1 border border-gray-300 rounded text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Clear All Filters"})})]})]})},If=X.memo(()=>{const[n,e]=h.useState(null),t=In(),r=h.useCallback(I=>{console.error("ContentTable error:",I),e(I)},[]),s=h.useCallback(()=>{e(null)},[]),{selectedCategory:i,selectedContent:l,isLoading:c,error:o,refetchContent:d,deleteContent:u,updateContentStatus:m,setSelectedCategory:p}=mr(),[f,g]=h.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),y=["Not Started","In Progress","Completed"],v=["Beginner","Intermediate","Advanced"],x=["15 min","30 min","45 min","60 min","90 min+"],b=h.useCallback(I=>{g(I)},[]),C=h.useCallback(I=>{p(I==="all"?"all":I)},[p]),k=h.useCallback(I=>{t(`/course/${I}`)},[t]),P={isLoading:c,error:o,validationError:null},E={searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""},$=h.useMemo(()=>{if(!l)return[];let I=l;if(f.searchQuery){const T=f.searchQuery.toLowerCase().trim();I=I.filter(j=>{var M,B,G;const Y=[j.title,((M=j.data)==null?void 0:M.description)||"",j.department||"",((G=(B=j.data)==null?void 0:B.tags)==null?void 0:G.join(" "))||"",j.domain||"",j.contentType||""].join(" ").toLowerCase();return Y.includes(T)?!0:T.split(/\s+/).some(D=>D.length<2?!1:Y.split(/\s+/).some(F=>F.startsWith(D)))})}return f.statusFilter!=="all"&&(I=I.filter(T=>T.status===f.statusFilter)),f.difficultyFilter!=="all"&&(I=I.filter(T=>T.difficultyLevel===f.difficultyFilter)),f.durationFilter!=="all"&&(I=I.filter(T=>{if(!T.estimatedDuration)return!1;const j=T.estimatedDuration;switch(f.durationFilter){case"15 min":return j<=15;case"30 min":return j<=30;case"45 min":return j<=45;case"60 min":return j<=60;case"90 min+":return j>90;default:return!0}})),I.sort((T,j)=>{let M,B;switch(f.sortBy){case"title":M=(T.title||"").toLowerCase(),B=(j.title||"").toLowerCase();break;case"date":M=T.lastUpdated?new Date(T.lastUpdated):new Date(0),B=j.lastUpdated?new Date(j.lastUpdated):new Date(0);break;case"progress":M=T.progress,B=j.progress;break;case"difficulty":M=T.difficultyLevel||"",B=j.difficultyLevel||"";break;case"duration":M=T.estimatedDuration||0,B=j.estimatedDuration||0;break;default:M=T.title.toLowerCase(),B=j.title.toLowerCase()}return f.sortOrder==="asc"?M<B?-1:M>B?1:0:M>B?-1:M<B?1:0}),I},[l,f]),{categoryItems:w}=yf({content:$,selectedCategory:i==="all"?null:i,filterOptions:E}),S=a1({uiState:P,selectedCategory:i,categoryItems:w}),A=()=>S.shouldShowLoading?a.jsx(ys,{}):S.shouldShowError?a.jsx(i1,{error:o,onRetry:d}):S.shouldShowEmpty?a.jsx(vf,{selectedCategory:i}):S.shouldShowContent?a.jsx(c1,{category:i,items:w,onStatusUpdate:m,onStartContent:k,CoursesTable:bf,LearningPathwaysTable:wf,ProceduresTable:Sf,PoliciesTable:Cf}):null;return n?a.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"text-red-600 text-lg font-medium mb-2",children:"Something went wrong"}),a.jsx("div",{className:"text-gray-600 mb-4",children:n.message}),a.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Again"})]})}):a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsx(C1,{onFiltersChange:b,selectedCategory:i||"all",onCategoryChange:C,statusOptions:y,difficultyOptions:v,durationOptions:x}),a.jsx(l1,{category:i==="all"?"All Categories":i||"",isLoading:c}),(()=>{try{return A()}catch(I){return console.error("Error rendering content:",I),r(I instanceof Error?I:new Error("Unknown error")),null}})()]})});If.displayName="ContentTable";var I1=Object.defineProperty,j1=Object.defineProperties,E1=Object.getOwnPropertyDescriptors,Qm=Object.getOwnPropertySymbols,T1=Object.prototype.hasOwnProperty,N1=Object.prototype.propertyIsEnumerable,Ym=(n,e,t)=>e in n?I1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Jm=(n,e)=>{for(var t in e||(e={}))T1.call(e,t)&&Ym(n,t,e[t]);if(Qm)for(var t of Qm(e))N1.call(e,t)&&Ym(n,t,e[t]);return n},Xm=(n,e)=>j1(n,E1(e)),er=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class k1{getLearningInsights(){return er(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return null;const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),{data:r,error:s}=yield _.from("ai_learning_insights").select("*").eq("user_id",e.id).eq("facility_id",t==null?void 0:t.facility_id).single();if(s&&s.code!=="PGRST116")throw s;return r}catch(e){return console.error("Error fetching AI learning insights:",e),null}})}getContentRecommendations(e=5){return er(this,null,function*(){try{const{data:{user:t}}=yield _.auth.getUser();if(!t)return[];const{data:r,error:s}=yield _.from("ai_content_recommendations").select("*").eq("user_id",t.id).gte("recommendation_score",70).order("recommendation_score",{ascending:!1}).limit(e);if(s){if(s.code==="42P01")return console.warn("ai_content_recommendations table does not exist, returning empty recommendations"),[];throw s}return r.map(i=>{var l;return{id:i.id,user_id:i.user_id,content_id:i.content_id,recommendation_score:i.recommendation_score,recommendation_type:i.recommendation_type,reasoning:i.reasoning,created_at:i.created_at,updated_at:i.updated_at,is_displayed:i.is_displayed,is_clicked:i.is_clicked,is_completed:i.is_completed,display_count:i.display_count,click_count:i.click_count,completion_count:i.completion_count,user_feedback:i.user_feedback,ai_model_version:i.ai_model_version,learning_context:i.learning_context,content_metadata:i.content_metadata,tags:(l=i.data)==null?void 0:l.tags,recommendation_reason:i.recommendation_reason||i.reasoning,confidence_level:i.confidence_level||.8,user_context:i.user_context||{},content_context:i.content_context||{},click_through_rate:i.click_through_rate||0,completion_rate:i.completion_rate||0,user_feedback_rating:i.user_feedback_rating||0,ai_confidence_score:i.ai_confidence_score||.8,recommendation_algorithm:i.recommendation_algorithm||"default",last_ai_analysis:i.last_ai_analysis||new Date().toISOString(),model_version:i.model_version||"1.0.0",feature_vector:i.feature_vector||[],algorithm_used:i.algorithm_used||"default",expires_at:i.expires_at||null,recommendation_timing:i.recommendation_timing||"immediate"}})||[]}catch(t){return console.error("Error fetching AI content recommendations:",t),[]}})}trackRecommendationInteraction(e,t){return er(this,null,function*(){try{const{data:{user:r}}=yield _.auth.getUser();if(!r)return!1;const s={};switch(t){case"displayed":s.is_displayed=!0,s.display_count=(s.display_count||0)+1;break;case"clicked":s.is_clicked=!0;break;case"completed":s.is_completed=!0;break}const{error:i}=yield _.from("ai_content_recommendations").update(s).eq("id",e).eq("user_id",r.id);if(i){if(i.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping interaction tracking"),!1;throw i}return!0}catch(r){return console.error("Error tracking recommendation interaction:",r),!1}})}storeLearningInsights(e){return er(this,null,function*(){try{const{data:{user:t}}=yield _.auth.getUser();if(!t)return!1;const{error:r}=yield _.from("ai_learning_insights").upsert(Xm(Jm({user_id:t.id},e),{last_ai_analysis:new Date().toISOString(),updated_at:new Date().toISOString()}));if(r)throw r;return!0}catch(t){return console.error("Error storing AI learning insights:",t),!1}})}storeContentRecommendation(e,t){return er(this,null,function*(){try{const{data:{user:r}}=yield _.auth.getUser();if(!r)return!1;const{error:s}=yield _.from("ai_content_recommendations").insert(Xm(Jm({user_id:r.id,content_id:e},t),{created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));if(s){if(s.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping recommendation storage"),!1;throw s}return!0}catch(r){return console.error("Error storing AI content recommendation:",r),!1}})}getLearningAnalytics(){return er(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return[];const{data:t,error:r}=yield _.from("ai_learning_analytics").select("*").eq("user_id",e.id).order("session_start",{ascending:!1}).limit(10);if(r)throw r;return t.map(s=>({id:s.id,user_id:s.user_id,content_id:s.content_id,progress_status:s.progress_status}))||[]}catch(e){return console.error("Error fetching learning analytics:",e),[]}})}storeSessionAnalytics(e){return er(this,null,function*(){try{const{data:{user:t}}=yield _.auth.getUser();if(!t)return!1;const{data:r,error:s}=yield _.from("users").select("facility_id").eq("id",t.id).single();if(s||!(r!=null&&r.facility_id))return console.error("Missing facility_id in user profile"),!1;const{error:i}=yield _.from("ai_learning_analytics").insert({user_id:t.id,facility_id:r.facility_id,session_start:new Date(e.session_start).toISOString(),content_items_accessed:e.content_items_accessed,learning_path_progress:e.learning_path_progress,learning_patterns:e.learning_patterns,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(i)throw i;return!0}catch(t){return console.error("Error storing learning session analytics:",t),!1}})}generateLearningInsights(){return er(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return null;const{data:t}=yield _.from("knowledge_hub_user_progress").select("*").eq("user_id",e.id);if(!t||t.length===0)return null;const r=this.analyzeLearningPatterns(t.map(s=>({id:s.id,user_id:s.user_id,content_id:s.content_id,progress_status:s.progress_status})));return yield this.storeLearningInsights(r),r}catch(e){return console.error("Error generating learning insights:",e),null}})}analyzeLearningPatterns(e){const t=e.filter(u=>u.progress_status==="completed"),r=e.length,s=t.length,i=r>0?s/r*100:0,l=e.reduce((u,m)=>{const p=m.content_type||"Unknown";return u[p]=(u[p]||0)+1,u},{}),c=Object.entries(l).sort(([,u],[,m])=>m-u).slice(0,3).map(([u])=>u),o=t.filter(u=>u.time_spent_minutes),d=o.length>0?Math.round(o.reduce((u,m)=>u+(m.time_spent_minutes||0),0)/o.length):30;return{learning_efficiency_score:Math.round(i),preferred_content_categories:c,optimal_study_duration:d,next_learning_milestone:this.predictNextMilestone(e),skill_gaps:this.identifySkillGaps(e),ai_confidence_score:.8,model_version:"v1.0"}}predictNextMilestone(e){const t=e.filter(r=>r.progress_status==="completed");return t.length===0?"Complete your first course":t.length<3?"Complete 3 courses to build foundation":t.length<10?"Complete 10 courses for intermediate level":"Achieve advanced certification"}identifySkillGaps(e){const t=[],r=new Set(e.filter(s=>s.progress_status==="completed").map(s=>s.content_type));return r.has("procedure")||t.push("Clinical Procedures"),r.has("policy")||t.push("Healthcare Policies"),r.has("learning_pathway")||t.push("Structured Learning Paths"),t}}var ms=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function P1(){const[n,e]=h.useState(null),[t,r]=h.useState([]),[s,i]=h.useState(!1),[l,c]=h.useState(null),o=h.useMemo(()=>new k1,[]),d=h.useCallback(()=>ms(null,null,function*(){try{i(!0),c(null);const g=yield o.getLearningInsights();if(e(g),!g){const y=yield o.generateLearningInsights();y&&e(y)}}catch(g){c(g instanceof Error?g.message:"Failed to load learning insights")}finally{i(!1)}}),[o]),u=h.useCallback((g=5)=>ms(null,null,function*(){try{i(!0),c(null);const y=yield o.getContentRecommendations(g);r(y)}catch(y){c(y instanceof Error?y.message:"Failed to load content recommendations")}finally{i(!1)}}),[o]),m=h.useCallback((g,y)=>ms(null,null,function*(){try{yield o.trackRecommendationInteraction(g,y)}catch(v){console.error("Failed to track recommendation interaction:",v)}}),[o]),p=h.useCallback(g=>ms(null,null,function*(){try{yield o.storeSessionAnalytics(g)}catch(y){console.error("Failed to store session analytics:",y)}}),[o]),f=h.useCallback(()=>ms(null,null,function*(){try{i(!0),c(null);const g=yield o.generateLearningInsights();g&&e(g)}catch(g){c(g instanceof Error?g.message:"Failed to generate new insights")}finally{i(!1)}}),[o]);return h.useEffect(()=>{const g=setTimeout(()=>{d(),u()},200);return()=>clearTimeout(g)},[d,u]),{learningInsights:n,contentRecommendations:t,isLoading:s,error:l,loadLearningInsights:d,loadContentRecommendations:u,trackRecommendationInteraction:m,storeSessionAnalytics:p,generateNewInsights:f,refreshData:()=>{d(),u()}}}const jf=X.memo(()=>{var n;const e=In(),{content:t,isLoading:r}=mr(),{learningInsights:s,storeSessionAnalytics:i,isLoading:l}=P1(),c=h.useCallback(()=>{e("/library")},[e]);return h.useCallback(o=>{console.error("Knowledge Hub error:",o)},[]),X.useEffect(()=>{const o=setTimeout(()=>{!l&&s&&i({session_start:new Date().toISOString(),content_items_accessed:["knowledge_hub_main"],learning_path_progress:{current_page:"knowledge_hub"}})},100);return()=>clearTimeout(o)},[l,s,i]),!r&&(!t||t.length===0)?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[a.jsx("p",{className:"text-lg font-medium",children:"No content yet"}),a.jsx("p",{className:"text-sm mt-1",children:"Add something from the Library to get started."})]}):a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Knowledge Hub"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"Access training materials and educational resources"})]}),a.jsx("button",{onClick:c,className:"rounded-md bg-[#4ECDC4] px-4 py-2 text-white hover:bg-[#3db8b0] transition",children:"+ Library"})]}),a.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[a.jsxs("div",{className:"lg:w-1/4 space-y-6",children:[a.jsx(t1,{}),a.jsx(n1,{}),!l&&s&&a.jsx("div",{className:"hidden",children:a.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"AI Learning Insights"}),a.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[a.jsxs("p",{children:["Efficiency: ",s==null?void 0:s.learning_efficiency_score,"%"]}),a.jsxs("p",{children:["Next Milestone: ",s==null?void 0:s.next_learning_milestone]}),a.jsxs("p",{children:["Optimal Study Time:"," ",s==null?void 0:s.optimal_study_duration," min"]}),((n=s==null?void 0:s.skill_gaps)==null?void 0:n.length)>0&&a.jsxs("p",{children:["Skill Gaps: ",s.skill_gaps.join(", ")]})]})]})})]}),a.jsx("div",{className:"lg:w-3/4",children:a.jsx(If,{})})]})]})});jf.displayName="KnowledgeHubContent";const Ef=X.memo(()=>(h.useCallback(n=>{console.error("Knowledge Hub error:",n)},[]),a.jsx(HO,{children:a.jsx(ks,{children:a.jsx(QO,{children:a.jsx(jf,{})})})})));Ef.displayName="KnowledgeHub";const _o=({item:n,onActionClick:e,status:t,className:r="",isFavorite:s=!1,onToggleFavorite:i,isAiSuggestion:l=!1,aiGlowIntensity:c=0,index:o=0})=>{var d;const u=g=>{switch(g){case"Favorites":return el;case"Courses":return Ss;case"Learning Pathways":return So;case"Procedures":return Qg;case"Policies":return tl;case"SDS Sheets":return tl;default:return Ss}},m=g=>{switch(g){case"Favorites":return"bg-yellow-100 text-yellow-800 border border-yellow-200";case"Courses":return"bg-blue-100 text-blue-800 border border-blue-200";case"Learning Pathways":return"bg-purple-100 text-purple-800 border border-purple-200";case"Procedures":return"bg-red-100 text-red-800 border border-red-200";case"Policies":return"bg-green-100 text-green-800 border border-green-200";case"SDS Sheets":return"bg-orange-100 text-orange-800 border border-orange-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},p=()=>{switch(t){case"In Progress":return"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200";case"Completed":return"bg-blue-100 text-blue-700 border border-blue-300 hover:bg-blue-200";default:return l?"bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700 shadow-lg hover:shadow-xl":"border-2 border-[#4ECDC4] text-[#4ECDC4] hover:bg-teal-50"}},f=()=>{switch(t){case"In Progress":return"Added";case"Completed":return"Completed";default:return"+Add"}};return a.jsxs(Ye.div,{role:"article","aria-labelledby":`content-card-title-${n.id}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:l?o*.1:0},className:`relative group h-80 flex flex-col ${l?"bg-gradient-to-br from-white via-purple-50 to-pink-50 border-2 border-purple-200 shadow-xl hover:shadow-2xl ai-card":"bg-white border border-gray-100 shadow-lg hover:shadow-xl"} rounded-xl p-6 transition-all duration-300 transform hover:scale-105 ${r}`,style:{boxShadow:l?`0 10px 25px rgba(147, 51, 234, 0.15), 0 0 20px rgba(236, 72, 153, ${.1+Math.sin(c*.1+o)*.05})`:void 0},children:[l&&a.jsx(Ye.div,{animate:{opacity:[.3,.8,.3],scale:[1,1.02,1]},transition:{duration:3,repeat:1/0,ease:"easeInOut",delay:o*.2},className:"absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-orange-400 rounded-xl blur-sm -z-10"}),i&&a.jsx("button",{onClick:i,className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-full transition-colors duration-200",children:a.jsx(N,{path:el,size:1.2,color:s?"#FFD700":"#9CA3AF"})}),a.jsx("div",{className:"flex items-start justify-between mb-4 flex-1",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(N,{path:u(n.category),size:1,className:`${l?"text-purple-600":"text-[#4ECDC4]"}`}),a.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${m(n.category)}`,children:n.category})]}),a.jsx("h4",{id:`content-card-title-${n.id}`,className:`text-lg font-semibold mb-2 transition-colors duration-200 h-12 flex items-start ${l?"text-gray-900 group-hover:text-purple-600":"text-gray-900 group-hover:text-[#4ECDC4]"}`,children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"line-clamp-2 leading-tight",children:n.title}),n.source==="Cliniio"&&a.jsx("div",{className:"flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-500 rounded-full text-xs font-medium border border-blue-200 flex-shrink-0",children:a.jsx(N,{path:bs,size:.6})})]})}),a.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2 h-10 leading-tight",children:String(((d=n.data)==null?void 0:d.description)||"")}),a.jsx("div",{className:`flex items-center gap-2 text-sm font-medium ${l?"text-purple-600":"text-violet-600"}`,children:a.jsxs("span",{children:["+",n.points," points"]})})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full border ${l?"bg-purple-100 text-purple-800 border-purple-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:n.level}),a.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[a.jsx(N,{path:ws,size:.7}),a.jsx("span",{children:n.duration})]})]}),a.jsx("button",{onClick:e,"aria-label":`Add ${n.title} to Knowledge Hub`,className:`px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${p()}`,children:f()})]})]})},D1=Object.freeze(Object.defineProperty({__proto__:null,default:_o},Symbol.toStringTag,{value:"Module"})),A1=X.lazy(()=>L(()=>Promise.resolve().then(()=>D1),void 0)),O1=({filteredContent:n,handleAddToList:e,getItemStatus:t,favorites:r,handleToggleFavorite:s})=>a.jsx("section",{role:"list","aria-label":"Library content list",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.jsx(h.Suspense,{fallback:a.jsx("div",{children:"Loading..."}),children:n.map((i,l)=>a.jsx(Ye.div,{role:"listitem",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:l*.1},children:a.jsx(A1,{item:i,status:t(i.id),onActionClick:()=>e(i),isFavorite:r.has(i.id),onToggleFavorite:()=>s(i.id),isAiSuggestion:!1,index:l})},i.id))})});class R1 extends h.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){console.error("Library Error:",e,t)}render(){return this.state.hasError?a.jsxs("div",{className:"p-6 bg-red-50 text-red-800 rounded-lg",children:[a.jsx("h2",{className:"text-lg font-bold",children:"Oops! Something went wrong in the Library."}),a.jsx("p",{children:"Please refresh the page or try again later."})]}):this.props.children}}var $1=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});function M1(){return $1(this,null,function*(){try{const{data:n,error:e}=yield _.from("knowledge_hub_content").select("*").eq("is_active",!0).eq("status","published").order("created_at",{ascending:!1});return e?(console.error("Error fetching content:",e),Zm()):(n||[]).map(r=>z1(r,"knowledge_hub_content"))}catch(n){return console.error("Error in fetchLibraryContent:",n),Zm()}})}function Zm(){return console.log("Using fallback content"),[{id:"handwashing-policy-1",title:"Handwashing Policies for Staff",category:"Policies",status:"Not Started",dueDate:void 0,progress:0,department:"infection_control",lastUpdated:new Date().toISOString(),source:"Cliniio",description:"Comprehensive handwashing protocols and procedures for healthcare staff to maintain infection control standards",level:"Beginner",duration:"20 min",points:7,publishedDate:new Date().toISOString()},{id:"test-item-2",title:"TEST ITEM - This Should Show",category:"Courses",status:"Not Started",dueDate:void 0,progress:0,department:"general",lastUpdated:new Date().toISOString(),source:"Cliniio",description:"This is a test item to verify the library is working",level:"Beginner",duration:"15 min",points:5,publishedDate:new Date().toISOString()}]}function F1(n){return{course:"Courses",procedure:"Procedures",policy:"Policies",learning_pathway:"Learning Pathways"}[n]||"Courses"}function L1(n){if(!n)return"15 min";if(n<60)return`${n} min`;const e=Math.floor(n/60),t=n%60;return t===0?`${e} hr`:`${e} hr ${t} min`}const z1=(n,e)=>{var t;return{id:n.id,title:n.title,description:(t=n.data)==null?void 0:t.description,category:F1(n.content_type||e),level:n.difficulty_level||"Beginner",duration:L1(n.estimated_duration_minutes||n.estimated_read_time_minutes||0),points:n.points||0,status:"Not Started",dueDate:void 0,progress:0,department:n.department||"general",lastUpdated:n.updated_at||n.created_at||new Date().toISOString(),source:"Cliniio",publishedDate:n.published_at||n.created_at||new Date().toISOString()}};var B1=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const q1=()=>{const[n,e]=h.useState([]),[t,r]=h.useState(!0),[s,i]=h.useState(null);return h.useEffect(()=>{B1(null,null,function*(){try{r(!0);const c=yield M1();e(c)}catch(c){console.error("useLibraryContent: Error loading content:",c),i(c instanceof Error?c:new Error("Failed to load content")),e([])}finally{r(!1)}})},[]),{content:n,loading:t,error:s}};var hs=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});class U1{constructor(){this.tableName="knowledge_hub_content"}addToKnowledgeHub(e,t){return hs(this,null,function*(){try{if(!t){const{data:{user:c}}=yield _.auth.getUser();if(!c)throw new Error("User not authenticated");t=c.id}const r=yield this.checkExistingContent(e.id,t);if(r)return{success:!1,message:"This content is already in your Knowledge Hub",contentId:r.id};const s=yield this.transformLibraryToKnowledgeHub(e,t),{data:i,error:l}=yield _.from("knowledge_hub_content").insert([s]).select().single();if(l)throw console.error("Error adding to Knowledge Hub:",l),new Error(`Failed to add content: ${l.message}`);return{success:!0,message:`"${e.title}" added to your Knowledge Hub`,contentId:i.id?String(i.id):void 0}}catch(r){console.error("Knowledge Hub integration error:",r);const s=new Error(r instanceof Error?r.message:"Failed to add content to Knowledge Hub");throw s.code="INTEGRATION_ERROR",s.details=r,s}})}checkExistingContent(e,t){return hs(this,null,function*(){try{const{data:r,error:s}=yield _.from("knowledge_hub_content").select("id").eq("author_id",t).eq("title",e).single();if(s&&s.code!=="PGRST116")throw s;return r||null}catch(r){return console.error("Error checking existing content:",r),null}})}transformLibraryToKnowledgeHub(e,t){return hs(this,null,function*(){var r,s,i,l;const c={description:((r=e.data)==null?void 0:r.description)||null,media:((s=e.data)==null?void 0:s.media)||null,requirements:((i=e.data)==null?void 0:i.requirements)||[],steps:((l=e.data)==null?void 0:l.steps)||[]};return{id:e.id||crypto.randomUUID(),title:e.title,content_type:e.category||"generic",content:c,domain:null,tags:[e.category,e.level].filter(Boolean),status:"not_started",author_id:t,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_active:!0}})}mapContentType(e){return{Courses:"course","Learning Pathways":"learning_pathway",Procedures:"procedure",Policies:"policy","SDS Sheets":"procedure"}[e]||"course"}getUserContentCount(e){return hs(this,null,function*(){try{if(!e){const{data:{user:s}}=yield _.auth.getUser();if(!s)return 0;e=s.id}const{count:t,error:r}=yield _.from("knowledge_hub_content").select("*",{count:"exact",head:!0}).eq("author_id",e);if(r)throw r;return t||0}catch(t){return console.error("Error getting user content count:",t),0}})}removeFromKnowledgeHub(e,t){return hs(this,null,function*(){try{if(!t){const{data:{user:s}}=yield _.auth.getUser();if(!s)throw new Error("User not authenticated");t=s.id}const{error:r}=yield _.from("knowledge_hub_content").delete().eq("id",e).eq("author_id",t);if(r)throw r;return!0}catch(r){return console.error("Error removing from Knowledge Hub:",r),!1}})}}const eh=new U1;var H1=Object.defineProperty,V1=Object.defineProperties,W1=Object.getOwnPropertyDescriptors,th=Object.getOwnPropertySymbols,G1=Object.prototype.hasOwnProperty,K1=Object.prototype.propertyIsEnumerable,rh=(n,e,t)=>e in n?H1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qe=(n,e)=>{for(var t in e||(e={}))G1.call(e,t)&&rh(n,t,e[t]);if(th)for(var t of th(e))K1.call(e,t)&&rh(n,t,e[t]);return n},Ue=(n,e)=>V1(n,W1(e)),nh=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const Q1=()=>{const[n,e]=h.useState({isAdding:!1,addedItems:new Set,error:null,successMessage:null}),t=h.useCallback(l=>nh(null,null,function*(){e(c=>Ue(qe({},c),{isAdding:!0,error:null,successMessage:null}));try{const c=yield eh.addToKnowledgeHub(l);c.success?(e(o=>Ue(qe({},o),{isAdding:!1,addedItems:new Set([...o.addedItems,l.id]),successMessage:c.message})),setTimeout(()=>{e(o=>Ue(qe({},o),{successMessage:null}))},3e3)):(e(o=>Ue(qe({},o),{isAdding:!1,error:c.message})),setTimeout(()=>{e(o=>Ue(qe({},o),{error:null}))},5e3))}catch(c){const o=c instanceof Error?c.message:"Failed to add content to Knowledge Hub";e(d=>Ue(qe({},d),{isAdding:!1,error:o})),setTimeout(()=>{e(d=>Ue(qe({},d),{error:null}))},5e3)}}),[]),r=h.useCallback(l=>nh(null,null,function*(){try{(yield eh.removeFromKnowledgeHub(l))?(e(o=>Ue(qe({},o),{addedItems:new Set([...o.addedItems].filter(d=>d!==l)),successMessage:"Content removed from Knowledge Hub"})),setTimeout(()=>{e(o=>Ue(qe({},o),{successMessage:null}))},3e3)):(e(o=>Ue(qe({},o),{error:"Failed to remove content from Knowledge Hub"})),setTimeout(()=>{e(o=>Ue(qe({},o),{error:null}))},5e3))}catch(c){console.error(c),e(o=>Ue(qe({},o),{error:"Failed to remove content from Knowledge Hub"})),setTimeout(()=>{e(o=>Ue(qe({},o),{error:null}))},5e3)}}),[]),s=h.useCallback(()=>{e(l=>Ue(qe({},l),{error:null,successMessage:null}))},[]),i=h.useCallback(l=>n.addedItems.has(l),[n.addedItems]);return{state:n,addToKnowledgeHub:t,removeFromKnowledgeHub:r,clearMessages:s,isInKnowledgeHub:i}};var Y1=Object.defineProperty,J1=Object.defineProperties,X1=Object.getOwnPropertyDescriptors,sh=Object.getOwnPropertySymbols,Z1=Object.prototype.hasOwnProperty,eR=Object.prototype.propertyIsEnumerable,ah=(n,e,t)=>e in n?Y1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,tR=(n,e)=>{for(var t in e||(e={}))Z1.call(e,t)&&ah(n,t,e[t]);if(sh)for(var t of sh(e))eR.call(e,t)&&ah(n,t,e[t]);return n},rR=(n,e)=>J1(n,X1(e));class Ar{constructor(){this.progressItems=new Map;try{this.loadFromStorage()}catch(e){console.error("[LearningProgressService] Failed to initialize:",e)}}static getInstance(){try{return Ar.instance||(Ar.instance=new Ar),Ar.instance}catch(e){return console.error("[LearningProgressService] Failed to get instance:",e),null}}loadFromStorage(){try{if(typeof window=="undefined"||!window.localStorage){console.warn("[LearningProgressService] localStorage not available");return}const e=localStorage.getItem("learningProgress");if(e){const t=JSON.parse(e);this.progressItems.clear(),t.forEach(r=>{this.progressItems.set(r.id,r)})}}catch(e){console.error("[LearningProgressService] Failed to load from storage:",e)}}saveToStorage(){try{if(typeof window=="undefined"||!window.localStorage){console.warn("[LearningProgressService] localStorage not available for saving");return}const e=Array.from(this.progressItems.values());localStorage.setItem("learningProgress",JSON.stringify(e))}catch(e){console.error("[LearningProgressService] Failed to save to storage:",e)}}addToMyList(e){const t=rR(tR({},e),{status:"In Progress",updated_at:new Date().toISOString()});this.progressItems.set(e.id,t),this.saveToStorage()}markInProgress(e){const t=this.progressItems.get(e);t&&(t.status="In Progress",t.updated_at=new Date().toISOString(),this.saveToStorage())}getItemStatus(e){const t=this.progressItems.get(e);return t?t.status:"Not Started"}updateItemStatus(e,t){const r=this.progressItems.get(e);r&&(r.status=t,r.updated_at=new Date().toISOString(),this.saveToStorage())}getItemsByCategory(e){return Array.from(this.progressItems.values()).filter(t=>t.category===e)}getAllProgressItems(){return Array.from(this.progressItems.values())}removeItem(e){this.progressItems.delete(e),this.saveToStorage()}isInitialized(){return this.progressItems!==void 0}}const nR=Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"}));function sR(){const[n,e]=h.useState(""),[t,r]=h.useState(!1),[s,i]=h.useState(new Set),[l,c]=h.useState({category:"",skillLevel:"",timeline:"",status:"",source:"",showNewOnly:!1}),[o,d]=h.useState("All"),[u,m]=h.useState("All"),[p]=h.useState(()=>Ar.getInstance()),[f,g]=h.useState(!1),[y,v]=h.useState(0),[x,b]=h.useState(!1),C=h.useMemo(()=>["All","Beginner","Intermediate","Advanced"],[]),k=h.useMemo(()=>["< 1 hour","1-3 hours","3-5 hours","5+ hours"],[]),P=h.useMemo(()=>["Not Started","In Progress","Completed"],[]),E=h.useMemo(()=>["All Sources","Cliniio","Admin"],[]),$=h.useMemo(()=>["All","Favorites","Courses","Learning Pathways","Procedures","Policies","SDS Sheets"],[]);return{searchQuery:n,setSearchQuery:e,showFilters:t,setShowFilters:r,favorites:s,setFavorites:i,filters:l,setFilters:c,selectedCategory:o,setSelectedCategory:d,selectedLevel:u,setSelectedLevel:m,progressService:p,aiSuggestionsActive:f,setAiSuggestionsActive:g,aiGlowIntensity:y,setAiGlowIntensity:v,showAiTooltip:x,setShowAiTooltip:b,skillLevels:C,timelines:k,statuses:P,sources:E,categories:$}}var aR=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const iR=X.lazy(()=>L(()=>import("./LibraryFilters-hT-W97ru.js"),__vite__mapDeps([32,2,3,6,1,4,5]))),oR=X.lazy(()=>L(()=>import("./LibraryHeader-ButSr6o-.js"),__vite__mapDeps([33,2,3,6,1,4,5]))),lR=()=>{const n=In(),{addToKnowledgeHub:e}=Q1(),{currentUser:t}=Mr(),{searchQuery:r,setSearchQuery:s,showFilters:i,setShowFilters:l,favorites:c,setFavorites:o,filters:d,setFilters:u,selectedCategory:m,setSelectedCategory:p,selectedLevel:f,setSelectedLevel:g,progressService:y,aiSuggestionsActive:v,setAiSuggestionsActive:x,aiGlowIntensity:b,setAiGlowIntensity:C,showAiTooltip:k,setShowAiTooltip:P,skillLevels:E,timelines:$,statuses:w,sources:S,categories:A}=sR(),{content:I}=q1();h.useEffect(()=>{const D=setInterval(()=>{C(U=>U+1)},100);return()=>clearInterval(D)},[v,C]);const T=I.filter(D=>{var U;const F=r===""||D.title.toLowerCase().includes(r.toLowerCase())||String(((U=D.data)==null?void 0:U.description)||"").toLowerCase().includes(r.toLowerCase())||D.category.toLowerCase().includes(r.toLowerCase()),V=!d.category||D.category===d.category,q=!d.skillLevel||D.level===d.skillLevel,W=!d.status||D.status===d.status,ee=!d.source||D.source===d.source;return F&&V&&q&&W&&ee}),j=h.useCallback(()=>{x(D=>{const U=!D;if(U){const F={session_start:new Date().toISOString(),content_items_accessed:I.map(V=>V.id),learning_path_progress:{ai_suggestions_enabled:!0},learning_patterns:{ai_interaction:"enabled"}};L(()=>As(null,null,function*(){const{AISuggestionsService:V}=yield import("./aiSuggestionsService-DbFZ1FuS.js");return{AISuggestionsService:V}}),__vite__mapDeps([34,1,2,3,4,5,6])).then(({AISuggestionsService:V})=>{new V().storeLearningSessionAnalytics(F)})}return U})},[I,x]),M=h.useCallback(D=>{o(U=>{const F=new Set(U);F.has(D)?F.delete(D):F.add(D);const V=U.has(D)?"removed":"added",q={session_start:new Date().toISOString(),content_items_accessed:[D],learning_path_progress:{favorites_updated:!0},learning_patterns:{favorite_action:V}};return L(()=>As(null,null,function*(){const{AISuggestionsService:W}=yield import("./aiSuggestionsService-DbFZ1FuS.js");return{AISuggestionsService:W}}),__vite__mapDeps([34,1,2,3,4,5,6])).then(({AISuggestionsService:W})=>{new W().storeLearningSessionAnalytics(q)}),F})},[o]),B=h.useCallback(D=>(y==null?void 0:y.getItemStatus(D))||"Not Started",[y]),G=h.useCallback(D=>I.filter(U=>U.category===D).length,[I]),Y=h.useCallback(()=>{u({category:"",skillLevel:"",status:"",source:"",timeline:"",showNewOnly:!1}),p(""),g("")},[u,p,g]),R=h.useCallback(D=>aR(null,null,function*(){try{const{data:{user:U}}=yield _.auth.getUser();if(!U){console.error("No authenticated user");return}let F="courses";D.category==="Policies"?F="policies":D.category==="Procedures"&&(F="procedures");const V={user_id:U.id,content_id:D.id,content_type:F,status:"not_started",progress_percentage:0,assigned_at:new Date().toISOString(),is_repeat:D.isRepeat||!1},{error:q}=yield _.from("knowledge_hub_user_progress").insert([V]);if(q){console.error("Error adding to knowledge hub:",q);return}console.log("Successfully added to knowledge hub:",D.title),yield e(D),console.log("✅ Added to Knowledge Hub:",D.title);const W=document.querySelector(`[data-item-id="${D.id}"]`);if(W){const ee=W.querySelector("button[onclick]")||W.querySelector("button:last-child");if(ee){const Ee=ee.textContent;ee.textContent="Added!",ee.classList.add("bg-green-500","text-white"),setTimeout(()=>{ee.textContent=Ee,ee.classList.remove("bg-green-500","text-white")},2e3)}else console.log("Button not found in card, item ID:",D.id)}else console.log("Card not found for visual feedback, item ID:",D.id)}catch(U){console.error("Error adding to knowledge hub:",U)}}),[e]);return a.jsx(R1,{children:a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white",children:[a.jsx("div",{className:"p-6",children:a.jsxs("button",{onClick:()=>n("/knowledge-hub"),className:"inline-flex items-center gap-2 text-sm text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200",children:[a.jsx(N,{path:Oa,size:.8,className:"rotate-180"}),"Back to Knowledge Hub"]})}),a.jsx(h.Suspense,{fallback:a.jsx(_s,{}),children:a.jsx(oR,{})}),a.jsx("div",{className:"px-6 pb-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsx("div",{className:"max-w-2xl mx-auto mb-8",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:a.jsx(N,{path:Io,size:1.2,className:"text-gray-400"})}),a.jsx("input",{type:"text",placeholder:"Search courses, procedures, policies...",value:r,onChange:D=>s(D.target.value),className:"w-full pl-12 pr-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-[#4ECDC4]/20 focus:border-[#4ECDC4] transition-all duration-200 shadow-sm","aria-label":"Search content"}),a.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center gap-2",children:a.jsx("button",{onClick:()=>l(!i),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors duration-200 shadow-md ${i?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"}`,children:a.jsx(N,{path:wo,size:1})})})]})}),a.jsx(h.Suspense,{fallback:a.jsx(pg,{}),children:a.jsx(iR,{showFilters:i,filters:d,setFilters:u,selectedCategory:m,setSelectedCategory:p,selectedLevel:f,setSelectedLevel:g,handleResetFilters:Y,handleToggleAiSuggestions:j,aiSuggestionsActive:v,aiGlowIntensity:b,showAiTooltip:k,setShowAiTooltip:P,skillLevels:E,timelines:$,statuses:w,sources:S,categories:A,getCategoryCount:G})})]})}),a.jsx("div",{className:"px-6 pb-12",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[v&&a.jsxs(Ye.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-[#4ECDC4]/10 to-[#3db8b0]/10 rounded-2xl p-8 mb-8 border border-[#4ECDC4]/20",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-[#4ECDC4] rounded-full flex items-center justify-center",children:a.jsx(N,{path:Yg,size:1.2,color:"white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"AI-Powered Recommendations"}),a.jsx("p",{className:"text-gray-600",children:"Personalized content suggestions based on your role and learning history"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(_o,{item:{id:"ai-1",title:"Infection Control Mastery",category:"Procedures",description:"Advanced techniques for maintaining sterile environments",level:"Advanced",duration:"75 min",points:65,status:"Not Started",source:"Cliniio",publishedDate:"2025-01-15"},status:(y==null?void 0:y.getItemStatus("ai-1"))||"Not Started",onActionClick:()=>{y==null||y.markInProgress("ai-1")},isFavorite:c.has("ai-1"),onToggleFavorite:()=>M("ai-1"),isAiSuggestion:!0,aiGlowIntensity:b,index:0}),a.jsx(_o,{item:{id:"ai-2",title:"Patient Safety Leadership",category:"Learning Pathways",description:"Develop leadership skills in patient safety protocols",level:"Advanced",duration:"120 min",points:85,status:"Not Started",source:"Cliniio",publishedDate:"2025-01-10"},status:(y==null?void 0:y.getItemStatus("ai-2"))||"Not Started",onActionClick:()=>{y==null||y.markInProgress("ai-2")},isFavorite:c.has("ai-2"),onToggleFavorite:()=>M("ai-2"),isAiSuggestion:!0,aiGlowIntensity:b,index:1})]})]}),a.jsx(O1,{filteredContent:T,handleAddToList:R,getItemStatus:B,favorites:c,handleToggleFavorite:M})]})})]})})},cR=h.createContext(void 0),dR=({children:n})=>{const[e,t]=h.useState("favourites");return a.jsx(cR.Provider,{value:{activeTab:e,setActiveTab:t},children:n})},uR=()=>a.jsx(dR,{children:a.jsx(lR,{})});var Tf=(n,e,t)=>new Promise((r,s)=>{var i=o=>{try{c(t.next(o))}catch(d){s(d)}},l=o=>{try{c(t.throw(o))}catch(d){s(d)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,l);c((t=t.apply(n,e)).next())});const mR=h.lazy(()=>L(()=>import("./ScannerPage-BduD6R5y.js"),__vite__mapDeps([35,2,3,6,1,4,5]))),hR=h.lazy(()=>L(()=>import("./ScannerPage-BR1FBpy6.js"),__vite__mapDeps([36,2,3,6,1,4,5]))),pR=h.lazy(()=>L(()=>import("./ScannerPage-MY8KBI34.js"),__vite__mapDeps([37,2,3,6,1,4,5]))),fR=h.lazy(()=>L(()=>import("./index-BlRRmNha.js"),__vite__mapDeps([38,2,3,6,1,4,5,10]))),gR=h.lazy(()=>L(()=>import("./index-Z2_bziUK.js").then(n=>n.i),__vite__mapDeps([39,2,3,6,1,4,5]))),yR=h.lazy(()=>L(()=>import("./index-CUvgBSxn.js"),__vite__mapDeps([40,2,3,1,4,5]))),vR=h.lazy(()=>L(()=>import("./login-CgiYf71G.js").then(n=>n.R),__vite__mapDeps([1,2,3,4,5]))),_R=h.lazy(()=>L(()=>import("./index-DExgsR84.js"),__vite__mapDeps([41,2,3,6,1,4,5]))),xR=h.lazy(()=>L(()=>import("./AuthCallback-DmfVM3Uf.js"),__vite__mapDeps([42,2,3,1,4,5]))),bR=h.lazy(()=>L(()=>import("./HelpArticlePage-LqcqqjxR.js"),__vite__mapDeps([43,2,3,1,4,5,6,44])));let wt=null;const wR=300*1e3;function Nf(){return Tf(this,null,function*(){if(!(typeof window!="undefined"&&window.location.pathname==="/login"))try{const{FacilityService:n}=yield L(()=>Promise.resolve().then(()=>It),void 0),e=yield n.getCurrentFacilityId();if(!e){console.warn("No facility ID available - using development fallback"),wt={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()};return}wt={id:e,timestamp:Date.now()}}catch(n){console.warn("Failed to update facility ID cache:",n),wt||(wt={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()})}})}function ih(){const n=Date.now();if(wt&&n-wt.timestamp<wR)return wt.id;if(wt)return Nf(),wt.id;throw wt?new Error("Unexpected state in getCurrentFacilityId"):new Error("Facility ID lookup failed — no fallback allowed in production.")}function SR(){const n=window;if(typeof window=="undefined"||n.__postgrestGuardInstalled||typeof window.fetch=="undefined")return;n.__postgrestGuardInstalled=!0;const e=".supabase.co/rest/v1/",t=window.fetch.bind(window);window.fetch=(r,s)=>Tf(null,null,function*(){try{let i=typeof r=="string"?r:r.toString();if(i.includes(e)){const l=new URL(i),c=p=>p.endsWith(":1")?p.slice(0,-2):p,o=[],d=[];for(const[p,f]of l.searchParams.entries()){const g=f.trim();if(g==="eq."||g==="eq"||g==="eq:"||g==="eq:."||g==="."){o.push(p);continue}if(p==="facility_id"&&(g==="eq.:1"||g==="eq:1"||g===":1"||g==="eq.:")){const v=ih();d.push(["facility_id",`eq.${v}`]);continue}const y=c(g);if(y!==g){d.push([p,y]);continue}if(p==="quantity"&&g==="lt.reorder_point"){o.push(p);continue}}if(o.forEach(p=>l.searchParams.delete(p)),d.forEach(([p,f])=>{l.searchParams.set(p,f)}),l.search.includes("facility_id=eq.:1")){const p=ih();l.search=l.search.replace("facility_id=eq.:1",`facility_id=eq.${p}`)}l.search=l.search.replace(/(^|&)([^=&]+)=eq\.(?=(&|$))/g,(p,f)=>f?f.slice(0,-1):""),l.search=l.search.replace(/(:1)(?=(&|$))/g,""),l.search=l.search.replace(/(^|&)quantity=lt\.reorder_point(?=(&|$))/g,(p,f)=>f?f.slice(0,-1):"");const u=new URL(l.toString()),m=new Map;for(const[p,f]of u.searchParams.entries())m.set(p,f);u.search="";for(const[p,f]of m.entries())u.searchParams.append(p,f);u.toString()!==i&&(n.__postgrestGuardLogged||(n.__postgrestGuardLogged=!0,console.info("🛡️ PostgREST guard rewrote URL:",{from:i,to:u.toString()})),i=u.toString(),r=i)}}catch(i){throw console.error(i),i}return t(r,s)})}const CR=new yg;function IR(){return X.useEffect(()=>{Nf(),SR(),L(()=>As(null,null,function*(){const{realTimeStatusMonitor:n}=yield Promise.resolve().then(()=>KT);return{realTimeStatusMonitor:n}}),void 0).then(({realTimeStatusMonitor:n})=>{n.startMonitoring()})},[]),a.jsx(vg,{client:CR,children:a.jsx(Es,{children:a.jsx(fg,{children:a.jsx(sy,{children:a.jsxs(Hf,{children:[a.jsxs(ry,{children:[a.jsxs(Vf,{children:[a.jsx(_e,{path:"/login",element:a.jsx(vR,{})}),a.jsx(_e,{path:"/auth/callback",element:a.jsx(xR,{})}),a.jsx(_e,{path:"/home",element:a.jsx(He,{children:a.jsx($E,{})})}),a.jsx(_e,{path:"/sterilization",element:a.jsx(He,{children:a.jsx(Fp,{})})}),a.jsx(_e,{path:"/sterilization/scanner",element:a.jsx(He,{children:a.jsx(mR,{})})}),a.jsx(_e,{path:"/inventory",element:a.jsx(He,{children:a.jsx(MD,{})})}),a.jsx(_e,{path:"/inventory/scanner",element:a.jsx(He,{children:a.jsx(hR,{})})}),a.jsx(_e,{path:"/environmental-clean",element:a.jsx(He,{children:a.jsx(UO,{})})}),a.jsx(_e,{path:"/environmental-clean/scanner",element:a.jsx(He,{children:a.jsx(pR,{})})}),a.jsx(_e,{path:"/knowledge-hub",element:a.jsx(He,{children:a.jsx(Ef,{})})}),a.jsx(_e,{path:"/library",element:a.jsx(He,{children:a.jsx(uR,{})})}),a.jsx(_e,{path:"/intelligence",element:a.jsx(He,{children:a.jsx(_R,{})})}),a.jsx(_e,{path:"/settings",element:a.jsx(He,{children:a.jsx(fR,{})})}),a.jsx(_e,{path:"/content-builder",element:a.jsx(He,{children:a.jsx(gR,{})})}),a.jsx(_e,{path:"/course/:courseId",element:a.jsx(He,{children:a.jsx(yR,{})})}),a.jsx(_e,{path:"/help/article/:slug",element:a.jsx(bR,{})}),a.jsx(_e,{path:"/",element:a.jsx(bo,{to:"/home",replace:!0})})]}),a.jsx(s0,{})]}),a.jsx(Y_,{})]})})})})})}var jR=Object.defineProperty,oh=Object.getOwnPropertySymbols,ER=Object.prototype.hasOwnProperty,TR=Object.prototype.propertyIsEnumerable,lh=(n,e,t)=>e in n?jR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,NR=(n,e)=>{for(var t in e||(e={}))ER.call(e,t)&&lh(n,t,e[t]);if(oh)for(var t of oh(e))TR.call(e,t)&&lh(n,t,e[t]);return n};const kR={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},Zi=n=>{typeof window!="undefined"&&(localStorage.setItem("cliniio_log_level",n),window.cliniioLogger&&window.cliniioLogger.setLevel(n),console.log(`🔧 Console log level set to: ${n}`))},PR=()=>{if(typeof window!="undefined"){const n=localStorage.getItem("cliniio_log_level");if(n&&kR[n]!==void 0)return n}return"WARN"},ch={quiet:()=>Zi("WARN"),normal:()=>Zi("INFO"),verbose:()=>Zi("DEBUG"),silent:()=>{const n=NR({},console);return Object.keys(console).forEach(e=>{typeof console[e]=="function"&&(console[e]=()=>{})}),console.log("🔇 Console logging disabled. Use consoleControl.restore() to re-enable."),n},restore:n=>{n&&(Object.assign(console,n),console.log("🔊 Console logging restored."))},status:()=>{const n=PR();return console.log(`📊 Current log level: ${n}`),n}},kf=()=>{typeof window!="undefined"&&(window.consoleControl=ch,console.log("🎛️ Console control initialized. Use consoleControl.quiet(), consoleControl.normal(), or consoleControl.verbose() to adjust logging."),ch.status())};typeof window!="undefined"&&kf();kf();typeof window!="undefined"&&(window.cliniioLogger=O);"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistrations().then(function(n){for(const e of n)e.unregister(),console.log("Service worker unregistered")}),navigator.serviceWorker.ready.then(n=>{n.unregister(),console.log("Main service worker unregistered")}));ty.createRoot(document.getElementById("root")).render(a.jsx(X.StrictMode,{children:a.jsx(IR,{})}));export{BR as $,k1 as A,Is as B,Pr as C,b0 as D,ob as E,ht as F,Bt as G,Lu as H,Ct as I,Ah as J,Cu as K,lx as L,St as M,Mt as N,LC as O,we as P,oe as Q,du as R,ks as S,ZE as T,Ns as U,AS as V,jt as W,je as X,It as Y,ol as Z,wN as _,Ro as a,vp as a0,At as b,bD as c,qA as d,ir as e,HA as f,VA as g,UA as h,pf as i,sb as j,Ux as k,VR as l,Vh as m,Ph as n,QP as o,HR as p,Uo as q,Qc as r,Cs as s,vO as t,ne as u,CT as v,Nh as w,Fa as x,LR as y,Tp as z};
