import{s as i}from"./login-CtXU169Q.js";import"./utils-DSBVV_PW.js";import"./vendor-DoALFvsH.js";import"./data-73RVSc-N.js";import"./ui-DETUEJ2B.js";const v=t=>typeof t=="object"&&t!==null&&"id"in t&&typeof t.id=="string",f=t=>typeof t=="object"&&t!==null&&("data"in t||"error"in t),h=t=>typeof t=="object"&&t!==null&&"eventType"in t&&"table"in t&&typeof t.table=="string";var m=(t,e,r)=>new Promise((s,a)=>{var o=n=>{try{d(r.next(n))}catch(c){a(c)}},u=n=>{try{d(r.throw(n))}catch(c){a(c)}},d=n=>n.done?s(n.value):Promise.resolve(n.value).then(o,u);d((r=r.apply(t,e)).next())});class C{constructor(){this.tableName="inventory_items"}getAllItems(e){return m(this,null,function*(){var r,s,a;try{const o=i.from(this.tableName).select((e==null?void 0:e.select)||"*").order(((r=e==null?void 0:e.orderBy)==null?void 0:r.column)||"created_at",{ascending:(a=(s=e==null?void 0:e.orderBy)==null?void 0:s.ascending)!=null?a:!1});e!=null&&e.limit&&o.limit(e.limit),e!=null&&e.offset&&o.range(e.offset,e.offset+(e.limit||10)-1),e!=null&&e.filters&&Object.entries(e.filters).forEach(([y,l])=>{l!=null&&o.eq(y,l)});const u=yield o;if(!f(u))return{success:!1,error:"Invalid response format from Supabase",processedCount:0,errorCount:1};if(u.error)return{success:!1,error:u.error.message,processedCount:0,errorCount:1};const d=u.data||[],n=[];let c=0;for(const y of d)if(v(y)){const l=this.transformRowToInventoryItem(y);l.success&&l.data?n.push(l.data):c++}else c++;return{success:!0,data:n,processedCount:n.length,errorCount:c}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error occurred",processedCount:0,errorCount:1}}})}getItemById(e){return m(this,null,function*(){try{const r=yield i.from(this.tableName).select("*").eq("id",e).single();return f(r)?r.error?{success:!1,error:r.error.message}:!r.data||!v(r.data)?{success:!1,error:"Item not found or invalid format"}:this.transformRowToInventoryItem(r.data):{success:!1,error:"Invalid response format from Supabase"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error occurred"}}})}createItem(e){return m(this,null,function*(){try{const r=yield i.from(this.tableName).insert([e]).select().single();return f(r)?r.error?{success:!1,error:r.error.message}:!r.data||!v(r.data)?{success:!1,error:"Failed to create item or invalid response format"}:this.transformRowToInventoryItem(r.data):{success:!1,error:"Invalid response format from Supabase"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error occurred"}}})}updateItem(e,r){return m(this,null,function*(){try{const s=yield i.from(this.tableName).update(r).eq("id",e).select().single();return f(s)?s.error?{success:!1,error:s.error.message}:!s.data||!v(s.data)?{success:!1,error:"Item not found or invalid response format"}:this.transformRowToInventoryItem(s.data):{success:!1,error:"Invalid response format from Supabase"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}})}deleteItem(e){return m(this,null,function*(){try{const r=yield i.from(this.tableName).delete().eq("id",e);return f(r)?r.error?{success:!1,error:r.error.message}:{success:!0}:{success:!1,error:"Invalid response format from Supabase"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error occurred"}}})}subscribeToChanges(e,r){const s=i.channel("inventory_changes").on("postgres_changes",{event:(r==null?void 0:r.event)||"*",schema:(r==null?void 0:r.schema)||"public",table:(r==null?void 0:r.table)||this.tableName,filter:r==null?void 0:r.filter},a=>{h(a)?e(a):console.warn("Received invalid realtime payload:",a)}).subscribe();return()=>{i.removeChannel(s)}}transformRowToInventoryItem(e){try{return{success:!0,data:{id:e.id,facility_id:e.facility_id,name:e.name,quantity:e.quantity,data:e.data,created_at:e.created_at,updated_at:e.updated_at,reorder_level:e.reorder_level,reorder_point:e.reorder_point,status:e.status,expiration_date:e.expiration_date,unit_cost:e.unit_cost,category:e.category}}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Failed to transform row to inventory item"}}}transformInventoryItemToRow(e){return{facility_id:e.facility_id,name:e.name,quantity:e.quantity,data:e.data,reorder_level:e.reorder_level,reorder_point:e.reorder_point,status:e.status,expiration_date:e.expiration_date,unit_cost:e.unit_cost,category:e.category}}}export{C as TypedSupabaseAdapter};
