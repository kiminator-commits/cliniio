const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/services-CE_LtFqr.js","assets/js/react-vendor-BgCjxHGT.js","assets/js/data-vendor-C88t-X3A.js","assets/js/vendor-jNhfZCZ0.js","assets/js/inventory-pages-Dx6mSDHp.js","assets/js/ui-vendor-mgcSnJSc.js","assets/css/ui-vendor-DJSy8M6b.css","assets/js/utils-vendor-CxPd0XhF.js","assets/js/knowledgehub-pages-w63GWyRJ.js"])))=>i.map(i=>d[i]);
import{j as e,r as u,R as Z,c as Ee,N as ao,I as C,a as Is,u as Dr,b as Er,F as no,d as lo,e as io,f as oo,g as co,h as uo,i as mo,k as po,l as xo,m as ho,n as go,o as Ql,p as fo,q as bo,s as yo,M as vo,t as qr,v as vs,w as Yl,x as jo,y as wo,z as No,L as Jl,B as xr,A as je,C as Co,D as So,E as _o,G as To,H as Xl,J as Zl,K as ko,O as Io}from"./react-vendor-BgCjxHGT.js";import{f as ei,F as Ct,o as Po,l as Do,B as Fs,a as Eo,b as Oo,c as hs,d as $o,e as Hr,g as Ao,h as ti,t as Xt,i as hr,S as Ro,U as Ps,j as Ds,k as Bo,s as Fo,m as Vr,n as Mo,p as Lo,I as Dt,T as si,q as zo,v as ri,r as de,u as Uo,w as gs,A as pt,P as Wr,x as Et,y as Ot,z as Ms,C as xt,D as ls,E as qo}from"./services-CE_LtFqr.js";import{m as ut,a as ai,b as ae,c as ce,d as Me,e as dt,f as Be,g as Ho,h as Gr,i as Pt,j as Le,k as ni,l as ts,n as ze,o as Es,p as li,q as Vo,r as Ce,s as Wo,t as gr,u as ii,v as _t,w as Go,x as Ko,y as Qo,z as Kr,A as Yo,B as Jo,C as Xo,D as ss,E as Or,F as mt,G as fr,H as $r,I as oi,J as ci,K as js,L as Os,M as De,N as Ar,O as di,P as br,Q as Tt,R as kt,S as yr,T as Zo,U as Qr,V as ec,W as ui,X as vr,Y as jr,Z as It,_ as tc,$ as sc,a0 as rc,a1 as ws,a2 as ac,a3 as nc,a4 as lc,a5 as Ue,a6 as Yt,a7 as Zt,a8 as Yr,a9 as ic,aa as mi,ab as pi,ac as xi,ad as hi,ae as gi,af as oc,ag as fs,ah as cc,ai as dc,aj as $s,ak as uc,al as mc,am as pc,an as Jr,ao as xc,ap as hc,aq as Xr,ar as gc,as as Jt,at as fc,au as Zr,av as bc,aw as yc,ax as vc,ay as jc,az as wc,aA as ea}from"./ui-vendor-mgcSnJSc.js";import{c as rs,A as As,m as me}from"./utils-vendor-CxPd0XhF.js";import{c as Nc,p as Rs}from"./data-vendor-C88t-X3A.js";const Cc="modulepreload",Sc=function(r){return"/"+r},ta={},qe=function(t,s,n){let a=Promise.resolve();if(s&&s.length>0){let l=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),o=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=l(s.map(d=>{if(d=Sc(d),d in ta)return;ta[d]=!0;const p=d.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const x=document.createElement("link");if(x.rel=p?"stylesheet":Cc,p||(x.as="script"),x.crossOrigin="",x.href=d,o&&x.setAttribute("nonce",o),document.head.appendChild(x),p)return new Promise((f,g)=>{x.addEventListener("load",f),x.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(c){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=c,window.dispatchEvent(o),!o.defaultPrevented)throw c}return a.then(c=>{for(const o of c||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})};function Jy(){return e.jsxs("div",{className:"flex items-center justify-center h-full w-full bg-transparent",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-t-transparent border-gray-400"}),e.jsx("span",{className:"ml-3 text-gray-500 text-sm font-medium",children:"Loading..."})]})}const fi=u.createContext(void 0),Xy=({children:r})=>{const[t,s]=Z.useState("/"),[n,a]=Z.useState(!0),i=Z.useCallback(()=>{a(!0)},[]),c=Z.useCallback(()=>{a(!1)},[]);return e.jsx(fi.Provider,{value:{currentPath:t,setCurrentPath:s,isDrawerOpen:n,openDrawer:i,closeDrawer:c},children:r})},_c=()=>{const r=u.useContext(fi);if(!r)throw new Error("useNavigation must be used within NavigationProvider");return r},Tc="",kc="";console.debug=()=>{},console.info=()=>{},console.warn=()=>{};const Q=Nc(Tc,kc,{auth:{persistSession:!0,autoRefreshToken:!0}}),Ic=r=>(r?console.info(`ðŸ¥ Using facility scope: ${r}`):console.warn("âš ï¸ Missing facilityId â€” using default Supabase client"),Q),Pc=Object.freeze(Object.defineProperty({__proto__:null,getScopedClient:Ic,supabase:Q},Symbol.toStringTag,{value:"Module"})),wr={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},Dc=()=>"INFO";let Nr=Dc();const _e=r=>wr[r]<=wr[Nr],ye={error:(r,...t)=>{_e("ERROR")&&console.error(r,...t)},warn:(r,...t)=>{_e("WARN")&&console.warn(r,...t)},info:(r,...t)=>{_e("INFO")&&console.info(r,...t)},debug:(r,...t)=>{_e("DEBUG")&&console.log(r,...t)},verbose:(r,...t)=>{_e("VERBOSE")&&console.log(r,...t)},perf:(r,...t)=>{_e("DEBUG")&&console.log(`[PERF] ${r}`,...t)},security:(r,...t)=>{_e("INFO")&&console.log(`[SECURITY] ${r}`,...t)},audit:(r,...t)=>{_e("INFO")&&console.log(`[AUDIT] ${r}`,...t)},realtime:(r,...t)=>{_e("DEBUG")&&console.log(r,...t)},getLevel:()=>Nr,setLevel:r=>{wr[r]!==void 0&&(Nr=r,console.log(`ðŸ”§ Logger level changed to: ${r}`))},isEnabled:r=>_e(r)};var bs={};const Ns=(r,t="")=>{if(typeof process!="undefined"&&(process!=null&&bs)&&r in bs)return bs[r];if(typeof window!="undefined"&&window.env&&r in window.env)return window.env[r];if(t===void 0)throw new Error(`Missing required env var: ${r}`);return t},Ec=()=>{var r;return typeof process!="undefined"&&((r=process==null?void 0:bs)==null?void 0:r.NODE_ENV)==="development"},Zy=()=>typeof window!="undefined";var Ls=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const bi=u.createContext(void 0),ev=({children:r})=>{const[t,s]=u.useState(null),[n,a]=u.useState(!1),[i,c]=u.useState(!1),[o,l]=u.useState(!1),[d,p]=u.useState(0),m=1800*1e3,x=()=>t?!t.name||t.name.trim()===""?t.email||"Unknown User":t.name:"Unknown User",f=h=>{console.log("ðŸ”„ UserContext: handleSetCurrentUser called with:",h?`${h.name} (${h.email})`:"null"),s(h),h?(localStorage.setItem("currentUser",JSON.stringify(h)),p(Date.now())):(localStorage.removeItem("currentUser"),p(0))},g=u.useCallback(()=>Ls(null,null,function*(){if(n)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log("ðŸš« UserContext: No auth token found, skipping refreshUserData");return}console.log("ðŸ”„ UserContext: Starting refreshUserData...");const y=Date.now();if(t&&y-d<m){ye.info("âœ… UserContext: Using cached user data"),l(!0);return}try{a(!0),ye.info("ðŸ”„ UserContext: Starting user data refresh...");const{data:{session:b}}=yield Q.auth.getSession();if(!b){ye.info("âš ï¸ UserContext: No active Supabase session, skipping refresh"),l(!0);return}const _=new Promise(($,P)=>{setTimeout(()=>P(new Error("User data fetch timeout")),5e3)}),E=Ls(null,null,function*(){var $,P,w,T,k;const S=Date.now(),{data:{user:I},error:D}=yield Q.auth.getUser();if(D){console.error("âŒ UserContext: Auth error:",D);return}if(!I){ye.info("âš ï¸ UserContext: No authenticated user found");return}ye.info("âœ… UserContext: Found authenticated user:",I.id);const O=Date.now()-S;ye.info(`â±ï¸ UserContext: Auth fetch took ${O}ms`);const A=Date.now(),{data:R,error:B}=yield Q.from("users").select("*").eq("id",I.id).single();if(B){if(console.error("âŒ UserContext: Failed to fetch user profile:",B),B.code==="PGRST116"){console.log("ðŸ”„ UserContext: Creating missing user profile...");const{error:U}=yield Q.from("users").insert({id:I.id,email:I.email,first_name:I.email.split("@")[0],last_name:"",role:"user",facility_id:ei.getDefaultFacilityId(),avatar_url:(($=I.user_metadata)==null?void 0:$.avatar_url)||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(U){console.error("âŒ UserContext: Failed to create user profile:",U);return}console.log("âœ… UserContext: User profile created successfully");const{data:F}=yield Q.from("users").select("*").eq("id",I.id).single();if(F){const q={id:F.id,name:`${F.first_name||""} ${F.last_name||""}`.trim()||((P=F.email)==null?void 0:P.split("@")[0])||"User",email:F.email,role:F.role,avatar_url:F.avatar_url,facility_id:F.facility_id};f(q);return}}return}const V=Date.now()-A;if(ye.info(`â±ï¸ UserContext: Profile fetch took ${V}ms`),ye.info(`â±ï¸ UserContext: Total fetch time: ${Date.now()-S}ms`),R){let U=R.avatar_url;if(!U&&((w=I.user_metadata)!=null&&w.avatar_url)){U=I.user_metadata.avatar_url,console.log("ðŸ”§ UserContext: Using avatar_url from auth metadata:",U);try{yield Q.from("users").update({avatar_url:U}).eq("id",I.id),console.log("âœ… UserContext: Updated database with avatar_url from auth metadata")}catch(X){console.error("âŒ UserContext: Failed to update avatar_url:",X)}}!U&&((T=I.user_metadata)!=null&&T.avatar_url)&&(U=I.user_metadata.avatar_url,console.log("ðŸ”§ UserContext: Using avatar_url from Supabase auth user:",U)),U||(U=`https://ui-avatars.com/api/?name=${encodeURIComponent(R.first_name||R.email||"User")}&background=4ECDC4&color=fff&size=128`,console.log("ðŸ”§ UserContext: Using default avatar URL:",U));const F={id:R.id,name:`${R.first_name||""} ${R.last_name||""}`.trim()||((k=R.email)==null?void 0:k.split("@")[0])||"User",email:R.email,role:R.role,avatar_url:U,facility_id:R.facility_id},q={admin:"Administrator",manager:"Manager",user:"User",viewer:"Viewer"},W=typeof R.role=="string"?R.role:"user";F.role=q[W]||W,s(F),p(y)}c(!0)});yield Promise.race([E,_])}catch(b){b instanceof Error&&b.message.includes("timeout")&&ye.warn("âš ï¸ UserContext: User data fetch timed out, this may indicate database performance issues"),console.error("âŒ UserContext: Error refreshing user data:",b)}finally{a(!1),c(!0)}}),[n,t,d,m]),v=u.useCallback(()=>{console.log("ðŸ§¹ UserContext: Starting clearUserData..."),ye.info("ðŸ§¹ UserContext: Clearing all user data on logout"),s(null),c(!1),l(!1),p(0),a(!1),["currentUser","userProfile","userData","user_preferences","sb-user","user_data"].forEach(b=>{const _=localStorage.getItem(b);_&&(console.log(`ðŸ—‘ï¸ Clearing localStorage.${b}:`,_.substring(0,100)+"..."),localStorage.removeItem(b))}),["currentUser","userProfile","userData","user_preferences","user_id","user_email","user_role"].forEach(b=>{const _=sessionStorage.getItem(b);_&&(console.log(`ðŸ—‘ï¸ Clearing sessionStorage.${b}:`,_.substring(0,100)+"..."),sessionStorage.removeItem(b))}),console.log("âœ… UserContext: clearUserData completed"),ye.info("âœ… UserContext: All user data cleared successfully")},[]),j=u.useCallback(()=>Ls(null,null,function*(){if(i||n)return;if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log("ðŸš« UserContext: No auth token found, skipping initializeUserContext");return}ye.info("ðŸ”„ UserContext: Starting user data refresh..."),yield g(),c(!0)}),[i,n,g]);return u.useEffect(()=>{if(!i){const h=Date.now();if(t&&h-d<m){c(!0);return}const y=setTimeout(()=>{if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){console.log("ðŸš« UserContext: No auth token found, skipping auto-initialization"),c(!0);return}t?g():c(!0)},100);return()=>clearTimeout(y)}},[i,t,d,m,g]),e.jsx(bi.Provider,{value:{currentUser:t,setCurrentUser:f,getUserDisplayName:x,refreshUserData:g,initializeUserContext:j,clearUserData:v,isLoading:n},children:r})},He=()=>{const r=u.useContext(bi);if(!r)throw new Error("useUser must be used within a UserProvider");return r};var Oc=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const yi=u.createContext(void 0),tv=({children:r})=>{const[t,s]=u.useState(null),[n,a]=u.useState(!0),[i,c]=u.useState(null),o=()=>(t==null?void 0:t.id)||null,l=()=>Oc(null,null,function*(){var d;try{a(!0),c(null);const p=yield Ct.getCurrentFacilityId();if(!p)throw new Error("No facility ID available - user not authenticated");const m=yield Ct.getFacility(p);s(m),localStorage.setItem("currentFacility",JSON.stringify(m))}catch(p){if(console.warn("âš ï¸ Facility context error, using development fallback:",p),typeof window!="undefined"&&((d=window.location)==null?void 0:d.hostname)==="localhost"){console.warn("Using dev facility fallback in development/test mode");const x={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0};s(x),localStorage.setItem("currentFacility",JSON.stringify(x)),c(null)}else throw new Error("FacilityContext failed to resolve facility ID â€” no fallback allowed in production.")}finally{a(!1)}});return u.useEffect(()=>{if(typeof window!="undefined"&&window.location.pathname==="/login"){a(!1);return}l().catch(d=>{typeof window!="undefined"&&c(d.message)})},[]),e.jsx(yi.Provider,{value:{currentFacility:t,setCurrentFacility:s,getCurrentFacilityId:o,isLoading:n,error:i,refreshFacility:l},children:r})},vi=()=>{const r=u.useContext(yi);if(!r)throw new Error("useFacility must be used within a FacilityProvider");return r};var $c=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class Ac extends Z.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){return $c(this,null,function*(){console.error("ðŸ’¥ Global Error Boundary caught:",t,s),this.props.onError&&this.props.onError(t,s),yield Po.logCritical("Global React component crash",{error:t.message,stack:t.stack,componentStack:s.componentStack})})}render(){if(this.state.hasError){if(this.props.fallback){if(Z.isValidElement(this.props.fallback))return this.props.fallback;{const t=this.props.fallback;return e.jsx(t,{error:this.state.error,errorInfo:void 0})}}return e.jsxs("div",{className:"p-6 text-center text-red-700 bg-red-50 rounded-xl",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Something went wrong."}),e.jsx("p",{className:"text-sm opacity-75",children:"The team has been notified and is investigating."})]})}return this.props.children}}var Rc=Object.defineProperty,Bc=Object.defineProperties,Fc=Object.getOwnPropertyDescriptors,sa=Object.getOwnPropertySymbols,Mc=Object.prototype.hasOwnProperty,Lc=Object.prototype.propertyIsEnumerable,ra=(r,t,s)=>t in r?Rc(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,$t=(r,t)=>{for(var s in t||(t={}))Mc.call(t,s)&&ra(r,s,t[s]);if(sa)for(var s of sa(t))Lc.call(t,s)&&ra(r,s,t[s]);return r},zs=(r,t)=>Bc(r,Fc(t));const Rr=Ee((r,t)=>{const n=typeof window!="undefined"?localStorage.getItem("token"):null;return{token:n,authToken:n,tokenExpiry:null,remember:!1,formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,stage:"credentials",otp:""},errors:{},loading:!1,csrfToken:null,isSecureMode:!1,isOffline:!1,failedAttempts:0,setToken:(a,i)=>{typeof window!="undefined"&&(i?localStorage.setItem("token",a):sessionStorage.setItem("token",a),r({token:a,authToken:a,remember:i}))},setAuthToken:a=>{r({authToken:a,token:a})},setSessionExpiry:a=>{r({tokenExpiry:a})},setField:(a,i)=>{r(c=>({formData:zs($t({},c.formData),{[a]:i})}))},setErrors:a=>{r(i=>({errors:$t($t({},i.errors),a)}))},setLoading:a=>{r({loading:a})},setError:a=>{r(i=>({errors:zs($t({},i.errors),{submit:a})}))},clearError:()=>{r(a=>({errors:zs($t({},a.errors),{submit:void 0})}))},incrementFailedAttempts:()=>{r(a=>({failedAttempts:a.failedAttempts+1}))},resetFailedAttempts:()=>{r({failedAttempts:0})},reset:()=>{r({formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,stage:"credentials",otp:""},errors:{},loading:!1,failedAttempts:0})},clear:()=>{typeof window!="undefined"&&(localStorage.removeItem("token"),sessionStorage.removeItem("token"),r({token:null,authToken:null,tokenExpiry:null,formData:{email:"",password:"",rememberMe:!1,rememberDevice:!1,stage:"credentials",otp:""},errors:{},loading:!1,failedAttempts:0}))},get isTokenExpired(){const a=t();return a.tokenExpiry?new Date>new Date(a.tokenExpiry):!1}}}),zc=Object.freeze(Object.defineProperty({__proto__:null,useLoginStore:Rr},Symbol.toStringTag,{value:"Module"}));function sv({children:r}){const{token:t,clear:s}=Rr();return u.useEffect(()=>{t||(Do.info("No token found â€” triggering logout cleanup."),s())},[t,s]),t?e.jsx(e.Fragment,{children:r}):e.jsx(ao,{to:"/login",replace:!0})}var aa,na;const Uc=(aa=void 0)!=null?aa:"",qc=(na=void 0)!=null?na:"",ji=()=>({url:Uc,anonKey:qc}),Cr=()=>{function r(){let n=Ns("VITE_SUPABASE_URL",""),a=Ns("VITE_SUPABASE_ANON_KEY","");if(!n||!a){const i=ji();n=i.url,a=i.anonKey}return{supabaseUrl:n,supabaseAnonKey:a}}const{supabaseUrl:t,supabaseAnonKey:s}=r();return!!(t&&s&&t!=="https://mock.supabase.co")},Hc=()=>{function r(){let s=Ns("VITE_SUPABASE_URL",""),n=Ns("VITE_SUPABASE_ANON_KEY","");if(!s||!n){const a=ji();s=a.url,n=a.anonKey}return{supabaseUrl:s,supabaseAnonKey:n}}const{supabaseUrl:t}=r();return t||""},Vc=r=>typeof r=="string"?new Error(r):r!=null&&r.message?new Error(r.message):typeof r=="object"&&"error_description"in r&&r.error_description?new Error(r.error_description):new Error("An unexpected error occurred with Supabase"),rv=Object.freeze(Object.defineProperty({__proto__:null,getSupabaseUrl:Hc,handleSupabaseError:Vc,isSupabaseConfigured:Cr,supabase:Q},Symbol.toStringTag,{value:"Module"})),la=r=>{if(!r)return null;const t=localStorage.getItem("officeHoursSettings");if(!t)return ia(r,{workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},startHour:8,endHour:17});const s=JSON.parse(t);return ia(r,s)},ia=(r,t)=>{const s=new Date(r);return s.setHours(s.getHours()+24),Wc(s,t)},Wc=(r,t)=>{const s=new Date(r),n=s.getDay(),a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i=a[n];if(!t.workingDays[i]){let l=1;for(;l<=7;){const d=new Date(s);d.setDate(d.getDate()+l);const p=d.getDay(),m=a[p];if(t.workingDays[m])return s.setDate(s.getDate()+l),s.setHours(t.startHour,0,0,0),s;l++}}const o=s.getHours();if(o<t.startHour)s.setHours(t.startHour,0,0,0);else if(o>=t.endHour){let l=1;for(;l<=7;){const d=new Date(s);d.setDate(d.getDate()+l);const p=d.getDay(),m=a[p];if(t.workingDays[m])return s.setDate(s.getDate()+l),s.setHours(t.startHour,0,0,0),s;l++}}return s},Gc=r=>{const t=new Date,s=r.getTime()-t.getTime(),n=Math.ceil(s/(1e3*60*60*24));return n===0?"Today":n===1?"Tomorrow":n<7?r.toLocaleDateString("en-US",{weekday:"long"}):r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};var Kc=Object.defineProperty,Qc=Object.defineProperties,Yc=Object.getOwnPropertyDescriptors,oa=Object.getOwnPropertySymbols,Jc=Object.prototype.hasOwnProperty,Xc=Object.prototype.propertyIsEnumerable,ca=(r,t,s)=>t in r?Kc(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,At=(r,t)=>{for(var s in t||(t={}))Jc.call(t,s)&&ca(r,s,t[s]);if(oa)for(var s of oa(t))Xc.call(t,s)&&ca(r,s,t[s]);return r},Rt=(r,t)=>Qc(r,Yc(t)),Us=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Zc=r=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null,setBiTestCompleted:t=>r({biTestCompleted:t}),setBiTestDate:t=>r({biTestDate:t}),recordBITestResult:t=>Us(null,null,function*(){console.log("ðŸ”¬ Store: recordBITestResult called with:",t);try{const{data:{user:s},error:n}=yield Q.auth.getUser();if(n||!s)throw new Error("User not authenticated");const a="550e8400-e29b-41d4-a716-446655440000",i={facility_id:a};let c=[],o=null,l=null;try{c=yield Fs.getAvailableKits(i.facility_id),c.length>0&&(o=c[0],l=yield Fs.getCurrentTestConditions())}catch(m){console.error(m),o={id:"default-kit",facility_id:i.facility_id,name:"Default BI Kit",manufacturer:"Default Manufacturer",lot_number:"DEFAULT-001",expiry_date:new Date(Date.now()+365*24*60*60*1e3).toISOString(),incubation_time_minutes:60,incubation_temperature_celsius:37,quantity:1,min_quantity:1,max_quantity:100,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},l={room_temperature_celsius:22,humidity_percent:45,equipment_used:"Default Equipment",operator:s.id,operator_id:s.id,facility_id:i.facility_id,test_date:new Date().toISOString()}}const d={facility_id:a,operator:s.id,test_date:new Date().toISOString(),result:t.status==="pending"?"pass":t.status,bi_lot_number:(o==null?void 0:o.lot_number)||"",bi_expiry_date:(o==null?void 0:o.expiry_date)||null,incubation_time_minutes:(o==null?void 0:o.incubation_time_minutes)||60,incubation_temperature_celsius:(o==null?void 0:o.incubation_temperature_celsius)||37,test_conditions:l||void 0,failure_reason:t.status==="fail"?"BI test failed":void 0,skip_reason:t.status==="skip"?"BI test skipped":void 0,compliance_notes:t.status==="pass"?"BI test passed":void 0},p=yield Eo.createBITestResult(d);if(o&&o.id!=="default-kit")try{yield Fs.decrementKitQuantity(o.id)}catch(m){console.error(m)}return console.log("ðŸ”¬ Store: Updating state with lastBITestDate:",t.date.toISOString()),r(m=>{const x=la(t.date),f={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:t.passed?"BI Test Passed":"BI Test Failed",time:t.date,toolCount:1,color:t.passed?"bg-green-500":"bg-red-500"},g=Rt(At({},t),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),v={biTestCompleted:t.passed,biTestDate:t.date.toISOString(),biTestResults:[...m.biTestResults,g],lastBITestDate:t.date.toISOString(),nextBITestDue:x,biTestPassed:t.passed,activityLog:[f,...m.activityLog].slice(0,20)};return console.log("ðŸ”¬ Store: New state lastBITestDate:",v.lastBITestDate),v}),p}catch(s){throw console.error("Error recording BI test result:",s),console.log("ðŸ”¬ Store: Error path - updating state with lastBITestDate:",t.date.toISOString()),r(n=>{const a=la(t.date),i={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:t.passed?"BI Test Passed":"BI Test Failed",time:t.date,toolCount:1,color:t.passed?"bg-green-500":"bg-red-500"},c=Rt(At({},t),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),o={biTestCompleted:t.passed,biTestDate:t.date.toISOString(),biTestResults:[...n.biTestResults,c],lastBITestDate:t.date.toISOString(),nextBITestDue:a,biTestPassed:t.passed,activityLog:[i,...n.activityLog].slice(0,20)};return console.log("ðŸ”¬ Store: Error path - New state lastBITestDate:",o.lastBITestDate),o}),s}}),setNextBITestDue:t=>r({nextBITestDue:t}),setLastBITestDate:t=>r({lastBITestDate:t}),setBiTestPassed:t=>r({biTestPassed:t}),setBiTestOptedOut:t=>r({biTestOptedOut:t}),addActivity:t=>r(s=>({activityLog:[Rt(At({},t),{id:t.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),...s.activityLog].slice(0,20)})),activateBIFailure:t=>r(()=>({biFailureActive:!0,biFailureDetails:{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,failure_date:new Date,affected_tools_count:t.affectedToolsCount,affected_batch_ids:t.affectedBatchIds,detected_by_operator_id:t.operator,facility_id:"unknown",incident_number:`BI-${Date.now()}`,severity_level:"high",status:"active",resolution_notes:null,resolved_at:null,resolved_by:null}})),deactivateBIFailure:()=>r(()=>({biFailureActive:!1,biFailureDetails:null})),loadBIFailureIncidents:t=>Us(null,null,function*(){try{const{data:s,error:n}=yield Q.from("bi_failure_incidents").select("*").eq("facility_id",t).eq("status","resolved").gte("resolved_at",new Date(Date.now()-2592e6).toISOString()).order("resolved_at",{ascending:!1}).limit(20);if(n){console.error("Failed to load BI failure incidents:",n);return}r(a=>{const i=new Set(a.activityLog.map(l=>l.id)),c=[];(s||[]).forEach(l=>{var d;const p=`bi-incident-resolved-${l.id}`;i.has(p)||c.push({id:p,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date(String(l.resolved_at||l.updated_at)),toolCount:((d=l.metadata)==null?void 0:d.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:l.id,operatorId:l.resolved_by_operator,resolutionNotes:l.resolution_notes}})});const o=[...c,...a.activityLog].sort((l,d)=>new Date(d.time).getTime()-new Date(l.time).getTime()).slice(0,20);return Rt(At({},a),{activityLog:o})})}catch(s){console.error("Error loading BI failure incidents:",s)}}),loadBITestResults:t=>Us(null,null,function*(){try{const{data:s,error:n}=yield Q.from("bi_test_results").select("*").eq("facility_id",t).order("test_date",{ascending:!1}).limit(50);if(n){console.error("Failed to load BI test results:",n);return}const a=(s||[]).map(i=>({id:String(i.id),facility_id:String(i.facility_id),test_number:String(i.test_number),test_date:String(i.test_date),result:String(i.result),status:String(i.result),operator:String(i.operator),cycle_id:String(i.cycle_id),bi_lot_number:String(i.bi_lot_number),bi_expiry_date:String(i.bi_expiry_date),incubation_time_minutes:Number(i.incubation_time_minutes),incubation_temperature_celsius:Number(i.incubation_temperature_celsius),test_conditions:i.test_conditions||{},failure_reason:String(i.failure_reason),skip_reason:String(i.skip_reason),compliance_notes:String(i.compliance_notes),date:new Date(String(i.test_date)),toolId:String(i.test_number||"default-tool"),passed:i.result==="pass",notes:String(i.compliance_notes||i.failure_reason||i.skip_reason),created_at:String(i.created_at),updated_at:String(i.updated_at)}));r(i=>{const c=new Set(i.activityLog.map(d=>d.id)),o=[];a.forEach(d=>{const p=`bi-test-${d.id}`;c.has(p)||o.push({id:p,type:"bi-test",title:d.passed?"BI Test Passed":"BI Test Failed",time:new Date(String(d.test_date)),toolCount:1,color:d.passed?"bg-green-500":"bg-red-500",metadata:{testNumber:String(d.test_number),operatorId:d.operator}})});const l=[...o,...i.activityLog].sort((d,p)=>new Date(p.time).getTime()-new Date(d.time).getTime()).slice(0,20);return Rt(At({},i),{biTestResults:a,activityLog:l})})}catch(s){console.error("Error loading BI test results:",s)}}),syncBIFailureFromDatabase:t=>r({biFailureActive:t.status==="active",biFailureDetails:t.status==="active"?{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,facility_id:"",incident_number:"",failure_date:t.failure_date,affected_tools_count:t.affected_tools_count,affected_batch_ids:t.affected_batch_ids,detected_by_operator_id:t.detected_by_operator||"System Alert",severity_level:"medium",status:t.status||"active",regulatory_notification_required:!1,regulatory_notification_sent:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}:null}),resetBIState:()=>r(()=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null}))});var da=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const ed=r=>({enforceCi:!1,enforceBi:!1,allowOverrides:!0,loading:!1,fetchComplianceSettings:t=>da(null,null,function*(){var s,n,a;r({loading:!0});const{data:i,error:c}=yield Q.from("facility_compliance_settings").select("enforce_ci, enforce_bi, allow_overrides").eq("facility_id",t).maybeSingle();c?console.error("Failed to fetch compliance settings:",c.message):r(i?{enforceCi:(s=i.enforce_ci)!=null?s:!1,enforceBi:(n=i.enforce_bi)!=null?n:!1,allowOverrides:(a=i.allow_overrides)!=null?a:!0}:{enforceCi:!1,enforceBi:!1,allowOverrides:!0}),r({loading:!1})}),updateComplianceSettings:(t,s)=>da(null,null,function*(){var n,a,i;const{error:c}=yield Q.from("facility_compliance_settings").upsert({facility_id:t,enforce_ci:s.enforceCi,enforce_bi:s.enforceBi,allow_overrides:s.allowOverrides,updated_at:new Date().toISOString()},{onConflict:"facility_id"});c?console.error("Failed to update compliance settings:",c.message):r({enforceCi:(n=s.enforceCi)!=null?n:!1,enforceBi:(a=s.enforceBi)!=null?a:!1,allowOverrides:(i=s.allowOverrides)!=null?i:!0})})}),td=(r,t)=>{if(r.duration<=0)throw new Error(`${t} has invalid duration`);if(r.temperature!==void 0&&(r.temperature<30||r.temperature>150))throw new Error(`${t} has unsafe temperature`);if(r.pressure!==void 0&&(r.pressure<5||r.pressure>30))throw new Error(`${t} has unsafe pressure`)},oe={bath1:{name:"Bath 1",duration:1,temperature:60,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},bath2:{name:"Bath 2",duration:1,temperature:65,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},drying:{name:"Drying",duration:1,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},autoclave:{name:"Autoclave",duration:1,temperature:121,pressure:15,requiresCI:!0,requiresBI:!0,requiresCiStrip:!0,requiresBiTest:!0}};Object.entries(oe).forEach(([r,t])=>{td(t,r)});const wi={bath1:{label:oe.bath1.name,duration:oe.bath1.duration*60},bath2:{label:oe.bath2.name,duration:oe.bath2.duration*60},drying:{label:oe.drying.name,duration:oe.drying.duration*60},autoclave:{label:oe.autoclave.name,duration:oe.autoclave.duration*60}},sd=()=>{const t=new Date().toISOString().split("T")[0].replace(/-/g,""),s=`cycle_count_${t}`,a=parseInt(localStorage.getItem(s)||"0")+1;return localStorage.setItem(s,a.toString()),`CYCLE-${t}-${String(a).padStart(3,"0")}`},Sr=r=>{const t=`cycle_${Date.now()}`,s=sd();return{id:t,cycleNumber:s,phases:[],tools:[],operator:r,startTime:new Date,completedAt:null}},rd=(r,t,s,n=[])=>({id:r,name:t,duration:s,tools:n,isActive:!1,startTime:null,endTime:null,status:"pending"}),ad=r=>({bath1:{name:oe.bath1.name,duration:oe.bath1.duration*60},bath2:{name:oe.bath2.name,duration:oe.bath2.duration*60},drying:{name:oe.drying.name,duration:oe.drying.duration*60},autoclave:{name:oe.autoclave.name,duration:oe.autoclave.duration*60}})[r],nd=r=>{const t=["bath1","bath2","drying","autoclave"],s=t.indexOf(r);return t[s+1]||null},_r=r=>r.phases.some(t=>t.id==="autoclave");var ld=Object.defineProperty,id=Object.defineProperties,od=Object.getOwnPropertyDescriptors,ua=Object.getOwnPropertySymbols,cd=Object.prototype.hasOwnProperty,dd=Object.prototype.propertyIsEnumerable,ma=(r,t,s)=>t in r?ld(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Qe=(r,t)=>{for(var s in t||(t={}))cd.call(t,s)&&ma(r,s,t[s]);if(ua)for(var s of ua(t))dd.call(t,s)&&ma(r,s,t[s]);return r},Ye=(r,t)=>id(r,od(t)),ud=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const md=(r,t,s)=>({setCurrentCycle:n=>r(a=>Ye(Qe({},a),{currentCycle:n})),setError:n=>r(a=>Ye(Qe({},a),{error:n})),startNewCycle:n=>{const a=Sr(n);r(i=>Ye(Qe({},i),{currentCycle:a}))},addToolToCycle:n=>{r(a=>{const i=a.currentCycle;if(!i){const c=Sr("Current Operator");return c.tools=[n],t(),Ye(Qe({},a),{currentCycle:c})}if(!i.tools.includes(n)){const c=Ye(Qe({},i),{tools:[...i.tools,n]});return t(),Ye(Qe({},a),{currentCycle:c})}return a})},loadCycles:n=>ud(null,null,function*(){try{const i=(yield Oo.getSterilizationCycles(n)).map(c=>({id:c.id,cycleNumber:c.cycle_number,phases:Array.isArray(c.phases)?c.phases.map(o=>({id:o.id,name:o.name,duration:o.duration,tools:Array.isArray(o.tools)?o.tools.map(l=>String(l)):[],isActive:o.isActive,startTime:o.startTime?new Date(o.startTime):null,endTime:o.endTime?new Date(o.endTime):null,status:o.status})):[],tools:Array.isArray(c.tools)?c.tools.map(o=>o.id):[],operator:c.operator_id||"Unknown",startTime:c.start_time?new Date(c.start_time):new Date,completedAt:c.end_time||null,batchId:c.cycle_number}));r(c=>Ye(Qe({},c),{cycles:i}))}catch(a){console.error("Failed to load sterilization cycles:",a),r(i=>Ye(Qe({},i),{error:a instanceof Error?a.message:"Failed to load cycles"}))}})});var pd=Object.defineProperty,xd=Object.defineProperties,hd=Object.getOwnPropertyDescriptors,pa=Object.getOwnPropertySymbols,gd=Object.prototype.hasOwnProperty,fd=Object.prototype.propertyIsEnumerable,xa=(r,t,s)=>t in r?pd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,he=(r,t)=>{for(var s in t||(t={}))gd.call(t,s)&&xa(r,s,t[s]);if(pa)for(var s of pa(t))fd.call(t,s)&&xa(r,s,t[s]);return r},ge=(r,t)=>xd(r,hd(t));const bd=(r,t,s)=>({addPhaseToCycle:(n,a,i)=>{r(c=>{if(!c.currentCycle){const x=t().availableTools.filter(g=>g.currentPhase==="bath1").map(g=>g.id),f=Sr("Current Operator");return f.tools=x,ge(he({},c),{currentCycle:f})}if(c.currentCycle.phases.find(m=>m.id===n))return c;const l=rd(n,a,i,[...c.currentCycle.tools]),d=[...c.currentCycle.phases,l],p=ge(he({},c.currentCycle),{phases:d});return ge(he({},c),{currentCycle:p})})},startPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!0,startTime:new Date,status:"active"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})},completePhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!1,endTime:new Date,status:"completed"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})},pausePhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!1,status:"paused"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})},resetPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?ge(he({},c),{isActive:!1,startTime:null,endTime:null,status:"pending"}):c);return ge(he({},a),{currentCycle:ge(he({},a.currentCycle),{phases:i})})})}});var yd=Object.defineProperty,vd=Object.defineProperties,jd=Object.getOwnPropertyDescriptors,ha=Object.getOwnPropertySymbols,wd=Object.prototype.hasOwnProperty,Nd=Object.prototype.propertyIsEnumerable,ga=(r,t,s)=>t in r?yd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,is=(r,t)=>{for(var s in t||(t={}))wd.call(t,s)&&ga(r,s,t[s]);if(ha)for(var s of ha(t))Nd.call(t,s)&&ga(r,s,t[s]);return r},os=(r,t)=>vd(r,jd(t));const Cd=(r,t,s)=>({moveToolToNextPhase:n=>{r(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.find(m=>m.tools.includes(n)&&m.isActive);if(!i)return a;const c=nd(i.id);if(!c){const m=t();return m.incrementToolCycleCount&&m.incrementToolCycleCount(n),a}const o=t(),l=o.availableTools.find(m=>m.id===n);if(l!=null&&l.isP2Status&&c==="autoclave")return o.incrementToolCycleCount&&o.incrementToolCycleCount(n),a;let d=a.currentCycle.phases.find(m=>m.id===c);if(!d){const m=ad(c);m&&(d={id:c,name:m.name,duration:m.duration,tools:[],isActive:!1,startTime:null,endTime:null,status:"pending"})}if(!d)return a;const p=a.currentCycle.phases.map(m=>m.id===i.id?os(is({},m),{tools:m.tools.filter(x=>x!==n)}):m.id===c?os(is({},m),{tools:[...m.tools,n]}):m);return a.currentCycle.phases.find(m=>m.id===c)||p.push(d),os(is({},a),{currentCycle:os(is({},a.currentCycle),{phases:p})})})}}),Sd=r=>{let t=100,s=null;if(r.length>0){const n=new Date;n.setDate(n.getDate()-30);const a=r.filter(o=>o.date>=n),i=a.filter(o=>o.passed===!1),c=a.filter(o=>!o.passed&&o.date<n);if(a.length>0){const o=a.filter(l=>l.passed===!0).length;t=Math.round(o/a.length*100),i.length>0&&(s={direction:"down",value:`${i.length} failure(s) this month`})}else c.length>0&&(s={direction:"warning",value:`${c.length} test(s) missed this month`})}return{rate:t,trend:s}},_d=r=>{const t=new Date;t.setDate(t.getDate()-7);const s=new Date;s.setDate(s.getDate()-14);const n=r.filter(o=>new Date(o.startTime)>=t&&_r(o)),a=r.filter(o=>{const l=new Date(o.startTime);return l>=s&&l<t&&_r(o)}),i=n.length,c=a.length;if(c>0){const o=Math.round((i-c)/c*100);return{direction:o>=0?"up":"down",value:`${o>=0?"+":""}${o}% from last week`}}else if(i>0)return{direction:"up",value:"New this week"};return null},Td=(r,t)=>{const s=new Date;s.setDate(s.getDate()-30);const n=t.filter(c=>{const o=c.currentPhase==="complete"||c.currentPhase==="available",l=c.startTime&&c.endTime,d=l&&new Date(c.endTime)>=s,p=l&&new Date(c.endTime).getTime()-new Date(c.startTime).getTime()>1800*1e3;return o&&l&&d&&p});if(n.length===0)return 0;const a=n.reduce((c,o)=>{const l=new Date(o.startTime),p=new Date(o.endTime).getTime()-l.getTime();return c+p},0);return Math.round(a/n.length/(1e3*60))},kd=(r,t,s,n,a)=>{const i={cycleCompletionRate:.2,timeEfficiency:.15,resourceUtilization:.15,qualityMetrics:.15,throughputEfficiency:.1,inventoryEfficiency:.15},c=new Date;c.setDate(c.getDate()-7);const o=new Date;o.setDate(o.getDate()-14);const l=r.filter(S=>new Date(S.startTime)>=c&&_r(S)),d=l.length,p=l.filter(S=>S.completedAt!==null).length,m=d>0?p/d*100:0,x=60,f=Math.max(0,Math.min(100,(x-Math.abs(s-x))/x*100)),g=l.reduce((S,I)=>S+I.tools.length,0),v=d>0?g/d:0,h=Math.max(0,Math.min(100,v/7*100)),y=t,_=d/7,$=Math.max(0,Math.min(100,_/2.5*100));let P=0;const w=m*i.cycleCompletionRate+f*i.timeEfficiency+h*i.resourceUtilization+y*i.qualityMetrics+$*i.throughputEfficiency+P*i.inventoryEfficiency,T=r.filter(S=>{const I=new Date(S.startTime);return I>=o&&I<c});let k=null;if(T.length>0){const I=T.filter(A=>A.completedAt!==null).length/T.length*100*i.cycleCompletionRate+80,D=w-I,O=Math.round(D/I*100);k={direction:D>=0?"up":"down",value:`${D>=0?"+":""}${O}% from last week`}}return{score:Math.round(w),trend:k,breakdown:{sterilization:{completionRate:m,timeEfficiency:f,resourceUtilization:h,qualityScore:y,throughputEfficiency:$},inventory:{efficiency:P,lowStockItems:0,totalItems:0,expiringItems:0,accuracy:100}}}},Id=(r,t,s,n)=>{const{rate:a,trend:i}=Sd(s),c=_d(r),o=Td(r,t),l=kd(r,a,o),d=new Date;d.setDate(d.getDate()-30);const p=r.filter(g=>{const v=new Date(g.startTime);return!isNaN(v.getTime())&&v>=d}),m=p.length,x=p.filter(g=>g.completedAt!==null).length,f=c&&c.direction!=="warning"?{direction:c.direction,value:c.value}:null;return{totalCycles:m,completedCycles:x,averageCycleTime:o,biPassRate:a,biPassRateTrend:i,cycleTrend:f,efficiencyScore:l}};var Pd=Object.defineProperty,Dd=Object.defineProperties,Ed=Object.getOwnPropertyDescriptors,fa=Object.getOwnPropertySymbols,Od=Object.prototype.hasOwnProperty,$d=Object.prototype.propertyIsEnumerable,ba=(r,t,s)=>t in r?Pd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,qs=(r,t)=>{for(var s in t||(t={}))Od.call(t,s)&&ba(r,s,t[s]);if(fa)for(var s of fa(t))$d.call(t,s)&&ba(r,s,t[s]);return r},Ad=(r,t)=>Dd(r,Ed(t));const Rd=(r,t,s)=>{const n=md(r,t),a=bd(r,t),i=Cd(r,t);return Ad(qs(qs(qs({currentCycle:null,cycles:[],error:null},n),a),i),{getCycleStats:()=>{const c=t();return Id(c.cycles||[],c.availableTools||[],c.biTestResults||[])}})},Bd=r=>({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:"",setModalOpen:t=>r({isModalOpen:t}),setShowAnalyticsModal:t=>r({showAnalyticsModal:t}),setShowCleaningLogModal:t=>r({showCleaningLogModal:t}),setShowBITestModal:t=>r({showBITestModal:t}),setShowBatchCodeModal:t=>r({showBatchCodeModal:t}),setWorkflowType:t=>r({workflowType:t}),setScannedData:t=>r({scannedData:t}),resetUIState:()=>r({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:""})});var Fd=Object.defineProperty,Md=Object.defineProperties,Ld=Object.getOwnPropertyDescriptors,ya=Object.getOwnPropertySymbols,zd=Object.prototype.hasOwnProperty,Ud=Object.prototype.propertyIsEnumerable,va=(r,t,s)=>t in r?Fd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,qd=(r,t)=>{for(var s in t||(t={}))zd.call(t,s)&&va(r,s,t[s]);if(ya)for(var s of ya(t))Ud.call(t,s)&&va(r,s,t[s]);return r},Hd=(r,t)=>Md(r,Ld(t));const Ni=(r,t)=>({availableTools:[],toolsInCycle:[],setAvailableTools:s=>{r({availableTools:s})},addToolToCycle:s=>{const n=t().availableTools.find(a=>a.id===s);n&&r(a=>({toolsInCycle:[...a.toolsInCycle,n]}))},clearCycle:()=>{r({toolsInCycle:[]})},incrementToolCycleCount:s=>{r(n=>({availableTools:n.availableTools.map(a=>a.id===s?Hd(qd({},a),{cycleCount:a.cycleCount+1}):a)}))},checkToolReplacementNeeded:s=>{const n=t().availableTools.find(a=>a.id===s);return n?n.cycleCount>=(n.maxCycles||200):!1},getToolCycleCount:s=>{const n=t().availableTools.find(a=>a.id===s);return n?n.cycleCount:0}}),Ci=(r,t,s)=>({}),Si=(r,t)=>({currentBatchId:null,batchedToolIds:[],currentCycle:null,setCurrentBatchId:s=>r({currentBatchId:s}),addToolToBatch:s=>r({batchedToolIds:[...t().batchedToolIds,s]}),resetBatch:()=>r({currentBatchId:null,batchedToolIds:[]})});var Vd=Object.defineProperty,ja=Object.getOwnPropertySymbols,Wd=Object.prototype.hasOwnProperty,Gd=Object.prototype.propertyIsEnumerable,wa=(r,t,s)=>t in r?Vd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Hs=(r,t)=>{for(var s in t||(t={}))Wd.call(t,s)&&wa(r,s,t[s]);if(ja)for(var s of ja(t))Gd.call(t,s)&&wa(r,s,t[s]);return r};const Kd=(r,t,s)=>Hs(Hs(Hs({},Ni(r,t)),Ci()),Si(r,t));var Qd=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Yd=r=>({lastGeneratedCode:null,generatedCodes:[],generateBatchCode:(t,s)=>Qd(null,null,function*(){const n=s===1,a=new Date,i=a.toISOString().slice(0,10).replace(/-/g,""),c=a.toISOString().slice(11,17).replace(/:/g,""),o=Math.random().toString(36).substring(2,5).toUpperCase(),l=`${i}-${c}-${o}`,d={code:l,generatedAt:a,operator:t,toolCount:s,isSingleTool:n};return r(p=>({lastGeneratedCode:d,generatedCodes:[...p.generatedCodes,d]})),l}),validateBatchCode:t=>/^\d{8}-\d{4}-[A-Z0-9]{3}$/.test(t),getBatchByCode:(t,s)=>s.find(n=>n.batchCode===t)||null});var Jd=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class Xd{static generateBatchCode(t,s){return Jd(this,null,function*(){try{const n=new Date().toISOString().slice(0,10).replace(/-/g,""),a=t.slice(0,3).toUpperCase(),i=s.toString().padStart(2,"0");return{batchCode:`${a}${n}${i}`,success:!0}}catch(n){return{batchCode:"",success:!1,error:n instanceof Error?n.message:"Unknown error"}}})}}var Zd=Object.defineProperty,eu=Object.defineProperties,tu=Object.getOwnPropertyDescriptors,Na=Object.getOwnPropertySymbols,su=Object.prototype.hasOwnProperty,ru=Object.prototype.propertyIsEnumerable,Ca=(r,t,s)=>t in r?Zd(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Bt=(r,t)=>{for(var s in t||(t={}))su.call(t,s)&&Ca(r,s,t[s]);if(Na)for(var s of Na(t))ru.call(t,s)&&Ca(r,s,t[s]);return r},Ft=(r,t)=>eu(r,tu(t)),Sa=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const au=(r,t)=>({currentBatch:null,batches:[],batchHistory:[],batchLoading:!1,createBatch:(s,n)=>Sa(null,null,function*(){r({batchLoading:!0});try{const a=`batch_${Date.now()}`,i={id:a,batchCode:"",createdAt:new Date,createdBy:s,status:"creating",tools:[],packageInfo:{packageType:"",packageSize:""},sterilizationInfo:{},facility_id:"default-facility",auditTrail:[{id:`audit_${Date.now()}`,timestamp:new Date,action:"created",operator:s,details:`Batch created in ${n?"batch":"single tool"} mode`}]};return r(c=>({currentBatch:i,batches:[...c.batches,i],batchLoading:!1})),a}catch(a){throw r({batchLoading:!1}),a}}),addToolToBatch:s=>{const{currentBatch:n}=t();if(n&&!n.tools.includes(s)){const a=Ft(Bt({},n),{tools:[...n.tools,s],auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_added",operator:n.createdBy,details:`Tool ${s} added to batch`,metadata:{toolId:s}}]});r(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))}},removeToolFromBatch:s=>{const{currentBatch:n}=t();if(!n)return;const a=Ft(Bt({},n),{tools:n.tools.filter(i=>i!==s),auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_removed",operator:n.createdBy,details:`Tool ${s} removed from batch`,metadata:{toolId:s}}]});r(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))},finalizeBatch:s=>Sa(null,null,function*(){const{currentBatch:n}=t();if(!n)throw new Error("No current batch to finalize");r({batchLoading:!0});try{const a=yield Xd.generateBatchCode(n.createdBy,n.tools.length);if(!a.success)throw new Error(a.error||"Failed to generate batch code");const i=a.batchCode,c=Ft(Bt({},n),{batchCode:i,status:"ready",packageInfo:s,auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"ready_for_autoclave",operator:n.createdBy,details:`Batch finalized with code ${i}`,metadata:{batchCode:i,packageInfo:s}}]});r(o=>({currentBatch:c,batches:o.batches.map(l=>l.id===n.id?c:l),batchHistory:[...o.batchHistory,c],batchLoading:!1}))}catch(a){throw r({batchLoading:!1}),a}}),updateBatchStatus:(s,n)=>{r(a=>{var i;return{batches:a.batches.map(c=>c.id===s?Ft(Bt({},c),{status:n,auditTrail:[...c.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:n==="in_autoclave"?"autoclave_started":n==="completed"?"autoclave_completed":"tool_added",operator:c.createdBy,details:`Batch status updated to ${n}`,metadata:{status:n}}]}):c),currentBatch:((i=a.currentBatch)==null?void 0:i.id)===s?Ft(Bt({},a.currentBatch),{status:n}):a.currentBatch}})},getBatchById:s=>{const{batches:n,batchHistory:a}=t();return[...n,...a].find(i=>i.id===s)||null},getBatchesByStatus:s=>{const{batches:n,batchHistory:a}=t();return[...n,...a].filter(i=>i.status===s)},clearCurrentBatch:()=>r({currentBatch:null}),setBatchLoading:s=>r({batchLoading:s})});var nu=Object.defineProperty,_a=Object.getOwnPropertySymbols,lu=Object.prototype.hasOwnProperty,iu=Object.prototype.propertyIsEnumerable,Ta=(r,t,s)=>t in r?nu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Vs=(r,t)=>{for(var s in t||(t={}))lu.call(t,s)&&Ta(r,s,t[s]);if(_a)for(var s of _a(t))iu.call(t,s)&&Ta(r,s,t[s]);return r};const ou=(r,t)=>({currentSession:null,startPackagingSession:(s,n)=>{const a={id:crypto.randomUUID(),operatorName:s,facilityId:n,scannedTools:[],startedAt:new Date().toISOString()};r({currentSession:a})},addToolToSession:s=>{const n=t().currentSession;n&&(n.scannedTools.includes(s)||(n.scannedTools.push(s),r({currentSession:Vs({},n)})))},removeToolFromSession:s=>{const n=t().currentSession;n&&(n.scannedTools=n.scannedTools.filter(a=>a!==s),r({currentSession:Vs({},n)}))},generateBatchId:()=>`PKG-${Math.floor(1e3+Math.random()*9e3)}`,assignBatchIdToSession:s=>{const n=t().currentSession;n&&(n.currentBatchId=s,r({currentSession:Vs({},n)}))},endPackagingSession:()=>{r({currentSession:null})},resetPackagingSession:()=>{r({currentSession:null})}});var cu=Object.defineProperty,du=Object.defineProperties,uu=Object.getOwnPropertyDescriptors,ka=Object.getOwnPropertySymbols,mu=Object.prototype.hasOwnProperty,pu=Object.prototype.propertyIsEnumerable,Ia=(r,t,s)=>t in r?cu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Mt=(r,t)=>{for(var s in t||(t={}))mu.call(t,s)&&Ia(r,s,t[s]);if(ka)for(var s of ka(t))pu.call(t,s)&&Ia(r,s,t[s]);return r},Ws=(r,t)=>du(r,uu(t));const Pa={gravity:{name:"Gravity",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35},prevacuum:{name:"Pre-vacuum",temperature:132,pressure:30,sterilizeTime:4,dryTime:15,totalTime:19},flash:{name:"Flash",temperature:132,pressure:30,sterilizeTime:3,dryTime:0,totalTime:3},custom:{name:"Custom",temperature:121,pressure:15,sterilizeTime:15,dryTime:20,totalTime:35}},xu={autoclaveHasPrinter:!1,receiptRetentionMonths:12},hu=r=>({cycleSettings:Pa,defaultCycleType:"gravity",allowCustomCycles:!1,autoclaveReceiptSettings:xu,updateCycleSettings:(t,s)=>{r(n=>({cycleSettings:Ws(Mt({},n.cycleSettings),{[t]:Mt(Mt({},n.cycleSettings[t]),s)})}))},setDefaultCycleType:t=>{r({defaultCycleType:t})},setAllowCustomCycles:t=>{r({allowCustomCycles:t})},setAutoclaveHasPrinter:t=>{r(s=>({autoclaveReceiptSettings:Ws(Mt({},s.autoclaveReceiptSettings),{autoclaveHasPrinter:t})}))},setReceiptRetentionMonths:t=>{r(s=>({autoclaveReceiptSettings:Ws(Mt({},s.autoclaveReceiptSettings),{receiptRetentionMonths:t})}))},resetCycleSettings:()=>{r({cycleSettings:Pa,defaultCycleType:"gravity",allowCustomCycles:!1})}});var fe=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const gu=r=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,setBiTestCompleted:t=>r({biTestCompleted:t}),setBiTestDate:t=>r({biTestDate:t}),recordBITestResult:()=>fe(null,null,function*(){}),debugCheck:()=>{console.log("ðŸ”¬ biTestSlice is being used!")},setNextBITestDue:t=>r({nextBITestDue:t}),setLastBITestDate:t=>r({lastBITestDate:t}),setBiTestPassed:t=>r({biTestPassed:t}),setBiTestOptedOut:t=>r({biTestOptedOut:t}),setBiTestInProgress:t=>r({biTestInProgress:t}),resetBIState:()=>r({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1}),activateBIFailure:()=>fe(null,null,function*(){}),deactivateBIFailure:()=>fe(null,null,function*(){}),updateBIFailureStatus:()=>fe(null,null,function*(){}),resolveBIFailure:()=>fe(null,null,function*(){}),getBIFailureHistory:()=>fe(null,null,function*(){}),addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>fe(null,null,function*(){}),setEnforceBI:()=>fe(null,null,function*(){}),setEnforceCI:()=>fe(null,null,function*(){}),setAllowOverrides:()=>fe(null,null,function*(){}),toggleEnforceBI:()=>fe(null,null,function*(){}),toggleEnforceCI:()=>fe(null,null,function*(){}),loadComplianceSettings:()=>fe(null,null,function*(){}),syncWithSupabase:()=>fe(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>fe(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})});var fu=Object.defineProperty,bu=Object.defineProperties,yu=Object.getOwnPropertyDescriptors,Da=Object.getOwnPropertySymbols,vu=Object.prototype.hasOwnProperty,ju=Object.prototype.propertyIsEnumerable,Ea=(r,t,s)=>t in r?fu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Oa=(r,t)=>{for(var s in t||(t={}))vu.call(t,s)&&Ea(r,s,t[s]);if(Da)for(var s of Da(t))ju.call(t,s)&&Ea(r,s,t[s]);return r},$a=(r,t)=>bu(r,yu(t)),be=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const wu=(r,t)=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,biFailureActive:!1,biFailureDetails:null,biFailureHistory:[],biFailureLoading:!1,biFailureError:null,activityLog:[],activityLogLoading:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,complianceSettingsLoading:!1,isSyncing:!1,lastSyncTime:null,syncError:null,pendingChanges:[],optimisticUpdates:new Map,activateBIFailure:s=>be(null,null,function*(){r({biFailureLoading:!0,biFailureError:null});try{const n={id:`bi-failure-${Date.now()}`,incident_number:`BI-${Date.now()}`,failure_date:new Date().toISOString(),affected_tools_count:s.affectedToolsCount,affected_batch_ids:s.affectedBatchIds,failure_reason:s.failureReason,severity_level:s.severity||"medium",status:"active",detected_by_operator_id:s.operator,regulatory_notification_sent:!1,regulatory_notification_date:void 0,facility_id:"default-facility",regulatory_notification_required:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};r({biFailureActive:!0,biFailureDetails:n,biFailureHistory:[...t().biFailureHistory,n],biFailureLoading:!1})}catch(n){r({biFailureError:n instanceof Error?n.message:"Failed to activate BI failure",biFailureLoading:!1})}}),deactivateBIFailure:()=>be(null,null,function*(){r({biFailureLoading:!0});try{r({biFailureActive:!1,biFailureDetails:null,biFailureLoading:!1})}catch(s){r({biFailureError:s instanceof Error?s.message:"Failed to deactivate BI failure",biFailureLoading:!1})}}),updateBIFailureStatus:s=>be(null,null,function*(){r({biFailureLoading:!0});try{const n=t().biFailureDetails;if(n){const a=$a(Oa({},n),{status:s,updated_at:new Date().toISOString()});r({biFailureDetails:a,biFailureActive:s==="active",biFailureLoading:!1})}}catch(n){r({biFailureError:n instanceof Error?n.message:"Failed to update BI failure status",biFailureLoading:!1})}}),resolveBIFailure:()=>be(null,null,function*(){r({biFailureLoading:!0});try{const s=t().biFailureDetails;if(s){const n=$a(Oa({},s),{status:"resolved",updated_at:new Date().toISOString()});r({biFailureDetails:n,biFailureActive:!1,biFailureLoading:!1})}}catch(s){r({biFailureError:s instanceof Error?s.message:"Failed to resolve BI failure",biFailureLoading:!1})}}),getBIFailureHistory:()=>be(null,null,function*(){r({biFailureLoading:!0});try{r({biFailureLoading:!1})}catch(s){r({biFailureError:s instanceof Error?s.message:"Failed to get BI failure history",biFailureLoading:!1})}}),setBiTestCompleted:()=>{},setBiTestDate:()=>{},recordBITestResult:()=>be(null,null,function*(){}),setNextBITestDue:()=>{},setLastBITestDate:()=>{},setBiTestPassed:()=>{},setBiTestOptedOut:()=>{},setBiTestInProgress:()=>{},resetBIState:()=>{},addActivity:()=>{},clearActivityLog:()=>{},loadActivityLog:()=>be(null,null,function*(){}),setEnforceBI:()=>be(null,null,function*(){}),setEnforceCI:()=>be(null,null,function*(){}),setAllowOverrides:()=>be(null,null,function*(){}),toggleEnforceBI:()=>be(null,null,function*(){}),toggleEnforceCI:()=>be(null,null,function*(){}),loadComplianceSettings:()=>be(null,null,function*(){}),syncWithSupabase:()=>be(null,null,function*(){}),syncBIFailureFromDatabase:()=>{},addPendingChange:()=>{},clearPendingChanges:()=>{},retryFailedSync:()=>be(null,null,function*(){}),addOptimisticUpdate:()=>{},removeOptimisticUpdate:()=>{},clearOptimisticUpdates:()=>{},saveStateToLocalStorage:()=>{},loadStateFromLocalStorage:()=>{},clearLocalStorage:()=>{},getBIComplianceStatus:()=>({isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"}),getBIFailureRiskLevel:()=>"low",getActivitySummary:()=>({totalActivities:0,recentActivities:0,biTestCount:0,failureCount:0})}),Nu=r=>{const{biTestPassed:t,nextBITestDue:s,biTestOptedOut:n,enforceBI:a}=r;if(!a||n)return{isCompliant:!0,nextTestDue:null,daysUntilDue:0,status:"compliant"};const i=new Date,c=s?Math.ceil((s.getTime()-i.getTime())/(1e3*60*60*24)):0;let o;return t?c<0?o="overdue":c<=3?o="due-soon":o="compliant":o="failed",{isCompliant:o==="compliant",nextTestDue:s,daysUntilDue:c,status:o}},Cu=r=>{const{biFailureDetails:t}=r;return t&&t.severity_level||"low"},Su=r=>{const{activityLog:t}=r,s=new Date,n=new Date(s.getTime()-1440*60*1e3),a=t.filter(o=>o.time>n).length,i=t.filter(o=>o.type==="bi-test").length,c=t.filter(o=>o.type==="bi-failure").length;return{totalActivities:t.length,recentActivities:a,biTestCount:i,failureCount:c}};var _u=Object.defineProperty,Tu=Object.defineProperties,ku=Object.getOwnPropertyDescriptors,Cs=Object.getOwnPropertySymbols,_i=Object.prototype.hasOwnProperty,Ti=Object.prototype.propertyIsEnumerable,Aa=(r,t,s)=>t in r?_u(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,st=(r,t)=>{for(var s in t||(t={}))_i.call(t,s)&&Aa(r,s,t[s]);if(Cs)for(var s of Cs(t))Ti.call(t,s)&&Aa(r,s,t[s]);return r},ht=(r,t)=>Tu(r,ku(t)),Iu=(r,t)=>{var s={};for(var n in r)_i.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&Cs)for(var n of Cs(r))t.indexOf(n)<0&&Ti.call(r,n)&&(s[n]=r[n]);return s},Oe=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Pu=(r,t,s)=>ht(st(st({},(()=>{const a=gu(r),{recordBITestResult:i}=a;return Iu(a,["recordBITestResult"])})()),wu(r,t)),{addActivity:n=>{const a=ht(st({},n),{id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});r(i=>({activityLog:[a,...i.activityLog].slice(0,50)}))},clearActivityLog:()=>r({activityLog:[]}),loadActivityLog:()=>Oe(null,null,function*(){r({activityLogLoading:!0});try{const n=yield Ct.getCurrentFacilityId();if(!n)throw new Error("No facility ID available");const{data:a,error:i}=yield Q.from("bi_activity_log").select("*").eq("facility_id",n).order("created_at",{ascending:!1}).limit(100);if(i)throw i;const c=(a||[]).map(o=>({id:o.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:o.type||"general",title:o.title||"Activity",time:new Date(o.created_at||new Date().toISOString()),color:o.color||"blue",description:(o.data&&typeof o.data=="object"&&"description"in o.data?o.data.description:"")||"",metadata:o.metadata||{}}));r({activityLog:c,activityLogLoading:!1})}catch(n){console.error("Failed to load activity log:",n),r({activityLogLoading:!1,syncError:"Failed to load activity log"})}}),setEnforceBI:n=>Oe(null,null,function*(){r({enforceBI:n}),t().addPendingChange({type:"settings",data:{enforceBI:n}}),yield t().syncWithSupabase()}),setEnforceCI:n=>Oe(null,null,function*(){r({enforceCI:n}),t().addPendingChange({type:"settings",data:{enforceCI:n}}),yield t().syncWithSupabase()}),setAllowOverrides:n=>Oe(null,null,function*(){r({allowOverrides:n}),t().addPendingChange({type:"settings",data:{allowOverrides:n}}),yield t().syncWithSupabase()}),toggleEnforceBI:()=>Oe(null,null,function*(){const{enforceBI:n}=t();yield t().setEnforceBI(!n)}),toggleEnforceCI:()=>Oe(null,null,function*(){const{enforceCI:n}=t();yield t().setEnforceCI(!n)}),loadComplianceSettings:()=>Oe(null,null,function*(){var n,a,i,c;r({complianceSettingsLoading:!0});try{const o=yield Ct.getCurrentFacilityId();if(!o)throw new Error("No facility ID available");const{data:l,error:d}=yield Q.from("facilities").select("settings").eq("id",o).single();if(d&&d.code!=="PGRST116")throw d;const p=(n=l==null?void 0:l.settings)!=null?n:{},m=(a=p.enforce_bi)!=null?a:!1,x=(i=p.enforce_ci)!=null?i:!1,f=(c=p.allow_overrides)!=null?c:!1;r({enforceBI:!!m,enforceCI:!!x,allowOverrides:!!f,complianceSettingsLoading:!1})}catch(o){console.error("Failed to load compliance settings:",o),r({complianceSettingsLoading:!1,syncError:"Failed to load compliance settings"})}}),syncWithSupabase:()=>Oe(null,null,function*(){r({isSyncing:!0,syncError:null});try{const n=yield Ct.getCurrentFacilityId();if(!n)throw new Error("No facility ID available");const{pendingChanges:a}=t();for(const i of a)try{switch(i.type){case"bi-test":i.data&&typeof i.data=="object"&&(yield $o.createBITestResult(ht(st({},i.data),{facility_id:n,result:"pass"})));break;case"bi-failure":i.data&&typeof i.data=="object"&&(yield hs.createIncident(ht(st({},i.data),{facility_id:n,affected_tools_count:0,affected_batch_ids:[]})));break;case"settings":if(i.data&&typeof i.data=="object"){const c=i.data,{data:o,error:l}=yield Q.from("facilities").select("settings").eq("id",n).single();if(l)throw l;const d=(o==null?void 0:o.settings)||{},p=ht(st({},d),{enforce_bi:c.enforceBI,enforce_ci:c.enforceCI,allow_overrides:c.allowOverrides}),{error:m}=yield Q.from("facilities").update({settings:p,updated_at:new Date().toISOString()}).eq("id",n);if(m)throw m}break}}catch(c){console.error(`Failed to sync ${i.type}:`,c)}r({isSyncing:!1,lastSyncTime:new Date,pendingChanges:[]})}catch(n){console.error("Sync failed:",n),r({isSyncing:!1,syncError:"Sync failed"})}}),syncBIFailureFromDatabase:n=>{const a=n;r({biFailureActive:a.status==="active",biFailureDetails:a.status==="active"?{id:a.id,incident_number:a.incident_number,failure_date:a.failure_date,affected_tools_count:a.affected_tools_count,affected_batch_ids:a.affected_batch_ids,failure_reason:a.failure_reason,severity_level:a.severity_level,status:a.status,detected_by_operator_id:a.detected_by_operator_id,regulatory_notification_sent:a.regulatory_notification_sent||!1,regulatory_notification_date:a.regulatory_notification_date,facility_id:a.facility_id||"",regulatory_notification_required:a.regulatory_notification_required||!1,created_at:a.created_at||new Date().toISOString(),updated_at:a.updated_at||new Date().toISOString()}:null})},addPendingChange:n=>{r(a=>({pendingChanges:[...a.pendingChanges,ht(st({},n),{id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date})]}))},clearPendingChanges:()=>r({pendingChanges:[]}),retryFailedSync:()=>Oe(null,null,function*(){yield t().syncWithSupabase()}),addOptimisticUpdate:(n,a)=>{const{optimisticUpdates:i}=t();i.set(n,a),r({optimisticUpdates:new Map(i)})},removeOptimisticUpdate:n=>{const{optimisticUpdates:a}=t();a.delete(n),r({optimisticUpdates:new Map(a)})},clearOptimisticUpdates:()=>r({optimisticUpdates:new Map}),saveStateToLocalStorage:()=>{const n=t(),a={biTestCompleted:n.biTestCompleted,biTestDate:n.biTestDate,biTestResults:n.biTestResults,nextBITestDue:n.nextBITestDue,lastBITestDate:n.lastBITestDate,biTestPassed:n.biTestPassed,biTestOptedOut:n.biTestOptedOut,enforceBI:n.enforceBI,enforceCI:n.enforceCI,allowOverrides:n.allowOverrides,lastSyncTime:n.lastSyncTime};try{localStorage.setItem("biWorkflowState",JSON.stringify(a))}catch(i){console.error(i)}},loadStateFromLocalStorage:()=>{try{const n=localStorage.getItem("biWorkflowState");if(n){const a=JSON.parse(n);r({biTestCompleted:a.biTestCompleted||!1,biTestDate:a.biTestDate||null,biTestResults:a.biTestResults||[],nextBITestDue:a.nextBITestDue?new Date(a.nextBITestDue):null,lastBITestDate:a.lastBITestDate||null,biTestPassed:a.biTestPassed||!1,biTestOptedOut:a.biTestOptedOut||!1,enforceBI:a.enforceBI!==void 0?a.enforceBI:!0,enforceCI:a.enforceCI!==void 0?a.enforceCI:!0,allowOverrides:a.allowOverrides||!1,lastSyncTime:a.lastSyncTime?new Date(a.lastSyncTime):null})}}catch(n){console.error(n)}},clearLocalStorage:()=>{try{localStorage.removeItem("biWorkflowState")}catch(n){console.error(n)}},getBIComplianceStatus:()=>Nu(t()),getBIFailureRiskLevel:()=>Cu(t()),getActivitySummary:()=>Su(t())});var Du=Object.defineProperty,Ra=Object.getOwnPropertySymbols,Eu=Object.prototype.hasOwnProperty,Ou=Object.prototype.propertyIsEnumerable,Ba=(r,t,s)=>t in r?Du(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,we=(r,t)=>{for(var s in t||(t={}))Eu.call(t,s)&&Ba(r,s,t[s]);if(Ra)for(var s of Ra(t))Ou.call(t,s)&&Ba(r,s,t[s]);return r};const G=Ee()((...r)=>we(we(we(we(we(we(we(we(we(we(we(we(we({},Zc(...r)),ed(...r)),Rd(...r)),Bd(...r)),Kd(...r)),Si(...r)),Yd(...r)),au(...r)),Ni(...r)),Ci(...r)),ou(...r)),hu(...r)),Pu(...r)));var Tr=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Fa=(r,t)=>{const s=document.createElement("div");if(s.className=`
    fixed top-4 right-4 z-[10000] bg-white border-l-4 border-green-500 
    shadow-lg rounded-lg p-4 max-w-md transform transition-all duration-300 
    animate-slide-in-right
  `,s.style.cssText=`
    animation: slideInRight 0.3s ease-out;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  `,s.innerHTML=`
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div class="ml-3 flex-1">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-gray-800">${r}</h3>
          <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="ml-2 text-gray-400 hover:text-gray-600">
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
        <p class="mt-1 text-sm text-gray-600">${t}</p>
      </div>
    </div>
  `,!document.getElementById("cliniio-notification-styles")){const n=document.createElement("style");n.id="cliniio-notification-styles",n.textContent=`
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(n)}document.body.appendChild(s),setTimeout(()=>{s.parentElement&&(s.style.transform="translateX(100%)",s.style.opacity="0",setTimeout(()=>{s.parentElement&&s.remove()},300))},5e3)},Ma=()=>Tr(null,null,function*(){try{const{SupabaseAuthService:r}=yield qe(()=>import("./services-CE_LtFqr.js").then(a=>a.aD),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{user:t,error:s}=yield r.getCurrentUser();if(s&&console.warn("Auth service error:",s),t!=null&&t.id)return t.id;const n=sessionStorage.getItem("currentOperatorId")||localStorage.getItem("currentOperatorId");if(n)return n;throw console.error("No operator ID found in production. User may not be authenticated."),new Error("User not authenticated - no operator ID available")}catch(r){throw console.error("Failed to get operator ID:",r),new Error("Authentication required - unable to get operator ID")}}),$u=({onClose:r,onSuccess:t})=>{const{biFailureDetails:s,deactivateBIFailure:n}=G(),[a,i]=u.useState(!1),[c,o]=u.useState(null),[l,d]=u.useState(!1),[p,m]=u.useState(""),x=u.useCallback(()=>Tr(null,null,function*(){i(!0),o(null);try{const w=yield Ma();if(!s)throw new Error("No BI failure incident to resolve");const T=sessionStorage.getItem("currentBIFailureIncidentId");if(T){const k=yield hs.resolveIncident({incidentId:T,resolvedByOperatorId:w,resolutionNotes:p});console.log("âœ… BI Failure Resolution completed:",{incidentId:T,resolvedByOperatorId:w,resolutionNotes:p,timestamp:new Date().toISOString()}),Fa("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const S=G.getState();S.loadBITestResults&&(S.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("ðŸ”„ Refreshed BI test results after incident resolution"))},1e3)}else{const k="550e8400-e29b-41d4-a716-446655440000",{data:S,error:I}=yield Q.from("bi_failure_incidents").insert({facility_id:k,user_id:w,incident_type:"bi_test_failure",severity:"high",status:"open",description:"BI Test Failure - Contamination Detected",failure_reason:"Biological indicator test failed, indicating sterilization failure",metadata:{affected_tools_count:(s==null?void 0:s.affected_tools_count)||1,affected_batch_ids:(s==null?void 0:s.affected_batch_ids)||["DEFAULT-BATCH"]}}).select().single();if(I)throw new Error(`Failed to create incident: ${I.message}`);const D=yield hs.resolveIncident({incidentId:S.id,resolvedByOperatorId:w,resolutionNotes:p}),O=G.getState();O.addActivity&&O.addActivity({id:`bi-incident-resolved-${S.id}`,type:"bi-failure",title:"BI Failure Incident Resolved",time:new Date,toolCount:(s==null?void 0:s.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:S.id,operatorId:w,resolutionNotes:p}}),Fa("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const A=G.getState();A.loadBITestResults&&(A.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("ðŸ”„ Refreshed BI test results after incident resolution"))},1e3),console.log("âœ… BI Failure Resolution completed:",{incidentId:S.id,resolvedByOperatorId:w,resolutionNotes:p,timestamp:new Date().toISOString()}),sessionStorage.setItem("currentBIFailureIncidentId",S.id)}n(),t(),r()}catch(w){if(console.error("Failed to resolve BI failure incident:",w),w instanceof Hr)o({message:w.message,code:w.code,severity:w.severity,retryable:w.retryable});else if(w&&typeof w=="object"&&"name"in w&&w.name==="BIFailureError"&&"message"in w&&"code"in w&&"severity"in w&&"retryable"in w){const T=w;o({message:T.message,code:T.code,severity:T.severity,retryable:T.retryable})}else o({message:w instanceof Error?w.message:"An unexpected error occurred",severity:"high",retryable:!1})}finally{i(!1)}}),[p,n,t,r,s]),f=u.useCallback(w=>Tr(null,null,function*(){i(!0),o(null);try{const T=yield Ma(),k={facility_id:w.facilityId,detected_by_operator_id:T,affected_tools_count:w.affected_tools_count,affected_batch_ids:w.affectedBatchIds,failure_reason:w.failureReason,severity_level:w.severityLevel||"high"};return yield hs.createIncident(k)}catch(T){throw console.error("Failed to create BI failure incident:",T),T instanceof Hr?o({message:T.message,code:T.code,severity:T.severity,retryable:T.retryable}):o({message:T instanceof Error?T.message:"Failed to create incident",severity:"high",retryable:!1}),T}finally{i(!1)}}),[]),g=u.useCallback(()=>{o(null),x()},[x]),v=u.useCallback(()=>{o(null),d(!1),r()},[r]),j=u.useCallback(w=>{w.target===w.currentTarget&&v()},[v]),h=u.useCallback(w=>{w.key==="Escape"&&v()},[v]),y=u.useCallback(()=>{d(w=>!w)},[]),b=u.useCallback(w=>{m(w)},[]),_=u.useCallback(()=>"mdiAlertCircle",[]),E=u.useCallback(w=>{switch(w){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},[]),$=u.useCallback(()=>a||!s,[a,s]),P=u.useCallback(()=>a?"Resolving...":"Confirm Resolution",[a]);return{isLoading:a,error:c,showExposureReport:l,resolutionNotes:p,biFailureDetails:s,handleResolve:x,createIncident:f,handleRetry:g,handleClose:v,handleBackdropClick:j,handleKeyDown:h,toggleExposureReport:y,updateResolutionNotes:b,getErrorIcon:_,getErrorColor:E,isResolveButtonDisabled:$,getResolveButtonText:P}},Au=({isSubmitting:r,onClose:t,onMinimize:s})=>{const n=()=>{r||t()},a=i=>{i.key==="Enter"&&!r&&n()};return e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{path:ut,size:1.5,className:"text-red-500"}),e.jsxs("div",{children:[e.jsx("h2",{id:"bi-failure-modal-title",className:"text-xl font-semibold text-gray-900",children:"BI Failure Resolution Workflow"}),e.jsx("p",{id:"bi-failure-modal-description",className:"text-sm text-gray-600",children:"Complete these steps to resolve the BI failure"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx("button",{onClick:s,disabled:r,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${r?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Minimize workflow to banner",title:"Minimize to continue working on other tasks",children:e.jsx(C,{path:ai,size:1.2})}),e.jsx("button",{onClick:n,onKeyDown:a,disabled:r,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${r?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Close modal","aria-describedby":"bi-failure-modal-description",children:e.jsx(C,{path:ae,size:1.2})})]})]})},Br=()=>{const{biTestResults:r,cycles:t,currentCycle:s,availableTools:n}=G();return u.useMemo(()=>{if(!r||!Array.isArray(r))return{lastPassedDate:null,affectedCycles:[],affectedTools:[],totalToolsAffected:0,totalCyclesAffected:0,totalSterilizationEvents:0,toolsUsedMultipleTimes:0,uniqueOperators:[],dateRange:null,toolsByCategory:{},hasCurrentCycleAffected:!1};const a=r.filter(b=>b.passed).sort((b,_)=>new Date(_.date).getTime()-new Date(b.date).getTime())[0],i=a?new Date(a.date):null,c=s?[...t,s]:t,o=i?c.filter(b=>new Date(b.startTime)>i):c,l=o.flatMap(b=>b.tools.map(_=>_)),d=new Map;l.forEach(b=>{d.set(b,(d.get(b)||0)+1)});const m=Array.from(d.keys()).map(b=>n.find(E=>E.id===b)||{id:b,name:`Tool ${b}`,barcode:b,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:void 0,status:"available"}),x=m.length,f=o.length,g=l.length,v=m.filter(b=>(d.get(b.id)||0)>1).length,j=[...new Set(o.map(b=>b.operator).filter(b=>typeof b=="string"))],h=o.length>0?{start:new Date(Math.min(...o.map(b=>new Date(b.startTime).getTime()))),end:new Date(Math.max(...o.map(b=>new Date(b.startTime).getTime())))}:null,y=m.reduce((b,_)=>{const E=_.category||"Unknown";return b[E]=(b[E]||0)+1,b},{});return{lastPassedDate:i,affectedCycles:o,affectedTools:m,totalToolsAffected:x,totalCyclesAffected:f,totalSterilizationEvents:g,toolsUsedMultipleTimes:v,uniqueOperators:j,dateRange:h,toolsByCategory:y,hasCurrentCycleAffected:!!(s&&(!i||new Date(s.startTime)>i))}},[r,t,s,n])},Ru=({biFailureDetails:r})=>{var t,s,n,a,i;const c=Br();return c.affectedCycles&&c.affectedCycles.map(o=>o.batchId).filter(o=>!!o),r?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4 p-3 bg-white rounded-lg border border-red-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:Me,size:1,className:"text-red-500 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Cycles"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:c.totalCyclesAffected})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:dt,size:1,className:"text-red-500 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Batches"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:((t=r.affectedBatchIds)==null?void 0:t.length)||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:Be,size:1,className:"text-red-500 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Tools"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:r.affectedToolsCount||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx(C,{path:Ho,size:1,className:"text-red-600 mr-1"}),e.jsx("span",{className:"text-xs font-medium text-red-700",children:"Multi-Use"})]}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:c.toolsUsedMultipleTimes})]})]}),e.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Be,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Affected Tools:"})," ",r.affectedToolsCount||0," tools are currently quarantined"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Me,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Failure Date:"})," ",r.date?r.date.toLocaleDateString():"Unknown date"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Me,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Risk Window:"})," ",c.dateRange?e.jsxs("span",{className:"font-mono text-xs",children:[c.dateRange.start.toLocaleDateString()," â†’"," ",c.dateRange.end.toLocaleDateString()]}):"All cycles (no previous passed BI test)"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:dt,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Affected Batches:"})," ",(((s=r.affectedBatchIds)==null?void 0:s.length)||0)>0?e.jsxs("span",{className:"font-mono text-xs",children:[(n=r.affectedBatchIds)==null?void 0:n.slice(0,3).join(", "),(((a=r.affectedBatchIds)==null?void 0:a.length)||0)>3&&` +${(((i=r.affectedBatchIds)==null?void 0:i.length)||0)-3} more`]}):"No batch IDs available"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Be,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Operator:"})," ",r.operator]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:Be,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tools by Category:"})," ",e.jsx("span",{className:"text-xs",children:c.toolsByCategory?Object.entries(c.toolsByCategory).map(([o,l])=>`${o}: ${l}`).join(", "):"No tools categorized"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:ce,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Contamination Scope:"})," ",c.totalSterilizationEvents," total sterilization events in risk window."," ",c.toolsUsedMultipleTimes>0&&e.jsxs("span",{className:"text-red-600 font-medium",children:[c.toolsUsedMultipleTimes," tools used multiple times (require extra attention)"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{path:ce,size:.8,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Detected By:"})," ",r.operator," â€¢"," ",e.jsx("strong",{children:"Date:"})," ",(()=>{try{return r.date?r.date instanceof Date?r.date.toLocaleDateString():new Date(r.date).toLocaleDateString():"Unknown date"}catch(o){return console.error("Date formatting error:",o),"Invalid date"}})()]})]})]})]}):e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),e.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Affected Tools:"})," 0 tools are currently quarantined"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Failure Date:"})," Unknown date"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Affected Batches:"})," No batch IDs available"]})]})]})};var Bu=Object.defineProperty,Fu=Object.defineProperties,Mu=Object.getOwnPropertyDescriptors,La=Object.getOwnPropertySymbols,Lu=Object.prototype.hasOwnProperty,zu=Object.prototype.propertyIsEnumerable,za=(r,t,s)=>t in r?Bu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ua=(r,t)=>{for(var s in t||(t={}))Lu.call(t,s)&&za(r,s,t[s]);if(La)for(var s of La(t))zu.call(t,s)&&za(r,s,t[s]);return r},qa=(r,t)=>Fu(r,Mu(t)),Uu=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const qu=({onToggleExposureReport:r})=>{const{currentUser:t,initializeUserContext:s}=He();u.useEffect(()=>{t||s()},[t,s]);const[n,a]=u.useState([]),[i,c]=u.useState(!1),[o,l]=u.useState(null);u.useEffect(()=>{const j=()=>{c(!0);const y=sessionStorage.getItem("biFailureWorkflowState");if(y)try{const b=JSON.parse(y);a(b),console.log("ðŸ“‹ Restored workflow state from session storage")}catch(b){console.error("Failed to parse saved workflow state:",b),h()}else h();c(!1)},h=()=>{a([{step_id:"quarantine",status:"in_progress"},{step_id:"re-sterilization",status:"pending"},{step_id:"new-bi-test",status:"pending"},{step_id:"documentation",status:"pending"}])};j()},[]);const d=j=>Uu(null,null,function*(){if(!t){console.error("No current user available - currentUser:",t);return}const h=t.id||t.email||"unknown-user",y=n.findIndex(b=>b.step_id===j);if(y===-1){console.error(`Step ${j} not found`);return}try{const b=[...n];b[y]=qa(Ua({},b[y]),{status:"completed",completed_by_user_id:h,completed_at:new Date().toISOString(),notes:`Completed by ${t.email}`}),y+1<b.length&&(b[y+1]=qa(Ua({},b[y+1]),{status:"in_progress"})),a(b),sessionStorage.setItem("biFailureWorkflowState",JSON.stringify(b)),console.log(`âœ… Step ${j} completed by ${t.email||"unknown user"}`)}catch(b){console.error(`Failed to complete step ${j}:`,b),l(`Failed to complete step: ${b instanceof Error?b.message:"Unknown error"}`)}}),p=j=>{const h=n.find(y=>y.step_id===j);return(h==null?void 0:h.status)||"pending"},m=j=>{const h=n.find(y=>y.step_id===j);return(h==null?void 0:h.status)==="in_progress"},x=j=>{const h=n.find(y=>y.step_id===j);return{completedBy:h==null?void 0:h.completed_by_user_id,completedAt:h==null?void 0:h.completed_at,notes:h==null?void 0:h.notes}},f=[{id:"quarantine",title:"Quarantine All Affected Tools",description:"Ensure all tools from affected batches are properly quarantined",icon:dt,isInteractive:!0},{id:"re-sterilization",title:"Re-sterilize All Quarantined Tools",description:"Re-sterilize all affected tools using proper protocols",icon:Gr,isInteractive:!0},{id:"new-bi-test",title:"Perform New BI Test",description:"Conduct a new biological indicator test to verify sterilization",icon:Gr,isInteractive:!0},{id:"documentation",title:"Complete Documentation",description:"Document all actions taken and results obtained",icon:Pt,isInteractive:!0}],g=j=>{switch(j){case"completed":return"text-green-600 bg-green-50 border-green-200";case"in_progress":return"text-blue-600 bg-blue-50 border-blue-200";case"pending":return"text-gray-600 bg-gray-50 border-gray-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},v=j=>{switch(j){case"completed":return"Completed";case"in_progress":return"In Progress";case"pending":return"Pending";default:return"Unknown"}};return i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading workflow progress..."})]})]}):o?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700",children:o})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),e.jsx("div",{className:"space-y-3",children:f.map(j=>{const h=p(j.id),y=h==="completed",b=h==="pending",_=m(j.id),E=x(j.id);return e.jsx("div",{className:`border rounded-lg p-4 ${b?"text-gray-400 bg-gray-50 border-gray-200":g(h)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(C,{path:j.icon,size:1.2,className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-medium",children:j.title}),e.jsx("div",{className:"flex items-center space-x-2",children:_?e.jsxs("button",{onClick:()=>d(j.id),className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-xs font-medium",children:[e.jsx(C,{path:Le,size:.8}),e.jsx("span",{children:"Mark Complete"})]}):y?e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-white bg-opacity-75",children:v(h)}):b?e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-200 text-gray-500",children:"Waiting for previous step"}):null})]}),e.jsx("p",{className:"text-sm opacity-90",children:j.description}),j.isInteractive&&y&&e.jsx("div",{className:"mt-2 text-xs opacity-75",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["âœ… Completed by:"," ",E.completedBy||"Unknown"]}),e.jsxs("span",{children:["ðŸ•’"," ",E.completedAt?new Date(E.completedAt).toLocaleString():"Unknown time"]})]})})]})]})},j.id)})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:ni,size:1.2,className:"text-blue-500"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Exposure Tracking"})]}),e.jsx("button",{onClick:r,onKeyDown:j=>j.key==="Enter"&&r(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium","aria-label":"View exposure report",children:"View Exposure Report"})]})})]})},Hu=({error:r,onRetry:t,getErrorColor:s})=>{if(!r)return null;const n=()=>{t()},a=i=>{i.key==="Enter"&&r.retryable&&n()};return e.jsx("div",{className:`border rounded-lg p-4 ${s(r.severity)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(C,{path:ce,size:1.2,className:"mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium",children:[r.severity==="critical"&&"Critical Error",r.severity==="high"&&"High Priority Error",r.severity==="medium"&&"Error",r.severity==="low"&&"Warning"]}),r.code&&e.jsxs("span",{className:"text-xs font-mono bg-white bg-opacity-75 px-2 py-1 rounded",children:["Error Code: ",r.code]})]}),e.jsx("p",{className:"text-sm mb-3",children:r.message}),r.retryable&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:n,onKeyDown:a,className:"inline-flex items-center space-x-1 px-3 py-1.5 text-sm font-medium bg-white bg-opacity-75 hover:bg-opacity-90 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-current","aria-label":"Retry the operation",children:[e.jsx(C,{path:ts,size:.9}),e.jsx("span",{children:"Retry"})]}),e.jsx("span",{className:"text-xs opacity-75",children:"This error may be temporary. You can try again."})]}),!r.retryable&&e.jsx("p",{className:"text-xs opacity-75",children:"This error requires manual intervention. Please contact your supervisor."})]})]})})},Vu=({isLoading:r,isResolveButtonDisabled:t,resolveButtonText:s,resolutionNotes:n,onResolve:a,onCancel:i,onUpdateNotes:c})=>{const o=m=>{c(m.target.value)},l=()=>{t||a()},d=()=>{r||i()},p=m=>{m.key==="Enter"&&(m.ctrlKey||m.metaKey)&&!t&&(m.preventDefault(),l()),m.key==="Escape"&&!r&&d()};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resolution-notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Notes"}),e.jsx("textarea",{id:"resolution-notes",value:n,onChange:o,onKeyDown:p,disabled:r,rows:4,className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${r?"bg-gray-100 cursor-not-allowed":"bg-white"}`,placeholder:"Document the steps taken to resolve this BI failure incident...","aria-describedby":"resolution-notes-help"}),e.jsx("p",{id:"resolution-notes-help",className:"mt-1 text-sm text-gray-500",children:"Include details about re-sterilization parameters, new BI test results, and any corrective actions taken."})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:d,disabled:r,className:`px-4 py-2 text-sm font-medium rounded-md border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${r?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,"aria-label":"Cancel resolution",children:"Cancel"}),e.jsx("button",{onClick:l,disabled:t,className:`px-4 py-2 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${t?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,"aria-label":"Resolve BI failure incident",children:s})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Ctrl+Enter"})," ","to resolve â€¢"," ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel"]})})]})};var ki=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Wu=()=>ki(null,null,function*(){try{const{biFailureDetails:r}=G.getState(),t=sessionStorage.getItem("currentBIFailureIncidentId");if(t)return t;if(r){const s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const a=Math.random()*16|0;return(n==="x"?a:a&3|8).toString(16)});return sessionStorage.setItem("currentBIFailureIncidentId",s),s}return null}catch(r){return console.error("Failed to get current incident ID:",r),null}}),Ha=()=>{ti.exportExposureReport("pdf")},Va=()=>{ti.exportExposureReport("csv")},Gu=({isOpen:r,onClose:t,incidentId:s})=>{const[n,a]=u.useState(null),[i,c]=u.useState(!1),[o,l]=u.useState(null),d=u.useCallback(()=>ki(null,null,function*(){c(!0),l(null);try{const f=s||(yield Wu());if(!f)throw new Error("No incident ID available for exposure report");const g=yield Ao.generatePatientExposureReport(f);a(g)}catch(f){l(f instanceof Error?f.message:"Failed to load exposure report")}finally{c(!1)}}),[s]);u.useEffect(()=>{r&&d()},[r,d]);const p=()=>{a(null),l(null),t()},m=f=>{f.target===f.currentTarget&&p()},x=f=>{f.key==="Escape"&&p()};return r?Is.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:m,onKeyDown:x,role:"button",tabIndex:0,"aria-label":"Close modal backdrop",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto scrollbar-hide",role:"dialog","aria-labelledby":"exposure-report-title","aria-describedby":"exposure-report-description",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{path:ni,size:1.5,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h2",{id:"exposure-report-title",className:"text-xl font-semibold text-gray-900",children:"Exposure Report"}),e.jsx("p",{id:"exposure-report-description",className:"text-sm text-gray-600",children:'Tools scanned dirty in "IN USE" rooms during BI failure risk window'})]})]}),e.jsx("button",{onClick:p,onKeyDown:f=>f.key==="Enter"&&p(),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close exposure report",children:e.jsx(C,{path:ae,size:1.2})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[i&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading exposure report..."})]}),o&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500"}),e.jsxs("span",{className:"text-red-800",children:["Error: ",o]})]})}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(C,{path:ut,size:1.2,className:"text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:'"IN USE" Rooms with Tool Contamination'})]}),e.jsx("p",{className:"text-2xl font-bold text-red-900 mb-3",children:n.totalRoomsAffected||0}),e.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Risk Window Analysis:"}),e.jsx("p",{children:'This count shows tools that were used between the last passed BI test and the failed BI test. The tools have been traced to the rooms that were marked "IN USE" and scanned for use, taking them from a clean to dirty status.'}),e.jsx("p",{className:"font-medium text-red-800",children:"âš ï¸ Important:"}),e.jsx("p",{children:"These tools could have been cycled through the autoclave many times before a failed BI was identified. It is important to validate this list against your patient records software to initiate a patient trace and contact plan (if in your policies and procedures)."})]})]})}),n.roomDetails&&n.roomDetails.length>0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Room Exposure Analysis"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:'Tools scanned dirty in "IN USE" rooms during risk window'})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time/Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Room"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Associated Tools Scanned"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.roomDetails.map((f,g)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:new Date(String(f.roomUsedDate)).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(String(f.roomUsedDate)).toLocaleTimeString()})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:String(f.roomName)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",String(f.roomId)]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length," tool",f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.length!==1?"s":""," ","scanned dirty"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:f.contaminatedTools&&Array.isArray(f.contaminatedTools)&&f.contaminatedTools.map((v,j)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:String(v)},j))})]}):e.jsx("span",{className:"text-gray-400 italic",children:"No tools scanned"})})]},g))})]})})]}):e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{path:ze,size:1.2,className:"text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-green-800",children:"No Room Exposure Found"}),e.jsxs("div",{className:"text-green-700 space-y-2",children:[e.jsx("p",{children:'Based on tool scans, it looks as though no tools that were autoclaved after the passed BI and before the failed BI have been initiated in the "dirty tool" status.'}),e.jsx("p",{className:"font-medium text-green-800",children:"This would indicate that there is no patient tracing needed."}),e.jsx("p",{className:"text-sm",children:"However, if your team is not scanning consistently, this data could be inaccurate."})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:Va,onKeyDown:f=>f.key==="Enter"&&Va(),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Export exposure report",children:[e.jsx(C,{path:Es,size:1}),e.jsx("span",{children:"Export Report"})]}),e.jsxs("button",{onClick:Ha,onKeyDown:f=>f.key==="Enter"&&Ha(),className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Print exposure report",children:[e.jsx(C,{path:li,size:1}),e.jsx("span",{children:"Print Report"})]})]}),e.jsx("button",{onClick:p,onKeyDown:f=>f.key==="Enter"&&p(),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})]})]})]})]})}),document.body):null};var Ku=Object.defineProperty,Qu=Object.defineProperties,Yu=Object.getOwnPropertyDescriptors,Wa=Object.getOwnPropertySymbols,Ju=Object.prototype.hasOwnProperty,Xu=Object.prototype.propertyIsEnumerable,Ga=(r,t,s)=>t in r?Ku(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Zu=(r,t)=>{for(var s in t||(t={}))Ju.call(t,s)&&Ga(r,s,t[s]);if(Wa)for(var s of Wa(t))Xu.call(t,s)&&Ga(r,s,t[s]);return r},em=(r,t)=>Qu(r,Yu(t));const tm=({isOpen:r,onClose:t,onMinimize:s,isMinimized:n=!1})=>{const{isLoading:a,error:i,showExposureReport:c,resolutionNotes:o,biFailureDetails:l,handleResolve:d,handleRetry:p,handleClose:m,handleBackdropClick:x,handleKeyDown:f,toggleExposureReport:g,updateResolutionNotes:v,getErrorColor:j,isResolveButtonDisabled:h,getResolveButtonText:y}=$u({onClose:t,onSuccess:()=>{}});return r?Is.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 p-4",style:{paddingTop:"12rem"},onClick:x,role:"button",tabIndex:0,"aria-label":"Close modal by clicking outside",onKeyDown:b=>{if(b.key==="Enter"||b.key===" "){b.preventDefault();const _=em(Zu({},b),{target:b.currentTarget,currentTarget:b.currentTarget,nativeEvent:b.nativeEvent,bubbles:!0,cancelable:!0,button:0});x(_)}},children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-y-auto transform translate-y-16 scrollbar-hide",role:"dialog","aria-labelledby":"bi-failure-modal-title","aria-describedby":"bi-failure-modal-description",onKeyDown:f,children:[e.jsx(Au,{isSubmitting:a,onClose:m,onMinimize:s}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Ru,{biFailureDetails:l?{date:typeof l.failure_date=="string"?new Date(l.failure_date):l.failure_date instanceof Date?l.failure_date:new Date,affectedToolsCount:l.affected_tools_count,affectedBatchIds:l.affected_batch_ids,operator:l.detected_by_operator_id}:null}),e.jsx(qu,{showExposureReport:c,onToggleExposureReport:g}),e.jsx(Hu,{error:i,onRetry:p,getErrorColor:j}),e.jsx(Vu,{isLoading:a,isResolveButtonDisabled:h(),resolveButtonText:y(),resolutionNotes:o,onResolve:d,onCancel:m,onUpdateNotes:v})]})]}),c&&e.jsx(Gu,{isOpen:c,onClose:g,incidentId:l==null?void 0:l.id})]}),document.body):null},sm=({isOpen:r,onClose:t})=>e.jsx(tm,{isOpen:r,onClose:t}),rm=({onDismiss:r})=>{const[t,s]=u.useState(!1),[n,a]=u.useState(!1),{biFailureActive:i,biFailureDetails:c}=G(),{currentUser:o}=He();return i?e.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[9999] bg-red-600 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-1 bg-red-700 rounded-lg flex-shrink-0",children:e.jsx(C,{path:ce,size:1.2,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"ðŸš¨ TOOL RECALL: BI TEST FAILURE"}),e.jsx("span",{className:"text-sm bg-red-700 px-2 py-1 rounded",children:c!=null&&c.failure_date&&typeof c.failure_date=="string"?new Date(c.failure_date).toLocaleDateString():c!=null&&c.failure_date&&c.failure_date instanceof Date?c.failure_date.toLocaleDateString():"Today"})]}),e.jsxs("p",{className:"text-sm text-red-100 mt-1",children:[e.jsx("strong",{children:"CRITICAL:"})," All tools sterilized since the last successful BI test must be quarantined immediately. Check packaging for affected batch numbers."]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>{s(!0),a(!1)},className:"flex items-center gap-2 bg-red-700 hover:bg-red-800 px-3 py-1 rounded-lg transition-colors",title:n?"Resume workflow":"View resolution workflow",children:[e.jsx(C,{path:Vo,size:1,className:"text-white"}),e.jsx("span",{className:"text-sm font-medium",children:n?"Resume Workflow":"Resolution Workflow"})]}),(c==null?void 0:c.affected_tools_count)!==void 0&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-700 px-3 py-1 rounded-lg",children:[e.jsx(C,{path:dt,size:1,className:"text-white"}),e.jsxs("span",{className:"text-sm font-medium",children:[c.affected_tools_count," tools affected"]})]}),r&&e.jsx("button",{onClick:r,className:"p-1 hover:bg-red-700 rounded-lg transition-colors",title:"Dismiss banner",children:e.jsx(C,{path:ae,size:1.2,className:"text-white"})})]})]}),e.jsx(sm,{isOpen:t,onClose:()=>s(!1)})]}):null},av=({onDismiss:r})=>{const t=Dr();return t.pathname==="/login"||t.pathname.startsWith("/auth")?null:e.jsx(rm,{onDismiss:r})},am=({notification:r})=>{const[t,s]=u.useState(!0);u.useEffect(()=>{const o=setTimeout(()=>{s(!1),setTimeout(()=>{Xt.removeNotification(r.id)},300)},5e3);return()=>clearTimeout(o)},[r.id]);const n=()=>{s(!1),setTimeout(()=>{Xt.removeNotification(r.id)},300)},a=()=>{switch(r.type){case"tool_available":return Ce;case"position_changed":case"queue_update":return ze;case"tool_unavailable":return ce;default:return ze}},i=()=>{switch(r.type){case"tool_available":return"text-green-500";case"position_changed":case"queue_update":return"text-blue-500";case"tool_unavailable":return"text-orange-500";default:return"text-gray-500"}},c=()=>{switch(r.type){case"tool_available":return r.title.includes("ðŸ”¥")?"bg-red-50 border-red-200":r.title.includes("âš¡")?"bg-yellow-50 border-yellow-200":r.title.includes("ðŸ“‹")?"bg-gray-50 border-gray-200":"bg-green-50 border-green-200";case"position_changed":case"queue_update":return"bg-blue-50 border-blue-200";case"tool_unavailable":return"bg-orange-50 border-orange-200";default:return"bg-gray-50 border-gray-200"}};return e.jsx("div",{className:`
        ${c()}
        border rounded-lg shadow-lg p-4 mb-3 max-w-sm w-full
        transform transition-all duration-300 ease-in-out
        ${t?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{path:a(),size:1.2,className:i()})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:r.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:r.message}),r.action&&e.jsx("button",{onClick:r.action.onClick,className:"mt-2 text-sm font-medium text-blue-600 hover:text-blue-500",children:r.action.label})]}),e.jsx("button",{onClick:n,className:"ml-4 flex-shrink-0 text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]})})},nv=()=>{const[r,t]=u.useState([]);return u.useEffect(()=>Xt.subscribe(t),[]),r.length===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-[9999] max-w-sm",children:r.map(s=>e.jsx(am,{notification:s},s.id))})};function nm(){const r=u.useCallback(()=>hr.getRecentInsights(10),[]),t=u.useCallback(()=>hr.getPerformanceSummary(),[]);return{getInsights:r,getSummary:t}}const lv=({isVisible:r=!1,onClose:t})=>{const[s,n]=u.useState(null),[a,i]=u.useState([]),[c,o]=u.useState("all"),{getInsights:l,getSummary:d}=nm();if(u.useEffect(()=>{if(r){const x=()=>{n(d()),i(l())};x();const f=setInterval(x,5e3);return()=>clearInterval(f)}},[r,l,d]),!r)return null;const p=[{key:"all",label:"All Categories",color:"bg-gray-500"},{key:"ui",label:"UI Performance",color:"bg-blue-500"},{key:"api",label:"API Performance",color:"bg-green-500"},{key:"database",label:"Database",color:"bg-purple-500"},{key:"memory",label:"Memory Usage",color:"bg-yellow-500"},{key:"network",label:"Network",color:"bg-red-500"},{key:"user-interaction",label:"User Interaction",color:"bg-indigo-500"}],m=x=>{switch(x){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Enhanced Performance Dashboard"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Performance Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(x=>e.jsx("button",{onClick:()=>o(x.key),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${c===x.key?`${x.color} text-white`:"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:x.label},x.key))})]}),s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Performance Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.totalMetrics}),e.jsx("div",{className:"text-sm text-blue-800",children:"Total Metrics"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.totalInsights}),e.jsx("div",{className:"text-sm text-green-800",children:"Insights Generated"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:Object.keys(s.categories).length}),e.jsx("div",{className:"text-sm text-purple-800",children:"Active Categories"})]})]})]}),s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Category Performance"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(s.categories).map(([x,f])=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold capitalize",children:x}),e.jsxs("span",{className:"text-sm text-gray-600",children:[f.count," metrics"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Avg:"}),e.jsxs("span",{className:"font-medium",children:[f.avgValue.toFixed(1),"ms"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Max:"}),e.jsxs("span",{className:"font-medium",children:[f.maxValue.toFixed(1),"ms"]})]})]})]},x))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Recent Performance Insights"}),e.jsxs("div",{className:"space-y-3",children:[a.map((x,f)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:x.metric}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${m(x.severity)}`,children:x.severity})]}),e.jsx("p",{className:"text-gray-700 mb-2",children:x.insight}),e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:x.recommendation}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:x.timestamp.toLocaleString()})]},f)),a.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No performance insights available"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{onClick:()=>hr.clearOldMetrics(1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Clear Old Metrics (1h)"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleString()]})]})]})]})})};var lm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const im=({isOpen:r,onOpen:t,onClose:s,hasComplianceIssues:n=!1,hasAIUsageIssues:a=!1})=>{const{currentUser:i,getUserDisplayName:c,isLoading:o,clearUserData:l}=He(),[d,p]=u.useState(!1),m=u.useRef(null),x=Er(),g=Dr().pathname;if(o)return e.jsx("div",{className:"bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen w-16 sm:w-20 md:w-20",children:e.jsx("div",{className:"flex-1 pt-4 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[#4ECDC4]"})})});const v=h=>{x(h)},j=[{path:"/home",icon:no,label:"Home"},{path:"/sterilization",icon:lo,label:"Sterilization"},{path:"/inventory",icon:io,label:"Inventory"},{path:"/environmental-clean",icon:oo,label:"Environmental Clean"},{path:"/knowledge-hub",icon:co,label:"Knowledge Hub"},{path:"/intelligence",icon:uo,label:"Intelligence"},{path:"/settings",icon:mo,label:"Settings"}];return e.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen ${r?"w-full sm:w-64 md:w-64":"w-16 sm:w-20 md:w-20"}`,children:[e.jsxs("div",{className:"flex-1 pt-4 overflow-y-auto",children:[r?e.jsxs("div",{className:"px-4 sm:px-6 pb-6 flex justify-between items-center",children:[e.jsx("div",{className:"relative",children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[#4ECDC4]",children:"Cliniio"})}),e.jsx("button",{onClick:s,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),s())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Collapse navigation menu (Press Enter or Space)",title:"Collapse menu (Enter/Space)",tabIndex:0,children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 12H5"})})})]}):e.jsx("div",{className:"px-4 sm:px-6 pb-6 flex justify-center items-center",children:e.jsx("button",{onClick:t,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),t())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Expand navigation menu (Press Enter or Space)",title:"Expand menu (Enter/Space)",tabIndex:0,children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5l7 7-7 7"})})})}),e.jsx("nav",{children:j.map(({path:h,icon:y,label:b})=>e.jsxs("button",{onClick:()=>v(h),className:`flex items-center transition-colors duration-200 w-full text-left touch-manipulation relative ${r?"px-4 sm:px-6 py-4":"px-3 sm:px-4 py-4 justify-center"} ${g===h?"bg-[#4ECDC4] bg-opacity-10 border-r-4 border-[#4ECDC4] text-[#4ECDC4]":"text-[#5b5b5b] hover:bg-gray-50 hover:text-[#4ECDC4]"}`,"aria-label":r?b:`${b} page`,title:r?void 0:b,children:[e.jsx(y,{size:20,className:`${r?"mr-4":""} ${g===h?"text-[#4ECDC4]":"text-gray-400"}`,"aria-hidden":"true"}),r&&e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:`font-medium whitespace-nowrap ${g===h?"text-[#4ECDC4]":"text-[#5b5b5b]"}`,children:b}),h==="/settings"&&(n||a)&&e.jsx("div",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold ml-2",children:"!"})]}),!r&&h==="/settings"&&(n||a)&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold",children:"!"})]},h))})]}),e.jsx("div",{className:`${r?"p-3 sm:p-4":"p-1"} border-t border-gray-200 bg-white sticky bottom-0`,children:e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:m,className:`flex items-center space-x-4 w-full text-left ${r?"mb-4":"justify-center mb-2"}`,onClick:()=>p(h=>!h),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&p(y=>!y)},"aria-expanded":d,"aria-haspopup":"true","aria-label":r?`User menu for ${i?c():"User"}`:"User profile menu",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4ECDC4] flex items-center justify-center overflow-hidden",children:i!=null&&i.avatar_url?e.jsx("img",{src:i.avatar_url,alt:"Profile",className:"w-8 h-8 rounded-full object-cover",onLoad:()=>console.log("Avatar image loaded successfully in DrawerMenu"),onError:h=>console.error("Avatar image failed to load in DrawerMenu:",h)}):e.jsx(po,{size:20,className:"text-white"})}),r&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:c()}),e.jsx("p",{className:"text-xs text-gray-500",children:(i==null?void 0:i.role)||"User"})]})]}),d&&r&&e.jsx("div",{role:"menu","aria-labelledby":"user-menu",style:{position:"absolute",bottom:56,left:0,background:"white",borderRadius:8,boxShadow:"0 2px 16px rgba(0,0,0,0.15)",minWidth:180,zIndex:100,padding:12,textAlign:"center"},children:e.jsx("button",{role:"menuitem",className:"px-4 py-2 bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] w-full",onClick:()=>lm(null,null,function*(){console.log("ðŸšª DrawerMenu: Logout button clicked");try{console.log("ðŸšª DrawerMenu: Starting logout process..."),console.log("ðŸšª DrawerMenu: Calling clearUserData()..."),l(),yield new Promise(b=>setTimeout(b,100)),console.log("ðŸšª DrawerMenu: Calling login store reset()...");const{useLoginStore:h}=yield qe(()=>Promise.resolve().then(()=>zc),void 0);yield h.getState().reset(),console.log("ðŸšª DrawerMenu: Calling auth service logout()..."),yield new Ro().logout(),console.log("ðŸšª DrawerMenu: Logout successful, navigating to login"),x("/login"),p(!1),console.log("ðŸ”„ DrawerMenu: Reloading page for clean state..."),window.location.reload()}catch(h){console.error("ðŸšª DrawerMenu: Logout failed:",h),x("/login"),p(!1),console.log("ðŸ”„ DrawerMenu: Reloading page after logout error..."),window.location.reload()}}),children:"Logout"})})]})})]})},Fe=({className:r="",children:t})=>e.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${r}`,"aria-label":"Loading content",role:"status",children:t}),om=({className:r=""})=>e.jsxs("div",{className:`bg-white rounded-lg shadow-sm p-6 ${r}`,children:[e.jsx(Fe,{className:"h-4 w-3/4 mb-4"}),e.jsx(Fe,{className:"h-8 w-1/2 mb-2"}),e.jsx(Fe,{className:"h-3 w-full mb-1"}),e.jsx(Fe,{className:"h-3 w-2/3"})]}),iv=({rows:r=5,columns:t=4})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:e.jsx("div",{className:"flex space-x-4",children:Array.from({length:t}).map((s,n)=>e.jsx(Fe,{className:"h-4 flex-1"},`header-${n}`))})}),e.jsx("div",{className:"divide-y divide-gray-200",children:Array.from({length:r}).map((s,n)=>e.jsx("div",{className:"px-6 py-4",children:e.jsx("div",{className:"flex space-x-4",children:Array.from({length:t}).map((a,i)=>e.jsx(Fe,{className:"h-4 flex-1"},`cell-${n}-${i}`))})},`row-${n}`))})]}),ov=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Fe,{className:"h-10 flex-1"}),e.jsx(Fe,{className:"h-10 w-20"})]}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:4}).map((r,t)=>e.jsx(Fe,{className:"h-8 w-16"},t))})]}),cm=({size:r="md"})=>{const t={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return e.jsx("div",{className:"flex justify-center items-center p-4",children:e.jsx("div",{className:`animate-spin rounded-full border-4 border-t-transparent border-blue-500 ${t[r]}`,role:"status","aria-label":"Loading"})})},dm=()=>{const r=Dr();return{getCurrentContext:()=>{const s=r.pathname;return s.includes("/sterilization")?"sterilization":s.includes("/inventory")?"inventory":s.includes("/environmental-clean")?"environmental-clean":s.includes("/home")?"home":"general"}}},um=r=>{const t=Er(),{getCurrentContext:s}=dm(),[n,a]=u.useState(null),[i,c]=u.useState(null),[o,l]=u.useState(new Set),[d,p]=u.useState(new Set),[m,x]=u.useState(new Set),[f,g]=u.useState(new Set),v=s();return{selectedHelpType:n,expandedMetrics:o,expandedTasks:d,expandedGamification:m,expandedRelevant:f,currentContext:v,handleOptionClick:w=>{w.action==="ai-chat"?a("ai-chat"):w.action==="context-help"?a("context-help"):w.action==="cliniio-help"?a("cliniio-help"):w.action==="product-feedback"?a("product-feedback"):w.action==="page"&&w.path?(t(w.path),r()):w.action==="modal"&&alert(`${w.title} - Coming soon! This will open a focused help interface.`)},handleBack:()=>{i?(a(i),c(null)):a(null)},handleFeedbackSuccess:()=>{a("cliniio-help")},toggleMetricSection:w=>{l(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},toggleTaskSection:w=>{p(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},toggleGamificationSection:w=>{x(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},toggleRelevantSection:w=>{g(T=>{const k=new Set(T);return k.has(w)?k.delete(w):k.add(w),k})},setHelpType:w=>{c(n),a(w)}}},Ka=({onOptionClick:r})=>{const t=[{id:"ai-assistant",icon:e.jsx("span",{children:"ðŸ¤–"}),title:"AI Assistant",description:"Get AI-powered help and answers",action:"ai-chat"},{id:"cliniio-help",icon:e.jsx("span",{children:"ðŸ’¬"}),title:"Cliniio Help",description:"General help and support",action:"cliniio-help"},{id:"context-help",icon:e.jsx("span",{children:"ðŸ“š"}),title:"Relevant Information",description:"Standards and protocols for your current task",action:"context-help"},{id:"product-feedback",icon:e.jsx("span",{children:"ðŸ’¡"}),title:"Product Feedback",description:"Report bugs or suggest improvements",action:"product-feedback"}];return e.jsx("div",{className:"p-4 space-y-3",children:t.map(s=>e.jsx("button",{onClick:()=>r(s),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:s.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description})]})]})},s.id))})};var mm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const pm=({currentContext:r,onBack:t})=>{const[s,n]=u.useState([{role:"assistant",content:"Hello! I'm your Cliniio AI assistant. How can I help you today?"}]),[a,i]=u.useState(""),[c,o]=u.useState(!1),l=()=>mm(null,null,function*(){if(!a.trim()||c)return;const p=a.trim();i(""),n(m=>[...m,{role:"user",content:p}]),o(!0);try{const m=yield Ps.askAI(p,{module:"ai-chat",facilityId:"unknown",userId:"unknown"});n(x=>[...x,{role:"assistant",content:m}])}catch(m){console.error(m),n(x=>[...x,{role:"assistant",content:"Sorry, I encountered an error. Please try again."}])}finally{o(!1)}}),d=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),l())};return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"AI Assistant"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ask me anything about Cliniio"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 scrollbar-hide",children:[s.map((p,m)=>e.jsx("div",{className:`flex ${p.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-4 py-2 rounded-lg ${p.role==="user"?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-800"}`,children:e.jsx("p",{className:"text-sm",children:p.content})})},m)),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),e.jsx("div",{className:"border-t border-gray-200 p-4 bg-white",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:a,onChange:p=>i(p.target.value),onKeyPress:d,placeholder:"Ask me anything...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",disabled:c}),e.jsx("button",{onClick:l,disabled:!a.trim()||c,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("span",{className:"text-sm",children:"Send"})})]})})]})};var xm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const hm=({currentContext:r,expandedRelevant:t,onToggleRelevantSection:s,onBack:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{xm(null,null,function*(){try{console.log("ðŸ” Loading relevant information articles...");const x=yield Ds.getArticlesByCategory("relevant-information");console.log("ðŸ“‹ Found articles:",x),i(x)}catch(x){console.error("Error loading relevant information articles:",x)}finally{o(!1)}})},[]);const l=m=>{window.open(`/help/article/${m}`,"_blank")},d=[{id:"canadian-standards",title:"ðŸ‡¨ðŸ‡¦ Canadian Standards",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ CSA Z314.2-19 - Decontamination of Reusable Medical Devices"}),e.jsx("li",{children:"â€¢ CSA Z314.3-19 - Steam Sterilization in Health Care Facilities"}),e.jsx("li",{children:"â€¢ Health Canada SOR/98-282 - Medical Device Regulations"}),e.jsx("li",{children:"â€¢ Public Health Agency of Canada - Routine Practices and Additional Precautions"}),e.jsx("li",{children:"â€¢ Ontario Health - Infection Prevention and Control Guidelines"}),e.jsx("li",{children:"â€¢ BC Centre for Disease Control - Healthcare-Associated Infection Prevention"}),e.jsx("li",{children:"â€¢ Alberta Health Services - Sterilization and Reprocessing Standards"}),e.jsx("li",{children:"â€¢ Quebec Health - Hygiene Practices in Healthcare Facilities"})]})},{id:"us-standards",title:"ðŸ‡ºðŸ‡¸ US Standards",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"â€¢ AAMI ST79:2017 - Comprehensive Guide to Steam Sterilization"}),e.jsx("li",{children:"â€¢ AAMI ST91:2021 - Flexible Endoscope Reprocessing"}),e.jsx("li",{children:"â€¢ CDC Guidelines - Disinfection and Sterilization in Healthcare Facilities"}),e.jsx("li",{children:"â€¢ FDA Regulations - Medical Device Reprocessing Standards"}),e.jsx("li",{children:"â€¢ Joint Commission - Healthcare Accreditation Standards"}),e.jsx("li",{children:"â€¢ OSHA Guidelines - Workplace Safety and Chemical Handling"}),e.jsx("li",{children:"â€¢ ANSI/AAMI Standards - Sterilization Validation and Monitoring"})]})},{id:"international-standards",title:"ðŸŒ International Standards",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"â€¢ ISO 15883 - Washer-disinfectors"}),e.jsx("li",{children:"â€¢ ISO 17665 - Steam sterilization"}),e.jsx("li",{children:"â€¢ ISO 13485 - Medical Device Quality Management"}),e.jsx("li",{children:"â€¢ ISO 9001 - Quality Management Systems"}),e.jsx("li",{children:"â€¢ WHO Guidelines - Infection Prevention and Control"}),e.jsx("li",{children:"â€¢ ASTM Standards - Material Testing and Validation"}),e.jsx("li",{children:"â€¢ IAC Standards - Infection Prevention and Control"}),e.jsx("li",{children:"â€¢ APIC Guidelines - Healthcare-Associated Infection Prevention"})]})}],p=m=>{const x=t.has(m.id),g={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[m.color];return e.jsxs("div",{className:`${g.bg} ${g.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>s(m.id),className:`w-full p-3 text-left flex items-center justify-between ${g.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${g.text}`,children:m.title}),e.jsx("span",{className:`${g.icon} text-lg transition-transform duration-200`,children:x?"âˆ’":"+"})]}),x&&e.jsxs("div",{className:"px-3 pb-3",children:[m.content,m.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(m.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},m.id)};if(r==="home"||r==="general"){if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(x=>({id:x.slug,title:x.title,color:"blue",slug:x.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:x.excerpt||'Click "Read Full Article" to learn more about standards and compliance.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Standards and compliance reference"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Comprehensive Standards Reference"}),m.map(p)]})})]})}return r==="sterilization"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"BI Testing"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Biological indicator testing protocols"}),e.jsx("li",{children:"â€¢ Testing frequency requirements"}),e.jsx("li",{children:"â€¢ Result interpretation and documentation"}),e.jsx("li",{children:"â€¢ Quality assurance procedures"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Sterilization Workflow"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Pre-cleaning and inspection protocols"}),e.jsx("li",{children:"â€¢ Proper packaging and loading techniques"}),e.jsx("li",{children:"â€¢ Sterilization cycle parameters"}),e.jsx("li",{children:"â€¢ Post-sterilization handling procedures"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Reporting and Compliance"}),e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Documentation requirements"}),e.jsx("li",{children:"â€¢ Regulatory compliance standards"}),e.jsx("li",{children:"â€¢ Audit preparation and procedures"}),e.jsx("li",{children:"â€¢ Quality management systems"})]})]})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"General information and standards will be displayed here based on your current page."})})};var gm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const fm=()=>{const[r,t]=u.useState(""),[s,n]=u.useState(""),[a,i]=u.useState(""),[c,o]=u.useState("medium"),[l,d]=u.useState(""),[p,m]=u.useState(!1);return{feedbackType:r,setFeedbackType:t,feedbackTitle:s,setFeedbackTitle:n,feedbackDescription:a,setFeedbackDescription:i,feedbackPriority:c,setFeedbackPriority:o,feedbackEmail:l,setFeedbackEmail:d,isSubmittingFeedback:p,handleFeedbackSubmit:g=>gm(null,null,function*(){g.preventDefault(),m(!0);try{const v={type:r,title:s,description:a,priority:c,email:l},j=yield Bo.submitFeedback(v);return j.success?(t(""),n(""),i(""),o("medium"),d(""),alert("Thank you for your feedback! We'll review it and get back to you if needed."),!0):(console.error("Error submitting feedback:",j.error),alert("There was an error submitting your feedback. Please try again."),!1)}catch(v){return console.error("Error submitting feedback:",v),alert("There was an error submitting your feedback. Please try again."),!1}finally{m(!1)}}),resetFeedbackForm:()=>{t(""),n(""),i(""),o("medium"),d("")}}};var bm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const ym=({onBack:r,onSuccess:t})=>{const{feedbackType:s,setFeedbackType:n,feedbackTitle:a,setFeedbackTitle:i,feedbackDescription:c,setFeedbackDescription:o,feedbackPriority:l,setFeedbackPriority:d,feedbackEmail:p,setFeedbackEmail:m,isSubmittingFeedback:x,handleFeedbackSubmit:f}=fm(),g=v=>bm(null,null,function*(){(yield f(v))&&t()});return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Product Feedback"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Help us improve Cliniio"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-white text-2xl",children:"ðŸ’¡"})}),e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Share Your Feedback"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Help us make Cliniio better for everyone"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackType",className:"block text-sm font-medium text-gray-700 mb-2",children:"Feedback Type *"}),e.jsxs("select",{id:"feedbackType",value:s,onChange:v=>n(v.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select feedback type"}),e.jsx("option",{value:"bug",children:"Bug Report"}),e.jsx("option",{value:"feature",children:"Feature Request"}),e.jsx("option",{value:"improvement",children:"Improvement Suggestion"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),e.jsx("input",{id:"feedbackTitle",type:"text",value:a,onChange:v=>i(v.target.value),placeholder:"Brief description of your feedback",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{id:"feedbackDescription",value:c,onChange:v=>o(v.target.value),placeholder:"Please provide detailed information...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackPriority",className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("select",{id:"feedbackPriority",value:l,onChange:v=>d(v.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email (optional)"}),e.jsx("input",{id:"feedbackEmail",type:"email",value:p,onChange:v=>m(v.target.value),placeholder:"your.email@facility.com",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"We'll only use this to follow up on your feedback"})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full bg-[#4ECDC4] text-white py-3 px-4 rounded-lg hover:bg-[#4ECDC4]/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:x?"Submitting...":"Submit Feedback"})]})]})})]})},vm=({onBack:r})=>{const[t,s]=u.useState(new Set([0])),[n,a]=u.useState(null),i=o=>{s(l=>{const d=new Set(l);return d.has(o)?(d.delete(o),n===o&&a(null)):(d.add(o),a(o)),d})},c=()=>{a(null)};return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Onboarding Tour"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Step-by-step guide to using the Home page"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-white text-2xl",children:"ðŸŽ¯"})}),e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Welcome to Cliniio!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Let's take a quick tour of your Home page"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(0),className:"w-full p-4 text-left flex items-center justify-between hover:bg-blue-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"1"}),e.jsx("h5",{className:"font-medium text-blue-800",children:"Daily Tasks & Progress"})]}),e.jsx("span",{className:"text-blue-600 text-lg transition-transform duration-200",children:t.has(0)?"âˆ’":"+"})]}),t.has(0)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"The main area shows your daily tasks and responsibilities. Each task card displays what needs to be done and your progress."}),e.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3 text-xs text-blue-600",children:[e.jsx("strong",{children:"Try it:"})," Look for task cards with checkboxes. Click on a checkbox to mark a task as complete and earn points!"]}),e.jsxs("button",{onClick:()=>a(n===0?null:0),className:"mt-3 w-full bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600 transition-colors",children:["ðŸŽ¯"," ",n===0?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(1),className:"w-full p-4 text-left flex items-center justify-between hover:bg-green-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"2"}),e.jsx("h5",{className:"font-medium text-green-800",children:"Quick Action Buttons"})]}),e.jsx("span",{className:"text-green-600 text-lg transition-transform duration-200",children:t.has(1)?"âˆ’":"+"})]}),t.has(1)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"At the top of your Home page, you'll find quick access buttons for important features and your performance stats."}),e.jsxs("div",{className:"bg-white border border-green-200 rounded p-3 text-xs text-green-600",children:[e.jsx("strong",{children:"Try it:"}),' Click on the purple "Stats" button to see your performance metrics, or the amber "Leaderboard" to check your ranking.']}),e.jsxs("button",{onClick:()=>a(n===1?null:1),className:"mt-3 w-full bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 transition-colors",children:["ðŸŽ¯"," ",n===1?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(2),className:"w-full p-4 text-left flex items-center justify-between hover:bg-purple-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"3"}),e.jsx("h5",{className:"font-medium text-purple-800",children:"Gamification & Points"})]}),e.jsx("span",{className:"text-purple-600 text-lg transition-transform duration-200",children:t.has(2)?"âˆ’":"+"})]}),t.has(2)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Notice the points and progress indicators? Cliniio makes work fun by rewarding your achievements and tracking your progress."}),e.jsxs("div",{className:"bg-white border border-purple-500 rounded p-3 text-xs text-purple-600",children:[e.jsx("strong",{children:"Try it:"})," Complete a task and watch your points increase. Check your progress in the Stats section to see your growth."]}),e.jsxs("button",{onClick:()=>a(n===2?null:2),className:"mt-3 w-full bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600 transition-colors",children:["ðŸŽ¯"," ",n===2?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(3),className:"w-full p-4 text-left flex items-center justify-between hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"4"}),e.jsx("h5",{className:"font-medium text-amber-800",children:"Performance Metrics"})]}),e.jsx("span",{className:"text-amber-600 text-lg transition-transform duration-200",children:t.has(3)?"âˆ’":"+"})]}),t.has(3)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Below your tasks, you'll see cards showing your time savings, cost savings, AI efficiency, and team performance."}),e.jsxs("div",{className:"bg-white border border-amber-200 rounded p-3 text-xs text-amber-600",children:[e.jsx("strong",{children:"Try it:"})," Review your metrics to see how you're performing. These update automatically as you complete tasks."]}),e.jsxs("button",{onClick:()=>a(n===3?null:3),className:"mt-3 w-full bg-amber-500 text-white px-3 py-2 rounded text-sm hover:bg-amber-600 transition-colors",children:["ðŸŽ¯"," ",n===3?"Hide arrow":"Show me where this is"]})]})]}),e.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>i(4),className:"w-full p-4 text-left flex items-center justify-between hover:bg-teal-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"5"}),e.jsx("h5",{className:"font-medium text-teal-800",children:"Help & Support"})]}),e.jsx("span",{className:"text-teal-600 text-lg transition-transform duration-200",children:t.has(4)?"âˆ’":"+"})]}),t.has(4)&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"That floating help button (ðŸ›Ÿ) you used to get here is always available when you need assistance with any feature."}),e.jsxs("div",{className:"bg-white border border-teal-200 rounded p-3 text-xs text-teal-600",children:[e.jsx("strong",{children:"Remember:"})," You can access help from anywhere in Cliniio. Just look for the floating button!"]}),e.jsxs("button",{onClick:()=>a(n===4?null:4),className:"mt-3 w-full bg-teal-500 text-white px-3 py-2 rounded text-sm hover:bg-teal-600 transition-colors",children:["ðŸŽ¯"," ",n===4?"Hide arrow":"Show me where this is"]})]})]})]}),e.jsx("div",{className:"bg-[#4ECDC4] border border-[#4ECDC4] rounded-lg p-4 text-center",children:e.jsxs("div",{className:"text-white",children:[e.jsx("h5",{className:"font-medium text-lg mb-2",children:"ðŸŽ‰ You're All Set!"}),e.jsx("p",{className:"text-sm text-white text-opacity-90 mb-3",children:"You now know the basics of navigating your Home page. Feel free to explore and try things out!"}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-white text-[#4ECDC4] rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Finish Tour"})]})})]})}),n!==null&&e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[n===0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute left-1/4 top-1/3 z-50",children:[e.jsx("div",{className:"bg-blue-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ“‹ Daily Tasks"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-blue-500 ml-4"})]})}),n===1&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute right-1/4 top-20 z-50",children:[e.jsx("div",{className:"bg-green-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"âš¡ Quick Actions"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-green-500 ml-4"})]})}),n===2&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute left-1/4 top-1/4 z-50",children:[e.jsx("div",{className:"bg-purple-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ† Points & Progress"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-purple-500 ml-4"})]})}),n===3&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute left-1/4 bottom-1/4 z-50",children:[e.jsx("div",{className:"bg-amber-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ“Š Performance Metrics"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-amber-500 ml-4"})]})}),n===4&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"absolute bottom-20 right-20 z-50",children:[e.jsx("div",{className:"bg-teal-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"ðŸ›Ÿ Help Button"}),e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-teal-500 ml-4"})]})}),e.jsx("button",{onClick:c,className:"absolute top-4 right-4 bg-white text-gray-700 px-3 py-2 rounded-lg shadow-lg pointer-events-auto hover:bg-gray-100 transition-colors border border-gray-200 z-50",children:"âœ• Close"})]})]})},jm=({currentContext:r,onBack:t,onSetHelpType:s})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Cliniio Help"}),e.jsx("p",{className:"text-xs text-gray-500",children:r==="home"?"Help for Home page":"General help and support"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r==="home"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Home Page Help"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s("performance-metrics"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"ðŸ“Š"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Understanding your dashboard metrics"})]})]})}),e.jsx("button",{onClick:()=>s("task-management"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"âœ…"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Task Management"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Managing daily tasks and workflows"})]})]})}),e.jsx("button",{onClick:()=>s("gamification"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"ðŸ†"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Gamification System"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How points, levels, and streaks work"})]})]})}),e.jsx("button",{onClick:()=>s("ai-features"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:e.jsx("span",{className:"text-lg",children:"ðŸ¤–"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"AI Features"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How AI improves your workflow"})]})]})})]})]}):r==="sterilization"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s("bi-testing"),className:"bg-blue-50 border border-blue-200 rounded-lg p-3 w-full text-left hover:bg-blue-100 transition-colors",children:e.jsx("h5",{className:"font-medium text-blue-800",children:"ðŸ§ª BI Testing"})}),e.jsx("button",{onClick:()=>s("sterilization-workflow"),className:"bg-green-50 border border-green-200 rounded-lg p-3 w-full text-left hover:bg-green-100 transition-colors",children:e.jsx("h5",{className:"font-medium text-green-800",children:"âœ‚ï¸ Sterilization Workflow"})}),e.jsx("button",{onClick:()=>s("reporting-compliance"),className:"bg-purple-50 border border-purple-200 rounded-lg p-3 w-full text-left hover:bg-purple-100 transition-colors",children:e.jsx("h5",{className:"font-medium text-purple-800",children:"ðŸ“Š Reporting and Compliance"})})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"Help content coming soon for this page."})})})]});var wm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Nm=({onBack:r,expandedMetrics:t,onToggleMetricSection:s,onSetHelpType:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{wm(null,null,function*(){try{console.log("ðŸ” Loading performance metrics articles...");const f=yield Ds.getArticlesByCategory("performance-metrics");console.log("ðŸ“Š Found articles:",f),console.log("ðŸ“Š Articles count:",f.length),console.log("ðŸ“Š Articles details:",f.map(g=>({slug:g.slug,title:g.title,published:g.is_published}))),i(f)}catch(f){console.error("âŒ Error loading performance metrics articles:",f)}finally{o(!1)}})},[]);const l=x=>{window.open(`/help/article/${x}`,"_blank")},d=[{id:"time-savings",title:"Time Savings",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Shows hours saved through AI assistance"}),e.jsx("li",{children:"â€¢ Daily and monthly tracking"}),e.jsx("li",{children:"â€¢ Compares AI vs. manual task completion"}),e.jsx("li",{children:"â€¢ Real-time updates as tasks complete"})]})},{id:"cost-savings",title:"Cost Savings",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Calculates dollar impact of AI efficiency"}),e.jsx("li",{children:"â€¢ Includes error prevention and compliance savings"}),e.jsx("li",{children:"â€¢ Uses facility-specific hourly rates"}),e.jsx("li",{children:"â€¢ Projects annual savings with growth factors"})]})},{id:"team-performance",title:"Team Performance",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Skills: Based on AI task completion rates"}),e.jsx("li",{children:"â€¢ Inventory: Real-time accuracy from actual data"}),e.jsx("li",{children:"â€¢ Sterilization: Performance from cycle data"}),e.jsx("li",{children:"â€¢ Helps identify training needs"})]})}],p=x=>{const f=t.has(x.id),v={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[x.color];return e.jsxs("div",{className:`${v.bg} ${v.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>s(x.id),className:`w-full p-3 text-left flex items-center justify-between ${v.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${v.text}`,children:x.title}),e.jsx("span",{className:`${v.icon} text-lg transition-transform duration-200`,children:f?"âˆ’":"+"})]}),f&&e.jsxs("div",{className:"px-3 pb-3",children:[x.content,x.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(x.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},x.id)};if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(x=>({id:x.slug,title:x.title,color:"blue",slug:x.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:x.excerpt||'Click "Read Full Article" to learn more about this performance metric.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Understanding your dashboard metrics"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Dashboard Metrics Explained"}),m.map(p)]})})]})};var Cm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Sm=({onBack:r,onSetHelpType:t,expandedTasks:s,onToggleTaskSection:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{Cm(null,null,function*(){try{console.log("ðŸ” Loading task management articles...");const f=yield Ds.getArticlesByCategory("task-management");console.log("ðŸ“‹ Found articles:",f),i(f)}catch(f){console.error("Error loading task management articles:",f)}finally{o(!1)}})},[]);const l=x=>{window.open(`/help/article/${x}`,"_blank")},d=[{id:"task-categories",title:"ðŸ“‹ Task Categories",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Sterilization: Autoclave cycles and BI tests"}),e.jsx("li",{children:"â€¢ Inventory: Stock checks and ordering"}),e.jsx("li",{children:"â€¢ Environmental: Cleaning schedules and compliance"}),e.jsx("li",{children:"â€¢ Quality: Documentation and audits"})]})},{id:"task-completion",title:"âœ… Task Completion",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Click checkboxes to mark tasks complete"}),e.jsx("li",{children:"â€¢ Earn points for each completed task"}),e.jsx("li",{children:"â€¢ Track progress throughout the day"}),e.jsx("li",{children:"â€¢ Maintain streaks for consistency"})]})},{id:"workflow-tips",title:"ðŸ’¡ Workflow Tips",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Use filters to focus on specific task types"}),e.jsx("li",{children:"â€¢ Prioritize high-impact tasks first"}),e.jsx("li",{children:"â€¢ Set reminders for time-sensitive items"}),e.jsx("li",{children:"â€¢ Review completed tasks for quality"})]})}],p=x=>{const f=s.has(x.id),v={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[x.color];return e.jsxs("div",{className:`${v.bg} ${v.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>n(x.id),className:`w-full p-3 text-left flex items-center justify-between ${v.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${v.text}`,children:x.title}),e.jsx("span",{className:`${v.icon} text-lg transition-transform duration-200`,children:f?"âˆ’":"+"})]}),f&&e.jsxs("div",{className:"px-3 pb-3",children:[x.content,x.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(x.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},x.id)};if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(x=>({id:x.slug,title:x.title,color:"blue",slug:x.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:x.excerpt||'Click "Read Full Article" to learn more about task management.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Managing daily tasks and workflows"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Daily Task Management"}),m.map(p)]})})]})};var _m=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Tm=({onBack:r,onSetHelpType:t,expandedGamification:s,onToggleGamificationSection:n})=>{const[a,i]=u.useState([]),[c,o]=u.useState(!0);u.useEffect(()=>{_m(null,null,function*(){try{console.log("ðŸ” Loading gamification articles...");const f=yield Ds.getArticlesByCategory("gamification");console.log("ðŸŽ® Found articles:",f),i(f)}catch(f){console.error("Error loading gamification articles:",f)}finally{o(!1)}})},[]);const l=x=>{window.open(`/help/article/${x}`,"_blank")},d=[{id:"point-system",title:"â­ Point System",color:"blue",content:e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Complete tasks to earn points"}),e.jsx("li",{children:"â€¢ Points vary by task difficulty and impact"}),e.jsx("li",{children:"â€¢ Bonus points for maintaining streaks"}),e.jsx("li",{children:"â€¢ Level up as you accumulate points"})]})},{id:"streaks-consistency",title:"ðŸ”¥ Streaks & Consistency",color:"green",content:e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Daily streaks increase your multiplier"}),e.jsx("li",{children:"â€¢ Perfect days earn bonus rewards"}),e.jsx("li",{children:"â€¢ Streaks reset on missed days"}),e.jsx("li",{children:"â€¢ Long streaks unlock special achievements"})]})},{id:"level-progression",title:"ðŸ“Š Level Progression",color:"purple",content:e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Multiple skill-based sub-levels"}),e.jsx("li",{children:"â€¢ Sterilization, inventory, and environmental"}),e.jsx("li",{children:"â€¢ Rank against other users"}),e.jsx("li",{children:"â€¢ Unlock new features as you progress"})]})}],p=x=>{const f=s.has(x.id),v={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[x.color];return e.jsxs("div",{className:`${v.bg} ${v.border} border rounded-lg overflow-hidden`,children:[e.jsxs("button",{onClick:()=>n(x.id),className:`w-full p-3 text-left flex items-center justify-between ${v.hover} transition-colors`,children:[e.jsx("h5",{className:`font-medium ${v.text}`,children:x.title}),e.jsx("span",{className:`${v.icon} text-lg transition-transform duration-200`,children:f?"âˆ’":"+"})]}),f&&e.jsxs("div",{className:"px-3 pb-3",children:[x.content,x.slug&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>l(x.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“–"}),"Read Full Article"]})})]})]},x.id)};if(c)return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const m=a.length>0?a.map(x=>({id:x.slug,title:x.title,color:"blue",slug:x.slug,content:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:x.excerpt||'Click "Read Full Article" to learn more about gamification.'})})})):d;return e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>t("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"How points, levels, and streaks work"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Earning and Progress"}),m.map(p)]})})]})},km=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"AI Features"}),e.jsx("p",{className:"text-xs text-gray-500",children:"How AI improves your workflow"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"AI-Powered Assistance"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Smart Task Generation"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ AI creates relevant daily tasks"}),e.jsx("li",{children:"â€¢ Adapts to your facility's needs"}),e.jsx("li",{children:"â€¢ Suggests optimal task sequences"}),e.jsx("li",{children:"â€¢ Learns from your preferences"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Optimization"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Real-time efficiency monitoring"}),e.jsx("li",{children:"â€¢ Predictive maintenance alerts"}),e.jsx("li",{children:"â€¢ Resource optimization suggestions"}),e.jsx("li",{children:"â€¢ Compliance risk mitigation"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Intelligent Insights"}),e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Data-driven recommendations"}),e.jsx("li",{children:"â€¢ Trend analysis and forecasting"}),e.jsx("li",{children:"â€¢ Best practice suggestions"}),e.jsx("li",{children:"â€¢ Continuous improvement tips"})]})]})]})})]}),Im=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"New Features"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Discover what's new in Cliniio"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"What's New in Cliniio"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Latest Updates"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Enhanced AI assistance capabilities"}),e.jsx("li",{children:"â€¢ Improved task management system"}),e.jsx("li",{children:"â€¢ New gamification features"}),e.jsx("li",{children:"â€¢ Enhanced reporting and analytics"})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Improvements"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Faster page loading times"}),e.jsx("li",{children:"â€¢ Better mobile responsiveness"}),e.jsx("li",{children:"â€¢ Improved accessibility features"}),e.jsx("li",{children:"â€¢ Enhanced security measures"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Coming Soon"}),e.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Advanced workflow automation"}),e.jsx("li",{children:"â€¢ Integration with external systems"}),e.jsx("li",{children:"â€¢ Enhanced mobile app features"}),e.jsx("li",{children:"â€¢ More customization options"})]})]})]})})]}),Pm=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Sterilization Workflow"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sterilization processes and procedures"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"Sterilization workflow content coming soon."})})})]}),Dm=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Reporting and Compliance"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Documentation and regulatory compliance procedures"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"Reporting and compliance content coming soon."})})})]}),Em=({onBack:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"â† Back"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"BI Testing"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Biological indicator testing protocols"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"BI testing content coming soon."})})})]}),Om=({selectedHelpType:r,currentContext:t,expandedMetrics:s,expandedTasks:n,expandedGamification:a,expandedRelevant:i,onOptionClick:c,onBack:o,onFeedbackSuccess:l,onToggleMetricSection:d,onToggleTaskSection:p,onToggleGamificationSection:m,onToggleRelevantSection:x,onSetHelpType:f})=>{if(!r)return e.jsx(Ka,{onOptionClick:c});switch(r){case"ai-chat":return e.jsx(pm,{currentContext:t,onBack:o});case"context-help":return e.jsx(hm,{currentContext:t,expandedRelevant:i,onToggleRelevantSection:x,onBack:o});case"product-feedback":return e.jsx(ym,{onBack:o,onSuccess:l});case"onboarding":return e.jsx(vm,{onBack:o});case"cliniio-help":return e.jsx(jm,{currentContext:t,onBack:o,onSetHelpType:f});case"performance-metrics":return e.jsx(Nm,{onBack:o,expandedMetrics:s,onToggleMetricSection:d,onSetHelpType:f});case"task-management":return e.jsx(Sm,{onBack:o,onSetHelpType:f,expandedTasks:n,onToggleTaskSection:p});case"gamification":return e.jsx(Tm,{onBack:o,onSetHelpType:f,expandedGamification:a,onToggleGamificationSection:m});case"ai-features":return e.jsx(km,{onBack:o});case"new-features":return e.jsx(Im,{onBack:o});case"bi-testing":return e.jsx(Em,{onBack:o});case"sterilization-workflow":return e.jsx(Pm,{onBack:o});case"reporting-compliance":return e.jsx(Dm,{onBack:o});default:return e.jsx(Ka,{onOptionClick:c})}},$m=({isDrawerOpen:r,onClose:t})=>{const{selectedHelpType:s,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,currentContext:o,handleOptionClick:l,handleBack:d,handleFeedbackSuccess:p,toggleMetricSection:m,toggleTaskSection:x,toggleGamificationSection:f,toggleRelevantSection:g,setHelpType:v}=um(t),j=()=>e.jsx(Om,{selectedHelpType:s,currentContext:o,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,onOptionClick:l,onBack:d,onFeedbackSuccess:p,onToggleMetricSection:m,onToggleTaskSection:x,onToggleGamificationSection:f,onToggleRelevantSection:g,onSetHelpType:v});return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t,onKeyDown:h=>h.key==="Escape"&&t(),role:"button",tabIndex:0,"aria-label":"Close help drawer"}),e.jsxs("div",{className:"fixed top-0 right-0 h-screen w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out flex flex-col",children:[e.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-[#4ECDC4] text-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"?"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Help & Support"}),e.jsx("p",{className:"text-xs text-white text-opacity-90",children:"Choose how you'd like to get help"})]})]})}),j()]})]}):null},Am=()=>{const[r,t]=u.useState(!1),s=()=>{t(!r)},n=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{onClick:s,className:"w-14 h-14 bg-transparent text-gray-700 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 relative flex items-center justify-center","aria-label":"Get AI help and assistance",title:"AI Help & Assistant",children:e.jsx("span",{className:"text-6xl",children:"ðŸ›Ÿ"})})}),e.jsx($m,{isDrawerOpen:r,onClose:n})]})};var Rm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const cv=({children:r,hasComplianceIssues:t,hasAIUsageIssues:s})=>{const{isDrawerOpen:n,openDrawer:a,closeDrawer:i}=_c(),[c,o]=u.useState(!1);u.useEffect(()=>{function d(){return Rm(this,null,function*(){try{const{data:m,error:x}=yield Q.from("audit_flags").select("id").eq("resolved",!1).limit(1);x||o(m&&m.length>0)}catch(m){console.error("Failed to check compliance issues:",m)}})}d();const p=()=>{setTimeout(()=>{d()},1e3)};return window.addEventListener("complianceIssueResolved",p),()=>window.removeEventListener("complianceIssueResolved",p)},[]);const l=t!==void 0?t:c;return e.jsx(Ac,{children:e.jsxs(u.Suspense,{fallback:e.jsx(cm,{size:"lg"}),children:[e.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-blue-50 to-teal-50",children:[e.jsx(im,{isOpen:n,onOpen:a,onClose:i,hasComplianceIssues:l,hasAIUsageIssues:s||!1}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"pt-6",children:r})})]}),e.jsx(Am,{})]})})},Gs=["Welcome back, sterilization superstar! âœ¨","Hey there, inventory rockstar! ðŸŽ¸","The clinic's MVP is back in action! ðŸ†","Welcome to another day of medical excellence! ðŸŒŸ","Ready to tackle some sterilization challenges? ðŸ’ª","Back in the clinic and ready to shine! âœ¨","Time to make those tools gleam! âœ¨","Welcome back! The tools missed you! ðŸ”§","Let's make today spotlessly successful! âœ¨","Ready to master the medical inventory? ðŸ“‹","The sterilization superstar has arrived! ðŸŒŸ","Let's make those tools SHINE today! âœ¨","Welcome back to your sterilization kingdom! ðŸ‘‘","Ready to conquer today's challenge? Let's do this! ðŸ…","Another day, another challenge to crush! ðŸš€","Your daily challenge awaitsâ€”show it who's boss! ðŸ’ª","Inventory hero reporting for duty! ðŸ“¦","Let's keep those supplies in tip-top shape! ðŸ—‚ï¸","Inventory wizardry in progressâ€”abracadabra! ðŸ§™â€â™‚ï¸","Time to check off those tasks like a pro! âœ…","Taskmaster mode: activated! ðŸ•¹ï¸","Let's make that to-do list disappear! âœ¨","Sparkle squad, assemble! ðŸ§½","Let's make every room shine bright! ðŸ’¡","Clean team, ready for action! ðŸ¦¸â€â™€ï¸","Knowledge quest begins now! ðŸ“š","Time to level up your skills! ðŸŽ®","Learning legend in the house! ðŸ†"],Bm=()=>{const[r,t]=u.useState(Gs[0]);return u.useEffect(()=>{const s=Math.floor(Math.random()*Gs.length);setTimeout(()=>{t(Gs[s])},0)},[]),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-[#5b5b5b] mb-2",children:r})},Ii=({content:r,children:t,className:s=""})=>{const[n,a]=u.useState(!1);return e.jsxs("div",{className:`relative inline-block ${s}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[t,n&&e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50",children:e.jsx("div",{className:"bg-white text-gray-700 text-xs font-medium px-3 py-2 rounded-lg shadow-lg border border-gray-200 text-center whitespace-pre-line",children:r})})]})},Fm=[{icon:Wo,bg:"teal",label:"Cumulative Stats",description:`Performance
Statistics`},{icon:gr,bg:"purple",label:"Leaderboard",description:`Team
Rankings`},{icon:ii,bg:"blue",label:"Daily Challenge",description:`Daily
Challenge`}],dv=({onStatsClick:r,onLeaderboardClick:t,onChallengeClick:s})=>{const n=(a,i)=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),i==null||i())};return e.jsxs("header",{className:"mb-6 pl-8","aria-label":"Dashboard header","data-testid":"nav-bar",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Bm,{}),e.jsx("nav",{className:"flex gap-4 pr-8",role:"navigation","aria-label":"Dashboard actions",children:Fm.map(a=>{const i=a.label==="Cumulative Stats"?r:a.label==="Leaderboard"?t:a.label==="Daily Challenge"?s:void 0;return e.jsx(Ii,{content:a.description,children:e.jsx("button",{className:`rounded-xl w-12 h-12 flex items-center justify-center transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 ${a.label==="Cumulative Stats"?"bg-purple-100 focus:ring-purple-500":a.label==="Leaderboard"?"bg-amber-100 focus:ring-amber-500":"bg-blue-100 focus:ring-blue-500"}`,"aria-label":`${a.label}: ${a.description}`,onClick:i,onKeyDown:c=>n(c,i),tabIndex:0,children:e.jsx(C,{path:a.icon,size:1.1,"aria-hidden":"true",color:a.label==="Cumulative Stats"?"#9333ea":a.label==="Leaderboard"?"#d97706":"#2563eb"})})},a.label)})})]}),e.jsx("p",{className:"text-sm text-gray-500",role:"status","aria-live":"polite",children:"Here's your impact and progress for today."})]})},ct={NAV_BAR_MARGIN_TOP:4,NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:24,NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED:72,COLORS:{PRIMARY:"#4ECDC4",PRIMARY_BG:"teal-100",BORDER:"teal-400",BG_GRADIENT:{FROM:"blue-50",TO:"teal-50"}},SPACING:{PADDING:6,MARGIN_TOP:6},BORDER:{LEFT_WIDTH:4},taskCard:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50",sectionBox:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50"},uv=r=>{const t=r?ct.NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:ct.NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED,s=ct.NAV_BAR_MARGIN_TOP;return{navBarMarginLeft:t,navBarMarginTop:s}};function Mm(){return rs(ct.sectionBox,"mb-4")}function Ks(){return rs(ct.taskCard,"mb-4")}var Lm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const zm=()=>{const[r,t]=u.useState({toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}),[s,n]=u.useState(!0),[a,i]=u.useState(null),c=u.useCallback(()=>Lm(null,null,function*(){try{n(!0),i(null);const l=yield Fo.fetchCumulativeStats();t(l)}catch(l){console.error("Error fetching cumulative stats:",l),i(l instanceof Error?l.message:"Failed to fetch stats")}finally{n(!1)}}),[]);u.useEffect(()=>{c()},[c]);const o=u.useCallback(()=>{c()},[c]);return{stats:r,loading:s,error:a,refreshStats:o}},Um=({isOpen:r,onClose:t,gamificationData:s})=>{const{stats:n,loading:a,error:i,refreshStats:c}=zm(),o=(s==null?void 0:s.stats)||{toolsSterilized:n.toolsSterilized,inventoryChecks:n.inventoryChecks,perfectDays:n.perfectDays,totalTasks:n.totalTasks,completedTasks:n.completedTasks,currentStreak:n.currentStreak,bestStreak:n.bestStreak};return e.jsx(As,{children:r&&e.jsx(me.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:e.jsxs(me.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:e.jsx(C,{path:_t,size:.9,className:"text-white"})}),e.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:"Cumulative Stats"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,disabled:a,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg disabled:opacity-50",title:"Refresh stats",children:e.jsx(C,{path:ts,size:.9,className:a?"animate-spin":""})}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg",children:e.jsx(C,{path:ae,size:.9})})]})]}),i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[e.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Stats"}),e.jsx("div",{className:"text-red-500 text-xs mt-1",children:i})]}),e.jsxs("div",{className:"space-y-3",children:[a&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4] mx-auto"}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading stats..."})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-[#4ECDC4] bg-opacity-10 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-[#4ECDC4] font-semibold text-sm",children:"Tools Sterilized"}),e.jsx("div",{className:"text-2xl font-bold text-[#4ECDC4]",children:o.toolsSterilized}),e.jsx("div",{className:"text-xs text-[#4ECDC4] mt-0.5",children:"That's impressive!"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-blue-600 font-semibold text-sm",children:"Inventory Checks"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:o.inventoryChecks}),e.jsx("div",{className:"text-xs text-blue-500 mt-0.5",children:"Always organized!"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-green-600 font-semibold text-sm",children:"Perfect Days"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:o.perfectDays}),e.jsx("div",{className:"text-xs text-green-500 mt-0.5",children:"Zero errors!"})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-purple-600 font-semibold text-sm",children:"Task Completion"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[o.totalTasks>0?Math.round(o.completedTasks/o.totalTasks*100):0,"%"]}),e.jsxs("div",{className:"text-xs text-purple-500 mt-0.5",children:[o.completedTasks," / ",o.totalTasks," tasks completed"]})]}),e.jsxs("div",{className:"bg-amber-50 p-3 rounded-xl",children:[e.jsx("div",{className:"mb-0.5 text-amber-600 font-semibold text-sm",children:"Current Streak"}),e.jsx("div",{className:"text-2xl font-bold text-amber-700",children:o.currentStreak}),e.jsxs("div",{className:"text-xs text-amber-500 mt-0.5",children:["Best streak: ",o.bestStreak]})]})]})]})]})})})};var qm=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Hm=({isOpen:r,onClose:t,gamificationData:s,loading:n=!1,error:a=null})=>{const[i,c]=u.useState("All"),[o,l]=u.useState([]);u.useEffect(()=>{qm(null,null,function*(){try{let m=Q.from("user_gamification_stats").select("user_id, total_xp, category");i!=="All"&&(m=m.eq("category",i.toLowerCase()));const{data:x,error:f}=yield m.order("total_xp",{ascending:!1}).limit(10);if(f)throw f;l(x||[])}catch(m){console.error("Error fetching leaderboard:",m)}})},[i]);const d={rank:(s==null?void 0:s.rank)||1,topUsers:(s==null?void 0:s.topUsers)||[]};return e.jsx(As,{children:r&&e.jsx(me.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:e.jsxs(me.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-6 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-blue-500 rounded-xl",children:e.jsx(C,{path:gr,size:1,className:"text-white"})}),e.jsx("h2",{className:"ml-3 text-xl font-bold text-[#5b5b5b]",children:"Office Leaderboard"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-blue-700 font-medium",children:"Your Rank"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xl font-bold text-blue-700 mr-1",children:["#",d.rank]}),e.jsx("span",{className:"text-blue-500 text-sm",children:"/15"})]})]}),a&&e.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[e.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Leaderboard"}),e.jsx("div",{className:"text-red-500 text-xs mt-1",children:a})]}),e.jsx("div",{className:"flex gap-2 mb-4 justify-center",children:["All","Learning","Cleaning","Challenges"].map(p=>e.jsx("button",{onClick:()=>c(p),className:`px-3 py-1 rounded-full text-sm font-medium border transition ${i===p?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-100"}`,children:p},p))}),e.jsxs("div",{className:"space-y-3",children:[n&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading leaderboard..."})]}),!n&&!a&&d.topUsers.map((p,m)=>e.jsxs(me.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:m*.2+.2},className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-semibold",children:p.avatar}),m===0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center",children:e.jsx(C,{path:gr,size:.4,className:"text-white"})})]}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700",children:p.full_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Rank #",m+1]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg font-bold text-[#4ECDC4]",children:p.score}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"pts"})]})]},p.id||p.full_name))]})]})})})},Vm=Z.memo(Hm),Fr={TASKS:"Daily Operations Tasks",STATS:"Stats Overview",CHALLENGES:"Today's Challenge"};var Wm=Object.defineProperty,Gm=Object.defineProperties,Km=Object.getOwnPropertyDescriptors,Qa=Object.getOwnPropertySymbols,Qm=Object.prototype.hasOwnProperty,Ym=Object.prototype.propertyIsEnumerable,Ya=(r,t,s)=>t in r?Wm(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Jm=(r,t)=>{for(var s in t||(t={}))Qm.call(t,s)&&Ya(r,s,t[s]);if(Qa)for(var s of Qa(t))Ym.call(t,s)&&Ya(r,s,t[s]);return r},Xm=(r,t)=>Gm(r,Km(t)),Ja=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Zm={knowledge:"bg-blue-100 text-blue-800",process:"bg-purple-100 text-purple-800",quality:"bg-green-100 text-green-800",collaboration:"bg-orange-100 text-orange-800",daily:"bg-gray-100 text-gray-800",team:"bg-pink-100 text-pink-800"},ep={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"},tp=({isOpen:r,onClose:t,onChallengeComplete:s})=>{const[n,a]=u.useState("all"),[i,c]=u.useState("all"),[o,l]=u.useState("pending"),[d,p]=u.useState([]),[m,x]=u.useState(!0);u.useEffect(()=>{Ja(null,null,function*(){try{x(!0);const b=(yield Vr.fetchUserChallenges()).map(_=>({id:_.id,title:_.title,description:_.description,category:_.category,difficulty:_.difficulty,points:_.points,timeEstimate:_.time_estimate,completed:_.isCompleted||!1}));p(b)}catch(y){console.error("Error loading challenges:",y)}finally{x(!1)}})},[]);const f=[{id:"knowledge",icon:Go,label:"Knowledge"},{id:"process",icon:Ko,label:"Process"},{id:"quality",icon:Qo,label:"Quality"},{id:"collaboration",icon:Kr,label:"Collaboration"},{id:"daily",icon:Yo,label:"Daily"},{id:"team",icon:Kr,label:"Team"}],g=[{id:"easy",label:"Easy",color:"text-green-500"},{id:"medium",label:"Medium",color:"text-yellow-500"},{id:"hard",label:"Hard",color:"text-red-500"}],v=d.filter(h=>{const y=n==="all"||h.category===n,b=i==="all"||h.difficulty===i,_=o==="all"||o==="pending"&&!h.completed||o==="completed"&&h.completed;return y&&b&&_}),j=h=>Ja(null,null,function*(){try{(yield Vr.completeChallenge({challenge_id:h.id,points_earned:h.points}))?(p(b=>b.map(_=>_.id===h.id?Xm(Jm({},_),{completed:!0}):_)),s(h.points)):console.error("Failed to complete challenge")}catch(y){console.error("Error completing challenge:",y)}});return e.jsx(As,{children:r&&e.jsx(me.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:e.jsxs(me.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto scrollbar-hide",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:e.jsx(C,{path:ii,size:.9,className:"text-white"})}),e.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:Fr.CHALLENGES})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:.9})})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Category"}),e.jsxs("select",{value:n,onChange:h=>a(h.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Categories"}),f.map(h=>e.jsx("option",{value:h.id,children:h.label},h.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Difficulty"}),e.jsxs("select",{value:i,onChange:h=>c(h.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),g.map(h=>e.jsx("option",{value:h.id,children:h.label},h.id))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Status"}),e.jsxs("select",{value:o,onChange:h=>l(h.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Challenges"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsx("div",{className:"space-y-3",children:m?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading challenges..."})}):v.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"No challenges available"})}):v.map(h=>e.jsx("div",{className:`p-3 rounded-lg border ${h.completed?"bg-gray-50 border-gray-200":"bg-white border-gray-200 hover:border-[#4ECDC4]"}`,children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Zm[h.category]}`,children:h.category}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${ep[h.difficulty]}`,children:h.difficulty}),e.jsx("span",{className:"text-xs text-gray-500",children:h.timeEstimate})]}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-0.5",children:h.title}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:h.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-[#4ECDC4]",children:[h.points," points"]}),!h.completed&&e.jsx("button",{onClick:()=>j(h),className:"px-3 py-1 bg-[#4ECDC4] text-white text-xs rounded-lg hover:bg-[#38b2ac] transition-colors",children:"Complete"}),h.completed&&e.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[e.jsx(C,{path:Jo,size:.8,className:"mr-1"}),"Completed"]})]})]})})},h.id))})]})})})},mv=({isStatsOpen:r,onStatsClose:t,isLeaderboardOpen:s,onLeaderboardClose:n,isChallengeOpen:a,onChallengeClose:i,gamificationData:c,leaderboardRank:o,leaderboardTopUsers:l,leaderboardLoading:d=!1,leaderboardError:p=null})=>{const[m,x]=u.useState({rank:o,topUsers:l}),[f,g]=u.useState(!1),[v,j]=u.useState(null);u.useEffect(()=>{s&&l.length===0&&(setTimeout(()=>{g(!0),j(null)},0),Mo.fetchLeaderboardData().then(y=>{x({rank:1,topUsers:(y==null?void 0:y.map(b=>({id:b.user_id,name:b.user_name||"Anonymous",score:b.points||0,avatar:"ðŸ‘¤"})))||[]})}).catch(y=>{j(y.message||"Failed to load leaderboard")}).finally(()=>{g(!1)}))},[s,l.length]);const h={stats:c.stats||{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}};return e.jsxs(e.Fragment,{children:[r&&e.jsx(Um,{isOpen:r,onClose:t,gamificationData:h}),e.jsx(Vm,{isOpen:s,onClose:n,gamificationData:m,loading:f,error:v}),e.jsx(tp,{isOpen:a,onClose:i,onChallengeComplete:y=>{console.log("Challenge completed with points:",y)}})]})},le=({path:r,size:t=24,color:s="currentColor",className:n})=>e.jsx(xo.Icon,{path:r,size:t,color:s,className:n}),pv=({currentPage:r,totalPages:t,onPageChange:s,onNextPage:n,onPreviousPage:a,hasNextPage:i,hasPreviousPage:c,isLoading:o=!1,className:l=""})=>{if(t<=1)return null;const d=()=>{const p=[];if(t<=5)for(let x=1;x<=t;x++)p.push(x);else if(r<=3){for(let x=1;x<=4;x++)p.push(x);p.push("..."),p.push(t)}else if(r>=t-2){p.push(1),p.push("...");for(let x=t-3;x<=t;x++)p.push(x)}else{p.push(1),p.push("...");for(let x=r-1;x<=r+1;x++)p.push(x);p.push("..."),p.push(t)}return p};return e.jsxs("div",{className:`flex items-center justify-center space-x-2 ${l}`,children:[e.jsxs("button",{onClick:a,disabled:!c||o,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${c&&!o?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:[e.jsx(le,{path:Xo,size:16,className:"mr-1"}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-1",children:d().map((p,m)=>e.jsx(Z.Fragment,{children:p==="..."?e.jsx("span",{className:"px-3 py-2 text-sm text-gray-500",children:"..."}):e.jsx("button",{onClick:()=>s(p),disabled:o,className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${p===r?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"} ${o?"cursor-not-allowed":""}`,children:p})},m))}),e.jsxs("button",{onClick:n,disabled:!i||o,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${i&&!o?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:["Next",e.jsx(le,{path:ss,size:16,className:"ml-1"})]}),e.jsxs("div",{className:"ml-4 text-sm text-gray-500",children:["Page ",r," of ",t]})]})},xv=({onLoadMore:r,hasMore:t,isLoading:s,className:n="",buttonText:a="Load More",loadingText:i="Loading..."})=>t?e.jsx("div",{className:`flex justify-center ${n}`,children:e.jsx("button",{onClick:r,disabled:s,className:"flex items-center px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?e.jsxs(e.Fragment,{children:[e.jsx(le,{path:Or,size:16,className:"animate-spin mr-2"}),i]}):e.jsxs(e.Fragment,{children:[a,e.jsx(le,{path:mt,size:16,className:"ml-2"})]})})}):null;var sp=Object.defineProperty,rp=Object.defineProperties,ap=Object.getOwnPropertyDescriptors,Xa=Object.getOwnPropertySymbols,np=Object.prototype.hasOwnProperty,lp=Object.prototype.propertyIsEnumerable,Za=(r,t,s)=>t in r?sp(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Qs=(r,t)=>{for(var s in t||(t={}))np.call(t,s)&&Za(r,s,t[s]);if(Xa)for(var s of Xa(t))lp.call(t,s)&&Za(r,s,t[s]);return r},Ys=(r,t)=>rp(r,ap(t)),ip=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const op=({task:r,isOpen:t,onClose:s,onSave:n})=>{const[a,i]=u.useState({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),[c,o]=u.useState({}),[l,d]=u.useState(!1),[p,m]=u.useState(null);u.useEffect(()=>{r&&(i({title:r.title||"",description:r.description||"",priority:r.priority||"medium",dueDate:r.dueDate?new Date(r.dueDate).toISOString().split("T")[0]:"",status:r.status||"pending"}),o({}),m(null))},[r]),u.useEffect(()=>{t||(i({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),o({}),m(null),d(!1))},[t]);const x=u.useCallback(()=>{const j={};if(a.title.trim()?a.title.trim().length<3?j.title="Title must be at least 3 characters long":a.title.trim().length>100&&(j.title="Title must be less than 100 characters"):j.title="Title is required",a.description.trim().length>500&&(j.description="Description must be less than 500 characters"),a.dueDate){const h=new Date(a.dueDate),y=new Date;y.setHours(0,0,0,0),h<y&&(j.dueDate="Due date cannot be in the past")}return o(j),Object.keys(j).length===0},[a]),f=u.useCallback((j,h)=>{i(y=>Ys(Qs({},y),{[j]:h})),c[j]&&o(y=>Ys(Qs({},y),{[j]:void 0}))},[c]),g=u.useCallback(j=>ip(null,null,function*(){if(j.preventDefault(),!!r&&x()){d(!0),m(null);try{const h=Ys(Qs({},r),{title:a.title.trim(),description:a.description.trim()||void 0,priority:a.priority,dueDate:a.dueDate||new Date().toISOString(),status:a.status});yield n(r.id,h),s()}catch(h){m(h instanceof Error?h.message:"Failed to save task")}finally{d(!1)}}}),[r,a,x,n,s]),v=u.useCallback(()=>{l||s()},[l,s]);return u.useEffect(()=>{const j=h=>{h.key==="Escape"&&t&&!l&&s()};if(t)return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[t,l,s]),!t||!r?null:e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:v,onKeyDown:j=>{j.key==="Escape"&&v()},role:"button",tabIndex:0,"aria-label":"Close modal"}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-md transform overflow-hidden rounded-lg bg-white shadow-xl transition-all",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Task"}),e.jsx("button",{onClick:v,disabled:l,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50","aria-label":"Close modal",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("form",{onSubmit:g,className:"px-6 py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),e.jsx("input",{type:"text",id:"title",value:a.title,onChange:j=>f("title",j.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.title?"border-red-300":"border-gray-300"}`,placeholder:"Enter task title",disabled:l}),c.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.title})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{id:"description",value:a.description,onChange:j=>f("description",j.target.value),rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.description?"border-red-300":"border-gray-300"}`,placeholder:"Enter task description (optional)",disabled:l}),c.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.description}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[a.description.length,"/500 characters"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{id:"priority",value:a.priority,onChange:j=>f("priority",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",id:"dueDate",value:a.dueDate,onChange:j=>f("dueDate",j.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.dueDate?"border-red-300":"border-gray-300"}`,disabled:l}),c.dueDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.dueDate})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",value:a.status,onChange:j=>f("status",j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),p&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800",children:p})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:v,disabled:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:l?"Saving...":"Save Changes"})]})]})]})})]})};var cp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const dp=({tasks:r,onTaskComplete:t,onTaskUpdate:s})=>{const[n,a]=u.useState(1),[i,c]=u.useState(null),[o,l]=u.useState(null),[d,p]=u.useState(!1),m=10,x=u.useCallback(S=>{if(!S.dueDate)return!1;const I=new Date(S.dueDate);return(new Date().getTime()-I.getTime())/(1e3*60*60)<=24},[]),f=u.useCallback(S=>{const I="task-item border rounded-lg p-4 mb-2",D=x(S);return rs(I,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":D,"shadow-sm":!D})},[x]),g=u.useMemo(()=>Array.isArray(r)?r:[],[r]),v=u.useMemo(()=>g.filter(S=>S.status!=="completed"),[g]),j=u.useMemo(()=>Math.max(1,Math.ceil(v.length/m)),[v.length,m]),h=u.useMemo(()=>(n-1)*m,[n,m]),y=u.useMemo(()=>h+m,[h,m]),b=u.useMemo(()=>v.slice(h,y),[v,h,y]),_=u.useCallback(S=>{c(I=>I===S?null:S)},[]),E=u.useCallback(S=>{l(S),p(!0)},[]),$=u.useCallback((S,I)=>cp(null,null,function*(){if(s)try{yield s(S,I),p(!1),l(null)}catch(D){console.error("Failed to update task:",D)}}),[s]),P=u.useCallback(()=>{p(!1),l(null)},[]),w=u.useCallback(()=>{a(S=>Math.max(1,S-1))},[]),T=u.useCallback(()=>{a(S=>Math.min(j,S+1))},[j]),k=u.useMemo(()=>b.map(S=>e.jsxs("div",{className:f(S),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>_(S.id),className:"text-gray-400 hover:text-gray-600","aria-label":i===S.id?"Collapse task details":"Expand task details",children:e.jsx("span",{className:`transform transition-transform ${i===S.id?"rotate-90":""}`,children:"â–¶"})}),e.jsx("span",{className:"font-medium",children:S.title}),x(S)&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-[#4ECDC4] bg-[#4ECDC4] bg-opacity-10 px-2 py-1 rounded-full",children:["+",S.points||0," pts"]}),e.jsx("button",{onClick:()=>E(S),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Edit"}),t&&e.jsx("button",{onClick:()=>t(S.id,S.points||0),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Complete"})]})]}),i===S.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:S.description}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Priority: ",S.priority]}),e.jsxs("div",{children:["Status: ",S.status]}),e.jsxs("div",{children:["Points: ",S.points||0]}),S.dueDate&&e.jsxs("div",{children:["Due: ",new Date(S.dueDate).toLocaleDateString()]})]})]})]},S.id)),[b,i,_,E,t,f,x]);return v.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No tasks available"}):e.jsxs("div",{className:"space-y-4",children:[k,j>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsx("button",{onClick:w,disabled:n===1,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",n," of ",j]}),e.jsx("button",{onClick:T,disabled:n===j,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsx(op,{task:o,isOpen:d,onClose:P,onSave:$})]})},up={COMPLETE:"Complete"};var mp=Object.defineProperty,pp=Object.defineProperties,xp=Object.getOwnPropertyDescriptors,en=Object.getOwnPropertySymbols,hp=Object.prototype.hasOwnProperty,gp=Object.prototype.propertyIsEnumerable,tn=(r,t,s)=>t in r?mp(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,gt=(r,t)=>{for(var s in t||(t={}))hp.call(t,s)&&tn(r,s,t[s]);if(en)for(var s of en(t))gp.call(t,s)&&tn(r,s,t[s]);return r},cs=(r,t)=>pp(r,xp(t)),fp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const bp=r=>({id:r.id,title:r.title,description:r.description,status:r.status,priority:r.priority==="urgent"?"high":r.priority||"medium",due_date:r.dueDate,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),user_id:"",facility_id:"",completed:r.completed}),Pi=Z.memo(({onTaskComplete:r,onTaskUpdate:t,tasks:s,itemHeight:n=120,containerHeight:a=600})=>{const[i,c]=u.useState(null),[o,l]=u.useState(null),[d,p]=u.useState({}),[m,x]=u.useState(0),f=u.useRef(null),g=u.useCallback(D=>{if(!D.dueDate)return!1;const O=new Date(D.dueDate);return(new Date().getTime()-O.getTime())/(1e3*60*60)<=24},[]),v=u.useCallback(D=>{const O="rounded-xl border border-gray-200 p-4 bg-white mx-2",A=g(D);return rs(O,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":A,"shadow-sm":!A})},[g]),j=u.useMemo(()=>Array.isArray(s)?s:[],[s]),h=u.useMemo(()=>j.filter(D=>D.status!=="completed"),[j]),y=Math.ceil(a/n),b=Math.floor(m/n),_=Math.min(b+y+2,h.length),E=u.useMemo(()=>h.slice(b,_),[h,b,_]),$=h.length*n,P=u.useCallback(D=>{x(D.currentTarget.scrollTop)},[]),w=u.useCallback(D=>{c(O=>O===D?null:D)},[]),T=u.useCallback(D=>{l(D.id),p(D)},[]),k=u.useCallback(()=>{l(null),p({})},[]),S=u.useCallback(()=>fp(null,null,function*(){if(o)try{const D=h.find(V=>V.id===o);if(!D){console.error("Task not found for editing");return}const O=gt(gt({},D),d),A=bp(O),{createTaskService:R}=yield qe(()=>import("./services-CE_LtFqr.js").then(V=>V.aE),__vite__mapDeps([0,1,2,3,4,5,6,7,8]));yield R().updateTask(A),t&&t(o,O),l(null),p({})}catch(D){console.error("Failed to save task:",D)}}),[o,h,d,t]),I=u.useMemo(()=>E.map((D,O)=>{const R=(b+O)*n;return e.jsx("div",{className:"absolute w-full",style:{top:R,height:n},children:e.jsxs("div",{className:v(D),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("button",{onClick:()=>w(D.id),className:"mt-1 text-gray-400 hover:text-gray-600","aria-label":i===D.id?"Collapse task details":"Expand task details",children:e.jsx(ho,{className:`transform transition-transform ${i===D.id?"rotate-90":""}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:D.title}),g(D)&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:`${D.category||"General"} - ${D.type||"Training"} - Due: ${D.dueDate||"N/A"}`})]})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[e.jsxs("span",{className:"text-violet-600 font-semibold",children:["+",D.points," pts"]}),e.jsx("button",{onClick:()=>r==null?void 0:r(D.id,D.points||0),className:"rounded-full border border-green-500 text-green-500 text-sm px-3 py-1 hover:bg-green-50","aria-label":`Complete task: ${D.title}`,"data-testid":`task-checkbox-${D.id}`,children:up.COMPLETE})]})]}),i===D.id&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"text-sm space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`category-${D.id}`,className:"block text-gray-600 font-medium mb-1",children:"Category"}),o===D.id?e.jsx("input",{id:`category-${D.id}`,type:"text",value:d.category||"",onChange:B=>p(cs(gt({},d),{category:B.target.value})),className:"w-full px-3 py-2 border rounded-md"}):e.jsx("div",{className:"text-gray-700",children:D.category||"General"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`type-${D.id}`,className:"block text-gray-600 font-medium mb-1",children:"Type"}),o===D.id?e.jsx("input",{id:`type-${D.id}`,type:"text",value:d.type||"",onChange:B=>p(cs(gt({},d),{type:B.target.value})),className:"w-full px-3 py-2 border rounded-md"}):e.jsx("div",{className:"text-gray-700",children:D.type||"Training"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`dueDate-${D.id}`,className:"block text-gray-600 font-medium mb-1",children:"Due Date"}),o===D.id?e.jsx("input",{id:`dueDate-${D.id}`,type:"date",value:d.dueDate||"",onChange:B=>p(cs(gt({},d),{dueDate:B.target.value})),className:"w-full px-3 py-2 border rounded-md"}):e.jsx("div",{className:"text-gray-700",children:D.dueDate||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`points-${D.id}`,className:"block text-gray-600 font-medium mb-1",children:"Points"}),o===D.id?e.jsx("input",{id:`points-${D.id}`,type:"number",value:d.points||0,onChange:B=>p(cs(gt({},d),{points:parseInt(B.target.value)})),className:"w-full px-3 py-2 border rounded-md"}):e.jsxs("div",{className:"text-gray-700",children:[D.points||0," points"]})]})]}),e.jsx("div",{className:"mt-4 space-y-4",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:()=>T(D),className:"rounded-full border border-violet-500 text-violet-500 text-sm px-3 py-1 hover:bg-violet-50","aria-label":`Edit task: ${D.title}`,children:[e.jsx(go,{className:"inline-block mr-1"}),"Edit"]})})})}),o===D.id&&e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-violet-600 text-white rounded-md hover:bg-violet-700",children:"Save"})]})]})]})]})},D.id)}),[E,b,n,i,o,d,w,r,T,k,S,v,g]);return e.jsx("div",{ref:f,className:"relative overflow-auto",style:{height:a},onScroll:P,children:e.jsx("div",{style:{height:$,position:"relative"},children:I})})});Pi.displayName="VirtualizedTasksList";const sn={categories:[{value:"operations",label:"Operations"},{value:"maintenance",label:"Maintenance"},{value:"safety",label:"Safety"}],types:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}]},yp=({selectedCategory:r,selectedType:t,onCategoryChange:s,onTypeChange:n})=>e.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:r,onChange:a=>s(a.target.value),children:[e.jsx("option",{value:"",children:"Category"}),sn.categories.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:t,onChange:a=>n(a.target.value),children:[e.jsx("option",{value:"",children:"Type"}),sn.types.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",children:[e.jsx("option",{value:"",children:"Due Date"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"tomorrow",children:"Tomorrow"}),e.jsx("option",{value:"this_week",children:"This Week"})]})]})}),vp=(r,t,s)=>{if(!r||r.length===0)return[];let n=r;return t&&(n=n.filter(a=>a.category===t)),s&&(n=n.filter(a=>a.type===s)),n},jp=({tasks:r,onTaskComplete:t,onTaskUpdate:s,availablePoints:n,showFilters:a,onToggleFilters:i,selectedCategory:c,selectedType:o,onCategoryChange:l,onTypeChange:d,isLoading:p=!1})=>{const m=u.useMemo(()=>{if(r)return vp(r,c,o)},[r,c,o]),x=u.useMemo(()=>m&&m.length>50,[m]);return p?e.jsx("div",{className:`${Ks()} h-full`,"data-testid":"tasks-list",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((f,g)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]},g))})]})}):r?e.jsxs("div",{className:`${Ks()} h-full`,"data-testid":"tasks-list",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`bg-${ct.COLORS.PRIMARY_BG} rounded-md p-1`,children:e.jsx(C,{path:fr,size:1,color:ct.COLORS.PRIMARY})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:Fr.TASKS})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"px-3 py-2 text-sm font-semibold bg-[#4ECDC4] bg-opacity-10 text-[#4ECDC4] border border-[#4ECDC4] border-opacity-30 rounded-lg",children:["ðŸ“Š Total Available: ",n," Points"]}),e.jsxs("button",{onClick:i,className:"p-2 bg-[#4ECDC4] hover:bg-[#38b2ac] rounded-lg text-white flex items-center transition-colors duration-200",children:[e.jsx(C,{path:$r,size:.8}),e.jsx("span",{className:"ml-1 text-sm hidden sm:inline-block",children:"Filter"})]})]})]}),a&&e.jsx(yp,{selectedCategory:c,selectedType:o,onCategoryChange:l,onTypeChange:d}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto h-full",children:x?e.jsx(Pi,{tasks:m,onTaskComplete:t,onTaskUpdate:s,itemHeight:120,containerHeight:600}):e.jsx(dp,{tasks:m,onTaskComplete:t,onTaskUpdate:s})})]}):e.jsx("div",{className:`${Ks()} h-full`,"data-testid":"tasks-list",children:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-gray-500 text-center",children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:"No tasks available"}),e.jsx("div",{className:"text-sm",children:"Tasks will appear here when they become available."})]})})})},hv=u.memo(jp),gv=({message:r="Something went wrong."})=>e.jsx("div",{role:"alert","aria-live":"assertive",className:"text-sm text-red-600 mt-2",children:r}),wp=({data:r})=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"bg-blue-100 rounded-md p-2 mr-3",children:e.jsx(Ql,{size:20,className:"text-[#2563eb]"})}),e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Time Savings"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Day)"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:[r.daily," hrs"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Month)"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:[r.monthly," hrs"]})]})]})]}),Np=({data:r={monthly:0,annual:0}})=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"bg-green-100 rounded-md p-2 mr-3",children:e.jsx(fo,{size:20,className:"text-green-800"})}),e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Cost Savings"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Monthly Savings"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(r.monthly||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Annual Savings"}),e.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(r.annual||0).toLocaleString()]})]})]})]});var Cp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Sp=({timeframe:r="daily",aiImpactMetrics:t})=>{const[s,n]=u.useState(null),[a,i]=u.useState(!0),c=u.useRef(0);if(u.useEffect(()=>{if(t){console.log("ðŸ¤– EnhancedAiEfficiencyCard: Using pre-loaded AI metrics:",t),n(t),i(!1);return}console.log("ðŸ¤– EnhancedAiEfficiencyCard: No pre-loaded metrics, fetching independently...");const m=()=>Cp(null,null,function*(){try{i(!0);const f=yield Lo.getAIImpactMetrics();n(f)}catch(f){console.error("Error fetching AI metrics:",f)}finally{i(!1)}});m();const x=setInterval(m,120*1e3);return()=>clearInterval(x)},[t]),a)return e.jsx("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"bg-purple-200 rounded-md p-2 mr-3 w-10 h-10"}),e.jsx("div",{className:"h-5 bg-gray-200 rounded w-32"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})});const o=s||{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},costSavings:{daily:0,monthly:0,annual:0,roi:0}},l=()=>{const m=(()=>{switch(r){case"daily":return o.timeSavings.daily;case"weekly":return o.timeSavings.weekly;case"monthly":return o.timeSavings.monthly;default:return o.timeSavings.daily}})(),x=Date.now();return x-c.current>1e3&&(console.log("ðŸ•’ EnhancedAiEfficiencyCard: getTimeframeValue:",{timeframe:r,timeSavings:o.timeSavings,returnedValue:m}),c.current=x),m},d=m=>{const x=Date.now();x-c.current>1e3&&console.log("â° EnhancedAiEfficiencyCard: formatTime called with:",m);const f=(()=>{if(m<60)return`${m} m`;const g=Math.floor(m/60),v=m%60;return v>0?`${g}h ${v} m`:`${g}h`})();return x-c.current>1e3&&(console.log("â° EnhancedAiEfficiencyCard: formatTime result:",f),c.current=x),f},p=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m);return e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"bg-purple-200 rounded-md p-2 mr-3",children:e.jsx(bo,{size:20,className:"text-purple-900"})}),e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"AI & Process Efficiency"})})]}),e.jsx("div",{className:"flex items-center text-xs text-gray-400"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-left text-gray-500",children:"Time Saved"}),e.jsx("span",{className:"text-base text-right text-gray-700",children:d(l())})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-left text-gray-500",children:"Cost Saved"}),e.jsx("span",{className:"text-base text-right text-gray-700",children:p(r==="weekly"?o.costSavings.monthly/4:o.costSavings[r]||0)})]})]})]})},_p=({data:r})=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"bg-yellow-200 rounded-md p-2 mr-3",children:e.jsx(yo,{size:20,className:"text-yellow-900"})}),e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Team Performance"})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Skills"}),e.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.skills,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Inventory Efficiency"}),e.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.inventory,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Sterilization Efficiency"}),e.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[r.sterilization,"%"]})]})]})]}),Tp=({metrics:r={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0}},aiImpactMetrics:t})=>{var s,n,a,i,c,o,l,d,p;const[m]=u.useState("daily");return console.log("ðŸ“Š PerformanceMetrics: Received metrics:",r),console.log("ðŸ¤– PerformanceMetrics: Received aiImpactMetrics:",t),console.log("ðŸ‘¥ PerformanceMetrics: Team performance data:",r.teamPerformance),t&&console.log("ðŸ” aiImpactMetrics structure:",{timeSavings:t.timeSavings,costSavings:t.costSavings,keys:Object.keys(t)}),e.jsxs("div",{className:"bg-white rounded-lg p-4 pt-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-teal-100 rounded-md p-1",children:e.jsx(vo,{size:24,color:"#4ECDC4"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:"Performance Metrics"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(wp,{data:r.timeSaved,timeframe:m}),e.jsx(Np,{data:r.costSavings}),e.jsx(Sp,{timeframe:m,showInsights:!1,aiImpactMetrics:t?{timeSavings:{daily:((s=t.timeSavings)==null?void 0:s.daily)||0,weekly:((n=t.timeSavings)==null?void 0:n.weekly)||0,monthly:((a=t.timeSavings)==null?void 0:a.monthly)||0,total:((i=t.timeSavings)==null?void 0:i.total)||0,percentage:((c=t.timeSavings)==null?void 0:c.percentage)||0},costSavings:{daily:((o=t.costSavings)==null?void 0:o.daily)||0,monthly:((l=t.costSavings)==null?void 0:l.monthly)||0,annual:((d=t.costSavings)==null?void 0:d.annual)||0,roi:((p=t.costSavings)==null?void 0:p.roi)||0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:0,riskMitigation:0,predictiveAccuracy:0},efficiencyGains:{taskCompletionRate:0,qualityImprovement:0,resourceOptimization:0,workflowStreamlining:0},realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:"",dataFreshness:100}}:null}),e.jsx(_p,{data:r.teamPerformance,timeframe:m})]})]})};function kp(){return e.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 shadow-sm mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"BI Indicator Dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Biological indicator results will be displayed here once available."})]})}function Ip(){return e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50 shadow-sm mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CI Indicator Dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Chemical indicator results will be displayed here once available."})]})}const Pp=({biData:r,ciData:t,performanceMetrics:s,aiImpactMetrics:n})=>e.jsxs("div",{className:Mm(),"data-testid":"metrics-section",children:[e.jsx(Tp,{metrics:s,aiImpactMetrics:n}),r&&e.jsx(kp,{}),t&&e.jsx(Ip,{})]}),fv=u.memo(Pp);var Dp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const bv=({onRefresh:r,className:t="",size:s="md"})=>{const[n,a]=u.useState(!1),[i,c]=u.useState(null),[o,l]=u.useState("idle"),d={sm:"w-6 h-6 text-sm",md:"w-8 h-8 text-base",lg:"w-10 h-10 text-lg"},p=()=>Dp(null,null,function*(){if(!n){a(!0),l("idle");try{yield r(),c(new Date),l("success"),setTimeout(()=>l("idle"),2e3)}catch(g){console.error("Refresh failed:",g),l("error"),setTimeout(()=>l("idle"),3e3)}finally{a(!1)}}}),m=()=>{if(n)return e.jsx(qr,{className:"animate-spin"});switch(o){case"success":return e.jsx(Yl,{className:"text-green-500"});case"error":return e.jsx(vs,{className:"text-red-500"});default:return e.jsx(qr,{})}},x=()=>n?"Refreshing...":o==="success"?"Updated successfully":o==="error"?"Refresh failed":i?`Last updated: ${i.toLocaleTimeString()}`:"Refresh",f=()=>n?"Refreshing performance metrics":o==="success"?"Performance metrics updated successfully":o==="error"?"Failed to refresh performance metrics - try again":i?`Refresh performance metrics - Last updated: ${i.toLocaleTimeString()}`:"Refresh performance metrics (PRN)";return e.jsx(Ii,{content:x(),children:e.jsx("button",{onClick:p,disabled:n,className:`
          ${d[s]}
          flex items-center justify-center
          bg-white hover:bg-gray-50
          border border-gray-200 hover:border-gray-300
          rounded-lg shadow-sm hover:shadow-md
          transition-all duration-200
          disabled:opacity-50 disabled:cursor-not-allowed
          ${t}
        `,"aria-label":f(),children:m()})})},Ep=({points:r})=>{const t=Math.max(0,r||0);return e.jsx("div",{className:"text-xl font-bold text-[#4ECDC4]",children:t})},Op=({streakCount:r})=>{const t=Math.max(0,r||0);return e.jsxs("div",{className:"text-sm text-orange-500 font-medium",children:["ðŸ”¥ ",t,"-day streak"]})},$p=({level:r})=>{const t=Math.max(1,r||1);return e.jsx("span",{className:"text-xl font-bold text-[#4ECDC4]",children:t})},yv=({gamificationData:r={streak:0,level:1,rank:100,totalScore:0,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}}})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2","aria-label":Fr.STATS,"aria-live":"polite","data-testid":"gamification-stats",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center p-1 pr-8",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:e.jsx(jo,{size:20,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Current Streak"}),e.jsx("div",{className:"flex items-baseline",children:e.jsx(Op,{streakCount:r.streak})})]})]}),e.jsxs("div",{className:"flex items-center p-1",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:e.jsx(wo,{size:20,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Level"}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx($p,{level:r.level}),e.jsx("div",{className:"ml-2 px-2 py-0.5 bg-blue-100 rounded-full",children:e.jsxs("span",{className:"text-xs font-semibold text-blue-600",children:["Top ",r.rank,"%"]})})]})]})]}),e.jsxs("div",{className:"flex items-center p-1 pl-8",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:e.jsx(No,{size:20,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Points"}),e.jsx("div",{className:"flex items-baseline",children:e.jsx(Ep,{points:r.totalScore})})]})]})]})}),vv=({size:r="lg",message:t="Data Compilation In Progress..."})=>{const s={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},n={sm:"text-sm",md:"text-base",lg:"text-lg"};return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`${s[r]} animate-bounce`,children:e.jsx("div",{className:"text-6xl",children:"ðŸš€"})}),e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"w-1 h-8 bg-gradient-to-t from-orange-400 to-transparent animate-pulse"})})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:`font-semibold text-gray-700 ${n[r]}`,children:t}),e.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Preparing your dashboard for takeoff..."})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})},Ap={"blue-500":"from-blue-500 to-blue-600","green-500":"from-green-500 to-emerald-600","red-500":"from-red-500 to-rose-600","yellow-500":"from-yellow-500 to-orange-500","purple-500":"from-purple-500 to-purple-600","gray-400":"from-gray-400 to-gray-500"},Rp={"blue-200":"border-blue-200","green-200":"border-green-200","red-200":"border-red-200","yellow-200":"border-yellow-200","purple-200":"border-purple-200","gray-200":"border-gray-200"},ds=({title:r,value:t,icon:s,iconBgColor:n,gradientFrom:a,gradientTo:i,borderColor:c,textColor:o,valueColor:l,trend:d})=>{const p=Ap[a]||"from-gray-400 to-gray-500",m=Rp[c]||"border-gray-200";return e.jsxs("div",{className:rs("bg-gradient-to-br p-4 rounded-lg border",p,m),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${o}`,children:r}),e.jsx("p",{className:`text-2xl font-bold ${l}`,children:t})]}),e.jsx("div",{className:`p-2 ${n} rounded-lg`,children:e.jsx(C,{path:s,size:1.5,className:"text-white"})})]}),d&&e.jsxs("div",{className:`mt-2 flex items-center text-xs ${o}`,children:[e.jsx(C,{path:d.direction==="up"?oi:d.direction==="down"?ci:ut,size:.8,className:"mr-1"}),e.jsx("span",{children:d.value})]})]})},Bp=({score:r,trend:t})=>{const s=()=>t?t.direction==="up"?"text-green-600":"text-red-600":"text-gray-500",n=()=>t?t.direction==="up"?oi:ci:_t;return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-3 mt-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-blue-500 p-1.5 rounded-lg mr-3",children:e.jsx(C,{path:_t,size:1,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-blue-800",children:"Overall Efficiency Trend"}),e.jsxs("p",{className:"text-xl font-bold text-blue-900",children:[r,"%"]})]})]}),t&&e.jsxs("div",{className:`flex items-center text-sm font-medium ${s()}`,children:[e.jsx(C,{path:n(),size:.9,className:"mr-1"}),e.jsx("span",{children:t.value})]})]}),!t&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"No trend data available yet. Complete more cycles to see performance trends."})]})};var Lt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Js=(...r)=>console.log("[useCentralizedInventoryData]",...r);let ys=!1;const St=Ee()(Rs((r,t)=>({data:null,isLoading:!0,error:null,items:[],tools:[],supplies:[],equipment:[],officeHardware:[],getTools:()=>t().tools,getSupplies:()=>t().supplies,getEquipment:()=>t().equipment,getOfficeHardware:()=>t().officeHardware,getCategories:()=>{const s=t();return Array.from(new Set([...s.tools.map(n=>n.category).filter(n=>n!==null),...s.supplies.map(n=>n.category).filter(n=>n!==null),...s.equipment.map(n=>n.category).filter(n=>n!==null),...s.officeHardware.map(n=>n.category).filter(n=>n!==null)]))},getFilteredData:s=>Lt(null,null,function*(){const i=(yield(yield Dt.getInstance()).getAllItems()).data||[];return!i||!Array.isArray(i)?[]:i.filter(c=>{var o,l;return((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase()))})}),getFilteredSuppliesData:s=>Lt(null,null,function*(){return((yield(yield Dt.getInstance()).getAllItems()).data||[]).filter(c=>{var o,l;return c.category==="Supplies"&&(((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase())))})}),getFilteredEquipmentData:s=>Lt(null,null,function*(){return((yield(yield Dt.getInstance()).getAllItems()).data||[]).filter(c=>{var o,l;return c.category==="Equipment"&&(((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase())))})}),getFilteredOfficeHardwareData:s=>Lt(null,null,function*(){return((yield(yield Dt.getInstance()).getAllItems()).data||[]).filter(c=>{var o,l;return c.category==="Office Hardware"&&(((o=c.name)==null?void 0:o.toLowerCase().includes(s.toLowerCase()))||((l=c.category)==null?void 0:l.toLowerCase().includes(s.toLowerCase())))})}),refreshData:()=>Lt(null,null,function*(){var s,n,a;if(ys){console.log("[useCentralizedInventoryData] Data fetch already in progress, skipping...");return}ys=!0,r({isLoading:!0,error:null});try{let i=0;const c=2,o=25;for(;i<c;)try{const p=(yield(yield Dt.getInstance()).getAllItems()).data||[],m={tools:p.filter(x=>x.category==="Tools"),supplies:p.filter(x=>x.category==="Supplies"),equipment:p.filter(x=>x.category==="Equipment"),officeHardware:p.filter(x=>x.category==="Office Hardware")};console.log("[useCentralizedInventoryData] Setting state with data:",{allItems:p.length,tools:m.tools.length,supplies:m.supplies.length,equipment:m.equipment.length,officeHardware:m.officeHardware.length}),r({items:p,tools:m.tools,supplies:m.supplies,equipment:m.equipment,officeHardware:m.officeHardware,data:{tools:m.tools,supplies:m.supplies,equipment:m.equipment,officeHardware:m.officeHardware,categories:Array.from(new Set(p.map(x=>x.category).filter(Boolean))),isLoading:!1,error:null},error:null,isLoading:!1}),Js("âœ… single-source applied",{counts:{all:p.length,tools:m.tools.length,supplies:m.supplies.length,equipment:m.equipment.length,officeHardware:m.officeHardware.length}});break}catch(l){if(i++,i>=c)Js("âŒ facade fetch failed after all retries; clearing state",String((s=l==null?void 0:l.message)!=null?s:l)),r({items:[],tools:[],supplies:[],equipment:[],officeHardware:[],error:String((n=l==null?void 0:l.message)!=null?n:l),isLoading:!1});else{Js(`âš ï¸ Facade fetch attempt ${i} failed, retrying...`,String((a=l==null?void 0:l.message)!=null?a:l));const d=o*(i+1);yield new Promise(p=>setTimeout(p,d))}}}finally{ys=!1}}),clearError:()=>r({error:null}),inventoryData:[],suppliesData:[],equipmentData:[],officeHardwareData:[]}),{name:"centralized-inventory-store",partialize:r=>({tools:r.tools,supplies:r.supplies,equipment:r.equipment,officeHardware:r.officeHardware,items:r.items,data:r.data})})),Fp=()=>{const r=St(n=>n.refreshData),t=St(n=>n.isLoading),s=St(n=>n.data);return Z.useEffect(()=>{if(!t&&!s&&!ys){const n=setTimeout(()=>{r()},0);return()=>clearTimeout(n)}},[r,t,s]),{refreshData:r,isLoading:t}};var Xs=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Mp=()=>{const{getCycleStats:r,biTestResults:t,nextBITestDue:s,activityLog:n,availableTools:a,loadBITestResults:i,loadBIFailureIncidents:c}=G(),{tools:o}=St(),[l,d]=u.useState([]),[p,m]=u.useState([]),[x,f]=u.useState(!1),[g,v]=u.useState(null),[j,h]=u.useState(!1),y=!o||o.length===0,b=u.useCallback(()=>Xs(null,null,function*(){try{console.log("ðŸ”„ Manually refreshing BI results...");const T="550e8400-e29b-41d4-a716-446655440000";yield i(T),yield c(T),console.log("âœ… BI results refreshed successfully")}catch(T){console.error("âŒ Failed to refresh BI results:",T)}}),[i,c]);u.useEffect(()=>{const T=()=>Xs(null,null,function*(){try{const O="550e8400-e29b-41d4-a716-446655440000";yield i(O),yield c(O)}catch(O){console.error("Failed to load BI activities:",O)}});T();const k=new Date,S=new Date(k);S.setDate(S.getDate()+1),S.setHours(0,0,0,0);const I=S.getTime()-k.getTime(),D=setTimeout(()=>{T(),setInterval(T,1440*60*1e3)},I);return()=>clearTimeout(D)},[i,c]);const _=u.useMemo(()=>{const T=o.length;if(y)return{totalTools:T,activeTools:0,completedToday:0};const k=a.filter(D=>D.currentPhase&&D.currentPhase!=="complete"&&D.currentPhase!=="failed").length,S=new Date,I=a.filter(D=>{if(!D.endTime)return!1;const A=new Date(D.endTime).toDateString()===S.toDateString(),R=D.currentPhase==="complete";return A&&R}).length;return{totalTools:T,activeTools:k,completedToday:I}},[a,o,y]),E=u.useMemo(()=>(console.log("ðŸ” recentBITests filter:",{isLoading:y,biTestResultsLength:(t==null?void 0:t.length)||0,biTestResults:(t==null?void 0:t.length)>0?t.slice(0,3).map(T=>({status:T.status,date:T.date,passed:T.passed,id:T.id})):"none"}),y||!t||t.length===0?[]:t.filter(T=>{const k=new Date;return k.setDate(k.getDate()-7),new Date(T.date)>=k}).sort((T,k)=>new Date(k.date).getTime()-new Date(T.date).getTime()).slice(0,5)),[t,y]),$=u.useMemo(()=>y||!n||n.length===0?[]:n.map(T=>{var k;const S=Lp(T.time);return{id:T.id,type:T.type,title:T.title,description:(k=T.data)==null?void 0:k.description,time:S,toolCount:T.toolCount,color:T.color,operatorId:T.operatorId,metadata:T.metadata}}),[n,y]),P=u.useCallback(()=>Xs(null,null,function*(){d([]),m([]),f(!1),h(!0),v(null)}),[]);return u.useEffect(()=>{!y&&a&&t&&n&&!j&&setTimeout(()=>{P().catch(T=>{console.warn("AI insights generation failed (non-blocking):",T)})},0)},[y,a,t,n,P,j]),y?{stats:{totalCycles:0,completedCycles:0,averageCycleTime:0,biPassRate:100,efficiencyScore:{score:0,trend:null},cycleTrend:null,biPassRateTrend:null},additionalMetrics:_,recentBITests:E,nextBITestDue:null,recentActivities:$,aiInsights:[],aiForecasts:[],isAiLoading:!1,aiError:null,generateAIInsights:P,isLoading:!0}:{stats:r(),additionalMetrics:_,recentBITests:E,nextBITestDue:s,refreshBIResults:b,recentActivities:$,aiInsights:l,aiForecasts:p,isAiLoading:x,aiError:g,generateAIInsights:P,isLoading:!1}};function Lp(r){const s=new Date().getTime()-new Date(r).getTime(),n=Math.floor(s/6e4);if(n<1)return"just now";if(n<60)return`${n} minute${n===1?"":"s"} ago`;const a=Math.floor(n/60);if(a<24)return`${a} hour${a===1?"":"s"} ago`;const i=Math.floor(a/24);return`${i} day${i===1?"":"s"} ago`}var rn=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const zp=()=>{const{currentUser:r}=He(),{getCurrentFacilityId:t,isLoading:s}=vi(),{availableTools:n,setAvailableTools:a,loadCycles:i}=G(),[c,o]=u.useState(!1),[l,d]=u.useState(!1),[p,m]=u.useState(null);return u.useEffect(()=>{rn(null,null,function*(){if(!(c||s)){if(!r){console.log("â³ Waiting for user authentication...");return}try{d(!0),m(null);const f=t();if(!f)throw new Error("User facility not found");const g=yield si.getAvailableTools(f);a(g),yield i(f),o(!0)}catch(f){console.error("Failed to initialize sterilization store:",f),m(f instanceof Error?f.message:"Unknown error")}finally{d(!1)}}})},[r,c,a,i,t,s]),u.useEffect(()=>{if(c)return;rn(null,null,function*(){try{m(null);const f=t();if(!f){console.log("âš ï¸ No facility ID available, skipping sterilization initialization");return}yield i(f),o(!0),console.log("âœ… Sterilization analytics initialized successfully")}catch(f){console.error("Failed to initialize sterilization analytics:",f),m(f instanceof Error?f.message:"Unknown error")}})},[c,i,t]),{isInitialized:c,isLoading:l,error:p,hasData:n.length>0}},Up=u.lazy(()=>qe(()=>Promise.resolve().then(()=>Vb),void 0).then(r=>({default:r.RecentActivity}))),qp=u.lazy(()=>qe(()=>Promise.resolve().then(()=>Gb),void 0).then(r=>({default:r.BITestResults}))),Hp=u.lazy(()=>qe(()=>Promise.resolve().then(()=>Qb),void 0).then(r=>({default:r.ToolStatus}))),Zs=()=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg mb-4"}),e.jsx("div",{className:"h-24 bg-gray-200 rounded-lg"})]}),jv=()=>{var r,t;const[s,n]=u.useState(!0),{isLoading:a,error:i}=zp(),{stats:c,additionalMetrics:o,recentBITests:l,nextBITestDue:d,recentActivities:p,refreshBIResults:m}=Mp();return u.useEffect(()=>{const x=setTimeout(()=>{n(!0)},100);return()=>clearTimeout(x)},[]),a||!s?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[e.jsx(C,{path:_t,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),e.jsx("div",{className:"text-sm text-gray-500",children:i?"Error loading data":"Loading..."})]}),i&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm",children:i}),e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((x,f)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},f))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[...Array(3)].map((x,f)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},f))})]})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[e.jsx(C,{path:_t,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]}),e.jsx(Bp,{score:((r=c.efficiencyScore)==null?void 0:r.score)||0,trend:(t=c.efficiencyScore)==null?void 0:t.trend}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(ds,{title:"Total Cycles",value:c.totalCycles,icon:js,iconBgColor:"bg-blue-500",gradientFrom:"blue-50",gradientTo:"blue-100",borderColor:"blue-200",textColor:"text-blue-600",valueColor:"text-blue-800",trend:c.cycleTrend}),e.jsx(ds,{title:"Completed Cycles",value:c.completedCycles,icon:Ce,iconBgColor:"bg-green-500",gradientFrom:"green-50",gradientTo:"green-100",borderColor:"green-200",textColor:"text-green-600",valueColor:"text-green-800",trend:c.cycleTrend}),e.jsx(ds,{title:"Tool Turnaround Time",value:`${Math.round(c.averageCycleTime)} min`,icon:Os,iconBgColor:"bg-purple-500",gradientFrom:"purple-50",gradientTo:"purple-100",borderColor:"purple-200",textColor:"text-purple-600",valueColor:"text-purple-800",trend:{direction:"down",value:"Target: <60 min"}}),e.jsx(ds,{title:"BI Pass Rate",value:`${Math.round(c.biPassRate)}%`,icon:De,iconBgColor:"bg-orange-500",gradientFrom:"orange-50",gradientTo:"orange-100",borderColor:"orange-200",textColor:"text-orange-600",valueColor:"text-orange-800",trend:c.biPassRateTrend})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(u.Suspense,{fallback:e.jsx(Zs,{}),children:e.jsx(Up,{activities:p})}),e.jsx(u.Suspense,{fallback:e.jsx(Zs,{}),children:e.jsx(qp,{recentTests:l,nextTestDue:d,refreshBIResults:m})}),e.jsx(u.Suspense,{fallback:e.jsx(Zs,{}),children:e.jsx(Hp,{totalTools:o.totalTools,activeTools:o.activeTools,completedToday:o.completedToday})})]})]})};var Vp=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Di=Ee((r,t)=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1,enforceBI:!0,enforceCI:!0,allowOverrides:!1,setBiTestCompleted:s=>r({biTestCompleted:s}),setBiTestDate:s=>r({biTestDate:s}),setNextBITestDue:s=>r({nextBITestDue:s}),setLastBITestDate:s=>r({lastBITestDate:s}),setBiTestPassed:s=>r({biTestPassed:s}),setBiTestOptedOut:s=>r({biTestOptedOut:s}),setBiTestInProgress:s=>r({biTestInProgress:s}),setEnforceBI:s=>r({enforceBI:s}),setEnforceCI:s=>r({enforceCI:s}),setAllowOverrides:s=>r({allowOverrides:s}),resetBIState:()=>r({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,biTestInProgress:!1}),recordBITestResult:s=>Vp(null,null,function*(){console.log("ðŸ”¬ Clean BI Store: recordBITestResult called with:",s);try{const{data:{user:n},error:a}=yield Q.auth.getUser();if(a||!n)throw new Error("User not authenticated");const i="550e8400-e29b-41d4-a716-446655440000",c={facility_id:i,operator_id:n.id,test_date:new Date().toISOString(),result:s.status==="pending"?"pass":s.status,bi_lot_number:"DEFAULT-001",bi_expiry_date:new Date(Date.now()+365*24*60*60*1e3).toISOString(),incubation_time_minutes:60,incubation_temperature_celsius:37,test_conditions:{room_temperature_celsius:22,humidity_percent:45,equipment_used:"Default Equipment",operator:n.id,operator_id:n.id,facility_id:i,test_date:new Date().toISOString()},failure_reason:s.status==="fail"?"BI test failed":void 0,skip_reason:s.status==="skip"?"BI test skipped":void 0,compliance_notes:s.status==="pass"?"BI test passed":void 0,cycle_id:"00000000-0000-0000-0000-000000000000",test_number:`BI-${Date.now()}`},{error:o}=yield Q.from("bi_test_results").insert(c);if(o)throw o;const l=new Date;l.setDate(l.getDate()+1),r(d=>({biTestResults:[...d.biTestResults,s],biTestCompleted:s.passed,biTestDate:s.date.toISOString(),lastBITestDate:s.date.toISOString(),nextBITestDue:l,biTestPassed:s.passed})),console.log("ðŸ”¬ Clean BI Store: State updated successfully"),console.log("ðŸ”¬ Clean BI Store: lastBITestDate set to:",s.date.toISOString())}catch(n){console.error("ðŸ”¬ Clean BI Store: Error recording BI test result:",n);const a=new Date;throw a.setDate(a.getDate()+1),r(i=>({biTestResults:[...i.biTestResults,s],biTestCompleted:s.passed,biTestDate:s.date.toISOString(),lastBITestDate:s.date.toISOString(),nextBITestDue:a,biTestPassed:s.passed})),console.log("ðŸ”¬ Clean BI Store: State updated despite error"),n}})})),Wp=({quarantineData:r})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(C,{path:dt,size:1,className:"text-gray-600"}),e.jsx("h3",{className:"font-medium text-gray-800",children:"Quarantine Summary"})]}),r.lastPassedDate&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:ts,size:.8,className:"text-blue-600"}),e.jsx("h4",{className:"font-medium text-blue-800 text-sm",children:"Last Successful BI Test"})]}),e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx("strong",{children:"Date:"})," ",r.lastPassedDate.toLocaleDateString()," at"," ",r.lastPassedDate.toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.totalToolsAffected}),e.jsx("div",{className:"text-gray-600",children:"Tools Affected"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.totalCyclesAffected}),e.jsx("div",{className:"text-gray-600",children:"Cycles Affected"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r.uniqueOperators.length}),e.jsx("div",{className:"text-gray-600",children:"Operators Involved"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.hasCurrentCycleAffected?"Yes":"No"}),e.jsx("div",{className:"text-gray-600",children:"Current Cycle Affected"})]})]}),r.dateRange&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:Ar,size:.8,className:"text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800 text-sm",children:"Affected Date Range"})]}),e.jsxs("p",{className:"text-xs text-yellow-700",children:[e.jsx("strong",{children:"From:"})," ",r.dateRange.start.toLocaleDateString()," ",e.jsx("strong",{children:"To:"})," ",r.dateRange.end.toLocaleDateString()]})]}),Object.keys(r.toolsByCategory).length>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Tools by Category:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:Object.entries(r.toolsByCategory).map(([t,s])=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-gray-600",children:t}),e.jsx("span",{className:"font-semibold text-gray-800",children:s})]},t))})]})]}),Gp=({affectedCycles:r})=>r.length===0?null:e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Cycles:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:e.jsxs("div",{className:"space-y-2 text-xs",children:[r.slice(0,5).map((t,s)=>e.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.cycleNumber||`Cycle ${s+1}`}),e.jsxs("div",{className:"text-gray-500",children:[new Date(t.startTime).toLocaleDateString()," -"," ",t.operator]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-500",children:[e.jsxs("div",{children:[t.tools.length," tools"]}),e.jsxs("div",{children:[t.phases.length," phases"]})]})]})},t.id)),r.length>5&&e.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",r.length-5," more cycles affected"]})]})})]});var Ei=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Kp=r=>Ei(null,null,function*(){try{const t=yield zo.getMostRecentBatchForTool(r);return t||null}catch(t){return console.error("Failed to get batch info for tool:",t),null}}),Qp=({affectedTools:r})=>{const{availableTools:t}=G(),[s,n]=u.useState(new Map),[a,i]=u.useState(!1);u.useEffect(()=>{Ei(null,null,function*(){if(r.length!==0){i(!0);try{const l=new Map;for(const d of r){const p=yield Kp(d.id);p&&l.set(d.id,p)}n(l)}catch(l){console.error("Failed to load batch info:",l)}finally{i(!1)}}})},[r]);const c=o=>{const l=t.find(d=>d.id===o);return l?{id:l.id,name:l.name,barcode:l.barcode,category:l.category,type:l.type||"Unknown",cycleCount:l.cycleCount||0,lastSterilized:l.lastSterilized,status:l.status,cycleId:l.cycleId}:{id:o,name:`Tool ${o}`,barcode:o,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:null,status:"unknown",cycleId:void 0}};return r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Tool Details:"}),e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200 max-h-32 overflow-hidden",children:e.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs",children:[r.slice(0,6).map((o,l)=>{const d=c(o.id),p=s.get(o.id),m=(p==null?void 0:p.batchName)||"Batch Info Pending",x=p==null?void 0:p.cycleName,f=p==null?void 0:p.status,g=[`Tool: ${d.name}`,`Barcode: ${d.barcode}`,`Category: ${d.category}`,`Type: ${d.type}`,`Cycle Count: ${d.cycleCount}`,`Status: ${d.status}`,`Batch: ${m}`,...x?[`Cycle: ${x}`]:[],...f?[`Batch Status: ${f}`]:[]].join(`
`);return e.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700 hover:bg-gray-200 transition-colors cursor-help",title:g,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:d.name}),e.jsxs("div",{className:"text-gray-500 text-xs",children:["#",d.barcode]}),e.jsx("div",{className:"text-orange-600 text-xs font-medium",children:a?"Loading Batch...":`Batch: ${m}`}),x&&e.jsxs("div",{className:"text-blue-600 text-xs",children:["Cycle: ",x]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-500",children:[e.jsx("div",{children:d.category}),e.jsxs("div",{children:["Cycles: ",d.cycleCount]}),f&&e.jsx("div",{className:`text-xs ${f==="completed"?"text-green-600":f==="failed"?"text-red-600":f==="in_cycle"?"text-blue-600":"text-gray-600"}`,children:f})]})]})},l)}),r.length>6&&e.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",r.length-6," more tools affected"]})]})})})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-600",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," Hover over tools for detailed information. All tools must be quarantined and re-sterilized."]})})]})},Yp=({totalToolsAffected:r})=>e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Required Actions"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("span",{children:["Quarantine all ",r," affected tools immediately"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:"Re-sterilize all quarantined tools"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:"Perform a new BI test after re-sterilization"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:"Contact supervisor for incident documentation"})]})]})]}),Jp=({operatorName:r,totalToolsAffected:t,totalCyclesAffected:s})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:Ar,size:1,className:"text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Operator Confirmation"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:r}),", by confirming this BI test failure, you acknowledge that:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{children:["â€¢ All ",t," affected tools will be quarantined"]}),e.jsxs("li",{children:["â€¢ ",s," sterilization cycles are affected"]}),e.jsx("li",{children:"â€¢ A compliance incident report will be generated"}),e.jsx("li",{children:"â€¢ Re-sterilization procedures must be followed"})]})]}),Xp=({onCancel:r})=>e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-red-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(C,{path:di,size:1.5,className:"text-red-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800",children:"BI Test Failure - Critical Alert"}),e.jsx("p",{className:"text-sm text-red-600",children:"Sterilization process failure detected"})]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-red-100 rounded-lg transition-colors",children:e.jsx(C,{path:ae,size:1,className:"text-red-600"})})]}),Zp=()=>e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{path:ce,size:1.2,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800 mb-2",children:"Immediate Action Required"}),e.jsx("p",{className:"text-sm text-red-700",children:"A Biological Indicator test failure indicates that the sterilization process may not have been effective. All tools processed since the last successful BI test must be quarantined and re-sterilized."})]})]})}),ex=({isOpen:r,onConfirm:t,onCancel:s,operatorName:n})=>{const a=Br();return r?Is.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:s,onKeyDown:i=>{i.key==="Escape"&&s()},role:"button",tabIndex:0,"aria-label":"Close modal"}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsx(Xp,{onCancel:s}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto bi-modal-scrollbar-hide",children:[e.jsx(Zp,{}),e.jsx(Wp,{quarantineData:a}),e.jsx(Gp,{affectedCycles:a.affectedCycles}),e.jsx(Qp,{affectedTools:a.affectedTools}),e.jsx(Yp,{totalToolsAffected:a.totalToolsAffected}),e.jsx(Jp,{operatorName:n,totalToolsAffected:a.totalToolsAffected,totalCyclesAffected:a.totalCyclesAffected})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:t,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Confirm BI Test Failure"})]})]})]}),document.body):null},tx=({isVisible:r,onComplete:t,onOptOut:s,onDismiss:n})=>{const[a,i]=u.useState(!1),[c,o]=u.useState(null),{enforceBI:l}=Di(),{currentCycle:d}=G(),p=Br();if(!r||!l)return null;const m=g=>{if(console.log("ðŸ”¬ BITestBanner: Button clicked:",g),g==="fail"){o(g),i(!0);return}const v={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:g==="pass",date:new Date,status:g,operator:(d==null?void 0:d.operator)||"Operator"};g==="skip"&&s(),console.log("ðŸ”¬ BITestBanner: Calling onComplete with:",v),t(v)},x=()=>{if(i(!1),c){const g={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:!1,date:new Date,status:"fail",operator:(d==null?void 0:d.operator)||"Operator"},{activateBIFailure:v}=G.getState(),j=p.totalToolsAffected,h=p.affectedCycles.map(y=>y.batchId).filter(y=>!!y);v({affectedToolsCount:j,affectedBatchIds:h,operator:(d==null?void 0:d.operator)||"Operator"}),t(g)}o(null)},f=()=>{i(!1),o(null)};return e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 mb-4 rounded-r-lg shadow-sm",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg flex-shrink-0",children:e.jsx(C,{path:De,size:1.2,className:"text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800",children:"Daily BI Test Required"}),e.jsxs("span",{className:"text-sm text-orange-600",children:["(",new Date().toLocaleDateString(),")"]})]}),e.jsx("p",{className:"text-orange-700 text-sm mb-3",children:"Please complete the daily Biological Indicator test to ensure sterilization compliance."}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>m("pass"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-green-300 hover:border-green-500 bg-green-50 hover:bg-green-100 text-green-800 transition-colors",children:[e.jsx(C,{path:Ce,size:1,className:"text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PASS"})]}),e.jsxs("button",{onClick:()=>m("fail"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-red-300 hover:border-red-500 bg-red-50 hover:bg-red-100 text-red-800 transition-colors",children:[e.jsx(C,{path:ce,size:1,className:"text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"FAIL"})]}),e.jsxs("button",{onClick:()=>m("skip"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-gray-300 hover:border-gray-500 bg-gray-50 hover:bg-gray-100 text-gray-800 transition-colors",children:[e.jsx(C,{path:De,size:1,className:"text-gray-600"}),e.jsx("span",{className:"text-sm font-medium",children:"SKIP"})]})]})]})]})}),e.jsx(ex,{isOpen:a,onConfirm:x,onCancel:f,operatorName:(d==null?void 0:d.operator)||"Operator"})]})},sx=r=>{if(!r)return!0;const t=new Date().toDateString();return new Date(r).toDateString()!==t};class rt{static getTabs(){return[{id:"timers",label:"Phase Timers",icon:br},{id:"analytics",label:"Analytics",icon:_t},{id:"logs",label:"Cleaning Logs",icon:Pt}]}static getCycleProgressInfo(t){const s=t.phases.some(a=>a.status==="active"),n=t.phases.map(a=>({id:a.id,name:a.name,status:a.status,toolCount:a.tools.length,statusColor:this.getPhaseStatusColor(a.status)}));return{hasActivePhase:s,phaseStatuses:n}}static getPhaseStatusColor(t){switch(t){case"completed":return"bg-green-500";case"active":return"bg-blue-500";case"failed":return"bg-red-500";default:return"bg-gray-300"}}static validateOperatorName(t){return t.trim().length>0}static getTabButtonClasses(t){return t?"bg-[#4ECDC4] text-white shadow-md":"text-gray-600 hover:text-[#4ECDC4] hover:bg-gray-50"}static getStartCycleButtonState(t){const s=!this.validateOperatorName(t),n=this.validateOperatorName(t)?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-gray-300 text-gray-500 cursor-not-allowed";return{disabled:s,className:n}}static shouldShowNoCycleMessage(t){return!t}static shouldShowActiveCycleInfo(t){return t.phases.some(s=>s.status==="active")}}const rx=()=>{const{currentCycle:r}=G();u.useRef(performance.now());const t=u.useMemo(()=>rt.getTabs(),[]),s=u.useMemo(()=>r?rt.getCycleProgressInfo(r):null,[r]),n=u.useCallback(l=>rt.validateOperatorName(l),[]),a=u.useCallback(l=>rt.getTabButtonClasses(l),[]),i=u.useCallback(l=>rt.getStartCycleButtonState(l),[]),c=u.useCallback(()=>rt.shouldShowNoCycleMessage(r),[r]),o=u.useCallback(()=>r?rt.shouldShowActiveCycleInfo(r):!1,[r]);return u.useMemo(()=>{},[]),{tabs:t,cycleProgressInfo:s,validateOperatorName:n,getTabButtonClasses:a,getStartCycleButtonState:i,shouldShowNoCycleMessage:c,shouldShowActiveCycleInfo:o}},ax=()=>{const[r,t]=u.useState("timers"),[s,n]=u.useState(!1),[a,i]=u.useState(""),c=u.useCallback(x=>{(x==="timers"||x==="analytics"||x==="logs")&&t(x)},[]),o=u.useCallback(x=>{i(x.target.value)},[]),l=u.useCallback(x=>{x.key},[]),d=u.useCallback(()=>{n(!1),i("")},[]),p=u.useCallback(()=>{n(!0)},[]),m=u.useCallback(()=>{i("")},[]);return{activeTab:r,showNewCycleModal:s,operatorName:a,handleTabChange:c,handleOperatorNameChange:o,handleOperatorNameKeyPress:l,handleCloseNewCycleModal:d,openNewCycleModal:p,resetOperatorName:m}},Oi=u.memo(()=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Sterilization Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Manage sterilization cycles, track tools, and monitor performance"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsx("span",{className:"text-gray-600",children:"Tool Scanner"}),e.jsxs(Jl,{to:"/sterilization/scanner",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center gap-2",children:[e.jsx(C,{path:Tt,size:1}),"Scan Tool"]})]})]}));Oi.displayName="DashboardHeader";var nx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class Ne{static fetchCleaningLogs(){return nx(this,null,function*(){try{const{data:t,error:s}=yield Q.from("sterilization_cycles").select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching sterilization cycles:",s),s;return(t||[]).map(a=>({id:a.id,room_id:a.id,room_name:`Cycle ${a.id.slice(0,8)}`,status:a.status||"in_progress",cleaning_type:"sterilization",scheduled_time:a.start_time,started_time:a.start_time,completed_time:a.end_time,operator_id:a.operator_id,notes:"",checklist_items:[],completed_items:[],failed_items:[],created_at:a.created_at,updated_at:a.updated_at}))}catch(t){return console.error("Failed to fetch sterilization cycles:",t),[]}})}static filterCleaningLogs(t,s){return t.filter(n=>{let a=!1;s.status==="all"?a=!0:s.status==="in_progress"?a=n.status==="pending"||n.status==="in_progress":a=n.status===s.status;const i=!s.date||new Date(n.created_at).toDateString()===new Date(s.date).toDateString();return a&&i})}static calculateStats(t){return{totalCycles:t.length,completed:t.filter(s=>s.status==="completed").length,failed:t.filter(s=>s.status==="failed").length,totalTools:t.length}}static getStatusColor(t){switch(t){case"completed":return{color:"text-green-600 bg-green-100"};case"verified":return{color:"text-blue-600 bg-blue-100"};case"failed":return{color:"text-red-600 bg-red-100"};case"in_progress":return{color:"text-yellow-600 bg-yellow-100"};case"pending":return{color:"text-gray-600 bg-gray-100"};case"cancelled":return{color:"text-orange-600 bg-orange-100"};default:return{color:"text-gray-600 bg-gray-100"}}}static formatDuration(t,s){if(!s)return"In Progress";const n=new Date(t),i=new Date(s).getTime()-n.getTime(),c=Math.floor(i/(1e3*60)),o=Math.floor(c/60),l=c%60;return`${o}h ${l}m`}static getBITestResultsForCycle(t,s){return t.filter(n=>{const a=new Date(s);return new Date(n.date).toDateString()===a.toDateString()})}static getBITestResultColor(t){return t==="pass"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}static formatTestTime(t){return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static getCleaningTypeDisplayName(t){switch(t){case"routine":return"Routine";case"deep_clean":return"Deep Clean";case"emergency":return"Emergency";case"post_procedure":return"Post Procedure";default:return t}}static getQualityScoreDisplay(t){return t?`${Math.round(t*100)}%`:"N/A"}static getComplianceScoreDisplay(t){return t?`${Math.round(t*100)}%`:"N/A"}static filterCycles(t,s){return Array.isArray(t)?t.filter(n=>{const a=s.status?n.status===s.status:!0;let i=!0;if(s.date){const c=new Date(s.date);isNaN(c.getTime())||(i=new Date(n.start_time).toDateString()===c.toDateString())}return a&&i}):[]}static calculateFailedCycles(t){return Array.isArray(t)?t.filter(s=>{var n;return((n=s.status)==null?void 0:n.toLowerCase())==="failed"}).length:0}static exportToCSV(t){if(!t||t.length===0){alert("No data to export");return}try{const s=["Cycle ID","Room Name","Status","Cleaning Type","Scheduled Time","Started Time","Completed Time","Operator ID","Notes","Created At","Updated At"],n=t.map(l=>[l.id,l.room_name,l.status,l.cleaning_type,l.scheduled_time||"",l.started_time||"",l.completed_time||"",l.operator_id||"",l.notes||"",l.created_at,l.updated_at]),a=[s.join(","),...n.map(l=>l.map(d=>`"${d}"`).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),c=window.URL.createObjectURL(i),o=document.createElement("a");o.href=c,o.download=`cleaning_logs_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(c)}catch(s){console.error("Failed to export cleaning logs:",s),alert("Failed to export data. Please try again.")}}}var lx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const ix=({filterStatus:r,filterDate:t})=>{const{biTestResults:s}=G(),[n,a]=u.useState([]),[i,c]=u.useState(!0),[o,l]=u.useState(null);u.useEffect(()=>{lx(null,null,function*(){try{c(!0),l(null);const E=yield Ne.fetchCleaningLogs();a(E)}catch(E){console.error("Failed to fetch cleaning logs:",E),l("Failed to load cleaning logs")}finally{c(!1)}})},[]);const d=u.useMemo(()=>{const _={status:r,date:t};return Ne.filterCleaningLogs(n,_)},[n,r,t]),p=u.useMemo(()=>Ne.calculateStats(d),[d]);return{filteredLogs:d,stats:p,loading:i,error:o,getStatusColor:_=>Ne.getStatusColor(_).color,formatDuration:(_,E)=>Ne.formatDuration(_,E),getBITestResultsForCycle:_=>Ne.getBITestResultsForCycle(s,_),getBITestResultColor:_=>Ne.getBITestResultColor(_),formatTestTime:_=>Ne.formatTestTime(_),getCleaningTypeDisplayName:_=>Ne.getCleaningTypeDisplayName(_),getQualityScoreDisplay:_=>Ne.getQualityScoreDisplay(_),getComplianceScoreDisplay:_=>Ne.getComplianceScoreDisplay(_),exportLogs:()=>{Ne.exportToCSV(d)}}},ox=()=>{const[r,t]=u.useState(null),[s,n]=u.useState("all"),[a,i]=u.useState(""),{filteredLogs:c,stats:o,loading:l,error:d,getStatusColor:p,formatDuration:m,getBITestResultsForCycle:x,getBITestResultColor:f,formatTestTime:g,getQualityScoreDisplay:v,getComplianceScoreDisplay:j}=ix({filterStatus:s,filterDate:a});return l?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(C,{path:Or,size:2,className:"animate-spin text-[#4ECDC4] mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading cleaning logs..."})]})}):d?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(C,{path:ce,size:2,className:"text-red-500 mr-3"}),e.jsx("span",{className:"text-red-600",children:d})]})}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[e.jsx(C,{path:Pt,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Cleaning Log Tracker"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>{console.warn("âš ï¸ Export not yet implemented.")},disabled:!0,className:"flex items-center gap-2 px-3 py-2 bg-gray-400 text-white rounded-lg opacity-70 cursor-not-allowed","aria-disabled":"true",children:[e.jsx(C,{path:Es,size:1}),"Export (Coming Soon)"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Filter"}),e.jsxs("select",{id:"status-filter",value:s,onChange:h=>n(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Filter"}),e.jsx("input",{id:"date-filter",type:"date",value:a,onChange:h=>i(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{n("all"),i("")},className:"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear Filters"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-800",children:o.completed})]}),e.jsx(C,{path:Ce,size:1.5,className:"text-green-500"})]})}),e.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-800",children:o.failed})]}),e.jsx(C,{path:ce,size:1.5,className:"text-red-500"})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Cycles"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:o.totalTools})]}),e.jsx(C,{path:Be,size:1.5,className:"text-purple-500"})]})})]}),e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No sterilization cycles found for the selected filters."}):c.map(h=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:h.room_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${p(h.status)}`,children:h.status.toUpperCase()}),e.jsx("span",{className:"text-sm text-gray-500",children:"Sterilization Cycle"})]}),e.jsxs("button",{onClick:()=>t(r===h.id?null:h.id),className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(C,{path:kt,size:1}),r===h.id?"Hide":"View"," Details"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:Me,size:1}),e.jsxs("span",{children:["Scheduled:"," ",new Date(h.scheduled_time).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:Os,size:1}),e.jsxs("span",{children:["Duration:"," ",m(h.started_time||h.scheduled_time,h.completed_time)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:yr,size:1}),e.jsxs("span",{children:["Room ID: ",h.room_id]})]})]}),r===h.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Quality Metrics"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Quality Score:"}),e.jsx("span",{className:"font-medium",children:v(h.quality_score)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Compliance Score:"}),e.jsx("span",{className:"font-medium",children:j(h.compliance_score)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Timeline"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Scheduled:"}),e.jsx("span",{children:new Date(h.scheduled_time).toLocaleString()})]}),h.started_time&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Started:"}),e.jsx("span",{children:new Date(h.started_time).toLocaleString()})]}),h.completed_time&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Completed:"}),e.jsx("span",{children:new Date(h.completed_time).toLocaleString()})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(C,{path:De,size:1}),"BI Test Results"]}),e.jsxs("div",{className:"space-y-2",children:[x(h.created_at).map((y,b)=>e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${f(y.passed?"pass":"fail")}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:y.passed?"PASS":"FAIL"}),e.jsx("span",{children:g(new Date(y.date))})]})},b)),x(h.created_at).length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No BI tests for this date"})]})]})]})]},h.id))})]})};var cx=Object.defineProperty,dx=Object.defineProperties,ux=Object.getOwnPropertyDescriptors,an=Object.getOwnPropertySymbols,mx=Object.prototype.hasOwnProperty,px=Object.prototype.propertyIsEnumerable,nn=(r,t,s)=>t in r?cx(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,ee=(r,t)=>{for(var s in t||(t={}))mx.call(t,s)&&nn(r,s,t[s]);if(an)for(var s of an(t))px.call(t,s)&&nn(r,s,t[s]);return r},re=(r,t)=>dx(r,ux(t)),xx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const es=Ee((r,t)=>({timers:{},overexposed:!1,intervals:{},startTimer:(s,n,a)=>{const i=t().intervals[s];i&&clearInterval(i),r(o=>({timers:re(ee({},o.timers),{[s]:{id:s,timeRemaining:a?a.timeRemaining:s==="drying"?0:n,elapsedTime:a?a.elapsedTime:0,duration:n,isRunning:!0,overexposed:!1}})}));const c=setInterval(()=>{const o=t().timers[s];if(o&&o.isRunning)if(s==="drying"){const l=o.elapsedTime+1;r(d=>({timers:re(ee({},d.timers),{[s]:re(ee({},o),{elapsedTime:l})})}))}else{const l=o.elapsedTime+1;if(o.timeRemaining>0){const d=o.timeRemaining-1;r(p=>({timers:re(ee({},p.timers),{[s]:re(ee({},o),{timeRemaining:d,elapsedTime:l,overexposed:!1})})}))}else{const d=s==="bath1"||s==="bath2",p=d?o.elapsedTime-o.duration:0;r(m=>({timers:re(ee({},m.timers),{[s]:re(ee({},o),{timeRemaining:0,elapsedTime:l,overexposed:d&&p>0})}),overexposed:d&&p>0||m.overexposed})),s==="autoclave"&&o.elapsedTime===o.duration&&t().triggerRoomAssignment()}}},1e3);r(o=>({intervals:re(ee({},o.intervals),{[s]:c})}))},pauseTimer:s=>{const n=t().intervals[s];n&&(clearInterval(n),r(a=>{const i=ee({},a.intervals);return delete i[s],{intervals:i}})),r(a=>({timers:re(ee({},a.timers),{[s]:a.timers[s]?re(ee({},a.timers[s]),{isRunning:!1}):a.timers[s]})}))},resetTimer:s=>{const n=t().intervals[s];n&&(clearInterval(n),r(a=>{const i=ee({},a.intervals);return delete i[s],{intervals:i}})),r(a=>({timers:re(ee({},a.timers),{[s]:a.timers[s]?re(ee({},a.timers[s]),{timeRemaining:s==="drying"?0:a.timers[s].duration,elapsedTime:0,isRunning:!1,overexposed:!1}):a.timers[s]})}))},updateTimer:(s,n)=>{r(a=>({timers:re(ee({},a.timers),{[s]:a.timers[s]?re(ee({},a.timers[s]),{timeRemaining:n}):a.timers[s]})}))},getTimer:s=>t().timers[s],resumeTimer:s=>{const n=t().timers[s];if(!n)return;const a=t().intervals[s];a&&clearInterval(a),r(c=>({timers:re(ee({},c.timers),{[s]:re(ee({},n),{isRunning:!0})})}));const i=setInterval(()=>{const c=t().timers[s];if(c&&c.isRunning)if(s==="drying"){const o=c.elapsedTime+1;r(l=>({timers:re(ee({},l.timers),{[s]:re(ee({},c),{elapsedTime:o})})}))}else{const o=c.elapsedTime+1;if(c.timeRemaining>0){const l=c.timeRemaining-1;r(d=>({timers:re(ee({},d.timers),{[s]:re(ee({},c),{timeRemaining:l,elapsedTime:o,overexposed:!1})})}))}else{const l=s==="bath1"||s==="bath2",d=l?c.elapsedTime-c.duration:0;r(p=>({timers:re(ee({},p.timers),{[s]:re(ee({},c),{timeRemaining:0,elapsedTime:o,overexposed:l&&d>0})}),overexposed:l&&d>0||p.overexposed})),s==="autoclave"&&c.elapsedTime===c.duration&&t().triggerRoomAssignment()}}},1e3);r(c=>({intervals:re(ee({},c.intervals),{[s]:i})}))},setOverexposed:s=>{r({overexposed:s})},triggerRoomAssignment:()=>{const s=document.createElement("div");s.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",s.innerHTML=`
      <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h2 class="text-lg font-semibold mb-4">Room Assignment Required</h2>
        <p class="text-sm text-gray-600 mb-4">Autoclave cycle completed. Please scan the location barcode where these tools will be stored.</p>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Location Barcode</label>
            <input 
              id="locationBarcode" 
              type="text" 
              placeholder="Scan or enter location barcode" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div class="flex space-x-3">
            <button 
              id="assignLocation" 
              class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              Assign Location
            </button>
            <button 
              id="skipLocation" 
              class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500"
            >
              Skip
            </button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(s);const n=s.querySelector("#assignLocation"),a=s.querySelector("#skipLocation"),i=s.querySelector("#locationBarcode"),c=()=>xx(null,null,function*(){const l=i.value.trim();if(!l){alert("Please enter a location barcode");return}try{const d=localStorage.getItem("currentBatchId");if(!d){alert("No active batch found");return}const p=yield ri({batchId:d,toolsCount:1,assignedLocation:l});if(p.status==="invalid_location"){alert(`Invalid location: ${p.reasoning}`);return}const{supabase:m}=yield qe(()=>Promise.resolve().then(()=>Pc),void 0);yield m.from("sterilization_batches").update({location_barcode:l}).eq("id",d),yield m.from("inventory_items").update({scanned_location:l}).eq("batch_id",d),alert(`âœ… Location ${l} assigned successfully`),document.body.removeChild(s)}catch(d){console.error("Error assigning location:",d),alert("Error assigning location. Please try again.")}}),o=()=>{document.body.removeChild(s)};n==null||n.addEventListener("click",c),a==null||a.addEventListener("click",o),setTimeout(()=>i==null?void 0:i.focus(),100)}})),hx={unwrapped:{name:"Unwrapped",temp:"132Â°C (270Â°F)",sterilizeTime:3,dryTime:30,totalTime:15,duration:900},pouches:{name:"Pouches",temp:"132Â°C (270Â°F)",sterilizeTime:5,dryTime:30,totalTime:17,duration:1020},packs:{name:"Packs",temp:"121Â°C (250Â°F)",sterilizeTime:30,dryTime:30,totalTime:40,duration:2400},handpieces:{name:"Handpieces",temp:"132Â°C (270Â°F)",sterilizeTime:6,dryTime:30,totalTime:16,duration:960}},gx=()=>"pouches";var fx=Object.defineProperty,bx=Object.defineProperties,yx=Object.getOwnPropertyDescriptors,ln=Object.getOwnPropertySymbols,vx=Object.prototype.hasOwnProperty,jx=Object.prototype.propertyIsEnumerable,on=(r,t,s)=>t in r?fx(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,cn=(r,t)=>{for(var s in t||(t={}))vx.call(t,s)&&on(r,s,t[s]);if(ln)for(var s of ln(t))jx.call(t,s)&&on(r,s,t[s]);return r},dn=(r,t)=>bx(r,yx(t));const wx=()=>{const{timers:r,startTimer:t,pauseTimer:s,resetTimer:n,resumeTimer:a}=es(),{currentCycle:i,setCurrentCycle:c}=G(),o=u.useCallback((p,m)=>{t(p,m)},[t]),l=u.useCallback(p=>{const m=r[p];m!=null&&m.isRunning?s(p):m&&a(p)},[r,s,a]),d=u.useCallback(p=>{if(console.log("ðŸ›‘ Cancelling timer for phase:",p),s(p),n(p),i){console.log("ðŸ›‘ Clearing tools from cycle. Current tools:",i.tools);const m=dn(cn({},i),{tools:[],phases:i.phases.map(x=>dn(cn({},x),{tools:[],isActive:!1,status:"pending",startTime:null,endTime:null}))});c(m),console.log("âœ… Cycle cleared, tools removed. Workflow can be restarted.")}},[s,n,i,c]);return{handleStartTimer:o,handlePauseTimer:l,handleStopTimer:d}},Nx=()=>{const{startTimer:r,pauseTimer:t,resetTimer:s}=es(),{currentCycle:n,moveToolToNextPhase:a,updateToolStatus:i,addActivity:c}=G(),{currentUser:o}=He();return{handleMoveToNextPhase:u.useCallback(d=>{if(console.log(`ðŸ”„ Starting phase transition from ${d}`),!o){console.log("âŒ User authentication required for phase transitions"),alert("Please log in to perform sterilization phase transitions");return}if(!n){console.log("âŒ No active cycle found");return}const p=n.tools.some(g=>{const v=G.getState().availableTools.find(j=>j.id===g);return v==null?void 0:v.isP2Status});if(d==="drying"&&p){console.log("âœ… Completing P2 Status tools after drying phase"),n.tools.forEach(g=>{const v=G.getState().availableTools.find(j=>j.id===g);if(v!=null&&v.isP2Status){const j=G.getState();j.incrementToolCycleCount&&j.incrementToolCycleCount(g),console.log(`Tool ${g} status updated to complete`),de.monitorToolStatusChange(g,"drying","complete"),console.log(`âœ… P2 Status tool ${v.name} completed and cycle count incremented`)}}),t(d),s(d);return}const m=["bath1","bath2","airDry","autoclave"],x=m.indexOf(d),f=m[x+1];if(f){console.log(`ðŸ”„ Moving tools from ${d} to ${f}`),n.tools.forEach(v=>{const j=G.getState().availableTools.find(h=>h.id===v);j&&(a(v),console.log(`Tool ${v} status updated to ${f}`),console.log(`âœ… Moved tool ${j.name} from ${d} to ${f}`))}),t(d),s(d);const g=wi[f];g&&r(f,g.duration),console.log(`âœ… Phase transition completed: ${d} â†’ ${f}`)}else{console.log("âœ… Completing all tools after autoclave phase");const g=[];n.tools.forEach(v=>{const j=G.getState().availableTools.find(h=>h.id===v);if(j){const h=G.getState();h.incrementToolCycleCount&&h.incrementToolCycleCount(v),console.log(`Tool ${v} status updated to complete`),de.monitorToolStatusChange(v,"autoclave","available"),g.push(j),console.log(`âœ… Tool ${j.name} completed sterilization cycle and marked as available`)}}),g.length>0&&(c({id:`cycle-${n.cycleNumber}-${Date.now()}`,type:"cycle-complete",title:`Cycle ${n.cycleNumber} Completed`,time:new Date,toolCount:g.length,color:"bg-green-500"}),console.log(`âœ… Activity logged: Cycle ${n.cycleNumber} completed with ${g.length} tools`)),t(d),s(d)}},[o,n,r,t,s,a,c])}},Je=r=>{const t=Math.floor(r/3600),s=Math.floor(r%3600/60),n=r%60;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},Cx=(r,t)=>r?"bg-red-100 text-red-700 border border-red-200":t?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-600",Sx=(r,t)=>r?"OVEREXPOSED":t?"ACTIVE":"INACTIVE",_x=(r,t,s,n)=>{var a;if(!r)return t==="drying"?"00:00:00":Je(s);if(t==="drying")return Je(n);if((t==="bath1"||t==="bath2")&&r.overexposed&&r.elapsedTime){const c=r.elapsedTime-s;return`+${Je(c)}`}return Je((a=r.timeRemaining)!=null?a:0)},Tx=({phaseId:r,phaseConfig:t,timer:s,duration:n,elapsedTime:a,isExpanded:i,onToggleExpanded:c})=>{var o;const{currentCycle:l}=G(),d=(o=s==null?void 0:s.timeRemaining)!=null?o:n,p=(s==null?void 0:s.isRunning)||!1,m=(s==null?void 0:s.overexposed)||!1,x=l==null?void 0:l.tools.some(f=>{const g=G.getState().availableTools.find(v=>v.id===f);return g==null?void 0:g.isP2Status});return e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:c,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&c()},role:"button",tabIndex:0,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#5b5b5b]",children:t.label}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${Cx(m,p)}`,children:Sx(m,p)}),r==="drying"&&x&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 border border-blue-200",children:"P2 STATUS"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-2xl font-mono font-bold ${m?"text-red-600":"text-[#5b5b5b]"}`,children:_x(s,r,n,a)}),e.jsx("div",{className:"text-xs text-gray-500",children:s?`${s.elapsedTime?`${Math.floor(s.elapsedTime/60)}:${(s.elapsedTime%60).toString().padStart(2,"0")}`:"00:00"} elapsed`:"Ready"})]}),e.jsx(C,{path:i?Zo:mt,size:1,className:"text-gray-400"})]})]}),r!=="drying"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 relative",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${m?"bg-red-500":"bg-[#4ECDC4]"}`,style:{width:`${d/n*100}%`}})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:m&&(r==="bath1"||r==="bath2")?`100% + ${Je(a-n)} overexposed`:`${Math.round((n-d)/n*100)}% complete`})]})]})},kx=({phaseId:r,timer:t,onPauseTimer:s,onStopTimer:n,onMoveToNextPhase:a})=>{const{currentCycle:i}=G(),c=(t==null?void 0:t.isRunning)||!1,o=t&&t.timeRemaining===0,l=i&&i.tools.length>0,d=i==null?void 0:i.tools.some(m=>{const x=G.getState().availableTools.find(f=>f.id===m);return x==null?void 0:x.isP2Status}),p=l&&(r==="bath1"&&o||r==="bath2"&&t||r==="drying"&&t||r==="autoclave"&&o);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[r==="bath1"&&t?e.jsxs("button",{onClick:()=>s(r),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200"}`,children:[e.jsx(C,{path:c?Qr:br,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):r==="bath1"?e.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via workflow"}):t?e.jsxs("button",{onClick:()=>s(r),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,children:[e.jsx(C,{path:c?Qr:br,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):e.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via previous phase"}),e.jsx("button",{onClick:()=>n(r),className:"px-4 py-2 bg-red-100 text-red-700 border border-red-300 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Cancel"})]}),p&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>a(r),className:"w-full px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:r==="drying"&&d?"Complete P2 Status Tools":r==="autoclave"?"Complete All Tools":"Move to Next Phase"})})]})},Ix=({selectedCycle:r,onCycleSelect:t})=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Select Cycle Type:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(hx).map(([s,n])=>e.jsxs("button",{onClick:()=>t(s),className:`p-3 text-xs rounded-lg border transition-all duration-200 ${r===s?"bg-[#4ECDC4] text-white border-[#4ECDC4] shadow-sm":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-[#4ECDC4]"}`,children:[e.jsx("div",{className:"font-medium",children:n.name}),e.jsx("div",{className:"text-xs opacity-75",children:n.temp}),e.jsxs("div",{className:"text-xs opacity-75",children:[n.totalTime," min"]})]},s))})]}),Px=({duration:r,isRunning:t,timer:s})=>e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{children:["Duration: ",Je(r||0)]}),e.jsxs("div",{children:["Status: ",t?"Running":"Stopped"]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Remaining: ",Je(s.timeRemaining||0)]}),e.jsxs("div",{children:["Elapsed: ",Je(s.elapsedTime||0)]})]})]}),Dx=()=>{const r=G(a=>a.currentCycle),t=G(a=>a.availableTools),n=u.useMemo(()=>(r==null?void 0:r.tools)||[],[r==null?void 0:r.tools]).map(a=>t.find(i=>i.id===a)).filter(a=>a!==void 0);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:Be,size:.8,className:"text-gray-500"}),e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Tools in Phase"})]}),(r==null?void 0:r.cycleNumber)&&e.jsx("span",{className:"text-xs text-gray-500 font-mono bg-white px-2 py-1 rounded border",children:r.cycleNumber})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.length>0?n.map(a=>e.jsx("span",{className:"px-2 py-1 bg-white text-xs text-gray-600 rounded border",children:a.name},a.id)):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-xs text-gray-500 rounded border",children:"No tools in cycle"})})]})},$i=u.memo(({className:r=""})=>{const{timers:t}=es(),[s,n]=u.useState(null),[a,i]=u.useState(gx()),{handlePauseTimer:c,handleStopTimer:o}=wx(),{handleMoveToNextPhase:l}=Nx(),d=x=>{n(s===x?null:x)},p=x=>{o(x),n(null)},m=x=>{l(x),n(null)};return e.jsxs("div",{className:`space-y-4 ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"Sterilization Timers"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Individual phase timers for concurrent cycles"})]}),e.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-[#4ECDC4] text-white rounded-full",children:"Phase Timers"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(wi).map(([x,f])=>{var g;const v=t[x],j=f.duration,h=s===x,y=(g=v==null?void 0:v.elapsedTime)!=null?g:0;return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-300 ${v!=null&&v.isRunning||x==="bath1"?"shadow-[0_0_25px_rgba(78,205,196,0.5)] border-[#4ECDC4] ring-2 ring-[#4ECDC4] ring-opacity-30":""}`,children:[e.jsx(Tx,{phaseId:x,phaseConfig:f,timer:v,duration:j,elapsedTime:y,isExpanded:h,onToggleExpanded:()=>d(x)}),h&&e.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[e.jsx(Dx,{}),x==="autoclave"&&e.jsx(Ix,{selectedCycle:a,onCycleSelect:i}),e.jsx(kx,{phaseId:x,timer:v,onPauseTimer:c,onStopTimer:p,onMoveToNextPhase:m}),e.jsx(Px,{duration:j||0,isRunning:(v==null?void 0:v.isRunning)||!1,timer:v})]})]},x)})})]})});$i.displayName="TimerDisplay";const Ex=u.memo(function({activeTab:t,tabs:s,SterilizationAnalyticsComponent:n,onTabChange:a,getTabButtonClasses:i}){return e.jsxs("div",{className:"bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("div",{className:"flex flex-wrap gap-2 p-4",children:s.map(c=>e.jsxs("button",{onClick:()=>a(c.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${i(t===c.id)}`,children:[e.jsx(C,{path:c.icon,size:.8}),c.label]},c.id))})}),e.jsxs("div",{className:"p-6",children:[t==="timers"&&e.jsx($i,{}),t==="analytics"&&e.jsx(e.Fragment,{children:n&&e.jsx(n,{})}),t==="logs"&&e.jsx(u.Suspense,{fallback:e.jsx(om,{}),children:e.jsx(ox,{})})]})]})}),Ox=({isOpen:r,operatorName:t,onOperatorNameChange:s,onOperatorNameKeyPress:n,onStartCycle:a,onClose:i,getStartCycleButtonState:c})=>r?Is.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999]",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Start New Sterilization Cycle"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator Name"}),e.jsx("input",{id:"operator-name",type:"text",value:t,onChange:s,placeholder:"Enter operator name...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",onKeyPress:n})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a,disabled:c(t).disabled,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${c(t).className}`,children:"Start Cycle"}),e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"})]})]})]})}),document.body):null;var $x=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Ax=({isOpen:r,onClose:t})=>{const{lastGeneratedCode:s,setShowBatchCodeModal:n}=G(),[a,i]=u.useState(!1);u.useEffect(()=>{r||n(!1)},[r,n]);const c=()=>{n(!1),t()},o=()=>$x(null,null,function*(){if(s!=null&&s.code)try{yield navigator.clipboard.writeText(s.code),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error(d)}}),l=()=>{const d=window.open("","_blank");d&&s&&(d.document.write(`
        <html>
          <head>
            <title>Batch Code - ${s.code}</title>
            <style>
              body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
              .batch-code { font-size: 48px; font-weight: bold; margin: 20px 0; }
              .info { font-size: 16px; margin: 10px 0; }
              .instructions { text-align: left; margin: 20px 0; }
              @media print { body { margin: 0; } }
            </style>
          </head>
          <body>
            <h1>Batch Code</h1>
            <div class="batch-code">${s.code}</div>
            <div class="info">
              <p><strong>Generated:</strong> ${s.generatedAt.toLocaleString()}</p>
              <p><strong>Operator:</strong> ${s.operator}</p>
              <p><strong>Tools:</strong> ${s.toolCount}</p>
            </div>
            <div class="instructions">
              <h3>Instructions:</h3>
              <ol>
                <li>Write this batch code clearly on the package</li>
                <li>Add today's date</li>
                <li>Add your name (${s.operator})</li>
                <li>Place package in autoclave</li>
              </ol>
            </div>
          </body>
        </html>
      `),d.document.close(),d.print())};return!r||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{path:ec,size:1.5,className:"text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Batch Code Generated"})]}),e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(le,{path:ae,size:1.5})})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-4",children:[e.jsx("p",{className:"text-sm text-purple-600 mb-2",children:"Your Batch Code"}),e.jsx("div",{className:"text-3xl font-bold text-purple-800 font-mono tracking-wider",children:s.code})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Generated:"})," ",s.generatedAt.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Operator:"})," ",s.operator]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tools:"})," ",s.toolCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",s.isSingleTool?"Single Tool":"Batch"]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Instructions"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-2",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"1."}),e.jsx("span",{children:"Write this batch code clearly on the package"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"2."}),e.jsxs("span",{children:["Add today's date: ",new Date().toLocaleDateString()]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"3."}),e.jsxs("span",{children:["Add your name: ",s.operator]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-bold mr-2",children:"4."}),e.jsx("span",{children:"Place package in autoclave for sterilization"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[e.jsx(le,{path:ui,size:1}),e.jsx("span",{children:a?"Copied!":"Copy Code"})]}),e.jsxs("button",{onClick:l,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(le,{path:li,size:1}),e.jsx("span",{children:"Print"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:c,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Done"})}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Important:"})," This batch code is now tracked in the system. If a BI failure occurs, all tools in this batch will be affected."]})})]})})};var Rx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Bx=u.memo(({SterilizationAnalyticsComponent:r})=>{const{recordBITestResult:t,lastBITestDate:s,biTestOptedOut:n,setBiTestOptedOut:a,enforceBI:i}=Di(),{startNewCycle:c,showBatchCodeModal:o,setShowBatchCodeModal:l}=G(),{tabs:d,validateOperatorName:p,getTabButtonClasses:m,getStartCycleButtonState:x}=rx(),{activeTab:f,showNewCycleModal:g,operatorName:v,handleTabChange:j,handleOperatorNameChange:h,handleCloseNewCycleModal:y,resetOperatorName:b}=ax();u.useEffect(()=>{Uo()},[]),u.useEffect(()=>{let T=null,k=!0;function S(){k&&(sx(s),T=setTimeout(S,3e5))}return S(),()=>{k=!1,T&&(clearTimeout(T),T=null)}},[s]);const _=u.useCallback(T=>Rx(null,null,function*(){console.log("ðŸ”¬ Dashboard: handleBITestComplete called with:",T);try{yield t(T),console.log("ðŸ”¬ Dashboard: BI test result recorded successfully")}catch(k){console.error("ðŸ”¬ Dashboard: Error recording BI test result:",k)}}),[t]),E=u.useCallback(()=>{p(v)&&(c(v.trim()),y(),b())},[v,c,p,y,b]),$=u.useCallback(()=>{a(!0)},[a]);u.useCallback(()=>{},[]);const P=u.useMemo(()=>{if(!i||n)return!1;const T=new Date().toDateString(),k=s?new Date(s).toDateString():null;return console.log("ðŸ”¬ Dashboard: Banner visibility check:",{enforceBI:i,biTestOptedOut:n,lastBITestDate:s,lastTestDate:k,today:T,shouldShow:k!==T}),k!==T},[i,n,s]),w=u.useCallback(T=>{T.key==="Enter"&&E()},[E]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(tx,{isVisible:P,onComplete:_,onOptOut:$}),e.jsx(Oi,{}),e.jsx(Ex,{activeTab:f,tabs:d,SterilizationAnalyticsComponent:r,onTabChange:j,getTabButtonClasses:m}),e.jsx(Ox,{isOpen:g,operatorName:v,onOperatorNameChange:h,onOperatorNameKeyPress:w,onClose:y,onStartCycle:E,getStartCycleButtonState:x}),e.jsx(Ax,{isOpen:o,onClose:()=>l(!1)})]})});Bx.displayName="SterilizationDashboard";const wv=()=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",role:"banner","aria-label":"Inventory management header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Inventory Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage your inventory items and equipment"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Item scanner controls",children:[e.jsx("span",{className:"text-gray-600",children:"Item Scanner"}),e.jsx(Jl,{to:"/inventory/scanner",children:e.jsx(xr,{variant:"success",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1","aria-label":"Scan new inventory item using barcode scanner",tabIndex:0,children:"Inventory Scanner"})})]})})]}),Nv=()=>e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})});var Fx=Object.defineProperty,Mx=Object.defineProperties,Lx=Object.getOwnPropertyDescriptors,un=Object.getOwnPropertySymbols,zx=Object.prototype.hasOwnProperty,Ux=Object.prototype.propertyIsEnumerable,mn=(r,t,s)=>t in r?Fx(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,qx=(r,t)=>{for(var s in t||(t={}))zx.call(t,s)&&mn(r,s,t[s]);if(un)for(var s of un(t))Ux.call(t,s)&&mn(r,s,t[s]);return r},Hx=(r,t)=>Mx(r,Lx(t));const Ai=()=>{Fp();const r=St(),{tools:t,supplies:s,equipment:n,officeHardware:a}=r,i=[...t,...s,...n,...a],c=i.map(o=>{var l;return Hx(qx({},o),{category:(l=o.category)!=null?l:"uncategorized"})});return{allItems:i,itemsWithCategory:c,tools:t,supplies:s,equipment:n,officeHardware:a,totalUniqueItems:t.length+s.length+n.length+a.length,refreshData:r.refreshData,getAllItems:()=>i,getItemsByCategory:o=>{switch(o){case"tools":return t;case"supplies":return s;case"equipment":return n;case"officeHardware":return a;default:return[]}}}};var Vx=Object.defineProperty,pn=Object.getOwnPropertySymbols,Wx=Object.prototype.hasOwnProperty,Gx=Object.prototype.propertyIsEnumerable,xn=(r,t,s)=>t in r?Vx(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,hn=(r,t)=>{for(var s in t||(t={}))Wx.call(t,s)&&xn(r,s,t[s]);if(pn)for(var s of pn(t))Gx.call(t,s)&&xn(r,s,t[s]);return r},Kx=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Qx=r=>({items:[],categories:[],selectedItems:[],isLoading:!1,isCategoriesLoading:!1,setItems:t=>r({items:t,inventoryItems:t}),setCategories:t=>r({categories:t}),addItem:t=>r(s=>({items:[...s.items,t],inventoryItems:[...s.items,t]})),updateItem:(t,s)=>r(n=>{const a=n.items.map(i=>i.id===t?hn(hn({},i),s):i);return{items:a,inventoryItems:a}}),deleteItem:t=>r(s=>{const n=s.items.filter(a=>a.id!==t);return{items:n,inventoryItems:n}}),addCategory:t=>r(s=>({categories:[...s.categories,t]})),removeCategory:t=>r(s=>({categories:s.categories.filter(n=>n!==t)})),setSelectedItems:t=>r({selectedItems:t}),setLoading:t=>r({isLoading:t}),setCategoriesLoading:t=>r({isCategoriesLoading:t}),setInventoryLoading:t=>r({isLoading:t}),refreshInventoryData:()=>Kx(null,null,function*(){console.log("Refreshing inventory data...")}),getFilteredItems:()=>[],getUniqueCategories:()=>[],inventoryItems:[]});var Yx=Object.defineProperty,Jx=Object.defineProperties,Xx=Object.getOwnPropertyDescriptors,gn=Object.getOwnPropertySymbols,Zx=Object.prototype.hasOwnProperty,eh=Object.prototype.propertyIsEnumerable,fn=(r,t,s)=>t in r?Yx(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,th=(r,t)=>{for(var s in t||(t={}))Zx.call(t,s)&&fn(r,s,t[s]);if(gn)for(var s of gn(t))eh.call(t,s)&&fn(r,s,t[s]);return r},sh=(r,t)=>Jx(r,Xx(t));const rh=r=>({activeTab:"tools",showFilters:!1,showTrackedOnly:!1,showFavoritesOnly:!1,expandedSections:{general:!0,purchase:!1,maintenance:!1,usage:!1},showFiltersPanel:!1,showAnalytics:!0,showBulkActions:!1,mergeMode:!1,selectedItems:[],trackedItems:new Set,trackingData:new Map,setActiveTab:t=>r({activeTab:t}),setShowFilters:t=>r({showFilters:t}),setShowTrackedOnly:t=>r({showTrackedOnly:t}),setShowFavoritesOnly:t=>r({showFavoritesOnly:t}),setExpandedSections:t=>r({expandedSections:t}),toggleExpandedSection:t=>r(s=>({expandedSections:sh(th({},s.expandedSections),{[t]:!s.expandedSections[t]})})),setShowFiltersPanel:t=>r({showFiltersPanel:t}),setShowAnalytics:t=>r({showAnalytics:t}),setShowBulkActions:t=>r({showBulkActions:t}),toggleTrackedItem:(t,s)=>r(n=>{const a=new Set(n.trackedItems),i=new Map(n.trackingData);return a.has(t)?(a.delete(t),i.delete(t)):(a.add(t),i.set(t,{doctor:s,timestamp:new Date().toISOString()})),{trackedItems:a,trackingData:i}}),setTrackedItems:t=>r({trackedItems:t}),setTrackingData:t=>r({trackingData:t}),setMergeMode:t=>r({mergeMode:t,selectedItems:t?[]:[]}),toggleItemSelection:t=>r(s=>{const n=[...s.selectedItems],a=n.indexOf(t);return a>-1?n.splice(a,1):n.push(t),{selectedItems:n}}),clearSelectedItems:()=>r({selectedItems:[]}),selectAllItems:t=>r({selectedItems:[...t]})}),ah=r=>({showAddModal:!1,showTrackModal:!1,showUploadBarcodeModal:!1,showScanModal:!1,showDeleteModal:!1,itemToDelete:null,scanMode:null,scannedItems:[],setShowAddModal:t=>r({showAddModal:t}),setShowTrackModal:t=>r({showTrackModal:t}),setShowUploadBarcodeModal:t=>r({showUploadBarcodeModal:t}),setShowScanModal:t=>r({showScanModal:t}),setShowDeleteModal:t=>r({showDeleteModal:t}),setItemToDelete:t=>r({itemToDelete:t}),openDeleteModal:t=>r({showDeleteModal:!0,itemToDelete:t}),closeDeleteModal:()=>r({showDeleteModal:!1,itemToDelete:null}),setScanMode:t=>r({scanMode:t}),addScannedItem:t=>r(s=>({scannedItems:[...s.scannedItems,t]})),removeScannedItem:t=>r(s=>({scannedItems:s.scannedItems.filter(n=>n!==t)})),resetScannedItems:()=>r({scannedItems:[]}),openAddModal:()=>r({showAddModal:!0}),closeAddModal:()=>r({showAddModal:!1}),openTrackModal:()=>r({showTrackModal:!0}),closeTrackModal:()=>r({showTrackModal:!1}),openUploadBarcodeModal:()=>r({showUploadBarcodeModal:!0}),closeUploadBarcodeModal:()=>r({showUploadBarcodeModal:!1}),toggleUploadBarcodeModal:()=>r(t=>({showUploadBarcodeModal:!t.showUploadBarcodeModal})),openScanModal:()=>r({showScanModal:!0}),closeScanModal:()=>r({showScanModal:!1})}),nh=()=>{try{const r=localStorage.getItem("cliniio-favorites");return r?JSON.parse(r):[]}catch(r){return console.warn("Failed to load favorites from localStorage:",r),[]}},bn=r=>{try{localStorage.setItem("cliniio-favorites",JSON.stringify(r))}catch(t){console.warn("Failed to save favorites to localStorage:",t)}},lh=r=>({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",favorites:nh(),showFavoritesOnly:!1,sortField:"name",sortDirection:"asc",setSearchQuery:t=>r({searchQuery:t,searchTerm:t}),setSearchTerm:t=>r({searchTerm:t,searchQuery:t}),setCategoryFilter:t=>r({categoryFilter:t}),setLocationFilter:t=>r({locationFilter:t}),setStatusFilter:t=>r({statusFilter:t}),setActiveFilter:t=>r({activeFilter:t}),setFavorites:t=>{r({favorites:t}),bn(t)},toggleFavorite:t=>r(s=>{const n=s.favorites.includes(t)?s.favorites.filter(a=>a!==t):[...s.favorites,t];return bn(n),{favorites:n}}),setShowFavoritesOnly:t=>r({showFavoritesOnly:t}),setSortField:t=>r({sortField:t}),setSortDirection:t=>r({sortDirection:t}),clearFilters:()=>r({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:""}),resetFilters:()=>r({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",sortField:"name",sortDirection:"asc",showFavoritesOnly:!1}),clearSearch:()=>r({searchQuery:"",searchTerm:""})});var ih=Object.defineProperty,oh=Object.defineProperties,ch=Object.getOwnPropertyDescriptors,yn=Object.getOwnPropertySymbols,dh=Object.prototype.hasOwnProperty,uh=Object.prototype.propertyIsEnumerable,vn=(r,t,s)=>t in r?ih(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,er=(r,t)=>{for(var s in t||(t={}))dh.call(t,s)&&vn(r,s,t[s]);if(yn)for(var s of yn(t))uh.call(t,s)&&vn(r,s,t[s]);return r},mh=(r,t)=>oh(r,ch(t));function jn(){return{id:"",itemName:"",category:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:0,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const ph=(r,t)=>({formData:jn(),isEditMode:!1,isDirty:!1,isCloned:!1,setFormData:s=>r({formData:s,isDirty:!1}),mergeFormData:s=>{console.log("ðŸ” mergeFormData called with:",s),r(n=>({formData:er(er({},n.formData),s),isDirty:!0}))},updateField:(s,n)=>r(a=>({formData:mh(er({},a.formData),{[s]:n}),isDirty:!0})),resetForm:()=>r({formData:jn(),isEditMode:!1,isDirty:!1,isCloned:!1}),setEditMode:s=>r({isEditMode:s}),setIsCloned:s=>r({isCloned:s}),markAsDirty:()=>r({isDirty:!0}),markAsClean:()=>r({isDirty:!1}),openEditModal:s=>{var n;const{setFormData:a,setEditMode:i}=t(),c={id:s.id,itemName:s.name||s.item||"",category:s.category||"",location:s.location||"",status:s.status||"",quantity:s.quantity||1,unitCost:s.unit_cost||0,minimumQuantity:s.reorder_point||0,maximumQuantity:((n=s.data)==null?void 0:n.maximumQuantity)||0,supplier:s.supplier||"",barcode:s.barcode||"",sku:s.sku||"",description:s.description||"",notes:s.notes||"",updated_at:s.updated_at||new Date().toISOString(),createdAt:s.created_at||new Date().toISOString()};a(c),i(!0)},closeEditModal:()=>{const{resetForm:s}=t();s()}}),xh=r=>({currentPage:1,itemsPerPage:10,totalItems:0,setCurrentPage:t=>r({currentPage:t}),setItemsPerPage:t=>r({itemsPerPage:t,currentPage:1}),setTotalItems:t=>r({totalItems:t}),nextPage:()=>r(t=>{const s=Math.ceil(t.totalItems/t.itemsPerPage);return{currentPage:Math.min(t.currentPage+1,s)}}),previousPage:()=>r(t=>({currentPage:Math.max(t.currentPage-1,1)})),goToPage:t=>r(s=>{const n=Math.ceil(s.totalItems/s.itemsPerPage);return{currentPage:Math.max(1,Math.min(t,n))}}),resetPagination:()=>r({currentPage:1}),get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)},get startIndex(){return(this.currentPage-1)*this.itemsPerPage},get endIndex(){return Math.min(this.startIndex+this.itemsPerPage,this.totalItems)},get pagination(){return{currentPage:this.currentPage,pageSize:this.itemsPerPage}}});var hh=Object.defineProperty,wn=Object.getOwnPropertySymbols,gh=Object.prototype.hasOwnProperty,fh=Object.prototype.propertyIsEnumerable,Nn=(r,t,s)=>t in r?hh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,bh=(r,t)=>{for(var s in t||(t={}))gh.call(t,s)&&Nn(r,s,t[s]);if(wn)for(var s of wn(t))fh.call(t,s)&&Nn(r,s,t[s]);return r};const yh=r=>({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1,setAnalyticsData:t=>r({analyticsData:t}),setLoadingAnalytics:t=>r({isLoadingAnalytics:t}),updateAnalytics:()=>{r(()=>({isLoadingAnalytics:!0})),setTimeout(()=>{r(t=>({isLoadingAnalytics:!1,analyticsData:bh({},t.analyticsData)}))},1e3)},resetAnalytics:()=>r({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1})});var vh=Object.defineProperty,Cn=Object.getOwnPropertySymbols,jh=Object.prototype.hasOwnProperty,wh=Object.prototype.propertyIsEnumerable,Sn=(r,t,s)=>t in r?vh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,at=(r,t)=>{for(var s in t||(t={}))jh.call(t,s)&&Sn(r,s,t[s]);if(Cn)for(var s of Cn(t))wh.call(t,s)&&Sn(r,s,t[s]);return r};const Nh=Ee()((...r)=>at(at(at(at(at(at(at({},Qx(...r)),rh(...r)),ah(...r)),lh(...r)),ph(...r)),xh(...r)),yh(...r))),Ve=()=>Nh(),Ch=()=>{const{showAddModal:r,showTrackModal:t,showUploadBarcodeModal:s,showScanModal:n,openAddModal:a,closeAddModal:i,openTrackModal:c,closeTrackModal:o,openUploadBarcodeModal:l,closeUploadBarcodeModal:d,openScanModal:p,closeScanModal:m,formData:x,setFormData:f,mergeFormData:g,updateField:v,isEditMode:j,setEditMode:h,expandedSections:y,setExpandedSections:b,resetForm:_}=Ve(),E=u.useCallback(()=>{h(!1),_(),a()},[h,_,a]),$=u.useCallback(O=>{h(!0),f(O),a()},[h,f,a]),P=u.useCallback(()=>{i(),h(!1),_()},[i,h,_]),w=u.useCallback(()=>{c()},[c]),T=u.useCallback(()=>{o()},[o]),k=u.useCallback(()=>{l()},[l]),S=u.useCallback(()=>{d()},[d]),I=u.useCallback(()=>{p()},[p]),D=u.useCallback(()=>{m()},[m]);return{showAddModal:r,showTrackModal:t,showUploadBarcodeModal:s,showScanModal:n,formData:x,isEditMode:j,expandedSections:y,openAddModal:E,openEditModal:$,openTrackModal:w,openUploadBarcodeModal:k,openScanModal:I,closeAddModal:P,closeTrackModal:T,closeUploadBarcodeModal:S,closeScanModal:D,setFormData:f,mergeFormData:g,updateField:v,setExpandedSections:b}};var Sh=Object.defineProperty,_h=Object.defineProperties,Th=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertySymbols,kh=Object.prototype.hasOwnProperty,Ih=Object.prototype.propertyIsEnumerable,Tn=(r,t,s)=>t in r?Sh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,zt=(r,t)=>{for(var s in t||(t={}))kh.call(t,s)&&Tn(r,s,t[s]);if(_n)for(var s of _n(t))Ih.call(t,s)&&Tn(r,s,t[s]);return r},Ut=(r,t)=>_h(r,Th(t)),Ph=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Dh=()=>{const r=Ch(),{refreshData:t}=St(),{searchQuery:s,setSearchQuery:n,favorites:a,setFavorites:i,trackedItems:c,trackingData:o,toggleTrackedItem:l}=Ve(),d=u.useCallback((w,T)=>{console.log(`ðŸ”„ Form field changed: ${w} = "${T}"`),console.log("ðŸ“ Current form data before update:",r.formData),console.log("ðŸ” Calling updateField with:",w,T),r.updateField(w,T),console.log("ðŸ“ Form data after update should be updated in store")},[r]),p=u.useCallback(w=>{r.setExpandedSections(Ut(zt({},r.expandedSections),{[w]:!r.expandedSections[w]}))},[r]),m=u.useCallback(w=>{const k=(I=>{if(!I)return 0;if(typeof I=="number")return I;const D=I.toString().replace(/[$,\s]/g,""),O=parseFloat(D);return isNaN(O)?0:O})(w.unitCost);console.log(`ðŸ’° Cost parsing: "${w.unitCost}" -> ${k}`);const S={name:w.itemName||"",category:w.category||"",location:w.location||"",status:w.status||"Active",quantity:w.quantity||1,unit_cost:k,facility_id:"unknown",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:(typeof w.reorder_point=="number"?w.reorder_point:0)||0,expiration_date:(typeof w.expiry_date=="string"?w.expiry_date:"")||"",supplier:(typeof w.supplier=="string"?w.supplier:"")||"",cost:k,vendor:(typeof w.supplier=="string"?w.supplier:"")||"",warranty:(typeof w.warranty=="string"?w.warranty:"")||"",maintenance_schedule:"",next_due:"",service_provider:"",assigned_to:"",notes:w.notes||"",tool_id:"",supply_id:"",equipment_id:"",hardware_id:"",p2_status:"",serial_number:(typeof w.serialNumber=="string"?w.serialNumber:"")||"",manufacturer:(typeof w.manufacturer=="string"?w.manufacturer:"")||"",image_url:"",tags:[],favorite:!1,tracked:!0,barcode:w.barcode||"",sku:w.sku||"",description:w.description||"",current_phase:"Active",is_active:!0,unit:"",expiration:(typeof w.expiry_date=="string"?w.expiry_date:"")||"",purchase_date:(typeof w.purchaseDate=="string"?w.purchaseDate:"")||"",last_serviced:"",last_updated:new Date().toISOString(),data:{warranty:w.warranty||"",notes:w.notes||"",purchaseDate:w.purchaseDate||"",supplier:w.supplier||"",manufacturer:w.manufacturer||"",expiry_date:w.expiry_date||"",assetTag:w.assetTag||"",brand:w.brand||"",model:w.model||"",serialNumber:w.serialNumber||"",barcode:w.barcode||"",sku:w.sku||"",description:w.description||"",tags:[],imageUrl:"",isActive:!0,tracked:!0,favorite:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),currentPhase:"Active",p2Status:"",toolId:"",supplyId:"",equipmentId:"",hardwareId:"",serviceProvider:"",assignedTo:""}};return console.log("ðŸ“¦ Converted item to save:",S),S},[]),x=u.useCallback(()=>Ph(null,null,function*(){try{console.log("ðŸ”„ Starting save process..."),console.log("ðŸ“ Form data:",r.formData);const w=m(Ut(zt({},r.formData),{name:r.formData.itemName,category:r.formData.category,quantity:r.formData.quantity,location:r.formData.location,manufacturer:r.formData.manufacturer,supplier:r.formData.supplier,expiry_date:r.formData.expiry_date}));if(console.log("ðŸ’¾ Item to save:",w),r.isEditMode){if(r.formData.id){console.log("âœï¸ Updating existing item...");const T=yield gs.updateItem(r.formData.id,w);if(console.log("âœ… Update response:",T),T.error)throw new Error(`Update failed: ${T.error}`);if(T.data){console.log("âœ… Item updated successfully:",T.data);const S=(I=>{var D,O,A,R,B,V,U,F,q,W,X,ie,te;return{itemName:I.name||I.item||"",category:I.category||"",id:I.id||"",location:I.location||"",createdAt:((D=I.data)==null?void 0:D.purchaseDate)||new Date().toISOString(),supplier:I.supplier||"",unit_cost:I.unit_cost||0,notes:((O=I.data)==null?void 0:O.notes)||"",updated_at:((A=I.data)==null?void 0:A.lastServiced)||new Date().toISOString(),status:I.status||"",quantity:I.quantity||1,reorder_point:I.reorder_point||0,barcode:((R=I.data)==null?void 0:R.barcode)||"",sku:((B=I.data)==null?void 0:B.sku)||"",description:((V=I.data)==null?void 0:V.description)||"",unitCost:I.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((U=I.data)==null?void 0:U.warranty)||"",purchaseDate:((F=I.data)==null?void 0:F.purchaseDate)||"",expiry_date:((q=I.data)==null?void 0:q.expiry_date)||"",assetTag:((W=I.data)==null?void 0:W.assetTag)||"",brand:((X=I.data)==null?void 0:X.brand)||"",model:((ie=I.data)==null?void 0:ie.model)||"",serialNumber:((te=I.data)==null?void 0:te.serialNumber)||"",manufacturer:I.manufacturer||""}})(T.data);r.setFormData(S)}else throw new Error("Update succeeded but no data returned")}}else{console.log("âž• Creating new item...");const T=yield gs.createItem(w);if(console.log("âœ… Create response:",T),T.error)throw new Error(`Create failed: ${T.error}`);if(!T.data)throw new Error("Create succeeded but no data returned")}console.log("âœ… Item saved successfully!"),console.log("ðŸ”„ Refreshing inventory data..."),yield t(),console.log("âœ… Inventory data refreshed!"),console.log("ðŸ§¹ Clearing analytics cache..."),gs.clearCache(),console.log("âœ… Analytics cache cleared!")}catch(w){console.error("âŒ Failed to save item:",w)}}),[r,m,t]),f=u.useCallback(()=>{},[]),g=u.useCallback(w=>{const T=new Set(a);T.has(w)?T.delete(w):T.add(w),i(Array.from(T))},[a,i]),v=u.useCallback((w,T)=>{l(w,T)},[l]),j=u.useCallback(w=>{n(w)},[n]),h=u.useCallback(w=>{const k=(S=>{var I,D,O,A,R,B,V,U,F,q,W,X,ie;return{itemName:S.name||S.item||"",category:S.category||"",id:S.id||"",location:S.location||"",createdAt:((I=S.data)==null?void 0:I.purchaseDate)||new Date().toISOString(),supplier:S.supplier||"",unit_cost:S.unit_cost||0,notes:((D=S.data)==null?void 0:D.notes)||"",updated_at:((O=S.data)==null?void 0:O.lastServiced)||new Date().toISOString(),status:S.status||"",quantity:S.quantity||1,reorder_point:S.reorder_point||0,barcode:((A=S.data)==null?void 0:A.barcode)||"",sku:((R=S.data)==null?void 0:R.sku)||"",description:((B=S.data)==null?void 0:B.description)||"",unitCost:S.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((V=S.data)==null?void 0:V.warranty)||"",purchaseDate:((U=S.data)==null?void 0:U.purchaseDate)||"",expiry_date:((F=S.data)==null?void 0:F.expiry_date)||"",assetTag:((q=S.data)==null?void 0:q.assetTag)||"",brand:((W=S.data)==null?void 0:W.brand)||"",model:((X=S.data)==null?void 0:X.model)||"",serialNumber:((ie=S.data)==null?void 0:ie.serialNumber)||"",manufacturer:S.manufacturer||""}})(w);r.openEditModal(k)},[r]),y=u.useCallback(()=>{r.openAddModal()},[r]),b=u.useCallback(w=>{console.log("ðŸ”„ Cloning item:",w);const k=(I=>{var D,O,A,R,B,V,U,F,q,W,X,ie,te;return{itemName:I.name||I.item||"",category:I.category||"",id:I.id||"",location:I.location||"",createdAt:((D=I.data)==null?void 0:D.purchaseDate)||new Date().toISOString(),supplier:I.supplier||"",unit_cost:I.unit_cost||0,notes:((O=I.data)==null?void 0:O.notes)||"",updated_at:((A=I.data)==null?void 0:A.lastServiced)||new Date().toISOString(),status:I.status||"",quantity:I.quantity||1,reorder_point:I.reorder_point||0,barcode:((R=I.data)==null?void 0:R.barcode)||"",sku:((B=I.data)==null?void 0:B.sku)||"",description:((V=I.data)==null?void 0:V.description)||"",unitCost:I.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3,warranty:((U=I.data)==null?void 0:U.warranty)||"",purchaseDate:((F=I.data)==null?void 0:F.purchaseDate)||"",expiry_date:((q=I.data)==null?void 0:q.expiry_date)||"",assetTag:((W=I.data)==null?void 0:W.assetTag)||"",brand:((X=I.data)==null?void 0:X.brand)||"",model:((ie=I.data)==null?void 0:ie.model)||"",serialNumber:((te=I.data)==null?void 0:te.serialNumber)||"",manufacturer:I.manufacturer||""}})(w),S=Ut(zt({},k),{id:"",barcode:"",itemName:`${k.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("ðŸ“‹ Cloned form data:",S),r.setFormData(S),r.openAddModal()},[r]),_=u.useCallback(()=>{console.log("ðŸ”„ Cloning current form data");const w=r.formData,T=Ut(zt({},w),{id:"",barcode:"",sku:"",itemName:`${w.itemName} (Copy)`,createdAt:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("ðŸ“‹ Cloned form data:",T),r.closeAddModal(),r.setFormData(T),r.openAddModal()},[r]),E=u.useCallback(()=>{r.openTrackModal()},[r]),$=u.useCallback(()=>{r.openUploadBarcodeModal()},[r]),P=u.useCallback(()=>{r.openScanModal()},[r]);return Ut(zt({},r),{handleFormChange:d,toggleSection:p,handleSaveItem:x,handleDeleteItem:f,handleEditItem:h,handleAddItem:y,handleCloneItem:b,handleCloneCurrentForm:_,openAddModal:y,handleTrackItem:v,handleSearchChange:j,handleOpenTrackModal:E,handleOpenUploadBarcodeModal:$,handleOpenScanModal:P,toggleFavorite:g,searchQuery:s,favorites:a,trackedItems:c,trackingData:o})},kn={ADD_ITEM:{id:"add-item-modal",title:"Add New Item",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!0,className:"inventory-modal"},SCAN_ITEM:{id:"scan-item-modal",title:"Scan Items",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!1,className:"scan-modal"}},Ri=[{id:"general",title:"General Information",defaultExpanded:!0,fields:[{name:"itemName",label:"Item Name",type:"text",required:!0,placeholder:"Enter item name"},{name:"category",label:"Category",type:"select",required:!0,options:[{value:"tools",label:"Tools"},{value:"supplies",label:"Supplies"},{value:"equipment",label:"Equipment"},{value:"officeHardware",label:"Office Hardware"}]},{name:"id",label:"ID / Serial #",type:"text",required:!0,placeholder:"Enter ID or serial number"},{name:"location",label:"Location",type:"location",required:!0}]},{id:"purchase",title:"Purchase Information",defaultExpanded:!1,fields:[{name:"purchaseDate",label:"Purchase Date",type:"date",required:!1},{name:"vendor",label:"Vendor",type:"text",required:!1,placeholder:"Enter vendor name"},{name:"unitCost",label:"Cost",type:"text",required:!0,placeholder:"Enter cost (e.g., $25.99, 15.50)"},{name:"warranty",label:"Warranty",type:"text",required:!1,placeholder:"Enter warranty information"}]},{id:"maintenance",title:"Maintenance Information",defaultExpanded:!1,fields:[{name:"maintenanceSchedule",label:"Maintenance Schedule",type:"text",required:!1,placeholder:"Enter maintenance schedule"},{name:"lastServiced",label:"Last Serviced",type:"date",required:!1},{name:"nextDue",label:"Next Due",type:"date",required:!1},{name:"serviceProvider",label:"Service Provider",type:"text",required:!1,placeholder:"Enter service provider"}]},{id:"usage",title:"Usage Information",defaultExpanded:!1,fields:[{name:"assignedTo",label:"Assigned To",type:"text",required:!1,placeholder:"Enter assigned person"},{name:"status",label:"Status",type:"select",required:!1,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"p2",label:"P2"},{value:"n/a",label:"N/A"}]},{name:"isP2Status",label:"P2 Tool",type:"select",required:!1,options:[{value:"false",label:"No"},{value:"true",label:"Yes"}]},{name:"quantity",label:"Quantity",type:"number",required:!0,placeholder:"Enter quantity",validation:{min:0}},{name:"notes",label:"Notes",type:"textarea",required:!1,placeholder:"Additional notes"}]}],Eh=(r,t=!1)=>{const s={};for(const n of Ri)for(const a of n.fields)if(!(a.name==="id"&&!t)&&(a.required&&!r[a.name]&&(s[a.name]=`${a.label} is required`),a.validation&&r[a.name])){const i=r[a.name];a.validation.min!==void 0&&Number(i)<a.validation.min&&(s[a.name]=`${a.label} must be at least ${a.validation.min}`),a.validation.max!==void 0&&Number(i)>a.validation.max&&(s[a.name]=`${a.label} must be at most ${a.validation.max}`),a.validation.pattern&&typeof i=="string"&&(new RegExp(a.validation.pattern).test(i)||(s[a.name]=a.validation.message||`${a.label} format is invalid`))}return s},Oh=({formData:r,isEditMode:t,handleSaveItem:s})=>({handleSave:u.useCallback(()=>{console.log("ðŸ” Validating form data before save..."),console.log("ðŸ“ Current form data:",r),console.log("ðŸ” Is edit mode:",t);const a=Eh(r,t);if(console.log("âœ… Validation errors:",a),Object.keys(a).length===0)console.log("âœ… Validation passed, calling handleSaveItem..."),s();else{console.error("âŒ Validation failed:",a);return}},[r,t,s])});var $h=Object.defineProperty,Ah=Object.defineProperties,Rh=Object.getOwnPropertyDescriptors,In=Object.getOwnPropertySymbols,Bh=Object.prototype.hasOwnProperty,Fh=Object.prototype.propertyIsEnumerable,Pn=(r,t,s)=>t in r?$h(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,us=(r,t)=>{for(var s in t||(t={}))Bh.call(t,s)&&Pn(r,s,t[s]);if(In)for(var s of In(t))Fh.call(t,s)&&Pn(r,s,t[s]);return r},ms=(r,t)=>Ah(r,Rh(t));const Bi=()=>{const[r,t]=u.useState({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1}),s=()=>{if(!navigator.geolocation){t(a=>ms(us({},a),{error:"Geolocation is not supported by this browser.",isLoading:!1}));return}t(a=>ms(us({},a),{isLoading:!0,error:null})),navigator.geolocation.getCurrentPosition(a=>{t({latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,error:null,isLoading:!1})},a=>{let i="Unknown error occurred";switch(a.code){case a.PERMISSION_DENIED:i="Location access denied. Please enable location services.";break;case a.POSITION_UNAVAILABLE:i="Location information unavailable.";break;case a.TIMEOUT:i="Location request timed out.";break}t(c=>ms(us({},c),{error:i,isLoading:!1}))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},n=()=>{t({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1})};return ms(us({},r),{getCurrentLocation:s,clearLocation:n})};var Mh=Object.defineProperty,Lh=Object.defineProperties,zh=Object.getOwnPropertyDescriptors,Dn=Object.getOwnPropertySymbols,Uh=Object.prototype.hasOwnProperty,qh=Object.prototype.propertyIsEnumerable,En=(r,t,s)=>t in r?Mh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,tr=(r,t)=>{for(var s in t||(t={}))Uh.call(t,s)&&En(r,s,t[s]);if(Dn)for(var s of Dn(t))qh.call(t,s)&&En(r,s,t[s]);return r},On=(r,t)=>Lh(r,zh(t));const Bs=Ee()(Rs((r,t)=>({rooms:[],addRoom:s=>{const n=On(tr({},s),{id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});r(a=>({rooms:[...a.rooms,n]}))},updateRoom:(s,n)=>{r(a=>({rooms:a.rooms.map(i=>i.id===s?On(tr(tr({},i),n),{updatedAt:new Date().toISOString()}):i)}))},deleteRoom:s=>{r(n=>({rooms:n.rooms.filter(a=>a.id!==s)}))},getActiveRooms:()=>t().rooms.filter(s=>s.isActive),getRoomsByDepartment:s=>t().rooms.filter(n=>n.department===s&&n.isActive),getRoomByBarcode:s=>t().rooms.find(n=>n.barcode===s&&n.isActive)}),{name:"room-storage"})),Cv=Object.freeze(Object.defineProperty({__proto__:null,useRoomStore:Bs},Symbol.toStringTag,{value:"Module"}));var Hh=Object.defineProperty,Vh=Object.defineProperties,Wh=Object.getOwnPropertyDescriptors,$n=Object.getOwnPropertySymbols,Gh=Object.prototype.hasOwnProperty,Kh=Object.prototype.propertyIsEnumerable,An=(r,t,s)=>t in r?Hh(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Qh=(r,t)=>{for(var s in t||(t={}))Gh.call(t,s)&&An(r,s,t[s]);if($n)for(var s of $n(t))Kh.call(t,s)&&An(r,s,t[s]);return r},Yh=(r,t)=>Vh(r,Wh(t));const Jh=(r,t)=>{const n=r.latitude*Math.PI/180,a=t.latitude*Math.PI/180,i=(t.latitude-r.latitude)*Math.PI/180,c=(t.longitude-r.longitude)*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n)*Math.cos(a)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},Xh=(r,t,s=100)=>{const n=t.filter(c=>c.gpsCoordinates&&c.isActive);if(n.length===0)return null;let a=null,i=1/0;return n.forEach(c=>{if(c.gpsCoordinates){const o=Jh(r,c.gpsCoordinates);o<i&&o<=s&&(i=o,a=Yh(Qh({},c),{distance:Math.round(o)}))}}),a},Zh=r=>`${r.latitude.toFixed(6)}, ${r.longitude.toFixed(6)}`,eg=r=>r<1e3?`${Math.round(r)}m`:`${(r/1e3).toFixed(1)}km`,tg=({value:r,onChange:t,placeholder:s="Select location or use GPS",className:n=""})=>{const[a,i]=u.useState(!1),[c,o]=u.useState("room"),{getCurrentLocation:l,latitude:d,longitude:p,accuracy:m,isLoading:x}=Bi(),{getActiveRooms:f}=Bs(),g=f(),[v,j]=u.useState(null),h=$=>{o($),j(null),$==="gps"?l():$==="manual"&&t("")},y=$=>{t($),i(!1)},b=()=>{if(d&&p){const $=Xh({latitude:d,longitude:p},g,50);if($)j({room:$,distance:$.distance||0}),t($.name);else{const P=`GPS: ${d.toFixed(6)}, ${p.toFixed(6)}`;t(P),j(null)}i(!1)}},_=$=>{t($.target.value)},E=()=>c==="gps"&&d&&p?`GPS: ${d.toFixed(6)}, ${p.toFixed(6)}`:r;return e.jsxs("div",{className:`relative ${n}`,children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>h("room"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="room"?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[e.jsx(C,{path:vr,size:.8,className:"inline mr-1"}),"Room"]}),e.jsxs("button",{type:"button",onClick:()=>h("gps"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="gps"?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[e.jsx(C,{path:jr,size:.8,className:"inline mr-1"}),"GPS"]}),e.jsx("button",{type:"button",onClick:()=>h("manual"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="manual"?"bg-purple-100 text-purple-700 border border-purple-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:"Manual"})]}),c==="room"&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>i(!a),className:"w-full px-3 py-2 text-left border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("span",{className:r?"text-gray-900":"text-gray-500",children:r||s}),e.jsx(C,{path:mt,size:1,className:"float-right mt-1"})]}),a&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:g.length>0?g.map($=>e.jsxs("button",{type:"button",onClick:()=>y($.name),className:"w-full px-3 py-2 text-left hover:bg-gray-100 focus:outline-none focus:bg-gray-100",children:[e.jsx("div",{className:"font-medium text-gray-900",children:$.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[$.department," â€¢ ",$.floor]})]},$.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No rooms available"})})]}),c==="gps"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",onClick:l,disabled:x,className:"w-full px-3 py-2 text-sm bg-green-100 text-green-700 border border-green-300 rounded-md hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:x?"Getting location...":"Get Current Location"}),v&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("div",{className:"font-medium flex items-center",children:[e.jsx(C,{path:vr,size:.8,className:"mr-1"}),"Smart Room Detection"]}),e.jsxs("div",{className:"mt-1",children:["Suggested:"," ",e.jsx("span",{className:"font-medium",children:v.room.name})]}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Distance: ",eg(v.distance)]})]})}),d&&p&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Latitude: ",d.toFixed(6)]}),e.jsxs("div",{children:["Longitude: ",p.toFixed(6)]}),m&&e.jsxs("div",{children:["Accuracy: Â±",Math.round(m),"m"]})]}),e.jsx("button",{type:"button",onClick:b,className:"w-full px-3 py-2 text-sm bg-blue-100 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:v?"Use Suggested Room":"Use GPS Coordinates"})]})]}),c==="manual"&&e.jsx("input",{type:"text",value:r,onChange:_,placeholder:"Enter location manually",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Current location: ",E()]})]})},sg=({field:r,value:t,onChange:s})=>{var n,a,i;const c=o=>{s(o.target.value)};switch(r.type){case"text":return e.jsx("input",{type:"text",className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,value:t||"",onChange:c,required:r.required});case"number":return e.jsx("input",{type:"number",className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,value:t||"",onChange:c,required:r.required,min:(n=r.validation)==null?void 0:n.min,max:(a=r.validation)==null?void 0:a.max});case"date":return e.jsx("input",{type:"date",className:"form-control py-1 px-2 text-sm",value:t||"",onChange:c,required:r.required});case"select":return e.jsxs("select",{className:"form-select py-1 px-2 text-sm",value:t||"",onChange:c,required:r.required,children:[e.jsxs("option",{value:"",children:["Select ",r.label.toLowerCase()]}),(i=r.options)==null?void 0:i.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]});case"textarea":return e.jsx("textarea",{className:"form-control py-1 px-2 text-sm",placeholder:r.placeholder,rows:2,value:t||"",onChange:c,required:r.required});case"location":return e.jsx(tg,{value:t||"",onChange:s});default:return null}},rg=({section:r,expanded:t,onToggle:s,formData:n,handleFormChange:a})=>e.jsxs("div",{className:"mb-3 border border-gray-200 rounded-lg",children:[e.jsxs("button",{type:"button",onClick:s,className:"w-full p-3 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors rounded-t-lg",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:r.title}),e.jsx(C,{path:t?mt:ss,size:1,className:"text-gray-600"})]}),t&&e.jsx("div",{className:"p-3 border-t border-gray-200",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.fields.map(i=>i.name==="quantity"&&n.category==="tools"?null:e.jsxs("div",{children:[e.jsx("label",{htmlFor:`modal-${i.name}`,className:"block text-xs font-medium text-gray-700 mb-1",children:i.label}),e.jsx(sg,{field:i,value:n[i.name]||"",onChange:c=>a(i.name,c)})]},i.name))})})]}),Rn=({modalConfig:r,show:t,onHide:s,formData:n,isEditMode:a,isCloned:i=!1,expandedSections:c,toggleSection:o,handleFormChange:l,onSave:d,onClone:p,progressInfo:m,sections:x,children:f})=>{const g=i?"Cloned Edit Item":a?"Edit Item":r.title;return e.jsxs(je,{show:t,onHide:s,size:r.size,centered:r.centered,backdrop:r.backdrop,keyboard:r.keyboard,scrollable:r.scrollable,className:r.className,children:[e.jsx(je.Header,{closeButton:!0,children:e.jsxs(je.Title,{className:"flex items-center gap-3",children:[g,m&&e.jsxs("div",{className:"text-sm text-gray-500 font-normal",children:["(",m.current," of ",m.total,")"," ",m.currentItemName]})]})}),i&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mx-4 mt-2",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsx("strong",{children:"Database Safety Alert:"})," Please update the following fields before saving:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-yellow-700 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"ID/Serial #"})," - Must be unique"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Barcode"})," - Must be unique"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"SKU"})," - Must be unique"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Item Name"}),' - Currently shows "(Copy)" suffix']})]})]})]})}),e.jsxs(je.Body,{className:"max-h-[70vh] overflow-y-auto",children:[m&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Processing scanned items: ",m.current," of"," ",m.total]}),e.jsxs("span",{className:"text-xs text-blue-600",children:[Math.round(m.current/m.total*100),"% complete"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${m.current/m.total*100}%`}})})]}),e.jsx("div",{style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsxs("form",{id:"inventory-form",onSubmit:v=>{v.preventDefault(),d&&d()},children:[x==null?void 0:x.map(v=>e.jsx(rg,{section:v,expanded:c[v.id]||!1,onToggle:()=>o(v.id),formData:n,handleFormChange:l},v.id)),f]})})]}),e.jsxs(je.Footer,{className:"pt-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:p,className:"bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Clone"}),e.jsx("button",{onClick:s,className:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Cancel"})]}),d&&e.jsx("button",{type:"submit",form:"inventory-form",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:a?"Update Item":"Save Item"})]})]})},ag=u.lazy(()=>qe(()=>Promise.resolve().then(()=>Xb),void 0));u.lazy(()=>qe(()=>Promise.resolve().then(()=>Zb),void 0));const Sv=()=>{const{showAddModal:r,showUploadBarcodeModal:t,showScanModal:s,closeAddModal:n,closeUploadBarcodeModal:a,closeScanModal:i,formData:c,isEditMode:o,expandedSections:l,handleFormChange:d,toggleSection:p,handleSaveItem:m,handleCloneCurrentForm:x}=Dh(),{handleSave:f}=Oh({formData:c,isEditMode:o,handleSaveItem:m}),g=v=>{p(v)};return e.jsxs(e.Fragment,{children:[e.jsx(Rn,{modalConfig:kn.ADD_ITEM,show:r,onHide:n,formData:c,isEditMode:o,expandedSections:l,toggleSection:g,handleFormChange:d,onSave:f,onClone:x,sections:Ri}),e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center p-4",children:"Loading..."}),children:e.jsx(ag,{show:t,onClose:a})}),s&&e.jsx(Rn,{modalConfig:kn.SCAN_ITEM,show:s,onHide:i,formData:{itemName:"",category:"",id:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()},isEditMode:!1,expandedSections:{general:!1,purchase:!1,maintenance:!1,usage:!1},toggleSection:()=>{},handleFormChange:()=>{},children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("h4",{children:"Scan Items"}),e.jsx("p",{children:"Scan modal content would be implemented here"})]})})]})},ng=({show:r,onClose:t,title:s,children:n,footer:a,size:i="lg"})=>e.jsxs(je,{show:r,onHide:t,centered:!0,size:i,"aria-modal":"true",role:"dialog",children:[s&&e.jsx(je.Header,{closeButton:!0,className:"bg-gray-50 border-b border-gray-200",children:e.jsx(je.Title,{className:"text-xl font-semibold text-gray-800",children:s})}),e.jsx(je.Body,{className:"p-4",children:n}),a&&e.jsx(je.Footer,{className:"bg-gray-50 border-t border-gray-200 px-4 py-3",children:a})]}),_v=({show:r,onClose:t,onConfirm:s,item:n,isLoading:a=!1,activeTab:i="tools"})=>{if(!n)return null;const c=()=>{s()},o=()=>{t()};return e.jsx(ng,{show:r,onClose:t,title:"Confirm Archive",size:"lg",footer:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:o,disabled:a,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md font-medium transition-colors duration-200 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:c,disabled:a,className:"px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-md font-medium transition-colors duration-200 disabled:opacity-50 flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Archiving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{path:It,size:.8}),"Archive"]})})]}),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(C,{path:ut,size:1.2,className:"text-red-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:['Archive "',n.name,'"?']}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This will archive the item from the active inventory. The item will be hidden but preserved for audit purposes and compliance requirements."}),e.jsx("div",{className:"bg-gray-50 rounded-md p-3",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Item:"}),e.jsx("span",{children:n.name})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Category:"}),e.jsx("span",{children:n.category})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{children:n.location})]}),i!=="tools"&&n.quantity!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Quantity:"}),e.jsx("span",{children:n.quantity})]})]})})]})]})})},Tv=()=>e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})});var lg=Object.defineProperty,ig=Object.defineProperties,og=Object.getOwnPropertyDescriptors,Bn=Object.getOwnPropertySymbols,cg=Object.prototype.hasOwnProperty,dg=Object.prototype.propertyIsEnumerable,Fn=(r,t,s)=>t in r?lg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,ug=(r,t)=>{for(var s in t||(t={}))cg.call(t,s)&&Fn(r,s,t[s]);if(Bn)for(var s of Bn(t))dg.call(t,s)&&Fn(r,s,t[s]);return r},mg=(r,t)=>ig(r,og(t)),kr=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const pg=(r,t)=>{let s;return(...n)=>{clearTimeout(s),s=setTimeout(()=>r(...n),t)}},Mn=new Map,xg=1e3,hg=(r,t,s)=>{const n=`${r}:${t}:${JSON.stringify(s)}`,a=Date.now(),i=Mn.get(n);return i&&a-i<xg?!0:(Mn.set(n,a),!1)},kv={log:pg((...r)=>kr(null,null,function*(){const[t,s,n]=r;if(hg(t,s,n)){console.log("Skipping duplicate audit event:",{category:t,action:s});return}try{if(!Cr()){console.warn("âš ï¸ Supabase not configured, skipping audit event logging");return}const a=yield Ct.getCurrentFacilityId(),{data:{user:i}}=yield Q.auth.getUser(),c=(i==null?void 0:i.id)||crypto.randomUUID(),{error:o}=yield Q.from("audit_logs").insert({id:crypto.randomUUID(),module:t,table_name:t,action:s,record_id:null,user_id:c,facility_id:a,metadata:mg(ug({},n),{category:t,timestamp:new Date().toISOString()}),created_at:new Date().toISOString()});o?console.error("Failed to log audit event:",o):console.log("Audit event logged:",{category:t,action:s})}catch(a){console.error("Error logging audit event:",a)}}),100),logProblemToolAction:(r,t,s,n,a)=>kr(null,null,function*(){const{error:i}=yield Q.from("audit_logs").insert({event_type:"tool_problem_flagged",tool_id:r,facility_id:s,user_id:t,previous_status:n,new_status:"problem",details:a||null,happened_at:new Date().toISOString()});i&&console.error("Audit log insert failed:",i);try{if(!Cr()){console.warn("âš ï¸ Supabase not configured, skipping problem tool audit logging");return}const{error:c}=yield Q.from("audit_logs").insert({id:crypto.randomUUID(),module:"sterilization",table_name:"tools",action:"tool_problem_action",record_id:r,user_id:t,facility_id:s,old_values:{status:n},new_values:{status:"problem"},metadata:{problem_notes:a,timestamp:new Date().toISOString()},created_at:new Date().toISOString()});c?console.error("Failed to log problem tool action:",c):console.log("Problem tool action logged:",r)}catch(c){console.error("Error logging problem tool action:",c)}})};function gg(r,t,s,n){return kr(this,null,function*(){yield Q.from("audit_logs").insert({event_type:"RECEIPT_UPLOADED",receipt_id:r,batch_id:t,operator_name:s,facility_id:n,happened_at:new Date().toISOString()})})}var fg=Object.defineProperty,bg=Object.defineProperties,yg=Object.getOwnPropertyDescriptors,Ln=Object.getOwnPropertySymbols,vg=Object.prototype.hasOwnProperty,jg=Object.prototype.propertyIsEnumerable,zn=(r,t,s)=>t in r?fg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,qt=(r,t)=>{for(var s in t||(t={}))vg.call(t,s)&&zn(r,s,t[s]);if(Ln)for(var s of Ln(t))jg.call(t,s)&&zn(r,s,t[s]);return r},sr=(r,t)=>bg(r,yg(t)),nt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const rr=8,ps=4,Fi=Ee()(Rs((r,t)=>({statusTypes:[],isLoading:!1,error:null,fetchStatusTypes:()=>nt(null,null,function*(){r({isLoading:!0,error:null});try{r({statusTypes:[{id:"1",name:"Available",color:"#10B981",icon:"check-circle",description:"Item is available and ready for use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"2",name:"In Use",color:"#6B7280",icon:"pause-circle",description:"Item is currently in use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"3",name:"Maintenance",color:"#F59E0B",icon:"wrench",description:"Item requires maintenance",isDefault:!0,isCore:!0,isPublished:!0,category:"maintenance",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{id:"4",name:"Critical",color:"#EF4444",icon:"exclamation-triangle",description:"Item has critical issues",isDefault:!0,isCore:!0,isPublished:!0,category:"critical",requiresVerification:!0,autoTransition:!1,alertLevel:"critical"}],isLoading:!1})}catch(s){console.error("âŒ Error fetching status types:",s),r({error:s instanceof Error?s.message:"Failed to fetch status types",isLoading:!1})}}),refreshStatusTypes:()=>nt(null,null,function*(){yield t().fetchStatusTypes()}),getCoreStatusTypes:()=>t().statusTypes.filter(s=>s.isCore),getPublishedStatusTypes:()=>t().statusTypes.filter(s=>s.isPublished),getCustomStatusTypes:()=>t().statusTypes.filter(s=>!s.isCore),getStatusTypesByCategory:s=>t().statusTypes.filter(n=>n.category===s),getAllStatusTypes:()=>t().statusTypes,addStatusType:s=>nt(null,null,function*(){try{const n=t(),a=n.getCustomStatusTypes();if(a.length>=ps)throw new Error(`Maximum of ${ps} custom statuses allowed. You currently have ${a.length} custom statuses.`);if(n.statusTypes.length>=rr)throw new Error(`Maximum of ${rr} total statuses allowed. You currently have ${n.statusTypes.length} statuses.`);const i=sr(qt({id:Date.now().toString()},s),{isCore:!1,isPublished:!1});r(c=>({statusTypes:[...c.statusTypes,i]}))}catch(n){throw console.error("Error adding status type:",n),n}}),updateStatusType:(s,n)=>nt(null,null,function*(){const a=t().statusTypes.find(i=>i.id===s);if(a&&a.isCore){console.warn("Cannot update core status types");return}try{r(i=>({statusTypes:i.statusTypes.map(c=>c.id===s?qt(qt({},c),n):c)}))}catch(i){throw console.error("Error updating status type:",i),i}}),deleteStatusType:s=>nt(null,null,function*(){const n=t().statusTypes.find(a=>a.id===s);if(n&&n.isCore){console.warn("Cannot delete core status types");return}try{r(a=>({statusTypes:a.statusTypes.filter(i=>i.id!==s)}))}catch(a){throw console.error("Error deleting status type:",a),a}}),publishStatusType:s=>nt(null,null,function*(){const n=t().statusTypes.find(a=>a.id===s);if(n&&n.isCore){console.warn("Core status types are always published");return}try{r(a=>({statusTypes:a.statusTypes.map(i=>i.id===s?sr(qt({},i),{isPublished:!0}):i)}))}catch(a){throw console.error("Error publishing status type:",a),a}}),unpublishStatusType:s=>nt(null,null,function*(){const n=t().statusTypes.find(a=>a.id===s);if(n&&n.isCore){console.warn("Cannot unpublish core status types");return}try{r(a=>({statusTypes:a.statusTypes.map(i=>i.id===s?sr(qt({},i),{isPublished:!1}):i)}))}catch(a){throw console.error("Error unpublishing status type:",a),a}}),getStatusTypeById:s=>t().statusTypes.find(n=>n.id===s),getStatusTypeByName:s=>t().statusTypes.find(n=>n.name===s),getCategories:()=>{const s=new Set(t().statusTypes.map(n=>n.category).filter(Boolean));return Array.from(s).filter(n=>n!==void 0).sort()},getStatusCountInfo:()=>{const s=t(),n=s.getCoreStatusTypes(),a=s.getCustomStatusTypes();return{total:s.statusTypes.length,core:n.length,custom:a.length,maxCustom:ps}},canAddCustomStatus:()=>{const s=t();return s.getCustomStatusTypes().length<ps&&s.statusTypes.length<rr}}),{name:"status-types-storage",partialize:()=>({})})),Iv=()=>{const r=Fi();return u.useEffect(()=>{r.statusTypes.length===0&&!r.isLoading&&r.fetchStatusTypes()},[r]),r};var wg=Object.defineProperty,Ng=Object.defineProperties,Cg=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,Sg=Object.prototype.hasOwnProperty,_g=Object.prototype.propertyIsEnumerable,qn=(r,t,s)=>t in r?wg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,lt=(r,t)=>{for(var s in t||(t={}))Sg.call(t,s)&&qn(r,s,t[s]);if(Un)for(var s of Un(t))_g.call(t,s)&&qn(r,s,t[s]);return r},ft=(r,t)=>Ng(r,Cg(t));class Tg{constructor(t=[]){this.checklists=[],this.checklists=t}getAllChecklists(){return[...this.checklists]}getChecklistById(t){return this.checklists.find(s=>s.id===t)}getChecklistsByCategory(t){return this.checklists.filter(s=>s.category===t)}getPublishedChecklistsByCategory(t){return this.checklists.filter(s=>s.category===t&&s.status==="published")}getChecklistsByStatus(t){return this.checklists.filter(s=>s.status===t)}addChecklist(t){const s=ft(lt({},t),{status:"draft",id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});return this.checklists.push(s),s}updateChecklist(t,s){const n=this.checklists.findIndex(i=>i.id===t);if(n===-1)return null;const a=ft(lt(lt({},this.checklists[n]),s),{updatedAt:new Date().toISOString()});return this.checklists[n]=a,a}deleteChecklist(t){const s=this.checklists.findIndex(n=>n.id===t);return s===-1?!1:(this.checklists.splice(s,1),!0)}publishChecklist(t){return this.updateChecklist(t,{status:"published",updatedAt:new Date().toISOString()})}unpublishChecklist(t){return this.updateChecklist(t,{status:"draft",updatedAt:new Date().toISOString()})}duplicateChecklist(t,s){const n=this.getChecklistById(t);if(!n)return null;const a=ft(lt({},n),{id:this.generateId(),title:s||`${n.title} (Copy)`,status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:n.items.map(i=>ft(lt({},i),{id:this.generateId(),completed:!1,skipped:!1}))});return this.checklists.push(a),a}getChecklistStatistics(){const t=this.checklists.length,s=this.checklists.filter(o=>o.status==="published").length,n=this.checklists.filter(o=>o.status==="draft").length,a=this.checklists.reduce((o,l)=>(o[l.category]=(o[l.category]||0)+1,o),{}),i=this.checklists.reduce((o,l)=>o+l.items.length,0),c=t>0?i/t:0;return{total:t,published:s,draft:n,byCategory:a,averageItemsPerChecklist:c,totalItems:i}}searchChecklists(t){const s=t.toLowerCase();return this.checklists.filter(n=>n.title.toLowerCase().includes(s)||n.items.some(a=>a.title.toLowerCase().includes(s)||a.instructions.toLowerCase().includes(s)))}filterChecklists(t){return this.checklists.filter(s=>!(t.category&&s.category!==t.category||t.status&&s.status!==t.status||t.hasScheduling!==void 0&&!!(s.autoSchedule||s.scheduleFrequency)!==t.hasScheduling||t.minItems!==void 0&&s.items.length<t.minItems||t.maxItems!==void 0&&s.items.length>t.maxItems))}sortChecklists(t,s,n="asc"){return[...t].sort((a,i)=>{let c=0;switch(s){case"title":c=a.title.localeCompare(i.title);break;case"createdAt":c=new Date(a.createdAt).getTime()-new Date(i.createdAt).getTime();break;case"updatedAt":c=new Date(a.updatedAt).getTime()-new Date(i.updatedAt).getTime();break;case"category":c=a.category.localeCompare(i.category);break;case"status":c=a.status.localeCompare(i.status);break}return n==="desc"?-c:c})}exportChecklists(t){const s=t?this.checklists.filter(n=>t.includes(n.id)):this.checklists;return JSON.stringify(s,null,2)}importChecklists(t){try{const s=JSON.parse(t);if(!Array.isArray(s))return{success:!1,imported:[],errors:["Invalid format: expected array of checklists"]};const n=[],a=[];return s.forEach((i,c)=>{const o=this.validateChecklist(i);if(!o.isValid)n.push(`Checklist ${c+1}: ${o.errors.join(", ")}`);else{const l=ft(lt({},i),{id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:i.items.map(d=>ft(lt({},d),{id:this.generateId()}))});a.push(l)}}),a.length>0&&this.checklists.push(...a),{success:n.length===0,imported:a,errors:n}}catch(s){return{success:!1,imported:[],errors:["Invalid JSON format"]}}}validateChecklist(t){const s=[];return(!t.title||t.title.trim()==="")&&s.push("Title is required"),t.category?["setup","patient","weekly","public","deep","environmental_cleaning"].includes(t.category)||s.push(`Invalid category: ${t.category}`):s.push("Category is required"),!t.items||!Array.isArray(t.items)?s.push("Items array is required"):t.items.length===0&&s.push("At least one item is required"),{isValid:s.length===0,errors:s}}getDefaultChecklists(){return[{id:"treatment-room-setup",title:"Treatment Room Setup",category:"setup",status:"published",items:[{id:"clean-surfaces",title:"Clean and sanitize all surfaces with CaviWipes",instructions:"Use 2 wipes per surface. Allow to air dry for 3 minutes.",requiredInventory:[{id:"caviwipes-001",name:"CaviWipes",required:2,available:100,used:0,unit:"wipes"}],sdsId:"caviwipes-sds",skipped:!1,completed:!1},{id:"restock-supplies",title:"Restock Treatment Room Supplies",instructions:"Verify all supplies are present and in date",requiredInventory:[{id:"gloves-001",name:"Nitrile Gloves",required:10,available:500,used:0,unit:"pairs"},{id:"gauze-001",name:"Sterile Gauze",required:5,available:200,used:0,unit:"packs"},{id:"alcohol-001",name:"Alcohol Swabs",required:10,available:300,used:0,unit:"swabs"}],skipped:!1,completed:!1}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}setChecklists(t){this.checklists=[...t]}clearChecklists(){this.checklists=[]}}var kg=Object.defineProperty,Ig=Object.defineProperties,Pg=Object.getOwnPropertyDescriptors,Hn=Object.getOwnPropertySymbols,Dg=Object.prototype.hasOwnProperty,Eg=Object.prototype.propertyIsEnumerable,Vn=(r,t,s)=>t in r?kg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Se=(r,t)=>{for(var s in t||(t={}))Dg.call(t,s)&&Vn(r,s,t[s]);if(Hn)for(var s of Hn(t))Eg.call(t,s)&&Vn(r,s,t[s]);return r},$e=(r,t)=>Ig(r,Pg(t));class Og{addItemToChecklist(t,s,n){const a=$e(Se({},n),{id:this.generateId()});return t.map(i=>i.id===s?$e(Se({},i),{items:[...i.items,a],updatedAt:new Date().toISOString()}):i)}updateChecklistItem(t,s,n,a){return t.map(i=>i.id===s?$e(Se({},i),{items:i.items.map(c=>c.id===n?Se(Se({},c),a):c),updatedAt:new Date().toISOString()}):i)}deleteChecklistItem(t,s,n){return t.map(a=>a.id===s?$e(Se({},a),{items:a.items.filter(i=>i.id!==n),updatedAt:new Date().toISOString()}):a)}getItemById(t,s,n){const a=t.find(i=>i.id===s);return a&&a.items.find(i=>i.id===n)||null}completeItem(t,s,n){return this.updateChecklistItem(t,s,n,{completed:!0,skipped:!1})}skipItem(t,s,n){return this.updateChecklistItem(t,s,n,{skipped:!0,completed:!1})}resetItem(t,s,n){return this.updateChecklistItem(t,s,n,{completed:!1,skipped:!1})}moveItemUp(t,s,n){return t.map(a=>{if(a.id!==s)return a;const i=[...a.items],c=i.findIndex(o=>o.id===n);return c<=0?a:([i[c],i[c-1]]=[i[c-1],i[c]],$e(Se({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemDown(t,s,n){return t.map(a=>{if(a.id!==s)return a;const i=[...a.items],c=i.findIndex(o=>o.id===n);return c===-1||c>=i.length-1?a:([i[c],i[c+1]]=[i[c+1],i[c]],$e(Se({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemToPosition(t,s,n,a){return t.map(i=>{if(i.id!==s)return i;const c=[...i.items],o=c.findIndex(d=>d.id===n);if(o===-1)return i;const[l]=c.splice(o,1);return c.splice(a,0,l),$e(Se({},i),{items:c,updatedAt:new Date().toISOString()})})}duplicateItem(t,s,n){const a=this.getItemById(t,s,n);if(!a)return t;const i=$e(Se({},a),{id:this.generateId(),title:`${a.title} (Copy)`,completed:!1,skipped:!1});return t.map(c=>c.id===s?$e(Se({},c),{items:[...c.items,i],updatedAt:new Date().toISOString()}):c)}getItemStatistics(t){let s=0,n=0,a=0,i=0,c=0;t.forEach(d=>{d.items.forEach(p=>{s++,p.completed&&n++,p.skipped&&a++,p.requiredInventory&&p.requiredInventory.length>0&&i++,p.sdsId&&c++})});const o=s-n-a,l=s>0?n/s*100:0;return{totalItems:s,completedItems:n,skippedItems:a,pendingItems:o,completionRate:l,itemsWithInventory:i,itemsWithSDS:c}}getChecklistCompletionStatus(t){const s=t.items.length,n=t.items.filter(l=>l.completed).length,a=t.items.filter(l=>l.skipped).length,i=s-n-a,c=s>0?n/s*100:0;return{totalItems:s,completedItems:n,skippedItems:a,pendingItems:i,completionRate:c,isFullyCompleted:n===s}}validateItem(t){const s=[];return(!t.title||t.title.trim()==="")&&s.push("Title is required"),(!t.instructions||t.instructions.trim()==="")&&s.push("Instructions are required"),t.requiredInventory&&Array.isArray(t.requiredInventory)&&t.requiredInventory.forEach((n,a)=>{(!n.id||n.id.trim()==="")&&s.push(`Inventory item ${a+1}: ID is required`),(!n.name||n.name.trim()==="")&&s.push(`Inventory item ${a+1}: Name is required`),n.required<=0&&s.push(`Inventory item ${a+1}: Required quantity must be greater than 0`),n.available<0&&s.push(`Inventory item ${a+1}: Available quantity cannot be negative`),n.used<0&&s.push(`Inventory item ${a+1}: Used quantity cannot be negative`),n.used>n.available&&s.push(`Inventory item ${a+1}: Used quantity cannot exceed available quantity`)}),{isValid:s.length===0,errors:s}}searchItems(t,s){const n=s.toLowerCase(),a=[];return t.forEach(i=>{i.items.forEach(c=>{var o;c.title.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"title"}):c.instructions.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"instructions"}):(o=c.requiredInventory)!=null&&o.some(l=>l.name.toLowerCase().includes(n))&&a.push({checklist:i,item:c,matchType:"inventory"})})}),a}filterItems(t,s){const n=[];return t.forEach(a=>{s.category&&a.category!==s.category||a.items.forEach(i=>{s.completed!==void 0&&i.completed!==s.completed||s.skipped!==void 0&&i.skipped!==s.skipped||s.hasInventory!==void 0&&!!(i.requiredInventory&&i.requiredInventory.length>0)!==s.hasInventory||s.hasSDS!==void 0&&!!i.sdsId!==s.hasSDS||n.push({checklist:a,item:i})})}),n}sortItems(t,s,n="asc"){return[...t].sort((a,i)=>{var c,o;let l=0;switch(s){case"title":l=a.item.title.localeCompare(i.item.title);break;case"completed":l=(a.item.completed?1:0)-(i.item.completed?1:0);break;case"skipped":l=(a.item.skipped?1:0)-(i.item.skipped?1:0);break;case"inventoryCount":{const d=((c=a.item.requiredInventory)==null?void 0:c.length)||0,p=((o=i.item.requiredInventory)==null?void 0:o.length)||0;l=d-p;break}}return n==="desc"?-l:l})}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}}const it=new Tg,ar=new Og,Wn=Ee()(Rs((r,t)=>({checklists:it.getDefaultChecklists(),addChecklist:s=>{const n=it.addChecklist(s);r(a=>({checklists:[...a.checklists,n]}))},updateChecklist:(s,n)=>{r(a=>{const i=it.updateChecklist(s,n);return i?{checklists:a.checklists.map(c=>c.id===s?i:c)}:a})},deleteChecklist:s=>{r(n=>it.deleteChecklist(s)?{checklists:n.checklists.filter(i=>i.id!==s)}:n)},addItemToChecklist:(s,n)=>{r(a=>({checklists:ar.addItemToChecklist(a.checklists,s,n)}))},updateChecklistItem:(s,n,a)=>{r(i=>({checklists:ar.updateChecklistItem(i.checklists,s,n,a)}))},deleteChecklistItem:(s,n)=>{r(a=>({checklists:ar.deleteChecklistItem(a.checklists,s,n)}))},getChecklistsByCategory:s=>it.getChecklistsByCategory(s),publishChecklist:s=>{r(n=>{const a=it.publishChecklist(s);return a?{checklists:n.checklists.map(i=>i.id===s?a:i)}:n})},getPublishedChecklistsByCategory:s=>it.getPublishedChecklistsByCategory(s)}),{name:"checklist-storage"}));var $g=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Ag=r=>{var t;typeof window!="undefined"&&((t=window.toast)!=null&&t.error)?window.toast.error(r):console.warn("âš ï¸",r)},Pv=({scannedData:r,toolId:t,onClose:s,batchMode:n=!1})=>{const{availableTools:a,currentCycle:i,addPhaseToCycle:c,startPhase:o,addToolToCycle:l}=G(),[d,p]=u.useState(!1),[m,x]=u.useState(null),[f,g]=u.useState([]),[v,j]=u.useState({show:!1,tool:null}),h=u.useCallback(D=>a.find(O=>O.barcode===D),[a]),b=u.useCallback(()=>t?a.find(D=>D.id===t):h(r),[t,a,h,r])(),_=u.useCallback(()=>!i||!b?!1:i.tools.includes(b.id),[i,b]),E=u.useCallback(D=>$g(null,null,function*(){if(!D||typeof D!="string"||D.trim()===""){Ag("No barcode detected â€” please rescan.");return}const O=D.trim();console.info("âœ… Scanned barcode received:",O),p(!0),x(null);try{yield new Promise(B=>setTimeout(B,1e3));const A=h(O);if(!A){x({type:"error",text:`Tool with barcode "${O}" not found in inventory.`});return}if(f.find(B=>B.id===A.id)){x({type:"error",text:`Tool "${A.name}" already scanned.`});return}const R=G.getState();if(R.checkToolReplacementNeeded&&R.checkToolReplacementNeeded(A.id)){j({show:!0,tool:A});return}g(B=>{const V=[...B,A];return x(n?{type:"success",text:`Tool "${A.name}" added to batch. Total: ${V.length} tools.`}:{type:"success",text:`Tool "${A.name}" scanned successfully. Ready for sterilization.`}),V})}catch(A){x({type:"error",text:"Failed to scan tool. Please try again."}),console.error("Scan error:",A)}finally{p(!1)}}),[h,n,f]),$=u.useCallback(()=>{if(!i)return null;const D=i.phases.find(A=>A.isActive),O=i.tools.length;return{cycleId:i.id,operator:i.operator,totalTools:O,activePhase:(D==null?void 0:D.name)||"No active phase",startTime:i.startTime}},[i]),P=u.useCallback(()=>{const D=(i==null?void 0:i.phases.some(B=>B.id==="bath1"&&B.isActive))||!1,{getTimer:O}=es.getState(),A=O("bath1"),R=(A==null?void 0:A.isRunning)||!1;return D||R},[i]),w=u.useCallback(()=>{g([]),x(null)},[]),T=u.useCallback(()=>{j({show:!1,tool:null}),x({type:"error",text:"Tool marked for replacement. Please replace with a new tool before continuing."})},[]),k=u.useCallback(()=>{v.tool&&(g(D=>[...D,v.tool]),x({type:"success",text:`Tool "${v.tool.name}" added despite needing replacement.`})),j({show:!1,tool:null})},[v.tool]),S=u.useCallback(()=>{j({show:!1,tool:null})},[]),I=u.useCallback(D=>{if(!D||D.length===0){console.warn("âš ï¸ handleSendToBath1 called with no tools.");return}if(P()){x({type:"error",text:"âš ï¸ Bath 1 timer is already in process. Please wait for the current phase to complete before starting a new one."});return}try{D.forEach(A=>{l(A.id);const R=G.getState();console.log(`Tool ${A.id} status updated to bath1`)}),c("bath1",oe.bath1.name,oe.bath1.duration*60),o("bath1");const{startTimer:O}=es.getState();O("bath1",oe.bath1.duration*60),x({type:"success",text:`ðŸš€ ${D.length} tools sent to Bath 1! Phase timer started.`}),g([]),s&&s()}catch(O){console.error("âŒ Error in handleSendToBath1:",O),x({type:"error",text:"Failed to start Bath 1 phase. Please try again."})}},[l,c,o,x,s,P]);return u.useEffect(()=>{if(m){const D=setTimeout(()=>{x(null)},5e3);return()=>clearTimeout(D)}},[m]),{tool:b,currentCycle:i,isScanning:d,scanMessage:m,scannedTools:f,batchMode:n,handleScanTool:E,handleSendToBath1:I,clearScannedTools:w,isToolInCycle:_(),isBath1Active:P(),cycleStatus:$(),replacementAlert:v,handleReplaceTool:T,handleContinueAnyway:k,handleDismissReplacementAlert:S}},Mi=[{id:"clean",name:"Clean Tool",icon:tc,color:"green",description:"Ready to use on patients",statusRequirement:"Complete â†’ Dirty"},{id:"dirty",name:"Dirty Tool",icon:sc,color:"orange",description:"Ready for cleaning process",statusRequirement:"Dirty â†’ Clean"},{id:"problem",name:"Tool Problem",icon:ce,color:"red",description:"Report tool issues or problems",statusRequirement:"Any status â†’ Problem"},{id:"import",name:"Import Autoclave Receipt",icon:Pt,color:"blue",description:"Import physical autoclave cycle documentation",statusRequirement:"Documentation"},{id:"packaging",name:"Packaging Workflow",icon:dt,color:"purple",description:"Tools that are ready for packaging",statusRequirement:"Complete â†’ Packaged"}],Rg=r=>Mi.find(t=>t.id===r),Bg=r=>({green:"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",orange:"border-orange-200 hover:border-orange-300 bg-orange-50 hover:bg-orange-100",blue:"border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",purple:"border-purple-200 hover:border-purple-300 bg-purple-50 hover:bg-purple-100",red:"border-red-200 hover:border-red-300 bg-red-50 hover:bg-red-100"})[r],Fg=r=>({green:"bg-green-100",orange:"bg-orange-100",blue:"bg-blue-100",purple:"bg-purple-100",red:"bg-red-100"})[r],Mg=r=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[r],Lg=r=>({green:"text-green-800",orange:"text-orange-800",blue:"text-blue-800",purple:"text-purple-800",red:"text-red-800"})[r],zg=r=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[r],Ug=r=>({green:"text-green-700",orange:"text-orange-700",blue:"text-blue-700",purple:"text-purple-700",red:"text-red-700"})[r],qg=({workflow:r,onClick:t})=>e.jsx("button",{onClick:()=>t(r.id),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${Bg(r.color)}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Fg(r.color)}`,children:e.jsx(C,{path:r.icon,size:1.2,className:Mg(r.color)})}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold text-sm ${Lg(r.color)}`,children:r.name}),e.jsx("p",{className:`text-xs ${zg(r.color)}`,children:r.description}),e.jsx("p",{className:`text-xs mt-1 font-medium ${Ug(r.color)}`,children:r.statusRequirement})]})]})}),Dv=({onWorkflowSelect:r})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Select Workflow"}),e.jsx("div",{className:"space-y-3",children:Mi.map(t=>e.jsx(qg,{workflow:t,onClick:r},t.id))})]}),Ev=({workflowId:r,color:t="blue"})=>{const s=Rg(r);if(!s)return null;const n=()=>({blue:"bg-blue-50 border-blue-200 text-blue-800 text-blue-600",orange:"bg-orange-50 border-orange-200 text-orange-800 text-orange-600",purple:"bg-purple-50 border-purple-200 text-purple-800 text-purple-600"})[t],[a,i,c,o]=n().split(" ");return e.jsxs("div",{className:`${a} border ${i} rounded-lg p-3`,children:[e.jsxs("h3",{className:`font-semibold ${c} text-sm mb-1`,children:[s.name," Workflow"]}),e.jsx("p",{className:`${o} text-xs`,children:s.description}),e.jsxs("div",{className:"mt-2 text-xs text-blue-500",children:[e.jsx("strong",{children:"Tool Status:"})," ",s.statusRequirement]})]})},Ov=({isScanning:r,scanMessage:t,onScan:s,size:n="large",showCameraStatus:a=!0})=>{const i=n==="large",c=i?"w-48 h-32":"w-32 h-24",o=i?"w-4 h-4":"w-3 h-3",l=i?"p-4":"p-3",d=i?1.5:1.2,p=i?"w-2 h-2":"w-1.5 h-1.5",m="text-xs",x=i?"bottom-4 right-4":"bottom-2 right-2",f=i?"h-48":"h-32",g=i?"text-lg":"text-base",v=i?"text-sm":"text-xs",j=()=>t?typeof t=="string"?t:t.text:null,h=()=>t?typeof t=="string"?"success":t.type:null;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("div",{className:`relative bg-black rounded-lg ${f} flex items-center justify-center`,children:[e.jsxs("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] ${c} rounded-lg`,children:[e.jsx("div",{className:`absolute top-0 left-0 ${o} border-t-2 border-l-2 border-[#4ECDC4] rounded-tl`}),e.jsx("div",{className:`absolute top-0 right-0 ${o} border-t-2 border-r-2 border-[#4ECDC4] rounded-tr`}),e.jsx("div",{className:`absolute bottom-0 left-0 ${o} border-b-2 border-l-2 border-[#4ECDC4] rounded-bl`}),e.jsx("div",{className:`absolute bottom-0 right-0 ${o} border-b-2 border-r-2 border-[#4ECDC4] rounded-br`})]}),a&&e.jsxs("div",{className:`absolute ${x} flex items-center`,children:[e.jsx("div",{className:`${p} rounded-full bg-red-500 mr-1 animate-pulse`}),e.jsx("span",{className:`text-white ${m}`,children:"Camera active"})]}),e.jsx("button",{onClick:s,disabled:r,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 ${l} rounded-full transition-all duration-200 ${r?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:e.jsx(C,{path:Tt,size:d,className:`${r?"text-gray-400":"text-white"}`})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`${g} font-medium text-gray-800 mb-1`,children:r?"Scanning...":"Click to Scan"}),e.jsx("p",{className:`text-gray-600 ${v}`,children:r?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),t&&e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-3 p-3 rounded-lg ${h()==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:Tt,size:.8,className:h()==="success"?"text-green-600":"text-red-600"}),e.jsx("span",{className:`font-medium text-sm ${h()==="success"?"text-green-800":"text-red-800"}`,children:j()})]})})]})};var bt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Hg=()=>{const[r,t]=u.useState([]),[s,n]=u.useState(null),[a,i]=u.useState(!1),[c,o]=u.useState(null),l=u.useCallback((j,h)=>bt(null,null,function*(){i(!0),o(null);try{const y=yield pt.uploadReceipt(j,h);return t(b=>[y,...b]),y}catch(y){const b=y instanceof Error?y.message:"Failed to upload receipt";throw o(b),y}finally{i(!1)}}),[]),d=u.useCallback(j=>bt(null,null,function*(){i(!0),o(null);try{const h=yield pt.getReceiptsByBatch(j);return t(h),h}catch(h){const y=h instanceof Error?h.message:"Failed to load receipts";throw o(y),h}finally{i(!1)}}),[]),p=u.useCallback((j=50,h=0)=>bt(null,null,function*(){i(!0),o(null);try{const y=yield pt.getAllReceipts(j,h);return t(y),y}catch(y){const b=y instanceof Error?y.message:"Failed to load receipts";throw o(b),y}finally{i(!1)}}),[]),m=u.useCallback(j=>bt(null,null,function*(){i(!0),o(null);try{yield pt.deleteReceipt(j),t(h=>h.filter(y=>y.id!==j))}catch(h){const y=h instanceof Error?h.message:"Failed to delete receipt";throw o(y),h}finally{i(!1)}}),[]),x=u.useCallback(()=>bt(null,null,function*(){i(!0),o(null);try{const j=yield pt.getFacilitySettings();return n(j),j}catch(j){const h=j instanceof Error?j.message:"Failed to load facility settings";throw o(h),j}finally{i(!1)}}),[]),f=u.useCallback(j=>bt(null,null,function*(){i(!0),o(null);try{const h=yield pt.updateFacilitySettings(j);return n(h),h}catch(h){const y=h instanceof Error?h.message:"Failed to update facility settings";throw o(y),h}finally{i(!1)}}),[]),g=u.useCallback(()=>{o(null)},[]),v=u.useCallback(()=>{t([])},[]);return{receipts:r,facilitySettings:s,loading:a,error:c,uploadReceipt:l,loadReceiptsByBatch:d,loadAllReceipts:p,deleteReceipt:m,loadFacilitySettings:x,updateFacilitySettings:f,clearError:g,clearReceipts:v}};var Vg=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Wg=()=>{const r=navigator.userAgent.toLowerCase(),s=["android","iphone","ipad","ipod","blackberry","windows phone","mobile","tablet"].some(c=>r.includes(c)),n="ontouchstart"in window||navigator.maxTouchPoints>0,a=window.innerWidth<=768,i="orientation"in window||"deviceorientation"in window;return s||n&&a||i},Gg=()=>Vg(null,null,function*(){try{return!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?!1:(yield navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="videoinput").length>0}catch(r){return console.warn("Error checking camera access:",r),!1}});var Kg=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Qg=({isMobile:r,hasCamera:t,onPhotoCapture:s,onCancel:n})=>{const[a,i]=u.useState(!1),c=u.useRef(null),o=u.useRef(null),l=u.useRef(null),d=u.useCallback(()=>Kg(null,null,function*(){if(!r){alert("Camera access is only available on mobile devices. Please use the file upload option instead.");return}if(!t){alert("No camera detected on this device. Please use file upload instead.");return}try{const x=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});c.current&&(c.current.srcObject=x,l.current=x,i(!0))}catch(x){console.error(x),alert("Unable to access camera. Please use file upload instead.")}}),[r,t]),p=u.useCallback(()=>{l.current&&(l.current.getTracks().forEach(x=>x.stop()),l.current=null),i(!1)},[]),m=u.useCallback(()=>{if(c.current&&o.current){const x=c.current,f=o.current,g=f.getContext("2d");g&&(f.width=x.videoWidth,f.height=x.videoHeight,g.drawImage(x,0,0),f.toBlob(v=>{if(v){const j=new File([v],`receipt-${Date.now()}.jpg`,{type:"image/jpeg"}),h=URL.createObjectURL(v);s(j,h),p()}},"image/jpeg",.8))}},[s,p]);return!r||!t?null:e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:d,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(C,{path:rc,size:1.2}),e.jsx("span",{children:"Take Photo"})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,className:"w-full h-64 object-cover rounded-md",children:e.jsx("track",{kind:"captions"})}),e.jsx("canvas",{ref:o,className:"hidden"})]}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsxs("button",{type:"button",onClick:m,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[e.jsx(C,{path:Le,size:1}),e.jsx("span",{children:"Capture"})]}),e.jsxs("button",{type:"button",onClick:p,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[e.jsx(C,{path:ae,size:1}),e.jsx("span",{children:"Cancel"})]})]})]})})]})};var Gn=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Yg=({photoFile:r,photoPreview:t,isMobile:s,onFileSelect:n,onClearPhoto:a})=>{const i=u.useRef(null),c=d=>Gn(null,null,function*(){if(d.type==="image/jpeg")return d;const p=yield createImageBitmap(d),m=document.createElement("canvas");m.width=p.width,m.height=p.height;const x=m.getContext("2d");if(!x)return d;x.drawImage(p,0,0);const f=yield new Promise(g=>m.toBlob(v=>g(v),"image/jpeg",.8));return f?new File([f],d.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"}):d}),o=u.useCallback(d=>Gn(null,null,function*(){var p;const m=(p=d.target.files)==null?void 0:p[0];if(m&&m.type.startsWith("image/")){let x=m;x=yield c(x);const f=new FileReader;f.onload=g=>{var v;const j=(v=g.target)==null?void 0:v.result;n(x,j)},f.readAsDataURL(x)}}),[n]),l=u.useCallback(()=>{var d;(d=i.current)==null||d.click()},[]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"photo-upload",className:"block text-sm font-medium text-gray-700",children:"Receipt Photo *"}),t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:"Receipt preview",className:"w-full h-48 object-cover rounded-md border border-gray-300"}),e.jsx("button",{type:"button",onClick:a,className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(C,{path:ae,size:.8})})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Photo captured: ",(r==null?void 0:r.name)||"Receipt photo"]}),e.jsx("p",{className:"text-xs text-blue-600",children:"Note: Photos are uploaded directly to Cliniio and not stored on your device"})]}):e.jsxs("div",{className:"space-y-2",children:[!s&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-md mb-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:ut,size:1,className:"text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Camera access is only available on mobile devices. Please use the file upload option below."})]})}),e.jsxs("button",{type:"button",onClick:l,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[e.jsx(C,{path:ws,size:1.2}),e.jsx("span",{children:"Choose File"})]}),e.jsx("input",{ref:i,id:"photo-upload",type:"file",accept:"image/*",onChange:o,className:"hidden"}),e.jsx("p",{className:"text-xs text-blue-600 text-center",children:"Photos are uploaded directly to Cliniio and not stored on your device"})]})]})},Jg=({cycleNumber:r,temperatureEvidence:t,onCycleNumberChange:s,onTemperatureEvidenceChange:n})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cycleNumber",className:"block text-sm font-medium text-gray-700",children:"Cycle Number (Optional)"}),e.jsx("input",{type:"text",id:"cycleNumber",value:r,onChange:a=>s(a.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., CYC-2024-001"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temperatureEvidence",className:"block text-sm font-medium text-gray-700",children:"Temperature Evidence (Optional)"}),e.jsx("textarea",{id:"temperatureEvidence",value:t,onChange:a=>n(a.target.value),rows:3,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Temperature reached 121Â°C for 4 minutes"})]})]});var Kn=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Xg=({batchCode:r,operator:t,onSuccess:s,onCancel:n})=>{const{uploadReceipt:a,loading:i,error:c}=Hg(),[o,l]=u.useState(null),[d,p]=u.useState(null),[m,x]=u.useState(""),[f,g]=u.useState(""),[v,j]=u.useState(!1),[h,y]=u.useState(!1),[b,_]=u.useState(null);u.useEffect(()=>{Kn(null,null,function*(){const k=Wg(),S=yield Gg();j(k),y(S)})},[]),u.useEffect(()=>()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d)},[d]);const E=u.useCallback((T,k)=>{l(T),p(k)},[]),$=u.useCallback((T,k)=>{l(T),p(k)},[]),P=u.useCallback(()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),l(null),p(null)},[d]),w=u.useCallback(T=>Kn(null,null,function*(){if(T.preventDefault(),!o){alert("Please select or capture a photo of the receipt");return}try{const k={batchCode:r,cycleNumber:m||void 0,photoFile:o,temperatureEvidence:f||void 0};_("Compressing image for optimal storage...");const S=yield a(k,t);d&&d.startsWith("blob:")&&URL.revokeObjectURL(d);const I=S.photoSize<o.size?` (compressed from ${(o.size/1024).toFixed(1)}KB to ${(S.photoSize/1024).toFixed(1)}KB)`:"";_(`Receipt uploaded successfully!${I}`),s==null||s(S)}catch(k){console.error("Error uploading receipt:",k);const S=k instanceof Error?k.message:"Error uploading receipt";_(`Upload failed: ${S}`)}}),[o,r,m,f,a,t,s,d]);return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Upload Autoclave Receipt"})}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Batch Code:"})," ",r]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Qg,{isMobile:v,hasCamera:h,onPhotoCapture:E}),v&&h&&e.jsx("div",{className:"text-center text-gray-500 text-sm",children:"or"}),e.jsx(Yg,{photoFile:o,photoPreview:d,isMobile:v,onFileSelect:$,onClearPhoto:P})]}),e.jsx(Jg,{cycleNumber:m,temperatureEvidence:f,onCycleNumberChange:x,onTemperatureEvidenceChange:g}),c&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800",children:c})}),b&&e.jsx("div",{className:`p-3 rounded-md ${b.includes("successfully")?"bg-green-50 border border-green-200":b.includes("failed")?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"}`,children:e.jsx("p",{className:`text-sm ${b.includes("successfully")?"text-green-800":b.includes("failed")?"text-red-800":"text-blue-800"}`,children:b})}),e.jsx("button",{type:"submit",disabled:!o||i,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{path:ws,size:1.2}),e.jsx("span",{children:"Upload Receipt"})]})})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:n,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"â† Back to Workflow Selection"})})]})},Zg=[{type:"damaged",label:"Damaged",description:"Physical damage or broken parts"},{type:"improperly_cleaned",label:"Improperly Cleaned",description:"Rust, residue, or staining"},{type:"worn_out",label:"Worn Out",description:"Excessive wear or dull edges"},{type:"other",label:"Other",description:"Other issues not listed above"}],ef=({selectedProblemType:r,onProblemTypeSelect:t})=>e.jsx("div",{className:"space-y-3",children:Zg.map(s=>e.jsx("button",{onClick:()=>t(s.type),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${r===s.type?"border-red-300 bg-red-50":"border-gray-200 hover:border-red-200 bg-white hover:bg-red-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.label}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),r===s.type&&e.jsx(C,{path:Le,size:1,className:"text-red-600"})]})},s.type))}),tf=()=>{const[r,t]=u.useState(!1),s=u.useRef(null);return u.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition;s.current=new i,s.current.continuous=!1,s.current.interimResults=!1,s.current.lang="en-US",s.current.onresult=c=>{const o=c.results[0][0].transcript;return t(!1),o},s.current.onerror=c=>{console.error("Speech recognition error:",c.error),t(!1)},s.current.onend=()=>{t(!1)}}},[]),{isRecording:r,startRecording:i=>{s.current&&(t(!0),s.current.onresult=c=>{const o=c.results[0][0].transcript;i(o),t(!1)},s.current.start())},stopRecording:()=>{s.current&&s.current.stop()}}},sf=({value:r,onChange:t})=>{const{isRecording:s,startRecording:n,stopRecording:a}=tf(),i=()=>{s?a():n(c=>{t(c)})};return e.jsxs(me.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:[e.jsx("label",{htmlFor:"problem-description",className:"block text-sm font-medium text-gray-700",children:"Describe the problem"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("textarea",{id:"problem-description",value:r,onChange:c=>t(c.target.value),placeholder:"Describe the issue...",className:"flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 resize-none",rows:3}),e.jsx("button",{onClick:i,className:`p-3 rounded-md transition-colors ${s?"bg-red-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:s?"Stop recording":"Voice input",children:e.jsx(C,{path:s?ac:nc,size:1})})]}),s&&e.jsx("p",{className:"text-sm text-red-600",children:"Recording... Speak now"})]})};var rf=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const $v=({onClose:r})=>{const[t,s]=u.useState(!1),[n,a]=u.useState(""),[i,c]=u.useState(null),[o,l]=u.useState(""),[d,p]=u.useState(!1),[m,x]=u.useState(null),[f,g]=u.useState(""),[v,j]=u.useState(!1),{availableTools:h,markToolAsProblem:y}=G(),b=()=>{s(!0),l("Scanning tool..."),setTimeout(()=>{const E=h.filter(w=>w.barcode).map(w=>w.barcode);if(E.length===0){c("error"),l("No tools available for scanning"),s(!1);return}const $=E[Math.floor(Math.random()*E.length)],P=h.find(w=>w.barcode===$);P?(a($),c("success"),l(`Successfully scanned ${P.name}`),p(!0)):(c("error"),l("Tool not found in system")),s(!1)},1e3)},_=()=>rf(null,null,function*(){if(!(!m||!n)){j(!0);try{const{data:{user:E},error:$}=yield Q.auth.getUser();if($||!E){l("Authentication error. Please log in again.");return}const P=yield si.scanToolForProblemWorkflow(n,m,f||"No additional notes provided",E.id);if(P.success){l(P.message);const w=h.find(T=>T.barcode===n);w&&console.log(`Tool ${w.id} marked as problem: ${m}`),setTimeout(()=>{r()},2e3)}else l(P.message)}catch(E){console.error("Error reporting tool problem:",E),l("Error reporting tool problem. Please try again.")}finally{j(!1)}}});return e.jsxs("div",{className:"space-y-6",children:[d?e.jsxs(me.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Report Tool Problem"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Tool: ",n]})]}),e.jsx(ef,{selectedProblemType:m,onProblemTypeSelect:x}),m==="other"&&e.jsx(sf,{value:f,onChange:g}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Back"}),e.jsx("button",{onClick:_,disabled:!m||v,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Processing...":"Report Problem"})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:r,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"â† Back to Workflow Selection"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-1",children:"Tool Problem Workflow"}),e.jsx("p",{className:"text-red-600 text-sm",children:"Report tool issues or problems"}),e.jsxs("div",{className:"mt-2 text-xs text-red-500",children:[e.jsx("strong",{children:"Tool Status:"})," Any status â†’ Problem"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative bg-black rounded-lg h-48 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-32 rounded-lg",children:[e.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),e.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),e.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),e.jsx("button",{onClick:b,disabled:t,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${t?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:e.jsx(C,{path:Tt,size:1.5,className:`${t?"text-gray-400":"text-white"}`})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:t?"Scanning...":"Click to Scan"}),e.jsx("p",{className:"text-gray-600 text-sm",children:t?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),i&&e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg ${i==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:Tt,size:1,className:i==="success"?"text-green-600":"text-red-600"}),e.jsx("span",{className:`font-medium ${i==="success"?"text-green-800":"text-red-800"}`,children:o})]})})]})]}),!d&&e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:r,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"â† Back to Workflow Selection"})})]})},af=()=>{const r=new Date,t=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/(1e3*60*60*24)),s=t%26,n=t%9+1;return`${String.fromCharCode(65+s)}${n}`},nf=()=>af();var lf=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const of=({scannedData:r,toolId:t})=>{const{availableTools:s}=G(),[n]=u.useState(nf()),[a,i]=u.useState(!1),c=u.useCallback(d=>s.find(p=>p.barcode===d),[s]),o=u.useCallback(()=>t?s.find(d=>d.id===t):c(r),[t,s,c,r]);u.useEffect(()=>{const d=o();d&&d.currentPhase==="complete"&&r&&console.log(`Tool ${d.id} marked as dirty`)},[r,o,n]);const l=()=>lf(null,null,function*(){try{yield navigator.clipboard.writeText(n),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error("Failed to copy code:",d)}});return{tool:o(),traceabilityCode:n,copied:a,handleCopyCode:l}},cf=({traceabilityCode:r,copied:t,onCopyCode:s})=>e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx(C,{path:fr,size:1.2,className:"text-blue-600"}),e.jsx("h4",{className:"text-lg font-semibold text-blue-800",children:"Traceability Code"})]}),e.jsx("p",{className:"text-blue-700 mb-4 text-sm",children:"Enter this code in your patient chart for compliance tracking"}),e.jsx("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 mb-4",children:e.jsx("div",{className:"text-4xl font-bold text-blue-800 tracking-wider font-mono",children:r})}),e.jsxs("button",{onClick:s,className:`flex items-center gap-2 mx-auto px-4 py-2 rounded-lg transition-all duration-200 ${t?"bg-green-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[e.jsx(C,{path:t?Ce:ui,size:1}),e.jsx("span",{children:t?"Copied!":"Copy Code"})]}),e.jsxs("button",{onClick:()=>{const n=`EMR-${Date.now()}-${Math.random().toString(36).substr(2,6).toUpperCase()}`;navigator.clipboard.writeText(n),alert(`EMR ID generated and copied: ${n}`)},className:"flex items-center gap-2 mx-auto mt-3 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all duration-200",children:[e.jsx(C,{path:fr,size:1}),e.jsx("span",{children:"Generate EMR ID"})]})]})});function Av({scannedData:r,onClose:t,toolId:s}){const{tool:n,traceabilityCode:a,copied:i,handleCopyCode:c}=of({scannedData:r,toolId:s});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(me.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:Ce,size:1.2,className:"text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Tool Ready for Use"})]}),e.jsx("p",{className:"text-green-700 mb-2",children:n?`${n.name} is clean and ready for patient use.`:"Tool is clean and ready for patient use."}),e.jsxs("p",{className:"text-sm text-green-600",children:["Scanned: ",r]})]}),e.jsx(cf,{traceabilityCode:a,copied:i,onCopyCode:c}),e.jsxs(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-md font-semibold text-orange-800 mb-2",children:"Status Update"}),e.jsxs("p",{className:"text-orange-700 mb-2",children:[e.jsx("strong",{children:'Tool has been marked as "dirty"'})," and will need sterilization after use."]}),e.jsx("p",{className:"text-sm text-orange-600",children:"This change is automatically reflected in the inventory system."})]}),e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},className:"flex gap-2",children:e.jsx("button",{onClick:t,className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition-colors font-medium",children:"Confirm & Close"})})]})}var yt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const df=(r,t)=>{const{currentSession:s,startPackagingSession:n,addToolToSession:a,removeToolFromSession:i,generateBatchId:c,assignBatchIdToSession:o,endPackagingSession:l}=G(),{currentUser:d}=He(),{getCurrentFacilityId:p}=vi(),[m,x]=u.useState(""),[f,g]=u.useState(""),[v,j]=u.useState(""),[h,y]=u.useState(null),[b,_]=u.useState({packageType:"",packageSize:"",notes:""}),[E,$]=u.useState(!1),[P,w]=u.useState(!1),[T,k]=u.useState([]),[S,I]=u.useState([]),[D,O]=u.useState(!1),[A,R]=u.useState(""),[B,V]=u.useState(null),U=G(J=>J.currentBatch)||null,F=G(J=>J.batchLoading)||!1,q=u.useCallback(()=>yt(null,null,function*(){try{const J=yield Wr.getToolsReadyForPackaging();k(J)}catch(J){console.error("Error loading tools ready for packaging:",J),j("Error loading tools ready for packaging")}}),[]),W=u.useCallback(J=>yt(null,null,function*(){g(J),y(null),j("Processing scan...");const ne=T.find(Y=>Y.barcode===J);if(!ne){y("error"),j("Tool not found or not ready for packaging");return}if(S.find(Y=>Y.id===ne.id)){y("error"),j("Tool already added to package");return}if(I(Y=>[...Y,ne]),a(J),t&&U){const Y=G.getState().addToolToBatch;Y(ne.id)}y("success"),j(`Successfully added ${ne.name} to package`),setTimeout(()=>{g(""),j(""),y(null)},2e3)}),[T,S,a,t,U]),X=u.useCallback(()=>{if(T.length===0){y("error"),j("No tools available for packaging");return}const J=T[Math.floor(Math.random()*T.length)];W(J.barcode)},[T,W]),ie=u.useCallback(J=>yt(null,null,function*(){if(!s){j("Please start a packaging session first");return}try{j("Creating new autoclave load...");const ne=J?`${J}${Math.floor(1e3+Math.random()*9e3)}`:c();o(ne);const Y=G.getState().createBatch;yield Y(m,!0),j("New autoclave load created successfully!"),setTimeout(()=>{j("")},2e3)}catch(ne){j("Error creating new autoclave load"),console.error("Error creating new autoclave load:",ne)}}),[s,m,c,o]),te=u.useCallback(()=>{if(!(U!=null&&U.batchCode)){j("Please create a batch first before uploading receipts");return}w(!0)},[U==null?void 0:U.batchCode]),We=u.useCallback(()=>{w(!1),j("Receipt uploaded successfully!"),setTimeout(()=>{j("")},2e3)},[]),Xe=u.useCallback(()=>{w(!1)},[]),z=u.useCallback(()=>yt(null,null,function*(){try{j("Creating package...");const J=yield Wr.createPackage(S.map(ne=>ne.id),b,m);J.success?(j(J.message),I([]),$(!1),yield q(),setTimeout(()=>{r()},3e3)):j(J.message)}catch(J){console.error("Error finalizing package:",J),j("Error creating package. Please try again.")}}),[S,b,m,q,r]),ue=u.useCallback(()=>yt(null,null,function*(){if(!A){alert("Please scan a location barcode first.");return}const J={batchId:(s==null?void 0:s.currentBatchId)||"",toolsCount:S.length,assignedLocation:A,technicianId:d==null?void 0:d.id},ne=yield ri(J);if(V(ne.status),ne.status==="invalid_location"){alert(`âš ï¸ Location "${A}" is not valid for this facility. Please check the location name.`);return}try{s!=null&&s.currentBatchId&&(yield Q.from("sterilization_batches").update({location_barcode:A}).eq("id",s.currentBatchId)),yield Q.from("inventory_items").update({scanned_location:A}).in("id",S.map(Y=>Y.id)),alert(`âœ… Location ${A} assigned successfully`),O(!1),R(""),yield z()}catch(Y){console.error("Error assigning location:",Y),alert("Error assigning location. Please try again.")}}),[A,S,s,d,z]),se=u.useCallback(()=>yt(null,null,function*(){if(S.length===0){j("No tools selected for packaging");return}if(!b.packageType){j("Please select a package type");return}O(!0)}),[S,b]),Ze=u.useCallback(()=>{l(),I([]),j(""),y(null),r()},[l,r]),Ge=u.useCallback(J=>{const ne=S.find(Y=>Y.id===J);if(ne&&(I(Y=>Y.filter(N=>N.id!==J)),i(ne.barcode),t&&U)){const Y=G.getState().removeToolFromBatch;Y(J)}},[S,i,t,U]),et=u.useCallback(()=>{if(!m.trim()){j("Please enter operator name");return}const J=p()||"unknown-facility";n(m,J)},[m,n,p]);return{operatorName:m,scannedBarcode:f,scanMessage:v,scanResult:h,packageInfo:b,showPackageForm:E,showReceiptUpload:P,scannedTools:S,batchLoading:F,currentSession:s,availableTools:T,isAssigning:D,locationCode:A,locationStatus:B,setOperatorName:x,setScannedBarcode:g,setPackageInfo:_,setShowPackageForm:$,setLocationCode:R,setIsAssigning:O,handleScan:W,simulateScan:X,handleNewAutoclaveLoad:ie,handleImportReceipt:te,handleReceiptUploadSuccess:We,handleReceiptUploadCancel:Xe,handleFinalizePackage:se,handleAssignLocation:ue,handleEndSession:Ze,handleRemoveTool:Ge,handleStartSession:et,loadToolsReadyForPackaging:q}},uf=({operatorName:r,isBatchMode:t,onEndSession:s})=>e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Packaging Workflow"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t?"Batch Mode":"Single Tool Mode"," - Operator:"," ",r]})]}),e.jsxs("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:[e.jsx(le,{path:ae,size:1.5}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),mf=({scannedBarcode:r,scanMessage:t,scanResult:s,onScan:n,onBarcodeChange:a,onSimulateScan:i,onNewAutoclaveLoad:c,onImportReceipt:o,currentBatchCode:l,availableTools:d})=>{const p=m=>{m.key==="Enter"&&n(r)};return e.jsxs("div",{className:"mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{path:lc,size:1.2,className:"text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-800",children:"Scanner"})]}),e.jsx("button",{onClick:i,disabled:d.length===0,className:`px-3 py-1 text-sm rounded-md transition-colors ${d.length===0?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:"Simulate Scan"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(le,{path:ze,size:1,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Tools Ready for Packaging"})]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[d.length," tools available for packaging"]}),d.length>0&&e.jsx("div",{className:"mt-2 text-xs text-blue-600",children:e.jsxs("p",{children:["Available barcodes:"," ",d.slice(0,3).map(m=>m.barcode).join(", "),d.length>3&&`... and ${d.length-3} more`]})})]}),l&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Current Batch:"})," ",l]})}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[c&&e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[e.jsx(le,{path:Ue,size:1}),e.jsx("span",{children:"+ New Autoclave Load"})]}),o&&e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(le,{path:Pt,size:1}),e.jsx("span",{children:"Import Receipt"})]})]}),s&&e.jsx("div",{className:`p-3 rounded-md mb-3 ${s==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:r,onChange:m=>a(m.target.value),onKeyPress:p,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter barcode manually or scan..."}),e.jsx("button",{onClick:()=>n(r),disabled:!r.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Scan Tool"})]})]})},pf=({scannedTools:r,onRemoveTool:t,onFinalizePackage:s})=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-gray-800",children:["Scanned Tools (",r.length,")"]}),r.length>0&&e.jsx("button",{onClick:s,className:"px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors",children:"Finalize Package"})]}),r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{path:dt,size:2,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No tools scanned yet"}),e.jsx("p",{className:"text-sm",children:"Scan tools to add them to the package"})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Barcode: ",n.barcode]})]}),e.jsxs("button",{onClick:()=>t(n.id),className:"p-1 text-red-500 hover:text-red-700 transition-colors",children:[e.jsx(le,{path:ai,size:1}),e.jsx("span",{className:"sr-only",children:"Remove"})]})]},n.id))})]});var xf=Object.defineProperty,hf=Object.defineProperties,gf=Object.getOwnPropertyDescriptors,Qn=Object.getOwnPropertySymbols,ff=Object.prototype.hasOwnProperty,bf=Object.prototype.propertyIsEnumerable,Yn=(r,t,s)=>t in r?xf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,nr=(r,t)=>{for(var s in t||(t={}))ff.call(t,s)&&Yn(r,s,t[s]);if(Qn)for(var s of Qn(t))bf.call(t,s)&&Yn(r,s,t[s]);return r},lr=(r,t)=>hf(r,gf(t));const yf=({packageInfo:r,batchLoading:t,onPackageInfoChange:s,onFinalizePackage:n,onCancel:a,packageTypes:i,packageSizes:c})=>{const o=p=>{s(lr(nr({},r),{packageType:p}))},l=p=>{s(lr(nr({},r),{packageSize:p}))},d=p=>{s(lr(nr({},r),{notes:p}))};return e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-3",children:"Package Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"package-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Type"}),e.jsxs("select",{id:"package-type",value:r.packageType,onChange:p=>o(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select package type"}),i.map(p=>e.jsx("option",{value:p,children:p.charAt(0).toUpperCase()+p.slice(1)},p))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"package-size",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Size"}),e.jsxs("select",{id:"package-size",value:r.packageSize,onChange:p=>l(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select package size"}),c.map(p=>e.jsx("option",{value:p,children:p.charAt(0).toUpperCase()+p.slice(1).replace("-"," ")},p))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"package-notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{id:"package-notes",value:r.notes,onChange:p=>d(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"Additional notes about the package..."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:n,disabled:t||!r.packageType||!r.packageSize,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:t?"Processing...":"Generate Batch Code"})]})]})},vf=({operatorName:r,onOperatorNameChange:t,onStartSession:s,onCancel:n})=>e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Packaging Workflow"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Operator Name"}),e.jsx("input",{id:"operator-name",type:"text",value:r,onChange:a=>t(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter your name"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:s,disabled:!r.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 transition-colors",children:"Start Session"})]})]});var Jn=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Rv=({onClose:r,isBatchMode:t})=>{const{currentUser:s}=He(),[n,a]=u.useState(!1),[i,c]=u.useState(["pouch","wrap","container","tray"]),[o,l]=u.useState(["small","medium","large","extra-large"]),[d,p]=u.useState("PKG-"),[m,x]=u.useState(25),[f,g]=u.useState(!1),[v,j]=u.useState(null);u.useEffect(()=>{Jn(null,null,function*(){try{if(!(s!=null&&s.facility_id))return;const{data:N,error:M}=yield Q.from("facility_settings").select("packaging_settings").eq("facility_id",s.facility_id).single();if(M)console.warn("No packaging settings found, using defaults");else if(N!=null&&N.packaging_settings){const L=N.packaging_settings;c(H=>L.packageTypes||H),l(H=>L.packageSizes||H),p(H=>L.batchPrefix||H),x(H=>L.maxToolsPerBatch||H),g(!!L.requireReceiptUpload)}}catch(N){console.error("Error loading packaging settings:",N)}finally{a(!0)}})},[s]);const h=df(r,t);Z.useEffect(()=>{h!=null&&h.loadToolsReadyForPackaging&&h.loadToolsReadyForPackaging()},[h]);const y=Y=>{if(I.length>=m){alert(`â— Maximum batch size reached. You can only package up to ${m} tools per batch.`);return}h==null||h.handleScan(Y)},b=Y=>Jn(null,null,function*(){j({url:Y.photoUrl,id:Y.id});try{Y&&(O!=null&&O.currentBatchId)&&(s!=null&&s.facility_id)&&(yield gg(Y.id||Y.photoUrl||"unknown",O.currentBatchId,(s==null?void 0:s.name)||"Unknown Operator",s.facility_id))}catch(N){console.error("Failed to log receipt upload audit event:",N)}h==null||h.handleReceiptUploadSuccess()}),_=()=>{if(f&&(!v||!v.url)){alert("ðŸ“„ Receipt upload required before completing this batch.");return}h==null||h.handleFinalizePackage()};if(!n)return e.jsx("p",{className:"text-sm text-gray-500",children:"Loading Packaging Settings..."});if(!h)return e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading packaging workflow..."})]})});const{operatorName:E,scannedBarcode:$,scanMessage:P,scanResult:w,packageInfo:T,showPackageForm:k,showReceiptUpload:S,scannedTools:I,batchLoading:D,currentSession:O,availableTools:A,isAssigning:R,locationCode:B,locationStatus:V,setOperatorName:U,setScannedBarcode:F,setPackageInfo:q,setShowPackageForm:W,setLocationCode:X,setIsAssigning:ie,handleScan:te,simulateScan:We,handleNewAutoclaveLoad:Xe,handleImportReceipt:z,handleReceiptUploadSuccess:ue,handleReceiptUploadCancel:se,handleFinalizePackage:Ze,handleAssignLocation:Ge,handleEndSession:et,handleRemoveTool:J,handleStartSession:ne}=h;return O?S?e.jsx(Xg,{batchCode:O.currentBatchId||"",operator:E,onSuccess:b,onCancel:se}):R?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999] p-4",children:e.jsx("div",{className:"bg-white rounded-xl overflow-hidden w-full max-w-md shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Room Assignment"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 mb-2",children:"Scan or enter location barcode:"}),e.jsx("input",{id:"location",type:"text",value:B,onChange:Y=>X(Y.target.value),placeholder:"e.g., ROOM-1-CUPBOARD-A",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ie(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Ge,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Assign Location"})]}),V&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Location Status: ",V]})]})]})})}):e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:[e.jsx(uf,{operatorName:E,isBatchMode:t,onEndSession:et}),e.jsx(mf,{scannedBarcode:$,scanMessage:P,scanResult:w,onScan:y,onBarcodeChange:F,onSimulateScan:We,onNewAutoclaveLoad:()=>Xe(d),onImportReceipt:z,currentBatchCode:O.currentBatchId||void 0,availableTools:A}),e.jsx(pf,{scannedTools:I,onRemoveTool:J,onFinalizePackage:()=>W(!0)}),f&&!v&&e.jsxs("div",{className:"mb-4 rounded-md bg-yellow-100 border border-yellow-300 px-4 py-3 text-sm text-yellow-800 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-yellow-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Receipt upload required before finalizing this batch."})]}),k&&e.jsx(yf,{packageInfo:T,batchLoading:D,onPackageInfoChange:q,onFinalizePackage:_,onCancel:()=>W(!1),packageTypes:i,packageSizes:o}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Session ID: ",O==null?void 0:O.id]}),e.jsxs("p",{children:["Started:"," ",O!=null&&O.startedAt?new Date(O.startedAt).toLocaleTimeString():"N/A"]}),e.jsxs("p",{children:["Tools Ready: ",A.length]})]})]}):e.jsx(vf,{operatorName:E,onOperatorNameChange:U,onStartSession:ne,onCancel:r})},Bv=({tool:r,onDismiss:t,onReplace:s,onContinue:n})=>{const a=(r.maxCycles||200)-r.cycleCount;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:ce,size:1.5,className:"text-red-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tool Replacement Required"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(C,{path:ae,size:1})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{path:ze,size:1,className:"text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-red-800 font-medium mb-2",children:[r.name," (Barcode: ",r.barcode,")"]}),e.jsxs("p",{className:"text-red-700 text-sm",children:["This tool has completed ",e.jsx("strong",{children:r.cycleCount})," ","sterilization cycles and has reached the maximum recommended limit of ",r.maxCycles||200," cycles."]}),a<=0&&e.jsx("p",{className:"text-red-700 text-sm font-medium mt-2",children:"âš ï¸ This tool has exceeded the maximum cycle limit and should be replaced immediately."}),a>0&&a<=5&&e.jsxs("p",{className:"text-orange-700 text-sm font-medium mt-2",children:["âš ï¸ Only ",a," cycle",a!==1?"s":""," remaining before replacement is required."]})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cycle Information"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Current Cycles:"}),e.jsx("span",{className:"font-medium",children:r.cycleCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Maximum Cycles:"}),e.jsx("span",{className:"font-medium",children:r.maxCycles||200})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cycles Remaining:"}),e.jsx("span",{className:`font-medium ${a<=0?"text-red-600":a<=5?"text-orange-600":"text-green-600"}`,children:a<=0?"Exceeded":a})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Recommendation"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"For patient safety and compliance, it is recommended to replace this tool with a new one. Continued use beyond the cycle limit may compromise sterilization effectiveness."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:s,className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Replace Tool"}),e.jsx("button",{onClick:n,className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"Continue Anyway"})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 text-sm transition-colors",children:"Dismiss"})})]})})};var Ht=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const jf=Ee(r=>({users:[],roles:[],userRoles:[],loading:!1,error:null,fetchUsers(t){return Ht(this,null,function*(){r({loading:!0,error:null});try{const s=yield Et.getUsers(t);console.log("ðŸ” Store.fetchUsers - Received users:",s),console.log("ðŸ” Store.fetchUsers - First user:",s[0]),r({users:s,loading:!1})}catch(s){console.error("ðŸ” Store.fetchUsers - Error:",s),r({error:s instanceof Error?s.message:String(s),loading:!1})}})},fetchRoles(t){return Ht(this,null,function*(){r({loading:!0,error:null});try{const s=yield Et.getRoles(t);r({roles:s,loading:!1})}catch(s){r({error:s instanceof Error?s.message:String(s),loading:!1})}})},fetchUserRoles(t){return Ht(this,null,function*(){r({loading:!0,error:null});try{const s=yield Et.getUserRoles(t);r({userRoles:s,loading:!1})}catch(s){r({error:s instanceof Error?s.message:String(s),loading:!1})}})},assignRole(t,s,n){return Ht(this,null,function*(){r({loading:!0});try{yield Et.assignUserRole(t,s,n),yield this.fetchUserRoles(s),r({loading:!1})}catch(a){r({error:a instanceof Error?a.message:String(a),loading:!1})}})},removeRole(t,s,n){return Ht(this,null,function*(){r({loading:!0});try{yield Et.softDeleteUser(t,s),yield this.fetchUserRoles(s),r({loading:!1})}catch(a){r({error:a instanceof Error?a.message:String(a),loading:!1})}})},clearRoles(){r({users:[],roles:[],userRoles:[],error:null,loading:!1})}}));var wf=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});function Nf(r){const{users:t,roles:s,userRoles:n,loading:a,error:i,fetchUsers:c,fetchRoles:o,fetchUserRoles:l,assignRole:d,removeRole:p,clearRoles:m}=jf(),x=u.useCallback(()=>wf(null,null,function*(){yield Promise.all([c(r),o(r),l(r)])}),[r,c,o,l]);return u.useEffect(()=>(x(),()=>m()),[r,x,m]),{users:t,roles:s,userRoles:n,loading:a,error:i,assignRole:d,removeRole:p,reload:x}}var Cf=Object.defineProperty,Sf=Object.defineProperties,_f=Object.getOwnPropertyDescriptors,Xn=Object.getOwnPropertySymbols,Tf=Object.prototype.hasOwnProperty,kf=Object.prototype.propertyIsEnumerable,Zn=(r,t,s)=>t in r?Cf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,pe=(r,t)=>{for(var s in t||(t={}))Tf.call(t,s)&&Zn(r,s,t[s]);if(Xn)for(var s of Xn(t))kf.call(t,s)&&Zn(r,s,t[s]);return r},xe=(r,t)=>Sf(r,_f(t)),vt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});function Fv(){const{currentUser:r}=He(),t=(r==null?void 0:r.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{users:s,loading:n,error:a,assignRole:i,removeRole:c,reload:o}=Nf(t),[l,d]=u.useState(""),[p,m]=u.useState(null),[x,f]=u.useState(!1),[g,v]=u.useState(!1),[j,h]=u.useState(!1),[y,b]=u.useState(null),[_,E]=u.useState(null),[$,P]=u.useState({name:"",description:"",permissions:{}}),[w,T]=u.useState(null),[k,S]=u.useState({first_name:"",last_name:"",email:"",role:"",permissions:{}}),[I,D]=u.useState({first_name:"",last_name:"",email:"",role:"",permissions:{}}),O=s.filter(N=>{var M,L,H;if(!l.trim())return!0;const Ke=l.toLowerCase(),tt=((M=N.first_name)==null?void 0:M.toLowerCase())||"",as=((L=N.last_name)==null?void 0:L.toLowerCase())||"",ns=((H=N.email)==null?void 0:H.toLowerCase())||"";return tt.includes(Ke)||as.includes(Ke)||ns.includes(Ke)});if(u.useEffect(()=>{if(a&&console.error("User Management error:",a),console.log("ðŸ” Debug - All users:",s),console.log("ðŸ” Debug - Filtered users:",O),console.log("ðŸ” Debug - Search term:",l),s.length>0){const N=s[0];console.log("ðŸ” Debug - First user name fields:",{id:N.id,first_name:N.first_name,last_name:N.last_name,email:N.email,full_name:N.full_name})}},[a,s,O,l]),u.useEffect(()=>{vt(null,null,function*(){try{const M=yield Ot.checkTierLimits(t);T(M)}catch(M){console.error("Error fetching tier info:",M)}})},[t,s.length]),n)return e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading user management data..."})]});if(a)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("p",{className:"text-red-600",children:["Error loading user data: ",a]})});const A=N=>{m(N),D({first_name:N.first_name||"",last_name:N.last_name||"",email:N.email||"",role:N.role||"",permissions:N.permissions||{}})},R=N=>{const M=V(N);D(xe(pe({},I),{role:N,permissions:M}))},B=(N,M)=>{const L=xe(pe({},I.permissions),{[N]:M}),H=U(L);D(xe(pe({},I),{role:H||"custom",permissions:L}))},V=N=>({administrator:{view_dashboard:!0,view_analytics:!0,export_data:!0,manage_users:!0,assign_roles:!0,view_user_activity:!0,system_settings:!0,facility_settings:!0,security_settings:!0,create_tasks:!0,edit_tasks:!0,delete_tasks:!0,assign_tasks:!0},manager:{view_dashboard:!0,view_analytics:!0,export_data:!0,manage_users:!1,assign_roles:!0,view_user_activity:!0,system_settings:!1,facility_settings:!0,security_settings:!1,create_tasks:!0,edit_tasks:!0,delete_tasks:!0,assign_tasks:!0},technician:{view_dashboard:!0,view_analytics:!1,export_data:!1,manage_users:!1,assign_roles:!1,view_user_activity:!1,system_settings:!1,facility_settings:!1,security_settings:!1,create_tasks:!0,edit_tasks:!0,delete_tasks:!1,assign_tasks:!1},viewer:{view_dashboard:!0,view_analytics:!0,export_data:!1,manage_users:!1,assign_roles:!1,view_user_activity:!1,system_settings:!1,facility_settings:!1,security_settings:!1,create_tasks:!1,edit_tasks:!1,delete_tasks:!1,assign_tasks:!1},trainer:{view_dashboard:!0,view_analytics:!0,export_data:!0,manage_users:!1,assign_roles:!1,view_user_activity:!1,system_settings:!1,facility_settings:!0,security_settings:!1,create_tasks:!0,edit_tasks:!0,delete_tasks:!1,assign_tasks:!0},custom:{}})[N]||{},U=N=>{const M=["administrator","manager","technician","viewer","trainer"];for(const L of M){const H=V(L);if(Object.keys(H).every(tt=>N[tt]===H[tt]))return L}return null},F=N=>{b(N),h(!0)},q=()=>vt(null,null,function*(){if(y)try{yield c(y.id,t,y.role),yield Ot.cleanupUserInvitations(y.id,t),alert(`User ${y.first_name} ${y.last_name} has been removed from the facility.`),h(!1),b(null),yield o()}catch(N){console.error("Error deleting user:",N),alert(`Failed to remove user: ${N instanceof Error?N.message:"Unknown error"}`)}}),W=()=>{h(!1),b(null)},X=()=>vt(null,null,function*(){if(p)try{yield i(p.id,t,I.role),m(null),yield o()}catch(N){console.error("Error updating user:",N)}}),ie=()=>{m(null),D({first_name:"",last_name:"",email:"",role:"",permissions:{}})},te=()=>{f(!0),S({first_name:"",last_name:"",email:"",role:"",permissions:{}})},We=()=>{f(!1),S({first_name:"",last_name:"",email:"",role:"",permissions:{}})},Xe=()=>vt(null,null,function*(){if(!k.first_name||!k.last_name||!k.email||!k.role){alert("Please fill in all required fields");return}try{const N=yield Ot.checkTierLimits(t);if(!N.canAdd){alert(`You've reached the user limit for your ${N.tier} tier (${N.currentCount}/${N.limit}). Please upgrade your plan to add more users.`);return}const M={first_name:k.first_name,last_name:k.last_name,facility_id:t,role:k.role,permissions:k.permissions},{data:L,error:H}=yield Ot.sendInvitation(k.email,M);if(H){console.error("Invitation error:",H),alert(`Failed to send invitation: ${H instanceof Error?H.message:String(H)}`);return}const Ke=yield Ot.createInvitation({email:k.email,facility_id:t,invited_by:(r==null?void 0:r.id)||"",role:k.role,permissions:k.permissions});alert(`Invitation sent successfully to ${k.email}! They will receive an email to complete their registration.`),f(!1),yield o()}catch(N){console.error("Error adding user:",N),alert("An error occurred while sending the invitation. Please try again.")}}),z=N=>{const M=V(N);S(xe(pe({},k),{role:N,permissions:M}))},ue=(N,M)=>{const L=xe(pe({},k.permissions),{[N]:M}),H=U(L);S(xe(pe({},k),{role:H||"custom",permissions:L}))},se=()=>{v(!0),E(null),P({name:"",description:"",permissions:{}})},Ze=N=>{E(N),P({name:N.role_name||"",description:N.description||"",permissions:N.permissions||{}})},Ge=()=>{E(null),P({name:"",description:"",permissions:{}})},et=()=>vt(null,null,function*(){if(!$.name.trim()){alert("Please enter a role name");return}try{_&&_.id?yield Ms.updateRole(_.id,{name:$.name,description:$.description,permissions:$.permissions,facility_id:t,created_by:(r==null?void 0:r.id)||""}):yield Ms.createRole({name:$.name,description:$.description,permissions:$.permissions,facility_id:t,created_by:(r==null?void 0:r.id)||""}),alert(`Role ${_?"updated":"created"} successfully!`),v(!1),yield o()}catch(N){console.error("Error saving role:",N),alert(`Failed to ${_?"update":"create"} role: ${N instanceof Error?N.message:"Unknown error"}`)}}),J=N=>vt(null,null,function*(){if(window.confirm(`Are you sure you want to delete the role "${N.role_name}"? This action cannot be undone.`))try{yield Ms.deleteRole(N.id),alert("Role deleted successfully!"),yield o()}catch(M){console.error("Error deleting role:",M),alert(`Failed to delete role: ${M instanceof Error?M.message:"Unknown error"}`)}}),ne=()=>{v(!1),E(null),P({name:"",description:"",permissions:{}})},Y=(N,M)=>{P(xe(pe({},$),{permissions:xe(pe({},$.permissions),{[N]:M})}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("button",{onClick:o,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(C,{path:ts,size:.8,className:"mr-2"}),"Refresh"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(C,{path:yr,size:1,className:"text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(C,{path:yr,size:1,className:"text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(N=>N.is_active!==!1).length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-20 rounded-lg",children:e.jsx(C,{path:Yt,size:1,className:"text-[#4ECDC4]"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Plan Tier"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 capitalize",children:w?w.tier:"Loading..."}),e.jsx("p",{className:"text-xs text-gray-500",children:w?`${w.currentCount}/${w.limit===999999?"âˆž":w.limit} users`:"Loading..."})]})]})})]}),w&&(()=>{const N=w.currentCount/w.limit*100;return N>=80&&N<100?e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{path:Yt,size:1,className:"text-yellow-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Approaching Tier Limit"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["You're using ",w.currentCount," users on your ",w.tier," tier. Consider upgrading to add more team members."]})]})]})}):N>=100?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{path:Yt,size:1,className:"text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Tier Limit Reached"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["You've reached the maximum number of users (",w.limit,") for your ",w.tier," tier. Upgrade your plan to add more team members."]})]})]})}):null})(),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Team Directory"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:l,onChange:N=>d(N.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("button",{onClick:te,className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(C,{path:Ue,size:.8,className:"mr-2"}),"Add User"]}),e.jsxs("button",{onClick:se,className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] transition-colors",children:[e.jsx(C,{path:Yt,size:.8,className:"mr-2"}),"Manage Roles"]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O.map(N=>{var M,L;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden flex items-center justify-center",children:N.avatar_url?e.jsx("img",{src:N.avatar_url,alt:`${N.first_name} ${N.last_name}`,className:"h-10 w-10 object-cover rounded-full",onError:H=>{var Ke,tt;const as=H.target;as.style.display="none";const ns=as.parentElement;if(ns){const Ur=((Ke=N.first_name)==null?void 0:Ke[0])||"",so=((tt=N.last_name)==null?void 0:tt[0])||"",ro=Ur+so||"?";ns.innerHTML=`
                                  <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    <span class="text-sm font-medium text-blue-600">
                                      ${ro}
                                    </span>
                                  </div>
                                `}}}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:(((M=N.first_name)==null?void 0:M[0])||"")+(((L=N.last_name)==null?void 0:L[0])||"")||"?"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.first_name||N.last_name?`${N.first_name||""} ${N.last_name||""}`.trim():N.email||"Unknown User"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",N.id.slice(0,8),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:N.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N.role==="admin"?"bg-red-100 text-red-800":N.role==="manager"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:N.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${N.is_active===!1?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:N.is_active===!1?"Inactive":"Active"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>A(N),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"Edit user",children:e.jsx(C,{path:Zt,size:.8})}),e.jsx("button",{onClick:()=>F(N),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Delete user",children:e.jsx(C,{path:Yr,size:.8})})]})})]},N.id)})})]})}),O.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No users found matching your search."})})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-hide flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-6",children:["Edit User: ",p.first_name," ",p.last_name]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),e.jsx("input",{type:"text",value:I.first_name,onChange:N=>D(xe(pe({},I),{first_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",value:I.last_name,onChange:N=>D(xe(pe({},I),{last_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:I.email,onChange:N=>D(xe(pe({},I),{email:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"ðŸ‘¤ User Role"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{id:"administrator",name:"ðŸ‘‘ Administrator",desc:"Full system access"},{id:"manager",name:"ðŸ‘¨â€ðŸ’¼ Manager",desc:"Department management"},{id:"technician",name:"ðŸ”§ Technician",desc:"Task execution"},{id:"viewer",name:"ðŸ‘€ Viewer",desc:"Read-only access"},{id:"trainer",name:"ðŸ“š Trainer",desc:"Content management"},{id:"custom",name:"âž• Custom",desc:"Manual permissions"}].map(N=>e.jsxs("button",{onClick:()=>R(N.id),className:`p-3 rounded-lg border text-left transition-colors ${I.role===N.id?"border-teal-500 bg-teal-50 text-teal-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:N.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N.desc})]},N.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"ðŸ” Permissions"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ“Š Dashboard Access"}),e.jsx("div",{className:"space-y-2",children:[{id:"view_dashboard",label:"View Dashboard",desc:"Access main dashboard"},{id:"view_analytics",label:"View Analytics",desc:"Access reports and analytics"},{id:"export_data",label:"Export Data",desc:"Download reports and data"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=I.permissions)==null?void 0:M[N.id])||!1,onChange:H=>B(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ‘¥ User Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"manage_users",label:"Manage Users",desc:"Add, edit, remove users"},{id:"assign_roles",label:"Assign Roles",desc:"Change user roles and permissions"},{id:"view_user_activity",label:"View User Activity",desc:"Monitor user actions"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=I.permissions)==null?void 0:M[N.id])||!1,onChange:H=>B(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"âš™ï¸ System Settings"}),e.jsx("div",{className:"space-y-2",children:[{id:"system_settings",label:"System Settings",desc:"Modify system configuration"},{id:"facility_settings",label:"Facility Settings",desc:"Manage facility preferences"},{id:"security_settings",label:"Security Settings",desc:"Configure security policies"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=I.permissions)==null?void 0:M[N.id])||!1,onChange:H=>B(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ“‹ Task Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"create_tasks",label:"Create Tasks",desc:"Create new tasks and assignments"},{id:"edit_tasks",label:"Edit Tasks",desc:"Modify existing tasks"},{id:"delete_tasks",label:"Delete Tasks",desc:"Remove tasks and assignments"},{id:"assign_tasks",label:"Assign Tasks",desc:"Assign tasks to team members"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=I.permissions)==null?void 0:M[N.id])||!1,onChange:H=>B(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=I.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 pt-4 border-t bg-white sticky bottom-0 z-10",children:[e.jsx("button",{onClick:ie,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 bg-white",children:"Cancel"}),e.jsx("button",{onClick:X,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] border border-[#4ECDC4]",children:"Save Changes"})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-hide flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Add New User"}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",value:k.first_name,onChange:N=>S(xe(pe({},k),{first_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter first name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",value:k.last_name,onChange:N=>S(xe(pe({},k),{last_name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter last name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",value:k.email,onChange:N=>S(xe(pe({},k),{email:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email address"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"ðŸ‘¤ User Role"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{id:"administrator",name:"ðŸ‘‘ Administrator",desc:"Full system access"},{id:"manager",name:"ðŸ‘¨â€ðŸ’¼ Manager",desc:"Department management"},{id:"technician",name:"ðŸ”§ Technician",desc:"Task execution"},{id:"viewer",name:"ðŸ‘€ Viewer",desc:"Read-only access"},{id:"trainer",name:"ðŸ“š Trainer",desc:"Content management"},{id:"custom",name:"âž• Custom",desc:"Manual permissions"}].map(N=>e.jsxs("button",{onClick:()=>z(N.id),className:`p-3 rounded-lg border text-left transition-colors ${k.role===N.id?"border-teal-500 bg-teal-50 text-teal-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:N.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N.desc})]},N.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"ðŸ” Permissions"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ“Š Dashboard Access"}),e.jsx("div",{className:"space-y-2",children:[{id:"view_dashboard",label:"View Dashboard",desc:"Access main dashboard"},{id:"view_analytics",label:"View Analytics",desc:"Access reports and analytics"},{id:"export_data",label:"Export Data",desc:"Download reports and data"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=k.permissions)==null?void 0:M[N.id])||!1,onChange:H=>ue(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ‘¥ User Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"manage_users",label:"Manage Users",desc:"Add, edit, remove users"},{id:"assign_roles",label:"Assign Roles",desc:"Change user roles and permissions"},{id:"view_user_activity",label:"View User Activity",desc:"Monitor user actions"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=k.permissions)==null?void 0:M[N.id])||!1,onChange:H=>ue(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"âš™ï¸ System Settings"}),e.jsx("div",{className:"space-y-2",children:[{id:"system_settings",label:"System Settings",desc:"Modify system configuration"},{id:"facility_settings",label:"Facility Settings",desc:"Manage facility preferences"},{id:"security_settings",label:"Security Settings",desc:"Configure security policies"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=k.permissions)==null?void 0:M[N.id])||!1,onChange:H=>ue(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ“‹ Task Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"create_tasks",label:"Create Tasks",desc:"Create new tasks and assignments"},{id:"edit_tasks",label:"Edit Tasks",desc:"Modify existing tasks"},{id:"delete_tasks",label:"Delete Tasks",desc:"Remove tasks and assignments"},{id:"assign_tasks",label:"Assign Tasks",desc:"Assign tasks to team members"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=k.permissions)==null?void 0:M[N.id])||!1,onChange:H=>ue(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=k.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 pt-4 border-t bg-white sticky bottom-0 z-10",children:[e.jsx("button",{onClick:We,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 bg-white",children:"Cancel"}),e.jsx("button",{onClick:Xe,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] border border-[#4ECDC4]",children:"Add User"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-hide flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:_?`Edit Role: ${_.role_name}`:"Role Management"}),e.jsxs("button",{onClick:Ge,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] flex items-center gap-2",children:[e.jsx(C,{path:Ue,size:.8}),"Create New Role"]})]}),!_&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"ðŸ“‹ Current Roles"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[{id:"administrator",role_name:"ðŸ‘‘ Administrator",description:"Full system access",isDefault:!0,facility_id:t},{id:"manager",role_name:"ðŸ‘¨â€ðŸ’¼ Manager",description:"Department management",isDefault:!0,facility_id:t},{id:"technician",role_name:"ðŸ”§ Technician",description:"Task execution",isDefault:!0,facility_id:t},{id:"viewer",role_name:"ðŸ‘€ Viewer",description:"Read-only access",isDefault:!0,facility_id:t},{id:"trainer",role_name:"ðŸ“š Trainer",description:"Content management",isDefault:!0,facility_id:t},{id:"custom",role_name:"âž• Custom",description:"Manual permissions",isDefault:!1,facility_id:t}].map(N=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-sm",children:N.role_name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:N.description}),N.isDefault&&e.jsx("span",{className:"inline-block mt-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:"Default"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>Ze(N),className:"p-1 text-gray-500 hover:text-gray-700",title:"Edit Role",children:e.jsx(C,{path:Zt,size:.8})}),!N.isDefault&&e.jsx("button",{onClick:()=>J(N),className:"p-1 text-red-500 hover:text-red-700",title:"Delete Role",children:e.jsx(C,{path:Yr,size:.8})})]})]})},N.id))})]}),_&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role Name *"}),e.jsx("input",{type:"text",value:$.name,onChange:N=>P(xe(pe({},$),{name:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter role name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:$.description,onChange:N=>P(xe(pe({},$),{description:N.target.value})),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Enter role description"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"ðŸ” Role Permissions"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ“Š Dashboard Access"}),e.jsx("div",{className:"space-y-2",children:[{id:"view_dashboard",label:"View Dashboard",desc:"Access main dashboard"},{id:"view_analytics",label:"View Analytics",desc:"Access reports and analytics"},{id:"export_data",label:"Export Data",desc:"Download reports and data"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=$.permissions)==null?void 0:M[N.id])||!1,onChange:H=>Y(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ‘¥ User Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"manage_users",label:"Manage Users",desc:"Add, edit, remove users"},{id:"assign_roles",label:"Assign Roles",desc:"Change user roles and permissions"},{id:"view_user_activity",label:"View User Activity",desc:"Monitor user actions"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=$.permissions)==null?void 0:M[N.id])||!1,onChange:H=>Y(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"âš™ï¸ System Settings"}),e.jsx("div",{className:"space-y-2",children:[{id:"system_settings",label:"System Settings",desc:"Modify system configuration"},{id:"facility_settings",label:"Facility Settings",desc:"Manage facility preferences"},{id:"security_settings",label:"Security Settings",desc:"Configure security policies"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=$.permissions)==null?void 0:M[N.id])||!1,onChange:H=>Y(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"ðŸ“‹ Task Management"}),e.jsx("div",{className:"space-y-2",children:[{id:"create_tasks",label:"Create Tasks",desc:"Create new tasks and assignments"},{id:"edit_tasks",label:"Edit Tasks",desc:"Modify existing tasks"},{id:"delete_tasks",label:"Delete Tasks",desc:"Remove tasks and assignments"},{id:"assign_tasks",label:"Assign Tasks",desc:"Assign tasks to team members"}].map(N=>{var M,L;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.label}),e.jsx("div",{className:"text-xs text-gray-500",children:N.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((M=$.permissions)==null?void 0:M[N.id])||!1,onChange:H=>Y(N.id,H.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#4ECDC4]/20 rounded-full peer after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all ${(L=$.permissions)!=null&&L[N.id]?"bg-[#4ECDC4] after:translate-x-full":"bg-gray-200"}`})]})]},N.id)})})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 pt-4 border-t bg-white sticky bottom-0 z-10",children:[e.jsx("button",{onClick:ne,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 bg-white",children:_?"Back to Roles":"Close"}),_&&e.jsx("button",{onClick:et,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3BB5B0] border border-[#4ECDC4]",children:_.id?"Update Role":"Create Role"})]})]})}),j&&y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Remove Team Member"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone."})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Are you sure you want to remove ",e.jsxs("strong",{children:[y.first_name," ",y.last_name]})," from your facility? They will lose access to all facility data and will need to be re-invited to regain access."]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:W,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{onClick:q,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Remove User"})]})]})})]})}var If=Object.defineProperty,el=Object.getOwnPropertySymbols,Pf=Object.prototype.hasOwnProperty,Df=Object.prototype.propertyIsEnumerable,tl=(r,t,s)=>t in r?If(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,sl=(r,t)=>{for(var s in t||(t={}))Pf.call(t,s)&&tl(r,s,t[s]);if(el)for(var s of el(t))Df.call(t,s)&&tl(r,s,t[s]);return r},jt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class Ef{constructor(){this.sessionStartTime=Date.now(),this.lastActivityTime=Date.now(),this.inactivityTimer=null,this.sessionTimer=null,this.warningTimer=null,this.isRememberMe=!1,this.config={sessionTimeout:480,inactiveTimeout:30,rememberMeDuration:7},this.loadConfig(),this.setupActivityListeners(),this.startTimers()}loadConfig(){const t=localStorage.getItem("cliniio_session_timeout"),s=localStorage.getItem("cliniio_inactive_timeout"),n=localStorage.getItem("cliniio_remember_me_duration");t&&(this.config.sessionTimeout=parseInt(t)),s&&(this.config.inactiveTimeout=parseInt(s)),n&&(this.config.rememberMeDuration=parseInt(n)),this.isRememberMe=localStorage.getItem("cliniio_remember_me")==="true",this.isRememberMe&&(this.config.sessionTimeout=this.config.rememberMeDuration*24*60)}setupActivityListeners(){["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(s=>{document.addEventListener(s,()=>this.updateActivity(),{passive:!0})}),document.addEventListener("visibilitychange",()=>{document.hidden?this.pauseTimers():this.resumeTimers()})}updateActivity(){this.lastActivityTime=Date.now(),this.resetInactivityTimer()}startTimers(){this.startSessionTimer(),this.startInactivityTimer()}startSessionTimer(){this.sessionTimer&&clearTimeout(this.sessionTimer);const t=this.config.sessionTimeout*60*1e3,s=Date.now()-this.sessionStartTime,n=Math.max(0,t-s),a=Math.max(0,n-300*1e3);a>0&&(this.warningTimer=setTimeout(()=>{this.showSessionWarning(n)},a)),this.sessionTimer=setTimeout(()=>{this.handleSessionExpired()},n)}startInactivityTimer(){this.inactivityTimer&&clearTimeout(this.inactivityTimer);const t=this.config.inactiveTimeout*60*1e3;this.inactivityTimer=setTimeout(()=>{this.handleInactivityTimeout()},t)}resetInactivityTimer(){this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.startInactivityTimer()}pauseTimers(){this.sessionTimer&&clearTimeout(this.sessionTimer),this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.warningTimer&&clearTimeout(this.warningTimer)}resumeTimers(){this.startTimers()}showSessionWarning(t){var s,n;const a=Math.ceil(t/6e4),i=document.createElement("div");i.id="session-warning",i.className="fixed top-4 right-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4 shadow-lg z-50 max-w-sm",i.innerHTML=`
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-yellow-800">Session Expiring Soon</h3>
          <div class="mt-2 text-sm text-yellow-700">
            <p>Your session will expire in ${a} minute${a!==1?"s":""}.</p>
          </div>
          <div class="mt-4 flex space-x-3">
            <button id="extend-session" class="bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 rounded-md border border-yellow-200 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
              Extend Session
            </button>
            <button id="dismiss-warning" class="bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 rounded-md border border-yellow-200 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
              Dismiss
            </button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(i),(s=document.getElementById("extend-session"))==null||s.addEventListener("click",()=>{this.extendSession(),i.remove()}),(n=document.getElementById("dismiss-warning"))==null||n.addEventListener("click",()=>{i.remove()}),setTimeout(()=>{i.parentNode&&i.remove()},3e4)}extendSession(){return jt(this,null,function*(){try{const{data:t,error:s}=yield Q.auth.refreshSession();if(s){console.error("Error extending session:",s);return}t.session&&(this.sessionStartTime=Date.now(),this.startTimers(),this.showMessage("Session extended successfully!","success"))}catch(t){console.error("Error extending session:",t),this.showMessage("Failed to extend session. Please log in again.","error")}})}handleSessionExpired(){return jt(this,null,function*(){console.log("ðŸš¨ SESSION EXPIRED - redirecting to login"),this.showMessage("Your session has expired. Please log in again.","error"),setTimeout(()=>jt(this,null,function*(){yield this.logout()}),2e3)})}handleInactivityTimeout(){return jt(this,null,function*(){this.showMessage("You have been inactive for too long. Logging out...","warning"),setTimeout(()=>jt(this,null,function*(){yield this.logout()}),2e3)})}showMessage(t,s){const n={success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800"},a=document.createElement("div");a.className=`fixed top-4 right-4 ${n[s]} border rounded-lg p-4 shadow-lg z-50 max-w-sm`,a.innerHTML=`
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 ${s==="success"?"text-green-400":s==="error"?"text-red-400":"text-yellow-400"}" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm font-medium">${t}</p>
        </div>
      </div>
    `,document.body.appendChild(a),setTimeout(()=>{a.parentNode&&a.remove()},5e3)}logout(){return jt(this,null,function*(){try{yield Q.auth.signOut(),window.location.href="/login"}catch(t){console.error("Error during logout:",t),window.location.href="/login"}})}updateConfig(t){this.config=sl(sl({},this.config),t),this.startTimers()}setRememberMe(t){this.isRememberMe=t,localStorage.setItem("cliniio_remember_me",t.toString()),t?this.config.sessionTimeout=this.config.rememberMeDuration*24*60:this.config.sessionTimeout=480,this.startTimers()}getSessionInfo(){const t=Date.now(),s=t-this.sessionStartTime,n=Math.max(0,this.config.sessionTimeout*60*1e3-s),a=t-this.lastActivityTime,i=Math.max(0,this.config.inactiveTimeout*60*1e3-a);return{sessionStartTime:this.sessionStartTime,lastActivityTime:this.lastActivityTime,remainingTime:n,inactiveTimeRemaining:i}}destroy(){this.sessionTimer&&clearTimeout(this.sessionTimer),this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.warningTimer&&clearTimeout(this.warningTimer),["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(s=>{document.removeEventListener(s,()=>this.updateActivity())})}}const ir=new Ef,Mv=({variant:r="compact",className:t=""})=>{const[s,n]=u.useState(ir.getSessionInfo()),[a,i]=u.useState(!1);u.useEffect(()=>{const d=setInterval(()=>{n(ir.getSessionInfo())},3e4);return()=>clearInterval(d)},[]);const c=d=>{const p=Math.floor(d/6e4),m=Math.floor(p/60);return m>0?`${m}h ${p%60}m`:`${p}m`},o=d=>d<300*1e3?"text-red-600":d<900*1e3?"text-yellow-600":"text-green-600",l=d=>d<300*1e3?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(Ql,{className:"h-4 w-4"});return r==="compact"?e.jsxs("div",{className:`flex items-center space-x-2 ${t}`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[l(s.remainingTime),e.jsx("span",{className:`text-sm font-medium ${o(s.remainingTime)}`,children:c(s.remainingTime)})]}),e.jsx("button",{onClick:()=>i(!a),className:"text-xs text-gray-500 hover:text-gray-700 underline",children:a?"Hide":"Details"})]}):e.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 p-4 ${t}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Session Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l(s.remainingTime),e.jsxs("span",{className:`text-sm font-medium ${o(s.remainingTime)}`,children:[c(s.remainingTime)," remaining"]})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Session started:"}),e.jsx("span",{children:new Date(s.sessionStartTime).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last activity:"}),e.jsx("span",{children:new Date(s.lastActivityTime).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Inactive timeout:"}),e.jsx("span",{children:c(s.inactiveTimeRemaining)})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("button",{onClick:()=>ir.extendSession(),className:"w-full px-3 py-2 bg-blue-600 text-white text-xs rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Extend Session"})})]})},Lv=({children:r,className:t=""})=>e.jsx("div",{className:`rounded-lg border bg-card text-card-foreground shadow-sm ${t}`,children:r});var Of=Object.defineProperty,Ss=Object.getOwnPropertySymbols,Li=Object.prototype.hasOwnProperty,zi=Object.prototype.propertyIsEnumerable,rl=(r,t,s)=>t in r?Of(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,$f=(r,t)=>{for(var s in t||(t={}))Li.call(t,s)&&rl(r,s,t[s]);if(Ss)for(var s of Ss(t))zi.call(t,s)&&rl(r,s,t[s]);return r},Af=(r,t)=>{var s={};for(var n in r)Li.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&Ss)for(var n of Ss(r))t.indexOf(n)<0&&zi.call(r,n)&&(s[n]=r[n]);return s};const zv=r=>{var t=r,{className:s=""}=t,n=Af(t,["className"]);return e.jsx("input",$f({className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${s}`},n))};var Rf=Object.defineProperty,Bf=Object.defineProperties,Ff=Object.getOwnPropertyDescriptors,_s=Object.getOwnPropertySymbols,Ui=Object.prototype.hasOwnProperty,qi=Object.prototype.propertyIsEnumerable,al=(r,t,s)=>t in r?Rf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Mf=(r,t)=>{for(var s in t||(t={}))Ui.call(t,s)&&al(r,s,t[s]);if(_s)for(var s of _s(t))qi.call(t,s)&&al(r,s,t[s]);return r},Lf=(r,t)=>Bf(r,Ff(t)),zf=(r,t)=>{var s={};for(var n in r)Ui.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&_s)for(var n of _s(r))t.indexOf(n)<0&&qi.call(r,n)&&(s[n]=r[n]);return s};const Uv=r=>{var t=r,{children:s,className:n=""}=t,a=zf(t,["children","className"]);return e.jsx("label",Lf(Mf({className:`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${n}`},a),{children:s}))};var Uf=Object.defineProperty,Ts=Object.getOwnPropertySymbols,Hi=Object.prototype.hasOwnProperty,Vi=Object.prototype.propertyIsEnumerable,nl=(r,t,s)=>t in r?Uf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,qf=(r,t)=>{for(var s in t||(t={}))Hi.call(t,s)&&nl(r,s,t[s]);if(Ts)for(var s of Ts(t))Vi.call(t,s)&&nl(r,s,t[s]);return r},Hf=(r,t)=>{var s={};for(var n in r)Hi.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&Ts)for(var n of Ts(r))t.indexOf(n)<0&&Vi.call(r,n)&&(s[n]=r[n]);return s};const qv=r=>{var t=r,{className:s="",onCheckedChange:n,onChange:a}=t,i=Hf(t,["className","onCheckedChange","onChange"]);const c=o=>{n&&n(o.target.checked),a&&a(o)};return e.jsx("input",qf({type:"checkbox",className:`h-4 w-4 text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 border-gray-300 rounded transition-colors duration-200 ${s}`,onChange:c},i))},Hv=({checked:r,onCheckedChange:t,className:s="",disabled:n=!1})=>{const a=()=>{n||t(!r)};return e.jsx("button",{type:"button",role:"switch","aria-checked":r,disabled:n,onClick:a,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${r?"bg-blue-600":"bg-gray-200"} ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"} ${s}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r?"translate-x-6":"translate-x-1"}`})})};var Vf=Object.defineProperty,Wf=Object.defineProperties,Gf=Object.getOwnPropertyDescriptors,ll=Object.getOwnPropertySymbols,Kf=Object.prototype.hasOwnProperty,Qf=Object.prototype.propertyIsEnumerable,il=(r,t,s)=>t in r?Vf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Yf=(r,t)=>{for(var s in t||(t={}))Kf.call(t,s)&&il(r,s,t[s]);if(ll)for(var s of ll(t))Qf.call(t,s)&&il(r,s,t[s]);return r},Jf=(r,t)=>Wf(r,Gf(t));const Xf={id:"dental",name:"Dental Practice",description:"Statuses optimized for dental offices and clinics",category:"Specialty Care",statuses:[{name:"Pre-Procedure Ready",color:"#16a34a",icon:"check-circle",description:"Dental chair prepared, instruments sterilized, ready for patient",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Post-Procedure Cleaning",color:"#dc2626",icon:"broom",description:"Biohazard cleanup required after dental procedure",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Sterilization Cycle",color:"#ca8a04",icon:"progress-clock",description:"Instruments currently in autoclave sterilization cycle",requiresVerification:!1,autoTransition:!0,transitionTo:"Pre-Procedure Ready",alertLevel:"medium"},{name:"Patient in Chair",color:"#3b82f6",icon:"account",description:"Patient currently in dental chair, room occupied",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"X-Ray Room Ready",color:"#8b5cf6",icon:"radiology-box",description:"X-ray room prepared and ready for imaging",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Equipment Maintenance",color:"#ea580c",icon:"wrench",description:"Dental equipment under maintenance or repair",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"}]},Zf={id:"primary_care",name:"Primary Care",description:"Statuses for general practice and family medicine",category:"General Practice",statuses:[{name:"Patient Exam Room",color:"#3b82f6",icon:"account",description:"Patient currently in exam room for consultation",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Waiting for Labs",color:"#ca8a04",icon:"progress-clock",description:"Room waiting for lab results or test completion",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Vaccination Ready",color:"#16a34a",icon:"needle",description:"Vaccination station prepared and ready",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Chronic Care Visit",color:"#8b5cf6",icon:"account-clock",description:"Extended visit for chronic condition management",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Wellness Check",color:"#059669",icon:"heart-pulse",description:"Routine physical examination in progress",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Follow-up Visit",color:"#3b82f6",icon:"calendar-check",description:"Follow-up appointment for previous condition",requiresVerification:!1,autoTransition:!1,alertLevel:"low"}]},e0={id:"private_surgery",name:"Private Surgery",description:"Statuses for surgical centers and operating rooms",category:"Surgical",statuses:[{name:"Pre-Op Ready",color:"#16a34a",icon:"check-circle",description:"Pre-operative room prepared for patient",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{name:"Surgery in Progress",color:"#dc2626",icon:"scissors-cutting",description:"Active surgery currently in progress",requiresVerification:!1,autoTransition:!1,alertLevel:"critical"},{name:"Post-Op Recovery",color:"#3b82f6",icon:"bed",description:"Post-operative recovery room occupied",requiresVerification:!1,autoTransition:!1,alertLevel:"high"},{name:"Sterile Instruments",color:"#8b5cf6",icon:"package-variant",description:"Surgical instruments sterilized and ready",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{name:"Anesthesia Ready",color:"#ca8a04",icon:"gas-cylinder",description:"Anesthesia equipment prepared and ready",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Surgical Suite Clean",color:"#16a34a",icon:"broom",description:"Surgical suite cleaned and sanitized post-procedure",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"}]},t0={id:"emergency_room",name:"Emergency Room",description:"Statuses for emergency departments and urgent care",category:"Emergency",statuses:[{name:"Trauma Bay Ready",color:"#16a34a",icon:"ambulance",description:"Trauma bay prepared for emergency patient",requiresVerification:!1,autoTransition:!1,alertLevel:"critical"},{name:"Code Blue",color:"#dc2626",icon:"alert-circle",description:"Cardiac arrest or medical emergency in progress",requiresVerification:!1,autoTransition:!1,alertLevel:"critical"},{name:"Isolation Room",color:"#ea580c",icon:"shield-lock",description:"Isolation room for infectious disease patients",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Waiting for Specialist",color:"#ca8a04",icon:"account-clock",description:"Patient waiting for specialist consultation",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Discharge Pending",color:"#8b5cf6",icon:"exit-to-app",description:"Patient ready for discharge, paperwork pending",requiresVerification:!1,autoTransition:!1,alertLevel:"low"}]},s0={id:"laboratory",name:"Laboratory",description:"Statuses for medical laboratories and testing facilities",category:"Diagnostic",statuses:[{name:"Sample Processing",color:"#ca8a04",icon:"test-tube",description:"Laboratory samples currently being processed",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Equipment Calibration",color:"#ea580c",icon:"wrench",description:"Laboratory equipment under calibration",requiresVerification:!1,autoTransition:!1,alertLevel:"medium"},{name:"Quality Control",color:"#8b5cf6",icon:"clipboard-check",description:"Quality control testing in progress",requiresVerification:!0,autoTransition:!1,alertLevel:"high"},{name:"Results Ready",color:"#16a34a",icon:"file-document",description:"Test results completed and ready for review",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{name:"Hazardous Materials",color:"#dc2626",icon:"biohazard",description:"Hazardous materials handling in progress",requiresVerification:!0,autoTransition:!1,alertLevel:"critical"}]},Wi=[Xf,Zf,e0,t0,s0];function ks(r){return Wi.find(t=>t.id===r)}function ol(r){return r.statuses.map(t=>Jf(Yf({},t),{id:t.name.toLowerCase().replace(/\s+/g,"_"),isDefault:!1,isCore:!1,isPublished:!1}))}function r0(r,t){const s=[];for(const n of r.statuses)for(const a of t){if(n.name.toLowerCase()===a.name.toLowerCase()){s.push({bundleStatus:n.name,existingStatus:a.name,similarity:1});continue}const i=n.name.toLowerCase().split(/\s+/),c=a.name.toLowerCase().split(/\s+/),o=i.filter(l=>c.includes(l));if(o.length>0){const l=o.length/Math.max(i.length,c.length);l>=.5&&s.push({bundleStatus:n.name,existingStatus:a.name,similarity:l})}}return s.sort((n,a)=>a.similarity-n.similarity)}const a0=({rooms:r,onEditRoom:t,onDeleteRoom:s,onToggleActive:n})=>e.jsx("div",{className:"space-y-2",children:r.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.department," â€¢ ",a.floor]}),a.barcode&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Barcode: ",a.barcode]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>n(a.id,a.isActive),className:`px-3 py-1 text-sm rounded-md transition-colors ${a.isActive?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:a.isActive?"Active":"Inactive"}),e.jsx("button",{onClick:()=>t(a),className:"p-1 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx(C,{path:Zt,size:.8})}),e.jsx("button",{onClick:()=>s(a.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:It,size:.8})})]})]},a.id))}),n0=()=>{const r=["OR001","ICU101","SUP001","ER001","LAB001","RAD001","PHY001","ADM001"];return r[Math.floor(Math.random()*r.length)]||"OR001"};var l0=Object.defineProperty,i0=Object.defineProperties,o0=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,c0=Object.prototype.hasOwnProperty,d0=Object.prototype.propertyIsEnumerable,dl=(r,t,s)=>t in r?l0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ae=(r,t)=>{for(var s in t||(t={}))c0.call(t,s)&&dl(r,s,t[s]);if(cl)for(var s of cl(t))d0.call(t,s)&&dl(r,s,t[s]);return r},Re=(r,t)=>i0(r,o0(t));const u0=({isOpen:r,onClose:t,room:s,mode:n,onSave:a})=>{const[i,c]=u.useState({name:"",department:"",floor:"",barcode:"",gpsCoordinates:null}),{getCurrentLocation:o,latitude:l,longitude:d,accuracy:p,isLoading:m}=Bi(),x=["Surgery","Intensive Care","Emergency","Logistics","Administration","Laboratory"];u.useEffect(()=>{setTimeout(s&&n==="edit"?()=>{c({name:s.name||"",department:s.department||"",floor:s.floor||"",barcode:s.barcode||"",gpsCoordinates:s.gpsCoordinates||null})}:()=>{c({name:"",department:"",floor:"",barcode:"",gpsCoordinates:null})},0)},[s,n,r]),u.useEffect(()=>{l&&d&&setTimeout(()=>{c(g=>Re(Ae({},g),{gpsCoordinates:{latitude:l,longitude:d,accuracy:p||0,lastUpdated:new Date().toISOString()}}))},0)},[l,d,p]);const f=()=>{if(i.name&&i.department&&i.floor){const g=Re(Ae({},i),{gpsCoordinates:i.gpsCoordinates?Re(Ae({},i.gpsCoordinates),{lastUpdated:new Date().toISOString()}):void 0});a(g),t()}};return r?e.jsxs("div",{className:"mb-4 p-3 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h3",{className:"text-md font-medium mb-3",children:n==="add"?"Add New Room":"Edit Room"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-name",className:"block text-xs font-medium text-gray-700 mb-1",children:"Room Name"}),e.jsx("input",{id:"room-name",type:"text",value:i.name,onChange:g=>c(Re(Ae({},i),{name:g.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Operating Room 1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-barcode",className:"block text-xs font-medium text-gray-700 mb-1",children:"Barcode"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{id:"room-barcode",type:"text",value:i.barcode,onChange:g=>c(Re(Ae({},i),{barcode:g.target.value})),className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., OR001"}),e.jsxs("button",{type:"button",onClick:()=>c(Re(Ae({},i),{barcode:n0()})),className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors flex items-center gap-1 text-xs",title:"Generate random barcode",children:[e.jsx(C,{path:Tt,size:.6}),e.jsx("span",{children:"Gen"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-department",className:"block text-xs font-medium text-gray-700 mb-1",children:"Department"}),e.jsxs("select",{id:"room-department",value:i.department,onChange:g=>c(Re(Ae({},i),{department:g.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Department"}),x.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"room-floor",className:"block text-xs font-medium text-gray-700 mb-1",children:"Floor"}),e.jsx("input",{id:"room-floor",type:"text",value:i.floor,onChange:g=>c(Re(Ae({},i),{floor:g.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 2nd Floor"})]})]}),e.jsxs("div",{className:"mt-4 p-3 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-blue-800 flex items-center",children:[e.jsx(C,{path:jr,size:.8,className:"mr-1"}),"GPS Coordinates (Optional)"]}),e.jsxs("button",{type:"button",onClick:o,disabled:m,className:"flex items-center px-3 py-1 bg-blue-600 text-white text-xs rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(C,{path:jr,size:.6,className:"mr-1"}),m?"Getting Location...":"Get Current Location"]})]}),i.gpsCoordinates?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("div",{className:"font-medium",children:"Current GPS Coordinates:"}),e.jsx("div",{className:"font-mono text-xs",children:Zh(i.gpsCoordinates)}),i.gpsCoordinates.accuracy&&e.jsxs("div",{className:"text-xs text-blue-600",children:["Accuracy: Â±",Math.round(i.gpsCoordinates.accuracy),"m"]})]}),e.jsx("button",{type:"button",onClick:()=>c(g=>Re(Ae({},g),{gpsCoordinates:null})),className:"text-xs text-red-600 hover:text-red-800",children:"Remove GPS Coordinates"})]}):e.jsx("div",{className:"text-sm text-blue-600",children:`No GPS coordinates set. Click "Get Current Location" to capture the room's GPS coordinates. This will enable smart location detection for inventory items.`})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:f,className:"flex items-center px-3 py-1 bg-[#4ECDC4] text-white text-sm rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:n==="add"?Ue:Le,size:.8,className:"mr-1"}),n==="add"?"Add Room":"Update Room"]}),e.jsxs("button",{onClick:t,className:"flex items-center px-3 py-1 bg-gray-500 text-white text-sm rounded-md hover:bg-gray-600 transition-colors",children:[e.jsx(C,{path:ae,size:.8,className:"mr-1"}),"Cancel"]})]})]}):null},m0=({coreStatuses:r,customStatuses:t,onEditStatus:s,onDeleteStatus:n,onTogglePublishStatus:a,statusCountInfo:i})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Core Status Types (Required)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:r.map(c=>e.jsxs("div",{className:"p-2 rounded-lg border bg-white border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-1",style:{backgroundColor:c.color}}),e.jsx("span",{className:"font-medium text-xs",children:c.name}),e.jsx(C,{path:ic,size:.4,className:"text-gray-300 ml-1",title:"Core status - always available"})]}),e.jsx("span",{className:"px-1 py-0.5 bg-blue-100 text-blue-600 text-xs rounded",children:"Core"})]}),e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:c.description})]},c.id))}),e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Custom Status Types (Optional)"}),e.jsxs("div",{className:"relative ml-2 tooltip-container",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold cursor-help",children:"i"}),e.jsxs("div",{className:"tooltip-content",children:[e.jsx("div",{className:"mb-1 font-medium",children:"ðŸ’¡ Data Integrity Protection"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:"â€¢ Similar statuses (â‰¥90% match) are blocked"}),e.jsx("div",{children:"â€¢ Very similar statuses (â‰¥80% match) show warnings"}),e.jsx("div",{children:"â€¢ Smart suggestions help you choose better names"}),e.jsx("div",{children:"â€¢ All statuses start as drafts for testing"})]}),e.jsx("div",{className:"tooltip-arrow"})]})]})]}),i&&e.jsxs("div",{className:"text-xs text-gray-500",children:[i.custom,"/",i.maxCustom," custom statuses"]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Custom statuses start as drafts. Click the eye icon to publish them and make them visible in the cleaning workflow."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4",children:t.map(c=>e.jsxs("div",{className:`p-3 rounded-lg border ${c.isPublished?"bg-purple-100 border-purple-300":"bg-gray-100 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full mr-2",style:{backgroundColor:c.color}}),e.jsx("span",{className:"font-medium text-sm",children:c.name}),e.jsx("span",{className:`ml-2 px-1 py-0.5 text-xs rounded ${c.isPublished?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"}`,children:c.isPublished?"Published":"Draft"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>s(c),className:"p-1 text-purple-600 hover:bg-purple-100 rounded",title:"Edit status",children:e.jsx(C,{path:Zt,size:.6})}),e.jsx("button",{onClick:()=>a(c.id,!c.isPublished),className:`p-1 rounded ${c.isPublished?"text-orange-600 hover:bg-orange-100":"text-green-600 hover:bg-green-100"}`,title:c.isPublished?"Unpublish status":"Publish status",children:e.jsx(C,{path:c.isPublished?mi:kt,size:.6})}),e.jsx("button",{onClick:()=>n(c.id),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Delete status",children:e.jsx(C,{path:It,size:.6})})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:c.description}),e.jsxs("div",{className:"text-xs text-purple-600",children:[c.requiresVerification&&e.jsx("span",{className:"mr-2",children:"âœ“ Verification"}),c.autoTransition&&e.jsx("span",{className:"mr-2",children:"âœ“ Auto Transition"}),c.alertLevel&&c.alertLevel!=="low"&&e.jsxs("span",{className:"mr-2",children:["âš  ",c.alertLevel]})]})]},c.id))})]}),p0=({customStatuses:r,onLoadBundle:t,onReplaceWithBundle:s})=>{var n;const[a,i]=u.useState(""),[c,o]=u.useState(!1),[l,d]=u.useState([]),p=g=>{i(g);const v=ks(g);if(v){const j=r0(v,r);d(j),o(!0)}},m=()=>{t(a),i(""),o(!1),d([])},x=()=>{s(a),i(""),o(!1),d([])},f=()=>{i(""),o(!1),d([])};return e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-medium text-green-800 mb-2",children:"ðŸš€ Quick Setup: Pre-configured Status Bundles"}),e.jsx("p",{className:"text-xs text-green-700 mb-3",children:"Select a bundle to quickly add relevant statuses for your healthcare specialty. All statuses start as drafts."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-3",children:Wi.map(g=>e.jsxs("button",{onClick:()=>p(g.id),className:`p-2 text-left rounded border transition-colors ${a===g.id?"bg-green-100 border-green-400 text-green-800":"bg-white border-green-200 hover:bg-green-50 text-green-700"}`,children:[e.jsx("div",{className:"font-medium text-xs",children:g.name}),e.jsx("div",{className:"text-xs opacity-75",children:g.description}),e.jsxs("div",{className:"text-xs opacity-60",children:[g.statuses.length," statuses"]})]},g.id))}),c&&a&&e.jsxs("div",{className:"mt-3 p-3 bg-white border border-green-300 rounded",children:[e.jsxs("h6",{className:"text-sm font-medium text-green-800 mb-2",children:["Bundle Preview: ",(n=ks(a))==null?void 0:n.name]}),l.length>0&&e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsxs("p",{className:"text-xs text-yellow-800 mb-1",children:["âš ï¸ Found ",l.length," similar statuses:"]}),e.jsx("ul",{className:"text-xs text-yellow-700 space-y-1",children:l.slice(0,3).map((g,v)=>e.jsxs("li",{children:['â€¢ "',g.bundleStatus,'" similar to "',g.existingStatus,'"']},v))})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Add New Statuses Only"}),e.jsx("button",{onClick:x,className:"px-3 py-1 text-xs bg-orange-600 text-white rounded hover:bg-orange-700",children:"Replace All Custom Statuses"}),e.jsx("button",{onClick:f,className:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]})]})]})};var x0=Object.defineProperty,h0=Object.defineProperties,g0=Object.getOwnPropertyDescriptors,ul=Object.getOwnPropertySymbols,f0=Object.prototype.hasOwnProperty,b0=Object.prototype.propertyIsEnumerable,ml=(r,t,s)=>t in r?x0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,y0=(r,t)=>{for(var s in t||(t={}))f0.call(t,s)&&ml(r,s,t[s]);if(ul)for(var s of ul(t))b0.call(t,s)&&ml(r,s,t[s]);return r},v0=(r,t)=>h0(r,g0(t)),j0=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const pl=[{name:"check-circle",label:"Check Circle",path:"mdiCheckCircle"},{name:"exclamation-triangle",label:"Warning",path:"mdiExclamationTriangle"},{name:"pause-circle",label:"Pause",path:"mdiPauseCircle"},{name:"clock",label:"Clock",path:"mdiClock"},{name:"shield",label:"Shield",path:"mdiShield"},{name:"wrench",label:"Wrench",path:"mdiWrench"},{name:"heart",label:"Heart",path:"mdiHeart"},{name:"star",label:"Star",path:"mdiStar"},{name:"flag",label:"Flag",path:"mdiFlag"},{name:"home",label:"Home",path:"mdiHome"}],w0=[{name:"Green",value:"#16a34a",bgClass:"bg-green-100",textClass:"text-green-600"},{name:"Red",value:"#dc2626",bgClass:"bg-red-100",textClass:"text-red-600"},{name:"Yellow",value:"#ca8a04",bgClass:"bg-yellow-100",textClass:"text-yellow-600"},{name:"Blue",value:"#3b82f6",bgClass:"bg-blue-100",textClass:"text-blue-600"},{name:"Purple",value:"#9333ea",bgClass:"bg-purple-100",textClass:"text-purple-600"},{name:"Orange",value:"#ea580c",bgClass:"bg-orange-100",textClass:"text-orange-600"},{name:"Gray",value:"#6b7280",bgClass:"bg-gray-100",textClass:"text-gray-600"},{name:"Pink",value:"#ec4899",bgClass:"bg-pink-100",textClass:"text-pink-600"}],N0=({isOpen:r,onClose:t,onSave:s,existingStatuses:n})=>{var a;const[i,c]=u.useState({name:"",description:"",icon:"check-circle",color:"#16a34a"}),[o,l]=u.useState(!1),[d,p]=u.useState([]),m=(g,v)=>{c(j=>v0(y0({},j),{[g]:v})),p([])},x=()=>{const g=[];return i.name.trim()||g.push("Status name is required"),i.name.trim().split(/\s+/).length>1&&g.push("Status name must be 1 word only"),i.name.trim().length<2&&g.push("Status name must be at least 2 characters"),i.name.trim().length>20&&g.push("Status name must be less than 20 characters"),n.map(h=>h.name.toLowerCase()).includes(i.name.toLowerCase())&&g.push("A status with this name already exists"),/^[a-zA-Z0-9]+$/.test(i.name.trim())||g.push("Status name can only contain letters and numbers"),p(g),g.length===0},f=()=>j0(null,null,function*(){if(x()){l(!0);try{yield s({name:i.name.trim(),description:i.description.trim()||`${i.name.trim()} status`,icon:i.icon,color:i.color,isDefault:!1,isCore:!1,isPublished:!0,category:"custom",requiresVerification:!1,autoTransition:!1,alertLevel:"low"}),c({name:"",description:"",icon:"check-circle",color:"#16a34a"}),t()}catch(g){console.error("Error saving status:",g),p(["Failed to save status. Please try again."])}finally{l(!1)}}});return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create Custom Status"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1.2})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:g=>m("name",g.target.value),placeholder:"e.g., Clean, Dirty, Maintenance",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",maxLength:20}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"One word only, letters and numbers"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (Optional)"}),e.jsx("textarea",{value:i.description,onChange:g=>m("description",g.target.value),placeholder:"Brief description of this status",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Icon"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:pl.map(g=>e.jsx("button",{onClick:()=>m("icon",g.name),className:`p-2 rounded-md border-2 transition-colors ${i.icon===g.name?"border-[#4ECDC4] bg-[#4ECDC4]/10":"border-gray-200 hover:border-gray-300"}`,title:g.label,children:e.jsx(C,{path:g.path,size:1,className:i.icon===g.name?"text-[#4ECDC4]":"text-gray-600"})},g.name))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:w0.map(g=>e.jsx("button",{onClick:()=>m("color",g.value),className:`p-3 rounded-md border-2 transition-colors ${i.color===g.value?"border-gray-400":"border-gray-200 hover:border-gray-300"}`,title:g.name,children:e.jsx("div",{className:`w-full h-6 rounded ${g.bgClass} flex items-center justify-center`,children:e.jsx(C,{path:Le,size:.8,className:g.textClass})})},g.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preview"}),e.jsx("div",{className:"p-3 border border-gray-200 rounded-md bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:`${i.color}20`},children:e.jsx(C,{path:((a=pl.find(g=>g.name===i.icon))==null?void 0:a.path)||"mdiCheckCircle",size:.8,color:i.color})}),e.jsx("span",{className:"font-medium text-gray-800",children:i.name||"Status Name"})]})})]}),d.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:d.map((g,v)=>e.jsxs("li",{children:["â€¢ ",g]},v))})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:o||!i.name.trim(),className:`px-4 py-2 rounded-md transition-colors ${o||!i.name.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,children:o?"Creating...":"Create Status"})]})]})]})}):null};var C0=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Vv=()=>{const{rooms:r,addRoom:t,updateRoom:s,deleteRoom:n}=Bs(),{getCoreStatusTypes:a,getCustomStatusTypes:i,addStatusType:c,deleteStatusType:o,publishStatusType:l,unpublishStatusType:d,getStatusCountInfo:p,canAddCustomStatus:m}=Fi(),x=a(),f=i(),[g,v]=u.useState(!1),[j,h]=u.useState(null),[y,b]=u.useState(!1),[_,E]=u.useState(!1),[$,P]=u.useState(!1),w=F=>{t({name:F.name||"",department:F.department||"",floor:F.floor||"",barcode:F.barcode||"",isActive:!0}),v(!1)},T=F=>{j&&(s(j.id,F),h(null))},k=F=>{h(F)},S=()=>{v(!1),h(null)},I=(F,q)=>{s(F,{isActive:!q})},D=F=>{n(F)},O=()=>{},A=F=>{o(F)},R=(F,q)=>{q?l(F):d(F)},B=F=>C0(null,null,function*(){try{yield c(F),P(!1)}catch(q){throw console.error("Error creating status:",q),q}}),V=F=>{const q=ks(F);if(!q)return;const W=ol(q),X=f.map(te=>te.name.toLowerCase());W.filter(te=>!X.includes(te.name.toLowerCase())).forEach(te=>{c(te)})},U=F=>{const q=ks(F);if(!q)return;f.forEach(X=>{o(X.id)}),ol(q).forEach(X=>{c(X)})};return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>b(!y),className:"flex items-center text-xl font-semibold text-gray-800 hover:text-gray-600 transition-colors",children:[e.jsx(C,{path:y?mt:ss,size:1.2,className:"mr-2"}),"Room Management",e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",r.filter(F=>F.isActive).length," active)"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>E(!_),className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:[e.jsx(C,{path:Yt,size:1,className:"mr-2"}),"Status Types"]}),e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:Ue,size:1,className:"mr-2"}),"Add Room"]})]})]}),_&&e.jsxs("div",{className:"mb-6 p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-purple-800",children:"Custom Status Types"}),e.jsx("div",{className:"text-sm text-purple-600 mt-1",children:(()=>{const F=p();return`${F.custom}/${F.maxCustom} custom statuses used (${F.total}/8 total)`})()})]}),e.jsxs("button",{onClick:()=>P(!0),disabled:!m(),className:`flex items-center px-3 py-1 rounded-md transition-colors text-sm ${m()?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,title:m()?"Add a new custom status":"Maximum of 4 custom statuses reached",children:[e.jsx(C,{path:Ue,size:.8,className:"mr-1"}),"Add Custom Status"]})]}),e.jsx(p0,{customStatuses:f,onLoadBundle:V,onReplaceWithBundle:U}),e.jsx(m0,{coreStatuses:x,customStatuses:f,onEditStatus:O,onDeleteStatus:A,onTogglePublishStatus:R,statusCountInfo:p()})]}),e.jsx(u0,{isOpen:g||!!j,onClose:S,room:j,mode:g?"add":"edit",onSave:g?w:T}),y&&e.jsx(a0,{rooms:r,onEditRoom:k,onDeleteRoom:D,onToggleActive:I}),e.jsx(N0,{isOpen:$,onClose:()=>P(!1),onSave:B,existingStatuses:[...x,...f]})]})},S0={title:"",category:"setup",autoSchedule:!1,scheduleFrequency:"weekly",scheduleDay:"monday",scheduleTime:"09:00",schedulePriority:"medium",schedulePoints:50,scheduleDuration:30,triggerRoomStatus:!1,triggerStaffSchedule:!1,triggerAdminDecision:!1};var _0=Object.defineProperty,T0=Object.defineProperties,k0=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,I0=Object.prototype.hasOwnProperty,P0=Object.prototype.propertyIsEnumerable,hl=(r,t,s)=>t in r?_0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,D0=(r,t)=>{for(var s in t||(t={}))I0.call(t,s)&&hl(r,s,t[s]);if(xl)for(var s of xl(t))P0.call(t,s)&&hl(r,s,t[s]);return r},E0=(r,t)=>T0(r,k0(t)),gl=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const O0=(r,t)=>{const[s,n]=u.useState(S0),[a,i]=u.useState(!1),[c,o]=u.useState(!1),[l,d]=u.useState([]);u.useEffect(()=>{r?n({title:r.title,category:r.category,autoSchedule:r.autoSchedule||!1,scheduleFrequency:r.scheduleFrequency||"weekly",scheduleDay:r.scheduleDay||"monday",scheduleTime:r.scheduleTime||"09:00",schedulePriority:r.schedulePriority||"medium",schedulePoints:r.schedulePoints||50,scheduleDuration:r.scheduleDuration||30,triggerRoomStatus:r.triggerRoomStatus||!1,triggerStaffSchedule:r.triggerStaffSchedule||!1,triggerAdminDecision:r.triggerAdminDecision||!1}):t&&n({title:"",category:"setup",autoSchedule:!1,scheduleFrequency:"weekly",scheduleDay:"monday",scheduleTime:"09:00",schedulePriority:"medium",schedulePoints:50,scheduleDuration:30,triggerRoomStatus:!1,triggerStaffSchedule:!1,triggerAdminDecision:!1})},[r,t]);const p=()=>gl(null,null,function*(){o(!0);try{try{const g=yield Ps.askAI(`Generate 8 checklist title suggestions for the ${s.category} category. Each title should be descriptive and follow healthcare facility naming conventions.`,{module:"checklist-form",facilityId:"unknown",userId:"unknown"}),v=x(g);d(v),i(!0)}catch(g){console.warn("AI service failed, using fallback suggestions:",g);const v=yield f(s.category);d(v),i(!0)}}catch(g){console.error("Error generating AI suggestions:",g);const v=yield f(s.category);d(v),i(!0)}finally{o(!1)}}),m=g=>{n(v=>E0(D0({},v),{title:g})),i(!1)},x=g=>{try{const v=g.match(/\[[\s\S]*\]/);if(v){const y=JSON.parse(v[0]);if(Array.isArray(y))return y.map(b=>typeof b=="string"?b:b.title||b.name||b.suggestion||"Untitled Checklist")}const j=g.split(`
`).filter(y=>y.trim()),h=[];for(const y of j)if(y.match(/^\d+\./)){const b=y.replace(/^\d+\.\s*/,"").trim();b&&h.push(b)}else y.trim()&&!y.toLowerCase().includes("category")&&!y.toLowerCase().includes("suggestions")&&h.push(y.trim());return h.length>0?h:["AI-generated checklist","Custom checklist","Professional checklist"]}catch(v){return console.error("Error parsing AI response:",v),["AI-generated checklist","Custom checklist","Professional checklist"]}},f=g=>gl(null,null,function*(){return yield new Promise(j=>setTimeout(j,1e3)),{setup:["Treatment Room Setup Checklist","Surgical Suite Preparation","Examination Room Setup","Emergency Room Preparation","Laboratory Setup Protocol","Radiology Room Setup","Pharmacy Setup Checklist","Reception Area Setup"],patient:["Patient Room Cleaning Protocol","Isolation Room Procedures","Post-Procedure Room Cleanup","Patient Equipment Sanitization","Bedside Supply Restocking","Patient Safety Equipment Check","Infection Control Protocol","Patient Comfort Items Setup"],weekly:["Weekly Deep Cleaning Protocol","Equipment Maintenance Schedule","Supply Inventory Audit","Safety Equipment Inspection","Emergency Equipment Check","Compliance Documentation Review","Staff Training Verification","Quality Assurance Audit"],public:["Waiting Room Maintenance","Lobby Cleaning Protocol","Restroom Sanitization","Common Area Disinfection","Public Equipment Cleaning","Visitor Area Maintenance","Cafeteria Cleaning Protocol","Parking Area Maintenance"],deep:["Post-Contamination Deep Clean","Equipment Sterilization Protocol","Ventilation System Cleaning","Structural Disinfection","Biohazard Cleanup Protocol","Emergency Response Cleanup","Infection Outbreak Response","Facility-Wide Sanitization"]}[g]||[]});return{checklistFormData:s,showAIChecklistSuggestions:a,isGeneratingSuggestions:c,aiChecklistSuggestions:l,setChecklistFormData:n,setShowAIChecklistSuggestions:i,generateAIChecklistSuggestions:p,applyAIChecklistSuggestion:m}},$0=[{id:"setup",title:"Setup/Take Down",icon:Be,color:"#FF6B6B"},{id:"patient",title:"Per Patient",icon:pi,color:"#4ECDC4"},{id:"weekly",title:"Weekly",icon:xi,color:"#45B7D1"},{id:"public",title:"Public Spaces",icon:hi,color:"#96CEB4"},{id:"deep",title:"Deep Clean",icon:gi,color:"#FF9F1C"}];var A0=Object.defineProperty,R0=Object.defineProperties,B0=Object.getOwnPropertyDescriptors,fl=Object.getOwnPropertySymbols,F0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,bl=(r,t,s)=>t in r?A0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,yl=(r,t)=>{for(var s in t||(t={}))F0.call(t,s)&&bl(r,s,t[s]);if(fl)for(var s of fl(t))M0.call(t,s)&&bl(r,s,t[s]);return r},vl=(r,t)=>R0(r,B0(t));const L0=({checklistFormData:r,setChecklistFormData:t,showAIChecklistSuggestions:s,isGeneratingSuggestions:n,aiChecklistSuggestions:a,onGenerateAISuggestions:i,onApplyAISuggestion:c,onCloseAISuggestions:o})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"checklist-title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Checklist Title"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{id:"checklist-title",type:"text",value:r.title,onChange:l=>t(vl(yl({},r),{title:l.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"e.g., Treatment Room Setup"}),e.jsxs("button",{onClick:i,disabled:n,className:"flex items-center px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-400 transition-colors",title:"Get AI suggestions for checklist titles",children:[e.jsx(C,{path:oc,size:.8,className:"mr-1"}),n?"...":"AI"]})]}),s&&e.jsxs("div",{className:"mt-3 p-3 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h5",{className:"text-sm font-medium text-purple-800 flex items-center",children:[e.jsx(C,{path:fs,size:.8,className:"mr-1"}),"AI Suggestions"]}),e.jsx("button",{onClick:o,className:"text-purple-600 hover:text-purple-800",children:e.jsx(C,{path:ae,size:.8})})]}),e.jsx("div",{className:"space-y-2",children:a.map((l,d)=>e.jsx("button",{onClick:()=>c(l),className:"w-full text-left p-2 text-sm text-purple-700 hover:bg-purple-100 rounded-md transition-colors",children:l},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"checklist-category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsx("select",{id:"checklist-category",value:r.category,onChange:l=>t(vl(yl({},r),{category:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:$0.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))})]})]});var z0=Object.defineProperty,U0=Object.defineProperties,q0=Object.getOwnPropertyDescriptors,jl=Object.getOwnPropertySymbols,H0=Object.prototype.hasOwnProperty,V0=Object.prototype.propertyIsEnumerable,wl=(r,t,s)=>t in r?z0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Te=(r,t)=>{for(var s in t||(t={}))H0.call(t,s)&&wl(r,s,t[s]);if(jl)for(var s of jl(t))V0.call(t,s)&&wl(r,s,t[s]);return r},ke=(r,t)=>U0(r,q0(t));const W0=({checklistFormData:r,setChecklistFormData:t})=>e.jsxs("div",{className:"mt-6 p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-md font-medium text-blue-800 flex items-center",children:[e.jsx(C,{path:Me,size:1,className:"mr-2"}),"Scheduling Configuration"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.autoSchedule||!1,onChange:s=>t(ke(Te({},r),{autoSchedule:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Enable Auto-Scheduling"})]})]}),r.autoSchedule&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-frequency",className:"block text-sm font-medium text-blue-700 mb-1",children:"Frequency"}),e.jsxs("select",{id:"schedule-frequency",value:r.scheduleFrequency||"weekly",onChange:s=>t(ke(Te({},r),{scheduleFrequency:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"per_patient",children:"Per Patient"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"bi_weekly",children:"Bi-Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),(r.scheduleFrequency==="weekly"||r.scheduleFrequency==="bi_weekly"||r.scheduleFrequency==="monthly")&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-day",className:"block text-sm font-medium text-blue-700 mb-1",children:"Schedule Day"}),e.jsxs("select",{id:"schedule-day",value:r.scheduleDay||"monday",onChange:s=>t(ke(Te({},r),{scheduleDay:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"monday",children:"Monday"}),e.jsx("option",{value:"tuesday",children:"Tuesday"}),e.jsx("option",{value:"wednesday",children:"Wednesday"}),e.jsx("option",{value:"thursday",children:"Thursday"}),e.jsx("option",{value:"friday",children:"Friday"}),e.jsx("option",{value:"saturday",children:"Saturday"}),e.jsx("option",{value:"sunday",children:"Sunday"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-time",className:"block text-sm font-medium text-blue-700 mb-1",children:"Schedule Time"}),e.jsx("input",{id:"schedule-time",type:"time",value:r.scheduleTime||"09:00",onChange:s=>t(ke(Te({},r),{scheduleTime:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-priority",className:"block text-sm font-medium text-blue-700 mb-1",children:"Priority"}),e.jsxs("select",{id:"schedule-priority",value:r.schedulePriority||"medium",onChange:s=>t(ke(Te({},r),{schedulePriority:s.target.value})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-points",className:"block text-sm font-medium text-blue-700 mb-1",children:"Points"}),e.jsx("input",{id:"schedule-points",type:"number",value:r.schedulePoints||50,onChange:s=>t(ke(Te({},r),{schedulePoints:parseInt(s.target.value)})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-duration",className:"block text-sm font-medium text-blue-700 mb-1",children:"Duration (minutes)"}),e.jsx("input",{id:"schedule-duration",type:"number",value:r.scheduleDuration||30,onChange:s=>t(ke(Te({},r),{scheduleDuration:parseInt(s.target.value)})),className:"w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-700 mb-2",children:"Trigger Conditions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.triggerRoomStatus||!1,onChange:s=>t(ke(Te({},r),{triggerRoomStatus:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Trigger on room status change"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.triggerStaffSchedule||!1,onChange:s=>t(ke(Te({},r),{triggerStaffSchedule:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Trigger based on staff availability"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.triggerAdminDecision||!1,onChange:s=>t(ke(Te({},r),{triggerAdminDecision:s.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Require admin approval"})]})]})]})]})]}),G0=({selectedChecklist:r,onSaveDraft:t,onPublish:s,isValid:n=!0})=>e.jsxs("div",{className:"flex justify-end mt-4 space-x-3",children:[e.jsxs("button",{onClick:t,disabled:!n,className:`flex items-center px-6 py-2 rounded-lg font-semibold text-lg ${n?"bg-gray-500 text-white hover:bg-gray-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(C,{path:Le,size:1,className:"mr-2"}),"Save Draft"]}),r&&e.jsxs("button",{onClick:s,disabled:!n,className:`flex items-center px-6 py-2 rounded-lg font-semibold text-lg ${n?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(C,{path:Le,size:1,className:"mr-2"}),"Publish"]})]}),K0=({selectedChecklist:r,isAddingChecklist:t,onSaveDraft:s,onPublish:n})=>{const{checklistFormData:a,showAIChecklistSuggestions:i,isGeneratingSuggestions:c,aiChecklistSuggestions:o,setChecklistFormData:l,setShowAIChecklistSuggestions:d,generateAIChecklistSuggestions:p,applyAIChecklistSuggestion:m}=O0(r,t),x=()=>{a.title&&a.category&&s(a)},f=()=>{a.title&&a.category&&(s(a),n())},g=a.title.trim()!==""&&a.category!==null;return e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-md font-medium mb-3",children:"Checklist Details"}),e.jsx(L0,{checklistFormData:a,setChecklistFormData:l,showAIChecklistSuggestions:i,isGeneratingSuggestions:c,aiChecklistSuggestions:o,onGenerateAISuggestions:p,onApplyAISuggestion:m,onCloseAISuggestions:()=>d(!1)}),e.jsx(W0,{checklistFormData:a,setChecklistFormData:l}),e.jsx(G0,{selectedChecklist:r,onSaveDraft:x,onPublish:f,isValid:g})]})},Q0=[{id:"setup",title:"Setup/Take Down",icon:Be,color:"#FF6B6B"},{id:"patient",title:"Per Patient",icon:pi,color:"#4ECDC4"},{id:"weekly",title:"Weekly",icon:xi,color:"#45B7D1"},{id:"public",title:"Public Spaces",icon:hi,color:"#96CEB4"},{id:"deep",title:"Deep Clean",icon:gi,color:"#FF9F1C"}],Y0=({checklists:r,onEditChecklist:t,onDeleteChecklist:s})=>{const[n,a]=u.useState(new Set(["setup"])),i=c=>{a(o=>{const l=new Set(o);return l.has(c)?l.delete(c):l.add(c),l})};return e.jsx("div",{className:"space-y-6",children:Q0.map(c=>{const o=r.filter(m=>m.category===c.id),l=o.filter(m=>m.status==="published"),d=o.filter(m=>m.status==="draft"),p=n.has(c.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("button",{onClick:()=>i(c.id),className:"flex items-center w-full text-left hover:bg-gray-50 p-2 -m-2 rounded-md transition-colors",children:[e.jsx(C,{path:c.icon,size:1.2,color:c.color,className:"mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:c.title}),e.jsxs("span",{className:"ml-2 px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:[l.length," published, ",d.length," ","draft"]}),e.jsx(C,{path:p?mt:ss,size:1,className:"ml-auto text-gray-400"})]}),p&&e.jsx(e.Fragment,{children:o.length===0?e.jsx("p",{className:"text-gray-500 text-sm italic mt-4",children:"No checklists created yet."}):e.jsxs("div",{className:"space-y-3 mt-4",children:[l.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Published Checklists"}),l.map(m=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:m.title}),e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[m.items.length," item",m.items.length!==1?"s":""]}),e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${m.status==="published"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:m.status==="published"?"Published":"Draft"}),m.autoSchedule&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full flex items-center",children:[e.jsx(C,{path:Me,size:.7,className:"mr-1"}),"Auto-Scheduled"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>t(m),className:"px-3 py-1 text-sm text-[#4ECDC4] hover:bg-[#4ECDC4] hover:text-white rounded-md transition-colors",children:"Edit & Manage"}),e.jsx("button",{onClick:()=>s(m.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:It,size:.8})})]})]})},m.id))]}),d.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Draft Checklists"}),d.map(m=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:m.title}),e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[m.items.length," item",m.items.length!==1?"s":""]}),e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${m.status==="published"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:m.status==="published"?"Published":"Draft"}),m.autoSchedule&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full flex items-center",children:[e.jsx(C,{path:Me,size:.7,className:"mr-1"}),"Auto-Scheduled"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>t(m),className:"px-3 py-1 text-sm text-[#4ECDC4] hover:bg-[#4ECDC4] hover:text-white rounded-md transition-colors",children:"Edit & Manage"}),e.jsx("button",{onClick:()=>s(m.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:It,size:.8})})]})]})},m.id))]})]})})]},c.id)})})},J0=r=>{const t=r.data&&typeof r.data=="object"&&r.data!==null?r.data.expiration:null;if(!t&&!r.expiryDate)return null;const s=new Date(String(t||r.expiryDate||"")),n=new Date,a=new Date;return a.setDate(n.getDate()+30),s<n?{status:"expired",color:"text-red-600",bgColor:"bg-red-50"}:s<=a?{status:"expiring-soon",color:"text-orange-600",bgColor:"bg-orange-50"}:{status:"valid",color:"text-green-600",bgColor:"bg-green-50"}},X0=r=>new Date(r).toLocaleDateString(),or=(r,t)=>({searchQuery:r.trim()||void 0,category:t.category||void 0,manufacturer:t.manufacturer||void 0,supplier:t.supplier||void 0,reorder_point:t.reorder_point?parseInt(t.reorder_point):void 0,expiryDate:t.expiryDate||void 0,sortBy:t.sortBy,sortDirection:t.sortDirection}),Nl=()=>({category:"",location:"",status:"",manufacturer:"",supplier:"",reorder_point:"",expiryDate:"",sortBy:"name",sortDirection:"asc"});var Z0=Object.defineProperty,eb=Object.defineProperties,tb=Object.getOwnPropertyDescriptors,Cl=Object.getOwnPropertySymbols,sb=Object.prototype.hasOwnProperty,rb=Object.prototype.propertyIsEnumerable,Sl=(r,t,s)=>t in r?Z0(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,_l=(r,t)=>{for(var s in t||(t={}))sb.call(t,s)&&Sl(r,s,t[s]);if(Cl)for(var s of Cl(t))rb.call(t,s)&&Sl(r,s,t[s]);return r},ab=(r,t)=>eb(r,tb(t)),wt=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});class nb{searchInventoryItems(t){return wt(this,null,function*(){try{const s=ab(_l(_l({search:t.searchQuery,category:t.category},t.manufacturer&&{search:`${t.searchQuery||""} ${t.manufacturer}`.trim()}),t.supplier&&{search:`${t.searchQuery||""} ${t.supplier}`.trim()}),{minQuantity:t.reorder_point}),n=yield xt.getItemsFromSupabase(s);if(n.error)return console.error("Error fetching inventory items:",n.error),[];let a=n.data||[];if(t.manufacturer&&!t.searchQuery&&(a=a.filter(i=>(i.data&&typeof i.data=="object"&&i.data!==null?i.data.manufacturer:null)===t.manufacturer)),t.supplier&&!t.searchQuery&&(a=a.filter(i=>(i.data&&typeof i.data=="object"&&i.data!==null?i.data.supplier:null)===t.supplier)),t.expiryDate){const i=new Date,c=new Date;c.setDate(i.getDate()+30),a=a.filter(o=>{const l=o.data&&typeof o.data=="object"&&o.data!==null?o.data.expiration:null;if(!l&&!o.expiration_date)return!1;const d=new Date(String(l||o.expiration_date||""));switch(t.expiryDate){case"expired":return d<i;case"expiring-soon":return d>=i&&d<=c;case"valid":return d>c;default:return!0}})}return t.sortBy&&a.sort((i,c)=>{let o,l;switch(t.sortBy){case"name":o=i.name||"",l=c.name||"";break;case"category":o=i.category||"",l=c.category||"";break;case"quantity":o=i.quantity||0,l=c.quantity||0;break;case"expiration":{const d=i.data&&typeof i.data=="object"&&i.data!==null?i.data.expiration:null,p=c.data&&typeof c.data=="object"&&c.data!==null?c.data.expiration:null;o=new Date(String(d||i.expiration_date||"")),l=new Date(String(p||c.expiration_date||""));break}case"unit_cost":o=i.unit_cost||0,l=c.unit_cost||0;break;default:return 0}return t.sortDirection==="desc"?o>l?-1:o<l?1:0:o<l?-1:o>l?1:0}),a}catch(s){return console.error("Error in searchInventoryItems:",s),[]}})}getCategories(){return wt(this,null,function*(){try{const t=yield xt.getItemsFromSupabase();return t.error?(console.error("Error fetching categories:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.category).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getCategories:",t),[]}})}getManufacturers(){return wt(this,null,function*(){try{const t=yield xt.getItemsFromSupabase();return t.error?(console.error("Error fetching manufacturers:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.data&&typeof n.data=="object"&&n.data!==null?n.data.manufacturer:null).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getManufacturers:",t),[]}})}getSuppliers(){return wt(this,null,function*(){try{const t=yield xt.getItemsFromSupabase();return t.error?(console.error("Error fetching suppliers:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.data&&typeof n.data=="object"&&n.data!==null?n.data.supplier:null).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getSuppliers:",t),[]}})}getLocations(){return wt(this,null,function*(){try{const t=yield xt.getItemsFromSupabase();return t.error?(console.error("Error fetching locations:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.location).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getLocations:",t),[]}})}getStatuses(){return wt(this,null,function*(){try{const t=yield xt.getItemsFromSupabase();return t.error?(console.error("Error fetching statuses:",t.error),[]):Array.from(new Set((t.data||[]).map(n=>n.status).filter(n=>!!n))).sort()}catch(t){return console.error("Error in getStatuses:",t),[]}})}}const ot=new nb;var cr=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const lb=()=>{const[r,t]=u.useState([]),[s,n]=u.useState(!1),[a,i]=u.useState(null),[c,o]=u.useState([]),[l,d]=u.useState([]),[p,m]=u.useState([]),[x,f]=u.useState([]),[g,v]=u.useState([]);u.useEffect(()=>{cr(null,null,function*(){try{const[b,_,E,$,P]=yield Promise.all([ot.getCategories(),ot.getLocations(),ot.getStatuses(),ot.getManufacturers(),ot.getSuppliers()]);o(b),d(_),m(E),f($),v(P)}catch(b){i(b instanceof Error?b.message:"Failed to load filter options")}})},[]);const j=u.useCallback(y=>cr(null,null,function*(){n(!0),i(null);try{const b=yield ot.searchInventoryItems(y);t(b)}catch(b){i(b instanceof Error?b.message:"Failed to search inventory")}finally{n(!1)}}),[]),h=u.useCallback(()=>cr(null,null,function*(){n(!0),i(null);try{const y=yield ot.searchInventoryItems({});t(y)}catch(y){i(y instanceof Error?y.message:"Failed to clear search")}finally{n(!1)}}),[]);return{inventoryItems:r,isLoading:s,error:a,categories:c,locations:l,statuses:p,manufacturers:x,suppliers:g,searchInventory:j,clearSearch:h}},ib=({isOpen:r,selectedItems:t=[],onSelectItems:s,onClose:n})=>{const{inventoryItems:a,isLoading:i,error:c,categories:o,locations:l,statuses:d,searchInventory:p,clearSearch:m}=lb(),[x,f]=u.useState(""),[g,v]=u.useState(!1),[j,h]=u.useState(Nl()),[y,b]=u.useState(t);return u.useEffect(()=>{if(!r)return;const w=setTimeout(()=>{if(x.trim()||Object.values(j).some(T=>T!=="")){const T=or(x,j);p(T)}},300);return()=>clearTimeout(w)},[x,j,r,p]),u.useEffect(()=>{if(r){m(),b(t);const w=or(x,j);p(w)}},[r,t,m,p,x,j]),u.useEffect(()=>{b(t)},[t]),{searchQuery:x,showFilters:g,filters:j,localSelectedItems:y,inventoryItems:a,isLoading:i,error:c,categories:o,locations:l,statuses:d,setSearchQuery:f,setShowFilters:v,setFilters:h,handleClearFilters:()=>{h(Nl()),f(""),m().then(()=>{setTimeout(()=>{p({})},100)})},handleItemToggle:w=>{const T=y.some(k=>k.id===w.id);b(T?k=>k.filter(S=>S.id!==w.id):k=>[...k,w])},handleConfirmSelection:()=>{s(y),n()},handleSearch:()=>{const w=or(x,j);p(w)}}},ob=({onClose:r})=>e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Search Inventory Items"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Select items for your checklist with advanced filtering"})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(C,{path:ae,size:1.5})})]}),cb=({searchQuery:r,onSearchChange:t,onSearch:s})=>{const n=a=>{a.key==="Enter"&&s()};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{path:cc,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search items...",value:r,onChange:a=>t(a.target.value),onKeyPress:n,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]"})]}),e.jsx("button",{onClick:s,className:"w-full mt-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] transition-colors",children:"Search"})]})};var db=Object.defineProperty,ub=Object.defineProperties,mb=Object.getOwnPropertyDescriptors,Tl=Object.getOwnPropertySymbols,pb=Object.prototype.hasOwnProperty,xb=Object.prototype.propertyIsEnumerable,kl=(r,t,s)=>t in r?db(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,hb=(r,t)=>{for(var s in t||(t={}))pb.call(t,s)&&kl(r,s,t[s]);if(Tl)for(var s of Tl(t))xb.call(t,s)&&kl(r,s,t[s]);return r},gb=(r,t)=>ub(r,mb(t));const fb=({filters:r,onFiltersChange:t,onClearFilters:s,categories:n,showFilters:a,onToggleFilters:i})=>{const c=(o,l)=>{t(gb(hb({},r),{[o]:l}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900",children:[e.jsx(C,{path:$r,size:1}),e.jsx("span",{children:"Filters"}),e.jsx(C,{path:dc,size:1,className:`transform transition-transform ${a?"rotate-180":""}`})]})}),e.jsx(As,{children:a&&e.jsxs(me.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{id:"category-filter",value:r.category,onChange:o=>c("category",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"",children:"All Categories"}),n.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"min-quantity-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Quantity"}),e.jsx("input",{id:"min-quantity-filter",type:"number",value:r.reorder_point,onChange:o=>c("reorder_point",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"max-quantity-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Quantity"}),e.jsx("input",{id:"max-quantity-filter",type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"âˆž"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry-status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Status"}),e.jsxs("select",{id:"expiry-status-filter",value:r.expiryDate,onChange:o=>c("expiryDate",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"",children:"All Items"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"expiring-soon",children:"Expiring Soon (30 days)"}),e.jsx("option",{value:"valid",children:"Valid"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsxs("select",{id:"sort-by-filter",value:r.sortBy,onChange:o=>c("sortBy",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"quantity",children:"Quantity"}),e.jsx("option",{value:"expiration",children:"Expiration"}),e.jsx("option",{value:"unit_cost",children:"Unit Cost"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-direction-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Direction"}),e.jsxs("select",{id:"sort-direction-filter",value:r.sortDirection,onChange:o=>c("sortDirection",o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[e.jsx("option",{value:"asc",children:"Ascending"}),e.jsx("option",{value:"desc",children:"Descending"})]})]})]}),e.jsx("button",{onClick:s,className:"w-full px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Clear Filters"})]})})]})},bb=({selectedItems:r})=>e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Selected Items"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.length," item",r.length!==1?"s":""," ","selected"]}),r.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[r.slice(0,3).map(t=>e.jsx("div",{className:"text-xs text-gray-600 truncate",children:t.name},t.id)),r.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",r.length-3," more"]})]})]}),yb=({item:r,isSelected:t,onToggle:s})=>{const n=J0(r),a=i=>{var c;return(c=r.data)==null?void 0:c[i]};return e.jsx(me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`border rounded-lg p-4 cursor-pointer transition-all ${t?"border-[#4ECDC4] bg-[#4ECDC4]/5":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>s(r),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:r.name}),t&&e.jsx("span",{className:"px-2 py-1 text-xs bg-[#4ECDC4] text-white rounded-full",children:"Selected"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:$s,size:.8}),e.jsx("span",{children:r.category})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:vr,size:.8}),e.jsx("span",{children:r.location})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"font-medium",children:"Quantity:"}),e.jsxs("span",{children:[r.quantity||0," ",String(a("unit")||"units")]})]})]}),e.jsxs("div",{className:"space-y-1",children:[a("manufacturer")?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:uc,size:.8}),e.jsx("span",{children:String(a("manufacturer"))})]}):null,a("supplier")?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:mc,size:.8}),e.jsx("span",{children:String(a("supplier"))})]}):null,a("expiration")||r.expiryDate?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(C,{path:Me,size:.8}),e.jsxs("span",{children:["Expires:"," ",X0(String(a("expiration")||r.expiryDate||""))]})]}):null]})]}),n&&e.jsxs("div",{className:`mt-2 inline-block px-2 py-1 text-xs rounded-full ${n.bgColor} ${n.color}`,children:[n.status==="expired"&&"Expired",n.status==="expiring-soon"&&"Expiring Soon",n.status==="valid"&&"Valid"]})]})})})},vb=({inventoryItems:r,selectedItems:t,onItemToggle:s,isLoading:n,error:a})=>e.jsxs("div",{className:"w-2/3 p-6 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Search Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:n?"Searching...":`${r.length} items found`})]})}),a&&e.jsxs("div",{className:"flex items-center space-x-2 text-red-500 mb-4",children:[e.jsx(C,{path:ce,size:1}),e.jsx("span",{children:a})]}),n&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:Or,size:1,className:"animate-spin text-[#4ECDC4]"}),e.jsx("span",{className:"text-gray-600",children:"Searching inventory..."})]})}),!n&&!a&&e.jsx("div",{className:"space-y-3",children:r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{path:$s,size:3,className:"mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No items found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria."})]}):r.map(i=>{const c=t.some(o=>o.id===i.id);return e.jsx(yb,{item:i,isSelected:c,onToggle:s},i.id)})})]}),jb=({isOpen:r,onClose:t,onSelectItems:s,selectedItems:n=[]})=>{const{searchQuery:a,showFilters:i,filters:c,localSelectedItems:o,inventoryItems:l,isLoading:d,error:p,categories:m,locations:x,statuses:f,setSearchQuery:g,setShowFilters:v,setFilters:j,handleClearFilters:h,handleItemToggle:y,handleConfirmSelection:b,handleSearch:_}=ib({isOpen:r,selectedItems:n,onSelectItems:s,onClose:t});return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(me.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsx(ob,{onClose:t}),e.jsxs("div",{className:"flex h-[calc(90vh-140px)]",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 p-6 overflow-y-auto",children:[e.jsx(cb,{searchQuery:a,onSearchChange:g,onSearch:_}),e.jsx(fb,{filters:c,onFiltersChange:j,onClearFilters:h,categories:m,locations:x,statuses:f,showFilters:i,onToggleFilters:()=>v(!i)}),e.jsx(bb,{selectedItems:o})]}),e.jsx(vb,{inventoryItems:l,selectedItems:o,onItemToggle:y,isLoading:d,error:p})]}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsxs("button",{onClick:b,disabled:o.length===0,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Confirm Selection (",o.length,")"]})})]})}):null};var wb=Object.defineProperty,Nb=Object.defineProperties,Cb=Object.getOwnPropertyDescriptors,Il=Object.getOwnPropertySymbols,Sb=Object.prototype.hasOwnProperty,_b=Object.prototype.propertyIsEnumerable,Pl=(r,t,s)=>t in r?wb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Vt=(r,t)=>{for(var s in t||(t={}))Sb.call(t,s)&&Pl(r,s,t[s]);if(Il)for(var s of Il(t))_b.call(t,s)&&Pl(r,s,t[s]);return r},Wt=(r,t)=>Nb(r,Cb(t)),Dl=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Tb=({selectedChecklist:r,onAddItem:t,onUpdateItem:s,onDeleteItem:n,onGenerateAIItemSuggestions:a,showAIItemSuggestions:i,isGeneratingSuggestions:c,aiItemSuggestions:o,onApplyAIItemSuggestion:l,onCloseAISuggestions:d,showSuccessMessage:p})=>{const[m,x]=u.useState(!1),[f,g]=u.useState([]),[v,j]=u.useState(!1),[h,y]=u.useState(null),[b,_]=u.useState({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),[E,$]=u.useState(!1),P=()=>{b.title&&b.instructions&&r&&(t({title:b.title,instructions:b.instructions,requiredInventory:f.map(O=>({id:O.id,name:O.name||"",required:1,available:O.quantity||0,used:0,unit:"unit"})),sdsId:b.sdsId||void 0}),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([]),j(!1))},w=O=>{b.title&&b.instructions&&r&&(s(O,{title:b.title,instructions:b.instructions,requiredInventory:f.map(A=>({id:A.id,name:A.name||"",required:1,available:A.quantity||0,used:0,unit:"unit"})),sdsId:b.sdsId||void 0}),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([]),y(null))},T=O=>{var A;y(O.id),_({title:O.title,instructions:O.instructions,inventoryItemIds:((A=O.requiredInventory)==null?void 0:A.map(B=>B.id))||[],sdsId:O.sdsId||""});const R=(O.requiredInventory||[]).map(B=>({id:B.id,facility_id:null,name:B.name,quantity:B.available,data:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:null,category:null,status:null,location:null,supplier:null,cost:null,vendor:null,warranty:null,maintenance_schedule:null,next_due:null,service_provider:null,assigned_to:null,notes:null,tool_id:null,supply_id:null,equipment_id:null,hardware_id:null,p2_status:null,serial_number:null,manufacturer:null,image_url:null,tags:null,favorite:null,tracked:null,barcode:null,sku:null,description:null,current_phase:null,is_active:null,unit:null,expiration:null,purchase_date:null,last_serviced:null,last_updated:null}));g(R)},k=O=>{g(O)},S=(O,A)=>Dl(null,null,function*(){if(O.trim()){$(!0);try{try{const R=yield Ps.askAI(`Generate detailed instructions for checklist item "${O}" in the ${A||(r==null?void 0:r.category)} category. Provide step-by-step instructions that are clear and actionable.`,{module:"checklist-item-form",facilityId:"unknown",userId:"unknown"});_(B=>Wt(Vt({},B),{instructions:R}))}catch(R){console.warn("AI service failed, using fallback description:",R);const B=yield D(O,A||(r==null?void 0:r.category));_(V=>Wt(Vt({},V),{instructions:B}))}}catch(R){console.error("Error generating AI description:",R),_(B=>Wt(Vt({},B),{instructions:`Complete ${O.toLowerCase()} following established procedures and safety protocols.`}))}finally{$(!1)}}}),I=O=>{if(_(A=>Wt(Vt({},A),{title:O})),O.length>=5&&!b.instructions){const A=setTimeout(()=>{S(O)},1e3);return()=>clearTimeout(A)}return()=>{}},D=(O,A)=>Dl(null,null,function*(){return yield new Promise(B=>setTimeout(B,800)),{setup:`Perform ${O.toLowerCase()} according to facility protocols. Ensure all equipment is properly prepared and safety measures are in place.`,patient:`Complete ${O.toLowerCase()} with patient safety as the priority. Follow infection control protocols and maintain patient privacy.`,weekly:`Conduct thorough ${O.toLowerCase()} as part of weekly maintenance schedule. Document all activities and report any issues.`,public:`Execute ${O.toLowerCase()} in public areas following facility standards. Maintain professional appearance and ensure accessibility.`,deep:`Perform intensive ${O.toLowerCase()} using specialized equipment and procedures. Follow all safety protocols and containment measures.`}[A]||`Complete ${O.toLowerCase()} following established procedures and safety protocols.`});return e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium",children:"Checklist Items"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:a,disabled:c,className:"flex items-center px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-400 transition-colors",title:"Get AI suggestions for checklist items",children:[e.jsx(C,{path:pc,size:.8,className:"mr-1"}),c?"Generating...":"AI Suggestions"]}),e.jsxs("button",{onClick:()=>{j(!0),y(null),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([])},className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:Ue,size:1,className:"mr-2"}),"Add Item"]})]})]}),i&&e.jsxs("div",{className:"mb-4 p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-purple-800 flex items-center",children:[e.jsx(C,{path:fs,size:.8,className:"mr-1"}),"AI Item Suggestions"]}),e.jsx("button",{onClick:d,className:"text-purple-600 hover:text-purple-800",children:e.jsx(C,{path:ae,size:.8})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:o.map((O,A)=>e.jsxs("div",{className:"border border-purple-200 rounded-lg p-3 bg-white",children:[e.jsx("h6",{className:"font-medium text-purple-800 mb-1",children:O.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:O.instructions}),O.suggestedInventory.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Suggested: "}),e.jsx("span",{className:"text-xs text-purple-600",children:O.suggestedInventory.join(", ")})]}),e.jsx("button",{onClick:()=>l(O),className:"w-full px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:"Use This Item"})]},A))})]}),p&&e.jsx("div",{className:"mb-4 p-3 border border-green-200 rounded-lg bg-green-50",children:e.jsxs("div",{className:"flex items-center text-green-800",children:[e.jsx(C,{path:Le,size:.8,className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:p})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[r.items.map(O=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-800",children:O.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:O.instructions}),O.requiredInventory&&O.requiredInventory.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Required: "}),O.requiredInventory.map(A=>A.name).join(", ")]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[e.jsx("button",{onClick:()=>T(O),className:"p-1 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",children:e.jsx(C,{path:Zt,size:.8})}),e.jsx("button",{onClick:()=>n(O.id),className:"p-1 text-red-600 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(C,{path:It,size:.8})})]})]})},O.id)),r.items.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No items added yet. Click "Add Item" to get started.'})]}),v&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsx("h5",{className:"font-medium mb-3",children:h?"Edit Item":"Add New Item"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"item-title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Item Title"}),e.jsx("input",{id:"item-title",type:"text",value:b.title,onChange:O=>I(O.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",placeholder:"e.g., Clean and sanitize surfaces"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:["Instructions",E&&e.jsxs("span",{className:"ml-2 text-xs text-blue-600 flex items-center",children:[e.jsx(C,{path:fs,size:.6,className:"mr-1 animate-pulse"}),"AI generating..."]})]}),b.title&&!E&&e.jsxs("button",{type:"button",onClick:()=>S(b.title),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center",title:"Generate AI description",children:[e.jsx(C,{path:fs,size:.6,className:"mr-1"}),"AI Generate"]})]}),e.jsx("textarea",{value:b.instructions,onChange:O=>_(Wt(Vt({},b),{instructions:O.target.value})),className:`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] ${E?"bg-blue-50 border-blue-200":""}`,rows:3,placeholder:E?"AI is generating instructions...":"Detailed instructions for this task...",disabled:E})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"inventory-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Required Inventory"}),e.jsx("button",{id:"inventory-select",onClick:()=>x(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-left focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:f.length>0?`${f.length} item(s) selected`:"Click to select required inventory items"}),f.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:f.map(O=>e.jsxs("div",{className:"text-sm text-gray-600",children:["â€¢ ",O.name]},O.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{j(!1),y(null),_({title:"",instructions:"",inventoryItemIds:[],sdsId:""}),g([])},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:()=>h?w(h):P(),className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac]",children:h?"Update Item":"Add Item"})]})]})]}),e.jsx(jb,{isOpen:m,onClose:()=>x(!1),onSelectItems:k,selectedItems:f})]})};var kb=Object.defineProperty,Ib=Object.defineProperties,Pb=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,Db=Object.prototype.hasOwnProperty,Eb=Object.prototype.propertyIsEnumerable,Ol=(r,t,s)=>t in r?kb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ob=(r,t)=>{for(var s in t||(t={}))Db.call(t,s)&&Ol(r,s,t[s]);if(El)for(var s of El(t))Eb.call(t,s)&&Ol(r,s,t[s]);return r},$b=(r,t)=>Ib(r,Pb(t)),$l=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Wv=()=>{const{checklists:r,updateChecklist:t,deleteChecklist:s,publishChecklist:n,addItemToChecklist:a,updateChecklistItem:i,deleteChecklistItem:c}=Wn(),[o,l]=u.useState(!1),[d,p]=u.useState(null),[m,x]=u.useState(!1),f=R=>{if(d)t(d.id,R);else{const{addChecklist:B}=Wn.getState();B($b(Ob({},R),{title:R.title||"New Checklist",items:[],status:"draft"}))}p(null),l(!1)},g=()=>{d&&(n(d.id),p(null))},v=R=>{p(R)},j=()=>{l(!1),p(null)},h=R=>{if(d){a(d.id,R);const B=r.find(V=>V.id===d.id);B&&p(B)}},y=(R,B)=>{d&&i(d.id,R,B)},b=R=>{d&&c(d.id,R)},[_,E]=u.useState(!1),[$,P]=u.useState(!1),[w,T]=u.useState([]),[k,S]=u.useState(null),I=()=>$l(null,null,function*(){if(d){P(!0);try{try{const R=yield Ps.askAI(`Generate 5-7 detailed checklist items for "${d.title}" in the ${d.category} category. Each item should include title, detailed instructions, and suggested inventory requirements.`,{module:"checklist-management",facilityId:"unknown",userId:"unknown"}),B=O(R);T(B),E(!0)}catch(R){console.warn("AI service failed, using fallback suggestions:",R);const B=yield A(d.category);T(B),E(!0)}}catch(R){console.error("Error generating AI item suggestions:",R);const B=yield A(d.category);T(B),E(!0)}finally{P(!1)}}}),D=R=>{if(!d)return;a(d.id,{title:R.title,instructions:R.instructions,requiredInventory:[],sdsId:void 0});const B=r.find(V=>V.id===d.id);B&&p(B),E(!1),S(`âœ… Added "${R.title}" to checklist`),setTimeout(()=>S(null),3e3)},O=R=>{try{const B=R.match(/\[[\s\S]*\]/);if(B){const q=JSON.parse(B[0]);if(Array.isArray(q))return q.map(W=>{var X;return{title:W.title||W.name||"Untitled Item",instructions:W.instructions||((X=W.data)==null?void 0:X.description)||W.steps||"No instructions provided",suggestedInventory:Array.isArray(W.suggestedInventory)?W.suggestedInventory:Array.isArray(W.inventory)?W.inventory:Array.isArray(W.requirements)?W.requirements:[]}})}const V=R.split(`
`).filter(q=>q.trim()),U=[];let F=null;for(const q of V)if(q.match(/^\d+\./))F&&U.push(F),F={title:q.replace(/^\d+\.\s*/,"").trim(),instructions:"",suggestedInventory:[]};else if(F&&q.trim())if(q.toLowerCase().includes("inventory")||q.toLowerCase().includes("supplies")){const W=q.match(/[^:]+:\s*(.+)/);W&&(F.suggestedInventory=W[1].split(",").map(X=>X.trim()))}else F.instructions+=(F.instructions?" ":"")+q.trim();return F&&U.push(F),U.length>0?U:[{title:"AI-generated item",instructions:R.substring(0,200)+"...",suggestedInventory:[]}]}catch(B){return console.error("Error parsing AI response:",B),[{title:"AI-generated item",instructions:R.substring(0,200)+"...",suggestedInventory:[]}]}},A=R=>$l(null,null,function*(){return yield new Promise(V=>setTimeout(V,1500)),[{title:"Surface Disinfection",instructions:"Use EPA-approved disinfectant wipes. Clean all high-touch surfaces including door handles, light switches, and equipment controls. Allow 3-5 minutes contact time for proper disinfection.",suggestedInventory:["Disinfectant Wipes","Nitrile Gloves","Safety Goggles"]},{title:"Equipment Sanitization",instructions:"Clean all medical equipment with appropriate cleaning agents. Pay special attention to patient contact surfaces. Verify equipment is operational after cleaning.",suggestedInventory:["Equipment Cleaning Solution","Microfiber Cloths","Alcohol Wipes"]},{title:"Supply Restocking",instructions:"Check all supply levels and restock as needed. Verify expiration dates on all items. Ensure emergency supplies are readily accessible.",suggestedInventory:["Various Medical Supplies","Storage Containers","Labeling Materials"]},{title:"Safety Equipment Check",instructions:"Verify all safety equipment is present and functional. Test emergency systems and alarms. Check fire extinguishers and emergency exits.",suggestedInventory:["Safety Equipment","Testing Tools","Documentation Forms"]},{title:"Quality Control Verification",instructions:"Perform final quality control check. Verify all cleaning standards have been met. Document completion and any issues found.",suggestedInventory:["Quality Control Checklist","Documentation Forms","Camera for Documentation"]}]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>x(!m),className:"flex items-center text-xl font-semibold text-gray-800 hover:text-gray-600 transition-colors",children:[e.jsx(C,{path:m?mt:ss,size:1.2,className:"mr-2"}),"Checklist Management",e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",r.length," total)"]})]}),e.jsxs("button",{onClick:()=>{l(!0),p(null)},className:"flex items-center px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#38b2ac] transition-colors",children:[e.jsx(C,{path:Ue,size:1,className:"mr-2"}),"Add Checklist"]})]}),m&&e.jsx(Y0,{checklists:r,onEditChecklist:v,onDeleteChecklist:s})]}),(d||o)&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto scrollbar-hide",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:o?"Add New Checklist":`Edit: ${d==null?void 0:d.title}`}),e.jsx("button",{onClick:j,className:"p-1 text-gray-500 hover:text-gray-700",children:e.jsx(C,{path:ae,size:1.2})})]}),e.jsx(K0,{selectedChecklist:d,isAddingChecklist:o,onCancel:j,onSaveDraft:f,onPublish:g}),d&&e.jsx(Tb,{selectedChecklist:d,onAddItem:h,onUpdateItem:y,onDeleteItem:b,onGenerateAIItemSuggestions:I,showAIItemSuggestions:_,isGeneratingSuggestions:$,aiItemSuggestions:w,onApplyAIItemSuggestion:D,onCloseAISuggestions:()=>E(!1),showSuccessMessage:k})]})})]})},Ab={RATE_LIMIT:{MAX_ATTEMPTS:5,LOCKOUT_DURATION_MINUTES:15,WINDOW_SIZE_MINUTES:15},VALIDATION:{DEBOUNCE_MS:500},THRESHOLDS:{MIN_PASSWORD_LENGTH:8,MAX_LOGIN_ATTEMPTS:5},PASSWORD_STRENGTH:{MIN_LENGTH:8,GOOD_LENGTH:12,EXCELLENT_LENGTH:16,MAX_SCORE:5}},Gi=r=>(Object.keys(r).forEach(t=>{typeof r[t]=="object"&&r[t]!==null&&Gi(r[t])}),Object.freeze(r));Gi(Ab);const Gv=(r,t)=>{if(!r||typeof r!="string")return null;const s=r.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim();return t==="email"?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?s:null:t==="password"&&s.length<8?null:s},Kv=r=>{const t=[];return!r||typeof r!="string"?{isSuspicious:!1,threats:t}:(/('|"|;|--|\/\*|\*\/|union|select|insert|update|delete|drop|create|alter)/i.test(r)&&t.push("Potential SQL injection detected"),/<script|javascript:|on\w+\s*=|vbscript:|expression\(/i.test(r)&&t.push("Potential XSS attack detected"),/\||&|;|`|\$\(|eval\(|exec\(/i.test(r)&&t.push("Potential command injection detected"),{isSuspicious:t.length>0,threats:t})},Ir=(r=32)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";if(typeof crypto!="undefined"&&crypto.getRandomValues){const n=new Uint8Array(r);crypto.getRandomValues(n);for(let a=0;a<r;a++)s+=t[n[a]%t.length]}else for(let n=0;n<r;n++)s+=t.charAt(Math.floor(Math.random()*t.length));return s},dr={generateToken:()=>Ir(32),storeToken:r=>{try{typeof window!="undefined"&&localStorage.setItem("csrf_token",r)}catch(t){}},getStoredToken:()=>{try{return typeof window!="undefined"?localStorage.getItem("csrf_token"):null}catch(r){return null}},validateToken:(r,t)=>{if(!r||!t)return!1;const s=r===t;return s},setHttpOnlyCookie:r=>{dr.storeToken(r)},refreshToken:()=>{const r=dr.generateToken();return dr.storeToken(r),r},clearToken:()=>{try{typeof window!="undefined"&&localStorage.removeItem("csrf_token")}catch(r){}}};var Rb=Object.defineProperty,Bb=Object.defineProperties,Fb=Object.getOwnPropertyDescriptors,Al=Object.getOwnPropertySymbols,Mb=Object.prototype.hasOwnProperty,Lb=Object.prototype.propertyIsEnumerable,Rl=(r,t,s)=>t in r?Rb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Bl=(r,t)=>{for(var s in t||(t={}))Mb.call(t,s)&&Rl(r,s,t[s]);if(Al)for(var s of Al(t))Lb.call(t,s)&&Rl(r,s,t[s]);return r},Fl=(r,t)=>Bb(r,Fb(t)),Ml=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Qv=()=>{const[r,t]=u.useState({}),[s,n]=u.useState("");u.useEffect(()=>{const c=Ir(32);n(c),typeof sessionStorage!="undefined"&&sessionStorage.setItem("oauth_state",c)},[]);const a=c=>Ml(null,null,function*(){try{if(t(m=>Fl(Bl({},m),{[c]:!0})),!s)throw new Error("OAuth state not initialized");const o=c==="microsoft"?"azure":c,l=Ir(128),d=yield i(l);typeof sessionStorage!="undefined"&&(sessionStorage.setItem("oauth_code_verifier",l),sessionStorage.setItem("oauth_provider",c));const{error:p}=yield Q.auth.signInWithOAuth({provider:o,options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{access_type:"offline",prompt:"consent",state:s,code_challenge:d,code_challenge_method:"S256"}}});if(p)throw console.error(`OAuth login error with ${c}:`,p),p;Ec()&&console.log(`[SECURITY] OAuth login initiated with ${c}:`,{provider:o,state:s,codeChallenge:d,timestamp:new Date().toISOString()})}catch(o){console.error(`Failed to login with ${c}:`,o),typeof sessionStorage!="undefined"&&(sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),sessionStorage.removeItem("oauth_state")),alert(`Failed to login with ${c}. Please try again.`)}finally{t(o=>Fl(Bl({},o),{[c]:!1}))}}),i=c=>Ml(null,null,function*(){try{const l=new TextEncoder().encode(c),d=yield crypto.subtle.digest("SHA-256",l),p=Array.from(new Uint8Array(d));return btoa(String.fromCharCode(...p)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(o){return console.error("Failed to generate PKCE code challenge:",o),c.substring(0,43)}});return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>a("google"),disabled:r.google||!s,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.google?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):e.jsx(Co,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"ml-2",children:"Google"})]}),e.jsxs("button",{type:"button",onClick:()=>a("microsoft"),disabled:r.microsoft||!s,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.microsoft?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"}):e.jsx(So,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"ml-2",children:"Microsoft"})]})]})]})};var zb=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Ub=()=>{const r=Er(),{setAuthToken:t,setSessionExpiry:s}=Rr();return u.useEffect(()=>{zb(null,null,function*(){var a,i,c,o,l,d,p,m,x,f,g,v;try{const h=new URLSearchParams(window.location.search).get("state"),y=sessionStorage.getItem("oauth_state");if(h&&y&&h!==y){console.error("OAuth state mismatch - possible CSRF attack"),r("/login?error=invalid_state");return}const{data:b,error:_}=yield Q.auth.getSession();if(_){console.error("Auth callback error:",_),r("/login?error=auth_failed");return}if(b.session){if(console.log("OAuth authentication successful, setting up user session"),t(b.session.access_token),s(b.session.expires_at?new Date(b.session.expires_at*1e3).toISOString():""),localStorage.setItem("authToken",b.session.access_token),localStorage.setItem("sessionExpiry",b.session.expires_at?new Date(b.session.expires_at*1e3).toISOString():""),localStorage.setItem("currentUser",JSON.stringify(b.session.user)),(a=b.session)!=null&&a.user)try{const E=((i=b.session.user.app_metadata)==null?void 0:i.provider)||"unknown";console.log("OAuth provider detected:",E);const{data:$,error:P}=yield Q.from("users").select("*").eq("id",b.session.user.id).single();if(P&&P.code!=="PGRST116"&&console.warn("Error checking user profile:",P),$){const T=(((m=b.session.user.user_metadata)==null?void 0:m.full_name)||((x=b.session.user.user_metadata)==null?void 0:x.name)||((f=b.session.user.user_metadata)==null?void 0:f.display_name)||`${$.first_name||""} ${$.last_name||""}`.trim()).trim().split(" "),k=T[0]||"",S=T.slice(1).join(" ")||"",I={email:b.session.user.email,first_name:k,last_name:S,avatar_url:((g=b.session.user.user_metadata)==null?void 0:g.avatar_url)||((v=b.session.user.user_metadata)==null?void 0:v.picture)||$.avatar_url,provider:E,updated_at:new Date().toISOString()},{error:D}=yield Q.from("users").update(I).eq("id",b.session.user.id);D?console.warn("Failed to update user profile:",D):console.log("Updated existing user profile:",I)}else{const T=(((c=b.session.user.user_metadata)==null?void 0:c.full_name)||((o=b.session.user.user_metadata)==null?void 0:o.name)||((l=b.session.user.user_metadata)==null?void 0:l.display_name)||"").trim().split(" "),k=T[0]||"",S=T.slice(1).join(" ")||"",I={id:b.session.user.id,email:b.session.user.email,first_name:k,last_name:S,role:"user",facility_id:ei.getDefaultFacilityId(),avatar_url:((d=b.session.user.user_metadata)==null?void 0:d.avatar_url)||((p=b.session.user.user_metadata)==null?void 0:p.picture)||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:D}=yield Q.from("users").insert(I);D?console.warn("Failed to create user profile:",D):console.log("Created new user profile for OAuth user:",I)}}catch(E){console.warn("Error handling user profile:",E)}sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),console.log("OAuth user session established, redirecting to home"),r("/home")}else console.log("No session found, redirecting to login"),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),r("/login")}catch(j){console.error("Unexpected error in auth callback:",j),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),sessionStorage.removeItem("oauth_provider"),r("/login?error=unexpected")}})},[r,t,s]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-teal-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Completing authentication..."})]})})},Yv=Object.freeze(Object.defineProperty({__proto__:null,default:Ub},Symbol.toStringTag,{value:"Module"})),qb=r=>{switch(r){case"bi-test":return De;case"bi-failure":return ce;case"cycle-complete":case"cycle-completed":return Ce;case"cycle-started":return js;case"tool-quarantine":return di;case"regulatory-notification":return Jr;case"tool-200-scans":return hc;case"bath-1-change":case"bath-2-change":return xc;case"autoclave-cycle-started":return js;case"tool-problem-flagged":return ut;case"batch-id-created":return $s;case"incident-resolution":return Ce;default:return Jr}},Hb=({activities:r})=>{const t=r.length>10,s=t?"400px":"auto";return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center justify-between",children:[e.jsx("span",{children:"Recent Activity"}),t&&e.jsxs("span",{className:"text-xs text-gray-500 font-normal",children:[r.length," activities"]})]}),e.jsx("div",{className:"space-y-3 overflow-y-auto pr-2",style:{maxHeight:s,scrollbarWidth:"thin",scrollbarColor:"#cbd5e0 #f7fafc"},children:r.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 ${n.color} rounded-lg flex items-center justify-center`,children:e.jsx(C,{path:qb(n.type),size:.8,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:n.title}),e.jsx("p",{className:"text-xs text-gray-500",children:n.time})]})]}),n.toolCount&&e.jsxs("span",{className:"text-xs text-gray-500",children:[n.toolCount," tools"]})]},a))})]})},Vb=Object.freeze(Object.defineProperty({__proto__:null,RecentActivity:Hb},Symbol.toStringTag,{value:"Module"})),Wb=({recentTests:r,nextTestDue:t,refreshBIResults:s})=>{const n=i=>{switch(i){case"pass":return"text-green-600";case"fail":return"text-red-600";case"skip":return"text-gray-600";case"in-progress":return"text-yellow-600";default:return"text-gray-600"}},a=i=>{switch(i){case"pass":return Ce;case"fail":return ce;case"skip":return De;case"in-progress":return De;default:return De}};return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:De,size:1,className:"text-orange-600"}),"BI Test Results"]}),s&&e.jsxs("button",{onClick:s,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",title:"Refresh BI Results",children:[e.jsx(C,{path:ts,size:.7}),"Refresh"]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{path:Me,size:.8,className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Next Test Due"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t?Gc(t):"Not scheduled"}),t&&e.jsx("p",{className:"text-xs text-gray-500",children:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Recent Results"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.length," tests"]})]}),r.length>0?r.map((i,c)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{path:a(i.status),size:.8,className:n(i.status)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:i.status.toUpperCase()}),e.jsx("p",{className:"text-xs text-gray-500",children:i.date.toLocaleDateString()})]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Tool ",i.toolId]})]},c)):e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(C,{path:De,size:1.5,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No recent BI tests"}),e.jsx("p",{className:"text-xs mt-1",children:"Try refreshing if you just completed a test"})]})]})]})},Gb=Object.freeze(Object.defineProperty({__proto__:null,BITestResults:Wb},Symbol.toStringTag,{value:"Module"})),Kb=({totalTools:r,activeTools:t,completedToday:s})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Tool Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{path:Be,size:1,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Total Tools"}),e.jsx("p",{className:"text-xs text-gray-500",children:"In system"})]})]}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:r})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{path:js,size:1,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"In Cycle"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Currently processing"})]})]}),e.jsx("span",{className:"text-lg font-semibold text-blue-600",children:t})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{path:Ce,size:1,className:"text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Completed Today"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sterilized tools"})]})]}),e.jsx("span",{className:"text-lg font-semibold text-green-600",children:s})]})]})]}),Qb=Object.freeze(Object.defineProperty({__proto__:null,ToolStatus:Kb},Symbol.toStringTag,{value:"Module"}));var Yb=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Jb=({show:r,onClose:t})=>{const[s,n]=u.useState(null),[a,i]=u.useState(!1),[c,o]=u.useState(null),[l,d]=u.useState(!1),[p,m]=u.useState(null),[x,f]=u.useState(0),{activeTab:g}=Ve(),v=()=>{const _=`${(()=>{const w="barcode,name,category,location,quantity,status,purchaseDate,vendor,cost,notes";switch(g){case"tools":return`${w},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,assignedTo`;case"supplies":return`${w},expirationDate,reorderPoint,minimumStock`;case"equipment":return`${w},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,serialNumber`;case"officeHardware":return`${w},warranty,serialNumber,assignedTo`;default:return w}})()}
123456789,${g.slice(0,-1)} Name,${g},Location,1,Available,2024-01-01,Vendor Name,100.00,Notes`,E=new Blob([_],{type:"text/csv"}),$=window.URL.createObjectURL(E),P=document.createElement("a");P.href=$,P.download=`${g}_template.csv`,document.body.appendChild(P),P.click(),document.body.removeChild(P),window.URL.revokeObjectURL($)},j=b=>{var _;const E=(_=b.target.files)==null?void 0:_[0];E&&E.type==="text/csv"&&(n(E),o(null),d(!1))},h=(b,_)=>{var E;const $=[];return(!((E=b.data)!=null&&E.barcode)||String(b.data.barcode).trim()==="")&&$.push(`Row ${_}: Barcode is required`),(!b.name||String(b.name).trim()==="")&&$.push(`Row ${_}: Name is required`),b.quantity&&(isNaN(Number(b.quantity))||Number(b.quantity)<0)&&$.push(`Row ${_}: Quantity must be a positive number`),b.unit_cost&&(isNaN(parseFloat(String(b.unit_cost)))||parseFloat(String(b.unit_cost))<0)&&$.push(`Row ${_}: Cost must be a positive number`),$},y=()=>Yb(null,null,function*(){if(s){i(!0),o(null),d(!1),m(null),f(0);try{const _=(yield s.text()).split(`
`),E=_[0].split(",").map(z=>z.trim()),$=E.findIndex(z=>z.toLowerCase().includes("barcode")),P=E.findIndex(z=>z.toLowerCase().includes("name")),w=E.findIndex(z=>z.toLowerCase().includes("category")),T=E.findIndex(z=>z.toLowerCase().includes("location")),k=E.findIndex(z=>z.toLowerCase().includes("quantity")),S=E.findIndex(z=>z.toLowerCase().includes("status")),I=E.findIndex(z=>z.toLowerCase().includes("purchasedate")),D=E.findIndex(z=>z.toLowerCase().includes("vendor")),O=E.findIndex(z=>z.toLowerCase().includes("cost")),A=E.findIndex(z=>z.toLowerCase().includes("warranty")),R=E.findIndex(z=>z.toLowerCase().includes("maintenanceschedule")),B=E.findIndex(z=>z.toLowerCase().includes("lastserviced")),V=E.findIndex(z=>z.toLowerCase().includes("nextdue")),U=E.findIndex(z=>z.toLowerCase().includes("serviceprovider")),F=E.findIndex(z=>z.toLowerCase().includes("assignedto")),q=E.findIndex(z=>z.toLowerCase().includes("notes"));if($===-1||P===-1)throw new Error("CSV must contain barcode and name columns");const W=[],X=[];for(let z=1;z<_.length;z++){const ue=_[z].trim();if(!ue)continue;const se=ue.split(",").map(et=>et.trim());if(se.length<E.length)continue;const Ze={id:`csv-${Date.now()}-${z}`,name:se[P],category:w!==-1?se[w]:g,location:T!==-1?se[T]:"Unknown",quantity:k!==-1&&parseInt(se[k])||1,status:S!==-1?se[S]:"Available",unit_cost:O!==-1&&parseFloat(se[O])||0,updated_at:new Date().toISOString(),data:{barcode:se[$],purchaseDate:I!==-1?se[I]:new Date().toISOString().split("T")[0],vendor:D!==-1?se[D]:"",warranty:A!==-1?se[A]:"",maintenanceSchedule:R!==-1?se[R]:"",lastServiced:B!==-1?se[B]:"",nextDue:V!==-1?se[V]:"",serviceProvider:U!==-1?se[U]:"",assignedTo:F!==-1?se[F]:"",notes:q!==-1?se[q]:"Imported via CSV upload"}},Ge=h(Ze,z+1);X.push(...Ge),Ge.length===0&&W.push(Ze)}if(X.length>0){m({success:!1,message:`Validation failed for ${X.length} items`,importedCount:0,failedCount:X.length,errors:X});return}let ie=0,te=0;const We=[];for(let z=0;z<W.length;z++){try{const ue=W[z];if(ue&&ue.id&&ue.name)yield gs.addInventoryItem(ue),ie++;else throw new Error("Invalid item data")}catch(ue){te++,We.push(`Row ${z+2}: ${ue instanceof Error?ue.message:"Import failed"}`)}f((z+1)/W.length*100)}const Xe={success:te===0,message:te===0?`Successfully imported ${ie} items`:`Imported ${ie} items, ${te} failed`,importedCount:ie,failedCount:te,errors:We};m(Xe),d(te===0),te===0&&setTimeout(()=>{n(null),d(!1),m(null),f(0),t()},3e3)}catch(b){o(b instanceof Error?b.message:"Failed to upload CSV")}finally{i(!1)}}});return e.jsxs(je,{show:r,onHide:t,centered:!0,backdrop:"static",size:"lg",children:[e.jsx(je.Header,{closeButton:!0,className:"pb-2",children:e.jsxs(je.Title,{className:"text-lg",children:["Import ",g.charAt(0).toUpperCase()+g.slice(1)," CSV"]})}),e.jsxs(je.Body,{className:"py-3 pb-6",children:[e.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[e.jsx(C,{path:Es,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 1: Download Template"]})}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Get the CSV template with all required columns for ",g," ","data."]}),e.jsxs("button",{onClick:v,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center",children:[e.jsx(C,{path:Pt,size:.8,className:"mr-2"}),"Download Template"]})]})]}),e.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[e.jsx(C,{path:ws,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 2: Upload CSV"]})}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Upload your filled CSV file to import ",g," into the database."]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"csv-file-input",className:"block text-xs font-medium text-gray-700 mb-1",children:"Select CSV File"}),e.jsx("input",{id:"csv-file-input",type:"file",accept:".csv",onChange:j,className:"form-control py-1 px-2 text-sm"})]}),s&&e.jsxs("p",{className:"text-sm text-green-600 mb-2",children:["âœ“ Selected: ",s.name]}),c&&e.jsxs("p",{className:"text-sm text-red-600 mb-2",children:["âœ— ",c]}),l&&e.jsx("p",{className:"text-sm text-green-600 mb-2",children:"âœ“ Items uploaded successfully!"}),a&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[Math.round(x),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-[#4ECDC4] h-2 rounded-full transition-all duration-300",style:{width:`${x}%`}})})]}),p&&e.jsxs("div",{className:`p-3 rounded-lg border ${p.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(C,{path:p.success?Ce:ce,size:1,className:`mr-2 ${p.success?"text-green-600":"text-red-600"}`}),e.jsx("span",{className:`font-medium ${p.success?"text-green-800":"text-red-800"}`,children:p.message})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Imported: ",p.importedCount," items"]}),e.jsxs("p",{children:["Failed: ",p.failedCount," items"]})]}),p.errors.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Errors:"}),e.jsxs("div",{className:"max-h-20 overflow-y-auto text-xs text-red-600",children:[p.errors.slice(0,5).map((b,_)=>e.jsxs("div",{children:["â€¢ ",b]},_)),p.errors.length>5&&e.jsxs("div",{children:["... and ",p.errors.length-5," more errors"]})]})]})]})]})]})]}),e.jsxs(je.Footer,{className:"pt-2",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors duration-200",children:"Cancel"}),e.jsxs("button",{onClick:y,disabled:!s||a,className:"px-4 py-2 bg-[#4ECDC4] hover:bg-[#3db8b0] text-white rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[e.jsx(C,{path:ws,size:.8,className:"mr-2"}),a?"Importing...":`Import ${g.charAt(0).toUpperCase()+g.slice(1)}`]})]})]})},Xb=Object.freeze(Object.defineProperty({__proto__:null,default:Jb},Symbol.toStringTag,{value:"Module"})),Mr=()=>{const{currentUser:r,getUserDisplayName:t}=He(),{trackedItems:s,trackingData:n,toggleTrackedItem:a}=Ve(),{availableTools:i}=G(),[c,o]=u.useState([]),[l,d]=u.useState([]),[p,m]=u.useState([]),[x,f]=u.useState({totalTracked:0,highPriority:0,mediumPriority:0,lowPriority:0,pendingNotifications:0}),g=u.useCallback(()=>t()||(r==null?void 0:r.email)||"Unknown Doctor",[t,r]),v=u.useCallback(()=>{const k=g(),S=de.getTrackedToolsForDoctor(k);o(S)},[g]),j=u.useCallback(()=>{const k=g(),S=de.getPendingNotifications(k),I=de.getAllNotifications(k);d(S),m(I)},[g]),h=u.useCallback(()=>{const k=de.getTrackingStats();f(k)},[]),y=u.useCallback((k,S="medium",I)=>{const D=r?g():"Test Doctor";de.trackTool(k,D,S,I),a(k,D),v(),h()},[r,g,a,v,h]),b=u.useCallback(k=>{const S=r?g():"Test Doctor";de.untrackTool(k,S),a(k,S),v(),h()},[r,g,a,v,h]),_=u.useCallback(k=>{de.acknowledgeNotification(k),j(),h()},[j,h]),E=u.useCallback(()=>{de.clearExpiredNotifications(),j(),h()},[j,h]),$=u.useCallback(k=>de.getPriorityQueue(k),[]),P=u.useCallback(k=>de.isToolTracked(k),[]),w=u.useCallback(k=>de.getToolTrackers(k),[]),T=u.useCallback(k=>de.subscribeToStatusChanges(k),[]);return u.useEffect(()=>de.subscribeToStatusChanges((S,I,D)=>{if(D==="available"||D==="complete"){const O=g();de.getToolTrackers(S).find(B=>B.doctorName===O)&&b(S)}j(),h()}),[j,h,g,b]),u.useEffect(()=>{const S=setInterval(()=>{i.forEach(I=>{const D=I.currentPhase||I.status||"";de.isToolTracked(I.id)&&de.monitorToolStatusChange(I.id,"",D)})},5e3);return()=>clearInterval(S)},[i]),u.useEffect(()=>{(()=>{const S=g();de.getPendingNotifications(S).forEach(D=>{const O=i.find(A=>A.id===D.toolId);O&&D.toolName!==O.name&&(D.toolName=O.name,D.message=`Your tracked tool "${O.name}" is now available! You have first priority to claim it.`)})})()},[i,g]),!s||!n||!i?(console.warn("useTrackedTools: Missing required store data"),{trackedTools:c,pendingNotifications:l,allNotifications:p,trackingStats:x,trackTool:y,untrackTool:b,acknowledgeNotification:_,clearExpiredNotifications:E,getPriorityQueue:$,isToolTracked:P,getToolTrackers:w,subscribeToStatusChanges:T}):{trackedTools:c,pendingNotifications:l,allNotifications:p,trackingStats:x,trackTool:y,untrackTool:b,acknowledgeNotification:_,clearExpiredNotifications:E,getPriorityQueue:$,isToolTracked:P,getToolTrackers:w,subscribeToStatusChanges:T}},Ll=r=>{switch(r){case"high":return ut;case"medium":return ze;case"low":return Os;default:return ze}},ur=r=>{switch(r){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},zl=({isOpen:r,onClose:t,className:s=""})=>{const{getAllItems:n}=Ai(),{trackedTools:a,trackTool:i,untrackTool:c,getPriorityQueue:o}=Mr(),[l,d]=u.useState(""),[p,m]=u.useState("all"),[x,f]=u.useState("medium"),[g,v]=u.useState(null),h=n().filter(P=>{var w,T;return((w=P.data)==null?void 0:w.toolId)||((T=P.data)==null?void 0:T.supplyId)}).filter(P=>{const w=(P.name||"").toLowerCase().includes(l.toLowerCase())||(P.category||"").toLowerCase().includes(l.toLowerCase())||P.data&&typeof P.data=="object"&&"barcode"in P.data&&typeof P.data.barcode=="string"&&P.data.barcode||"".toLowerCase().includes(l.toLowerCase()),T=a.some(S=>S.toolId===P.id),k=P.status==="available"||P.status==="complete"||P.status==="clean";switch(p){case"tracked":return w&&T;case"available":return w&&k;case"unavailable":return w&&!k;default:return w}}),y=P=>a.some(w=>w.toolId===P),b=P=>a.find(w=>w.toolId===P),_=P=>{y(P)?c(P):i(P,x)},E=(P,w)=>{y(P)&&(c(P),i(P,w))},$=P=>{const w=P.toLowerCase();return["available","complete","clean"].includes(w)?"bg-green-100 text-green-800":["dirty","in_cycle","bath1","bath2","airDry","autoclave"].includes(w)?"bg-yellow-100 text-yellow-800":["failed","problem","maintenance"].includes(w)?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`bg-white rounded-xl shadow-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-hidden ${s}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Track Tools & Supplies"}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors","aria-label":"Close modal",children:e.jsx(le,{path:ae,size:1.5})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-3",children:"Select Priority Level"}),e.jsx("div",{className:"flex gap-3",children:["high","medium","low"].map(P=>e.jsxs("button",{onClick:()=>f(P),className:`flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-colors ${x===P?`${ur(P)} border-current`:"border-gray-300 text-gray-600 hover:border-gray-400"}`,children:[e.jsx(le,{path:Ll(P),size:1}),e.jsx("span",{className:"capitalize font-medium",children:P})]},P))}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[x==="high"&&"High priority: You will be notified immediately when the tool becomes available.",x==="medium"&&"Medium priority: You will be notified when the tool becomes available (default).",x==="low"&&"Low priority: You will be notified when the tool becomes available, but others may have higher priority."]})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search tools and supplies...",value:l,onChange:P=>d(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none"})}),e.jsx("div",{className:"flex gap-2",children:["all","tracked","available","unavailable"].map(P=>e.jsx("button",{onClick:()=>m(P),className:`px-4 py-2 rounded-lg border transition-colors capitalize ${p===P?"bg-blue-500 text-white border-blue-500":"border-gray-300 text-gray-600 hover:border-gray-400"}`,children:P},P))})]}),e.jsx("div",{className:"overflow-y-auto max-h-96",children:e.jsx("div",{className:"grid gap-4",children:h.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{path:kt,size:3,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No items found matching your criteria"})]}):h.map(P=>{const w=y(P.id),T=b(P.id),k=o(P.id);return e.jsx("div",{className:`p-4 border rounded-lg transition-colors ${w?"border-blue-300 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:P.name||""}),e.jsx("span",{className:"text-sm text-gray-500",children:P.category||""}),P.data&&typeof P.data=="object"&&"barcode"in P.data&&typeof P.data.barcode=="string"&&e.jsx("span",{className:"text-xs text-gray-400 font-mono",children:P.data.barcode})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${$(P.status||"")}`,children:P.status||""}),w&&T&&e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full flex items-center gap-1 ${ur(T.priority)}`,children:[e.jsx(le,{path:Ll(T.priority),size:.8}),T.priority]})]}),w&&k.length>1&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{onClick:()=>v(g===P.id?null:P.id),className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(le,{path:g===P.id?mi:kt,size:.8}),"Show priority queue (",k.length," ","waiting)"]}),g===P.id&&e.jsxs("div",{className:"mt-2 p-2 bg-white rounded border text-xs",children:[e.jsx("div",{className:"font-medium mb-1",children:"Priority Queue:"}),k.map((S,I)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:I===0?"font-medium text-green-600":"text-gray-600",children:[I+1,". ",S.doctorName]}),e.jsx("span",{className:`px-1 py-0.5 rounded text-xs ${ur(S.priority)}`,children:S.priority})]},`${S.doctorName}-${S.timestamp}`))]})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:w?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>_(P.id),className:"px-3 py-1 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded transition-colors",children:"Untrack"}),T&&e.jsxs("select",{value:T.priority,onChange:S=>E(P.id,S.target.value),className:"px-2 py-1 text-xs border rounded focus:outline-none",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}):e.jsxs("button",{onClick:()=>_(P.id),className:"px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(le,{path:Le,size:1}),"Track"]})})]})},P.id)})})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[a.length," item",a.length!==1?"s":""," ","currently tracked"]}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded-lg transition-colors",children:"Close"})]})]})}):null},Zb=Object.freeze(Object.defineProperty({__proto__:null,EnhancedTrackModal:zl,default:zl},Symbol.toStringTag,{value:"Module"})),Ki=Z.memo(({className:r=""})=>{const[t,s]=u.useState([]),[n,a]=u.useState([]),[i,c]=u.useState("all"),[o,l]=u.useState(!1);u.useEffect(()=>{const f=()=>{const v=Xt.getNotificationHistory();s(v),a(v)};f();const g=setInterval(f,5e3);return()=>clearInterval(g)},[]),u.useEffect(()=>{setTimeout(()=>{a(i==="all"?t:t.filter(f=>f.type===i))},0)},[t,i]);const d=f=>{switch(f){case"tool_available":return Ce;case"position_changed":case"queue_update":return ze;case"tool_unavailable":return ce;default:return ze}},p=f=>{switch(f){case"tool_available":return"text-green-500";case"position_changed":case"queue_update":return"text-blue-500";case"tool_unavailable":return"text-orange-500";default:return"text-gray-500"}},m=f=>{if(f.title.includes("ðŸ”¥"))return"bg-red-50 border-red-200";if(f.title.includes("âš¡"))return"bg-yellow-50 border-yellow-200";if(f.title.includes("ðŸ“‹"))return"bg-gray-50 border-gray-200";switch(f.type){case"tool_available":return"bg-green-50 border-green-200";case"position_changed":case"queue_update":return"bg-blue-50 border-blue-200";case"tool_unavailable":return"bg-orange-50 border-orange-200";default:return"bg-gray-50 border-gray-200"}},x=()=>{Xt.clearNotificationHistory(),s([]),a([])};return o?e.jsxs("div",{className:`fixed bottom-4 right-4 w-96 max-h-96 bg-white rounded-lg shadow-xl border ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(C,{path:Xr,size:1.2,className:"mr-2 text-blue-500"}),"Notification History"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:x,className:"text-sm text-gray-500 hover:text-gray-700",title:"Clear history",children:"Clear"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{path:gc,size:1,className:"text-gray-500"}),e.jsxs("select",{value:i,onChange:f=>c(f.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"tool_available",children:"Tool Available"}),e.jsx("option",{value:"position_changed",children:"Position Changed"}),e.jsx("option",{value:"queue_update",children:"Queue Update"}),e.jsx("option",{value:"tool_unavailable",children:"Tool Unavailable"})]})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:n.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(C,{path:Os,size:2,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No notifications in history"})]}):e.jsx("div",{className:"p-2 space-y-2",children:n.map(f=>e.jsx("div",{className:`${m(f)} border rounded-lg p-3 text-sm`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(C,{path:d(f.type),size:1,className:`${p(f.type)} mr-2 mt-0.5`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:f.title}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:f.message}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:new Date(f.timestamp).toLocaleString()}),e.jsx("span",{className:"text-xs text-gray-500",children:f.toolName})]})]})]})},f.id))})})]}):e.jsxs("button",{onClick:()=>l(!0),className:`font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1 min-w-fit whitespace-nowrap bg-white hover:bg-gray-50 text-gray-700 ${r}`,title:"View notification history",children:[e.jsx(C,{path:Xr,size:1,className:"mr-2","aria-hidden":"true"}),"History",t.length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:t.length})]})});Ki.displayName="NotificationHistory";const Qi=Z.memo(({filters:r,showFilters:t,setShowFilters:s,onToggleTrackedFilter:n})=>{const a=u.useRef(null),i=u.useRef(null),c=(o,l)=>{var d,p;switch(o.key){case"ArrowRight":o.preventDefault(),l==="filter"&&n&&((d=i.current)==null||d.focus());break;case"ArrowLeft":o.preventDefault(),l==="tracked"&&n&&((p=a.current)==null||p.focus());break;case"Enter":case" ":{o.preventDefault(),l==="filter"?s(!t):l==="tracked"&&n&&n();break}case"Escape":{o.preventDefault(),t&&s(!1);const m=o.currentTarget.closest('[role="toolbar"]');m&&m.focus();break}}};return u.useEffect(()=>{if(t){const o=document.querySelector("#expanded-filters-panel input");o&&o.focus()}},[t]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2 overflow-x-hidden",role:"toolbar","aria-label":"Inventory filtering controls",tabIndex:-1,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(xr,{ref:a,variant:"outline-secondary",className:"font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",onClick:()=>s(!t),onKeyDown:o=>c(o,"filter"),"aria-expanded":t,"aria-controls":"expanded-filters-panel","aria-label":`${t?"Hide":"Show"} advanced filters`,tabIndex:0,children:[e.jsx(C,{path:$r,size:1,className:"mr-2","aria-hidden":"true"}),"Filters"]}),n&&e.jsxs(xr,{ref:i,variant:"outline-secondary",className:`font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1 min-w-fit whitespace-nowrap ${r.showTrackedOnly?"bg-[#4ECDC4] text-white border-[#4ECDC4]":""}`,onClick:n,onKeyDown:o=>c(o,"tracked"),"aria-pressed":r.showTrackedOnly,"aria-label":`${r.showTrackedOnly?"Hide":"Show"} tracked items only`,tabIndex:0,children:[e.jsx(C,{path:kt,size:1,className:"mr-2","aria-hidden":"true"}),"Tracked Only"]}),e.jsx(Ki,{})]})})})});Qi.displayName="InventoryFilters";const ey=({activeTab:r,filters:t,setCategoryFilter:s,setLocationFilter:n,setSearchQuery:a,onToggleFavoritesFilter:i})=>{const{mergeMode:c,setMergeMode:o,selectedItems:l,clearSelectedItems:d}=Ve(),{getActiveRooms:p}=Bs(),m=p(),x=()=>{c?(d(),o(!1)):o(!0)},f=()=>{if(l.length<2){alert("Please select at least 2 items to merge");return}console.log("Merging items:",Array.from(l))};return e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"search-input",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Search"}),e.jsx("input",{id:"search-input",type:"text",placeholder:"Search inventory...",className:"form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.searchQuery||"",onChange:g=>a(g.target.value)})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"location-search-input",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Filter by Location"}),e.jsx("input",{id:"location-search-input",type:"text",placeholder:"Filter by location...",className:"form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.location||"",onChange:g=>n(g.target.value)})]}),r==="tools"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Tools",children:"Tools"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tools-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"tools-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:Jt,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tools-merge-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Actions"}),c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[l.length," selected"]}),e.jsx("button",{onClick:f,disabled:l.length<2,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm disabled:bg-gray-300",children:"Merge Selected"}),e.jsx("button",{onClick:x,className:"px-3 py-1 bg-gray-500 text-white rounded text-sm",children:"Cancel"})]}):e.jsxs("button",{id:"tools-merge-filter-btn",onClick:x,className:"flex items-center gap-2 px-3 py-2 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors",children:[e.jsx(C,{path:fc,size:.8}),e.jsx("span",{className:"text-sm",children:"Merge Duplicates"})]})]})]}),r==="supplies"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supply-category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"supply-category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Supplies",children:"Supplies"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supply-location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"supply-location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"supplies-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"supplies-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:Jt,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]})]}),r==="equipment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"equipment-category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"equipment-category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Equipment",children:"Equipment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"equipment-location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"equipment-location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"equipment-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"equipment-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:Jt,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]})]}),r==="officeHardware"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hardware-category-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Category"}),e.jsxs("select",{id:"hardware-category-select",className:"form-select",value:t.category||"",onChange:g=>s(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Office Hardware",children:"Office Hardware"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hardware-location-select",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Location"}),e.jsxs("select",{id:"hardware-location-select",className:"form-select",value:t.location||"",onChange:g=>n(g.target.value),children:[e.jsx("option",{value:"",children:"All"}),m.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hardware-favorites-filter-btn",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Quick Filter"}),e.jsxs("button",{id:"hardware-favorites-filter-btn",onClick:i,className:`flex items-center gap-2 px-3 py-2 rounded-md border transition-colors ${t.showFavoritesOnly?"bg-yellow-500 text-white border-yellow-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(C,{path:Jt,size:.8}),e.jsx("span",{className:"text-sm",children:"Favorites"})]})]})]})]})},ty="_tableContainer_18z7q_2",sy="_table_18z7q_2",ry="_tableHeader_18z7q_26",ay="_tableHeaderCell_18z7q_34",ny="_tableCell_18z7q_45",ly="_tableRow_18z7q_90",iy="_selectedRow_18z7q_104",oy="_actionGroup_18z7q_124",cy="_actionButton_18z7q_133",dy="_editButton_18z7q_166",uy="_deleteButton_18z7q_177",my="_trackButton_18z7q_188",py="_tracked_18z7q_203",xy="_virtualizedList_18z7q_240",hy="_virtualizedOverlay_18z7q_249",gy="_virtualizedBody_18z7q_262",fy="_virtualizedRow_18z7q_268",K={tableContainer:ty,table:sy,tableHeader:ry,tableHeaderCell:ay,tableCell:ny,tableRow:ly,selectedRow:iy,actionGroup:oy,actionButton:cy,editButton:dy,deleteButton:uy,trackButton:my,tracked:py,virtualizedList:xy,virtualizedOverlay:hy,virtualizedBody:gy,virtualizedRow:fy},by="_tooltipContainer_7fsb9_2",yy="_tooltipContent_7fsb9_7",vy="_tooltipArrow_7fsb9_35",mr={tooltipContainer:by,tooltipContent:yy,tooltipArrow:vy},Lr=Z.memo(u.forwardRef(({item:r,activeTab:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,isTracked:c=!1},o)=>{const{favorites:l,toggleFavorite:d,openDeleteModal:p}=Ve(),{getToolTrackers:m}=Mr(),x=l.includes(r.id),f=m(r.id),g=f.length,j=f.some(S=>S.doctorName==="Current Doctor")?f.findIndex(S=>S.doctorName==="Current Doctor")+1:0,h=S=>{s(S)},y=u.useRef(null),b=u.useRef(null),_=u.useRef(null),E=u.useRef(null);u.useImperativeHandle(o,()=>({focusEdit:()=>{var S;return(S=y.current)==null?void 0:S.focus()},focusFavorite:()=>{var S;return(S=b.current)==null?void 0:S.focus()},focusTrack:()=>{var S;return(S=_.current)==null?void 0:S.focus()},focusDelete:()=>{var S;return(S=E.current)==null?void 0:S.focus()}}));const $=(S,I)=>{if(S.key==="Enter"||S.key===" ")switch(S.preventDefault(),I){case"edit":s(r);break;case"favorite":d(r.id);break;case"track":i==null||i(r);break;case"delete":T();break}},P=()=>{i==null||i(r)},w=()=>{a?a(r.id):d(r.id)},T=()=>{p(r)},k=c?`Stop tracking (You are ${j}/${g} in queue)`:`Start tracking (${g} in queue)`;return e.jsx("td",{className:K.tableCell,children:e.jsxs("div",{className:K.actionGroup,children:[e.jsxs("button",{ref:y,onClick:()=>h(r),onKeyDown:S=>$(S,"edit"),className:`${K.actionButton} ${K.editButton} text-xs px-2 py-0.5 flex items-center`,"aria-label":`Edit ${r.name||"item"}`,tabIndex:0,children:[e.jsx("svg",{className:"inline-block mr-1",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16","aria-hidden":"true",children:e.jsx("path",{d:"M15.502 1.94a1.5 1.5 0 0 1 0 2.12l-1.439 1.439-2.12-2.12 1.439-1.439a1.5 1.5 0 0 1 2.12 0zm-2.561 2.561-9.193 9.193a.5.5 0 0 0-.121.196l-1 3a.5.5 0 0 0 .633.633l3-1a.5.5 0 0 0 .196-.12l9.193-9.194-2.12-2.12z"})}),"Edit"]}),t==="tools"&&e.jsx("button",{ref:b,onClick:w,onKeyDown:S=>$(S,"favorite"),className:`${K.actionButton} ${x?"!text-yellow-500 !bg-yellow-50 !border-yellow-200 hover:!text-yellow-600":"text-gray-400 hover:text-yellow-500 hover:bg-yellow-50"} transition-colors duration-200`,"aria-label":`${x?"Remove from":"Add to"} favorites`,"aria-pressed":x,tabIndex:0,children:e.jsx(C,{path:Jt,size:.8,className:x?"fill-current":"","aria-hidden":"true"})}),(t==="tools"||t==="supplies")&&e.jsxs("div",{className:mr.tooltipContainer,children:[e.jsxs("button",{ref:_,onClick:P,onKeyDown:S=>$(S,"track"),className:`${K.actionButton} ${K.trackButton} ${c?K.tracked:""} relative`,"aria-label":k,"aria-pressed":c,tabIndex:0,children:[e.jsx(C,{path:kt,size:1.2,"aria-hidden":"true"}),g>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:g})]}),e.jsxs("div",{className:mr.tooltipContent,children:[k,e.jsx("div",{className:mr.tooltipArrow})]})]}),e.jsxs("button",{ref:E,onClick:T,onKeyDown:S=>$(S,"delete"),className:`${K.actionButton} ${K.deleteButton} text-xs px-2 py-0.5 flex items-center`,"aria-label":`Delete ${r.name||"item"}`,tabIndex:0,children:[e.jsxs("svg",{className:"inline-block mr-1",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16","aria-hidden":"true",children:[e.jsx("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"}),e.jsx("path",{fillRule:"evenodd",d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"})]}),"Delete"]})]})})}));Lr.displayName="TableActions";const Yi=Z.memo(({item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})=>{const{mergeMode:o,selectedItems:l,toggleItemSelection:d}=Ve(),p=()=>{o&&d(r.id)},m=l.includes(r.id),x=u.useMemo(()=>{var f;const g=e.jsxs("td",{className:K.tableCell,children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),r.data&&typeof r.data=="object"&&"description"in r.data&&typeof r.data.description=="string"&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:r.data.description})]},"name"),v=e.jsx("td",{className:K.tableCell,children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:r.category})},"category"),j=e.jsx("td",{className:K.tableCell,children:e.jsx("span",{className:`font-medium ${(r.quantity||0)<10?"text-red-600":"text-gray-900"}`,children:r.quantity||0})},"quantity"),h=e.jsxs("td",{className:K.tableCell,children:["$",(r.unit_cost||0).toFixed(2)]},"price"),y=[g];if(c!=="tools"&&y.push(v),c==="supplies")y.push(e.jsx("td",{className:K.tableCell,children:r.location||"N/A"},"location"));else if(c==="tools"){const _=r.status||"N/A",E=r.data&&typeof r.data=="object"&&"p2Status"in r.data&&typeof r.data.p2Status=="string"?r.data.p2Status==="P2":r.p2_status==="P2"||!1;y.push(e.jsx("td",{className:K.tableCell,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_==="active"?"bg-green-100 text-green-800":_==="inactive"?"bg-red-100 text-red-800":_==="p2"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:_.toUpperCase()}),E&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"P2"})]})},"status"))}c!=="tools"&&y.push(j),y.push(h);const b=e.jsx("td",{className:K.tableCell,children:(f=r.scanned_location)!=null?f:e.jsx("span",{className:"text-gray-400",children:"Unassigned"})},"location");return y.push(b),y},[r,c]);return e.jsxs("tr",{className:`${K.tableRow} ${m?K.selectedRow:""}`,tabIndex:0,onClick:p,style:{cursor:o?"pointer":"default"},children:[x,e.jsx(Lr,{item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})]})});Yi.displayName="TableRow";const zr=Z.memo(({columns:r,activeTab:t})=>e.jsx("thead",{className:K.tableHeader,children:e.jsxs("tr",{children:[r.map(s=>t==="tools"&&(s==="category"||s==="quantity")?null:e.jsx("th",{className:`${K.tableHeaderCell} text-gray-500 inventory-table-header`,scope:"col","aria-label":s.toLowerCase(),style:{color:"#6b7280"},children:s},s)),e.jsx("th",{className:`${K.tableHeaderCell} text-gray-500 inventory-table-header`,scope:"col","aria-label":"Item actions",style:{color:"#6b7280"},children:"Actions"})]})}));zr.displayName="TableHeader";const Pr=Z.memo(({currentPage:r,totalPages:t,onPageChange:s})=>e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-4",role:"navigation","aria-label":"Table pagination",children:[e.jsx("button",{onClick:()=>s(Math.max(1,r-1)),disabled:r===1,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to previous page","aria-disabled":r===1,tabIndex:0,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700","aria-label":`Page ${r} of ${t}`,children:["Page ",r," of ",t]}),e.jsx("button",{onClick:()=>s(Math.min(t,r+1)),disabled:r===t,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to next page","aria-disabled":r===t,tabIndex:0,children:"Next"})]}));Pr.displayName="TablePagination";const Ji=Z.memo(({item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})=>{const o=u.useMemo(()=>{const l=e.jsxs("div",{className:K.tableCell,children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.name}),r.data&&typeof r.data=="object"&&"description"in r.data&&typeof r.data.description=="string"&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:r.data.description})]},"name"),d=e.jsx("div",{className:K.tableCell,children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:r.category})},"category"),p=e.jsx("td",{className:K.tableCell,children:e.jsx("span",{className:`font-medium ${(r.quantity||0)<10?"text-red-600":"text-gray-900"}`,children:r.quantity||0})},"quantity"),m=e.jsxs("td",{className:K.tableCell,children:["$",(r.unit_cost||0).toFixed(2)]},"price"),x=[l];return c!=="tools"&&x.push(d),c==="supplies"?x.push(e.jsx("div",{className:K.tableCell,children:r.location||"N/A"},"location")):c==="tools"&&x.push(e.jsx("div",{className:K.tableCell,children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.status==="active"?"bg-green-100 text-green-800":r.status==="inactive"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status})},"status")),x.push(p,m),x},[r,c]);return e.jsxs("div",{className:`${K.tableRow} ${K.virtualizedRow}`,children:[o,e.jsx("div",{className:K.tableCell,children:e.jsx(Lr,{item:r,onEdit:t,onDelete:s,onToggleFavorite:n,onTrackToggle:a,isTracked:i,activeTab:c})})]})});Ji.displayName="VirtualizedTableRow";const Xi=Z.memo(({data:r,columns:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,isTracked:c,activeTab:o,itemHeight:l=80,maxHeight:d=600})=>{const p=u.useCallback(({index:x,style:f})=>{const g=r[x];return g?e.jsx("div",{style:f,children:e.jsx(Ji,{item:g,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,isTracked:c?c(g.id):!1,activeTab:o})}):null},[r,s,n,a,i,c,o]),m=u.useMemo(()=>e.jsx(_o,{height:Math.min(d,r.length*l),itemCount:r.length,itemSize:l,width:"100%",className:K.virtualizedList,children:p}),[r.length,l,d,p]);return e.jsx("div",{className:K.tableContainer,children:e.jsxs("div",{className:K.tableWrapper,children:[e.jsxs("table",{className:K.table,role:"table","aria-label":"Inventory items table",children:[e.jsx(zr,{columns:t,activeTab:o}),e.jsx("tbody",{className:K.virtualizedBody})]}),e.jsx("div",{className:K.virtualizedOverlay,children:m})]})})});Xi.displayName="VirtualizedInventoryTable";const Zi=Z.memo(({data:r,columns:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:i,showTrackedOnly:c=!1,showFavoritesOnly:o=!1,itemsPerPage:l=3,currentPage:d=1,onPageChange:p,activeTab:m})=>{const x=r.length>100,{favorites:f}=Ve(),{trackTool:g,untrackTool:v,isToolTracked:j}=Mr(),{totalPages:h,paginatedData:y}=u.useMemo(()=>{let E=r;c&&(E=E.filter(k=>j(k.id))),o&&(E=E.filter(k=>f.includes(k.id)));const $=Math.max(1,Math.ceil(E.length/l)),P=(d-1)*l,w=P+l,T=E.slice(P,w);return{totalPages:$,paginatedData:T}},[r,c,o,f,j,l,d]),b=u.useCallback(E=>{j(E.id)?v(E.id):g(E.id,"medium",E.name),i&&i(E)},[j,v,g,i]),_=u.useCallback(E=>j(E),[j]);return x?e.jsxs("div",{className:`${K.tableContainer} inventory-table`,children:[e.jsx(Xi,{data:y,columns:t,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:b,isTracked:_,activeTab:m,itemHeight:80,maxHeight:600}),p&&e.jsx(Pr,{currentPage:d,totalPages:h,onPageChange:p})]}):e.jsxs("div",{className:`${K.tableContainer} inventory-table`,children:[e.jsx("div",{className:K.tableWrapper,children:e.jsxs("table",{className:K.table,role:"table","aria-label":"Inventory items table",children:[e.jsx(zr,{columns:t,activeTab:m}),e.jsx("tbody",{children:y.map(E=>e.jsx(Yi,{item:E,onEdit:s,onDelete:n,onToggleFavorite:a,onTrackToggle:b,isTracked:_(E.id),activeTab:m},E.id))})]})}),p&&e.jsx(Pr,{currentPage:d,totalPages:h,onPageChange:p})]})});Zi.displayName="BaseInventoryTable";const jy=r=>r==="tools"||r==="supplies",wy=r=>jy(r),Ny=r=>{const t=["Name","Category","Quantity","Price"];switch(r){case"supplies":return["Name","Category","Location","Quantity","Price"];case"tools":return["Name","Status","Price","Location"];case"equipment":case"officeHardware":default:return[...t,"Location"]}},eo=Z.memo(({activeTab:r,filteredData:t,filteredSuppliesData:s,filteredEquipmentData:n,filteredOfficeHardwareData:a,handleEditClick:i,handleDeleteItem:c,handleToggleFavorite:o,onTrackToggle:l,showTrackedOnly:d=!1,showFavoritesOnly:p=!1,itemsPerPage:m})=>{const x=u.useMemo(()=>{switch(r){case"tools":return t;case"supplies":return s;case"equipment":return n;case"officeHardware":return a;default:return t}},[r,t,s,n,a]),f=u.useMemo(()=>Ny(r),[r]);return e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Zi,{data:x,columns:f,onEdit:i,onDelete:c,onToggleFavorite:o,onTrackToggle:l,showTrackedOnly:d,showFavoritesOnly:p,itemsPerPage:m,currentPage:1,onPageChange:()=>{},activeTab:r})})});eo.displayName="InventoryTables";class Cy extends Z.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("Table Error Boundary caught an error:",t,s)}render(){if(this.state.hasError){const t=this.props.fallback;return t?e.jsx(t,{error:this.state.error}):e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Table Error"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:"Something went wrong with the table display. Please refresh the page."}),this.state.error&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-red-600 text-sm cursor-pointer",children:"Error Details"}),e.jsx("pre",{className:"text-xs text-red-500 mt-1 overflow-auto",children:this.state.error.message})]})]})}return this.props.children}}var Sy=Object.defineProperty,Ul=Object.getOwnPropertySymbols,_y=Object.prototype.hasOwnProperty,Ty=Object.prototype.propertyIsEnumerable,ql=(r,t,s)=>t in r?Sy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,pr=(r,t)=>{for(var s in t||(t={}))_y.call(t,s)&&ql(r,s,t[s]);if(Ul)for(var s of Ul(t))Ty.call(t,s)&&ql(r,s,t[s]);return r};const to=Z.memo(({onEdit:r,onDelete:t,onClone:s,items:n})=>{const{activeTab:a,showFilters:i,setShowFilters:c,searchQuery:o,setSearchQuery:l,categoryFilter:d,setCategoryFilter:p,locationFilter:m,setLocationFilter:x,showTrackedOnly:f,setShowTrackedOnly:g,showFavoritesOnly:v,setShowFavoritesOnly:j,itemsPerPage:h,favorites:y,toggleFavorite:b,openAddModal:_}=Ve(),{tools:E,supplies:$,equipment:P,officeHardware:w}=Ai(),T=Z.useMemo(()=>({searchQuery:o,category:d,location:m,showTrackedOnly:f,showFavoritesOnly:v}),[o,d,m,f,v]),k=Z.useMemo(()=>({filters:T,showFilters:i,setShowFilters:c,setSearchQuery:l,onToggleTrackedFilter:()=>{wy(a)&&g(!f)}}),[T,i,c,l,a,f,g]),S=Z.useMemo(()=>({activeTab:a,filters:{searchQuery:o,category:d,location:m,showFavoritesOnly:v},setCategoryFilter:p,setLocationFilter:x,setSearchQuery:l,onToggleFavoritesFilter:()=>{j(!v)}}),[a,o,d,m,v,p,x,l,j]),I=Z.useMemo(()=>{const A={search:o,category:d,location:m},R=ls.applyFilters(E,A),B=ls.applyFilters($,A),V=ls.applyFilters(P,A),U=ls.applyFilters(w,A);return{activeTab:a,filteredData:R,filteredSuppliesData:B,filteredEquipmentData:V,filteredOfficeHardwareData:U,handleEditClick:r,handleDeleteItem:t,handleCloneItem:s,handleToggleFavorite:b,showTrackedOnly:f,showFavoritesOnly:v,itemsPerPage:h,favorites:y}},[a,E,$,P,w,o,d,m,r,t,s,b,f,v,h,y]),D=()=>{switch(a){case"tools":return"Tools Table";case"supplies":return"Supplies Table";case"equipment":return"Equipment Table";case"officeHardware":return"Office Hardware Table";default:return"Inventory Table"}},O=()=>{switch(a){case"tools":return"Manage your tools inventory items";case"supplies":return"Manage your supplies inventory items";case"equipment":return"Manage your equipment inventory items";case"officeHardware":return"Manage your office hardware inventory items";default:return"Manage your inventory items"}};return e.jsxs("div",{role:"region","aria-label":`${a} inventory table section`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:D()}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:O()})]}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-[#4ECDC4] hover:bg-[#3db8b0] text-white rounded-lg font-medium flex items-center gap-2 transition-colors duration-200 shadow-sm hover:shadow-md","aria-label":"Add new item to inventory",children:[e.jsx(C,{path:Ue,size:1}),"Add Item"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Qi,pr({},k))}),i&&e.jsx("div",{id:"expanded-filters-panel",children:e.jsx(ey,pr({},S))}),e.jsx(Cy,{children:e.jsx(eo,pr({},I))})]})});to.displayName="InventoryTableSection";const Jv=Object.freeze(Object.defineProperty({__proto__:null,default:to},Symbol.toStringTag,{value:"Module"})),Nt={tools:{icon:"#9333ea",bgColor:"bg-purple-100"},value:{icon:"#16a34a",bgColor:"bg-green-100"},maintenance:{icon:"#ea580c",bgColor:"bg-orange-100"}},ky=({data:r})=>{var t,s,n,a;const{tools:i,supplies:c,equipment:o,officeHardware:l}=r||{},d=(t=i==null?void 0:i.length)!=null?t:0,p=(s=c==null?void 0:c.length)!=null?s:0,m=(n=o==null?void 0:o.length)!=null?n:0,x=(a=l==null?void 0:l.length)!=null?a:0,f=d+p+m+x;if(u.useEffect(()=>{r&&console.log("ðŸ“Š InventoryInsightsCard received data:",r)},[r]),u.useEffect(()=>{r&&f!==d+p+m+x&&console.error("ðŸš¨ Count mismatch detected!",{totalItemsCount:f,sumOfCategories:d+p+m+x,difference:f-(d+p+m+x)})},[f,d,p,m,x,r]),!r||!r.tools||!r.supplies||!r.equipment||!r.officeHardware)return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"No inventory data available"})});const g=(r.tools.reduce((b,_)=>b+(_.unit_cost||0),0)||0)+(r.supplies.reduce((b,_)=>b+(_.unit_cost||0)*(_.quantity||1),0)||0)+(r.equipment.reduce((b,_)=>b+(_.unit_cost||0),0)||0)+(r.officeHardware.reduce((b,_)=>b+(_.unit_cost||0),0)||0),v=r.equipment.filter(b=>{var _,E;if("status"in b&&b.status==="Maintenance")return!0;if("lastServiced"in b&&((_=b.data)!=null&&_.lastServiced)){const $=new Date(b.data.lastServiced),P=new Date;return P.setMonth(P.getMonth()-6),$<P}if("warranty"in b&&((E=b.data)!=null&&E.warranty)){const $=new Date(b.data.warranty),P=new Date;return P.setDate(P.getDate()+30),$<=P&&$>new Date}return!1}).length,j=f>0?Math.min(f/50*100,100):0,h=g>0?Math.min(g/1e4*100,100):0,y=v>0?Math.min(v/10*100,100):0;return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-3",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Inventory insights and statistics",children:[e.jsxs("h3",{className:"text-base font-semibold mb-3 flex items-center text-[#5b5b5b]",children:[e.jsx(C,{path:Zr,size:1.1,color:"#4ECDC4",className:"mr-2","aria-hidden":"true"}),"Inventory Insights"]}),e.jsxs("div",{className:"space-y-3",role:"list","aria-label":"Inventory metrics",children:[e.jsxs("div",{role:"listitem",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1 group relative",children:[e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx("div",{className:`${Nt.tools.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:Zr,size:.8,color:Nt.tools.icon,"aria-hidden":"true"})}),"Total Items"]}),e.jsxs("span",{className:"font-semibold cursor-help",title:`Tools: ${d} â€¢ Supplies: ${p} â€¢ Equipment: ${m} â€¢ Office Hardware: ${x}`,"aria-label":`Total items: ${f}. Full breakdown: ${d} tools, ${p} supplies, ${m} equipment, ${x} office hardware`,children:[f,f!==d+p+m+x&&e.jsx("span",{className:"text-xs text-red-500 ml-1",children:"âš ï¸"})]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-md shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["Tools: ",d," â€¢ Supplies: ",p," â€¢ Equipment:"," ",m," â€¢ Office Hardware: ",x,e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":j,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Total items progress: ${j}%`,children:e.jsx("div",{className:"bg-purple-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${j}%`}})})]}),e.jsxs("div",{role:"listitem",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1 group relative",children:[e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx("div",{className:`${Nt.value.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:bc,size:.8,color:Nt.value.icon,"aria-hidden":"true"})}),"Total Value"]}),e.jsxs("span",{className:"font-semibold cursor-help",title:"Cumulative value of all inventory items","aria-label":`Total inventory value: $${g.toLocaleString()}`,children:["$",g.toLocaleString()]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-md shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["Cumulative value of all inventory items",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":h,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Total value progress: ${h}%`,children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${h}%`}})})]}),e.jsxs("div",{role:"listitem",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1 group relative",children:[e.jsxs("span",{className:"flex items-center text-gray-600",children:[e.jsx("div",{className:`${Nt.maintenance.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:Ar,size:.8,color:Nt.maintenance.icon,"aria-hidden":"true"})}),"Maintenance Due (30 days)"]}),e.jsx("span",{className:"font-semibold cursor-help",title:"Equipment due for maintenance or with expiring warranty in next 30 days","aria-label":`Items requiring maintenance in next 30 days: ${v}`,children:v}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-md shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["Equipment due for maintenance or with expiring warranty in next 30 days",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",role:"progressbar","aria-valuenow":y,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Maintenance due progress: ${y}%`,children:e.jsx("div",{className:"bg-orange-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${y}%`}})})]})]})]})},Xv=Object.freeze(Object.defineProperty({__proto__:null,default:ky},Symbol.toStringTag,{value:"Module"}));var Iy=Object.defineProperty,Py=Object.defineProperties,Dy=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,Ey=Object.prototype.hasOwnProperty,Oy=Object.prototype.propertyIsEnumerable,Vl=(r,t,s)=>t in r?Iy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,$y=(r,t)=>{for(var s in t||(t={}))Ey.call(t,s)&&Vl(r,s,t[s]);if(Hl)for(var s of Hl(t))Oy.call(t,s)&&Vl(r,s,t[s]);return r},Ay=(r,t)=>Py(r,Dy(t));const Ry={tools:{icon:"#9333ea",bgColor:"bg-purple-100",textColor:"text-purple-600",selectedBgColor:"bg-purple-50"},supplies:{icon:"#16a34a",bgColor:"bg-green-100",textColor:"text-green-600",selectedBgColor:"bg-green-50"},equipment:{icon:"#ea580c",bgColor:"bg-orange-100",textColor:"text-orange-600",selectedBgColor:"bg-orange-50"},officeHardware:{icon:"#3b82f6",bgColor:"bg-blue-100",textColor:"text-blue-600",selectedBgColor:"bg-blue-50"}},By=({onCategoryChange:r,counts:t})=>{const[s,n]=u.useState([{label:"Tools",icon:yc,selected:!0,tabId:"tools"},{label:"Supplies",icon:$s,selected:!1,tabId:"supplies"},{label:"Equipment",icon:vc,selected:!1,tabId:"equipment"},{label:"Office Hardware",icon:jc,selected:!1,tabId:"officeHardware"}]),a=u.useRef([]),i=(o,l)=>{n(s.map(d=>Ay($y({},d),{selected:d.label===o}))),r(l)},c=(o,l)=>{var d,p,m,x;switch(o.key){case"ArrowDown":{o.preventDefault();const f=(l+1)%s.length;(d=a.current[f])==null||d.focus();break}case"ArrowUp":{o.preventDefault();const f=l===0?s.length-1:l-1;(p=a.current[f])==null||p.focus();break}case"Home":{o.preventDefault(),(m=a.current[0])==null||m.focus();break}case"End":{o.preventDefault(),(x=a.current[s.length-1])==null||x.focus();break}case"Enter":case" ":{o.preventDefault();const f=s[l];i(f.label,f.tabId);break}}};return u.useEffect(()=>{var o;const l=s.findIndex(d=>d.selected);l!==-1&&((o=a.current[l])==null||o.focus())},[s]),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-3",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Inventory category selection",children:[e.jsxs("h3",{className:"text-base font-semibold mb-3 flex items-center text-[#5b5b5b]",children:[e.jsx(C,{path:wc,size:1.1,color:"#4ECDC4",className:"mr-2","aria-hidden":"true"}),"Categories"]}),e.jsx("div",{className:"space-y-2",role:"tablist","aria-label":"Inventory categories",children:s.map((o,l)=>{const d=Ry[o.tabId];return e.jsxs("button",{ref:p=>a.current[l]=p,onClick:()=>i(o.label,o.tabId),onKeyDown:p=>c(p,l),className:`w-full px-3 py-1.5 rounded-lg text-left flex items-center text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1 ${o.selected?`${d.selectedBgColor} ${d.textColor}`:"text-gray-600 hover:bg-gray-100"}`,tabIndex:0,role:"tab","aria-selected":o.selected,"aria-label":`${o.label} category${o.selected?" (currently selected)":""}`,children:[e.jsx("div",{className:`${d.bgColor} rounded-full p-1 mr-2`,children:e.jsx(C,{path:o.icon,size:.9,color:d.icon,"aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1 flex justify-between items-center",children:[e.jsx("span",{children:o.label}),t&&e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${o.selected?"bg-white bg-opacity-30":"bg-gray-200 text-gray-600"}`,children:t[o.tabId]||0})]})]},o.label)})})]})},Zv=Object.freeze(Object.defineProperty({__proto__:null,default:By},Symbol.toStringTag,{value:"Module"}));var Fy=Object.defineProperty,My=Object.defineProperties,Ly=Object.getOwnPropertyDescriptors,Wl=Object.getOwnPropertySymbols,zy=Object.prototype.hasOwnProperty,Uy=Object.prototype.propertyIsEnumerable,Gl=(r,t,s)=>t in r?Fy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ie=(r,t)=>{for(var s in t||(t={}))zy.call(t,s)&&Gl(r,s,t[s]);if(Wl)for(var s of Wl(t))Uy.call(t,s)&&Gl(r,s,t[s]);return r},Pe=(r,t)=>My(r,Ly(t));const qy=()=>{const[r,t]=u.useState([]),[s,n]=u.useState(!1),[a,i]=u.useState("medium"),[c,o]=u.useState("ui"),[l,d]=u.useState({title:"",description:"",steps:[""],expected:"",actual:"",environment:navigator.userAgent,reporter:"User"}),p=u.useCallback(h=>{const y=Pe(Ie({},h),{id:`bug-${Date.now()}-${Math.random()}`,timestamp:new Date,status:"open"});t(b=>[y,...b]),n(!1),d({title:"",description:"",steps:[""],expected:"",actual:"",environment:navigator.userAgent,reporter:"User"})},[]),m=u.useCallback((h,y)=>{t(b=>b.map(_=>_.id===h?Pe(Ie({},_),{status:y}):_))},[]),x=u.useCallback(()=>{const h=JSON.stringify(r,null,2),y=new Blob([h],{type:"application/json"}),b=URL.createObjectURL(y),_=document.createElement("a");_.href=b,_.download=`bug-reports-${new Date().toISOString().split("T")[0]}.json`,_.click(),URL.revokeObjectURL(b)},[r]),f=u.useCallback(h=>{if(h.preventDefault(),!l.title||!l.description){alert("Please fill in all required fields");return}p({title:l.title,description:l.description,severity:a,category:c,steps:l.steps.filter(y=>y.trim()),expected:l.expected,actual:l.actual,environment:l.environment,reporter:l.reporter,attachments:[]})},[l,a,c,p]),g=u.useCallback(()=>{d(h=>Pe(Ie({},h),{steps:[...h.steps,""]}))},[]),v=u.useCallback(h=>{d(y=>Pe(Ie({},y),{steps:y.steps.filter((b,_)=>_!==h)}))},[]),j=u.useCallback((h,y)=>{d(b=>Pe(Ie({},b),{steps:b.steps.map((_,E)=>E===h?y:_)}))},[]);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Bug Tracker"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:[e.jsx(C,{path:ea,size:1}),"Report Bug"]}),e.jsxs("button",{onClick:x,disabled:r.length===0,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(C,{path:Es,size:1}),"Export"]})]})]}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900",children:"Report New Bug"}),e.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{path:ae,size:1})})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Bug Title *"}),e.jsx("input",{id:"bug-title",type:"text",value:l.title,onChange:h=>d(y=>Pe(Ie({},y),{title:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"Brief description of the bug",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-severity",className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity"}),e.jsxs("select",{id:"bug-severity",value:a,onChange:h=>i(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-category",className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{id:"bug-category",value:c,onChange:h=>o(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[e.jsx("option",{value:"ui",children:"UI/UX"}),e.jsx("option",{value:"functionality",children:"Functionality"}),e.jsx("option",{value:"performance",children:"Performance"}),e.jsx("option",{value:"accessibility",children:"Accessibility"}),e.jsx("option",{value:"data",children:"Data"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-environment",className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),e.jsx("input",{id:"bug-environment",type:"text",value:l.environment,onChange:h=>d(y=>Pe(Ie({},y),{environment:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"Browser, OS, etc."})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{id:"bug-description",value:l.description,onChange:h=>d(y=>Pe(Ie({},y),{description:h.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"Detailed description of the bug",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-steps",className:"block text-sm font-medium text-gray-700 mb-2",children:"Steps to Reproduce"}),l.steps.map((h,y)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 w-6",children:[y+1,"."]}),e.jsx("input",{id:`bug-step-${y}`,type:"text",value:h,onChange:b=>j(y,b.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:`Step ${y+1}`}),l.steps.length>1&&e.jsx("button",{type:"button",onClick:()=>v(y),className:"p-2 text-red-400 hover:text-red-600",children:e.jsx(C,{path:ae,size:.8})})]},y)),e.jsx("button",{type:"button",onClick:g,className:"text-sm text-[#4ECDC4] hover:text-[#3db8b0] underline",children:"+ Add Step"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-expected",className:"block text-sm font-medium text-gray-700 mb-2",children:"Expected Behavior"}),e.jsx("textarea",{id:"bug-expected",value:l.expected,onChange:h=>d(y=>Pe(Ie({},y),{expected:h.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"What should happen?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bug-actual",className:"block text-sm font-medium text-gray-700 mb-2",children:"Actual Behavior"}),e.jsx("textarea",{id:"bug-actual",value:l.actual,onChange:h=>d(y=>Pe(Ie({},y),{actual:h.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",placeholder:"What actually happens?"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Submit Bug Report"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Bug Reports"}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[r.map(h=>e.jsxs("div",{className:`p-4 rounded-lg border ${h.severity==="critical"?"bg-red-50 border-red-200":h.severity==="high"?"bg-orange-50 border-orange-200":h.severity==="medium"?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:h.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:h.description})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${h.severity==="critical"?"bg-red-100 text-red-800":h.severity==="high"?"bg-orange-100 text-orange-800":h.severity==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:h.severity}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${h.status==="open"?"bg-red-100 text-red-800":h.status==="investigating"?"bg-yellow-100 text-yellow-800":h.status==="fixing"?"bg-blue-100 text-blue-800":h.status==="testing"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:h.status})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[h.category," â€¢ ",h.reporter]}),e.jsx("span",{children:h.timestamp.toLocaleDateString()})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Status:"}),e.jsxs("select",{value:h.status,onChange:y=>m(h.id,y.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"investigating",children:"Investigating"}),e.jsx("option",{value:"fixing",children:"Fixing"}),e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})]})]},h.id)),r.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(C,{path:ea,size:2,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{children:"No bug reports yet. Report a bug to get started."})]})]})]})]})},Hy=({isOpen:r,onClose:t,errorContext:s="login",technicalReport:n})=>{const[a,i]=u.useState("support");if(!r)return null;const c=l=>{l.target===l.currentTarget&&t()},o=l=>{l.key==="Escape"&&t()};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"support-contact-title",children:[e.jsx("button",{className:"absolute inset-0 w-full h-full",onClick:c,onKeyDown:o,tabIndex:-1,"aria-label":"Close dialog"}),e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{id:"support-contact-title",className:"text-xl font-semibold text-gray-900",children:"Get Help"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(To,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsxs("button",{onClick:()=>i("admin"),className:`py-4 px-1 border-b-2 font-medium text-sm ${a==="admin"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(Xl,{className:"w-4 h-4 inline mr-2"}),"Administrator"]}),e.jsxs("button",{onClick:()=>i("support"),className:`py-4 px-1 border-b-2 font-medium text-sm ${a==="support"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(Zl,{className:"w-4 h-4 inline mr-2"}),"Technical Support"]}),e.jsxs("button",{onClick:()=>i("bug"),className:`py-4 px-1 border-b-2 font-medium text-sm ${a==="bug"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ko,{className:"w-4 h-4 inline mr-2"}),"Report Bug"]})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[a==="admin"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"Contact Your System Administrator"}),e.jsx("p",{className:"text-blue-800 mb-4",children:"For login issues, account access problems, or user management questions, please contact your system administrator."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-blue-700",children:e.jsx("strong",{children:"Common Administrator Issues:"})}),e.jsxs("ul",{className:"text-sm text-blue-700 list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Account not found or disabled"}),e.jsx("li",{children:"Password reset requests"}),e.jsx("li",{children:"Permission or role changes"}),e.jsx("li",{children:"Account lockouts"}),e.jsx("li",{children:"User profile updates"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"How to Contact:"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Contact your IT department or system administrator directly. They have access to user management tools and can resolve account-related issues."})]})]}),a==="support"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-orange-900 mb-2",children:"Contact Technical Support"}),e.jsx("p",{className:"text-orange-800 mb-4",children:"For technical issues, system errors, or application problems, please contact our technical support team."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-orange-700",children:e.jsx("strong",{children:"Common Technical Issues:"})}),e.jsxs("ul",{className:"text-sm text-orange-700 list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"System performance problems"}),e.jsx("li",{children:"Connection or network errors"}),e.jsx("li",{children:"Application crashes or freezes"}),e.jsx("li",{children:"Data synchronization issues"}),e.jsx("li",{children:"Browser compatibility problems"})]})]})]}),n&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Technical Report"}),e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"Please include this technical report when contacting support:"}),e.jsx("div",{className:"bg-white border border-gray-300 rounded p-3",children:e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap overflow-x-auto",children:n})})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Support Information:"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Error Context:"})," ",s]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Timestamp:"})," ",new Date().toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Browser:"})," ",navigator.userAgent]})]})]})]}),a==="bug"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Report a Bug"}),e.jsx("p",{className:"text-gray-600",children:"Use the bug tracker below to report issues, suggest improvements, or provide feedback about the application."})]}),e.jsx(qy,{})]})]}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4 bg-gray-50",children:e.jsx("div",{className:"flex justify-end space-x-3",children:e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Close"})})})]})]})},xs={INVALID_CREDENTIALS:"Invalid email or password. Please check your credentials and try again.",NETWORK_ERROR:"Unable to connect to the server. Please check your internet connection and try again.",INTERNAL_ERROR:"An internal error occurred. Our technical team has been notified. Please try again later.",UNEXPECTED_ERROR:"An unexpected error occurred. Please try again or contact technical support if the problem persists."},ve={AUTH:"auth",NETWORK:"network",VALIDATION:"validation",SYSTEM:"system",UNKNOWN:"unknown"},Gt={ADMIN:"admin",SUPPORT:"support",RETRY:"retry"},Kt={LOW:"low",MEDIUM:"medium",HIGH:"high"},Qt={[ve.AUTH]:Gt.ADMIN,[ve.NETWORK]:Gt.SUPPORT,[ve.VALIDATION]:Gt.RETRY,[ve.SYSTEM]:Gt.SUPPORT,[ve.UNKNOWN]:Gt.SUPPORT};var Vy=(r,t,s)=>new Promise((n,a)=>{var i=l=>{try{o(s.next(l))}catch(d){a(d)}},c=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,c);o((s=s.apply(r,t)).next())});const Kl=({error:r,context:t="login",onRetry:s,onDismiss:n})=>{const[a,i]=u.useState(!1),[c,o]=u.useState(!1),[l,d]=u.useState(!1),m=u.useCallback(y=>{const b=typeof y=="string"?y:y.message,_=b.toLowerCase();return _.includes("unauthorized")||_.includes("invalid credentials")||_.includes("authentication failed")||_.includes("invalid email")||_.includes("password")||_.includes("login")||_.includes("401")||_.includes("403")?{type:ve.AUTH,title:"Login Issue",message:xs.INVALID_CREDENTIALS,action:Qt[ve.AUTH],severity:Kt.MEDIUM}:_.includes("network")||_.includes("connection")||_.includes("timeout")||_.includes("fetch")||_.includes("http")||_.includes("server")||_.includes("500")||_.includes("502")||_.includes("503")||_.includes("504")?{type:ve.NETWORK,title:"Connection Problem",message:xs.NETWORK_ERROR,action:Qt[ve.NETWORK],severity:Kt.HIGH}:_.includes("database")||_.includes("internal")||_.includes("system")||_.includes("service")||_.includes("unexpected")||_.includes("error")?{type:ve.SYSTEM,title:"System Issue",message:xs.INTERNAL_ERROR,action:Qt[ve.SYSTEM],severity:Kt.HIGH}:_.includes("required")||_.includes("invalid")||_.includes("format")||_.includes("validation")?{type:ve.VALIDATION,title:"Please Check Your Input",message:b,action:Qt[ve.VALIDATION],severity:Kt.LOW}:{type:ve.UNKNOWN,title:"Something Went Wrong",message:xs.UNEXPECTED_ERROR,action:Qt[ve.UNKNOWN],severity:Kt.MEDIUM}},[])(r),x=u.useCallback(()=>{const y={timestamp:new Date().toISOString(),context:t,error:{message:typeof r=="string"?r:r.message,stack:typeof r=="object"&&r.stack?r.stack:void 0},userAgent:navigator.userAgent,url:window.location.href,category:m};return JSON.stringify(y,null,2)},[r,t,m]),f=u.useCallback(()=>Vy(null,null,function*(){try{const y=x();yield navigator.clipboard.writeText(y),o(!0),setTimeout(()=>o(!1),2e3)}catch(y){ye.error("Failed to copy technical report:",y)}}),[x]),g=u.useCallback(()=>{try{qo.reportError(typeof r=="string"?new Error(r):r,void 0,{context:t,category:m.type}),ye.info("Error reported to service")}catch(y){ye.error("Failed to report error:",y)}},[r,t,m.type]),v=y=>{switch(y){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},j=y=>{switch(y){case"admin":return e.jsx(Xl,{className:"w-5 h-5"});case"support":return e.jsx(Zl,{className:"w-5 h-5"});case"retry":return e.jsx(vs,{className:"w-5 h-5"});default:return e.jsx(vs,{className:"w-5 h-5"})}},h=y=>{switch(y){case"admin":return"Contact Administrator";case"support":return"Contact Support";case"retry":return"Try Again";default:return"Get Help"}};return e.jsxs("div",{className:`rounded-lg border p-4 ${v(m.severity)}`,children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:j(m.action)}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium",children:m.title}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx("p",{children:m.message})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[m.action==="retry"&&s&&e.jsx("button",{onClick:s,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Try Again"}),(m.action==="admin"||m.action==="support")&&e.jsx("button",{onClick:()=>{g(),d(!0)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:h(m.action)}),e.jsxs("button",{onClick:()=>i(!a),className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[a?"Hide":"Show"," Technical Details"]})]}),a&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-100 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Technical Report"}),e.jsx("button",{onClick:f,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-gray-600 hover:text-gray-800",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Yl,{className:"w-3 h-3 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Io,{className:"w-3 h-3 mr-1"}),"Copy Report"]})})]}),e.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap overflow-x-auto",children:x()})]}),n&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:n,className:"text-sm text-gray-500 hover:text-gray-700",children:"Dismiss"})})]})]}),e.jsx(Hy,{isOpen:l,onClose:()=>d(!1),errorContext:t,technicalReport:a?x():void 0})]})},ej=Object.freeze(Object.defineProperty({__proto__:null,UserFriendlyErrorHandler:Kl,default:Kl},Symbol.toStringTag,{value:"Module"}));export{Ov as $,Lv as A,G as B,om as C,_v as D,Ac as E,Uv as F,qv as G,Hv as H,Sv as I,zv as J,Wv as K,cm as L,Bx as M,jv as N,Pv as O,Xg as P,$v as Q,Vv as R,cv as S,iv as T,Fv as U,Av as V,Dv as W,Rv as X,Ev as Y,Bv as Z,qe as _,St as a,mv as a0,gv as a1,hv as a2,bv as a3,fv as a4,zm as a5,yv as a6,ct as a7,xv as a8,pv as a9,ej as aA,_c as aa,uv as ab,dv as ac,vv as ad,ev as ae,tv as af,Xy as ag,sv as ah,Jy as ai,nv as aj,av as ak,lv as al,Iv as am,Bs as an,ng as ao,Wn as ap,Tv as aq,ov as ar,Fi as as,Pc as at,rv as au,Cv as av,Yv as aw,Jv as ax,Xv as ay,Zv as az,Dh as b,le as c,Ai as d,wv as e,Nv as f,He as g,Rr as h,Qv as i,dr as j,Ec as k,Ab as l,Gv as m,Kv as n,Ns as o,Cr as p,ye as q,Vc as r,Q as s,Zy as t,Ve as u,kv as v,Ic as w,vi as x,Mv as y,ir as z};
