const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/components-CI6m6L5v.js","assets/js/react-vendor-BgCjxHGT.js","assets/js/data-vendor-C88t-X3A.js","assets/js/vendor-jNhfZCZ0.js","assets/js/services-CE_LtFqr.js","assets/js/inventory-pages-Dx6mSDHp.js","assets/js/ui-vendor-mgcSnJSc.js","assets/css/ui-vendor-DJSy8M6b.css","assets/js/utils-vendor-CxPd0XhF.js","assets/css/components-B4OH_j2L.css"])))=>i.map(i=>d[i]);
import{j as a,r as u,I as k,R as T,B as oe,b as ke}from"./react-vendor-BgCjxHGT.js";import{_ as Oe,s as g,T as Je,S as Ze}from"./components-CI6m6L5v.js";import{A as We,l as Ie,aB as Xe,aC as re,aD as ze,i as qe,h as Ae,c as et,F as le,D as tt,aE as rt,U as Le,P as ne,Z as nt,d as ce,ah as st,H as at,ai as it}from"./ui-vendor-mgcSnJSc.js";import{a5 as B,a6 as J,a7 as K,a8 as ee,a9 as de,aa as F}from"./services-CE_LtFqr.js";const ot=({children:r})=>a.jsx("div",{children:r}),te=`
⚠️ Deprecated: Old Knowledge Hub mock data files were removed.
This placeholder prevents accidental imports. All Knowledge Hub data now comes directly from Supabase.
`;var lt=Object.defineProperty,ue=Object.getOwnPropertySymbols,ct=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable,ge=(r,e,t)=>e in r?lt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Z=(r,e)=>{for(var t in e||(e={}))ct.call(e,t)&&ge(r,t,e[t]);if(ue)for(var t of ue(e))dt.call(e,t)&&ge(r,t,e[t]);return r},W=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class O{static getCategoryCount(e,t){return e.filter(n=>n.category===t).length}static updateContentInList(e,t,n){return e.map(s=>s.id===t?Z(Z({},s),n):s)}static removeContentFromList(e,t){return e.filter(n=>n.id!==t)}static performContentUpdate(e,t){return W(this,null,function*(){try{return console.warn(te),Z({id:e},t)}catch(n){return console.error(n),Z({id:e},t)}})}static performContentDeletion(e){return W(this,null,function*(){try{const{supabase:t}=yield Oe(()=>import("./components-CI6m6L5v.js").then(s=>s.at),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),{error:n}=yield t.from("knowledge_hub_content").delete().eq("id",e);if(n)throw new Error(`Failed to delete content: ${n.message}`);console.log(`✅ Successfully deleted content item: ${e}`)}catch(t){throw console.error("Error deleting content:",t),t}})}static performContentStatusUpdate(e,t){return W(this,null,function*(){try{return console.warn(te),{id:e,status:t}}catch(n){return console.error(n),{id:e,status:t}}})}static performContentFetch(){return W(this,null,function*(){try{return console.warn(te),[]}catch(e){return console.error(e),[]}})}static createError(e){return new Error(e)}static getErrorMessage(e){return e instanceof Error?e.message:"An unknown error occurred"}}var G=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const ut=()=>G(null,null,function*(){try{const{data:r,error:e}=yield g.from("knowledge_hub_content").select("*").order("created_at",{ascending:!1});return e?(console.error("❌ Failed to fetch Knowledge Hub content:",e.message),[]):(console.log(`✅ Loaded ${(r==null?void 0:r.length)||0} Knowledge Hub items from Supabase`),r||[])}catch(r){return console.error("❌ Unexpected error fetching Knowledge Hub content:",r),[]}}),De=u.createContext(void 0),gt=({children:r})=>{const[e,t]=u.useState([]),[n,s]=u.useState(null),[i,c]=u.useState(!1),[l,o]=u.useState(null),[d,f]=u.useState(null),[w,S]=u.useState(null),v=u.useCallback(()=>G(null,null,function*(){try{c(!0),o(null);const h=yield ut();if(t(h),s(h),!d&&h.length>0){const _=h[0].category;f(_)}g.auth.getUser().then(_=>{var N;(N=_==null?void 0:_.data)!=null&&N.user}).catch(_=>{console.warn("Supabase auth not available:",_)})}catch(h){const _=O.getErrorMessage(h);o(O.createError(_)),console.error("❌ KnowledgeHub: Error fetching content:",h)}finally{c(!1)}}),[]);u.useEffect(()=>{const h=setTimeout(()=>{v()},0);return()=>clearTimeout(h)},[v]);const p=u.useCallback((h,_)=>G(null,null,function*(){try{c(!0),o(null);const N=yield O.performContentUpdate(h,_);return t(q=>O.updateContentInList(q,h,N)),!0}catch(N){const q=O.getErrorMessage(N);return o(O.createError(q)),!1}finally{c(!1)}}),[]),x=u.useCallback(h=>G(null,null,function*(){try{return c(!0),o(null),yield O.performContentDeletion(h),t(_=>O.removeContentFromList(_,h)),!0}catch(_){const N=O.getErrorMessage(_);return o(O.createError(N)),!1}finally{c(!1)}}),[]),D=u.useCallback(h=>O.getCategoryCount(e,h),[e]),m=u.useCallback((h,_)=>G(null,null,function*(){try{c(!0),o(null);const N=yield O.performContentStatusUpdate(h,_);return t(q=>O.updateContentInList(q,h,N)),!0}catch(N){const q=O.getErrorMessage(N);return o(O.createError(q)),!1}finally{c(!1)}}),[]),U=u.useCallback(()=>{S(null)},[]),A=u.useCallback(h=>{f(h);const _=e.filter(N=>N.category===h);s(_)},[e]),M={content:e,selectedContent:n,selectedCategory:d,isLoading:i,error:l,validationError:w,setSelectedCategory:A,getCategoryCount:D,refetchContent:v,deleteContent:x,updateContentStatus:m,updateContent:p,clearValidationError:U};return a.jsx(De.Provider,{value:M,children:r})},Q=()=>{const r=u.useContext(De);if(r===void 0)throw new Error("useSimplifiedKnowledgeHub must be used within a SimplifiedKnowledgeHubProvider");return r};var ft=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const E=(r,e="")=>typeof r=="string"&&r.trim()!==""?r:e,fe=(r,e=0)=>typeof r=="number"&&!isNaN(r)?r:e,he=(r,e=!1)=>typeof r=="boolean"?r:e,ht=r=>Array.isArray(r)?r.filter(e=>typeof e=="string"):[],mt=r=>Array.isArray(r)?r.filter(e=>typeof e=="object"&&e!==null):[];function pt(){return ft(this,null,function*(){var r;try{const{data:{user:e},error:t}=yield g.auth.getUser();let n=null;!t&&e&&(n=((r=e.user_metadata)==null?void 0:r.facility_id)||null);const s=g.from("courses").select("*");n&&s.eq("facility_id",n);const{data:i,error:c}=yield s.order("created_at",{ascending:!1});return c?(console.error("Error fetching content items:",c),[]):(i||[]).map(l=>{var o,d;return{id:E(l.id),title:E(l.title),category:E(l.content_type),status:E(l.status),description:E((o=l.data)==null?void 0:o.description),tags:ht((d=l.data)==null?void 0:d.tags),domain:E(l.domain),contentType:E(l.content_type),type:E(l.type),createdAt:E(l.created_at),lastUpdated:E(l.updated_at),publishedAt:E(l.published_at)||void 0,archivedAt:E(l.archived_at)||void 0,estimatedDuration:fe(l.estimated_duration)||void 0,difficultyLevel:E(l.difficulty_level),department:E(l.department)||void 0,authorId:E(l.author_id)||void 0,assignedBy:E(l.assigned_by)||void 0,isRepeat:he(l.is_repeat),isActive:he(l.is_active),content:l.content||{},media:mt(l.media),dueDate:E(l.due_date)||new Date().toISOString().split("T")[0],progress:fe(l.progress)}})}catch(e){return console.error("Error in getAllContentItems:",e),[]}})}var _t=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const yt=()=>{const[r,e]=u.useState([]),[t,n]=u.useState(!1),[s,i]=u.useState(null),c=()=>_t(null,null,function*(){try{n(!0),i(null);const o=(yield pt()).filter(d=>d.lastUpdated).sort((d,f)=>new Date(f.lastUpdated).getTime()-new Date(d.lastUpdated).getTime()).slice(0,10).map(d=>({id:d.id,title:d.title||"Untitled",type:d.category||"Unknown",updated_at:d.lastUpdated}));e(o)}catch(l){console.error("Failed to load recent updates:",l),i(l instanceof Error?l.message:"An error occurred")}finally{n(!1)}});return u.useEffect(()=>{c()},[]),a.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[a.jsx(k,{path:We,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Recent Activity"]}),a.jsx("button",{onClick:c,disabled:t,className:"p-1 text-gray-500 hover:text-[#4ECDC4] transition-colors",title:"Refresh activity",children:a.jsx(k,{path:Ie,size:.8,className:t?"animate-spin":""})})]}),a.jsx("div",{className:"space-y-2",children:t?a.jsxs("div",{className:"flex items-center justify-center py-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#4ECDC4]"}),a.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading..."})]}):s?a.jsx("div",{className:"text-red-500 text-sm py-2 px-2 bg-red-50 rounded",children:"Error loading activity. Please try refreshing."}):r.length===0?a.jsxs("div",{className:"text-center py-6",children:[a.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"No recent activity"}),a.jsx("p",{className:"text-xs text-gray-400",children:"Activity will appear here as you interact with content"})]}):r.map(l=>a.jsxs("div",{className:"border-b pb-2 last:border-b-0",children:[a.jsx("div",{className:"font-medium text-sm text-gray-900",children:l.title}),a.jsxs("div",{className:"text-xs text-gray-500",children:[l.type," —"," ",new Date(l.updated_at).toLocaleDateString()]})]},l.id))})]})};class H{static filterByCategory(e,t){return!e||!Array.isArray(e)?[]:e.filter(n=>n.category===t)}static filterContent(e,t){let n=[...e];if(t.searchQuery.trim()){const s=t.searchQuery.toLowerCase();n=n.filter(i=>{var c,l,o,d;return i.title.toLowerCase().includes(s)||((l=(c=i.data)==null?void 0:c.description)==null?void 0:l.toLowerCase().includes(s))||((d=(o=i.data)==null?void 0:o.tags)==null?void 0:d.some(f=>f.toLowerCase().includes(s)))})}return t.selectedDomain&&t.selectedDomain!=="All"&&(n=n.filter(s=>s.domain===t.selectedDomain)),t.selectedContentType&&t.selectedContentType!=="All"&&(n=n.filter(s=>s.contentType===t.selectedContentType)),n}static getCategoryCount(e,t){return!e||!Array.isArray(e)?0:e.filter(n=>n.category===t).length}static getUniqueDomains(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(n=>n.domain).filter(n=>!!n));return Array.from(t).sort()}static getUniqueContentTypes(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(n=>n.contentType).filter(n=>!!n));return Array.from(t).sort()}}const Ue=({content:r,selectedCategory:e,filterOptions:t})=>{const n=u.useMemo(()=>!r||!Array.isArray(r)?[]:H.filterByCategory(r,e||""),[r,e]),s=u.useMemo(()=>H.filterContent(n,t),[n,t]),i=u.useMemo(()=>r?H.getUniqueDomains(r):[],[r]),c=u.useMemo(()=>r?H.getUniqueContentTypes(r):[],[r]);return{categoryItems:n,filteredItems:s,uniqueDomains:i,uniqueContentTypes:c,getCategoryCount:o=>r?H.getCategoryCount(r,o):0}},xt={Courses:{icon:"#9333ea",bgColor:"bg-purple-100",textColor:"text-purple-600",selectedBgColor:"bg-purple-50"},"Learning Pathways":{icon:"#16a34a",bgColor:"bg-green-100",textColor:"text-green-600",selectedBgColor:"bg-green-50"},Procedures:{icon:"#ea580c",bgColor:"bg-orange-100",textColor:"text-orange-600",selectedBgColor:"bg-orange-50"},Policies:{icon:"#3b82f6",bgColor:"bg-blue-100",textColor:"text-blue-600",selectedBgColor:"bg-blue-50"}},vt=()=>{const{selectedCategory:r,setSelectedCategory:e,content:t}=Q(),{getCategoryCount:n}=Ue({content:t,selectedCategory:r,filterOptions:{searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""}}),s=[{id:"Courses",icon:re},{id:"Learning Pathways",icon:ze},{id:"Procedures",icon:qe},{id:"Policies",icon:Ae}];return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center mb-4",children:[a.jsx(k,{path:Xe,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Categories"]}),a.jsx("div",{className:"space-y-2",children:s.map(i=>{const c=xt[i.id];return a.jsxs("button",{onClick:()=>e(i.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors flex items-center justify-between ${r===i.id?`${c.selectedBgColor} ${c.textColor}`:"text-[#5b5b5b] hover:bg-gray-100"}`,children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:`${c.bgColor} rounded-full p-1 mr-2`,children:a.jsx(k,{path:i.icon,size:.9,color:c.icon,"aria-hidden":"true"})}),i.id]}),a.jsx("span",{className:"text-sm text-gray-500",children:n(i.id)})]},i.id)})})]})};class wt{static determineRenderState(e,t,n){const{isLoading:s,error:i}=e;return{shouldShowLoading:s,shouldShowError:!!i,shouldShowEmpty:!s&&!i&&(!t||n.length===0),shouldShowContent:!s&&!i&&!!t&&n.length>0}}static getTagColor(e){switch(e){case"Required":return"bg-red-100 text-red-800";case"Optional":return"bg-blue-100 text-blue-800";case"New":return"bg-green-100 text-green-800";case"Updated":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}}static getStatusColor(e){switch(e){case"Not Started":return"bg-gray-100 text-gray-700";case"In Progress":return"bg-blue-100 text-blue-700";case"Completed":return"bg-green-100 text-green-700";default:return"bg-gray-100 text-gray-700"}}static formatTimeAgo(e){const t=new Date,n=new Date(e),s=Math.floor((t.getTime()-n.getTime())/(1e3*60*60));if(s<1)return"Just now";if(s<24)return`${s} hours ago`;const i=Math.floor(s/24);if(i<7)return`${i} days ago`;const c=Math.floor(i/7);return c<4?`${c} weeks ago`:`${Math.floor(i/30)} months ago`}}const bt=({uiState:r,selectedCategory:e,categoryItems:t})=>u.useMemo(()=>wt.determineRenderState(r,e,t),[r,e,t]),Fe=({selectedCategory:r})=>a.jsx("div",{className:"mt-4",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-gray-50",children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"?"Course Name":r==="Learning Pathways"?"Pathway Name":r==="Procedures"?"Procedure Name":r==="Policies"?"Policy Name":"Content Name"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"?"Status":r==="Learning Pathways"?"Courses":r==="Procedures"?"Department":"Category"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"?"Due Date":r==="Learning Pathways"?"Status":"Last Updated"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r==="Courses"||r==="Learning Pathways"?"Progress":"Status"}),a.jsx("th",{className:"w-10 px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:r?"No content available in this category.":"Select a category to view content."})})})]})})}),Y=()=>a.jsx(Je,{rows:5,columns:4}),Ct=({error:r,onRetry:e})=>a.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[a.jsx(k,{path:et,size:2,color:"#ef4444",className:"mb-2"}),a.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Failed to load content"}),a.jsx("p",{className:"text-gray-500 text-sm mb-4",children:r.message}),a.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#3db8b0] transition",children:[a.jsx(k,{path:Ie,size:.8}),"Retry"]})]}),jt=({category:r})=>{const e=u.useMemo(()=>{switch(r){case"Courses":return re;case"Learning Pathways":return ze;case"Procedures":return qe;case"Policies":return Ae;default:return re}},[r]);return a.jsx(k,{path:e,size:1.1,color:"#4ECDC4",className:"mr-2"})},St=({category:r,isLoading:e})=>a.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[a.jsx(jt,{category:r}),r||"All Categories",e&&a.jsx("div",{className:"ml-2 animate-spin rounded-full h-4 w-4 border-b-2 border-[#4ECDC4]"})]}),Nt=({category:r,items:e,onStartContent:t,CoursesTable:n,LearningPathwaysTable:s,ProceduresTable:i,PoliciesTable:c})=>u.useMemo(()=>{switch(r){case"Courses":return a.jsx(u.Suspense,{fallback:a.jsx(Y,{}),children:a.jsx(n,{items:e,onStartContent:t})});case"Learning Pathways":return a.jsx(u.Suspense,{fallback:a.jsx(Y,{}),children:a.jsx(s,{items:e,onStartContent:t})});case"Procedures":return a.jsx(u.Suspense,{fallback:a.jsx(Y,{}),children:a.jsx(i,{items:e,onStartContent:t})});case"Policies":return a.jsx(u.Suspense,{fallback:a.jsx(Y,{}),children:a.jsx(c,{items:e,onStartContent:t})});default:return a.jsx(Fe,{selectedCategory:r})}},[r,e,t,n,s,i,c]),Pt=({pagination:r,onPageChange:e})=>{const{totalItems:t,totalPages:n,currentPage:s}=r;return t===0?null:a.jsxs("div",{className:"flex justify-center items-center mt-4 gap-4",role:"navigation","aria-label":"Table pagination",children:[a.jsx("button",{onClick:()=>e(Math.max(1,s-1)),disabled:s===1,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to previous page","aria-disabled":s===1,tabIndex:0,children:"Previous"}),a.jsxs("span",{className:"text-sm text-gray-700","aria-label":`Page ${s} of ${n}`,children:["Page ",s," of ",n]}),a.jsx("button",{onClick:()=>e(Math.min(n,s+1)),disabled:s===n,className:"px-3 py-1 border rounded-md disabled:opacity-50 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","aria-label":"Go to next page","aria-disabled":s===n,tabIndex:0,children:"Next"})]})},Et=({item:r,isExpanded:e,onToggleExpansion:t,onDelete:n,onStartContent:s,progressDisplay:i,dueDateDisplay:c,actionButton:l,columnWidths:o})=>{var d,f;if(!r)return console.warn("TableRow: item prop is undefined or null"),null;const w=()=>{r!=null&&r.id&&t(r.id)},S=()=>{r!=null&&r.id&&n(r.id)},v=()=>{s&&(r!=null&&r.id)&&s(r.id)};try{return a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.content)||"auto"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:w,className:"p-1 hover:bg-gray-200 rounded",children:a.jsx(k,{path:e?le:tt,size:.8,className:"text-gray-500"})}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-gray-900 leading-tight",children:r!=null&&r.title&&r.title.length>40?a.jsxs(a.Fragment,{children:[a.jsx("div",{children:r.title.substring(0,40)}),a.jsx("div",{className:"text-sm text-gray-600",children:r.title.substring(40)})]}):(r==null?void 0:r.title)||"Untitled"})})]})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.progress)||"auto"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:`h-2 rounded-full ${((i==null?void 0:i.percentage)||0)===0?"bg-gray-400":((i==null?void 0:i.percentage)||0)===100?"bg-[#10B981]":"bg-[#4ECDC4]"}`,style:{width:`${(i==null?void 0:i.percentage)||0}%`}})})}),a.jsx("span",{className:"text-sm text-gray-600 min-w-[3rem]",children:(i==null?void 0:i.text)||"0%"})]})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.startDate)||"auto"},children:((i==null?void 0:i.percentage)||0)>0&&(r!=null&&r.lastUpdated)?a.jsx("span",{className:"text-sm text-gray-700",children:(()=>{try{return new Date(r.lastUpdated).toLocaleDateString()}catch(p){return console.error(p),"Invalid date"}})()}):a.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.assigned)||"auto"},children:a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("span",{className:`text-lg font-medium ${((i==null?void 0:i.percentage)||0)>0?"text-[#10B981]":"text-gray-400"}`,children:((i==null?void 0:i.percentage)||0)>0?"✓":"✗"})})}),a.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.actions)||"auto"},children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:v,disabled:(l==null?void 0:l.disabled)||!1,className:`w-8 h-8 rounded flex items-center justify-center transition-colors ${(l==null?void 0:l.variant)==="primary"?"bg-[#4ECDC4] text-white hover:bg-[#3DB8B0] disabled:bg-gray-300":(l==null?void 0:l.variant)==="secondary"?"bg-[#5B5B5B] text-white hover:bg-[#4A4A4A] disabled:bg-gray-300":"bg-[#EF4444] text-white hover:bg-[#DC2626] disabled:bg-gray-300"} disabled:cursor-not-allowed`,title:((i==null?void 0:i.percentage)||0)===100?"View":((i==null?void 0:i.percentage)||0)>0?"Resume":"Start",children:a.jsx(k,{path:((i==null?void 0:i.percentage)||0)===100?rt:((i==null?void 0:i.percentage)||0)>0?Le:ne,size:.8})}),a.jsx("button",{onClick:S,className:"w-8 h-8 text-[#EF4444] hover:bg-red-50 rounded flex items-center justify-center transition-colors",title:"Delete",children:a.jsx(k,{path:nt,size:.8})})]})})]}),e&&a.jsx("tr",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-[#4ECDC4]",children:a.jsx("td",{colSpan:5,className:"px-4 py-4",children:a.jsxs("div",{className:"space-y-4 animate-in slide-in-from-top-2 duration-300",children:[(r==null?void 0:r.description)&&a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(k,{path:le,size:.8,className:"text-[#4ECDC4]"}),a.jsx("h4",{className:"font-semibold text-gray-900",children:"Description"})]}),a.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:(d=r.data)==null?void 0:d.description})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${r.difficultyLevel==="advanced"?"bg-red-500":r.difficultyLevel==="intermediate"?"bg-yellow-500":"bg-green-500"}`}),a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Difficulty"})]}),a.jsx("p",{className:"text-xs text-gray-600 capitalize",children:r.difficultyLevel||"Beginner"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(k,{path:ce,size:.7,className:"text-[#4ECDC4]"}),a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Duration"})]}),a.jsx("p",{className:"text-xs text-gray-600",children:r.estimatedDuration?`${r.estimatedDuration} minutes`:"Not specified"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(k,{path:ce,size:.7,className:"text-[#4ECDC4]"}),a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Due Date"})]}),a.jsx("span",{className:`text-xs ${(c==null?void 0:c.color)||"text-gray-600"}`,children:(c==null?void 0:c.text)||"No due date"})]})]}),((f=r==null?void 0:r.data)==null?void 0:f.tags)&&r.data.tags.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"Tags"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:r.data.tags.map((p,x)=>a.jsxs("span",{className:"px-2 py-1 text-xs bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-800 rounded-full border border-blue-200 font-medium",children:["#",p]},x))})]}),a.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:"Progress"}),a.jsx("span",{className:"text-xs font-medium text-gray-600",children:(i==null?void 0:i.text)||"0%"})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ease-out ${((i==null?void 0:i.percentage)||0)===0?"bg-gray-400":((i==null?void 0:i.percentage)||0)===100?"bg-gradient-to-r from-green-500 to-green-600":"bg-gradient-to-r from-[#4ECDC4] to-[#3DB8B0]"}`,style:{width:`${(i==null?void 0:i.percentage)||0}%`}})})]})]})})})]})}catch(p){return console.error("Error rendering TableRow:",p),a.jsx("tr",{className:"border-b border-gray-200",children:a.jsxs("td",{colSpan:5,className:"px-4 py-3 text-center text-red-600",children:["Error loading row data. Please refresh the page."," ",p instanceof Error?p.message:"Unknown error"]})})}},kt=r=>{const e=$e(r),t=Ot(e),n=`${e}%`;return{percentage:e,color:t,text:n}},$e=r=>{if(r.progress!==void 0)return Math.round(r.progress);switch(r.status){case"draft":return 0;case"published":return 25;case"review":return 75;case"archived":return 100;default:return 0}},Ot=r=>r>=100?"bg-green-500":r>=75?"bg-blue-500":r>=50?"bg-yellow-500":r>=25?"bg-orange-500":"bg-red-500",It=(r,e)=>{const t=e[r];if(!t)return{text:"Not started",color:"text-gray-500",isOverdue:!1};const s=t<new Date;return{text:Te(t),color:s?"text-red-600":"text-gray-700",isOverdue:s}},zt=(r,e)=>{const t=e[r];if(!t)return{text:"No due date",color:"text-gray-500",isOverdue:!1};const s=t<new Date;return{text:Te(t),color:s?"text-red-600":"text-gray-700",isOverdue:s}},qt=(r,e)=>{const t=$e(r);return t===100?{text:"Completed",icon:Le,onClick:()=>{},disabled:!0,variant:"secondary"}:t>0?{text:"Resume",icon:ne,onClick:()=>e==null?void 0:e(r.id),disabled:!1,variant:"primary"}:{text:"Start",icon:ne,onClick:()=>e==null?void 0:e(r.id),disabled:!1,variant:"primary"}},Te=r=>{const e=new Date,t=Math.abs(e.getTime()-r.getTime()),n=Math.ceil(t/(1e3*60*60*24));return n===0?"Today":n===1?r<e?"Yesterday":"Tomorrow":n<7?`${n} days ${r<e?"ago":"from now"}`:r.toLocaleDateString()},At=(r,e,t)=>{const n=Math.ceil(r/t),s=(e-1)*t,i=s+t;return{totalItems:r,totalPages:n,startIndex:s,endIndex:i,currentPage:e,pageSize:t}};var Lt=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});const X=({items:r,onDelete:e,onStartContent:t})=>{const{updateContentStatus:n,refetchContent:s}=Q(),[i,c]=u.useState(new Set),[l]=u.useState({}),[o]=u.useState({}),[d,f]=u.useState(1),[w,S]=u.useState(10),[v]=u.useState({content:500,progress:150,startDate:140,assigned:120,actions:120}),p=r,x=u.useMemo(()=>At(p.length,d,w),[p.length,d,w]),D=u.useMemo(()=>{const h=x.startIndex,_=x.endIndex;return p.slice(h,_)},[p,x.startIndex,x.endIndex]),m=h=>{f(h)},U=h=>{const _=new Set(i);_.has(h)?_.delete(h):_.add(h),c(_)},A=h=>Lt(null,null,function*(){try{e(h),yield s()}catch(_){console.error("Failed to delete item:",_)}}),M=h=>{t&&t(h)};return a.jsxs("div",{className:"overflow-hidden",children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Content"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(h=>{const _=kt(h),N=It(h.id,l),q=zt(h.id,o),R=qt(h,M);return a.jsx(Et,{item:h,isExpanded:i.has(h.id),onToggleExpansion:U,onDelete:A,onStartContent:M,progressDisplay:_,startDateDisplay:N,dueDateDisplay:q,actionButton:R,columnWidths:v},h.id)})})]})}),a.jsx(Pt,{pagination:x,onPageChange:m})]})},Qe=T.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Q(),s=r&&r.length>0?r:[];return a.jsx(X,{items:s,type:"courses",onDelete:t,onStatusUpdate:n,onStartContent:e})});Qe.displayName="CoursesTable";const Me=T.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Q(),s=r.length>0?r:[];return a.jsx(X,{items:s,type:"learning-pathways",onDelete:t,onStatusUpdate:n,onStartContent:e})});Me.displayName="LearningPathwaysTable";const Re=T.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Q(),s=r&&r.length>0?r:[];return a.jsx(X,{items:s,type:"procedures",onDelete:t,onStatusUpdate:n,onStartContent:e})});Re.displayName="ProceduresTable";const Be=T.memo(({items:r,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Q(),s=r&&r.length>0?r:[];return a.jsx(X,{items:s,type:"policies",onDelete:t,onStatusUpdate:n,onStartContent:e})});Be.displayName="PoliciesTable";var Dt=Object.defineProperty,Ut=Object.defineProperties,Ft=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,$t=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,pe=(r,e,t)=>e in r?Dt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_e=(r,e)=>{for(var t in e||(e={}))$t.call(e,t)&&pe(r,t,e[t]);if(me)for(var t of me(e))Tt.call(e,t)&&pe(r,t,e[t]);return r},ye=(r,e)=>Ut(r,Ft(e));const Qt=({onFiltersChange:r,selectedCategory:e,onCategoryChange:t,statusOptions:n,difficultyOptions:s,durationOptions:i})=>{const[c,l]=u.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),[o,d]=u.useState(!1),f=u.useCallback((m,U)=>{const A=ye(_e({},c),{[m]:U});l(A),r(A)},[c,r]),w=u.useCallback(m=>{const U=m.target.value,A=ye(_e({},c),{searchQuery:U});l(A),r(A)},[c,r]),S=u.useCallback(m=>{t(m.target.value)},[t]),v=u.useCallback(()=>{d(!o)},[o]),p=u.useCallback(()=>{const m={searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"};l(m),r(m)},[r]),x=[{value:"all",label:"All Categories"},{value:"Courses",label:"Courses"},{value:"Policies",label:"Policies"},{value:"Procedures",label:"Procedures"},{value:"Learning Pathways",label:"Learning Pathways"}],D=[{value:"title",label:"Title"},{value:"date",label:"Date"},{value:"progress",label:"Progress"},{value:"difficulty",label:"Difficulty"},{value:"duration",label:"Duration"}];return a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2 overflow-x-hidden",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(k,{path:st,size:1,className:"text-gray-400"})}),a.jsx("input",{type:"text",placeholder:"Search all content...",value:c.searchQuery,onChange:w,className:"form-control w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsx("div",{className:"lg:w-48",children:a.jsx("select",{value:e,onChange:S,className:"form-select",children:x.map(m=>a.jsx("option",{value:m.value,children:m.label},m.value))})}),a.jsxs(oe,{variant:"outline-secondary",className:"font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",onClick:v,"aria-expanded":o,"aria-controls":"expanded-filters-panel","aria-label":`${o?"Hide":"Show"} advanced filters`,children:[a.jsx(k,{path:at,size:1,className:"mr-2","aria-hidden":"true"}),"Filters"]}),a.jsxs(oe,{variant:"outline-secondary",className:"font-medium px-4 py-2 rounded-md border border-gray-300 shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",onClick:()=>f("sortOrder",c.sortOrder==="asc"?"desc":"asc"),children:[a.jsx(k,{path:it,size:1,className:"mr-2"}),c.sortOrder==="asc"?"↑":"↓"]})]}),o&&a.jsxs("div",{id:"expanded-filters-panel",className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 flex flex-wrap gap-3",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full",children:[a.jsxs("div",{className:"sm:w-32",children:[a.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Status"}),a.jsxs("select",{id:"status-filter",className:"form-select",value:c.statusFilter,onChange:m=>f("statusFilter",m.target.value),children:[a.jsx("option",{value:"all",children:"All Statuses"}),n.map(m=>a.jsx("option",{value:m,children:m},m))]})]}),a.jsxs("div",{className:"sm:w-32",children:[a.jsx("label",{htmlFor:"difficulty-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Difficulty"}),a.jsxs("select",{id:"difficulty-filter",className:"form-select",value:c.difficultyFilter,onChange:m=>f("difficultyFilter",m.target.value),children:[a.jsx("option",{value:"all",children:"All Levels"}),s.map(m=>a.jsx("option",{value:m,children:m},m))]})]}),a.jsxs("div",{className:"sm:w-40",children:[a.jsx("label",{htmlFor:"duration-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Duration"}),a.jsxs("select",{id:"duration-filter",className:"form-select",value:c.durationFilter,onChange:m=>f("durationFilter",m.target.value),children:[a.jsx("option",{value:"all",children:"Any Duration"}),i.map(m=>a.jsx("option",{value:m,children:m},m))]})]}),a.jsxs("div",{className:"sm:w-32",children:[a.jsx("label",{htmlFor:"sort-by-filter",className:"block text-xs font-semibold text-gray-600 mb-1",children:"Sort By"}),a.jsx("select",{id:"sort-by-filter",className:"form-select",value:c.sortBy,onChange:m=>f("sortBy",m.target.value),children:D.map(m=>a.jsx("option",{value:m.value,children:m.label},m.value))})]})]}),a.jsx("div",{className:"flex justify-end w-full",children:a.jsx("button",{onClick:p,className:"inline-flex items-center px-3 py-1 border border-gray-300 rounded text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Clear All Filters"})})]})]})},Ke=T.memo(()=>{const[r,e]=u.useState(null),t=ke(),n=u.useCallback(b=>{console.error("ContentTable error:",b),e(b)},[]),s=u.useCallback(()=>{e(null)},[]),{selectedCategory:i,selectedContent:c,isLoading:l,error:o,refetchContent:d,deleteContent:f,updateContentStatus:w,setSelectedCategory:S}=Q(),[v,p]=u.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),x=["Not Started","In Progress","Completed"],D=["Beginner","Intermediate","Advanced"],m=["15 min","30 min","45 min","60 min","90 min+"],U=u.useCallback(b=>{p(b)},[]),A=u.useCallback(b=>{S(b==="all"?"all":b)},[S]),M=u.useCallback(b=>{t(`/course/${b}`)},[t]),h={isLoading:l,error:o,validationError:null},_={searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""},N=u.useMemo(()=>{if(!c)return[];let b=c;if(v.searchQuery){const P=v.searchQuery.toLowerCase().trim();b=b.filter(C=>{var I,z,se;const ae=[C.title,((I=C.data)==null?void 0:I.description)||"",C.department||"",((se=(z=C.data)==null?void 0:z.tags)==null?void 0:se.join(" "))||"",C.domain||"",C.contentType||""].join(" ").toLowerCase();return ae.includes(P)?!0:P.split(/\s+/).some(ie=>ie.length<2?!1:ae.split(/\s+/).some(Ye=>Ye.startsWith(ie)))})}return v.statusFilter!=="all"&&(b=b.filter(P=>P.status===v.statusFilter)),v.difficultyFilter!=="all"&&(b=b.filter(P=>P.difficultyLevel===v.difficultyFilter)),v.durationFilter!=="all"&&(b=b.filter(P=>{if(!P.estimatedDuration)return!1;const C=P.estimatedDuration;switch(v.durationFilter){case"15 min":return C<=15;case"30 min":return C<=30;case"45 min":return C<=45;case"60 min":return C<=60;case"90 min+":return C>90;default:return!0}})),b.sort((P,C)=>{let I,z;switch(v.sortBy){case"title":I=(P.title||"").toLowerCase(),z=(C.title||"").toLowerCase();break;case"date":I=P.lastUpdated?new Date(P.lastUpdated):new Date(0),z=C.lastUpdated?new Date(C.lastUpdated):new Date(0);break;case"progress":I=P.progress,z=C.progress;break;case"difficulty":I=P.difficultyLevel||"",z=C.difficultyLevel||"";break;case"duration":I=P.estimatedDuration||0,z=C.estimatedDuration||0;break;default:I=P.title.toLowerCase(),z=C.title.toLowerCase()}return v.sortOrder==="asc"?I<z?-1:I>z?1:0:I>z?-1:I<z?1:0}),b},[c,v]),{categoryItems:q}=Ue({content:N,selectedCategory:i==="all"?null:i,filterOptions:_}),R=bt({uiState:h,selectedCategory:i,categoryItems:q}),Ge=()=>R.shouldShowLoading?a.jsx(Y,{}):R.shouldShowError?a.jsx(Ct,{error:o,onRetry:d}):R.shouldShowEmpty?a.jsx(Fe,{selectedCategory:i}):R.shouldShowContent?a.jsx(Nt,{category:i,items:q,onStatusUpdate:w,onStartContent:M,CoursesTable:Qe,LearningPathwaysTable:Me,ProceduresTable:Re,PoliciesTable:Be}):null;return r?a.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"text-red-600 text-lg font-medium mb-2",children:"Something went wrong"}),a.jsx("div",{className:"text-gray-600 mb-4",children:r.message}),a.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Again"})]})}):a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[a.jsx(Qt,{onFiltersChange:U,selectedCategory:i||"all",onCategoryChange:A,statusOptions:x,difficultyOptions:D,durationOptions:m}),a.jsx(St,{category:i==="all"?"All Categories":i||"",isLoading:l}),(()=>{try{return Ge()}catch(b){return console.error("Error rendering content:",b),n(b instanceof Error?b:new Error("Unknown error")),null}})()]})});Ke.displayName="ContentTable";var Mt=Object.defineProperty,Rt=Object.defineProperties,Bt=Object.getOwnPropertyDescriptors,xe=Object.getOwnPropertySymbols,Kt=Object.prototype.hasOwnProperty,Ht=Object.prototype.propertyIsEnumerable,ve=(r,e,t)=>e in r?Mt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,we=(r,e)=>{for(var t in e||(e={}))Kt.call(e,t)&&ve(r,t,e[t]);if(xe)for(var t of xe(e))Ht.call(e,t)&&ve(r,t,e[t]);return r},be=(r,e)=>Rt(r,Bt(e)),$=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class Vt{getLearningInsights(){return $(this,null,function*(){try{const{data:{user:e}}=yield g.auth.getUser();if(!e)return null;const{data:t}=yield g.from("users").select("facility_id").eq("id",e.id).single(),{data:n,error:s}=yield g.from("ai_learning_insights").select("*").eq("user_id",e.id).eq("facility_id",t==null?void 0:t.facility_id).single();if(s&&s.code!=="PGRST116")throw s;return n}catch(e){return console.error("Error fetching AI learning insights:",e),null}})}getContentRecommendations(e=5){return $(this,null,function*(){try{const{data:{user:t}}=yield g.auth.getUser();if(!t)return[];const{data:n,error:s}=yield g.from("ai_content_recommendations").select("*").eq("user_id",t.id).gte("recommendation_score",70).order("recommendation_score",{ascending:!1}).limit(e);if(s){if(s.code==="42P01")return console.warn("ai_content_recommendations table does not exist, returning empty recommendations"),[];throw s}return n.map(i=>{var c;return{id:i.id,user_id:i.user_id,content_id:i.content_id,recommendation_score:i.recommendation_score,recommendation_type:i.recommendation_type,reasoning:i.reasoning,created_at:i.created_at,updated_at:i.updated_at,is_displayed:i.is_displayed,is_clicked:i.is_clicked,is_completed:i.is_completed,display_count:i.display_count,click_count:i.click_count,completion_count:i.completion_count,user_feedback:i.user_feedback,ai_model_version:i.ai_model_version,learning_context:i.learning_context,content_metadata:i.content_metadata,tags:(c=i.data)==null?void 0:c.tags,recommendation_reason:i.recommendation_reason||i.reasoning,confidence_level:i.confidence_level||.8,user_context:i.user_context||{},content_context:i.content_context||{},click_through_rate:i.click_through_rate||0,completion_rate:i.completion_rate||0,user_feedback_rating:i.user_feedback_rating||0,ai_confidence_score:i.ai_confidence_score||.8,recommendation_algorithm:i.recommendation_algorithm||"default",last_ai_analysis:i.last_ai_analysis||new Date().toISOString(),model_version:i.model_version||"1.0.0",feature_vector:i.feature_vector||[],algorithm_used:i.algorithm_used||"default",expires_at:i.expires_at||null,recommendation_timing:i.recommendation_timing||"immediate"}})||[]}catch(t){return console.error("Error fetching AI content recommendations:",t),[]}})}trackRecommendationInteraction(e,t){return $(this,null,function*(){try{const{data:{user:n}}=yield g.auth.getUser();if(!n)return!1;const s={};switch(t){case"displayed":s.is_displayed=!0,s.display_count=(s.display_count||0)+1;break;case"clicked":s.is_clicked=!0;break;case"completed":s.is_completed=!0;break}const{error:i}=yield g.from("ai_content_recommendations").update(s).eq("id",e).eq("user_id",n.id);if(i){if(i.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping interaction tracking"),!1;throw i}return!0}catch(n){return console.error("Error tracking recommendation interaction:",n),!1}})}storeLearningInsights(e){return $(this,null,function*(){try{const{data:{user:t}}=yield g.auth.getUser();if(!t)return!1;const{error:n}=yield g.from("ai_learning_insights").upsert(be(we({user_id:t.id},e),{last_ai_analysis:new Date().toISOString(),updated_at:new Date().toISOString()}));if(n)throw n;return!0}catch(t){return console.error("Error storing AI learning insights:",t),!1}})}storeContentRecommendation(e,t){return $(this,null,function*(){try{const{data:{user:n}}=yield g.auth.getUser();if(!n)return!1;const{error:s}=yield g.from("ai_content_recommendations").insert(be(we({user_id:n.id,content_id:e},t),{created_at:new Date().toISOString(),updated_at:new Date().toISOString()}));if(s){if(s.code==="42P01")return console.warn("ai_content_recommendations table does not exist, skipping recommendation storage"),!1;throw s}return!0}catch(n){return console.error("Error storing AI content recommendation:",n),!1}})}getLearningAnalytics(){return $(this,null,function*(){try{const{data:{user:e}}=yield g.auth.getUser();if(!e)return[];const{data:t,error:n}=yield g.from("ai_learning_analytics").select("*").eq("user_id",e.id).order("session_start",{ascending:!1}).limit(10);if(n)throw n;return t.map(s=>({id:s.id,user_id:s.user_id,content_id:s.content_id,progress_status:s.progress_status}))||[]}catch(e){return console.error("Error fetching learning analytics:",e),[]}})}storeSessionAnalytics(e){return $(this,null,function*(){try{const{data:{user:t}}=yield g.auth.getUser();if(!t)return!1;const{data:n,error:s}=yield g.from("users").select("facility_id").eq("id",t.id).single();if(s||!(n!=null&&n.facility_id))return console.error("Missing facility_id in user profile"),!1;const{error:i}=yield g.from("ai_learning_analytics").insert({user_id:t.id,facility_id:n.facility_id,session_start:new Date(e.session_start).toISOString(),content_items_accessed:e.content_items_accessed,learning_path_progress:e.learning_path_progress,learning_patterns:e.learning_patterns,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(i)throw i;return!0}catch(t){return console.error("Error storing learning session analytics:",t),!1}})}generateLearningInsights(){return $(this,null,function*(){try{const{data:{user:e}}=yield g.auth.getUser();if(!e)return null;const{data:t}=yield g.from("knowledge_hub_user_progress").select("*").eq("user_id",e.id);if(!t||t.length===0)return null;const n=this.analyzeLearningPatterns(t.map(s=>({id:s.id,user_id:s.user_id,content_id:s.content_id,progress_status:s.progress_status})));return yield this.storeLearningInsights(n),n}catch(e){return console.error("Error generating learning insights:",e),null}})}analyzeLearningPatterns(e){const t=e.filter(f=>f.progress_status==="completed"),n=e.length,s=t.length,i=n>0?s/n*100:0,c=e.reduce((f,w)=>{const S=w.content_type||"Unknown";return f[S]=(f[S]||0)+1,f},{}),l=Object.entries(c).sort(([,f],[,w])=>w-f).slice(0,3).map(([f])=>f),o=t.filter(f=>f.time_spent_minutes),d=o.length>0?Math.round(o.reduce((f,w)=>f+(w.time_spent_minutes||0),0)/o.length):30;return{learning_efficiency_score:Math.round(i),preferred_content_categories:l,optimal_study_duration:d,next_learning_milestone:this.predictNextMilestone(e),skill_gaps:this.identifySkillGaps(e),ai_confidence_score:.8,model_version:"v1.0"}}predictNextMilestone(e){const t=e.filter(n=>n.progress_status==="completed");return t.length===0?"Complete your first course":t.length<3?"Complete 3 courses to build foundation":t.length<10?"Complete 10 courses for intermediate level":"Achieve advanced certification"}identifySkillGaps(e){const t=[],n=new Set(e.filter(s=>s.progress_status==="completed").map(s=>s.content_type));return n.has("procedure")||t.push("Clinical Procedures"),n.has("policy")||t.push("Healthcare Policies"),n.has("learning_pathway")||t.push("Structured Learning Paths"),t}}var V=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});function Gt(){const[r,e]=u.useState(null),[t,n]=u.useState([]),[s,i]=u.useState(!1),[c,l]=u.useState(null),o=u.useMemo(()=>new Vt,[]),d=u.useCallback(()=>V(null,null,function*(){try{i(!0),l(null);const p=yield o.getLearningInsights();if(e(p),!p){const x=yield o.generateLearningInsights();x&&e(x)}}catch(p){l(p instanceof Error?p.message:"Failed to load learning insights")}finally{i(!1)}}),[o]),f=u.useCallback((p=5)=>V(null,null,function*(){try{i(!0),l(null);const x=yield o.getContentRecommendations(p);n(x)}catch(x){l(x instanceof Error?x.message:"Failed to load content recommendations")}finally{i(!1)}}),[o]),w=u.useCallback((p,x)=>V(null,null,function*(){try{yield o.trackRecommendationInteraction(p,x)}catch(D){console.error("Failed to track recommendation interaction:",D)}}),[o]),S=u.useCallback(p=>V(null,null,function*(){try{yield o.storeSessionAnalytics(p)}catch(x){console.error("Failed to store session analytics:",x)}}),[o]),v=u.useCallback(()=>V(null,null,function*(){try{i(!0),l(null);const p=yield o.generateLearningInsights();p&&e(p)}catch(p){l(p instanceof Error?p.message:"Failed to generate new insights")}finally{i(!1)}}),[o]);return u.useEffect(()=>{const p=setTimeout(()=>{d(),f()},200);return()=>clearTimeout(p)},[d,f]),{learningInsights:r,contentRecommendations:t,isLoading:s,error:c,loadLearningInsights:d,loadContentRecommendations:f,trackRecommendationInteraction:w,storeSessionAnalytics:S,generateNewInsights:v,refreshData:()=>{d(),f()}}}const He=T.memo(()=>{var r;const e=ke(),{content:t,isLoading:n}=Q(),{learningInsights:s,storeSessionAnalytics:i,isLoading:c}=Gt(),l=u.useCallback(()=>{e("/library")},[e]);return u.useCallback(o=>{console.error("Knowledge Hub error:",o)},[]),T.useEffect(()=>{const o=setTimeout(()=>{!c&&s&&i({session_start:new Date().toISOString(),content_items_accessed:["knowledge_hub_main"],learning_path_progress:{current_page:"knowledge_hub"}})},100);return()=>clearTimeout(o)},[c,s,i]),!n&&(!t||t.length===0)?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[a.jsx("p",{className:"text-lg font-medium",children:"No content yet"}),a.jsx("p",{className:"text-sm mt-1",children:"Add something from the Library to get started."})]}):a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Knowledge Hub"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"Access training materials and educational resources"})]}),a.jsx("button",{onClick:l,className:"rounded-md bg-[#4ECDC4] px-4 py-2 text-white hover:bg-[#3db8b0] transition",children:"+ Library"})]}),a.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[a.jsxs("div",{className:"lg:w-1/4 space-y-6",children:[a.jsx(yt,{}),a.jsx(vt,{}),!c&&s&&a.jsx("div",{className:"hidden",children:a.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"AI Learning Insights"}),a.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[a.jsxs("p",{children:["Efficiency: ",s==null?void 0:s.learning_efficiency_score,"%"]}),a.jsxs("p",{children:["Next Milestone: ",s==null?void 0:s.next_learning_milestone]}),a.jsxs("p",{children:["Optimal Study Time:"," ",s==null?void 0:s.optimal_study_duration," min"]}),((r=s==null?void 0:s.skill_gaps)==null?void 0:r.length)>0&&a.jsxs("p",{children:["Skill Gaps: ",s.skill_gaps.join(", ")]})]})]})})]}),a.jsx("div",{className:"lg:w-3/4",children:a.jsx(Ke,{})})]})]})});He.displayName="KnowledgeHubContent";const Ve=T.memo(()=>(u.useCallback(r=>{console.error("Knowledge Hub error:",r)},[]),a.jsx(ot,{children:a.jsx(Ze,{children:a.jsx(gt,{children:a.jsx(He,{})})})})));Ve.displayName="KnowledgeHub";const hr=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));var Yt=Object.defineProperty,Jt=Object.defineProperties,Zt=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,Wt=Object.prototype.hasOwnProperty,Xt=Object.prototype.propertyIsEnumerable,je=(r,e,t)=>e in r?Yt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Se=(r,e)=>{for(var t in e||(e={}))Wt.call(e,t)&&je(r,t,e[t]);if(Ce)for(var t of Ce(e))Xt.call(e,t)&&je(r,t,e[t]);return r},Ne=(r,e)=>Jt(r,Zt(e)),j=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class mr{getKnowledgeArticles(){return j(this,null,function*(){const{data:e,error:t}=yield g.from("knowledge_articles").select("*").eq("status","published").order("published_at",{ascending:!1});if(t)throw console.error("Error fetching knowledge articles:",t),new Error(`Failed to fetch knowledge articles: ${t.message}`);return(e||[]).map(s=>({id:s.id,title:s.title,content:s.content,category:s.category_id,status:s.status,created_at:s.created_at,updated_at:s.updated_at,published_at:s.published_at,summary:s.summary,tags:s.tags}))})}updateArticleStatus(e,t){return j(this,null,function*(){const{error:n}=yield g.from("knowledge_articles").update({status:t,updated_at:new Date().toISOString()}).eq("id",e);return{error:n==null?void 0:n.message}})}bulkUpdateArticlesStatus(e,t){return j(this,null,function*(){if(!e||e.length===0)return{success:!1,updatedCount:0,processedCount:0,errors:["No articles provided"]};const{error:n,count:s}=yield g.from("knowledge_articles").update({status:t,updated_at:new Date().toISOString()}).in("id",e).select("id");return n?{success:!1,updatedCount:0,processedCount:e.length,errors:[n.message]}:{success:!0,updatedCount:s||0,processedCount:e.length,errors:[]}})}deleteArticles(e){return j(this,null,function*(){if(!e||e.length===0)return{success:!1,deletedCount:0,processedCount:0,errors:["No articles provided"]};const{error:t,count:n}=yield g.from("knowledge_articles").update({status:"archived",updated_at:new Date().toISOString()}).in("id",e).select("id");return t?{success:!1,deletedCount:0,processedCount:e.length,errors:[t.message]}:{success:!0,deletedCount:n||0,processedCount:e.length,errors:[]}})}getLearningPathways(){return j(this,null,function*(){const{data:e,error:t}=yield g.from("knowledge_learning_paths").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching learning pathways:",t),new Error(`Failed to fetch learning pathways: ${t.message}`);return(e||[]).map(s=>({id:s.id,title:s.title,description:s.description,steps:[],status:s.is_active?"active":"inactive",created_at:s.created_at,updated_at:s.updated_at,difficulty_level:s.difficulty,estimated_time:parseInt(s.estimated_time)||0}))})}updateLearningPathStatus(e,t){return j(this,null,function*(){const{error:n}=yield g.from("knowledge_learning_paths").update({is_active:t,updated_at:new Date().toISOString()}).eq("id",e);return{error:n==null?void 0:n.message}})}bulkUpdateLearningPathsStatus(e,t){return j(this,null,function*(){if(!e||e.length===0)return{success:!1,updatedCount:0,processedCount:0,errors:["No pathways provided"]};const{error:n,count:s}=yield g.from("knowledge_learning_paths").update({is_active:t,updated_at:new Date().toISOString()}).in("id",e).select("id");return n?{success:!1,updatedCount:0,processedCount:e.length,errors:[n.message]}:{success:!0,updatedCount:s||0,processedCount:e.length,errors:[]}})}deleteLearningPaths(e){return j(this,null,function*(){if(!e||e.length===0)return{success:!1,deletedCount:0,processedCount:0,errors:["No pathways provided"]};const{error:t,count:n}=yield g.from("knowledge_learning_paths").update({is_active:!1,updated_at:new Date().toISOString()}).in("id",e).select("id");return t?{success:!1,deletedCount:0,processedCount:e.length,errors:[t.message]}:{success:!0,deletedCount:n||0,processedCount:e.length,errors:[]}})}getArticleById(e){return j(this,null,function*(){const{data:t,error:n}=yield g.from("knowledge_articles").select("*").eq("id",e).single();if(n)return{error:n.message};if(!t)return{error:"Article not found"};const s=t;return{data:{id:s.id,title:s.title,content:s.content,category:s.category_id,status:s.status,created_at:s.created_at,updated_at:s.updated_at,published_at:s.published_at,summary:s.summary,tags:s.tags}}})}getLearningPathById(e){return j(this,null,function*(){const{data:t,error:n}=yield g.from("knowledge_learning_paths").select("*").eq("id",e).single();if(n)return{error:n.message};if(!t)return{error:"Learning path not found"};const s=t;return{data:{id:s.id,title:s.title,description:s.description,steps:[],status:s.is_active?"active":"inactive",created_at:s.created_at,updated_at:s.updated_at,difficulty_level:s.difficulty,estimated_time:parseInt(s.estimated_time)||0}}})}getKnowledgeCategories(){return j(this,null,function*(){const{data:e,error:t}=yield g.from("knowledge_categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw console.error("Error fetching knowledge categories:",t),new Error(`Failed to fetch knowledge categories: ${t.message}`);return e||[]})}createArticle(e){return j(this,null,function*(){try{const{data:t,error:n}=yield g.from("knowledge_articles").insert([{title:e.title,content:e.content,summary:e.summary,category_id:e.category,tags:e.tags,status:e.status,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return n?{error:n.message}:{article:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to create article"}}})}updateArticle(e,t){return j(this,null,function*(){try{const{data:n,error:s}=yield g.from("knowledge_articles").update(Ne(Se({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();return s?{error:s.message}:{article:n}}catch(n){return{error:n instanceof Error?n.message:"Failed to update article"}}})}deleteArticle(e){return j(this,null,function*(){try{const{error:t}=yield g.from("knowledge_articles").update({status:"archived",updated_at:new Date().toISOString()}).eq("id",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete article"}}})}createLearningPath(e){return j(this,null,function*(){try{const{data:t,error:n}=yield g.from("knowledge_learning_paths").insert([{title:e.title,description:e.description,category:e.category,difficulty:e.difficulty,estimated_time:e.estimated_time,is_active:e.is_active,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return n?{error:n.message}:{pathway:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to create learning path"}}})}updateLearningPath(e,t){return j(this,null,function*(){try{const{data:n,error:s}=yield g.from("knowledge_learning_paths").update(Ne(Se({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();return s?{error:s.message}:{pathway:n}}catch(n){return{error:n instanceof Error?n.message:"Failed to update learning path"}}})}deleteLearningPath(e){return j(this,null,function*(){try{const{error:t}=yield g.from("knowledge_learning_paths").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete learning path"}}})}addCategory(e){return j(this,null,function*(){try{const{data:t,error:n}=yield g.from("knowledge_categories").insert([{name:e,is_active:!0,sort_order:999,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return n?{error:n.message}:{category:t}}catch(t){return{error:t instanceof Error?t.message:"Failed to add category"}}})}deleteCategory(e){return j(this,null,function*(){try{const{error:t}=yield g.from("knowledge_categories").update({is_active:!1,updated_at:new Date().toISOString()}).eq("name",e);return{error:t==null?void 0:t.message}}catch(t){return{error:t instanceof Error?t.message:"Failed to delete category"}}})}getRecentUserActivity(e,t){return j(this,null,function*(){try{let n=g.from("activity_feed").select("*").order("created_at",{ascending:!1});e&&(n=n.eq("user_id",e)),t?n=n.limit(t):n=n.limit(50);const{data:s,error:i}=yield n;return i?(console.error("Error fetching recent user activity:",i),[]):s||[]}catch(n){return console.error("Failed to get recent user activity:",n),[]}})}}var y=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class pr{static getKnowledgeArticles(){return y(this,null,function*(){return B.getKnowledgeArticles()})}static getKnowledgeArticleById(e){return y(this,null,function*(){return B.getKnowledgeArticleById(e)})}static createKnowledgeArticle(e){return y(this,null,function*(){return B.createKnowledgeArticle(e)})}static updateKnowledgeArticle(e,t){return y(this,null,function*(){return B.updateKnowledgeArticle(e,t)})}static deleteKnowledgeArticle(e){return y(this,null,function*(){return B.deleteKnowledgeArticle(e)})}static updateContentStatus(e,t){return y(this,null,function*(){return B.updateContentStatus(e,t)})}static bulkUpdateContentStatus(e,t){return y(this,null,function*(){return J.bulkUpdateContentStatus(e,t)})}static bulkDeleteContent(e){return y(this,null,function*(){return J.bulkDeleteContent(e)})}static getLearningPathways(){return y(this,null,function*(){return K.getLearningPathways()})}static getLearningPathwayById(e){return y(this,null,function*(){return K.getLearningPathwayById(e)})}static createLearningPathway(e){return y(this,null,function*(){return K.createLearningPathway(e)})}static updateLearningPathway(e,t){return y(this,null,function*(){return K.updateLearningPathway(e,t)})}static deleteLearningPathway(e){return y(this,null,function*(){return K.deleteLearningPathway(e)})}static updateLearningPathStatus(e,t){return y(this,null,function*(){return K.updateLearningPathStatus(e,t)})}static bulkUpdateLearningPathStatus(e,t){return y(this,null,function*(){return J.bulkUpdateLearningPathStatus(e,t)})}static bulkDeleteLearningPathways(e){return y(this,null,function*(){return J.bulkDeleteLearningPathways(e)})}static getKnowledgeCategories(){return y(this,null,function*(){return ee.getKnowledgeCategories()})}static addCategory(e){return y(this,null,function*(){return ee.addCategory(e)})}static deleteCategory(e){return y(this,null,function*(){return ee.deleteCategory(e)})}static getAllContent(){return y(this,null,function*(){return de.getAllContent()})}static getRecentUserActivity(e,t){return y(this,null,function*(){return de.getRecentUserActivity(e,t)})}static getQuizzes(){return y(this,null,function*(){return F.getQuizzes()})}static getQuizById(e){return y(this,null,function*(){return F.getQuizById(e)})}static startQuizAttempt(e){return y(this,null,function*(){return F.startQuizAttempt(e)})}static submitQuizAnswers(e,t){return y(this,null,function*(){return F.submitQuizAnswers(e,t)})}static getUserQuizAttempts(){return y(this,null,function*(){return F.getUserQuizAttempts()})}static createQuiz(e){return y(this,null,function*(){return F.createQuiz(e)})}static updateQuiz(e,t){return y(this,null,function*(){return F.updateQuiz(e,t)})}static deleteQuiz(e){return y(this,null,function*(){return F.deleteQuiz(e)})}}var er=Object.defineProperty,tr=Object.defineProperties,rr=Object.getOwnPropertyDescriptors,Pe=Object.getOwnPropertySymbols,nr=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable,Ee=(r,e,t)=>e in r?er(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ar=(r,e)=>{for(var t in e||(e={}))nr.call(e,t)&&Ee(r,t,e[t]);if(Pe)for(var t of Pe(e))sr.call(e,t)&&Ee(r,t,e[t]);return r},ir=(r,e)=>tr(r,rr(e)),L=(r,e,t)=>new Promise((n,s)=>{var i=o=>{try{l(t.next(o))}catch(d){s(d)}},c=o=>{try{l(t.throw(o))}catch(d){s(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(r,e)).next())});class or{static getQuizzesByCategory(e){return L(this,null,function*(){try{const{data:t,error:n}=yield g.from("knowledge_quizzes").select("*").eq("category_id",e).eq("is_active",!0).order("created_at",{ascending:!1});if(n)throw console.error("Error fetching quizzes:",n),new Error("Failed to fetch quizzes");return t?(t||[]).map(s=>{var i;return{id:s.id,title:s.title,description:s.description||((i=s.data)==null?void 0:i.description),category_id:s.category_id,facility_id:s.facility_id,passing_score:s.passing_score,time_limit_minutes:s.time_limit_minutes,is_active:s.is_active,created_at:s.created_at,updated_at:s.updated_at}}):[]}catch(t){return console.error("Error in getQuizzesByCategory:",t),[]}})}static getQuizWithQuestions(e){return L(this,null,function*(){try{const{data:t,error:n}=yield g.from("knowledge_quizzes").select("*").eq("id",e).eq("is_active",!0).single();if(n||!t)return console.error("Error fetching quiz:",n),null;const{data:s,error:i}=yield g.from("knowledge_quiz_questions").select("*").eq("quiz_id",e).eq("is_active",!0).order("question_order",{ascending:!0});if(i)return console.error("Error fetching quiz questions:",i),null;const c=t,l={id:c.id,title:c.title,description:c.description,category_id:c.category_id,facility_id:c.facility_id,passing_score:c.passing_score,time_limit_minutes:c.time_limit_minutes,is_active:c.is_active,created_at:c.created_at,updated_at:c.updated_at};if(!s)return null;const o=(s||[]).map(d=>({id:d.id,quiz_id:d.quiz_id,question_text:d.question_text,question_type:d.question_type||"multiple_choice",options:d.options||[],correct_answer:d.correct_answer||"",explanation:d.explanation,question_order:d.question_order,points:d.points,is_active:d.is_active,created_at:d.created_at,updated_at:d.updated_at}));return{quiz:l,questions:o}}catch(t){return console.error("Error in getQuizWithQuestions:",t),null}})}static startQuizAttempt(e,t){return L(this,null,function*(){try{const n=t||(yield this.getCurrentUserId());if(!n)throw new Error("User not authenticated");const s=yield this.getQuizWithQuestions(e);if(!s)throw new Error("Quiz not found or inactive");const{data:i}=yield g.from("knowledge_quiz_attempts").select("*").eq("user_id",n).eq("quiz_id",e).eq("status","started").single();if(i){const f=i;return{id:f.id,user_id:f.user_id,quiz_id:f.quiz_id,status:"started",score_percentage:f.score||0,total_questions:s.questions.length,correct_answers:0,started_at:f.started_at,completed_at:f.completed_at,time_spent_seconds:f.time_spent_minutes?f.time_spent_minutes*60:0,answers:f.answers}}const c={user_id:n,quiz_id:e,status:"started",score_percentage:0,total_questions:s.questions.length,correct_answers:0,started_at:new Date().toISOString()},{data:l,error:o}=yield g.from("knowledge_quiz_attempts").insert({user_id:c.user_id,quiz_id:c.quiz_id,started_at:c.started_at,answers:[]}).select().single();if(o)return console.error("Error starting quiz attempt:",o),null;if(!l)return null;const d=l;return{id:d.id,user_id:d.user_id,quiz_id:d.quiz_id,status:"started",score_percentage:0,total_questions:s.questions.length,correct_answers:0,started_at:d.started_at,completed_at:d.completed_at,time_spent_seconds:0,answers:d.answers}}catch(n){return console.error("Error in startQuizAttempt:",n),null}})}static submitQuizAttempt(e,t){return L(this,null,function*(){try{const{data:n,error:s}=yield g.from("knowledge_quiz_attempts").select("*").eq("id",e).single();if(s||!n)throw new Error("Quiz attempt not found");const i=n,c=yield this.getQuizWithQuestions(i.quiz_id);if(!c)throw new Error("Quiz not found");let l=0;const o=c.questions.length;for(const v of t){const p=c.questions.find(x=>x.id===v.question_id);p&&v.user_answer===p.correct_answer&&l++}const d=Math.round(l/o*100),f=d>=c.quiz.passing_score,w={status:"completed",score_percentage:d,correct_answers:l,completed_at:new Date().toISOString(),answers:t},{error:S}=yield g.from("knowledge_quiz_attempts").update({status:w.status,score_percentage:w.score_percentage,correct_answers:w.correct_answers,completed_at:w.completed_at,answers:w.answers}).eq("id",e);return S?(console.error("Error updating quiz attempt:",S),{success:!1,score:0,passed:!1}):{success:!0,score:d,passed:f}}catch(n){return console.error("Error in submitQuizAttempt:",n),{success:!1,score:0,passed:!1}}})}static getUserQuizAttempts(e){return L(this,null,function*(){try{const t=e||(yield this.getCurrentUserId());if(!t)throw new Error("User not authenticated");const{data:n,error:s}=yield g.from("knowledge_quiz_attempts").select("*").eq("user_id",t).order("started_at",{ascending:!1});return s?(console.error("Error fetching user quiz attempts:",s),[]):n?(n||[]).map(i=>({id:i.id,user_id:i.user_id,quiz_id:i.quiz_id,status:"started",score_percentage:i.score||0,total_questions:0,correct_answers:0,started_at:i.started_at,completed_at:i.completed_at,time_spent_seconds:i.time_spent_minutes?i.time_spent_minutes*60:0,answers:i.answers||[]})):[]}catch(t){return console.error("Error in getUserQuizAttempts:",t),[]}})}static getCurrentUserId(){return L(this,null,function*(){try{const{data:{user:e}}=yield g.auth.getUser();return(e==null?void 0:e.id)||null}catch(e){return console.error("Error getting current user:",e),null}})}static getAllQuizzes(){return L(this,null,function*(){try{const{data:e,error:t}=yield g.from("knowledge_quizzes").select("*").eq("is_active",!0).order("created_at",{ascending:!1});return t?(console.error("Error fetching all quizzes:",t),[]):e?(e||[]).map(n=>{var s;return{id:n.id,title:n.title,description:n.description||((s=n.data)==null?void 0:s.description),category_id:n.category_id,facility_id:n.facility_id,passing_score:n.passing_score,time_limit_minutes:n.time_limit_minutes,is_active:n.is_active,created_at:n.created_at,updated_at:n.updated_at}}):[]}catch(e){return console.error("Error in getAllQuizzes:",e),[]}})}static createQuiz(e){return L(this,null,function*(){try{if(!(yield this.getCurrentUserId()))throw new Error("User not authenticated");const{FacilityService:n}=yield Oe(()=>import("./services-CE_LtFqr.js").then(o=>o.aC),__vite__mapDeps([4,0,1,2,3,6,7,8,9,5])),s=yield n.getCurrentFacilityId(),{data:i,error:c}=yield g.from("knowledge_quizzes").insert({title:e.title,description:e.description,category_id:e.category_id,facility_id:s,passing_score:e.passing_score,time_limit_minutes:e.time_limit_minutes,is_active:!0}).select().single();if(c)return console.error("Error creating quiz:",c),null;if(!i)return null;const l=i;return{id:l.id,title:l.title,description:l.description,category_id:l.category_id,facility_id:l.facility_id,passing_score:l.passing_score,time_limit_minutes:l.time_limit_minutes,is_active:l.is_active,created_at:l.created_at,updated_at:l.updated_at}}catch(t){return console.error("Error in createQuiz:",t),null}})}static updateQuiz(e,t){return L(this,null,function*(){try{const{data:n,error:s}=yield g.from("knowledge_quizzes").update(ir(ar({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();if(s)return console.error("Error updating quiz:",s),null;if(!n)return null;const i=n;return{id:i.id,title:i.title,description:i.description,category_id:i.category_id,facility_id:i.facility_id,passing_score:i.passing_score,time_limit_minutes:i.time_limit_minutes,is_active:i.is_active,created_at:i.created_at,updated_at:i.updated_at}}catch(n){return console.error("Error in updateQuiz:",n),null}})}static deleteQuiz(e){return L(this,null,function*(){try{const{error:t}=yield g.from("knowledge_quizzes").delete().eq("id",e);return t?(console.error("Error deleting quiz:",t),!1):!0}catch(t){return console.error("Error in deleteQuiz:",t),!1}})}}const _r=Object.freeze(Object.defineProperty({__proto__:null,QuizService:or},Symbol.toStringTag,{value:"Module"}));export{Vt as A,pr as K,mr as U,hr as i,_r as q};
