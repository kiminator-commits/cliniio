import{r as p,j as e,Q as R,I as k}from"./react-vendor-DBfrHuQ-.js";import{S as E,N as I,O as $,B as P,s as O,P as F,W as q,Q as L,V as Q,X as Z,Y as H,Z as z,$ as V,a0 as B}from"./components-BtXJbSH9.js";import{c as M,R as X,Z as Y}from"./ui-vendor-BmV1twT8.js";import{q as G,aC as J}from"./services-JA4N6ZXe.js";import{m as A}from"./utils-vendor-BtegoRPv.js";const D=()=>e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}),_=p.memo(()=>e.jsx(R,{FallbackComponent:D,children:e.jsx(E,{children:e.jsx("div",{className:"p-6 space-y-6",children:e.jsx(R,{FallbackComponent:D,children:e.jsx(I,{SterilizationAnalyticsComponent:$})})})})}));_.displayName="Sterilization";const ue=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"}));var K=(t,m,r)=>new Promise((h,g)=>{var i=s=>{try{a(r.next(s))}catch(c){g(c)}},n=s=>{try{a(r.throw(s))}catch(c){g(c)}},a=s=>s.done?h(s.value):Promise.resolve(s.value).then(i,n);a((r=r.apply(t,m)).next())});const ee=()=>{const[t,m]=p.useState(!1),[r,h]=p.useState(""),[g,i]=p.useState(null),[n,a]=p.useState(""),{availableTools:s,addToolToCycle:c}=P();return{isScanning:t,scannedCode:r,scanResult:g,scanMessage:n,simulateScan:(d,y,S=!1)=>K(null,null,function*(){var f;m(!0),a(`Scanning tool for ${d} workflow...`);try{if(d==="clean"){const{data:o}=yield O.from("tools").select("barcode").eq("status","clean").eq("facility_id","550e8400-e29b-41d4-a716-446655440000").limit(10);let l;!o||o.length===0?(console.log("üß™ No clean tools found in database, using mock data for testing"),l="TEST-CLEAN-001"):l=o[Math.floor(Math.random()*o.length)].barcode;const x=yield G.scanToolForCleanWorkflow(l);h(((f=x.tool)==null?void 0:f.barcode)||""),x.success&&x.tool?(c(x.tool.id),i("success"),a(x.message),S||setTimeout(y,2e3)):(i("error"),a(x.message))}else{setTimeout(()=>{var o;const l=J.scanTool(d,s);h(((o=l.tool)==null?void 0:o.barcode)||""),l.success&&l.tool?(c(l.tool.id),i("success"),a(l.message),S||setTimeout(y,2e3)):(i("error"),a(l.message)),m(!1)},1e3);return}}catch(o){console.error("Error during scan:",o),i("error"),a("An unexpected error occurred during scanning.")}finally{m(!1)}})}},ae=()=>{const{setWorkflowType:t,setScannedData:m,scannedData:r}=P(),{isScanning:h,scanResult:g,scanMessage:i,simulateScan:n}=ee(),[a,s]=p.useState(""),[c,b]=p.useState(!1),[d,y]=p.useState("single"),S=u=>{console.log("ScannerPage: Workflow selected:",u),s(u),t(u),b(!1)},f=()=>{console.log("üîß handleBackToWorkflow called"),s(""),t(""),m(""),b(!1),console.log("üîß Returning to workflow selection...")},{scannedTools:o,handleSendToBath1:l,handleScanTool:x,scanMessage:N,isBath1Active:w,clearScannedTools:v,replacementAlert:C,handleReplaceTool:T,handleContinueAnyway:W,handleDismissReplacementAlert:j}=F({scannedData:r||"",onClose:()=>{console.log("üîß Dirty workflow onClose called - navigating back to sterilization page"),window.history.back()},batchMode:d==="batch"});return{selectedWorkflow:a,showWorkflowResult:c,scanMode:d,isScanning:h,scanResult:g,scanMessage:i,scannedData:r,scannedTools:o,dirtyScanMessage:N,isBath1Active:w,replacementAlert:C,handleWorkflowSelect:S,handleBackToWorkflow:f,handleScan:()=>{a&&(a==="clean"?n(a,()=>{setTimeout(()=>{b(!0)},1e3)},!1):n(a,()=>{},!1))},handleCloseWorkflow:()=>{b(!1),f()},handleReceiptUploadSuccess:u=>{console.log("Receipt uploaded successfully:",u),window.history.back()},handleReceiptUploadCancel:()=>{f()},handleDeleteTool:u=>{console.log("Delete tool:",u)},handleCancelAll:()=>{v(),console.log("Cancel all tools")},handleSendScannedToBath1:()=>{console.log("üß™ scannedTools.length:",o.length),console.log("üß™ handleSendToBath1:",typeof l),l(o)},handleScanModeChange:u=>{y(u),v()},handleScanTool:x,handleReplaceTool:T,handleContinueAnyway:W,handleDismissReplacementAlert:j,clearScannedTools:v}},U=p.memo(()=>{const{selectedWorkflow:t,scannedData:m,showWorkflowResult:r,scanMode:h,isScanning:g,scanMessage:i,scannedTools:n,dirtyScanMessage:a,isBath1Active:s,replacementAlert:c,handleWorkflowSelect:b,handleBackToWorkflow:d,handleScan:y,handleCloseWorkflow:S,handleReceiptUploadSuccess:f,handleReceiptUploadCancel:o,handleDeleteTool:l,handleCancelAll:x,handleSendScannedToBath1:N,handleScanModeChange:w,handleScanTool:v,handleReplaceTool:C,handleContinueAnyway:T,handleDismissReplacementAlert:W}=ae();return e.jsxs(e.Fragment,{children:[e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:()=>window.history.back()}),e.jsx(A.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:e.jsx("div",{className:"h-full flex flex-col",children:e.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Sterilization Scanner"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Scan tools for sterilization workflows"})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",style:{maxHeight:"calc(100vh - 120px)"},children:t?t==="import"?e.jsx("div",{children:e.jsx(L,{batchCode:"",operator:"",onSuccess:f,onCancel:o})}):t==="problem"?e.jsx("div",{children:e.jsx(Q,{onClose:d})}):t==="clean"&&r?e.jsx("div",{children:e.jsx(Z,{scannedData:m,onClose:S})}):t==="packaging"?e.jsx("div",{children:e.jsx(H,{onClose:d,isBatchMode:h==="batch"})}):t==="dirty"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{workflowId:"dirty",color:"orange"}),s&&e.jsx("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{path:M,size:.8,className:"text-red-600"}),e.jsx("span",{className:"text-red-700 text-xs font-medium",children:"Bath 1 is currently active"})]})}),c.show&&c.tool&&e.jsx(V,{tool:c.tool,onDismiss:W,onReplace:C,onContinue:T}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w("single"),className:`px-3 py-1.5 rounded text-sm transition-colors ${h==="single"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Single Scan"}),e.jsx("button",{onClick:()=>w("batch"),className:`px-3 py-1.5 rounded text-sm transition-colors ${h==="batch"?"bg-green-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Batch Scan"})]}),e.jsx(B,{isScanning:g,scanMessage:a,onScan:v,size:"small"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-gray-800 text-sm",children:["Scanned Tools (",n.length,")"]}),n.length===0?e.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 p-4 rounded text-center",children:[e.jsx(k,{path:X,size:1.5,className:"text-gray-400 mx-auto mb-1"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No tools scanned yet"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Use the scanner above to add tools"})]}):e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 scrollbar-hide hide-scrollbar",children:n.map(j=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:j.name}),e.jsxs("span",{className:"text-gray-600 text-xs ml-2",children:["(",j.barcode,")"]})]}),e.jsx("button",{onClick:()=>l(j.id),className:"text-red-500 hover:text-red-700 p-1",title:"Remove tool",children:e.jsx(k,{path:Y,size:.7})})]},j.id))})]}),s&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{path:M,size:1,className:"text-orange-600"}),e.jsx("span",{className:"text-orange-800 text-sm font-medium",children:"‚ö†Ô∏è Bath 1 timer is already in process"})]}),e.jsx("p",{className:"text-orange-600 text-xs mt-1",children:"Please wait for the current Bath 1 phase to complete before starting a new one."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:x,disabled:n.length===0,className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n.length===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,children:"Cancel"}),e.jsx("button",{onClick:N,disabled:n.length===0||s,className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n.length===0||s?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,title:s?"Bath 1 timer is already in process":void 0,children:"Send to Bath 1"})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:d,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"‚Üê Back to Workflow Selection"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(z,{workflowId:t,color:"blue"}),e.jsx(B,{isScanning:g,scanMessage:i,onScan:y,size:"large"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:d,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"‚Üê Back to Workflow Selection"})})]}):e.jsx(q,{onWorkflowSelect:b})})]})})})]})});U.displayName="ScannerPage";const pe=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{ue as S,pe as a};
