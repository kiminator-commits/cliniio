const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/authService-BA4JXlKn.js","assets/js/login-CtXU169Q.js","assets/js/utils-DSBVV_PW.js","assets/js/vendor-DoALFvsH.js","assets/js/data-73RVSc-N.js","assets/js/ui-DETUEJ2B.js","assets/js/BIFailureNotificationService-COBdTRhi.js","assets/js/enhancedGamification-YRW8WA9o.js","assets/js/streakExclusionUtils-BvcmMtsM.js","assets/js/taskService-Dic_JfU8.js","assets/js/InventoryServiceFactory-B9RA95iw.js","assets/js/errorHandlingService-BCXz5YQH.js","assets/js/settingsService-CLvfY-tc.js","assets/js/cleaningScheduleService-DFfBa6lH.js","assets/js/duplicatePreventionService-Cw2fNCJ9.js","assets/js/RecentActivity-BobxRaD1.js","assets/js/BITestResults-BAtbM-Ro.js","assets/js/ToolStatus-Bl7P6bcE.js","assets/js/InventoryTableSection-lMhbxIb_.js","assets/css/InventoryTableSection-C5EAgt_r.css","assets/js/InventoryInsightsCard-BnnydXz1.js","assets/js/CategoriesCard-GHppL70t.js","assets/js/LibraryFilters-Bs_G3a4n.js","assets/js/LibraryHeader-D6u4VL6S.js","assets/js/aiSuggestionsService-CrJvp41A.js","assets/js/index-DOKVnp66.js","assets/js/inventoryTransformers-BSO01pnq.js","assets/js/index-CseH7xNd.js","assets/js/index-CBzgsefj.js","assets/js/AuthCallback-0dK93gDT.js","assets/js/HelpArticlePage-xw8GXEzZ.js","assets/css/HelpArticlePage-04dAlKem.css"])))=>i.map(i=>d[i]);
var ph=Object.defineProperty,fh=Object.defineProperties;var gh=Object.getOwnPropertyDescriptors;var Ms=Object.getOwnPropertySymbols;var Ki=Object.prototype.hasOwnProperty,Qi=Object.prototype.propertyIsEnumerable;var Gi=(s,e,t)=>e in s?ph(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,re=(s,e)=>{for(var t in e||(e={}))Ki.call(e,t)&&Gi(s,t,e[t]);if(Ms)for(var t of Ms(e))Qi.call(e,t)&&Gi(s,t,e[t]);return s},we=(s,e)=>fh(s,gh(e));var Oe=(s,e)=>{var t={};for(var n in s)Ki.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&Ms)for(var n of Ms(s))e.indexOf(n)<0&&Qi.call(s,n)&&(t[n]=s[n]);return t};var Fs=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});import{j as r,c as or,A as zn,m as se,n as zs}from"./utils-DSBVV_PW.js";import{c as yh,b as vi,a as m,d as Ln,N as xi,e as Ts,u as Ur,R as X,L as Xd,f as $r,B as vh,h as xh,i as xe}from"./vendor-DoALFvsH.js";import{l as R,r as Ve,i as ht,s as _,p as rr,u as gt,j as cr,k as Pn,R as Za,_ as q,I,n as Bn,o as qn,b as Pe,q as de,t as Rn,v as lr,w as Ss,x as bh,y as Cs,z as Ue,A as bi,B as Zd,C as it,D as ei,E as _i,a as wi,G as eu,H as tu,J as _h,K as wh,L as Sh,M as Ch,N as jh,O as Nh,P as Ih,Q as Th,S as ru,T as Ls,U as at,V as Es,W as Eh,X as kh,Y as ti,Z as su,$ as Lr,a0 as Dh,a1 as Ph,a2 as Rh,a3 as Yi,a4 as An,a5 as Ah,a6 as ue,a7 as nu,a8 as ks,a9 as au,aa as Ds,ab as Oh,ac as $h,ad as ri,ae as iu,af as Mh,ag as Fh,ah as zh,ai as Lh,aj as Ji,h as Bh,f as qh,ak as js,al as Uh,am as Hh,an as Vh,ao as Si,ap as ou,aq as Wh,ar as xt,as as lu,at as On,au as cu,av as Ye,aw as Br,ax as qe,ay as Gh,az as du,aA as Kh,aB as $n,aC as Qh,aD as uu,aE as Yh,aF as Jh,aG as Xh,aH as Mn,aI as mu,aJ as si,aK as Zh,aL as Ci,aM as ji,aN as nt,aO as Xi,aP as ep,aQ as tp,aR as rp,aS as hu,aT as sp,aU as pu,aV as ea,aW as fu,aX as np,aY as gu,aZ as yu,a_ as ap,a$ as ip,b0 as op,b1 as lp,b2 as vu,b3 as xu,b4 as ta,b5 as cp,b6 as dp,b7 as up,b8 as Ni,b9 as bu,ba as mp,bb as hp,bc as pp,bd as fp,be as Ns,bf as _u,bg as gp,bh as yp,bi as vp,bj as xp,bk as bp,bl as _p,bm as Zi,bn as eo,bo as wp,bp as Sp,bq as Cp,br as jp}from"./login-CtXU169Q.js";import{c as Ft,u as Np,Q as Ip,a as Tp}from"./data-73RVSc-N.js";import{G as Ep,a as kp}from"./ui-DETUEJ2B.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var Bs={},to;function Dp(){if(to)return Bs;to=1;var s=yh();return Bs.createRoot=s.createRoot,Bs.hydrateRoot=s.hydrateRoot,Bs}var Pp=Dp();const Rp=vi(Pp),wu=m.createContext(void 0),ro="cliniio_menu_expanded",Ap=({children:s})=>{const[e,t]=m.useState(!0),n=m.useRef(e);m.useEffect(()=>{if(n.current!==e){n.current=e;const d=setTimeout(()=>{try{localStorage.setItem(ro,JSON.stringify(e))}catch(u){console.warn("Failed to save menu state to localStorage:",u)}},0);return()=>clearTimeout(d)}},[e]);const a=m.useCallback(()=>{t(!0)},[]),i=m.useCallback(()=>{t(!1)},[]),c=m.useCallback(()=>{t(d=>!d)},[]),l=m.useCallback(()=>{t(!0);try{localStorage.removeItem(ro)}catch(d){console.warn("Failed to clear menu state from localStorage:",d)}},[]),o={isDrawerOpen:e,openDrawer:a,closeDrawer:i,toggleDrawer:c,resetToExpanded:l};return r.jsx(wu.Provider,{value:o,children:s})},Su=()=>{const s=m.useContext(wu);if(s===void 0)throw new Error("useNavigation must be used within a NavigationProvider");return s},Op=50;var Gr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class $p{constructor(e="cliniio"){this.cache=new Map,this.namespace=e}getKey(e){return`${this.namespace}:${e}`}get(e){return Gr(this,null,function*(){try{const t=this.cache.get(this.getKey(e));return t&&t.expires>Date.now()?t.value:(t&&this.cache.delete(this.getKey(e)),null)}catch(t){return R.error("In-memory cache get error:",t),null}})}set(e,t){return Gr(this,arguments,function*(n,a,i={}){try{const c=i.ttl||300,l=Date.now()+c*1e3;this.cache.set(this.getKey(n),{value:a,expires:l})}catch(c){R.error("In-memory cache set error:",c)}})}del(e){return Gr(this,null,function*(){try{this.cache.delete(this.getKey(e))}catch(t){R.error("In-memory cache delete error:",t)}})}exists(e){return Gr(this,null,function*(){try{const t=this.cache.get(this.getKey(e));return t?t.expires>Date.now():!1}catch(t){return R.error("In-memory cache exists error:",t),!1}})}clear(){return Gr(this,null,function*(){try{this.cache.clear()}catch(e){R.error("In-memory cache clear error:",e)}})}cleanup(){const e=Date.now();for(const[t,n]of this.cache.entries())n.expires<=e&&this.cache.delete(t)}getStats(){return{size:this.cache.size,isRedis:!1}}}var Kr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Cu{constructor(e="cliniio"){this.namespace=e,this.fallbackCache=new $p(e)}getKey(e){return`${this.namespace}:${e}`}get(e){return Kr(this,null,function*(){try{if(Ve.isHealthy()){const n=yield Ve.getClient().get(this.getKey(e));return n?JSON.parse(n):null}else return yield this.fallbackCache.get(e)}catch(t){return R.error("Cache get error:",t),yield this.fallbackCache.get(e)}})}set(e,t){return Kr(this,arguments,function*(n,a,i={}){try{if(Ve.isHealthy()){const c=Ve.getClient(),l=i.ttl||300;yield c.setEx(this.getKey(n),l,JSON.stringify(a))}else yield this.fallbackCache.set(n,a,i)}catch(c){R.error("Cache set error:",c),yield this.fallbackCache.set(n,a,i)}})}del(e){return Kr(this,null,function*(){try{Ve.isHealthy()?yield Ve.getClient().del(this.getKey(e)):yield this.fallbackCache.del(e)}catch(t){R.error("Cache delete error:",t),yield this.fallbackCache.del(e)}})}exists(e){return Kr(this,null,function*(){try{return Ve.isHealthy()?(yield Ve.getClient().exists(this.getKey(e)))===1:yield this.fallbackCache.exists(e)}catch(t){return R.error("Cache exists error:",t),yield this.fallbackCache.exists(e)}})}clear(){return Kr(this,null,function*(){try{if(Ve.isHealthy()){const e=Ve.getClient(),t=yield e.keys(this.getKey("*"));t.length>0&&(yield e.del(t))}else yield this.fallbackCache.clear()}catch(e){R.error("Cache clear error:",e),yield this.fallbackCache.clear()}})}cleanup(){this.fallbackCache.cleanup()}getStats(){return{size:this.fallbackCache.getStats().size,isRedis:Ve.isHealthy()}}}var qs=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Mp{constructor(){this.CACHE_DURATION=300,this.FACILITY_KEY_PREFIX="facility",this.cache=new Cu("facility")}getFacility(e){return qs(this,null,function*(){try{const t=`${this.FACILITY_KEY_PREFIX}:${e}`,n=yield this.cache.get(t);return n&&this.isCacheValid(n)?(ht()&&Math.random()<.1&&R.debug(`Facility cache hit for ID: ${e}`),n.facility):(n&&(yield this.cache.del(t)),null)}catch(t){return R.error("Error getting facility from cache:",t),null}})}setFacility(e,t){return qs(this,null,function*(){try{const n=`${this.FACILITY_KEY_PREFIX}:${e}`,a={facility:t,timestamp:Date.now()};yield this.cache.set(n,a,{ttl:this.CACHE_DURATION}),ht()&&Math.random()<.1&&R.debug(`Facility cached for ID: ${e}`)}catch(n){R.error("Error setting facility in cache:",n)}})}invalidateFacility(e){return qs(this,null,function*(){try{const t=`${this.FACILITY_KEY_PREFIX}:${e}`;yield this.cache.del(t),R.debug(`Facility cache invalidated for ID: ${e}`)}catch(t){R.error("Error invalidating facility cache:",t)}})}clearAll(){return qs(this,null,function*(){try{yield this.cache.clear(),R.info("All facility cache cleared")}catch(e){R.error("Error clearing facility cache:",e)}})}isCacheValid(e){return Date.now()-e.timestamp<this.CACHE_DURATION*1e3}getStats(){return this.cache.getStats()}cleanup(){this.cache.cleanup()}}const Ze=new Mp;var zt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Mt{static getCurrentFacilityId(){return zt(this,null,function*(){var e;try{if(!_)throw new Error("Supabase client is not initialized");const t=yield _.auth.getUser(),n=(e=t==null?void 0:t.data)==null?void 0:e.user,a=t==null?void 0:t.error,c=`facility:${(n==null?void 0:n.id)||"anon"}`,l=yield Ze.getFacility(c);if(l)return l.id;if(a||!n){if(ht()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const h={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield Ze.setFacility(c,h);else throw new Error("Facility lookup failed in production — no fallback to dev facility allowed.");return h.id}throw new Error("User not authenticated")}const{data:o,error:d}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(d||!(o!=null&&o.facility_id)){if(ht()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const h={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield Ze.setFacility(c,h);else throw new Error("Facility lookup failed in production — no fallback to dev facility allowed.");return h.id}throw new Error("User facility not found")}try{const u=yield this.getFacilityById(o.facility_id);return yield Ze.setFacility(c,u),u.id}catch(u){if(ht()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const p={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield Ze.setFacility(c,p);else throw new Error("Facility lookup failed in production — no fallback to dev facility allowed.");return p.id}throw u}}catch(t){if(console.error("Failed to get current facility ID:",t),ht()||!1||typeof globalThis!="undefined"&&"jest"in globalThis){const a={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(typeof globalThis!="undefined"&&"jest"in globalThis||typeof globalThis!="undefined"&&"vi"in globalThis)yield Ze.setFacility("facility:anon",a);else throw new Error("Facility lookup failed in production — no fallback to dev facility allowed.");return a.id}throw t}})}static getFacilityById(e){return zt(this,null,function*(){try{const t=yield Ze.getFacility(e);if(t)return t;if(!_)throw new Error("Supabase client is not initialized");const n=yield _.from("facilities").select("id, name, type, is_active, created_at, updated_at").eq("id",e).single(),a=n==null?void 0:n.data;if((n==null?void 0:n.error)||!a)throw new Error("Facility not found");const c={id:a.id,name:a.name,type:a.type,isActive:a.is_active,createdAt:a.created_at,updatedAt:a.updated_at};return yield Ze.setFacility(e,c),c}catch(t){throw console.error("Failed to get facility by ID:",t),t}})}static getCurrentUserId(){return zt(this,null,function*(){var e;try{if(!_)throw new Error("Supabase client is not initialized");const t=yield _.auth.getUser(),n=(e=t==null?void 0:t.data)==null?void 0:e.user;if((t==null?void 0:t.error)||!n){if(ht())return"550e8400-e29b-41d4-a716-446655440001";throw new Error("User not authenticated")}return n.id}catch(t){if(console.error("Failed to get current user ID:",t),ht())return"550e8400-e29b-41d4-a716-446655440001";throw t}})}static getCurrentUserAndFacility(){return zt(this,null,function*(){var e;try{if(!_)throw new Error("Supabase client is not initialized");const t=yield _.auth.getUser(),n=(e=t==null?void 0:t.data)==null?void 0:e.user;if((t==null?void 0:t.error)||!n)throw new Error("No authenticated user found");const i=yield _.from("users").select("facility_id").eq("id",n.id).single(),c=i==null?void 0:i.data;if((i==null?void 0:i.error)||!c)throw new Error("Facility ID not found for user");return{userId:n.id,facilityId:c.facility_id}}catch(t){throw console.error("FacilityService.getCurrentUserAndFacility error:",t),t}})}static getAllFacilities(){return zt(this,arguments,function*(e={}){try{const{page:t=1,limit:n=Op,orderBy:a="name",orderDirection:i="asc"}=e,c=(t-1)*n,{data:l,error:o,count:d}=yield _.from("facilities").select("id, name, type, is_active, created_at, updated_at",{count:"exact"}).order(a,{ascending:i==="asc"}).range(c,c+n-1);if(o)throw o;const u=d||0,h=Math.ceil(u/n);return{data:(l||[]).map(f=>({id:f.id,name:f.name,type:f.type,isActive:f.is_active,createdAt:f.created_at,updatedAt:f.updated_at})),total:u,page:t,limit:n,totalPages:h,hasNext:t<h,hasPrev:t>1}}catch(t){throw console.error("Failed to get all facilities:",t),t}})}static clearCache(){return zt(this,null,function*(){this.cachedFacility=null,yield Ze.clearAll()})}static invalidateFacilityCache(e){return zt(this,null,function*(){yield Ze.invalidateFacility(e)})}static validateFacilityId(e){return!!(e&&e.length>0&&e!=="default-facility-id")}}Mt.cachedFacility=null;const ge=Object.freeze(Object.defineProperty({__proto__:null,FacilityService:Mt},Symbol.toStringTag,{value:"Module"}));var Fp=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const ju=m.createContext(void 0),zp=({children:s})=>{const[e,t]=m.useState(null),[n,a]=m.useState(!0),[i,c]=m.useState(null),l=()=>(e==null?void 0:e.id)||null,o=()=>Fp(null,null,function*(){var d;try{a(!0),c(null);const u=yield Mt.getCurrentFacilityId(),h=yield Mt.getFacilityById(u);t(h),localStorage.setItem("currentFacility",JSON.stringify(h))}catch(u){if(console.warn("⚠️ Facility context error, using development fallback:",u),typeof window!="undefined"&&((d=window.location)==null?void 0:d.hostname)==="localhost"){console.warn("Using dev facility fallback in development/test mode");const p={id:"550e8400-e29b-41d4-a716-446655440000",name:"Development Facility",type:"hospital",isActive:!0};t(p),localStorage.setItem("currentFacility",JSON.stringify(p)),c(null)}else throw new Error("FacilityContext failed to resolve facility ID — no fallback allowed in production.")}finally{a(!1)}});return m.useEffect(()=>{o().catch(d=>{c(d.message)})},[]),r.jsx(ju.Provider,{value:{currentFacility:e,setCurrentFacility:t,getCurrentFacilityId:l,isLoading:n,error:i,refreshFacility:o},children:s})},Nu=()=>{const s=m.useContext(ju);if(!s)throw new Error("useFacility must be used within a FacilityProvider");return s},Lp=({pageName:s,trackDataLoading:e=!1,trackNavigation:t=!0,trackAuthentication:n=!0,onMetricsComplete:a})=>{const i=m.useRef(performance.now()),c=m.useRef(),l=m.useRef(),o=m.useRef(),d=m.useRef(),u=m.useRef(),h=m.useCallback(x=>{},[s]);m.useLayoutEffect(()=>{const x=performance.now(),b=i.current;return c.current=x-b,c.current>1e4&&(c.current=1e4),rr.recordComponentMount(s,c.current,{page:s,timestamp:new Date().toISOString()}),h(`${s} mounted in ${c.current.toFixed(2)}ms`),o.current&&h(`${s} navigation took ${o.current.toFixed(2)}ms`),d.current&&h(`${s} authentication took ${d.current.toFixed(2)}ms`),u.current&&h(`${s} data fetch took ${u.current.toFixed(2)}ms`),()=>{const v=performance.now()-b,w=c.current,S={pageLoadTime:w||0,componentMountTime:w||0,dataLoadTime:l.current,navigationTime:o.current,authenticationTime:d.current,dataFetchTime:u.current,totalTime:v};a==null||a(S)}},[s,a,h]);const p=m.useCallback(()=>{e&&i.current&&(l.current=performance.now()-i.current,h(`${s} data loaded in ${l.current.toFixed(2)}ms`))},[s,e,h]),f=m.useCallback(()=>{t&&i.current&&(o.current=performance.now()-i.current,rr.recordNavigation("unknown",s,o.current,{page:s,timestamp:new Date().toISOString()}),h(`${s} navigation completed in ${o.current.toFixed(2)}ms`))},[s,t,h]),y=m.useCallback(()=>{n&&i.current&&(d.current||(d.current=performance.now()-i.current,rr.recordAuthentication(d.current,!0,{page:s,timestamp:new Date().toISOString()}),h(`${s} authentication completed in ${d.current.toFixed(2)}ms`)))},[s,n,h]),g=m.useCallback(()=>{e&&i.current&&(u.current=performance.now()-i.current,rr.recordDataFetch("data_fetch",u.current,!0,{page:s,timestamp:new Date().toISOString()}),h(`[PERF] ${s} data fetch completed in ${u.current.toFixed(2)}ms`))},[s,e,h]);return{recordDataLoaded:p,recordNavigationComplete:f,recordAuthenticationComplete:y,recordDataFetchComplete:g}};var Bp=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Iu=({children:s})=>{const e=Ln();gt(f=>f.authToken),gt(f=>f.tokenExpiry);const t=gt(f=>f.reset);gt(f=>f.isTokenExpired);const n=gt(f=>f.getRemainingSessionTime),[a,i]=m.useState(!1),[c,l]=m.useState(!1),{currentUser:o,isLoading:d,clearUserData:u}=cr(),{recordAuthenticationComplete:h}=Lp({pageName:`Page-${e.pathname}`,trackAuthentication:!0}),p=m.useMemo(()=>{const f=!!o,y=n();return{isAuthenticated:f,isTokenExpired:!1,remainingTime:y}},[o,n]);return m.useEffect(()=>{l(!0),Bp(null,null,function*(){try{console.log("[AUTH] Validating Supabase session...");const{data:{session:y}}=yield _.auth.getSession();if(!y){console.log("[AUTH] No valid session found - redirecting to login"),u(),t();return}console.log("[AUTH] Supabase session validation successful")}catch(y){console.error("[AUTH] Supabase session validation failed:",y),u(),t()}finally{l(!1)}})},[t,u]),m.useEffect(()=>{const f=setTimeout(()=>{!p.isAuthenticated&&!c&&(console.warn("⚠️ Authentication check timed out after 3 seconds"),i(!0))},3e3);return()=>clearTimeout(f)},[p.isAuthenticated,c]),m.useEffect(()=>{p.isAuthenticated&&h()},[p.isAuthenticated,h]),m.useEffect(()=>{a&&(console.error("❌ Authentication timeout - redirecting to login"),u(),t())},[a,t,u]),c||!p.isAuthenticated&&d||p.isAuthenticated&&!o&&d||a?r.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),c&&r.jsx("div",{className:"ml-3 text-sm text-gray-600",children:"Validating secure session..."})]}):p.isAuthenticated?r.jsx(r.Fragment,{children:s}):r.jsx(xi,{to:"/login",state:{from:e},replace:!0})};Iu.displayName="ProtectedRoute";const $e=m.memo(Iu);var et=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class ra{static getAvailableKits(e){return et(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("*").eq("facility_id",e).eq("status","active").gt("quantity",0).gt("expiry_date",new Date().toISOString().split("T")[0]).order("expiry_date",{ascending:!0});if(n)throw new Error(`Failed to get available BI test kits: ${n.message}`);return(t||[]).map(a=>({id:a.id,facility_id:a.facility_id,name:a.name,manufacturer:a.manufacturer,lot_number:a.lot_number,serial_number:a.serial_number||void 0,barcode:a.barcode||void 0,expiry_date:a.expiry_date,incubation_time_minutes:a.incubation_time_minutes,incubation_temperature_celsius:a.incubation_temperature_celsius,quantity:a.quantity,min_quantity:a.min_quantity,max_quantity:a.max_quantity,location:a.location||void 0,status:a.status,supplier:a.supplier||void 0,cost:a.cost||void 0,notes:a.notes||void 0,created_at:a.created_at,updated_at:a.updated_at,created_by:a.created_by||void 0,updated_by:a.updated_by||void 0}))})}static getKitById(e){return et(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("*").eq("id",e).single();if(n)throw new Error(`Failed to get BI test kit: ${n.message}`);if(!t)throw new Error("BI test kit not found");const a=t;return{id:a.id,facility_id:a.facility_id,name:a.name,manufacturer:a.manufacturer,lot_number:a.lot_number,serial_number:a.serial_number||void 0,barcode:a.barcode||void 0,expiry_date:a.expiry_date,incubation_time_minutes:a.incubation_time_minutes,incubation_temperature_celsius:a.incubation_temperature_celsius,quantity:a.quantity,min_quantity:a.min_quantity,max_quantity:a.max_quantity,location:a.location||void 0,status:a.status,supplier:a.supplier||void 0,cost:a.cost||void 0,notes:a.notes||void 0,created_at:a.created_at,updated_at:a.updated_at,created_by:a.created_by||void 0,updated_by:a.updated_by||void 0}})}static createKit(e){return et(this,null,function*(){const t={facility_id:e.facility_id,name:e.name,manufacturer:e.manufacturer,lot_number:e.lot_number,serial_number:e.serial_number,barcode:e.barcode,expiry_date:e.expiry_date,incubation_time_minutes:e.incubation_time_minutes,incubation_temperature_celsius:e.incubation_temperature_celsius,quantity:e.quantity,min_quantity:e.min_quantity,max_quantity:e.max_quantity,location:e.location,status:e.status,supplier:e.supplier,cost:e.cost,notes:e.notes,created_by:e.created_by,updated_by:e.updated_by},{data:n,error:a}=yield _.from("bi_test_kits").insert(t).select().single();if(a)throw new Error(`Failed to create BI test kit: ${a.message}`);if(!n)throw new Error("No data returned from BI test kit creation");const i=n;return{id:i.id,facility_id:i.facility_id,name:i.name,manufacturer:i.manufacturer,lot_number:i.lot_number,serial_number:i.serial_number||void 0,barcode:i.barcode||void 0,expiry_date:i.expiry_date,incubation_time_minutes:i.incubation_time_minutes,incubation_temperature_celsius:i.incubation_temperature_celsius,quantity:i.quantity,min_quantity:i.min_quantity,max_quantity:i.max_quantity,location:i.location||void 0,status:i.status,supplier:i.supplier||void 0,cost:i.cost||void 0,notes:i.notes||void 0,created_at:i.created_at,updated_at:i.updated_at,created_by:i.created_by||void 0,updated_by:i.updated_by||void 0}})}static useKit(e){return et(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("quantity").eq("id",e).single();if(n||!t)throw new Error(`Failed to fetch BI test kit: ${(n==null?void 0:n.message)||"Kit not found"}`);const a=t;if(a.quantity<=0)throw new Error("BI test kit quantity is already 0");const{error:i}=yield _.from("bi_test_kits").update({quantity:a.quantity-1,updated_at:new Date().toISOString()}).eq("id",e);if(i)throw new Error(`Failed to update BI test kit quantity: ${i.message}`)})}static decrementKitQuantity(e){return et(this,null,function*(){return this.useKit(e)})}static getCurrentTestConditions(){return et(this,null,function*(){const{data:{user:e},error:t}=yield _.auth.getUser();if(t||!e)throw new Error("User not authenticated");const{data:n,error:a}=yield _.from("users").select("facility_id").eq("id",e.id).single();if(a||!n)throw new Error("User facility not found");const i=n;return{room_temperature_celsius:22,humidity_percent:45,equipment_used:"Standard Incubator",operator_id:e.id,facility_id:i.facility_id,test_date:new Date().toISOString(),environmental_notes:"Standard laboratory conditions"}})}static getFailureReason(){return et(this,null,function*(){const e="Positive growth detected during incubation period";try{const t=yield this.getCurrentTestConditions();return`${e}. Test conducted at ${t.room_temperature_celsius}°C for standard incubation period.`}catch(t){return console.error(t),e}})}static getSkipReason(){return et(this,null,function*(){return"Test skipped by operator - reason documented in compliance notes"})}static getComplianceNotes(){return et(this,null,function*(){const e="BI test passed successfully - sterilization process validated";try{const t=yield this.getCurrentTestConditions();return`${e}. Test conditions: ${t.room_temperature_celsius}°C, standard incubation period.`}catch(t){return console.error(t),e}})}static checkKitInventory(e){return et(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_kits").select("quantity, expiry_date, status").eq("facility_id",e);if(n)throw new Error(`Failed to check kit inventory: ${n.message}`);const a=t||[],i=a.filter(d=>d.status==="active"&&d.quantity>0&&new Date(d.expiry_date)>new Date).reduce((d,u)=>d+u.quantity,0),c=a.filter(d=>new Date(d.expiry_date)<=new Date).length,l=i<5,o=[];return l&&o.push("Order additional BI test kits to maintain adequate inventory"),c>0&&o.push(`Dispose of ${c} expired BI test kit(s)`),{available:i,low_stock:l,expired_count:c,recommendations:o}})}}var qp=Object.defineProperty,Up=Object.defineProperties,Hp=Object.getOwnPropertyDescriptors,so=Object.getOwnPropertySymbols,Vp=Object.prototype.hasOwnProperty,Wp=Object.prototype.propertyIsEnumerable,no=(s,e,t)=>e in s?qp(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Gp=(s,e)=>{for(var t in e||(e={}))Vp.call(e,t)&&no(s,t,e[t]);if(so)for(var t of so(e))Wp.call(e,t)&&no(s,t,e[t]);return s},Kp=(s,e)=>Up(s,Hp(e)),pr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Ps{static createBITestResult(e){return pr(this,null,function*(){try{const n=new Date().toISOString().split("T")[0].replace(/-/g,""),a=Date.now().toString().slice(-6),i=`BI-${n}-${a}`,c={facility_id:e.facility_id,operator_id:e.operator_id,cycle_id:e.cycle_id||"00000000-0000-0000-0000-000000000000",test_number:i,test_date:e.test_date||new Date().toISOString(),result:e.result,bi_lot_number:e.bi_lot_number,bi_expiry_date:e.bi_expiry_date,incubation_time_minutes:e.incubation_time_minutes,incubation_temperature_celsius:e.incubation_temperature_celsius,test_conditions:e.test_conditions,failure_reason:e.failure_reason,skip_reason:e.skip_reason,compliance_notes:e.compliance_notes};console.log("🔍 Inserting BI test data:",JSON.stringify(c,null,2));const{data:l,error:o}=yield _.from("bi_test_results").insert(c).select().single();if(o)throw console.error("❌ Database error details:",o),o;if(!l||typeof l!="object")throw new Error("Invalid test result data");const d=l;return{id:d.id,facility_id:d.facility_id,operator_id:d.operator_id||void 0,cycle_id:d.cycle_id||void 0,test_number:d.test_number,test_date:d.test_date,result:d.result,status:d.status,bi_lot_number:d.bi_lot_number||void 0,bi_expiry_date:d.bi_expiry_date||void 0,incubation_time_minutes:d.incubation_time_minutes||void 0,incubation_temperature_celsius:d.incubation_temperature_celsius||void 0,test_conditions:d.test_conditions||{},failure_reason:d.failure_reason||void 0,skip_reason:d.skip_reason||void 0,compliance_notes:d.compliance_notes||void 0,audit_signature:d.audit_signature||void 0,created_at:d.created_at,updated_at:d.updated_at}}catch(t){throw console.error("Failed to create BI test result:",t),t}})}static updateBITestResult(e,t){return pr(this,null,function*(){const{data:n,error:a}=yield _.from("bi_test_results").update(Kp(Gp({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();if(a)throw new Error(`Failed to update BI test result: ${a.message}`);if(!n)throw new Error("No data returned from BI test result update");const i=n;return{id:i.id,facility_id:i.facility_id,operator_id:i.operator_id||void 0,cycle_id:i.cycle_id||void 0,test_number:i.test_number,test_date:i.test_date,result:i.result,status:i.status,bi_lot_number:i.bi_lot_number||void 0,bi_expiry_date:i.bi_expiry_date||void 0,incubation_time_minutes:i.incubation_time_minutes||void 0,incubation_temperature_celsius:i.incubation_temperature_celsius||void 0,test_conditions:i.test_conditions||{},failure_reason:i.failure_reason||void 0,skip_reason:i.skip_reason||void 0,compliance_notes:i.compliance_notes||void 0,audit_signature:i.audit_signature||void 0,created_at:i.created_at,updated_at:i.updated_at}})}static getBITestResults(){return pr(this,arguments,function*(e={}){let t=_.from("bi_test_results").select(`
        *,
        facilities(name, facility_code),
        operators(name, role),
        sterilization_cycles(cycle_number, cycle_type)
      `).order("test_date",{ascending:!1});e.facility_id&&(t=t.eq("facility_id",e.facility_id)),e.operator_id&&(t=t.eq("operator_id",e.operator_id)),e.cycle_id&&(t=t.eq("cycle_id",e.cycle_id)),e.result&&(t=t.eq("result",e.result)),e.status&&(t=t.eq("status",e.status)),e.start_date&&(t=t.gte("test_date",e.start_date)),e.end_date&&(t=t.lte("test_date",e.end_date)),e.limit&&(t=t.limit(e.limit)),e.offset&&(t=t.range(e.offset,e.offset+(e.limit||10)-1));const{data:n,error:a}=yield t;if(a)throw new Error(`Failed to fetch BI test results: ${a.message}`);return(n||[]).map(i=>({id:i.id,facility_id:i.facility_id,operator_id:i.operator_id||void 0,cycle_id:i.cycle_id||void 0,test_number:i.test_number,test_date:i.test_date,result:i.result,status:i.status,bi_lot_number:i.bi_lot_number||void 0,bi_expiry_date:i.bi_expiry_date||void 0,incubation_time_minutes:i.incubation_time_minutes||void 0,incubation_temperature_celsius:i.incubation_temperature_celsius||void 0,test_conditions:i.test_conditions||{},failure_reason:i.failure_reason||void 0,skip_reason:i.skip_reason||void 0,compliance_notes:i.compliance_notes||void 0,audit_signature:i.audit_signature||void 0,created_at:i.created_at,updated_at:i.updated_at}))})}static getBITestResult(e){return pr(this,null,function*(){try{const{data:t,error:n}=yield _.from("bi_test_results").select("*").eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw n}if(!t||typeof t!="object")return null;const a=t;return{id:a.id,facility_id:a.facility_id,operator_id:a.operator_id||void 0,cycle_id:a.cycle_id||void 0,test_number:a.test_number,test_date:a.test_date,result:a.result,status:a.status,bi_lot_number:a.bi_lot_number||void 0,bi_expiry_date:a.bi_expiry_date||void 0,incubation_time_minutes:a.incubation_time_minutes||void 0,incubation_temperature_celsius:a.incubation_temperature_celsius||void 0,test_conditions:a.test_conditions||{},failure_reason:a.failure_reason||void 0,skip_reason:a.skip_reason||void 0,compliance_notes:a.compliance_notes||void 0,audit_signature:a.audit_signature||void 0,created_at:a.created_at,updated_at:a.updated_at}}catch(t){throw console.error("Failed to get BI test result:",t),t}})}static deleteBITestResult(e){return pr(this,null,function*(){const{error:t}=yield _.from("bi_test_results").delete().eq("id",e);if(t)throw new Error(`Failed to delete BI test result: ${t.message}`)})}static generateTestNumber(e){return pr(this,null,function*(){const t=new Date,n=t.toISOString().split("T")[0].replace(/-/g,""),{count:a,error:i}=yield _.from("bi_test_results").select("*",{count:"exact",head:!0}).eq("facility_id",e).gte("test_date",t.toISOString().split("T")[0]).lt("test_date",new Date(t.getTime()+1440*60*1e3).toISOString().split("T")[0]);if(i)throw new Error(`Failed to generate test number: ${i.message}`);return`BI-${n}-${String((a!=null?a:0)+1).padStart(3,"0")}`})}}var fr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Rs={getBIPassRate(s){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("id").eq("facility_id",s).eq("result","pass");return t?{data:null,error:t}:{data:e.length,error:null}})},getBIPassRateAnalytics(s){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",s);if(t)return{data:null,error:t};const n=e.length,a=e.filter(c=>c.result==="pass").length,i=n>0?a/n*100:0;return{data:{totalTests:n,passedTests:a,passRate:i,facilityId:s},error:null}})},getOperatorPerformance(s,e){return fr(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_results").select("*").eq("facility_id",s).eq("operator_id",e);return n?{data:null,error:n}:{data:t,error:null}})},getBITestAnalytics(s){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",s);return t?{data:null,error:t}:{data:{totalTests:e.length,passedTests:e.filter(a=>a.result==="pass").length,failedTests:e.filter(a=>a.result==="fail").length,facilityId:s},error:null}})},getAITrainingData(s){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",s);return t?{data:null,error:t}:{data:e.map(a=>({id:a.id,facilityId:a.facility_id,operatorId:a.operator_id,result:a.result,timestamp:a.created_at,features:{incubationTemperature:a.incubation_temperature_celsius,incubationTime:a.incubation_time_minutes,testConditions:a.test_conditions,status:a.status}})),error:null}})},getPredictiveAnalyticsData(s){return fr(this,null,function*(){const{data:e,error:t}=yield _.from("bi_test_results").select("*").eq("facility_id",s).order("created_at",{ascending:!1}).limit(100);if(t)return{data:null,error:t};const n=e.length,a=e.slice(0,30),i=a.length>0?a.filter(l=>l.result==="pass").length/a.length*100:0;return{data:{facilityId:s,totalTests:n,recentPassRate:i,trendAnalysis:{isImproving:i>80,riskLevel:i<70?"high":i<85?"medium":"low"},recommendations:i<70?["Review sterilization procedures","Check equipment calibration","Retrain operators"]:i<85?["Monitor trends closely","Consider preventive maintenance"]:["Maintain current procedures"]},error:null}})}};var Lt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class bt{static getFacilities(){return Lt(this,null,function*(){const{data:e,error:t}=yield _.from("facilities").select("*").eq("is_active",!0).order("name");if(t)throw new Error(`Failed to fetch facilities: ${t.message}`);return(e||[]).map(n=>{var a,i,c,l,o;return{id:n.id||"",name:n.name||"",facility_code:((a=n.settings)==null?void 0:a.facility_code)||"",address:((i=n.address)==null?void 0:i.address)||void 0,contact_email:((c=n.contact_info)==null?void 0:c.email)||void 0,contact_phone:((l=n.contact_info)==null?void 0:l.phone)||void 0,compliance_requirements:((o=n.settings)==null?void 0:o.compliance_requirements)||{},settings:n.settings||{},is_active:n.is_active||!1,created_at:n.created_at,updated_at:n.updated_at}})})}static getOperators(e){return Lt(this,null,function*(){const{data:t,error:n}=yield _.from("users").select("*").eq("facility_id",e).eq("is_active",!0).order("first_name");if(n)throw new Error(`Failed to fetch operators: ${n.message}`);return(t||[]).map(a=>{var i,c,l,o,d;return{id:a.id||"",facility_id:a.facility_id,user_id:a.id||void 0,name:a.full_name||`${a.first_name||""} ${a.last_name||""}`.trim(),email:a.email||void 0,role:((i=a.preferences)==null?void 0:i.role)||"operator",certification_number:((c=a.preferences)==null?void 0:c.certification_number)||void 0,certification_expiry:((l=a.preferences)==null?void 0:l.certification_expiry)||void 0,permissions:((o=a.preferences)==null?void 0:o.permissions)||{},performance_metrics:((d=a.preferences)==null?void 0:d.performance_metrics)||{},is_active:a.is_active||!1,created_at:a.created_at||"",updated_at:a.updated_at||""}})})}static getSterilizationCycles(e,t=50){return Lt(this,null,function*(){const n=`${e}-${t}`,a=this.cache.get(n);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;const{data:i,error:c}=yield _.from("sterilization_cycles").select("id, cycle_number, start_time, end_time, status, parameters, tools").eq("facility_id",e).order("start_time",{ascending:!1}).limit(t);if(c)throw new Error(`Failed to fetch sterilization cycles: ${c.message}`);const l=(i||[]).map(o=>({id:o.id,facility_id:o.facility_id||"",operator_id:o.operator_id||void 0,cycle_number:o.cycle_number||"",cycle_type:o.cycle_type||"standard",status:o.status||"pending",start_time:o.start_time||"",end_time:o.end_time||void 0,phases:o.parameters||[],tools:o.tools||[],cycle_parameters:o.parameters||{},environmental_factors:o.results||{},notes:o.notes||void 0,created_at:o.created_at||"",updated_at:o.updated_at||""}));return this.cache.set(n,{data:l,timestamp:Date.now()}),l})}static createSterilizationCycle(e){return Lt(this,null,function*(){const t=yield this.generateCycleNumber(e.facility_id),n={id:crypto.randomUUID(),facility_id:e.facility_id,operator_id:e.operator_id,cycle_type:e.cycle_type||"standard",cycle_number:t,start_time:new Date().toISOString(),status:e.status||"pending",parameters:e.cycle_parameters||{},results:e.environmental_factors||{},tools:e.tools||[],notes:e.notes},{data:a,error:i}=yield _.from("sterilization_cycles").insert(n).select().single();if(i)throw new Error(`Failed to create sterilization cycle: ${i.message}`);if(!a)throw new Error("No data returned from sterilization cycle creation");const c=a;return{id:c.id,facility_id:c.facility_id||"",operator_id:c.operator_id||void 0,cycle_number:c.cycle_number||"",cycle_type:c.cycle_type||"standard",status:c.status||"pending",start_time:c.start_time||"",end_time:c.end_time||void 0,phases:c.tools||[],tools:c.tools||[],cycle_parameters:c.parameters||{},environmental_factors:c.results||{},notes:c.notes||void 0,created_at:c.created_at||"",updated_at:c.updated_at||""}})}static getEquipment(e){return Lt(this,null,function*(){const{data:t,error:n}=yield _.from("autoclave_equipment").select("*").eq("facility_id",e).eq("status","active").order("name");if(n)throw new Error(`Failed to fetch equipment: ${n.message}`);return(t||[]).map(a=>({id:a.id||"",facility_id:a.facility_id||"",equipment_type:a.name||"autoclave",model_number:a.model||void 0,serial_number:a.serial_number||void 0,manufacturer:void 0,installation_date:void 0,last_calibration_date:void 0,next_calibration_date:void 0,maintenance_schedule:{},performance_metrics:{},is_active:a.status==="active",created_at:a.created_at||"",updated_at:a.updated_at||""}))})}static getComplianceAudits(e){return Lt(this,null,function*(){const{data:t,error:n}=yield _.from("audit_logs").select("*").eq("facility_id",e).order("created_at",{ascending:!1});if(n)throw new Error(`Failed to fetch compliance audits: ${n.message}`);return(t||[]).map(a=>{var i,c,l,o,d,u,h,p,f;return{id:a.id||"",facility_id:a.facility_id||"",audit_type:((i=a.metadata)==null?void 0:i.audit_type)||"internal",audit_date:a.created_at,auditor_id:(c=a.operator_id)!=null?c:"system",audit_scope:((l=a.metadata)==null?void 0:l.audit_scope)||{},findings:((o=a.metadata)==null?void 0:o.findings)||[],compliance_score:((d=a.metadata)==null?void 0:d.compliance_score)||void 0,recommendations:((u=a.metadata)==null?void 0:u.recommendations)||void 0,corrective_actions:((h=a.metadata)==null?void 0:h.corrective_actions)||[],follow_up_date:((p=a.metadata)==null?void 0:p.follow_up_date)||void 0,status:((f=a.metadata)==null?void 0:f.status)||"pending",created_at:a.created_at,updated_at:a.updated_at||""}})})}static generateCycleNumber(e){return Lt(this,null,function*(){const t=new Date,n=t.toISOString().split("T")[0].replace(/-/g,""),{count:a,error:i}=yield _.from("sterilization_cycles").select("*",{count:"exact",head:!0}).eq("facility_id",e).gte("start_time",t.toISOString().split("T")[0]).lt("start_time",new Date(t.getTime()+1440*60*1e3).toISOString().split("T")[0]);if(i)throw new Error(`Failed to generate cycle number: ${i.message}`);return`CYCLE-${n}-${String((a!=null?a:0)+1).padStart(3,"0")}`})}}bt.cache=new Map;bt.CACHE_DURATION=300*1e3;class Tu{static subscribeToBITestChanges(e){if(!Pn()){console.warn("⚠️ Supabase not configured, skipping BI test subscription");return}try{return Za.subscribe("bi_test_results",e,{event:"*"})}catch(t){return console.error("❌ Failed to subscribe to BI test changes:",t),null}}static subscribeToCycleChanges(e){if(!Pn()){console.warn("⚠️ Supabase not configured, skipping cycle subscription");return}try{return Za.subscribe("sterilization_cycles",e,{event:"*"})}catch(t){return console.error("❌ Failed to subscribe to cycle changes:",t),null}}}class fe{}fe.createBITestResult=Ps.createBITestResult;fe.updateBITestResult=Ps.updateBITestResult;fe.getBITestResults=Ps.getBITestResults;fe.getBITestResult=Ps.getBITestResult;fe.deleteBITestResult=Ps.deleteBITestResult;fe.getBIPassRateAnalytics=Rs.getBIPassRateAnalytics;fe.getOperatorPerformance=Rs.getOperatorPerformance;fe.getBITestAnalytics=Rs.getBITestAnalytics;fe.getAITrainingData=Rs.getAITrainingData;fe.getPredictiveAnalyticsData=Rs.getPredictiveAnalyticsData;fe.getFacilities=bt.getFacilities;fe.getOperators=bt.getOperators;fe.getSterilizationCycles=bt.getSterilizationCycles;fe.createSterilizationCycle=bt.createSterilizationCycle;fe.getEquipment=bt.getEquipment;fe.getComplianceAudits=bt.getComplianceAudits;fe.subscribeToBITestChanges=Tu.subscribeToBITestChanges;fe.subscribeToCycleChanges=Tu.subscribeToCycleChanges;const ao=s=>{if(!s)return null;const e=localStorage.getItem("officeHoursSettings");if(!e)return io(s,{workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},startHour:8,endHour:17});const t=JSON.parse(e);return io(s,t)},io=(s,e)=>{const t=new Date(s);return t.setHours(t.getHours()+24),Qp(t,e)},Qp=(s,e)=>{const t=new Date(s),n=t.getDay(),a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],i=a[n];if(!e.workingDays[i]){let o=1;for(;o<=7;){const d=new Date(t);d.setDate(d.getDate()+o);const u=d.getDay(),h=a[u];if(e.workingDays[h])return t.setDate(t.getDate()+o),t.setHours(e.startHour,0,0,0),t;o++}}const l=t.getHours();if(l<e.startHour)t.setHours(e.startHour,0,0,0);else if(l>=e.endHour){let o=1;for(;o<=7;){const d=new Date(t);d.setDate(d.getDate()+o);const u=d.getDay(),h=a[u];if(e.workingDays[h])return t.setDate(t.getDate()+o),t.setHours(e.startHour,0,0,0),t;o++}}return t},pD=s=>{const e=new Date,t=s.getTime()-e.getTime(),n=Math.ceil(t/(1e3*60*60*24));return n===0?"Today":n===1?"Tomorrow":n<7?s.toLocaleDateString("en-US",{weekday:"long"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};var Yp=Object.defineProperty,Jp=Object.defineProperties,Xp=Object.getOwnPropertyDescriptors,oo=Object.getOwnPropertySymbols,Zp=Object.prototype.hasOwnProperty,ef=Object.prototype.propertyIsEnumerable,lo=(s,e,t)=>e in s?Yp(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qr=(s,e)=>{for(var t in e||(e={}))Zp.call(e,t)&&lo(s,t,e[t]);if(oo)for(var t of oo(e))ef.call(e,t)&&lo(s,t,e[t]);return s},Yr=(s,e)=>Jp(s,Xp(e)),sa=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const tf=s=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null,setBiTestCompleted:e=>s({biTestCompleted:e}),setBiTestDate:e=>s({biTestDate:e}),recordBITestResult:e=>sa(null,null,function*(){console.log("🔬 recordBITestResult called with:",e);try{const{data:{user:t},error:n}=yield _.auth.getUser();if(n||!t)throw new Error("User not authenticated");const a="550e8400-e29b-41d4-a716-446655440000",i={facility_id:a};let c=[],l=null,o=null;try{c=yield ra.getAvailableKits(i.facility_id),c.length>0&&(l=c[0],o=yield ra.getCurrentTestConditions())}catch(h){console.error(h),l={id:"default-kit",facility_id:i.facility_id,name:"Default BI Kit",manufacturer:"Default Manufacturer",lot_number:"DEFAULT-001",expiry_date:new Date(Date.now()+365*24*60*60*1e3).toISOString(),incubation_time_minutes:60,incubation_temperature_celsius:37,quantity:1,min_quantity:1,max_quantity:100,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},o={room_temperature_celsius:22,humidity_percent:45,equipment_used:"Default Equipment",operator_id:t.id,facility_id:i.facility_id,test_date:new Date().toISOString()}}const d={facility_id:a,operator_id:t.id,test_date:new Date().toISOString(),result:e.status==="pending"?"pass":e.status,bi_lot_number:(l==null?void 0:l.lot_number)||"",bi_expiry_date:(l==null?void 0:l.expiry_date)||null,incubation_time_minutes:(l==null?void 0:l.incubation_time_minutes)||60,incubation_temperature_celsius:(l==null?void 0:l.incubation_temperature_celsius)||37,test_conditions:o||void 0,failure_reason:e.status==="fail"?"BI test failed":void 0,skip_reason:e.status==="skip"?"BI test skipped":void 0,compliance_notes:e.status==="pass"?"BI test passed":void 0},u=yield fe.createBITestResult(d);if(l&&l.id!=="default-kit")try{yield ra.decrementKitQuantity(l.id)}catch(h){console.error(h)}return s(h=>{const p=ao(e.date),f={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:e.passed?"BI Test Passed":"BI Test Failed",time:e.date,toolCount:1,color:e.passed?"bg-green-500":"bg-red-500"},y=Yr(Qr({},e),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});return{biTestCompleted:e.passed,biTestDate:e.date.toISOString(),biTestResults:[...h.biTestResults,y],lastBITestDate:e.date.toISOString(),nextBITestDue:p,biTestPassed:e.passed,activityLog:[f,...h.activityLog].slice(0,20)}}),u}catch(t){throw console.error("Error recording BI test result:",t),s(n=>{const a=ao(e.date),i={id:`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"bi-test",title:e.passed?"BI Test Passed":"BI Test Failed",time:e.date,toolCount:1,color:e.passed?"bg-green-500":"bg-red-500"},c=Yr(Qr({},e),{id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});return{biTestCompleted:e.passed,biTestDate:e.date.toISOString(),biTestResults:[...n.biTestResults,c],lastBITestDate:e.date.toISOString(),nextBITestDue:a,biTestPassed:e.passed,activityLog:[i,...n.activityLog].slice(0,20)}}),t}}),setNextBITestDue:e=>s({nextBITestDue:e}),setLastBITestDate:e=>s({lastBITestDate:e}),setBiTestPassed:e=>s({biTestPassed:e}),setBiTestOptedOut:e=>s({biTestOptedOut:e}),addActivity:e=>s(t=>({activityLog:[Yr(Qr({},e),{id:e.id||`activity-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),...t.activityLog].slice(0,20)})),activateBIFailure:e=>s(()=>({biFailureActive:!0,biFailureDetails:{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:new Date,affectedToolsCount:e.affectedToolsCount,affectedBatchIds:e.affectedBatchIds,operator:e.operator}})),deactivateBIFailure:()=>s(()=>({biFailureActive:!1,biFailureDetails:null})),loadBIFailureIncidents:e=>sa(null,null,function*(){try{const{data:t,error:n}=yield _.from("bi_failure_incidents").select("*").eq("facility_id",e).eq("status","resolved").gte("resolved_at",new Date(Date.now()-2592e6).toISOString()).order("resolved_at",{ascending:!1}).limit(20);if(n){console.error("Failed to load BI failure incidents:",n);return}s(a=>{const i=new Set(a.activityLog.map(o=>o.id)),c=[];(t||[]).forEach(o=>{var d;const u=`bi-incident-resolved-${o.id}`;i.has(u)||c.push({id:u,type:"incident-resolution",title:"BI Failure Incident Resolved",time:new Date(o.resolved_at||o.updated_at),toolCount:((d=o.metadata)==null?void 0:d.affected_tools_count)||1,color:"bg-blue-500",metadata:{incidentId:o.id,operatorId:o.resolved_by_operator_id,resolutionNotes:o.resolution_notes}})});const l=[...c,...a.activityLog].sort((o,d)=>new Date(d.time).getTime()-new Date(o.time).getTime()).slice(0,20);return Yr(Qr({},a),{activityLog:l})})}catch(t){console.error("Error loading BI failure incidents:",t)}}),loadBITestResults:e=>sa(null,null,function*(){try{const{data:t,error:n}=yield _.from("bi_test_results").select("*").eq("facility_id",e).order("test_date",{ascending:!1}).limit(50);if(n){console.error("Failed to load BI test results:",n);return}const a=(t||[]).map(i=>({id:i.id,facility_id:i.facility_id,test_number:i.test_number,test_date:i.test_date,result:i.result,status:i.result,operator_id:i.operator_id,cycle_id:i.cycle_id,bi_lot_number:i.bi_lot_number,bi_expiry_date:i.bi_expiry_date,incubation_time_minutes:i.incubation_time_minutes,incubation_temperature_celsius:i.incubation_temperature_celsius,test_conditions:i.test_conditions||{},failure_reason:i.failure_reason,skip_reason:i.skip_reason,compliance_notes:i.compliance_notes,date:new Date(i.test_date),toolId:i.test_number||"default-tool",passed:i.result==="pass",notes:i.compliance_notes||i.failure_reason||i.skip_reason,created_at:i.created_at,updated_at:i.updated_at}));s(i=>{const c=new Set(i.activityLog.map(d=>d.id)),l=[];a.forEach(d=>{const u=`bi-test-${d.id}`;c.has(u)||l.push({id:u,type:"bi-test",title:d.passed?"BI Test Passed":"BI Test Failed",time:new Date(d.test_date),toolCount:1,color:d.passed?"bg-green-500":"bg-red-500",metadata:{testNumber:d.test_number,operatorId:d.operator_id}})});const o=[...l,...i.activityLog].sort((d,u)=>new Date(u.time).getTime()-new Date(d.time).getTime()).slice(0,20);return Yr(Qr({},i),{biTestResults:a,activityLog:o})})}catch(t){console.error("Error loading BI test results:",t)}}),syncBIFailureFromDatabase:e=>s({biFailureActive:e.status==="active",biFailureDetails:e.status==="active"?{id:`bi-failure-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,date:new Date(e.failure_date),affectedToolsCount:e.affected_tools_count,affectedBatchIds:e.affected_batch_ids,operator:e.detected_by_operator_id||"System Alert"}:null}),resetBIState:()=>s(()=>({biTestCompleted:!1,biTestDate:null,biTestResults:[],nextBITestDue:null,lastBITestDate:null,biTestPassed:!1,biTestOptedOut:!1,activityLog:[],biFailureActive:!1,biFailureDetails:null}))});var rf=Object.defineProperty,sf=Object.defineProperties,nf=Object.getOwnPropertyDescriptors,co=Object.getOwnPropertySymbols,af=Object.prototype.hasOwnProperty,of=Object.prototype.propertyIsEnumerable,uo=(s,e,t)=>e in s?rf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Bt=(s,e)=>{for(var t in e||(e={}))af.call(e,t)&&uo(s,t,e[t]);if(co)for(var t of co(e))of.call(e,t)&&uo(s,t,e[t]);return s},na=(s,e)=>sf(s,nf(e));const lf=(s,e)=>({ciRequired:!0,biRequired:!0,enforceBI:!0,enforceCI:!0,allowOverrides:!1,autoclaveReceiptSettings:{autoclaveHasPrinter:!1,receiptRetentionMonths:12},cycleSettings:{unwrapped:{name:"Unwrapped",temperature:132,pressure:15,sterilizeTime:3,dryTime:30,totalTime:15},pouches:{name:"Pouches",temperature:132,pressure:15,sterilizeTime:5,dryTime:30,totalTime:17},packs:{name:"Packs",temperature:121,pressure:15,sterilizeTime:30,dryTime:30,totalTime:40},handpieces:{name:"Handpieces",temperature:132,pressure:15,sterilizeTime:6,dryTime:30,totalTime:16},custom:{name:"Custom",temperature:132,pressure:15,sterilizeTime:4,dryTime:30,totalTime:16}},defaultCycleType:"pouches",allowCustomCycles:!0,setCiRequired:t=>s({ciRequired:t}),setBiRequired:t=>s({biRequired:t}),setEnforceBI:t=>s({enforceBI:t}),setEnforceCI:t=>s({enforceCI:t}),setAllowOverrides:t=>s({allowOverrides:t}),toggleEnforceBI:()=>s({enforceBI:!e().enforceBI}),toggleEnforceCI:()=>s({enforceCI:!e().enforceCI}),setAutoclaveHasPrinter:t=>s(n=>({autoclaveReceiptSettings:na(Bt({},n.autoclaveReceiptSettings),{autoclaveHasPrinter:t})})),setReceiptRetentionMonths:t=>s(n=>({autoclaveReceiptSettings:na(Bt({},n.autoclaveReceiptSettings),{receiptRetentionMonths:t})})),updateAutoclaveReceiptSettings:t=>s(n=>({autoclaveReceiptSettings:Bt(Bt({},n.autoclaveReceiptSettings),t)})),setDefaultCycleType:t=>s({defaultCycleType:t}),setAllowCustomCycles:t=>s({allowCustomCycles:t}),updateCycleSettings:(t,n)=>s(a=>({cycleSettings:na(Bt({},a.cycleSettings),{[t]:Bt(Bt({},a.cycleSettings[t]),n)})})),resetCycleSettings:()=>s({cycleSettings:{unwrapped:{name:"Unwrapped",temperature:132,pressure:15,sterilizeTime:3,dryTime:30,totalTime:15},pouches:{name:"Pouches",temperature:132,pressure:15,sterilizeTime:5,dryTime:30,totalTime:17},packs:{name:"Packs",temperature:121,pressure:15,sterilizeTime:30,dryTime:30,totalTime:40},handpieces:{name:"Handpieces",temperature:132,pressure:15,sterilizeTime:6,dryTime:30,totalTime:16},custom:{name:"Custom",temperature:132,pressure:15,sterilizeTime:4,dryTime:30,totalTime:16}},defaultCycleType:"pouches",allowCustomCycles:!0}),resetSettings:()=>s({ciRequired:!0,biRequired:!0,enforceBI:!0,enforceCI:!0,allowOverrides:!1,autoclaveReceiptSettings:{autoclaveHasPrinter:!1,receiptRetentionMonths:12},cycleSettings:{unwrapped:{name:"Unwrapped",temperature:132,pressure:15,sterilizeTime:3,dryTime:30,totalTime:15},pouches:{name:"Pouches",temperature:132,pressure:15,sterilizeTime:5,dryTime:30,totalTime:17},packs:{name:"Packs",temperature:121,pressure:15,sterilizeTime:30,dryTime:30,totalTime:40},handpieces:{name:"Handpieces",temperature:132,pressure:15,sterilizeTime:6,dryTime:30,totalTime:16},custom:{name:"Custom",temperature:132,pressure:15,sterilizeTime:4,dryTime:30,totalTime:16}},defaultCycleType:"pouches",allowCustomCycles:!0})}),cf=(s,e)=>{if(s.duration<=0)throw new Error(`${e} has invalid duration`);if(s.temperature!==void 0&&(s.temperature<30||s.temperature>150))throw new Error(`${e} has unsafe temperature`);if(s.pressure!==void 0&&(s.pressure<5||s.pressure>30))throw new Error(`${e} has unsafe pressure`)},me={bath1:{name:"Bath 1",duration:1,temperature:60,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},bath2:{name:"Bath 2",duration:1,temperature:65,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},drying:{name:"Drying",duration:1,requiresCI:!1,requiresBI:!1,requiresCiStrip:!1,requiresBiTest:!1},autoclave:{name:"Autoclave",duration:1,temperature:121,pressure:15,requiresCI:!0,requiresBI:!0,requiresCiStrip:!0,requiresBiTest:!0}};Object.entries(me).forEach(([s,e])=>{cf(e,s)});const Eu={bath1:{label:me.bath1.name,duration:me.bath1.duration*60},bath2:{label:me.bath2.name,duration:me.bath2.duration*60},drying:{label:me.drying.name,duration:me.drying.duration*60},autoclave:{label:me.autoclave.name,duration:me.autoclave.duration*60}},df=()=>{const e=new Date().toISOString().split("T")[0].replace(/-/g,""),t=`cycle_count_${e}`,a=parseInt(localStorage.getItem(t)||"0")+1;return localStorage.setItem(t,a.toString()),`CYCLE-${e}-${String(a).padStart(3,"0")}`},ni=s=>{const e=`cycle_${Date.now()}`,t=df();return{id:e,cycleNumber:t,phases:[],tools:[],operator:s,startTime:new Date,completedAt:null}},uf=(s,e,t,n=[])=>({id:s,name:e,duration:t,tools:n,isActive:!1,startTime:null,endTime:null,status:"pending"}),mf=s=>({bath1:{name:me.bath1.name,duration:me.bath1.duration*60},bath2:{name:me.bath2.name,duration:me.bath2.duration*60},drying:{name:me.drying.name,duration:me.drying.duration*60},autoclave:{name:me.autoclave.name,duration:me.autoclave.duration*60}})[s],hf=s=>{const e=["bath1","bath2","drying","autoclave"],t=e.indexOf(s);return e[t+1]||null},ai=s=>s.phases.some(e=>e.id==="autoclave");var pf=Object.defineProperty,ff=Object.defineProperties,gf=Object.getOwnPropertyDescriptors,mo=Object.getOwnPropertySymbols,yf=Object.prototype.hasOwnProperty,vf=Object.prototype.propertyIsEnumerable,ho=(s,e,t)=>e in s?pf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,jt=(s,e)=>{for(var t in e||(e={}))yf.call(e,t)&&ho(s,t,e[t]);if(mo)for(var t of mo(e))vf.call(e,t)&&ho(s,t,e[t]);return s},Nt=(s,e)=>ff(s,gf(e)),xf=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const bf=(s,e,t)=>({setCurrentCycle:n=>s(a=>Nt(jt({},a),{currentCycle:n})),setError:n=>s(a=>Nt(jt({},a),{error:n})),startNewCycle:n=>{const a=ni(n);s(i=>Nt(jt({},i),{currentCycle:a}))},addToolToCycle:n=>{s(a=>{const i=a.currentCycle;if(!i){const c=ni("Current Operator");c.tools=[n];const l=e();return l.updateToolStatus&&l.availableTools.find(d=>d.id===n)&&l.updateToolStatus(n,"bath1"),Nt(jt({},a),{currentCycle:c})}if(!i.tools.includes(n)){const c=Nt(jt({},i),{tools:[...i.tools,n]}),l=e();return l.updateToolStatus&&l.availableTools.find(d=>d.id===n)&&l.updateToolStatus(n,"bath1"),Nt(jt({},a),{currentCycle:c})}return a})},loadCycles:n=>xf(null,null,function*(){try{const i=(yield bt.getSterilizationCycles(n)).map(c=>({id:c.id,cycleNumber:c.cycle_number,phases:Array.isArray(c.phases)?c.phases.map(l=>({id:l.id,name:l.name,duration:l.duration,tools:Array.isArray(l.tools)?l.tools.map(o=>o.id):[],isActive:l.isActive,startTime:l.startTime?new Date(l.startTime):null,endTime:l.endTime?new Date(l.endTime):null,status:l.status})):[],tools:Array.isArray(c.tools)?c.tools.map(l=>l.id):[],operator:c.operator_id||"Unknown",startTime:c.start_time?new Date(c.start_time):new Date,completedAt:c.end_time||null,batchId:c.cycle_number}));s(c=>Nt(jt({},c),{cycles:i}))}catch(a){console.error("Failed to load sterilization cycles:",a),s(i=>Nt(jt({},i),{error:a instanceof Error?a.message:"Failed to load cycles"}))}})});var _f=Object.defineProperty,wf=Object.defineProperties,Sf=Object.getOwnPropertyDescriptors,po=Object.getOwnPropertySymbols,Cf=Object.prototype.hasOwnProperty,jf=Object.prototype.propertyIsEnumerable,fo=(s,e,t)=>e in s?_f(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Se=(s,e)=>{for(var t in e||(e={}))Cf.call(e,t)&&fo(s,t,e[t]);if(po)for(var t of po(e))jf.call(e,t)&&fo(s,t,e[t]);return s},Ce=(s,e)=>wf(s,Sf(e));const Nf=(s,e,t)=>({addPhaseToCycle:(n,a,i)=>{s(c=>{if(!c.currentCycle){const p=e().availableTools.filter(y=>y.currentPhase==="bath1").map(y=>y.id),f=ni("Current Operator");return f.tools=p,Ce(Se({},c),{currentCycle:f})}if(c.currentCycle.phases.find(h=>h.id===n))return c;const o=uf(n,a,i,[...c.currentCycle.tools]),d=[...c.currentCycle.phases,o],u=Ce(Se({},c.currentCycle),{phases:d});return Ce(Se({},c),{currentCycle:u})})},startPhase:n=>{s(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Ce(Se({},c),{isActive:!0,startTime:new Date,status:"active"}):c);return Ce(Se({},a),{currentCycle:Ce(Se({},a.currentCycle),{phases:i})})})},completePhase:n=>{s(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Ce(Se({},c),{isActive:!1,endTime:new Date,status:"completed"}):c);return Ce(Se({},a),{currentCycle:Ce(Se({},a.currentCycle),{phases:i})})})},pausePhase:n=>{s(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Ce(Se({},c),{isActive:!1,status:"paused"}):c);return Ce(Se({},a),{currentCycle:Ce(Se({},a.currentCycle),{phases:i})})})},resetPhase:n=>{s(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.map(c=>c.id===n?Ce(Se({},c),{isActive:!1,startTime:null,endTime:null,status:"pending"}):c);return Ce(Se({},a),{currentCycle:Ce(Se({},a.currentCycle),{phases:i})})})}});var If=Object.defineProperty,Tf=Object.defineProperties,Ef=Object.getOwnPropertyDescriptors,go=Object.getOwnPropertySymbols,kf=Object.prototype.hasOwnProperty,Df=Object.prototype.propertyIsEnumerable,yo=(s,e,t)=>e in s?If(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Us=(s,e)=>{for(var t in e||(e={}))kf.call(e,t)&&yo(s,t,e[t]);if(go)for(var t of go(e))Df.call(e,t)&&yo(s,t,e[t]);return s},Hs=(s,e)=>Tf(s,Ef(e));const Pf=(s,e,t)=>({moveToolToNextPhase:n=>{s(a=>{if(!a.currentCycle)return a;const i=a.currentCycle.phases.find(h=>h.tools.includes(n)&&h.isActive);if(!i)return a;const c=hf(i.id);if(!c){const h=e();return h.incrementToolCycleCount&&h.incrementToolCycleCount(n),a}const l=e(),o=l.availableTools.find(h=>h.id===n);if(o!=null&&o.isP2Status&&c==="autoclave")return l.incrementToolCycleCount&&l.incrementToolCycleCount(n),a;let d=a.currentCycle.phases.find(h=>h.id===c);if(!d){const h=mf(c);h&&(d={id:c,name:h.name,duration:h.duration,tools:[],isActive:!1,startTime:null,endTime:null,status:"pending"})}if(!d)return a;const u=a.currentCycle.phases.map(h=>h.id===i.id?Hs(Us({},h),{tools:h.tools.filter(p=>p!==n)}):h.id===c?Hs(Us({},h),{tools:[...h.tools,n]}):h);return a.currentCycle.phases.find(h=>h.id===c)||u.push(d),Hs(Us({},a),{currentCycle:Hs(Us({},a.currentCycle),{phases:u})})})}}),Rf=s=>{let e=100,t=null;if(s.length>0){const n=new Date;n.setDate(n.getDate()-30);const a=s.filter(l=>l.date>=n),i=a.filter(l=>l.passed===!1),c=a.filter(l=>!l.passed&&l.date<n);if(a.length>0){const l=a.filter(o=>o.passed===!0).length;e=Math.round(l/a.length*100),i.length>0&&(t={direction:"down",value:`${i.length} failure(s) this month`})}else c.length>0&&(t={direction:"warning",value:`${c.length} test(s) missed this month`})}return{rate:e,trend:t}},Af=s=>{const e=new Date;e.setDate(e.getDate()-7);const t=new Date;t.setDate(t.getDate()-14);const n=s.filter(l=>new Date(l.startTime)>=e&&ai(l)),a=s.filter(l=>{const o=new Date(l.startTime);return o>=t&&o<e&&ai(l)}),i=n.length,c=a.length;if(c>0){const l=Math.round((i-c)/c*100);return{direction:l>=0?"up":"down",value:`${l>=0?"+":""}${l}% from last week`}}else if(i>0)return{direction:"up",value:"New this week"};return null},Of=(s,e)=>{const t=new Date;t.setDate(t.getDate()-30);const n=e.filter(c=>{const l=c.currentPhase==="complete"||c.currentPhase==="available",o=c.startTime&&c.endTime,d=o&&new Date(c.endTime)>=t,u=o&&new Date(c.endTime).getTime()-new Date(c.startTime).getTime()>1800*1e3;return l&&o&&d&&u});if(n.length===0)return 0;const a=n.reduce((c,l)=>{const o=new Date(l.startTime),u=new Date(l.endTime).getTime()-o.getTime();return c+u},0);return Math.round(a/n.length/(1e3*60))},$f=(s,e,t,n,a)=>{const i={cycleCompletionRate:.2,timeEfficiency:.15,resourceUtilization:.15,qualityMetrics:.15,throughputEfficiency:.1,inventoryEfficiency:.15},c=new Date;c.setDate(c.getDate()-7);const l=new Date;l.setDate(l.getDate()-14);const o=s.filter(D=>new Date(D.startTime)>=c&&ai(D)),d=o.length,u=o.filter(D=>D.completedAt!==null).length,h=d>0?u/d*100:0,p=60,f=Math.max(0,Math.min(100,(p-Math.abs(t-p))/p*100)),y=o.reduce((D,O)=>D+O.tools.length,0),g=d>0?y/d:0,b=Math.max(0,Math.min(100,g/7*100)),v=e,S=d/7,C=Math.max(0,Math.min(100,S/2.5*100));let P=0;const N=h*i.cycleCompletionRate+f*i.timeEfficiency+b*i.resourceUtilization+v*i.qualityMetrics+C*i.throughputEfficiency+P*i.inventoryEfficiency,j=s.filter(D=>{const O=new Date(D.startTime);return O>=l&&O<c});let E=null;if(j.length>0){const O=j.filter(U=>U.completedAt!==null).length/j.length*100*i.cycleCompletionRate+80,k=N-O,$=Math.round(k/O*100);E={direction:k>=0?"up":"down",value:`${k>=0?"+":""}${$}% from last week`}}return{score:Math.round(N),trend:E,breakdown:{sterilization:{completionRate:h,timeEfficiency:f,resourceUtilization:b,qualityScore:v,throughputEfficiency:C},inventory:{efficiency:P,lowStockItems:0,totalItems:0,expiringItems:0,accuracy:100}}}},Mf=(s,e,t,n)=>{const{rate:a,trend:i}=Rf(t),c=Af(s),l=Of(s,e),o=$f(s,a,l),d=new Date;d.setDate(d.getDate()-30);const u=s.filter(y=>{const g=new Date(y.startTime);return!isNaN(g.getTime())&&g>=d}),h=u.length,p=u.filter(y=>y.completedAt!==null).length,f=c&&c.direction!=="warning"?{direction:c.direction,value:c.value}:null;return{totalCycles:h,completedCycles:p,averageCycleTime:l,biPassRate:a,biPassRateTrend:i,cycleTrend:f,efficiencyScore:o}};var Ff=Object.defineProperty,zf=Object.defineProperties,Lf=Object.getOwnPropertyDescriptors,vo=Object.getOwnPropertySymbols,Bf=Object.prototype.hasOwnProperty,qf=Object.prototype.propertyIsEnumerable,xo=(s,e,t)=>e in s?Ff(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,aa=(s,e)=>{for(var t in e||(e={}))Bf.call(e,t)&&xo(s,t,e[t]);if(vo)for(var t of vo(e))qf.call(e,t)&&xo(s,t,e[t]);return s},Uf=(s,e)=>zf(s,Lf(e));const Hf=(s,e,t)=>{const n=bf(s,e),a=Nf(s,e),i=Pf(s,e);return Uf(aa(aa(aa({currentCycle:null,cycles:[],error:null},n),a),i),{getCycleStats:()=>{const c=e();return Mf(c.cycles||[],c.availableTools||[],c.biTestResults||[])}})},Vf=s=>({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:"",setModalOpen:e=>s({isModalOpen:e}),setShowAnalyticsModal:e=>s({showAnalyticsModal:e}),setShowCleaningLogModal:e=>s({showCleaningLogModal:e}),setShowBITestModal:e=>s({showBITestModal:e}),setShowBatchCodeModal:e=>s({showBatchCodeModal:e}),setWorkflowType:e=>s({workflowType:e}),setScannedData:e=>s({scannedData:e}),resetUIState:()=>s({isModalOpen:!1,showAnalyticsModal:!1,showCleaningLogModal:!1,showBITestModal:!1,showBatchCodeModal:!1,workflowType:"",scannedData:""})});var Wf=Object.defineProperty,Gf=Object.defineProperties,Kf=Object.getOwnPropertyDescriptors,bo=Object.getOwnPropertySymbols,Qf=Object.prototype.hasOwnProperty,Yf=Object.prototype.propertyIsEnumerable,_o=(s,e,t)=>e in s?Wf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Jf=(s,e)=>{for(var t in e||(e={}))Qf.call(e,t)&&_o(s,t,e[t]);if(bo)for(var t of bo(e))Yf.call(e,t)&&_o(s,t,e[t]);return s},Xf=(s,e)=>Gf(s,Kf(e));const ku=(s,e)=>({availableTools:[],toolsInCycle:[],setAvailableTools:t=>{s({availableTools:t})},addToolToCycle:t=>{const n=e().availableTools.find(a=>a.id===t);n&&s(a=>({toolsInCycle:[...a.toolsInCycle,n]}))},clearCycle:()=>{s({toolsInCycle:[]})},incrementToolCycleCount:t=>{s(n=>({availableTools:n.availableTools.map(a=>a.id===t?Xf(Jf({},a),{cycleCount:a.cycleCount+1}):a)}))},checkToolReplacementNeeded:t=>{const n=e().availableTools.find(a=>a.id===t);return n?n.cycleCount>=(n.maxCycles||200):!1},getToolCycleCount:t=>{const n=e().availableTools.find(a=>a.id===t);return n?n.cycleCount:0}});var Zf=Object.defineProperty,eg=Object.defineProperties,tg=Object.getOwnPropertyDescriptors,wo=Object.getOwnPropertySymbols,rg=Object.prototype.hasOwnProperty,sg=Object.prototype.propertyIsEnumerable,So=(s,e,t)=>e in s?Zf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,gr=(s,e)=>{for(var t in e||(e={}))rg.call(e,t)&&So(s,t,e[t]);if(wo)for(var t of wo(e))sg.call(e,t)&&So(s,t,e[t]);return s},yr=(s,e)=>eg(s,tg(e)),ng=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Du=s=>({activeToolId:null,activeWorkflowType:null,availableTools:[],toolsInCycle:[],updateToolStatus:(e,t)=>{s(n=>({availableTools:(n.availableTools||[]).map(a=>a.id===e?yr(gr({},a),{currentPhase:t}):a),toolsInCycle:(n.toolsInCycle||[]).map(a=>a.id===e?yr(gr({},a),{currentPhase:t}):a)}))},markToolAsDirty:e=>{s(t=>({availableTools:(t.availableTools||[]).map(n=>n.id===e?yr(gr({},n),{currentPhase:"failed"}):n),toolsInCycle:(t.toolsInCycle||[]).map(n=>n.id===e?yr(gr({},n),{currentPhase:"failed"}):n)}))},markToolAsProblem:(e,t,n)=>ng(null,null,function*(){const a="Current User";s(i=>({availableTools:(i.availableTools||[]).map(c=>c.id===e?yr(gr({},c),{status:"problem",problemType:t,problemNotes:n,problemReportedBy:a,problemReportedAt:new Date}):c),toolsInCycle:(i.toolsInCycle||[]).map(c=>c.id===e?yr(gr({},c),{status:"problem",problemType:t,problemNotes:n,problemReportedBy:a,problemReportedAt:new Date}):c)}))}),setActiveToolId:e=>s({activeToolId:e}),setActiveWorkflowType:e=>s({activeWorkflowType:e}),resetWorkflow:()=>s({activeToolId:null,activeWorkflowType:null})}),Pu=(s,e)=>({currentBatchId:null,batchedToolIds:[],currentCycle:null,setCurrentBatchId:t=>s({currentBatchId:t}),addToolToBatch:t=>s({batchedToolIds:[...e().batchedToolIds,t]}),resetBatch:()=>s({currentBatchId:null,batchedToolIds:[]})});var ag=Object.defineProperty,Co=Object.getOwnPropertySymbols,ig=Object.prototype.hasOwnProperty,og=Object.prototype.propertyIsEnumerable,jo=(s,e,t)=>e in s?ag(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ia=(s,e)=>{for(var t in e||(e={}))ig.call(e,t)&&jo(s,t,e[t]);if(Co)for(var t of Co(e))og.call(e,t)&&jo(s,t,e[t]);return s};const lg=(s,e,t)=>ia(ia(ia({},ku(s,e)),Du(s)),Pu(s,e));var cg=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const dg=s=>({lastGeneratedCode:null,generatedCodes:[],generateBatchCode:(e,t)=>cg(null,null,function*(){const n=t===1,a=new Date,i=a.toISOString().slice(0,10).replace(/-/g,""),c=a.toISOString().slice(11,17).replace(/:/g,""),l=Math.random().toString(36).substring(2,5).toUpperCase(),o=`${i}-${c}-${l}`,d={code:o,generatedAt:a,operator:e,toolCount:t,isSingleTool:n};return s(u=>({lastGeneratedCode:d,generatedCodes:[...u.generatedCodes,d]})),o}),validateBatchCode:e=>/^\d{8}-\d{4}-[A-Z0-9]{3}$/.test(e),getBatchByCode:(e,t)=>t.find(n=>n.batchCode===e)||null});var ug=Object.defineProperty,mg=Object.defineProperties,hg=Object.getOwnPropertyDescriptors,No=Object.getOwnPropertySymbols,pg=Object.prototype.hasOwnProperty,fg=Object.prototype.propertyIsEnumerable,Io=(s,e,t)=>e in s?ug(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Jr=(s,e)=>{for(var t in e||(e={}))pg.call(e,t)&&Io(s,t,e[t]);if(No)for(var t of No(e))fg.call(e,t)&&Io(s,t,e[t]);return s},Xr=(s,e)=>mg(s,hg(e)),To=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const gg=(s,e)=>({currentBatch:null,batches:[],batchHistory:[],batchLoading:!1,createBatch:(t,n)=>To(null,null,function*(){s({batchLoading:!0});try{const a=`batch_${Date.now()}`,i={id:a,batchCode:"",createdAt:new Date,createdBy:t,status:"creating",tools:[],packageInfo:{packageType:"",packageSize:""},sterilizationInfo:{},auditTrail:[{id:`audit_${Date.now()}`,timestamp:new Date,action:"created",operator:t,details:`Batch created in ${n?"batch":"single tool"} mode`}]};return s(c=>({currentBatch:i,batches:[...c.batches,i],batchLoading:!1})),a}catch(a){throw s({batchLoading:!1}),a}}),addToolToBatch:t=>{const{currentBatch:n}=e();if(n&&!n.tools.includes(t)){const a=Xr(Jr({},n),{tools:[...n.tools,t],auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_added",operator:n.createdBy,details:`Tool ${t} added to batch`,metadata:{toolId:t}}]});s(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))}},removeToolFromBatch:t=>{const{currentBatch:n}=e();if(!n)return;const a=Xr(Jr({},n),{tools:n.tools.filter(i=>i!==t),auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"tool_removed",operator:n.createdBy,details:`Tool ${t} removed from batch`,metadata:{toolId:t}}]});s(i=>({currentBatch:a,batches:i.batches.map(c=>c.id===n.id?a:c)}))},finalizeBatch:t=>To(null,null,function*(){const{currentBatch:n}=e();if(!n)throw new Error("No current batch to finalize");s({batchLoading:!0});try{const i=yield Q.getState().generateBatchCode(n.createdBy,n.tools.length),c=Xr(Jr({},n),{batchCode:i,status:"ready",packageInfo:t,auditTrail:[...n.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:"ready_for_autoclave",operator:n.createdBy,details:`Batch finalized with code ${i}`,metadata:{batchCode:i,packageInfo:t}}]});s(l=>({currentBatch:c,batches:l.batches.map(o=>o.id===n.id?c:o),batchHistory:[...l.batchHistory,c],batchLoading:!1}))}catch(a){throw s({batchLoading:!1}),a}}),updateBatchStatus:(t,n)=>{s(a=>{var i;return{batches:a.batches.map(c=>c.id===t?Xr(Jr({},c),{status:n,auditTrail:[...c.auditTrail,{id:`audit_${Date.now()}`,timestamp:new Date,action:n==="in_autoclave"?"autoclave_started":n==="completed"?"autoclave_completed":"tool_added",operator:c.createdBy,details:`Batch status updated to ${n}`,metadata:{status:n}}]}):c),currentBatch:((i=a.currentBatch)==null?void 0:i.id)===t?Xr(Jr({},a.currentBatch),{status:n}):a.currentBatch}})},getBatchById:t=>{const{batches:n,batchHistory:a}=e();return[...n,...a].find(i=>i.id===t)||null},getBatchesByStatus:t=>{const{batches:n,batchHistory:a}=e();return[...n,...a].filter(i=>i.status===t)},clearCurrentBatch:()=>s({currentBatch:null}),setBatchLoading:t=>s({batchLoading:t})});var yg=Object.defineProperty,vg=Object.defineProperties,xg=Object.getOwnPropertyDescriptors,Eo=Object.getOwnPropertySymbols,bg=Object.prototype.hasOwnProperty,_g=Object.prototype.propertyIsEnumerable,ko=(s,e,t)=>e in s?yg(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Do=(s,e)=>{for(var t in e||(e={}))bg.call(e,t)&&ko(s,t,e[t]);if(Eo)for(var t of Eo(e))_g.call(e,t)&&ko(s,t,e[t]);return s},Po=(s,e)=>vg(s,xg(e));const wg=(s,e)=>({currentPackagingSession:null,sessionLoading:!1,sessionError:null,startPackagingSession:(t,n=!1,a)=>{const i={id:`session_${Date.now()}`,operator:t,startTime:new Date,status:"active",scannedTools:[],isBatchMode:n,currentBatchId:a||null};s({currentPackagingSession:i,sessionError:null})},endPackagingSession:()=>{s({currentPackagingSession:null})},addToolToSession:t=>{const n=e().currentPackagingSession;if(n){const a=Po(Do({},n),{scannedTools:[...n.scannedTools,{id:t}]});s({currentPackagingSession:a})}},removeToolFromSession:t=>{const n=e().currentPackagingSession;if(n){const a=Po(Do({},n),{scannedTools:n.scannedTools.filter(i=>i.id!==t)});s({currentPackagingSession:a})}},clearSessionError:()=>{s({sessionError:null})}});var Sg=Object.defineProperty,Ro=Object.getOwnPropertySymbols,Cg=Object.prototype.hasOwnProperty,jg=Object.prototype.propertyIsEnumerable,Ao=(s,e,t)=>e in s?Sg(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,We=(s,e)=>{for(var t in e||(e={}))Cg.call(e,t)&&Ao(s,t,e[t]);if(Ro)for(var t of Ro(e))jg.call(e,t)&&Ao(s,t,e[t]);return s};const Q=Ft()((...s)=>We(We(We(We(We(We(We(We(We(We(We({},tf(...s)),lf(...s)),Hf(...s)),Vf(...s)),lg(...s)),Pu(...s)),dg(...s)),gg(...s)),ku(...s)),Du(...s)),wg(...s)));class ee extends Error{constructor(e,t,n="medium",a=!1,i){super(e),this.code=t,this.severity=n,this.retryable=a,this.details=i,this.name="BIFailureError"}}const G={MISSING_FACILITY_ID:"MISSING_FACILITY_ID",INVALID_TOOLS_COUNT:"INVALID_TOOLS_COUNT",MISSING_BATCH_IDS:"MISSING_BATCH_IDS",DATABASE_ERROR:"DATABASE_ERROR",NO_DATA_RETURNED:"NO_DATA_RETURNED",MAX_RETRIES_EXCEEDED:"MAX_RETRIES_EXCEEDED",UNEXPECTED_ERROR:"UNEXPECTED_ERROR",INCIDENT_NOT_FOUND:"INCIDENT_NOT_FOUND",INVALID_INCIDENT_STATUS:"INVALID_INCIDENT_STATUS",OPERATION_NOT_PERMITTED:"OPERATION_NOT_PERMITTED",NETWORK_ERROR:"NETWORK_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR"};var Ng=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class F{static handleDatabaseError(e,t,n){this.logError("DATABASE_ERROR",e,t,n);const a=e;throw(a==null?void 0:a.code)==="PGRST116"?new ee(`Database connection error during ${t}: ${a.message||"Unknown error"}`,"DATABASE_CONNECTION_ERROR","critical",!0):(a==null?void 0:a.code)==="23505"?new ee(`Duplicate record error during ${t}: ${a.message||"Unknown error"}`,"DUPLICATE_RECORD_ERROR","high",!1):(a==null?void 0:a.code)==="23503"?new ee(`Foreign key constraint error during ${t}: ${a.message||"Unknown error"}`,"FOREIGN_KEY_ERROR","high",!1):new ee(`Database error during ${t}: ${(a==null?void 0:a.message)||"Unknown error"}`,"DATABASE_ERROR","critical",!0)}static handleNetworkError(e,t,n){var a;this.logError("NETWORK_ERROR",e,t,n);const i=e;throw(i==null?void 0:i.code)==="NETWORK_ERROR"||(a=i==null?void 0:i.message)!=null&&a.includes("network")?new ee(`Network connection failed during ${t}: ${i.message||"Unknown error"}`,"NETWORK_ERROR","high",!0):(i==null?void 0:i.code)==="PGRST116"?new ee(`Database connection timeout during ${t}: ${i.message||"Unknown error"}`,"DATABASE_TIMEOUT_ERROR","critical",!0):new ee(`Network error during ${t}: ${(i==null?void 0:i.message)||"Unknown error"}`,"NETWORK_ERROR","high",!0)}static handleValidationError(e,t,n="medium"){throw this.logError("VALIDATION_ERROR",{message:e,code:t},"validation"),new ee(e,t,n,!1)}static handleAuthorizationError(e,t,n){this.logError("AUTHORIZATION_ERROR",e,t,n);const a=e;throw new ee(`Authorization error during ${t}: ${(a==null?void 0:a.message)||"Access denied"}`,"AUTHORIZATION_ERROR","high",!1)}static handleCriticalError(e,t,n){var a,i,c;this.logError("CRITICAL_ERROR",e,t,n);const l=e;throw(l==null?void 0:l.code)==="CRITICAL_ERROR"||(a=l==null?void 0:l.message)!=null&&a.includes("critical")?new ee(`Critical error during ${t}: ${l.message||"System failure"}`,"CRITICAL_ERROR","critical",!1):(l==null?void 0:l.code)==="HIGH_PRIORITY"||(i=l==null?void 0:l.message)!=null&&i.includes("high")?new ee(`High priority error during ${t}: ${l.message||"High priority issue"}`,"HIGH_PRIORITY_ERROR","high",!1):(l==null?void 0:l.code)==="MEDIUM_PRIORITY"||(c=l==null?void 0:l.message)!=null&&c.includes("medium")?new ee(`Medium priority error during ${t}: ${l.message||"Medium priority issue"}`,"MEDIUM_PRIORITY_ERROR","medium",!1):new ee(`Critical error during ${t}: ${(l==null?void 0:l.message)||"Unknown critical error"}`,"CRITICAL_ERROR","critical",!1)}static createStandardizedError(e,t,n="UNKNOWN_ERROR"){const a=e;return new ee((a==null?void 0:a.message)||`Unknown error during ${t}`,n,"medium",!0,{name:(a==null?void 0:a.name)||"UnknownError",message:(a==null?void 0:a.message)||"No message",code:(a==null?void 0:a.code)||"NO_CODE",operation:t,stack:a==null?void 0:a.stack})}static logError(e,t,n,a){if(this.errorCount++,this.errorCount>this.MAX_ERRORS){console.warn("Maximum error count reached, stopping error logging");return}const i={type:e,operation:n,timestamp:new Date().toISOString(),context:a,error:t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t};console.error("BIFailureErrorHandler:",i),t instanceof Error&&(this.lastError=t)}static getLastError(){return this.lastError}static reset(){this.lastError=null,this.errorCount=0}static isRetryableError(e){var t,n,a;if(e instanceof ee)return e.retryable;const i=e;return!!((i==null?void 0:i.code)==="NETWORK_ERROR"||(t=i==null?void 0:i.message)!=null&&t.includes("network")||(n=i==null?void 0:i.message)!=null&&n.includes("timeout")||(i==null?void 0:i.code)==="PGRST116"||(a=i==null?void 0:i.message)!=null&&a.includes("connection"))}static handleUnexpectedError(e,t){this.logError("UNEXPECTED_ERROR",e,t);const n=e;throw new ee(`Unexpected error during ${t}: ${(n==null?void 0:n.message)||"Unknown error"}`,"UNEXPECTED_ERROR","critical",!1)}static withRetry(e,t,n=3,a=1e3){return Ng(this,null,function*(){let i=null;for(let c=1;c<=n;c++)try{return yield e()}catch(l){if(i=this.createStandardizedError(l,t),!this.isRetryableError(l)||c===n)throw i;yield new Promise(o=>setTimeout(o,a*c))}throw i||new ee(`Operation failed after ${n} attempts: ${t}`,"MAX_RETRIES_EXCEEDED","critical",!1)})}}F.lastError=null;F.errorCount=0;F.MAX_ERRORS=100;class lt{static validateCreateIncidentParams(e){e.facility_id||F.handleValidationError("Facility ID is required",G.MISSING_FACILITY_ID,"critical"),e.affected_tools_count<0&&F.handleValidationError("Affected tools count cannot be negative",G.INVALID_TOOLS_COUNT,"high"),(!Array.isArray(e.affected_batch_ids)||e.affected_batch_ids.length===0)&&F.handleValidationError("At least one affected batch ID is required",G.MISSING_BATCH_IDS,"critical");for(const t of e.affected_batch_ids)(!t||typeof t!="string"||t.trim().length===0)&&F.handleValidationError("Invalid batch ID format",G.VALIDATION_ERROR,"high");e.severity_level&&!["low","medium","high","critical"].includes(e.severity_level)&&F.handleValidationError("Invalid severity level. Must be one of: low, medium, high, critical",G.VALIDATION_ERROR,"medium"),this.isValidUUID(e.facility_id)||F.handleValidationError("Invalid facility ID format",G.VALIDATION_ERROR,"high"),e.detected_by_operator_id&&!this.isValidUUID(e.detected_by_operator_id)&&F.handleValidationError("Invalid operator ID format",G.VALIDATION_ERROR,"medium")}static validateResolveIncidentParams(e){e.incidentId||F.handleValidationError("Incident ID is required",G.VALIDATION_ERROR,"critical"),e.resolvedByOperatorId||F.handleValidationError("Resolving operator ID is required",G.VALIDATION_ERROR,"critical"),this.isValidUUID(e.incidentId)||F.handleValidationError("Invalid incident ID format",G.VALIDATION_ERROR,"high"),this.isValidUUID(e.resolvedByOperatorId)||F.handleValidationError("Invalid operator ID format",G.VALIDATION_ERROR,"high"),e.resolutionNotes&&e.resolutionNotes.length>1e4&&F.handleValidationError("Resolution notes cannot exceed 10,000 characters",G.VALIDATION_ERROR,"medium")}static validateQuarantineToolsParams(e){e.incidentId||F.handleValidationError("Incident ID is required",G.VALIDATION_ERROR,"critical"),e.quarantinedByOperatorId||F.handleValidationError("Quarantining operator ID is required",G.VALIDATION_ERROR,"critical"),(!Array.isArray(e.tools)||e.tools.length===0)&&F.handleValidationError("At least one tool must be specified for quarantine",G.VALIDATION_ERROR,"high");for(const t of e.tools)t.tool_id||F.handleValidationError("Tool ID is required for each tool",G.VALIDATION_ERROR,"high"),this.isValidUUID(t.tool_id)||F.handleValidationError("Invalid tool ID format",G.VALIDATION_ERROR,"high");this.isValidUUID(e.incidentId)||F.handleValidationError("Invalid incident ID format",G.VALIDATION_ERROR,"high"),this.isValidUUID(e.quarantinedByOperatorId)||F.handleValidationError("Invalid operator ID format",G.VALIDATION_ERROR,"high")}static validateRecordToolUsageParams(e){e.facilityId||F.handleValidationError("Facility ID is required",G.MISSING_FACILITY_ID,"critical"),e.toolId||F.handleValidationError("Tool ID is required",G.VALIDATION_ERROR,"critical"),e.patientId||F.handleValidationError("Patient ID is required",G.VALIDATION_ERROR,"critical"),this.isValidUUID(e.facilityId)||F.handleValidationError("Invalid facility ID format",G.VALIDATION_ERROR,"high"),this.isValidUUID(e.toolId)||F.handleValidationError("Invalid tool ID format",G.VALIDATION_ERROR,"high"),this.isValidUUID(e.patientId)||F.handleValidationError("Invalid patient ID format",G.VALIDATION_ERROR,"high"),e.operatorId&&!this.isValidUUID(e.operatorId)&&F.handleValidationError("Invalid operator ID format",G.VALIDATION_ERROR,"medium"),e.procedureNotes&&e.procedureNotes.length>5e3&&F.handleValidationError("Procedure notes cannot exceed 5,000 characters",G.VALIDATION_ERROR,"medium")}static validateFacilityId(e){e||F.handleValidationError("Facility ID is required",G.MISSING_FACILITY_ID,"high"),this.isValidUUID(e)||F.handleValidationError("Invalid facility ID format",G.VALIDATION_ERROR,"high")}static validateIncidentId(e){e||F.handleValidationError("Incident ID is required",G.VALIDATION_ERROR,"critical"),this.isValidUUID(e)||F.handleValidationError("Invalid incident ID format",G.VALIDATION_ERROR,"high")}static validateDateRange(e,t){const n=new Date(e),a=new Date(t);isNaN(n.getTime())&&F.handleValidationError("Invalid start date format",G.VALIDATION_ERROR,"medium"),isNaN(a.getTime())&&F.handleValidationError("Invalid end date format",G.VALIDATION_ERROR,"medium"),n>a&&F.handleValidationError("Start date cannot be after end date",G.VALIDATION_ERROR,"medium");const i=new Date;i.setFullYear(i.getFullYear()-5),n<i&&F.handleValidationError("Start date cannot be more than 5 years ago",G.VALIDATION_ERROR,"medium")}static isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}static validateBusinessRules(e){e.affected_tools_count>1e4&&F.handleValidationError("Affected tools count seems unreasonably high. Please verify the data.",G.VALIDATION_ERROR,"medium"),new Set(e.affected_batch_ids).size!==e.affected_batch_ids.length&&F.handleValidationError("Duplicate batch IDs are not allowed",G.VALIDATION_ERROR,"medium"),e.failure_reason&&e.failure_reason.length>2e3&&F.handleValidationError("Failure reason cannot exceed 2,000 characters",G.VALIDATION_ERROR,"medium")}}var Ig=Object.defineProperty,Tg=Object.defineProperties,Eg=Object.getOwnPropertyDescriptors,Oo=Object.getOwnPropertySymbols,kg=Object.prototype.hasOwnProperty,Dg=Object.prototype.propertyIsEnumerable,$o=(s,e,t)=>e in s?Ig(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,vr=(s,e)=>{for(var t in e||(e={}))kg.call(e,t)&&$o(s,t,e[t]);if(Oo)for(var t of Oo(e))Dg.call(e,t)&&$o(s,t,e[t]);return s},Vs=(s,e)=>Tg(s,Eg(e)),ve=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class oa{static createIncident(e){return ve(this,null,function*(){var t;try{lt.validateCreateIncidentParams(e),lt.validateBusinessRules(e);const n=yield F.withRetry(()=>ve(null,null,function*(){const{data:a,error:i}=yield _.from("bi_failure_incidents").insert({facility_id:e.facility_id,cycle_id:e.bi_test_result_id,user_id:e.detected_by_operator_id,incident_type:e.incident_type||"bi_failure",severity:e.severity||"medium",description:e.description||"BI test failure incident",failure_reason:e.failure_reason,status:"open",detected_at:new Date().toISOString(),metadata:{affected_tools_count:e.affected_tools_count,affected_batch_ids:e.affected_batch_ids,notes:e.notes}}).select().single();if(i)throw i;if(!a)throw new Error("No data returned from incident creation");return a}),"create BI failure incident");if(n&&e.lastSuccessfulBIDate)try{yield this.identifyExposureWindowTools(n.id,e.lastSuccessfulBIDate),console.log("Exposure window tools identified for incident:",n.incident_number)}catch(a){global.__TESTING__||console.error("Error identifying exposure window tools:",a)}return Vs(vr({},n),{affected_batch_ids:(t=n.affected_batch_ids)!=null?t:[]})}catch(n){if(n instanceof Error&&n.name==="BIFailureError")throw n;F.handleUnexpectedError(n,"create BI failure incident")}})}static getActiveIncidents(e){return ve(this,null,function*(){lt.validateFacilityId(e);try{const{data:t}=yield F.withRetry(()=>ve(null,null,function*(){const n=yield _.from("bi_failure_incidents").select("*").eq("facility_id",e).in("status",["active","in_resolution"]).order("failure_date",{ascending:!1});if(n.error)throw n.error;return n}),"get active BI failure incidents");return(t!=null?t:[]).map(n=>{var a;return Vs(vr({},n),{affected_batch_ids:(a=n.affected_batch_ids)!=null?a:[]})})}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;F.handleUnexpectedError(t,"get active BI failure incidents")}})}static getIncidentById(e,t){return ve(this,null,function*(){var n;lt.validateIncidentId(e);try{const{data:a}=yield F.withRetry(()=>ve(null,null,function*(){const i=yield _.from("bi_failure_incidents").select("*").eq("id",e).eq("facility_id",t).single();if(i.error){if(i.error.code==="PGRST116")return{data:null,error:null};throw i.error}return i}),"get BI failure incident by ID");return a?Vs(vr({},a),{affected_batch_ids:(n=a.affected_batch_ids)!=null?n:[]}):null}catch(a){if(a instanceof Error&&a.name==="BIFailureError")throw a;F.handleUnexpectedError(a,"get BI failure incident by ID")}})}static resolveIncident(e){return ve(this,null,function*(){lt.validateResolveIncidentParams(e);try{return!!(yield F.withRetry(()=>ve(null,null,function*(){const{data:n,error:a}=yield _.from("bi_failure_incidents").update({status:"resolved",resolved_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e.incidentId).select("id").single();return a&&F.handleDatabaseError(a,"resolve BI failure incident"),n}),"resolve BI failure incident"))}catch(t){if(t instanceof Error&&t.name==="BIFailureError")throw t;F.handleUnexpectedError(t,"resolve BI failure incident")}})}static updateIncidentStatus(e,t,n,a){return ve(this,null,function*(){lt.validateIncidentId(e);try{const{data:i}=yield F.withRetry(()=>ve(null,null,function*(){const c=yield _.from("bi_failure_incidents").update(vr({status:n,updated_at:new Date().toISOString()},a&&{updated_by_operator_id:a})).eq("id",e).eq("facility_id",t).select("id").single();if(c.error)throw c.error;return c}),"update incident status");return!!i}catch(i){if(i instanceof Error&&i.name==="BIFailureError")throw i;F.handleUnexpectedError(i,"update incident status")}})}static deleteIncident(e,t,n){return ve(this,null,function*(){lt.validateIncidentId(e);try{const{data:a}=yield F.withRetry(()=>ve(null,null,function*(){const i=yield _.from("bi_failure_incidents").update(vr({status:"closed",updated_at:new Date().toISOString()},n&&{deleted_by_operator_id:n})).eq("id",e).eq("facility_id",t).select("id").single();if(i.error)throw i.error;return i}),"delete BI failure incident");return!!a}catch(a){if(a instanceof Error&&a.name==="BIFailureError")throw a;F.handleUnexpectedError(a,"delete BI failure incident")}})}static getIncidentHistory(e,t,n,a=100){return ve(this,null,function*(){lt.validateFacilityId(e),t&&n&&lt.validateDateRange(t,n);try{let i=_.from("bi_failure_incidents").select("*").eq("facility_id",e).order("failure_date",{ascending:!1}).limit(a);t&&(i=i.gte("failure_date",t)),n&&(i=i.lte("failure_date",n));const{data:c}=yield F.withRetry(()=>ve(null,null,function*(){const l=yield i;if(l.error)throw l.error;return l}),"get incident history");return(c!=null?c:[]).map(l=>{var o;return Vs(vr({},l),{affected_batch_ids:(o=l.affected_batch_ids)!=null?o:[]})})}catch(i){if(i instanceof Error&&i.name==="BIFailureError")throw i;F.handleUnexpectedError(i,"get incident history")}})}static identifyExposureWindowTools(e,t){return ve(this,null,function*(){try{const{data:n,error:a}=yield F.withRetry(()=>ve(null,null,function*(){return yield _.rpc("identify_exposure_window_tools",{p_incident_id:e,p_last_successful_bi_date:t.toISOString()})}),"identify exposure window tools");return a&&F.handleDatabaseError(a,"identify exposure window tools"),n!=null?n:0}catch(n){if(n instanceof Error&&n.name==="BIFailureError")throw n;F.handleUnexpectedError(n,"identify exposure window tools")}})}static getCurrentFacilityId(){return ve(this,null,function*(){var e,t;try{const{data:{session:n}}=yield _.auth.getSession(),a=(t=(e=n==null?void 0:n.user)==null?void 0:e.app_metadata)==null?void 0:t.facility_id;if(!a)throw new Error("No authenticated facility ID found.");return a}catch(n){throw console.error("Failed to get current facility ID:",n),new Error("No authenticated facility ID found.")}})}}var ii=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Mo=(s,e)=>{const t=document.createElement("div");if(t.className=`
    fixed top-4 right-4 z-[10000] bg-white border-l-4 border-green-500 
    shadow-lg rounded-lg p-4 max-w-md transform transition-all duration-300 
    animate-slide-in-right
  `,t.style.cssText=`
    animation: slideInRight 0.3s ease-out;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  `,t.innerHTML=`
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div class="ml-3 flex-1">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-gray-800">${s}</h3>
          <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="ml-2 text-gray-400 hover:text-gray-600">
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
        <p class="mt-1 text-sm text-gray-600">${e}</p>
      </div>
    </div>
  `,!document.getElementById("cliniio-notification-styles")){const n=document.createElement("style");n.id="cliniio-notification-styles",n.textContent=`
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(n)}document.body.appendChild(t),setTimeout(()=>{t.parentElement&&(t.style.transform="translateX(100%)",t.style.opacity="0",setTimeout(()=>{t.parentElement&&t.remove()},300))},5e3)},Fo=()=>ii(null,null,function*(){try{const{SupabaseAuthService:s}=yield q(()=>import("./authService-BA4JXlKn.js"),__vite__mapDeps([0,1,2,3,4,5])),{user:e,error:t}=yield s.getCurrentUser();if(t&&console.warn("Auth service error:",t),e!=null&&e.id)return e.id;const n=sessionStorage.getItem("currentOperatorId")||localStorage.getItem("currentOperatorId");if(n)return n;throw console.error("No operator ID found in production. User may not be authenticated."),new Error("User not authenticated - no operator ID available")}catch(s){throw console.error("Failed to get operator ID:",s),new Error("Authentication required - unable to get operator ID")}}),Pg=({onClose:s,onSuccess:e})=>{const{biFailureDetails:t,deactivateBIFailure:n}=Q(),[a,i]=m.useState(!1),[c,l]=m.useState(null),[o,d]=m.useState(!1),[u,h]=m.useState(""),p=m.useCallback(()=>ii(null,null,function*(){i(!0),l(null);try{const N=yield Fo();if(!t)throw new Error("No BI failure incident to resolve");const j=sessionStorage.getItem("currentBIFailureIncidentId");if(j){const E=yield oa.resolveIncident({incidentId:j,resolvedByOperatorId:N,resolutionNotes:u});console.log("✅ BI Failure Resolution completed:",{incidentId:j,resolvedByOperatorId:N,resolutionNotes:u,timestamp:new Date().toISOString()}),Mo("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const D=Q.getState();D.loadBITestResults&&(D.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("🔄 Refreshed BI test results after incident resolution"))},1e3)}else{const E="550e8400-e29b-41d4-a716-446655440000",{data:D,error:O}=yield _.from("bi_failure_incidents").insert({facility_id:E,user_id:N,incident_type:"bi_test_failure",severity:"high",status:"open",description:"BI Test Failure - Contamination Detected",failure_reason:"Biological indicator test failed, indicating sterilization failure",metadata:{affected_tools_count:(t==null?void 0:t.affectedToolsCount)||1,affected_batch_ids:(t==null?void 0:t.affectedBatchIds)||["DEFAULT-BATCH"]}}).select().single();if(O)throw new Error(`Failed to create incident: ${O.message}`);const k=yield oa.resolveIncident({incidentId:D.id,resolvedByOperatorId:N,resolutionNotes:u}),$=Q.getState();$.addActivity&&$.addActivity({id:`bi-incident-resolved-${D.id}`,type:"incident-resolution",title:"BI Failure Incident Resolved",time:new Date,toolCount:(t==null?void 0:t.affectedToolsCount)||1,color:"bg-blue-500",metadata:{incidentId:D.id,operatorId:N,resolutionNotes:u}}),Mo("BI Failure Incident Resolved","The BI failure incident has been successfully resolved and logged in the system."),setTimeout(()=>{const U=Q.getState();U.loadBITestResults&&(U.loadBITestResults("550e8400-e29b-41d4-a716-446655440000"),console.log("🔄 Refreshed BI test results after incident resolution"))},1e3),console.log("✅ BI Failure Resolution completed:",{incidentId:D.id,resolvedByOperatorId:N,resolutionNotes:u,timestamp:new Date().toISOString()}),sessionStorage.setItem("currentBIFailureIncidentId",D.id)}n(),e(),s()}catch(N){if(console.error("Failed to resolve BI failure incident:",N),N instanceof ee)l({message:N.message,code:N.code,severity:N.severity,retryable:N.retryable});else if(N&&typeof N=="object"&&"name"in N&&N.name==="BIFailureError"){const j=N;l({message:j.message,code:j.code,severity:j.severity,retryable:j.retryable})}else l({message:N instanceof Error?N.message:"An unexpected error occurred",severity:"high",retryable:!1})}finally{i(!1)}}),[u,n,e,s,t]),f=m.useCallback(N=>ii(null,null,function*(){i(!0),l(null);try{const j=yield Fo(),E={facility_id:N.facilityId,detected_by_operator_id:j,affected_tools_count:N.affectedToolsCount,affected_batch_ids:N.affectedBatchIds,failure_reason:N.failureReason,severity_level:N.severityLevel||"high"};return yield oa.createIncident(E)}catch(j){throw console.error("Failed to create BI failure incident:",j),j instanceof ee?l({message:j.message,code:j.code,severity:j.severity,retryable:j.retryable}):l({message:j instanceof Error?j.message:"Failed to create incident",severity:"high",retryable:!1}),j}finally{i(!1)}}),[]),y=m.useCallback(()=>{l(null),p()},[p]),g=m.useCallback(()=>{l(null),d(!1),s()},[s]),x=m.useCallback(N=>{N.target===N.currentTarget&&g()},[g]),b=m.useCallback(N=>{N.key==="Escape"&&g()},[g]),v=m.useCallback(()=>{d(N=>!N)},[]),w=m.useCallback(N=>{h(N)},[]),S=m.useCallback(()=>"mdiAlertCircle",[]),T=m.useCallback(N=>{switch(N){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},[]),C=m.useCallback(()=>a||!t,[a,t]),P=m.useCallback(()=>a?"Resolving...":"Confirm Resolution",[a]);return{isLoading:a,error:c,showExposureReport:o,resolutionNotes:u,biFailureDetails:t,handleResolve:p,createIncident:f,handleRetry:y,handleClose:g,handleBackdropClick:x,handleKeyDown:b,toggleExposureReport:v,updateResolutionNotes:w,getErrorIcon:S,getErrorColor:T,isResolveButtonDisabled:C,getResolveButtonText:P}},Rg=({isSubmitting:s,onClose:e,onMinimize:t})=>{const n=()=>{s||e()},a=i=>{i.key==="Enter"&&!s&&n()};return r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(I,{path:Bn,size:1.5,className:"text-red-500"}),r.jsxs("div",{children:[r.jsx("h2",{id:"bi-failure-modal-title",className:"text-xl font-semibold text-gray-900",children:"BI Failure Resolution Workflow"}),r.jsx("p",{id:"bi-failure-modal-description",className:"text-sm text-gray-600",children:"Complete these steps to resolve the BI failure"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[t&&r.jsx("button",{onClick:t,disabled:s,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${s?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Minimize workflow to banner",title:"Minimize to continue working on other tasks",children:r.jsx(I,{path:qn,size:1.2})}),r.jsx("button",{onClick:n,onKeyDown:a,disabled:s,className:`p-2 hover:bg-gray-100 rounded-lg transition-colors ${s?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Close modal","aria-describedby":"bi-failure-modal-description",children:r.jsx(I,{path:Pe,size:1.2})})]})]})};var Ag=Object.defineProperty,Og=Object.defineProperties,$g=Object.getOwnPropertyDescriptors,zo=Object.getOwnPropertySymbols,Mg=Object.prototype.hasOwnProperty,Fg=Object.prototype.propertyIsEnumerable,Lo=(s,e,t)=>e in s?Ag(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,zg=(s,e)=>{for(var t in e||(e={}))Mg.call(e,t)&&Lo(s,t,e[t]);if(zo)for(var t of zo(e))Fg.call(e,t)&&Lo(s,t,e[t]);return s},Lg=(s,e)=>Og(s,$g(e));const Ii=()=>{const{biTestResults:s,cycles:e,currentCycle:t,availableTools:n}=Q();return m.useMemo(()=>{const a=s.filter(w=>w.passed).sort((w,S)=>new Date(S.date).getTime()-new Date(w.date).getTime())[0],i=a?new Date(a.date):null,c=t?[...e,t]:e,l=i?c.filter(w=>new Date(w.startTime)>i):c,o=l.flatMap(w=>w.tools.map(S=>S)),d=new Map;o.forEach(w=>{d.set(w,(d.get(w)||0)+1)});const h=Array.from(d.keys()).map(w=>{const S=n.find(C=>C.id===w),T=d.get(w)||0;return Lg(zg({},S||{id:w,name:`Tool ${w}`,barcode:w,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:void 0,status:"available"}),{riskWindowCycles:T})}),p=h.length,f=l.length,y=o.length,g=h.filter(w=>w.riskWindowCycles>1).length,x=[...new Set(l.map(w=>w.operator))],b=l.length>0?{start:new Date(Math.min(...l.map(w=>new Date(w.startTime).getTime()))),end:new Date(Math.max(...l.map(w=>new Date(w.startTime).getTime())))}:null,v=h.reduce((w,S)=>{const T=S.category||"Unknown";return w[T]=(w[T]||0)+1,w},{});return{lastPassedDate:i,affectedCycles:l,affectedTools:h,totalToolsAffected:p,totalCyclesAffected:f,totalSterilizationEvents:y,toolsUsedMultipleTimes:g,uniqueOperators:x,dateRange:b,toolsByCategory:v,hasCurrentCycleAffected:!!(t&&(!i||new Date(t.startTime)>i))}},[s,e,t,n])},Bg=({biFailureDetails:s})=>{const e=Ii(),t=e.affectedCycles.map(n=>n.batchId).filter(n=>!!n);return s?r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[r.jsx(I,{path:de,size:1.2,className:"text-red-500"}),r.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),r.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4 p-3 bg-white rounded-lg border border-red-100",children:[r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center mb-1",children:[r.jsx(I,{path:Rn,size:1,className:"text-red-500 mr-1"}),r.jsx("span",{className:"text-xs font-medium text-red-700",children:"Cycles"})]}),r.jsx("div",{className:"text-lg font-bold text-red-800",children:e.totalCyclesAffected})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center mb-1",children:[r.jsx(I,{path:lr,size:1,className:"text-red-500 mr-1"}),r.jsx("span",{className:"text-xs font-medium text-red-700",children:"Batches"})]}),r.jsx("div",{className:"text-lg font-bold text-red-800",children:t.length})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center mb-1",children:[r.jsx(I,{path:Ss,size:1,className:"text-red-500 mr-1"}),r.jsx("span",{className:"text-xs font-medium text-red-700",children:"Tools"})]}),r.jsx("div",{className:"text-lg font-bold text-red-800",children:e.totalToolsAffected})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center mb-1",children:[r.jsx(I,{path:bh,size:1,className:"text-red-600 mr-1"}),r.jsx("span",{className:"text-xs font-medium text-red-700",children:"Multi-Use"})]}),r.jsx("div",{className:"text-lg font-bold text-red-800",children:e.toolsUsedMultipleTimes})]})]}),r.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[r.jsxs("div",{className:"flex items-start space-x-2",children:[r.jsx(I,{path:Rn,size:.8,className:"text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Risk Window:"})," ",e.dateRange?r.jsxs("span",{className:"font-mono text-xs",children:[e.dateRange.start.toLocaleDateString()," →"," ",e.dateRange.end.toLocaleDateString()]}):"All cycles (no previous passed BI test)"]})]}),r.jsxs("div",{className:"flex items-start space-x-2",children:[r.jsx(I,{path:lr,size:.8,className:"text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Affected Batches:"})," ",t.length>0?r.jsxs("span",{className:"font-mono text-xs",children:[t.slice(0,3).join(", "),t.length>3&&` +${t.length-3} more`]}):"No batch IDs available"]})]}),r.jsxs("div",{className:"flex items-start space-x-2",children:[r.jsx(I,{path:Ss,size:.8,className:"text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Tools by Category:"})," ",r.jsx("span",{className:"text-xs",children:Object.entries(e.toolsByCategory).map(([n,a])=>`${n}: ${a}`).join(", ")})]})]}),r.jsxs("div",{className:"flex items-start space-x-2",children:[r.jsx(I,{path:de,size:.8,className:"text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Contamination Scope:"})," ",e.totalSterilizationEvents," total sterilization events in risk window."," ",e.toolsUsedMultipleTimes>0&&r.jsxs("span",{className:"text-red-600 font-medium",children:[e.toolsUsedMultipleTimes," tools used multiple times (require extra attention)"]})]})]}),r.jsxs("div",{className:"flex items-start space-x-2",children:[r.jsx(I,{path:de,size:.8,className:"text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Detected By:"})," ",s.operator," •"," ",r.jsx("strong",{children:"Date:"})," ",(()=>{try{return s.date?s.date instanceof Date?s.date.toLocaleDateString():new Date(s.date).toLocaleDateString():"Unknown date"}catch(n){return console.error("Date formatting error:",n),"Invalid date"}})()]})]})]})]}):r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[r.jsx(I,{path:de,size:1.2,className:"text-red-500"}),r.jsx("span",{className:"font-medium text-red-800",children:"Current Status: BI Failure Active"})]}),r.jsxs("div",{className:"text-sm text-red-700 space-y-1",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Affected Tools:"})," 0 tools are currently quarantined"]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Failure Date:"})," Unknown date"]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Affected Batches:"})," No batch IDs available"]})]})]})};var qg=Object.defineProperty,Ug=Object.defineProperties,Hg=Object.getOwnPropertyDescriptors,Bo=Object.getOwnPropertySymbols,Vg=Object.prototype.hasOwnProperty,Wg=Object.prototype.propertyIsEnumerable,qo=(s,e,t)=>e in s?qg(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Uo=(s,e)=>{for(var t in e||(e={}))Vg.call(e,t)&&qo(s,t,e[t]);if(Bo)for(var t of Bo(e))Wg.call(e,t)&&qo(s,t,e[t]);return s},Ho=(s,e)=>Ug(s,Hg(e)),Gg=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Kg=({onToggleExposureReport:s})=>{const{currentUser:e,initializeUserContext:t}=cr();m.useEffect(()=>{e||t()},[e,t]);const[n,a]=m.useState([]),[i,c]=m.useState(!1),[l,o]=m.useState(null);m.useEffect(()=>{const x=()=>{c(!0);const v=sessionStorage.getItem("biFailureWorkflowState");if(v)try{const w=JSON.parse(v);a(w),console.log("📋 Restored workflow state from session storage")}catch(w){console.error("Failed to parse saved workflow state:",w),b()}else b();c(!1)},b=()=>{a([{step_id:"quarantine",status:"in_progress"},{step_id:"re-sterilization",status:"pending"},{step_id:"new-bi-test",status:"pending"},{step_id:"documentation",status:"pending"}])};x()},[]);const d=x=>Gg(null,null,function*(){if(!e){console.error("No current user available - currentUser:",e);return}const b=e.id||e.email||"unknown-user",v=n.findIndex(w=>w.step_id===x);if(v===-1){console.error(`Step ${x} not found`);return}try{const w=[...n];w[v]=Ho(Uo({},w[v]),{status:"completed",completed_by_user_id:b,completed_at:new Date().toISOString(),notes:`Completed by ${e.email}`}),v+1<w.length&&(w[v+1]=Ho(Uo({},w[v+1]),{status:"in_progress"})),a(w),sessionStorage.setItem("biFailureWorkflowState",JSON.stringify(w)),console.log(`✅ Step ${x} completed by ${e.email||"unknown user"}`)}catch(w){console.error(`Failed to complete step ${x}:`,w),o(`Failed to complete step: ${w instanceof Error?w.message:"Unknown error"}`)}}),u=x=>{const b=n.find(v=>v.step_id===x);return(b==null?void 0:b.status)||"pending"},h=x=>{const b=n.find(v=>v.step_id===x);return(b==null?void 0:b.status)==="in_progress"},p=x=>{const b=n.find(v=>v.step_id===x);return{completedBy:b==null?void 0:b.completed_by_user_id,completedAt:b==null?void 0:b.completed_at,notes:b==null?void 0:b.notes}},f=[{id:"quarantine",title:"Quarantine All Affected Tools",description:"Ensure all tools from affected batches are properly quarantined",icon:lr,isInteractive:!0},{id:"re-sterilization",title:"Re-sterilize All Quarantined Tools",description:"Re-sterilize all affected tools using proper protocols",icon:Cs,isInteractive:!0},{id:"new-bi-test",title:"Perform New BI Test",description:"Conduct a new biological indicator test to verify sterilization",icon:Cs,isInteractive:!0},{id:"documentation",title:"Complete Documentation",description:"Document all actions taken and results obtained",icon:Ue,isInteractive:!0}],y=x=>{switch(x){case"completed":return"text-green-600 bg-green-50 border-green-200";case"in_progress":return"text-blue-600 bg-blue-50 border-blue-200";case"pending":return"text-gray-600 bg-gray-50 border-gray-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},g=x=>{switch(x){case"completed":return"Completed";case"in_progress":return"In Progress";case"pending":return"Pending";default:return"Unknown"}};return i?r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),r.jsxs("div",{className:"text-center py-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Loading workflow progress..."})]})]}):l?r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(I,{path:de,size:1.2,className:"text-red-500 mr-2"}),r.jsx("p",{className:"text-red-700",children:l})]})})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Resolution Workflow Steps"}),r.jsx("div",{className:"space-y-3",children:f.map(x=>{const b=u(x.id),v=b==="completed",w=b==="pending",S=h(x.id),T=p(x.id);return r.jsx("div",{className:`border rounded-lg p-4 ${w?"text-gray-400 bg-gray-50 border-gray-200":y(b)}`,children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx(I,{path:x.icon,size:1.2,className:"mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("h4",{className:"font-medium",children:x.title}),r.jsx("div",{className:"flex items-center space-x-2",children:S?r.jsxs("button",{onClick:()=>d(x.id),className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-xs font-medium",children:[r.jsx(I,{path:bi,size:.8}),r.jsx("span",{children:"Mark Complete"})]}):v?r.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-white bg-opacity-75",children:g(b)}):w?r.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-gray-200 text-gray-500",children:"Waiting for previous step"}):null})]}),r.jsx("p",{className:"text-sm opacity-90",children:x.description}),x.isInteractive&&v&&r.jsx("div",{className:"mt-2 text-xs opacity-75",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("span",{children:["✅ Completed by:"," ",T.completedBy||"Unknown"]}),r.jsxs("span",{children:["🕒"," ",T.completedAt?new Date(T.completedAt).toLocaleString():"Unknown time"]})]})})]})]})},x.id)})}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(I,{path:Zd,size:1.2,className:"text-blue-500"}),r.jsx("span",{className:"font-medium text-blue-800",children:"Exposure Tracking"})]}),r.jsx("button",{onClick:s,onKeyDown:x=>x.key==="Enter"&&s(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium","aria-label":"View exposure report",children:"View Exposure Report"})]})})]})},Qg=({error:s,onRetry:e,getErrorColor:t})=>{if(!s)return null;const n=()=>{e()},a=i=>{i.key==="Enter"&&s.retryable&&n()};return r.jsx("div",{className:`border rounded-lg p-4 ${t(s.severity)}`,children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx(I,{path:de,size:1.2,className:"mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("h4",{className:"font-medium",children:[s.severity==="critical"&&"Critical Error",s.severity==="high"&&"High Priority Error",s.severity==="medium"&&"Error",s.severity==="low"&&"Warning"]}),s.code&&r.jsxs("span",{className:"text-xs font-mono bg-white bg-opacity-75 px-2 py-1 rounded",children:["Error Code: ",s.code]})]}),r.jsx("p",{className:"text-sm mb-3",children:s.message}),s.retryable&&r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs("button",{onClick:n,onKeyDown:a,className:"inline-flex items-center space-x-1 px-3 py-1.5 text-sm font-medium bg-white bg-opacity-75 hover:bg-opacity-90 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-current","aria-label":"Retry the operation",children:[r.jsx(I,{path:it,size:.9}),r.jsx("span",{children:"Retry"})]}),r.jsx("span",{className:"text-xs opacity-75",children:"This error may be temporary. You can try again."})]}),!s.retryable&&r.jsx("p",{className:"text-xs opacity-75",children:"This error requires manual intervention. Please contact your supervisor."})]})]})})},Yg=({isLoading:s,isResolveButtonDisabled:e,resolveButtonText:t,resolutionNotes:n,onResolve:a,onCancel:i,onUpdateNotes:c})=>{const l=h=>{c(h.target.value)},o=()=>{e||a()},d=()=>{s||i()},u=h=>{h.key==="Enter"&&(h.ctrlKey||h.metaKey)&&!e&&(h.preventDefault(),o()),h.key==="Escape"&&!s&&d()};return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"resolution-notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Notes"}),r.jsx("textarea",{id:"resolution-notes",value:n,onChange:l,onKeyDown:u,disabled:s,rows:4,className:`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${s?"bg-gray-100 cursor-not-allowed":"bg-white"}`,placeholder:"Document the steps taken to resolve this BI failure incident...","aria-describedby":"resolution-notes-help"}),r.jsx("p",{id:"resolution-notes-help",className:"mt-1 text-sm text-gray-500",children:"Include details about re-sterilization parameters, new BI test results, and any corrective actions taken."})]}),r.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[r.jsx("button",{onClick:d,disabled:s,className:`px-4 py-2 text-sm font-medium rounded-md border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${s?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,"aria-label":"Cancel resolution",children:"Cancel"}),r.jsx("button",{onClick:o,disabled:e,className:`px-4 py-2 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${e?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,"aria-label":"Resolve BI failure incident",children:t})]}),r.jsx("div",{className:"text-xs text-gray-500 text-center",children:r.jsxs("p",{children:[r.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Ctrl+Enter"})," ","to resolve •"," ",r.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel"]})})]})};var je=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Jg=()=>{try{return!!(ei("VITE_SUPABASE_URL")&&ei("VITE_SUPABASE_ANON_KEY"))}catch(s){return console.error(s),!1}};class Xg{static createIncident(e){return je(this,null,function*(){try{if(!e.facility_id)throw new ee("Facility ID is required",G.MISSING_FACILITY_ID,"high",!1);if(e.affected_tools_count<=0)throw new ee("Affected tools count must be greater than 0",G.INVALID_TOOLS_COUNT,"medium",!1);if(!e.affected_batch_ids||e.affected_batch_ids.length===0)throw new ee("At least one affected batch ID is required",G.MISSING_BATCH_IDS,"medium",!1);const n={incident_number:yield this.generateIncidentNumber(e.facility_id),facility_id:e.facility_id,failure_date:new Date().toISOString(),affected_tools_count:e.affected_tools_count,affected_batch_ids:e.affected_batch_ids,severity_level:"high",status:"active",detected_by_operator_id:yield Mt.getCurrentUserId(),regulatory_notification_sent:!1},{data:a,error:i}=yield _.from("bi_failure_incidents").insert(n).select().single();if(i&&F.handleDatabaseError(i,"create incident",{params:e}),!a)throw new ee("No data returned from incident creation",G.NO_DATA_RETURNED,"critical",!1);return a}catch(t){if(t instanceof ee)throw t;F.handleUnexpectedError(t,"create incident")}})}static resolveIncident(e,t,n,a){return je(this,null,function*(){try{const{error:i}=yield _.from("bi_failure_incidents").update({status:"resolved",resolved_by_operator_id:n,resolution_notes:a}).eq("id",e).eq("facility_id",t);return i&&F.handleDatabaseError(i,"resolve incident",{incidentId:e}),!0}catch(i){if(i instanceof ee)throw i;F.handleUnexpectedError(i,"resolve incident")}})}static getActiveIncidents(e){return je(this,null,function*(){try{const{data:t,error:n}=yield _.from("bi_failure_incidents").select("*").eq("facility_id",e).eq("status","active");return n&&F.handleDatabaseError(n,"get active incidents",{facilityId:e}),(t||[]).map(a=>({id:a.id,incident_number:a.incident_number,status:a.status,facility_id:a.facility_id,failure_date:a.failure_date,detected_by_operator_id:a.detected_by_operator_id,affected_tools_count:a.affected_tools_count,affected_batch_ids:a.affected_batch_ids||[],failure_reason:a.failure_reason,severity_level:a.severity_level,resolution_deadline:a.resolution_deadline,estimated_impact:a.estimated_impact,regulatory_notification_required:a.regulatory_notification_required,regulatory_notification_sent:a.regulatory_notification_sent,regulatory_notification_date:a.regulatory_notification_date,created_at:a.created_at,updated_at:a.updated_at}))}catch(t){if(t instanceof ee)throw t;F.handleUnexpectedError(t,"get active incidents")}})}static validateToolForUse(e,t){return je(this,null,function*(){try{return(yield this.getActiveIncidents(t)).length===0}catch(n){if(n instanceof ee)throw n;F.handleUnexpectedError(n,"validate tool for use")}})}static validateToolUse(e){return je(this,null,function*(){try{const t=yield Mt.getCurrentFacilityId(),n=yield this.getActiveIncidents(t);return n.length===0?{canUse:!0,requiresImmediateAction:!1,validationResult:"approved"}:n.some(i=>i.affected_batch_ids.some(c=>e.includes(c)||c.includes(e)))?{canUse:!1,requiresImmediateAction:!0,validationResult:"quarantine_breach"}:{canUse:!1,requiresImmediateAction:!1,validationResult:"exposure_window"}}catch(t){if(t instanceof ee)throw t;return F.handleUnexpectedError(t,"validate tool use"),{canUse:!1,requiresImmediateAction:!0,validationResult:"pending_review"}}})}static generateExposureReport(e){return je(this,null,function*(){try{const t=yield this.getFacilityIdForIncident(e),{riskWindowStart:n,riskWindowEnd:a}=yield this.getRiskWindow(t),i=yield this.getRoomStatusChangesDuringRiskWindow(t,n,a),c=yield this.getToolContaminationEvents(t,n,a),l=yield this.correlateRoomAndToolData(i,c);return l.length===0?(console.warn("No room-tool correlation found. This may indicate clean operations or no activity during risk window."),{incidentNumber:`BI-FAIL-${e}`,totalRoomsAffected:0,roomDetails:[]}):{incidentNumber:`BI-FAIL-${e}`,totalRoomsAffected:l.length,roomDetails:l}}catch(t){if(t instanceof ee)throw t;return F.handleUnexpectedError(t,"generate exposure report"),console.error("Failed to generate exposure report, returning empty report:",t),{incidentNumber:`BI-FAIL-${e}`,totalRoomsAffected:0,roomDetails:[]}}})}static getFacilityIdForIncident(e){return je(this,null,function*(){try{const{FacilityService:t}=yield q(()=>Promise.resolve().then(()=>ge),void 0);return yield t.getCurrentFacilityId()}catch(t){return console.error("Failed to get facility ID:",t),"550e8400-e29b-41d4-a716-446655440000"}})}static getRiskWindow(e){return je(this,null,function*(){try{const{data:t,error:n}=yield _.from("bi_test_results").select("test_date, result").eq("facility_id",e).eq("result","pass").order("test_date",{ascending:!1}).limit(1);if(n)throw n;const a=t&&t.length>0?t[0].test_date:new Date(Date.now()-10080*60*1e3).toISOString(),i=new Date().toISOString();return console.log("Risk window determined:",{facilityId:e,lastPassedBI:t&&t.length>0?t[0].test_date:"None found",riskWindowStart:a,riskWindowEnd:i}),{riskWindowStart:a,riskWindowEnd:i}}catch(t){console.error("Failed to get risk window:",t);const n=new Date(Date.now()-10080*60*1e3).toISOString(),a=new Date().toISOString();return console.log("Using fallback risk window:",{riskWindowStart:n,riskWindowEnd:a}),{riskWindowStart:n,riskWindowEnd:a}}})}static getRoomStatusChangesDuringRiskWindow(e,t,n){return je(this,null,function*(){try{const{data:a,error:i}=yield _.from("environmental_cleans_enhanced").select(`
          room_id,
          room_name,
          status,
          updated_at,
          cleaner_id
        `).eq("facility_id",e).gte("updated_at",t).lte("updated_at",n).in("status",["in_use","IN USE"]).order("updated_at");if(i)throw i;return(a||[]).map(c=>({roomId:c.room_id||c.id||"unknown",roomName:c.room_name||"Unknown Room",status:c.status,timestamp:c.updated_at,userId:c.cleaner_id||"Unknown User"}))}catch(a){return console.error('Failed to get "IN USE" room status changes:',a),[]}})}static getToolContaminationEvents(e,t,n){return je(this,null,function*(){try{const{data:a,error:i}=yield _.from("audit_logs").select(`
          user_id,
          action,
          table_name,
          record_id,
          created_at,
          metadata
        `).eq("facility_id",e).eq("module","sterilization").eq("action","tool_scanned_clean_workflow").gte("created_at",t).lte("created_at",n).order("created_at");if(i)throw i;const c=(a||[]).map(o=>o.record_id).filter(o=>!!o);let l={};if(c.length>0){const{data:o,error:d}=yield _.from("sterilization_tools").select("id, tool_name").in("id",c);!d&&o&&(l=Object.fromEntries(o.map(u=>[u.id,u.tool_name])))}return(a||[]).map(o=>({toolId:o.record_id||"unknown",toolName:l[o.record_id||""]||"Unknown Tool",timestamp:o.created_at,userId:o.user_id||"Unknown User",action:o.action}))}catch(a){return console.error("Failed to get tool contamination events:",a),[]}})}static correlateRoomAndToolData(e,t){return je(this,null,function*(){const n=e.filter(l=>l.status==="in_use"||l.status==="IN USE"),a=new Map;t.forEach(l=>{const o=a.get(l.userId)||[];o.push(l),a.set(l.userId,o)});const i=[],c=new Map;n.forEach(l=>{const o=c.get(l.roomId)||[];o.push(l),c.set(l.roomId,o)});for(const[l,o]of c){const d=o[o.length-1],u=14400*1e3,h=new Date(d.timestamp).getTime(),p=t.filter(x=>{const v=new Date(x.timestamp).getTime()-h;return v>=0&&v<=u}),f=new Set;o.forEach(x=>{x.userId&&x.userId!=="Unknown User"&&f.add(x.userId)});const y=[],g=[];for(const x of f)(a.get(x)||[]).forEach(v=>{y.push(v.toolName),g.includes(v.userId)||g.push(v.userId)});(p.length>0||y.length>0)&&i.push({roomId:d.roomId,roomName:d.roomName,contaminationDate:p.length>0?p[0].timestamp:d.timestamp,roomUsedDate:d.timestamp,usersInvolved:g.length>0?g:[d.userId],contaminatedTools:y.length>0?y:p.map(x=>x.toolName)})}return i})}static subscribeToBIFailureUpdates(e){return je(this,null,function*(){try{if(!Jg()){console.warn("⚠️ Supabase not configured, skipping BI failure subscription");return}try{Za.subscribe("bi_failure_incidents",t=>{console.log("BI failure update:",t);const n=t;switch(n.eventType){case"INSERT":this.handleNewIncident(n.new);break;case"UPDATE":this.handleIncidentUpdate(n.old,n.new);break;case"DELETE":this.handleIncidentDeletion(n.old);break;default:console.log("Unknown event type:",n.eventType)}},{event:"*",filter:`facility_id=eq.${e}`})}catch(t){throw console.error("❌ Failed to subscribe to BI failure updates:",t),t}}catch(t){if(t instanceof ee)throw t;F.handleUnexpectedError(t,"subscribe to BI failure updates")}})}static handleNewIncident(e){try{const t=e;console.log("New BI failure incident detected:",t.incident_number),this.triggerIncidentNotifications(t),window.dispatchEvent(new CustomEvent("bi-failure-incident-created",{detail:{incident:t}}))}catch(t){console.error("Error handling new incident:",t)}}static handleIncidentUpdate(e,t){try{const n=e,a=t;console.log("BI failure incident updated:",a.incident_number),n.status!==a.status&&(console.log(`Incident status changed from ${n.status} to ${a.status}`),this.triggerStatusChangeNotifications(n,a)),window.dispatchEvent(new CustomEvent("bi-failure-incident-updated",{detail:{oldIncident:n,newIncident:a}}))}catch(n){console.error("Error handling incident update:",n)}}static handleIncidentDeletion(e){try{const t=e;console.log("BI failure incident deleted:",t.incident_number),window.dispatchEvent(new CustomEvent("bi-failure-incident-deleted",{detail:{incident:t}}))}catch(t){console.error("Error handling incident deletion:",t)}}static triggerIncidentNotifications(e){return je(this,null,function*(){try{const{BIFailureNotificationService:t}=yield q(()=>import("./BIFailureNotificationService-COBdTRhi.js"),__vite__mapDeps([6,1,2,3,4,5]));yield t.sendRegulatoryNotification(e.id,e.facility_id,e.severity_level,{incidentNumber:e.incident_number,failureDate:e.failure_date,affectedToolsCount:e.affected_tools_count,failureReason:e.failure_reason})}catch(t){console.error("Error triggering incident notifications:",t)}})}static triggerStatusChangeNotifications(e,t){return je(this,null,function*(){try{const{BIFailureNotificationService:n}=yield q(()=>import("./BIFailureNotificationService-COBdTRhi.js"),__vite__mapDeps([6,1,2,3,4,5]));t.status==="resolved"&&(yield n.sendInternalNotification(t.id,t.facility_id,"medium",["admin@facility.com","supervisor@facility.com"],`BI Failure incident ${t.incident_number} has been resolved.`))}catch(n){console.error("Error triggering status change notifications:",n)}})}static generateIncidentNumber(e){return je(this,null,function*(){try{const t=new Date,n=t.toISOString().split("T")[0].replace(/-/g,""),{count:a,error:i}=yield _.from("bi_failure_incidents").select("*",{count:"exact",head:!0}).eq("facility_id",e).gte("failure_date",t.toISOString().split("T")[0]);return i&&F.handleDatabaseError(i,"generate incident number",{facilityId:e}),`BI-FAIL-${n}-${String((a||0)+1).padStart(3,"0")}`}catch(t){if(t instanceof ee)throw t;F.handleUnexpectedError(t,"generate incident number")}})}}var Ru=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Zg=()=>Ru(null,null,function*(){try{const{biFailureDetails:s}=Q.getState(),e=sessionStorage.getItem("currentBIFailureIncidentId");if(e)return e;if(s){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const a=Math.random()*16|0;return(n==="x"?a:a&3|8).toString(16)});return sessionStorage.setItem("currentBIFailureIncidentId",t),t}return null}catch(s){return console.error("Failed to get current incident ID:",s),null}}),Vo=s=>{try{const e=window.open("","_blank");if(!e){alert("Please allow pop-ups to print the report.");return}const t=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Patient Exposure Report - ${s.incidentNumber}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
            .summary { margin-bottom: 30px; }
            .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
            .summary-item { border: 1px solid #ddd; padding: 15px; text-align: center; }
            .summary-item h3 { margin: 0 0 10px 0; color: #333; }
            .summary-item .number { font-size: 24px; font-weight: bold; color: #2563eb; }
            .risk-breakdown { margin-bottom: 30px; }
            .risk-item { display: flex; justify-content: space-between; padding: 5px 0; }
            .high { color: #dc2626; }
            .medium { color: #ea580c; }
            .low { color: #16a34a; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f9fafb; font-weight: bold; }
            .risk-badge { padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
            .risk-badge.high { background-color: #fef2f2; color: #dc2626; }
            .risk-badge.medium { background-color: #fff7ed; color: #ea580c; }
            .risk-badge.low { background-color: #f0fdf4; color: #16a34a; }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Exposure Report</h1>
            <p><strong>Incident Number:</strong> ${s.incidentNumber}</p>
            <p><strong>Generated:</strong> ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
          </div>

          <div class="summary">
            <h2>Exposure Summary</h2>
            <div class="summary-grid">
              <div class="summary-item">
                <h3>Total Rooms Affected</h3>
                <div class="number">${s.totalRoomsAffected}</div>
              </div>
            </div>
          </div>

          ${s.roomDetails&&s.roomDetails.length>0?`
            <h2>Affected Rooms</h2>
            <table>
              <thead>
                <tr>
                  <th>Room ID</th>
                  <th>Room Name</th>
                  <th>Contamination Date</th>
                  <th>Room Used Date</th>
                  <th>Users Involved</th>
                  <th>Contaminated Tools</th>
                </tr>
              </thead>
              <tbody>
                ${s.roomDetails.map(n=>`
                  <tr>
                    <td>${n.roomId}</td>
                    <td>${n.roomName}</td>
                    <td>${new Date(n.contaminationDate).toLocaleDateString()}</td>
                    <td>${new Date(n.roomUsedDate).toLocaleDateString()}</td>
                    <td>${n.usersInvolved.join(", ")}</td>
                    <td>${n.contaminatedTools.length} tools</td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          `:"<p><em>No room details available</em></p>"}

          <div class="no-print" style="margin-top: 30px; text-align: center;">
            <button onclick="window.print()" style="padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer;">
              Print Report
            </button>
            <button onclick="window.close()" style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
              Close
            </button>
          </div>
        </body>
      </html>
    `;e.document.write(t),e.document.close(),e.onload=()=>{e.print()}}catch(e){console.error("Failed to print exposure report:",e),alert("Failed to print report. Please try again.")}},Wo=s=>{var e;try{const n=[["Incident Number","Room ID","Room Name","Contamination Date","Room Used Date","Users Involved","Contaminated Tools Count","Contaminated Tools List"].join(","),...((e=s.roomDetails)==null?void 0:e.map(l=>[s.incidentNumber,l.roomId,l.roomName,new Date(l.contaminationDate).toLocaleDateString(),new Date(l.roomUsedDate).toLocaleDateString(),l.usersInvolved.join(";"),l.contaminatedTools.length.toString(),l.contaminatedTools.join(";")].join(",")))||[]].join(`
`),a=new Blob([n],{type:"text/csv"}),i=window.URL.createObjectURL(a),c=document.createElement("a");c.href=i,c.download=`exposure_report_${s.incidentNumber}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i)}catch(t){console.error("Failed to export exposure report:",t),alert("Failed to export report. Please try again.")}},ey=({isOpen:s,onClose:e,incidentId:t})=>{const[n,a]=m.useState(null),[i,c]=m.useState(!1),[l,o]=m.useState(null),d=m.useCallback(()=>Ru(null,null,function*(){c(!0),o(null);try{const f=t||(yield Zg());if(!f)throw new Error("No incident ID available for exposure report");const y=yield Xg.generateExposureReport(f);a(y)}catch(f){o(f instanceof Error?f.message:"Failed to load exposure report")}finally{c(!1)}}),[t]);m.useEffect(()=>{s&&d()},[s,d]);const u=()=>{a(null),o(null),e()},h=f=>{f.target===f.currentTarget&&u()},p=f=>{f.key==="Escape"&&u()};return s?Ts.createPortal(r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:h,onKeyDown:p,role:"button",tabIndex:0,"aria-label":"Close modal backdrop",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto scrollbar-hide",role:"dialog","aria-labelledby":"exposure-report-title","aria-describedby":"exposure-report-description",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(I,{path:Zd,size:1.5,className:"text-blue-500"}),r.jsxs("div",{children:[r.jsx("h2",{id:"exposure-report-title",className:"text-xl font-semibold text-gray-900",children:"Exposure Report"}),r.jsx("p",{id:"exposure-report-description",className:"text-sm text-gray-600",children:'Tools scanned dirty in "IN USE" rooms during BI failure risk window'})]})]}),r.jsx("button",{onClick:u,onKeyDown:f=>f.key==="Enter"&&u(),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close exposure report",children:r.jsx(I,{path:Pe,size:1.2})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[i&&r.jsxs("div",{className:"flex items-center justify-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),r.jsx("span",{className:"ml-3 text-gray-600",children:"Loading exposure report..."})]}),l&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(I,{path:de,size:1.2,className:"text-red-500"}),r.jsxs("span",{className:"text-red-800",children:["Error: ",l]})]})}),n&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-1 gap-4",children:r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[r.jsx(I,{path:Bn,size:1.2,className:"text-red-500"}),r.jsx("span",{className:"font-medium text-red-800",children:'"IN USE" Rooms with Tool Contamination'})]}),r.jsx("p",{className:"text-2xl font-bold text-red-900 mb-3",children:n.totalRoomsAffected}),r.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[r.jsx("p",{className:"font-medium",children:"Risk Window Analysis:"}),r.jsx("p",{children:'This count shows tools that were used between the last passed BI test and the failed BI test. The tools have been traced to the rooms that were marked "IN USE" and scanned for use, taking them from a clean to dirty status.'}),r.jsx("p",{className:"font-medium text-red-800",children:"⚠️ Important:"}),r.jsx("p",{children:"These tools could have been cycled through the autoclave many times before a failed BI was identified. It is important to validate this list against your patient records software to initiate a patient trace and contact plan (if in your policies and procedures)."})]})]})}),n.roomDetails&&n.roomDetails.length>0?r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Room Exposure Analysis"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:'Tools scanned dirty in "IN USE" rooms during risk window'})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time/Date"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Room"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Associated Tools Scanned"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.roomDetails.map((f,y)=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"font-medium",children:new Date(f.roomUsedDate).toLocaleDateString()}),r.jsx("div",{className:"text-xs text-gray-500",children:new Date(f.roomUsedDate).toLocaleTimeString()})]})}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"font-medium",children:f.roomName}),r.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",f.roomId]})]})}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:f.contaminatedTools.length>0?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[f.contaminatedTools.length," tool",f.contaminatedTools.length!==1?"s":""," ","scanned dirty"]}),r.jsx("div",{className:"flex flex-wrap gap-1",children:f.contaminatedTools.map((g,x)=>r.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:g},x))})]}):r.jsx("span",{className:"text-gray-400 italic",children:"No tools scanned"})})]},y))})]})})]}):r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(I,{path:_i,size:1.2,className:"text-green-500"}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-green-800",children:"No Room Exposure Found"}),r.jsxs("div",{className:"text-green-700 space-y-2",children:[r.jsx("p",{children:'Based on tool scans, it looks as though no tools that were autoclaved after the passed BI and before the failed BI have been initiated in the "dirty tool" status.'}),r.jsx("p",{className:"font-medium text-green-800",children:"This would indicate that there is no patient tracing needed."}),r.jsx("p",{className:"text-sm",children:"However, if your team is not scanning consistently, this data could be inaccurate."})]})]})]})}),r.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[r.jsxs("div",{className:"flex space-x-3",children:[r.jsxs("button",{onClick:()=>{Wo(n)},onKeyDown:f=>f.key==="Enter"&&Wo(n),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Export exposure report",children:[r.jsx(I,{path:wi,size:1}),r.jsx("span",{children:"Export Report"})]}),r.jsxs("button",{onClick:()=>{Vo(n)},onKeyDown:f=>f.key==="Enter"&&Vo(n),className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors","aria-label":"Print exposure report",children:[r.jsx(I,{path:eu,size:1}),r.jsx("span",{children:"Print Report"})]})]}),r.jsx("button",{onClick:u,onKeyDown:f=>f.key==="Enter"&&u(),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})]})]})]})]})}),document.body):null};var ty=Object.defineProperty,ry=Object.defineProperties,sy=Object.getOwnPropertyDescriptors,Go=Object.getOwnPropertySymbols,ny=Object.prototype.hasOwnProperty,ay=Object.prototype.propertyIsEnumerable,Ko=(s,e,t)=>e in s?ty(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,iy=(s,e)=>{for(var t in e||(e={}))ny.call(e,t)&&Ko(s,t,e[t]);if(Go)for(var t of Go(e))ay.call(e,t)&&Ko(s,t,e[t]);return s},oy=(s,e)=>ry(s,sy(e));const ly=({isOpen:s,onClose:e,onMinimize:t,isMinimized:n=!1})=>{const{isLoading:a,error:i,showExposureReport:c,resolutionNotes:l,biFailureDetails:o,handleResolve:d,handleRetry:u,handleClose:h,handleBackdropClick:p,handleKeyDown:f,toggleExposureReport:y,updateResolutionNotes:g,getErrorColor:x,isResolveButtonDisabled:b,getResolveButtonText:v}=Pg({onClose:e,onSuccess:()=>{}});return s?Ts.createPortal(r.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 p-4",style:{paddingTop:"12rem"},onClick:p,role:"button",tabIndex:0,"aria-label":"Close modal by clicking outside",onKeyDown:w=>{if(w.key==="Enter"||w.key===" "){w.preventDefault();const S=oy(iy({},w),{target:w.currentTarget,currentTarget:w.currentTarget,nativeEvent:w.nativeEvent,bubbles:!0,cancelable:!0,button:0});p(S)}},children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-y-auto transform translate-y-16 scrollbar-hide",role:"dialog","aria-labelledby":"bi-failure-modal-title","aria-describedby":"bi-failure-modal-description",onKeyDown:f,children:[r.jsx(Rg,{isSubmitting:a,onClose:h,onMinimize:t}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsx(Bg,{biFailureDetails:o}),r.jsx(Kg,{showExposureReport:c,onToggleExposureReport:y}),r.jsx(Qg,{error:i,onRetry:u,getErrorColor:x}),r.jsx(Yg,{isLoading:a,isResolveButtonDisabled:b(),resolveButtonText:v(),resolutionNotes:l,onResolve:d,onCancel:h,onUpdateNotes:g})]})]}),c&&r.jsx(ey,{isOpen:c,onClose:y,incidentId:o==null?void 0:o.id})]}),document.body):null},cy=({isOpen:s,onClose:e})=>r.jsx(ly,{isOpen:s,onClose:e}),dy=({onDismiss:s})=>{const[e,t]=m.useState(!1),[n,a]=m.useState(!1),{biFailureActive:i,biFailureDetails:c}=Q(),{currentUser:l}=cr();return i?r.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[9999] bg-red-600 text-white shadow-lg",children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[r.jsx("div",{className:"p-1 bg-red-700 rounded-lg flex-shrink-0",children:r.jsx(I,{path:de,size:1.2,className:"text-white"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h3",{className:"text-lg font-bold",children:"🚨 TOOL RECALL: BI TEST FAILURE"}),r.jsx("span",{className:"text-sm bg-red-700 px-2 py-1 rounded",children:c!=null&&c.date?c.date instanceof Date?c.date.toLocaleDateString():new Date(c.date).toLocaleDateString():"Today"})]}),r.jsxs("p",{className:"text-sm text-red-100 mt-1",children:[r.jsx("strong",{children:"CRITICAL:"})," All tools sterilized since the last successful BI test must be quarantined immediately. Check packaging for affected batch numbers."]})]})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:()=>{t(!0),a(!1)},className:"flex items-center gap-2 bg-red-700 hover:bg-red-800 px-3 py-1 rounded-lg transition-colors",title:n?"Resume workflow":"View resolution workflow",children:[r.jsx(I,{path:tu,size:1,className:"text-white"}),r.jsx("span",{className:"text-sm font-medium",children:n?"Resume Workflow":"Resolution Workflow"})]}),(c==null?void 0:c.affectedToolsCount)!==void 0&&r.jsxs("div",{className:"flex items-center gap-2 bg-red-700 px-3 py-1 rounded-lg",children:[r.jsx(I,{path:lr,size:1,className:"text-white"}),r.jsxs("span",{className:"text-sm font-medium",children:[c.affectedToolsCount," tools affected"]})]}),s&&r.jsx("button",{onClick:s,className:"p-1 hover:bg-red-700 rounded-lg transition-colors",title:"Dismiss banner",children:r.jsx(I,{path:Pe,size:1.2,className:"text-white"})})]})]}),r.jsx(cy,{isOpen:e,onClose:()=>t(!1),onMinimize:()=>{a(!0),t(!1)},isMinimized:n})]}):null},uy=({onDismiss:s})=>{const e=Ln();return e.pathname==="/login"||e.pathname.startsWith("/auth")?null:r.jsx(dy,{onDismiss:s})};var my=Object.defineProperty,Qo=Object.getOwnPropertySymbols,hy=Object.prototype.hasOwnProperty,py=Object.prototype.propertyIsEnumerable,Yo=(s,e,t)=>e in s?my(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,fy=(s,e)=>{for(var t in e||(e={}))hy.call(e,t)&&Yo(s,t,e[t]);if(Qo)for(var t of Qo(e))py.call(e,t)&&Yo(s,t,e[t]);return s};class Un{static subscribe(e,t,n={}){const a=this.getChannelKey(e,n);if(!this.subscriptions.has(a)){if(!Pn())return console.warn("⚠️ Supabase not configured, skipping real-time subscription"),()=>{};try{const c=_.channel(a).on("postgres_changes",fy({event:n.event||"*",schema:"public",table:e},n.filter&&{filter:n.filter}),l=>{const o=this.channelSubscribers.get(a);o&&o.forEach(d=>d(l))}).subscribe();this.subscriptions.set(a,c),this.channelSubscribers.set(a,new Set),console.log(`✅ Created shared realtime channel: ${a}`)}catch(c){return console.error(`❌ Failed to create realtime channel ${a}:`,c),()=>{}}}const i=this.channelSubscribers.get(a);return i.add(t),console.log(`📡 Added subscriber to ${a} (total: ${i.size})`),()=>{this.unsubscribe(a,t)}}static unsubscribe(e,t){const n=this.channelSubscribers.get(e);if(n&&(n.delete(t),n.size===0)){const a=this.subscriptions.get(e);a&&(_.removeChannel(a),this.subscriptions.delete(e),this.channelSubscribers.delete(e),console.log(`🔕 Cleaned up channel: ${e}`))}}static getChannelKey(e,t){const n=[e];return t.event&&t.event!=="*"&&n.push(t.event),t.filter&&n.push(t.filter),n.join("_")}static getStats(){return{activeChannels:this.subscriptions.size,totalSubscribers:Array.from(this.channelSubscribers.values()).reduce((e,t)=>e+t.size,0),tableSubscribers:Object.fromEntries(Array.from(this.channelSubscribers.entries()).map(([e,t])=>[e,t.size]))}}static cleanup(){this.subscriptions.forEach(e=>{_.removeChannel(e)}),this.subscriptions.clear(),this.channelSubscribers.clear(),console.log("🧹 Cleaned up all realtime subscriptions")}static nuclearCleanup(){console.log("🧹 Force cleaning up all realtime connections"),this.cleanup()}}Un.subscriptions=new Map;Un.channelSubscribers=new Map;class Au{static initialize(){if(this.isInitialized){R.realtime("🔄 SimpleRealtimeAutoOptimizer already initialized");return}R.realtime("🚀 SimpleRealtimeAutoOptimizer: Initialized (simplified)"),this.isInitialized=!0}static forceRestart(){R.realtime("🔄 SimpleRealtimeAutoOptimizer: Force restart (simplified)")}static getStatus(){return{isInitialized:this.isInitialized,optimizationStatus:{isRunning:!0,interval:"simplified",mode:"simplified"}}}static immediateNuclearCleanup(){R.realtime("🧹 SimpleRealtimeAutoOptimizer: Immediate cleanup"),Un.cleanup()}}Au.isInitialized=!1;Au.initialize();class Ou{static startOptimization(){if(this.isOptimizing){R.realtime("🔄 SimpleRealtimeOptimizer already running");return}this.isOptimizing=!0,R.realtime("🚀 Started simplified realtime optimization")}static stopOptimization(){this.isOptimizing=!1,R.realtime("⏹️ Stopped simplified realtime optimization")}static getStatus(){return{isRunning:this.isOptimizing,interval:this.isOptimizing?"simplified":"inactive",mode:this.isOptimizing?"simplified":"inactive"}}static emergencyCleanup(){R.realtime("🧹 Emergency cleanup (simplified)"),Un.cleanup()}}Ou.isOptimizing=!1;setTimeout(()=>{R.realtime("🚀 Auto-starting simplified realtime optimization..."),Ou.startOptimization()},2e3);var gy=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const yy=({isOpen:s,onOpen:e,onClose:t})=>{const{currentUser:n,getUserDisplayName:a,isLoading:i,clearUserData:c}=cr(),[l,o]=m.useState(!1),d=m.useRef(null),u=Ur(),p=Ln().pathname;if(i)return r.jsx("div",{className:"bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen w-16 sm:w-20 md:w-20",children:r.jsx("div",{className:"flex-1 pt-4 flex justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[#4ECDC4]"})})});const f=g=>{u(g)},y=[{path:"/home",icon:_h,label:"Home"},{path:"/sterilization",icon:wh,label:"Sterilization"},{path:"/inventory",icon:Sh,label:"Inventory"},{path:"/environmental-clean",icon:Ch,label:"Environmental Clean"},{path:"/knowledge-hub",icon:jh,label:"Knowledge Hub"},{path:"/intelligence",icon:Nh,label:"Intelligence"},{path:"/settings",icon:Ih,label:"Settings"}];return r.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col min-h-screen ${s?"w-full sm:w-64 md:w-64":"w-16 sm:w-20 md:w-20"}`,children:[r.jsxs("div",{className:"flex-1 pt-4 overflow-y-auto",children:[s?r.jsxs("div",{className:"px-4 sm:px-6 pb-6 flex justify-between items-center",children:[r.jsx("div",{className:"relative",children:r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-[#4ECDC4]",children:"Cliniio"})}),r.jsx("button",{onClick:t,onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),t())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Collapse navigation menu (Press Enter or Space)",title:"Collapse menu (Enter/Space)",tabIndex:0,children:r.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 12H5"})})})]}):r.jsx("div",{className:"px-4 sm:px-6 pb-6 flex justify-center items-center",children:r.jsx("button",{onClick:e,onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),e())},className:"p-2 hover:bg-gray-50 rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-opacity-50 touch-manipulation","aria-label":"Expand navigation menu (Press Enter or Space)",title:"Expand menu (Enter/Space)",tabIndex:0,children:r.jsx("svg",{className:"w-5 h-5 text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200 transform hover:scale-110 active:scale-95",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5l7 7-7 7"})})})}),r.jsx("nav",{children:y.map(({path:g,icon:x,label:b})=>r.jsxs("button",{onClick:()=>f(g),className:`flex items-center transition-colors duration-200 w-full text-left touch-manipulation ${s?"px-4 sm:px-6 py-4":"px-3 sm:px-4 py-4 justify-center"} ${p===g?"bg-[#4ECDC4] bg-opacity-10 border-r-4 border-[#4ECDC4] text-[#4ECDC4]":"text-[#5b5b5b] hover:bg-gray-50 hover:text-[#4ECDC4]"}`,"aria-label":s?b:`${b} page`,title:s?void 0:b,children:[r.jsx(x,{size:20,className:`${s?"mr-4":""} ${p===g?"text-[#4ECDC4]":"text-gray-400"}`,"aria-hidden":"true"}),s&&r.jsx("span",{className:`font-medium whitespace-nowrap ${p===g?"text-[#4ECDC4]":"text-[#5b5b5b]"}`,children:b})]},g))})]}),r.jsx("div",{className:`${s?"p-3 sm:p-4":"p-1"} border-t border-gray-200 bg-white sticky bottom-0`,children:r.jsxs("div",{className:"relative",children:[r.jsxs("button",{ref:d,className:`flex items-center space-x-4 w-full text-left ${s?"mb-4":"justify-center mb-2"}`,onClick:()=>o(g=>!g),onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&o(x=>!x)},"aria-expanded":l,"aria-haspopup":"true","aria-label":s?`User menu for ${n?a():"User"}`:"User profile menu",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4ECDC4] flex items-center justify-center overflow-hidden",children:n!=null&&n.avatar_url?r.jsx("img",{src:n.avatar_url,alt:"Profile",className:"w-8 h-8 rounded-full object-cover",onLoad:()=>console.log("Avatar image loaded successfully in DrawerMenu"),onError:g=>console.error("Avatar image failed to load in DrawerMenu:",g)}):r.jsx(Th,{size:20,className:"text-white"})}),s&&r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700",children:a()}),r.jsx("p",{className:"text-xs text-gray-500",children:(n==null?void 0:n.role)||"User"})]})]}),l&&s&&r.jsx("div",{role:"menu","aria-labelledby":"user-menu",style:{position:"absolute",bottom:56,left:0,background:"white",borderRadius:8,boxShadow:"0 2px 16px rgba(0,0,0,0.15)",minWidth:180,zIndex:100,padding:12,textAlign:"center"},children:r.jsx("button",{role:"menuitem",className:"px-4 py-2 bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] w-full",onClick:()=>gy(null,null,function*(){console.log("🚪 DrawerMenu: Logout button clicked");try{console.log("🚪 DrawerMenu: Starting logout process..."),console.log("🚪 DrawerMenu: Calling clearUserData()..."),c(),yield new Promise(b=>setTimeout(b,100)),console.log("🚪 DrawerMenu: Calling login store reset()...");const{useLoginStore:g}=yield q(()=>import("./login-CtXU169Q.js").then(b=>b.cl),__vite__mapDeps([1,2,3,4,5]));yield g.getState().reset(),console.log("🚪 DrawerMenu: Calling auth service logout()..."),yield new ru().logout(),console.log("🚪 DrawerMenu: Logout successful, navigating to login"),u("/login"),o(!1),console.log("🔄 DrawerMenu: Reloading page for clean state..."),window.location.reload()}catch(g){console.error("🚪 DrawerMenu: Logout failed:",g),u("/login"),o(!1),console.log("🔄 DrawerMenu: Reloading page after logout error..."),window.location.reload()}}),children:"Logout"})})]})})]})},vy=()=>{const s=Ln();return{getCurrentContext:()=>{const t=s.pathname;return t.includes("/sterilization")?"sterilization":t.includes("/inventory")?"inventory":t.includes("/environmental-clean")?"environmental-clean":t.includes("/home")?"home":"general"}}},xy=s=>{const e=Ur(),{getCurrentContext:t}=vy(),[n,a]=m.useState(null),[i,c]=m.useState(null),[l,o]=m.useState(new Set),[d,u]=m.useState(new Set),[h,p]=m.useState(new Set),[f,y]=m.useState(new Set),g=t();return{selectedHelpType:n,expandedMetrics:l,expandedTasks:d,expandedGamification:h,expandedRelevant:f,currentContext:g,handleOptionClick:N=>{N.action==="ai-chat"?a("ai-chat"):N.action==="context-help"?a("context-help"):N.action==="cliniio-help"?a("cliniio-help"):N.action==="product-feedback"?a("product-feedback"):N.action==="page"&&N.path?(e(N.path),s()):N.action==="modal"&&alert(`${N.title} - Coming soon! This will open a focused help interface.`)},handleBack:()=>{i?(a(i),c(null)):a(null)},handleFeedbackSuccess:()=>{a("cliniio-help")},toggleMetricSection:N=>{o(j=>{const E=new Set(j);return E.has(N)?E.delete(N):E.add(N),E})},toggleTaskSection:N=>{u(j=>{const E=new Set(j);return E.has(N)?E.delete(N):E.add(N),E})},toggleGamificationSection:N=>{p(j=>{const E=new Set(j);return E.has(N)?E.delete(N):E.add(N),E})},toggleRelevantSection:N=>{y(j=>{const E=new Set(j);return E.has(N)?E.delete(N):E.add(N),E})},setHelpType:N=>{c(n),a(N)}}},Jo=({onOptionClick:s})=>{const e=[{id:"ai-assistant",icon:r.jsx("span",{children:"🤖"}),title:"AI Assistant",description:"Get AI-powered help and answers",action:"ai-chat"},{id:"cliniio-help",icon:r.jsx("span",{children:"💬"}),title:"Cliniio Help",description:"General help and support",action:"cliniio-help"},{id:"context-help",icon:r.jsx("span",{children:"📚"}),title:"Relevant Information",description:"Standards and protocols for your current task",action:"context-help"},{id:"product-feedback",icon:r.jsx("span",{children:"💡"}),title:"Product Feedback",description:"Report bugs or suggest improvements",action:"product-feedback"}];return r.jsx("div",{className:"p-4 space-y-3",children:e.map(t=>r.jsx("button",{onClick:()=>s(t),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:t.icon}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors text-sm",children:t.title}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]})},t.id))})};var by=Object.defineProperty,Xo=Object.getOwnPropertySymbols,_y=Object.prototype.hasOwnProperty,wy=Object.prototype.propertyIsEnumerable,Zo=(s,e,t)=>e in s?by(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ws=(s,e)=>{for(var t in e||(e={}))_y.call(e,t)&&Zo(s,t,e[t]);if(Xo)for(var t of Xo(e))wy.call(e,t)&&Zo(s,t,e[t]);return s},Zr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Ti{constructor(e={}){this.config=Ws({maxRequests:100,windowMs:60*1e3,burstLimit:10,retryDelay:1e3,maxRetries:3},e),this.generalLimiter=new Ls({maxRequests:this.config.maxRequests,windowMs:this.config.windowMs,keyPrefix:"ai_general",blockDurationMs:this.config.windowMs}),this.burstLimiter=new Ls({maxRequests:this.config.burstLimit,windowMs:10*1e3,keyPrefix:"ai_burst",blockDurationMs:30*1e3})}checkRateLimit(e,t=!1){return Zr(this,null,function*(){try{if(t){const a=yield this.burstLimiter.checkRateLimit(e);if(!a.allowed)return{allowed:!1,remaining:0,resetTime:a.resetTime,retryAfter:a.retryAfter,burstRemaining:0}}const n=yield this.generalLimiter.checkRateLimit(e);return{allowed:n.allowed,remaining:n.remaining,resetTime:n.resetTime,retryAfter:n.retryAfter,burstRemaining:t?yield this.getBurstRemaining(e):void 0}}catch(n){return R.error("AI rate limit check failed:",n),{allowed:!0,remaining:this.config.maxRequests,resetTime:Date.now()+this.config.windowMs}}})}recordRequest(e,t=!1){return Zr(this,null,function*(){try{t&&(yield this.burstLimiter.checkRateLimit(e)),yield this.generalLimiter.checkRateLimit(e)}catch(n){R.error("AI rate limit recording failed:",n)}})}getBurstRemaining(e){return Zr(this,null,function*(){try{return(yield this.burstLimiter.getRateLimitStatus(e)).remaining}catch(t){return R.error("Failed to get burst remaining:",t),this.config.burstLimit}})}resetRateLimit(e){return Zr(this,null,function*(){try{yield Promise.all([this.generalLimiter.resetRateLimit(e),this.burstLimiter.resetRateLimit(e)])}catch(t){R.error("Failed to reset AI rate limits:",t)}})}getStatus(e){return Zr(this,null,function*(){try{const[t,n]=yield Promise.all([this.generalLimiter.getRateLimitStatus(e),this.burstLimiter.getRateLimitStatus(e)]);return{general:{allowed:t.allowed,remaining:t.remaining,resetTime:t.resetTime,retryAfter:t.retryAfter},burst:{allowed:n.allowed,remaining:n.remaining,resetTime:n.resetTime,retryAfter:n.retryAfter}}}catch(t){return R.error("Failed to get AI rate limit status:",t),{general:{allowed:!0,remaining:this.config.maxRequests,resetTime:Date.now()+this.config.windowMs},burst:{allowed:!0,remaining:this.config.burstLimit,resetTime:Date.now()+10*1e3}}}})}updateConfig(e){this.config=Ws(Ws({},this.config),e),this.generalLimiter=new Ls({maxRequests:this.config.maxRequests,windowMs:this.config.windowMs,keyPrefix:"ai_general",blockDurationMs:this.config.windowMs}),this.burstLimiter=new Ls({maxRequests:this.config.burstLimit,windowMs:10*1e3,keyPrefix:"ai_burst",blockDurationMs:30*1e3}),R.info("AI rate limiter configuration updated",e)}getConfigs(){return Ws({},this.config)}getStats(){return{general:this.generalLimiter.getStats(),burst:this.burstLimiter.getStats(),config:this.config}}isHealthy(){try{const e=this.generalLimiter.getStats(),t=this.burstLimiter.getStats();return e.redisHealthy||t.redisHealthy}catch(e){return R.error("Health check failed:",e),!1}}}const oi=new Ti({maxRequests:50,windowMs:60*1e3,burstLimit:5,retryDelay:2e3,maxRetries:3});new Ti({maxRequests:20,windowMs:60*1e3,burstLimit:3,retryDelay:3e3,maxRetries:2});new Ti({maxRequests:10,windowMs:300*1e3,burstLimit:2,retryDelay:5e3,maxRetries:1});var Sy=Object.defineProperty,el=Object.getOwnPropertySymbols,Cy=Object.prototype.hasOwnProperty,jy=Object.prototype.propertyIsEnumerable,tl=(s,e,t)=>e in s?Sy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,la=(s,e)=>{for(var t in e||(e={}))Cy.call(e,t)&&tl(s,t,e[t]);if(el)for(var t of el(e))jy.call(e,t)&&tl(s,t,e[t]);return s},Gs=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Ny{constructor(e={}){this.queue=[],this.processing=!1,this.activeRequests=0,this.processingInterval=null,this.results=new Map,this.config=la({maxConcurrent:5,batchSize:3,processingInterval:1e3,retryDelay:2e3},e)}addRequest(e,t,n){return Gs(this,arguments,function*(a,i,c,l={}){const o={id:`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,service:a,identifier:i,operation:c,priority:l.priority||0,maxRetries:l.maxRetries||3,timeout:l.timeout||3e4,createdAt:new Date,metadata:l.metadata};return this.queue.push(o),this.queue.sort((d,u)=>u.priority-d.priority),R.debug(`Added request to queue: ${o.id} (priority: ${o.priority})`),this.processing||this.startProcessing(),this.waitForCompletion(o.id)})}startProcessing(){this.processing||(this.processing=!0,this.processingInterval=setInterval(()=>{this.processQueue()},this.config.processingInterval),R.info("AI request queue processing started"))}stopProcessing(){this.processingInterval&&(clearInterval(this.processingInterval),this.processingInterval=null),this.processing=!1,R.info("AI request queue processing stopped")}processQueue(){return Gs(this,null,function*(){if(this.activeRequests>=this.config.maxConcurrent||this.queue.length===0)return;const e=this.queue.splice(0,this.config.batchSize);for(const t of e){if(this.activeRequests>=this.config.maxConcurrent){this.queue.unshift(...e.slice(e.indexOf(t)));break}this.processRequest(t)}})}processRequest(e){return Gs(this,null,function*(){this.activeRequests++;try{R.debug(`Processing request: ${e.id}`);const t=yield oi.checkRateLimit(e.identifier);if(!t.allowed)throw new Error(`Rate limit exceeded. Retry after ${t.retryAfter}ms`);const n=yield e.operation();yield oi.recordRequest(e.identifier),this.storeResult(e.id,{success:!0,data:n})}catch(t){R.error(`Request ${e.id} failed:`,t),e.maxRetries>0?(e.maxRetries--,this.queue.push(e),R.debug(`Retrying request ${e.id} (${e.maxRetries} retries left)`)):this.storeResult(e.id,{success:!1,error:t instanceof Error?t.message:"Unknown error"})}finally{this.activeRequests--}})}waitForCompletion(e){return Gs(this,null,function*(){return new Promise((t,n)=>{const a=()=>{const i=this.getResult(e);i?i.success?t(i.data):n(new Error(i.error)):setTimeout(a,100)};a()})})}storeResult(e,t){this.results.set(e,t)}getResult(e){return this.results.get(e)}getStats(){return{queueLength:this.queue.length,activeRequests:this.activeRequests,processing:this.processing,config:this.config}}clearQueue(){this.queue=[],this.results.clear(),R.info("AI request queue cleared")}updateConfig(e){this.config=la(la({},this.config),e),R.info("AI request queue configuration updated:",this.config)}}const Ks=new Ny;var es=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Iy{constructor(){this.DEFAULT_TTL=3600,this.hitCounts=new Map,this.cache=new Cu("ai_responses")}generateCacheKey(e){const{service:t,operation:n,parameters:a,userId:i,facilityId:c}=e,l=this.hashObject(a);let o=`${t}:${n}:${l}`;return i&&(o+=`:user:${i}`),c&&(o+=`:facility:${c}`),o}get(e){return es(this,null,function*(){try{const t=this.generateCacheKey(e),n=yield this.cache.get(t);if(n){const a=this.hitCounts.get(t)||0;return this.hitCounts.set(t,a+1),R.debug(`AI cache hit for ${e.service}:${e.operation}`),n.data}return null}catch(t){return R.error("Error getting from AI cache:",t),null}})}set(e,t){return es(this,arguments,function*(n,a,i={}){try{const c=this.generateCacheKey(n),l=i.ttl||this.DEFAULT_TTL,o={data:a,timestamp:Date.now(),hitCount:0,metadata:{service:n.service,operation:n.operation,userId:n.userId,facilityId:n.facilityId}};yield this.cache.set(c,o,{ttl:l}),R.debug(`AI response cached for ${n.service}:${n.operation}`)}catch(c){R.error("Error setting AI cache:",c)}})}executeWithCache(e,t){return es(this,arguments,function*(n,a,i={}){const c=yield this.get(n);if(c!==null)return c;const l=yield a();return yield this.set(n,l,i),l})}invalidate(e){return es(this,null,function*(){try{R.info("Invalidating AI cache for pattern:",e),yield this.cache.clear()}catch(t){R.error("Error invalidating AI cache:",t)}})}getStats(){return{totalEntries:this.hitCounts.size,hitCounts:Object.fromEntries(this.hitCounts),cacheStats:this.cache.getStats()}}clear(){return es(this,null,function*(){try{yield this.cache.clear(),this.hitCounts.clear(),R.info("AI response cache cleared")}catch(e){R.error("Error clearing AI cache:",e)}})}hashObject(e){const t=JSON.stringify(e,Object.keys(e).sort());return this.simpleHash(t)}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){const a=e.charCodeAt(n);t=(t<<5)-t+a,t=t&t}return Math.abs(t).toString(36)}}const Qs=new Iy;var Ty=Object.defineProperty,rl=Object.getOwnPropertySymbols,Ey=Object.prototype.hasOwnProperty,ky=Object.prototype.propertyIsEnumerable,sl=(s,e,t)=>e in s?Ty(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ca=(s,e)=>{for(var t in e||(e={}))Ey.call(e,t)&&sl(s,t,e[t]);if(rl)for(var t of rl(e))ky.call(e,t)&&sl(s,t,e[t]);return s},xr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Dy{constructor(e={}){this.pendingRequests=[],this.activeBatches=0,this.batchTimer=null,this.config=ca({maxBatchSize:10,maxWaitTime:2e3,maxConcurrentBatches:3,priorityThreshold:5},e)}addRequest(e){return xr(this,arguments,function*(t,n={}){const a={id:`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,operation:t,priority:n.priority||0,metadata:n.metadata};return this.pendingRequests.push(a),this.pendingRequests.sort((i,c)=>c.priority-i.priority),R.debug(`Added request to batch queue: ${a.id} (priority: ${a.priority})`),this.batchTimer||this.startBatchTimer(),this.waitForCompletion(a.id)})}startBatchTimer(){this.batchTimer=setTimeout(()=>{this.processBatches(),this.batchTimer=null},this.config.maxWaitTime)}processBatches(){return xr(this,null,function*(){if(this.activeBatches>=this.config.maxConcurrentBatches){this.startBatchTimer();return}const e=this.pendingRequests.filter(n=>n.priority<this.config.priorityThreshold);if(e.length===0)return;const t=this.createBatches(e);for(const n of t){if(this.activeBatches>=this.config.maxConcurrentBatches)break;this.processBatch(n)}this.pendingRequests.length>0&&this.startBatchTimer()})}createBatches(e){const t=[];for(let n=0;n<e.length;n+=this.config.maxBatchSize){const a=e.slice(n,n+this.config.maxBatchSize);t.push(a)}return t}processBatch(e){return xr(this,null,function*(){this.activeBatches++;try{R.debug(`Processing batch of ${e.length} requests`),e.forEach(i=>{const c=this.pendingRequests.findIndex(l=>l.id===i.id);c!==-1&&this.pendingRequests.splice(c,1)});const t=Date.now(),n=e.map(i=>xr(this,null,function*(){const c=Date.now();try{const l=yield i.operation(),o=Date.now()-c;this.storeResult(i.id,{id:i.id,success:!0,data:l,duration:o})}catch(l){const o=Date.now()-c;this.storeResult(i.id,{id:i.id,success:!1,error:l instanceof Error?l.message:"Unknown error",duration:o})}}));yield Promise.all(n);const a=Date.now()-t;R.debug(`Batch completed in ${a}ms`)}catch(t){R.error("Batch processing failed:",t),e.forEach(n=>{this.storeResult(n.id,{id:n.id,success:!1,error:"Batch processing failed",duration:0})})}finally{this.activeBatches--}})}waitForCompletion(e){return xr(this,null,function*(){return new Promise((t,n)=>{const a=()=>{const i=this.getResult(e);i?i.success?t(i.data):n(new Error(i.error)):setTimeout(a,50)};a()})})}storeResult(e,t){this.results=this.results||new Map,this.results.set(e,t)}getResult(e){return this.results=this.results||new Map,this.results.get(e)}getStats(){return{pendingRequests:this.pendingRequests.length,activeBatches:this.activeBatches,config:this.config}}updateConfig(e){this.config=ca(ca({},this.config),e),R.info("AI request batcher configuration updated:",this.config)}clearPending(){this.pendingRequests=[],this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),R.info("AI request batcher cleared")}forceProcess(){return xr(this,null,function*(){this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null),yield this.processBatches()})}}const ts=new Dy;var Py=Object.defineProperty,Ry=Object.defineProperties,Ay=Object.getOwnPropertyDescriptors,nl=Object.getOwnPropertySymbols,Oy=Object.prototype.hasOwnProperty,$y=Object.prototype.propertyIsEnumerable,al=(s,e,t)=>e in s?Py(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,da=(s,e)=>{for(var t in e||(e={}))Oy.call(e,t)&&al(s,t,e[t]);if(nl)for(var t of nl(e))$y.call(e,t)&&al(s,t,e[t]);return s},My=(s,e)=>Ry(s,Ay(e));class Mr{constructor(){this.serviceMetrics={},this.alerts=[],this.requestTimes=[],this.MAX_REQUEST_TIMES=1e3,this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,cacheHitRate:0,rateLimitHits:0,queueLength:0,activeRequests:0,lastUpdated:new Date}}static getInstance(){return Mr.instance||(Mr.instance=new Mr),Mr.instance}recordRequest(e,t,n,a=!1,i=!1){const c=new Date;this.metrics.totalRequests++,t?this.metrics.successfulRequests++:this.metrics.failedRequests++,a?this.metrics.cacheHitRate=(this.metrics.cacheHitRate*(this.metrics.totalRequests-1)+1)/this.metrics.totalRequests:this.metrics.cacheHitRate=this.metrics.cacheHitRate*(this.metrics.totalRequests-1)/this.metrics.totalRequests,i&&this.metrics.rateLimitHits++,this.requestTimes.push(n),this.requestTimes.length>this.MAX_REQUEST_TIMES&&this.requestTimes.shift(),this.metrics.averageResponseTime=this.calculateAverageResponseTime(),this.serviceMetrics[e]||(this.serviceMetrics[e]={requests:0,successes:0,failures:0,avgResponseTime:0,lastRequest:c});const l=this.serviceMetrics[e];l.requests++,l.lastRequest=c,t?l.successes++:l.failures++,l.avgResponseTime=(l.avgResponseTime*(l.requests-1)+n)/l.requests,this.metrics.lastUpdated=c,this.checkAlerts(e,t,n)}updateQueueMetrics(e,t){this.metrics.queueLength=e,this.metrics.activeRequests=t,this.metrics.lastUpdated=new Date}getMetrics(){return da({},this.metrics)}getServiceMetrics(){return da({},this.serviceMetrics)}getAlerts(){return[...this.alerts]}clearOldAlerts(e=1440*60*1e3){const t=new Date(Date.now()-e);this.alerts=this.alerts.filter(n=>n.timestamp>t)}getHealthStatus(){const e=[],t=[],n=this.metrics.totalRequests>0?this.metrics.failedRequests/this.metrics.totalRequests:0;n>.1&&(e.push(`High error rate: ${(n*100).toFixed(1)}%`),t.push("Investigate failed requests and improve error handling")),this.metrics.averageResponseTime>5e3&&(e.push(`Slow response time: ${this.metrics.averageResponseTime.toFixed(0)}ms`),t.push("Optimize AI operations and consider caching")),this.metrics.queueLength>50&&(e.push(`High queue length: ${this.metrics.queueLength}`),t.push("Increase processing capacity or optimize request handling")),this.metrics.cacheHitRate<.3&&(e.push(`Low cache hit rate: ${(this.metrics.cacheHitRate*100).toFixed(1)}%`),t.push("Improve caching strategy and cache more responses"));let a="healthy";return e.length>0&&(a=e.length>2?"critical":"warning"),{status:a,issues:e,recommendations:t}}calculateAverageResponseTime(){return this.requestTimes.length===0?0:this.requestTimes.reduce((e,t)=>e+t,0)/this.requestTimes.length}checkAlerts(e,t,n){if(!t){const a=this.serviceMetrics[e];if(a&&a.requests>10){const i=a.failures/a.requests;i>.2&&this.addAlert({type:"high_error_rate",severity:"critical",message:`High error rate for ${e}: ${(i*100).toFixed(1)}%`,metadata:{service:e,errorRate:i}})}}n>1e4&&this.addAlert({type:"slow_response",severity:"warning",message:`Slow response time for ${e}: ${n}ms`,metadata:{service:e,responseTime:n}}),this.metrics.queueLength>100&&this.addAlert({type:"high_queue_length",severity:"critical",message:`High queue length: ${this.metrics.queueLength}`,metadata:{queueLength:this.metrics.queueLength}}),this.metrics.rateLimitHits>10&&this.addAlert({type:"rate_limit_exceeded",severity:"warning",message:`Rate limit exceeded ${this.metrics.rateLimitHits} times`,metadata:{rateLimitHits:this.metrics.rateLimitHits}})}addAlert(e){const t=My(da({},e),{id:`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date});this.alerts.push(t),R.warn(`AI Performance Alert: ${t.message}`,t)}resetMetrics(){this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,cacheHitRate:0,rateLimitHits:0,queueLength:0,activeRequests:0,lastUpdated:new Date},this.serviceMetrics={},this.alerts=[],this.requestTimes=[],R.info("AI monitoring metrics reset")}}const rs=Mr.getInstance();var Fy=Object.defineProperty,zy=Object.defineProperties,Ly=Object.getOwnPropertyDescriptors,il=Object.getOwnPropertySymbols,By=Object.prototype.hasOwnProperty,qy=Object.prototype.propertyIsEnumerable,ol=(s,e,t)=>e in s?Fy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Uy=(s,e)=>{for(var t in e||(e={}))By.call(e,t)&&ol(s,t,e[t]);if(il)for(var t of il(e))qy.call(e,t)&&ol(s,t,e[t]);return s},Hy=(s,e)=>zy(s,Ly(e)),Ys=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class sr{constructor(){}static getInstance(){return sr.instance||(sr.instance=new sr),sr.instance}execute(e,t,n){return Ys(this,null,function*(){const a=Date.now();let i=!1,c=!1,l,o;try{if(e.useCache!==!1){const u={service:e.service,operation:e.operation,parameters:(n==null?void 0:n.parameters)||{},userId:n==null?void 0:n.userId,facilityId:n==null?void 0:n.facilityId},h=yield Qs.get(u);h!==null&&(i=!0,l=h,c=!0,R.debug(`AI operation served from cache: ${e.service}:${e.operation}`))}if(!i&&(e.useBatching!==!1&&(e.priority||0)<5?l=yield ts.addRequest(t,{priority:e.priority,metadata:e.metadata}):l=yield Ks.addRequest(e.service,(n==null?void 0:n.userId)||"anonymous",t,{priority:e.priority,maxRetries:e.maxRetries,timeout:e.timeout,metadata:e.metadata}),c=!0,e.useCache!==!1&&l)){const u={service:e.service,operation:e.operation,parameters:(n==null?void 0:n.parameters)||{},userId:n==null?void 0:n.userId,facilityId:n==null?void 0:n.facilityId};yield Qs.set(u,l,{ttl:e.cacheTtl})}const d=Date.now()-a;return rs.recordRequest(e.service,c,d,i,!1),{success:c,data:l,error:o,fromCache:i,responseTime:d,metadata:e.metadata}}catch(d){const u=Date.now()-a;return o=d instanceof Error?d.message:"Unknown error",c=!1,rs.recordRequest(e.service,c,u,i,!1),R.error(`AI operation failed: ${e.service}:${e.operation}`,d),{success:c,data:l,error:o,fromCache:i,responseTime:u,metadata:e.metadata}}})}executeBatch(e){return Ys(this,null,function*(){const t=e.map(({config:n,operation:a,context:i})=>this.execute(n,a,i));return Promise.all(t)})}getStats(){return{monitoring:rs.getMetrics(),queue:Ks.getStats(),cache:Qs.getStats(),batcher:ts.getStats(),rateLimiter:oi.getConfigs()}}getHealthStatus(){const e=rs.getHealthStatus(),t=this.getStats();return Hy(Uy({},e),{metrics:t})}reset(){return Ys(this,null,function*(){yield Qs.clear(),Ks.clearQueue(),ts.clearPending(),rs.resetMetrics(),R.info("AI service reset completed")})}updateConfig(e){e.queue&&Ks.updateConfig(e.queue),e.batcher&&ts.updateConfig(e.batcher),R.info("AI service configuration updated")}forceProcess(){return Ys(this,null,function*(){yield ts.forceProcess(),R.info("AI service force processing completed")})}}sr.getInstance();var Vy=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Wy="/functions/v1/openai";function $u(s){return Vy(this,arguments,function*({prompt:e,context:t=""}){throw console.warn("askCliniioAI() is deprecated. Use UnifiedAIService.askAI() instead."),Wy?new Error("Missing NEXT_PUBLIC_SUPABASE_ANON_KEY"):new Error("Missing NEXT_PUBLIC_SUPABASE_URL")})}var ua=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Gy{constructor(e){this.facilityId=e}getLearningInsights(){return ua(this,null,function*(){try{const e=[],{data:t}=yield _.from("learning_ai_personalized_recommendations").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);t&&t.forEach(c=>{e.push({type:"personalized_recommendation",title:"Personalized Learning Recommendations",description:`${c.recommended_content.length} content items recommended for user ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.recommendation_reasoning||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromConfidence(c.confidence_score),actionable:!0,id:c.id||`recommendation-${Date.now()}`})});const{data:n}=yield _.from("learning_ai_skill_gap_analysis").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);n&&n.forEach(c=>{const l=Object.keys(c.skill_gaps);e.push({type:"skill_gap_analysis",title:"Skill Gap Analysis",description:`${l.length} skill gaps identified for user ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.learning_recommendations||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromGapCount(l.length),actionable:!0,id:c.id||`skillgap-${Date.now()}`})});const{data:a}=yield _.from("learning_ai_path_optimization").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);a&&a.forEach(c=>{e.push({type:"learning_path_optimization",title:"Learning Path Optimized",description:`Path efficiency score: ${(c.path_efficiency_score*100).toFixed(1)}% for user ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.optimization_factors||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromEfficiency(c.path_efficiency_score),actionable:!0,id:c.id||`pathopt-${Date.now()}`})});const{data:i}=yield _.from("learning_ai_performance_prediction").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);return i&&i.forEach(c=>{e.push({type:"performance_prediction",title:"Performance Prediction",description:`Predicted performance: ${(c.predicted_performance*100).toFixed(1)}% for content ${c.user_id}`,confidence:c.confidence_score||0,recommendations:c.performance_factors||[],data:c,created_at:c.created_at,facility_id:this.facilityId,priority:this.getPriorityFromPerformance(c.predicted_performance),actionable:!0,id:c.id||`perfpred-${Date.now()}`})}),e}catch(e){return console.error("Error getting learning insights:",e),[]}})}getHistoricalLearningData(){return ua(this,null,function*(){try{const{data:e}=yield _.from("user_learning_progress").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(30);return e?e.map(t=>({date:t.created_at,user_id:t.user_id,content_id:t.content_id,progress_percentage:t.completion_rate,time_spent:t.session_duration,score:t.satisfaction_score,engagement_score:this.calculateEngagementScore(t)})):Array.from({length:30},(t,n)=>({date:new Date(Date.now()-n*24*60*60*1e3).toISOString(),user_id:`user-${Math.floor(Math.random()*10)+1}`,content_id:`content-${Math.floor(Math.random()*20)+1}`,progress_percentage:Math.random()*100,time_spent:Math.floor(Math.random()*120)+15,score:Math.random()>.3?Math.random()*40+60:void 0,engagement_score:Math.random()*.4+.6}))}catch(e){return console.error("Error getting historical learning data:",e),[]}})}getLearningCostData(){return ua(this,null,function*(){try{const{data:e}=yield _.from("learning_costs").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(1).single();if(e){const t=e;return{content_creation_costs:t.content_creation_costs,platform_costs:t.platform_costs,assessment_costs:t.assessment_costs,certification_costs:t.certification_costs,total_cost:t.total_cost}}return{content_creation_costs:15e3,platform_costs:5e3,assessment_costs:3e3,certification_costs:2e3,total_cost:25e3}}catch(e){return console.error("Error getting learning cost data:",e),{content_creation_costs:15e3,platform_costs:5e3,assessment_costs:3e3,certification_costs:2e3,total_cost:25e3}}})}calculateLearningEfficiency(e,t,n){const a=e*n/(t/60);return Math.min(a,1)}calculateEngagementScore(e){const t=e.time_spent_minutes||0,n=e.progress_percentage||0,a=e.attempts||1,i=Math.min(t/60,1),c=n/100,l=Math.max(0,1-(a-1)*.1);return i*.4+c*.4+l*.2}calculateRetentionRate(e,t){if(e.length!==t.length)return 0;const n=e.map((a,i)=>t[i]/a);return n.reduce((a,i)=>a+i,0)/n.length}calculateSkillProgression(e){const t={};return Object.entries(e).forEach(([n,a])=>{if(a.length<2){t[n]="stable";return}const i=a.slice(0,Math.ceil(a.length/2)),c=a.slice(Math.ceil(a.length/2)),l=i.reduce((u,h)=>u+h,0)/i.length,o=c.reduce((u,h)=>u+h,0)/c.length,d=l-o;d>.1?t[n]="improving":d<-.1?t[n]="declining":t[n]="stable"}),t}calculateLearningVelocity(e,t){return e/(t/7)}calculateKnowledgeDecayRate(e,t,n){if(n===0)return 0;const a=t/e;return a<=0?1:-Math.log(a)/n}calculateAdaptiveDifficultyAdjustment(e,t,n){const i=(e-t)*.1;return Math.max(0,Math.min(1,n+i))}detectLearningPatterns(e){const t=e.map(y=>y.content_id.split("-")[0]),n=e.map(y=>new Date(y.date).getHours()),a=t.reduce((y,g)=>(y[g]=(y[g]||0)+1,y),{}),i=Object.entries(a).sort(([,y],[,g])=>g-y).slice(0,3).map(([y])=>y),c=n.reduce((y,g)=>(y[g]=(y[g]||0)+1,y),{}),l=Object.entries(c).sort(([,y],[,g])=>g-y).slice(0,2).map(([y])=>`${y}:00`),o=Array.from(new Set(e.map(y=>y.date.split("T")[0]))).sort();let d=0,u=1;for(let y=1;y<o.length;y++){const g=new Date(o[y-1]);(new Date(o[y]).getTime()-g.getTime())/(1e3*60*60*24)===1?u++:(d=Math.max(d,u),u=1)}d=Math.max(d,u);const h=e.map(y=>y.progress_percentage),p=h.reduce((y,g)=>y+g,0)/h.length;let f="intermediate";return p>90?f="advanced":p<60&&(f="beginner"),{preferredContentTypes:i,optimalStudyTimes:l,learningStreaks:d,difficultyPreferences:f}}getPriorityFromConfidence(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}getPriorityFromGapCount(e){return e>=5?"critical":e>=3?"high":e>=1?"medium":"low"}getPriorityFromEfficiency(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}getPriorityFromPerformance(e){return e>=.9?"critical":e>=.8?"high":e>=.7?"medium":"low"}}var Js={},tt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Hn{constructor(e){this.facilityId=e}processPersonalizedRecommendationsWithAI(){return tt(this,null,function*(){return{recommended_content:["infection_control_basics","sterilization_protocols_advanced","environmental_cleaning_standards"],recommendation_reasoning:["Based on your role as environmental services technician","Addresses identified skill gaps in infection control","Builds on your completed sterilization fundamentals course"],confidence_scores:[.92,.85,.78],learning_path_suggestions:["Complete infection control basics first","Then proceed to advanced sterilization protocols","Finish with environmental cleaning standards"],skill_development_areas:["Infection control protocols","Advanced sterilization techniques","Environmental monitoring"],estimated_completion_time:120,difficulty_progression:["beginner","intermediate","advanced"],alternative_recommendations:["safety_protocols_fundamentals","equipment_maintenance_basics"],confidence_score:.87}})}processSkillGapAnalysisWithAI(){return tt(this,null,function*(){return{current_skills:{basic_cleaning:.8,safety_protocols:.6,infection_control:.4,equipment_operation:.7,documentation:.5},required_skills:{basic_cleaning:.9,safety_protocols:.9,infection_control:.8,equipment_operation:.8,documentation:.8,advanced_sterilization:.7,environmental_monitoring:.6},skill_gaps:{infection_control:.4,documentation:.3,advanced_sterilization:.7,environmental_monitoring:.6},gap_priorities:["infection_control","advanced_sterilization","environmental_monitoring","documentation"],learning_recommendations:["Complete infection control certification course","Take advanced sterilization protocols training","Enroll in environmental monitoring workshop","Practice documentation best practices"],skill_development_plan:["Week 1-2: Infection control fundamentals","Week 3-4: Advanced sterilization techniques","Week 5-6: Environmental monitoring protocols","Week 7-8: Documentation and reporting"],estimated_learning_time:160,confidence_score:.82}})}processLearningPathOptimizationWithAI(){return tt(this,null,function*(){return{optimized_learning_path:["safety_fundamentals","infection_control_basics","sterilization_protocols","environmental_cleaning_standards","advanced_sterilization_techniques","quality_assurance_protocols"],path_efficiency_score:.88,estimated_total_time:180,difficulty_progression:["beginner","beginner","intermediate","intermediate","advanced","advanced"],prerequisite_mapping:{infection_control_basics:["safety_fundamentals"],sterilization_protocols:["infection_control_basics"],environmental_cleaning_standards:["sterilization_protocols"],advanced_sterilization_techniques:["environmental_cleaning_standards"],quality_assurance_protocols:["advanced_sterilization_techniques"]},alternative_paths:[["safety_fundamentals","equipment_operation","sterilization_protocols"],["safety_fundamentals","documentation_basics","infection_control_basics"]],optimization_factors:["Prerequisite knowledge alignment","Learning curve optimization","Time efficiency","Skill progression logic"],confidence_score:.85}})}processPerformancePredictionWithAI(){return tt(this,null,function*(){return{predicted_performance:.82,predicted_completion_time:45,success_probability:.78,risk_factors:["Limited experience with advanced sterilization","Time constraints for study sessions","Complex technical concepts in later modules"],improvement_suggestions:["Allocate additional study time for complex topics","Seek hands-on practice opportunities","Connect with experienced colleagues for guidance","Break down complex topics into smaller sessions"],study_recommendations:["Study in 30-minute focused sessions","Review prerequisite materials before starting","Take practice quizzes regularly","Join study groups for peer learning"],confidence_score:.79}})}processAdaptiveDifficultyWithAI(){return tt(this,null,function*(){return{recommended_difficulty:"intermediate",difficulty_adjustment:.2,learning_curve_analysis:"User shows strong grasp of fundamentals but needs more practice with intermediate concepts",adaptation_reasoning:["High performance on basic safety protocols (95% accuracy)","Moderate performance on infection control (78% accuracy)","Struggling with advanced sterilization concepts (65% accuracy)","Consistent engagement and completion rates"],performance_indicators:{quiz_accuracy:.78,completion_rate:.92,engagement_time:.85,retention_score:.73},next_difficulty_target:"advanced",confidence_score:.81}})}processEngagementAnalysisWithAI(){return tt(this,null,function*(){return{engagement_score:.76,engagement_trends:{video_content:.85,interactive_quizzes:.78,text_reading:.65,simulations:.92},engagement_factors:["Interactive content increases engagement","Visual learning materials are preferred","Practical simulations maintain interest","Short, focused sessions work best"],disengagement_triggers:["Long text-heavy modules","Complex technical jargon without explanation","Lack of immediate feedback","Repetitive content format"],improvement_suggestions:["Increase use of interactive simulations","Break down text content into smaller chunks","Add more visual aids and diagrams","Provide immediate feedback on quizzes"],optimal_learning_times:["Morning sessions (9-11 AM)","Afternoon sessions (2-4 PM)"],content_preferences:["Video demonstrations","Interactive simulations","Case study examples","Hands-on practice exercises"],confidence_score:.83}})}processRetentionPredictionWithAI(){return tt(this,null,function*(){return{retention_probability:.72,knowledge_decay_rate:.15,review_recommendations:["Review infection control protocols weekly","Practice sterilization procedures monthly","Take refresher quizzes every 2 weeks","Attend hands-on workshops quarterly"],reinforcement_schedule:["Week 1: Initial review of key concepts","Week 2: Practice quiz on fundamentals","Month 1: Comprehensive review session","Month 3: Advanced application practice"],retention_factors:["Regular practice and application","Immediate feedback on performance","Spaced repetition of key concepts","Real-world application opportunities"],forgetting_risk_areas:["Complex sterilization parameters","Specific compliance requirements","Equipment operation procedures","Emergency response protocols"],confidence_score:.77}})}processLearningAnalyticsWithAI(){return tt(this,null,function*(){return{learning_efficiency_score:.81,preferred_content_categories:["interactive_simulations","video_demonstrations","case_studies","hands_on_practice"],optimal_study_duration:30,learning_patterns:{peak_performance_hours:"9-11 AM, 2-4 PM",preferred_session_length:"25-35 minutes",break_frequency:"every 45 minutes",review_preference:"immediate after completion"},progress_trends:{completion_rate:"increasing",quiz_accuracy:"stable",engagement_level:"improving",retention_rate:"declining"},performance_metrics:{overall_completion:.88,quiz_average:.82,engagement_score:.76,retention_rate:.68},insights:["User performs best with interactive content","Morning sessions show higher engagement","Retention drops after 2 weeks without review","Case studies improve practical application"],recommendations:["Schedule more interactive content","Implement spaced repetition for retention","Add more case study examples","Optimize study session timing"],confidence_score:.84}})}buildPersonalizedRecommendationPrompt(e,t,n){return`Generate personalized learning recommendations based on:
  User Profile: ${e}
  Learning History: ${t}
  Skill Gaps: ${n}
  
  Please provide:
  1. Recommended content based on role and interests
  2. Reasoning for each recommendation
  3. Confidence scores for recommendations
  4. Learning path suggestions
  5. Skill development areas to focus on
  6. Estimated completion time
  7. Difficulty progression
  8. Alternative recommendations`}buildSkillGapAnalysisPrompt(e,t,n){return`Analyze skill gaps based on:
  Current Skills: ${e}
  Required Skills: ${t}
  Role Requirements: ${n}
  
  Please provide:
  1. Current skill levels assessment
  2. Required skill levels for role
  3. Identified skill gaps with priority levels
  4. Learning recommendations to address gaps
  5. Skill development plan with timeline
  6. Estimated learning time required
  7. Confidence score for analysis`}buildLearningPathOptimizationPrompt(e,t,n){return`Optimize learning path based on:
  User Goals: ${e}
  Available Content: ${t}
  Constraints: ${n}
  
  Please provide:
  1. Optimized learning path sequence
  2. Path efficiency score
  3. Estimated total completion time
  4. Difficulty progression through path
  5. Prerequisite mapping
  6. Alternative path options
  7. Optimization factors considered
  8. Confidence score for optimization`}buildPerformancePredictionPrompt(e,t,n){return`Predict learning performance based on:
  User Profile: ${e}
  Content Information: ${t}
  Historical Performance: ${n}
  
  Please provide:
  1. Predicted performance score
  2. Predicted completion time
  3. Success probability
  4. Risk factors that may impact performance
  5. Improvement suggestions
  6. Study recommendations
  7. Confidence score for prediction`}executeWithRetry(e,t=3,n=100){return tt(this,null,function*(){const{OptimizedRetryService:a}=yield q(()=>import("./login-CtXU169Q.js").then(i=>i.co),__vite__mapDeps([1,2,3,4,5]));return yield a.executeWithRetry(e,{maxRetries:t,baseDelay:n,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return tt(this,null,function*(){const n=new Promise((a,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,n])})}selectModelForTask(e){switch(e){case"recommendation":return"gpt-4";case"skill_gap":return"gpt-4";case"path_optimization":return"gpt-4";case"performance_prediction":return"gpt-4";case"adaptive_difficulty":return"gpt-4";case"engagement_analysis":return"gpt-4";case"retention_prediction":return"gpt-4";case"learning_analytics":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:Js.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:Js.GOOGLE_AI_API_BASE_URL||"https://generativelanguage.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro"},azure:{baseUrl:Js.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:Js.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}}const Ky={ai_enabled:!1,ai_version:"1.0.0",personalized_recommendations:!1,skill_gap_analysis:!1,learning_path_optimization:!1,performance_prediction:!1,adaptive_difficulty:!1,learning_analytics_enabled:!1,behavior_tracking:!1,progress_prediction:!1,engagement_metrics:!1,retention_analysis:!1,ai_confidence_threshold:.8,recommendation_limit:5,data_retention_days:365,model_version:"v1.0",data_sharing_enabled:!1,local_ai_processing_enabled:!1,encrypted_data_transmission:!0,ai_model_training:!1},Qy={NO_DATA_FOUND:"PGRST116"},Ar={DIFFICULTY_LEVEL:"beginner",USER_ROLE:"user",DEPARTMENT:"general",EXPERIENCE_LEVEL:"entry",LEARNING_STYLE:"visual",TIME_AVAILABILITY:30},Yy={LEARNING_PROGRESS_DATA:100};function Jy(s){var e,t,n,a,i,c,l,o,d,u,h,p,f,y,g,x,b,v,w,S,T,C,P,N;return{id:(e=s.id)!=null?e:"",facility_id:(t=s.facility_id)!=null?t:"",ai_enabled:(n=s.ai_enabled)!=null?n:!1,ai_version:(a=s.ai_version)!=null?a:"",personalized_recommendations:(i=s.personalized_recommendations)!=null?i:!1,skill_gap_analysis:(c=s.skill_gap_analysis)!=null?c:!1,learning_path_optimization:(l=s.learning_path_optimization)!=null?l:!1,performance_prediction:(o=s.performance_prediction)!=null?o:!1,adaptive_difficulty:(d=s.adaptive_difficulty)!=null?d:!1,learning_analytics_enabled:(u=s.learning_analytics_enabled)!=null?u:!1,behavior_tracking:(h=s.behavior_tracking)!=null?h:!1,progress_prediction:(p=s.progress_prediction)!=null?p:!1,engagement_metrics:(f=s.engagement_metrics)!=null?f:!1,retention_analysis:(y=s.retention_analysis)!=null?y:!1,ai_confidence_threshold:(g=s.ai_confidence_threshold)!=null?g:0,recommendation_limit:(x=s.recommendation_limit)!=null?x:0,data_retention_days:(b=s.data_retention_days)!=null?b:0,model_version:(v=s.model_version)!=null?v:"",data_sharing_enabled:(w=s.data_sharing_enabled)!=null?w:!1,local_ai_processing_enabled:(S=s.local_ai_processing_enabled)!=null?S:!1,encrypted_data_transmission:(T=s.encrypted_data_transmission)!=null?T:!1,ai_model_training:(C=s.ai_model_training)!=null?C:!1,created_at:(P=s.created_at)!=null?P:"",updated_at:(N=s.updated_at)!=null?N:""}}function Xy(s){var e,t,n,a,i,c,l,o,d,u,h;return{id:(e=s.id)!=null?e:"",user_id:(t=s.user_id)!=null?t:"",role:(n=s.role)!=null?n:Ar.USER_ROLE,department:(a=s.department)!=null?a:Ar.DEPARTMENT,experience_level:(i=s.experience_level)!=null?i:Ar.EXPERIENCE_LEVEL,skill_areas:(c=s.skill_areas)!=null?c:[],learning_goals:(l=s.learning_goals)!=null?l:[],preferred_learning_style:(o=s.preferred_learning_style)!=null?o:Ar.LEARNING_STYLE,time_availability:(d=s.time_availability)!=null?d:Ar.TIME_AVAILABILITY,last_updated:(h=(u=s.updated_at)!=null?u:s.created_at)!=null?h:""}}function It(s,e){return s!==null&&s[e]===!0}function Ot(s){return Date.now()-s}function Zy(s){return Array.isArray(s)?s.join("; "):s}function e0(s){return s.split("; ").filter(e=>e.trim().length>0)}function yt(){return new Date().toISOString()}var t0=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class r0{constructor(e){this.facilityId=e,this.providerService=new Hn(e)}generatePersonalizedRecommendations(e){return t0(this,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,y;try{const g=Date.now(),x=yield this.providerService.processPersonalizedRecommendationsWithAI(),b=Ot(g),v={facility_id:this.facilityId,user_id:e,recommended_content:x.recommended_content,recommendation_reasoning:x.recommendation_reasoning,confidence_scores:x.confidence_scores,learning_path_suggestions:x.learning_path_suggestions,skill_development_areas:x.skill_development_areas,estimated_completion_time:x.estimated_completion_time,difficulty_progression:x.difficulty_progression,alternative_recommendations:x.alternative_recommendations,confidence_score:x.confidence_score,processing_time_ms:b,created_at:yt()},w={facility_id:v.facility_id,user_id:v.user_id,recommended_content:v.recommended_content,recommendation_reasoning:Zy(v.recommendation_reasoning),confidence_scores:v.confidence_scores,learning_path_suggestions:v.learning_path_suggestions,skill_development_areas:v.skill_development_areas,estimated_completion_time:v.estimated_completion_time,difficulty_progression:v.difficulty_progression,alternative_recommendations:v.alternative_recommendations,confidence_score:v.confidence_score,processing_time_ms:v.processing_time_ms,created_at:v.created_at},{data:S,error:T}=yield _.from("learning_ai_personalized_recommendations").insert(w).select().single();if(T)return console.error("Error saving personalized recommendation result:",T),null;if(!S)return null;const C=S;return{id:(t=C.id)!=null?t:"",facility_id:(n=C.facility_id)!=null?n:"",user_id:(a=C.user_id)!=null?a:"",recommended_content:(i=C.recommended_content)!=null?i:[],recommendation_reasoning:e0(C.recommendation_reasoning),confidence_scores:(c=C.confidence_scores)!=null?c:[],learning_path_suggestions:(l=C.learning_path_suggestions)!=null?l:[],skill_development_areas:(o=C.skill_development_areas)!=null?o:[],estimated_completion_time:(d=C.estimated_completion_time)!=null?d:0,difficulty_progression:(u=C.difficulty_progression)!=null?u:[],alternative_recommendations:(h=C.alternative_recommendations)!=null?h:[],confidence_score:(p=C.confidence_score)!=null?p:0,processing_time_ms:(f=C.processing_time_ms)!=null?f:0,created_at:(y=C.created_at)!=null?y:""}}catch(g){return console.error("Error generating personalized recommendations:",g),null}})}}var s0=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class n0{constructor(e){this.facilityId=e,this.providerService=new Hn(e)}analyzeSkillGaps(e){return s0(this,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,y;try{const g=Date.now(),x=yield this.providerService.processSkillGapAnalysisWithAI(),b=Ot(g),v={facility_id:this.facilityId,user_id:e,current_skills:x.current_skills,required_skills:x.required_skills,skill_gaps:x.skill_gaps,gap_priorities:x.gap_priorities,learning_recommendations:x.learning_recommendations,skill_development_plan:x.skill_development_plan,estimated_learning_time:x.estimated_learning_time,confidence_score:x.confidence_score,processing_time_ms:b,created_at:yt()},w={facility_id:v.facility_id,user_id:v.user_id,current_skills:v.current_skills,required_skills:v.required_skills,skill_gaps:v.skill_gaps,gap_priorities:v.gap_priorities,learning_recommendations:v.learning_recommendations,skill_development_plan:v.skill_development_plan,estimated_learning_time:v.estimated_learning_time,confidence_score:v.confidence_score,processing_time_ms:v.processing_time_ms,created_at:v.created_at},{data:S,error:T}=yield _.from("learning_ai_skill_gap_analysis").insert(w).select().single();if(T)return console.error("Error saving skill gap analysis result:",T),null;if(!S)return null;const C=S;return{id:(t=C.id)!=null?t:"",facility_id:(n=C.facility_id)!=null?n:"",user_id:(a=C.user_id)!=null?a:"",current_skills:(i=C.current_skills)!=null?i:{},required_skills:(c=C.required_skills)!=null?c:{},skill_gaps:(l=C.skill_gaps)!=null?l:{},gap_priorities:(o=C.gap_priorities)!=null?o:[],learning_recommendations:(d=C.learning_recommendations)!=null?d:[],skill_development_plan:(u=C.skill_development_plan)!=null?u:[],estimated_learning_time:(h=C.estimated_learning_time)!=null?h:0,confidence_score:(p=C.confidence_score)!=null?p:0,processing_time_ms:(f=C.processing_time_ms)!=null?f:0,created_at:(y=C.created_at)!=null?y:""}}catch(g){return console.error(g),console.error("Error analyzing skill gaps"),null}})}}var a0=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class i0{constructor(e){this.facilityId=e,this.providerService=new Hn(e)}optimizeLearningPath(e){return a0(this,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,y;try{const g=Date.now(),x=yield this.providerService.processLearningPathOptimizationWithAI(),b=Ot(g),v={facility_id:this.facilityId,user_id:e,optimized_learning_path:x.optimized_learning_path,path_efficiency_score:x.path_efficiency_score,estimated_total_time:x.estimated_total_time,difficulty_progression:x.difficulty_progression,prerequisite_mapping:x.prerequisite_mapping,alternative_paths:x.alternative_paths,optimization_factors:x.optimization_factors,confidence_score:x.confidence_score,processing_time_ms:b,created_at:yt()},w={facility_id:v.facility_id,user_id:v.user_id,optimized_learning_path:v.optimized_learning_path,path_efficiency_score:v.path_efficiency_score,estimated_total_time:v.estimated_total_time,difficulty_progression:v.difficulty_progression,prerequisite_mapping:v.prerequisite_mapping,alternative_paths:v.alternative_paths,optimization_factors:v.optimization_factors,confidence_score:v.confidence_score,processing_time_ms:v.processing_time_ms,created_at:v.created_at},{data:S,error:T}=yield _.from("learning_ai_path_optimization").insert(w).select().single();if(T)return console.error("Error saving learning path optimization result:",T),null;if(!S)return null;const C=S;return{id:(t=C.id)!=null?t:"",facility_id:(n=C.facility_id)!=null?n:"",user_id:(a=C.user_id)!=null?a:"",optimized_learning_path:(i=C.optimized_learning_path)!=null?i:[],path_efficiency_score:(c=C.path_efficiency_score)!=null?c:0,estimated_total_time:(l=C.estimated_total_time)!=null?l:0,difficulty_progression:(o=C.difficulty_progression)!=null?o:[],prerequisite_mapping:(d=C.prerequisite_mapping)!=null?d:{},alternative_paths:(u=C.alternative_paths)!=null?u:[],optimization_factors:(h=C.optimization_factors)!=null?h:[],confidence_score:(p=C.confidence_score)!=null?p:0,processing_time_ms:(f=C.processing_time_ms)!=null?f:0,created_at:(y=C.created_at)!=null?y:""}}catch(g){return console.error("Error optimizing learning path:",g),null}})}}var ss=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class o0{constructor(e){this.facilityId=e,this.providerService=new Hn(e)}predictPerformance(e,t){return ss(this,null,function*(){var n,a,i,c,l,o,d,u,h,p;try{const f=Date.now(),y=yield this.providerService.processPerformancePredictionWithAI(),g=Ot(f),x={facility_id:this.facilityId,user_id:e,content_id:t,predicted_performance:y.predicted_performance,predicted_completion_time:y.predicted_completion_time,success_probability:y.success_probability,risk_factors:y.risk_factors,improvement_suggestions:y.improvement_suggestions,study_recommendations:y.study_recommendations,confidence_score:y.confidence_score,processing_time_ms:g,created_at:yt()},b={facility_id:x.facility_id,user_id:x.user_id,content_id:x.content_id,predicted_performance:x.predicted_performance,confidence_score:x.confidence_score,performance_factors:x.risk_factors,improvement_suggestions:x.improvement_suggestions,estimated_completion_time:x.predicted_completion_time,difficulty_assessment:x.study_recommendations,prerequisite_requirements:{},alternative_approaches:{},processing_time_ms:x.processing_time_ms,created_at:x.created_at},{data:v,error:w}=yield _.from("learning_ai_performance_prediction").insert(b).select().single();if(w)return console.error("Error saving performance prediction result:",w),null;if(!v)return null;const S=v;return{id:(n=S.id)!=null?n:"",facility_id:(a=S.facility_id)!=null?a:"",user_id:(i=S.user_id)!=null?i:"",content_id:(c=S.content_id)!=null?c:"",predicted_performance:(l=S.predicted_performance)!=null?l:0,predicted_completion_time:(o=S.estimated_completion_time)!=null?o:0,success_probability:0,risk_factors:[],improvement_suggestions:(d=S.improvement_suggestions)!=null?d:[],study_recommendations:[],confidence_score:(u=S.confidence_score)!=null?u:0,processing_time_ms:(h=S.processing_time_ms)!=null?h:0,created_at:(p=S.created_at)!=null?p:""}}catch(f){return console.error("Error predicting performance:",f),null}})}adjustDifficulty(e,t){return ss(this,null,function*(){var n,a,i,c,l,o,d;try{const u=Date.now(),h=yield this.providerService.processAdaptiveDifficultyWithAI(),p=Ot(u),f={facility_id:this.facilityId,user_id:e,content_id:t,recommended_difficulty:h.recommended_difficulty,difficulty_adjustment:h.difficulty_adjustment,learning_curve_analysis:h.learning_curve_analysis,adaptation_reasoning:h.adaptation_reasoning,performance_indicators:h.performance_indicators,next_difficulty_target:h.next_difficulty_target,confidence_score:h.confidence_score,processing_time_ms:p,created_at:yt()},y={facility_id:f.facility_id,user_id:f.user_id,content_id:f.content_id,recommended_difficulty:f.recommended_difficulty,difficulty_adjustment:f.difficulty_adjustment,learning_curve_analysis:f.learning_curve_analysis,adaptation_reasoning:f.adaptation_reasoning,performance_indicators:f.performance_indicators,next_difficulty_target:f.next_difficulty_target,confidence_score:f.confidence_score,processing_time_ms:f.processing_time_ms,created_at:f.created_at},{data:g,error:x}=yield _.from("learning_ai_adaptive_difficulty").insert(y).select().single();if(x)return console.error("Error saving adaptive difficulty result:",x),null;if(!g)return null;const b=g;return{recommended_difficulty:(n=b.recommended_difficulty)!=null?n:Ar.DIFFICULTY_LEVEL,difficulty_adjustment:(a=b.difficulty_adjustment)!=null?a:0,learning_curve_analysis:(i=b.learning_curve_analysis)!=null?i:"",adaptation_reasoning:(c=b.adaptation_reasoning)!=null?c:[],performance_indicators:(l=b.performance_indicators)!=null?l:{},next_difficulty_target:(o=b.next_difficulty_target)!=null?o:"",confidence_score:(d=b.confidence_score)!=null?d:0}}catch(u){return console.error("Error adjusting difficulty:",u),null}})}analyzeEngagement(e){return ss(this,null,function*(){var t,n,a,i,c,l,o,d;try{const u=Date.now(),h=yield this.providerService.processEngagementAnalysisWithAI(),p=Ot(u),f={facility_id:this.facilityId,user_id:e,engagement_score:h.engagement_score,engagement_trends:h.engagement_trends,engagement_factors:h.engagement_factors,disengagement_triggers:h.disengagement_triggers,improvement_suggestions:h.improvement_suggestions,optimal_learning_times:h.optimal_learning_times,content_preferences:h.content_preferences,confidence_score:h.confidence_score,processing_time_ms:p,created_at:yt()},y={facility_id:f.facility_id,user_id:f.user_id,engagement_score:f.engagement_score,engagement_trends:f.engagement_trends,engagement_factors:f.engagement_factors,disengagement_triggers:f.disengagement_triggers,improvement_suggestions:f.improvement_suggestions,optimal_learning_times:f.optimal_learning_times,content_preferences:f.content_preferences,confidence_score:f.confidence_score,processing_time_ms:f.processing_time_ms,created_at:f.created_at},{data:g,error:x}=yield _.from("learning_ai_engagement_analysis").insert(y).select().single();if(x)return console.error("Error saving engagement analysis result:",x),null;if(!g)return null;const b=g;return{engagement_score:(t=b.engagement_score)!=null?t:0,engagement_trends:(n=b.engagement_trends)!=null?n:{},engagement_factors:(a=b.engagement_factors)!=null?a:[],disengagement_triggers:(i=b.disengagement_triggers)!=null?i:[],improvement_suggestions:(c=b.improvement_suggestions)!=null?c:[],optimal_learning_times:(l=b.optimal_learning_times)!=null?l:[],content_preferences:(o=b.content_preferences)!=null?o:[],confidence_score:(d=b.confidence_score)!=null?d:0}}catch(u){return console.error("Error analyzing engagement:",u),null}})}predictRetention(e){return ss(this,null,function*(){var t,n,a,i,c,l,o;try{const d=Date.now(),u=yield this.providerService.processRetentionPredictionWithAI(),h=Ot(d),p={facility_id:this.facilityId,user_id:e,retention_probability:u.retention_probability,knowledge_decay_rate:u.knowledge_decay_rate,review_recommendations:u.review_recommendations,reinforcement_schedule:u.reinforcement_schedule,retention_factors:u.retention_factors,forgetting_risk_areas:u.forgetting_risk_areas,confidence_score:u.confidence_score,processing_time_ms:h,created_at:yt()},f={facility_id:p.facility_id,user_id:p.user_id,retention_probability:p.retention_probability,knowledge_decay_rate:p.knowledge_decay_rate,review_recommendations:p.review_recommendations,reinforcement_schedule:p.reinforcement_schedule,retention_factors:p.retention_factors,forgetting_risk_areas:p.forgetting_risk_areas,confidence_score:p.confidence_score,processing_time_ms:p.processing_time_ms,created_at:p.created_at},{data:y,error:g}=yield _.from("learning_ai_retention_prediction").insert(f).select().single();if(g)return console.error("Error saving retention prediction result:",g),null;if(!y)return null;const x=y;return{retention_probability:(t=x.retention_probability)!=null?t:0,knowledge_decay_rate:(n=x.knowledge_decay_rate)!=null?n:0,review_recommendations:(a=x.review_recommendations)!=null?a:[],reinforcement_schedule:(i=x.reinforcement_schedule)!=null?i:[],retention_factors:(c=x.retention_factors)!=null?c:[],forgetting_risk_areas:(l=x.forgetting_risk_areas)!=null?l:[],confidence_score:(o=x.confidence_score)!=null?o:0}}catch(d){return console.error("Error predicting retention:",d),null}})}generateLearningAnalytics(e){return ss(this,null,function*(){var t,n,a,i,c,l,o,d,u;try{const h=Date.now(),p=yield this.providerService.processLearningAnalyticsWithAI(),f=Ot(h),y={facility_id:this.facilityId,user_id:e,learning_efficiency_score:p.learning_efficiency_score,preferred_content_categories:p.preferred_content_categories,optimal_study_duration:p.optimal_study_duration,learning_patterns:p.learning_patterns,progress_trends:p.progress_trends,performance_metrics:p.performance_metrics,insights:p.insights,recommendations:p.recommendations,confidence_score:p.confidence_score,processing_time_ms:f,created_at:yt()},g={facility_id:y.facility_id,user_id:y.user_id,learning_efficiency_score:y.learning_efficiency_score,preferred_content_categories:y.preferred_content_categories,optimal_study_duration:y.optimal_study_duration,learning_patterns:y.learning_patterns,progress_trends:y.progress_trends,performance_metrics:y.performance_metrics,insights:y.insights,recommendations:y.recommendations,confidence_score:y.confidence_score,processing_time_ms:y.processing_time_ms,created_at:y.created_at},{data:x,error:b}=yield _.from("learning_ai_analytics").insert(g).select().single();if(b)return console.error("Error saving learning analytics result:",b),null;if(!x)return null;const v=x;return{learning_efficiency_score:(t=v.learning_efficiency_score)!=null?t:0,preferred_content_categories:(n=v.preferred_content_categories)!=null?n:[],optimal_study_duration:(a=v.optimal_study_duration)!=null?a:0,learning_patterns:(i=v.learning_patterns)!=null?i:{},progress_trends:(c=v.progress_trends)!=null?c:{},performance_metrics:(l=v.performance_metrics)!=null?l:{},insights:(o=v.insights)!=null?o:[],recommendations:(d=v.recommendations)!=null?d:[],confidence_score:(u=v.confidence_score)!=null?u:0}}catch(h){return console.error("Error generating learning analytics:",h),null}})}}var Vn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function l0(s){return Vn(this,null,function*(){try{const{data:e,error:t}=yield _.from("learning_ai_settings").select("*").eq("facility_id",s).single();if(t){if(t.code===Qy.NO_DATA_FOUND)return null;throw t}return e?Jy(e):null}catch(e){return console.error(e),console.error("Error loading learning AI settings"),null}})}function c0(s,e){return Vn(this,null,function*(){try{const t={facility_id:s,ai_enabled:e.ai_enabled,ai_version:e.ai_version,personalized_recommendations:e.personalized_recommendations,skill_gap_analysis:e.skill_gap_analysis,learning_path_optimization:e.learning_path_optimization,performance_prediction:e.performance_prediction,adaptive_difficulty:e.adaptive_difficulty,learning_analytics_enabled:e.learning_analytics_enabled,behavior_tracking:e.behavior_tracking,progress_prediction:e.progress_prediction,engagement_metrics:e.engagement_metrics,retention_analysis:e.retention_analysis,ai_confidence_threshold:e.ai_confidence_threshold,recommendation_limit:e.recommendation_limit,data_retention_days:e.data_retention_days,model_version:e.model_version,data_sharing_enabled:e.data_sharing_enabled,local_ai_processing_enabled:e.local_ai_processing_enabled,encrypted_data_transmission:e.encrypted_data_transmission,ai_model_training:e.ai_model_training,updated_at:yt()},{error:n}=yield _.from("learning_ai_settings").upsert(t);return n?(console.error("Error saving learning AI settings:",n),!1):!0}catch(t){return console.error(t),console.error("Error saving learning AI settings"),!1}})}function d0(s,e){return Vn(this,null,function*(){try{const{data:t,error:n}=yield _.from("learning_progress").select("*").eq("facility_id",s).eq("user_id",e).order("created_at",{ascending:!1}).limit(Yy.LEARNING_PROGRESS_DATA);return n?(console.error("Error getting learning progress data:",n),[]):t||[]}catch(t){return console.error("Error getting learning progress data:",t),[]}})}function u0(s,e){return Vn(this,null,function*(){try{const{data:t,error:n}=yield _.from("user_profiles").select("*").eq("user_id",e).eq("facility_id",s).single();return n?(console.error("Error getting user profile:",n),null):t?Xy(t):null}catch(t){return console.error("Error getting user profile:",t),null}})}var Ne=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class m0{constructor(e){this.facilityId=e,this.analyticsService=new Gy(e),this.recommendationService=new r0(e),this.knowledgeGapService=new n0(e),this.pathwayAnalysisService=new i0(e),this.evaluationService=new o0(e)}initialize(){return Ne(this,null,function*(){try{return(yield this.loadSettings())!==null}catch(e){return console.error(e),console.error("Failed to initialize LearningAIService"),!1}})}loadSettings(){return Ne(this,null,function*(){return yield l0(this.facilityId)})}saveSettings(e){return Ne(this,null,function*(){return yield c0(this.facilityId,e)})}initializeSettings(){return Ne(this,null,function*(){try{const e=Ky;return yield this.saveSettings(e)}catch(e){return console.error(e),console.error("Error initializing learning AI settings"),!1}})}generatePersonalizedRecommendations(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!It(t,"personalized_recommendations"))throw new Error("Personalized recommendations AI is not enabled");return yield this.recommendationService.generatePersonalizedRecommendations(e)}catch(t){return console.error("Error generating personalized recommendations:",t),null}})}analyzeSkillGaps(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!It(t,"skill_gap_analysis"))throw new Error("Skill gap analysis AI is not enabled");return yield this.knowledgeGapService.analyzeSkillGaps(e)}catch(t){return console.error(t),console.error("Error analyzing skill gaps"),null}})}optimizeLearningPath(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!It(t,"learning_path_optimization"))throw new Error("Learning path optimization AI is not enabled");return yield this.pathwayAnalysisService.optimizeLearningPath(e)}catch(t){return console.error("Error optimizing learning path:",t),null}})}predictPerformance(e,t){return Ne(this,null,function*(){try{const n=yield this.loadSettings();if(!It(n,"performance_prediction"))throw new Error("Performance prediction AI is not enabled");return yield this.evaluationService.predictPerformance(e,t)}catch(n){return console.error("Error predicting performance:",n),null}})}adjustDifficulty(e,t){return Ne(this,null,function*(){try{const n=yield this.loadSettings();if(!It(n,"adaptive_difficulty"))throw new Error("Adaptive difficulty AI is not enabled");return yield this.evaluationService.adjustDifficulty(e,t)}catch(n){return console.error("Error adjusting difficulty:",n),null}})}analyzeEngagement(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!It(t,"engagement_metrics"))throw new Error("Engagement analysis AI is not enabled");return yield this.evaluationService.analyzeEngagement(e)}catch(t){return console.error("Error analyzing engagement:",t),null}})}predictRetention(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!It(t,"retention_analysis"))throw new Error("Retention prediction AI is not enabled");return yield this.evaluationService.predictRetention(e)}catch(t){return console.error("Error predicting retention:",t),null}})}generateLearningAnalytics(e){return Ne(this,null,function*(){try{const t=yield this.loadSettings();if(!It(t,"learning_analytics_enabled"))throw new Error("Learning analytics AI is not enabled");return yield this.evaluationService.generateLearningAnalytics(e)}catch(t){return console.error("Error generating learning analytics:",t),null}})}getLearningInsights(){return Ne(this,null,function*(){return this.analyticsService.getLearningInsights()})}getLearningProgressData(e){return Ne(this,null,function*(){return yield d0(this.facilityId,e)})}getUserProfile(e){return Ne(this,null,function*(){return yield u0(this.facilityId,e)})}}var ma=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Ei{constructor(e){this.facilityId=e}getInventoryInsights(){return ma(this,null,function*(){try{const e=[],{data:t}=yield _.from("inventory_ai_barcode_analysis").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);t&&t.forEach(a=>{e.push({type:"barcode_analysis",title:"Barcode Quality Assessment",description:`Barcode ${a.barcode_value} analyzed with ${(a.confidence_score*100).toFixed(1)}% confidence`,confidence:a.confidence_score||0,recommendations:a.recommendations||[],data:a,timestamp:a.created_at,priority:a.confidence_score<.7?"critical":a.confidence_score<.85?"high":"medium",id:a.id||`barcode-${Date.now()}`,actionable:!0})});const{data:n}=yield _.from("inventory_ai_demand_forecasting").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(5);return n&&n.forEach(a=>{e.push({type:"demand_forecast",title:"Demand Forecast",description:`${a.forecast_period} forecast: ${a.predicted_demand} units predicted`,confidence:a.confidence_score||0,recommendations:a.recommendations||[],data:a,timestamp:a.created_at,priority:a.confidence_score<.7?"critical":a.confidence_score<.85?"high":"medium",id:a.id||`forecast-${Date.now()}`,actionable:!0})}),e}catch(e){return console.error("Error getting inventory insights:",e),[]}})}getHistoricalInventoryData(){return ma(this,null,function*(){return Array.from({length:30},(e,t)=>({date:new Date(Date.now()-t*24*60*60*1e3).toISOString(),quantity:Math.floor(Math.random()*20)+10,transaction_type:"usage"}))})}getInventoryCostData(){return ma(this,null,function*(){return{purchasing_costs:8e3,storage_costs:4e3,transportation_costs:3e3,total_cost:15e3}})}detectBarcodeType(e){return e?e.length===13?"ean13":e.length===12?"upc":e.length===8?"ean8":"code128":"unknown"}assessBarcodeQuality(e){return e>=.9?"excellent":e>=.8?"good":e>=.7?"fair":"poor"}calculateInventoryTurns(e,t){return t===0?0:e/t}calculateStockoutRisk(e,t,n,a){const i=(e-a)/t;return i<=0?1:i<=n?.8:i<=n*1.5?.5:.2}calculateSafetyStock(e,t,n){const a=this.getZScore(n);return Math.ceil(e*t*a*.1)}calculateReorderPoint(e,t,n){return Math.ceil(e*t+n)}getZScore(e){return{.8:.84,.85:1.04,.9:1.28,.95:1.65,.99:2.33}[e]||1.28}}var ha=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class h0{constructor(e){this.facilityId=e}generateDemandForecast(e,t,n){return ha(this,null,function*(){try{const a=Date.now(),i=n||(yield this.getHistoricalInventoryData()),c=yield this.generateForecastWithAI(i,t),l=Date.now()-a;return{facility_id:this.facilityId,inventory_item_id:e,forecast_period:t,forecast_date:new Date().toISOString().split("T")[0],predicted_demand:c.predicted_demand,confidence_interval_lower:c.confidence_interval_lower,confidence_interval_upper:c.confidence_interval_upper,seasonal_factors:c.seasonal_factors,trend_analysis:c.trend_analysis,influencing_factors:c.influencing_factors,confidence_score:c.confidence_score,processing_time_ms:l,historical_data_points:i.length,accuracy_metrics:c.accuracy_metrics,recommendations:c.recommendations}}catch(a){throw console.error("Error generating demand forecast:",a),a}})}generateForecastWithAI(e,t){return ha(this,null,function*(){return{predicted_demand:this.calculateDeterministicForecast(e,t),confidence_interval_lower:this.calculateConfidenceInterval(e,t,"lower"),confidence_interval_upper:this.calculateConfidenceInterval(e,t,"upper"),seasonal_factors:this.analyzeSeasonality(e),trend_analysis:this.detectTrendDirection(e),influencing_factors:this.identifyInfluencingFactors(e),confidence_score:this.calculateConfidenceScore(e),accuracy_metrics:this.calculateAccuracyMetrics(e),recommendations:this.generateRecommendations(e,t)}})}getHistoricalInventoryData(){return ha(this,null,function*(){return Array.from({length:30},(e,t)=>({date:new Date(Date.now()-t*24*60*60*1e3).toISOString(),quantity:Math.floor(Math.random()*20)+10,transaction_type:"usage"}))})}calculateDeterministicForecast(e,t){if(e.length===0)return 0;const a=e.reduce((i,c)=>i+c.quantity,0)/e.length;switch(t){case"week":return Math.ceil(a*7);case"month":return Math.ceil(a*30);case"quarter":return Math.ceil(a*90);case"year":return Math.ceil(a*365);default:return Math.ceil(a*30)}}calculateConfidenceInterval(e,t,n){if(e.length===0)return 0;const a=this.calculateDeterministicForecast(e,t),i=this.calculateVariance(e),c=Math.sqrt(i/e.length),l=1.96;return n==="lower"?Math.max(0,Math.ceil(a-l*c)):Math.ceil(a+l*c)}calculateVariance(e){if(e.length<=1)return 0;const t=e.map(i=>i.quantity),n=t.reduce((i,c)=>i+c,0)/t.length;return t.map(i=>Math.pow(i-n,2)).reduce((i,c)=>i+c,0)/(t.length-1)}analyzeSeasonality(e){if(e.length<7)return{seasonality:"insufficient_data",trend:"unknown"};const t=this.groupByWeek(e);return{seasonality:this.detectWeeklyPattern(t)?"weekly":"none",trend:this.detectTrendDirection(e),weekly_variance:this.calculateWeeklyVariance(t)}}groupByWeek(e){const t={};return e.forEach(n=>{const a=new Date(n.date),i=`${a.getFullYear()}-W${Math.ceil((a.getDate()+a.getDay())/7)}`;t[i]||(t[i]=[]),t[i].push(n.quantity)}),t}detectWeeklyPattern(e){const t=Object.keys(e);if(t.length<2)return!1;const n=t.map(i=>{const c=e[i];return c.reduce((l,o)=>l+o,0)/c.length});return this.calculateVariance(n.map((i,c)=>({quantity:n[c],date:new Date().toISOString(),transaction_type:"usage"})))>5}detectTrendDirection(e){if(e.length<2)return"insufficient_data";const t=[...e].sort((o,d)=>new Date(o.date).getTime()-new Date(d.date).getTime()),n=t.slice(0,Math.floor(t.length/2)),a=t.slice(Math.floor(t.length/2)),i=n.reduce((o,d)=>o+d.quantity,0)/n.length,l=(a.reduce((o,d)=>o+d.quantity,0)/a.length-i)/i*100;return l>10?"increasing":l<-10?"decreasing":"stable"}calculateWeeklyVariance(e){const t=Object.values(e).map(i=>i.reduce((c,l)=>c+l,0)/i.length);if(t.length<=1)return 0;const n=t.reduce((i,c)=>i+c,0)/t.length;return t.map(i=>Math.pow(i-n,2)).reduce((i,c)=>i+c,0)/(t.length-1)}identifyInfluencingFactors(e){const t=[];if(e.length>0){const n=this.detectTrendDirection(e);n==="increasing"&&t.push("increased_procedures"),n==="decreasing"&&t.push("reduced_activity"),this.analyzeSeasonality(e).seasonality==="weekly"&&t.push("weekly_usage_patterns")}return t.length>0?t:["stable_usage_patterns"]}calculateConfidenceScore(e){return e.length===0?0:e.length<7?.5:e.length<14?.7:e.length<30?.8:.85}calculateAccuracyMetrics(e){if(e.length<2)return{mae:0,rmse:0};const t=this.calculateVariance(e),n=Math.sqrt(t)*.8,a=Math.sqrt(t);return{mae:Math.round(n*100)/100,rmse:Math.round(a*100)/100}}generateRecommendations(e,t){const n=[];if(e.length<7)return n.push("Collect more historical data for accurate forecasting"),n;const a=this.detectTrendDirection(e),i=this.calculateDeterministicForecast(e,t);return a==="increasing"?n.push(`Consider increasing stock levels by 15% for ${t} period`):a==="decreasing"&&n.push(`Consider reducing stock levels by 10% for ${t} period`),n.push(`Monitor usage patterns ${t}ly`),n.push(`Set reorder point at ${Math.ceil(i*.8)} units`),n}}var Xs={},Tt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class ki{constructor(e){this.facilityId=e}processImageWithAI(){return Tt(this,null,function*(){return{confidence:.85,damage_detected:!1,damage_types:[],objects:["inventory_item","barcode"],confidence_scores:[.9,.8],classification:"medical_supply",category:"disposables",quality:"good",condition:"good",damage_description:null,recommendations:["Item appears to be in good condition","Barcode is clearly visible"]}})}generateForecastWithAI(){return Tt(this,null,function*(){return{predicted_demand:Math.floor(Math.random()*100)+50,confidence_interval_lower:40,confidence_interval_upper:80,seasonal_factors:{seasonality:"moderate",trend:"increasing"},trend_analysis:"Steady increase in demand over the past 6 months",influencing_factors:["seasonal usage","increased procedures"],confidence_score:.82,accuracy_metrics:{mae:12.5,rmse:15.2},recommendations:["Consider increasing stock levels by 15%","Monitor usage patterns weekly"]}})}generateOptimizationWithAI(){return Tt(this,null,function*(){return{current_cost:15e3,optimized_cost:12e3,cost_savings:3e3,savings_percentage:20,optimization_factors:{bulk_purchasing:!0,supplier_negotiation:!0},recommended_actions:["Negotiate bulk pricing with suppliers","Implement just-in-time inventory"],implementation_timeline:"3-6 months",risk_assessment:"low",confidence_score:.88,roi_estimate:150}})}processCategorizationWithAI(){return Tt(this,null,function*(){return{suggested_category:"medical_supplies",suggested_subcategory:"disposables",category_confidence_score:.92,alternative_categories:["Item description matches medical supply patterns","Similar items in database"],categorization_reasoning:["Item description matches medical supply patterns","Similar items in database"],form_fill_suggestions:{category:"medical_supplies",subcategory:"disposables"},workflow_recommendations:["Use standard medical supply workflow","Apply medical supply pricing"],confidence_score:.92}})}uploadImage(e){return Tt(this,null,function*(){return`/uploads/inventory/${Date.now()}_${e.name}`})}buildImageAnalysisPrompt(e){return`Analyze this inventory item image: ${e}. 
    Please provide:
    1. Object recognition with confidence scores
    2. Item classification and category
    3. Quality assessment
    4. Damage detection if any
    5. Recommendations for inventory management`}buildForecastingPrompt(e,t){return`Based on the following historical inventory data: ${e}
    Generate a ${t} demand forecast including:
    1. Predicted demand quantity
    2. Confidence intervals
    3. Seasonal factors
    4. Trend analysis
    5. Influencing factors
    6. Recommendations`}buildOptimizationPrompt(e,t){return`Analyze the following cost data: ${e}
    Provide ${t} optimization including:
    1. Current vs optimized costs
    2. Cost savings and ROI
    3. Optimization factors
    4. Recommended actions
    5. Implementation timeline
    6. Risk assessment`}buildCategorizationPrompt(e,t){return`Categorize this ${t} input: ${e}
    Please provide:
    1. Suggested category and subcategory
    2. Confidence scores
    3. Alternative categories
    4. Reasoning for categorization
    5. Form fill suggestions
    6. Workflow recommendations`}executeWithRetry(e,t=3,n=100){return Tt(this,null,function*(){const{OptimizedRetryService:a}=yield q(()=>import("./login-CtXU169Q.js").then(i=>i.co),__vite__mapDeps([1,2,3,4,5]));return yield a.executeWithRetry(e,{maxRetries:t,baseDelay:n,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return Tt(this,null,function*(){const n=new Promise((a,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,n])})}selectModelForTask(e){switch(e){case"image":return"gpt-4-vision-preview";case"forecast":return"gpt-4";case"optimization":return"gpt-4";case"categorization":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:Xs.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:Xs.GOOGLE_VISION_API_BASE_URL||"https://vision.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro-vision"},azure:{baseUrl:Xs.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:Xs.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}processPredictiveAnalyticsWithAI(){return Tt(this,null,function*(){const e=[{itemId:"item-001",itemName:"Surgical Masks",predictedDemand:Math.floor(Math.random()*1e3)+500,confidence:.85+Math.random()*.1,timeframe:"30 days",factors:["seasonal flu season","increased procedures","historical usage patterns"]},{itemId:"item-002",itemName:"Gloves",predictedDemand:Math.floor(Math.random()*2e3)+1e3,confidence:.78+Math.random()*.15,timeframe:"30 days",factors:["standard usage","procedure volume","safety protocols"]}],t=[{itemId:"item-003",itemName:"Antibiotics",riskLevel:"high",probability:.75,estimatedStockoutDate:new Date(Date.now()+360*60*60*1e3).toISOString(),recommendedAction:"Increase order quantity and expedite delivery"},{itemId:"item-004",itemName:"IV Supplies",riskLevel:"medium",probability:.45,estimatedStockoutDate:new Date(Date.now()+720*60*60*1e3).toISOString(),recommendedAction:"Monitor usage and adjust reorder points"}],n=[{equipmentId:"equip-001",equipmentName:"Autoclave Unit A",predictedIssue:"Heating element degradation",estimatedFailureDate:new Date(Date.now()+1080*60*60*1e3).toISOString(),confidence:.82,recommendedMaintenance:"Schedule preventive maintenance within 2 weeks"}];return{demandForecast:e,stockoutRisk:t,maintenancePredictions:n,costTrends:[{category:"Medical Supplies",currentCost:15e3,predictedCost:16200,trend:"increasing",confidence:.79,factors:["inflation","supply chain issues","increased demand"]},{category:"Equipment",currentCost:8e3,predictedCost:7800,trend:"decreasing",confidence:.68,factors:["bulk purchasing","vendor negotiations","efficiency improvements"]}],seasonalPatterns:[{category:"Respiratory Supplies",pattern:"Winter peak, summer low",peakSeason:"December - February",lowSeason:"June - August",confidence:.91,recommendations:["Stock up in summer for winter demand","Negotiate seasonal pricing"]},{category:"Surgical Supplies",pattern:"Consistent year-round",peakSeason:"N/A",lowSeason:"N/A",confidence:.95,recommendations:["Maintain steady inventory levels","Focus on cost optimization"]}]}})}}const p0={ai_enabled:!1,ai_version:"1.0.0",computer_vision_enabled:!1,barcode_scanning_enabled:!1,image_recognition_enabled:!1,quality_assessment_enabled:!1,damage_detection_enabled:!1,inventory_counting_enabled:!1,predictive_analytics_enabled:!1,demand_forecasting_enabled:!1,maintenance_prediction_enabled:!1,cost_optimization_enabled:!1,seasonal_analysis_enabled:!1,cycle_optimization_enabled:!1,smart_categorization_enabled:!1,auto_classification_enabled:!1,smart_form_filling_enabled:!1,intelligent_workflow_enabled:!1,quality_assurance_enabled:!1,compliance_monitoring_enabled:!1,audit_trail_enhancement_enabled:!1,risk_assessment_enabled:!1,scanner_intelligence_enabled:!1,multi_format_barcode_support:!1,smart_validation_enabled:!1,error_prevention_enabled:!1,real_time_monitoring_enabled:!1,anomaly_detection_enabled:!1,predictive_maintenance_enabled:!1,smart_notifications_enabled:!1,ai_confidence_threshold:.85,ai_data_retention_days:90,real_time_processing_enabled:!1,data_sharing_enabled:!1,local_ai_processing_enabled:!1,encrypted_data_transmission:!0,ai_model_training:!1,auto_optimization_enabled:!1,performance_monitoring:!1,resource_optimization:!1},pa=.85,f0=2160*60*60*1e3,g0=365*24*60*60*1e3,y0="30_days",v0=10,x0=5,b0="maintenance-1",_0=[{month:"Jan",cost:1e3,trend:"stable"},{month:"Feb",cost:1200,trend:"increasing"}],Mu="Uncategorized",Di="Unknown",w0="Unknown Equipment",ns={csv:"text/csv",excel:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf",json:"application/json",default:"text/plain"},S0="good",C0="good",j0=["Increase inventory levels for low stock items.","Review maintenance schedules."],N0="low";var ll=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class I0{constructor(e){this.facilityId=e,this.analyticsService=new Ei(e),this.forecastingService=new h0(e),this.providerService=new ki(e)}generateDemandForecast(e,t){return ll(this,null,function*(){try{const n=yield this.analyticsService.getHistoricalInventoryData(),a=yield this.forecastingService.generateDemandForecast(e,t,n),{data:i,error:c}=yield _.from("inventory_ai_demand_forecasting").insert(a).select().single();return c?(console.error("Error saving demand forecast:",c),null):i}catch(n){return console.error("Error generating demand forecast:",n),null}})}getPredictiveAnalytics(){return ll(this,null,function*(){try{const e=Date.now(),{data:t,error:n}=yield at.getInventoryTransactionsByFacility(this.facilityId);if(n)return console.error("Error getting inventory transactions:",n),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};const a=new Date(Date.now()-f0);(t||[]).filter(x=>x.created_at&&new Date(x.created_at)>=a).sort((x,b)=>new Date(b.created_at||"").getTime()-new Date(x.created_at||"").getTime());const{data:c,error:l}=yield at.getEquipmentMaintenanceByFacility(this.facilityId);if(l)return console.error("Error getting equipment maintenance:",l),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};const o=new Date(Date.now()-g0);(c||[]).filter(x=>x.created_at&&new Date(x.created_at)>=o).sort((x,b)=>new Date(b.created_at||"").getTime()-new Date(x.created_at||"").getTime());const{data:u,error:h}=yield at.getInventoryCostsByFacility(this.facilityId);if(h)return console.error("Error getting inventory costs:",h),{demandForecast:[],stockoutRisk:[],maintenancePredictions:[],costTrends:[],seasonalPatterns:[]};(u||[]).filter(x=>x.created_at&&new Date(x.created_at)>=o).sort((x,b)=>new Date(b.created_at||"").getTime()-new Date(x.created_at||"").getTime());const f=yield this.providerService.processPredictiveAnalyticsWithAI(),y=Date.now()-e,{error:g}=yield _.from("inventory_ai_predictive_analytics").insert({facility_id:this.facilityId,predictions_data:f,processing_time_ms:y,generated_at:new Date().toISOString()});return g&&console.error("Error saving predictive analytics:",g),f}catch(e){throw console.error("Error generating predictive analytics:",e),e}})}}var cl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class T0{constructor(e){this.facilityId=e,this.providerService=new ki(e)}generateCostOptimization(e){return cl(this,null,function*(){try{const t=Date.now(),n=yield this.providerService.generateOptimizationWithAI(),a=Date.now()-t,i={facility_id:this.facilityId,optimization_type:e,current_cost:n.current_cost,optimized_cost:n.optimized_cost,cost_savings:n.cost_savings,savings_percentage:n.savings_percentage,optimization_factors:n.optimization_factors,recommended_actions:n.recommended_actions,implementation_timeline:n.implementation_timeline,risk_assessment:n.risk_assessment,confidence_score:n.confidence_score,processing_time_ms:a,data_analysis_period:y0,roi_estimate:n.roi_estimate},{data:c,error:l}=yield _.from("inventory_ai_cost_optimization").insert(i).select().single();return l?(console.error("Error saving cost optimization:",l),null):c}catch(t){return console.error("Error generating cost optimization:",t),null}})}categorizeItem(e,t){return cl(this,null,function*(){try{const n=Date.now(),a=yield this.providerService.processCategorizationWithAI(),i=Date.now()-n,c={facility_id:this.facilityId,suggested_category:a.suggested_category,suggested_subcategory:a.suggested_subcategory,category_confidence_score:a.category_confidence_score,alternative_categories:a.alternative_categories,categorization_reasoning:a.categorization_reasoning,form_fill_suggestions:a.form_fill_suggestions,workflow_recommendations:a.workflow_recommendations,confidence_score:a.confidence_score,processing_time_ms:i,input_data_type:t,learning_feedback:!1,user_acceptance:void 0},{data:l,error:o}=yield _.from("inventory_ai_smart_categorization").insert(c).select().single();return o?(console.error("Error saving smart categorization:",o),null):l}catch(n){return console.error("Error categorizing item:",n),null}})}}var dl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class E0{constructor(e){this.facilityId=e,this.analyticsService=new Ei(e),this.providerService=new ki(e)}analyzeBarcode(e,t){return dl(this,null,function*(){try{const n=Date.now(),a=yield this.providerService.processImageWithAI(),i=Date.now()-n,c={facility_id:this.facilityId,barcode_value:t,barcode_type:this.analyticsService.detectBarcodeType(t),quality_rating:this.analyticsService.assessBarcodeQuality(a.confidence),readability_score:a.confidence||pa,damage_detected:a.damage_detected||!1,damage_types:a.damage_types||[],confidence_score:a.confidence||pa,processing_time_ms:i,image_file_path:yield this.providerService.uploadImage(e),ai_insights:a,recommendations:a.recommendations||[]},{data:l,error:o}=yield _.from("inventory_ai_barcode_analysis").insert(c).select().single();return o?(console.error("Error saving barcode analysis:",o),null):l}catch(n){return console.error("Error analyzing barcode:",n),null}})}analyzeImage(e){return dl(this,null,function*(){try{const t=Date.now(),n=yield this.providerService.processImageWithAI(),a=Date.now()-t,i={facility_id:this.facilityId,recognized_objects:n.objects||[],object_confidence_scores:n.confidence_scores||[],item_classification:n.classification,category_suggestion:n.category,quality_assessment:n.quality||S0,damage_detected:n.damage_detected||!1,damage_description:n.damage_description||void 0,condition_rating:n.condition||C0,confidence_score:n.confidence||pa,processing_time_ms:a,image_file_path:yield this.providerService.uploadImage(e),ai_insights:n,recommendations:n.recommendations||[]},{data:c,error:l}=yield _.from("inventory_ai_image_recognition").insert(i).select().single();return l?(console.error("Error saving image recognition:",l),null):c}catch(t){return console.error("Error analyzing image:",t),null}})}}function k0(s){return s.reduce((e,t)=>{const n=t.category||Mu;return e[n]||(e[n]=0),e[n]=e[n]+1,e},{})}function D0(s){return s.reduce((e,t)=>{const n=t.category||Mu;return e[n]=(e[n]||0)+(t.amount||0),e},{})}function P0(s){return s.reduce((e,t)=>{const n=t.type||Di;return e[n]=(e[n]||0)+1,e},{})}function R0(s){return s.filter(e=>{var t;return(e.quantity||0)<(((t=e.data)==null?void 0:t.min_quantity)||0)}).map(e=>{var t;return{id:e.id||"",name:e.name||"",current_stock:e.quantity||0,reorder_point:((t=e.data)==null?void 0:t.min_quantity)||0}})}function A0(s){return s.sort((e,t)=>(t.value||0)-(e.value||0)).slice(0,v0).map(e=>({id:e.id||"",name:e.name||"",value:e.value||0,category:e.category||Di}))}function O0(s){return s.slice(0,x0).map(e=>({id:b0,equipment_name:e.equipment_name||w0,due_date:e.due_date||new Date().toISOString(),type:e.type||Di}))}function $0(s){return s.reduce((e,t)=>e+(t.amount||0),0)}function M0(){return _0}function F0(s){return{totalValue:s.totalItems,riskLevel:N0,recommendations:j0}}function z0(s){if(Array.isArray(s)){const e=Object.keys(s[0]||{}),t=[e.join(",")];for(const n of s){const a=e.map(i=>JSON.stringify(n[i]||""));t.push(a.join(","))}return t.join(`
`)}return JSON.stringify(s)}function L0(s){switch(s){case"csv":return ns.csv;case"excel":return ns.excel;case"pdf":return ns.pdf;case"json":return ns.json;default:return ns.default}}var qt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class B0{constructor(e){this.facilityId=e}exportAnalyticsReport(e,t,n){return qt(this,null,function*(){try{const a=Date.now();let i={};switch(e){case"inventory":i=yield this.generateInventoryReport();break;case"predictive":i={};break;case"cost":i=yield this.generateCostReport();break;case"maintenance":i=yield this.generateMaintenanceReport();break;case"comprehensive":i=yield this.generateComprehensiveReport();break}const c=yield this.formatReportData(i,t),{error:l}=yield _.from("inventory_ai_exports").insert({facility_id:this.facilityId,report_type:e,export_format:t,date_range:n,processing_time_ms:Date.now()-a,exported_at:new Date().toISOString()});return l&&console.error("Error saving export record:",l),{success:!0,data:c,downloadUrl:yield this.generateDownloadUrl(c,t)}}catch(a){return console.error("Error exporting analytics report:",a),{success:!1,error:a instanceof Error?a.message:"Export failed"}}})}generateInventoryReport(){return qt(this,null,function*(){const t=(yield at.getItems()).filter(n=>n.facility_id===this.facilityId);return{totalItems:(t==null?void 0:t.length)||0,categories:k0(t||[]),lowStockItems:R0(t||[]),highValueItems:A0(t||[])}})}generateCostReport(){return qt(this,null,function*(){const{data:e,error:t}=yield at.getInventoryCostsByFacility(this.facilityId);return t?(console.error("Error getting inventory costs for cost report:",t),{totalCosts:0,costByCategory:{},costTrends:[]}):{totalCosts:$0(e||[]),costByCategory:D0(e||[]),costTrends:M0()}})}generateMaintenanceReport(){return qt(this,null,function*(){const{data:e,error:t}=yield at.getEquipmentMaintenanceByFacility(this.facilityId);return t?(console.error("Error getting equipment maintenance for maintenance report:",t),{totalMaintenance:0,maintenanceByType:{},upcomingMaintenance:[]}):{totalMaintenance:(e==null?void 0:e.length)||0,maintenanceByType:P0(e||[]),upcomingMaintenance:O0(e||[])}})}generateComprehensiveReport(){return qt(this,null,function*(){const[e,t,n]=yield Promise.all([this.generateInventoryReport(),this.generateCostReport(),this.generateMaintenanceReport()]);return{inventory:e,predictive:{},cost:t,maintenance:n,summary:F0(e)}})}formatReportData(e,t){return qt(this,null,function*(){switch(t){case"json":return JSON.stringify(e,null,2);case"csv":return z0(e);case"excel":return e;case"pdf":return e;default:return e}})}generateDownloadUrl(e,t){return qt(this,null,function*(){const n=new Blob([JSON.stringify(e)],{type:L0(t)});return URL.createObjectURL(n)})}}var q0=Object.defineProperty,U0=Object.defineProperties,H0=Object.getOwnPropertyDescriptors,ul=Object.getOwnPropertySymbols,V0=Object.prototype.hasOwnProperty,W0=Object.prototype.propertyIsEnumerable,ml=(s,e,t)=>e in s?q0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,G0=(s,e)=>{for(var t in e||(e={}))V0.call(e,t)&&ml(s,t,e[t]);if(ul)for(var t of ul(e))W0.call(e,t)&&ml(s,t,e[t]);return s},K0=(s,e)=>U0(s,H0(e)),fa=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Q0{constructor(e){this.facilityId=e}loadSettings(){return fa(this,null,function*(){try{const{data:e,error:t}=yield _.from("inventory_ai_settings").select("*").eq("facility_id",this.facilityId).single();return t?(console.error("Error loading AI settings:",t),null):e}catch(e){return console.error("Error loading AI settings:",e),null}})}saveSettings(e){return fa(this,null,function*(){try{const{error:t}=yield _.from("inventory_ai_settings").upsert(K0(G0({facility_id:this.facilityId},e),{updated_at:new Date().toISOString()}));return t?(console.error("Error saving AI settings:",t),!1):!0}catch(t){return console.error("Error saving AI settings:",t),!1}})}initializeSettings(){return fa(this,null,function*(){try{const e=p0;return yield this.saveSettings(e)}catch(e){return console.error("Error initializing AI settings:",e),!1}})}}var Ge=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Y0{constructor(e){this.facilityId=e,this.analyticsService=new Ei(e),this.forecastingService=new I0(e),this.optimizationService=new T0(e),this.riskAnalysisService=new E0(e),this.costAnalyticsService=new B0(e),this.supabaseProvider=new Q0(e)}getInventoryInsights(){return Ge(this,null,function*(){return this.analyticsService.getInventoryInsights()})}loadSettings(){return Ge(this,null,function*(){return yield this.supabaseProvider.loadSettings()})}saveSettings(e){return Ge(this,null,function*(){return yield this.supabaseProvider.saveSettings(e)})}initializeSettings(){return Ge(this,null,function*(){return yield this.supabaseProvider.initializeSettings()})}analyzeBarcode(e,t){return Ge(this,null,function*(){try{const n=yield this.loadSettings();if(!(n!=null&&n.barcode_scanning_enabled))throw new Error("Barcode scanning AI is not enabled");return yield this.riskAnalysisService.analyzeBarcode(e,t)}catch(n){return console.error("Error analyzing barcode:",n),null}})}analyzeImage(e){return Ge(this,null,function*(){try{const t=yield this.loadSettings();if(!(t!=null&&t.image_recognition_enabled))throw new Error("Image recognition AI is not enabled");return yield this.riskAnalysisService.analyzeImage(e)}catch(t){return console.error("Error analyzing image:",t),null}})}generateDemandForecast(e,t){return Ge(this,null,function*(){try{const n=yield this.loadSettings();if(!(n!=null&&n.demand_forecasting_enabled))throw new Error("Demand forecasting AI is not enabled");return yield this.forecastingService.generateDemandForecast(e,t)}catch(n){return console.error("Error generating demand forecast:",n),null}})}generateCostOptimization(e){return Ge(this,null,function*(){try{const t=yield this.loadSettings();if(!(t!=null&&t.cost_optimization_enabled))throw new Error("Cost optimization AI is not enabled");return yield this.optimizationService.generateCostOptimization(e)}catch(t){return console.error("Error generating cost optimization:",t),null}})}categorizeItem(e,t){return Ge(this,null,function*(){try{const n=yield this.loadSettings();if(!(n!=null&&n.smart_categorization_enabled))throw new Error("Smart categorization AI is not enabled");return yield this.optimizationService.categorizeItem(e,t)}catch(n){return console.error("Error categorizing item:",n),null}})}getPredictiveAnalytics(){return Ge(this,null,function*(){try{const e=yield this.loadSettings();if(!(e!=null&&e.predictive_analytics_enabled))throw new Error("Predictive analytics AI is not enabled");return yield this.forecastingService.getPredictiveAnalytics()}catch(e){throw console.error("Error generating predictive analytics:",e),e}})}exportAnalyticsReport(e,t,n){return Ge(this,null,function*(){try{const a=yield this.loadSettings();if(!(a!=null&&a.predictive_analytics_enabled))throw new Error("Analytics export is not enabled");return yield this.costAnalyticsService.exportAnalyticsReport(e,t,n)}catch(a){return console.error("Error exporting analytics report:",a),{success:!1,error:a instanceof Error?a.message:"Export failed"}}})}}var J0=Object.defineProperty,X0=Object.defineProperties,Z0=Object.getOwnPropertyDescriptors,hl=Object.getOwnPropertySymbols,ev=Object.prototype.hasOwnProperty,tv=Object.prototype.propertyIsEnumerable,pl=(s,e,t)=>e in s?J0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,rv=(s,e)=>{for(var t in e||(e={}))ev.call(e,t)&&pl(s,t,e[t]);if(hl)for(var t of hl(e))tv.call(e,t)&&pl(s,t,e[t]);return s},sv=(s,e)=>X0(s,Z0(e)),fl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class nv{constructor(e){this.settings=null,this.facilityId=e}loadSettings(){return fl(this,null,function*(){try{const{data:e,error:t}=yield _.from("sterilization_ai_settings").select("*").eq("facility_id",this.facilityId).single();return t?(console.error("Error loading AI settings:",t),null):(this.settings=e,e)}catch(e){return console.error("Error loading AI settings:",e),null}})}saveSettings(e){return fl(this,null,function*(){try{const t=sv(rv({},e),{facility_id:this.facilityId,updated_at:new Date().toISOString()}),{error:n}=yield _.from("sterilization_ai_settings").upsert(t,{onConflict:"facility_id"});return n?(console.error("Error saving AI settings:",n),!1):(yield this.loadSettings(),!0)}catch(t){return console.error("Error saving AI settings:",t),!1}})}isFeatureEnabled(e){var t;return(t=this.settings)!=null&&t.ai_enabled?this.settings[e]===!0:!1}getCurrentSettings(){return this.settings}getOpenAIKey(){var e;return((e=this.settings)==null?void 0:e.openai_api_key_encrypted)||ei("VITE_OPENAI_API_KEY")}isComputerVisionEnabled(){return this.isFeatureEnabled("computer_vision_enabled")}isToolConditionAssessmentEnabled(){return this.isFeatureEnabled("tool_condition_assessment")}isBarcodeQualityDetectionEnabled(){return this.isFeatureEnabled("barcode_quality_detection")}isToolTypeRecognitionEnabled(){return this.isFeatureEnabled("tool_type_recognition")}isPredictiveAnalyticsEnabled(){return this.isFeatureEnabled("predictive_analytics_enabled")}isCycleOptimizationEnabled(){return this.isFeatureEnabled("cycle_optimization")}isIntelligentWorkflowSelectionEnabled(){return this.isFeatureEnabled("intelligent_workflow_selection")}isAutomatedProblemDetectionEnabled(){return this.isFeatureEnabled("automated_problem_detection")}isRealTimeMonitoringEnabled(){return this.isFeatureEnabled("real_time_monitoring_enabled")}isComplianceMonitoringEnabled(){return this.isFeatureEnabled("compliance_monitoring")}isBiologicalIndicatorAnalysisEnabled(){return this.isFeatureEnabled("biological_indicator_analysis")}getConfidenceThreshold(){var e;return((e=this.settings)==null?void 0:e.ai_confidence_threshold)||.8}getDataRetentionDays(){var e;return((e=this.settings)==null?void 0:e.ai_data_retention_days)||365}}function av(){try{const s=localStorage.getItem("currentUser");if(s){const e=JSON.parse(s);return(e==null?void 0:e.id)||null}return null}catch(s){return console.warn("Failed to get user ID from storage:",s),null}}function st(s){const e=av();return e||s||null}var gl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class J{static callOpenAI(e,t){return gl(this,null,function*(){var n,a;if(!t)throw new Error("OpenAI API key not configured");try{const i=yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are a healthcare AI specialist for Cliniio, specializing in sterilization facility management, medical instrument analysis, and compliance workflows. Provide accurate, actionable insights based on the data provided."},{role:"user",content:e}],temperature:.3,max_tokens:1e3})});if(!i.ok)throw new Error(`OpenAI API error: ${i.status} ${i.statusText}`);return((a=(n=(yield i.json()).choices[0])==null?void 0:n.message)==null?void 0:a.content)||"AI analysis completed but no response received"}catch(i){throw console.error("OpenAI API call failed:",i),new Error("AI analysis failed")}})}static testConnection(e){return gl(this,null,function*(){try{return{success:!0,response:yield this.callOpenAI("Hello! This is a test message from Cliniio sterilization AI service. Please respond with a brief confirmation that you are working.",e)}}catch(t){return{success:!1,response:"",error:t instanceof Error?t.message:"Unknown error"}}})}static parseConditionFromAI(e){return e.includes("excellent")||e.includes("perfect")?"excellent":e.includes("good")||e.includes("acceptable")?"good":e.includes("fair")||e.includes("adequate")?"fair":e.includes("poor")||e.includes("unacceptable")?"poor":e.includes("damaged")||e.includes("broken")?"damaged":"good"}static parseWearLevelFromAI(e){return e.includes("minimal")||e.includes("new")?"minimal":e.includes("moderate")||e.includes("normal")?"moderate":e.includes("significant")||e.includes("worn")?"significant":e.includes("critical")||e.includes("severe")?"critical":"moderate"}static parseCleaningQualityFromAI(e){return e.includes("excellent")||e.includes("clean")?"excellent":e.includes("good")||e.includes("acceptable")?"good":e.includes("fair")||e.includes("adequate")?"fair":e.includes("poor")||e.includes("dirty")?"poor":"good"}static parseDamageFromAI(e){return e.includes("damage")||e.includes("broken")||e.includes("cracked")}static parseDamageTypesFromAI(e){const t=[];return e.includes("crack")&&t.push("crack"),e.includes("scratch")&&t.push("scratch"),e.includes("rust")&&t.push("rust"),e.includes("bend")&&t.push("bent"),t}static parseBarcodeQualityFromAI(e){return e.includes("excellent")||e.includes("clear")?"excellent":e.includes("good")||e.includes("readable")?"good":e.includes("fair")||e.includes("acceptable")?"fair":e.includes("poor")||e.includes("unreadable")?"poor":"good"}static parseToolTypeFromAI(e){return e.includes("handpiece")?"Dental Handpiece":e.includes("scalpel")?"Surgical Scalpel":e.includes("forceps")?"Surgical Forceps":e.includes("scissors")?"Surgical Scissors":"Medical Instrument"}static parseToolCategoryFromAI(e){return e.includes("dental")?"Dental Instruments":e.includes("surgical")?"Surgical Instruments":e.includes("ophthalmic")?"Ophthalmic Instruments":"General Medical Instruments"}static parseRiskLevel(e){return e.includes("high")||e.includes("critical")?"high":e.includes("medium")||e.includes("moderate")?"medium":"low"}static parseComplianceScore(e){return e.includes("excellent")||e.includes("100%")?.95:e.includes("good")||e.includes("90%")?.9:e.includes("fair")||e.includes("80%")?.8:.75}static generateRecommendations(e){const t=[];return e.includes("clean")&&t.push("Ensure thorough cleaning before sterilization"),e.includes("inspect")&&t.push("Perform detailed visual inspection"),e.includes("maintenance")&&t.push("Schedule maintenance check"),t.length===0&&t.push("Tool appears in good condition"),t}static generateBarcodeRecommendations(e){const t=[];return e.includes("poor")&&t.push("Replace barcode label"),e.includes("fair")&&t.push("Clean barcode surface"),e.includes("good")&&t.push("Monitor for degradation"),t}static generateToolSuggestions(e){const t=[];return e.includes("high-speed")&&t.push("High-speed handpiece - requires special sterilization cycle"),e.includes("delicate")&&t.push("Delicate instrument - handle with care"),e.includes("sharp")&&t.push("Sharp instrument - use protective packaging"),t}static parseOptimizationSuggestions(e){const t=[];return e.includes("temperature")&&t.push("Optimize temperature settings"),e.includes("duration")&&t.push("Adjust cycle duration"),e.includes("grouping")&&t.push("Improve tool grouping"),t.length===0&&t.push("Review cycle parameters"),t}static parseRecommendedParameters(e){const t={};return e.includes("temperature")&&(t.temperature=134),e.includes("duration")&&(t.duration=20),e.includes("pressure")&&(t.pressure=30),t}static parseRecommendedWorkflow(e){return e.includes("clean")?"clean":e.includes("dirty")?"dirty":e.includes("problem")?"problem":e.includes("packaging")?"packaging":"dirty"}static parseWorkflowReasoning(){return["Tool condition assessment completed","Historical usage patterns analyzed","Sterilization requirements verified"]}static parseAlternativeWorkflows(){return[{workflow:"clean",confidence:.75,reasoning:"Alternative cleaning approach"}]}static parseIssues(e){const t=[];return e.includes("wear")&&t.push("Tool wear detected"),e.includes("damage")&&t.push("Potential damage"),e.includes("maintenance")&&t.push("Maintenance needed"),t}static parseRiskFactors(e){const t=[];return e.includes("temperature")&&t.push("Temperature variations"),e.includes("pressure")&&t.push("Pressure fluctuations"),e.includes("time")&&t.push("Timing issues"),t}static parseRequiredActions(e){const t=[];return e.includes("document")&&t.push("Document variations"),e.includes("investigate")&&t.push("Investigate causes"),e.includes("correct")&&t.push("Correct procedures"),t}static parseAuditRecommendations(e){const t=[];return e.includes("review")&&t.push("Review procedures"),e.includes("monitor")&&t.push("Monitor parameters"),e.includes("train")&&t.push("Staff training"),t}static parseBIValidation(e){return e.includes("pass")||e.includes("success")?!0:(e.includes("fail")||e.includes("failure"),!1)}}var iv=Object.defineProperty,ov=Object.defineProperties,lv=Object.getOwnPropertyDescriptors,yl=Object.getOwnPropertySymbols,cv=Object.prototype.hasOwnProperty,dv=Object.prototype.propertyIsEnumerable,vl=(s,e,t)=>e in s?iv(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,uv=(s,e)=>{for(var t in e||(e={}))cv.call(e,t)&&vl(s,t,e[t]);if(yl)for(var t of yl(e))dv.call(e,t)&&vl(s,t,e[t]);return s},mv=(s,e)=>ov(s,lv(e)),Ut=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class hv{constructor(e){this.facilityId=e}recordMetric(e){return Ut(this,null,function*(){try{const t=mv(uv({facility_id:this.facilityId},e),{created_at:new Date().toISOString()}),{data:n,error:a}=yield _.from("ai_performance_metrics").insert(t).select("id").single();return a?(console.error("Error recording performance metric:",a),null):n.id}catch(t){return console.error("Error recording performance metric:",t),null}})}getPerformanceSummary(e="day",t){return Ut(this,null,function*(){try{const n=this.getStartDate(e);let a=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",n.toISOString());t&&(a=a.eq("service_name",t));const{data:i,error:c}=yield a;return c?(console.error("Error fetching performance metrics:",c),this.getDefaultPerformanceSummary()):this.calculatePerformanceSummary(i||[])}catch(n){return console.error("Error getting performance summary:",n),this.getDefaultPerformanceSummary()}})}getServicePerformance(e="day"){return Ut(this,null,function*(){try{const t=this.getStartDate(e),{data:n,error:a}=yield _.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",t.toISOString());return a?(console.error("Error fetching service performance:",a),[]):this.calculateServicePerformance(n||[])}catch(t){return console.error("Error getting service performance:",t),[]}})}getDetailedMetrics(e){return Ut(this,null,function*(){try{const t=this.getStartDate(e.timeRange||"day");let n=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",t.toISOString()).order("created_at",{ascending:!1});e.serviceName&&(n=n.eq("service_name",e.serviceName)),e.operationName&&(n=n.eq("operation_name",e.operationName)),e.success!==void 0&&(n=n.eq("success",e.success)),e.limit&&(n=n.limit(e.limit));const{data:a,error:i}=yield n;return i?(console.error("Error fetching detailed metrics:",i),[]):a}catch(t){return console.error("Error getting detailed metrics:",t),[]}})}getPerformanceTrends(e="month",t){return Ut(this,null,function*(){try{const n=this.getStartDate(e),a=this.getInterval(e);let i=_.from("ai_performance_metrics").select("*").eq("facility_id",this.facilityId).gte("created_at",n.toISOString()).order("created_at",{ascending:!0});t&&(i=i.eq("service_name",t));const{data:c,error:l}=yield i;return l?(console.error("Error fetching performance trends:",l),{dates:[],processingTimes:[],successRates:[],operationCounts:[]}):this.calculateTrends(c||[],a)}catch(n){return console.error("Error getting performance trends:",n),{dates:[],processingTimes:[],successRates:[],operationCounts:[]}}})}getOptimizationRecommendations(){return Ut(this,null,function*(){try{const e=yield this.getPerformanceSummary("week"),t=[];return e.averageProcessingTime>5e3&&t.push("Consider optimizing AI model selection or reducing input complexity"),e.p95ProcessingTime>1e4&&t.push("Investigate performance bottlenecks in AI service calls"),e.successRate<.9&&t.push("Review error patterns and improve error handling"),e.errorRate>.1&&t.push("Implement retry mechanisms and fallback strategies"),e.performanceTrend==="degrading"&&t.push("Monitor system resources and consider scaling AI services"),t.length===0&&t.push("Performance is within acceptable ranges - continue monitoring"),t}catch(e){return console.error("Error getting optimization recommendations:",e),["Unable to generate recommendations at this time"]}})}cleanupOldMetrics(e=90){return Ut(this,null,function*(){try{const t=new Date(Date.now()-e*24*60*60*1e3),{data:n,error:a}=yield _.from("ai_performance_metrics").delete().lt("created_at",t.toISOString()).eq("facility_id",this.facilityId).select("id");return a?(console.error("Error cleaning up old metrics:",a),0):(n==null?void 0:n.length)||0}catch(t){return console.error("Error cleaning up old metrics:",t),0}})}getStartDate(e){const t=new Date;switch(e){case"hour":return new Date(t.getTime()-3600*1e3);case"day":return new Date(t.getTime()-1440*60*1e3);case"week":return new Date(t.getTime()-10080*60*1e3);case"month":return new Date(t.getTime()-720*60*60*1e3);case"quarter":return new Date(t.getTime()-2160*60*60*1e3);default:return new Date(t.getTime()-1440*60*1e3)}}getInterval(e){switch(e){case"week":return 1440*60*1e3;case"month":return 1440*60*1e3;case"quarter":return 10080*60*1e3;default:return 1440*60*1e3}}calculatePerformanceSummary(e){if(e.length===0)return this.getDefaultPerformanceSummary();const t=e.map(g=>g.processing_time_ms).filter(g=>g>0),n=e.filter(g=>g.success),a=e.filter(g=>!g.success),i=t.sort((g,x)=>g-x),c=e.length,l=n.length/c,o=t.reduce((g,x)=>g+x,0)/t.length,d=i[Math.floor(i.length/2)],u=i[Math.floor(i.length*.95)],h=i[Math.floor(i.length*.99)],p=e.slice(-10),f=p.reduce((g,x)=>g+x.processing_time_ms,0)/p.length,y=f<o*.9?"improving":f>o*1.1?"degrading":"stable";return{totalOperations:c,successRate:l,averageProcessingTime:o,medianProcessingTime:d,p95ProcessingTime:u,p99ProcessingTime:h,totalErrors:a.length,errorRate:a.length/c,performanceTrend:y,recommendations:this.generateRecommendations(e)}}calculateServicePerformance(e){const t=new Map;return e.forEach(n=>{t.has(n.service_name)||t.set(n.service_name,[]),t.get(n.service_name).push(n)}),Array.from(t.entries()).map(([n,a])=>{var i;const c=a.map(g=>g.processing_time_ms).filter(g=>g>0),l=a.filter(g=>g.success),o=((i=a[0])==null?void 0:i.created_at)||"",d=a.length,u=l.length/d,h=c.length>0?c.reduce((g,x)=>g+x,0)/c.length:0,p=Math.max(0,100-h/100),f=u*100,y=Math.round((p+f)/2);return{serviceName:n,operationCount:d,successRate:u,averageTime:h,totalErrors:a.filter(g=>!g.success).length,lastOperation:o,performanceScore:y}}).sort((n,a)=>a.performanceScore-n.performanceScore)}calculateTrends(e,t){const n=new Date,a=new Map;for(let c=0;c<10;c++){const o=new Date(n.getTime()-c*t).toISOString().split("T")[0];a.set(o,{times:[],success:0,total:0})}e.forEach(c=>{const l=new Date(c.created_at).toISOString().split("T")[0],o=a.get(l);o&&(o.times.push(c.processing_time_ms),o.total++,c.success&&o.success++)});const i=Array.from(a.entries()).sort(([c],[l])=>c.localeCompare(l));return{dates:i.map(([c])=>c),processingTimes:i.map(([,c])=>c.times.length>0?c.times.reduce((l,o)=>l+o,0)/c.times.length:0),successRates:i.map(([,c])=>c.total>0?c.success/c.total:0),operationCounts:i.map(([,c])=>c.total)}}generateRecommendations(e){const t=[];if(e.length===0)return["No performance data available for recommendations"];const n=e.reduce((i,c)=>i+c.processing_time_ms,0)/e.length,a=e.filter(i=>i.success).length/e.length;return n>5e3&&t.push("Consider optimizing AI model selection for faster processing"),a<.9&&t.push("Review error patterns and implement better error handling"),t.length===0&&t.push("Performance is within acceptable ranges"),t}getDefaultPerformanceSummary(){return{totalOperations:0,successRate:0,averageProcessingTime:0,medianProcessingTime:0,p95ProcessingTime:0,p99ProcessingTime:0,totalErrors:0,errorRate:0,performanceTrend:"stable",recommendations:["No performance data available"]}}}var as=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class pv{constructor(e){this.analysisStartTime=0,this.facilityId=e,this.performanceMetrics=new hv(e)}analyzeToolCondition(e,t,n){return as(this,null,function*(){this.analysisStartTime=Date.now();try{let a;t?a=`Analyze medical instrument data for tool ID: ${e}. Provide general condition assessment, wear level estimation, cleaning quality recommendations, and damage detection guidance based on best practices for medical instrument sterilization.`:a=`Analyze medical instrument data for tool ID: ${e}. Provide general condition assessment, wear level estimation, cleaning quality recommendations, and damage detection guidance based on best practices for medical instrument sterilization.`;const i=yield J.callOpenAI(a,n||""),c={success:!0,toolId:e,condition:J.parseConditionFromAI(i),wearLevel:J.parseWearLevelFromAI(i),cleaningQuality:J.parseCleaningQualityFromAI(i),damageDetected:J.parseDamageFromAI(i),damageTypes:J.parseDamageTypesFromAI(i),confidence:.8,recommendations:J.generateRecommendations(i)},l=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"analyzeToolCondition",processing_time_ms:l,success:!0,input_size_bytes:(t==null?void 0:t.size)||0,ai_model_used:"gpt-4",confidence_score:c.confidence,user_id:st()||void 0}),yield this.saveToolAssessment(c),c}catch(a){const i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"analyzeToolCondition",processing_time_ms:i,success:!1,error_message:a instanceof Error?a.message:"Unknown error",user_id:st()||void 0}),console.error("Tool condition analysis failed:",a),{success:!1,condition:"good",wearLevel:"moderate",cleaningQuality:"good",damageDetected:!1,confidence:.5,recommendations:["Analysis failed - manual inspection recommended"],error:a instanceof Error?a.message:"Unknown error"}}})}detectBarcodeQuality(e,t){return as(this,null,function*(){this.analysisStartTime=Date.now();try{let n;e?n=yield J.callOpenAI("Provide general guidance on barcode quality assessment for medical instruments. Include best practices for barcode readability, common issues, and maintenance recommendations.",t||""):n=yield J.callOpenAI("Provide general guidance on barcode quality assessment for medical instruments. Include best practices for barcode readability, common issues, and maintenance recommendations.",t||"");const a=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectBarcodeQuality",processing_time_ms:a,success:!0,input_size_bytes:(e==null?void 0:e.size)||0,ai_model_used:"gpt-4",confidence_score:.9,user_id:st()||void 0}),{success:!0,quality:J.parseBarcodeQualityFromAI(n),confidence:.9,recommendations:J.generateBarcodeRecommendations(n)}}catch(n){const a=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectBarcodeQuality",processing_time_ms:a,success:!1,error_message:n instanceof Error?n.message:"Unknown error",user_id:st()||void 0}),console.error("Barcode quality detection failed:",n),{success:!1,quality:"fair",confidence:.5,recommendations:["Analysis failed - manual verification recommended"]}}})}identifyToolType(e,t){return as(this,null,function*(){this.analysisStartTime=Date.now();try{let n;return e?n=yield J.callOpenAI("Provide comprehensive guidance on medical instrument classification and sterilization requirements. Include common instrument types, categories, sterilization cycles, and best practices for healthcare facilities.",t||""):n=yield J.callOpenAI("Provide comprehensive guidance on medical instrument classification and sterilization requirements. Include common instrument types, categories, sterilization cycles, and best practices for healthcare facilities.",t||""),{success:!0,toolType:J.parseToolTypeFromAI(n),category:J.parseToolCategoryFromAI(n),confidence:.8,suggestions:J.generateToolSuggestions(n)}}catch(n){return console.error("Tool type identification failed:",n),{success:!1,confidence:.5,suggestions:["Identification failed - manual classification needed"]}}})}detectPotentialProblems(e,t,n){return as(this,null,function*(){this.analysisStartTime=Date.now();try{const a=yield J.callOpenAI(`Analyze tool data for potential problems: ${JSON.stringify(t)}. Identify risks and provide recommendations.`,n||""),i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectPotentialProblems",processing_time_ms:i,success:!0,ai_model_used:"gpt-4",confidence_score:.8,user_id:st()||void 0}),{success:!0,problemsDetected:a.includes("problem")||a.includes("risk"),riskLevel:J.parseRiskLevel(a),issues:J.parseIssues(a),recommendations:J.generateRecommendations(a)}}catch(a){const i=Date.now()-this.analysisStartTime;return yield this.performanceMetrics.recordMetric({service_name:"AnalysisServices",operation_name:"detectPotentialProblems",processing_time_ms:i,success:!1,error_message:a instanceof Error?a.message:"Unknown error",user_id:st()||void 0}),console.error("Problem detection failed:",a),{success:!1,problemsDetected:!1,riskLevel:"low",issues:[],recommendations:["Analysis failed - manual inspection recommended"]}}})}saveToolAssessment(e){return as(this,null,function*(){try{const t={facility_id:this.facilityId,tool_id:e.toolId,cycle_id:null,condition_rating:e.condition,wear_level:e.wearLevel,cleaning_quality:e.cleaningQuality,damage_detected:e.damageDetected,damage_types:e.damageTypes||[],confidence_score:e.confidence,model_id:null,processing_time_ms:Date.now()-this.analysisStartTime,image_file_path:null,ai_insights:{recommendations:e.recommendations},created_by:st()},{data:n,error:a}=yield _.from("sterilization_ai_tool_assessments").insert(t).select("id").single();return a?(console.error("Error saving tool assessment:",a),null):n.id}catch(t){return console.error("Error saving tool assessment:",t),null}})}}var Zs=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class fv{constructor(e){this.facilityId=e}getCycleOptimization(e,t){return Zs(this,null,function*(){try{const{data:n}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).eq("status","completed").order("created_at",{ascending:!1}).limit(100);if(!n||n.length===0)throw new Error("No historical cycle data available");const a=yield J.callOpenAI(`Analyze sterilization cycle data for optimization. Historical cycles: ${JSON.stringify(n)}. Provide efficiency improvements and parameter recommendations.`,t||""),i={cycleId:e,currentEfficiency:this.calculateCurrentEfficiency(n),predictedEfficiency:this.calculatePredictedEfficiency(n),optimizationSuggestions:J.parseOptimizationSuggestions(a),estimatedTimeSavings:this.calculateTimeSavings(),recommendedParameters:J.parseRecommendedParameters(a),confidence:.85};return yield this.saveCycleOptimization(i),i}catch(n){throw console.error("Cycle optimization failed:",n),new Error("Cycle optimization analysis failed")}})}getWorkflowSuggestion(e,t,n){return Zs(this,null,function*(){try{const{data:a}=yield _.from("tools").select("*").eq("id",e).eq("facility_id",this.facilityId).single();if(!a)throw new Error("Tool not found");const i=yield J.callOpenAI(`Recommend sterilization workflow for tool: ${JSON.stringify(a)}. History: ${JSON.stringify(t)}. Consider tool type, condition, and usage patterns.`,n||""),c={toolId:e,recommendedWorkflow:J.parseRecommendedWorkflow(i),confidence:this.calculateWorkflowConfidence(a,t),reasoning:J.parseWorkflowReasoning(),alternativeWorkflows:J.parseAlternativeWorkflows()};return yield this.saveWorkflowSuggestion(c),c}catch(a){throw console.error("Workflow suggestion failed:",a),new Error("Workflow suggestion failed")}})}calculateCurrentEfficiency(e){if(!e||e.length===0)return .75;const t=e.reduce((n,a)=>n+(a.duration_minutes||0),0)/e.length;return Math.max(.5,Math.min(1,1-(t-20)/100))}calculatePredictedEfficiency(e){const t=this.calculateCurrentEfficiency(e);return Math.min(1,t+.15)}calculateTimeSavings(){return Math.floor(Math.random()*15)+5}calculateWorkflowConfidence(e,t){let n=.5;return e.condition==="excellent"&&(n+=.2),t.usage_count<100&&(n+=.1),Math.min(n,.95)}saveCycleOptimization(e){return Zs(this,null,function*(){try{const t={facility_id:this.facilityId,cycle_id:e.cycleId,current_efficiency:e.currentEfficiency,predicted_efficiency:e.predictedEfficiency,estimated_time_savings:e.estimatedTimeSavings,recommended_parameters:e.recommendedParameters,confidence_score:e.confidence,model_id:null,processing_time_ms:0,optimization_factors:{},created_by:null};yield _.from("sterilization_ai_cycle_optimizations").insert(t)}catch(t){console.error("Error saving cycle optimization:",t)}})}saveWorkflowSuggestion(e){return Zs(this,null,function*(){try{const t={facility_id:this.facilityId,tool_id:e.toolId,recommended_workflow:e.recommendedWorkflow,confidence_score:e.confidence,reasoning:e.reasoning,alternative_workflows:e.alternativeWorkflows,model_id:null,processing_time_ms:0,tool_history_data:{},created_by:null};yield _.from("sterilization_ai_workflow_suggestions").insert(t)}catch(t){console.error("Error saving workflow suggestion:",t)}})}}var Et=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class gv{constructor(e){this.facilityId=e}getPredictiveAnalytics(e){return Et(this,null,function*(){try{const{data:t}=yield _.from("autoclave_equipment").select("*").eq("facility_id",this.facilityId),{data:n}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).eq("status","completed").order("created_at",{ascending:!1}).limit(50),a=`
        Analyze sterilization data for predictive insights:
        Equipment: ${JSON.stringify(t)}
        Recent cycles: ${JSON.stringify(n)}
        
        Provide:
        1. Equipment maintenance predictions
        2. Cycle efficiency trends
        3. Quality metrics analysis
        4. Risk factors and recommendations
      `,i=yield J.callOpenAI(a,e||"");return this.parsePredictiveAnalytics(i,t)}catch(t){throw console.error("Predictive analytics failed:",t),new Error("Predictive analytics failed")}})}getRealTimeInsights(){return Et(this,null,function*(){try{const{data:e}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).gte("created_at",new Date(Date.now()-864e5).toISOString()),t=[];if(e&&e.length>0){const a=yield this.analyzeCycleEfficiency(e);a&&t.push(a)}const{data:n}=yield _.from("autoclave_equipment").select("*").eq("facility_id",this.facilityId);if(n&&n.length>0){const a=yield this.analyzeEquipmentMaintenance(n);a&&t.push(a)}return t}catch(e){return console.error("Real-time insights failed:",e),[]}})}getHistoricalTrends(e){return Et(this,null,function*(){try{const t=new Date,n=new Date;switch(e){case"week":n.setDate(t.getDate()-7);break;case"month":n.setMonth(t.getMonth()-1);break;case"quarter":n.setMonth(t.getMonth()-3);break;case"year":n.setFullYear(t.getFullYear()-1);break}const{data:a}=yield _.from("sterilization_cycles").select("*").eq("facility_id",this.facilityId).gte("created_at",n.toISOString()).lte("created_at",t.toISOString()).order("created_at",{ascending:!0});if(!a||a.length===0)throw new Error("No historical data available");const i=this.calculateTrends(a),c=this.generateTrendInsights(i),l=this.generateTrendPredictions(i);return{success:!0,trends:i,insights:c,predictions:l}}catch(t){return console.error("Historical trends analysis failed:",t),{success:!1,trends:{efficiency:[],quality:[],duration:[],temperature:[]},insights:["Analysis failed"],predictions:["Unable to generate predictions"]}}})}parsePredictiveAnalytics(e,t){return{equipmentMaintenance:(t==null?void 0:t.map(n=>({equipmentId:n.id,nextMaintenanceDue:new Date(Date.now()+720*60*60*1e3).toISOString(),riskLevel:"medium",predictedIssues:["Calibration needed","Wear detection"]})))||[],cycleEfficiency:{trend:"improving",factors:["Optimized parameters","Better tool grouping"],recommendations:["Continue current practices","Monitor performance"]},qualityMetrics:{currentQuality:.94,predictedQuality:.96,riskFactors:["Temperature variations"],improvementActions:["Standardize procedures"]}}}analyzeCycleEfficiency(e){return Et(this,null,function*(){try{const t=this.calculateCurrentEfficiency(e);return t<.8?{id:`efficiency-${Date.now()}`,type:"efficiency_improvement",title:"Cycle Efficiency Improvement Opportunity",description:`Current efficiency is ${(t*100).toFixed(1)}%. Optimization could improve this by 15-20%.`,confidence:.85,priority:"medium",actionable:!0,recommendations:["Review cycle parameters","Optimize tool grouping","Analyze temperature settings"],data:{currentEfficiency:t,potentialEfficiency:t+.15},created_at:new Date().toISOString(),facility_id:this.facilityId}:null}catch(t){return console.error("Cycle efficiency analysis failed:",t),null}})}analyzeEquipmentMaintenance(e){return Et(this,null,function*(){try{const t=e.filter(n=>(new Date(n.last_maintenance).getTime()-Date.now())/(1e3*60*60*24)<=14);return t.length>0?{id:`maintenance-${Date.now()}`,type:"maintenance_prediction",title:"Equipment Maintenance Due Soon",description:`${t.length} piece(s) of equipment require maintenance within 2 weeks.`,confidence:.9,priority:"high",actionable:!0,recommendations:["Schedule maintenance","Review maintenance logs","Check calibration status"],data:{equipmentCount:t.length,daysUntilMaintenance:14},created_at:new Date().toISOString(),facility_id:this.facilityId}:null}catch(t){return console.error("Equipment maintenance analysis failed:",t),null}})}calculateCurrentEfficiency(e){if(!e||e.length===0)return .75;const t=e.reduce((n,a)=>{var i;return n+((i=a.duration_minutes)!=null?i:0)},0)/e.length;return Math.max(.5,Math.min(1,1-(t-20)/100))}calculateTrends(e){const t=[],n=[],a=[],i=[];return e.forEach((c,l)=>{var o,d;t.push(.75+l*.02+Math.random()*.1),n.push(.9+l*.01+Math.random()*.05),a.push((o=c.duration_minutes)!=null?o:20),i.push((d=c.temperature)!=null?d:134)}),{efficiency:t,quality:n,duration:a,temperature:i}}generateTrendInsights(e){const t=[];if(e.efficiency.length>1){const n=e.efficiency[e.efficiency.length-1]-e.efficiency[0];n>.1&&t.push(`Efficiency has improved ${(n*100).toFixed(1)}% over the period`)}return e.quality.length>1&&e.quality.reduce((a,i)=>a+i,0)/e.quality.length>.95&&t.push("Quality metrics remain consistently high"),t}generateTrendPredictions(e){const t=[];if(e.efficiency.length>1){const n=e.efficiency[e.efficiency.length-1],a=Math.min(1,n+.05);t.push(`Efficiency expected to reach ${(a*100).toFixed(1)}% by end of quarter`)}return e.quality.length>1&&t.push("Quality metrics likely to maintain 96%+ levels"),t}exportAnalyticsReport(e,t,n){return Et(this,null,function*(){try{const a=Date.now();let i={};switch(e){case"insights":i={insights:yield this.getRealTimeInsights()};break;case"predictive":i={predictive:yield this.getPredictiveAnalytics()};break;case"historical":i=yield this.getHistoricalTrends("month");break;case"comprehensive":{const[o,d,u]=yield Promise.all([this.getRealTimeInsights(),this.getPredictiveAnalytics(),this.getHistoricalTrends("month")]);i={insights:o,predictive:d,historical:u};break}}const c=yield this.formatReportData(i,t),{error:l}=yield _.from("sterilization_ai_exports").insert({facility_id:this.facilityId,report_type:e,export_format:t,date_range:n,processing_time_ms:Date.now()-a,exported_at:new Date().toISOString()});return l&&console.error("Error saving export record:",l),{success:!0,data:c,downloadUrl:yield this.generateDownloadUrl(c,t)}}catch(a){return console.error("Error exporting analytics report:",a),{success:!1,error:a instanceof Error?a.message:"Export failed"}}})}formatReportData(e,t){return Et(this,null,function*(){switch(t){case"json":return JSON.stringify(e,null,2);case"csv":return this.convertToCSV(e);case"excel":return this.convertToExcel(e);case"pdf":return this.convertToPDF(e);default:return e}})}generateDownloadUrl(e,t){return Et(this,null,function*(){const n=new Blob([JSON.stringify(e)],{type:this.getMimeType(t)});return URL.createObjectURL(n)})}getMimeType(e){switch(e){case"csv":return"text/csv";case"excel":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"pdf":return"application/pdf";case"json":return"application/json";default:return"text/plain"}}convertToCSV(e){if(Array.isArray(e)){const t=Object.keys(e[0]||{}),n=[t.join(",")];for(const a of e){const i=t.map(c=>{var l;return JSON.stringify((l=a[c])!=null?l:"")});n.push(i.join(","))}return n.join(`
`)}return JSON.stringify(e)}convertToExcel(e){return e}convertToPDF(e){return e}}var xl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class yv{constructor(e){this.facilityId=e}analyzeCompliance(e,t){return xl(this,null,function*(){try{const{data:n}=yield _.from("sterilization_cycles").select("*").eq("id",e).single();if(!n)throw new Error("Cycle not found");const a=yield J.callOpenAI(`Analyze sterilization cycle for compliance: ${JSON.stringify(n)}. Check for regulatory requirements and audit recommendations.`,t||"");return{cycleId:e,complianceScore:J.parseComplianceScore(a),riskFactors:J.parseRiskFactors(a),requiredActions:J.parseRequiredActions(a),auditRecommendations:J.parseAuditRecommendations(a),regulatoryUpdates:this.parseRegulatoryUpdates()}}catch(n){throw console.error("Compliance analysis failed:",n),new Error("Compliance analysis failed")}})}validateBiologicalIndicators(e,t){return xl(this,null,function*(){try{const n=yield J.callOpenAI(`Analyze biological indicator data: ${JSON.stringify(e)}. Determine if sterilization conditions were properly achieved.`,t||"");return{valid:J.parseBIValidation(n),confidence:.95,recommendations:["Continue current sterilization parameters","Monitor for any trend changes","Schedule next validation per protocol"]}}catch(n){return console.error("BI validation failed:",n),{valid:!1,confidence:.5,recommendations:["Manual validation required"]}}})}parseRegulatoryUpdates(){return["New FDA guidelines effective Q1 2025","Updated AAMI standards for autoclave validation"]}}var be=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class vv{constructor(e){this.facilityId=e,this.settingsManager=new nv(e),this.analysisServices=new pv(e),this.optimizationServices=new fv(e),this.analyticsServices=new gv(e),this.complianceServices=new yv(e)}initialize(){return be(this,null,function*(){try{return(yield this.settingsManager.loadSettings())!==null}catch(e){return console.error("Failed to initialize SterilizationAIService:",e),!1}})}loadSettings(){return be(this,null,function*(){return this.settingsManager.loadSettings()})}saveSettings(e){return be(this,null,function*(){return this.settingsManager.saveSettings(e)})}analyzeToolCondition(e,t){return be(this,null,function*(){if(!this.settingsManager.isToolConditionAssessmentEnabled())throw new Error("Tool condition assessment is not enabled");const n=this.settingsManager.getOpenAIKey();return this.analysisServices.analyzeToolCondition(e,t,n)})}detectBarcodeQuality(e){return be(this,null,function*(){if(!this.settingsManager.isBarcodeQualityDetectionEnabled())throw new Error("Barcode quality detection is not enabled");const t=this.settingsManager.getOpenAIKey();return this.analysisServices.detectBarcodeQuality(e,t)})}identifyToolType(e){return be(this,null,function*(){if(!this.settingsManager.isToolTypeRecognitionEnabled())throw new Error("Tool type recognition is not enabled");const t=this.settingsManager.getOpenAIKey();return this.analysisServices.identifyToolType(e,t)})}getCycleOptimization(e){return be(this,null,function*(){if(!this.settingsManager.isCycleOptimizationEnabled())throw new Error("Cycle optimization is not enabled");const t=this.settingsManager.getOpenAIKey();return this.optimizationServices.getCycleOptimization(e,t)})}getWorkflowSuggestion(e,t){return be(this,null,function*(){if(!this.settingsManager.isIntelligentWorkflowSelectionEnabled())throw new Error("Intelligent workflow selection is not enabled");const n=this.settingsManager.getOpenAIKey();return this.optimizationServices.getWorkflowSuggestion(e,t,n)})}getPredictiveAnalytics(){return be(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Predictive analytics is not enabled");const e=this.settingsManager.getOpenAIKey();return this.analyticsServices.getPredictiveAnalytics(e)})}getRealTimeInsights(){return be(this,null,function*(){if(!this.settingsManager.isRealTimeMonitoringEnabled())throw new Error("Real-time monitoring is not enabled");return this.analyticsServices.getRealTimeInsights()})}getHistoricalTrends(e){return be(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Predictive analytics is not enabled");return this.analyticsServices.getHistoricalTrends(e)})}exportAnalyticsReport(e,t,n){return be(this,null,function*(){if(!this.settingsManager.isPredictiveAnalyticsEnabled())throw new Error("Analytics export is not enabled");return this.analyticsServices.exportAnalyticsReport(e,t,n)})}detectPotentialProblems(e,t){return be(this,null,function*(){if(!this.settingsManager.isAutomatedProblemDetectionEnabled())throw new Error("Automated problem detection is not enabled");const n=this.settingsManager.getOpenAIKey();return this.analysisServices.detectPotentialProblems(e,t,n)})}analyzeCompliance(e){return be(this,null,function*(){if(!this.settingsManager.isComplianceMonitoringEnabled())throw new Error("Compliance monitoring is not enabled");const t=this.settingsManager.getOpenAIKey();return this.complianceServices.analyzeCompliance(e,t)})}validateBiologicalIndicators(e){return be(this,null,function*(){if(!this.settingsManager.isBiologicalIndicatorAnalysisEnabled())throw new Error("Biological indicator analysis is not enabled");const t=this.settingsManager.getOpenAIKey();return this.complianceServices.validateBiologicalIndicators(e,t)})}testChatGPT4Connection(){return be(this,null,function*(){const e=this.settingsManager.getOpenAIKey();return e?J.testConnection(e):{success:!1,response:"",error:"OpenAI API key not configured"}})}isFeatureEnabled(e){return this.settingsManager.isFeatureEnabled(e)}getCurrentSettings(){return this.settingsManager.getCurrentSettings()}getConfidenceThreshold(){return this.settingsManager.getConfidenceThreshold()}getDataRetentionDays(){return this.settingsManager.getDataRetentionDays()}}var en={},rt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class xv{constructor(e){this.facilityId=e}processPredictiveCleaningWithAI(){return rt(this,null,function*(){return{predicted_cleaning_date:new Date(Date.now()+2880*60*1e3).toISOString(),confidence_score:.85,urgency_level:"medium",cleaning_type:"routine",estimated_duration:45,required_resources:["cleaning_supplies","staff_2","equipment_standard"],risk_factors:["high_traffic_area","recent_contamination"],optimization_suggestions:["Schedule during low-traffic hours","Use eco-friendly cleaning products","Implement double-cleaning for high-risk areas"]}})}processContaminationPredictionWithAI(){return rt(this,null,function*(){return{contamination_probability:.25,predicted_contamination_type:"bacterial",risk_factors:["high_occupancy","inadequate_ventilation","recent_illness"],prevention_measures:["Increase cleaning frequency","Improve ventilation","Implement additional disinfection protocols"],early_warning_signs:["Increased moisture levels","Unusual odors","Staff illness reports"],confidence_score:.78}})}processResourceOptimizationWithAI(){return rt(this,null,function*(){return{current_usage:{cleaning_supplies:100,staff_hours:40,equipment_usage:8,water_usage:200,energy_consumption:150},optimized_usage:{cleaning_supplies:85,staff_hours:35,equipment_usage:7,water_usage:180,energy_consumption:135},savings_percentage:15,cost_savings:2500,efficiency_improvement:20,recommended_actions:["Implement smart scheduling to reduce staff hours","Use concentrated cleaning products to reduce supply usage","Optimize equipment usage patterns","Install water-efficient cleaning systems"],implementation_timeline:"2-4 weeks",risk_assessment:"low",confidence_score:.82}})}processSmartSchedulingWithAI(){return rt(this,null,function*(){return{optimal_cleaning_time:"2024-09-04T14:00:00Z",staff_recommendations:["experienced_cleaner_1","trainee_cleaner_2"],resource_requirements:["standard_cleaning_kit","disinfection_spray","mop_bucket"],conflict_avoidance:["Avoid patient visiting hours","Schedule around maintenance windows","Coordinate with other departments"],efficiency_score:.88,cost_optimization:.75,quality_assurance:["Pre-cleaning inspection","Post-cleaning verification","Quality checklist completion"],confidence_score:.85}})}processRiskAssessmentWithAI(){return rt(this,null,function*(){return{overall_risk_score:.35,risk_categories:{contamination:.4,compliance:.2,safety:.3,efficiency:.5},risk_factors:["High-traffic areas with increased contamination risk","Aging equipment requiring maintenance","Staff training gaps in new protocols","Inconsistent cleaning schedules"],mitigation_strategies:["Implement enhanced cleaning protocols for high-risk areas","Schedule preventive maintenance for aging equipment","Provide additional staff training on new protocols","Standardize cleaning schedules across all areas"],priority_actions:["Immediate: Schedule equipment maintenance","Short-term: Implement enhanced cleaning protocols","Medium-term: Comprehensive staff training program"],confidence_score:.79}})}processTrendAnalysisWithAI(){return rt(this,null,function*(){return{analysis_type:"cleaning_efficiency",trend_direction:"improving",trend_strength:.7,key_insights:["Cleaning efficiency has improved 15% over the past quarter","Resource usage optimization is showing positive results","Quality scores are consistently above target thresholds"],contributing_factors:["Implementation of new cleaning protocols","Staff training improvements","Better scheduling optimization","Upgraded cleaning equipment"],recommendations:["Continue current optimization strategies","Expand successful protocols to other areas","Monitor for potential plateau effects","Consider additional technology investments"],confidence_score:.84}})}processAnomalyDetectionWithAI(){return rt(this,null,function*(){return{anomaly_type:"resource_spike",severity:"medium",description:"Unusual increase in cleaning supply usage detected in Room 204",detected_at:new Date().toISOString(),normal_range:{daily_usage:"10-15 units",weekly_usage:"70-105 units"},actual_value:{daily_usage:"25 units",weekly_usage:"175 units"},potential_causes:["Increased contamination requiring additional cleaning","Equipment malfunction causing waste","Staff training issue with proper usage","Room usage pattern changes"],recommended_actions:["Investigate room conditions and usage patterns","Check equipment functionality","Review staff training records","Implement usage monitoring for this area"],confidence_score:.76}})}processQualityAssuranceWithAI(){return rt(this,null,function*(){return{quality_score:.87,quality_metrics:{cleanliness:.92,compliance:.85,efficiency:.88,safety:.9},quality_trends:{cleanliness_trend:"improving",compliance_trend:"stable",efficiency_trend:"improving",safety_trend:"stable"},improvement_areas:["Documentation completeness","Staff training consistency","Equipment maintenance scheduling"],best_practices:["Standardized cleaning protocols","Regular quality inspections","Staff feedback integration","Continuous improvement processes"],compliance_status:"compliant",audit_recommendations:["Maintain current quality standards","Focus on documentation improvements","Schedule regular compliance reviews","Implement additional quality checkpoints"],confidence_score:.83}})}buildPredictiveCleaningPrompt(e,t){return`Analyze the following room and historical cleaning data:
    Room Data: ${e}
    Historical Data: ${t}
    
    Please provide:
    1. Predicted optimal cleaning date
    2. Confidence score for prediction
    3. Urgency level assessment
    4. Recommended cleaning type
    5. Estimated duration
    6. Required resources
    7. Risk factors to consider
    8. Optimization suggestions`}buildContaminationPredictionPrompt(e,t){return`Analyze contamination risk based on:
    Room Data: ${e}
    Environmental Data: ${t}
    
    Please provide:
    1. Contamination probability score
    2. Predicted contamination type
    3. Risk factors identified
    4. Prevention measures
    5. Early warning signs to monitor
    6. Confidence score for prediction`}buildResourceOptimizationPrompt(e,t){return`Optimize resource usage based on:
    Current Usage: ${e}
    Cost Data: ${t}
    
    Please provide:
    1. Current vs optimized usage comparison
    2. Savings percentage and cost reduction
    3. Efficiency improvement metrics
    4. Recommended actions
    5. Implementation timeline
    6. Risk assessment
    7. Confidence score for optimization`}buildSmartSchedulingPrompt(e,t,n){return`Create optimal cleaning schedule based on:
    Room Data: ${e}
    Staff Availability: ${t}
    Constraints: ${n}
    
    Please provide:
    1. Optimal cleaning time
    2. Staff recommendations
    3. Resource requirements
    4. Conflict avoidance strategies
    5. Efficiency and cost optimization scores
    6. Quality assurance measures
    7. Confidence score for scheduling`}executeWithRetry(e,t=3,n=100){return rt(this,null,function*(){const{OptimizedRetryService:a}=yield q(()=>import("./login-CtXU169Q.js").then(i=>i.co),__vite__mapDeps([1,2,3,4,5]));return yield a.executeWithRetry(e,{maxRetries:t,baseDelay:n,backoffStrategy:"linear",retryCondition:i=>i.message.includes("network")||i.message.includes("timeout")||i.message.includes("rate limit")||i.message.includes("temporary")}).then(i=>{if(!i.success)throw i.error;return i.data})})}executeWithTimeout(e,t=3e4){return rt(this,null,function*(){const n=new Promise((a,i)=>{setTimeout(()=>i(new Error("Operation timed out")),t)});return Promise.race([e,n])})}selectModelForTask(e){switch(e){case"predictive_cleaning":return"gpt-4";case"contamination_prediction":return"gpt-4";case"resource_optimization":return"gpt-4";case"smart_scheduling":return"gpt-4";case"risk_assessment":return"gpt-4";case"trend_analysis":return"gpt-4";case"anomaly_detection":return"gpt-4";case"quality_assurance":return"gpt-4";default:return"gpt-4"}}getProviderConfig(e){const t={openai:{baseUrl:en.OPENAI_API_BASE_URL||"https://api.openai.com/v1",timeout:3e4,maxRetries:3,model:"gpt-4"},google:{baseUrl:en.GOOGLE_AI_API_BASE_URL||"https://generativelanguage.googleapis.com/v1",timeout:3e4,maxRetries:3,model:"gemini-pro"},azure:{baseUrl:en.AZURE_OPENAI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"gpt-4"},custom:{baseUrl:en.CUSTOM_AI_ENDPOINT||"",timeout:3e4,maxRetries:3,model:"custom"}};return t[e]||t.openai}}var ga=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class bv{constructor(e){this.facilityId=e}getEnvironmentalInsights(){return ga(this,null,function*(){try{return[]}catch(e){return console.error("Error getting environmental insights:",e),[]}})}getHistoricalCleaningData(){return ga(this,null,function*(){try{const{data:e}=yield _.from("environmental_cleans_enhanced").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(30);return e?e.map(t=>({date:t.created_at,room_id:t.room_id,cleaning_type:t.cleaning_type||"routine",duration:this.calculateDuration(t.started_time,t.completed_time),quality_score:t.quality_score||.8,resources_used:{cleaning_supplies:5,staff_hours:1,equipment_usage:1,water_usage:20,energy_consumption:10}})):[]}catch(e){return console.error("Error getting historical cleaning data:",e),[]}})}calculateDuration(e,t){if(!e||!t)return 30;const n=new Date(e),i=new Date(t).getTime()-n.getTime();return Math.max(Math.floor(i/(1e3*60)),1)}getEnvironmentalCleaningCostData(){return ga(this,null,function*(){try{return{staff_costs:12e3,supply_costs:3e3,equipment_costs:2e3,utility_costs:1500,total_cost:18500}}catch(e){return console.error("Error getting environmental cleaning cost data:",e),{staff_costs:12e3,supply_costs:3e3,equipment_costs:2e3,utility_costs:1500,total_cost:18500}}})}calculateCleaningEfficiency(e,t,n){const a=this.calculateResourceUsageFactor(n),i=e/(t*a);return Math.min(i,1)}calculateResourceUsageFactor(e){const t=e.staff_hours||1,n=e.cleaning_supplies||1,a=e.equipment_usage||1;return(t*.4+n*.3+a*.3)/10}calculateContaminationRisk(e,t,n,a){const i=(Date.now()-new Date(n).getTime())/864e5;let c=.1;c+={operating_room:.3,icu:.25,patient_room:.15,common_area:.1,storage:.05}[e]||.1,c+=t*.2,i>7?c+=.3:i>3&&(c+=.15);const o=a.humidity||50,d=a.temperature||20;return o>70&&(c+=.1),d>25&&(c+=.05),Math.min(c,1)}calculateCostSavings(e,t){const n=e-t,a=n/e*100;return{savings:n,percentage:a}}calculateQualityTrend(e){if(e.length<2)return"stable";const t=e.slice(0,Math.ceil(e.length/2)),n=e.slice(Math.ceil(e.length/2)),a=t.reduce((l,o)=>l+o,0)/t.length,i=n.reduce((l,o)=>l+o,0)/n.length,c=a-i;return c>.05?"improving":c<-.05?"declining":"stable"}calculateResourceEfficiency(e,t){const n=Object.values(e).reduce((i,c)=>i+c,0),a=Object.values(t).reduce((i,c)=>i+c,0);return n===0?0:(n-a)/n*100}detectAnomalies(e,t=2){if(e.length<3)return[];const n=e.reduce((c,l)=>c+l,0)/e.length,a=e.reduce((c,l)=>c+Math.pow(l-n,2),0)/e.length,i=Math.sqrt(a);return e.map((c,l)=>({index:l,value:c,deviation:Math.abs(c-n)/i})).filter(c=>c.deviation>t)}getPriorityFromUrgency(e){switch(e){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low";default:return"medium"}}getPriorityFromProbability(e){return e>=.8?"critical":e>=.6?"high":e>=.4?"medium":"low"}getPriorityFromSavings(e){return e>=30?"critical":e>=20?"high":e>=10?"medium":"low"}getPriorityFromSeverity(e){switch(e){case"critical":return"critical";case"high":return"high";case"medium":return"medium";case"low":return"low";default:return"medium"}}}var Ie=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class _v{constructor(e){this.facilityId=e,this.providerService=new xv(e),this.analyticsService=new bv(e)}initialize(){return Ie(this,null,function*(){try{return(yield this.loadSettings())!==null}catch(e){return console.error(e),console.error("Failed to initialize EnvironmentalAIService"),!1}})}loadSettings(){return Ie(this,null,function*(){return null})}saveSettings(e){return Ie(this,null,function*(){return!1})}initializeSettings(){return Ie(this,null,function*(){return!1})}generatePredictiveCleaning(e){return Ie(this,null,function*(){return null})}predictContamination(e){return Ie(this,null,function*(){return null})}optimizeResources(e){return Ie(this,null,function*(){return null})}generateSmartSchedule(e){return Ie(this,null,function*(){return null})}assessRisk(e){return Ie(this,null,function*(){return null})}analyzeTrends(e){return Ie(this,null,function*(){return null})}detectAnomalies(e){return Ie(this,null,function*(){return null})}assessQuality(e){return Ie(this,null,function*(){return null})}getEnvironmentalInsights(){return Ie(this,null,function*(){return this.analyticsService.getEnvironmentalInsights()})}getHistoricalCleaningData(){return Ie(this,null,function*(){try{const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("*").eq("facility_id",this.facilityId).order("created_at",{ascending:!1}).limit(100);return t?(console.error("Error getting historical cleaning data:",t),[]):(e==null?void 0:e.map(a=>({id:a.id,facility_id:a.facility_id,room_id:a.room_id,room_name:a.room_name,cleaning_type:a.cleaning_type,status:a.status,started_time:a.started_time,completed_time:a.completed_time,created_at:a.created_at,updated_at:a.updated_at})))||[]}catch(e){return console.error("Error getting historical cleaning data:",e),[]}})}getRoomData(e){return Ie(this,null,function*(){var t,n,a,i,c,l,o,d;try{const{data:u,error:h}=yield _.from("environmental_cleans_enhanced").select("*").eq("id",e).eq("facility_id",this.facilityId).single();if(h)return console.error("Error getting room data:",h),null;const p=u;return{id:p.id,room_id:p.id,room_name:(t=p.room_name)!=null?t:"Unknown Room",room_type:(n=p.room_type)!=null?n:"unknown",last_cleaned:(a=p.last_cleaned)!=null?a:new Date().toISOString(),cleaning_frequency:(i=p.cleaning_frequency)!=null?i:1,priority_level:(c=p.priority_level)!=null?c:"medium",contamination_risk:(l=p.contamination_risk)!=null?l:.5,usage_pattern:(o=p.usage_pattern)!=null?o:{},maintenance_status:(d=p.maintenance_status)!=null?d:"good"}}catch(u){return console.error("Error getting room data:",u),null}})}isFeatureEnabled(e,t){return this.getNestedProperty(e,t)===!0}getNestedProperty(e,t){return t.split(".").reduce((n,a)=>n==null?void 0:n[a],e)}}var _e=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class As{static askAI(e,t){return _e(this,null,function*(){return $u({prompt:e,context:t})})}static executeOptimizedAI(e,t,n){return _e(this,null,function*(){return sr.getInstance().execute(e,t,n)})}static getLearningAI(e){return this.learningAIInstance||(this.learningAIInstance=new m0(e)),this.learningAIInstance}static getLearningRecommendations(e,t){return _e(this,null,function*(){return this.getLearningAI(e).getPersonalizedRecommendations(t)})}static analyzeKnowledgeGaps(e,t){return _e(this,null,function*(){return this.getLearningAI(e).analyzeKnowledgeGaps(t)})}static optimizeLearningPathways(e,t){return _e(this,null,function*(){return this.getLearningAI(e).optimizeLearningPathways(t)})}static getInventoryAI(e){return this.inventoryAIInstance||(this.inventoryAIInstance=new Y0(e)),this.inventoryAIInstance}static analyzeBarcode(e,t){return _e(this,null,function*(){return this.getInventoryAI(e).analyzeBarcode(t)})}static performImageRecognition(e,t){return _e(this,null,function*(){return this.getInventoryAI(e).performImageRecognition(t)})}static generateDemandForecasting(e,t){return _e(this,null,function*(){return this.getInventoryAI(e).generateDemandForecasting(t)})}static optimizeInventoryCosts(e){return _e(this,null,function*(){return this.getInventoryAI(e).optimizeInventoryCosts()})}static getSterilizationAI(){return this.sterilizationAIInstance||(this.sterilizationAIInstance=new vv),this.sterilizationAIInstance}static getSterilizationInsights(){return _e(this,null,function*(){return this.getSterilizationAI().getInsights()})}static getSterilizationPredictiveAnalytics(){return _e(this,null,function*(){return this.getSterilizationAI().getPredictiveAnalytics()})}static getSterilizationRealTimeInsights(){return _e(this,null,function*(){return this.getSterilizationAI().getRealTimeInsights()})}static getSterilizationHistoricalTrends(){return _e(this,null,function*(){return this.getSterilizationAI().getHistoricalTrends()})}static getEnvironmentalAI(e){return this.environmentalAIInstance||(this.environmentalAIInstance=new _v(e)),this.environmentalAIInstance}static analyzeEnvironmentalData(e,t){return _e(this,null,function*(){return this.getEnvironmentalAI(e).analyzeEnvironmentalData(t)})}static generateEnvironmentalInsights(e){return _e(this,null,function*(){return this.getEnvironmentalAI(e).generateInsights()})}static initializeServices(e){return _e(this,null,function*(){try{yield this.getLearningAI(e).initialize(),yield this.getInventoryAI(e).initialize(),yield this.getEnvironmentalAI(e).initialize(),console.log(`[UnifiedAIService] All AI services initialized for facility: ${e}`)}catch(t){throw console.error("[UnifiedAIService] Failed to initialize AI services:",t),t}})}static getServiceStatus(){return{learningAI:!!this.learningAIInstance,inventoryAI:!!this.inventoryAIInstance,sterilizationAI:!!this.sterilizationAIInstance,environmentalAI:!!this.environmentalAIInstance}}static clearInstances(){this.learningAIInstance=null,this.inventoryAIInstance=null,this.sterilizationAIInstance=null,this.environmentalAIInstance=null}}As.learningAIInstance=null;As.inventoryAIInstance=null;As.sterilizationAIInstance=null;As.environmentalAIInstance=null;const wv=()=>({checkQuestionRelevance:(t,n)=>{const a=t.toLowerCase();if(n==="sterilization")return["sterilization","sterilize","autoclave","bi","biological indicator","csa","z314","steam","cycle","load","packaging","maintenance","cleaning","validation","monitoring","temperature","pressure","exposure","drying","cooling","documentation","traceability"].some(c=>a.includes(c));if(n==="inventory")return["inventory","stock","supply","order","purchase","tracking","expiry","lot","serial","barcode","scan","count","reorder"].some(c=>a.includes(c));if(n==="environmental-clean")return["cleaning","disinfection","environmental","infection control","protocol","procedure","schedule","checklist","compliance"].some(c=>a.includes(c));if(n==="home"){const i=["dashboard","home","overview","summary","metrics","stats","performance","tasks","gamification","points","level","streak","leaderboard","challenge","navigation","menu","help","assistant","cliniio","general","status","welcome","getting started","tutorial","onboarding"];return["settings","configuration","admin","setup","sterilization","autoclave","inventory","stock","cleaning","disinfection","password","login","access","account","user","permission","report","analytics","data","export","training","course","learning","education"].some(l=>a.includes(l))?!1:i.some(l=>a.includes(l))}return!0},getRedirectMessage:(t,n)=>{const a=n.toLowerCase();return t==="sterilization"?a.includes("inventory")||a.includes("stock")||a.includes("supply")?"That's an inventory question! Please go to the Inventory page or ask your manager for inventory-related help.":a.includes("cleaning")&&!a.includes("autoclave")&&!a.includes("sterilization")?"For general cleaning questions, try the Environmental Clean page or ask your manager.":a.includes("password")||a.includes("login")||a.includes("system")?"For system access issues, try Cliniio Help or contact your manager.":"That question isn't related to sterilization. Try the Relevant Information section above for standards and protocols, or ask your manager for other topics.":t==="inventory"?a.includes("sterilization")||a.includes("autoclave")?"That's a sterilization question! Please go to the Sterilization page or ask your manager for sterilization-related help.":"That question isn't related to inventory. Try the Relevant Information section above, or ask your manager for other topics.":t==="environmental-clean"?a.includes("sterilization")||a.includes("autoclave")?"For sterilization questions, try the Sterilization page or ask your manager.":"That question isn't related to environmental cleaning. Try the Relevant Information section above, or ask your manager for other topics.":t==="home"?a.includes("sterilization")||a.includes("autoclave")||a.includes("bi")||a.includes("biological indicator")?"That's a sterilization question! Please go to the Sterilization page for specialized help, or contact your clinic administrator for detailed guidance.":a.includes("inventory")||a.includes("stock")||a.includes("supply")||a.includes("order")||a.includes("purchase")?"That's an inventory question! Please go to the Inventory page for specialized help, or contact your clinic administrator for detailed guidance.":a.includes("cleaning")||a.includes("disinfection")||a.includes("environmental")?"That's an environmental cleaning question! Please go to the Environmental Clean page for specialized help, or contact your clinic administrator for detailed guidance.":a.includes("password")||a.includes("login")||a.includes("access")||a.includes("account")||a.includes("user")||a.includes("permission")?"For system access issues, please contact your clinic administrator or IT support. They can help with login problems, password resets, and account permissions.":a.includes("settings")||a.includes("configuration")||a.includes("admin")||a.includes("setup")?"For system settings and configuration questions, please contact your clinic administrator. They have access to the necessary administrative functions.":a.includes("report")||a.includes("analytics")||a.includes("data")||a.includes("export")?"For detailed reports and analytics, please go to the Analytics page or contact your clinic administrator for comprehensive data analysis.":a.includes("training")||a.includes("course")||a.includes("learning")||a.includes("education")?"For training and learning resources, please go to the Learning Hub or contact your clinic administrator for educational materials and courses.":"I can only help with general dashboard questions here. For specialized topics like sterilization, inventory, cleaning, or system administration, please go to the appropriate page or contact your clinic administrator for detailed assistance.":"That question isn't related to your current page. Try the Relevant Information section above, or ask your manager for other topics."}});var Sv=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Cv=({currentContext:s,onBack:e})=>{const[t,n]=m.useState([{role:"assistant",content:"Hello! I'm your Cliniio AI assistant. How can I help you today?"}]),[a,i]=m.useState(""),[c,l]=m.useState(!1),{checkQuestionRelevance:o,getRedirectMessage:d}=wv(),u=()=>Sv(null,null,function*(){if(!a.trim()||c)return;const p=a.trim();if(i(""),n(y=>[...y,{role:"user",content:p}]),l(!0),!o(p,s)){const y=d(s,p);n(g=>[...g,{role:"assistant",content:y}]),l(!1);return}try{const y=yield As.askAI(p,`User is on ${s} page and asking for help. Only answer questions related to ${s}.`);n(g=>[...g,{role:"assistant",content:y}])}catch(y){console.error(y),n(g=>[...g,{role:"assistant",content:"Sorry, I encountered an error. Please try again."}])}finally{l(!1)}}),h=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u())};return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"AI Assistant"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Ask me anything about Cliniio"})]})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 scrollbar-hide",children:[t.map((p,f)=>r.jsx("div",{className:`flex ${p.role==="user"?"justify-end":"justify-start"}`,children:r.jsx("div",{className:`max-w-xs px-4 py-2 rounded-lg ${p.role==="user"?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-800"}`,children:r.jsx("p",{className:"text-sm",children:p.content})})},f)),c&&r.jsx("div",{className:"flex justify-start",children:r.jsx("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),r.jsx("div",{className:"border-t border-gray-200 p-4 bg-white",children:r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("input",{type:"text",value:a,onChange:p=>i(p.target.value),onKeyPress:h,placeholder:"Ask me anything...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",disabled:c}),r.jsx("button",{onClick:u,disabled:!a.trim()||c,className:"px-4 py-2 bg-[#4ECDC4] text-white rounded-lg hover:bg-[#3db8b0] focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:r.jsx("span",{className:"text-sm",children:"Send"})})]})})]})};var is=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class jv{getArticlesByCategory(e){return is(this,null,function*(){try{const{data:t,error:n}=yield _.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count").eq("category",e).eq("is_published",!0).order("priority",{ascending:!0}).order("created_at",{ascending:!1});return n?(console.error("Error fetching help articles:",n),[]):t||[]}catch(t){return console.error("Error fetching help articles:",t),[]}})}getArticleBySlug(e){return is(this,null,function*(){try{const{data:t,error:n}=yield _.from("help_articles").select("*").eq("slug",e).eq("is_published",!0).single();return n?(console.error("Error fetching help article:",n),null):t}catch(t){return console.error("Error fetching help article:",t),null}})}incrementViewCount(e){return is(this,null,function*(){try{const{data:t}=yield _.from("help_articles").select("view_count").eq("slug",e).single();t&&(yield _.from("help_articles").update({view_count:t.view_count+1,last_viewed_at:new Date().toISOString()}).eq("slug",e))}catch(t){console.error("Error incrementing view count:",t)}})}getFeaturedArticles(e=3){return is(this,null,function*(){try{const{data:t,error:n}=yield _.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count").eq("is_published",!0).eq("is_featured",!0).order("priority",{ascending:!0}).order("view_count",{ascending:!1}).limit(e);return n?(console.error("Error fetching featured articles:",n),[]):t||[]}catch(t){return console.error("Error fetching featured articles:",t),[]}})}searchArticles(e,t){return is(this,null,function*(){try{let n=_.from("help_articles").select("id, slug, title, excerpt, category, subcategory, priority, is_featured, view_count").eq("is_published",!0).or(`title.ilike.%${e}%,excerpt.ilike.%${e}%`);t&&(n=n.eq("category",t));const{data:a,error:i}=yield n.order("priority",{ascending:!0}).order("view_count",{ascending:!1});return i?(console.error("Error searching help articles:",i),[]):a||[]}catch(n){return console.error("Error searching help articles:",n),[]}})}}const Wn=new jv;var Nv=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Iv=({currentContext:s,expandedRelevant:e,onToggleRelevantSection:t,onBack:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{Nv(null,null,function*(){try{console.log("🔍 Loading relevant information articles...");const p=yield Wn.getArticlesByCategory("relevant-information");console.log("📋 Found articles:",p),i(p)}catch(p){console.error("Error loading relevant information articles:",p)}finally{l(!1)}})},[]);const o=h=>{window.open(`/help/article/${h}`,"_blank")},d=[{id:"canadian-standards",title:"🇨🇦 Canadian Standards",color:"blue",content:r.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("li",{children:"• CSA Z314.2-19 - Decontamination of Reusable Medical Devices"}),r.jsx("li",{children:"• CSA Z314.3-19 - Steam Sterilization in Health Care Facilities"}),r.jsx("li",{children:"• Health Canada SOR/98-282 - Medical Device Regulations"}),r.jsx("li",{children:"• Public Health Agency of Canada - Routine Practices and Additional Precautions"}),r.jsx("li",{children:"• Ontario Health - Infection Prevention and Control Guidelines"}),r.jsx("li",{children:"• BC Centre for Disease Control - Healthcare-Associated Infection Prevention"}),r.jsx("li",{children:"• Alberta Health Services - Sterilization and Reprocessing Standards"}),r.jsx("li",{children:"• Quebec Health - Hygiene Practices in Healthcare Facilities"})]})},{id:"us-standards",title:"🇺🇸 US Standards",color:"green",content:r.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[r.jsx("li",{children:"• AAMI ST79:2017 - Comprehensive Guide to Steam Sterilization"}),r.jsx("li",{children:"• AAMI ST91:2021 - Flexible Endoscope Reprocessing"}),r.jsx("li",{children:"• CDC Guidelines - Disinfection and Sterilization in Healthcare Facilities"}),r.jsx("li",{children:"• FDA Regulations - Medical Device Reprocessing Standards"}),r.jsx("li",{children:"• Joint Commission - Healthcare Accreditation Standards"}),r.jsx("li",{children:"• OSHA Guidelines - Workplace Safety and Chemical Handling"}),r.jsx("li",{children:"• ANSI/AAMI Standards - Sterilization Validation and Monitoring"})]})},{id:"international-standards",title:"🌍 International Standards",color:"purple",content:r.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[r.jsx("li",{children:"• ISO 15883 - Washer-disinfectors"}),r.jsx("li",{children:"• ISO 17665 - Steam sterilization"}),r.jsx("li",{children:"• ISO 13485 - Medical Device Quality Management"}),r.jsx("li",{children:"• ISO 9001 - Quality Management Systems"}),r.jsx("li",{children:"• WHO Guidelines - Infection Prevention and Control"}),r.jsx("li",{children:"• ASTM Standards - Material Testing and Validation"}),r.jsx("li",{children:"• IAC Standards - Infection Prevention and Control"}),r.jsx("li",{children:"• APIC Guidelines - Healthcare-Associated Infection Prevention"})]})}],u=h=>{const p=e.has(h.id),y={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[h.color];return r.jsxs("div",{className:`${y.bg} ${y.border} border rounded-lg overflow-hidden`,children:[r.jsxs("button",{onClick:()=>t(h.id),className:`w-full p-3 text-left flex items-center justify-between ${y.hover} transition-colors`,children:[r.jsx("h5",{className:`font-medium ${y.text}`,children:h.title}),r.jsx("span",{className:`${y.icon} text-lg transition-transform duration-200`,children:p?"−":"+"})]}),p&&r.jsxs("div",{className:"px-3 pb-3",children:[h.content,h.slug&&r.jsx("div",{className:"mt-3",children:r.jsxs("button",{onClick:()=>o(h.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[r.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},h.id)};if(s==="home"||s==="general"){if(c)return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:r.jsx("div",{className:"space-y-2",children:r.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about standards and compliance.'})})})):d;return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Relevant Information"}),r.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Standards and compliance reference"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Comprehensive Standards Reference"}),h.map(u)]})})]})}return s==="sterilization"?r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"BI Testing"}),r.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("li",{children:"• Biological indicator testing protocols"}),r.jsx("li",{children:"• Testing frequency requirements"}),r.jsx("li",{children:"• Result interpretation and documentation"}),r.jsx("li",{children:"• Quality assurance procedures"})]})]}),r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Sterilization Workflow"}),r.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[r.jsx("li",{children:"• Pre-cleaning and inspection protocols"}),r.jsx("li",{children:"• Proper packaging and loading techniques"}),r.jsx("li",{children:"• Sterilization cycle parameters"}),r.jsx("li",{children:"• Post-sterilization handling procedures"})]})]}),r.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Reporting and Compliance"}),r.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[r.jsx("li",{children:"• Documentation requirements"}),r.jsx("li",{children:"• Regulatory compliance standards"}),r.jsx("li",{children:"• Audit preparation and procedures"}),r.jsx("li",{children:"• Quality management systems"})]})]})]})]}):r.jsx("div",{className:"text-center text-gray-500 py-8",children:r.jsx("p",{children:"General information and standards will be displayed here based on your current page."})})};var bl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Tv={submitFeedback(s){return bl(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return{success:!1,error:"User not authenticated"};const{error:t}=yield _.from("product_feedback").insert([{type:s.type,title:s.title,description:s.description,priority:s.priority,user_id:e.id,contact_email:s.email,page_url:window.location.href,user_agent:navigator.userAgent,browser_info:{language:navigator.language,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled}}]);return t?(console.error("Error submitting feedback:",t),{success:!1,error:t.message}):{success:!0}}catch(e){return console.error("Error submitting feedback:",e),{success:!1,error:e instanceof Error?e.message:"An unknown error occurred"}}})},getFeedbackHistory(){return bl(this,null,function*(){try{const{data:{user:s}}=yield _.auth.getUser();if(!s)return{data:[],error:"User not authenticated"};const{data:e,error:t}=yield _.from("product_feedback").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});return t?(console.error("Error fetching feedback history:",t),{data:[],error:t.message}):{data:e||[]}}catch(s){return console.error("Error fetching feedback history:",s),{data:[],error:"Failed to fetch feedback history"}}})}};var Ev=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const kv=()=>{const[s,e]=m.useState(""),[t,n]=m.useState(""),[a,i]=m.useState(""),[c,l]=m.useState("medium"),[o,d]=m.useState(""),[u,h]=m.useState(!1);return{feedbackType:s,setFeedbackType:e,feedbackTitle:t,setFeedbackTitle:n,feedbackDescription:a,setFeedbackDescription:i,feedbackPriority:c,setFeedbackPriority:l,feedbackEmail:o,setFeedbackEmail:d,isSubmittingFeedback:u,handleFeedbackSubmit:y=>Ev(null,null,function*(){y.preventDefault(),h(!0);try{const g={type:s,title:t,description:a,priority:c,email:o},x=yield Tv.submitFeedback(g);return x.success?(e(""),n(""),i(""),l("medium"),d(""),alert("Thank you for your feedback! We'll review it and get back to you if needed."),!0):(console.error("Error submitting feedback:",x.error),alert("There was an error submitting your feedback. Please try again."),!1)}catch(g){return console.error("Error submitting feedback:",g),alert("There was an error submitting your feedback. Please try again."),!1}finally{h(!1)}}),resetFeedbackForm:()=>{e(""),n(""),i(""),l("medium"),d("")}}};var Dv=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Pv=({onBack:s,onSuccess:e})=>{const{feedbackType:t,setFeedbackType:n,feedbackTitle:a,setFeedbackTitle:i,feedbackDescription:c,setFeedbackDescription:l,feedbackPriority:o,setFeedbackPriority:d,feedbackEmail:u,setFeedbackEmail:h,isSubmittingFeedback:p,handleFeedbackSubmit:f}=kv(),y=g=>Dv(null,null,function*(){(yield f(g))&&e()});return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Product Feedback"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Help us improve Cliniio"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:r.jsx("span",{className:"text-white text-2xl",children:"💡"})}),r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Share Your Feedback"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Help us make Cliniio better for everyone"})]}),r.jsxs("form",{onSubmit:y,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"feedbackType",className:"block text-sm font-medium text-gray-700 mb-2",children:"Feedback Type *"}),r.jsxs("select",{id:"feedbackType",value:t,onChange:g=>n(g.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0,children:[r.jsx("option",{value:"",children:"Select feedback type"}),r.jsx("option",{value:"bug",children:"Bug Report"}),r.jsx("option",{value:"feature",children:"Feature Request"}),r.jsx("option",{value:"improvement",children:"Improvement Suggestion"}),r.jsx("option",{value:"other",children:"Other"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"feedbackTitle",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),r.jsx("input",{id:"feedbackTitle",type:"text",value:a,onChange:g=>i(g.target.value),placeholder:"Brief description of your feedback",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"feedbackDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),r.jsx("textarea",{id:"feedbackDescription",value:c,onChange:g=>l(g.target.value),placeholder:"Please provide detailed information...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"feedbackPriority",className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),r.jsxs("select",{id:"feedbackPriority",value:o,onChange:g=>d(g.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent",children:[r.jsx("option",{value:"low",children:"Low"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"high",children:"High"}),r.jsx("option",{value:"critical",children:"Critical"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"feedbackEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email (optional)"}),r.jsx("input",{id:"feedbackEmail",type:"email",value:u,onChange:g=>h(g.target.value),placeholder:"your.email@facility.com",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"We'll only use this to follow up on your feedback"})]}),r.jsx("button",{type:"submit",disabled:p,className:"w-full bg-[#4ECDC4] text-white py-3 px-4 rounded-lg hover:bg-[#4ECDC4]/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:p?"Submitting...":"Submit Feedback"})]})]})})]})},Rv=({onBack:s})=>{const[e,t]=m.useState(new Set([0])),[n,a]=m.useState(null),i=l=>{t(o=>{const d=new Set(o);return d.has(l)?(d.delete(l),n===l&&a(null)):(d.add(l),a(l)),d})},c=()=>{a(null)};return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Onboarding Tour"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Step-by-step guide to using the Home page"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-[#4ECDC4] rounded-full flex items-center justify-center mx-auto mb-3",children:r.jsx("span",{className:"text-white text-2xl",children:"🎯"})}),r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Welcome to Cliniio!"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Let's take a quick tour of your Home page"})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>i(0),className:"w-full p-4 text-left flex items-center justify-between hover:bg-blue-100 transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"1"}),r.jsx("h5",{className:"font-medium text-blue-800",children:"Daily Tasks & Progress"})]}),r.jsx("span",{className:"text-blue-600 text-lg transition-transform duration-200",children:e.has(0)?"−":"+"})]}),e.has(0)&&r.jsxs("div",{className:"px-4 pb-4",children:[r.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"The main area shows your daily tasks and responsibilities. Each task card displays what needs to be done and your progress."}),r.jsxs("div",{className:"bg-white border border-blue-200 rounded p-3 text-xs text-blue-600",children:[r.jsx("strong",{children:"Try it:"})," Look for task cards with checkboxes. Click on a checkbox to mark a task as complete and earn points!"]}),r.jsxs("button",{onClick:()=>a(n===0?null:0),className:"mt-3 w-full bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600 transition-colors",children:["🎯"," ",n===0?"Hide arrow":"Show me where this is"]})]})]}),r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>i(1),className:"w-full p-4 text-left flex items-center justify-between hover:bg-green-100 transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"2"}),r.jsx("h5",{className:"font-medium text-green-800",children:"Quick Action Buttons"})]}),r.jsx("span",{className:"text-green-600 text-lg transition-transform duration-200",children:e.has(1)?"−":"+"})]}),e.has(1)&&r.jsxs("div",{className:"px-4 pb-4",children:[r.jsx("p",{className:"text-sm text-green-700 mb-3",children:"At the top of your Home page, you'll find quick access buttons for important features and your performance stats."}),r.jsxs("div",{className:"bg-white border border-green-200 rounded p-3 text-xs text-green-600",children:[r.jsx("strong",{children:"Try it:"}),' Click on the purple "Stats" button to see your performance metrics, or the amber "Leaderboard" to check your ranking.']}),r.jsxs("button",{onClick:()=>a(n===1?null:1),className:"mt-3 w-full bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600 transition-colors",children:["🎯"," ",n===1?"Hide arrow":"Show me where this is"]})]})]}),r.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>i(2),className:"w-full p-4 text-left flex items-center justify-between hover:bg-purple-100 transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"3"}),r.jsx("h5",{className:"font-medium text-purple-800",children:"Gamification & Points"})]}),r.jsx("span",{className:"text-purple-600 text-lg transition-transform duration-200",children:e.has(2)?"−":"+"})]}),e.has(2)&&r.jsxs("div",{className:"px-4 pb-4",children:[r.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Notice the points and progress indicators? Cliniio makes work fun by rewarding your achievements and tracking your progress."}),r.jsxs("div",{className:"bg-white border border-purple-500 rounded p-3 text-xs text-purple-600",children:[r.jsx("strong",{children:"Try it:"})," Complete a task and watch your points increase. Check your progress in the Stats section to see your growth."]}),r.jsxs("button",{onClick:()=>a(n===2?null:2),className:"mt-3 w-full bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600 transition-colors",children:["🎯"," ",n===2?"Hide arrow":"Show me where this is"]})]})]}),r.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>i(3),className:"w-full p-4 text-left flex items-center justify-between hover:bg-amber-100 transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"4"}),r.jsx("h5",{className:"font-medium text-amber-800",children:"Performance Metrics"})]}),r.jsx("span",{className:"text-amber-600 text-lg transition-transform duration-200",children:e.has(3)?"−":"+"})]}),e.has(3)&&r.jsxs("div",{className:"px-4 pb-4",children:[r.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Below your tasks, you'll see cards showing your time savings, cost savings, AI efficiency, and team performance."}),r.jsxs("div",{className:"bg-white border border-amber-200 rounded p-3 text-xs text-amber-600",children:[r.jsx("strong",{children:"Try it:"})," Review your metrics to see how you're performing. These update automatically as you complete tasks."]}),r.jsxs("button",{onClick:()=>a(n===3?null:3),className:"mt-3 w-full bg-amber-500 text-white px-3 py-2 rounded text-sm hover:bg-amber-600 transition-colors",children:["🎯"," ",n===3?"Hide arrow":"Show me where this is"]})]})]}),r.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg overflow-hidden",children:[r.jsxs("button",{onClick:()=>i(4),className:"w-full p-4 text-left flex items-center justify-between hover:bg-teal-100 transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:"5"}),r.jsx("h5",{className:"font-medium text-teal-800",children:"Help & Support"})]}),r.jsx("span",{className:"text-teal-600 text-lg transition-transform duration-200",children:e.has(4)?"−":"+"})]}),e.has(4)&&r.jsxs("div",{className:"px-4 pb-4",children:[r.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"That floating help button (🛟) you used to get here is always available when you need assistance with any feature."}),r.jsxs("div",{className:"bg-white border border-teal-200 rounded p-3 text-xs text-teal-600",children:[r.jsx("strong",{children:"Remember:"})," You can access help from anywhere in Cliniio. Just look for the floating button!"]}),r.jsxs("button",{onClick:()=>a(n===4?null:4),className:"mt-3 w-full bg-teal-500 text-white px-3 py-2 rounded text-sm hover:bg-teal-600 transition-colors",children:["🎯"," ",n===4?"Hide arrow":"Show me where this is"]})]})]})]}),r.jsx("div",{className:"bg-[#4ECDC4] border border-[#4ECDC4] rounded-lg p-4 text-center",children:r.jsxs("div",{className:"text-white",children:[r.jsx("h5",{className:"font-medium text-lg mb-2",children:"🎉 You're All Set!"}),r.jsx("p",{className:"text-sm text-white text-opacity-90 mb-3",children:"You now know the basics of navigating your Home page. Feel free to explore and try things out!"}),r.jsx("button",{onClick:s,className:"px-4 py-2 bg-white text-[#4ECDC4] rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Finish Tour"})]})})]})}),n!==null&&r.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[n===0&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"absolute left-1/4 top-1/3 z-50",children:[r.jsx("div",{className:"bg-blue-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"📋 Daily Tasks"}),r.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-blue-500 ml-4"})]})}),n===1&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"absolute right-1/4 top-20 z-50",children:[r.jsx("div",{className:"bg-green-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"⚡ Quick Actions"}),r.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-green-500 ml-4"})]})}),n===2&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"absolute left-1/4 top-1/4 z-50",children:[r.jsx("div",{className:"bg-purple-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"🏆 Points & Progress"}),r.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-purple-500 ml-4"})]})}),n===3&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"absolute left-1/4 bottom-1/4 z-50",children:[r.jsx("div",{className:"bg-amber-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"📊 Performance Metrics"}),r.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-amber-500 ml-4"})]})}),n===4&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"absolute bottom-20 right-20 z-50",children:[r.jsx("div",{className:"bg-teal-500 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium",children:"🛟 Help Button"}),r.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-teal-500 ml-4"})]})}),r.jsx("button",{onClick:c,className:"absolute top-4 right-4 bg-white text-gray-700 px-3 py-2 rounded-lg shadow-lg pointer-events-auto hover:bg-gray-100 transition-colors border border-gray-200 z-50",children:"✕ Close"})]})]})},Av=({currentContext:s,onBack:e,onSetHelpType:t})=>r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Cliniio Help"}),r.jsx("p",{className:"text-xs text-gray-500",children:s==="home"?"Help for Home page":"General help and support"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:s==="home"?r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Home Page Help"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:()=>t("performance-metrics"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:r.jsx("span",{className:"text-lg",children:"📊"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Performance Metrics"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Understanding your dashboard metrics"})]})]})}),r.jsx("button",{onClick:()=>t("task-management"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:r.jsx("span",{className:"text-lg",children:"✅"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Task Management"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Managing daily tasks and workflows"})]})]})}),r.jsx("button",{onClick:()=>t("gamification"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:r.jsx("span",{className:"text-lg",children:"🏆"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"Gamification System"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How points, levels, and streaks work"})]})]})}),r.jsx("button",{onClick:()=>t("ai-features"),className:"w-full p-3 text-left border border-gray-200 rounded-lg hover:border-[#4ECDC4] hover:bg-[#4ECDC4]/5 transition-all duration-200 group",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600 group-hover:bg-[#4ECDC4] group-hover:text-white transition-colors",children:r.jsx("span",{className:"text-lg",children:"🤖"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h5",{className:"font-medium text-gray-900 group-hover:text-[#4ECDC4] transition-colors",children:"AI Features"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How AI improves your workflow"})]})]})})]})]}):s==="sterilization"?r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"Sterilization Standards & Protocols"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:()=>t("bi-testing"),className:"bg-blue-50 border border-blue-200 rounded-lg p-3 w-full text-left hover:bg-blue-100 transition-colors",children:r.jsx("h5",{className:"font-medium text-blue-800",children:"🧪 BI Testing"})}),r.jsx("button",{onClick:()=>t("sterilization-workflow"),className:"bg-green-50 border border-green-200 rounded-lg p-3 w-full text-left hover:bg-green-100 transition-colors",children:r.jsx("h5",{className:"font-medium text-green-800",children:"✂️ Sterilization Workflow"})}),r.jsx("button",{onClick:()=>t("reporting-compliance"),className:"bg-purple-50 border border-purple-200 rounded-lg p-3 w-full text-left hover:bg-purple-100 transition-colors",children:r.jsx("h5",{className:"font-medium text-purple-800",children:"📊 Reporting and Compliance"})})]})]}):r.jsx("div",{className:"text-center text-gray-500 py-8",children:r.jsx("p",{children:"Help content coming soon for this page."})})})]});var Ov=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const $v=({onBack:s,expandedMetrics:e,onToggleMetricSection:t,onSetHelpType:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{Ov(null,null,function*(){try{console.log("🔍 Loading performance metrics articles...");const f=yield Wn.getArticlesByCategory("performance-metrics");console.log("📊 Found articles:",f),console.log("📊 Articles count:",f.length),console.log("📊 Articles details:",f.map(y=>({slug:y.slug,title:y.title,published:y.is_published}))),i(f)}catch(f){console.error("❌ Error loading performance metrics articles:",f)}finally{l(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"time-savings",title:"Time Savings",color:"blue",content:r.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("li",{children:"• Shows hours saved through AI assistance"}),r.jsx("li",{children:"• Daily and monthly tracking"}),r.jsx("li",{children:"• Compares AI vs. manual task completion"}),r.jsx("li",{children:"• Real-time updates as tasks complete"})]})},{id:"cost-savings",title:"Cost Savings",color:"green",content:r.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[r.jsx("li",{children:"• Calculates dollar impact of AI efficiency"}),r.jsx("li",{children:"• Includes error prevention and compliance savings"}),r.jsx("li",{children:"• Uses facility-specific hourly rates"}),r.jsx("li",{children:"• Projects annual savings with growth factors"})]})},{id:"team-performance",title:"Team Performance",color:"purple",content:r.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[r.jsx("li",{children:"• Skills: Based on AI task completion rates"}),r.jsx("li",{children:"• Inventory: Real-time accuracy from actual data"}),r.jsx("li",{children:"• Sterilization: Performance from cycle data"}),r.jsx("li",{children:"• Helps identify training needs"})]})}],u=p=>{const f=e.has(p.id),g={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return r.jsxs("div",{className:`${g.bg} ${g.border} border rounded-lg overflow-hidden`,children:[r.jsxs("button",{onClick:()=>t(p.id),className:`w-full p-3 text-left flex items-center justify-between ${g.hover} transition-colors`,children:[r.jsx("h5",{className:`font-medium ${g.text}`,children:p.title}),r.jsx("span",{className:`${g.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&r.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&r.jsx("div",{className:"mt-3",children:r.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[r.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(c)return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:r.jsx("div",{className:"space-y-2",children:r.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about this performance metric.'})})})):d;return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>n("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Performance Metrics"}),r.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Understanding your dashboard metrics"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Dashboard Metrics Explained"}),h.map(u)]})})]})};var Mv=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Fv=({onBack:s,onSetHelpType:e,expandedTasks:t,onToggleTaskSection:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{Mv(null,null,function*(){try{console.log("🔍 Loading task management articles...");const f=yield Wn.getArticlesByCategory("task-management");console.log("📋 Found articles:",f),i(f)}catch(f){console.error("Error loading task management articles:",f)}finally{l(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"task-categories",title:"📋 Task Categories",color:"blue",content:r.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("li",{children:"• Sterilization: Autoclave cycles and BI tests"}),r.jsx("li",{children:"• Inventory: Stock checks and ordering"}),r.jsx("li",{children:"• Environmental: Cleaning schedules and compliance"}),r.jsx("li",{children:"• Quality: Documentation and audits"})]})},{id:"task-completion",title:"✅ Task Completion",color:"green",content:r.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[r.jsx("li",{children:"• Click checkboxes to mark tasks complete"}),r.jsx("li",{children:"• Earn points for each completed task"}),r.jsx("li",{children:"• Track progress throughout the day"}),r.jsx("li",{children:"• Maintain streaks for consistency"})]})},{id:"workflow-tips",title:"💡 Workflow Tips",color:"purple",content:r.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[r.jsx("li",{children:"• Use filters to focus on specific task types"}),r.jsx("li",{children:"• Prioritize high-impact tasks first"}),r.jsx("li",{children:"• Set reminders for time-sensitive items"}),r.jsx("li",{children:"• Review completed tasks for quality"})]})}],u=p=>{const f=t.has(p.id),g={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return r.jsxs("div",{className:`${g.bg} ${g.border} border rounded-lg overflow-hidden`,children:[r.jsxs("button",{onClick:()=>n(p.id),className:`w-full p-3 text-left flex items-center justify-between ${g.hover} transition-colors`,children:[r.jsx("h5",{className:`font-medium ${g.text}`,children:p.title}),r.jsx("span",{className:`${g.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&r.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&r.jsx("div",{className:"mt-3",children:r.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[r.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(c)return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:r.jsx("div",{className:"space-y-2",children:r.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about task management.'})})})):d;return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Task Management"}),r.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"Managing daily tasks and workflows"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Daily Task Management"}),h.map(u)]})})]})};var zv=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Lv=({onBack:s,onSetHelpType:e,expandedGamification:t,onToggleGamificationSection:n})=>{const[a,i]=m.useState([]),[c,l]=m.useState(!0);m.useEffect(()=>{zv(null,null,function*(){try{console.log("🔍 Loading gamification articles...");const f=yield Wn.getArticlesByCategory("gamification");console.log("🎮 Found articles:",f),i(f)}catch(f){console.error("Error loading gamification articles:",f)}finally{l(!1)}})},[]);const o=p=>{window.open(`/help/article/${p}`,"_blank")},d=[{id:"point-system",title:"⭐ Point System",color:"blue",content:r.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("li",{children:"• Complete tasks to earn points"}),r.jsx("li",{children:"• Points vary by task difficulty and impact"}),r.jsx("li",{children:"• Bonus points for maintaining streaks"}),r.jsx("li",{children:"• Level up as you accumulate points"})]})},{id:"streaks-consistency",title:"🔥 Streaks & Consistency",color:"green",content:r.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[r.jsx("li",{children:"• Daily streaks increase your multiplier"}),r.jsx("li",{children:"• Perfect days earn bonus rewards"}),r.jsx("li",{children:"• Streaks reset on missed days"}),r.jsx("li",{children:"• Long streaks unlock special achievements"})]})},{id:"level-progression",title:"📊 Level Progression",color:"purple",content:r.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[r.jsx("li",{children:"• Multiple skill-based sub-levels"}),r.jsx("li",{children:"• Sterilization, inventory, and environmental"}),r.jsx("li",{children:"• Rank against other users"}),r.jsx("li",{children:"• Unlock new features as you progress"})]})}],u=p=>{const f=t.has(p.id),g={blue:{bg:"bg-blue-50",border:"border-blue-200",hover:"hover:bg-blue-100",text:"text-blue-800",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",hover:"hover:bg-green-100",text:"text-green-800",icon:"text-green-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",hover:"hover:bg-purple-100",text:"text-purple-800",icon:"text-purple-600"}}[p.color];return r.jsxs("div",{className:`${g.bg} ${g.border} border rounded-lg overflow-hidden`,children:[r.jsxs("button",{onClick:()=>n(p.id),className:`w-full p-3 text-left flex items-center justify-between ${g.hover} transition-colors`,children:[r.jsx("h5",{className:`font-medium ${g.text}`,children:p.title}),r.jsx("span",{className:`${g.icon} text-lg transition-transform duration-200`,children:f?"−":"+"})]}),f&&r.jsxs("div",{className:"px-3 pb-3",children:[p.content,p.slug&&r.jsx("div",{className:"mt-3",children:r.jsxs("button",{onClick:()=>o(p.slug),className:"inline-flex items-center px-3 py-2 bg-[#4ECDC4] text-white text-sm rounded-lg hover:bg-[#4ECDC4]/90 transition-colors",children:[r.jsx("span",{className:"mr-2",children:"📖"}),"Read Full Article"]})})]})]},p.id)};if(c)return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Loading help articles..."})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4]"})})})]});const h=a.length>0?a.map(p=>({id:p.slug,title:p.title,color:"blue",slug:p.slug,content:r.jsx("div",{className:"space-y-2",children:r.jsx("p",{className:"text-sm text-gray-600",children:p.excerpt||'Click "Read Full Article" to learn more about gamification.'})})})):d;return r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>e("cliniio-help"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Gamification System"}),r.jsx("p",{className:"text-xs text-gray-500",children:a.length>0?`${a.length} help articles available`:"How points, levels, and streaks work"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:a.length>0?"Help Articles":"Earning and Progress"}),h.map(u)]})})]})},Bv=({onBack:s})=>r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"AI Features"}),r.jsx("p",{className:"text-xs text-gray-500",children:"How AI improves your workflow"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"AI-Powered Assistance"}),r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Smart Task Generation"}),r.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("li",{children:"• AI creates relevant daily tasks"}),r.jsx("li",{children:"• Adapts to your facility's needs"}),r.jsx("li",{children:"• Suggests optimal task sequences"}),r.jsx("li",{children:"• Learns from your preferences"})]})]}),r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Optimization"}),r.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[r.jsx("li",{children:"• Real-time efficiency monitoring"}),r.jsx("li",{children:"• Predictive maintenance alerts"}),r.jsx("li",{children:"• Resource optimization suggestions"}),r.jsx("li",{children:"• Compliance risk mitigation"})]})]}),r.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Intelligent Insights"}),r.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[r.jsx("li",{children:"• Data-driven recommendations"}),r.jsx("li",{children:"• Trend analysis and forecasting"}),r.jsx("li",{children:"• Best practice suggestions"}),r.jsx("li",{children:"• Continuous improvement tips"})]})]})]})})]}),qv=({onBack:s})=>r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"New Features"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Discover what's new in Cliniio"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-800 text-lg",children:"What's New in Cliniio"}),r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"Latest Updates"}),r.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[r.jsx("li",{children:"• Enhanced AI assistance capabilities"}),r.jsx("li",{children:"• Improved task management system"}),r.jsx("li",{children:"• New gamification features"}),r.jsx("li",{children:"• Enhanced reporting and analytics"})]})]}),r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Performance Improvements"}),r.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[r.jsx("li",{children:"• Faster page loading times"}),r.jsx("li",{children:"• Better mobile responsiveness"}),r.jsx("li",{children:"• Improved accessibility features"}),r.jsx("li",{children:"• Enhanced security measures"})]})]}),r.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[r.jsx("h5",{className:"font-medium text-purple-800 mb-2",children:"Coming Soon"}),r.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[r.jsx("li",{children:"• Advanced workflow automation"}),r.jsx("li",{children:"• Integration with external systems"}),r.jsx("li",{children:"• Enhanced mobile app features"}),r.jsx("li",{children:"• More customization options"})]})]})]})})]}),Uv=({onBack:s})=>r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Sterilization Workflow"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Sterilization processes and procedures"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsx("div",{className:"text-center text-gray-500 py-8",children:r.jsx("p",{children:"Sterilization workflow content coming soon."})})})]}),Hv=({onBack:s})=>r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Reporting and Compliance"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Documentation and regulatory compliance procedures"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsx("div",{className:"text-center text-gray-500 py-8",children:r.jsx("p",{children:"Reporting and compliance content coming soon."})})})]}),Vv=({onBack:s})=>r.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-200",children:"← Back"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"BI Testing"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Biological indicator testing protocols"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-hide",children:r.jsx("div",{className:"text-center text-gray-500 py-8",children:r.jsx("p",{children:"BI testing content coming soon."})})})]}),Wv=({selectedHelpType:s,currentContext:e,expandedMetrics:t,expandedTasks:n,expandedGamification:a,expandedRelevant:i,onOptionClick:c,onBack:l,onFeedbackSuccess:o,onToggleMetricSection:d,onToggleTaskSection:u,onToggleGamificationSection:h,onToggleRelevantSection:p,onSetHelpType:f})=>{if(!s)return r.jsx(Jo,{onOptionClick:c});switch(s){case"ai-chat":return r.jsx(Cv,{currentContext:e,onBack:l});case"context-help":return r.jsx(Iv,{currentContext:e,expandedRelevant:i,onToggleRelevantSection:p,onBack:l});case"product-feedback":return r.jsx(Pv,{onBack:l,onSuccess:o});case"onboarding":return r.jsx(Rv,{onBack:l});case"cliniio-help":return r.jsx(Av,{currentContext:e,onBack:l,onSetHelpType:f});case"performance-metrics":return r.jsx($v,{onBack:l,expandedMetrics:t,onToggleMetricSection:d,onSetHelpType:f});case"task-management":return r.jsx(Fv,{onBack:l,onSetHelpType:f,expandedTasks:n,onToggleTaskSection:u});case"gamification":return r.jsx(Lv,{onBack:l,onSetHelpType:f,expandedGamification:a,onToggleGamificationSection:h});case"ai-features":return r.jsx(Bv,{onBack:l});case"new-features":return r.jsx(qv,{onBack:l});case"bi-testing":return r.jsx(Vv,{onBack:l});case"sterilization-workflow":return r.jsx(Uv,{onBack:l});case"reporting-compliance":return r.jsx(Hv,{onBack:l});default:return r.jsx(Jo,{onOptionClick:c})}},Gv=({isDrawerOpen:s,onClose:e})=>{const{selectedHelpType:t,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,currentContext:l,handleOptionClick:o,handleBack:d,handleFeedbackSuccess:u,toggleMetricSection:h,toggleTaskSection:p,toggleGamificationSection:f,toggleRelevantSection:y,setHelpType:g}=xy(e),x=()=>r.jsx(Wv,{selectedHelpType:t,currentContext:l,expandedMetrics:n,expandedTasks:a,expandedGamification:i,expandedRelevant:c,onOptionClick:o,onBack:d,onFeedbackSuccess:u,onToggleMetricSection:h,onToggleTaskSection:p,onToggleGamificationSection:f,onToggleRelevantSection:y,onSetHelpType:g});return s?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:e,onKeyDown:b=>b.key==="Escape"&&e(),role:"button",tabIndex:0,"aria-label":"Close help drawer"}),r.jsxs("div",{className:"fixed top-0 right-0 h-screen w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out flex flex-col",children:[r.jsx("div",{className:"flex items-center p-4 border-b border-gray-200 bg-[#4ECDC4] text-white",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-white text-sm font-bold",children:"?"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-bold",children:"Help & Support"}),r.jsx("p",{className:"text-xs text-white text-opacity-90",children:"Choose how you'd like to get help"})]})]})}),x()]})]}):null},Kv=()=>{const[s,e]=m.useState(!1),t=()=>{e(!s)},n=()=>{e(!1)};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:r.jsx("button",{onClick:t,className:"w-14 h-14 bg-transparent text-gray-700 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 relative flex items-center justify-center","aria-label":"Get AI help and assistance",title:"AI Help & Assistant",children:r.jsx("span",{className:"text-6xl",children:"🛟"})})}),r.jsx(Gv,{isDrawerOpen:s,onClose:n})]})},Hr=({children:s})=>{const{isDrawerOpen:e,openDrawer:t,closeDrawer:n}=Su();return r.jsx(Es,{children:r.jsxs(m.Suspense,{fallback:r.jsx(Eh,{size:"lg"}),children:[r.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-blue-50 to-teal-50",children:[r.jsx(yy,{isOpen:e,onOpen:t,onClose:n}),r.jsx("div",{className:"flex-1",children:r.jsx("div",{className:"pt-6",children:s})})]}),r.jsx(Kv,{})]})})},ya=["Welcome back, sterilization superstar! ✨","Hey there, inventory rockstar! 🎸","The clinic's MVP is back in action! 🏆","Welcome to another day of medical excellence! 🌟","Ready to tackle some sterilization challenges? 💪","Back in the clinic and ready to shine! ✨","Time to make those tools gleam! ✨","Welcome back! The tools missed you! 🔧","Let's make today spotlessly successful! ✨","Ready to master the medical inventory? 📋","The sterilization superstar has arrived! 🌟","Let's make those tools SHINE today! ✨","Welcome back to your sterilization kingdom! 👑","Ready to conquer today's challenge? Let's do this! 🏅","Another day, another challenge to crush! 🚀","Your daily challenge awaits—show it who's boss! 💪","Inventory hero reporting for duty! 📦","Let's keep those supplies in tip-top shape! 🗂️","Inventory wizardry in progress—abracadabra! 🧙‍♂️","Time to check off those tasks like a pro! ✅","Taskmaster mode: activated! 🕹️","Let's make that to-do list disappear! ✨","Sparkle squad, assemble! 🧽","Let's make every room shine bright! 💡","Clean team, ready for action! 🦸‍♀️","Knowledge quest begins now! 📚","Time to level up your skills! 🎮","Learning legend in the house! 🏆"],Qv=()=>{const[s,e]=m.useState(ya[0]);return m.useEffect(()=>{const t=Math.floor(Math.random()*ya.length);e(ya[t])},[]),r.jsx("h1",{className:"text-xl md:text-2xl font-bold text-[#5b5b5b] mb-2",children:s})},Fu=({content:s,children:e,className:t=""})=>{const[n,a]=m.useState(!1);return r.jsxs("div",{className:`relative inline-block ${t}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[e,n&&r.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50",children:r.jsx("div",{className:"bg-white text-gray-700 text-xs font-medium px-3 py-2 rounded-lg shadow-lg border border-gray-200 text-center whitespace-pre-line",children:s})})]})},Yv=[{icon:kh,bg:"teal",label:"Cumulative Stats",description:`Performance
Statistics`},{icon:ti,bg:"purple",label:"Leaderboard",description:`Team
Rankings`},{icon:su,bg:"blue",label:"Daily Challenge",description:`Daily
Challenge`}],Jv=({onStatsClick:s,onLeaderboardClick:e,onChallengeClick:t})=>{const n=(a,i)=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),i==null||i())};return r.jsxs("header",{className:"mb-6 pl-8","aria-label":"Dashboard header",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(Qv,{}),r.jsx("nav",{className:"flex gap-4 pr-8",role:"navigation","aria-label":"Dashboard actions",children:Yv.map(a=>{const i=a.label==="Cumulative Stats"?s:a.label==="Leaderboard"?e:a.label==="Daily Challenge"?t:void 0;return r.jsx(Fu,{content:a.description,children:r.jsx("button",{className:`rounded-xl w-12 h-12 flex items-center justify-center transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 ${a.label==="Cumulative Stats"?"bg-purple-100 focus:ring-purple-500":a.label==="Leaderboard"?"bg-amber-100 focus:ring-amber-500":"bg-blue-100 focus:ring-blue-500"}`,"aria-label":`${a.label}: ${a.description}`,onClick:i,onKeyDown:c=>n(c,i),tabIndex:0,children:r.jsx(I,{path:a.icon,size:1.1,"aria-hidden":"true",color:a.label==="Cumulative Stats"?"#9333ea":a.label==="Leaderboard"?"#d97706":"#2563eb"})})},a.label)})})]}),r.jsx("p",{className:"text-sm text-gray-500",role:"status","aria-live":"polite",children:"Here's your impact and progress for today."})]})},Ae={NAV_BAR_MARGIN_TOP:4,NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:24,NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED:72,COLORS:{PRIMARY:"#4ECDC4",PRIMARY_BG:"teal-100",BORDER:"teal-400",BG_GRADIENT:{FROM:"blue-50",TO:"teal-50"}},SPACING:{PADDING:6,MARGIN_TOP:6},BORDER:{LEFT_WIDTH:4},taskCard:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50",sectionBox:"bg-white rounded-lg shadow-md p-6 border-l-4 border-[#4ECDC4] border-opacity-50"},Xv=s=>{const e=s?Ae.NAV_BAR_MARGIN_LEFT_DRAWER_OPEN:Ae.NAV_BAR_MARGIN_LEFT_DRAWER_CLOSED,t=Ae.NAV_BAR_MARGIN_TOP;return{navBarMarginLeft:e,navBarMarginTop:t}};function Zv(){return or(Ae.sectionBox,"mb-4")}function va(){return or(Ae.taskCard,"mb-4")}var ex=Object.defineProperty,_l=Object.getOwnPropertySymbols,tx=Object.prototype.hasOwnProperty,rx=Object.prototype.propertyIsEnumerable,wl=(s,e,t)=>e in s?ex(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Sl=(s,e)=>{for(var t in e||(e={}))tx.call(e,t)&&wl(s,t,e[t]);if(_l)for(var t of _l(e))rx.call(e,t)&&wl(s,t,e[t]);return s};const Pi=Ft(s=>({totalScore:0,availablePoints:0,showFilters:!1,showLeaderboardModal:!1,showStatsModal:!1,showChallengeModal:!1,leaderboardUsers:[],tasks:[],gamificationData:{totalScore:0,level:1,totalPoints:0,streak:0,rank:100,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}},drawerOpen:!0,loading:!1,taskError:null,setTotalScore:e=>s({totalScore:e}),setAvailablePoints:e=>s({availablePoints:e}),setShowFilters:e=>s({showFilters:e}),setShowLeaderboardModal:e=>s({showLeaderboardModal:e}),setShowStatsModal:e=>s({showStatsModal:e}),setShowChallengeModal:e=>s({showChallengeModal:e}),setLeaderboardUsers:e=>s({leaderboardUsers:e}),setTasks:e=>s({tasks:e}),setGamificationData:e=>s({gamificationData:e}),updateGamificationData:e=>{ht(),s(t=>({gamificationData:Sl(Sl({},t.gamificationData),e)}))},setDrawerOpen:e=>s({drawerOpen:e}),setLoading:e=>s({loading:e}),setTaskError:e=>s({taskError:e})}));var sx=Object.defineProperty,nx=Object.defineProperties,ax=Object.getOwnPropertyDescriptors,Cl=Object.getOwnPropertySymbols,ix=Object.prototype.hasOwnProperty,ox=Object.prototype.propertyIsEnumerable,jl=(s,e,t)=>e in s?sx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,lx=(s,e)=>{for(var t in e||(e={}))ix.call(e,t)&&jl(s,t,e[t]);if(Cl)for(var t of Cl(e))ox.call(e,t)&&jl(s,t,e[t]);return s},cx=(s,e)=>nx(s,ax(e)),Me=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class dx{constructor(){this.cachedStats=null,this.cacheTimestamp=0,this.CACHE_DURATION=3e4,this.lastLogTime=0}getCachedUser(){return Me(this,null,function*(){try{const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{userId:t,facilityId:n}=yield e.getCurrentUserAndFacility();return{id:t,facility_id:n}}catch(e){return console.error("Failed to get cached user:",e),null}})}fetchCumulativeStats(){return Me(this,null,function*(){console.log("🔍 statsService: fetchCumulativeStats called");const e=Date.now();if(this.cachedStats&&e-this.cacheTimestamp<this.CACHE_DURATION)return console.log("📊 statsService: Returning cached stats"),this.cachedStats;try{const t=yield this.getCachedUser();if(console.log("👤 statsService: Got user:",t),!t)return R.debug("statsService: No authenticated user found, returning default stats"),this.getDefaultStats();R.debug("statsService: Fetching cumulative stats for user:",t.id);const n=yield this.getCurrentUserFacilityId();if(!n)return R.debug("statsService: No facility ID found, returning default stats"),this.getDefaultStats();R.debug("statsService: Querying for user_id:",t.id,"facility_id:",n),console.log("🔍 statsService: Trying to fetch from gamification table for facility:",n);const a=yield this.fetchGamificationStatsFromTable(n);if(a)return console.log("✅ statsService: Found gamification stats in database:",a),this.cachedStats=a,this.cacheTimestamp=e,a;console.log("❌ statsService: No gamification stats found, falling back to calculations");const i=yield this.calculateStatsFromExistingTables(t.id,n),c=yield this.calculateStreakFromActivity(t.id,n),l=cx(lx({},i),{currentStreak:c.currentStreak,bestStreak:c.bestStreak});return e-this.lastLogTime>1e3&&(R.debug("statsService: Calculated stats:",l),this.lastLogTime=e),this.cachedStats=l,this.cacheTimestamp=e,l}catch(t){return console.error("Error in fetchCumulativeStats:",t),this.getDefaultStats()}})}fetchGamificationStatsFromTable(e){return Me(this,null,function*(){try{console.log("🔍 Fetching gamification stats for facility:",e);const{data:t,error:n}=yield _.from("user_gamification_stats").select("*").eq("facility_id",e).single();if(console.log("📊 Gamification stats query result:",{data:t,error:n}),n||!t)return R.debug("statsService: No gamification stats found in database"),null;const a={toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:t.total_tasks||0,completedTasks:t.completed_tasks||0,currentStreak:t.current_streak||0,bestStreak:t.best_streak||0,totalPoints:t.total_points||0,challengesCompleted:0,totalChallenges:0};return console.log("✅ Converted gamification stats:",a),a}catch(t){return console.error("❌ Error fetching gamification stats from table:",t),null}})}calculateStatsFromExistingTables(e,t){return Me(this,null,function*(){try{const n=yield this.fetchSterilizationStats(),a=yield this.fetchInventoryStats(t),i=yield this.fetchActivityStats(e,t),c=yield this.calculateStreakFromActivity(e,t);let l=null;try{const{calculateEnhancedLevel:o}=yield q(()=>import("./enhancedGamification-YRW8WA9o.js"),__vite__mapDeps([7,1,2,3,4,5]));l=yield o(e,t)}catch(o){console.error(o)}return{toolsSterilized:n.toolsSterilized,inventoryChecks:a.inventoryChecks,perfectDays:i.perfectDays,totalTasks:i.totalTasks,completedTasks:i.completedTasks,currentStreak:c.currentStreak,bestStreak:c.bestStreak,totalPoints:i.totalPoints,challengesCompleted:i.challengesCompleted,totalChallenges:i.totalChallenges,enhancedLevel:l||void 0}}catch(n){return console.error("Error calculating stats from existing tables:",n),this.getDefaultStats()}})}calculateStatsFromCompletions(e,t){return Me(this,null,function*(){const n=e.reduce((h,p)=>h+(p.points_earned||0),0),a=e.length,i=e.filter(h=>h.completion_type==="daily_task").length,c=a-i,l=this.calculateCategoryStats(e),o=yield this.calculateStreak(e),d=yield this.fetchSterilizationStats();let u=null;try{const{data:{user:h}}=yield _.auth.getUser();if(h){const{calculateEnhancedLevel:p}=yield q(()=>import("./enhancedGamification-YRW8WA9o.js"),__vite__mapDeps([7,1,2,3,4,5])),f=yield this.getCurrentUserFacilityId();u=yield p(h.id,f||"")}}catch(h){console.error(h)}return{toolsSterilized:d.toolsSterilized,inventoryChecks:l.quality,perfectDays:Math.floor(a/3),totalTasks:t+i,completedTasks:a,currentStreak:o.currentStreak,bestStreak:o.bestStreak,totalPoints:n,challengesCompleted:c,totalChallenges:t,enhancedLevel:u||void 0}})}fetchSterilizationStats(){return Me(this,null,function*(){try{if(!(yield this.getCachedUser()))return{toolsSterilized:0};const t=yield this.getCurrentUserFacilityId();if(!t)return{toolsSterilized:0};const{data:n,error:a}=yield _.from("sterilization_cycles").select("id").eq("facility_id",t).eq("status","completed");return a?(console.error("Error fetching sterilization stats:",a),{toolsSterilized:0}):{toolsSterilized:(n==null?void 0:n.length)||0}}catch(e){return console.error("Error in fetchSterilizationStats:",e),{toolsSterilized:0}}})}fetchInventoryStats(e){return Me(this,null,function*(){try{const{data:t,error:n}=yield _.from("inventory_items").select("id").eq("facility_id",e).not("updated_at","is",null);return n?(console.error("Error fetching inventory stats:",n),{inventoryChecks:0}):{inventoryChecks:(t==null?void 0:t.length)||0}}catch(t){return console.error("Error in fetchInventoryStats:",t),{inventoryChecks:0}}})}fetchActivityStats(e,t){return Me(this,null,function*(){try{const{data:n,error:a}=yield _.from("home-daily_operations_tasks").select("*").eq("facility_id",t).gte("created_at",new Date(Date.now()-2592e6).toISOString());if(a)return console.error("Error fetching task stats:",a),{perfectDays:0,totalTasks:0,completedTasks:0,totalPoints:0,challengesCompleted:0,totalChallenges:0};const i=(n==null?void 0:n.length)||0,c=(n==null?void 0:n.filter(u=>u.completed).length)||0,l=(n==null?void 0:n.reduce((u,h)=>{if(h.completed){const p=new Date(h.completed_at||h.created_at).toDateString();u[p]=(u[p]||0)+1}return u},{}))||{},o=Object.values(l).filter(u=>u>=3).length,d=(n==null?void 0:n.reduce((u,h)=>u+(h.completed&&h.points||0),0))||0;return{perfectDays:o,totalTasks:i,completedTasks:c,totalPoints:d,challengesCompleted:c,totalChallenges:i}}catch(n){return console.error("Error in fetchActivityStats:",n),{perfectDays:0,totalTasks:0,completedTasks:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}}})}calculateStreakFromActivity(e,t){return Me(this,null,function*(){try{const{data:n,error:a}=yield _.from("activity_feed").select("created_at").eq("user_id",e).eq("facility_id",t).gte("created_at",new Date(Date.now()-7776e6).toISOString()).order("created_at",{ascending:!1});if(a||!n)return{currentStreak:0,bestStreak:0};const i=n.reduce((u,h)=>{const p=new Date(h.created_at).toDateString();return u[p]||(u[p]=[]),u[p].push(h),u},{}),c=Object.keys(i).sort().reverse();let l=0,o=0,d=0;for(const u of c)i[u].length>0?(d++,l===0&&(l=d)):(o=Math.max(o,d),d=0);return o=Math.max(o,d),{currentStreak:Math.max(l,0),bestStreak:Math.max(o,0)}}catch(n){return console.error("Error calculating streak from activity:",n),{currentStreak:0,bestStreak:0}}})}calculateCategoryStats(e){const t={knowledge:0,process:0,quality:0,collaboration:0,daily:0,team:0};return e.forEach(n=>{const a=n.home_challenges,i=a==null?void 0:a.category;i&&Object.prototype.hasOwnProperty.call(t,i)&&t[i]++}),t}calculateStreak(e){return Me(this,null,function*(){if(e.length===0)return{currentStreak:0,bestStreak:0};const t=yield this.getCurrentUserFacilityId();if(!t)return this.calculateBasicStreak(e);const n=e.map(o=>new Date(o.completed_at)).sort((o,d)=>d.getTime()-o.getTime());let a=0,i=0,c=0;const l=new Date;l.setHours(0,0,0,0);for(let o=0;o<n.length;o++){const d=new Date(n[o]);if(d.setHours(0,0,0,0),o===0)Math.floor((l.getTime()-d.getTime())/864e5)<=1&&((yield this.shouldExcludeDateFromStreak(d,t))||(a=1,c=1));else{const u=new Date(n[o-1]);u.setHours(0,0,0,0),Math.floor((u.getTime()-d.getTime())/(1e3*60*60*24))===1?(yield this.shouldExcludeDateFromStreak(d,t))?c=0:(c++,(o===0||a>0)&&(a=c)):c=1}i=Math.max(i,c)}return{currentStreak:a,bestStreak:i}})}calculateBasicStreak(e){if(e.length===0)return{currentStreak:0,bestStreak:0};const t=e.map(l=>new Date(l.completed_at)).sort((l,o)=>o.getTime()-l.getTime());let n=0,a=0,i=0;const c=new Date;c.setHours(0,0,0,0);for(let l=0;l<t.length;l++){const o=new Date(t[l]);if(o.setHours(0,0,0,0),l===0)Math.floor((c.getTime()-o.getTime())/864e5)<=1&&(n=1,i=1);else{const d=new Date(t[l-1]);d.setHours(0,0,0,0),Math.floor((d.getTime()-o.getTime())/(1e3*60*60*24))===1?(i++,(l===0||n>0)&&(n=i)):i=1}a=Math.max(a,i)}return{currentStreak:n,bestStreak:a}}shouldExcludeDateFromStreak(e,t){return Me(this,null,function*(){const{shouldExcludeDateFromStreak:n}=yield q(()=>import("./streakExclusionUtils-BvcmMtsM.js"),__vite__mapDeps([8,1,2,3,4,5]));return n(e,t)})}getCurrentUserFacilityId(){return Me(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)return null;const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single();return(t==null?void 0:t.facility_id)||null}catch(e){return console.error("Error getting user facility ID:",e),null}})}getDefaultStats(){return{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}}}const zu=new dx;var ux=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Lu=()=>{const[s,e]=m.useState({toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0,totalPoints:0,challengesCompleted:0,totalChallenges:0}),[t,n]=m.useState(!0),[a,i]=m.useState(null),c=m.useCallback(()=>ux(null,null,function*(){try{n(!0),i(null);const o=yield zu.fetchCumulativeStats();e(o)}catch(o){console.error("Error fetching cumulative stats:",o),i(o instanceof Error?o.message:"Failed to fetch stats")}finally{n(!1)}}),[]);m.useEffect(()=>{c()},[c]);const l=m.useCallback(()=>{c()},[c]);return{stats:s,loading:t,error:a,refreshStats:l}},mx=({isOpen:s,onClose:e,gamificationData:t})=>{const{stats:n,loading:a,error:i,refreshStats:c}=Lu(),l=(t==null?void 0:t.stats)||{toolsSterilized:n.toolsSterilized,inventoryChecks:n.inventoryChecks,perfectDays:n.perfectDays,totalTasks:n.totalTasks,completedTasks:n.completedTasks,currentStreak:n.currentStreak,bestStreak:n.bestStreak};return r.jsx(zn,{children:s&&r.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:r.jsxs(se.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:o=>o.stopPropagation(),children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:r.jsx(I,{path:Lr,size:.9,className:"text-white"})}),r.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:"Cumulative Stats"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:c,disabled:a,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg disabled:opacity-50",title:"Refresh stats",children:r.jsx(I,{path:it,size:.9,className:a?"animate-spin":""})}),r.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 p-1 min-h-[36px] flex items-center justify-center rounded-lg",children:r.jsx(I,{path:Pe,size:.9})})]})]}),i&&r.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[r.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Stats"}),r.jsx("div",{className:"text-red-500 text-xs mt-1",children:i})]}),r.jsxs("div",{className:"space-y-3",children:[a&&r.jsxs("div",{className:"text-center py-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4ECDC4] mx-auto"}),r.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading stats..."})]}),!a&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-[#4ECDC4] bg-opacity-10 p-3 rounded-xl",children:[r.jsx("div",{className:"mb-0.5 text-[#4ECDC4] font-semibold text-sm",children:"Tools Sterilized"}),r.jsx("div",{className:"text-2xl font-bold text-[#4ECDC4]",children:l.toolsSterilized}),r.jsx("div",{className:"text-xs text-[#4ECDC4] mt-0.5",children:"That's impressive!"})]}),r.jsxs("div",{className:"bg-blue-50 p-3 rounded-xl",children:[r.jsx("div",{className:"mb-0.5 text-blue-600 font-semibold text-sm",children:"Inventory Checks"}),r.jsx("div",{className:"text-2xl font-bold text-blue-700",children:l.inventoryChecks}),r.jsx("div",{className:"text-xs text-blue-500 mt-0.5",children:"Always organized!"})]}),r.jsxs("div",{className:"bg-green-50 p-3 rounded-xl",children:[r.jsx("div",{className:"mb-0.5 text-green-600 font-semibold text-sm",children:"Perfect Days"}),r.jsx("div",{className:"text-2xl font-bold text-green-700",children:l.perfectDays}),r.jsx("div",{className:"text-xs text-green-500 mt-0.5",children:"Zero errors!"})]}),r.jsxs("div",{className:"bg-purple-50 p-3 rounded-xl",children:[r.jsx("div",{className:"mb-0.5 text-purple-600 font-semibold text-sm",children:"Task Completion"}),r.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[l.totalTasks>0?Math.round(l.completedTasks/l.totalTasks*100):0,"%"]}),r.jsxs("div",{className:"text-xs text-purple-500 mt-0.5",children:[l.completedTasks," / ",l.totalTasks," tasks completed"]})]}),r.jsxs("div",{className:"bg-amber-50 p-3 rounded-xl",children:[r.jsx("div",{className:"mb-0.5 text-amber-600 font-semibold text-sm",children:"Current Streak"}),r.jsx("div",{className:"text-2xl font-bold text-amber-700",children:l.currentStreak}),r.jsxs("div",{className:"text-xs text-amber-500 mt-0.5",children:["Best streak: ",l.bestStreak]})]})]})]})]})})})},hx=({isOpen:s,onClose:e,gamificationData:t,loading:n=!1,error:a=null})=>{const i={rank:(t==null?void 0:t.rank)||1,topUsers:(t==null?void 0:t.topUsers)||[]};return r.jsx(zn,{children:s&&r.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:r.jsxs(se.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-6 rounded-xl shadow-xl max-w-md w-full mx-4",onClick:c=>c.stopPropagation(),children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-blue-500 rounded-xl",children:r.jsx(I,{path:ti,size:1,className:"text-white"})}),r.jsx("h2",{className:"ml-3 text-xl font-bold text-[#5b5b5b]",children:"Office Leaderboard"})]}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:r.jsx(I,{path:Pe,size:1})})]}),r.jsxs("div",{className:"flex items-center justify-between mb-4 bg-blue-50 p-3 rounded-lg",children:[r.jsx("div",{className:"text-blue-700 font-medium",children:"Your Rank"}),r.jsxs("div",{className:"flex items-center",children:[r.jsxs("span",{className:"text-xl font-bold text-blue-700 mr-1",children:["#",i.rank]}),r.jsx("span",{className:"text-blue-500 text-sm",children:"/15"})]})]}),a&&r.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-xl mb-3",children:[r.jsx("div",{className:"text-red-600 text-sm font-semibold",children:"Error Loading Leaderboard"}),r.jsx("div",{className:"text-red-500 text-xs mt-1",children:a})]}),r.jsxs("div",{className:"space-y-3",children:[n&&r.jsxs("div",{className:"text-center py-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),r.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading leaderboard..."})]}),!n&&!a&&i.topUsers.map((c,l)=>r.jsxs(se.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:l*.2+.2},className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-semibold",children:c.avatar}),l===0&&r.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center",children:r.jsx(I,{path:ti,size:.4,className:"text-white"})})]}),r.jsxs("div",{className:"ml-3",children:[r.jsx("div",{className:"text-sm font-semibold text-gray-700",children:c.full_name}),r.jsxs("div",{className:"text-xs text-gray-500",children:["Rank #",l+1]})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"text-lg font-bold text-[#4ECDC4]",children:c.score}),r.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"pts"})]})]},c.id||c.full_name))]})]})})})},px=X.memo(hx),Ri={TASKS:"Daily Operations Tasks",STATS:"Stats Overview",CHALLENGES:"Today's Challenge"};var br=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class fx{constructor(){this.lastLogTime=0,this.lastRawLogTime=0}getCachedUser(){return br(this,null,function*(){const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{userId:t,facilityId:n}=yield e.getCurrentUserAndFacility();if(!t||!n)throw new Error("No authenticated user or facility for challengeService");return{id:t,facility_id:n}})}getCachedUserOld(){return br(this,null,function*(){const{data:{user:e}}=yield _.auth.getUser();if(!e||!(yield _.auth.getSession()).data.session)return null;const{data:n,error:a}=yield _.from("users").select("id, facility_id").eq("id",e.id).single();if(a){console.error("Error fetching user profile:",a),console.log("Creating user profile for:",e.id);const{FacilityService:i}=yield q(()=>Promise.resolve().then(()=>ge),void 0),c=yield i.getCurrentFacilityId(),{data:l,error:o}=yield _.from("users").insert({id:e.id,email:e.email,facility_id:c,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select("id, facility_id").single();return o?(console.error("Error creating user profile:",o),null):l}return n})}fetchChallenges(){return br(this,null,function*(){try{const e=yield this.getCachedUser();if(!e)return R.debug("challengeService: No authenticated user found, returning empty array"),[];R.debug("challengeService: Fetching challenges for facility:",e.facility_id);const{data:t,error:n}=yield _.from("home_challenges").select("*").eq("facility_id",e.facility_id).order("created_at",{ascending:!1});if(n)return console.error("Error fetching challenges:",n),[];const a=Date.now();a-this.lastRawLogTime>1e3&&(R.debug("challengeService: Raw challenges data:",t),this.lastRawLogTime=a);const i=t.map(o=>({id:o.id,title:o.title,description:o.description,category:o.category,difficulty:o.difficulty,points:o.points,timeEstimate:o.time_estimate,completed:!1})),c=yield this.getUserCompletedChallenges(),l=new Set(c.map(o=>o.challenge_id));return i.forEach(o=>{o.completed=l.has(o.id)}),a-this.lastLogTime>1e3&&(R.debug("challengeService: Transformed challenges:",i),this.lastLogTime=a),i}catch(e){return console.error("Error in fetchChallenges:",e),[]}})}getUserCompletedChallenges(){return br(this,null,function*(){try{const e=yield this.getCachedUser();if(!e)return R.debug("challengeService: No authenticated user found for completed challenges"),[];const{data:t,error:n}=yield _.from("home_challenge_completions").select("*").eq("user_id",e.id).eq("facility_id",e.facility_id).order("completed_at",{ascending:!1});return n?(console.error("Error fetching completed challenges:",n),[]):t||[]}catch(e){return console.error("Error in getUserCompletedChallenges:",e),[]}})}completeChallenge(e){return br(this,null,function*(){try{const t=yield this.getCachedUser();if(!t)return console.error("challengeService: No authenticated user found for challenge completion"),!1;const{data:n,error:a}=yield _.from("home_challenge_completions").insert({challenge_id:e.challenge_id,user_id:t.id,facility_id:t.facility_id,points_earned:e.points_earned}).select().single();return a?(console.error("Error completing challenge:",a),!1):(R.debug("challengeService: Challenge completed successfully:",n),!0)}catch(t){return console.error("Error in completeChallenge:",t),!1}})}createChallenge(e){return br(this,null,function*(){try{const t=yield this.getCachedUser();if(!t)return console.error("challengeService: No authenticated user found for creating challenge"),null;const{data:n,error:a}=yield _.from("home_challenges").insert({title:e.title,description:e.description,category:e.category,difficulty:e.difficulty,points:e.points,time_estimate:e.timeEstimate,facility_id:t.facility_id,created_by:t.id}).select().single();return a?(console.error("Error creating challenge:",a),null):{id:n.id,title:n.title,description:n.description,category:n.category,difficulty:n.difficulty,points:n.points,timeEstimate:n.time_estimate,completed:!1}}catch(t){return console.error("Error in createChallenge:",t),null}})}}const Nl=new fx;var gx=Object.defineProperty,yx=Object.defineProperties,vx=Object.getOwnPropertyDescriptors,Il=Object.getOwnPropertySymbols,xx=Object.prototype.hasOwnProperty,bx=Object.prototype.propertyIsEnumerable,Tl=(s,e,t)=>e in s?gx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_x=(s,e)=>{for(var t in e||(e={}))xx.call(e,t)&&Tl(s,t,e[t]);if(Il)for(var t of Il(e))bx.call(e,t)&&Tl(s,t,e[t]);return s},wx=(s,e)=>yx(s,vx(e)),El=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Sx={knowledge:"bg-blue-100 text-blue-800",process:"bg-purple-100 text-purple-800",quality:"bg-green-100 text-green-800",collaboration:"bg-orange-100 text-orange-800",daily:"bg-gray-100 text-gray-800",team:"bg-pink-100 text-pink-800"},Cx={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"},jx=({isOpen:s,onClose:e,onChallengeComplete:t})=>{const[n,a]=m.useState("all"),[i,c]=m.useState("all"),[l,o]=m.useState("pending"),[d,u]=m.useState([]),[h,p]=m.useState(!0);m.useEffect(()=>{El(null,null,function*(){try{p(!0);const v=yield Nl.fetchChallenges();u(v)}catch(v){console.error("Error loading challenges:",v)}finally{p(!1)}})},[]);const f=[{id:"knowledge",icon:Dh,label:"Knowledge"},{id:"process",icon:Ph,label:"Process"},{id:"quality",icon:Rh,label:"Quality"},{id:"collaboration",icon:Yi,label:"Collaboration"},{id:"daily",icon:An,label:"Daily"},{id:"team",icon:Yi,label:"Team"}],y=[{id:"easy",label:"Easy",color:"text-green-500"},{id:"medium",label:"Medium",color:"text-yellow-500"},{id:"hard",label:"Hard",color:"text-red-500"}],g=d.filter(b=>{const v=n==="all"||b.category===n,w=i==="all"||b.difficulty===i,S=l==="all"||l==="pending"&&!b.completed||l==="completed"&&b.completed;return v&&w&&S}),x=b=>El(null,null,function*(){try{(yield Nl.completeChallenge({challenge_id:b.id,points_earned:b.points}))?(u(w=>w.map(S=>S.id===b.id?wx(_x({},S),{completed:!0}):S)),t(b.points)):console.error("Failed to complete challenge")}catch(v){console.error("Error completing challenge:",v)}});return r.jsx(zn,{children:s&&r.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:r.jsxs(se.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white p-4 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto scrollbar-hide",onClick:b=>b.stopPropagation(),children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 bg-[#4ECDC4] rounded-xl",children:r.jsx(I,{path:su,size:.9,className:"text-white"})}),r.jsx("h2",{className:"ml-2 text-lg font-bold text-[#5b5b5b]",children:Ri.CHALLENGES})]}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:r.jsx(I,{path:Pe,size:.9})})]}),r.jsxs("div",{className:"mb-4 flex gap-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Category"}),r.jsxs("select",{value:n,onChange:b=>a(b.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[r.jsx("option",{value:"all",children:"All Categories"}),f.map(b=>r.jsx("option",{value:b.id,children:b.label},b.id))]})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Difficulty"}),r.jsxs("select",{value:i,onChange:b=>c(b.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[r.jsx("option",{value:"all",children:"All Difficulties"}),y.map(b=>r.jsx("option",{value:b.id,children:b.label},b.id))]})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Status"}),r.jsxs("select",{value:l,onChange:b=>o(b.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:border-transparent text-sm",children:[r.jsx("option",{value:"all",children:"All Challenges"}),r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"completed",children:"Completed"})]})]})]}),r.jsx("div",{className:"space-y-3",children:h?r.jsx("div",{className:"text-center py-8",children:r.jsx("div",{className:"text-gray-500",children:"Loading challenges..."})}):g.length===0?r.jsx("div",{className:"text-center py-8",children:r.jsx("div",{className:"text-gray-500",children:"No challenges available"})}):g.map(b=>r.jsx("div",{className:`p-3 rounded-lg border ${b.completed?"bg-gray-50 border-gray-200":"bg-white border-gray-200 hover:border-[#4ECDC4]"}`,children:r.jsx("div",{className:"flex justify-between items-start",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Sx[b.category]}`,children:b.category}),r.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Cx[b.difficulty]}`,children:b.difficulty}),r.jsx("span",{className:"text-xs text-gray-500",children:b.timeEstimate})]}),r.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-0.5",children:b.title}),r.jsx("p",{className:"text-xs text-gray-600 mb-2",children:b.description}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-xs font-medium text-[#4ECDC4]",children:[b.points," points"]}),!b.completed&&r.jsx("button",{onClick:()=>x(b),className:"px-3 py-1 bg-[#4ECDC4] text-white text-xs rounded-lg hover:bg-[#38b2ac] transition-colors",children:"Complete"}),b.completed&&r.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[r.jsx(I,{path:Ah,size:.8,className:"mr-1"}),"Completed"]})]})]})})},b.id))})]})})})};var Nx=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Ix{getCachedUser(){return null}fetchLeaderboardData(){return Nx(this,null,function*(){var e,t;try{const n=yield this.getCachedUser();if(!n)return R.debug("leaderboardService: No authenticated user found, returning empty data"),{users:[],userRank:1,totalUsers:0};R.debug("leaderboardService: Fetching leaderboard data for facility:",n.facility_id);const{data:a,error:i}=yield _.from("home_challenge_completions").select(`
          user_id,
          points_earned
        `).eq("facility_id",n.facility_id);if(i)return console.error("Error fetching leaderboard data:",i),{users:[],userRank:1,totalUsers:0};const c=new Map;a==null||a.forEach(h=>{const p=h.user_id,f=h.points_earned||0;c.has(p)?c.get(p).points+=f:c.set(p,{points:f})});const l=Array.from(c.entries()).map(([h,p])=>({id:h,name:`User ${h.slice(0,8)}`,score:p.points,rank:0,avatar:"👤"})).sort((h,p)=>p.score-h.score);let o=1,d=((e=l[0])==null?void 0:e.score)||0;l.forEach((h,p)=>{h.score<d&&(o=p+1,d=h.score),h.rank=o});const u=((t=l.find(h=>h.id===n.id))==null?void 0:t.rank)||1;return R.debug("leaderboardService: Calculated leaderboard:",{totalUsers:l.length,userRank:u,topUsers:l.slice(0,5)}),{users:l,userRank:u,totalUsers:l.length}}catch(n){return console.error("Error in fetchLeaderboardData:",n),{users:[],userRank:1,totalUsers:0}}})}}const Bu=new Ix,Tx=({isStatsOpen:s,onStatsClose:e,isLeaderboardOpen:t,onLeaderboardClose:n,isChallengeOpen:a,onChallengeClose:i,gamificationData:c,leaderboardRank:l,leaderboardTopUsers:o,leaderboardLoading:d=!1,leaderboardError:u=null})=>{const[h,p]=m.useState({rank:l,topUsers:o}),[f,y]=m.useState(!1),[g,x]=m.useState(null);m.useEffect(()=>{t&&o.length===0&&(y(!0),x(null),Bu.fetchLeaderboardData().then(v=>{var w;p({rank:v.userRank||1,topUsers:((w=v.users)==null?void 0:w.map(S=>({id:S.id,name:S.full_name||"Anonymous",score:S.score||0,avatar:S.avatar||"👤"})))||[]})}).catch(v=>{x(v.message||"Failed to load leaderboard")}).finally(()=>{y(!1)}))},[t,o.length]);const b={stats:c.stats||{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}};return r.jsxs(r.Fragment,{children:[s&&r.jsx(mx,{isOpen:s,onClose:e,gamificationData:b}),r.jsx(px,{isOpen:t,onClose:n,gamificationData:h,loading:f,error:g}),r.jsx(jx,{isOpen:a,onClose:i,onChallengeComplete:v=>{console.log("Challenge completed with points:",v)}})]})};function Ex(s){return m.useMemo(()=>!s||s.length===0?[]:s.slice().sort((e,t)=>t.score-e.score).slice(0,3),[s])}function kx({leaderboardData:s}){const{showStatsModal:e,setShowStatsModal:t,showLeaderboardModal:n,setShowLeaderboardModal:a,showChallengeModal:i,setShowChallengeModal:c,gamificationData:l}=Pi(),o=m.useMemo(()=>s.users||[],[s.users]),d=Ex(o),u=m.useMemo(()=>s.userRank||1,[s.userRank]),h=m.useMemo(()=>!s.users||s.users.length===0?[]:d.map(p=>({id:p.id,name:p.full_name||"Anonymous",score:p.score||0,rank:p.rank,avatar:p.avatar||"👤"})),[d,s.users]);return r.jsx(Tx,{isStatsOpen:e,onStatsClose:()=>t(!1),isLeaderboardOpen:n,onLeaderboardClose:()=>a(!1),isChallengeOpen:i,onChallengeClose:()=>c(!1),gamificationData:l,leaderboardRank:u,leaderboardTopUsers:h,leaderboardLoading:!1,leaderboardError:null})}var Dx=Object.defineProperty,kl=Object.getOwnPropertySymbols,Px=Object.prototype.hasOwnProperty,Rx=Object.prototype.propertyIsEnumerable,Dl=(s,e,t)=>e in s?Dx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ax=(s,e)=>{for(var t in e||(e={}))Px.call(e,t)&&Dl(s,t,e[t]);if(kl)for(var t of kl(e))Rx.call(e,t)&&Dl(s,t,e[t]);return s};const mt={maxTasksPerUser:3,enabledCategories:["equipment","compliance","operational","safety"],priorityThresholds:{low:1,medium:2,high:3,urgent:4},autoAssignment:!0,aiSensitivity:"medium"},Ox={urgent:4,high:3,medium:2,low:1},$x={equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]};function Mx(s){var e,t,n,a,i,c,l,o,d,u,h,p;return{maxTasksPerUser:(e=s.maxTasksPerUser)!=null?e:mt.maxTasksPerUser,enabledCategories:(t=s.enabledCategories)!=null?t:mt.enabledCategories,priorityThresholds:{low:(a=(n=s.priorityThresholds)==null?void 0:n.low)!=null?a:mt.priorityThresholds.low,medium:(c=(i=s.priorityThresholds)==null?void 0:i.medium)!=null?c:mt.priorityThresholds.medium,high:(o=(l=s.priorityThresholds)==null?void 0:l.high)!=null?o:mt.priorityThresholds.high,urgent:(u=(d=s.priorityThresholds)==null?void 0:d.urgent)!=null?u:mt.priorityThresholds.urgent},autoAssignment:(h=s.autoAssignment)!=null?h:mt.autoAssignment,aiSensitivity:(p=s.aiSensitivity)!=null?p:mt.aiSensitivity}}function Pl(s){return Ox[s]}function qu(s,e){const t=$x[e];return t?t.includes(s):!0}function xa(){return Ax({},mt)}var tn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Fx{calculateLevel(e){return e<100?1:e<250?2:e<500?3:e<750?4:e<1e3?5:Math.floor(Math.log(e/100)/Math.log(1.5))+5}calculatePointsToNextLevel(e,t){const n=this.getLevelThreshold(e+1);return Math.max(0,n-t)}getLevelThreshold(e){return e<=1?0:e<=5?[0,100,250,500,750,1e3][e-1]:Math.floor(100*Math.pow(1.5,e-5))}calculateUserRank(e,t){return tn(this,null,function*(){try{const{data:n,error:a}=yield _.from("home_challenge_completions").select("user_id, points_earned").eq("facility_id",t);if(a)return console.error("Error fetching facility users for ranking:",a),{rank:1,percentile:100};const i=new Map;n==null||n.forEach(u=>{const h=u.user_id,p=u.points_earned;i.set(h,(i.get(h)||0)+p)});const c=Array.from(i.entries()).sort(([,u],[,h])=>h-u),l=c.findIndex(([u])=>u===e),o=l===-1?c.length:l+1,d=Math.round((1-(o-1)/c.length)*100);return{rank:o,percentile:d}}catch(n){return console.error("Error calculating user rank:",n),{rank:1,percentile:100}}})}updateGamificationData(e){return tn(this,null,function*(){try{const{data:t,error:n}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e.userId).eq("facility_id",e.facilityId);if(n)throw console.error("Error fetching user completions:",n),n;const a=(t||[]).reduce((h,p)=>h+p.points_earned,0),i=this.calculateLevel(a),c=i+1,l=this.calculatePointsToNextLevel(i,a),{rank:o,percentile:d}=yield this.calculateUserRank(e.userId,e.facilityId),u={currentLevel:i,nextLevel:c,pointsToNextLevel:l,totalPoints:a,rank:o,rankPercentile:d};return R.info("Gamification update:",{userId:e.userId,pointsEarned:e.pointsEarned,totalPoints:a,currentLevel:i,rank:o,taskTitle:e.taskTitle}),u}catch(t){throw console.error("Error updating gamification data:",t),t}})}checkLevelUp(e,t,n){return tn(this,null,function*(){try{const{data:a,error:i}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e).eq("facility_id",t);if(i)return console.error("Error fetching user completions for level check:",i),!1;const c=(a||[]).reduce((d,u)=>d+u.points_earned,0),l=this.calculateLevel(n);return this.calculateLevel(c)>l}catch(a){return console.error("Error checking level up:",a),!1}})}getGamificationSummary(e,t){return tn(this,null,function*(){try{const{data:n,error:a}=yield _.from("home_challenge_completions").select("points_earned").eq("user_id",e).eq("facility_id",t);if(a)throw console.error("Error fetching gamification summary:",a),a;const i=(n||[]).reduce((h,p)=>h+p.points_earned,0),c=this.calculateLevel(i),l=c+1,o=this.calculatePointsToNextLevel(c,i),{rank:d,percentile:u}=yield this.calculateUserRank(e,t);return{currentLevel:c,nextLevel:l,pointsToNextLevel:o,totalPoints:i,rank:d,rankPercentile:u}}catch(n){throw console.error("Error getting gamification summary:",n),n}})}}const zx=new Fx;var Lx=Object.defineProperty,Rl=Object.getOwnPropertySymbols,Bx=Object.prototype.hasOwnProperty,qx=Object.prototype.propertyIsEnumerable,Al=(s,e,t)=>e in s?Lx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Uu=(s,e)=>{for(var t in e||(e={}))Bx.call(e,t)&&Al(s,t,e[t]);if(Rl)for(var t of Rl(e))qx.call(e,t)&&Al(s,t,e[t]);return s},Gn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function kt(){return`gap-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Ux(){return`task-${Date.now()}-${Math.random()}`}function Hx(){return`ai-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Vx(s,e){return Gn(this,null,function*(){try{for(const t of s)for(const n of t.tasks){const{error:a}=yield _.from("home_daily_operations_tasks").insert({facility_id:e,title:n.title,description:n.description,completed:!1,points:n.points,type:n.type,category:n.category,priority:n.priority,due_date:n.dueDate,estimated_duration:n.estimatedDuration,status:"pending",assigned_to:t.userId,created_by:st(t.userId)||t.userId,created_at:n.createdAt,updated_at:n.updatedAt});a&&console.error("Error creating daily task:",a)}}catch(t){throw console.error("Error creating daily tasks:",t),t}})}function Wx(s){return Gn(this,null,function*(){const{data:e,error:t}=yield _.from("home_daily_operations_tasks").select("*").eq("assigned_to",s).eq("status","pending").order("priority",{ascending:!1}).order("due_date",{ascending:!0});if(t)throw t;return(e||[]).map(n=>Uu({id:n.id},n))})}function Gx(s){return Gn(this,null,function*(){const{data:e,error:t}=yield _.from("home_daily_operations_tasks").select("*").eq("facility_id",s).eq("status","pending").order("priority",{ascending:!1}).order("due_date",{ascending:!0});if(t)throw t;return(e||[]).map(n=>Uu({id:n.id},n))})}function Kx(s,e){return Gn(this,null,function*(){try{const{data:t,error:n}=yield _.from("home_daily_operations_tasks").select("points, facility_id, title, category").eq("id",s).single();if(n||!t)throw new Error(`Task not found: ${(n==null?void 0:n.message)||"Unknown error"}`);const a=t.points||0,{error:i}=yield _.from("home_daily_operations_tasks").update({completed:!0,status:"completed",completed_by:e,completed_at:new Date().toISOString()}).eq("id",s);if(i)throw new Error(`Failed to complete task: ${i.message}`);if(a>0){const{error:c}=yield _.from("home_challenge_completions").insert({challenge_id:s,user_id:e,facility_id:t.facility_id,points_earned:a,completion_type:"daily_task",task_title:t.title,task_category:t.category});if(c)console.error("Failed to award points for task completion:",c);else{console.log(`Awarded ${a} points for completing task: ${t.title}`);try{const l=yield zx.updateGamificationData({userId:e,facilityId:t.facility_id,pointsEarned:a,taskTitle:t.title,taskCategory:t.category});l.currentLevel>1&&console.log(`🎉 Level up! User ${e} reached level ${l.currentLevel}`),console.log("Gamification updated:",{level:l.currentLevel,totalPoints:l.totalPoints,rank:l.rank,pointsToNextLevel:l.pointsToNextLevel})}catch(l){console.error("Error updating gamification data:",l)}}}}catch(t){throw console.error("Error completing daily task:",t),t}})}var De=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function Ht(){return De(this,null,function*(){const{data:{user:s}}=yield _.auth.getUser();if(!s)throw new Error("User not authenticated");return s.id})}function Ke(){return De(this,null,function*(){const{data:{user:s}}=yield _.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:e,error:t}=yield _.from("users").select("facility_id").eq("id",s.id).single();if(t||!e)throw new Error("Failed to get user facility");return e.facility_id})}const Re={getToolByBarcode(s){return De(this,null,function*(){const e=yield Ke(),{data:t,error:n}=yield _.from("tools").select("*").eq("barcode",s).eq("facility_id",e).maybeSingle();return n?(console.error("ToolService.getToolByBarcode error:",n),null):t})},getToolsByStatus(s){return De(this,null,function*(){const e=yield Ke(),{data:t,error:n}=yield _.from("tools").select("*").eq("status",s).eq("facility_id",e);return n?(console.error("ToolService.getToolsByStatus error:",n),[]):t||[]})},updateToolStatus(s,e){return De(this,null,function*(){if(s.startsWith("mock-tool-"))return console.log("🧪 Skipping database update for mock tool:",s),{id:s,status:e,updated_at:new Date().toISOString()};const t={status:e,facility_id:yield Ke(),updated_by:yield Ht(),updated_at:new Date().toISOString()},{data:n,error:a}=yield _.from("tools").update(t).eq("id",s).select().single();if(a)throw a;return n})},getToolByBarcodeAndStatus(s,e){return De(this,null,function*(){if(s==="TEST-CLEAN-001"&&e==="clean")return console.log("🧪 Using mock tool data for testing Clean Tool workflow"),{id:"mock-tool-test-clean-001",barcode:"TEST-CLEAN-001",tool_type:"surgical_scissors",tool_name:"Test Surgical Scissors",status:"clean",facility_id:"550e8400-e29b-41d4-a716-446655440000",current_cycle_id:"00000000-0000-0000-0000-000000000000",location:"Sterilization Room",sterilization_count:0,notes:"Mock tool for testing Clean Tool workflow",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),latitude:null,longitude:null,gps_accuracy:null,location_timestamp:null,maintenance_due_date:null,metadata:null,model:"Test Model",manufacturer:"Test Manufacturer",serial_number:"TEST-001"};const t=yield Ke(),{data:n,error:a}=yield _.from("tools").select("*").eq("barcode",s).eq("status",e).eq("facility_id",t).single();if(a)throw a;return n})},getToolsByFacilityAndStatus(s,e){return De(this,null,function*(){const{data:t,error:n}=yield _.from("tools").select("*").eq("facility_id",s).eq("status",e);if(n)throw n;return t})},getToolsByStatuses(s){return De(this,null,function*(){const e=yield Ke(),{data:t,error:n}=yield _.from("tools").select("*").in("status",s).eq("facility_id",e);if(n)throw n;return t})},updateToolsStatus(s,e){return De(this,null,function*(){const t={status:e,facility_id:yield Ke(),updated_by:yield Ht(),updated_at:new Date().toISOString()},{data:n,error:a}=yield _.from("tools").update(t).in("id",s).select();if(a)throw a;return n!=null?n:[]})},updateToolsCyclePhase(s,e,t,n){return De(this,null,function*(){const a={status:e,current_cycle_id:t,current_phase:n,facility_id:yield Ke(),updated_by:yield Ht(),updated_at:new Date().toISOString()},{data:i,error:c}=yield _.from("tools").update(a).in("id",s).select();if(c)throw c;return i!=null?i:[]})},clearCycleAssignment(s,e){return De(this,null,function*(){const t=s.filter(l=>l.startsWith("mock-tool-")),n=s.filter(l=>!l.startsWith("mock-tool-"));if(t.length>0&&console.log("🧪 Skipping database update for mock tools:",t),n.length===0)return t.map(l=>({id:l,status:e,current_cycle_id:"00000000-0000-0000-0000-000000000000",current_phase:null,updated_at:new Date().toISOString()}));const a={status:e,current_cycle_id:"00000000-0000-0000-0000-000000000000",current_phase:null,facility_id:yield Ke(),updated_by:yield Ht(),updated_at:new Date().toISOString()},{data:i,error:c}=yield _.from("tools").update(a).in("id",n).select();if(c)throw c;return i!=null?i:[]})},markAsSterilized(s){return De(this,null,function*(){if(s.startsWith("mock-tool-"))return console.log("🧪 Skipping database update for mock tool:",s),{id:s,last_sterilized:new Date().toISOString(),updated_at:new Date().toISOString()};const e={last_sterilized:new Date().toISOString(),updated_by:yield Ht(),facility_id:yield Ke(),updated_at:new Date().toISOString()},{data:t,error:n}=yield _.from("tools").update(e).eq("id",s).select().single();if(n)throw n;return t})},updateToolPhase(s,e){return De(this,null,function*(){const t={current_phase:e,updated_by:yield Ht(),facility_id:yield Ke(),updated_at:new Date().toISOString()},{data:n,error:a}=yield _.from("tools").update(t).eq("id",s).select().single();if(a)throw a;return n})},touchTools(s){return De(this,null,function*(){const e={updated_by:yield Ht(),facility_id:yield Ke(),updated_at:new Date().toISOString()},{data:t,error:n}=yield _.from("tools").update(e).in("id",s).select();if(n)throw n;return t!=null?t:[]})}};var Fe=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Qx{scanOperationalGaps(e){return Fe(this,null,function*(){const t=[],n=yield this.scanEquipmentMaintenance(e);t.push(...n);const a=yield this.scanComplianceGaps(e);t.push(...a);const i=yield this.scanOperationalIssues(e);t.push(...i);const c=yield this.scanSafetyGaps(e);return t.push(...c),t})}scanEquipmentMaintenance(e){return Fe(this,null,function*(){const t=[],n=new Date;try{const a=yield this.scanAutoclaveMaintenance(e,n);t.push(...a);const i=yield this.scanToolMaintenance(e);t.push(...i)}catch(a){console.error("Error scanning equipment maintenance:",a)}return t})}scanAutoclaveMaintenance(e,t){return Fe(this,null,function*(){const n=[],{data:a,error:i}=yield _.from("autoclaves").select("*").eq("facility_id",e).eq("status","active");if(i)throw i;return a==null||a.forEach(c=>{const l=c;l.next_maintenance&&new Date(l.next_maintenance)<=t&&n.push({id:kt(),type:"equipment",priority:"high",title:`Autoclave Maintenance Due: ${l.autoclave_name}`,description:`Maintenance is due for autoclave ${l.autoclave_name}. Schedule maintenance to ensure proper operation.`,category:"equipment",dueDate:l.next_maintenance,estimatedPoints:75,estimatedDuration:120,assignedRole:"technician",facilityId:e,metadata:{autoclaveId:l.id,equipmentType:"autoclave"}}),l.calibration_due&&new Date(l.calibration_due)<=t&&n.push({id:kt(),type:"compliance",priority:"urgent",title:`Autoclave Calibration Due: ${l.autoclave_name}`,description:`Calibration is due for autoclave ${l.autoclave_name}. This is critical for compliance.`,category:"compliance",dueDate:l.calibration_due,estimatedPoints:100,estimatedDuration:60,assignedRole:"technician",facilityId:e,metadata:{autoclaveId:l.id,equipmentType:"autoclave"}})}),n})}scanToolMaintenance(e){return Fe(this,null,function*(){const t=[],n=yield Re.getToolsByFacilityAndStatus(e,"problem");return n==null||n.forEach(a=>{t.push({id:kt(),type:"equipment",priority:"medium",title:`Tool Maintenance Required: ${a.tool_name||a.id}`,description:`Tool ${a.tool_name||a.id} requires maintenance. Check condition and repair if possible.`,category:"equipment",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:50,estimatedDuration:45,assignedRole:"technician",facilityId:e,metadata:{toolId:a.id,toolName:a.tool_name||a.id}})}),t})}scanComplianceGaps(e){return Fe(this,null,function*(){const t=[],n=new Date;try{const a=yield this.scanBITests(e,n);t.push(...a);const i=yield this.scanCleaningTasks(e,n);t.push(...i)}catch(a){console.error("Error scanning compliance gaps:",a)}return t})}scanBITests(e,t){return Fe(this,null,function*(){const n=[],{data:a,error:i}=yield _.from("biological_indicator_tests").select("*").eq("facility_id",e).eq("status","pending").lte("due_date",t.toISOString().split("T")[0]);if(i)throw i;return a==null||a.forEach(c=>{const l=c;n.push({id:kt(),type:"compliance",priority:"urgent",title:"Daily BI Test Required",description:"Daily Biological Indicator test is required for sterilization compliance.",category:"compliance",dueDate:l.due_date,estimatedPoints:80,estimatedDuration:30,assignedRole:"operator",facilityId:e,metadata:{biTestId:l.id,testType:"daily_bi"}})}),n})}scanCleaningTasks(e,t){return Fe(this,null,function*(){const n=[],{data:a,error:i}=yield _.from("cleaning_tasks").select("*").eq("facility_id",e).eq("status","pending").lte("due_date",t.toISOString());if(i)throw i;return a==null||a.forEach(c=>{const l=c;n.push({id:kt(),type:"compliance",priority:l.priority==="critical"?"urgent":"high",title:`Cleaning Task Overdue: ${l.name}`,description:`Cleaning task "${l.name}" is overdue. Complete to maintain compliance.`,category:"compliance",dueDate:l.due_date,estimatedPoints:60,estimatedDuration:l.estimated_duration_minutes||60,assignedRole:"cleaning_staff",facilityId:e,metadata:{taskId:l.id,taskName:l.name,location:l.location}})}),n})}scanOperationalIssues(e){return Fe(this,null,function*(){const t=[];try{const n=yield this.scanStuckTools(e);t.push(...n);const a=yield this.scanLowInventory(e);t.push(...a)}catch(n){console.error("Error scanning operational issues:",n)}return t})}scanStuckTools(e){return Fe(this,null,function*(){const t=[],n=["bath1","bath2","airDry","autoclave"],i=(yield Promise.all(n.map(c=>Re.getToolsByFacilityAndStatus(e,c)))).flat();return i==null||i.forEach(c=>{t.push({id:kt(),type:"operational",priority:"medium",title:`Tool Stuck in Phase: ${c.tool_name||c.id}`,description:`Tool ${c.tool_name||c.id} appears to be stuck in ${c.status} phase. Check workflow status.`,category:"operational",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:40,estimatedDuration:30,assignedRole:"operator",facilityId:e,metadata:{toolId:c.id,toolName:c.tool_name||c.id,currentPhase:c.status}})}),t})}scanLowInventory(e){return Fe(this,null,function*(){const t=[],a=(yield at.getItems()).filter(i=>{var c,l;return i.facility_id===e&&(i.quantity||0)<(((c=i.data)==null?void 0:c.min_quantity)||0)&&((l=i.data)==null?void 0:l.isActive)===!0});return a==null||a.forEach(i=>{var c;t.push({id:kt(),type:"operational",priority:"high",title:`Low Stock Alert: ${i.name}`,description:`Inventory item ${i.name} is running low. Current quantity: ${i.quantity}.`,category:"operational",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:35,estimatedDuration:20,assignedRole:"inventory_manager",facilityId:e,metadata:{itemId:i.id,itemName:i.name,currentQuantity:i.quantity,minQuantity:(c=i.data)==null?void 0:c.min_quantity}})}),t})}scanSafetyGaps(e){return Fe(this,null,function*(){const t=[];try{const n=yield this.scanFailedCycles(e);t.push(...n)}catch(n){console.error("Error scanning safety gaps:",n)}return t})}scanFailedCycles(e){return Fe(this,null,function*(){const t=[],{data:n,error:a}=yield _.from("sterilization_cycles").select("*").eq("facility_id",e).eq("status","failed").gte("created_at",new Date(Date.now()-6048e5).toISOString());if(a)throw a;return n==null||n.forEach(i=>{const c=i;t.push({id:kt(),type:"safety",priority:"high",title:`Investigate Failed Cycle: ${c.id}`,description:`Sterilization cycle ${c.id} failed and requires investigation to prevent future failures.`,category:"safety",dueDate:new Date().toISOString().split("T")[0],estimatedPoints:70,estimatedDuration:90,assignedRole:"supervisor",facilityId:e,metadata:{cycleId:c.id,failureReason:c.failure_reason}})}),t})}getGapStatistics(e){const t=e.length,n=e.reduce((d,u)=>(d[u.type]=(d[u.type]||0)+1,d),{}),a=e.reduce((d,u)=>(d[u.priority]=(d[u.priority]||0)+1,d),{}),i=e.reduce((d,u)=>(d[u.category]=(d[u.category]||0)+1,d),{}),c=e.reduce((d,u)=>(d[u.assignedRole]=(d[u.assignedRole]||0)+1,d),{}),l=t>0?e.reduce((d,u)=>d+u.estimatedPoints,0)/t:0,o=e.reduce((d,u)=>d+u.estimatedDuration,0);return{total:t,byType:n,byPriority:a,byCategory:i,byRole:c,averagePoints:l,totalEstimatedDuration:o}}filterGaps(e,t){return e.filter(n=>!(t.type&&n.type!==t.type||t.priority&&n.priority!==t.priority||t.category&&n.category!==t.category||t.assignedRole&&n.assignedRole!==t.assignedRole||t.facilityId&&n.facilityId!==t.facilityId))}sortGapsByPriority(e){const t={urgent:4,high:3,medium:2,low:1};return e.sort((n,a)=>{const i=(t[a.priority]||0)-(t[n.priority]||0);return i!==0?i:new Date(n.dueDate).getTime()-new Date(a.dueDate).getTime()})}getGapsDueToday(e){const t=new Date().toISOString().split("T")[0];return e.filter(n=>n.dueDate<=t)}getOverdueGaps(e){const t=new Date().toISOString().split("T")[0];return e.filter(n=>n.dueDate<t)}}var Yx=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Jx{assignTasksWithAI(e,t,n){return Yx(this,null,function*(){try{const a=this.prepareAnalysisData(e,t,n),i=yield $u({prompt:this.buildAIPrompt(a),context:"Daily Operations Task Assignment"});return this.parseAITaskAssignments(i,e,t,n)}catch(a){return console.error("AI task assignment failed, using fallback logic:",a),this.fallbackTaskAssignment(e,t,n)}})}prepareAnalysisData(e,t,n){return{operationalGaps:e,availableUsers:t,configuration:n,facilityContext:{totalGaps:e.length,gapTypes:e.reduce((a,i)=>(a[i.type]=(a[i.type]||0)+1,a),{}),priorityDistribution:e.reduce((a,i)=>(a[i.priority]=(a[i.priority]||0)+1,a),{})}}}buildAIPrompt(e){return`Analyze the following operational gaps and assign tasks to users optimally:

Operational Gaps: ${JSON.stringify(e.operationalGaps,null,2)}
Available Users: ${JSON.stringify(e.availableUsers,null,2)}
Configuration: ${JSON.stringify(e.configuration,null,2)}
Facility Context: ${JSON.stringify(e.facilityContext,null,2)}

Please provide a JSON response with task assignments that:
1. Respects max tasks per user (${e.configuration.maxTasksPerUser})
2. Prioritizes urgent and high priority tasks
3. Matches user roles to task categories
4. Balances workload across users
5. Considers task priority and estimated duration

Return ONLY valid JSON in this exact format:
[
  {
    "userId": "user_id_here",
    "tasks": [
      {
        "gapId": "gap_id_here"
      }
    ]
  }
]

Each task should reference a gapId from the operational gaps. Do not include any explanatory text, only the JSON array.`}parseAITaskAssignments(e,t,n,a){try{const i=e.match(/\[[\s\S]*\]/);if(!i)return console.warn("No JSON array found in AI response, using fallback"),this.fallbackTaskAssignment(t,n,a);const c=JSON.parse(i[0]);if(!Array.isArray(c))return console.warn("AI response is not an array, using fallback"),this.fallbackTaskAssignment(t,n,a);const l=[],o=new Map(n.map(u=>[u.id,u])),d=new Map(t.map(u=>[u.id,u]));for(const u of c){if(!u.userId||!Array.isArray(u.tasks))continue;if(!o.get(u.userId)){console.warn(`User ${u.userId} not found, skipping assignment`);continue}const p=[];for(const f of u.tasks){if(!f.gapId)continue;const y=d.get(f.gapId);y&&p.push({id:Hx(),title:y.title,description:y.description,category:y.category,priority:y.priority,points:y.estimatedPoints,estimatedDuration:y.estimatedDuration,dueDate:y.dueDate,type:y.type,assignedRole:y.assignedRole,facilityId:y.facilityId,metadata:y.metadata,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}p.length>0&&l.push({userId:u.userId,tasks:p})}return l.length>0?l:(console.warn("AI parsing produced no valid assignments, using fallback"),this.fallbackTaskAssignment(t,n,a))}catch(i){return console.error("Error parsing AI response:",i),this.fallbackTaskAssignment(t,n,a)}}fallbackTaskAssignment(e,t,n){const a=[],i=[...e].sort((l,o)=>Pl(o.priority)-Pl(l.priority)),c=new Map;for(const l of i){const o=t.filter(u=>(c.get(u.id)||0)<n.maxTasksPerUser);if(o.length===0)break;const d=this.findBestUserMatch(l,o);if(d){const u=c.get(d.id)||0;c.set(d.id,u+1);let h=a.find(p=>p.userId===d.id);h||(h={userId:d.id,tasks:[]},a.push(h)),h.tasks.push({id:Ux(),title:l.title,description:l.description,category:l.category,priority:l.priority,points:l.estimatedPoints,dueDate:l.dueDate,type:l.type,estimatedDuration:l.estimatedDuration,assignedRole:l.assignedRole,facilityId:l.facilityId,metadata:l.metadata,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}}return a}findBestUserMatch(e,t){if(e.assignedRole){const a=t.find(i=>i.role===e.assignedRole);if(a)return a}const n=t.filter(a=>qu(a.role,e.category));return n.length>0?n[0]:t[0]||null}validateTaskAssignments(e,t){const n=[],a=[];return e.forEach((i,c)=>{var l;i.userId||n.push(`Assignment ${c+1}: Missing userId`),(!i.tasks||i.tasks.length===0)&&a.push(`Assignment ${c+1}: No tasks assigned`),i.tasks&&i.tasks.length>t.maxTasksPerUser&&n.push(`Assignment ${c+1}: Exceeds max tasks per user (${i.tasks.length} > ${t.maxTasksPerUser})`),(l=i.tasks)==null||l.forEach((o,d)=>{o.title||n.push(`Assignment ${c+1}, Task ${d+1}: Missing title`),o.category||n.push(`Assignment ${c+1}, Task ${d+1}: Missing category`),o.priority||n.push(`Assignment ${c+1}, Task ${d+1}: Missing priority`),o.points<=0&&a.push(`Assignment ${c+1}, Task ${d+1}: Zero or negative points`),o.estimatedDuration<=0&&a.push(`Assignment ${c+1}, Task ${d+1}: Zero or negative duration`)})}),{isValid:n.length===0,errors:n,warnings:a}}getAssignmentStatistics(e){const t=e.length,n=e.reduce((d,u)=>d+u.tasks.length,0),a=t>0?n/t:0,i={},c={};let l=0,o=0;return e.forEach(d=>{d.tasks.forEach(u=>{i[u.priority]=(i[u.priority]||0)+1,c[u.category]=(c[u.category]||0)+1,l+=u.points,o+=u.estimatedDuration})}),{totalAssignments:t,totalTasks:n,averageTasksPerUser:a,tasksByPriority:i,tasksByCategory:c,totalPoints:l,totalEstimatedDuration:o}}optimizeTaskAssignments(e,t){const n=new Map;e.forEach(c=>{const l={taskCount:c.tasks.length,totalPoints:c.tasks.reduce((o,d)=>o+d.points,0),totalDuration:c.tasks.reduce((o,d)=>o+d.estimatedDuration,0)};n.set(c.userId,l)});const a=[...e];return Array.from(n.entries()).filter(([c,l])=>l.taskCount>t.maxTasksPerUser).map(([c,l])=>c).forEach(c=>{const l=a.find(u=>u.userId===c);if(!l)return;const o=l.tasks.slice(t.maxTasksPerUser);l.tasks=l.tasks.slice(0,t.maxTasksPerUser);const d=a.filter(u=>u.tasks.length<t.maxTasksPerUser&&u.userId!==c);o.forEach(u=>{if(d.length>0){const h=d[0];h.tasks.push(u);const p=d.findIndex(f=>f.userId===h.userId);p>=0&&h.tasks.length>=t.maxTasksPerUser&&d.splice(p,1)}})}),a}exportTaskAssignments(e){return JSON.stringify(e,null,2)}importTaskAssignments(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,assignments:[],errors:["Invalid format: expected array of assignments"]};const n=[];return t.forEach((a,i)=>{a.userId||n.push(`Assignment ${i+1}: Missing userId`),(!a.tasks||!Array.isArray(a.tasks))&&n.push(`Assignment ${i+1}: Missing or invalid tasks array`)}),{success:n.length===0,assignments:t,errors:n}}catch(t){return{success:!1,assignments:[],errors:["Invalid JSON format"]}}}}var rn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Xx{getFacilityUsers(e){return rn(this,null,function*(){const{data:t,error:n}=yield _.from("users").select("id, full_name, role, department, is_active, facility_id").eq("facility_id",e).eq("is_active",!0);if(n)throw n;return(t||[]).map(a=>{const i=a;return{id:i.id,role:i.role,full_name:i.full_name,department:i.department,is_active:i.is_active,facility_id:i.facility_id}})})}getUsersByRole(e,t){return rn(this,null,function*(){return(yield this.getFacilityUsers(e)).filter(a=>a.role===t)})}getUsersByDepartment(e,t){return rn(this,null,function*(){return(yield this.getFacilityUsers(e)).filter(a=>a.department===t)})}getAvailableRoles(){return[{role:"technician",description:"Equipment maintenance and repair specialist",capabilities:["equipment_maintenance","tool_repair","calibration"],compatibleCategories:["equipment","compliance"]},{role:"operator",description:"Daily operations and sterilization specialist",capabilities:["sterilization","daily_operations","bi_testing"],compatibleCategories:["operational","compliance"]},{role:"cleaning_staff",description:"Environmental cleaning and sanitation specialist",capabilities:["environmental_cleaning","sanitization","compliance"],compatibleCategories:["compliance","operational"]},{role:"inventory_manager",description:"Inventory management and supply specialist",capabilities:["inventory_management","supply_ordering","stock_control"],compatibleCategories:["operational"]},{role:"supervisor",description:"Operations oversight and safety specialist",capabilities:["safety_investigation","quality_control","oversight"],compatibleCategories:["safety","operational"]},{role:"manager",description:"Facility management and coordination",capabilities:["facility_management","coordination","planning"],compatibleCategories:["operational","safety","compliance"]}]}isRoleCompatibleWithCategory(e,t){const a=this.getAvailableRoles().find(i=>i.role===e);return a?a.compatibleCategories.includes(t):!1}getRoleCapabilities(e){const n=this.getAvailableRoles().find(a=>a.role===e);return(n==null?void 0:n.capabilities)||[]}findBestUserMatch(e,t,n){if(e.assignedRole){const i=t.find(c=>c.role===e.assignedRole);if(i)return i}const a=t.filter(i=>this.isRoleCompatibleWithCategory(i.role,e.category));return a.length>0?n?a.reduce((i,c)=>{const l=n.get(i.id),o=n.get(c.id);return l?o&&o.utilization<l.utilization?c:i:c}):a[0]:n&&t.length>0?t.reduce((i,c)=>{const l=n.get(i.id),o=n.get(c.id);return l?o&&o.utilization<l.utilization?c:i:c}):t[0]||null}calculateUserWorkload(e,t,n,a,i=5){const c=i,l=c>0?t/c*100:0;return{userId:e,currentTasks:t,totalPoints:n,totalDuration:a,capacity:c,utilization:l}}getUserWorkloadStatistics(e,t){const n=e.length;let a=0,i=0,c=0;const l={},o={low:0,medium:0,high:0};e.forEach(u=>{const h=t.get(u.id);h&&(a+=h.utilization,h.utilization>100?i++:h.utilization<50&&c++,h.utilization<50?o.low++:h.utilization<=80?o.medium++:o.high++,l[u.role]=(l[u.role]||0)+h.utilization)});const d=n>0?a/n:0;return{totalUsers:n,averageUtilization:d,overloadedUsers:i,underutilizedUsers:c,workloadByRole:l,workloadDistribution:o}}getUsersWithCapacity(e,t,n){return e.filter(a=>{const i=t.get(a.id);return!i||i.currentTasks<n})}getOverloadedUsers(e,t,n){return e.filter(a=>{const i=t.get(a.id);return i&&i.currentTasks>n})}balanceWorkload(e,t,n){const a=[],i=this.getOverloadedUsers(e,t,n),c=this.getUsersWithCapacity(e,t,n);return i.length>0&&(c.length>0?a.push({type:"redistribute",description:`Redistribute tasks from ${i.length} overloaded users to ${c.length} users with capacity`,priority:"high"}):a.push({type:"add_user",description:"All users are at capacity. Consider adding more staff or increasing capacity limits",priority:"high"})),Array.from(t.values()).reduce((o,d)=>o+d.utilization,0)/t.size>90&&a.push({type:"reduce_tasks",description:"Overall utilization is very high. Consider reducing task load or adding resources",priority:"medium"}),{recommendations:a,canBalance:c.length>0}}getUserPerformanceMetrics(e,t){return rn(this,null,function*(){return(yield this.getFacilityUsers(e)).map(a=>({userId:a.id,userName:a.full_name,role:a.role,tasksCompleted:0,averageCompletionTime:0,pointsEarned:0,efficiency:0}))})}validateUserData(e){const t=[];(!e.id||e.id.trim()==="")&&t.push("User ID is required"),(!e.role||e.role.trim()==="")&&t.push("User role is required"),(!e.full_name||e.full_name.trim()==="")&&t.push("Full name is required"),(!e.facility_id||e.facility_id.trim()==="")&&t.push("Facility ID is required");const n=this.getAvailableRoles();return e.role&&!n.find(a=>a.role===e.role)&&t.push(`Invalid role: ${e.role}`),{isValid:t.length===0,errors:t}}exportUserData(e){return JSON.stringify(e,null,2)}importUserData(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,users:[],errors:["Invalid format: expected array of users"]};const n=[];return t.forEach((a,i)=>{const c=this.validateUserData(a);c.isValid||n.push(`User ${i+1}: ${c.errors.join(", ")}`)}),{success:n.length===0,users:t,errors:n}}catch(t){return{success:!1,users:[],errors:["Invalid JSON format"]}}}}var Zx=Object.defineProperty,eb=Object.defineProperties,tb=Object.getOwnPropertyDescriptors,Ol=Object.getOwnPropertySymbols,rb=Object.prototype.hasOwnProperty,sb=Object.prototype.propertyIsEnumerable,$l=(s,e,t)=>e in s?Zx(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,nb=(s,e)=>{for(var t in e||(e={}))rb.call(e,t)&&$l(s,t,e[t]);if(Ol)for(var t of Ol(e))sb.call(e,t)&&$l(s,t,e[t]);return s},ab=(s,e)=>eb(s,tb(e));const Ml={inventory_items:{defaultLimit:50,maxLimit:200,maxOffset:1e4,allowedOrderByFields:["created_at","updated_at","name","category","quantity"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},sterilization_cycles:{defaultLimit:100,maxLimit:500,maxOffset:5e3,allowedOrderByFields:["start_time","created_at","cycle_number","status"],defaultOrderBy:"start_time",defaultOrderDirection:"desc"},audit_logs:{defaultLimit:100,maxLimit:500,maxOffset:2e3,allowedOrderByFields:["created_at","action","module"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},users:{defaultLimit:100,maxLimit:500,maxOffset:2e3,allowedOrderByFields:["created_at","email","role"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"},admin_task_config:{defaultLimit:20,maxLimit:100,maxOffset:1e3,allowedOrderByFields:["facility_id","created_at","updated_at"],defaultOrderBy:"facility_id",defaultOrderDirection:"asc"},default:{defaultLimit:50,maxLimit:200,maxOffset:5e3,allowedOrderByFields:["created_at","id"],defaultOrderBy:"created_at",defaultOrderDirection:"desc"}};function Kn(s={},e="default"){const t=Ml[e]||Ml.default;let n=s.limit||t.defaultLimit;n<=0&&(n=t.defaultLimit),n>t.maxLimit&&(R.warn(`Query limit ${n} exceeds maximum ${t.maxLimit} for table ${e}, capping to maximum`),n=t.maxLimit);let a=s.offset||0;a<0&&(a=0),a>t.maxOffset&&(R.warn(`Query offset ${a} exceeds maximum ${t.maxOffset} for table ${e}, capping to maximum`),a=t.maxOffset);let i=s.orderBy||t.defaultOrderBy;t.allowedOrderByFields.includes(i)||(R.warn(`Order by field '${i}' not allowed for table ${e}, using default '${t.defaultOrderBy}'`),i=t.defaultOrderBy);const c=s.orderDirection||t.defaultOrderDirection;return["asc","desc"].includes(c)||R.warn(`Invalid order direction '${c}' for table ${e}, using default '${t.defaultOrderDirection}'`),ab(nb({},s),{limit:n,offset:a,orderBy:i,orderDirection:c})}function ib(s,e={},t="default"){const n=Kn(e,t);return{query:s.limit(n.limit).range(n.offset,n.offset+n.limit-1),offset:n.offset,limit:n.limit}}function ob(s,e={},t="default"){const n=Kn(e,t);return s.order(n.orderBy,{ascending:n.orderDirection==="asc"})}function lb(s,e,t={},n="default"){const a=Kn(t,n),i=Math.ceil(e/a.limit),c=Math.floor(a.offset/a.limit)+1;return{data:s,total:e,page:c,limit:a.limit,totalPages:i,hasNext:c<i,hasPrev:c>1}}function cb(s,e){return["id","created_at","updated_at"].join(", ")}function db(s,e={},t="default"){const n=Kn(e,t),a=ob(s,n,t),{query:i}=ib(a,n,t);return{query:i,safeOptions:n,warnings:[]}}var ub=Object.defineProperty,mb=Object.defineProperties,hb=Object.getOwnPropertyDescriptors,Fl=Object.getOwnPropertySymbols,pb=Object.prototype.hasOwnProperty,fb=Object.prototype.propertyIsEnumerable,zl=(s,e,t)=>e in s?ub(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,gb=(s,e)=>{for(var t in e||(e={}))pb.call(e,t)&&zl(s,t,e[t]);if(Fl)for(var t of Fl(e))fb.call(e,t)&&zl(s,t,e[t]);return s},yb=(s,e)=>mb(s,hb(e)),_r=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class ba{static getConfig(e){return _r(this,null,function*(){try{const{data:t,error:n}=yield _.from("admin_task_config").select("id, facility_id, max_tasks_per_user, enabled_categories, priority_thresholds, auto_assignment, ai_sensitivity, ai_confidence_threshold, max_ai_processing_time_ms, workload_balancing_enabled, max_concurrent_tasks_per_user, role_category_mapping, task_notifications_enabled, notification_channels, compliance_tracking_enabled, audit_logging_enabled, task_optimization_enabled, predictive_assignment_enabled, created_by, updated_by, created_at, updated_at").eq("facility_id",e).single();if(n){if(n.code==="PGRST116")return R.info(`No admin config found for facility ${e}, creating default`),yield this.createDefaultConfig(e);throw n}return this.mapDatabaseToConfig(t)}catch(t){throw R.error("Error getting admin task config:",t),new Error("Failed to retrieve admin task configuration")}})}static upsertConfig(e,t){return _r(this,null,function*(){try{const n=Mx(t),a=st(),i={facility_id:e,max_tasks_per_user:n.maxTasksPerUser,enabled_categories:n.enabledCategories,priority_thresholds:n.priorityThresholds,auto_assignment:n.autoAssignment,ai_sensitivity:n.aiSensitivity,ai_confidence_threshold:.75,max_ai_processing_time_ms:3e4,workload_balancing_enabled:!0,max_concurrent_tasks_per_user:5,role_category_mapping:{equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]},task_notifications_enabled:!0,notification_channels:["email","in_app"],compliance_tracking_enabled:!0,audit_logging_enabled:!0,task_optimization_enabled:!0,predictive_assignment_enabled:!0,updated_by:a},{data:c,error:l}=yield _.from("admin_task_config").upsert(i,{onConflict:"facility_id",ignoreDuplicates:!1}).select("*").single();if(l)throw l;return R.info(`Admin task config updated for facility ${e}`),this.mapDatabaseToConfig(c)}catch(n){throw R.error("Error upserting admin task config:",n),new Error("Failed to save admin task configuration")}})}static createDefaultConfig(e){return _r(this,null,function*(){try{const t=st(),n={facility_id:e,max_tasks_per_user:3,enabled_categories:["equipment","compliance","operational","safety"],priority_thresholds:{low:1,medium:2,high:3,urgent:4},auto_assignment:!0,ai_sensitivity:"medium",ai_confidence_threshold:.75,max_ai_processing_time_ms:3e4,workload_balancing_enabled:!0,max_concurrent_tasks_per_user:5,role_category_mapping:{equipment:["technician","maintenance"],compliance:["supervisor","manager","operator"],operational:["operator","inventory_manager"],safety:["supervisor","manager"]},task_notifications_enabled:!0,notification_channels:["email","in_app"],compliance_tracking_enabled:!0,audit_logging_enabled:!0,task_optimization_enabled:!0,predictive_assignment_enabled:!0,created_by:t,updated_by:t},{data:a,error:i}=yield _.from("admin_task_config").insert(n).select("*").single();if(i)throw i;return R.info(`Default admin task config created for facility ${e}`),this.mapDatabaseToConfig(a)}catch(t){throw R.error("Error creating default admin task config:",t),new Error("Failed to create default admin task configuration")}})}static deleteConfig(e){return _r(this,null,function*(){try{const{error:t}=yield _.from("admin_task_config").delete().eq("facility_id",e);if(t)throw t;R.info(`Admin task config deleted for facility ${e}`)}catch(t){throw R.error("Error deleting admin task config:",t),new Error("Failed to delete admin task configuration")}})}static mapDatabaseToConfig(e){return{maxTasksPerUser:e.max_tasks_per_user,enabledCategories:e.enabled_categories||[],priorityThresholds:e.priority_thresholds||{low:1,medium:2,high:3,urgent:4},autoAssignment:e.auto_assignment,aiSensitivity:e.ai_sensitivity||"medium"}}static getAllConfigs(){return _r(this,arguments,function*(e={}){try{const{orderBy:t="facility_id",orderDirection:n="asc"}=e,{query:a,safeOptions:i,warnings:c}=db(_.from("admin_task_config"),yb(gb({},e),{orderBy:t,orderDirection:n}),"admin_task_config"),l=a.select(cb("admin_task_config"),{count:"exact"}),{data:o,error:d,count:u}=yield l;if(d)throw d;return c.length>0&&R.warn("Admin config query warnings:",c),lb(o||[],u||0,i,"admin_task_config")}catch(t){throw R.error("Error getting all admin task configs:",t),new Error("Failed to retrieve admin task configurations")}})}static hasConfig(e){return _r(this,null,function*(){try{const{count:t,error:n}=yield _.from("admin_task_config").select("*",{count:"exact",head:!0}).eq("facility_id",e);if(n)throw n;return(t||0)>0}catch(t){return R.error("Error checking admin task config existence:",t),!1}})}}var vb=Object.defineProperty,xb=Object.defineProperties,bb=Object.getOwnPropertyDescriptors,Ll=Object.getOwnPropertySymbols,_b=Object.prototype.hasOwnProperty,wb=Object.prototype.propertyIsEnumerable,Bl=(s,e,t)=>e in s?vb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,sn=(s,e)=>{for(var t in e||(e={}))_b.call(e,t)&&Bl(s,t,e[t]);if(Ll)for(var t of Ll(e))wb.call(e,t)&&Bl(s,t,e[t]);return s},nn=(s,e)=>xb(s,bb(e)),an=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Sb{getAdminTaskConfig(e){return an(this,null,function*(){try{if(!e){const{FacilityService:t}=yield q(()=>Promise.resolve().then(()=>ge),void 0);e=yield t.getCurrentFacilityId()}return yield ba.getConfig(e)}catch(t){return console.warn("Failed to get admin config from database, using default:",t),xa()}})}updateAdminTaskConfig(e,t){return an(this,null,function*(){try{return yield ba.updateConfig(e,t)}catch(n){throw console.error("Failed to update admin config:",n),n}})}resetToDefaults(e){return an(this,null,function*(){const t=xa();return yield this.updateAdminTaskConfig(e,t)})}validateConfig(e){const t=[],n=[];if(e.maxTasksPerUser!==void 0&&(e.maxTasksPerUser<1&&t.push("Max tasks per user must be at least 1"),e.maxTasksPerUser>20&&n.push("Max tasks per user is very high, may impact user productivity")),e.priorityWeights){const a=e.priorityWeights;a.urgent!==void 0&&a.urgent<1&&t.push("Urgent priority weight must be at least 1"),a.high!==void 0&&a.high<1&&t.push("High priority weight must be at least 1"),a.medium!==void 0&&a.medium<1&&t.push("Medium priority weight must be at least 1"),a.low!==void 0&&a.low<1&&t.push("Low priority weight must be at least 1"),a.urgent&&a.high&&a.urgent<=a.high&&n.push("Urgent priority weight should be higher than high priority"),a.high&&a.medium&&a.high<=a.medium&&n.push("High priority weight should be higher than medium priority"),a.medium&&a.low&&a.medium<=a.low&&n.push("Medium priority weight should be higher than low priority")}if(e.rolePreferences&&Object.entries(e.rolePreferences).forEach(([a,i])=>{Array.isArray(i)?i.forEach(c=>{qu(a,c)||n.push(`Role ${a} may not be compatible with category ${c}`)}):t.push(`Role preferences for ${a} must be an array`)}),e.timeConstraints){const a=e.timeConstraints;a.maxTaskDuration!==void 0&&a.maxTaskDuration<5&&t.push("Max task duration must be at least 5 minutes"),a.minTaskDuration!==void 0&&a.minTaskDuration<1&&t.push("Min task duration must be at least 1 minute"),a.maxTaskDuration&&a.minTaskDuration&&a.maxTaskDuration<=a.minTaskDuration&&t.push("Max task duration must be greater than min task duration")}return{isValid:t.length===0,errors:t,warnings:n}}getConfigurationRecommendations(e,t){const n=[];if(t&&(t.taskCompletionRate<.8&&n.push({category:"performance",title:"Low Task Completion Rate",description:`Current completion rate is ${(t.taskCompletionRate*100).toFixed(1)}%. Consider reducing max tasks per user or improving task assignment.`,priority:"high",suggestedValue:Math.max(1,e.maxTasksPerUser-1)}),t.averageTasksPerUser>e.maxTasksPerUser*.9&&n.push({category:"workload",title:"High User Workload",description:`Users are consistently at ${(t.averageTasksPerUser/e.maxTasksPerUser*100).toFixed(1)}% capacity. Consider increasing max tasks or adding more users.`,priority:"medium",suggestedValue:e.maxTasksPerUser+1}),t.averageTaskDuration>120&&n.push({category:"performance",title:"Long Task Duration",description:`Average task duration is ${t.averageTaskDuration} minutes. Consider breaking down complex tasks or adjusting time estimates.`,priority:"medium"})),e.priorityWeights){const a=e.priorityWeights;a.urgent&&a.high&&a.urgent<=a.high&&n.push({category:"priority",title:"Priority Weight Ordering",description:"Urgent priority weight should be higher than high priority to ensure proper task prioritization.",priority:"medium",suggestedValue:nn(sn({},a),{urgent:a.high+1})})}return(!e.rolePreferences||Object.keys(e.rolePreferences).length===0)&&n.push({category:"role",title:"Missing Role Preferences",description:"No role preferences configured. Consider setting up role-category mappings for better task assignment.",priority:"low",suggestedValue:{technician:["equipment","compliance"],operator:["operational","compliance"],cleaning_staff:["compliance"],inventory_manager:["operational"],supervisor:["safety","operational"]}}),n}getDefaultConfigForFacilityType(e){const t=xa();switch(e){case"small":return nn(sn({},t),{maxTasksPerUser:3,priorityWeights:{urgent:10,high:7,medium:4,low:1}});case"medium":return nn(sn({},t),{maxTasksPerUser:5,priorityWeights:{urgent:12,high:8,medium:5,low:2}});case"large":return nn(sn({},t),{maxTasksPerUser:7,priorityWeights:{urgent:15,high:10,medium:6,low:3}});default:return t}}exportConfig(e){return JSON.stringify(e,null,2)}importConfig(e){try{const t=JSON.parse(e),n=this.validateConfig(t);return{success:n.isValid,config:n.isValid?t:null,errors:n.errors}}catch(t){return{success:!1,config:null,errors:["Invalid JSON format"]}}}getConfigurationHistory(e){return an(this,null,function*(){try{return yield ba.getConfigHistory(e)}catch(t){return console.error("Failed to get configuration history:",t),[]}})}compareConfigurations(e,t){const n=[];return new Set([...Object.keys(e),...Object.keys(t)]).forEach(i=>{const c=e[i],l=t[i];c===void 0&&l!==void 0?n.push({field:i,oldValue:void 0,newValue:l,type:"added"}):c!==void 0&&l===void 0?n.push({field:i,oldValue:c,newValue:void 0,type:"removed"}):JSON.stringify(c)!==JSON.stringify(l)&&n.push({field:i,oldValue:c,newValue:l,type:"modified"})}),{changes:n,hasChanges:n.length>0}}getConfigurationSummary(e){var t;const n=e.priorityWeights?Object.keys(e.priorityWeights).length:0,a=e.rolePreferences?Object.keys(e.rolePreferences).length:0,i=!!e.timeConstraints,c=e.aiEnabled!==!1;let l="simple";return(n>2||a>3||i)&&(l="moderate"),(n>3||a>5||i&&((t=e.timeConstraints)!=null&&t.maxTaskDuration))&&(l="complex"),{maxTasksPerUser:e.maxTasksPerUser,priorityCount:n,rolePreferencesCount:a,timeConstraintsEnabled:i,aiEnabled:c,complexity:l}}}var Qn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Cb=new Qx,jb=new Jx,Nb=new Xx,Ib=new Sb;function Tb(s){return Qn(this,null,function*(){return Cb.scanOperationalGaps(s)})}function Eb(s){return Qn(this,null,function*(){return Nb.getFacilityUsers(s)})}function kb(s){return Qn(this,null,function*(){return Ib.getAdminTaskConfig(s)})}function Db(s,e,t){return Qn(this,null,function*(){return jb.assignTasksWithAI(s,e,t)})}var os=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Pb{generateDailyTasks(e){return os(this,null,function*(){try{const t=yield Tb(e);if(t.length===0)return console.log("No operational gaps found for daily tasks"),[];const n=yield Eb(e),a=yield kb(),i=yield Db(t,n,a);return yield Vx(i,e),i}catch(t){throw console.error("Error generating daily tasks:",t),new Error(`Failed to generate daily tasks: ${t instanceof Error?t.message:"Unknown error"}`)}})}getUserDailyTasks(e){return os(this,null,function*(){return Wx(e)})}getFacilityDailyTasks(e){return os(this,null,function*(){return Gx(e)})}completeDailyTask(e,t){return os(this,null,function*(){return Kx(e,t)})}updateDailyTask(e,t){return os(this,null,function*(){try{const{data:{user:n}}=yield _.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:a,error:i}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(i||!(a!=null&&a.facility_id))throw new Error("User facility not found");const c={updated_at:new Date().toISOString()};t.title!==void 0&&(c.title=t.title),t.description!==void 0&&(c.description=t.description),t.category!==void 0&&(c.category=t.category),t.difficulty!==void 0&&(c.difficulty=t.difficulty),t.points!==void 0&&(c.points=t.points),t.timeEstimate!==void 0&&(c.time_estimate=t.timeEstimate),t.isCompleted!==void 0&&(c.is_completed=t.isCompleted);const{data:l,error:o}=yield _.from("home_challenges").update(c).eq("id",e).eq("facility_id",a.facility_id).select().single();if(o)throw new Error(`Failed to update task: ${o.message}`);return{id:l.id,title:l.title,description:l.description||"",category:l.category,difficulty:l.difficulty,points:l.points,timeEstimate:l.time_estimate,isCompleted:l.is_completed||!1,completedAt:l.completed_at||null,pointsEarned:l.points_earned||0,createdAt:l.created_at,updatedAt:l.updated_at}}catch(n){throw console.error("Error updating daily task:",n),n}})}}const Hu=new Pb,Rb=({currentPage:s,totalPages:e,onPageChange:t,onNextPage:n,onPreviousPage:a,hasNextPage:i,hasPreviousPage:c,isLoading:l=!1,className:o=""})=>{if(e<=1)return null;const d=()=>{const u=[];if(e<=5)for(let p=1;p<=e;p++)u.push(p);else if(s<=3){for(let p=1;p<=4;p++)u.push(p);u.push("..."),u.push(e)}else if(s>=e-2){u.push(1),u.push("...");for(let p=e-3;p<=e;p++)u.push(p)}else{u.push(1),u.push("...");for(let p=s-1;p<=s+1;p++)u.push(p);u.push("..."),u.push(e)}return u};return r.jsxs("div",{className:`flex items-center justify-center space-x-2 ${o}`,children:[r.jsxs("button",{onClick:a,disabled:!c||l,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${c&&!l?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:[r.jsx(ue,{path:nu,size:16,className:"mr-1"}),"Previous"]}),r.jsx("div",{className:"flex items-center space-x-1",children:d().map((u,h)=>r.jsx(X.Fragment,{children:u==="..."?r.jsx("span",{className:"px-3 py-2 text-sm text-gray-500",children:"..."}):r.jsx("button",{onClick:()=>t(u),disabled:l,className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${u===s?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"} ${l?"cursor-not-allowed":""}`,children:u})},h))}),r.jsxs("button",{onClick:n,disabled:!i||l,className:`flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors ${i&&!l?"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50":"text-gray-400 bg-gray-100 border border-gray-200 cursor-not-allowed"}`,children:["Next",r.jsx(ue,{path:ks,size:16,className:"ml-1"})]}),r.jsxs("div",{className:"ml-4 text-sm text-gray-500",children:["Page ",s," of ",e]})]})},Ab=({onLoadMore:s,hasMore:e,isLoading:t,className:n="",buttonText:a="Load More",loadingText:i="Loading..."})=>e?r.jsx("div",{className:`flex justify-center ${n}`,children:r.jsx("button",{onClick:s,disabled:t,className:"flex items-center px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t?r.jsxs(r.Fragment,{children:[r.jsx(ue,{path:au,size:16,className:"animate-spin mr-2"}),i]}):r.jsxs(r.Fragment,{children:[a,r.jsx(ue,{path:Ds,size:16,className:"ml-2"})]})})}):null;var Ob=Object.defineProperty,$b=Object.defineProperties,Mb=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,Fb=Object.prototype.hasOwnProperty,zb=Object.prototype.propertyIsEnumerable,Ul=(s,e,t)=>e in s?Ob(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_a=(s,e)=>{for(var t in e||(e={}))Fb.call(e,t)&&Ul(s,t,e[t]);if(ql)for(var t of ql(e))zb.call(e,t)&&Ul(s,t,e[t]);return s},wa=(s,e)=>$b(s,Mb(e)),Lb=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Bb=({task:s,isOpen:e,onClose:t,onSave:n})=>{const[a,i]=m.useState({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),[c,l]=m.useState({}),[o,d]=m.useState(!1),[u,h]=m.useState(null);m.useEffect(()=>{s&&(i({title:s.title||"",description:s.description||"",priority:s.priority||"medium",dueDate:s.dueDate?new Date(s.dueDate).toISOString().split("T")[0]:"",status:s.status||"pending"}),l({}),h(null))},[s]),m.useEffect(()=>{e||(i({title:"",description:"",priority:"medium",dueDate:"",status:"pending"}),l({}),h(null),d(!1))},[e]);const p=m.useCallback(()=>{const x={};if(a.title.trim()?a.title.trim().length<3?x.title="Title must be at least 3 characters long":a.title.trim().length>100&&(x.title="Title must be less than 100 characters"):x.title="Title is required",a.description.trim().length>500&&(x.description="Description must be less than 500 characters"),a.dueDate){const b=new Date(a.dueDate),v=new Date;v.setHours(0,0,0,0),b<v&&(x.dueDate="Due date cannot be in the past")}return l(x),Object.keys(x).length===0},[a]),f=m.useCallback((x,b)=>{i(v=>wa(_a({},v),{[x]:b})),c[x]&&l(v=>wa(_a({},v),{[x]:void 0}))},[c]),y=m.useCallback(x=>Lb(null,null,function*(){if(x.preventDefault(),!!s&&p()){d(!0),h(null);try{const b=wa(_a({},s),{title:a.title.trim(),description:a.description.trim()||void 0,priority:a.priority,dueDate:a.dueDate||new Date().toISOString(),status:a.status});yield n(s.id,b),t()}catch(b){h(b instanceof Error?b.message:"Failed to save task")}finally{d(!1)}}}),[s,a,p,n,t]),g=m.useCallback(()=>{o||t()},[o,t]);return m.useEffect(()=>{const x=b=>{b.key==="Escape"&&e&&!o&&t()};if(e)return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[e,o,t]),!e||!s?null:r.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:g,onKeyDown:x=>{x.key==="Escape"&&g()},role:"button",tabIndex:0,"aria-label":"Close modal"}),r.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:r.jsxs("div",{className:"relative w-full max-w-md transform overflow-hidden rounded-lg bg-white shadow-xl transition-all",children:[r.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Task"}),r.jsx("button",{onClick:g,disabled:o,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50","aria-label":"Close modal",children:r.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),r.jsxs("form",{onSubmit:y,className:"px-6 py-4",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),r.jsx("input",{type:"text",id:"title",value:a.title,onChange:x=>f("title",x.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.title?"border-red-300":"border-gray-300"}`,placeholder:"Enter task title",disabled:o}),c.title&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.title})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{id:"description",value:a.description,onChange:x=>f("description",x.target.value),rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.description?"border-red-300":"border-gray-300"}`,placeholder:"Enter task description (optional)",disabled:o}),c.description&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.description}),r.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[a.description.length,"/500 characters"]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),r.jsxs("select",{id:"priority",value:a.priority,onChange:x=>f("priority",x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o,children:[r.jsx("option",{value:"low",children:"Low"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"high",children:"High"}),r.jsx("option",{value:"urgent",children:"Urgent"})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),r.jsx("input",{type:"date",id:"dueDate",value:a.dueDate,onChange:x=>f("dueDate",x.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${c.dueDate?"border-red-300":"border-gray-300"}`,disabled:o}),c.dueDate&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.dueDate})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),r.jsxs("select",{id:"status",value:a.status,onChange:x=>f("status",x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o,children:[r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"completed",children:"Completed"})]})]}),u&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:r.jsx("p",{className:"text-sm text-red-800",children:u})}),r.jsxs("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:g,disabled:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:o?"Saving...":"Save Changes"})]})]})]})})]})};var qb=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Ub=({tasks:s,onTaskComplete:e,onTaskUpdate:t})=>{const[n,a]=m.useState(1),[i,c]=m.useState(null),[l,o]=m.useState(null),[d,u]=m.useState(!1),h=10,p=m.useCallback(D=>{if(!D.dueDate)return!1;const O=new Date(D.dueDate);return(new Date().getTime()-O.getTime())/(1e3*60*60)<=24},[]),f=m.useCallback(D=>{const O="task-item border rounded-lg p-4 mb-2",k=p(D);return or(O,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":k,"shadow-sm":!k})},[p]),y=m.useMemo(()=>Array.isArray(s)?s:[],[s]),g=m.useMemo(()=>y.filter(D=>D.status!=="completed"),[y]),x=m.useMemo(()=>Math.max(1,Math.ceil(g.length/h)),[g.length,h]),b=m.useMemo(()=>(n-1)*h,[n,h]),v=m.useMemo(()=>b+h,[b,h]),w=m.useMemo(()=>g.slice(b,v),[g,b,v]),S=m.useCallback(D=>{c(O=>O===D?null:D)},[]),T=m.useCallback(D=>{o(D),u(!0)},[]),C=m.useCallback((D,O)=>qb(null,null,function*(){if(t)try{yield t(D,O),u(!1),o(null)}catch(k){console.error("Failed to update task:",k)}}),[t]),P=m.useCallback(()=>{u(!1),o(null)},[]),N=m.useCallback(()=>{a(D=>Math.max(1,D-1))},[]),j=m.useCallback(()=>{a(D=>Math.min(x,D+1))},[x]),E=m.useMemo(()=>w.map(D=>r.jsxs("div",{className:f(D),children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>S(D.id),className:"text-gray-400 hover:text-gray-600","aria-label":i===D.id?"Collapse task details":"Expand task details",children:r.jsx("span",{className:`transform transition-transform ${i===D.id?"rotate-90":""}`,children:"▶"})}),r.jsx("span",{className:"font-medium",children:D.title}),p(D)&&r.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs("span",{className:"text-sm font-semibold text-[#4ECDC4] bg-[#4ECDC4] bg-opacity-10 px-2 py-1 rounded-full",children:["+",D.points||0," pts"]}),r.jsx("button",{onClick:()=>T(D),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Edit"}),e&&r.jsx("button",{onClick:()=>e(D.id,D.points||0),className:"px-3 py-1 text-xs bg-[#4ECDC4] text-white rounded hover:bg-[#38b2ac] transition-colors",children:"Complete"})]})]}),i===D.id&&r.jsxs("div",{className:"mt-3 pt-3 border-t",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:D.description}),r.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[r.jsxs("div",{children:["Priority: ",D.priority]}),r.jsxs("div",{children:["Status: ",D.status]}),r.jsxs("div",{children:["Points: ",D.points||0]}),D.dueDate&&r.jsxs("div",{children:["Due: ",new Date(D.dueDate).toLocaleDateString()]})]})]})]},D.id)),[w,i,S,T,e,f,p]);return g.length===0?r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No tasks available"}):r.jsxs("div",{className:"space-y-4",children:[E,x>1&&r.jsxs("div",{className:"flex items-center justify-between pt-4",children:[r.jsx("button",{onClick:N,disabled:n===1,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),r.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",n," of ",x]}),r.jsx("button",{onClick:j,disabled:n===x,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),r.jsx(Bb,{task:l,isOpen:d,onClose:P,onSave:C})]})},Hb={COMPLETE:"Complete"};var Vb=Object.defineProperty,Wb=Object.defineProperties,Gb=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,Kb=Object.prototype.hasOwnProperty,Qb=Object.prototype.propertyIsEnumerable,Vl=(s,e,t)=>e in s?Vb(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,wr=(s,e)=>{for(var t in e||(e={}))Kb.call(e,t)&&Vl(s,t,e[t]);if(Hl)for(var t of Hl(e))Qb.call(e,t)&&Vl(s,t,e[t]);return s},on=(s,e)=>Wb(s,Gb(e)),Yb=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Jb=s=>({id:s.id,title:s.title,description:s.description,status:s.status,priority:s.priority==="urgent"?"high":s.priority||"medium",due_date:s.dueDate,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),user_id:"",facility_id:"",completed:s.completed}),Vu=X.memo(({onTaskComplete:s,onTaskUpdate:e,tasks:t,itemHeight:n=120,containerHeight:a=600})=>{const[i,c]=m.useState(null),[l,o]=m.useState(null),[d,u]=m.useState({}),[h,p]=m.useState(0),f=m.useRef(null),y=m.useCallback(k=>{if(!k.dueDate)return!1;const $=new Date(k.dueDate);return(new Date().getTime()-$.getTime())/(1e3*60*60)<=24},[]),g=m.useCallback(k=>{const $="rounded-xl border border-gray-200 p-4 bg-white mx-2",U=y(k);return or($,{"shadow-lg border-l-4 border-[#4ECDC4] border-opacity-50 bg-gradient-to-r from-white to-teal-50":U,"shadow-sm":!U})},[y]),x=m.useMemo(()=>Array.isArray(t)?t:[],[t]),b=m.useMemo(()=>x.filter(k=>k.status!=="completed"),[x]),v=Math.ceil(a/n),w=Math.floor(h/n),S=Math.min(w+v+2,b.length),T=m.useMemo(()=>b.slice(w,S),[b,w,S]),C=b.length*n,P=m.useCallback(k=>{p(k.currentTarget.scrollTop)},[]),N=m.useCallback(k=>{c($=>$===k?null:k)},[]),j=m.useCallback(k=>{o(k.id),u(k)},[]),E=m.useCallback(()=>{o(null),u({})},[]),D=m.useCallback(()=>Yb(null,null,function*(){if(l)try{const k=b.find(z=>z.id===l);if(!k){console.error("Task not found for editing");return}const $=wr(wr({},k),d),U=Jb($),{createTaskService:H}=yield q(()=>import("./taskService-Dic_JfU8.js"),__vite__mapDeps([9,1,2,3,4,5]));yield H().updateTask(U),e&&e(l,$),o(null),u({})}catch(k){console.error("Failed to save task:",k)}}),[l,b,d,e]),O=m.useMemo(()=>T.map((k,$)=>{const H=(w+$)*n;return r.jsx("div",{className:"absolute w-full",style:{top:H,height:n},children:r.jsxs("div",{className:g(k),children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("button",{onClick:()=>N(k.id),className:"mt-1 text-gray-400 hover:text-gray-600","aria-label":i===k.id?"Collapse task details":"Expand task details",children:r.jsx(Oh,{className:`transform transition-transform ${i===k.id?"rotate-90":""}`})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"font-semibold text-gray-800",children:k.title}),y(k)&&r.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-[#4ECDC4] text-white rounded-full animate-pulse",children:"NEW"})]}),r.jsx("div",{className:"text-sm text-gray-500",children:`${k.category||"General"} - ${k.type||"Training"} - Due: ${k.dueDate||"N/A"}`})]})]}),r.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[r.jsxs("span",{className:"text-violet-600 font-semibold",children:["+",k.points," pts"]}),r.jsx("button",{onClick:()=>s==null?void 0:s(k.id,k.points||0),className:"rounded-full border border-green-500 text-green-500 text-sm px-3 py-1 hover:bg-green-50","aria-label":`Complete task: ${k.title}`,"data-testid":`task-checkbox-${k.id}`,children:Hb.COMPLETE})]})]}),i===k.id&&r.jsxs(r.Fragment,{children:[r.jsx("hr",{className:"my-3"}),r.jsxs("div",{className:"text-sm space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:`category-${k.id}`,className:"block text-gray-600 font-medium mb-1",children:"Category"}),l===k.id?r.jsx("input",{id:`category-${k.id}`,type:"text",value:d.category||"",onChange:A=>u(on(wr({},d),{category:A.target.value})),className:"w-full px-3 py-2 border rounded-md"}):r.jsx("div",{className:"text-gray-700",children:k.category||"General"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:`type-${k.id}`,className:"block text-gray-600 font-medium mb-1",children:"Type"}),l===k.id?r.jsx("input",{id:`type-${k.id}`,type:"text",value:d.type||"",onChange:A=>u(on(wr({},d),{type:A.target.value})),className:"w-full px-3 py-2 border rounded-md"}):r.jsx("div",{className:"text-gray-700",children:k.type||"Training"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:`dueDate-${k.id}`,className:"block text-gray-600 font-medium mb-1",children:"Due Date"}),l===k.id?r.jsx("input",{id:`dueDate-${k.id}`,type:"date",value:d.dueDate||"",onChange:A=>u(on(wr({},d),{dueDate:A.target.value})),className:"w-full px-3 py-2 border rounded-md"}):r.jsx("div",{className:"text-gray-700",children:k.dueDate||"N/A"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:`points-${k.id}`,className:"block text-gray-600 font-medium mb-1",children:"Points"}),l===k.id?r.jsx("input",{id:`points-${k.id}`,type:"number",value:d.points||0,onChange:A=>u(on(wr({},d),{points:parseInt(A.target.value)})),className:"w-full px-3 py-2 border rounded-md"}):r.jsxs("div",{className:"text-gray-700",children:[k.points||0," points"]})]})]}),r.jsx("div",{className:"mt-4 space-y-4",children:r.jsx("div",{className:"flex justify-between items-center",children:r.jsx("div",{className:"flex items-center space-x-2",children:r.jsxs("button",{onClick:()=>j(k),className:"rounded-full border border-violet-500 text-violet-500 text-sm px-3 py-1 hover:bg-violet-50","aria-label":`Edit task: ${k.title}`,children:[r.jsx($h,{className:"inline-block mr-1"}),"Edit"]})})})}),l===k.id&&r.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[r.jsx("button",{onClick:E,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),r.jsx("button",{onClick:D,className:"px-4 py-2 bg-violet-600 text-white rounded-md hover:bg-violet-700",children:"Save"})]})]})]})]})},k.id)}),[T,w,n,i,l,d,N,s,j,E,D,g,y]);return r.jsx("div",{ref:f,className:"relative overflow-auto",style:{height:a},onScroll:P,children:r.jsx("div",{style:{height:C,position:"relative"},children:O})})});Vu.displayName="VirtualizedTasksList";const Wl={categories:[{value:"operations",label:"Operations"},{value:"maintenance",label:"Maintenance"},{value:"safety",label:"Safety"}],types:[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}]},Xb=({selectedCategory:s,selectedType:e,onCategoryChange:t,onTypeChange:n})=>r.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:s,onChange:a=>t(a.target.value),children:[r.jsx("option",{value:"",children:"Category"}),Wl.categories.map(a=>r.jsx("option",{value:a.value,children:a.label},a.value))]}),r.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",value:e,onChange:a=>n(a.target.value),children:[r.jsx("option",{value:"",children:"Type"}),Wl.types.map(a=>r.jsx("option",{value:a.value,children:a.label},a.value))]}),r.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded-md bg-white",children:[r.jsx("option",{value:"",children:"Due Date"}),r.jsx("option",{value:"today",children:"Today"}),r.jsx("option",{value:"tomorrow",children:"Tomorrow"}),r.jsx("option",{value:"this_week",children:"This Week"})]})]})}),Zb=(s,e,t)=>{if(!s||s.length===0)return[];let n=s;return e&&(n=n.filter(a=>a.category===e)),t&&(n=n.filter(a=>a.type===t)),n},e_=({tasks:s,onTaskComplete:e,onTaskUpdate:t,availablePoints:n,showFilters:a,onToggleFilters:i,selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d,isLoading:u=!1})=>{const h=m.useMemo(()=>{if(s)return Zb(s,c,l)},[s,c,l]),p=m.useMemo(()=>h&&h.length>50,[h]);return u?r.jsx("div",{className:`${va()} h-full`,"data-testid":"tasks-list",children:r.jsxs("div",{className:"animate-pulse space-y-4",children:[r.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((f,y)=>r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded"}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),r.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]},y))})]})}):s?r.jsxs("div",{className:`${va()} h-full`,"data-testid":"tasks-list",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`bg-${Ae.COLORS.PRIMARY_BG} rounded-md p-1`,children:r.jsx(I,{path:ri,size:1,color:Ae.COLORS.PRIMARY})}),r.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:Ri.TASKS})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"px-3 py-2 text-sm font-semibold bg-[#4ECDC4] bg-opacity-10 text-[#4ECDC4] border border-[#4ECDC4] border-opacity-30 rounded-lg",children:["📊 Total Available: ",n," Points"]}),r.jsxs("button",{onClick:i,className:"p-2 bg-[#4ECDC4] hover:bg-[#38b2ac] rounded-lg text-white flex items-center transition-colors duration-200",children:[r.jsx(I,{path:iu,size:.8}),r.jsx("span",{className:"ml-1 text-sm hidden sm:inline-block",children:"Filter"})]})]})]}),a&&r.jsx(Xb,{selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto h-full",children:p?r.jsx(Vu,{tasks:h,onTaskComplete:e,onTaskUpdate:t,itemHeight:120,containerHeight:600}):r.jsx(Ub,{tasks:h,onTaskComplete:e,onTaskUpdate:t})})]}):r.jsx("div",{className:`${va()} h-full`,"data-testid":"tasks-list",children:r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-gray-500 text-center",children:[r.jsx("div",{className:"text-lg font-medium mb-2",children:"No tasks available"}),r.jsx("div",{className:"text-sm",children:"Tasks will appear here when they become available."})]})})})},t_=m.memo(e_),r_=({message:s="Something went wrong."})=>r.jsx("div",{role:"alert","aria-live":"assertive",className:"text-sm text-red-600 mt-2",children:s});function s_({loading:s,tasks:e,taskError:t}){return s?null:t?r.jsx(r_,{message:"Some tasks may not be available due to a loading error."}):(!e||e.length===0,null)}const Wu=X.memo(({tasks:s,loading:e,taskError:t,storeAvailablePoints:n,storeShowFilters:a,setStoreShowFilters:i,selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d,onTaskToggle:u,onTaskUpdate:h})=>r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(s_,{loading:e,tasks:s,taskError:t}),r.jsx(Es,{children:r.jsx("div",{className:"flex-1",children:r.jsx(t_,{tasks:s,onTaskComplete:u,onTaskUpdate:h,availablePoints:n,showFilters:a,onToggleFilters:()=>i(!a),selectedCategory:c,selectedType:l,onCategoryChange:o,onTypeChange:d})})})]}));Wu.displayName="HomeTasksSection";const n_=({data:s})=>r.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[r.jsxs("div",{className:"flex items-center mb-4",children:[r.jsx("span",{className:"bg-blue-100 rounded-md p-2 mr-3",children:r.jsx(Mh,{size:20,className:"text-[#2563eb]"})}),r.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Time Savings"})]}),r.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Day)"}),r.jsxs("span",{className:"text-base text-blue-900 text-right",children:[s.daily," hrs"]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Time Saved (Month)"}),r.jsxs("span",{className:"text-base text-blue-900 text-right",children:[s.monthly," hrs"]})]})]})]}),a_=({data:s={monthly:0,annual:0}})=>r.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[r.jsxs("div",{className:"flex items-center mb-4",children:[r.jsx("span",{className:"bg-green-100 rounded-md p-2 mr-3",children:r.jsx(Fh,{size:20,className:"text-green-800"})}),r.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Cost Savings"})]}),r.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Monthly Savings"}),r.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(s.monthly||0).toLocaleString()]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Annual Savings"}),r.jsxs("span",{className:"text-base text-blue-900 text-right",children:["$",(s.annual||0).toLocaleString()]})]})]})]});var ct=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class i_{constructor(){this.baselineData=null,this.lastUpdate=0,this.UPDATE_INTERVAL=120*1e3,this.cachedMetrics=null}getAIImpactMetrics(){return ct(this,null,function*(){try{const e=Date.now();if(e-this.lastUpdate<this.UPDATE_INTERVAL)return this.getCachedMetrics();this.baselineData||(this.baselineData=yield this.getBaselineData());const t=yield this.calculateRealTimeMetrics();return this.cacheMetrics(t),this.lastUpdate=e,t}catch(e){return console.error("Error getting AI impact metrics:",e),this.getDefaultMetrics()}})}calculateRealTimeMetrics(){return ct(this,null,function*(){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());new Date(t.getTime()-t.getDay()*24*60*60*1e3);const n=new Date(e.getFullYear(),e.getMonth(),1),{FacilityService:a}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:i}=yield a.getCurrentUserAndFacility(),{data:c}=yield _.from("ai_task_performance").select("*").eq("facility_id",i).gte("completed_at",n.toISOString()),{data:l}=yield _.from("ai_challenge_completions").select("*").eq("facility_id",i).gte("completed_at",n.toISOString()),o=yield this.calculateProactiveManagement(c||[],l||[]),{aiTimeSavingsService:d}=yield q(()=>Promise.resolve().then(()=>L_),void 0),u=yield d.getAITimeSavings(),h={daily:u.daily_time_saved,weekly:Math.round(u.daily_time_saved*7),monthly:u.monthly_time_saved,total:u.monthly_time_saved,percentage:0},{aiCostCalculationService:p}=yield q(()=>Promise.resolve().then(()=>o_),void 0),f=yield p.calculateCostSavings(h,c||[]),y=yield this.calculateEfficiencyGains(c||[]);return{timeSavings:h,proactiveManagement:o,costSavings:f,efficiencyGains:y,realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:new Date(Date.now()+this.UPDATE_INTERVAL).toISOString(),dataFreshness:Math.floor((Date.now()-this.lastUpdate)/6e4)}}})}calculateTimeSavings(e,t,n,a){return ct(this,null,function*(){var i;const l=e.filter(x=>new Date(x.completed_at)>=t).reduce((x,b)=>x+(b.time_saved||0),0),d=e.filter(x=>new Date(x.completed_at)>=n).reduce((x,b)=>x+(b.time_saved||0),0),u=e.filter(x=>new Date(x.completed_at)>=a),h=u.reduce((x,b)=>x+(b.time_saved||0),0),p=e.reduce((x,b)=>x+(b.time_saved||0),0),f=((i=this.baselineData)==null?void 0:i.preAITaskDuration)||30,y=u.length>0?u.reduce((x,b)=>x+b.actual_duration,0)/u.length:f,g=f>0?Math.round((f-y)/f*100):0;return{daily:l,weekly:d,monthly:h,total:p,percentage:Math.max(0,Math.min(100,g))}})}calculateProactiveManagement(e,t){return ct(this,null,function*(){const n=new Date;n.setHours(n.getHours()+2);const a=e.filter(f=>new Date(f.completed_at)<n).length,i=e.filter(f=>f.estimated_duration&&f.actual_duration&&f.actual_duration<f.estimated_duration).length,c=e.length,l=e.filter(f=>f.estimated_duration&&f.actual_duration&&f.actual_duration<=f.estimated_duration).length,o=c>0?Math.round(l/c*100):100,d=e.filter(f=>f.difficulty==="high"||f.difficulty==="urgent").length,u=c>0?Math.round((c-d)/c*100):100,h=t.filter(f=>f.quality_score&&f.quality_score>=4).length,p=t.length>0?Math.round(h/t.length*100):100;return{issuesPrevented:a,earlyInterventions:i,complianceScore:o,riskMitigation:u,predictiveAccuracy:p}})}calculateEfficiencyGains(e){return ct(this,null,function*(){const t=e.length,n=e.filter(d=>d.completed_at).length,a=t>0?Math.round(n/t*100):100,i=e.length>0?e.reduce((d,u)=>d+(u.efficiency_score||0),0)/e.length:100,c=Math.round(i),l=yield this.calculateResourceOptimization(),o=yield this.calculateWorkflowStreamlining();return{taskCompletionRate:a,qualityImprovement:c,resourceOptimization:l,workflowStreamlining:o}})}calculateResourceOptimization(){return ct(this,null,function*(){try{const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("sterilization_cycles").select("tools").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString());if(!n||n.length===0)return 85;const i=n.reduce((o,d)=>{var u;return o+(((u=d.tools)==null?void 0:u.length)||0)},0)/n.length,c={min:6,max:8},l=i>=c.min&&i<=c.max?100:Math.max(0,100-Math.abs(i-7)*10);return Math.round(l)}catch(e){return console.error(e),console.error("Error calculating resource optimization"),85}})}calculateWorkflowStreamlining(){return ct(this,null,function*(){try{const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("home_daily_operations_tasks").select("estimated_duration, actual_duration").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString());if(!n||n.length===0)return 80;const a=n.map(c=>!c.estimated_duration||!c.actual_duration?100:Math.max(0,Math.min(100,c.estimated_duration/c.actual_duration*100))),i=a.reduce((c,l)=>c+l,0)/a.length;return Math.round(i)}catch(e){return console.error("Error calculating workflow streamlining:",e),80}})}getBaselineData(){return ct(this,null,function*(){try{return{preAITaskDuration:45,preAICompletionRate:75,preAIErrorRate:15,preAICostPerTask:33.75,implementationDate:"2024-01-01"}}catch(e){return console.error("Error getting baseline data:",e),{preAITaskDuration:45,preAICompletionRate:75,preAIErrorRate:15,preAICostPerTask:33.75,implementationDate:"2024-01-01"}}})}cacheMetrics(e){this.cachedMetrics=e}getCachedMetrics(){return this.cachedMetrics||this.getDefaultMetrics()}getDefaultMetrics(){return{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:100,riskMitigation:100,predictiveAccuracy:100},costSavings:{daily:0,monthly:0,annual:0,roi:0},efficiencyGains:{taskCompletionRate:100,qualityImprovement:100,resourceOptimization:85,workflowStreamlining:80},realTimeUpdates:{lastUpdated:new Date().toISOString(),nextUpdate:new Date(Date.now()+this.UPDATE_INTERVAL).toISOString(),dataFreshness:0}}}getAIInsights(){return ct(this,null,function*(){try{const e=yield this.getAIImpactMetrics(),{aiReportingService:t}=yield q(()=>Promise.resolve().then(()=>c_),void 0);return yield t.getAIInsights(e)}catch(e){return console.error("Error getting AI insights:",e),["AI system is actively monitoring facility operations"]}})}}const Gl=new i_;var Sr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Gu{calculateCostSavings(e,t){return Sr(this,null,function*(){try{const n=yield this.getFacilityCosts(),a=this.calculateDirectTimeSavings(e,n.hourlyRate),i=yield this.calculateIndirectCostSavings(t,n),c=yield this.calculateErrorPreventionSavings(t,n),l=yield this.calculateComplianceSavings(),o=yield this.calculateResourceOptimizationSavings(),d=a.daily+i.daily+c.daily+l.daily+o.daily,u=a.monthly+i.monthly+c.monthly+l.monthly+o.monthly,h=1e4,p=u*12,f=h>0?p/h*100:0;return{daily:Math.round(d*100)/100,monthly:Math.round(u*100)/100,annual:Math.round(p*100)/100,roi:Math.round(f*100)/100}}catch(n){return console.error("Error calculating cost savings:",n),this.calculateBasicCostSavings(e)}})}getFacilityCosts(){return Sr(this,null,function*(){try{const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("facilities").select("hourly_rate, type, staff_count").eq("id",t).single();return{hourlyRate:(n==null?void 0:n.hourly_rate)||45,facilityType:(n==null?void 0:n.facility_type)||"general",staffCount:(n==null?void 0:n.staff_count)||10}}catch(e){return console.error(e),{hourlyRate:45,facilityType:"general",staffCount:10}}})}calculateDirectTimeSavings(e,t){return{daily:e.daily/60*t,monthly:e.monthly/60*t}}calculateIndirectCostSavings(e,t){return Sr(this,null,function*(){const a=t.hourlyRate*t.staffCount*.3*.5,i=a*22;return{daily:a,monthly:i}})}calculateErrorPreventionSavings(e,t){return Sr(this,null,function*(){try{const{FacilityService:n}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:a}=yield n.getCurrentUserAndFacility(),{data:i}=yield _.from("quality_incidents").select("cost_impact, severity").eq("facility_id",a).gte("created_at",new Date(Date.now()-720*60*60*1e3).toISOString());if(!i||i.length===0){const o=t.facilityType==="dental"?150:200;return{daily:o*.1,monthly:o*2}}const l=i.reduce((o,d)=>o+(d.cost_impact||0),0)*.4;return{daily:l/30,monthly:l}}catch(n){console.error(n);const a=200;return{daily:a*.1,monthly:a*2}}})}calculateComplianceSavings(){return Sr(this,null,function*(){return{daily:600/30,monthly:600}})}calculateResourceOptimizationSavings(){return Sr(this,null,function*(){try{const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility(),{data:n}=yield _.from("inventory_items").select("unit_cost, quantity, reorder_point").eq("facility_id",t),{data:a}=yield _.from("sterilization_cycles").select("tools, cycle_time").eq("facility_id",t).gte("created_at",new Date(Date.now()-10080*60*1e3).toISOString()),i=(n==null?void 0:n.filter(d=>d.quantity<d.reorder_point))||[],c=i?i.reduce((d,u)=>d+u.unit_cost*.1,0):100,l=a?a.reduce((d,u)=>d+u.cycle_time*.15,0):50,o=c+l;return{daily:o/30,monthly:o}}catch(e){return console.error(e),{daily:5,monthly:150}}})}calculateBasicCostSavings(e){const n=e.daily/60*45,a=e.monthly/60*45,i=a*12;return{daily:Math.round(n*100)/100,monthly:Math.round(a*100)/100,annual:Math.round(i*100)/100,roi:0}}}const Ku=new Gu,o_=Object.freeze(Object.defineProperty({__proto__:null,AICostCalculationService:Gu,aiCostCalculationService:Ku},Symbol.toStringTag,{value:"Module"}));var l_=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Qu{getAIInsights(e){return l_(this,null,function*(){try{const t=[];return e.timeSavings.daily>120&&t.push(`🚀 AI saved ${Math.round(e.timeSavings.daily/60)} hours today!`),e.costSavings.monthly>1e3&&t.push(`💰 AI generated $${e.costSavings.monthly} in monthly savings`),e.proactiveManagement.issuesPrevented>5&&t.push(`🛡️ AI prevented ${e.proactiveManagement.issuesPrevented} potential issues this week`),e.costSavings.roi>50&&t.push(`📈 AI ROI: ${e.costSavings.roi}% - Excellent investment!`),t}catch(t){return console.error("Error getting AI insights:",t),["AI system is actively monitoring facility operations"]}})}generateAIImpactReport(e){return`
AI Impact Report - ${new Date().toLocaleDateString()}
================================================

TIME SAVINGS
------------
Daily: ${Math.round(e.timeSavings.daily/60)} hours (${Math.round(e.timeSavings.daily)} minutes)
Weekly: ${Math.round(e.timeSavings.weekly/60)} hours (${Math.round(e.timeSavings.weekly)} minutes)
Monthly: ${Math.round(e.timeSavings.monthly/60)} hours (${Math.round(e.timeSavings.monthly)} minutes)
Total: ${Math.round(e.timeSavings.total/60)} hours (${Math.round(e.timeSavings.total)} minutes)
Improvement: ${e.timeSavings.percentage}%

PROACTIVE MANAGEMENT
-------------------
Issues Prevented: ${e.proactiveManagement.issuesPrevented}
Early Interventions: ${e.proactiveManagement.earlyInterventions}
Compliance Score: ${e.proactiveManagement.complianceScore}%
Risk Mitigation: ${e.proactiveManagement.riskMitigation}%
Predictive Accuracy: ${e.proactiveManagement.predictiveAccuracy}%

COST SAVINGS
------------
Daily: $${e.costSavings.daily}
Monthly: $${e.costSavings.monthly}
Annual: $${e.costSavings.annual}
ROI: ${e.costSavings.roi}%

EFFICIENCY GAINS
----------------
Task Completion Rate: ${e.efficiencyGains.taskCompletionRate}%
Quality Improvement: ${e.efficiencyGains.qualityImprovement}%
Resource Optimization: ${e.efficiencyGains.resourceOptimization}%
Workflow Streamlining: ${e.efficiencyGains.workflowStreamlining}%

REAL-TIME UPDATES
-----------------
Last Updated: ${new Date(e.realTimeUpdates.lastUpdated).toLocaleString()}
Next Update: ${new Date(e.realTimeUpdates.nextUpdate).toLocaleString()}
Data Freshness: ${e.realTimeUpdates.dataFreshness} minutes
`.trim()}generateExecutiveSummary(e){return`
AI Implementation Executive Summary
==================================

KEY HIGHLIGHTS
--------------
• AI has saved ${Math.round(e.timeSavings.monthly/60)} hours this month
• Generated $${e.costSavings.monthly} in monthly cost savings
• Achieved ${e.costSavings.roi}% ROI on AI investment
• Prevented ${e.proactiveManagement.issuesPrevented} potential issues

PERFORMANCE METRICS
-------------------
• Time Efficiency: ${e.timeSavings.percentage}% improvement
• Cost Reduction: $${e.costSavings.annual} annual savings
• Compliance: ${e.proactiveManagement.complianceScore}% score
• Quality: ${e.efficiencyGains.qualityImprovement}% improvement

RECOMMENDATIONS
---------------
• Continue AI implementation across all departments
• Monitor ROI trends for investment decisions
• Expand proactive management capabilities
• Leverage efficiency gains for strategic planning

Generated: ${new Date().toLocaleString()}
`.trim()}generatePerformanceBreakdown(e){return{timeAnalysis:{dailyBreakdown:{hours:Math.round(e.timeSavings.daily/60),minutes:Math.round(e.timeSavings.daily),percentage:e.timeSavings.percentage},weeklyBreakdown:{hours:Math.round(e.timeSavings.weekly/60),minutes:Math.round(e.timeSavings.weekly)},monthlyBreakdown:{hours:Math.round(e.timeSavings.monthly/60),minutes:Math.round(e.timeSavings.monthly)}},costAnalysis:{savings:{daily:e.costSavings.daily,monthly:e.costSavings.monthly,annual:e.costSavings.annual},roi:e.costSavings.roi,investment:1e4},efficiencyAnalysis:{completion:e.efficiencyGains.taskCompletionRate,quality:e.efficiencyGains.qualityImprovement,resources:e.efficiencyGains.resourceOptimization,workflow:e.efficiencyGains.workflowStreamlining},proactiveAnalysis:{issues:e.proactiveManagement.issuesPrevented,interventions:e.proactiveManagement.earlyInterventions,compliance:e.proactiveManagement.complianceScore,risk:e.proactiveManagement.riskMitigation,accuracy:e.proactiveManagement.predictiveAccuracy},metadata:{generated:new Date().toISOString(),lastUpdated:e.realTimeUpdates.lastUpdated,nextUpdate:e.realTimeUpdates.nextUpdate,dataFreshness:e.realTimeUpdates.dataFreshness}}}}const kn=new Qu,c_=Object.freeze(Object.defineProperty({__proto__:null,AIReportingService:Qu,aiReportingService:kn},Symbol.toStringTag,{value:"Module"}));var Sa=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Yu{getAIImpactMetrics(){return Sa(this,null,function*(){return yield Gl.getAIImpactMetrics()})}getAIInsights(){return Sa(this,null,function*(){return yield Gl.getAIInsights()})}generateAIImpactReport(e){return kn.generateAIImpactReport(e)}generateExecutiveSummary(e){return kn.generateExecutiveSummary(e)}generatePerformanceBreakdown(e){return kn.generatePerformanceBreakdown(e)}calculateCostSavings(e,t){return Sa(this,null,function*(){return yield Ku.calculateCostSavings(e,t)})}}const Ai=new Yu,d_=Object.freeze(Object.defineProperty({__proto__:null,AIImpactMeasurementService:Yu,aiImpactMeasurementService:Ai},Symbol.toStringTag,{value:"Module"}));var u_=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const m_=({timeframe:s="daily",aiImpactMetrics:e})=>{const[t,n]=m.useState(null),[a,i]=m.useState(!0);if(m.useEffect(()=>{if(e){console.log("🤖 EnhancedAiEfficiencyCard: Using pre-loaded AI metrics:",e),n(e),i(!1);return}console.log("🤖 EnhancedAiEfficiencyCard: No pre-loaded metrics, fetching independently...");const u=()=>u_(null,null,function*(){try{i(!0);const p=yield Ai.getAIImpactMetrics();n(p)}catch(p){console.error("Error fetching AI metrics:",p)}finally{i(!1)}});u();const h=setInterval(u,120*1e3);return()=>clearInterval(h)},[e]),a)return r.jsx("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:r.jsxs("div",{className:"animate-pulse",children:[r.jsxs("div",{className:"flex items-center mb-4",children:[r.jsx("div",{className:"bg-purple-200 rounded-md p-2 mr-3 w-10 h-10"}),r.jsx("div",{className:"h-5 bg-gray-200 rounded w-32"})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})});const c=t||{timeSavings:{daily:0,weekly:0,monthly:0,total:0,percentage:0},costSavings:{daily:0,monthly:0,annual:0,roi:0}},l=()=>{const u=(()=>{switch(s){case"daily":return c.timeSavings.daily;case"weekly":return c.timeSavings.weekly;case"monthly":return c.timeSavings.monthly;default:return c.timeSavings.daily}})();return console.log("🕒 EnhancedAiEfficiencyCard: getTimeframeValue:",{timeframe:s,timeSavings:c.timeSavings,returnedValue:u}),u},o=u=>{console.log("⏰ EnhancedAiEfficiencyCard: formatTime called with:",u);const h=(()=>{if(u<60)return`${u} m`;const p=Math.floor(u/60),f=u%60;return f>0?`${p}h ${f} m`:`${p}h`})();return console.log("⏰ EnhancedAiEfficiencyCard: formatTime result:",h),h},d=u=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(u);return r.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"bg-purple-200 rounded-md p-2 mr-3",children:r.jsx(zh,{size:20,className:"text-purple-900"})}),r.jsx("div",{children:r.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"AI & Process Efficiency"})})]}),r.jsx("div",{className:"flex items-center text-xs text-gray-400"})]}),r.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-xs text-left text-gray-500",children:"Time Saved"}),r.jsx("span",{className:"text-base text-right text-gray-700",children:o(l())})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-xs text-left text-gray-500",children:"Cost Saved"}),r.jsx("span",{className:"text-base text-right text-gray-700",children:d(s==="weekly"?c.costSavings.monthly/4:c.costSavings[s]||0)})]})]})]})},h_=({data:s})=>r.jsxs("div",{className:"bg-white rounded-xl shadow p-6 border border-gray-100",children:[r.jsxs("div",{className:"flex items-center mb-4",children:[r.jsx("span",{className:"bg-yellow-200 rounded-md p-2 mr-3",children:r.jsx(Lh,{size:20,className:"text-yellow-900"})}),r.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Team Performance"})]}),r.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Skills"}),r.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[s.skills,"%"]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Inventory Efficiency"}),r.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[s.inventory,"%"]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-500 text-xs text-left",children:"Sterilization Efficiency"}),r.jsxs("span",{className:"text-base text-yellow-900 text-right",children:[s.sterilization,"%"]})]})]})]});function p_(s){return Ep({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"},child:[]}]})(s)}const f_=({metrics:s={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0}},aiImpactMetrics:e})=>{var t,n,a,i,c,l,o,d,u;const[h]=m.useState("daily");return console.log("📊 PerformanceMetrics: Received metrics:",s),console.log("🤖 PerformanceMetrics: Received aiImpactMetrics:",e),console.log("👥 PerformanceMetrics: Team performance data:",s.teamPerformance),e&&console.log("🔍 aiImpactMetrics structure:",{timeSavings:e.timeSavings,costSavings:e.costSavings,keys:Object.keys(e)}),r.jsxs("div",{className:"bg-white rounded-lg p-4 pt-2",children:[r.jsx("div",{className:"flex items-center justify-between mb-6",style:{marginTop:"-8px"},children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"bg-teal-100 rounded-md p-1",children:r.jsx(p_,{size:24,color:"#4ECDC4"})}),r.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:"Performance Metrics"})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsx(n_,{data:s.timeSaved,timeframe:h}),r.jsx(a_,{data:s.costSavings}),r.jsx(m_,{timeframe:h,showInsights:!1,aiImpactMetrics:e?{timeSavings:{daily:((t=e.timeSavings)==null?void 0:t.daily)||0,weekly:((n=e.timeSavings)==null?void 0:n.weekly)||0,monthly:((a=e.timeSavings)==null?void 0:a.monthly)||0,total:((i=e.timeSavings)==null?void 0:i.total)||0,percentage:((c=e.timeSavings)==null?void 0:c.percentage)||0},costSavings:{daily:((l=e.costSavings)==null?void 0:l.daily)||0,monthly:((o=e.costSavings)==null?void 0:o.monthly)||0,annual:((d=e.costSavings)==null?void 0:d.annual)||0,roi:((u=e.costSavings)==null?void 0:u.roi)||0},proactiveManagement:{issuesPrevented:0,earlyInterventions:0,complianceScore:0,riskMitigation:0,predictiveAccuracy:0},efficiencyGains:{taskCompletionRate:0,qualityImprovement:0,resourceOptimization:0,workflowStreamlining:0},realTimeUpdates:{updated_at:new Date().toISOString(),nextUpdate:"",dataFreshness:100}}:null}),r.jsx(h_,{data:s.teamPerformance,timeframe:h})]})]})};function g_(){return r.jsxs("div",{className:"border rounded-lg p-4 bg-purple-50 shadow-sm mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"BI Indicator Dashboard"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Biological indicator results will be displayed here once available."})]})}function y_(){return r.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50 shadow-sm mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CI Indicator Dashboard"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Chemical indicator results will be displayed here once available."})]})}const v_=({biData:s,ciData:e,performanceMetrics:t,aiImpactMetrics:n})=>r.jsxs("div",{className:Zv(),"data-testid":"metrics-section",children:[r.jsx(f_,{metrics:t,aiImpactMetrics:n}),s&&r.jsx(g_,{}),e&&r.jsx(y_,{})]}),x_=m.memo(v_);var b_=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const __=({onRefresh:s,className:e="",size:t="md"})=>{const[n,a]=m.useState(!1),[i,c]=m.useState(null),[l,o]=m.useState("idle"),d={sm:"w-6 h-6 text-sm",md:"w-8 h-8 text-base",lg:"w-10 h-10 text-lg"},u=()=>b_(null,null,function*(){if(!n){a(!0),o("idle");try{yield s(),c(new Date),o("success"),setTimeout(()=>o("idle"),2e3)}catch(y){console.error("Refresh failed:",y),o("error"),setTimeout(()=>o("idle"),3e3)}finally{a(!1)}}}),h=()=>{if(n)return r.jsx(Ji,{className:"animate-spin"});switch(l){case"success":return r.jsx(qh,{className:"text-green-500"});case"error":return r.jsx(Bh,{className:"text-red-500"});default:return r.jsx(Ji,{})}},p=()=>n?"Refreshing...":l==="success"?"Updated successfully":l==="error"?"Refresh failed":i?`Last updated: ${i.toLocaleTimeString()}`:"Refresh",f=()=>n?"Refreshing performance metrics":l==="success"?"Performance metrics updated successfully":l==="error"?"Failed to refresh performance metrics - try again":i?`Refresh performance metrics - Last updated: ${i.toLocaleTimeString()}`:"Refresh performance metrics (PRN)";return r.jsx(Fu,{content:p(),children:r.jsx("button",{onClick:u,disabled:n,className:`
          ${d[t]}
          flex items-center justify-center
          bg-white hover:bg-gray-50
          border border-gray-200 hover:border-gray-300
          rounded-lg shadow-sm hover:shadow-md
          transition-all duration-200
          disabled:opacity-50 disabled:cursor-not-allowed
          ${e}
        `,"aria-label":f(),children:h()})})};var Kl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class w_{constructor(){this.cache=null,this.CACHE_DURATION=1440*60*1e3,this.lastLogTime=0}fetchAndCacheMetricsOnLogin(){return Kl(this,null,function*(){try{R.debug("PerformanceMetricsCache: Fetching metrics on login...");const{homeMetricsService:e}=yield q(()=>Promise.resolve().then(()=>q_),void 0),{homeSterilizationIntegration:t}=yield q(()=>Promise.resolve().then(()=>H_),void 0),{homeIntegrationService:n}=yield q(()=>Promise.resolve().then(()=>W_),void 0),{FacilityService:a}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:i}=yield a.getCurrentUserAndFacility();if(!i)return R.debug("PerformanceMetricsCache: No facility ID, skipping cache"),null;const[c,l,o,d]=yield Promise.allSettled([e.getHomeMetrics(),t.getSterilizationMetrics(),n.getAllMetrics(),q(()=>Promise.resolve().then(()=>d_),void 0).then(p=>p.aiImpactMeasurementService.getAIImpactMetrics())]),u={aiMetrics:c.status==="fulfilled"?c.value:null,sterilizationMetrics:l.status==="fulfilled"?l.value:null,integrationMetrics:o.status==="fulfilled"?o.value:null,aiImpactMetrics:d.status==="fulfilled"?d.value:null,timestamp:Date.now(),facilityId:i};this.cache=u;try{localStorage.setItem("performanceMetricsCache",JSON.stringify(u))}catch(p){R.debug("PerformanceMetricsCache: Could not store in localStorage")}const h=Date.now();return h-this.lastLogTime>1e3&&(R.debug("PerformanceMetricsCache: Metrics cached successfully for facility:",i),this.lastLogTime=h),u}catch(e){return console.error("PerformanceMetricsCache: Error fetching metrics on login:",e),null}})}getCachedMetrics(){if(this.cache&&this.isCacheValid(this.cache))return this.cache;try{const e=localStorage.getItem("performanceMetricsCache");if(e){const t=JSON.parse(e);if(this.isCacheValid(t))return this.cache=t,t}}catch(e){R.debug("PerformanceMetricsCache: Could not read from localStorage:",err)}return null}refreshMetrics(){return Kl(this,null,function*(){return R.debug("PerformanceMetricsCache: Manual refresh requested"),this.cache=null,localStorage.removeItem("performanceMetricsCache"),yield this.fetchAndCacheMetricsOnLogin()})}isCacheValid(e){const n=Date.now()-e.timestamp;if(n>this.CACHE_DURATION)return R.debug("PerformanceMetricsCache: Cache expired (age:",n,"ms)"),!1;try{Mt.getCurrentUserAndFacility().then(({facilityId:a})=>{if(a!==e.facilityId)return R.debug("PerformanceMetricsCache: Facility changed, cache invalid"),!1})}catch(a){}return!0}clearCache(){this.cache=null,localStorage.removeItem("performanceMetricsCache"),R.debug("PerformanceMetricsCache: Cache cleared")}getCacheStatus(){const e=this.getCachedMetrics();return e?{hasCache:!0,age:Date.now()-e.timestamp,facilityId:e.facilityId}:{hasCache:!1}}}const li=new w_;var S_=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const C_=X.memo(function({loading:e=!1,aiMetrics:t,sterilizationMetrics:n,integrationMetrics:a,aiImpactMetrics:i}){const c=()=>S_(null,null,function*(){try{li.clearCache(),yield li.fetchAndCacheMetricsOnLogin(),window.location.reload()}catch(d){throw console.error("Failed to refresh metrics:",d),d}}),l=m.useMemo(()=>{var d,u,h;return{timeSaved:(t==null?void 0:t.timeSaved)||{daily:0,monthly:0},aiTimeSaved:(t==null?void 0:t.aiTimeSaved)||{daily:0,monthly:0},costSavings:(t==null?void 0:t.costSavings)||{monthly:0,annual:0},aiEfficiency:(t==null?void 0:t.aiEfficiency)||{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:((d=t==null?void 0:t.teamPerformance)==null?void 0:d.skills)||0,inventory:((u=t==null?void 0:t.teamPerformance)==null?void 0:u.inventory)||0,sterilization:((h=t==null?void 0:t.teamPerformance)==null?void 0:h.sterilization)||0}}},[t]);return e&&!(t||n||a)?r.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full",children:r.jsxs("div",{className:"animate-pulse space-y-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})}):r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute top-4 right-4 z-10",children:r.jsx(__,{onRefresh:c,size:"sm",className:"shadow-md"})}),r.jsx(m.Suspense,{fallback:r.jsx(js,{}),children:r.jsx(Es,{fallback:r.jsx("div",{className:"sr-only",children:"Metrics section failed to load."}),children:r.jsx(x_,{biData:void 0,ciData:void 0,performanceMetrics:l,aiImpactMetrics:i})})})]})}),j_=({points:s})=>{const e=Math.max(0,s||0);return r.jsx("div",{className:"text-xl font-bold text-[#4ECDC4]",children:e})},N_=({streakCount:s})=>{const e=Math.max(0,s||0);return r.jsxs("div",{className:"text-sm text-orange-500 font-medium",children:["🔥 ",e,"-day streak"]})},I_=({level:s})=>{const e=Math.max(1,s||1);return r.jsx("span",{className:"text-xl font-bold text-[#4ECDC4]",children:e})},T_=({gamificationData:s={streak:0,level:1,rank:100,totalScore:0,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}}})=>r.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2","aria-label":Ri.STATS,"aria-live":"polite","data-testid":"gamification-stats",children:r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[r.jsxs("div",{className:"flex items-center p-1 pr-8",children:[r.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:r.jsx(Uh,{size:20,className:"text-[#4ECDC4]"})}),r.jsxs("div",{className:"ml-2",children:[r.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Current Streak"}),r.jsx("div",{className:"flex items-baseline",children:r.jsx(N_,{streakCount:s.streak})})]})]}),r.jsxs("div",{className:"flex items-center p-1",children:[r.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:r.jsx(Hh,{size:20,className:"text-[#4ECDC4]"})}),r.jsxs("div",{className:"ml-2",children:[r.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Level"}),r.jsxs("div",{className:"flex items-baseline",children:[r.jsx(I_,{level:s.level}),r.jsx("div",{className:"ml-2 px-2 py-0.5 bg-blue-100 rounded-full",children:r.jsxs("span",{className:"text-xs font-semibold text-blue-600",children:["Top ",s.rank,"%"]})})]})]})]}),r.jsxs("div",{className:"flex items-center p-1 pl-8",children:[r.jsx("div",{className:"p-2 bg-[#4ECDC4] bg-opacity-10 rounded-full",children:r.jsx(Vh,{size:20,className:"text-[#4ECDC4]"})}),r.jsxs("div",{className:"ml-2",children:[r.jsx("h2",{className:"text-sm font-semibold text-[#1e293b]",children:"Points"}),r.jsx("div",{className:"flex items-baseline",children:r.jsx(j_,{points:s.totalScore})})]})]})]})}),Ca={DEFAULT_RANK:100,DEFAULT_LEVEL:1,DEFAULT_SCORE:0},Ju=X.memo(({gamificationData:s})=>{const{stats:e,loading:t}=Lu(),{updateGamificationData:n}=Pi(),i=!(s&&typeof s.streak=="number"&&typeof s.level=="number"&&typeof s.rank=="number"&&typeof s.totalScore=="number"&&s.streak>=0&&s.level>=1&&s.rank>=1&&s.totalScore>=0)||t,c=m.useMemo(()=>{const l=Math.max(0,(s==null?void 0:s.streak)||0),o=Math.max(1,(s==null?void 0:s.level)||Ca.DEFAULT_LEVEL),d=Math.max(1,(s==null?void 0:s.rank)||Ca.DEFAULT_RANK),u=Math.max(0,(s==null?void 0:s.totalScore)||Ca.DEFAULT_SCORE);return{streak:l,level:o,rank:d,totalScore:u,stats:{toolsSterilized:e.toolsSterilized||0,inventoryChecks:e.inventoryChecks||0,perfectDays:e.perfectDays||0,totalTasks:e.totalTasks||0,completedTasks:e.completedTasks||0,currentStreak:e.currentStreak||l,bestStreak:e.bestStreak||0}}},[s==null?void 0:s.streak,s==null?void 0:s.level,s==null?void 0:s.rank,s==null?void 0:s.totalScore,e]);return m.useEffect(()=>{!i&&c&&n(c)},[c,i,n]),i?r.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2",children:r.jsx("div",{className:"animate-pulse",children:r.jsxs("div",{className:"flex items-center justify-between p-1",children:[r.jsxs("div",{className:"flex items-center p-1",children:[r.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:r.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),r.jsxs("div",{className:"ml-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 mb-1"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]}),r.jsxs("div",{className:"flex items-center p-1",children:[r.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:r.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),r.jsxs("div",{className:"ml-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),r.jsxs("div",{className:"flex items-baseline",children:[r.jsx("div",{className:"h-6 bg-gray-200 rounded w-8 mr-2"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]})]}),r.jsxs("div",{className:"flex items-center p-1 pl-8",children:[r.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:r.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),r.jsxs("div",{className:"ml-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),r.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]})]})]})})}):r.jsx(T_,{gamificationData:c})});Ju.displayName="HomeGamificationSection";const Xu=X.memo(({gamificationData:s,tasks:e,loading:t,taskError:n,storeAvailablePoints:a,storeShowFilters:i,setStoreShowFilters:c,selectedCategory:l,selectedType:o,onCategoryChange:d,onTypeChange:u,onTaskToggle:h,onTaskUpdate:p,aiMetrics:f,sterilizationMetrics:y,integrationMetrics:g,aiImpactMetrics:x})=>{const b=m.useMemo(()=>or("flex flex-col lg:flex-row gap-6",`mt-${Ae.SPACING.MARGIN_TOP}`),[]),v=m.useMemo(()=>or(`p-${Ae.SPACING.PADDING}`),[]);return r.jsx("div",{className:v,children:r.jsxs("div",{className:"space-y-6",children:[r.jsx(Ju,{gamificationData:s}),r.jsxs("div",{className:b,children:[r.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:r.jsx(Wu,{tasks:e,loading:t,taskError:n,storeAvailablePoints:a,storeShowFilters:i,setStoreShowFilters:c,selectedCategory:l,selectedType:o,onCategoryChange:d,onTypeChange:u,onTaskToggle:h,onTaskUpdate:p})}),r.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:r.jsx(C_,{loading:t,aiMetrics:f,sterilizationMetrics:y,integrationMetrics:g,aiImpactMetrics:x})})]})]})})});Xu.displayName="HomeContentLayout";var ln=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Zu=X.memo(({homeData:s})=>{const[e,t]=m.useState(!1),[n,a]=m.useState(!1),[i,c]=m.useState(""),[l,o]=m.useState(""),d=m.useMemo(()=>s.tasks||[],[s.tasks]),u=s.totalTasksCount||0,[h,p]=m.useState(1),y=Math.ceil(u/10),g=h<y,x=m.useCallback(()=>{g&&p(M=>M+1)},[g]),b=m.useCallback(()=>{h>1&&p(M=>M-1)},[h]),v=m.useCallback(M=>{M>=1&&M<=y&&p(M)},[y]),w=m.useCallback(M=>ln(null,null,function*(){console.log("Completing task:",M)}),[]),S=m.useCallback(()=>ln(null,null,function*(){console.log("Refreshing tasks...")}),[]),T=!1,C=null,{aiMetrics:P={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:N={},integrationMetrics:j={},aiImpactMetrics:E=null}=s||{},D=m.useMemo(()=>d.map(M=>({id:M.id,title:M.title,description:M.description||"",completed:M.isCompleted,points:M.points,type:M.category,category:M.category,priority:"medium",dueDate:M.createdAt,status:M.isCompleted?"completed":"pending"})),[d]),O=m.useMemo(()=>d.reduce((M,W)=>M+(W.points||0),0),[d]),k=m.useMemo(()=>(L=>L&&typeof L.streak=="number"&&L.streak>=0&&typeof L.level=="number"&&L.level>=1&&typeof L.rank=="number"&&L.rank>=1&&typeof L.totalScore=="number"&&L.totalScore>=0)(s.gamificationData)?s.gamificationData:{streak:0,level:5,rank:1,totalScore:Math.max(0,O||0)},[s.gamificationData,O]),$=m.useCallback(M=>{t(M)},[]);m.useCallback(()=>{},[]);const U=m.useCallback(M=>{c(M)},[]),H=m.useCallback(M=>{o(M)},[]),A=m.useCallback((M,W)=>ln(null,null,function*(){try{const{FacilityService:L}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{userId:K}=yield L.getCurrentUserAndFacility();if(!K)throw new Error("No authenticated user for task toggle");yield w(M,K),W&&W>0&&console.log(`Task completed! Awarded ${W} points.`)}catch(L){console.error("Error toggling task:",L)}}),[w]),z=m.useCallback((M,W)=>ln(null,null,function*(){try{const L={title:W.title,description:W.description,category:W.category,points:W.points||0,isCompleted:W.status==="completed"};yield Hu.updateDailyTask(M,L),yield S(),console.log("Task updated successfully:",M)}catch(L){throw console.error("Failed to update task:",L),L}}),[S]);return r.jsxs("div",{className:"home-content","data-testid":"home-content",children:[r.jsx(Xu,{gamificationData:k,tasks:D,loading:T,taskError:C,storeAvailablePoints:O,storeShowFilters:n,setStoreShowFilters:a,selectedCategory:i,selectedType:l,onCategoryChange:U,onTypeChange:H,onTaskToggle:A,onTaskUpdate:z,aiMetrics:P||void 0,sterilizationMetrics:N||void 0,integrationMetrics:j||void 0,aiImpactMetrics:E||void 0}),y>1&&r.jsxs("div",{className:"mt-8 mb-4",children:[r.jsx("div",{className:"flex justify-center mb-4",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"paginationStyle",checked:!e,onChange:()=>$(!1),className:"mr-2"}),"Pagination"]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"paginationStyle",checked:e,onChange:()=>$(!0),className:"mr-2"}),"Load More"]})]})}),e?r.jsx(Ab,{onLoadMore:x,hasMore:g,isLoading:T,className:"mb-4"}):r.jsx(Rb,{currentPage:h,totalPages:y,onPageChange:v,onNextPage:x,onPreviousPage:b,hasNextPage:g,hasPreviousPage:h>1,isLoading:T,className:"mb-4"})]})]})});Zu.displayName="HomeContent";function E_({homeData:s}){const{setShowStatsModal:e,setShowLeaderboardModal:t,setShowChallengeModal:n}=Pi(),{isDrawerOpen:a}=Su(),{navBarMarginLeft:i,navBarMarginTop:c}=Xv(a),l=m.useRef(null),o=m.useCallback(()=>e(!0),[e]),d=m.useCallback(()=>t(!0),[t]),u=m.useCallback(()=>n(!0),[n]);return r.jsx(Es,{children:r.jsxs(Hr,{children:[r.jsxs("div",{className:or("h-screen bg-gradient-to-br hide-scrollbar overflow-hidden",`from-${Ae.COLORS.BG_GRADIENT.FROM}`,`to-${Ae.COLORS.BG_GRADIENT.TO}`),"aria-label":"Cliniio Home Dashboard",children:[r.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white text-black p-2 z-50 rounded shadow-lg","aria-label":"Skip to main content",children:"Skip to main content"}),r.jsxs("main",{className:`flex-1 border-l-${Ae.BORDER.LEFT_WIDTH} border-${Ae.COLORS.BORDER} pt-6 overflow-hidden`,role:"main",id:"main-content",ref:l,tabIndex:-1,"aria-label":"Main content area",children:[r.jsx("div",{style:{marginLeft:i,marginTop:c},className:"flex-shrink-0","aria-label":"Dashboard header container",children:r.jsx(Jv,{onStatsClick:o,onLeaderboardClick:d,onChallengeClick:u})}),r.jsx("div",{style:{marginLeft:i},className:"flex-1 overflow-y-auto hide-scrollbar",role:"region","aria-label":"Dashboard content",children:r.jsx(Zu,{homeData:s})})]})]}),r.jsx(kx,{leaderboardData:s.leaderboardData})]})})}function k_(s){return s.toISOString().split("T")[0]}var D_=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function P_(s,e){return D_(this,null,function*(){const{data:t}=yield _.from("performance_metrics").select("*").eq("date",s).eq("facility_id",e);return t||[]})}var R_=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function A_(){return R_(this,null,function*(){try{const s=yield Ai.getAIImpactMetrics();return{monthly:s.costSavings.monthly,annual:s.costSavings.annual}}catch(s){return console.warn("Failed to get AI impact metrics for cost savings:",s),{monthly:0,annual:0}}})}var em=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function O_(){return em(this,null,function*(){try{const s=yield A_();return{monthly_cost_savings:s.monthly,annual_cost_savings:s.annual}}catch(s){return console.error("Error getting cost savings aggregates:",s),{monthly_cost_savings:0,annual_cost_savings:0}}})}function $_(){return em(this,null,function*(){try{const{FacilityService:s}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:e}=yield s.getCurrentUserAndFacility(),t=k_(new Date);console.log("👥 getTeamPerformanceAggregates: Fetching for facility:",e,"date:",t);const n=yield P_(t,e);console.log("👥 getTeamPerformanceAggregates: Daily metrics:",n);const a=n==null?void 0:n.find(c=>c.metric_type==="team_performance");console.log("👥 getTeamPerformanceAggregates: Team performance data:",a);const i={skills_score:(a==null?void 0:a.skills)||85,inventory_score:(a==null?void 0:a.inventory)||92,sterilization_score:(a==null?void 0:a.sterilization)||88};return console.log("👥 getTeamPerformanceAggregates: Returning:",i),i}catch(s){return console.error("Error getting team performance aggregates:",s),{skills_score:85,inventory_score:92,sterilization_score:88}}})}var cn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class M_{constructor(){this.CACHE_DURATION=300*1e3,this.cache=new Map}isCacheValid(e){return Date.now()-e<this.CACHE_DURATION}getCachedData(e){const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}getOperationalTimeSavings(){return cn(this,null,function*(){try{console.log("🔍 OperationalTimeSavingsService: Starting calculation...");const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility();if(console.log("🏥 OperationalTimeSavingsService: Facility ID:",t),!t)return console.log("❌ OperationalTimeSavingsService: No facility ID, returning defaults"),{daily_time_saved:0,monthly_time_saved:0};const n=`operational-time-savings-${t}-${new Date().toISOString().split("T")[0]}`,a=this.getCachedData(n);if(a)return console.log("📊 OperationalTimeSavingsService: Using cached data:",a),a;console.log("🧮 OperationalTimeSavingsService: Calculating from multiple sources...");const[i,c,l]=yield Promise.all([this.calculateSterilizationTimeSavings(t),this.calculateTaskCompletionTimeSavings(t),this.calculateCleaningTimeSavings(t)]);console.log("📈 OperationalTimeSavingsService: Individual savings:",{sterilization:i,tasks:c,cleaning:l});const o=i.daily+c.daily+l.daily,d=i.monthly+c.monthly+l.monthly,u={daily_time_saved:Math.round(o),monthly_time_saved:Math.round(d)};return this.setCachedData(n,u),console.log("✅ OperationalTimeSavingsService: Final result:",u),u}catch(e){return console.error("❌ OperationalTimeSavingsService: Error calculating operational time savings:",e),{daily_time_saved:0,monthly_time_saved:0}}})}calculateSterilizationTimeSavings(e){return cn(this,null,function*(){try{const t=new Date().toISOString().split("T")[0],n=new Date().toISOString().slice(0,7),{data:a}=yield _.from("sterilization_cycles").select("duration_minutes, end_time").eq("facility_id",e).eq("status","completed").gte("end_time",`${t}T00:00:00`).lt("end_time",`${t}T23:59:59`),{data:i}=yield _.from("sterilization_cycles").select("duration_minutes, end_time").eq("facility_id",e).eq("status","completed").gte("end_time",`${n}-01T00:00:00`).lt("end_time",`${n}-31T23:59:59`),c=(a||[]).reduce((o,d)=>{const h=d.duration_minutes||60;return o+Math.max(0,60-h)},0),l=(i||[]).reduce((o,d)=>{const h=d.duration_minutes||60;return o+Math.max(0,60-h)},0);return{daily:c,monthly:l}}catch(t){return R.error("OperationalTimeSavingsService: Error calculating sterilization savings:",t),{daily:0,monthly:0}}})}calculateTaskCompletionTimeSavings(e){return cn(this,null,function*(){try{const t=new Date().toISOString().split("T")[0],n=new Date().toISOString().slice(0,7),{data:a}=yield _.from("home_daily_operations_tasks").select("estimated_duration, actual_duration").eq("facility_id",e).eq("completed",!0).gte("completed_at",`${t}T00:00:00`).lt("completed_at",`${t}T23:59:59`),{data:i}=yield _.from("home_daily_operations_tasks").select("estimated_duration, actual_duration").eq("facility_id",e).eq("completed",!0).gte("completed_at",`${n}-01T00:00:00`).lt("completed_at",`${n}-31T23:59:59`),c=(a||[]).reduce((o,d)=>{const u=d.estimated_duration||30,h=d.actual_duration||u;return o+Math.max(0,u-h)},0),l=(i||[]).reduce((o,d)=>{const u=d.estimated_duration||30,h=d.actual_duration||u;return o+Math.max(0,u-h)},0);return{daily:c,monthly:l}}catch(t){return R.error("OperationalTimeSavingsService: Error calculating task completion savings:",t),{daily:0,monthly:0}}})}calculateCleaningTimeSavings(e){return cn(this,null,function*(){try{return{daily:45,monthly:1350}}catch(t){return R.error("OperationalTimeSavingsService: Error calculating cleaning savings:",t),{daily:0,monthly:0}}})}clearCache(){this.cache.clear()}}const F_=new M_;var ls=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class z_{constructor(){this.CACHE_DURATION=300*1e3,this.cache=new Map}isCacheValid(e){return Date.now()-e<this.CACHE_DURATION}getCachedData(e){const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}getAITimeSavings(){return ls(this,null,function*(){try{const{FacilityService:e}=yield q(()=>Promise.resolve().then(()=>ge),void 0),{facilityId:t}=yield e.getCurrentUserAndFacility();if(!t)return R.debug("AITimeSavingsService: No facility ID, returning defaults"),{daily_time_saved:0,monthly_time_saved:0};const n=`ai-time-savings-${t}-${new Date().toISOString().split("T")[0]}`,a=this.getCachedData(n);if(a)return a;const[i,c,l,o]=yield Promise.all([this.calculateAITaskPerformanceSavings(t),this.calculateAITrainingSavings(t),this.calculateAIComplianceSavings(t),this.calculateAIPredictiveSavings(t)]),d=i.daily+c.daily+l.daily+o.daily,u=i.monthly+c.monthly+l.monthly+o.monthly,h={daily_time_saved:Math.round(d),monthly_time_saved:Math.round(u)};return this.setCachedData(n,h),R.debug("AITimeSavingsService: Calculated AI time savings:",h),h}catch(e){return R.error("AITimeSavingsService: Error calculating AI time savings:",e),{daily_time_saved:0,monthly_time_saved:0}}})}calculateAITaskPerformanceSavings(e){return ls(this,null,function*(){try{const t=new Date().toISOString().split("T")[0],n=new Date().toISOString().slice(0,7),{data:a}=yield _.from("ai_task_performance").select("time_saved").eq("facility_id",facilityId).gte("completed_at",`${t}T00:00:00`).lt("completed_at",`${t}T23:59:59`),{data:i}=yield _.from("ai_task_performance").select("time_saved").eq("facility_id",facilityId).gte("completed_at",`${n}-01T00:00:00`).lt("completed_at",`${n}-31T23:59:59`),c=(a||[]).reduce((o,d)=>o+(d.time_saved||0),0),l=(i||[]).reduce((o,d)=>o+(d.time_saved||0),0);return{daily:c,monthly:l}}catch(t){return R.error("AITimeSavingsService: Error calculating AI task performance savings:",t),{daily:0,monthly:0}}})}calculateAITrainingSavings(e){return ls(this,null,function*(){try{return{daily:30,monthly:900}}catch(t){return R.error("AITimeSavingsService: Error calculating AI training savings:",t),{daily:0,monthly:0}}})}calculateAIComplianceSavings(e){return ls(this,null,function*(){try{return{daily:20,monthly:600}}catch(t){return R.error("AITimeSavingsService: Error calculating AI compliance savings:",t),{daily:0,monthly:0}}})}calculateAIPredictiveSavings(e){return ls(this,null,function*(){try{return{daily:25,monthly:750}}catch(t){return R.error("AITimeSavingsService: Error calculating AI predictive savings:",t),{daily:0,monthly:0}}})}clearCache(){this.cache.clear()}}const tm=new z_,L_=Object.freeze(Object.defineProperty({__proto__:null,aiTimeSavingsService:tm},Symbol.toStringTag,{value:"Module"}));var dn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class B_{constructor(){this.cache=new Map,this.CACHE_TTL=300*1e3}isCacheValid(e){return Date.now()-e<this.CACHE_TTL}getCachedData(e){const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}getHomeMetrics(){return dn(this,null,function*(){try{const e=new Date().toISOString().split("T")[0],t=`home-metrics-${e}`,n=this.getCachedData(t);if(n)return n;const{data:{user:a}}=yield _.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:i}=yield _.from("users").select("facility_id").eq("id",a.id).single(),c=(i==null?void 0:i.facility_id)||"550e8400-e29b-41d4-a716-446655440000";console.log("🏠 HomeMetricsService: Fetching metrics for facility:",c);const[l,o,d,u,h,p]=yield Promise.all([F_.getOperationalTimeSavings(),tm.getAITimeSavings(),O_(),$_(),this.getDailyMetrics(e,c),this.getGamificationStats(e,c)]);console.log("📊 HomeMetricsService: Received operational time savings:",l);const f={timeSaved:{daily:l.daily_time_saved,monthly:l.monthly_time_saved},aiTimeSaved:{daily:o.daily_time_saved,monthly:o.monthly_time_saved},costSavings:{monthly:d.monthly_cost_savings,annual:d.annual_cost_savings},aiEfficiency:{timeSavings:this.extractAIEfficiency(h,"time_savings"),proactiveMgmt:this.extractAIEfficiency(h,"proactive_mgmt")},teamPerformance:{skills:u.skills_score,inventory:u.inventory_score,sterilization:u.sterilization_score},gamificationStats:{totalTasks:this.calculateTotalTasks(p),completedTasks:this.calculateCompletedTasks(p),perfectDays:this.calculatePerfectDays(p),currentStreak:this.calculateCurrentStreak(p),bestStreak:this.calculateBestStreak(p)}};return this.setCachedData(t,f),f}catch(e){return console.warn("Failed to fetch home metrics, using defaults:",e),this.getDefaultMetrics()}})}getDailyMetrics(e,t){return dn(this,null,function*(){const{data:n}=yield _.from("performance_metrics").select("*").eq("date",e).eq("facility_id",t);return n||[]})}getMonthlyMetrics(e,t){return dn(this,null,function*(){const{data:n}=yield _.from("performance_metrics").select("*").like("month",e).eq("facility_id",t);return n||[]})}getGamificationStats(e,t){return dn(this,null,function*(){const{data:n}=yield _.from("user_gamification_stats").select("*").eq("date",e).eq("facility_id",t).limit(10);return n||[]})}extractTimeSaved(e,t){const n=e.find(a=>a.metric_type==="time_saved");return t==="daily"?(n==null?void 0:n.daily_time_saved)||0:(n==null?void 0:n.monthly_time_saved)||0}extractCostSavings(e,t){const n=e.find(a=>a.metric_type==="cost_savings");return t==="monthly"?(n==null?void 0:n.monthly_cost_savings)||0:(n==null?void 0:n.annual_cost_savings)||0}extractAIEfficiency(e,t){const n=e.find(a=>a.metric_type==="ai_efficiency");return(n==null?void 0:n[t])||0}extractTeamPerformance(e,t){const n=e.find(a=>a.metric_type==="team_performance");return(n==null?void 0:n[t])||0}calculateTotalTasks(e){return e.reduce((t,n)=>t+(n.total_tasks||0),0)}calculateCompletedTasks(e){return e.reduce((t,n)=>t+(n.completed_tasks||0),0)}calculatePerfectDays(e){return e.filter(t=>(t.completed_tasks||0)===(t.total_tasks||0)).length}calculateCurrentStreak(e){return e.reduce((t,n)=>Math.max(t,n.current_streak||0),0)}calculateBestStreak(e){return e.reduce((t,n)=>Math.max(t,n.best_streak||0),0)}getDefaultMetrics(){return{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}}}}const rm=new B_,q_=Object.freeze(Object.defineProperty({__proto__:null,homeMetricsService:rm},Symbol.toStringTag,{value:"Module"}));var dt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class U_{getCachedUser(){return null}getSterilizationMetrics(){return dt(this,null,function*(){try{const e=yield this.getCachedUser();return e?yield this.getConsolidatedSterilizationMetrics(e.facility_id):this.getDefaultSterilizationMetrics()}catch(e){return console.error("Error fetching sterilization metrics:",e),this.getDefaultSterilizationMetrics()}})}getConsolidatedSterilizationMetrics(e){return dt(this,null,function*(){const t=new Date().toISOString().split("T")[0],n=new Date;n.setDate(n.getDate()-7);const a=new Date;a.setDate(a.getDate()-30);const{data:i,error:c}=yield _.from("sterilization_cycles").select("id, status, created_at, end_time").eq("facility_id",e).gte("created_at",a.toISOString()).lte("created_at",t).order("created_at",{ascending:!1});return c?(console.error("Error fetching consolidated sterilization metrics:",c),yield this.getFallbackSterilizationMetrics(e)):i&&Array.isArray(i)&&i.length>0?this.mapDatabaseResponseToMetrics(i[0]):this.getDefaultSterilizationMetrics()})}mapDatabaseResponseToMetrics(e){return{cyclesToday:e.cycles_today||0,cyclesThisWeek:e.cycles_this_week||0,biPassRate:e.bi_pass_rate||0,averageCycleTime:e.average_cycle_time||0,toolsInCycle:e.tools_in_cycle||0,toolsCompletedToday:e.tools_completed_today||0,performanceScore:e.performance_score||0}}getFallbackSterilizationMetrics(e){return dt(this,null,function*(){const[t,n,a,i,c,l]=yield Promise.all([this.getCyclesToday(e),this.getCyclesThisWeek(e),this.getBITestResults(e),this.getCycleTimes(e),this.getToolsInCycle(e),this.getToolsCompletedToday(e)]),o=this.calculateBIPassRate(a),d=this.calculateAverageCycleTime(i),u=this.calculatePerformanceScore({biPassRate:o,averageCycleTime:d,cyclesToday:t});return{cyclesToday:t,cyclesThisWeek:n,biPassRate:o,averageCycleTime:d,toolsInCycle:c,toolsCompletedToday:l,performanceScore:u}})}getCyclesToday(e){return dt(this,null,function*(){const{data:t,error:n}=yield _.from("sterilization_cycles").select("id").eq("facility_id",e).gte("created_at",new Date().toISOString().split("T")[0]);return n?(console.error("Error fetching cycles today:",n),0):(t==null?void 0:t.length)||0})}getCyclesThisWeek(e){return dt(this,null,function*(){const t=new Date;t.setDate(t.getDate()-7);const{data:n,error:a}=yield _.from("sterilization_cycles").select("id").eq("facility_id",e).gte("created_at",t.toISOString());return a?(console.error("Error fetching cycles this week:",a),0):(n==null?void 0:n.length)||0})}getBITestResults(e){return dt(this,null,function*(){const{data:t,error:n}=yield _.from("bi_test_results").select("result").eq("facility_id",e).gte("created_at",new Date(Date.now()-2592e6).toISOString());return n?(console.error("Error fetching BI test results:",n),[]):t||[]})}getCycleTimes(e){return dt(this,null,function*(){const{data:t,error:n}=yield _.from("sterilization_cycles").select("start_time, end_time, duration_minutes").eq("facility_id",e).eq("status","completed").gte("created_at",new Date(Date.now()-6048e5).toISOString());return n?(console.error("Error fetching cycle times:",n),[]):t||[]})}getToolsInCycle(e){return dt(this,null,function*(){try{return(yield Re.getToolsByFacilityAndStatus(e,"in_cycle")).length}catch(t){return console.error("Error fetching tools in cycle:",t),0}})}getToolsCompletedToday(e){return dt(this,null,function*(){try{const t=yield Re.getToolsByFacilityAndStatus(e,"available"),n=new Date().toISOString().split("T")[0];return t.filter(i=>i.updated_at&&i.updated_at.split("T")[0]>=n).length}catch(t){return console.error("Error fetching tools completed today:",t),0}})}calculateBIPassRate(e){if(e.length===0)return 0;const t=e.filter(n=>n.result==="pass").length;return Math.round(t/e.length*100)}calculateAverageCycleTime(e){if(e.length===0)return 0;const t=e.reduce((n,a)=>n+(a.duration_minutes||0),0);return Math.round(t/e.length)}calculatePerformanceScore(e){const t=Math.min(e.biPassRate,100),n=Math.min(e.cyclesToday*10,50),a=Math.max(0,50-e.averageCycleTime);return Math.round((t+n+a)/3)}getDefaultSterilizationMetrics(){return{cyclesToday:0,cyclesThisWeek:0,biPassRate:0,averageCycleTime:0,toolsInCycle:0,toolsCompletedToday:0,performanceScore:0}}}const sm=new U_,H_=Object.freeze(Object.defineProperty({__proto__:null,homeSterilizationIntegration:sm},Symbol.toStringTag,{value:"Module"}));var ja=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class V_{getInventoryMetrics(){return ja(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),n=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:a,error:i}=yield _.from("inventory_items").select("status").eq("facility_id",n);if(i)return console.warn("Failed to fetch aggregated inventory metrics, using fallback:",i),{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0};const c=(a==null?void 0:a.length)||0,l=(a==null?void 0:a.filter(u=>u.status==="low_stock").length)||0,o=(a==null?void 0:a.filter(u=>u.status==="expiring").length)||0,d=c>0?(c-l)/c*100:0;return{lowStockItems:l,totalItems:c,expiringItems:o,inventoryAccuracy:d}}catch(e){return console.error("Error fetching inventory metrics:",e),{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0}}})}getEnvironmentalCleanMetrics(){return ja(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),n=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:a,error:i}=yield _.from("environmental_clean_logs").select("status, area").eq("facility_id",n);if(i)return console.warn("Failed to fetch aggregated environmental clean metrics, using fallback:",i),{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98};const c=(a==null?void 0:a.length)||0,l=(a==null?void 0:a.filter(u=>u.status==="completed").length)||0,o=c>0?l/c*100:0,d=o>90?98:Math.max(70,o);return{cleaningEfficiency:o,totalRooms:c,cleanRooms:l,complianceScore:d}}catch(e){return console.error("Error fetching environmental clean metrics:",e),{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98}}})}getAllMetrics(){return ja(this,null,function*(){try{const{data:{user:e}}=yield _.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t}=yield _.from("users").select("facility_id").eq("id",e.id).single(),n=(t==null?void 0:t.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:a,error:i}=yield _.from("sterilization_cycles").select("status, created_at, end_time").eq("facility_id",n).order("created_at",{ascending:!1}).limit(10);if(i){console.warn("Failed to fetch combined metrics, falling back to individual calls:",i);const[l,o]=yield Promise.all([this.getInventoryMetrics(),this.getEnvironmentalCleanMetrics()]);return{inventory:l,environmentalClean:o}}const c=(a==null?void 0:a[0])||{};return{inventory:{lowStockItems:(c==null?void 0:c.inventory_low_stock_items)||0,totalItems:(c==null?void 0:c.inventory_total_items)||0,expiringItems:(c==null?void 0:c.inventory_expiring_items)||0,inventoryAccuracy:(c==null?void 0:c.inventory_accuracy)||0},environmentalClean:{cleaningEfficiency:(c==null?void 0:c.cleaning_efficiency)||0,totalRooms:(c==null?void 0:c.cleaning_total_rooms)||0,cleanRooms:(c==null?void 0:c.cleaning_clean_rooms)||0,complianceScore:(c==null?void 0:c.cleaning_compliance_score)||98}}}catch(e){return console.error("Error fetching all home integration metrics:",e),{inventory:{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0},environmentalClean:{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98}}}})}}const nm=new V_,W_=Object.freeze(Object.defineProperty({__proto__:null,homeIntegrationService:nm},Symbol.toStringTag,{value:"Module"}));var G_=Object.defineProperty,K_=Object.defineProperties,Q_=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,Y_=Object.prototype.hasOwnProperty,J_=Object.prototype.propertyIsEnumerable,Yl=(s,e,t)=>e in s?G_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,un=(s,e)=>{for(var t in e||(e={}))Y_.call(e,t)&&Yl(s,t,e[t]);if(Ql)for(var t of Ql(e))J_.call(e,t)&&Yl(s,t,e[t]);return s},mn=(s,e)=>K_(s,Q_(e)),Jl=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Na=[{id:"demo-1",title:"Complete Daily Safety Checklist",description:"Review and complete the facility safety checklist",category:"Safety",difficulty:"Easy",points:50,timeEstimate:"15 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-2",title:"Update Inventory Records",description:"Verify and update current inventory levels",category:"Inventory",difficulty:"Medium",points:75,timeEstimate:"30 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-3",title:"Review Sterilization Protocols",description:"Ensure all sterilization equipment is properly maintained",category:"Sterilization",difficulty:"Hard",points:100,timeEstimate:"45 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],Cr={aiMetrics:{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:{cyclesCompleted:0,successRate:"0%",equipmentStatus:"No Data"},integrationMetrics:{systemHealth:"No Data",uptime:"0%",lastSync:"Never"}},X_=()=>{const{currentFacility:s,isLoading:e}=Nu(),[t,n]=m.useState({tasks:[],aiMetrics:null,sterilizationMetrics:null,integrationMetrics:null,leaderboardData:{users:[],userRank:1,totalUsers:0},gamificationData:null,loading:!0,error:null});m.useCallback(()=>Jl(null,null,function*(){try{const i=yield Promise.allSettled([rm.getHomeMetrics(),sm.getSterilizationMetrics(),nm.getAllMetrics()]);n(c=>mn(un({},c),{aiMetrics:i[0].status==="fulfilled"?i[0].value:c.aiMetrics,sterilizationMetrics:i[1].status==="fulfilled"?i[1].value:c.sterilizationMetrics,integrationMetrics:i[2].status==="fulfilled"?i[2].value:c.integrationMetrics}))}catch(i){console.warn("Background AI PROCESS AND EFFICIENCY loading failed, using basic data:",i)}}),[]);const a=m.useCallback(()=>Jl(null,null,function*(){try{n(v=>mn(un({},v),{loading:!0,error:null}));let i;if(s!=null&&s.id)i=s.id;else{if(e)return;i="demo-facility-id"}const[c,l,o,d]=yield Promise.allSettled([Hu.getFacilityDailyTasks(i),li.fetchAndCacheMetricsOnLogin(),zu.fetchCumulativeStats(),Bu.fetchLeaderboardData()]),u=c.status==="fulfilled"?c.value:Na,h=l.status==="fulfilled"&&l.value?l.value:null,p=(h==null?void 0:h.aiMetrics)||mn(un({},Cr.aiMetrics),{costSavings:{monthly:0,annual:0},teamPerformance:{skills:0,inventory:0,sterilization:0}}),f=(h==null?void 0:h.sterilizationMetrics)||Cr.sterilizationMetrics,y=(h==null?void 0:h.integrationMetrics)||Cr.integrationMetrics,g={users:[],userRank:1,totalUsers:0},x=o.status==="fulfilled"&&o.value?(()=>{const v=o.value,w=d.status==="fulfilled"&&d.value?d.value:{userRank:1,totalUsers:1},S=Math.max(0,v.currentStreak||0),T=Math.max(0,v.totalPoints||0),C=Math.max(1,w.userRank||1),P=Math.max(1,w.totalUsers||1),N=C/P;let j;return N<=.1?j=Math.max(10,Math.floor(10+(.1-N)*50)):N<=.25?j=Math.max(7,Math.floor(7+(.25-N)*20)):N<=.5?j=Math.max(5,Math.floor(5+(.5-N)*8)):j=Math.max(1,Math.floor(1+(1-N)*4)),{streak:S,level:j,rank:C,totalScore:T}})():null,b=u.length>0?u.map(v=>"difficulty"in v&&"timeEstimate"in v?v:{id:v.id,title:v.title,description:v.description||"",category:v.category,difficulty:v.priority||"medium",points:v.points,timeEstimate:`${v.estimated_duration||30} min`,isCompleted:v.completed||!1,completedAt:v.completed_at||null,pointsEarned:v.completed?v.points:0,createdAt:v.created_at||v.due_date||new Date().toISOString(),updatedAt:v.updated_at||new Date().toISOString()}):Na;n({tasks:b,aiMetrics:p,sterilizationMetrics:f,integrationMetrics:y,aiImpactMetrics:(h==null?void 0:h.aiImpactMetrics)||null,leaderboardData:g,gamificationData:x,loading:!1,error:null}),console.log("🚀 Home data loaded (with fallbacks if needed):",{tasks:b.length,aiMetrics:!!p,sterilizationMetrics:!!f,integrationMetrics:!!y})}catch(i){console.error("Critical error loading home data, using all fallbacks:",i),n({tasks:Na,aiMetrics:mn(un({},Cr.aiMetrics),{costSavings:{monthly:0,annual:0},teamPerformance:{skills:0,inventory:0,sterilization:0}}),sterilizationMetrics:Cr.sterilizationMetrics,integrationMetrics:Cr.integrationMetrics,aiImpactMetrics:null,leaderboardData:{users:[],userRank:1,totalUsers:0},gamificationData:null,loading:!1,error:null})}}),[s==null?void 0:s.id,e]);return m.useEffect(()=>{e||a()},[e,a]),t},Xl=({size:s="lg",message:e="Data Compilation In Progress..."})=>{const t={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},n={sm:"text-sm",md:"text-base",lg:"text-lg"};return r.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-6",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:`${t[s]} animate-bounce`,children:r.jsx("div",{className:"text-6xl",children:"🚀"})}),r.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:r.jsx("div",{className:"w-1 h-8 bg-gradient-to-t from-orange-400 to-transparent animate-pulse"})})]}),r.jsxs("div",{className:"text-center space-y-2",children:[r.jsx("h3",{className:`font-semibold text-gray-700 ${n[s]}`,children:e}),r.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Preparing your dashboard for takeoff..."})]}),r.jsxs("div",{className:"flex space-x-1",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})};function Z_(){const{currentUser:s,isLoading:e}=cr(),t=gt(c=>c.authToken),n=gt(c=>c.isTokenExpired),a=X_();return!!!(s&&t&&!n())&&!e?r.jsx(xi,{to:"/login",replace:!0}):e||!s?r.jsx(Xl,{size:"lg",message:"Verifying Authentication..."}):a.loading?r.jsx(Xl,{size:"lg",message:"Data Compilation In Progress..."}):r.jsx(E_,{homeData:a})}const ew=m.createContext(null),Ia={didCatch:!1,error:null};class qr extends m.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Ia}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,n,a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];(t=(n=this.props).onReset)===null||t===void 0||t.call(n,{args:i,reason:"imperative-api"}),this.setState(Ia)}}componentDidCatch(e,t){var n,a;(n=(a=this.props).onError)===null||n===void 0||n.call(a,e,t)}componentDidUpdate(e,t){const{didCatch:n}=this.state,{resetKeys:a}=this.props;if(n&&t.error!==null&&tw(e.resetKeys,a)){var i,c;(i=(c=this.props).onReset)===null||i===void 0||i.call(c,{next:a,prev:e.resetKeys,reason:"keys"}),this.setState(Ia)}}render(){const{children:e,fallbackRender:t,FallbackComponent:n,fallback:a}=this.props,{didCatch:i,error:c}=this.state;let l=e;if(i){const o={error:c,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")l=t(o);else if(n)l=m.createElement(n,o);else if(a!==void 0)l=a;else throw c}return m.createElement(ew.Provider,{value:{didCatch:i,error:c,resetErrorBoundary:this.resetErrorBoundary}},l)}}function tw(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return s.length!==e.length||s.some((t,n)=>!Object.is(t,e[n]))}const hn=({title:s,value:e,icon:t,iconBgColor:n,gradientFrom:a,gradientTo:i,borderColor:c,textColor:l,valueColor:o,trend:d})=>r.jsxs("div",{className:`bg-gradient-to-br from-${a} to-${i} p-4 rounded-lg border border-${c}`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-medium ${l}`,children:s}),r.jsx("p",{className:`text-2xl font-bold ${o}`,children:e})]}),r.jsx("div",{className:`p-2 ${n} rounded-lg`,children:r.jsx(I,{path:t,size:1.5,className:"text-white"})})]}),d&&r.jsxs("div",{className:`mt-2 flex items-center text-xs ${l}`,children:[r.jsx(I,{path:d.direction==="up"?Si:d.direction==="down"?ou:Bn,size:.8,className:"mr-1"}),r.jsx("span",{children:d.value})]})]}),rw=({score:s,trend:e})=>{const t=()=>e?e.direction==="up"?"text-green-600":"text-red-600":"text-gray-500",n=()=>e?e.direction==="up"?Si:ou:Lr;return r.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-3 mt-4 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"bg-blue-500 p-1.5 rounded-lg mr-3",children:r.jsx(I,{path:Lr,size:1,className:"text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-semibold text-blue-800",children:"Overall Efficiency Trend"}),r.jsxs("p",{className:"text-xl font-bold text-blue-900",children:[s,"%"]})]})]}),e&&r.jsxs("div",{className:`flex items-center text-sm font-medium ${t()}`,children:[r.jsx(I,{path:n(),size:.9,className:"mr-1"}),r.jsx("span",{children:e.value})]})]}),!e&&r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"No trend data available yet. Complete more cycles to see performance trends."})]})};function sw(s,e){let t;try{t=s()}catch(a){return}return{getItem:a=>{var i;const c=o=>o===null?null:JSON.parse(o,void 0),l=(i=t.getItem(a))!=null?i:null;return l instanceof Promise?l.then(c):c(l)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const ci=s=>e=>{try{const t=s(e);return t instanceof Promise?t:{then(n){return ci(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return ci(n)(t)}}}},nw=(s,e)=>(t,n,a)=>{let i=re({storage:sw(()=>localStorage),partialize:g=>g,version:0,merge:(g,x)=>re(re({},x),g)},e),c=!1;const l=new Set,o=new Set;let d=i.storage;if(!d)return s((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...g)},n,a);const u=()=>{const g=i.partialize(re({},n()));return d.setItem(i.name,{state:g,version:i.version})},h=a.setState;a.setState=(g,x)=>(h(g,x),u());const p=s((...g)=>(t(...g),u()),n,a);a.getInitialState=()=>p;let f;const y=()=>{var g,x;if(!d)return;c=!1,l.forEach(v=>{var w;return v((w=n())!=null?w:p)});const b=((x=i.onRehydrateStorage)==null?void 0:x.call(i,(g=n())!=null?g:p))||void 0;return ci(d.getItem.bind(d))(i.name).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==i.version){if(i.migrate){const w=i.migrate(v.state,v.version);return w instanceof Promise?w.then(S=>[!0,S]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,v.state];return[!1,void 0]}).then(v=>{var w;const[S,T]=v;if(f=i.merge(T,(w=n())!=null?w:p),t(f,!0),S)return u()}).then(()=>{b==null||b(f,void 0),f=n(),c=!0,o.forEach(v=>v(f))}).catch(v=>{b==null||b(void 0,v)})};return a.persist={setOptions:g=>{i=re(re({},i),g),g.storage&&(d=g.storage)},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>c,onHydrate:g=>(l.add(g),()=>{l.delete(g)}),onFinishHydration:g=>(o.add(g),()=>{o.delete(g)})},i.skipHydration||y(),f||p},Yn=nw;var aw=Object.defineProperty,Zl=Object.getOwnPropertySymbols,iw=Object.prototype.hasOwnProperty,ow=Object.prototype.propertyIsEnumerable,ec=(s,e,t)=>e in s?aw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ta=(s,e)=>{for(var t in e||(e={}))iw.call(e,t)&&ec(s,t,e[t]);if(Zl)for(var t of Zl(e))ow.call(e,t)&&ec(s,t,e[t]);return s};class Fr{constructor(){this.metrics=new Map,this.callHistory=[],this.thresholds={maxResponseTime:5e3,maxErrorRate:10,maxCallsPerMinute:100},this.startCleanupInterval()}static getInstance(){return Fr.instance||(Fr.instance=new Fr),Fr.instance}startCall(e,t){const n=`${e}.${t}.${Date.now()}`,a={serviceName:e,methodName:t,startTime:Date.now()};return this.callHistory.push(a),n}endCall(e,t,n){const a=this.callHistory.find(i=>`${i.serviceName}.${i.methodName}.${i.startTime}`===e);if(!a){console.warn(`[ServiceMonitor] Call ${e} not found`);return}a.endTime=Date.now(),a.success=t,a.error=n,a.responseTime=a.endTime-a.startTime,this.updateMetrics(a)}updateMetrics(e){const t=e.serviceName,n=this.metrics.get(t)||{serviceName:t,totalCalls:0,successfulCalls:0,failedCalls:0,averageResponseTime:0,lastCallTime:0,errorRate:0,uptime:0};if(n.totalCalls++,e.success?n.successfulCalls++:n.failedCalls++,e.responseTime){const i=n.averageResponseTime*(n.totalCalls-1)+e.responseTime;n.averageResponseTime=i/n.totalCalls}n.errorRate=n.failedCalls/n.totalCalls*100,n.lastCallTime=e.endTime||e.startTime;const a=this.callHistory.find(i=>i.serviceName===t);a&&(n.uptime=e.endTime-a.startTime),this.metrics.set(t,n),this.checkPerformanceIssues(n)}checkPerformanceIssues(e){const t=[];e.averageResponseTime>this.thresholds.maxResponseTime&&t.push(`High response time: ${e.averageResponseTime}ms (threshold: ${this.thresholds.maxResponseTime}ms)`),e.errorRate>this.thresholds.maxErrorRate&&t.push(`High error rate: ${e.errorRate.toFixed(2)}% (threshold: ${this.thresholds.maxErrorRate}%)`);const n=this.getCallsLastMinute(e.serviceName);n>this.thresholds.maxCallsPerMinute&&t.push(`High call frequency: ${n} calls/minute (threshold: ${this.thresholds.maxCallsPerMinute})`),t.length>0&&(console.warn(`[ServiceMonitor] Performance issues detected for ${e.serviceName}:`,t),this.alertPerformanceIssues(e.serviceName,t))}getCallsLastMinute(e){const t=Date.now()-6e4;return this.callHistory.filter(n=>n.serviceName===e&&n.startTime>t).length}alertPerformanceIssues(e,t){console.error(`[ServiceMonitor] ALERT: ${e} has performance issues:`,t)}getServiceMetrics(e){return this.metrics.get(e)||null}getAllMetrics(){return Array.from(this.metrics.values())}getTopPerformingServices(e=5){return this.getAllMetrics().sort((t,n)=>t.errorRate-n.errorRate).slice(0,e)}getServicesWithIssues(){return this.getAllMetrics().filter(e=>e.errorRate>this.thresholds.maxErrorRate||e.averageResponseTime>this.thresholds.maxResponseTime)}updateThresholds(e){this.thresholds=Ta(Ta({},this.thresholds),e),console.log("[ServiceMonitor] Performance thresholds updated:",this.thresholds)}getThresholds(){return Ta({},this.thresholds)}startCleanupInterval(){setInterval(()=>{this.cleanupOldCalls()},3e5)}cleanupOldCalls(){const e=Date.now()-36e5,t=this.callHistory.length;this.callHistory=this.callHistory.filter(a=>a.startTime>e);const n=t-this.callHistory.length;n>0&&console.log(`[ServiceMonitor] Cleaned up ${n} old call records`)}resetMetrics(){this.metrics.clear(),this.callHistory=[],console.log("[ServiceMonitor] All metrics reset")}exportMetrics(){return{metrics:this.getAllMetrics(),callHistory:[...this.callHistory],thresholds:this.getThresholds(),exportTime:Date.now()}}}const Be=Fr.getInstance();class lw{constructor(e,t){this.serviceName=e,this.originalService=t,this.wrapMethods()}wrapMethods(){const e=Object.getPrototypeOf(this.originalService);Object.getOwnPropertyNames(e).forEach(n=>{if(typeof e[n]=="function"&&n!=="constructor"){const a=e[n];e[n]=(...i)=>{const c=Be.startCall(this.serviceName,n);try{const l=a.apply(this.originalService,i);return l&&typeof l.then=="function"?l.then(o=>(Be.endCall(c,!0),o)).catch(o=>{throw Be.endCall(c,!1,o instanceof Error?o.message:String(o)),o}):(Be.endCall(c,!0),l)}catch(l){throw Be.endCall(c,!1,l instanceof Error?l.message:String(l)),l}}}})}getService(){return this.originalService}}function cw(s,e){return new lw(s,e).getService()}var Vt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const am=class Or{constructor(){this.services=new Map,this.serviceFactories=new Map,this.registerDefaultServices()}static getInstance(){return Or.instance||(Or.instance=new Or),Or.instance}register(e,t){this.serviceFactories.set(e,t)}get(e){if(!this.services.has(e)){const t=this.serviceFactories.get(e);if(!t)throw new Error(`Service '${e}' not registered`);const n=performance.now();try{const a=t(),i=cw(e,a);this.services.set(e,i);const c=performance.now()-n;rr.recordResponseTime("service_creation",c,{service:e,operation:"create"});const l=Be.startCall("ServiceRegistry","createService");Be.endCall(l,!0)}catch(a){const i=performance.now()-n;throw rr.recordErrorRate("service_creation",100,{service:e,operation:"create",error:a instanceof Error?a.message:"Unknown error"}),console.error(`[ServiceRegistry] Failed to create service '${e}' after ${i.toFixed(2)}ms:`,a),a}}return this.services.get(e)}has(e){return this.services.has(e)}remove(e){return this.services.delete(e)}getServiceNames(){return Array.from(this.services.keys())}getPerformanceMetrics(){return Be.getAllMetrics()}getServicePerformanceMetrics(e){return Be.getServiceMetrics(e)}getServicesWithPerformanceIssues(){return Be.getServicesWithIssues()}getTopPerformingServices(e=5){return Be.getTopPerformingServices(e)}exportPerformanceData(){return Be.exportMetrics()}clear(){this.services.clear()}reset(){this.services.clear(),this.serviceFactories.clear(),Or.instance=null}registerDefaultServices(){this.register("performanceMonitor",()=>rr),this.register("inventoryService",()=>Vt(this,null,function*(){const{getInventoryService:e}=yield q(()=>import("./InventoryServiceFactory-B9RA95iw.js"),__vite__mapDeps([10,1,2,3,4,5]));return e()})),this.register("errorHandling",()=>Vt(this,null,function*(){const{ErrorHandlingService:e}=yield q(()=>import("./errorHandlingService-BCXz5YQH.js"),__vite__mapDeps([11,1,2,3,4,5]));return e.getInstance()})),this.register("settings",()=>Vt(this,null,function*(){const{SettingsService:e}=yield q(()=>import("./settingsService-CLvfY-tc.js"),__vite__mapDeps([12,1,2,3,4,5]));return e.getInstance()})),this.register("usageTracking",()=>Vt(this,null,function*(){const{usageTrackingService:e}=yield q(()=>Promise.resolve().then(()=>nT),void 0);return e})),this.register("learningProgress",()=>Vt(this,null,function*(){return(yield q(()=>Promise.resolve().then(()=>Uk),void 0)).default.getInstance()})),this.register("cleaningSchedule",()=>Vt(this,null,function*(){const{cleaningScheduleService:e}=yield q(()=>import("./cleaningScheduleService-DFfBa6lH.js"),__vite__mapDeps([13,1,2,3,4,5]));return e})),this.register("duplicatePrevention",()=>Vt(this,null,function*(){const{duplicatePreventionService:e}=yield q(()=>import("./duplicatePreventionService-Cw2fNCJ9.js"),__vite__mapDeps([14,1,2,3,4,5]));return e}))}};am.instance=null;let dw=am;const Dt=dw.getInstance();var uw=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class mw{static getInventoryService(){return uw(this,null,function*(){return Dt.get("inventoryService")})}static getErrorHandlingService(){return Dt.get("errorHandling")}static getSettingsService(){return Dt.get("settings")}static getPerformanceMonitor(){return Dt.get("performanceMonitor")}static getUsageTrackingService(){return Dt.get("usageTracking")}static getLearningProgressService(){return Dt.get("learningProgress")}static getCleaningScheduleService(){return Dt.get("cleaningSchedule")}static getDuplicatePreventionService(){return Dt.get("duplicatePrevention")}}const cs=mw.getInventoryService;var ds=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Ea=(...s)=>console.log("[useCentralizedInventoryData]",...s);let Dn=!1;const ar=Ft()(Yn((s,e)=>({data:null,isLoading:!0,error:null,items:[],tools:[],supplies:[],equipment:[],officeHardware:[],getTools:()=>e().tools,getSupplies:()=>e().supplies,getEquipment:()=>e().equipment,getOfficeHardware:()=>e().officeHardware,getCategories:()=>{const t=e();return Array.from(new Set([...t.tools.map(n=>n.category).filter(n=>n!==null),...t.supplies.map(n=>n.category).filter(n=>n!==null),...t.equipment.map(n=>n.category).filter(n=>n!==null),...t.officeHardware.map(n=>n.category).filter(n=>n!==null)]))},getFilteredData:t=>ds(null,null,function*(){const a=yield(yield cs()).fetchInventoryItems();return!a||!Array.isArray(a)?[]:a.filter(i=>{var c,l;return((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))})}),getFilteredSuppliesData:t=>ds(null,null,function*(){return(yield(yield cs()).fetchInventoryItems()).filter(i=>{var c,l;return i.category==="Supplies"&&(((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase())))})}),getFilteredEquipmentData:t=>ds(null,null,function*(){return(yield(yield cs()).fetchInventoryItems()).filter(i=>{var c,l;return i.category==="Equipment"&&(((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase())))})}),getFilteredOfficeHardwareData:t=>ds(null,null,function*(){return(yield(yield cs()).fetchInventoryItems()).filter(i=>{var c,l;return i.category==="Office Hardware"&&(((c=i.name)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))||((l=i.category)==null?void 0:l.toLowerCase().includes(t.toLowerCase())))})}),refreshData:()=>ds(null,null,function*(){var t,n,a,i,c,l,o,d,u,h,p,f,y,g,x,b,v,w,S;if(Dn){console.log("[useCentralizedInventoryData] Data fetch already in progress, skipping...");return}Dn=!0,s({isLoading:!0,error:null});try{let T=0;const C=2,P=25;for(;T<C;)try{const j=yield(yield cs()).fetchAllInventoryData(),E=[...(t=j==null?void 0:j.tools)!=null?t:[],...(n=j==null?void 0:j.supplies)!=null?n:[],...(a=j==null?void 0:j.equipment)!=null?a:[],...(i=j==null?void 0:j.officeHardware)!=null?i:[]];console.log("[useCentralizedInventoryData] Setting state with data:",{allItems:E.length,tools:((c=j==null?void 0:j.tools)==null?void 0:c.length)||0,supplies:((l=j==null?void 0:j.supplies)==null?void 0:l.length)||0,equipment:((o=j==null?void 0:j.equipment)==null?void 0:o.length)||0,officeHardware:((d=j==null?void 0:j.officeHardware)==null?void 0:d.length)||0}),s({items:E,tools:(u=j==null?void 0:j.tools)!=null?u:[],supplies:(h=j==null?void 0:j.supplies)!=null?h:[],equipment:(p=j==null?void 0:j.equipment)!=null?p:[],officeHardware:(f=j==null?void 0:j.officeHardware)!=null?f:[],data:j,error:null,isLoading:!1}),Ea("✅ single-source applied",{counts:{all:E.length,tools:((y=j==null?void 0:j.tools)!=null?y:[]).length,supplies:((g=j==null?void 0:j.supplies)!=null?g:[]).length,equipment:((x=j==null?void 0:j.equipment)!=null?x:[]).length,officeHardware:((b=j==null?void 0:j.officeHardware)!=null?b:[]).length}});break}catch(N){if(T++,T>=C)Ea("❌ facade fetch failed after all retries; clearing state",String((v=N==null?void 0:N.message)!=null?v:N)),s({items:[],tools:[],supplies:[],equipment:[],officeHardware:[],error:String((w=N==null?void 0:N.message)!=null?w:N),isLoading:!1});else{Ea(`⚠️ Facade fetch attempt ${T} failed, retrying...`,String((S=N==null?void 0:N.message)!=null?S:N));const j=P*(T+1);yield new Promise(E=>setTimeout(E,j))}}}finally{Dn=!1}}),clearError:()=>s({error:null}),inventoryData:[],suppliesData:[],equipmentData:[],officeHardwareData:[]}),{name:"centralized-inventory-store",partialize:s=>({tools:s.tools,supplies:s.supplies,equipment:s.equipment,officeHardware:s.officeHardware,items:s.items,data:s.data})})),hw=()=>{const s=ar(n=>n.refreshData),e=ar(n=>n.isLoading),t=ar(n=>n.data);return X.useEffect(()=>{if(!e&&!t&&!Dn){const n=setTimeout(()=>{s()},0);return()=>clearTimeout(n)}},[s,e,t]),{refreshData:s,isLoading:e}};var ka=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const pw=()=>{const{getCycleStats:s,biTestResults:e,nextBITestDue:t,activityLog:n,availableTools:a,loadBITestResults:i,loadBIFailureIncidents:c}=Q(),{tools:l}=ar(),[o,d]=m.useState([]),[u,h]=m.useState([]),[p,f]=m.useState(!1),[y,g]=m.useState(null),[x,b]=m.useState(!1),v=!l||l.length===0,w=m.useCallback(()=>ka(null,null,function*(){try{console.log("🔄 Manually refreshing BI results...");const j="550e8400-e29b-41d4-a716-446655440000";yield i(j),yield c(j),console.log("✅ BI results refreshed successfully")}catch(j){console.error("❌ Failed to refresh BI results:",j)}}),[i,c]);m.useEffect(()=>{const j=()=>ka(null,null,function*(){try{const $="550e8400-e29b-41d4-a716-446655440000";yield i($),yield c($)}catch($){console.error("Failed to load BI activities:",$)}});j();const E=new Date,D=new Date(E);D.setDate(D.getDate()+1),D.setHours(0,0,0,0);const O=D.getTime()-E.getTime(),k=setTimeout(()=>{j(),setInterval(j,1440*60*1e3)},O);return()=>clearTimeout(k)},[i,c]);const S=m.useMemo(()=>{const j=l.length;if(v)return{totalTools:j,activeTools:0,completedToday:0};const E=a.filter(k=>k.currentPhase&&k.currentPhase!=="complete"&&k.currentPhase!=="failed").length,D=new Date,O=a.filter(k=>{if(!k.endTime)return!1;const U=new Date(k.endTime).toDateString()===D.toDateString(),H=k.currentPhase==="complete";return U&&H}).length;return{totalTools:j,activeTools:E,completedToday:O}},[a,l,v]),T=m.useMemo(()=>(console.log("🔍 recentBITests filter:",{isLoading:v,biTestResultsLength:(e==null?void 0:e.length)||0,biTestResults:(e==null?void 0:e.length)>0?e.slice(0,3).map(j=>({status:j.status,date:j.date,passed:j.passed,id:j.id})):"none"}),v||!e||e.length===0?[]:e.filter(j=>{const E=new Date;return E.setDate(E.getDate()-7),new Date(j.test_date)>=E}).sort((j,E)=>new Date(E.test_date).getTime()-new Date(j.test_date).getTime()).slice(0,5)),[e,v]),C=m.useMemo(()=>v||!n||n.length===0?[]:n.map(j=>{var E;const D=fw(j.time);return{id:j.id,type:j.type,title:j.title,description:(E=j.data)==null?void 0:E.description,time:D,toolCount:j.toolCount,color:j.color,operatorId:j.operatorId,metadata:j.metadata}}),[n,v]),P=m.useCallback(()=>ka(null,null,function*(){d([]),h([]),f(!1),b(!0),g(null)}),[]);return m.useEffect(()=>{!v&&a&&e&&n&&!x&&P().catch(j=>{console.warn("AI insights generation failed (non-blocking):",j)})},[v,a,e,n,P,x]),v?{stats:{totalCycles:0,completedCycles:0,averageCycleTime:0,biPassRate:100,efficiencyScore:{score:0,trend:null},cycleTrend:null,biPassRateTrend:null},additionalMetrics:S,recentBITests:T,nextBITestDue:null,recentActivities:C,aiInsights:[],aiForecasts:[],isAiLoading:!1,aiError:null,generateAIInsights:P,isLoading:!0}:{stats:s(),additionalMetrics:S,recentBITests:T,nextBITestDue:t,refreshBIResults:w,recentActivities:C,aiInsights:o,aiForecasts:u,isAiLoading:p,aiError:y,generateAIInsights:P,isLoading:!1}};function fw(s){const t=new Date().getTime()-new Date(s).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return`${n} minute${n===1?"":"s"} ago`;const a=Math.floor(n/60);if(a<24)return`${a} hour${a===1?"":"s"} ago`;const i=Math.floor(a/24);return`${i} day${i===1?"":"s"} ago`}var Da=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Oi{static scanToolForCleanWorkflow(e,t){return Da(this,null,function*(){try{let n;try{if(n=yield Re.getToolByBarcodeAndStatus(e,"clean"),!n)return{success:!1,message:`Tool with barcode "${e}" not found or not available for sterilization.`}}catch(o){return{success:!1,message:`Tool with barcode "${e}" not found or not available for sterilization.`}}if(n.current_cycle_id&&!n.id.startsWith("mock-tool-")){const{data:o}=yield _.from("sterilization_cycles").select("status").eq("id",n.current_cycle_id).single();if((o==null?void 0:o.status)!=="completed")return{success:!1,message:`Tool "${n.tool_name}" is not ready for clean workflow. Current cycle status: ${(o==null?void 0:o.status)||"unknown"}`}}const a=yield Re.updateToolStatus(n.id,"dirty");yield Re.clearCycleAssignment([n.id],"dirty"),yield Re.markAsSterilized(n.id);const i={user_id:t,facility_id:n.facility_id,module:"sterilization",action:"tool_scanned_clean_workflow",table_name:"sterilization_tools",record_id:n.id,old_values:{status:"available",current_cycle_id:n.current_cycle_id},new_values:{status:"in_cycle",current_cycle_id:null},metadata:{barcode:e,workflow:"clean",previous_phase:"complete",new_phase:"dirty"}};yield _.from("audit_logs").insert(i);const c=a,l={id:c.id,name:c.tool_name,barcode:c.barcode,category:c.category||"general",type:c.tool_type,currentPhase:"failed",status:c.status,location:c.location,cycleCount:c.sterilization_count||0,lastSterilized:c.last_sterilized,notes:c.notes};return{success:!0,message:`Successfully scanned tool "${c.tool_name}" and marked as dirty. Ready for sterilization.`,tool:l}}catch(n){return console.error("Error scanning tool for clean workflow:",n),{success:!1,message:"An unexpected error occurred while scanning the tool."}}})}static scanToolForProblemWorkflow(e,t,n,a){return Da(this,null,function*(){try{const{data:i,error:c}=yield _.from("tools").select("*").eq("barcode",e).single();if(c||!i)return{success:!1,message:`Tool with barcode "${e}" not found in system.`};const l=i;let o=null;if(l.current_cycle_id){const{data:y}=yield _.from("sterilization_cycles").select("*").eq("id",l.current_cycle_id).single();o=y}const d=yield Re.updateToolStatus(l.id,"problem");yield Re.clearCycleAssignment([l.id],"problem");const{error:u}=yield _.from("tools").update({updated_at:new Date().toISOString(),notes:`PROBLEM: ${t} - ${n}`}).eq("id",l.id);if(u)return console.error("Failed to update tool status:",u),{success:!1,message:"Failed to update tool status. Please try again."};const h={user_id:a,facility_id:l.facility_id,module:"sterilization",action:"tool_scanned_problem_workflow",table_name:"sterilization_tools",record_id:l.id,old_values:{status:l.status,current_cycle_id:l.current_cycle_id,sterilization_count:l.sterilization_count,last_sterilized:l.last_sterilized},new_values:{status:"quarantine",current_cycle_id:null,notes:`PROBLEM: ${t} - ${n}`},metadata:{barcode:e,workflow:"problem",problem_type:t,problem_notes:n,previous_phase:"clean_workflow_scan",new_phase:"quarantine",last_cycle_id:l.current_cycle_id,last_cycle_status:o==null?void 0:o.status,last_cycle_completed:o==null?void 0:o.completed_at,sterilization_count_at_problem:l.sterilization_count,process_improvement_flag:!0,inspection_quality_issue:t.includes("damage")||t.includes("inspection"),cleaning_quality_issue:t.includes("cleaning")||t.includes("contamination")}};yield _.from("audit_logs").insert(h);const p=d,f={id:p.id,name:p.tool_name,barcode:p.barcode,category:p.category||"general",type:p.tool_type,currentPhase:"quarantine",status:p.status,location:p.location,cycleCount:p.sterilization_count||0,lastSterilized:p.last_sterilized,notes:p.notes};return{success:!0,message:`Tool "${p.tool_name}" marked as problem (${t}). Process improvement data collected.`,tool:f}}catch(i){return console.error("Error scanning tool for problem workflow:",i),{success:!1,message:"An unexpected error occurred while processing the problem tool."}}})}static getAvailableTools(e){return Da(this,null,function*(){try{return(yield Re.getToolsByFacilityAndStatus(e,"clean")).sort((a,i)=>(a.tool_name||"").localeCompare(i.tool_name||"")).map(a=>{const i=a;return{id:i.id,name:i.tool_name,barcode:i.barcode,category:i.category||"general",type:i.tool_type,currentPhase:i.current_cycle_id?"complete":"available",status:i.status,location:i.location,cycleCount:i.sterilization_count||0,lastSterilized:i.last_sterilized,notes:i.notes}})}catch(t){return console.error("Error fetching available tools:",t),[]}})}}var tc=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const gw=()=>{const{currentUser:s}=cr(),{getCurrentFacilityId:e,isLoading:t}=Nu(),{availableTools:n,setAvailableTools:a,loadCycles:i}=Q(),[c,l]=m.useState(!1),[o,d]=m.useState(!1),[u,h]=m.useState(null);return m.useEffect(()=>{tc(null,null,function*(){if(!(c||t)){if(!s){console.log("⏳ Waiting for user authentication...");return}try{d(!0),h(null);const f=e();if(!f)throw new Error("User facility not found");const y=yield Oi.getAvailableTools(f);a(y),yield i(f),l(!0)}catch(f){console.error("Failed to initialize sterilization store:",f),h(f instanceof Error?f.message:"Unknown error")}finally{d(!1)}}})},[s,c,a,i,e,t]),m.useEffect(()=>{if(c)return;tc(null,null,function*(){try{h(null);const f=e();if(!f){console.log("⚠️ No facility ID available, skipping sterilization initialization");return}yield i(f),l(!0),console.log("✅ Sterilization analytics initialized successfully")}catch(f){console.error("Failed to initialize sterilization analytics:",f),h(f instanceof Error?f.message:"Unknown error")}})},[c,i,e]),{isInitialized:c,isLoading:o,error:u,hasData:n.length>0}},yw=m.lazy(()=>q(()=>import("./RecentActivity-BobxRaD1.js"),__vite__mapDeps([15,2,3,1,4,5])).then(s=>({default:s.RecentActivity}))),vw=m.lazy(()=>q(()=>import("./BITestResults-BAtbM-Ro.js"),__vite__mapDeps([16,2,3,1,4,5])).then(s=>({default:s.BITestResults}))),xw=m.lazy(()=>q(()=>import("./ToolStatus-Bl7P6bcE.js"),__vite__mapDeps([17,2,3,1,4,5])).then(s=>({default:s.ToolStatus}))),Pa=()=>r.jsxs("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-32 bg-gray-200 rounded-lg mb-4"}),r.jsx("div",{className:"h-24 bg-gray-200 rounded-lg"})]}),bw=()=>{var s,e;const[t,n]=m.useState(!0),{isLoading:a,error:i}=gw(),{stats:c,additionalMetrics:l,recentBITests:o,nextBITestDue:d,recentActivities:u,refreshBIResults:h}=pw();return m.useEffect(()=>{const p=setTimeout(()=>{n(!0)},100);return()=>clearTimeout(p)},[]),a||!t?r.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:Lr,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),r.jsx("div",{className:"text-sm text-gray-500",children:i?"Error loading data":"Loading..."})]}),i&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm",children:i}),r.jsxs("div",{className:"animate-pulse space-y-4",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((p,f)=>r.jsx("div",{className:"h-24 bg-gray-200 rounded"},f))}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[...Array(3)].map((p,f)=>r.jsx("div",{className:"h-32 bg-gray-200 rounded"},f))})]})]}):r.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:Lr,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Sterilization Analytics"]}),r.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]}),r.jsx(rw,{score:((s=c.efficiencyScore)==null?void 0:s.score)||0,trend:(e=c.efficiencyScore)==null?void 0:e.trend}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[r.jsx(hn,{title:"Total Cycles",value:c.totalCycles,icon:Wh,iconBgColor:"bg-blue-500",gradientFrom:"blue-50",gradientTo:"blue-100",borderColor:"blue-200",textColor:"text-blue-600",valueColor:"text-blue-800",trend:c.cycleTrend}),r.jsx(hn,{title:"Completed Cycles",value:c.completedCycles,icon:xt,iconBgColor:"bg-green-500",gradientFrom:"green-50",gradientTo:"green-100",borderColor:"green-200",textColor:"text-green-600",valueColor:"text-green-800",trend:c.cycleTrend}),r.jsx(hn,{title:"Tool Turnaround Time",value:`${Math.round(c.averageCycleTime)} min`,icon:lu,iconBgColor:"bg-purple-500",gradientFrom:"purple-50",gradientTo:"purple-100",borderColor:"purple-200",textColor:"text-purple-600",valueColor:"text-purple-800",trend:{direction:"down",value:"Target: <60 min"}}),r.jsx(hn,{title:"BI Pass Rate",value:`${Math.round(c.biPassRate)}%`,icon:On,iconBgColor:"bg-orange-500",gradientFrom:"orange-50",gradientTo:"orange-100",borderColor:"orange-200",textColor:"text-orange-600",valueColor:"text-orange-800",trend:c.biPassRateTrend})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsx(m.Suspense,{fallback:r.jsx(Pa,{}),children:r.jsx(yw,{activities:u})}),r.jsx(m.Suspense,{fallback:r.jsx(Pa,{}),children:r.jsx(vw,{recentTests:o,nextTestDue:d,refreshBIResults:h})}),r.jsx(m.Suspense,{fallback:r.jsx(Pa,{}),children:r.jsx(xw,{totalTools:l.totalTools,activeTools:l.activeTools,completedToday:l.completedToday})})]})]})},_w=({quarantineData:s})=>r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(I,{path:lr,size:1,className:"text-gray-600"}),r.jsx("h3",{className:"font-medium text-gray-800",children:"Quarantine Summary"})]}),s.lastPassedDate&&r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(I,{path:it,size:.8,className:"text-blue-600"}),r.jsx("h4",{className:"font-medium text-blue-800 text-sm",children:"Last Successful BI Test"})]}),r.jsxs("p",{className:"text-xs text-blue-700",children:[r.jsx("strong",{children:"Date:"})," ",s.lastPassedDate.toLocaleDateString()," at"," ",s.lastPassedDate.toLocaleTimeString()]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[r.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[r.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.totalToolsAffected}),r.jsx("div",{className:"text-gray-600",children:"Tools Affected"})]}),r.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[r.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.totalCyclesAffected}),r.jsx("div",{className:"text-gray-600",children:"Cycles Affected"})]}),r.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[r.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s.uniqueOperators.length}),r.jsx("div",{className:"text-gray-600",children:"Operators Involved"})]}),r.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.hasCurrentCycleAffected?"Yes":"No"}),r.jsx("div",{className:"text-gray-600",children:"Current Cycle Affected"})]})]}),s.dateRange&&r.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(I,{path:cu,size:.8,className:"text-yellow-600"}),r.jsx("h4",{className:"font-medium text-yellow-800 text-sm",children:"Affected Date Range"})]}),r.jsxs("p",{className:"text-xs text-yellow-700",children:[r.jsx("strong",{children:"From:"})," ",s.dateRange.start.toLocaleDateString()," ",r.jsx("strong",{children:"To:"})," ",s.dateRange.end.toLocaleDateString()]})]}),Object.keys(s.toolsByCategory).length>0&&r.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[r.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Tools by Category:"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:Object.entries(s.toolsByCategory).map(([e,t])=>r.jsxs("div",{className:"flex justify-between items-center bg-gray-50 px-2 py-1 rounded",children:[r.jsx("span",{className:"text-gray-600",children:e}),r.jsx("span",{className:"font-semibold text-gray-800",children:t})]},e))})]})]}),ww=({affectedCycles:s})=>s.length===0?null:r.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 mb-4",children:[r.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Cycles:"}),r.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:r.jsxs("div",{className:"space-y-2 text-xs",children:[s.slice(0,5).map((e,t)=>r.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-gray-800",children:e.cycleNumber||`Cycle ${t+1}`}),r.jsxs("div",{className:"text-gray-500",children:[new Date(e.startTime).toLocaleDateString()," -"," ",e.operator]})]}),r.jsxs("div",{className:"text-right text-xs text-gray-500",children:[r.jsxs("div",{children:[e.tools.length," tools"]}),r.jsxs("div",{children:[e.phases.length," phases"]})]})]})},e.id)),s.length>5&&r.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",s.length-5," more cycles affected"]})]})})]});var gs=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function us(){return gs(this,null,function*(){const{data:{user:s}}=yield _.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:e,error:t}=yield _.from("users").select("facility_id").eq("id",s.id).single();if(t||!e)throw new Error("Failed to get user facility");return e.facility_id})}class Sw{static getBatchInfoForTool(e){return gs(this,null,function*(){try{const{data:t,error:n}=yield _.from("sterilization_batches").select("*").eq("id",e).order("created_at",{ascending:!1}).limit(1).single();if(n||!t)return null;const a=t;let i;if(a.cycle_id){const d=yield us(),{data:u,error:h}=yield _.from("sterilization_cycles").select("cycle_name").eq("id",a.cycle_id).eq("facility_id",d).single();!h&&u&&(i=u.cycle_name)}const{data:c,error:l}=yield _.from("users").select("name").eq("id",a.requested_by).single(),o=l?"Unknown":(c==null?void 0:c.full_name)||"Unknown";return{batchId:a.id,batchName:a.batch_name,cycleId:a.cycle_id,cycleName:i,status:a.status,totalItems:a.total_items,createdBy:o,createdAt:new Date(a.created_at),completedAt:a.completed_at?new Date(a.completed_at):void 0}}catch(t){return console.error("Error getting batch info for tool:",t),null}})}static getBatchInfoForTools(e){return gs(this,null,function*(){try{if(e.length===0)return[];const{data:t,error:n}=yield _.from("sterilization_batches").select("*").in("id",e).order("created_at",{ascending:!1});if(n||!t)return[];const a=yield us(),{data:i,error:c}=yield _.from("tools").select("id, tool_name, barcode, last_sterilized, sterilization_count").in("id",e).eq("facility_id",a);if(c||!i)return[];const l=new Map(i.map(h=>[h.id,{name:h.tool_name,barcode:h.barcode,lastSterilized:h.last_sterilized,cycleCount:h.sterilization_count}])),o=t,d=Array.from(new Set(o.map(h=>h.cycle_id).filter(Boolean))),u=new Map;if(d.length>0){const h=yield us(),{data:p,error:f}=yield _.from("sterilization_cycles").select("id, cycle_name").in("id",d).eq("facility_id",h);!f&&p&&p.forEach(y=>{u.set(y.id,y.cycle_name)})}return o.map(h=>{const p=l.get(h.id);return{toolId:h.id,toolName:(p==null?void 0:p.name)||"Unknown Tool",barcode:(p==null?void 0:p.barcode)||"Unknown",batchId:h.id,batchName:h.batch_name,cycleId:h.cycle_id,cycleName:h.cycle_id?u.get(h.cycle_id):void 0,status:h.status,lastSterilized:p!=null&&p.lastSterilized?new Date(p.lastSterilized):void 0,cycleCount:(p==null?void 0:p.cycleCount)||0}})}catch(t){return console.error("Error getting batch info for tools:",t),[]}})}static getCurrentBatchFromCycle(e){return gs(this,null,function*(){try{const t=yield us(),{data:n,error:a}=yield _.from("tools").select("current_cycle_id, tool_name").eq("id",e).eq("facility_id",t).single(),i=n;if(a||!n||!i.current_cycle_id)return null;const{data:c,error:l}=yield _.from("sterilization_cycles").select("*").eq("id",i.current_cycle_id).eq("facility_id",t).single();if(l||!c)return null;const{data:o,error:d}=yield _.from("sterilization_batches").select("*").eq("cycle_id",i.current_cycle_id).single(),u=c;if(d||!o)return{batchId:`VIRTUAL-${i.current_cycle_id}`,batchName:`Cycle ${u.cycle_name||u.id}`,cycleId:i.current_cycle_id,cycleName:u.cycle_name,status:u.status,totalItems:1,createdBy:"System",createdAt:new Date(u.start_time),completedAt:u.end_time?new Date(u.end_time):void 0};const h=o,{data:p,error:f}=yield _.from("users").select("name").eq("id",h.requested_by).single(),y=p,g=f?"Unknown":(y==null?void 0:y.full_name)||"Unknown";return{batchId:h.id,batchName:h.batch_name,cycleId:h.cycle_id||void 0,cycleName:u.cycle_name,status:h.status,totalItems:h.total_items,createdBy:g,createdAt:new Date(h.created_at),completedAt:h.completed_at?new Date(h.completed_at):void 0}}catch(t){return console.error("Error getting current batch from cycle:",t),null}})}static generateBatchIdFromCycleData(e){try{if(e.cycleId)return`BATCH-${e.cycleId}`;if(e.lastSterilized){const t=new Date(e.lastSterilized);return`BATCH-${t.getFullYear()}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}-${e.id.slice(-4)}`}return e.currentCycleId?`BATCH-${e.currentCycleId}`:null}catch(t){return console.error("Failed to generate batch ID from cycle data:",t),null}}static getMostRecentBatchForTool(e){return gs(this,null,function*(){try{let t=yield this.getBatchInfoForTool(e);if(t||(t=yield this.getCurrentBatchFromCycle(e),t))return t;const n=yield us(),{data:a,error:i}=yield _.from("tools").select("tool_name, last_sterilized, sterilization_count").eq("id",e).eq("facility_id",n).single();if(i||!a)return null;const c=a;if(c.last_sterilized){const l=new Date(c.last_sterilized);return{batchId:`VIRTUAL-${e}`,batchName:`Last Sterilization - ${c.tool_name}`,status:"completed",totalItems:1,createdBy:"System",createdAt:l,completedAt:l}}return null}catch(t){return console.error("Error getting most recent batch for tool:",t),null}})}}var im=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Cw=s=>im(null,null,function*(){try{const e=yield Sw.getMostRecentBatchForTool(s);return e||null}catch(e){return console.error("Failed to get batch info for tool:",e),null}}),jw=({affectedTools:s})=>{const{availableTools:e}=Q(),[t,n]=m.useState(new Map),[a,i]=m.useState(!1);m.useEffect(()=>{im(null,null,function*(){if(s.length!==0){i(!0);try{const o=new Map;for(const d of s){const u=yield Cw(d.id);u&&o.set(d.id,u)}n(o)}catch(o){console.error("Failed to load batch info:",o)}finally{i(!1)}}})},[s]);const c=l=>{const o=e.find(d=>d.id===l);return o?{id:o.id,name:o.name,barcode:o.barcode,category:o.category,type:o.type||"Unknown",cycleCount:o.cycleCount||0,lastSterilized:o.lastSterilized,status:o.status,cycleId:o.cycleId}:{id:l,name:`Tool ${l}`,barcode:l,category:"Unknown",type:"Unknown",cycleCount:0,lastSterilized:null,status:"unknown",cycleId:void 0}};return s.length===0?null:r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mt-4",children:[r.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Affected Tool Details:"}),r.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200 max-h-32 overflow-hidden",children:r.jsx("div",{className:"max-h-32 overflow-y-auto bi-modal-scrollbar-hide pr-2",children:r.jsxs("div",{className:"grid grid-cols-1 gap-2 text-xs",children:[s.slice(0,6).map((l,o)=>{const d=c(l.id),u=t.get(l.id),h=(u==null?void 0:u.batchName)||"Batch Info Pending",p=u==null?void 0:u.cycleName,f=u==null?void 0:u.status,y=[`Tool: ${d.name}`,`Barcode: ${d.barcode}`,`Category: ${d.category}`,`Type: ${d.type}`,`Cycle Count: ${d.cycleCount}`,`Status: ${d.status}`,`Batch: ${h}`,...p?[`Cycle: ${p}`]:[],...f?[`Batch Status: ${f}`]:[]].join(`
`);return r.jsx("div",{className:"bg-gray-100 px-3 py-2 rounded text-gray-700 hover:bg-gray-200 transition-colors cursor-help",title:y,children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-gray-800",children:d.name}),r.jsxs("div",{className:"text-gray-500 text-xs",children:["#",d.barcode]}),r.jsx("div",{className:"text-orange-600 text-xs font-medium",children:a?"Loading Batch...":`Batch: ${h}`}),p&&r.jsxs("div",{className:"text-blue-600 text-xs",children:["Cycle: ",p]})]}),r.jsxs("div",{className:"text-right text-xs text-gray-500",children:[r.jsx("div",{children:d.category}),r.jsxs("div",{children:["Cycles: ",d.cycleCount]}),f&&r.jsx("div",{className:`text-xs ${f==="completed"?"text-green-600":f==="failed"?"text-red-600":f==="in_cycle"?"text-blue-600":"text-gray-600"}`,children:f})]})]})},o)}),s.length>6&&r.jsxs("div",{className:"text-center text-gray-500 py-2 border-t border-gray-200",children:["+",s.length-6," more tools affected"]})]})})})]}),r.jsx("div",{className:"mt-2 text-xs text-gray-600",children:r.jsxs("p",{children:[r.jsx("strong",{children:"Note:"})," Hover over tools for detailed information. All tools must be quarantined and re-sterilized."]})})]})},Nw=({totalToolsAffected:s})=>r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[r.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Required Actions"}),r.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),r.jsxs("span",{children:["Quarantine all ",s," affected tools immediately"]})]}),r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{children:"Re-sterilize all quarantined tools"})]}),r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{children:"Perform a new BI test after re-sterilization"})]}),r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{children:"Contact supervisor for incident documentation"})]})]})]}),Iw=({operatorName:s,totalToolsAffected:e,totalCyclesAffected:t})=>r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(I,{path:cu,size:1,className:"text-gray-600"}),r.jsx("span",{className:"font-medium text-gray-700",children:"Operator Confirmation"})]}),r.jsxs("p",{className:"text-sm text-gray-600",children:[r.jsx("strong",{children:s}),", by confirming this BI test failure, you acknowledge that:"]}),r.jsxs("ul",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[r.jsxs("li",{children:["• All ",e," affected tools will be quarantined"]}),r.jsxs("li",{children:["• ",t," sterilization cycles are affected"]}),r.jsx("li",{children:"• A compliance incident report will be generated"}),r.jsx("li",{children:"• Re-sterilization procedures must be followed"})]})]}),Tw=({onCancel:s})=>r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-red-50",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:r.jsx(I,{path:Ye,size:1.5,className:"text-red-600"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-red-800",children:"BI Test Failure - Critical Alert"}),r.jsx("p",{className:"text-sm text-red-600",children:"Sterilization process failure detected"})]})]}),r.jsx("button",{onClick:s,className:"p-2 hover:bg-red-100 rounded-lg transition-colors",children:r.jsx(I,{path:Pe,size:1,className:"text-red-600"})})]}),Ew=()=>r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(I,{path:de,size:1.2,className:"text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-red-800 mb-2",children:"Immediate Action Required"}),r.jsx("p",{className:"text-sm text-red-700",children:"A Biological Indicator test failure indicates that the sterilization process may not have been effective. All tools processed since the last successful BI test must be quarantined and re-sterilized."})]})]})}),kw=({isOpen:s,onConfirm:e,onCancel:t,operatorName:n})=>{const a=Ii();return s?Ts.createPortal(r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:t,onKeyDown:i=>{i.key==="Escape"&&t()},role:"button",tabIndex:0,"aria-label":"Close modal"}),r.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[r.jsx(Tw,{onCancel:t}),r.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto bi-modal-scrollbar-hide",children:[r.jsx(Ew,{}),r.jsx(_w,{quarantineData:a}),r.jsx(ww,{affectedCycles:a.affectedCycles}),r.jsx(jw,{affectedTools:a.affectedTools}),r.jsx(Nw,{totalToolsAffected:a.totalToolsAffected}),r.jsx(Iw,{operatorName:n,totalToolsAffected:a.totalToolsAffected,totalCyclesAffected:a.totalCyclesAffected})]}),r.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[r.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:e,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Confirm BI Test Failure"})]})]})]}),document.body):null},Dw=({isVisible:s,onComplete:e,onOptOut:t})=>{const[n,a]=m.useState(!1),[i,c]=m.useState(null),{currentCycle:l,enforceBI:o}=Q(),d=Ii();if(!s||!o)return null;const u=f=>{if(f==="fail"){c(f),a(!0);return}const y={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:f==="pass",date:new Date,status:f,operator:(l==null?void 0:l.operator)||"Operator"};f==="skip"&&t(),e(y)},h=()=>{if(a(!1),i){const f={id:`bi-test-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toolId:"default",passed:!1,date:new Date,status:"fail",operator:(l==null?void 0:l.operator)||"Operator"},{activateBIFailure:y}=Q.getState(),g=d.totalToolsAffected,x=d.affectedCycles.map(b=>b.batchId).filter(b=>!!b);y({affectedToolsCount:g,affectedBatchIds:x,operator:(l==null?void 0:l.operator)||"Operator"}),e(f)}c(null)},p=()=>{a(!1),c(null)};return r.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 mb-4 rounded-r-lg shadow-sm",children:[r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[r.jsx("div",{className:"p-2 bg-orange-100 rounded-lg flex-shrink-0",children:r.jsx(I,{path:On,size:1.2,className:"text-orange-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("h3",{className:"text-lg font-semibold text-orange-800",children:"Daily BI Test Required"}),r.jsxs("span",{className:"text-sm text-orange-600",children:["(",new Date().toLocaleDateString(),")"]})]}),r.jsx("p",{className:"text-orange-700 text-sm mb-3",children:"Please complete the daily Biological Indicator test to ensure sterilization compliance."}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("button",{onClick:()=>u("pass"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-green-300 hover:border-green-500 bg-green-50 hover:bg-green-100 text-green-800 transition-colors",children:[r.jsx(I,{path:xt,size:1,className:"text-green-600"}),r.jsx("span",{className:"text-sm font-medium",children:"PASS"})]}),r.jsxs("button",{onClick:()=>u("fail"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-red-300 hover:border-red-500 bg-red-50 hover:bg-red-100 text-red-800 transition-colors",children:[r.jsx(I,{path:de,size:1,className:"text-red-600"}),r.jsx("span",{className:"text-sm font-medium",children:"FAIL"})]}),r.jsxs("button",{onClick:()=>u("skip"),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-gray-300 hover:border-gray-500 bg-gray-50 hover:bg-gray-100 text-gray-800 transition-colors",children:[r.jsx(I,{path:On,size:1,className:"text-gray-600"}),r.jsx("span",{className:"text-sm font-medium",children:"SKIP"})]})]})]})]})}),r.jsx(kw,{isOpen:n,onConfirm:h,onCancel:p,operatorName:(l==null?void 0:l.operator)||"Operator"})]})},Pw=s=>{if(!s)return!0;const e=new Date().toDateString();return new Date(s).toDateString()!==e};class Wt{static getTabs(){return[{id:"timers",label:"Phase Timers",icon:Br},{id:"analytics",label:"Analytics",icon:Lr},{id:"logs",label:"Cleaning Logs",icon:Ue}]}static getCycleProgressInfo(e){const t=e.phases.some(a=>a.status==="active"),n=e.phases.map(a=>({id:a.id,name:a.name,status:a.status,toolCount:a.tools.length,statusColor:this.getPhaseStatusColor(a.status)}));return{hasActivePhase:t,phaseStatuses:n}}static getPhaseStatusColor(e){switch(e){case"completed":return"bg-green-500";case"active":return"bg-blue-500";case"failed":return"bg-red-500";default:return"bg-gray-300"}}static validateOperatorName(e){return e.trim().length>0}static getTabButtonClasses(e){return e?"bg-[#4ECDC4] text-white shadow-md":"text-gray-600 hover:text-[#4ECDC4] hover:bg-gray-50"}static getStartCycleButtonState(e){const t=!this.validateOperatorName(e),n=this.validateOperatorName(e)?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-gray-300 text-gray-500 cursor-not-allowed";return{disabled:t,className:n}}static shouldShowNoCycleMessage(e){return!e}static shouldShowActiveCycleInfo(e){return e.phases.some(t=>t.status==="active")}}const Rw=()=>{const{currentCycle:s}=Q();m.useRef(performance.now());const e=m.useMemo(()=>Wt.getTabs(),[]),t=m.useMemo(()=>s?Wt.getCycleProgressInfo(s):null,[s]),n=m.useCallback(o=>Wt.validateOperatorName(o),[]),a=m.useCallback(o=>Wt.getTabButtonClasses(o),[]),i=m.useCallback(o=>Wt.getStartCycleButtonState(o),[]),c=m.useCallback(()=>Wt.shouldShowNoCycleMessage(s),[s]),l=m.useCallback(()=>s?Wt.shouldShowActiveCycleInfo(s):!1,[s]);return m.useMemo(()=>{},[]),{tabs:e,cycleProgressInfo:t,validateOperatorName:n,getTabButtonClasses:a,getStartCycleButtonState:i,shouldShowNoCycleMessage:c,shouldShowActiveCycleInfo:l}},Aw=()=>{const[s,e]=m.useState("timers"),[t,n]=m.useState(!1),[a,i]=m.useState(""),c=m.useCallback(p=>{(p==="timers"||p==="analytics"||p==="logs")&&e(p)},[]),l=m.useCallback(p=>{i(p.target.value)},[]),o=m.useCallback(p=>{p.key},[]),d=m.useCallback(()=>{n(!1),i("")},[]),u=m.useCallback(()=>{n(!0)},[]),h=m.useCallback(()=>{i("")},[]);return{activeTab:s,showNewCycleModal:t,operatorName:a,handleTabChange:c,handleOperatorNameChange:l,handleOperatorNameKeyPress:o,handleCloseNewCycleModal:d,openNewCycleModal:u,resetOperatorName:h}},om=m.memo(()=>r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Sterilization Management"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"Manage sterilization cycles, track tools, and monitor performance"})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow p-6 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsx("span",{className:"text-gray-600",children:"Tool Scanner"}),r.jsxs(Xd,{to:"/sterilization/scanner",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center gap-2",children:[r.jsx(I,{path:qe,size:1}),"Scan Tool"]})]})]}));om.displayName="DashboardHeader";var Ow=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class ze{static fetchCleaningLogs(){return Ow(this,null,function*(){try{const{data:e,error:t}=yield _.from("sterilization_cycles").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching sterilization cycles:",t),t;return(e||[]).map(a=>({id:a.id,room_id:a.id,room_name:`Cycle ${a.id.slice(0,8)}`,status:a.status||"in_progress",cleaning_type:"sterilization",scheduled_time:a.start_time,started_time:a.start_time,completed_time:a.completed_at,operator_id:a.operator_id,notes:a.notes||"",created_at:a.created_at,updated_at:a.updated_at}))}catch(e){return console.error("Failed to fetch sterilization cycles:",e),[]}})}static filterCleaningLogs(e,t){return e.filter(n=>{let a=!1;t.status==="all"?a=!0:t.status==="in_progress"?a=n.status==="pending"||n.status==="in_progress":a=n.status===t.status;const i=!t.date||new Date(n.created_at).toDateString()===new Date(t.date).toDateString();return a&&i})}static calculateStats(e){return{totalCycles:e.length,completed:e.filter(t=>t.status==="completed").length,failed:e.filter(t=>t.status==="failed").length,totalTools:e.length}}static getStatusColor(e){switch(e){case"completed":return{color:"text-green-600 bg-green-100"};case"verified":return{color:"text-blue-600 bg-blue-100"};case"failed":return{color:"text-red-600 bg-red-100"};case"in_progress":return{color:"text-yellow-600 bg-yellow-100"};case"pending":return{color:"text-gray-600 bg-gray-100"};case"cancelled":return{color:"text-orange-600 bg-orange-100"};default:return{color:"text-gray-600 bg-gray-100"}}}static formatDuration(e,t){if(!t)return"In Progress";const n=new Date(e),i=new Date(t).getTime()-n.getTime(),c=Math.floor(i/(1e3*60)),l=Math.floor(c/60),o=c%60;return`${l}h ${o}m`}static getBITestResultsForCycle(e,t){return e.filter(n=>{const a=new Date(t);return new Date(n.date).toDateString()===a.toDateString()})}static getBITestResultColor(e){return e==="pass"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}static formatTestTime(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static getCleaningTypeDisplayName(e){switch(e){case"routine":return"Routine";case"deep_clean":return"Deep Clean";case"emergency":return"Emergency";case"post_procedure":return"Post Procedure";default:return e}}static getQualityScoreDisplay(e){return e?`${Math.round(e*100)}%`:"N/A"}static getComplianceScoreDisplay(e){return e?`${Math.round(e*100)}%`:"N/A"}static exportToCSV(e){if(!e||e.length===0){alert("No data to export");return}try{const t=["Cycle ID","Room Name","Status","Cleaning Type","Scheduled Time","Started Time","Completed Time","Operator ID","Notes","Created At","Updated At"],n=e.map(o=>[o.id,o.room_name,o.status,o.cleaning_type,o.scheduled_time||"",o.started_time||"",o.completed_time||"",o.operator_id||"",o.notes||"",o.created_at,o.updated_at]),a=[t.join(","),...n.map(o=>o.map(d=>`"${d}"`).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),c=window.URL.createObjectURL(i),l=document.createElement("a");l.href=c,l.download=`cleaning_logs_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(c)}catch(t){console.error("Failed to export cleaning logs:",t),alert("Failed to export data. Please try again.")}}}var $w=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Mw=({filterStatus:s,filterDate:e})=>{const{biTestResults:t}=Q(),[n,a]=m.useState([]),[i,c]=m.useState(!0),[l,o]=m.useState(null);m.useEffect(()=>{$w(null,null,function*(){try{c(!0),o(null);const T=yield ze.fetchCleaningLogs();a(T)}catch(T){console.error("Failed to fetch cleaning logs:",T),o("Failed to load cleaning logs")}finally{c(!1)}})},[]);const d=m.useMemo(()=>{const S={status:s,date:e};return ze.filterCleaningLogs(n,S)},[n,s,e]),u=m.useMemo(()=>ze.calculateStats(d),[d]);return{filteredLogs:d,stats:u,loading:i,error:l,getStatusColor:S=>ze.getStatusColor(S).color,formatDuration:(S,T)=>ze.formatDuration(S,T),getBITestResultsForCycle:S=>ze.getBITestResultsForCycle(t,S),getBITestResultColor:S=>ze.getBITestResultColor(S),formatTestTime:S=>ze.formatTestTime(S),getCleaningTypeDisplayName:S=>ze.getCleaningTypeDisplayName(S),getQualityScoreDisplay:S=>ze.getQualityScoreDisplay(S),getComplianceScoreDisplay:S=>ze.getComplianceScoreDisplay(S),exportLogs:()=>{ze.exportToCSV(d)}}},Fw=()=>{const[s,e]=m.useState(null),[t,n]=m.useState("all"),[a,i]=m.useState(""),{filteredLogs:c,stats:l,loading:o,error:d,getStatusColor:u,formatDuration:h,getBITestResultsForCycle:p,getBITestResultColor:f,formatTestTime:y,getQualityScoreDisplay:g,getComplianceScoreDisplay:x,exportLogs:b}=Mw({filterStatus:t,filterDate:a});return o?r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx(I,{path:au,size:2,className:"animate-spin text-[#4ECDC4] mr-3"}),r.jsx("span",{className:"text-gray-600",children:"Loading cleaning logs..."})]})}):d?r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx(I,{path:de,size:2,className:"text-red-500 mr-3"}),r.jsx("span",{className:"text-red-600",children:d})]})}):r.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h2",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:Ue,size:1.2,className:"text-[#4ECDC4] mr-2"}),"Cleaning Log Tracker"]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[r.jsx(I,{path:wi,size:1}),"Export"]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Filter"}),r.jsxs("select",{id:"status-filter",value:t,onChange:v=>n(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[r.jsx("option",{value:"all",children:"All Statuses"}),r.jsx("option",{value:"in_progress",children:"In Progress"}),r.jsx("option",{value:"completed",children:"Completed"}),r.jsx("option",{value:"failed",children:"Failed"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Filter"}),r.jsx("input",{id:"date-filter",type:"date",value:a,onChange:v=>i(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:()=>{n("all"),i("")},className:"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Clear Filters"})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[r.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-green-600",children:"Completed"}),r.jsx("p",{className:"text-2xl font-bold text-green-800",children:l.completed})]}),r.jsx(I,{path:xt,size:1.5,className:"text-green-500"})]})}),r.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-red-600",children:"Failed"}),r.jsx("p",{className:"text-2xl font-bold text-red-800",children:l.failed})]}),r.jsx(I,{path:de,size:1.5,className:"text-red-500"})]})}),r.jsx("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Cycles"}),r.jsx("p",{className:"text-2xl font-bold text-purple-800",children:l.totalTools})]}),r.jsx(I,{path:Ss,size:1.5,className:"text-purple-500"})]})})]}),r.jsx("div",{className:"space-y-4",children:c.length===0?r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No sterilization cycles found for the selected filters."}):c.map(v=>r.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:v.room_name}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u(v.status)}`,children:v.status.toUpperCase()}),r.jsx("span",{className:"text-sm text-gray-500",children:"Sterilization Cycle"})]}),r.jsxs("button",{onClick:()=>e(s===v.id?null:v.id),className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:[r.jsx(I,{path:Gh,size:1}),s===v.id?"Hide":"View"," Details"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:Rn,size:1}),r.jsxs("span",{children:["Scheduled:"," ",new Date(v.scheduled_time).toLocaleDateString()]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:lu,size:1}),r.jsxs("span",{children:["Duration:"," ",h(v.started_time||v.scheduled_time,v.completed_time)]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:du,size:1}),r.jsxs("span",{children:["Room ID: ",v.room_id]})]})]}),s===v.id&&r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Quality Metrics"}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Quality Score:"}),r.jsx("span",{className:"font-medium",children:g(v.quality_score)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Compliance Score:"}),r.jsx("span",{className:"font-medium",children:x(v.compliance_score)})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Timeline"}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Scheduled:"}),r.jsx("span",{children:new Date(v.scheduled_time).toLocaleString()})]}),v.started_time&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Started:"}),r.jsx("span",{children:new Date(v.started_time).toLocaleString()})]}),v.completed_time&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Completed:"}),r.jsx("span",{children:new Date(v.completed_time).toLocaleString()})]})]})]})]}),r.jsxs("div",{className:"mt-4",children:[r.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center gap-2",children:[r.jsx(I,{path:On,size:1}),"BI Test Results"]}),r.jsxs("div",{className:"space-y-2",children:[p(v.created_at).map((w,S)=>r.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${f(w.passed?"pass":"fail")}`,children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{children:w.passed?"PASS":"FAIL"}),r.jsx("span",{children:y(new Date(w.date))})]})},S)),p(v.created_at).length===0&&r.jsx("p",{className:"text-sm text-gray-500",children:"No BI tests for this date"})]})]})]})]},v.id))})]})};var zw=Object.defineProperty,Lw=Object.defineProperties,Bw=Object.getOwnPropertyDescriptors,rc=Object.getOwnPropertySymbols,qw=Object.prototype.hasOwnProperty,Uw=Object.prototype.propertyIsEnumerable,sc=(s,e,t)=>e in s?zw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ae=(s,e)=>{for(var t in e||(e={}))qw.call(e,t)&&sc(s,t,e[t]);if(rc)for(var t of rc(e))Uw.call(e,t)&&sc(s,t,e[t]);return s},ce=(s,e)=>Lw(s,Bw(e));const Is=Ft((s,e)=>({timers:{},overexposed:!1,intervals:{},startTimer:(t,n,a)=>{const i=e().intervals[t];i&&clearInterval(i),s(l=>({timers:ce(ae({},l.timers),{[t]:{id:t,timeRemaining:a?a.timeRemaining:t==="drying"?0:n,elapsedTime:a?a.elapsedTime:0,duration:n,isRunning:!0,overexposed:!1}})}));const c=setInterval(()=>{const l=e().timers[t];if(l&&l.isRunning)if(t==="drying"){const o=l.elapsedTime+1;s(d=>({timers:ce(ae({},d.timers),{[t]:ce(ae({},l),{elapsedTime:o})})}))}else{const o=l.elapsedTime+1;if(l.timeRemaining>0){const d=l.timeRemaining-1;s(u=>({timers:ce(ae({},u.timers),{[t]:ce(ae({},l),{timeRemaining:d,elapsedTime:o,overexposed:!1})})}))}else{const d=t==="bath1"||t==="bath2",u=d?l.elapsedTime-l.duration:0;s(h=>({timers:ce(ae({},h.timers),{[t]:ce(ae({},l),{timeRemaining:0,elapsedTime:o,overexposed:d&&u>0})}),overexposed:d&&u>0||h.overexposed}))}}},1e3);s(l=>({intervals:ce(ae({},l.intervals),{[t]:c})}))},pauseTimer:t=>{const n=e().intervals[t];n&&(clearInterval(n),s(a=>{const i=ae({},a.intervals);return delete i[t],{intervals:i}})),s(a=>({timers:ce(ae({},a.timers),{[t]:a.timers[t]?ce(ae({},a.timers[t]),{isRunning:!1}):a.timers[t]})}))},resetTimer:t=>{const n=e().intervals[t];n&&(clearInterval(n),s(a=>{const i=ae({},a.intervals);return delete i[t],{intervals:i}})),s(a=>({timers:ce(ae({},a.timers),{[t]:a.timers[t]?ce(ae({},a.timers[t]),{timeRemaining:t==="drying"?0:a.timers[t].duration,elapsedTime:0,isRunning:!1,overexposed:!1}):a.timers[t]})}))},updateTimer:(t,n)=>{s(a=>({timers:ce(ae({},a.timers),{[t]:a.timers[t]?ce(ae({},a.timers[t]),{timeRemaining:n}):a.timers[t]})}))},getTimer:t=>e().timers[t],resumeTimer:t=>{const n=e().timers[t];if(!n)return;const a=e().intervals[t];a&&clearInterval(a),s(c=>({timers:ce(ae({},c.timers),{[t]:ce(ae({},n),{isRunning:!0})})}));const i=setInterval(()=>{const c=e().timers[t];if(c&&c.isRunning)if(t==="drying"){const l=c.elapsedTime+1;s(o=>({timers:ce(ae({},o.timers),{[t]:ce(ae({},c),{elapsedTime:l})})}))}else{const l=c.elapsedTime+1;if(c.timeRemaining>0){const o=c.timeRemaining-1;s(d=>({timers:ce(ae({},d.timers),{[t]:ce(ae({},c),{timeRemaining:o,elapsedTime:l,overexposed:!1})})}))}else{const o=t==="bath1"||t==="bath2",d=o?c.elapsedTime-c.duration:0;s(u=>({timers:ce(ae({},u.timers),{[t]:ce(ae({},c),{timeRemaining:0,elapsedTime:l,overexposed:o&&d>0})}),overexposed:o&&d>0||u.overexposed}))}}},1e3);s(c=>({intervals:ce(ae({},c.intervals),{[t]:i})}))},setOverexposed:t=>{s({overexposed:t})}})),Hw={unwrapped:{name:"Unwrapped",temp:"132°C (270°F)",sterilizeTime:3,dryTime:30,totalTime:15,duration:900},pouches:{name:"Pouches",temp:"132°C (270°F)",sterilizeTime:5,dryTime:30,totalTime:17,duration:1020},packs:{name:"Packs",temp:"121°C (250°F)",sterilizeTime:30,dryTime:30,totalTime:40,duration:2400},handpieces:{name:"Handpieces",temp:"132°C (270°F)",sterilizeTime:6,dryTime:30,totalTime:16,duration:960}},Vw=()=>"pouches";var Ww=Object.defineProperty,Gw=Object.defineProperties,Kw=Object.getOwnPropertyDescriptors,nc=Object.getOwnPropertySymbols,Qw=Object.prototype.hasOwnProperty,Yw=Object.prototype.propertyIsEnumerable,ac=(s,e,t)=>e in s?Ww(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ic=(s,e)=>{for(var t in e||(e={}))Qw.call(e,t)&&ac(s,t,e[t]);if(nc)for(var t of nc(e))Yw.call(e,t)&&ac(s,t,e[t]);return s},oc=(s,e)=>Gw(s,Kw(e));const Jw=()=>{const{timers:s,startTimer:e,pauseTimer:t,resetTimer:n,resumeTimer:a}=Is(),{currentCycle:i,setCurrentCycle:c}=Q(),l=m.useCallback((u,h)=>{e(u,h)},[e]),o=m.useCallback(u=>{const h=s[u];h!=null&&h.isRunning?t(u):h&&a(u)},[s,t,a]),d=m.useCallback(u=>{if(console.log("🛑 Cancelling timer for phase:",u),t(u),n(u),i){console.log("🛑 Clearing tools from cycle. Current tools:",i.tools);const h=oc(ic({},i),{tools:[],phases:i.phases.map(p=>oc(ic({},p),{tools:[],isActive:!1,status:"pending",startTime:null,endTime:null}))});c(h),console.log("✅ Cycle cleared, tools removed. Workflow can be restarted.")}},[t,n,i,c]);return{handleStartTimer:l,handlePauseTimer:o,handleStopTimer:d}};var Xw=Object.defineProperty,Zw=Object.defineProperties,eS=Object.getOwnPropertyDescriptors,lc=Object.getOwnPropertySymbols,tS=Object.prototype.hasOwnProperty,rS=Object.prototype.propertyIsEnumerable,cc=(s,e,t)=>e in s?Xw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,sS=(s,e)=>{for(var t in e||(e={}))tS.call(e,t)&&cc(s,t,e[t]);if(lc)for(var t of lc(e))rS.call(e,t)&&cc(s,t,e[t]);return s},nS=(s,e)=>Zw(s,eS(e));class aS{constructor(){this.notifications=[],this.priorityQueue=[],this.statusChangeCallbacks=[]}trackTool(e,t,n="medium"){const a=this.priorityQueue.findIndex(i=>i.toolId===e&&i.doctorName===t);a>=0?this.priorityQueue[a]=nS(sS({},this.priorityQueue[a]),{timestamp:new Date().toISOString(),priority:n,status:"waiting"}):this.priorityQueue.push({toolId:e,doctorName:t,timestamp:new Date().toISOString(),priority:n,status:"waiting"})}untrackTool(e,t){const n=this.priorityQueue.findIndex(a=>a.toolId===e&&a.doctorName===t);n>=0&&this.priorityQueue.splice(n,1)}isToolTracked(e){return this.priorityQueue.some(t=>t.toolId===e)}getToolTrackers(e){return this.priorityQueue.filter(t=>t.toolId===e).sort((t,n)=>{const a={high:3,medium:2,low:1},i=a[n.priority]-a[t.priority];return i!==0?i:new Date(t.timestamp).getTime()-new Date(n.timestamp).getTime()})}monitorToolStatusChange(e,t,n){this.isCleanStatus(n)&&!this.isCleanStatus(t)&&this.handleToolBecameAvailable(e),this.statusChangeCallbacks.forEach(a=>a(e,t,n))}handleToolBecameAvailable(e){const t=this.getToolTrackers(e);if(t.length===0)return;const n=t[0],a={id:`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,toolId:e,toolName:`Tool ${e}`,doctorName:n.doctorName,timestamp:new Date().toISOString(),status:"pending",priority:n.priority,message:"Your tracked tool is now available! You have first priority to claim it."};this.notifications.push(a),n.status="notified"}acknowledgeNotification(e){const t=this.notifications.find(n=>n.id===e);if(t){t.status="acknowledged";const n=this.priorityQueue.find(a=>a.toolId===t.toolId&&a.doctorName===t.doctorName);n&&(n.status="claimed")}}getPendingNotifications(e){return this.notifications.filter(t=>t.doctorName===e&&t.status==="pending")}getAllNotifications(e){return this.notifications.filter(t=>t.doctorName===e)}clearExpiredNotifications(){const e=new Date(Date.now()-864e5);this.notifications=this.notifications.filter(t=>{const n=new Date(t.timestamp)<e;return n&&t.status==="pending"&&(t.status="expired"),!n})}subscribeToStatusChanges(e){return this.statusChangeCallbacks.push(e),()=>{const t=this.statusChangeCallbacks.indexOf(e);t>=0&&this.statusChangeCallbacks.splice(t,1)}}isCleanStatus(e){const t=e.toLowerCase();return["clean","active"].includes(t)}getPriorityQueue(e){return this.priorityQueue.filter(t=>t.toolId===e).sort((t,n)=>{const a={high:3,medium:2,low:1},i=a[n.priority]-a[t.priority];return i!==0?i:new Date(t.timestamp).getTime()-new Date(n.timestamp).getTime()})}getTrackedToolsForDoctor(e){return this.priorityQueue.filter(t=>t.doctorName===e)}getTrackingStats(){const e=this.priorityQueue.length,t=this.priorityQueue.filter(c=>c.priority==="high").length,n=this.priorityQueue.filter(c=>c.priority==="medium").length,a=this.priorityQueue.filter(c=>c.priority==="low").length,i=this.notifications.filter(c=>c.status==="pending").length;return{totalTracked:e,highPriority:t,mediumPriority:n,lowPriority:a,pendingNotifications:i}}}const dc=new aS,iS=()=>{const{startTimer:s,pauseTimer:e,resetTimer:t}=Is(),{currentCycle:n,moveToolToNextPhase:a,updateToolStatus:i,addActivity:c}=Q(),{currentUser:l}=cr();return{handleMoveToNextPhase:m.useCallback(d=>{if(console.log(`🔄 Starting phase transition from ${d}`),!l){console.log("❌ User authentication required for phase transitions"),alert("Please log in to perform sterilization phase transitions");return}if(!n){console.log("❌ No active cycle found");return}const u=n.tools.some(y=>{const g=Q.getState().availableTools.find(x=>x.id===y);return g==null?void 0:g.isP2Status});if(d==="drying"&&u){console.log("✅ Completing P2 Status tools after drying phase"),n.tools.forEach(y=>{const g=Q.getState().availableTools.find(x=>x.id===y);if(g!=null&&g.isP2Status){const x=Q.getState();x.incrementToolCycleCount&&x.incrementToolCycleCount(y),i(y,"complete"),dc.monitorToolStatusChange(y,"drying","complete"),console.log(`✅ P2 Status tool ${g.name} completed and cycle count incremented`)}}),e(d),t(d);return}const h=["bath1","bath2","airDry","autoclave"],p=h.indexOf(d),f=h[p+1];if(f){console.log(`🔄 Moving tools from ${d} to ${f}`),n.tools.forEach(g=>{const x=Q.getState().availableTools.find(b=>b.id===g);x&&(a(g),i(g,f),console.log(`✅ Moved tool ${x.name} from ${d} to ${f}`))}),e(d),t(d);const y=Eu[f];y&&s(f,y.duration),console.log(`✅ Phase transition completed: ${d} → ${f}`)}else{console.log("✅ Completing all tools after autoclave phase");const y=[];n.tools.forEach(g=>{const x=Q.getState().availableTools.find(b=>b.id===g);if(x){const b=Q.getState();b.incrementToolCycleCount&&b.incrementToolCycleCount(g),i(g,"complete"),dc.monitorToolStatusChange(g,"autoclave","available"),y.push(x),console.log(`✅ Tool ${x.name} completed sterilization cycle and marked as available`)}}),y.length>0&&(c({id:`cycle-${n.cycleNumber}-${Date.now()}`,type:"cycle-complete",title:`Cycle ${n.cycleNumber} Completed`,time:new Date,toolCount:y.length,color:"bg-green-500"}),console.log(`✅ Activity logged: Cycle ${n.cycleNumber} completed with ${y.length} tools`)),e(d),t(d)}},[l,n,s,e,t,a,i,c])}},$t=s=>{const e=Math.floor(s/3600),t=Math.floor(s%3600/60),n=s%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},oS=(s,e)=>s?"bg-red-100 text-red-700 border border-red-200":e?"bg-[#4ECDC4] text-white":"bg-gray-100 text-gray-600",lS=(s,e)=>s?"OVEREXPOSED":e?"ACTIVE":"INACTIVE",cS=(s,e,t,n)=>{var a;if(!s)return e==="drying"?"00:00:00":$t(t);if(e==="drying")return $t(n);if((e==="bath1"||e==="bath2")&&s.overexposed&&s.elapsedTime){const c=s.elapsedTime-t;return`+${$t(c)}`}return $t((a=s.timeRemaining)!=null?a:0)},dS=({phaseId:s,phaseConfig:e,timer:t,duration:n,elapsedTime:a,isExpanded:i,onToggleExpanded:c})=>{var l;const{currentCycle:o}=Q(),d=(l=t==null?void 0:t.timeRemaining)!=null?l:n,u=(t==null?void 0:t.isRunning)||!1,h=(t==null?void 0:t.overexposed)||!1,p=o==null?void 0:o.tools.some(f=>{const y=Q.getState().availableTools.find(g=>g.id===f);return y==null?void 0:y.isP2Status});return r.jsxs("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:c,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&c()},role:"button",tabIndex:0,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("h3",{className:"text-lg font-semibold text-[#5b5b5b]",children:e.label}),r.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${oS(h,u)}`,children:lS(h,u)}),s==="drying"&&p&&r.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 border border-blue-200",children:"P2 STATUS"})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:`text-2xl font-mono font-bold ${h?"text-red-600":"text-[#5b5b5b]"}`,children:cS(t,s,n,a)}),r.jsx("div",{className:"text-xs text-gray-500",children:t?`${t.elapsedTime?`${Math.floor(t.elapsedTime/60)}:${(t.elapsedTime%60).toString().padStart(2,"0")}`:"00:00"} elapsed`:"Ready"})]}),r.jsx(I,{path:i?Kh:Ds,size:1,className:"text-gray-400"})]})]}),s!=="drying"&&r.jsxs("div",{className:"mt-3",children:[r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 relative",children:r.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${h?"bg-red-500":"bg-[#4ECDC4]"}`,style:{width:`${d/n*100}%`}})}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:h&&(s==="bath1"||s==="bath2")?`100% + ${$t(a-n)} overexposed`:`${Math.round((n-d)/n*100)}% complete`})]})]})},uS=({phaseId:s,timer:e,onPauseTimer:t,onStopTimer:n,onMoveToNextPhase:a})=>{const{currentCycle:i}=Q(),c=(e==null?void 0:e.isRunning)||!1,l=e&&e.timeRemaining===0,o=i&&i.tools.length>0,d=i==null?void 0:i.tools.some(h=>{const p=Q.getState().availableTools.find(f=>f.id===h);return p==null?void 0:p.isP2Status}),u=o&&(s==="bath1"&&l||s==="bath2"&&e||s==="drying"&&e||s==="autoclave"&&l);return r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex gap-3",children:[s==="bath1"&&e?r.jsxs("button",{onClick:()=>t(s),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200"}`,children:[r.jsx(I,{path:c?$n:Br,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):s==="bath1"?r.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via workflow"}):e?r.jsxs("button",{onClick:()=>t(s),className:`flex-1 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center justify-center ${c?"bg-gray-500 text-white hover:bg-gray-600":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,children:[r.jsx(I,{path:c?$n:Br,size:.8,className:"mr-2"}),c?"Pause":"Resume"]}):r.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm flex items-center justify-center",children:"Started via previous phase"}),r.jsx("button",{onClick:()=>n(s),className:"px-4 py-2 bg-red-100 text-red-700 border border-red-300 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Cancel"})]}),u&&r.jsx("div",{className:"mt-2",children:r.jsx("button",{onClick:()=>a(s),className:"w-full px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:s==="drying"&&d?"Complete P2 Status Tools":s==="autoclave"?"Complete All Tools":"Move to Next Phase"})})]})},mS=({selectedCycle:s,onCycleSelect:e})=>r.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Select Cycle Type:"}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Hw).map(([t,n])=>r.jsxs("button",{onClick:()=>e(t),className:`p-3 text-xs rounded-lg border transition-all duration-200 ${s===t?"bg-[#4ECDC4] text-white border-[#4ECDC4] shadow-sm":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-[#4ECDC4]"}`,children:[r.jsx("div",{className:"font-medium",children:n.name}),r.jsx("div",{className:"text-xs opacity-75",children:n.temp}),r.jsxs("div",{className:"text-xs opacity-75",children:[n.totalTime," min"]})]},t))})]}),hS=({duration:s,isRunning:e,timer:t})=>r.jsxs("div",{className:"text-xs text-gray-500 space-y-1 bg-gray-50 p-3 rounded-lg",children:[r.jsxs("div",{children:["Duration: ",$t(s)]}),r.jsxs("div",{children:["Status: ",e?"Running":"Stopped"]}),t&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["Remaining: ",$t(t.timeRemaining||0)]}),r.jsxs("div",{children:["Elapsed: ",$t(t.elapsedTime||0)]})]})]}),pS=()=>{const s=Q(a=>a.currentCycle),e=Q(a=>a.availableTools),n=m.useMemo(()=>(s==null?void 0:s.tools)||[],[s==null?void 0:s.tools]).map(a=>e.find(i=>i.id===a)).filter(a=>a!==void 0);return r.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(I,{path:Ss,size:.8,className:"text-gray-500"}),r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Tools in Phase"})]}),(s==null?void 0:s.cycleNumber)&&r.jsx("span",{className:"text-xs text-gray-500 font-mono bg-white px-2 py-1 rounded border",children:s.cycleNumber})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:n.length>0?n.map(a=>r.jsx("span",{className:"px-2 py-1 bg-white text-xs text-gray-600 rounded border",children:a.name},a.id)):r.jsx("span",{className:"px-2 py-1 bg-gray-100 text-xs text-gray-500 rounded border",children:"No tools in cycle"})})]})},lm=m.memo(({className:s=""})=>{const{timers:e}=Is(),[t,n]=m.useState(null),[a,i]=m.useState(Vw()),{handlePauseTimer:c,handleStopTimer:l}=Jw(),{handleMoveToNextPhase:o}=iS(),d=p=>{n(t===p?null:p)},u=p=>{l(p),n(null)},h=p=>{o(p),n(null)};return r.jsxs("div",{className:`space-y-4 ${s}`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"Sterilization Timers"}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Individual phase timers for concurrent cycles"})]}),r.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-[#4ECDC4] text-white rounded-full",children:"Phase Timers"})]}),r.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(Eu).map(([p,f])=>{var y;const g=e[p],x=f.duration,b=t===p,v=(y=g==null?void 0:g.elapsedTime)!=null?y:0;return r.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-300 ${g!=null&&g.isRunning||p==="bath1"?"shadow-[0_0_25px_rgba(78,205,196,0.5)] border-[#4ECDC4] ring-2 ring-[#4ECDC4] ring-opacity-30":""}`,children:[r.jsx(dS,{phaseId:p,phaseConfig:f,timer:g,duration:x,elapsedTime:v,isExpanded:b,onToggleExpanded:()=>d(p)}),b&&r.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[r.jsx(pS,{}),p==="autoclave"&&r.jsx(mS,{selectedCycle:a,onCycleSelect:i}),r.jsx(uS,{phaseId:p,timer:g,onPauseTimer:c,onStopTimer:u,onMoveToNextPhase:h}),r.jsx(hS,{duration:x||0,isRunning:(g==null?void 0:g.isRunning)||!1,timer:g})]})]},p)})})]})});lm.displayName="TimerDisplay";const fS=m.memo(function({activeTab:e,tabs:t,SterilizationAnalyticsComponent:n,onTabChange:a,getTabButtonClasses:i}){return r.jsxs("div",{className:"bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsx("div",{className:"border-b border-gray-200",children:r.jsx("div",{className:"flex flex-wrap gap-2 p-4",children:t.map(c=>r.jsxs("button",{onClick:()=>a(c.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${i(e===c.id)}`,children:[r.jsx(I,{path:c.icon,size:.8}),c.label]},c.id))})}),r.jsxs("div",{className:"p-6",children:[e==="timers"&&r.jsx(lm,{}),e==="analytics"&&r.jsx(r.Fragment,{children:n&&r.jsx(n,{})}),e==="logs"&&r.jsx(m.Suspense,{fallback:r.jsx(js,{}),children:r.jsx(Fw,{})})]})]})}),gS=({isOpen:s,operatorName:e,onOperatorNameChange:t,onOperatorNameKeyPress:n,onStartCycle:a,onClose:i,getStartCycleButtonState:c})=>s?Ts.createPortal(r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999]",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},children:r.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Start New Sterilization Cycle"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator Name"}),r.jsx("input",{id:"operator-name",type:"text",value:e,onChange:t,placeholder:"Enter operator name...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",onKeyPress:n})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:a,disabled:c(e).disabled,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${c(e).className}`,children:"Start Cycle"}),r.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"})]})]})]})}),document.body):null;var yS=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const vS=({isOpen:s,onClose:e})=>{const{lastGeneratedCode:t,setShowBatchCodeModal:n}=Q(),[a,i]=m.useState(!1);m.useEffect(()=>{s||n(!1)},[s,n]);const c=()=>{n(!1),e()},l=()=>yS(null,null,function*(){if(t!=null&&t.code)try{yield navigator.clipboard.writeText(t.code),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error(d)}}),o=()=>{const d=window.open("","_blank");d&&t&&(d.document.write(`
        <html>
          <head>
            <title>Batch Code - ${t.code}</title>
            <style>
              body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
              .batch-code { font-size: 48px; font-weight: bold; margin: 20px 0; }
              .info { font-size: 16px; margin: 10px 0; }
              .instructions { text-align: left; margin: 20px 0; }
              @media print { body { margin: 0; } }
            </style>
          </head>
          <body>
            <h1>Batch Code</h1>
            <div class="batch-code">${t.code}</div>
            <div class="info">
              <p><strong>Generated:</strong> ${t.generatedAt.toLocaleString()}</p>
              <p><strong>Operator:</strong> ${t.operator}</p>
              <p><strong>Tools:</strong> ${t.toolCount}</p>
            </div>
            <div class="instructions">
              <h3>Instructions:</h3>
              <ol>
                <li>Write this batch code clearly on the package</li>
                <li>Add today's date</li>
                <li>Add your name (${t.operator})</li>
                <li>Place package in autoclave</li>
              </ol>
            </div>
          </body>
        </html>
      `),d.document.close(),d.print())};return!s||!t?null:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(ue,{path:Qh,size:1.5,className:"text-purple-600"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Batch Code Generated"})]}),r.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(ue,{path:Pe,size:1.5})})]}),r.jsxs("div",{className:"text-center mb-6",children:[r.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-4",children:[r.jsx("p",{className:"text-sm text-purple-600 mb-2",children:"Your Batch Code"}),r.jsx("div",{className:"text-3xl font-bold text-purple-800 font-mono tracking-wider",children:t.code})]}),r.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Generated:"})," ",t.generatedAt.toLocaleString()]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Operator:"})," ",t.operator]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Tools:"})," ",t.toolCount]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Type:"})," ",t.isSingleTool?"Single Tool":"Batch"]})]})]}),r.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Instructions"}),r.jsxs("ol",{className:"text-sm text-blue-700 space-y-2",children:[r.jsxs("li",{className:"flex items-start",children:[r.jsx("span",{className:"font-bold mr-2",children:"1."}),r.jsx("span",{children:"Write this batch code clearly on the package"})]}),r.jsxs("li",{className:"flex items-start",children:[r.jsx("span",{className:"font-bold mr-2",children:"2."}),r.jsxs("span",{children:["Add today's date: ",new Date().toLocaleDateString()]})]}),r.jsxs("li",{className:"flex items-start",children:[r.jsx("span",{className:"font-bold mr-2",children:"3."}),r.jsxs("span",{children:["Add your name: ",t.operator]})]}),r.jsxs("li",{className:"flex items-start",children:[r.jsx("span",{className:"font-bold mr-2",children:"4."}),r.jsx("span",{children:"Place package in autoclave for sterilization"})]})]})]}),r.jsxs("div",{className:"flex space-x-3",children:[r.jsxs("button",{onClick:l,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[r.jsx(ue,{path:uu,size:1}),r.jsx("span",{children:a?"Copied!":"Copy Code"})]}),r.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[r.jsx(ue,{path:eu,size:1}),r.jsx("span",{children:"Print"})]})]}),r.jsx("div",{className:"mt-4",children:r.jsx("button",{onClick:c,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Done"})}),r.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:r.jsxs("p",{className:"text-sm text-yellow-800",children:[r.jsx("strong",{children:"Important:"})," This batch code is now tracked in the system. If a BI failure occurs, all tools in this batch will be affected."]})})]})})},cm=m.memo(({SterilizationAnalyticsComponent:s})=>{const{startNewCycle:e,recordBITestResult:t,lastBITestDate:n,biTestOptedOut:a,setBiTestOptedOut:i,enforceBI:c,showBatchCodeModal:l,setShowBatchCodeModal:o}=Q(),{tabs:d,validateOperatorName:u,getTabButtonClasses:h,getStartCycleButtonState:p}=Rw(),{activeTab:f,showNewCycleModal:y,operatorName:g,handleTabChange:x,handleOperatorNameChange:b,handleCloseNewCycleModal:v,resetOperatorName:w}=Aw();m.useEffect(()=>{let j=null,E=!0;function D(){E&&(Pw(n),j=setTimeout(D,3e5))}return D(),()=>{E=!1,j&&(clearTimeout(j),j=null)}},[n]);const S=m.useCallback(j=>{t(j)},[t]),T=m.useCallback(()=>{u(g)&&(e(g.trim()),v(),w())},[g,e,u,v,w]),C=m.useCallback(()=>{i(!0)},[i]);m.useCallback(()=>{},[]);const P=m.useMemo(()=>{if(!c||a)return!1;const j=new Date().toDateString();return(n?new Date(n).toDateString():null)!==j},[c,a,n]),N=m.useCallback(j=>{j.key==="Enter"&&T()},[T]);return r.jsxs("div",{className:"space-y-6",children:[r.jsx(Dw,{isVisible:P,onComplete:S,onOptOut:C}),r.jsx(om,{}),r.jsx(fS,{activeTab:f,tabs:d,SterilizationAnalyticsComponent:s,onTabChange:x,getTabButtonClasses:h}),r.jsx(gS,{isOpen:y,operatorName:g,onOperatorNameChange:b,onOperatorNameKeyPress:N,onClose:v,onStartCycle:T,getStartCycleButtonState:p}),r.jsx(vS,{isOpen:l,onClose:()=>o(!1)})]})});cm.displayName="SterilizationDashboard";const uc=()=>r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}),dm=m.memo(()=>r.jsx(qr,{FallbackComponent:uc,children:r.jsx(Hr,{children:r.jsx("div",{className:"p-6 space-y-6",children:r.jsx(qr,{FallbackComponent:uc,children:r.jsx(cm,{SterilizationAnalyticsComponent:bw})})})})}));dm.displayName="Sterilization";class xS{static scanTool(e,t){const n=t.map(c=>c.barcode),a=n[Math.floor(Math.random()*n.length)],i=t.find(c=>c.barcode===a);return i?{success:!0,message:`Successfully processed ${i.name} for ${e} workflow`,tool:i}:{success:!1,message:"No tools available for scanning"}}}var bS=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const _S=()=>{const[s,e]=m.useState(!1),[t,n]=m.useState(""),[a,i]=m.useState(null),[c,l]=m.useState(""),{availableTools:o,addToolToCycle:d}=Q();return{isScanning:s,scannedCode:t,scanResult:a,scanMessage:c,simulateScan:(h,p,f=!1)=>bS(null,null,function*(){var y;e(!0),l(`Scanning tool for ${h} workflow...`);try{if(h==="clean"){const{data:g}=yield _.from("tools").select("barcode").eq("status","clean").eq("facility_id","550e8400-e29b-41d4-a716-446655440000").limit(10);let x;!g||g.length===0?(console.log("🧪 No clean tools found in database, using mock data for testing"),x="TEST-CLEAN-001"):x=g[Math.floor(Math.random()*g.length)].barcode;const b=yield Oi.scanToolForCleanWorkflow(x);n(((y=b.tool)==null?void 0:y.barcode)||""),b.success&&b.tool?(d(b.tool.id),i("success"),l(b.message),f||setTimeout(p,2e3)):(i("error"),l(b.message))}else{setTimeout(()=>{var g;const x=xS.scanTool(h,o);n(((g=x.tool)==null?void 0:g.barcode)||""),x.success&&x.tool?(d(x.tool.id),i("success"),l(x.message),f||setTimeout(p,2e3)):(i("error"),l(x.message)),e(!1)},1e3);return}}catch(g){console.error("Error during scan:",g),i("error"),l("An unexpected error occurred during scanning.")}finally{e(!1)}})}};var wS=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const SS=({scannedData:s,toolId:e,onClose:t,batchMode:n=!1})=>{const{availableTools:a,currentCycle:i,addPhaseToCycle:c,startPhase:l,addToolToCycle:o}=Q(),[d,u]=m.useState(!1),[h,p]=m.useState(null),[f,y]=m.useState([]),[g,x]=m.useState({show:!1,tool:null}),b=m.useCallback(k=>a.find($=>$.barcode===k),[a]),w=m.useCallback(()=>e?a.find(k=>k.id===e):b(s),[e,a,b,s])(),S=m.useCallback(()=>!i||!w?!1:i.tools.includes(w.id),[i,w]),T=m.useCallback(()=>wS(null,null,function*(){u(!0),p(null);try{yield new Promise(H=>setTimeout(H,1e3));const k=s||"FORC001",$=b(k);if(!$){p({type:"error",text:`Tool with barcode "${k}" not found in inventory.`});return}if(f.find(H=>H.id===$.id)){p({type:"error",text:`Tool "${$.name}" already scanned.`});return}const U=Q.getState();if(U.checkToolReplacementNeeded&&U.checkToolReplacementNeeded($.id)){x({show:!0,tool:$});return}y(H=>{const A=[...H,$];return p(n?{type:"success",text:`Tool "${$.name}" added to batch. Total: ${A.length} tools.`}:{type:"success",text:`Tool "${$.name}" scanned successfully. Ready for sterilization.`}),A})}catch(k){p({type:"error",text:"Failed to scan tool. Please try again."}),console.error("Scan error:",k)}finally{u(!1)}}),[b,n,f,s]),C=m.useCallback(()=>{if(!i)return null;const k=i.phases.find(U=>U.isActive),$=i.tools.length;return{cycleId:i.id,operator:i.operator,totalTools:$,activePhase:(k==null?void 0:k.name)||"No active phase",startTime:i.startTime}},[i]),P=m.useCallback(()=>{const k=(i==null?void 0:i.phases.some(A=>A.id==="bath1"&&A.isActive))||!1,{getTimer:$}=Is.getState(),U=$("bath1"),H=(U==null?void 0:U.isRunning)||!1;return k||H},[i]),N=m.useCallback(()=>{y([]),p(null)},[]),j=m.useCallback(()=>{x({show:!1,tool:null}),p({type:"error",text:"Tool marked for replacement. Please replace with a new tool before continuing."})},[]),E=m.useCallback(()=>{g.tool&&(y(k=>[...k,g.tool]),p({type:"success",text:`Tool "${g.tool.name}" added despite needing replacement.`})),x({show:!1,tool:null})},[g.tool]),D=m.useCallback(()=>{x({show:!1,tool:null})},[]),O=m.useCallback(k=>{if(!k||k.length===0){console.warn("⚠️ handleSendToBath1 called with no tools.");return}if(P()){p({type:"error",text:"⚠️ Bath 1 timer is already in process. Please wait for the current phase to complete before starting a new one."});return}try{k.forEach(U=>{o(U.id);const H=Q.getState();H.updateToolStatus&&H.updateToolStatus(U.id,"bath1")}),c("bath1",me.bath1.name,me.bath1.duration*60),l("bath1");const{startTimer:$}=Is.getState();$("bath1",me.bath1.duration*60),p({type:"success",text:`🚀 ${k.length} tools sent to Bath 1! Phase timer started.`}),y([]),t&&t()}catch($){console.error("❌ Error in handleSendToBath1:",$),p({type:"error",text:"Failed to start Bath 1 phase. Please try again."})}},[o,c,l,p,t,P]);return m.useEffect(()=>{if(h){const k=setTimeout(()=>{p(null)},5e3);return()=>clearTimeout(k)}},[h]),{tool:w,currentCycle:i,isScanning:d,scanMessage:h,scannedTools:f,batchMode:n,handleScanTool:T,handleSendToBath1:O,clearScannedTools:N,isToolInCycle:S(),isBath1Active:P(),cycleStatus:C(),replacementAlert:g,handleReplaceTool:j,handleContinueAnyway:E,handleDismissReplacementAlert:D}},CS=()=>{const{setWorkflowType:s,setScannedData:e,scannedData:t}=Q(),{isScanning:n,scanResult:a,scanMessage:i,simulateScan:c}=_S(),[l,o]=m.useState(""),[d,u]=m.useState(!1),[h,p]=m.useState("single"),f=A=>{console.log("ScannerPage: Workflow selected:",A),o(A),s(A),u(!1)},y=()=>{console.log("🔧 handleBackToWorkflow called"),o(""),s(""),e(""),u(!1),console.log("🔧 Returning to workflow selection...")},{scannedTools:g,handleSendToBath1:x,handleScanTool:b,scanMessage:v,isBath1Active:w,clearScannedTools:S,replacementAlert:T,handleReplaceTool:C,handleContinueAnyway:P,handleDismissReplacementAlert:N}=SS({scannedData:t||"",onClose:()=>{console.log("🔧 Dirty workflow onClose called - navigating back to sterilization page"),window.history.back()},batchMode:h==="batch"});return{selectedWorkflow:l,showWorkflowResult:d,scanMode:h,isScanning:n,scanResult:a,scanMessage:i,scannedData:t,scannedTools:g,dirtyScanMessage:v,isBath1Active:w,replacementAlert:T,handleWorkflowSelect:f,handleBackToWorkflow:y,handleScan:()=>{l&&(l==="clean"?c(l,()=>{setTimeout(()=>{u(!0)},1e3)},!1):c(l,()=>{},!1))},handleCloseWorkflow:()=>{u(!1),y()},handleReceiptUploadSuccess:A=>{console.log("Receipt uploaded successfully:",A),window.history.back()},handleReceiptUploadCancel:()=>{y()},handleDeleteTool:A=>{console.log("Delete tool:",A)},handleCancelAll:()=>{S(),console.log("Cancel all tools")},handleSendScannedToBath1:()=>{console.log("🧪 scannedTools.length:",g.length),console.log("🧪 handleSendToBath1:",typeof x),x(g)},handleScanModeChange:A=>{p(A),S()},handleScanTool:b,handleReplaceTool:C,handleContinueAnyway:P,handleDismissReplacementAlert:N,clearScannedTools:S}},um=[{id:"clean",name:"Clean Tool",icon:Yh,color:"green",description:"Ready to use on patients",statusRequirement:"Complete → Dirty"},{id:"dirty",name:"Dirty Tool",icon:Jh,color:"orange",description:"Ready for cleaning process",statusRequirement:"Dirty → Clean"},{id:"problem",name:"Tool Problem",icon:de,color:"red",description:"Report tool issues or problems",statusRequirement:"Any status → Problem"},{id:"import",name:"Import Autoclave Receipt",icon:Ue,color:"blue",description:"Import physical autoclave cycle documentation",statusRequirement:"Documentation"},{id:"packaging",name:"Packaging Workflow",icon:lr,color:"purple",description:"Tools that are ready for packaging",statusRequirement:"Complete → Packaged"}],jS=s=>um.find(e=>e.id===s),NS=s=>({green:"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",orange:"border-orange-200 hover:border-orange-300 bg-orange-50 hover:bg-orange-100",blue:"border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",purple:"border-purple-200 hover:border-purple-300 bg-purple-50 hover:bg-purple-100",red:"border-red-200 hover:border-red-300 bg-red-50 hover:bg-red-100"})[s],IS=s=>({green:"bg-green-100",orange:"bg-orange-100",blue:"bg-blue-100",purple:"bg-purple-100",red:"bg-red-100"})[s],TS=s=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[s],ES=s=>({green:"text-green-800",orange:"text-orange-800",blue:"text-blue-800",purple:"text-purple-800",red:"text-red-800"})[s],kS=s=>({green:"text-green-600",orange:"text-orange-600",blue:"text-blue-600",purple:"text-purple-600",red:"text-red-600"})[s],DS=s=>({green:"text-green-700",orange:"text-orange-700",blue:"text-blue-700",purple:"text-purple-700",red:"text-red-700"})[s],PS=({workflow:s,onClick:e})=>r.jsx("button",{onClick:()=>e(s.id),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${NS(s.color)}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${IS(s.color)}`,children:r.jsx(I,{path:s.icon,size:1.2,className:TS(s.color)})}),r.jsxs("div",{children:[r.jsx("h4",{className:`font-semibold text-sm ${ES(s.color)}`,children:s.name}),r.jsx("p",{className:`text-xs ${kS(s.color)}`,children:s.description}),r.jsx("p",{className:`text-xs mt-1 font-medium ${DS(s.color)}`,children:s.statusRequirement})]})]})}),RS=({onWorkflowSelect:s})=>r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Select Workflow"}),r.jsx("div",{className:"space-y-3",children:um.map(e=>r.jsx(PS,{workflow:e,onClick:s},e.id))})]}),mc=({workflowId:s,color:e="blue"})=>{const t=jS(s);if(!t)return null;const n=()=>({blue:"bg-blue-50 border-blue-200 text-blue-800 text-blue-600",orange:"bg-orange-50 border-orange-200 text-orange-800 text-orange-600",purple:"bg-purple-50 border-purple-200 text-purple-800 text-purple-600"})[e],[a,i,c,l]=n().split(" ");return r.jsxs("div",{className:`${a} border ${i} rounded-lg p-3`,children:[r.jsxs("h3",{className:`font-semibold ${c} text-sm mb-1`,children:[t.name," Workflow"]}),r.jsx("p",{className:`${l} text-xs`,children:t.description}),r.jsxs("div",{className:"mt-2 text-xs text-blue-500",children:[r.jsx("strong",{children:"Tool Status:"})," ",t.statusRequirement]})]})},hc=({isScanning:s,scanMessage:e,onScan:t,size:n="large",showCameraStatus:a=!0})=>{const i=n==="large",c=i?"w-48 h-32":"w-32 h-24",l=i?"w-4 h-4":"w-3 h-3",o=i?"p-4":"p-3",d=i?1.5:1.2,u=i?"w-2 h-2":"w-1.5 h-1.5",h="text-xs",p=i?"bottom-4 right-4":"bottom-2 right-2",f=i?"h-48":"h-32",y=i?"text-lg":"text-base",g=i?"text-sm":"text-xs",x=()=>e?typeof e=="string"?e:e.text:null,b=()=>e?typeof e=="string"?"success":e.type:null;return r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsxs("div",{className:"text-center space-y-3",children:[r.jsxs("div",{className:`relative bg-black rounded-lg ${f} flex items-center justify-center`,children:[r.jsxs("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] ${c} rounded-lg`,children:[r.jsx("div",{className:`absolute top-0 left-0 ${l} border-t-2 border-l-2 border-[#4ECDC4] rounded-tl`}),r.jsx("div",{className:`absolute top-0 right-0 ${l} border-t-2 border-r-2 border-[#4ECDC4] rounded-tr`}),r.jsx("div",{className:`absolute bottom-0 left-0 ${l} border-b-2 border-l-2 border-[#4ECDC4] rounded-bl`}),r.jsx("div",{className:`absolute bottom-0 right-0 ${l} border-b-2 border-r-2 border-[#4ECDC4] rounded-br`})]}),a&&r.jsxs("div",{className:`absolute ${p} flex items-center`,children:[r.jsx("div",{className:`${u} rounded-full bg-red-500 mr-1 animate-pulse`}),r.jsx("span",{className:`text-white ${h}`,children:"Camera active"})]}),r.jsx("button",{onClick:t,disabled:s,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 ${o} rounded-full transition-all duration-200 ${s?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:r.jsx(I,{path:qe,size:d,className:`${s?"text-gray-400":"text-white"}`})})]}),r.jsxs("div",{children:[r.jsx("h3",{className:`${y} font-medium text-gray-800 mb-1`,children:s?"Scanning...":"Click to Scan"}),r.jsx("p",{className:`text-gray-600 ${g}`,children:s?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),e&&r.jsx(se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-3 p-3 rounded-lg ${b()==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:qe,size:.8,className:b()==="success"?"text-green-600":"text-red-600"}),r.jsx("span",{className:`font-medium text-sm ${b()==="success"?"text-green-800":"text-red-800"}`,children:x()})]})})]})};var AS=Object.defineProperty,OS=Object.defineProperties,$S=Object.getOwnPropertyDescriptors,pc=Object.getOwnPropertySymbols,MS=Object.prototype.hasOwnProperty,FS=Object.prototype.propertyIsEnumerable,fc=(s,e,t)=>e in s?AS(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,gc=(s,e)=>{for(var t in e||(e={}))MS.call(e,t)&&fc(s,t,e[t]);if(pc)for(var t of pc(e))FS.call(e,t)&&fc(s,t,e[t]);return s},zS=(s,e)=>OS(s,$S(e)),Pt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class jr{static compressImage(e,t=1200,n=.8){return Pt(this,null,function*(){return new Promise((a,i)=>{const c=document.createElement("canvas"),l=c.getContext("2d"),o=new Image;o.onload=()=>{const d=Math.min(t/o.width,t/o.height),u=o.width*d,h=o.height*d;c.width=u,c.height=h,l==null||l.drawImage(o,0,0,u,h),c.toBlob(p=>{if(p){const f=new File([p],e.name,{type:"image/jpeg",lastModified:Date.now()});a(f)}else i(new Error("Failed to compress image"))},"image/jpeg",n)},o.onerror=()=>i(new Error("Failed to load image")),o.src=URL.createObjectURL(e)})})}static uploadReceipt(e,t){return Pt(this,null,function*(){try{const{data:{user:n},error:a}=yield _.auth.getUser();if(a||!n)throw new Error("User not authenticated. Please log in again.");const{data:i,error:c}=yield _.from("users").select("facility_id").eq("id",n.id).single();if(c||!(i!=null&&i.facility_id))throw new Error("User facility not found");const l=yield this.compressImage(e.photoFile),o=new Date().toISOString().replace(/[:.]/g,"-"),d=`${n.id}/autoclave-receipt-${e.batchCode}-${o}.jpg`,{error:u}=yield _.storage.from("autoclave-receipts").upload(d,l,{cacheControl:"3600",upsert:!1});if(u)throw new Error(`Failed to upload file: ${u.message}`);const{data:h}=_.storage.from("autoclave-receipts").getPublicUrl(d),p=24,f=new Date;f.setMonth(f.getMonth()+p);const{data:y,error:g}=yield _.from("autoclave_receipts").insert({autoclave_id:null,receipt_number:e.batchCode}).select().single();if(g)throw yield _.storage.from("autoclave-receipts").remove([d]),new Error(`Failed to save receipt metadata: ${g.message}`);return this.mapDatabaseReceipt(y)}catch(n){throw console.error("Error uploading autoclave receipt:",n),n}})}static getReceiptsByBatch(e){return Pt(this,null,function*(){try{const{data:t,error:n}=yield _.from("autoclave_receipts").select("*").eq("receipt_number",e).order("created_at",{ascending:!1});if(n)throw new Error(`Failed to fetch receipts: ${n.message}`);return t.map(this.mapDatabaseReceipt)}catch(t){throw console.error("Error fetching receipts:",t),t}})}static getAllReceipts(e=50,t=0){return Pt(this,null,function*(){try{const{data:n,error:a}=yield _.from("autoclave_receipts").select("*").order("created_at",{ascending:!1}).range(t,t+e-1);if(a)throw new Error(`Failed to fetch receipts: ${a.message}`);return n.map(this.mapDatabaseReceipt)}catch(n){throw console.error("Error fetching all receipts:",n),n}})}static deleteReceipt(e){return Pt(this,null,function*(){try{const{data:t,error:n}=yield _.from("autoclave_receipts").select("id").eq("id",e).single();if(n)throw new Error(`Failed to fetch receipt: ${n.message}`);const{error:a}=yield _.from("autoclave_receipts").delete().eq("id",e);if(a)throw new Error(`Failed to delete receipt: ${a.message}`)}catch(t){throw console.error("Error deleting receipt:",t),t}})}static getFacilitySettings(){return Pt(this,null,function*(){return{id:"default",facilityId:void 0,autoclaveHasPrinter:!1,receiptRetentionMonths:24,createdAt:new Date,updatedAt:new Date}})}static updateFacilitySettings(e){return Pt(this,null,function*(){const t=yield this.getFacilitySettings();return zS(gc(gc({},t),e),{updatedAt:new Date})})}static cleanupExpiredReceipts(){return Pt(this,null,function*(){try{const{data:e,error:t}=yield _.from("autoclave_receipts").select("id").limit(0);if(t)throw new Error(`Failed to fetch expired receipts: ${t.message}`);if(!e||e.length===0)return 0;const n=e.map(i=>i.id),{error:a}=yield _.from("autoclave_receipts").delete().in("id",n);if(a)throw new Error(`Failed to delete expired receipts: ${a.message}`);return e.length}catch(e){throw console.error("Error cleaning up expired receipts:",e),e}})}static mapDatabaseReceipt(e){return{id:e.id,batchId:"",batchCode:e.receipt_number,cycleNumber:void 0,photoUrl:"",photoFilename:"",photoSize:0,temperatureEvidence:void 0,uploadedBy:"",uploadedAt:new Date(e.created_at),retentionUntil:new Date,isExpired:!1,createdAt:new Date(e.created_at),updatedAt:new Date(e.created_at)}}static mapDatabaseFacilitySettings(e){return{id:e.id,facilityId:e.facility_id,autoclaveHasPrinter:e.autoclave_has_printer,receiptRetentionMonths:e.receipt_retention_months,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}}var Nr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const LS=()=>{const[s,e]=m.useState([]),[t,n]=m.useState(null),[a,i]=m.useState(!1),[c,l]=m.useState(null),o=m.useCallback((x,b)=>Nr(null,null,function*(){i(!0),l(null);try{const v=yield jr.uploadReceipt(x,b);return e(w=>[v,...w]),v}catch(v){const w=v instanceof Error?v.message:"Failed to upload receipt";throw l(w),v}finally{i(!1)}}),[]),d=m.useCallback(x=>Nr(null,null,function*(){i(!0),l(null);try{const b=yield jr.getReceiptsByBatch(x);return e(b),b}catch(b){const v=b instanceof Error?b.message:"Failed to load receipts";throw l(v),b}finally{i(!1)}}),[]),u=m.useCallback((x=50,b=0)=>Nr(null,null,function*(){i(!0),l(null);try{const v=yield jr.getAllReceipts(x,b);return e(v),v}catch(v){const w=v instanceof Error?v.message:"Failed to load receipts";throw l(w),v}finally{i(!1)}}),[]),h=m.useCallback(x=>Nr(null,null,function*(){i(!0),l(null);try{yield jr.deleteReceipt(x),e(b=>b.filter(v=>v.id!==x))}catch(b){const v=b instanceof Error?b.message:"Failed to delete receipt";throw l(v),b}finally{i(!1)}}),[]),p=m.useCallback(()=>Nr(null,null,function*(){i(!0),l(null);try{const x=yield jr.getFacilitySettings();return n(x),x}catch(x){const b=x instanceof Error?x.message:"Failed to load facility settings";throw l(b),x}finally{i(!1)}}),[]),f=m.useCallback(x=>Nr(null,null,function*(){i(!0),l(null);try{const b=yield jr.updateFacilitySettings(x);return n(b),b}catch(b){const v=b instanceof Error?b.message:"Failed to update facility settings";throw l(v),b}finally{i(!1)}}),[]),y=m.useCallback(()=>{l(null)},[]),g=m.useCallback(()=>{e([])},[]);return{receipts:s,facilitySettings:t,loading:a,error:c,uploadReceipt:o,loadReceiptsByBatch:d,loadAllReceipts:u,deleteReceipt:h,loadFacilitySettings:p,updateFacilitySettings:f,clearError:y,clearReceipts:g}};var BS=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const qS=()=>{const s=navigator.userAgent.toLowerCase(),t=["android","iphone","ipad","ipod","blackberry","windows phone","mobile","tablet"].some(c=>s.includes(c)),n="ontouchstart"in window||navigator.maxTouchPoints>0,a=window.innerWidth<=768,i="orientation"in window||"deviceorientation"in window;return t||n&&a||i},US=()=>BS(null,null,function*(){try{return!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?!1:(yield navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput").length>0}catch(s){return console.warn("Error checking camera access:",s),!1}});var HS=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const VS=({isMobile:s,hasCamera:e,onPhotoCapture:t})=>{const[n,a]=m.useState(!1),i=m.useRef(null),c=m.useRef(null),l=m.useRef(null),o=m.useCallback(()=>HS(null,null,function*(){if(!s){alert("Camera access is only available on mobile devices. Please use the file upload option instead.");return}if(!e){alert("No camera detected on this device. Please use file upload instead.");return}try{const h=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});i.current&&(i.current.srcObject=h,l.current=h,a(!0))}catch(h){console.error(h),alert("Unable to access camera. Please use file upload instead.")}}),[s,e]),d=m.useCallback(()=>{l.current&&(l.current.getTracks().forEach(h=>h.stop()),l.current=null),a(!1)},[]),u=m.useCallback(()=>{if(i.current&&c.current){const h=i.current,p=c.current,f=p.getContext("2d");f&&(p.width=h.videoWidth,p.height=h.videoHeight,f.drawImage(h,0,0),p.toBlob(y=>{if(y){const g=new File([y],`receipt-${Date.now()}.jpg`,{type:"image/jpeg"}),x=URL.createObjectURL(y);t(g,x),d()}},"image/jpeg",.8))}},[t,d]);return!s||!e?null:r.jsxs(r.Fragment,{children:[r.jsxs("button",{type:"button",onClick:o,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[r.jsx(I,{path:Xh,size:1.2}),r.jsx("span",{children:"Take Photo"})]}),n&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-sm w-full mx-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,className:"w-full h-64 object-cover rounded-md",children:r.jsx("track",{kind:"captions"})}),r.jsx("canvas",{ref:c,className:"hidden"})]}),r.jsxs("div",{className:"flex space-x-2 mt-4",children:[r.jsxs("button",{type:"button",onClick:u,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[r.jsx(I,{path:bi,size:1}),r.jsx("span",{children:"Capture"})]}),r.jsxs("button",{type:"button",onClick:d,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[r.jsx(I,{path:Pe,size:1}),r.jsx("span",{children:"Cancel"})]})]})]})})]})},WS=({photoFile:s,photoPreview:e,isMobile:t,onFileSelect:n,onClearPhoto:a})=>{const i=m.useRef(null),c=m.useCallback(o=>{var d;const u=(d=o.target.files)==null?void 0:d[0];if(u&&u.type.startsWith("image/")){const h=new FileReader;h.onload=p=>{var f;const y=(f=p.target)==null?void 0:f.result;n(u,y)},h.readAsDataURL(u)}},[n]),l=m.useCallback(()=>{var o;(o=i.current)==null||o.click()},[]);return r.jsxs("div",{className:"space-y-3",children:[r.jsx("label",{htmlFor:"photo-upload",className:"block text-sm font-medium text-gray-700",children:"Receipt Photo *"}),e?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"relative",children:[r.jsx("img",{src:e,alt:"Receipt preview",className:"w-full h-48 object-cover rounded-md border border-gray-300"}),r.jsx("button",{type:"button",onClick:a,className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:r.jsx(I,{path:Pe,size:.8})})]}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Photo captured: ",(s==null?void 0:s.name)||"Receipt photo"]}),r.jsx("p",{className:"text-xs text-blue-600",children:"Note: Photos are uploaded directly to Cliniio and not stored on your device"})]}):r.jsxs("div",{className:"space-y-2",children:[!t&&r.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-md mb-2",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(I,{path:Bn,size:1,className:"text-yellow-600"}),r.jsx("p",{className:"text-sm text-yellow-800",children:"Camera access is only available on mobile devices. Please use the file upload option below."})]})}),r.jsxs("button",{type:"button",onClick:l,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:[r.jsx(I,{path:Mn,size:1.2}),r.jsx("span",{children:"Choose File"})]}),r.jsx("input",{ref:i,id:"photo-upload",type:"file",accept:"image/*",onChange:c,className:"hidden"}),r.jsx("p",{className:"text-xs text-blue-600 text-center",children:"Photos are uploaded directly to Cliniio and not stored on your device"})]})]})},GS=({cycleNumber:s,temperatureEvidence:e,onCycleNumberChange:t,onTemperatureEvidenceChange:n})=>r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"cycleNumber",className:"block text-sm font-medium text-gray-700",children:"Cycle Number (Optional)"}),r.jsx("input",{type:"text",id:"cycleNumber",value:s,onChange:a=>t(a.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., CYC-2024-001"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"temperatureEvidence",className:"block text-sm font-medium text-gray-700",children:"Temperature Evidence (Optional)"}),r.jsx("textarea",{id:"temperatureEvidence",value:e,onChange:a=>n(a.target.value),rows:3,className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Temperature reached 121°C for 4 minutes"})]})]});var yc=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const mm=({batchCode:s,operator:e,onSuccess:t,onCancel:n})=>{const{uploadReceipt:a,loading:i,error:c}=LS(),[l,o]=m.useState(null),[d,u]=m.useState(null),[h,p]=m.useState(""),[f,y]=m.useState(""),[g,x]=m.useState(!1),[b,v]=m.useState(!1),[w,S]=m.useState(null);m.useEffect(()=>{yc(null,null,function*(){const E=qS(),D=yield US();x(E),v(D)})},[]),m.useEffect(()=>()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d)},[d]);const T=m.useCallback((j,E)=>{o(j),u(E)},[]),C=m.useCallback((j,E)=>{o(j),u(E)},[]),P=m.useCallback(()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),o(null),u(null)},[d]),N=m.useCallback(j=>yc(null,null,function*(){if(j.preventDefault(),!l){alert("Please select or capture a photo of the receipt");return}try{const E={batchCode:s,cycleNumber:h||void 0,photoFile:l,temperatureEvidence:f||void 0};S("Compressing image for optimal storage...");const D=yield a(E,e);d&&d.startsWith("blob:")&&URL.revokeObjectURL(d);const O=D.photoSize<l.size?` (compressed from ${(l.size/1024).toFixed(1)}KB to ${(D.photoSize/1024).toFixed(1)}KB)`:"";S(`Receipt uploaded successfully!${O}`),t==null||t(D)}catch(E){console.error("Error uploading receipt:",E);const D=E instanceof Error?E.message:"Error uploading receipt";S(`Upload failed: ${D}`)}}),[l,s,h,f,a,e,t,d]);return r.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[r.jsx("div",{className:"mb-4",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Upload Autoclave Receipt"})}),r.jsxs("form",{onSubmit:N,className:"space-y-4",children:[r.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("span",{className:"font-medium",children:"Batch Code:"})," ",s]})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(VS,{isMobile:g,hasCamera:b,onPhotoCapture:T}),g&&b&&r.jsx("div",{className:"text-center text-gray-500 text-sm",children:"or"}),r.jsx(WS,{photoFile:l,photoPreview:d,isMobile:g,onFileSelect:C,onClearPhoto:P})]}),r.jsx(GS,{cycleNumber:h,temperatureEvidence:f,onCycleNumberChange:p,onTemperatureEvidenceChange:y}),c&&r.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:r.jsx("p",{className:"text-sm text-red-800",children:c})}),w&&r.jsx("div",{className:`p-3 rounded-md ${w.includes("successfully")?"bg-green-50 border border-green-200":w.includes("failed")?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"}`,children:r.jsx("p",{className:`text-sm ${w.includes("successfully")?"text-green-800":w.includes("failed")?"text-red-800":"text-blue-800"}`,children:w})}),r.jsx("button",{type:"submit",disabled:!l||i,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),r.jsx("span",{children:"Uploading..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(I,{path:Mn,size:1.2}),r.jsx("span",{children:"Upload Receipt"})]})})]}),r.jsx("div",{className:"flex justify-center pt-2",children:r.jsx("button",{onClick:n,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to Workflow Selection"})})]})},KS=[{type:"damaged",label:"Damaged",description:"Physical damage or broken parts"},{type:"improperly_cleaned",label:"Improperly Cleaned",description:"Rust, residue, or staining"},{type:"worn_out",label:"Worn Out",description:"Excessive wear or dull edges"},{type:"other",label:"Other",description:"Other issues not listed above"}],QS=({selectedProblemType:s,onProblemTypeSelect:e})=>r.jsx("div",{className:"space-y-3",children:KS.map(t=>r.jsx("button",{onClick:()=>e(t.type),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${s===t.type?"border-red-300 bg-red-50":"border-gray-200 hover:border-red-200 bg-white hover:bg-red-50"}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-800",children:t.label}),r.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}),s===t.type&&r.jsx(I,{path:bi,size:1,className:"text-red-600"})]})},t.type))}),YS=()=>{const[s,e]=m.useState(!1),t=m.useRef(null);return m.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition;t.current=new i,t.current.continuous=!1,t.current.interimResults=!1,t.current.lang="en-US",t.current.onresult=c=>{const l=c.results[0][0].transcript;return e(!1),l},t.current.onerror=c=>{console.error("Speech recognition error:",c.error),e(!1)},t.current.onend=()=>{e(!1)}}},[]),{isRecording:s,startRecording:i=>{t.current&&(e(!0),t.current.onresult=c=>{const l=c.results[0][0].transcript;i(l),e(!1)},t.current.start())},stopRecording:()=>{t.current&&t.current.stop()}}},JS=({value:s,onChange:e})=>{const{isRecording:t,startRecording:n,stopRecording:a}=YS(),i=()=>{t?a():n(c=>{e(c)})};return r.jsxs(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:[r.jsx("label",{htmlFor:"problem-description",className:"block text-sm font-medium text-gray-700",children:"Describe the problem"}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("textarea",{id:"problem-description",value:s,onChange:c=>e(c.target.value),placeholder:"Describe the issue...",className:"flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 resize-none",rows:3}),r.jsx("button",{onClick:i,className:`p-3 rounded-md transition-colors ${t?"bg-red-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:t?"Stop recording":"Voice input",children:r.jsx(I,{path:t?mu:si,size:1})})]}),t&&r.jsx("p",{className:"text-sm text-red-600",children:"Recording... Speak now"})]})};var XS=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const ZS=({onClose:s})=>{const[e,t]=m.useState(!1),[n,a]=m.useState(""),[i,c]=m.useState(null),[l,o]=m.useState(""),[d,u]=m.useState(!1),[h,p]=m.useState(null),[f,y]=m.useState(""),[g,x]=m.useState(!1),{availableTools:b,markToolAsProblem:v}=Q(),w=()=>{t(!0),o("Scanning tool..."),setTimeout(()=>{const T=b.filter(N=>N.barcode).map(N=>N.barcode);if(T.length===0){c("error"),o("No tools available for scanning"),t(!1);return}const C=T[Math.floor(Math.random()*T.length)],P=b.find(N=>N.barcode===C);P?(a(C),c("success"),o(`Successfully scanned ${P.name}`),u(!0)):(c("error"),o("Tool not found in system")),t(!1)},1e3)},S=()=>XS(null,null,function*(){if(!(!h||!n)){x(!0);try{const{data:{user:T},error:C}=yield _.auth.getUser();if(C||!T){o("Authentication error. Please log in again.");return}const P=yield Oi.scanToolForProblemWorkflow(n,h,f||"No additional notes provided",T.id);if(P.success){o(P.message);const N=b.find(j=>j.barcode===n);N&&(yield v(N.id,h,f)),setTimeout(()=>{s()},2e3)}else o(P.message)}catch(T){console.error("Error reporting tool problem:",T),o("Error reporting tool problem. Please try again.")}finally{x(!1)}}});return r.jsxs("div",{className:"space-y-6",children:[d?r.jsxs(se.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Report Tool Problem"}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Tool: ",n]})]}),r.jsx(QS,{selectedProblemType:h,onProblemTypeSelect:p}),h==="other"&&r.jsx(JS,{value:f,onChange:y}),r.jsxs("div",{className:"flex space-x-3 pt-4",children:[r.jsx("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Back"}),r.jsx("button",{onClick:S,disabled:!h||g,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:g?"Processing...":"Report Problem"})]}),r.jsx("div",{className:"flex justify-center pt-2",children:r.jsx("button",{onClick:s,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to Workflow Selection"})})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsx("h3",{className:"font-semibold text-red-800 mb-1",children:"Tool Problem Workflow"}),r.jsx("p",{className:"text-red-600 text-sm",children:"Report tool issues or problems"}),r.jsxs("div",{className:"mt-2 text-xs text-red-500",children:[r.jsx("strong",{children:"Tool Status:"})," Any status → Problem"]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[r.jsxs("div",{className:"text-center space-y-4",children:[r.jsxs("div",{className:"relative bg-black rounded-lg h-48 flex items-center justify-center",children:[r.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-32 rounded-lg",children:[r.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),r.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),r.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),r.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),r.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),r.jsx("button",{onClick:w,disabled:e,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${e?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:r.jsx(I,{path:qe,size:1.5,className:`${e?"text-gray-400":"text-white"}`})})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:e?"Scanning...":"Click to Scan"}),r.jsx("p",{className:"text-gray-600 text-sm",children:e?"Position barcode in camera view":"Use camera to scan tool barcode"})]})]}),i&&r.jsx(se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg ${i==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:qe,size:1,className:i==="success"?"text-green-600":"text-red-600"}),r.jsx("span",{className:`font-medium ${i==="success"?"text-green-800":"text-red-800"}`,children:l})]})})]})]}),!d&&r.jsx("div",{className:"flex justify-center pt-2",children:r.jsx("button",{onClick:s,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to Workflow Selection"})})]})},eC=()=>{const s=new Date,e=Math.floor((s.getTime()-new Date(s.getFullYear(),0,0).getTime())/(1e3*60*60*24)),t=e%26,n=e%9+1;return`${String.fromCharCode(65+t)}${n}`},tC=()=>eC();var rC=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const sC=({scannedData:s,toolId:e})=>{const{markToolAsDirty:t,availableTools:n}=Q(),[a]=m.useState(tC()),[i,c]=m.useState(!1),l=m.useCallback(u=>n.find(h=>h.barcode===u),[n]),o=m.useCallback(()=>e?n.find(u=>u.id===e):l(s),[e,n,l,s]);m.useEffect(()=>{const u=o();u&&u.currentPhase==="complete"&&s&&t(u.id)},[s,t,o,a]);const d=()=>rC(null,null,function*(){try{yield navigator.clipboard.writeText(a),c(!0),setTimeout(()=>c(!1),2e3)}catch(u){console.error("Failed to copy code:",u)}});return{tool:o(),traceabilityCode:a,copied:i,handleCopyCode:d}},nC=({traceabilityCode:s,copied:e,onCopyCode:t})=>r.jsx(se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[r.jsx(I,{path:ri,size:1.2,className:"text-blue-600"}),r.jsx("h4",{className:"text-lg font-semibold text-blue-800",children:"Traceability Code"})]}),r.jsx("p",{className:"text-blue-700 mb-4 text-sm",children:"Enter this code in your patient chart for compliance tracking"}),r.jsx("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 mb-4",children:r.jsx("div",{className:"text-4xl font-bold text-blue-800 tracking-wider font-mono",children:s})}),r.jsxs("button",{onClick:t,className:`flex items-center gap-2 mx-auto px-4 py-2 rounded-lg transition-all duration-200 ${e?"bg-green-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[r.jsx(I,{path:e?xt:uu,size:1}),r.jsx("span",{children:e?"Copied!":"Copy Code"})]}),r.jsxs("button",{onClick:()=>{const n=`EMR-${Date.now()}-${Math.random().toString(36).substr(2,6).toUpperCase()}`;navigator.clipboard.writeText(n),alert(`EMR ID generated and copied: ${n}`)},className:"flex items-center gap-2 mx-auto mt-3 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all duration-200",children:[r.jsx(I,{path:ri,size:1}),r.jsx("span",{children:"Generate EMR ID"})]})]})});function aC({scannedData:s,onClose:e,toolId:t}){const{tool:n,traceabilityCode:a,copied:i,handleCopyCode:c}=sC({scannedData:s,toolId:t});return r.jsxs("div",{className:"space-y-6",children:[r.jsxs(se.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(I,{path:xt,size:1.2,className:"text-green-600"}),r.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Tool Ready for Use"})]}),r.jsx("p",{className:"text-green-700 mb-2",children:n?`${n.name} is clean and ready for patient use.`:"Tool is clean and ready for patient use."}),r.jsxs("p",{className:"text-sm text-green-600",children:["Scanned: ",s]})]}),r.jsx(nC,{traceabilityCode:a,copied:i,onCopyCode:c}),r.jsxs(se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[r.jsx("h4",{className:"text-md font-semibold text-orange-800 mb-2",children:"Status Update"}),r.jsxs("p",{className:"text-orange-700 mb-2",children:[r.jsx("strong",{children:'Tool has been marked as "dirty"'})," and will need sterilization after use."]}),r.jsx("p",{className:"text-sm text-orange-600",children:"This change is automatically reflected in the inventory system."})]}),r.jsx(se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},className:"flex gap-2",children:r.jsx("button",{onClick:e,className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition-colors font-medium",children:"Confirm & Close"})})]})}var pn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const ie=s=>typeof s=="string"?s:"",fn=s=>typeof s=="number"?s:0,vc=s=>typeof s=="boolean"?s:!1,Ir=s=>{if(typeof s=="string"){const e=new Date(s);return isNaN(e.getTime())?void 0:e}};function iC(s){const e=Date.now().toString(36).toUpperCase(),t=Math.random().toString(36).substr(2,4).toUpperCase();return`PKG-${s.slice(0,4).toUpperCase()}-${e}-${t}`}class xc{static getToolsReadyForPackaging(){return pn(this,null,function*(){let t=null;for(let n=1;n<=3;n++)try{if(!gt.getState().authToken){if(n<3){yield new Promise(p=>setTimeout(p,n*500));continue}throw new Error("User not authenticated")}const{data:{user:i},error:c}=yield _.auth.getUser();if(c||!i)throw new Error("User not authenticated");const{data:l,error:o}=yield _.from("users").select("facility_id").eq("id",i.id).single();if(o||!l)throw new Error("User facility not found");const{data:d,error:u}=yield _.from("tools").select("*").eq("facility_id",l.facility_id).eq("status","active");if(u)throw new Error(`Failed to fetch tools: ${u.message}`);return(d||[]).map(p=>{const f=p;return{id:ie(f.tool_id),name:ie(f.tool_name),barcode:ie(f.barcode),type:ie(f.tool_type),category:ie(f.category)||"general",currentPhase:ie(f.current_phase),status:ie(f.current_phase)||"active",lastSterilized:ie(f.last_sterilized)||void 0,sterilizationCount:fn(f.sterilization_count),cycleCount:fn(f.cycle_count),location:"",manufacturer:"",model:"",serialNumber:"",maintenanceDueDate:null,notes:"",metadata:{}}})}catch(a){if(t=a instanceof Error?a:new Error("Unknown error"),n===3)throw console.error(`Error fetching tools ready for packaging (attempt ${n}/3):`,a),t;yield new Promise(i=>setTimeout(i,n*500))}throw t||new Error("Failed to fetch tools after all retries")})}static createPackage(e,t,n){return pn(this,null,function*(){try{if(!gt.getState().authToken)throw new Error("User not authenticated");const{FacilityService:i}=yield q(()=>Promise.resolve().then(()=>ge),void 0),c=yield i.getCurrentFacilityId(),{data:{user:l},error:o}=yield _.auth.getUser();if(o||!l)throw new Error("User not authenticated");const d=l.id,u=iC(c),{data:h,error:p}=yield _.from("sterilization_batches").insert({id:crypto.randomUUID(),cycle_id:crypto.randomUUID(),facility_id:c,batch_name:`Package ${u}`,batch_type:"routine",status:"packaged",package_id:u,package_type:t.packageType,package_size:t.packageSize,chemical_indicator_added:!0,packaged_by:d,packaged_at:new Date().toISOString(),requested_by:d,total_items:e.length,notes:t.notes}).select().single();if(p)throw new Error(`Failed to create package: ${p.message}`);const f=h,y=e.map(S=>({batch_id:f.id,tool_id:S,item_name:"Tool",item_type:"sterilization_tool",quantity:1,package_type:t.packageType,package_configuration:{package_size:t.packageSize,notes:t.notes}})),g=e.map(S=>Re.updateToolStatus(S,"active"));yield Promise.all(g),yield Re.touchTools(e);const b=yield new ru().getCurrentUser(),v=b?{id:b.facility_id}:null;yield _.from("audit_logs").insert({created_by:(b==null?void 0:b.id)||"unknown",facility_id:(v==null?void 0:v.id)||"unknown",module:"sterilization",action:"package_created",table_name:"sterilization_batches",record_id:f.id,old_values:{},new_values:{package_id:u,package_type:t.packageType,total_items:e.length,status:"packaged"},metadata:{package_id:u,tool_count:e.length,operator_name:n,package_info:t}});const w={id:ie(f.id),packageId:ie(f.package_id),batchName:ie(f.batch_name),batchType:ie(f.batch_type),status:ie(f.status),packageType:ie(f.package_type),packageSize:ie(f.package_size),chemicalIndicatorAdded:vc(f.chemical_indicator_added),packagedBy:ie(f.packaged_by),packagedAt:Ir(f.packaged_at)||new Date,totalItems:fn(f.total_items),createdAt:Ir(f.created_at)||new Date,updatedAt:Ir(f.updated_at)||new Date};return{success:!0,message:`Package ${u} created successfully with ${e.length} tools`,batch:w,packageId:ie(u)}}catch(a){return console.error("Error creating package:",a),{success:!1,message:a instanceof Error?a.message:"Failed to create package"}}})}static getPackageById(e){return pn(this,null,function*(){try{const{data:t,error:n}=yield _.from("sterilization_batches").select("*").eq("package_id",e).single();if(n||!t)return null;const a=t;return{id:ie(a.id),packageId:ie(a.package_id),batchName:ie(a.batch_name),batchType:ie(a.batch_type),status:ie(a.status),packageType:ie(a.package_type),packageSize:ie(a.package_size),chemicalIndicatorAdded:vc(a.chemical_indicator_added),packagedBy:ie(a.packaged_by),packagedAt:Ir(a.packaged_at)||new Date,totalItems:fn(a.total_items),createdAt:Ir(a.created_at)||new Date,updatedAt:Ir(a.updated_at)||new Date}}catch(t){return console.error("Error fetching package:",t),null}})}static getToolsInPackage(e){return pn(this,null,function*(){try{const{data:t,error:n}=yield _.from("sterilization_batches").select("id").eq("package_id",e).single();if(n||!t)throw new Error("Package not found");const a=t,{data:i,error:c}=yield _.from("sterilization_cycle_tools").select(`
          tool_id,
          tools (
            id,
            tool_name,
            barcode,
            tool_type,
            status,
            last_sterilized,
            sterilization_count,
            location,
            manufacturer,
            model,
            serial_number,
            maintenance_due_date,
            notes,
            metadata
          )
        `).eq("cycle_id",a.id);if(c)throw new Error(`Failed to fetch package tools: ${c.message}`);return(i||[]).map(l=>{const d=l.tools;if(!d)throw new Error("Tool data not found");return{id:d.id,name:d.tool_name,barcode:d.barcode,type:d.tool_type,category:d.category||"general",currentPhase:d.status,status:d.status||"available",location:d.location,manufacturer:d.manufacturer,model:d.model,serialNumber:d.serial_number,sterilizationCount:d.sterilization_count||0,cycleCount:d.cycle_count||0,lastSterilized:d.last_sterilized,maintenanceDueDate:d.maintenance_due_date?new Date(d.maintenance_due_date):null,notes:d.notes||"",metadata:d.metadata||{}}})}catch(t){throw console.error("Error fetching package tools:",t),t}})}}var gn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const oC=(s,e)=>{const t=Q(),[n,a]=m.useState(""),[i,c]=m.useState(""),[l,o]=m.useState(""),[d,u]=m.useState(null),[h,p]=m.useState({packageType:"",packageSize:"",notes:""}),[f,y]=m.useState(!1),[g,x]=m.useState(!1),[b,v]=m.useState([]),[w,S]=m.useState([]),T=(t==null?void 0:t.currentPackagingSession)||null,C=(t==null?void 0:t.currentBatch)||null,P=(t==null?void 0:t.batchLoading)||!1,N=m.useMemo(()=>(t==null?void 0:t.startPackagingSession)||(()=>{}),[t]),j=m.useMemo(()=>(t==null?void 0:t.endPackagingSession)||(()=>{}),[t]),E=m.useMemo(()=>(t==null?void 0:t.addToolToSession)||(()=>{}),[t]),D=m.useMemo(()=>(t==null?void 0:t.removeToolFromSession)||(()=>{}),[t]),O=m.useMemo(()=>(t==null?void 0:t.addToolToBatch)||(()=>{}),[t]),k=m.useMemo(()=>(t==null?void 0:t.removeToolFromBatch)||(()=>{}),[t]),$=m.useMemo(()=>(t==null?void 0:t.createBatch)||(()=>{}),[t]),U=m.useCallback(()=>gn(null,null,function*(){try{const Y=yield xc.getToolsReadyForPackaging();v(Y)}catch(Y){console.error("Error loading tools ready for packaging:",Y),o("Error loading tools ready for packaging")}}),[]),H=m.useCallback(Y=>gn(null,null,function*(){c(Y),u(null),o("Processing scan...");const he=b.find(B=>B.barcode===Y);if(!he){u("error"),o("Tool not found or not ready for packaging");return}if(w.find(B=>B.id===he.id)){u("error"),o("Tool already added to package");return}S(B=>[...B,he]),E(he.id),e&&C&&O(he.id),u("success"),o(`Successfully added ${he.name} to package`),setTimeout(()=>{c(""),o(""),u(null)},2e3)}),[b,w,E,e,C,O]),A=m.useCallback(()=>{if(b.length===0){u("error"),o("No tools available for packaging");return}const Y=b[Math.floor(Math.random()*b.length)];H(Y.barcode)},[b,H]),z=m.useCallback(()=>gn(null,null,function*(){if(!T){o("Please start a packaging session first");return}try{o("Creating new autoclave load..."),yield $(n,!0),o("New autoclave load created successfully!"),setTimeout(()=>{o("")},2e3)}catch(Y){o("Error creating new autoclave load"),console.error("Error creating new autoclave load:",Y)}}),[T,n,$]),M=m.useCallback(()=>{if(!(C!=null&&C.batchCode)){o("Please create a batch first before uploading receipts");return}x(!0)},[C==null?void 0:C.batchCode]),W=m.useCallback(()=>{x(!1),o("Receipt uploaded successfully!"),setTimeout(()=>{o("")},2e3)},[]),L=m.useCallback(()=>{x(!1)},[]),K=m.useCallback(()=>gn(null,null,function*(){if(w.length===0){o("No tools selected for packaging");return}if(!h.packageType){o("Please select a package type");return}try{o("Creating package...");const Y=yield xc.createPackage(w.map(he=>he.id),h,n);Y.success?(o(Y.message),S([]),y(!1),yield U(),setTimeout(()=>{s()},3e3)):o(Y.message)}catch(Y){console.error("Error finalizing package:",Y),o("Error creating package. Please try again.")}}),[w,h,n,U,s]),V=m.useCallback(()=>{j(),S([]),o(""),u(null),s()},[j,s]),Z=m.useCallback(Y=>{S(he=>he.filter(B=>B.id!==Y)),D(Y),e&&C&&k(Y)},[D,e,C,k]),ne=m.useCallback(()=>{if(!n.trim()){o("Please enter operator name");return}N(n)},[n,N]);return{operatorName:n,scannedBarcode:i,scanMessage:l,scanResult:d,packageInfo:h,showPackageForm:f,showReceiptUpload:g,scannedTools:w,batchLoading:P,currentPackagingSession:T,availableTools:b,setOperatorName:a,setScannedBarcode:c,setPackageInfo:p,setShowPackageForm:y,handleScan:H,simulateScan:A,handleNewAutoclaveLoad:z,handleImportReceipt:M,handleReceiptUploadSuccess:W,handleReceiptUploadCancel:L,handleFinalizePackage:K,handleEndSession:V,handleRemoveTool:Z,handleStartSession:ne,loadToolsReadyForPackaging:U}},lC=({operatorName:s,isBatchMode:e,onEndSession:t})=>r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Packaging Workflow"}),r.jsxs("p",{className:"text-sm text-gray-600",children:[e?"Batch Mode":"Single Tool Mode"," - Operator:"," ",s]})]}),r.jsxs("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:[r.jsx(ue,{path:Pe,size:1.5}),r.jsx("span",{className:"sr-only",children:"Close"})]})]}),cC=({scannedBarcode:s,scanMessage:e,scanResult:t,onScan:n,onBarcodeChange:a,onSimulateScan:i,onNewAutoclaveLoad:c,onImportReceipt:l,currentBatchCode:o,availableTools:d})=>{const u=h=>{h.key==="Enter"&&n(s)};return r.jsxs("div",{className:"mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(ue,{path:Zh,size:1.2,className:"text-purple-600"}),r.jsx("h4",{className:"font-medium text-purple-800",children:"Scanner"})]}),r.jsx("button",{onClick:i,disabled:d.length===0,className:`px-3 py-1 text-sm rounded-md transition-colors ${d.length===0?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:"Simulate Scan"})]}),r.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(ue,{path:_i,size:1,className:"text-blue-600"}),r.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Tools Ready for Packaging"})]}),r.jsxs("p",{className:"text-sm text-blue-700",children:[d.length," tools available for packaging"]}),d.length>0&&r.jsx("div",{className:"mt-2 text-xs text-blue-600",children:r.jsxs("p",{children:["Available barcodes:"," ",d.slice(0,3).map(h=>h.barcode).join(", "),d.length>3&&`... and ${d.length-3} more`]})})]}),o&&r.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md mb-4",children:r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("span",{className:"font-medium",children:"Current Batch:"})," ",o]})}),r.jsxs("div",{className:"flex space-x-2 mb-4",children:[c&&r.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[r.jsx(ue,{path:Ci,size:1}),r.jsx("span",{children:"+ New Autoclave Load"})]}),l&&r.jsxs("button",{onClick:l,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[r.jsx(ue,{path:Ue,size:1}),r.jsx("span",{children:"Import Receipt"})]})]}),t&&r.jsx("div",{className:`p-3 rounded-md mb-3 ${t==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("input",{type:"text",value:s,onChange:h=>a(h.target.value),onKeyPress:u,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter barcode manually or scan..."}),r.jsx("button",{onClick:()=>n(s),disabled:!s.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Scan Tool"})]})]})},dC=({scannedTools:s,onRemoveTool:e,onFinalizePackage:t})=>r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("h4",{className:"font-medium text-gray-800",children:["Scanned Tools (",s.length,")"]}),s.length>0&&r.jsx("button",{onClick:t,className:"px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors",children:"Finalize Package"})]}),s.length===0?r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(ue,{path:lr,size:2,className:"mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"No tools scanned yet"}),r.jsx("p",{className:"text-sm",children:"Scan tools to add them to the package"})]}):r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(n=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-800",children:n.name}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Barcode: ",n.barcode]})]}),r.jsxs("button",{onClick:()=>e(n.id),className:"p-1 text-red-500 hover:text-red-700 transition-colors",children:[r.jsx(ue,{path:qn,size:1}),r.jsx("span",{className:"sr-only",children:"Remove"})]})]},n.id))})]});var uC=Object.defineProperty,mC=Object.defineProperties,hC=Object.getOwnPropertyDescriptors,bc=Object.getOwnPropertySymbols,pC=Object.prototype.hasOwnProperty,fC=Object.prototype.propertyIsEnumerable,_c=(s,e,t)=>e in s?uC(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ra=(s,e)=>{for(var t in e||(e={}))pC.call(e,t)&&_c(s,t,e[t]);if(bc)for(var t of bc(e))fC.call(e,t)&&_c(s,t,e[t]);return s},Aa=(s,e)=>mC(s,hC(e));const gC=({packageInfo:s,batchLoading:e,onPackageInfoChange:t,onFinalizePackage:n,onCancel:a})=>{const i=o=>{t(Aa(Ra({},s),{packageType:o}))},c=o=>{t(Aa(Ra({},s),{packageSize:o}))},l=o=>{t(Aa(Ra({},s),{notes:o}))};return r.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-blue-800 mb-3",children:"Package Information"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"package-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Type"}),r.jsxs("select",{id:"package-type",value:s.packageType,onChange:o=>i(o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select package type"}),r.jsx("option",{value:"pouch",children:"Pouch"}),r.jsx("option",{value:"wrap",children:"Wrap"}),r.jsx("option",{value:"container",children:"Container"}),r.jsx("option",{value:"tray",children:"Tray"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"package-size",className:"block text-sm font-medium text-gray-700 mb-1",children:"Package Size"}),r.jsxs("select",{id:"package-size",value:s.packageSize,onChange:o=>c(o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select package size"}),r.jsx("option",{value:"small",children:"Small"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"large",children:"Large"}),r.jsx("option",{value:"extra-large",children:"Extra Large"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"package-notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),r.jsx("textarea",{id:"package-notes",value:s.notes,onChange:o=>l(o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"Additional notes about the package..."})]})]}),r.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[r.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:n,disabled:e||!s.packageType||!s.packageSize,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:e?"Processing...":"Generate Batch Code"})]})]})},yC=({operatorName:s,onOperatorNameChange:e,onStartSession:t,onCancel:n})=>r.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-md mx-auto",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Packaging Workflow"}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"operator-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Operator Name"}),r.jsx("input",{id:"operator-name",type:"text",value:s,onChange:a=>e(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter your name"})]}),r.jsxs("div",{className:"flex justify-end space-x-2",children:[r.jsx("button",{onClick:n,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:t,disabled:!s.trim(),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 transition-colors",children:"Start Session"})]})]}),vC=({onClose:s,isBatchMode:e})=>{const t=oC(s,e);if(X.useEffect(()=>{t!=null&&t.loadToolsReadyForPackaging&&t.loadToolsReadyForPackaging()},[t]),!t)return r.jsx("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Loading packaging workflow..."})]})});const{operatorName:n,scannedBarcode:a,scanMessage:i,scanResult:c,packageInfo:l,showPackageForm:o,showReceiptUpload:d,scannedTools:u,batchLoading:h,currentPackagingSession:p,availableTools:f,setOperatorName:y,setScannedBarcode:g,setPackageInfo:x,setShowPackageForm:b,handleScan:v,simulateScan:w,handleNewAutoclaveLoad:S,handleImportReceipt:T,handleReceiptUploadSuccess:C,handleReceiptUploadCancel:P,handleFinalizePackage:N,handleEndSession:j,handleRemoveTool:E,handleStartSession:D}=t;return p?d?r.jsx(mm,{batchCode:p.currentBatchId||"",operator:n,onSuccess:C,onCancel:P}):r.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:[r.jsx(lC,{operatorName:n,isBatchMode:e,onEndSession:j}),r.jsx(cC,{scannedBarcode:a,scanMessage:i,scanResult:c,onScan:v,onBarcodeChange:g,onSimulateScan:w,onNewAutoclaveLoad:S,onImportReceipt:T,currentBatchCode:p.currentBatchId||void 0,availableTools:f}),r.jsx(dC,{scannedTools:u,onRemoveTool:E,onFinalizePackage:()=>b(!0)}),o&&r.jsx(gC,{packageInfo:l,batchLoading:h,onPackageInfoChange:x,onFinalizePackage:N,onCancel:()=>b(!1)}),r.jsxs("div",{className:"text-sm text-gray-600",children:[r.jsxs("p",{children:["Session ID: ",p==null?void 0:p.id]}),r.jsxs("p",{children:["Started: ",p==null?void 0:p.startTime.toLocaleTimeString()]}),r.jsxs("p",{children:["Tools Ready: ",f.length]})]})]}):r.jsx(yC,{operatorName:n,onOperatorNameChange:y,onStartSession:D,onCancel:s})},xC=({tool:s,onDismiss:e,onReplace:t,onContinue:n})=>{const a=(s.maxCycles||200)-s.cycleCount;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:de,size:1.5,className:"text-red-500"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tool Replacement Required"})]}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(I,{path:Pe,size:1})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(I,{path:_i,size:1,className:"text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsxs("p",{className:"text-red-800 font-medium mb-2",children:[s.name," (Barcode: ",s.barcode,")"]}),r.jsxs("p",{className:"text-red-700 text-sm",children:["This tool has completed ",r.jsx("strong",{children:s.cycleCount})," ","sterilization cycles and has reached the maximum recommended limit of ",s.maxCycles||200," cycles."]}),a<=0&&r.jsx("p",{className:"text-red-700 text-sm font-medium mt-2",children:"⚠️ This tool has exceeded the maximum cycle limit and should be replaced immediately."}),a>0&&a<=5&&r.jsxs("p",{className:"text-orange-700 text-sm font-medium mt-2",children:["⚠️ Only ",a," cycle",a!==1?"s":""," remaining before replacement is required."]})]})]})}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cycle Information"}),r.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Current Cycles:"}),r.jsx("span",{className:"font-medium",children:s.cycleCount})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Maximum Cycles:"}),r.jsx("span",{className:"font-medium",children:s.maxCycles||200})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Cycles Remaining:"}),r.jsx("span",{className:`font-medium ${a<=0?"text-red-600":a<=5?"text-orange-600":"text-green-600"}`,children:a<=0?"Exceeded":a})]})]})]}),r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Recommendation"}),r.jsx("p",{className:"text-blue-800 text-sm",children:"For patient safety and compliance, it is recommended to replace this tool with a new one. Continued use beyond the cycle limit may compromise sterilization effectiveness."})]})]}),r.jsxs("div",{className:"flex gap-3 mt-6",children:[r.jsx("button",{onClick:t,className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Replace Tool"}),r.jsx("button",{onClick:n,className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium",children:"Continue Anyway"})]}),r.jsx("div",{className:"mt-3 text-center",children:r.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-sm transition-colors",children:"Dismiss"})})]})})},hm=m.memo(()=>{const{selectedWorkflow:s,scannedData:e,showWorkflowResult:t,scanMode:n,isScanning:a,scanMessage:i,scannedTools:c,dirtyScanMessage:l,isBath1Active:o,replacementAlert:d,handleWorkflowSelect:u,handleBackToWorkflow:h,handleScan:p,handleCloseWorkflow:f,handleReceiptUploadSuccess:y,handleReceiptUploadCancel:g,handleDeleteTool:x,handleCancelAll:b,handleSendScannedToBath1:v,handleScanModeChange:w,handleScanTool:S,handleReplaceTool:T,handleContinueAnyway:C,handleDismissReplacementAlert:P}=CS();return r.jsxs(r.Fragment,{children:[r.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:()=>window.history.back()}),r.jsx(se.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:r.jsx("div",{className:"h-full flex flex-col",children:r.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Sterilization Scanner"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Scan tools for sterilization workflows"})]}),r.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",style:{maxHeight:"calc(100vh - 120px)"},children:s?s==="import"?r.jsx("div",{children:r.jsx(mm,{batchCode:"",operator:"",onSuccess:y,onCancel:g})}):s==="problem"?r.jsx("div",{children:r.jsx(ZS,{onClose:h})}):s==="clean"&&t?r.jsx("div",{children:r.jsx(aC,{scannedData:e,onClose:f})}):s==="packaging"?r.jsx("div",{children:r.jsx(vC,{onClose:h,isBatchMode:n==="batch"})}):s==="dirty"?r.jsxs("div",{className:"space-y-4",children:[r.jsx(mc,{workflowId:"dirty",color:"orange"}),o&&r.jsx("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(I,{path:de,size:.8,className:"text-red-600"}),r.jsx("span",{className:"text-red-700 text-xs font-medium",children:"Bath 1 is currently active"})]})}),d.show&&d.tool&&r.jsx(xC,{tool:d.tool,onDismiss:P,onReplace:T,onContinue:C}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>w("single"),className:`px-3 py-1.5 rounded text-sm transition-colors ${n==="single"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Single Scan"}),r.jsx("button",{onClick:()=>w("batch"),className:`px-3 py-1.5 rounded text-sm transition-colors ${n==="batch"?"bg-green-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Batch Scan"})]}),r.jsx(hc,{isScanning:a,scanMessage:l,onScan:S,size:"small"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("h4",{className:"font-medium text-gray-800 text-sm",children:["Scanned Tools (",c.length,")"]}),c.length===0?r.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 p-4 rounded text-center",children:[r.jsx(I,{path:qe,size:1.5,className:"text-gray-400 mx-auto mb-1"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"No tools scanned yet"}),r.jsx("p",{className:"text-xs text-gray-400",children:"Use the scanner above to add tools"})]}):r.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 scrollbar-hide hide-scrollbar",children:c.map(N=>r.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-sm",children:N.name}),r.jsxs("span",{className:"text-gray-600 text-xs ml-2",children:["(",N.barcode,")"]})]}),r.jsx("button",{onClick:()=>x(N.id),className:"text-red-500 hover:text-red-700 p-1",title:"Remove tool",children:r.jsx(I,{path:ji,size:.7})})]},N.id))})]}),o&&r.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(I,{path:de,size:1,className:"text-orange-600"}),r.jsx("span",{className:"text-orange-800 text-sm font-medium",children:"⚠️ Bath 1 timer is already in process"})]}),r.jsx("p",{className:"text-orange-600 text-xs mt-1",children:"Please wait for the current Bath 1 phase to complete before starting a new one."})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:b,disabled:c.length===0,className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${c.length===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,children:"Cancel"}),r.jsx("button",{onClick:v,disabled:c.length===0||o,className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${c.length===0||o?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]"}`,title:o?"Bath 1 timer is already in process":void 0,children:"Send to Bath 1"})]}),r.jsx("div",{className:"flex justify-center pt-2",children:r.jsx("button",{onClick:h,className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors text-sm",children:"← Back to Workflow Selection"})})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsx(mc,{workflowId:s,color:"blue"}),r.jsx(hc,{isScanning:a,scanMessage:i,onScan:p,size:"large"}),r.jsx("div",{className:"flex justify-center",children:r.jsx("button",{onClick:h,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"← Back to Workflow Selection"})})]}):r.jsx(RS,{onWorkflowSelect:u})})]})})})]})});hm.displayName="ScannerPage";const bC=({children:s})=>r.jsx("div",{className:"space-y-6",children:s}),_C=({children:s})=>r.jsx(r.Fragment,{children:s});var Oa={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var wc;function wC(){return wc||(wc=1,(function(s){(function(){var e={}.hasOwnProperty;function t(){for(var i="",c=0;c<arguments.length;c++){var l=arguments[c];l&&(i=a(i,n(l)))}return i}function n(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var c="";for(var l in i)e.call(i,l)&&i[l]&&(c=a(c,l));return c}function a(i,c){return c?i?i+" "+c:i+c:i}s.exports?(t.default=t,s.exports=t):window.classNames=t})()})(Oa)),Oa.exports}var SC=wC();const He=vi(SC);function CC(s,e){if(s==null)return{};var t={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(e.indexOf(n)!==-1)continue;t[n]=s[n]}return t}function di(s,e){return di=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},di(s,e)}function jC(s,e){s.prototype=Object.create(e.prototype),s.prototype.constructor=s,di(s,e)}const NC=["xxl","xl","lg","md","sm","xs"],IC="xs",$i=m.createContext({prefixes:{},breakpoints:NC,minBreakpoint:IC}),{Consumer:fD,Provider:gD}=$i;function dr(s,e){const{prefixes:t}=m.useContext($i);return s||t[e]||e}function TC(){const{dir:s}=m.useContext($i);return s==="rtl"}function Jn(s){return s&&s.ownerDocument||document}function EC(s){var e=Jn(s);return e&&e.defaultView||window}function kC(s,e){return EC(s).getComputedStyle(s,e)}var DC=/([A-Z])/g;function PC(s){return s.replace(DC,"-$1").toLowerCase()}var RC=/^ms-/;function yn(s){return PC(s).replace(RC,"-ms-")}var AC=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function OC(s){return!!(s&&AC.test(s))}function ir(s,e){var t="",n="";if(typeof e=="string")return s.style.getPropertyValue(yn(e))||kC(s).getPropertyValue(yn(e));Object.keys(e).forEach(function(a){var i=e[a];!i&&i!==0?s.style.removeProperty(yn(a)):OC(a)?n+=a+"("+i+") ":t+=yn(a)+": "+i+";"}),n&&(t+="transform: "+n+";"),s.style.cssText+=";"+t}var $C=kp();const $a=vi($C),Sc={disabled:!1},pm=X.createContext(null);var MC=function(e){return e.scrollTop},ys="unmounted",Xt="exited",At="entering",er="entered",ui="exiting",_t=(function(s){jC(e,s);function e(n,a){var i;i=s.call(this,n,a)||this;var c=a,l=c&&!c.isMounting?n.enter:n.appear,o;return i.appearStatus=null,n.in?l?(o=Xt,i.appearStatus=At):o=er:n.unmountOnExit||n.mountOnEnter?o=ys:o=Xt,i.state={status:o},i.nextCallback=null,i}e.getDerivedStateFromProps=function(a,i){var c=a.in;return c&&i.status===ys?{status:Xt}:null};var t=e.prototype;return t.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},t.componentDidUpdate=function(a){var i=null;if(a!==this.props){var c=this.state.status;this.props.in?c!==At&&c!==er&&(i=At):(c===At||c===er)&&(i=ui)}this.updateStatus(!1,i)},t.componentWillUnmount=function(){this.cancelNextCallback()},t.getTimeouts=function(){var a=this.props.timeout,i,c,l;return i=c=l=a,a!=null&&typeof a!="number"&&(i=a.exit,c=a.enter,l=a.appear!==void 0?a.appear:c),{exit:i,enter:c,appear:l}},t.updateStatus=function(a,i){if(a===void 0&&(a=!1),i!==null)if(this.cancelNextCallback(),i===At){if(this.props.unmountOnExit||this.props.mountOnEnter){var c=this.props.nodeRef?this.props.nodeRef.current:$r.findDOMNode(this);c&&MC(c)}this.performEnter(a)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Xt&&this.setState({status:ys})},t.performEnter=function(a){var i=this,c=this.props.enter,l=this.context?this.context.isMounting:a,o=this.props.nodeRef?[l]:[$r.findDOMNode(this),l],d=o[0],u=o[1],h=this.getTimeouts(),p=l?h.appear:h.enter;if(!a&&!c||Sc.disabled){this.safeSetState({status:er},function(){i.props.onEntered(d)});return}this.props.onEnter(d,u),this.safeSetState({status:At},function(){i.props.onEntering(d,u),i.onTransitionEnd(p,function(){i.safeSetState({status:er},function(){i.props.onEntered(d,u)})})})},t.performExit=function(){var a=this,i=this.props.exit,c=this.getTimeouts(),l=this.props.nodeRef?void 0:$r.findDOMNode(this);if(!i||Sc.disabled){this.safeSetState({status:Xt},function(){a.props.onExited(l)});return}this.props.onExit(l),this.safeSetState({status:ui},function(){a.props.onExiting(l),a.onTransitionEnd(c.exit,function(){a.safeSetState({status:Xt},function(){a.props.onExited(l)})})})},t.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},t.safeSetState=function(a,i){i=this.setNextCallback(i),this.setState(a,i)},t.setNextCallback=function(a){var i=this,c=!0;return this.nextCallback=function(l){c&&(c=!1,i.nextCallback=null,a(l))},this.nextCallback.cancel=function(){c=!1},this.nextCallback},t.onTransitionEnd=function(a,i){this.setNextCallback(i);var c=this.props.nodeRef?this.props.nodeRef.current:$r.findDOMNode(this),l=a==null&&!this.props.addEndListener;if(!c||l){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var o=this.props.nodeRef?[this.nextCallback]:[c,this.nextCallback],d=o[0],u=o[1];this.props.addEndListener(d,u)}a!=null&&setTimeout(this.nextCallback,a)},t.render=function(){var a=this.state.status;if(a===ys)return null;var i=this.props,c=i.children;i.in,i.mountOnEnter,i.unmountOnExit,i.appear,i.enter,i.exit,i.timeout,i.addEndListener,i.onEnter,i.onEntering,i.onEntered,i.onExit,i.onExiting,i.onExited,i.nodeRef;var l=CC(i,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return X.createElement(pm.Provider,{value:null},typeof c=="function"?c(a,l):X.cloneElement(X.Children.only(c),l))},e})(X.Component);_t.contextType=pm;_t.propTypes={};function Tr(){}_t.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Tr,onEntering:Tr,onEntered:Tr,onExit:Tr,onExiting:Tr,onExited:Tr};_t.UNMOUNTED=ys;_t.EXITED=Xt;_t.ENTERING=At;_t.ENTERED=er;_t.EXITING=ui;function FC(s){return s.code==="Escape"||s.keyCode===27}function zC(){const s=m.version.split(".");return{major:+s[0],minor:+s[1],patch:+s[2]}}function Xn(s){if(!s||typeof s=="function")return null;const{major:e}=zC();return e>=19?s.props.ref:s.ref}const Vr=!!(typeof window!="undefined"&&window.document&&window.document.createElement);var mi=!1,hi=!1;try{var Ma={get passive(){return mi=!0},get once(){return hi=mi=!0}};Vr&&(window.addEventListener("test",Ma,Ma),window.removeEventListener("test",Ma,!0))}catch(s){}function fm(s,e,t,n){if(n&&typeof n!="boolean"&&!hi){var a=n.once,i=n.capture,c=t;!hi&&a&&(c=t.__once||function l(o){this.removeEventListener(e,l,i),t.call(this,o)},t.__once=c),s.addEventListener(e,c,mi?n:i)}s.addEventListener(e,t,n)}function pi(s,e,t,n){var a=n&&typeof n!="boolean"?n.capture:n;s.removeEventListener(e,t,a),t.__once&&s.removeEventListener(e,t.__once,a)}function Fn(s,e,t,n){return fm(s,e,t,n),function(){pi(s,e,t,n)}}function LC(s,e,t,n){if(n===void 0&&(n=!0),s){var a=document.createEvent("HTMLEvents");a.initEvent(e,t,n),s.dispatchEvent(a)}}function BC(s){var e=ir(s,"transitionDuration")||"",t=e.indexOf("ms")===-1?1e3:1;return parseFloat(e)*t}function qC(s,e,t){t===void 0&&(t=5);var n=!1,a=setTimeout(function(){n||LC(s,"transitionend",!0)},e+t),i=Fn(s,"transitionend",function(){n=!0},{once:!0});return function(){clearTimeout(a),i()}}function gm(s,e,t,n){t==null&&(t=BC(s)||0);var a=qC(s,t,n),i=Fn(s,"transitionend",e);return function(){a(),i()}}function Cc(s,e){const t=ir(s,e)||"",n=t.indexOf("ms")===-1?1e3:1;return parseFloat(t)*n}function UC(s,e){const t=Cc(s,"transitionDuration"),n=Cc(s,"transitionDelay"),a=gm(s,i=>{i.target===s&&(a(),e(i))},t+n)}function HC(s){s.offsetHeight}const jc=s=>!s||typeof s=="function"?s:e=>{s.current=e};function VC(s,e){const t=jc(s),n=jc(e);return a=>{t&&t(a),n&&n(a)}}function ym(s,e){return m.useMemo(()=>VC(s,e),[s,e])}function WC(s){return s&&"setState"in s?$r.findDOMNode(s):s!=null?s:null}const vm=X.forwardRef((h,u)=>{var p=h,{onEnter:s,onEntering:e,onEntered:t,onExit:n,onExiting:a,onExited:i,addEndListener:c,children:l,childRef:o}=p,d=Oe(p,["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children","childRef"]);const f=m.useRef(null),y=ym(f,o),g=N=>{y(WC(N))},x=N=>j=>{N&&f.current&&N(f.current,j)},b=m.useCallback(x(s),[s]),v=m.useCallback(x(e),[e]),w=m.useCallback(x(t),[t]),S=m.useCallback(x(n),[n]),T=m.useCallback(x(a),[a]),C=m.useCallback(x(i),[i]),P=m.useCallback(x(c),[c]);return r.jsx(_t,we(re({ref:u},d),{onEnter:b,onEntered:w,onEntering:v,onExit:S,onExited:C,onExiting:T,addEndListener:P,nodeRef:f,children:typeof l=="function"?(N,j)=>l(N,we(re({},j),{ref:g})):X.cloneElement(l,{ref:g})}))});vm.displayName="TransitionWrapper";function GC(s){const e=m.useRef(s);return m.useEffect(()=>{e.current=s},[s]),e}function fi(s){const e=GC(s);return m.useCallback(function(...t){return e.current&&e.current(...t)},[e])}const KC=(s=>m.forwardRef((e,t)=>r.jsx("div",we(re({},e),{ref:t,className:He(e.className,s)}))));function QC(s){const e=m.useRef(s);return m.useEffect(()=>{e.current=s},[s]),e}function tr(s){const e=QC(s);return m.useCallback(function(...t){return e.current&&e.current(...t)},[e])}function YC(){const s=m.useRef(!0),e=m.useRef(()=>s.current);return m.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[]),e.current}function JC(s){const e=m.useRef(null);return m.useEffect(()=>{e.current=s}),e.current}const XC=typeof global!="undefined"&&global.navigator&&global.navigator.product==="ReactNative",ZC=typeof document!="undefined",Nc=ZC||XC?m.useLayoutEffect:m.useEffect,ej=["as","disabled"];function tj(s,e){if(s==null)return{};var t={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(e.indexOf(n)>=0)continue;t[n]=s[n]}return t}function rj(s){return!s||s.trim()==="#"}function xm({tagName:s,disabled:e,href:t,target:n,rel:a,role:i,onClick:c,tabIndex:l=0,type:o}){s||(t!=null||n!=null||a!=null?s="a":s="button");const d={tagName:s};if(s==="button")return[{type:o||"button",disabled:e},d];const u=p=>{if((e||s==="a"&&rj(t))&&p.preventDefault(),e){p.stopPropagation();return}c==null||c(p)},h=p=>{p.key===" "&&(p.preventDefault(),u(p))};return s==="a"&&(t||(t="#"),e&&(t=void 0)),[{role:i!=null?i:"button",disabled:void 0,tabIndex:e?void 0:l,href:t,target:s==="a"?n:void 0,"aria-disabled":e||void 0,rel:s==="a"?a:void 0,onClick:u,onKeyDown:h},d]}const sj=m.forwardRef((s,e)=>{let{as:t,disabled:n}=s,a=tj(s,ej);const[i,{tagName:c}]=xm(Object.assign({tagName:t,disabled:n},a));return r.jsx(c,Object.assign({},a,i,{ref:e}))});sj.displayName="Button";const nj={[At]:"show",[er]:"show"},Mi=m.forwardRef((c,i)=>{var l=c,{className:s,children:e,transitionClasses:t={},onEnter:n}=l,a=Oe(l,["className","children","transitionClasses","onEnter"]);const o=re({in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1},a),d=m.useCallback((u,h)=>{HC(u),n==null||n(u,h)},[n]);return r.jsx(vm,we(re({ref:i,addEndListener:UC},o),{onEnter:d,childRef:Xn(e),children:(u,h)=>m.cloneElement(e,we(re({},h),{className:He("fade",s,e.props.className,nj[u],t[u])}))}))});Mi.displayName="Fade";const aj={"aria-label":$a.string,onClick:$a.func,variant:$a.oneOf(["white"])},Fi=m.forwardRef((i,a)=>{var c=i,{className:s,variant:e,"aria-label":t="Close"}=c,n=Oe(c,["className","variant","aria-label"]);return r.jsx("button",re({ref:a,type:"button",className:He("btn-close",e&&`btn-close-${e}`,s),"aria-label":t},n))});Fi.displayName="CloseButton";Fi.propTypes=aj;const zi=m.forwardRef((d,o)=>{var u=d,{as:s,bsPrefix:e,variant:t="primary",size:n,active:a=!1,disabled:i=!1,className:c}=u,l=Oe(u,["as","bsPrefix","variant","size","active","disabled","className"]);const h=dr(e,"btn"),[p,{tagName:f}]=xm(re({tagName:s,disabled:i},l)),y=f;return r.jsx(y,we(re(re({},p),l),{ref:o,disabled:i,className:He(c,h,a&&"active",t&&`${h}-${t}`,n&&`${h}-${n}`,l.href&&i&&"disabled")}))});zi.displayName="Button";function ij(s){const e=m.useRef(s);return e.current=s,e}function oj(s){const e=ij(s);m.useEffect(()=>()=>e.current(),[])}var lj=Function.prototype.bind.call(Function.prototype.call,[].slice);function Er(s,e){return lj(s.querySelectorAll(e))}function Ic(s,e){if(s.contains)return s.contains(e);if(s.compareDocumentPosition)return s===e||!!(s.compareDocumentPosition(e)&16)}const cj="data-rr-ui-";function dj(s){return`${cj}${s}`}const bm=m.createContext(Vr?window:void 0);bm.Provider;function Li(){return m.useContext(bm)}const Tc=s=>!s||typeof s=="function"?s:e=>{s.current=e};function uj(s,e){const t=Tc(s),n=Tc(e);return a=>{t&&t(a),n&&n(a)}}function Bi(s,e){return m.useMemo(()=>uj(s,e),[s,e])}var vn;function Ec(s){if((!vn&&vn!==0||s)&&Vr){var e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.width="50px",e.style.height="50px",e.style.overflow="scroll",document.body.appendChild(e),vn=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return vn}function mj(){return m.useState(null)}function Fa(s){s===void 0&&(s=Jn());try{var e=s.activeElement;return!e||!e.nodeName?null:e}catch(t){return s.body}}function hj(s){const e=m.useRef(s);return e.current=s,e}function pj(s){const e=hj(s);m.useEffect(()=>()=>e.current(),[])}function fj(s=document){const e=s.defaultView;return Math.abs(e.innerWidth-s.documentElement.clientWidth)}const kc=dj("modal-open");class qi{constructor({ownerDocument:e,handleContainerOverflow:t=!0,isRTL:n=!1}={}){this.handleContainerOverflow=t,this.isRTL=n,this.modals=[],this.ownerDocument=e}getScrollbarWidth(){return fj(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(e){}removeModalAttributes(e){}setContainerStyle(e){const t={overflow:"hidden"},n=this.isRTL?"paddingLeft":"paddingRight",a=this.getElement();e.style={overflow:a.style.overflow,[n]:a.style[n]},e.scrollBarWidth&&(t[n]=`${parseInt(ir(a,n)||"0",10)+e.scrollBarWidth}px`),a.setAttribute(kc,""),ir(a,t)}reset(){[...this.modals].forEach(e=>this.remove(e))}removeContainerStyle(e){const t=this.getElement();t.removeAttribute(kc),Object.assign(t.style,e.style)}add(e){let t=this.modals.indexOf(e);return t!==-1||(t=this.modals.length,this.modals.push(e),this.setModalAttributes(e),t!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),t}remove(e){const t=this.modals.indexOf(e);t!==-1&&(this.modals.splice(t,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(e))}isTopModal(e){return!!this.modals.length&&this.modals[this.modals.length-1]===e}}const za=(s,e)=>Vr?s==null?(e||Jn()).body:(typeof s=="function"&&(s=s()),s&&"current"in s&&(s=s.current),s&&("nodeType"in s||s.getBoundingClientRect)?s:null):null;function gj(s,e){const t=Li(),[n,a]=m.useState(()=>za(s,t==null?void 0:t.document));if(!n){const i=za(s);i&&a(i)}return m.useEffect(()=>{},[e,n]),m.useEffect(()=>{const i=za(s);i!==n&&a(i)},[s,n]),n}function yj({children:s,in:e,onExited:t,mountOnEnter:n,unmountOnExit:a}){const i=m.useRef(null),c=m.useRef(e),l=tr(t);m.useEffect(()=>{e?c.current=!0:l(i.current)},[e,l]);const o=Bi(i,Xn(s)),d=m.cloneElement(s,{ref:o});return e?d:a||!c.current&&n?null:d}const vj=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function xj(s,e){if(s==null)return{};var t={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(e.indexOf(n)>=0)continue;t[n]=s[n]}return t}function bj(s){let{onEnter:e,onEntering:t,onEntered:n,onExit:a,onExiting:i,onExited:c,addEndListener:l,children:o}=s,d=xj(s,vj);const u=m.useRef(null),h=Bi(u,Xn(o)),p=S=>T=>{S&&u.current&&S(u.current,T)},f=m.useCallback(p(e),[e]),y=m.useCallback(p(t),[t]),g=m.useCallback(p(n),[n]),x=m.useCallback(p(a),[a]),b=m.useCallback(p(i),[i]),v=m.useCallback(p(c),[c]),w=m.useCallback(p(l),[l]);return Object.assign({},d,{nodeRef:u},e&&{onEnter:f},t&&{onEntering:y},n&&{onEntered:g},a&&{onExit:x},i&&{onExiting:b},c&&{onExited:v},l&&{addEndListener:w},{children:typeof o=="function"?(S,T)=>o(S,Object.assign({},T,{ref:h})):m.cloneElement(o,{ref:h})})}const _j=["component"];function wj(s,e){if(s==null)return{};var t={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(e.indexOf(n)>=0)continue;t[n]=s[n]}return t}const Sj=m.forwardRef((s,e)=>{let{component:t}=s,n=wj(s,_j);const a=bj(n);return r.jsx(t,Object.assign({ref:e},a))});function Cj({in:s,onTransition:e}){const t=m.useRef(null),n=m.useRef(!0),a=tr(e);return Nc(()=>{if(!t.current)return;let i=!1;return a({in:s,element:t.current,initial:n.current,isStale:()=>i}),()=>{i=!0}},[s,a]),Nc(()=>(n.current=!1,()=>{n.current=!0}),[]),t}function jj({children:s,in:e,onExited:t,onEntered:n,transition:a}){const[i,c]=m.useState(!e);e&&i&&c(!1);const l=Cj({in:!!e,onTransition:d=>{const u=()=>{d.isStale()||(d.in?n==null||n(d.element,d.initial):(c(!0),t==null||t(d.element)))};Promise.resolve(a(d)).then(u,h=>{throw d.in||c(!0),h})}}),o=Bi(l,Xn(s));return i&&!e?null:m.cloneElement(s,{ref:o})}function Dc(s,e,t){return s?r.jsx(Sj,Object.assign({},t,{component:s})):e?r.jsx(jj,Object.assign({},t,{transition:e})):r.jsx(yj,Object.assign({},t))}const Nj=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function Ij(s,e){if(s==null)return{};var t={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(e.indexOf(n)>=0)continue;t[n]=s[n]}return t}let La;function Tj(s){return La||(La=new qi({ownerDocument:s==null?void 0:s.document})),La}function Ej(s){const e=Li(),t=s||Tj(e),n=m.useRef({dialog:null,backdrop:null});return Object.assign(n.current,{add:()=>t.add(n.current),remove:()=>t.remove(n.current),isTopModal:()=>t.isTopModal(n.current),setDialogRef:m.useCallback(a=>{n.current.dialog=a},[]),setBackdropRef:m.useCallback(a=>{n.current.backdrop=a},[])})}const _m=m.forwardRef((s,e)=>{let{show:t=!1,role:n="dialog",className:a,style:i,children:c,backdrop:l=!0,keyboard:o=!0,onBackdropClick:d,onEscapeKeyDown:u,transition:h,runTransition:p,backdropTransition:f,runBackdropTransition:y,autoFocus:g=!0,enforceFocus:x=!0,restoreFocus:b=!0,restoreFocusOptions:v,renderDialog:w,renderBackdrop:S=le=>r.jsx("div",Object.assign({},le)),manager:T,container:C,onShow:P,onHide:N=()=>{},onExit:j,onExited:E,onExiting:D,onEnter:O,onEntering:k,onEntered:$}=s,U=Ij(s,Nj);const H=Li(),A=gj(C),z=Ej(T),M=YC(),W=JC(t),[L,K]=m.useState(!t),V=m.useRef(null);m.useImperativeHandle(e,()=>z,[z]),Vr&&!W&&t&&(V.current=Fa(H==null?void 0:H.document)),t&&L&&K(!1);const Z=tr(()=>{if(z.add(),oe.current=Fn(document,"keydown",B),ye.current=Fn(document,"focus",()=>setTimeout(Y),!0),P&&P(),g){var le,$s;const mr=Fa((le=($s=z.dialog)==null?void 0:$s.ownerDocument)!=null?le:H==null?void 0:H.document);z.dialog&&mr&&!Ic(z.dialog,mr)&&(V.current=mr,z.dialog.focus())}}),ne=tr(()=>{if(z.remove(),oe.current==null||oe.current(),ye.current==null||ye.current(),b){var le;(le=V.current)==null||le.focus==null||le.focus(v),V.current=null}});m.useEffect(()=>{!t||!A||Z()},[t,A,Z]),m.useEffect(()=>{L&&ne()},[L,ne]),pj(()=>{ne()});const Y=tr(()=>{if(!x||!M()||!z.isTopModal())return;const le=Fa(H==null?void 0:H.document);z.dialog&&le&&!Ic(z.dialog,le)&&z.dialog.focus()}),he=tr(le=>{le.target===le.currentTarget&&(d==null||d(le),l===!0&&N())}),B=tr(le=>{o&&FC(le)&&z.isTopModal()&&(u==null||u(le),le.defaultPrevented||N())}),ye=m.useRef(),oe=m.useRef(),ur=(...le)=>{K(!0),E==null||E(...le)};if(!A)return null;const wt=Object.assign({role:n,ref:z.setDialogRef,"aria-modal":n==="dialog"?!0:void 0},U,{style:i,className:a,tabIndex:-1});let St=w?w(wt):r.jsx("div",Object.assign({},wt,{children:m.cloneElement(c,{role:"document"})}));St=Dc(h,p,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!t,onExit:j,onExiting:D,onExited:ur,onEnter:O,onEntering:k,onEntered:$,children:St});let Ct=null;return l&&(Ct=S({ref:z.setBackdropRef,onClick:he}),Ct=Dc(f,y,{in:!!t,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:Ct})),r.jsx(r.Fragment,{children:$r.createPortal(r.jsxs(r.Fragment,{children:[Ct,St]}),A)})});_m.displayName="Modal";const kj=Object.assign(_m,{Manager:qi});function Dj(s,e){return s.classList?s.classList.contains(e):(" "+(s.className.baseVal||s.className)+" ").indexOf(" "+e+" ")!==-1}function Pj(s,e){s.classList?s.classList.add(e):Dj(s,e)||(typeof s.className=="string"?s.className=s.className+" "+e:s.setAttribute("class",(s.className&&s.className.baseVal||"")+" "+e))}function Pc(s,e){return s.replace(new RegExp("(^|\\s)"+e+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function Rj(s,e){s.classList?s.classList.remove(e):typeof s.className=="string"?s.className=Pc(s.className,e):s.setAttribute("class",Pc(s.className&&s.className.baseVal||"",e))}const kr={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class Aj extends qi{adjustAndStore(e,t,n){const a=t.style[e];t.dataset[e]=a,ir(t,{[e]:`${parseFloat(ir(t,e))+n}px`})}restore(e,t){const n=t.dataset[e];n!==void 0&&(delete t.dataset[e],ir(t,{[e]:n}))}setContainerStyle(e){super.setContainerStyle(e);const t=this.getElement();if(Pj(t,"modal-open"),!e.scrollBarWidth)return;const n=this.isRTL?"paddingLeft":"paddingRight",a=this.isRTL?"marginLeft":"marginRight";Er(t,kr.FIXED_CONTENT).forEach(i=>this.adjustAndStore(n,i,e.scrollBarWidth)),Er(t,kr.STICKY_CONTENT).forEach(i=>this.adjustAndStore(a,i,-e.scrollBarWidth)),Er(t,kr.NAVBAR_TOGGLER).forEach(i=>this.adjustAndStore(a,i,e.scrollBarWidth))}removeContainerStyle(e){super.removeContainerStyle(e);const t=this.getElement();Rj(t,"modal-open");const n=this.isRTL?"paddingLeft":"paddingRight",a=this.isRTL?"marginLeft":"marginRight";Er(t,kr.FIXED_CONTENT).forEach(i=>this.restore(n,i)),Er(t,kr.STICKY_CONTENT).forEach(i=>this.restore(a,i)),Er(t,kr.NAVBAR_TOGGLER).forEach(i=>this.restore(a,i))}}let Ba;function Oj(s){return Ba||(Ba=new Aj(s)),Ba}const wm=m.forwardRef((i,a)=>{var c=i,{className:s,bsPrefix:e,as:t="div"}=c,n=Oe(c,["className","bsPrefix","as"]);return e=dr(e,"modal-body"),r.jsx(t,re({ref:a,className:He(s,e)},n))});wm.displayName="ModalBody";const Sm=m.createContext({onHide(){}}),Ui=m.forwardRef((u,d)=>{var h=u,{bsPrefix:s,className:e,contentClassName:t,centered:n,size:a,fullscreen:i,children:c,scrollable:l}=h,o=Oe(h,["bsPrefix","className","contentClassName","centered","size","fullscreen","children","scrollable"]);s=dr(s,"modal");const p=`${s}-dialog`,f=typeof i=="string"?`${s}-fullscreen-${i}`:`${s}-fullscreen`;return r.jsx("div",we(re({},o),{ref:d,className:He(p,e,a&&`${s}-${a}`,n&&`${p}-centered`,l&&`${p}-scrollable`,i&&f),children:r.jsx("div",{className:He(`${s}-content`,t),children:c})}))});Ui.displayName="ModalDialog";const Cm=m.forwardRef((i,a)=>{var c=i,{className:s,bsPrefix:e,as:t="div"}=c,n=Oe(c,["className","bsPrefix","as"]);return e=dr(e,"modal-footer"),r.jsx(t,re({ref:a,className:He(s,e)},n))});Cm.displayName="ModalFooter";const jm=m.forwardRef((l,c)=>{var o=l,{closeLabel:s="Close",closeVariant:e,closeButton:t=!1,onHide:n,children:a}=o,i=Oe(o,["closeLabel","closeVariant","closeButton","onHide","children"]);const d=m.useContext(Sm),u=fi(()=>{d==null||d.onHide(),n==null||n()});return r.jsxs("div",we(re({ref:c},i),{children:[a,t&&r.jsx(Fi,{"aria-label":s,variant:e,onClick:u})]}))});jm.displayName="AbstractModalHeader";const Nm=m.forwardRef((c,i)=>{var l=c,{bsPrefix:s,className:e,closeLabel:t="Close",closeButton:n=!1}=l,a=Oe(l,["bsPrefix","className","closeLabel","closeButton"]);return s=dr(s,"modal-header"),r.jsx(jm,we(re({ref:i},a),{className:He(e,s),closeLabel:t,closeButton:n}))});Nm.displayName="ModalHeader";const $j=KC("h4"),Im=m.forwardRef((i,a)=>{var c=i,{className:s,bsPrefix:e,as:t=$j}=c,n=Oe(c,["className","bsPrefix","as"]);return e=dr(e,"modal-title"),r.jsx(t,re({ref:a,className:He(s,e)},n))});Im.displayName="ModalTitle";function Mj(s){return r.jsx(Mi,we(re({},s),{timeout:null}))}function Fj(s){return r.jsx(Mi,we(re({},s),{timeout:null}))}const Tm=m.forwardRef((A,H)=>{var z=A,{bsPrefix:s,className:e,style:t,dialogClassName:n,contentClassName:a,children:i,dialogAs:c=Ui,"data-bs-theme":l,"aria-labelledby":o,"aria-describedby":d,"aria-label":u,show:h=!1,animation:p=!0,backdrop:f=!0,keyboard:y=!0,onEscapeKeyDown:g,onShow:x,onHide:b,container:v,autoFocus:w=!0,enforceFocus:S=!0,restoreFocus:T=!0,restoreFocusOptions:C,onEntered:P,onExit:N,onExiting:j,onEnter:E,onEntering:D,onExited:O,backdropClassName:k,manager:$}=z,U=Oe(z,["bsPrefix","className","style","dialogClassName","contentClassName","children","dialogAs","data-bs-theme","aria-labelledby","aria-describedby","aria-label","show","animation","backdrop","keyboard","onEscapeKeyDown","onShow","onHide","container","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","onEntered","onExit","onExiting","onEnter","onEntering","onExited","backdropClassName","manager"]);const[M,W]=m.useState({}),[L,K]=m.useState(!1),V=m.useRef(!1),Z=m.useRef(!1),ne=m.useRef(null),[Y,he]=mj(),B=ym(H,he),ye=fi(b),oe=TC();s=dr(s,"modal");const ur=m.useMemo(()=>({onHide:ye}),[ye]);function wt(){return $||Oj({isRTL:oe})}function St(te){if(!Vr)return;const hr=wt().getScrollbarWidth()>0,Wi=te.scrollHeight>Jn(te).documentElement.clientHeight;W({paddingRight:hr&&!Wi?Ec():void 0,paddingLeft:!hr&&Wi?Ec():void 0})}const Ct=fi(()=>{Y&&St(Y.dialog)});oj(()=>{pi(window,"resize",Ct),ne.current==null||ne.current()});const le=()=>{V.current=!0},$s=te=>{V.current&&Y&&te.target===Y.dialog&&(Z.current=!0),V.current=!1},mr=()=>{K(!0),ne.current=gm(Y.dialog,()=>{K(!1)})},ah=te=>{te.target===te.currentTarget&&mr()},ih=te=>{if(f==="static"){ah(te);return}if(Z.current||te.target!==te.currentTarget){Z.current=!1;return}b==null||b()},oh=te=>{y?g==null||g(te):(te.preventDefault(),f==="static"&&mr())},lh=(te,hr)=>{te&&St(te),E==null||E(te,hr)},ch=te=>{ne.current==null||ne.current(),N==null||N(te)},dh=(te,hr)=>{D==null||D(te,hr),fm(window,"resize",Ct)},uh=te=>{te&&(te.style.display=""),O==null||O(te),pi(window,"resize",Ct)},mh=m.useCallback(te=>r.jsx("div",we(re({},te),{className:He(`${s}-backdrop`,k,!p&&"show")})),[p,k,s]),Vi=re(re({},t),M);Vi.display="block";const hh=te=>r.jsx("div",we(re({role:"dialog"},te),{style:Vi,className:He(e,s,L&&`${s}-static`,!p&&"show"),onClick:f?ih:void 0,onMouseUp:$s,"data-bs-theme":l,"aria-label":u,"aria-labelledby":o,"aria-describedby":d,children:r.jsx(c,we(re({},U),{onMouseDown:le,className:n,contentClassName:a,children:i}))}));return r.jsx(Sm.Provider,{value:ur,children:r.jsx(kj,{show:h,ref:B,backdrop:f,container:v,keyboard:!0,autoFocus:w,enforceFocus:S,restoreFocus:T,restoreFocusOptions:C,onEscapeKeyDown:oh,onShow:x,onHide:b,onEnter:lh,onEntering:dh,onEntered:P,onExit:ch,onExiting:j,onExited:uh,manager:wt(),transition:p?Mj:void 0,backdropTransition:p?Fj:void 0,renderBackdrop:mh,renderDialog:hh})})});Tm.displayName="Modal";const Ee=Object.assign(Tm,{Body:wm,Header:Nm,Title:Im,Footer:Cm,Dialog:Ui,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),zj=()=>r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",role:"banner","aria-label":"Inventory management header",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Inventory Management"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage your inventory items and equipment"})]}),r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"Item scanner controls",children:[r.jsx("span",{className:"text-gray-600",children:"Item Scanner"}),r.jsx(Xd,{to:"/inventory/scanner",children:r.jsx(zi,{variant:"success",className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] focus:ring-offset-1","aria-label":"Scan new inventory item using barcode scanner",tabIndex:0,children:"Inventory Scanner"})})]})})]}),Lj=()=>r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})});var Bj=Object.defineProperty,qj=Object.defineProperties,Uj=Object.getOwnPropertyDescriptors,Rc=Object.getOwnPropertySymbols,Hj=Object.prototype.hasOwnProperty,Vj=Object.prototype.propertyIsEnumerable,Ac=(s,e,t)=>e in s?Bj(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Wj=(s,e)=>{for(var t in e||(e={}))Hj.call(e,t)&&Ac(s,t,e[t]);if(Rc)for(var t of Rc(e))Vj.call(e,t)&&Ac(s,t,e[t]);return s},Gj=(s,e)=>qj(s,Uj(e));const Oc=()=>{hw();const s=ar(),{tools:e,supplies:t,equipment:n,officeHardware:a}=s,i=[...e,...t,...n,...a],c=i.map(l=>{var o;return Gj(Wj({},l),{category:(o=l.category)!=null?o:"uncategorized"})});return{allItems:i,itemsWithCategory:c,tools:e,supplies:t,equipment:n,officeHardware:a,totalUniqueItems:e.length+t.length+n.length+a.length,refreshData:s.refreshData,getAllItems:()=>i,getItemsByCategory:l=>{switch(l){case"tools":return e;case"supplies":return t;case"equipment":return n;case"officeHardware":return a;default:return[]}}}};var Kj=Object.defineProperty,$c=Object.getOwnPropertySymbols,Qj=Object.prototype.hasOwnProperty,Yj=Object.prototype.propertyIsEnumerable,Mc=(s,e,t)=>e in s?Kj(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Fc=(s,e)=>{for(var t in e||(e={}))Qj.call(e,t)&&Mc(s,t,e[t]);if($c)for(var t of $c(e))Yj.call(e,t)&&Mc(s,t,e[t]);return s},Jj=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Xj=s=>({items:[],categories:[],selectedItems:[],isLoading:!1,isCategoriesLoading:!1,setItems:e=>s({items:e,inventoryItems:e}),setCategories:e=>s({categories:e}),addItem:e=>s(t=>({items:[...t.items,e],inventoryItems:[...t.items,e]})),updateItem:(e,t)=>s(n=>{const a=n.items.map(i=>i.id===e?Fc(Fc({},i),t):i);return{items:a,inventoryItems:a}}),deleteItem:e=>s(t=>{const n=t.items.filter(a=>a.id!==e);return{items:n,inventoryItems:n}}),addCategory:e=>s(t=>({categories:[...t.categories,e]})),removeCategory:e=>s(t=>({categories:t.categories.filter(n=>n!==e)})),setSelectedItems:e=>s({selectedItems:e}),setLoading:e=>s({isLoading:e}),setCategoriesLoading:e=>s({isCategoriesLoading:e}),setInventoryLoading:e=>s({isLoading:e}),refreshInventoryData:()=>Jj(null,null,function*(){console.log("Refreshing inventory data...")}),getFilteredItems:()=>[],getUniqueCategories:()=>[],inventoryItems:[]});var Zj=Object.defineProperty,eN=Object.defineProperties,tN=Object.getOwnPropertyDescriptors,zc=Object.getOwnPropertySymbols,rN=Object.prototype.hasOwnProperty,sN=Object.prototype.propertyIsEnumerable,Lc=(s,e,t)=>e in s?Zj(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,nN=(s,e)=>{for(var t in e||(e={}))rN.call(e,t)&&Lc(s,t,e[t]);if(zc)for(var t of zc(e))sN.call(e,t)&&Lc(s,t,e[t]);return s},aN=(s,e)=>eN(s,tN(e));const iN=s=>({activeTab:"tools",showFilters:!1,showTrackedOnly:!1,showFavoritesOnly:!1,expandedSections:{general:!0,purchase:!1,maintenance:!1,usage:!1},showFiltersPanel:!1,showAnalytics:!0,showBulkActions:!1,trackedItems:new Set,trackingData:new Map,setActiveTab:e=>s({activeTab:e}),setShowFilters:e=>s({showFilters:e}),setShowTrackedOnly:e=>s({showTrackedOnly:e}),setShowFavoritesOnly:e=>s({showFavoritesOnly:e}),setExpandedSections:e=>s({expandedSections:e}),toggleExpandedSection:e=>s(t=>({expandedSections:aN(nN({},t.expandedSections),{[e]:!t.expandedSections[e]})})),setShowFiltersPanel:e=>s({showFiltersPanel:e}),setShowAnalytics:e=>s({showAnalytics:e}),setShowBulkActions:e=>s({showBulkActions:e}),toggleTrackedItem:(e,t)=>s(n=>{const a=new Set(n.trackedItems),i=new Map(n.trackingData);return a.has(e)?(a.delete(e),i.delete(e)):(a.add(e),i.set(e,{doctor:t,timestamp:new Date().toISOString()})),{trackedItems:a,trackingData:i}}),setTrackedItems:e=>s({trackedItems:e}),setTrackingData:e=>s({trackingData:e})}),oN=s=>({showAddModal:!1,showTrackModal:!1,showUploadBarcodeModal:!1,showScanModal:!1,showDeleteModal:!1,itemToDelete:null,scanMode:null,scannedItems:[],setShowAddModal:e=>s({showAddModal:e}),setShowTrackModal:e=>s({showTrackModal:e}),setShowUploadBarcodeModal:e=>s({showUploadBarcodeModal:e}),setShowScanModal:e=>s({showScanModal:e}),setShowDeleteModal:e=>s({showDeleteModal:e}),setItemToDelete:e=>s({itemToDelete:e}),openDeleteModal:e=>s({showDeleteModal:!0,itemToDelete:e}),closeDeleteModal:()=>s({showDeleteModal:!1,itemToDelete:null}),setScanMode:e=>s({scanMode:e}),addScannedItem:e=>s(t=>({scannedItems:[...t.scannedItems,e]})),removeScannedItem:e=>s(t=>({scannedItems:t.scannedItems.filter(n=>n!==e)})),resetScannedItems:()=>s({scannedItems:[]}),openAddModal:()=>s({showAddModal:!0}),closeAddModal:()=>s({showAddModal:!1}),openTrackModal:()=>s({showTrackModal:!0}),closeTrackModal:()=>s({showTrackModal:!1}),openUploadBarcodeModal:()=>s({showUploadBarcodeModal:!0}),closeUploadBarcodeModal:()=>s({showUploadBarcodeModal:!1}),toggleUploadBarcodeModal:()=>s(e=>({showUploadBarcodeModal:!e.showUploadBarcodeModal})),openScanModal:()=>s({showScanModal:!0}),closeScanModal:()=>s({showScanModal:!1})}),lN=()=>{try{const s=localStorage.getItem("cliniio-favorites");return s?JSON.parse(s):[]}catch(s){return console.warn("Failed to load favorites from localStorage:",s),[]}},Bc=s=>{try{localStorage.setItem("cliniio-favorites",JSON.stringify(s))}catch(e){console.warn("Failed to save favorites to localStorage:",e)}},cN=s=>({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",favorites:lN(),showFavoritesOnly:!1,sortField:"name",sortDirection:"asc",setSearchQuery:e=>s({searchQuery:e,searchTerm:e}),setSearchTerm:e=>s({searchTerm:e,searchQuery:e}),setCategoryFilter:e=>s({categoryFilter:e}),setLocationFilter:e=>s({locationFilter:e}),setStatusFilter:e=>s({statusFilter:e}),setActiveFilter:e=>s({activeFilter:e}),setFavorites:e=>{s({favorites:e}),Bc(e)},toggleFavorite:e=>s(t=>{const n=t.favorites.includes(e)?t.favorites.filter(a=>a!==e):[...t.favorites,e];return Bc(n),{favorites:n}}),setShowFavoritesOnly:e=>s({showFavoritesOnly:e}),setSortField:e=>s({sortField:e}),setSortDirection:e=>s({sortDirection:e}),clearFilters:()=>s({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:""}),resetFilters:()=>s({searchQuery:"",searchTerm:"",categoryFilter:"",locationFilter:"",statusFilter:"",activeFilter:"",sortField:"name",sortDirection:"asc",showFavoritesOnly:!1}),clearSearch:()=>s({searchQuery:"",searchTerm:""})});var dN=Object.defineProperty,uN=Object.defineProperties,mN=Object.getOwnPropertyDescriptors,qc=Object.getOwnPropertySymbols,hN=Object.prototype.hasOwnProperty,pN=Object.prototype.propertyIsEnumerable,Uc=(s,e,t)=>e in s?dN(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,qa=(s,e)=>{for(var t in e||(e={}))hN.call(e,t)&&Uc(s,t,e[t]);if(qc)for(var t of qc(e))pN.call(e,t)&&Uc(s,t,e[t]);return s},fN=(s,e)=>uN(s,mN(e));function Hc(){return{id:"",itemName:"",category:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:0,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}}const gN=(s,e)=>({formData:Hc(),isEditMode:!1,isDirty:!1,setFormData:t=>s({formData:t,isDirty:!1}),mergeFormData:t=>{console.log("🔍 mergeFormData called with:",t),s(n=>({formData:qa(qa({},n.formData),t),isDirty:!0}))},updateField:(t,n)=>s(a=>({formData:fN(qa({},a.formData),{[t]:n}),isDirty:!0})),resetForm:()=>s({formData:Hc(),isEditMode:!1,isDirty:!1}),setEditMode:t=>s({isEditMode:t}),markAsDirty:()=>s({isDirty:!0}),markAsClean:()=>s({isDirty:!1}),openEditModal:t=>{var n;const{setFormData:a,setEditMode:i}=e(),c={id:t.id,itemName:t.name||t.item||"",category:t.category||"",location:t.location||"",status:t.status||"",quantity:t.quantity||1,unitCost:t.unit_cost||0,minimumQuantity:t.reorder_point||0,maximumQuantity:((n=t.data)==null?void 0:n.maximumQuantity)||0,supplier:t.supplier||"",barcode:t.barcode||"",sku:t.sku||"",description:t.description||"",notes:t.notes||"",updated_at:t.updated_at||new Date().toISOString(),createdAt:t.created_at||new Date().toISOString()};a(c),i(!0)},closeEditModal:()=>{const{resetForm:t}=e();t()}}),yN=s=>({currentPage:1,itemsPerPage:10,totalItems:0,setCurrentPage:e=>s({currentPage:e}),setItemsPerPage:e=>s({itemsPerPage:e,currentPage:1}),setTotalItems:e=>s({totalItems:e}),nextPage:()=>s(e=>{const t=Math.ceil(e.totalItems/e.itemsPerPage);return{currentPage:Math.min(e.currentPage+1,t)}}),previousPage:()=>s(e=>({currentPage:Math.max(e.currentPage-1,1)})),goToPage:e=>s(t=>{const n=Math.ceil(t.totalItems/t.itemsPerPage);return{currentPage:Math.max(1,Math.min(e,n))}}),resetPagination:()=>s({currentPage:1}),get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)},get startIndex(){return(this.currentPage-1)*this.itemsPerPage},get endIndex(){return Math.min(this.startIndex+this.itemsPerPage,this.totalItems)},get pagination(){return{currentPage:this.currentPage,pageSize:this.itemsPerPage}}});var vN=Object.defineProperty,Vc=Object.getOwnPropertySymbols,xN=Object.prototype.hasOwnProperty,bN=Object.prototype.propertyIsEnumerable,Wc=(s,e,t)=>e in s?vN(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_N=(s,e)=>{for(var t in e||(e={}))xN.call(e,t)&&Wc(s,t,e[t]);if(Vc)for(var t of Vc(e))bN.call(e,t)&&Wc(s,t,e[t]);return s};const wN=s=>({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1,setAnalyticsData:e=>s({analyticsData:e}),setLoadingAnalytics:e=>s({isLoadingAnalytics:e}),updateAnalytics:()=>{s(()=>({isLoadingAnalytics:!0})),setTimeout(()=>{s(e=>({isLoadingAnalytics:!1,analyticsData:_N({},e.analyticsData)}))},1e3)},resetAnalytics:()=>s({analyticsData:{totalItems:0,lowStockItems:0,outOfStockItems:0,expiredItems:0,categories:{},recentActivity:[]},isLoadingAnalytics:!1})});var SN=Object.defineProperty,Gc=Object.getOwnPropertySymbols,CN=Object.prototype.hasOwnProperty,jN=Object.prototype.propertyIsEnumerable,Kc=(s,e,t)=>e in s?SN(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Gt=(s,e)=>{for(var t in e||(e={}))CN.call(e,t)&&Kc(s,t,e[t]);if(Gc)for(var t of Gc(e))jN.call(e,t)&&Kc(s,t,e[t]);return s};const NN=Ft()((...s)=>Gt(Gt(Gt(Gt(Gt(Gt(Gt({},Xj(...s)),iN(...s)),oN(...s)),cN(...s)),gN(...s)),yN(...s)),wN(...s))),ot=()=>NN();function IN({scanMode:s,scannedItems:e,currentScannedItemIndex:t,setCurrentScannedItemIndex:n,resetScannedItems:a,handleCloseAddModal:i,handleOpenAddItemModalWithBarcode:c}){const l=m.useCallback(()=>{if(s==="add"&&e.length>0){const d=t+1;d<e.length?(n(d),c(e[d])):(n(0),a())}},[s,e,t,n,a,i,c]),o=m.useCallback(()=>{if(s==="add"&&e.length>0){const d=e[t],u=d.split("-"),h=u.length>=3?u.slice(2).join("-"):d;return{current:t+1,total:e.length,currentItemName:h}}},[s,e,t]);return{handleAddItemModalClosed:l,getProgressInfo:o}}const TN=s=>{if(!s)return null;const e=s.split("-");if(e.length>=3){const t=e[0].toUpperCase(),n=e[1],a=e.slice(2).join("-");let i="tools";if(t==="TOOL")i="tools";else if(t==="SUPPLY")i="supplies";else if(t==="EQUIP")i="equipment";else if(t==="HARDWARE")i="officeHardware";else if(t==="INV"){const c=a.toLowerCase();c.includes("scissors")||c.includes("forceps")||c.includes("scalpel")?i="tools":c.includes("bandage")||c.includes("gauze")||c.includes("tape")?i="supplies":c.includes("monitor")||c.includes("machine")||c.includes("device")?i="equipment":i="tools"}return{itemId:n,itemName:a,category:i}}return s.length>0?{itemId:s,itemName:s,category:"tools"}:null},Em=s=>{if(!s)return{item:"",category:"",toolId:"",location:"",cost:0,p2Status:"clean",barcode:""};const e=TN(s);return e?{item:e.itemName,category:e.category,toolId:e.itemId,location:"",cost:0,p2Status:"clean",barcode:s}:{item:s,category:"tools",toolId:s,location:"",cost:0,p2Status:"clean",barcode:s}},km=s=>{const e=Em(s);return{itemName:e.item,category:e.category,id:e.toolId,location:e.location,purchaseDate:"",vendor:"",cost:e.cost.toString(),warranty:"",maintenanceSchedule:"",lastServiced:"",nextDue:"",serviceProvider:"",assignedTo:"",status:e.p2Status,quantity:"1",notes:"",barcode:e.barcode}},Dm=s=>({id:s.id,itemName:s.itemName,category:s.category,location:s.location,status:s.status,quantity:parseInt(s.quantity)||1,unitCost:parseFloat(s.cost)||0,minimumQuantity:0,maximumQuantity:999,supplier:s.vendor,barcode:s.barcode,sku:"",description:"",notes:s.notes,updated_at:new Date().toISOString(),createdAt:s.purchaseDate||new Date().toISOString()}),EN=s=>({id:s.toolId,itemName:s.item,category:s.category,location:s.location,status:s.p2Status,quantity:1,unitCost:s.cost,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:s.barcode,sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()}),kN=()=>{const{scanMode:s,scannedItems:e,setScanMode:t,resetScannedItems:n,setShowScanModal:a,formData:i,setFormData:c,isEditMode:l}=ot(),[o,d]=m.useState(0),u=m.useCallback((f,y)=>{const g=Em(y),x=EN(g);c(x),f()},[c]),{getProgressInfo:h}=IN({scanMode:s,scannedItems:e,currentScannedItemIndex:o,setCurrentScannedItemIndex:d,resetScannedItems:n,handleCloseAddModal:()=>{},handleOpenAddItemModalWithBarcode:f=>u(()=>{},f)}),p=m.useCallback(()=>{t(null),n(),a(!0)},[t,n,a]);return{scanMode:s,scannedItems:e,currentScannedItemIndex:o,storeFormData:i,isEditMode:l,handleScanClick:p,handleOpenAddItemModalWithBarcode:u,getProgressInfo:h,setFormData:c,setScanMode:t,resetScannedItems:n,setShowScanModal:a}};function DN(){const s=m.useRef(null),e=m.useRef(new Set),[t,n]=m.useState(!1),a=m.useRef(!1);m.useEffect(()=>{if(!a.current)try{console.log("🔔 Setting up real-time inventory subscription via useInventoryRealtimeUpdates");const o=nt.subscribeToChanges();return s.current=o,n(!0),a.current=!0,()=>{s.current&&typeof s.current=="function"&&(s.current(),s.current=null),n(!1),a.current=!1}}catch(o){console.error("❌ Failed to set up real-time subscription in useInventoryRealtimeUpdates:",o),n(!1),a.current=!1}},[]);const i=m.useCallback(o=>(e.current.add(o),()=>{e.current.delete(o)}),[]),c=m.useCallback(o=>{e.current.delete(o)},[]),l=m.useCallback(()=>{e.current.forEach(o=>{try{o()}catch(d){console.error("Error in refresh callback:",d)}})},[]);return{registerRefreshCallback:i,unregisterRefreshCallback:c,triggerRefresh:l,isSubscribed:t}}function PN({openAddModal:s,closeAddModal:e,setEditMode:t,resetForm:n,setExpandedSections:a,setFormData:i}){const c=m.useCallback(()=>{s(),t(!1),a(Xi())},[s,t,a]),l=m.useCallback(()=>{e(),a(Xi())},[e,n,a]),o=m.useCallback(d=>{let u;const h=d.data;h!=null&&h.toolId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{toolId:h.toolId,p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location}:h!=null&&h.supplyId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{supplyId:h.supplyId,expiration:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location}:h!=null&&h.equipmentId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{equipmentId:h.equipmentId,lastServiced:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location}:h!=null&&h.hardwareId?u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{hardwareId:h.hardwareId,warranty:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location}:u={id:d.id||"",facility_id:"unknown",name:d.item,quantity:1,data:{toolId:"",p2Status:"available"},created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,unit_cost:0,category:d.category,status:"active",location:d.location},i(ep(u)),t(!0),s()},[i,t,s]);return{handleShowAddModal:c,handleCloseAddModal:l,handleEditClick:o}}const RN=({expandedSections:s,setExpandedSections:e,mergeFormData:t})=>({handleFormChangeWrapper:(a,i)=>{if(console.log("🛠 handleFormChangeWrapper invoked. Field:",a,"Value:",i,"mergeFormData type:",typeof t),typeof t!="function"){console.error("❌ mergeFormData is not a function inside useInventoryFormHandlers!");return}t(a==="category"?{category:i}:{[a]:i})},handleToggleSection:a=>{e(s.includes(a)?s.filter(i=>i!==a):[...s,a])}});function AN(s,e){return{handleToggleFavorite:m.useCallback(n=>{const a=tp(new Set(s),n);e(Array.from(a))},[s,e])}}const ON=()=>{const s=ar(),e=m.useMemo(()=>[...s.tools,...s.supplies,...s.equipment,...s.officeHardware],[s.tools,s.supplies,s.equipment,s.officeHardware]);return{getAllItems:()=>e,getItemsByCategory:t=>e.filter(a=>{var i;return((i=a.category)==null?void 0:i.toLowerCase())===t.toLowerCase()}),getFilteredItems:s.getFilteredData,getCategories:s.getCategories,fetchData:s.refreshData,inventoryData:e}};var $N=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Pm=()=>{const s=ot(),{formData:e,setFormData:t,isEditMode:n,setEditMode:a,favorites:i,setFavorites:c,expandedSections:l,setExpandedSections:o,openAddModal:d,closeAddModal:u,setActiveTab:h,showTrackedOnly:p,setShowTrackedOnly:f,showFavoritesOnly:y,setShowFavoritesOnly:g,searchQuery:x,setSearchQuery:b}=s,v=s.mergeFormData;typeof v!="function"&&console.error("❌ mergeFormData is NOT a function! Store might not be wired correctly."),ON();const{handleToggleSection:w,handleFormChangeWrapper:S}=RN({expandedSections:l,setExpandedSections:o,mergeFormData:v}),{handleToggleFavorite:T}=AN(i,c),{handleShowAddModal:C,handleCloseAddModal:P}=PN({openAddModal:d,closeAddModal:u,setEditMode:a,resetForm:()=>{},setExpandedSections:o,setFormData:t}),N=m.useCallback(A=>{var z,M;return((M=(z=nt.statusService).getStatusBadge)==null?void 0:M.call(z,A))||A},[]),j=m.useCallback(A=>{var z,M;return((M=(z=nt.statusService).getStatusText)==null?void 0:M.call(z,A))||A},[]),E=m.useCallback(A=>{var z,M,W;const L=K=>h(K);(W=(M=(z=nt.categoryService).createCategoryChangeHandler)==null?void 0:M.call(z,L))==null||W(A)},[h]),D=m.useCallback(()=>{var A,z,M;(M=(z=(A=nt.categoryService).createTrackedFilterHandler)==null?void 0:z.call(A,p,f))==null||M()},[p,f]),O=m.useCallback(()=>{var A,z,M;(M=(z=(A=nt.categoryService).createFavoritesFilterHandler)==null?void 0:z.call(A,y,g))==null||M()},[y,g]),k=m.useCallback(A=>b(A),[b]),$=m.useCallback(A=>{var z,M,W,L,K,V;const Z={itemName:A.name||A.item||"",category:A.category||"",id:A.id,location:A.location||"",createdAt:((z=A.data)==null?void 0:z.purchaseDate)||new Date().toISOString(),supplier:A.supplier||"",unit_cost:A.unit_cost||0,unitCost:A.unit_cost||0,notes:((M=A.data)==null?void 0:M.notes)||"",updated_at:((W=A.data)==null?void 0:W.lastServiced)||new Date().toISOString(),status:A.status||"",quantity:A.quantity||1,reorder_point:A.reorder_point||0,minimumQuantity:0,maximumQuantity:999,barcode:((L=A.data)==null?void 0:L.barcode)||"",sku:((K=A.data)==null?void 0:K.sku)||"",description:((V=A.data)==null?void 0:V.description)||""};t(Z),a(!0),d()},[t,a,d]),U=m.useCallback(()=>$N(null,null,function*(){if(!e)return;const A={name:e.itemName||"",category:e.category||"",location:e.location||"",status:e.status||"active",quantity:e.quantity||0,unit_cost:e.unitCost||0,description:e.description||"",notes:e.notes||"",supplier:e.supplier||"",barcode:e.barcode||"",sku:e.sku||"",updated_at:new Date().toISOString()};try{n&&e.id?yield at.processItemUpdate(e.id,A):yield at.processItemCreation(A),P()}catch(z){console.error("❌ Inventory save failed",z)}}),[e,n,P]),H=m.useMemo(()=>[],[]);return{showTrackedOnly:p,showFavoritesOnly:y,searchQuery:x,expandedSections:l,favorites:i,filteredTools:H,isEditMode:n,handleShowAddModal:C,handleCloseAddModal:P,handleEditItem:$,handleToggleTrackedFilter:D,handleToggleFavoritesFilter:O,onCategoryChange:E,setSearchTerm:k,handleSave:U,handleToggleSection:w,handleFormChangeWrapper:S,handleToggleFavorite:T,getStatusBadge:N,getStatusText:j}},MN=m.createContext(void 0),FN=s=>{const e=rp(),t="itemName"in s?s.itemName:s.name||s.item||"",n=s.category,a=s.id,i=s.location||"",c=s.unit_cost,l=typeof c=="number"?c.toString()||"0":c||"0",o=s.status||"",d=u=>{if(!u)return"";try{const h=new Date(u);return isNaN(h.getTime())?"":h.toISOString().split("T")[0]}catch(h){return console.error(h),""}};return{itemName:String(t||e.itemName||""),category:String(n||e.category||""),id:String(a||e.id||""),location:String(i||e.location||""),purchaseDate:d((s==null?void 0:s.createdAt)||e.createdAt),vendor:String((s==null?void 0:s.supplier)||e.supplier||""),cost:String(l),warranty:String((s==null?void 0:s.warranty)||""),maintenanceSchedule:String((s==null?void 0:s.maintenanceSchedule)||""),lastServiced:d((s==null?void 0:s.lastServiced)||e.updated_at),nextDue:String((s==null?void 0:s.nextDue)||""),serviceProvider:String((s==null?void 0:s.serviceProvider)||""),assignedTo:String((s==null?void 0:s.assignedTo)||""),status:String(o||e.status),quantity:String((s==null?void 0:s.quantity)||e.quantity),notes:String((s==null?void 0:s.notes)||e.notes||"")}},zN=()=>{const{showAddModal:s,showTrackModal:e,showUploadBarcodeModal:t,showScanModal:n,openAddModal:a,closeAddModal:i,openTrackModal:c,closeTrackModal:l,openUploadBarcodeModal:o,closeUploadBarcodeModal:d,openScanModal:u,closeScanModal:h,formData:p,setFormData:f,isEditMode:y,setEditMode:g,expandedSections:x,setExpandedSections:b,resetForm:v}=ot(),w=m.useCallback(()=>{g(!1),v(),a()},[g,v,a]),S=m.useCallback(O=>{g(!0),f(O),a()},[g,f,a]),T=m.useCallback(()=>{i(),g(!1),v()},[i,g,v]),C=m.useCallback(()=>{c()},[c]),P=m.useCallback(()=>{l()},[l]),N=m.useCallback(()=>{o()},[o]),j=m.useCallback(()=>{d()},[d]),E=m.useCallback(()=>{u()},[u]),D=m.useCallback(()=>{h()},[h]);return{showAddModal:s,showTrackModal:e,showUploadBarcodeModal:t,showScanModal:n,formData:p,isEditMode:y,expandedSections:x,openAddModal:w,openEditModal:S,openTrackModal:C,openUploadBarcodeModal:N,openScanModal:E,closeAddModal:T,closeTrackModal:P,closeUploadBarcodeModal:j,closeScanModal:D,setFormData:f,setExpandedSections:b}};var LN=Object.defineProperty,BN=Object.defineProperties,qN=Object.getOwnPropertyDescriptors,Qc=Object.getOwnPropertySymbols,UN=Object.prototype.hasOwnProperty,HN=Object.prototype.propertyIsEnumerable,Yc=(s,e,t)=>e in s?LN(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,xn=(s,e)=>{for(var t in e||(e={}))UN.call(e,t)&&Yc(s,t,e[t]);if(Qc)for(var t of Qc(e))HN.call(e,t)&&Yc(s,t,e[t]);return s},bn=(s,e)=>BN(s,qN(e)),VN=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const WN=()=>{const s=zN(),{refreshData:e}=ar(),{searchQuery:t,setSearchQuery:n,favorites:a,setFavorites:i,trackedItems:c,trackingData:l,toggleTrackedItem:o}=ot(),d=m.useCallback((C,P)=>{console.log(`🔄 Form field changed: ${C} = "${P}"`),s.setFormData(bn(xn({},s.formData),{[C]:P}))},[s]),u=m.useCallback(C=>{s.setExpandedSections(bn(xn({},s.expandedSections),{[C]:!s.expandedSections[C]}))},[s]),h=m.useCallback(C=>{const N=(E=>{if(!E)return 0;if(typeof E=="number")return E;const D=E.toString().replace(/[$,\s]/g,""),O=parseFloat(D);return isNaN(O)?0:O})(C.unitCost);console.log(`💰 Cost parsing: "${C.unitCost}" -> ${N}`);const j={name:C.itemName||null,category:C.category||null,location:C.location||void 0,status:C.status||void 0,quantity:C.quantity||1,unit_cost:N,facility_id:"unknown",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),reorder_point:null,expiration_date:null,data:{warranty:C.warranty,notes:C.notes,purchaseDate:C.purchaseDate,supplier:C.supplier,manufacturer:C.manufacturer,expiry_date:C.expiry_date,assetTag:C.assetTag,brand:C.brand,model:C.model,serialNumber:C.serialNumber}};return console.log("📦 Converted item to save:",j),j},[]),p=m.useCallback(()=>VN(null,null,function*(){try{console.log("🔄 Starting save process..."),console.log("📝 Form data:",s.formData);const C=h(bn(xn({},s.formData),{name:s.formData.itemName,category:s.formData.category,quantity:s.formData.quantity,location:s.formData.location,manufacturer:s.formData.manufacturer,supplier:s.formData.supplier,expiry_date:s.formData.expiry_date}));if(console.log("💾 Item to save:",C),s.isEditMode){if(s.formData.id){console.log("✏️ Updating existing item...");const P=yield nt.updateItem(s.formData.id,C);if(console.log("✅ Update response:",P),P.error)throw new Error(`Update failed: ${P.error}`);if(P.data){console.log("✅ Item updated successfully:",P.data);const j=(E=>{var D,O,k,$,U,H;return{itemName:E.name||E.item||"",category:E.category||"",id:E.id||"",location:E.location||"",createdAt:((D=E.data)==null?void 0:D.purchaseDate)||new Date().toISOString(),supplier:E.supplier||"",unit_cost:E.unit_cost||0,notes:((O=E.data)==null?void 0:O.notes)||"",updated_at:((k=E.data)==null?void 0:k.lastServiced)||new Date().toISOString(),status:E.status||"",quantity:E.quantity||1,reorder_point:E.reorder_point||0,barcode:(($=E.data)==null?void 0:$.barcode)||"",sku:((U=E.data)==null?void 0:U.sku)||"",description:((H=E.data)==null?void 0:H.description)||"",unitCost:E.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3}})(P.data);s.setFormData(j)}else throw new Error("Update succeeded but no data returned")}}else{console.log("➕ Creating new item...");const P=yield nt.createItem(C);if(console.log("✅ Create response:",P),P.error)throw new Error(`Create failed: ${P.error}`);if(!P.data)throw new Error("Create succeeded but no data returned")}console.log("✅ Item saved successfully!"),console.log("🔄 Refreshing inventory data..."),yield e(),console.log("✅ Inventory data refreshed!"),console.log("🧹 Clearing analytics cache..."),nt.clearCache(),console.log("✅ Analytics cache cleared!")}catch(C){console.error("❌ Failed to save item:",C)}}),[s,h,e]),f=m.useCallback(()=>{},[]),y=m.useCallback(C=>{const P=new Set(a);P.has(C)?P.delete(C):P.add(C),i(Array.from(P))},[a,i]),g=m.useCallback((C,P)=>{o(C,P)},[o]),x=m.useCallback(C=>{n(C)},[n]),b=m.useCallback(C=>{const N=(j=>{var E,D,O,k,$,U;return{itemName:j.name||j.item||"",category:j.category||"",id:j.id||"",location:j.location||"",createdAt:((E=j.data)==null?void 0:E.purchaseDate)||new Date().toISOString(),supplier:j.supplier||"",unit_cost:j.unit_cost||0,notes:((D=j.data)==null?void 0:D.notes)||"",updated_at:((O=j.data)==null?void 0:O.lastServiced)||new Date().toISOString(),status:j.status||"",quantity:j.quantity||1,reorder_point:j.reorder_point||0,barcode:((k=j.data)==null?void 0:k.barcode)||"",sku:(($=j.data)==null?void 0:$.sku)||"",description:((U=j.data)==null?void 0:U.description)||"",unitCost:j.unit_cost||0,minimumQuantity:0,maximumQuantity:1e3}})(C);s.openEditModal(N)},[s]),v=m.useCallback(()=>{s.openAddModal()},[s]),w=m.useCallback(()=>{s.openTrackModal()},[s]),S=m.useCallback(()=>{s.openUploadBarcodeModal()},[s]),T=m.useCallback(()=>{s.openScanModal()},[s]);return bn(xn({},s),{handleFormChange:d,toggleSection:u,handleSaveItem:p,handleDeleteItem:f,handleEditItem:b,handleAddItem:v,openAddModal:v,handleTrackItem:g,handleSearchChange:x,handleOpenTrackModal:w,handleOpenUploadBarcodeModal:S,handleOpenScanModal:T,toggleFavorite:y,searchQuery:t,favorites:a,trackedItems:c,trackingData:l})},Jc={ADD_ITEM:{id:"add-item-modal",title:"Add New Item",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!0,className:"inventory-modal"},SCAN_ITEM:{id:"scan-item-modal",title:"Scan Items",size:"lg",centered:!0,backdrop:"static",keyboard:!0,scrollable:!1,className:"scan-modal"}},Rm=[{id:"general",title:"General Information",defaultExpanded:!0,fields:[{name:"itemName",label:"Item Name",type:"text",required:!0,placeholder:"Enter item name"},{name:"category",label:"Category",type:"select",required:!0,options:[{value:"tools",label:"Tools"},{value:"supplies",label:"Supplies"},{value:"equipment",label:"Equipment"},{value:"officeHardware",label:"Office Hardware"}]},{name:"id",label:"ID / Serial #",type:"text",required:!0,placeholder:"Enter ID or serial number"},{name:"location",label:"Location",type:"location",required:!0}]},{id:"purchase",title:"Purchase Information",defaultExpanded:!1,fields:[{name:"purchaseDate",label:"Purchase Date",type:"date",required:!1},{name:"vendor",label:"Vendor",type:"text",required:!1,placeholder:"Enter vendor name"},{name:"unitCost",label:"Cost",type:"text",required:!0,placeholder:"Enter cost (e.g., $25.99, 15.50)"},{name:"warranty",label:"Warranty",type:"text",required:!1,placeholder:"Enter warranty information"}]},{id:"maintenance",title:"Maintenance Information",defaultExpanded:!1,fields:[{name:"maintenanceSchedule",label:"Maintenance Schedule",type:"text",required:!1,placeholder:"Enter maintenance schedule"},{name:"lastServiced",label:"Last Serviced",type:"date",required:!1},{name:"nextDue",label:"Next Due",type:"date",required:!1},{name:"serviceProvider",label:"Service Provider",type:"text",required:!1,placeholder:"Enter service provider"}]},{id:"usage",title:"Usage Information",defaultExpanded:!1,fields:[{name:"assignedTo",label:"Assigned To",type:"text",required:!1,placeholder:"Enter assigned person"},{name:"status",label:"Status",type:"select",required:!1,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Maintenance"}]},{name:"quantity",label:"Quantity",type:"number",required:!0,placeholder:"Enter quantity",validation:{min:0}},{name:"notes",label:"Notes",type:"textarea",required:!1,placeholder:"Additional notes"}]}],GN=s=>{const e={};for(const t of Rm)for(const n of t.fields)if(n.required&&!s[n.name]&&(e[n.name]=`${n.label} is required`),n.validation&&s[n.name]){const a=s[n.name];n.validation.min!==void 0&&Number(a)<n.validation.min&&(e[n.name]=`${n.label} must be at least ${n.validation.min}`),n.validation.max!==void 0&&Number(a)>n.validation.max&&(e[n.name]=`${n.label} must be at most ${n.validation.max}`),n.validation.pattern&&typeof a=="string"&&(new RegExp(n.validation.pattern).test(a)||(e[n.name]=n.validation.message||`${n.label} format is invalid`))}return e};var KN=Object.defineProperty,QN=Object.defineProperties,YN=Object.getOwnPropertyDescriptors,Xc=Object.getOwnPropertySymbols,JN=Object.prototype.hasOwnProperty,XN=Object.prototype.propertyIsEnumerable,Zc=(s,e,t)=>e in s?KN(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_n=(s,e)=>{for(var t in e||(e={}))JN.call(e,t)&&Zc(s,t,e[t]);if(Xc)for(var t of Xc(e))XN.call(e,t)&&Zc(s,t,e[t]);return s},wn=(s,e)=>QN(s,YN(e));const ZN=()=>{const[s,e]=m.useState({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1}),t=()=>{if(!navigator.geolocation){e(a=>wn(_n({},a),{error:"Geolocation is not supported by this browser.",isLoading:!1}));return}e(a=>wn(_n({},a),{isLoading:!0,error:null})),navigator.geolocation.getCurrentPosition(a=>{e({latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,error:null,isLoading:!1})},a=>{let i="Unknown error occurred";switch(a.code){case a.PERMISSION_DENIED:i="Location access denied. Please enable location services.";break;case a.POSITION_UNAVAILABLE:i="Location information unavailable.";break;case a.TIMEOUT:i="Location request timed out.";break}e(c=>wn(_n({},c),{error:i,isLoading:!1}))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},n=()=>{e({latitude:null,longitude:null,accuracy:null,error:null,isLoading:!1})};return wn(_n({},s),{getCurrentLocation:t,clearLocation:n})};var eI=Object.defineProperty,tI=Object.defineProperties,rI=Object.getOwnPropertyDescriptors,ed=Object.getOwnPropertySymbols,sI=Object.prototype.hasOwnProperty,nI=Object.prototype.propertyIsEnumerable,td=(s,e,t)=>e in s?eI(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ua=(s,e)=>{for(var t in e||(e={}))sI.call(e,t)&&td(s,t,e[t]);if(ed)for(var t of ed(e))nI.call(e,t)&&td(s,t,e[t]);return s},rd=(s,e)=>tI(s,rI(e));const Hi=Ft()(Yn((s,e)=>({rooms:[],addRoom:t=>{const n=rd(Ua({},t),{id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});s(a=>({rooms:[...a.rooms,n]}))},updateRoom:(t,n)=>{s(a=>({rooms:a.rooms.map(i=>i.id===t?rd(Ua(Ua({},i),n),{updatedAt:new Date().toISOString()}):i)}))},deleteRoom:t=>{s(n=>({rooms:n.rooms.filter(a=>a.id!==t)}))},getActiveRooms:()=>e().rooms.filter(t=>t.isActive),getRoomsByDepartment:t=>e().rooms.filter(n=>n.department===t&&n.isActive),getRoomByBarcode:t=>e().rooms.find(n=>n.barcode===t&&n.isActive)}),{name:"room-storage"})),aI=Object.freeze(Object.defineProperty({__proto__:null,useRoomStore:Hi},Symbol.toStringTag,{value:"Module"})),iI=({value:s,onChange:e,placeholder:t="Select location or use GPS",className:n=""})=>{const[a,i]=m.useState(!1),[c,l]=m.useState("room"),{getCurrentLocation:o,latitude:d,longitude:u,accuracy:h,isLoading:p}=ZN(),{getActiveRooms:f}=Hi(),y=f(),g=S=>{l(S),S==="gps"?o():S==="manual"&&e("")},x=S=>{e(S),i(!1)},b=()=>{if(d&&u){const S=`GPS: ${d.toFixed(6)}, ${u.toFixed(6)}`;e(S),i(!1)}},v=S=>{e(S.target.value)},w=()=>c==="gps"&&d&&u?`GPS: ${d.toFixed(6)}, ${u.toFixed(6)}`:s;return r.jsxs("div",{className:`relative ${n}`,children:[r.jsxs("div",{className:"flex flex-col space-y-2",children:[r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{type:"button",onClick:()=>g("room"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="room"?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[r.jsx(I,{path:hu,size:.8,className:"inline mr-1"}),"Room"]}),r.jsxs("button",{type:"button",onClick:()=>g("gps"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="gps"?"bg-green-100 text-green-700 border border-green-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[r.jsx(I,{path:sp,size:.8,className:"inline mr-1"}),"GPS"]}),r.jsx("button",{type:"button",onClick:()=>g("manual"),className:`px-3 py-1 text-xs rounded-md transition-colors ${c==="manual"?"bg-purple-100 text-purple-700 border border-purple-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:"Manual"})]}),c==="room"&&r.jsxs("div",{className:"relative",children:[r.jsxs("button",{type:"button",onClick:()=>i(!a),className:"w-full px-3 py-2 text-left border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("span",{className:s?"text-gray-900":"text-gray-500",children:s||t}),r.jsx(I,{path:Ds,size:1,className:"float-right mt-1"})]}),a&&r.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:y.length>0?y.map(S=>r.jsxs("button",{type:"button",onClick:()=>x(S.name),className:"w-full px-3 py-2 text-left hover:bg-gray-100 focus:outline-none focus:bg-gray-100",children:[r.jsx("div",{className:"font-medium text-gray-900",children:S.name}),r.jsxs("div",{className:"text-sm text-gray-500",children:[S.department," • ",S.floor]})]},S.id)):r.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No rooms available"})})]}),c==="gps"&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("button",{type:"button",onClick:o,disabled:p,className:"w-full px-3 py-2 text-sm bg-green-100 text-green-700 border border-green-300 rounded-md hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:p?"Getting location...":"Get Current Location"}),d&&u&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:[r.jsxs("div",{children:["Latitude: ",d.toFixed(6)]}),r.jsxs("div",{children:["Longitude: ",u.toFixed(6)]}),h&&r.jsxs("div",{children:["Accuracy: ±",Math.round(h),"m"]})]}),r.jsx("button",{type:"button",onClick:b,className:"w-full px-3 py-2 text-sm bg-blue-100 text-blue-700 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Use This Location"})]})]}),c==="manual"&&r.jsx("input",{type:"text",value:s,onChange:v,placeholder:"Enter location manually",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s&&r.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Current location: ",w()]})]})},oI=({field:s,value:e,onChange:t})=>{var n,a,i;const c=l=>{t(l.target.value)};switch(s.type){case"text":return r.jsx("input",{type:"text",className:"form-control py-1 px-2 text-sm",placeholder:s.placeholder,value:e||"",onChange:c,required:s.required});case"number":return r.jsx("input",{type:"number",className:"form-control py-1 px-2 text-sm",placeholder:s.placeholder,value:e||"",onChange:c,required:s.required,min:(n=s.validation)==null?void 0:n.min,max:(a=s.validation)==null?void 0:a.max});case"date":return r.jsx("input",{type:"date",className:"form-control py-1 px-2 text-sm",value:e||"",onChange:c,required:s.required});case"select":return r.jsxs("select",{className:"form-select py-1 px-2 text-sm",value:e||"",onChange:c,required:s.required,children:[r.jsxs("option",{value:"",children:["Select ",s.label.toLowerCase()]}),(i=s.options)==null?void 0:i.map(l=>r.jsx("option",{value:l.value,children:l.label},l.value))]});case"textarea":return r.jsx("textarea",{className:"form-control py-1 px-2 text-sm",placeholder:s.placeholder,rows:2,value:e||"",onChange:c,required:s.required});case"location":return r.jsx(iI,{value:e||"",onChange:t});default:return null}},lI=({section:s,expanded:e,onToggle:t,formData:n,handleFormChange:a})=>r.jsxs("div",{className:"mb-3 border border-gray-200 rounded-lg",children:[r.jsxs("button",{type:"button",onClick:t,className:"w-full p-3 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors rounded-t-lg",children:[r.jsx("h3",{className:"text-base font-semibold text-gray-800",children:s.title}),r.jsx(I,{path:e?Ds:ks,size:1,className:"text-gray-600"})]}),e&&r.jsx("div",{className:"p-3 border-t border-gray-200",children:r.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.fields.map(i=>r.jsxs("div",{children:[r.jsx("label",{htmlFor:`modal-${i.name}`,className:"block text-xs font-medium text-gray-700 mb-1",children:i.label}),r.jsx(oI,{field:i,value:n[i.name]||"",onChange:c=>a(i.name,c)})]},i.name))})})]}),sd=({modalConfig:s,show:e,onHide:t,formData:n,isEditMode:a,expandedSections:i,toggleSection:c,handleFormChange:l,onSave:o,progressInfo:d,sections:u,children:h})=>{const p=a?"Edit Item":s.title;return r.jsxs(Ee,{show:e,onHide:t,size:s.size,centered:s.centered,backdrop:s.backdrop,keyboard:s.keyboard,scrollable:s.scrollable,className:s.className,children:[r.jsx(Ee.Header,{closeButton:!0,children:r.jsxs(Ee.Title,{className:"flex items-center gap-3",children:[p,d&&r.jsxs("div",{className:"text-sm text-gray-500 font-normal",children:["(",d.current," of ",d.total,")"," ",d.currentItemName]})]})}),r.jsxs(Ee.Body,{className:"max-h-[70vh] overflow-y-auto",children:[d&&r.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Processing scanned items: ",d.current," of"," ",d.total]}),r.jsxs("span",{className:"text-xs text-blue-600",children:[Math.round(d.current/d.total*100),"% complete"]})]}),r.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${d.current/d.total*100}%`}})})]}),r.jsx("div",{style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:r.jsxs("form",{children:[u==null?void 0:u.map(f=>r.jsx(lI,{section:f,expanded:i[f.id]||!1,onToggle:()=>c(f.id),formData:n,handleFormChange:l},f.id)),h]})})]}),r.jsxs(Ee.Footer,{className:"pt-2",children:[r.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Cancel"}),o&&r.jsx("button",{onClick:o,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:a?"Update Item":"Save Item"}),r.jsx("button",{onClick:t,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 ml-2",children:"Close"})]})]})};var cI=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const dI=({show:s,onClose:e})=>{const[t,n]=m.useState(null),[a,i]=m.useState(!1),[c,l]=m.useState(null),[o,d]=m.useState(!1),[u,h]=m.useState(null),[p,f]=m.useState(0),{activeTab:y}=ot(),g=()=>{const S=`${(()=>{const N="barcode,name,category,location,quantity,status,purchaseDate,vendor,cost,notes";switch(y){case"tools":return`${N},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,assignedTo`;case"supplies":return`${N},expirationDate,reorderPoint,minimumStock`;case"equipment":return`${N},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,serialNumber`;case"officeHardware":return`${N},warranty,serialNumber,assignedTo`;default:return N}})()}
123456789,${y.slice(0,-1)} Name,${y},Location,1,Available,2024-01-01,Vendor Name,100.00,Notes`,T=new Blob([S],{type:"text/csv"}),C=window.URL.createObjectURL(T),P=document.createElement("a");P.href=C,P.download=`${y}_template.csv`,document.body.appendChild(P),P.click(),document.body.removeChild(P),window.URL.revokeObjectURL(C)},x=w=>{var S;const T=(S=w.target.files)==null?void 0:S[0];T&&T.type==="text/csv"&&(n(T),l(null),d(!1))},b=(w,S)=>{var T;const C=[];return(!((T=w.data)!=null&&T.barcode)||String(w.data.barcode).trim()==="")&&C.push(`Row ${S}: Barcode is required`),(!w.name||String(w.name).trim()==="")&&C.push(`Row ${S}: Name is required`),w.quantity&&(isNaN(Number(w.quantity))||Number(w.quantity)<0)&&C.push(`Row ${S}: Quantity must be a positive number`),w.unit_cost&&(isNaN(parseFloat(String(w.unit_cost)))||parseFloat(String(w.unit_cost))<0)&&C.push(`Row ${S}: Cost must be a positive number`),C},v=()=>cI(null,null,function*(){if(t){i(!0),l(null),d(!1),h(null),f(0);try{const S=(yield t.text()).split(`
`),T=S[0].split(",").map(B=>B.trim()),C=T.findIndex(B=>B.toLowerCase().includes("barcode")),P=T.findIndex(B=>B.toLowerCase().includes("name")),N=T.findIndex(B=>B.toLowerCase().includes("category")),j=T.findIndex(B=>B.toLowerCase().includes("location")),E=T.findIndex(B=>B.toLowerCase().includes("quantity")),D=T.findIndex(B=>B.toLowerCase().includes("status")),O=T.findIndex(B=>B.toLowerCase().includes("purchasedate")),k=T.findIndex(B=>B.toLowerCase().includes("vendor")),$=T.findIndex(B=>B.toLowerCase().includes("cost")),U=T.findIndex(B=>B.toLowerCase().includes("warranty")),H=T.findIndex(B=>B.toLowerCase().includes("maintenanceschedule")),A=T.findIndex(B=>B.toLowerCase().includes("lastserviced")),z=T.findIndex(B=>B.toLowerCase().includes("nextdue")),M=T.findIndex(B=>B.toLowerCase().includes("serviceprovider")),W=T.findIndex(B=>B.toLowerCase().includes("assignedto")),L=T.findIndex(B=>B.toLowerCase().includes("notes"));if(C===-1||P===-1)throw new Error("CSV must contain barcode and name columns");const K=[],V=[];for(let B=1;B<S.length;B++){const ye=S[B].trim();if(!ye)continue;const oe=ye.split(",").map(St=>St.trim());if(oe.length<T.length)continue;const ur={id:`csv-${Date.now()}-${B}`,name:oe[P],category:N!==-1?oe[N]:y,location:j!==-1?oe[j]:"Unknown",quantity:E!==-1&&parseInt(oe[E])||1,status:D!==-1?oe[D]:"Available",unit_cost:$!==-1&&parseFloat(oe[$])||0,updated_at:new Date().toISOString(),data:{barcode:oe[C],purchaseDate:O!==-1?oe[O]:new Date().toISOString().split("T")[0],vendor:k!==-1?oe[k]:"",warranty:U!==-1?oe[U]:"",maintenanceSchedule:H!==-1?oe[H]:"",lastServiced:A!==-1?oe[A]:"",nextDue:z!==-1?oe[z]:"",serviceProvider:M!==-1?oe[M]:"",assignedTo:W!==-1?oe[W]:"",notes:L!==-1?oe[L]:"Imported via CSV upload"}},wt=b(ur,B+1);V.push(...wt),wt.length===0&&K.push(ur)}if(V.length>0){h({success:!1,message:`Validation failed for ${V.length} items`,importedCount:0,failedCount:V.length,errors:V});return}let Z=0,ne=0;const Y=[];for(let B=0;B<K.length;B++){try{const ye=K[B];if(ye&&ye.id&&ye.name)yield nt.addInventoryItem(ye),Z++;else throw new Error("Invalid item data")}catch(ye){ne++,Y.push(`Row ${B+2}: ${ye instanceof Error?ye.message:"Import failed"}`)}f((B+1)/K.length*100)}const he={success:ne===0,message:ne===0?`Successfully imported ${Z} items`:`Imported ${Z} items, ${ne} failed`,importedCount:Z,failedCount:ne,errors:Y};h(he),d(ne===0),ne===0&&setTimeout(()=>{n(null),d(!1),h(null),f(0),e()},3e3)}catch(w){l(w instanceof Error?w.message:"Failed to upload CSV")}finally{i(!1)}}});return r.jsxs(Ee,{show:s,onHide:e,centered:!0,backdrop:"static",size:"lg",children:[r.jsx(Ee.Header,{closeButton:!0,className:"pb-2",children:r.jsxs(Ee.Title,{className:"text-lg",children:["Import ",y.charAt(0).toUpperCase()+y.slice(1)," CSV"]})}),r.jsxs(Ee.Body,{className:"py-3 pb-6",children:[r.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:r.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[r.jsx(I,{path:wi,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 1: Download Template"]})}),r.jsxs("div",{className:"p-3 border-t border-gray-200",children:[r.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Get the CSV template with all required columns for ",y," ","data."]}),r.jsxs("button",{onClick:g,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center",children:[r.jsx(I,{path:Ue,size:.8,className:"mr-2"}),"Download Template"]})]})]}),r.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:r.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[r.jsx(I,{path:Mn,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 2: Upload CSV"]})}),r.jsxs("div",{className:"p-3 border-t border-gray-200",children:[r.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Upload your filled CSV file to import ",y," into the database."]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{htmlFor:"csv-file-input",className:"block text-xs font-medium text-gray-700 mb-1",children:"Select CSV File"}),r.jsx("input",{id:"csv-file-input",type:"file",accept:".csv",onChange:x,className:"form-control py-1 px-2 text-sm"})]}),t&&r.jsxs("p",{className:"text-sm text-green-600 mb-2",children:["✓ Selected: ",t.name]}),c&&r.jsxs("p",{className:"text-sm text-red-600 mb-2",children:["✗ ",c]}),o&&r.jsx("p",{className:"text-sm text-green-600 mb-2",children:"✓ Items uploaded successfully!"}),a&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[r.jsx("span",{children:"Uploading..."}),r.jsxs("span",{children:[Math.round(p),"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-[#4ECDC4] h-2 rounded-full transition-all duration-300",style:{width:`${p}%`}})})]}),u&&r.jsxs("div",{className:`p-3 rounded-lg border ${u.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(I,{path:u.success?xt:de,size:1,className:`mr-2 ${u.success?"text-green-600":"text-red-600"}`}),r.jsx("span",{className:`font-medium ${u.success?"text-green-800":"text-red-800"}`,children:u.message})]}),r.jsxs("div",{className:"text-sm text-gray-600",children:[r.jsxs("p",{children:["Imported: ",u.importedCount," items"]}),r.jsxs("p",{children:["Failed: ",u.failedCount," items"]})]}),u.errors.length>0&&r.jsxs("div",{className:"mt-2",children:[r.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Errors:"}),r.jsxs("div",{className:"max-h-20 overflow-y-auto text-xs text-red-600",children:[u.errors.slice(0,5).map((w,S)=>r.jsxs("div",{children:["• ",w]},S)),u.errors.length>5&&r.jsxs("div",{children:["... and ",u.errors.length-5," more errors"]})]})]})]})]})]})]}),r.jsxs(Ee.Footer,{className:"pt-2",children:[r.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors duration-200",children:"Cancel"}),r.jsxs("button",{onClick:v,disabled:!t||a,className:"px-4 py-2 bg-[#4ECDC4] hover:bg-[#3db8b0] text-white rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[r.jsx(I,{path:Mn,size:.8,className:"mr-2"}),a?"Importing...":`Import ${y.charAt(0).toUpperCase()+y.slice(1)}`]})]})]})},uI=()=>{const{showAddModal:s,showUploadBarcodeModal:e,showScanModal:t,closeAddModal:n,closeUploadBarcodeModal:a,closeScanModal:i,formData:c,isEditMode:l,expandedSections:o,handleFormChange:d,toggleSection:u,handleSaveItem:h}=WN(),p=()=>{const y=GN(c);if(Object.keys(y).length===0)h();else{console.error("Validation errors:",y);return}},f=y=>{u(y)};return r.jsxs(r.Fragment,{children:[r.jsx(sd,{modalConfig:Jc.ADD_ITEM,show:s,onHide:n,formData:c,isEditMode:l,expandedSections:o,toggleSection:f,handleFormChange:d,onSave:p,sections:Rm}),r.jsx(dI,{show:e,onClose:a}),t&&r.jsx(sd,{modalConfig:Jc.SCAN_ITEM,show:t,onHide:i,formData:{itemName:"",category:"",id:"",location:"",status:"",quantity:1,unitCost:0,minimumQuantity:0,maximumQuantity:999,supplier:"",barcode:"",sku:"",description:"",notes:"",updated_at:new Date().toISOString(),createdAt:new Date().toISOString()},isEditMode:!1,expandedSections:{general:!1,purchase:!1,maintenance:!1,usage:!1},toggleSection:()=>{},handleFormChange:()=>{},children:r.jsxs("div",{className:"text-center p-4",children:[r.jsx("h4",{children:"Scan Items"}),r.jsx("p",{children:"Scan modal content would be implemented here"})]})})]})},mI=({isEditMode:s,formData:e,progressInfo:t})=>{const{expandedSections:n,handleCloseAddModal:a,handleSave:i,handleToggleSection:c,handleFormChangeWrapper:l}=Pm();return r.jsx(uI,{formData:e,isEditMode:s,expandedSections:n,handleCloseAddModal:a,handleSave:i,toggleSection:c,handleFormChange:l,progressInfo:t})};var hI=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Sn=(s,e="success")=>{switch(e){case"success":zs.success(s);break;case"warning":zs(s,{icon:"⚠️",style:{background:"#fef3c7",color:"#92400e"}});break;case"error":zs.error(s);break;default:zs(s)}},Am=({scanMode:s})=>{const{openAddModal:e,closeScanModal:t,setFormData:n,setEditMode:a,inventoryItems:i,refreshInventoryData:c}=ot(),l=m.useCallback(u=>{const h=i.find(p=>{var f;return((f=p.data)==null?void 0:f.barcode)===u||p.id===u});if(h)console.log("Item already exists:",h),Sn(`Item "${h.name}" already exists in inventory.`,"warning");else{const p=km(u),f=Dm(p);n(f),a(!1),t(),e()}},[i,n,a,t,e]),o=m.useCallback(u=>hI(null,null,function*(){try{const h=i.find(p=>{var f;return((f=p.data)==null?void 0:f.barcode)===u||p.id===u});h?window.confirm(`Are you sure you want to remove "${h.name}" from inventory?`)&&(yield pu.deleteItem(h.id),yield c(),console.log("Item removed from inventory:",h),Sn(`Successfully removed "${h.name}" from inventory.`,"success")):(console.log("Item not found in inventory:",u),Sn(`Item with barcode "${u}" not found in inventory.`,"error"))}catch(h){console.error("Error removing item from inventory:",h),Sn("Failed to remove item from inventory. Please try again.","error")}}),[i,c]);return{handleBarcodeScan:m.useCallback(u=>{s==="add"?l(u):s==="use"&&o(u)},[s,l,o]),handleAddInventoryWorkflow:l,handleUseInventoryWorkflow:o}},pI=({scanMode:s,onClose:e})=>r.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("h3",{className:"text-xl font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(ue,{path:qe,size:1.2,className:"text-[#4ECDC4] mr-3"}),s?"Inventory Scanner":"Scan Inventory"]})}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(ue,{path:Pe,size:1.2})})]}),fI=s=>s==="add"?"Add Inventory":"Use Inventory",gI=s=>`${s} item${s!==1?"s":""}`,yI=({scanMode:s,scannedItems:e,onSelectMode:t,onClearScannedItems:n,onRemoveScannedItem:a})=>s?r.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[r.jsx("h4",{className:"font-medium mb-2",children:"Scanner Active"}),r.jsx("div",{className:"bg-black h-32 rounded-lg flex items-center justify-center",children:r.jsx("div",{className:"text-white text-sm",children:"Camera Scanner"})})]}),e.length>0&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsxs("h4",{className:"font-medium",children:["Scanned Items (",gI(e.length),")"]}),r.jsx("button",{onClick:()=>{n&&n()},className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Clear All"})]}),r.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 hide-scrollbar",children:e.map(i=>r.jsxs("div",{className:"bg-gray-50 p-2 rounded text-sm flex items-center justify-between",children:[r.jsx("span",{className:"flex-1",children:i}),r.jsx("button",{onClick:()=>{a&&a(i)},className:"ml-2 p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors duration-200",title:"Remove item",children:r.jsx(ea.Icon,{path:ji,size:.8})})]},i))})]})]})}):r.jsx("div",{className:"p-6 overflow-y-auto flex-1 hide-scrollbar",children:r.jsxs("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Select the type of inventory operation you want to perform:"}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:r.jsxs("p",{className:"text-yellow-800 text-xs",children:["💡 ",r.jsx("strong",{children:"Tip:"}),' For items without barcodes, use the "Add Item" button in the appropriate category table.']})}),r.jsx("button",{onClick:()=>t("add"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:r.jsx(ea.Icon,{path:Ci,size:1.2,className:"text-green-600"})}),r.jsxs("div",{className:"text-left",children:[r.jsx("h4",{className:"font-semibold text-green-800 text-sm",children:"Add Inventory"}),r.jsx("p",{className:"text-xs text-green-600",children:"Scan barcode to add new items. If no barcode exists, you can add one manually."})]})]})}),r.jsx("button",{onClick:()=>t("use"),className:"w-full p-3 rounded-lg border-2 transition-all duration-200 border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:r.jsx(ea.Icon,{path:qn,size:1.2,className:"text-blue-600"})}),r.jsxs("div",{className:"text-left",children:[r.jsx("h4",{className:"font-semibold text-blue-800 text-sm",children:"Use Inventory"}),r.jsx("p",{className:"text-xs text-blue-600",children:"Scan barcode to remove items from inventory when they are used."})]})]})})]})});var nd=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const vI=({scanMode:s,scannedItems:e,onSelectMode:t})=>{const{openAddModal:n,closeScanModal:a,setFormData:i,setEditMode:c,inventoryItems:l}=ot(),o=()=>nd(null,null,function*(){if(s==="add"&&e.length>0){const d=e[0];if(l.find(f=>{var y;return((y=f.data)==null?void 0:y.barcode)===d||f.id===d})){alert(`Item with barcode ${d} already exists in inventory.`);return}const h=km(d),p=Dm(h);i(p),c(!1),a(),n()}else if(s==="use"&&e.length>0){const d=e.map(f=>nd(null,null,function*(){const y=l.find(g=>{var x;return((x=g.data)==null?void 0:x.barcode)===f||g.id===f});if(y)try{return yield pu.deleteItem(y.id),console.log("Successfully removed item from inventory:",y.name),{success:!0,item:y}}catch(g){return console.error("Failed to remove item:",y.name,g),{success:!1,item:y,error:g}}else return console.log("Item not found in inventory:",f),{success:!1,item:null,error:"Item not found"}})),u=yield Promise.all(d),h=u.filter(f=>f.success).length,p=u.filter(f=>!f.success).length;h>0&&alert(`Successfully removed ${h} item(s) from inventory.`),p>0&&alert(`Failed to remove ${p} item(s). Please check the console for details.`),a()}});return s?r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>o().catch(console.error),className:"flex-1 bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#4ECDC4] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:fI(s)}),r.jsx("button",{onClick:()=>t("add"),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200",children:"Back"})]})}):null},xI=({scanMode:s,scannedItems:e,onClose:t,onSelectMode:n,onScan:a,onProcess:i,onClearScannedItems:c,onOpenAddItemModal:l,onRemoveScannedItem:o})=>{Am({scanMode:s});const d=r.jsx(zn,{children:r.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[99999] p-4",style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:99999,backgroundColor:"rgba(0, 0, 0, 0.75)"},onClick:t,children:r.jsxs(se.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl overflow-hidden w-full max-w-md shadow-2xl max-h-[90vh] flex flex-col",onClick:u=>u.stopPropagation(),children:[r.jsx(pI,{scanMode:s,onClose:t}),r.jsx(yI,{scanMode:s,scannedItems:e,onSelectMode:n,onClearScannedItems:c,onRemoveScannedItem:o}),r.jsx(vI,{scanMode:s,scannedItems:e,onSelectMode:n,onProcess:i,onClose:t,onOpenAddItemModal:l})]})})});return Ts.createPortal(d,document.body)};function bI(){return r.jsx("div",{className:"text-red-600 text-sm p-4",children:"⚠️ Something went wrong loading the Scan Modal. Please refresh or try again later."})}const _I=()=>{const{showScanModal:s,scanMode:e,scannedItems:t,resetScannedItems:n,setScanMode:a,setShowScanModal:i,addScannedItem:c,removeScannedItem:l}=ot(),o=()=>{n(),a(null),i(!1)};return s?r.jsx(xI,{scanMode:e,scannedItems:t,onClose:o,onSelectMode:a,onScan:c,onProcess:()=>{},onClearScannedItems:n,onOpenAddItemModal:()=>{},onRemoveScannedItem:l}):null};function wI(){return r.jsx(qr,{FallbackComponent:bI,children:r.jsx(_I,{})})}var SI=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const CI=m.lazy(()=>q(()=>import("./InventoryTableSection-lMhbxIb_.js"),__vite__mapDeps([18,2,3,1,4,5,19]))),jI=m.lazy(()=>q(()=>import("./InventoryInsightsCard-BnnydXz1.js"),__vite__mapDeps([20,2,3,1,4,5]))),NI=m.lazy(()=>q(()=>import("./CategoriesCard-GHppL70t.js"),__vite__mapDeps([21,2,3,1,4,5]))),II=()=>{const{refreshData:s}=Oc(),{registerRefreshCallback:e}=DN();X.useEffect(()=>e(()=>{console.log("🔄 InventoryDashboard received real-time update, refreshing data..."),s()}),[s,e]);const{tools:t,supplies:n,equipment:a,officeHardware:i}=Oc(),{getProgressInfo:c}=kN(),{formData:l,activeTab:o}=ot(),d=m.useMemo(()=>FN(l),[l]),{expandedSections:u,handleCloseAddModal:h,handleSave:p,handleToggleSection:f,handleFormChangeWrapper:y,handleEditItem:g,isEditMode:x}=Pm(),{setActiveTab:b}=ot(),v=m.useMemo(()=>{switch(o){case"tools":return t||[];case"supplies":return n||[];case"equipment":return a||[];case"officeHardware":return i||[];default:return t||[]}},[o,t,n,a,i]),w={showTrackedOnly:!1,showFavoritesOnly:!1,handleShowAddModal:()=>{},handleCloseAddModal:h,handleToggleTrackedFilter:()=>{},handleToggleFavoritesFilter:()=>{},onCategoryChange:C=>b(C),searchTerm:"",expandedSections:u,favorites:[],filteredTools:[],setSearchTerm:()=>{},handleToggleFavorite:()=>{},handleSave:p,handleToggleSection:f,handleFormChangeWrapper:y,getStatusBadge:C=>C,getStatusText:C=>C},S=C=>SI(null,null,function*(){try{yield at.handleDeleteItem(C.id,()=>{console.log("Item deleted successfully"),s()},P=>{console.error("Failed to delete item:",P)})}catch(P){console.error("Error in delete handler:",P)}}),T={tools:t,supplies:n,equipment:a,officeHardware:i};return X.useEffect(()=>{console.log("🏠 InventoryDashboard insights data:",{tools:(t==null?void 0:t.length)||0,supplies:(n==null?void 0:n.length)||0,equipment:(a==null?void 0:a.length)||0,officeHardware:(i==null?void 0:i.length)||0,total:((t==null?void 0:t.length)||0)+((n==null?void 0:n.length)||0)+((a==null?void 0:a.length)||0)+((i==null?void 0:i.length)||0)})},[t,n,a,i]),r.jsx(MN.Provider,{value:w,children:r.jsx(qr,{fallback:r.jsx(Lj,{}),children:r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsx(zj,{}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[r.jsxs("div",{className:"flex flex-col gap-4 lg:w-1/4 pl-4",children:[r.jsx(m.Suspense,{fallback:r.jsx(js,{}),children:r.jsx(jI,{data:T})}),r.jsx(m.Suspense,{fallback:r.jsx(js,{}),children:r.jsx(NI,{onCategoryChange:C=>b(C),counts:{tools:(t==null?void 0:t.length)||0,supplies:(n==null?void 0:n.length)||0,equipment:(a==null?void 0:a.length)||0,officeHardware:(i==null?void 0:i.length)||0}})})]}),r.jsx("div",{className:"flex-1 pr-4",children:r.jsx(m.Suspense,{fallback:r.jsx(fu,{rows:8,columns:5}),children:r.jsx("div",{className:"bg-white rounded-lg shadow p-6 w-full max-w-full flex flex-col min-h-fit",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},role:"region","aria-label":"inventory table and controls",children:r.jsx(CI,{onEdit:g,onDelete:S,items:v})})})})]}),r.jsx(mI,{isEditMode:x,formData:d,progressInfo:c()}),r.jsx(wI,{})]})})})};function TI(){function s({children:t}){return r.jsx(bC,{children:r.jsx(Hr,{children:r.jsx(_C,{children:t})})})}function e(){return r.jsx(II,{})}return{ProviderTree:s,PageContent:e}}function EI(){const{ProviderTree:s,PageContent:e}=TI();return r.jsx(s,{children:r.jsx(e,{})})}var Ha=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const kI=()=>{var s;const[e,t]=m.useState(null),[n,a]=m.useState([]),[i,c]=m.useState(!1),[l,o]=m.useState(null);Am({scanMode:e});const d=()=>Ha(null,null,function*(){e&&(c(!0),o(null),setTimeout(()=>Ha(null,null,function*(){const g=["ITEM-001","ITEM-002","ITEM-003","ITEM-004","ITEM-005"],x=g[Math.floor(Math.random()*g.length)];try{e==="add"?n.includes(x)?o({type:"warning",message:`Item ${x} already scanned.`}):(a(b=>[...b,x]),o({type:"success",message:`Item ${x} scanned successfully! Ready to add to inventory.`})):e==="use"&&(n.includes(x)?(o({type:"success",message:`Item ${x} used successfully! Removed from inventory.`}),a(b=>b.filter(v=>v!==x))):o({type:"error",message:`Item ${x} not found in inventory.`}))}catch(b){o({type:"error",message:b instanceof Error?b.message:"Scan failed"})}finally{c(!1)}}),1e3))}),u=g=>Ha(null,null,function*(){if(g.trim()){c(!0),o(null);try{e==="add"?n.includes(g)?o({type:"warning",message:`Item ${g} already scanned.`}):(a(x=>[...x,g]),o({type:"success",message:`Item ${g} scanned successfully! Ready to add to inventory.`})):e==="use"&&(n.includes(g)?(o({type:"success",message:`Item ${g} used successfully! Removed from inventory.`}),a(x=>x.filter(b=>b!==g))):o({type:"error",message:`Item ${g} not found in inventory.`}))}catch(x){o({type:"error",message:x instanceof Error?x.message:"Manual scan failed"})}finally{c(!1)}}}),h=[{id:"add",name:"Add Inventory",icon:Ci,color:"green",description:"Add new items to inventory"},{id:"use",name:"Use Inventory",icon:qn,color:"blue",description:"Remove items from inventory"}],p=g=>{switch(g){case"success":return xt;case"error":return de;case"warning":return de;default:return qe}},f=g=>{switch(g){case"success":return"text-green-600";case"error":return"text-red-600";case"warning":return"text-yellow-600";default:return"text-gray-600"}},y=g=>{switch(g){case"success":return"bg-green-100 border-green-200";case"error":return"bg-red-100 border-red-200";case"warning":return"bg-yellow-100 border-yellow-200";default:return"bg-gray-100 border-gray-200"}};return r.jsxs(r.Fragment,{children:[r.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:()=>window.location.href="/inventory"}),r.jsx(se.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:r.jsx("div",{className:"h-full flex flex-col",children:r.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Inventory Scanner"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Scan items for inventory management"})]}),r.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",children:e?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`border rounded-lg p-4 ${e==="add"?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"}`,children:[r.jsxs("h3",{className:`font-semibold mb-1 ${e==="add"?"text-green-800":"text-blue-800"}`,children:[e.charAt(0).toUpperCase()+e.slice(1)," ","Operation"]}),r.jsx("p",{className:`text-sm ${e==="add"?"text-green-600":"text-blue-600"}`,children:(s=h.find(g=>g.id===e))==null?void 0:s.description})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("label",{htmlFor:"manual-barcode-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"Manual Barcode Entry"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{id:"manual-barcode-input",type:"text",placeholder:"Enter barcode manually...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyPress:g=>{if(g.key==="Enter"){const x=g.target;u(x.value),x.value=""}},disabled:i}),r.jsx("button",{onClick:()=>{const g=document.querySelector('input[placeholder="Enter barcode manually..."]');g&&(u(g.value),g.value="")},disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Scan"})]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[r.jsxs("div",{className:"text-center space-y-4",children:[r.jsxs("div",{className:"relative bg-black h-64 rounded-lg overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 to-black"}),r.jsx(se.div,{className:"absolute left-0 right-0 h-1 bg-[#4ECDC4]",animate:{top:["10%","90%","10%"],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),r.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-32 rounded-lg",children:[r.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),r.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),r.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),r.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),r.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),r.jsx("button",{onClick:d,disabled:i,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${i?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:r.jsx(I,{path:qe,size:1.5,className:`${i?"text-gray-400":"text-white"}`})})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:i?"Scanning...":"Click to Scan"}),r.jsx("p",{className:"text-gray-600 text-sm",children:i?"Position barcode in camera view":"Use camera to scan item barcode"})]})]}),l&&r.jsx(se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg border ${y(l.type)}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:p(l.type),size:1,className:f(l.type)}),r.jsx("span",{className:`font-medium ${f(l.type)}`,children:l.message})]})})]}),n.length>0&&r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsxs("h4",{className:"font-medium text-gray-800 mb-2",children:["Scanned Items (",n.length,")"]}),r.jsx("div",{className:"space-y-1",children:n.map((g,x)=>r.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-2",children:[r.jsx(I,{path:qe,size:.8,className:"text-gray-400"}),g]},x))})]}),r.jsx("div",{className:"flex justify-center",children:r.jsx("button",{onClick:()=>{t(null),a([]),o(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"← Back to Operation Selection"})})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Select Operation"}),r.jsx("div",{className:"space-y-3",children:h.map(g=>r.jsx("button",{onClick:()=>t(g.id),className:`w-full p-4 rounded-lg border-2 transition-all duration-200 text-left ${g.color==="green"?"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100":"border-blue-200 hover:border-blue-300 bg-blue-50 hover:bg-blue-100"}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${g.color==="green"?"bg-green-100":"bg-blue-100"}`,children:r.jsx(I,{path:g.icon,size:1.2,className:g.color==="green"?"text-green-600":"text-blue-600"})}),r.jsxs("div",{children:[r.jsx("h4",{className:`font-semibold text-sm ${g.color==="green"?"text-green-800":"text-blue-800"}`,children:g.name}),r.jsx("p",{className:`text-xs ${g.color==="green"?"text-green-600":"text-blue-600"}`,children:g.description})]})]})},g.id))})]})})]})})})]})},DI=()=>r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Refresh Page"})]})}),PI=({error:s,resetErrorBoundary:e})=>{const n=(a=>a.message.includes("fetch")||a.message.includes("network")?{title:"Connection Error",description:"Unable to connect to the server. Please check your internet connection.",suggestion:"Try refreshing the page or check your network connection.",severity:"warning"}:a.message.includes("permission")||a.message.includes("unauthorized")?{title:"Access Denied",description:"You don't have permission to access this feature.",suggestion:"Contact your administrator if you believe this is an error.",severity:"error"}:a.message.includes("timeout")?{title:"Request Timeout",description:"The request took too long to complete.",suggestion:"Try again in a moment. If the problem persists, contact support.",severity:"warning"}:{title:"Unexpected Error",description:"Something went wrong while loading the Environmental Clean module.",suggestion:"Try refreshing the page. If the problem continues, contact support.",severity:"error"})(s);return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:r.jsx("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${n.severity==="error"?"bg-red-100":"bg-yellow-100"}`,children:r.jsx(I,{path:de,size:2,className:n.severity==="error"?"text-red-600":"text-yellow-600"})}),r.jsx("h2",{className:`text-xl font-semibold mb-2 ${n.severity==="error"?"text-red-600":"text-yellow-600"}`,children:n.title}),r.jsx("p",{className:"text-gray-700 mb-4 leading-relaxed",children:n.description}),r.jsxs("details",{className:"mb-4 text-left",children:[r.jsxs("summary",{className:"cursor-pointer text-sm text-gray-500 hover:text-gray-700 flex items-center justify-center",children:[r.jsx(I,{path:np,size:.8,className:"mr-1"}),"Technical Details"]}),r.jsxs("div",{className:"mt-2 p-3 bg-gray-100 rounded text-xs font-mono text-gray-600 break-all",children:[s.message,s.stack&&r.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Stack trace:"}),r.jsx("div",{className:"mt-1",children:s.stack})]})]})]}),r.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["💡 ",n.suggestion]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsxs("button",{onClick:e,className:"flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[r.jsx(I,{path:it,size:.8,className:"mr-2"}),"Try Again"]}),r.jsxs("button",{onClick:()=>window.location.href="/",className:"flex items-center justify-center px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[r.jsx(I,{path:gu,size:.8,className:"mr-2"}),"Go Home"]})]}),r.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:r.jsxs("p",{className:"text-xs text-gray-500",children:["Still having trouble? Contact support at"," ",r.jsx("a",{href:"mailto:support@cliniio.com",className:"text-blue-600 hover:underline",children:"support@cliniio.com"})]})})]})})})};var Om=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function RI(){return Om(this,null,function*(){const{data:{user:s}}=yield _.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:e,error:t}=yield _.from("users").select("facility_id").eq("id",s.id).single();if(t||!e)throw new Error("Failed to get user facility");return e.facility_id})}class AI{static addTool(e,t,n,a,i){return Om(this,null,function*(){const c=yield RI(),{error:l}=yield _.from("tools").insert({current_phase:i,id:t,tool_name:n,barcode:a,status:"active",facility_id:c,current_cycle_id:e});if(l)throw new Error(`Failed to add tool: ${l.message}`)})}}var OI=Object.defineProperty,$I=Object.defineProperties,MI=Object.getOwnPropertyDescriptors,ad=Object.getOwnPropertySymbols,FI=Object.prototype.hasOwnProperty,zI=Object.prototype.propertyIsEnumerable,id=(s,e,t)=>e in s?OI(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,LI=(s,e)=>{for(var t in e||(e={}))FI.call(e,t)&&id(s,t,e[t]);if(ad)for(var t of ad(e))zI.call(e,t)&&id(s,t,e[t]);return s},BI=(s,e)=>$I(s,MI(e)),qI=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const UI=(s,e)=>{let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>s(...n),e)}},od=new Map,HI=1e3,VI=(s,e,t)=>{const n=`${s}:${e}:${JSON.stringify(t)}`,a=Date.now(),i=od.get(n);return i&&a-i<HI?!0:(od.set(n,a),!1)},Xe={log:UI((...s)=>qI(null,null,function*(){const[e,t,n]=s;if(VI(e,t,n)){console.log("Skipping duplicate audit event:",{category:e,action:t});return}try{if(!Pn()){console.warn("⚠️ Supabase not configured, skipping audit event logging");return}const{userId:a,facilityId:i}=yield Mt.getCurrentUserAndFacility(),{error:c}=yield _.from("audit_logs").insert({id:crypto.randomUUID(),module:e,table_name:e,action:t,record_id:null,user_id:a,facility_id:i,metadata:BI(LI({},n),{category:e,timestamp:new Date().toISOString()}),created_at:new Date().toISOString()});c?console.error("Failed to log audit event:",c):console.log("Audit event logged:",{category:e,action:t})}catch(a){console.error("Error logging audit event:",a)}}),100)};class Rt extends Error{constructor(e,t,n,a){super(e),this.code=t,this.statusCode=n,this.details=a,this.name="EnvironmentalCleanServiceError"}}const Kt={NETWORK_ERROR:"Unable to connect to the server. Please check your internet connection.",TIMEOUT_ERROR:"The request took too long to complete. Please try again.",UNAUTHORIZED:"You don't have permission to perform this action. Please contact your administrator.",NOT_FOUND:"The requested resource was not found.",VALIDATION_ERROR:"The provided data is invalid. Please check your input and try again.",SERVER_ERROR:"A server error occurred. Please try again later.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again."},vt=(s,e)=>{if(s instanceof Rt)return s;const t=s instanceof Error?s.message:String(s);return t.includes("fetch")||t.includes("network")||t.includes("ENOTFOUND")?new Rt(Kt.NETWORK_ERROR,"NETWORK_ERROR",void 0,{originalError:t,context:e}):t.includes("timeout")||t.includes("ETIMEDOUT")?new Rt(Kt.TIMEOUT_ERROR,"TIMEOUT_ERROR",void 0,{originalError:t,context:e}):t.includes("401")||t.includes("unauthorized")?new Rt(Kt.UNAUTHORIZED,"UNAUTHORIZED",401,{originalError:t,context:e}):t.includes("404")||t.includes("not found")?new Rt(Kt.NOT_FOUND,"NOT_FOUND",404,{originalError:t,context:e}):t.includes("422")||t.includes("validation")?new Rt(Kt.VALIDATION_ERROR,"VALIDATION_ERROR",422,{originalError:t,context:e}):t.includes("500")||t.includes("server error")?new Rt(Kt.SERVER_ERROR,"SERVER_ERROR",500,{originalError:t,context:e}):new Rt(Kt.UNKNOWN_ERROR,"UNKNOWN_ERROR",void 0,{originalError:t,context:e})},Va=s=>({pending:"Dirty",in_progress:"In Progress",completed:"Clean",verified:"Clean",clean:"Clean",failed:"Supervisor",cancelled:"Out of Service",dirty:"Dirty"})[s]||"Dirty",ld=s=>({Dirty:"dirty","In Progress":"in_progress",Clean:"clean","Out of Service":"cancelled",Supervisor:"pending",Isolation:"failed",Quarantine:"failed",Maintenance:"pending","Equipment Failure":"failed","Patient Occupied":"pending","Discharge Cleaning":"pending",Unassigned:"pending","Audit Required":"pending"})[s]||"dirty";var Dr=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Pr{static fetchRooms(){return Dr(this,null,function*(){try{const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select(`
          id,
          room_id,
          room_name,
          status,
          cleaning_type,
          scheduled_time,
          completed_time,
          quality_score,
          compliance_score,
          created_at,
          updated_at
        `).order("scheduled_time",{ascending:!1});if(t)throw t;return(e!=null?e:[]).map(a=>{var i,c,l,o,d;const u=Va(a.status);return{id:a.room_id||a.id,name:a.room_name||`Room ${a.room_id||a.id}`,status:u,metadata:{cleaningType:(i=a.cleaning_type)!=null?i:"",qualityScore:(c=a.quality_score)!=null?c:0,complianceScore:(l=a.compliance_score)!=null?l:0,scheduledTime:(o=a.scheduled_time)!=null?o:"",completedTime:(d=a.completed_time)!=null?d:void 0},createdAt:a.created_at,updatedAt:a.updated_at}})}catch(e){return console.warn("Environmental Clean rooms fetch failed, falling back to static data:",e),[{id:"room-1",name:"Operating Room 1",status:"pending",metadata:{cleaningType:"surgical",qualityScore:95,complianceScore:98,scheduledTime:new Date().toISOString(),completedTime:void 0},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"room-2",name:"Recovery Room A",status:"in_progress",metadata:{cleaningType:"standard",qualityScore:87,complianceScore:92,scheduledTime:new Date().toISOString(),completedTime:void 0},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"room-3",name:"ICU Room 3",status:"completed",metadata:{cleaningType:"intensive",qualityScore:99,complianceScore:100,scheduledTime:new Date().toISOString(),completedTime:new Date().toISOString()},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}})}static updateRoomStatus(e,t){return Dr(this,null,function*(){try{const{error:n}=yield _.from("environmental_cleans_enhanced").update({status:ld(t),updated_at:new Date().toISOString()}).eq("room_id",e);if(n)throw n;Xe.log("environmental_clean","room_status_updated",{roomId:e,status:t,timestamp:new Date().toISOString()})}catch(n){const a=vt(n,"updateRoomStatus");throw console.error("❌ Failed to update room status:",a),a}})}static createEnvironmentalClean(e){return Dr(this,null,function*(){var t,n,a,i;try{const{data:c,error:l}=yield _.from("environmental_cleans_enhanced").insert({room_id:(t=e.id)!=null?t:"",room_name:(n=e.name)!=null?n:"",status:"pending",cleaning_type:"routine",scheduled_time:new Date().toISOString(),checklist_items:[],completed_items:[],failed_items:[]}).select().single();if(l||!c)throw l!=null?l:new Error("Insert failed");const o={id:c.room_id,name:c.room_name||`Room ${c.room_id}`,status:Va(c.status),metadata:{cleaningType:(a=c.cleaning_type)!=null?a:"",scheduledTime:(i=c.scheduled_time)!=null?i:""},createdAt:c.created_at,updatedAt:c.updated_at};return Xe.log("environmental_clean","room_created",{roomId:o.id,roomName:o.name}),o}catch(c){const l=vt(c,"createEnvironmentalClean");throw console.error("❌ Failed to create environmental clean:",l),l}})}static updateEnvironmentalClean(e,t){return Dr(this,null,function*(){var n,a,i,c,l;try{const o={updated_at:new Date().toISOString()};t.name&&(o.room_name=t.name),t.status&&(o.status=ld(t.status));const{data:d,error:u}=yield _.from("environmental_cleans_enhanced").update(o).eq("room_id",e).select().single();if(u||!d)throw u!=null?u:new Error("Update failed");const h={id:d.room_id,name:d.room_name||`Room ${d.room_id}`,status:Va(d.status),metadata:{cleaningType:(n=d.cleaning_type)!=null?n:"",qualityScore:(a=d.quality_score)!=null?a:0,complianceScore:(i=d.compliance_score)!=null?i:0,scheduledTime:(c=d.scheduled_time)!=null?c:"",completedTime:(l=d.completed_time)!=null?l:void 0},createdAt:d.created_at,updatedAt:d.updated_at};return Xe.log("environmental_clean","room_updated",{roomId:h.id,roomName:h.name}),h}catch(o){const d=vt(o,"updateEnvironmentalClean");throw console.error("❌ Failed to update environmental clean:",d),d}})}static deleteEnvironmentalClean(e){return Dr(this,null,function*(){try{const{error:t}=yield _.from("environmental_cleans_enhanced").delete().eq("room_id",e);if(t)throw t;Xe.log("environmental_clean","room_deleted",{roomId:e})}catch(t){const n=vt(t,"deleteEnvironmentalClean");throw console.error("❌ Failed to delete environmental clean:",n),n}})}static completeRoomCleaning(e){return Dr(this,null,function*(){try{if(!e)throw new Error("Room ID is required");const{error:t}=yield _.from("environmental_cleans_enhanced").update({status:"completed",completed_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("room_id",e);if(t)throw t;Xe.log("environmental_clean","room_cleaning_completed",{roomId:e,timestamp:new Date().toISOString()})}catch(t){const n=vt(t,"completeRoomCleaning");throw console.error("❌ Error completing room cleaning:",n),n}})}}var Cn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class jn{static fetchAnalytics(){return Cn(this,null,function*(){try{console.log("📊 Fetching analytics from Supabase...");const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("status, completed_time, scheduled_time, created_at");if(t)throw t;const n=e||[],a=n.length,i=n.filter(b=>b.status==="clean"||b.status==="completed"||b.status==="verified").length,c=n.filter(b=>b.status==="dirty"||b.status==="pending").length,l=n.filter(b=>b.status==="in_progress").length,o=n.filter(b=>b.status==="biohazard").length,d=n.filter(b=>b.status==="theft").length,u=n.filter(b=>b.status==="low_inventory").length,h=n.filter(b=>b.status==="out_of_service").length,p=n.filter(b=>b.status==="public_areas").length,f=a>0?Math.round(i/a*100):0,y=n.filter(b=>b.completed_time&&b.scheduled_time);let g=0;if(y.length>0){const b=y.reduce((v,w)=>{const S=new Date(w.scheduled_time).getTime(),T=new Date(w.completed_time).getTime();return v+(T-S)},0);g=Math.round(b/y.length/(1e3*60))}const x={totalRooms:a,cleanRooms:i,dirtyRooms:c,inProgressRooms:l,biohazardRooms:o,theftRooms:d,lowInventoryRooms:u,outOfServiceRooms:h,publicAreas:p,cleaningEfficiency:f,averageCleaningTime:g,lastUpdated:new Date().toISOString()};return console.log("✅ Analytics fetched successfully:",x),x}catch(e){throw console.error("❌ Error fetching analytics:",e),e}})}static getRoomCountsByStatus(){return Cn(this,null,function*(){try{console.log("📊 Fetching room counts from Supabase...");const{data:e,error:t}=yield _.from("environmental_cleans_enhanced").select("status");if(t)throw t;const n=e||[],a={completed:n.filter(i=>i.status==="clean"||i.status==="completed").length,pending:n.filter(i=>i.status==="dirty"||i.status==="pending").length,in_progress:n.filter(i=>i.status==="in_progress").length,failed:n.filter(i=>i.status==="failed").length,cancelled:n.filter(i=>i.status==="cancelled").length,verified:n.filter(i=>i.status==="verified").length};return console.log("✅ Room counts fetched successfully:",a),a}catch(e){throw console.error("❌ Error getting room counts by status:",e),e}})}static getRecentlyCompletedCleanings(e=10){return Cn(this,null,function*(){try{const{data:t,error:n}=yield _.from("environmental_cleans_enhanced").select("room_name, completed_time, cleaner_id").eq("status","clean").not("completed_time","is",null).order("completed_time",{ascending:!1}).limit(e);if(n)throw n;return(t||[]).map(c=>({room:c.room_name||"Unknown Room",cleanedAt:c.completed_time,cleanedBy:c.cleaner_id?`Cleaner ${c.cleaner_id}`:"System"}))}catch(t){throw console.error("❌ Error getting recently completed cleanings:",t),t}})}static getCleaningEfficiencyTrends(e=7){return Cn(this,null,function*(){try{const t=new Date;t.setDate(t.getDate()-e);const{data:n,error:a}=yield _.from("environmental_cleans_enhanced").select("status, completed_time, scheduled_time, created_at").gte("created_at",t.toISOString()).order("created_at",{ascending:!1});if(a)throw a;const i=n||[],c={};return i.forEach(l=>{const o=new Date(l.created_at).toISOString().split("T")[0];c[o]||(c[o]={completed:0,total:0,efficiency:0}),c[o].total++,(l.status==="completed"||l.status==="verified")&&c[o].completed++}),Object.keys(c).forEach(l=>{const o=c[l];o.efficiency=o.total>0?Math.round(o.completed/o.total*100):0}),c}catch(t){throw console.error("❌ Error getting cleaning efficiency trends:",t),t}})}}var WI=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class GI{static fetchChecklists(){return WI(this,null,function*(){try{console.log("🔍 Fetching environmental cleaning checklists...");const{data:e,error:t}=yield _.from("environmental_cleaning_task_categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw console.error("❌ Supabase error:",t),t;return console.log("✅ Checklists fetched successfully:",(e==null?void 0:e.length)||0,"records"),(e||[]).map(n=>{var a;return{id:n.id,name:n.name,description:(a=n.data)==null?void 0:a.description,items:[],isActive:n.is_active,createdAt:n.created_at,updatedAt:n.updated_at}})}catch(e){throw console.error("❌ Error fetching checklists:",e),vt(e,"fetchChecklists")}})}}var cd=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class dd{static fetchRecentlyCleanedRooms(e=10){return cd(this,null,function*(){try{const{data:t,error:n}=yield _.from("environmental_cleans_enhanced").select(`
          room_name,
          completed_time,
          cleaner_id
        `).eq("status","clean").not("completed_time","is",null).order("completed_time",{ascending:!1}).limit(e);if(n)throw console.error("❌ Supabase error:",n),n;return(t||[]).map(i=>({room:i.room_name||"Unknown Room",cleanedAt:i.completed_time,cleanedBy:i.cleaner_id?`Cleaner ${i.cleaner_id}`:"System"}))}catch(t){console.error("❌ Raw error in fetchRecentlyCleanedRooms:",t);const n=vt(t,"fetchRecentlyCleanedRooms");throw console.error("❌ Failed to fetch recently cleaned rooms:",n),n}})}static scanRoomBarcode(e){return cd(this,null,function*(){try{if(!e||e.trim()==="")return{success:!1,message:"Please enter a valid barcode"};const{useRoomStore:t}=yield q(()=>Promise.resolve().then(()=>aI),void 0),a=t.getState().getRoomByBarcode(e.trim());return a?(Xe.log("environmental_clean","room_scan",{barcode:e,roomId:a.id,roomName:a.name}),{success:!0,room:{id:a.barcode||a.id,name:a.name,status:"dirty"},message:`Successfully scanned room: ${a.name}`}):{success:!1,message:`Room with barcode "${e}" not found. Please check the barcode or add the room in Settings.`}}catch(t){return console.error("❌ Error scanning room barcode:",t),{success:!1,message:"An error occurred while scanning the barcode. Please try again."}}})}}var KI=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class QI{static batchEnvironmentalCleanAction(e){return KI(this,arguments,function*({ids:t,action:n}){try{const a={updated_at:new Date().toISOString()};switch(n){case"mark_completed":a.status="completed",a.completed_time=new Date().toISOString();break;case"mark_in_progress":a.status="in_progress",a.started_time=new Date().toISOString();break;case"mark_verified":a.status="verified",a.verified_time=new Date().toISOString();break;default:throw new Error(`Unknown action: ${n}`)}const{error:i}=yield _.from("environmental_cleans_enhanced").update(a).in("room_id",t);if(i)throw i;return Xe.log("environmental_clean","batch_action",{action:n,roomIds:t,count:t.length}),{success:!0}}catch(a){const i=vt(a,"batchEnvironmentalCleanAction");throw console.error("❌ Failed to perform batch action:",i),i}})}}var YI=Object.defineProperty,JI=Object.defineProperties,XI=Object.getOwnPropertyDescriptors,ud=Object.getOwnPropertySymbols,ZI=Object.prototype.hasOwnProperty,eT=Object.prototype.propertyIsEnumerable,md=(s,e,t)=>e in s?YI(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,tT=(s,e)=>{for(var t in e||(e={}))ZI.call(e,t)&&md(s,t,e[t]);if(ud)for(var t of ud(e))eT.call(e,t)&&md(s,t,e[t]);return s},rT=(s,e)=>JI(s,XI(e));class zr{constructor(){this.usageData=new Map,this.STORAGE_KEY="inventory_usage_data",this.loadUsageData()}static getInstance(){return zr.instance||(zr.instance=new zr),zr.instance}loadUsageData(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e),n=Object.fromEntries(Object.entries(t).map(([a,i])=>{const c=i;return[a,rT(tT({},c),{lastUsed:new Date(c.lastUsed)})]}));this.usageData=new Map(Object.entries(n))}}catch(e){console.error(e),console.warn("Failed to load usage data:")}}saveUsageData(){try{const e=Object.fromEntries(this.usageData);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error(e),console.warn("Failed to save usage data:")}}getOrCreateUsageData(e){const t=this.usageData.get(e);if(!t){const n={itemId:e,usageCount:0,lastUsed:new Date,searchCount:0,favoriteCount:0,trackCount:0};return this.usageData.set(e,n),n}return t}trackItemView(e){const t=this.getOrCreateUsageData(e);t.usageCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemSearch(e){const t=this.getOrCreateUsageData(e);t.searchCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemFavorite(e){const t=this.getOrCreateUsageData(e);t.favoriteCount+=1,t.lastUsed=new Date,this.saveUsageData()}trackItemTrack(e){const t=this.getOrCreateUsageData(e);t.trackCount+=1,t.lastUsed=new Date,this.saveUsageData()}calculateSmartScore(e){const t=this.usageData.get(e);if(!t)return 0;const n=new Date;let a;try{a=t.lastUsed instanceof Date?t.lastUsed:new Date(t.lastUsed),isNaN(a.getTime())&&(a=new Date)}catch(l){console.error(l),a=new Date}const i=(n.getTime()-a.getTime())/(1e3*60*60*24);let c=t.usageCount*10;return i<=7&&(c+=50),c+=t.searchCount*5,c+=t.favoriteCount*20,c+=t.trackCount*15,i>30&&(c*=.8),Math.round(c)}getSmartRanking(e){return[...e].sort((t,n)=>{var a,i,c,l,o,d,u,h;const p=t.toolId||t.supplyId||t.equipmentId||t.hardwareId||((a=t.data)==null?void 0:a.toolId)||((i=t.data)==null?void 0:i.supplyId)||((c=t.data)==null?void 0:c.equipmentId)||((l=t.data)==null?void 0:l.hardwareId)||"",f=n.toolId||n.supplyId||n.equipmentId||n.hardwareId||((o=n.data)==null?void 0:o.toolId)||((d=n.data)==null?void 0:d.supplyId)||((u=n.data)==null?void 0:u.equipmentId)||((h=n.data)==null?void 0:h.hardwareId)||"",y=this.calculateSmartScore(p);return this.calculateSmartScore(f)-y})}getUsageStats(){return Object.fromEntries(this.usageData)}clearUsageData(){this.usageData.clear(),localStorage.removeItem(this.STORAGE_KEY)}}const sT=zr.getInstance(),nT=Object.freeze(Object.defineProperty({__proto__:null,usageTrackingService:sT},Symbol.toStringTag,{value:"Module"}));var ke=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class _s{static fetchRooms(){return ke(this,null,function*(){return Pr.fetchRooms()})}static fetchChecklists(){return ke(this,null,function*(){return GI.fetchChecklists()})}static updateRoomStatus(e,t){return ke(this,null,function*(){return Pr.updateRoomStatus(e,t)})}static completeRoomCleaning(e){return ke(this,null,function*(){return Pr.completeRoomCleaning(e)})}static fetchAnalytics(){return ke(this,null,function*(){return jn.fetchAnalytics()})}static getRoomCountsByStatus(){return ke(this,null,function*(){return jn.getRoomCountsByStatus()})}static getRecentlyCompletedCleanings(e=10){return ke(this,null,function*(){return jn.getRecentlyCompletedCleanings(e)})}static getCleaningEfficiencyTrends(e=7){return ke(this,null,function*(){return jn.getCleaningEfficiencyTrends(e)})}static fetchRecentlyCleanedRooms(e=10){return ke(this,null,function*(){return dd.fetchRecentlyCleanedRooms(e)})}static scanRoomBarcode(e){return ke(this,null,function*(){return dd.scanRoomBarcode(e)})}static createEnvironmentalClean(e){return ke(this,null,function*(){return Pr.createEnvironmentalClean(e)})}static updateEnvironmentalClean(e,t){return ke(this,null,function*(){return Pr.updateEnvironmentalClean(e,t)})}static deleteEnvironmentalClean(e){return ke(this,null,function*(){return Pr.deleteEnvironmentalClean(e)})}static batchEnvironmentalCleanAction(e){return ke(this,arguments,function*({ids:t,action:n}){return QI.batchEnvironmentalCleanAction({ids:t,action:n})})}}var Nn=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const $m=()=>{const[s,e]=m.useState([]),[t,n]=m.useState([]),[a,i]=m.useState(null),[c,l]=m.useState(!1),[o,d]=m.useState(null),u=(g,x)=>{const b=vt(g,x);d(b.message),console.error(`❌ ${x} failed:`,b)},h=m.useCallback(()=>Nn(null,null,function*(){try{l(!0),d(null);const g=yield _s.fetchRooms();e(g)}catch(g){u(g,"fetchRooms")}finally{l(!1)}}),[]),p=m.useCallback(()=>Nn(null,null,function*(){try{l(!0),d(null);const g=yield _s.fetchChecklists();n(g)}catch(g){u(g,"fetchChecklists")}finally{l(!1)}}),[]),f=m.useCallback(()=>Nn(null,null,function*(){try{l(!0),d(null);const g=yield _s.fetchAnalytics();i(g)}catch(g){u(g,"fetchAnalytics")}finally{l(!1)}}),[]),y=m.useCallback(()=>Nn(null,null,function*(){Promise.all([h(),p(),f()]).catch(g=>{console.error("Background data refresh failed:",g)})}),[h,p,f]);return m.useEffect(()=>{const g=setTimeout(()=>{y()},0);return()=>clearTimeout(g)},[y]),{rooms:s,checklists:t,analytics:a,loading:c,error:o,fetchRooms:h,fetchChecklists:p,fetchAnalytics:f,refreshData:y}};function aT(s=[]){const[e,t]=m.useState(""),[n,a]=m.useState("all"),[i,c]=m.useState(1),l=20,o=m.useMemo(()=>s.filter(y=>{const g=e===""||y.id.toLowerCase().includes(e.toLowerCase())||y.status.toLowerCase().includes(e.toLowerCase()),x=n==="all"||y.status===n;return g&&x}),[s,e,n]),d=Math.ceil(o.length/l),u=m.useMemo(()=>{const y=(i-1)*l;return o.slice(y,y+l)},[o,i]),h=m.useCallback(y=>{t(y),c(1)},[]),p=m.useCallback(y=>{a(y),c(1)},[]),f=m.useCallback(y=>{c(y)},[]);return{searchTerm:e,status:n,paginatedItems:u,onSearchChange:h,onStatusChange:p,currentPage:i,totalPages:d,onPageChange:f}}var iT=Object.defineProperty,oT=Object.defineProperties,lT=Object.getOwnPropertyDescriptors,hd=Object.getOwnPropertySymbols,cT=Object.prototype.hasOwnProperty,dT=Object.prototype.propertyIsEnumerable,pd=(s,e,t)=>e in s?iT(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,fd=(s,e)=>{for(var t in e||(e={}))cT.call(e,t)&&pd(s,t,e[t]);if(hd)for(var t of hd(e))dT.call(e,t)&&pd(s,t,e[t]);return s},gd=(s,e)=>oT(s,lT(e)),uT=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function mT(){return Np({mutationFn:s=>uT(null,null,function*(){try{const e=new Date().toISOString(),t=s.operator||"Unknown Operator",n=gd(fd({},s),{timestamp:e,operator:t,module:"environmental_clean",category:"environmental_clean"}),a=[Promise.resolve().then(()=>{try{Xe.log("environmental_clean",s.action,gd(fd({},s.item),{operator:t,roomId:s.roomId,status:s.status,metadata:s.metadata,timestamp:e}))}catch(c){console.warn("Audit logger failed:",c)}})];return Promise.allSettled(a).catch(()=>{}),{success:!0,auditId:`EC-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:e}}catch(e){return console.error("❌ Failed to log Environmental Clean audit:",e),console.warn("⚠️ Audit logging failed, using console fallback:",s),{success:!1,error:e instanceof Error?e.message:"Unknown audit error"}}}),retry:2,retryDelay:1e3,onMutate:()=>{},onError:s=>{console.error("❌ Environmental Clean audit failed:",s)},onSuccess:s=>{}})}const hT=({onScan:s})=>r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Environmental Clean"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"Track and manage room cleaning workflows and maintain compliance standards."})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow p-4 flex items-center gap-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsx("span",{className:"text-gray-600",children:"Room Scanner"}),r.jsx(zi,{variant:"success",onClick:s,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] border-[#4ECDC4] hover:border-[#3db8b0] text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",children:"Scan Room"})]})]}),pt={borderLeftColor:"rgba(78, 205, 196, 0.5)",primaryIconColor:"#4ECDC4",defaultBorderColor:"border-gray-200"},Mm={error:{light:"#fee2e2"},info:{light:"#dbeafe"}},ws=s=>e=>{e.key==="Enter"&&(e.preventDefault(),s())},Fm=s=>e=>{e.key===" "&&(e.preventDefault(),s())},zm=(s,e,t=0)=>{const[n,a]=m.useState(t),i=m.useCallback(c=>{switch(c.key){case"ArrowDown":c.preventDefault(),a(l=>(l+1)%s.length);break;case"ArrowUp":c.preventDefault(),a(l=>(l-1+s.length)%s.length);break;case"Home":c.preventDefault(),a(0);break;case"End":c.preventDefault(),a(s.length-1);break;case"Enter":case" ":c.preventDefault(),e(s[n],n);break}},[s,n,e]);return{selectedIndex:n,setSelectedIndex:a,handleKeyDown:i}},pT=(s,e,t)=>{const n=m.useCallback(a=>{if(s)switch(a.key){case"Escape":e();break}},[s,e,t]);return m.useEffect(()=>(document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)),[n]),{handleKeyDown:n}},fT=(s,e)=>e?`${s} ${e}`:s;var gT=Object.defineProperty,yT=Object.defineProperties,vT=Object.getOwnPropertyDescriptors,yd=Object.getOwnPropertySymbols,xT=Object.prototype.hasOwnProperty,bT=Object.prototype.propertyIsEnumerable,vd=(s,e,t)=>e in s?gT(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_T=(s,e)=>{for(var t in e||(e={}))xT.call(e,t)&&vd(s,t,e[t]);if(yd)for(var t of yd(e))bT.call(e,t)&&vd(s,t,e[t]);return s},wT=(s,e)=>yT(s,vT(e)),ST=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Lm=m.createContext(void 0);function Bm(){const s=m.useContext(Lm);if(!s)throw new Error("useRoomStatus must be used within a RoomStatusProvider");return s}const CT=({children:s})=>{const{rooms:e}=$m(),[t,n]=m.useState([]),[a,i]=m.useState([]);m.useEffect(()=>{const h=e.map(p=>({id:p.id,status:p.status,name:p.name,metadata:p.metadata}));n(h)},[e]),m.useEffect(()=>{ST(null,null,function*(){try{const p=yield _s.fetchRecentlyCleanedRooms(10);i(p)}catch(p){console.error("Failed to fetch recently cleaned rooms:",p)}})},[]);const c=m.useCallback((h,p)=>{if(n(f=>f.map(y=>y.id===h?wT(_T({},y),{status:p}):y)),p==="Clean"){const f=e.find(x=>x.id===h),g={room:f?f.name:`Room ${h}`,cleanedAt:new Date().toISOString(),cleanedBy:"Current User"};i(x=>[g,...x.slice(0,9)])}},[e]),l=m.useCallback(()=>t.filter(h=>h.status==="Clean").length,[t]),o=m.useCallback(()=>t.filter(h=>h.status==="Dirty").length,[t]),d=m.useCallback(()=>{const h=t.length,p=l();return h>0?Math.round(p/h*100):0},[t,l]),u={rooms:t,recentlyCleanedRooms:a,updateRoomStatus:c,getCleanRoomsCount:l,getDirtyRoomsCount:o,getEfficiency:d};return r.jsx(Lm.Provider,{value:u,children:s})};var jT=Object.defineProperty,NT=Object.defineProperties,IT=Object.getOwnPropertyDescriptors,xd=Object.getOwnPropertySymbols,TT=Object.prototype.hasOwnProperty,ET=Object.prototype.propertyIsEnumerable,bd=(s,e,t)=>e in s?jT(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ms=(s,e)=>{for(var t in e||(e={}))TT.call(e,t)&&bd(s,t,e[t]);if(xd)for(var t of xd(e))ET.call(e,t)&&bd(s,t,e[t]);return s},_d=(s,e)=>NT(s,IT(e)),Qt=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const gi=Ft()(Yn((s,e)=>({statusTypes:[],isLoading:!1,error:null,fetchStatusTypes:()=>Qt(null,null,function*(){s({isLoading:!0,error:null});try{s({statusTypes:[{id:"1",name:"Available",color:"#10B981",icon:"check-circle",description:"Item is available and ready for use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"2",name:"In Use",color:"#6B7280",icon:"pause-circle",description:"Item is currently in use",isDefault:!0,isCore:!0,isPublished:!0,category:"general",requiresVerification:!1,autoTransition:!1,alertLevel:"low"},{id:"3",name:"Maintenance",color:"#F59E0B",icon:"wrench",description:"Item requires maintenance",isDefault:!0,isCore:!0,isPublished:!0,category:"maintenance",requiresVerification:!0,autoTransition:!1,alertLevel:"medium"},{id:"4",name:"Critical",color:"#EF4444",icon:"exclamation-triangle",description:"Item has critical issues",isDefault:!0,isCore:!0,isPublished:!0,category:"critical",requiresVerification:!0,autoTransition:!1,alertLevel:"critical"}],isLoading:!1})}catch(t){console.error("❌ Error fetching status types:",t),s({error:t instanceof Error?t.message:"Failed to fetch status types",isLoading:!1})}}),refreshStatusTypes:()=>Qt(null,null,function*(){yield e().fetchStatusTypes()}),getCoreStatusTypes:()=>e().statusTypes.filter(t=>t.isCore),getPublishedStatusTypes:()=>e().statusTypes.filter(t=>t.isPublished),getCustomStatusTypes:()=>e().statusTypes.filter(t=>!t.isCore),getStatusTypesByCategory:t=>e().statusTypes.filter(n=>n.category===t),getAllStatusTypes:()=>e().statusTypes,addStatusType:t=>Qt(null,null,function*(){try{const n=ms({id:Date.now().toString()},t);s(a=>({statusTypes:[...a.statusTypes,n]}))}catch(n){throw console.error("Error adding status type:",n),n}}),updateStatusType:(t,n)=>Qt(null,null,function*(){const a=e().statusTypes.find(i=>i.id===t);if(a&&a.isCore){console.warn("Cannot update core status types");return}try{s(i=>({statusTypes:i.statusTypes.map(c=>c.id===t?ms(ms({},c),n):c)}))}catch(i){throw console.error("Error updating status type:",i),i}}),deleteStatusType:t=>Qt(null,null,function*(){const n=e().statusTypes.find(a=>a.id===t);if(n&&n.isCore){console.warn("Cannot delete core status types");return}try{s(a=>({statusTypes:a.statusTypes.filter(i=>i.id!==t)}))}catch(a){throw console.error("Error deleting status type:",a),a}}),publishStatusType:t=>Qt(null,null,function*(){const n=e().statusTypes.find(a=>a.id===t);if(n&&n.isCore){console.warn("Core status types are always published");return}try{s(a=>({statusTypes:a.statusTypes.map(i=>i.id===t?_d(ms({},i),{isPublished:!0}):i)}))}catch(a){throw console.error("Error publishing status type:",a),a}}),unpublishStatusType:t=>Qt(null,null,function*(){const n=e().statusTypes.find(a=>a.id===t);if(n&&n.isCore){console.warn("Cannot unpublish core status types");return}try{s(a=>({statusTypes:a.statusTypes.map(i=>i.id===t?_d(ms({},i),{isPublished:!1}):i)}))}catch(a){throw console.error("Error unpublishing status type:",a),a}}),getStatusTypeById:t=>e().statusTypes.find(n=>n.id===t),getStatusTypeByName:t=>e().statusTypes.find(n=>n.name===t),getCategories:()=>{const t=new Set(e().statusTypes.map(n=>n.category).filter(Boolean));return Array.from(t).filter(n=>n!==void 0).sort()}}),{name:"status-types-storage",partialize:()=>({})})),qm=()=>{const s=gi();return m.useEffect(()=>{s.statusTypes.length===0&&!s.isLoading&&s.fetchStatusTypes()},[s]),s},Um=()=>({iconMap:{default:Ye,broom:vu,"progress-clock":lp,"check-circle":xt,biohazard:op,"shield-alert":Ye,"package-variant":ip,wrench:ap,"office-building":yu,"account-supervisor":Ye,"shield-lock":Ye,"shield-cross":Ye,"help-circle":Ye,"alert-circle":Ye,account:Ye,"clipboard-check":Ye},colorMap:{"#16a34a":"#16a34a","#dc2626":"#dc2626","#ca8a04":"#ca8a04","#9333ea":"#9333ea","#4b5563":"#4b5563","#b45309":"#b45309","#047857":"#047857","#8B5CF6":"#8B5CF6","#EA580C":"#EA580C","#9CA3AF":"#9CA3AF","#059669":"#059669","#3B82F6":"#3B82F6","#F59E0B":"#F59E0B"},bgColorMap:{"#16a34a":"bg-green-100","#dc2626":"bg-red-100","#ca8a04":"bg-yellow-100","#9333ea":"bg-purple-100","#4b5563":"bg-gray-100","#b45309":"bg-amber-100","#047857":"bg-emerald-100","#8B5CF6":"bg-purple-100","#EA580C":"bg-amber-100","#9CA3AF":"bg-gray-100","#059669":"bg-green-100","#3B82F6":"bg-blue-100","#F59E0B":"bg-amber-100"},borderColorMap:{"#16a34a":"border-green-500","#dc2626":"border-red-500","#ca8a04":"border-yellow-500","#9333ea":"border-purple-500","#4b5563":"border-gray-500","#b45309":"border-amber-500","#047857":"border-emerald-500","#8B5CF6":"border-purple-500","#EA580C":"border-amber-500","#9CA3AF":"border-gray-500","#059669":"border-green-500","#3B82F6":"border-blue-500","#F59E0B":"border-amber-500"},bgColorSelectedMap:{"#16a34a":"bg-green-50","#dc2626":"bg-red-50","#ca8a04":"bg-yellow-50","#9333ea":"bg-purple-50","#4b5563":"bg-gray-50","#b45309":"bg-amber-50","#047857":"bg-emerald-50","#8B5CF6":"bg-purple-50","#EA580C":"bg-amber-50","#9CA3AF":"bg-gray-50","#059669":"bg-green-50","#3B82F6":"bg-blue-50","#F59E0B":"bg-amber-50"},textColorMap:{"#16a34a":"text-green-600","#dc2626":"text-red-600","#ca8a04":"text-yellow-600","#9333ea":"text-purple-600","#4b5563":"text-gray-600","#b45309":"text-amber-600","#047857":"text-emerald-600","#8B5CF6":"text-purple-600","#EA580C":"text-amber-600","#9CA3AF":"text-gray-600","#059669":"text-green-600","#3B82F6":"text-blue-600","#F59E0B":"text-amber-600"}}),kT=(s,e)=>e[s]||Ye,DT=(s,e)=>e[s]||"bg-gray-100",PT=(s,e)=>e[s]||"text-gray-600",RT=()=>{const{getCoreStatusTypes:s,getPublishedStatusTypes:e,statusTypes:t,isLoading:n}=qm(),a=Um();return m.useMemo(()=>{const i=s(),c=e(),l=h=>h.map(p=>{const f=a.iconMap[p.icon]||a.iconMap.default;return{value:p.id,name:p.name,bgColor:a.bgColorMap[p.color]||a.bgColorMap.default,bgColorSelected:a.bgColorSelectedMap[p.color]||a.bgColorSelectedMap.default,borderColor:a.borderColorMap[p.color]||a.borderColorMap.default,color:a.colorMap[p.color]||a.colorMap.default,icon:f,isCore:p.isCore||!1}}),o=l(i),d=l(c),u=[...o];return d.forEach(h=>{u.find(p=>p.value===h.value)||u.push(h)}),u},[s,e,a.bgColorMap,a.bgColorSelectedMap,a.borderColorMap,a.colorMap,a.iconMap])},AT=()=>{const{getCoreStatusTypes:s,getPublishedStatusTypes:e}=qm(),t=Um();return m.useMemo(()=>{const n=s(),a=e();return[...n,...a.filter(c=>!c.isCore)].map(c=>({status:c.name,icon:kT(c.icon,t.iconMap),color:c.color,bgColor:DT(c.color,t.bgColorMap),textColor:PT(c.color,t.textColorMap),isCore:c.isCore}))},[s,e,t.bgColorMap,t.iconMap,t.textColorMap])},OT=(s,e)=>s.filter(t=>t.status===e).length,$T=(s,e)=>{var t,n;if(s.name)return{name:s.name,department:((t=s.metadata)==null?void 0:t.department)||"",floor:((n=s.metadata)==null?void 0:n.floor)||""};const a=e.find(i=>(i.barcode||i.id)===s.id);return{name:a?a.name:`Room ${s.id}`,department:a&&a.department||"",floor:a&&a.floor||""}},MT=({isOpen:s,onClose:e,onUpdate:t,currentStatus:n})=>{const[a,i]=m.useState([]);pT(s,e);const c=RT(),{selectedIndex:l,handleKeyDown:o}=zm(c,h=>{const p=h.value;i(f=>f.includes(p)?f.filter(y=>y!==p):[...f,p])},0),d=h=>{i(p=>p.includes(h)?p.filter(f=>f!==h):[...p,h])},u=()=>{t(a),e()};return s?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"status-modal-title","aria-describedby":"status-modal-description",children:r.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",role:"document",children:[r.jsx("h3",{id:"status-modal-title",className:"text-lg font-semibold mb-4",children:"Update Room Status"}),r.jsx("div",{id:"status-modal-description",className:"sr-only",children:"Select room statuses using arrow keys to navigate and Enter or Space to select. Use Tab to move between options."}),r.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",role:"grid","aria-label":"Status options",onKeyDown:o,tabIndex:0,children:c.map((h,p)=>r.jsx("button",{className:`p-3 rounded-lg border transition-colors focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] ${a.includes(h.value)?`${h.bgColor} ${h.borderColor}`:n===h.value?`${h.borderColor} ${h.bgColorSelected}`:pt.defaultBorderColor} ${l===p?"ring-2 ring-[#4ECDC4]":""}`,onClick:()=>d(h.value),onKeyDown:f=>{ws(()=>d(h.value))(f),Fm(()=>d(h.value))(f)},role:"gridcell","aria-selected":a.includes(h.value),tabIndex:l===p?0:-1,"aria-label":fT("Select status",h.name),children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:h.icon,size:.8,color:h.color,"aria-hidden":"true"}),r.jsxs("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[r.jsx("span",{className:"truncate",children:h.name}),h.isCore&&r.jsx(I,{path:xu,size:.5,className:"text-gray-200 flex-shrink-0 ml-1",title:"Core status - always available"})]})]})},h.value))}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:e,onKeyDown:ws(e),className:"px-4 py-2 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 rounded","aria-label":"Cancel status update",children:"Cancel"}),r.jsx("button",{onClick:u,onKeyDown:ws(u),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":"Update room status",children:"Update"})]})]})}):null},FT=({status:s,icon:e,color:t,bgColor:n,textColor:a,isCore:i,roomCount:c,onClick:l,isSelected:o})=>r.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200 shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-0.5 cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#4ECDC4] min-h-[80px] min-w-[80px] relative group",onClick:l,role:"gridcell",tabIndex:o?0:-1,"aria-label":`${s} rooms: ${c} rooms`,title:s,onKeyDown:d=>{ws(l)(d),Fm(l)(d)},children:[r.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-white text-gray-800 text-xs rounded border border-gray-300 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[s,r.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-300"})]}),r.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[r.jsx("div",{className:`${n} rounded-full p-2 mb-2`,children:r.jsx(I,{path:e,size:1,color:t,"aria-hidden":"true"})}),r.jsx("div",{className:`text-2xl font-bold ${a}`,children:c})]}),i&&r.jsx("div",{className:"absolute top-1 right-1",children:r.jsx(I,{path:xu,size:.4,className:"text-gray-300",title:"Core status - always available"})})]}),zT=({status:s,rooms:e,onUpdateStatus:t})=>{const{getActiveRooms:n}=Hi(),a=n(),i=e.filter(c=>c.status===s);return r.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",role:"region","aria-label":`${s} rooms details`,children:[r.jsxs("h3",{className:"text-lg font-medium mb-3",children:[s," Rooms"]}),r.jsxs("div",{className:"space-y-2",children:[i.map(c=>{const{name:l,department:o,floor:d}=$T(c,a);return r.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("span",{className:"text-sm font-medium",children:l}),(o||d)&&r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[o&&r.jsx("span",{children:o}),o&&d&&r.jsx("span",{children:" • "}),d&&r.jsx("span",{children:d})]})]}),r.jsx("button",{onClick:()=>t(c.id),onKeyDown:ws(()=>t(c.id)),className:"text-xs text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded ml-2","aria-label":`Update status for ${l}`,children:"Update Status"})]},c.id)}),i.length===0&&r.jsx("p",{className:"text-sm text-gray-500",children:"No rooms with this status"})]})]})},LT=()=>{const{rooms:s,updateRoomStatus:e}=Bm(),[t,n]=m.useState(null),[a,i]=m.useState(null),[c,l]=m.useState(!1),o=AT(),{selectedIndex:d,handleKeyDown:u}=zm(o,y=>p(y.status),0),h=(y,g)=>{if(g.length>0){const x=g[0];e(y,x)}},p=y=>{n(t===y?null:y)},f=y=>{i(y),l(!0)};return r.jsxs("div",{id:"room-status-summary",className:"bg-white rounded-lg shadow p-6 mb-6 relative",style:{borderLeft:`4px solid ${pt.borderLeftColor}`},role:"region","aria-label":"Room status summary",children:[r.jsxs("h2",{className:"text-xl font-semibold mb-4 text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:hu,size:1.1,color:pt.primaryIconColor,className:"mr-2"}),"Room Status Summary"]}),r.jsx("div",{className:"grid grid-cols-4 gap-4",role:"grid","aria-label":"Status summary cards",onKeyDown:u,tabIndex:0,children:o.map((y,g)=>r.jsx(FT,{status:y.status,icon:y.icon,color:y.color,bgColor:y.bgColor,textColor:y.textColor,isCore:y.isCore,roomCount:OT(s,y.status),onClick:()=>p(y.status),isSelected:d===g,index:g},y.status))}),t&&r.jsx(zT,{status:t,rooms:s,onUpdateStatus:f}),r.jsx(MT,{isOpen:c,onClose:()=>l(!1),onUpdate:y=>{a&&h(a,y)},currentStatus:t||"Available"})]})},BT=()=>r.jsx("div",{className:"flex-1",children:r.jsx(LT,{})});var wd=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function qT(){const[s,e]=m.useState({totalRooms:0,cleanRooms:0,dirtyRooms:0,inProgressRooms:0,cleaningEfficiency:0,averageCleaningTime:0,lastUpdated:new Date().toISOString()}),[t,n]=m.useState(!0),[a,i]=m.useState(null),c=m.useCallback(()=>wd(null,null,function*(){try{n(!0),i(null);const o=yield _s.fetchAnalytics();e(o)}catch(o){i("Failed to load analytics"),console.error("Error fetching analytics:",o)}finally{n(!1)}}),[]),l=m.useCallback(()=>wd(null,null,function*(){yield c()}),[c]);return m.useEffect(()=>{c()},[c]),{analytics:s,isLoading:t,error:a,refreshAnalytics:l}}const UT=()=>{const{analytics:s,isLoading:e,error:t,refreshAnalytics:n}=qT();return e?r.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${pt.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:ta,size:1.1,color:pt.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[r.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:r.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})}),r.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:r.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})}),r.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-center",children:r.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"})})]})]}):t?r.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${pt.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:ta,size:1.1,color:pt.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),r.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Refresh analytics",children:r.jsx(I,{path:it,size:.8,className:"text-gray-600"})})]}),r.jsx("div",{className:"text-red-600 text-sm text-center py-4",children:t})]}):r.jsxs("div",{id:"cleaning-analytics",className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6",style:{borderLeft:`4px solid ${pt.borderLeftColor}`},role:"region","aria-label":"Cleaning analytics summary",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:ta,size:1.1,color:pt.primaryIconColor,className:"mr-2"}),"Cleaning Analytics"]}),r.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Refresh analytics",children:r.jsx(I,{path:it,size:.8,className:"text-gray-600"})})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-2",role:"group","aria-label":"Analytics metrics",children:[r.jsxs("div",{className:"p-2 bg-green-100 rounded-lg text-center",role:"status","aria-label":`Clean rooms: ${s.cleanRooms}`,children:[r.jsx("h3",{className:"text-sm text-green-700 font-medium mb-1",children:"Clean Rooms"}),r.jsx("p",{className:"text-xl font-bold text-green-700",children:s.cleanRooms})]}),r.jsxs("div",{className:"p-2 bg-orange-100 rounded-lg text-center",role:"status","aria-label":`Dirty rooms: ${s.dirtyRooms}`,children:[r.jsx("h3",{className:"text-sm text-orange-700 font-medium mb-1",children:"Dirty Rooms"}),r.jsx("p",{className:"text-xl font-bold text-orange-700",children:s.dirtyRooms})]}),r.jsxs("div",{className:"p-2 bg-purple-100 rounded-lg text-center",role:"status","aria-label":`Efficiency: ${s.cleaningEfficiency}%`,children:[r.jsx("h3",{className:"text-sm text-purple-700 font-medium mb-1",children:"Efficiency"}),r.jsxs("p",{className:"text-xl font-bold text-purple-700",children:[s.cleaningEfficiency,"%"]})]})]}),r.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-center",children:["Last updated: ",new Date(s.lastUpdated).toLocaleTimeString()]})]})},HT=()=>{const{recentlyCleanedRooms:s}=Bm(),e=m.useRef(null),t=!1,n=()=>{e.current&&(e.current.scrollTop=0)},a=()=>{console.log("Refreshing recently cleaned rooms...")};return r.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-xl shadow-lg mb-6 relative",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsxs("div",{className:"sticky top-0 bg-white pb-1 flex justify-between items-center",children:[r.jsxs("h2",{className:"text-lg font-semibold mb-1 text-[#5b5b5b] flex items-center",children:[r.jsx(I,{path:An,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Recently Cleaned Rooms"]}),r.jsx("button",{onClick:a,className:"p-1 text-gray-500 hover:text-[#4ECDC4] transition-colors",title:"Refresh data",disabled:t,children:r.jsx(I,{path:it,size:.8,className:""})})]}),r.jsx("div",{className:"overflow-y-auto [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",style:{maxHeight:"120px"},ref:e,children:s.length===0?r.jsx("p",{className:"text-gray-500 text-sm py-1",children:"No rooms cleaned recently"}):r.jsx("div",{className:"space-y-1",children:s.map((i,c)=>r.jsx("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg relative",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"relative",children:r.jsxs("span",{className:"font-medium text-gray-700 cursor-help hover:text-brand-primary transition-colors group",children:[i.room,r.jsxs("div",{className:"hidden group-hover:block absolute left-0 top-full mt-1 bg-white rounded-lg shadow-xl border border-gray-200 p-3 w-64 z-50",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(I,{path:du,size:.8,color:"#4ECDC4"}),r.jsx("span",{className:"font-medium text-gray-800",children:i.cleanedBy})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(I,{path:An,size:.8,color:"#4ECDC4"}),r.jsx("span",{className:"text-sm text-gray-600",children:new Date(i.cleanedAt).toLocaleString()})]})]})]})}),r.jsx(I,{path:xt,size:.8,color:"#4ECDC4"})]})},c))})}),r.jsx("button",{onClick:n,className:"absolute bottom-2 right-2 p-1.5 bg-brand-primary text-white rounded-full shadow-md hover:bg-brand-primary transition-colors",title:"Scroll to most recent",children:r.jsx(I,{path:cp,size:.8,className:"opacity-70"})})]})},VT=()=>r.jsxs("div",{className:"flex-1",children:[r.jsx(UT,{}),r.jsx("div",{className:"mt-4",children:r.jsx(HT,{})})]});var WT=Object.defineProperty,GT=Object.defineProperties,KT=Object.getOwnPropertyDescriptors,Sd=Object.getOwnPropertySymbols,QT=Object.prototype.hasOwnProperty,YT=Object.prototype.propertyIsEnumerable,Cd=(s,e,t)=>e in s?WT(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Yt=(s,e)=>{for(var t in e||(e={}))QT.call(e,t)&&Cd(s,t,e[t]);if(Sd)for(var t of Sd(e))YT.call(e,t)&&Cd(s,t,e[t]);return s},Rr=(s,e)=>GT(s,KT(e));class JT{constructor(e=[]){this.checklists=[],this.checklists=e}getAllChecklists(){return[...this.checklists]}getChecklistById(e){return this.checklists.find(t=>t.id===e)}getChecklistsByCategory(e){return this.checklists.filter(t=>t.category===e)}getPublishedChecklistsByCategory(e){return this.checklists.filter(t=>t.category===e&&t.status==="published")}getChecklistsByStatus(e){return this.checklists.filter(t=>t.status===e)}addChecklist(e){const t=Rr(Yt({},e),{status:"draft",id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});return this.checklists.push(t),t}updateChecklist(e,t){const n=this.checklists.findIndex(i=>i.id===e);if(n===-1)return null;const a=Rr(Yt(Yt({},this.checklists[n]),t),{updatedAt:new Date().toISOString()});return this.checklists[n]=a,a}deleteChecklist(e){const t=this.checklists.findIndex(n=>n.id===e);return t===-1?!1:(this.checklists.splice(t,1),!0)}publishChecklist(e){return this.updateChecklist(e,{status:"published",updatedAt:new Date().toISOString()})}unpublishChecklist(e){return this.updateChecklist(e,{status:"draft",updatedAt:new Date().toISOString()})}duplicateChecklist(e,t){const n=this.getChecklistById(e);if(!n)return null;const a=Rr(Yt({},n),{id:this.generateId(),title:t||`${n.title} (Copy)`,status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:n.items.map(i=>Rr(Yt({},i),{id:this.generateId(),completed:!1,skipped:!1}))});return this.checklists.push(a),a}getChecklistStatistics(){const e=this.checklists.length,t=this.checklists.filter(l=>l.status==="published").length,n=this.checklists.filter(l=>l.status==="draft").length,a=this.checklists.reduce((l,o)=>(l[o.category]=(l[o.category]||0)+1,l),{}),i=this.checklists.reduce((l,o)=>l+o.items.length,0),c=e>0?i/e:0;return{total:e,published:t,draft:n,byCategory:a,averageItemsPerChecklist:c,totalItems:i}}searchChecklists(e){const t=e.toLowerCase();return this.checklists.filter(n=>n.title.toLowerCase().includes(t)||n.items.some(a=>a.title.toLowerCase().includes(t)||a.instructions.toLowerCase().includes(t)))}filterChecklists(e){return this.checklists.filter(t=>!(e.category&&t.category!==e.category||e.status&&t.status!==e.status||e.hasScheduling!==void 0&&!!(t.autoSchedule||t.scheduleFrequency)!==e.hasScheduling||e.minItems!==void 0&&t.items.length<e.minItems||e.maxItems!==void 0&&t.items.length>e.maxItems))}sortChecklists(e,t,n="asc"){return[...e].sort((a,i)=>{let c=0;switch(t){case"title":c=a.title.localeCompare(i.title);break;case"createdAt":c=new Date(a.createdAt).getTime()-new Date(i.createdAt).getTime();break;case"updatedAt":c=new Date(a.updatedAt).getTime()-new Date(i.updatedAt).getTime();break;case"category":c=a.category.localeCompare(i.category);break;case"status":c=a.status.localeCompare(i.status);break}return n==="desc"?-c:c})}exportChecklists(e){const t=e?this.checklists.filter(n=>e.includes(n.id)):this.checklists;return JSON.stringify(t,null,2)}importChecklists(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,imported:[],errors:["Invalid format: expected array of checklists"]};const n=[],a=[];return t.forEach((i,c)=>{const l=this.validateChecklist(i);if(!l.isValid)n.push(`Checklist ${c+1}: ${l.errors.join(", ")}`);else{const o=Rr(Yt({},i),{id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:i.items.map(d=>Rr(Yt({},d),{id:this.generateId()}))});a.push(o)}}),a.length>0&&this.checklists.push(...a),{success:n.length===0,imported:a,errors:n}}catch(t){return{success:!1,imported:[],errors:["Invalid JSON format"]}}}validateChecklist(e){const t=[];return(!e.title||e.title.trim()==="")&&t.push("Title is required"),e.category?["setup","patient","weekly","public","deep","environmental_cleaning"].includes(e.category)||t.push(`Invalid category: ${e.category}`):t.push("Category is required"),!e.items||!Array.isArray(e.items)?t.push("Items array is required"):e.items.length===0&&t.push("At least one item is required"),{isValid:t.length===0,errors:t}}getDefaultChecklists(){return[{id:"treatment-room-setup",title:"Treatment Room Setup",category:"setup",status:"published",items:[{id:"clean-surfaces",title:"Clean and sanitize all surfaces with CaviWipes",instructions:"Use 2 wipes per surface. Allow to air dry for 3 minutes.",requiredInventory:[{id:"caviwipes-001",name:"CaviWipes",required:2,available:100,used:0,unit:"wipes"}],sdsId:"caviwipes-sds",skipped:!1,completed:!1},{id:"restock-supplies",title:"Restock Treatment Room Supplies",instructions:"Verify all supplies are present and in date",requiredInventory:[{id:"gloves-001",name:"Nitrile Gloves",required:10,available:500,used:0,unit:"pairs"},{id:"gauze-001",name:"Sterile Gauze",required:5,available:200,used:0,unit:"packs"},{id:"alcohol-001",name:"Alcohol Swabs",required:10,available:300,used:0,unit:"swabs"}],skipped:!1,completed:!1}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}setChecklists(e){this.checklists=[...e]}clearChecklists(){this.checklists=[]}}var XT=Object.defineProperty,ZT=Object.defineProperties,eE=Object.getOwnPropertyDescriptors,jd=Object.getOwnPropertySymbols,tE=Object.prototype.hasOwnProperty,rE=Object.prototype.propertyIsEnumerable,Nd=(s,e,t)=>e in s?XT(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qe=(s,e)=>{for(var t in e||(e={}))tE.call(e,t)&&Nd(s,t,e[t]);if(jd)for(var t of jd(e))rE.call(e,t)&&Nd(s,t,e[t]);return s},ut=(s,e)=>ZT(s,eE(e));class sE{addItemToChecklist(e,t,n){const a=ut(Qe({},n),{id:this.generateId()});return e.map(i=>i.id===t?ut(Qe({},i),{items:[...i.items,a],updatedAt:new Date().toISOString()}):i)}updateChecklistItem(e,t,n,a){return e.map(i=>i.id===t?ut(Qe({},i),{items:i.items.map(c=>c.id===n?Qe(Qe({},c),a):c),updatedAt:new Date().toISOString()}):i)}deleteChecklistItem(e,t,n){return e.map(a=>a.id===t?ut(Qe({},a),{items:a.items.filter(i=>i.id!==n),updatedAt:new Date().toISOString()}):a)}getItemById(e,t,n){const a=e.find(i=>i.id===t);return a&&a.items.find(i=>i.id===n)||null}completeItem(e,t,n){return this.updateChecklistItem(e,t,n,{completed:!0,skipped:!1})}skipItem(e,t,n){return this.updateChecklistItem(e,t,n,{skipped:!0,completed:!1})}resetItem(e,t,n){return this.updateChecklistItem(e,t,n,{completed:!1,skipped:!1})}moveItemUp(e,t,n){return e.map(a=>{if(a.id!==t)return a;const i=[...a.items],c=i.findIndex(l=>l.id===n);return c<=0?a:([i[c],i[c-1]]=[i[c-1],i[c]],ut(Qe({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemDown(e,t,n){return e.map(a=>{if(a.id!==t)return a;const i=[...a.items],c=i.findIndex(l=>l.id===n);return c===-1||c>=i.length-1?a:([i[c],i[c+1]]=[i[c+1],i[c]],ut(Qe({},a),{items:i,updatedAt:new Date().toISOString()}))})}moveItemToPosition(e,t,n,a){return e.map(i=>{if(i.id!==t)return i;const c=[...i.items],l=c.findIndex(d=>d.id===n);if(l===-1)return i;const[o]=c.splice(l,1);return c.splice(a,0,o),ut(Qe({},i),{items:c,updatedAt:new Date().toISOString()})})}duplicateItem(e,t,n){const a=this.getItemById(e,t,n);if(!a)return e;const i=ut(Qe({},a),{id:this.generateId(),title:`${a.title} (Copy)`,completed:!1,skipped:!1});return e.map(c=>c.id===t?ut(Qe({},c),{items:[...c.items,i],updatedAt:new Date().toISOString()}):c)}getItemStatistics(e){let t=0,n=0,a=0,i=0,c=0;e.forEach(d=>{d.items.forEach(u=>{t++,u.completed&&n++,u.skipped&&a++,u.requiredInventory&&u.requiredInventory.length>0&&i++,u.sdsId&&c++})});const l=t-n-a,o=t>0?n/t*100:0;return{totalItems:t,completedItems:n,skippedItems:a,pendingItems:l,completionRate:o,itemsWithInventory:i,itemsWithSDS:c}}getChecklistCompletionStatus(e){const t=e.items.length,n=e.items.filter(o=>o.completed).length,a=e.items.filter(o=>o.skipped).length,i=t-n-a,c=t>0?n/t*100:0;return{totalItems:t,completedItems:n,skippedItems:a,pendingItems:i,completionRate:c,isFullyCompleted:n===t}}validateItem(e){const t=[];return(!e.title||e.title.trim()==="")&&t.push("Title is required"),(!e.instructions||e.instructions.trim()==="")&&t.push("Instructions are required"),e.requiredInventory&&Array.isArray(e.requiredInventory)&&e.requiredInventory.forEach((n,a)=>{(!n.id||n.id.trim()==="")&&t.push(`Inventory item ${a+1}: ID is required`),(!n.name||n.name.trim()==="")&&t.push(`Inventory item ${a+1}: Name is required`),n.required<=0&&t.push(`Inventory item ${a+1}: Required quantity must be greater than 0`),n.available<0&&t.push(`Inventory item ${a+1}: Available quantity cannot be negative`),n.used<0&&t.push(`Inventory item ${a+1}: Used quantity cannot be negative`),n.used>n.available&&t.push(`Inventory item ${a+1}: Used quantity cannot exceed available quantity`)}),{isValid:t.length===0,errors:t}}searchItems(e,t){const n=t.toLowerCase(),a=[];return e.forEach(i=>{i.items.forEach(c=>{var l;c.title.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"title"}):c.instructions.toLowerCase().includes(n)?a.push({checklist:i,item:c,matchType:"instructions"}):(l=c.requiredInventory)!=null&&l.some(o=>o.name.toLowerCase().includes(n))&&a.push({checklist:i,item:c,matchType:"inventory"})})}),a}filterItems(e,t){const n=[];return e.forEach(a=>{t.category&&a.category!==t.category||a.items.forEach(i=>{t.completed!==void 0&&i.completed!==t.completed||t.skipped!==void 0&&i.skipped!==t.skipped||t.hasInventory!==void 0&&!!(i.requiredInventory&&i.requiredInventory.length>0)!==t.hasInventory||t.hasSDS!==void 0&&!!i.sdsId!==t.hasSDS||n.push({checklist:a,item:i})})}),n}sortItems(e,t,n="asc"){return[...e].sort((a,i)=>{var c,l;let o=0;switch(t){case"title":o=a.item.title.localeCompare(i.item.title);break;case"completed":o=(a.item.completed?1:0)-(i.item.completed?1:0);break;case"skipped":o=(a.item.skipped?1:0)-(i.item.skipped?1:0);break;case"inventoryCount":{const d=((c=a.item.requiredInventory)==null?void 0:c.length)||0,u=((l=i.item.requiredInventory)==null?void 0:l.length)||0;o=d-u;break}}return n==="desc"?-o:o})}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}}const Jt=new JT,Wa=new sE,nE=Ft()(Yn((s,e)=>({checklists:Jt.getDefaultChecklists(),addChecklist:t=>{const n=Jt.addChecklist(t);s(a=>({checklists:[...a.checklists,n]}))},updateChecklist:(t,n)=>{s(a=>{const i=Jt.updateChecklist(t,n);return i?{checklists:a.checklists.map(c=>c.id===t?i:c)}:a})},deleteChecklist:t=>{s(n=>Jt.deleteChecklist(t)?{checklists:n.checklists.filter(i=>i.id!==t)}:n)},addItemToChecklist:(t,n)=>{s(a=>({checklists:Wa.addItemToChecklist(a.checklists,t,n)}))},updateChecklistItem:(t,n,a)=>{s(i=>({checklists:Wa.updateChecklistItem(i.checklists,t,n,a)}))},deleteChecklistItem:(t,n)=>{s(a=>({checklists:Wa.deleteChecklistItem(a.checklists,t,n)}))},getChecklistsByCategory:t=>Jt.getChecklistsByCategory(t),publishChecklist:t=>{s(n=>{const a=Jt.publishChecklist(t);return a?{checklists:n.checklists.map(i=>i.id===t?a:i)}:n})},getPublishedChecklistsByCategory:t=>Jt.getPublishedChecklistsByCategory(t)}),{name:"checklist-storage"}));var aE=Object.defineProperty,iE=Object.defineProperties,oE=Object.getOwnPropertyDescriptors,Id=Object.getOwnPropertySymbols,lE=Object.prototype.hasOwnProperty,cE=Object.prototype.propertyIsEnumerable,Td=(s,e,t)=>e in s?aE(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ga=(s,e)=>{for(var t in e||(e={}))lE.call(e,t)&&Td(s,t,e[t]);if(Id)for(var t of Id(e))cE.call(e,t)&&Td(s,t,e[t]);return s},Ka=(s,e)=>iE(s,oE(e));const dE=()=>{const[s,e]=m.useState(null),[t,n]=m.useState(null),[a,i]=m.useState("checklists"),[c,l]=m.useState(""),[o,d]=m.useState(null),[u,h]=m.useState("all"),[p,f]=m.useState(new Set),[y,g]=m.useState({}),[x,b]=m.useState(!1),[v,w]=m.useState(""),[S,T]=m.useState([]),[C,P]=m.useState([]),N=L=>{e(L),n(null),b(!0)},j=L=>{n(L)},E=()=>{e(null),n(null),b(!1)};return{selectedCategory:s,selectedChecklist:t,activeTab:a,searchQuery:c,selectedSDS:o,sdsCategory:u,bypassedItems:p,adjustedQuantities:y,showModal:x,notes:v,stolenItems:S,prnItems:C,setSelectedCategory:e,setSelectedChecklist:n,setActiveTab:i,setSearchQuery:l,setSelectedSDS:d,setSdsCategory:h,setShowModal:b,setNotes:w,handleCategoryClick:N,handleChecklistSelect:j,handleCloseModal:E,handleMarkComplete:()=>{E()},handleBypassItem:L=>{f(K=>{const V=new Set(K);return V.has(L)?V.delete(L):V.add(L),V})},handleAdjustQuantity:(L,K,V)=>{g(Z=>Ka(Ga({},Z),{[`${L}-${K}`]:(Z[`${L}-${K}`]||0)+V}))},handleAddStolenItem:()=>{T([...S,{item:"",quantity:1,notes:""}])},handleAddPrnItem:()=>{P([...C,{item:"",quantity:1,reason:""}])},handleUpdateStolenItem:(L,K,V)=>{const Z=[...S];Z[L]=Ka(Ga({},Z[L]),{[K]:V}),T(Z)},handleUpdatePrnItem:(L,K,V)=>{const Z=[...C];Z[L]=Ka(Ga({},Z[L]),{[K]:V}),P(Z)},clearStolenItems:()=>{T([])},clearPrnItems:()=>{P([])},clearNotes:()=>{w("")}}},uE=()=>{const[s,e]=m.useState(!1),[t,n]=m.useState(""),a=m.useRef(null),i=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("Speech recognition is not supported in this browser. Please use Chrome or Edge.");return}const o=window.SpeechRecognition||window.webkitSpeechRecognition,d=new o;d.continuous=!0,d.interimResults=!0,d.lang="en-US",d.addEventListener("start",()=>{e(!0),n("")}),d.onresult=u=>{let h="",p="";for(let f=u.resultIndex;f<u.results.length;f++){const y=u.results[f][0].transcript;u.results[f].isFinal?h+=y:p+=y}n(h+p)},d.onerror=u=>{console.error("Speech recognition error:",u.error),e(!1),u.error==="no-speech"&&alert("No speech detected. Please try again.")},d.onend=()=>{e(!1)},a.current=d,d.start()},c=()=>{a.current&&(a.current.stop(),a.current=null),e(!1)},l=o=>{t.trim()&&(o(d=>d+(d?" ":"")+t),n(""))};return m.useEffect(()=>()=>{a.current&&a.current.stop()},[]),{isListening:s,transcript:t,startSpeechRecognition:i,stopSpeechRecognition:c,applyTranscriptToNotes:l}},mE=[{id:"setup",title:"Setup/Take Down",iconColor:"#FF6B6B",icon:Ss},{id:"patient",title:"Per Patient",iconColor:"#4ECDC4",icon:dp},{id:"weekly",title:"Weekly",iconColor:"#45B7D1",icon:up},{id:"public",title:"Public Spaces",iconColor:"#96CEB4",icon:yu},{id:"deep",title:"Deep Clean",iconColor:"#FF9F1C",icon:vu}],hE=[{id:"1",name:"Bleach SDS",category:"Cleaning",lastUpdated:"2024-03-20",url:"/sds/bleach.pdf",sections:[]},{id:"2",name:"Disinfectant SDS",category:"Cleaning",lastUpdated:"2024-03-19",url:"/sds/disinfectant.pdf",sections:[]},{id:"3",name:"Hand Sanitizer SDS",category:"Sanitization",lastUpdated:"2024-03-18",url:"/sds/hand-sanitizer.pdf",sections:[]}],pE=({activeTab:s,onTabChange:e})=>r.jsx("div",{className:"flex justify-between items-center mb-6",children:r.jsxs("div",{className:"flex space-x-4",children:[r.jsxs("button",{className:`pb-2 px-1 font-medium flex items-center ${s==="checklists"?"text-[#5b5b5b] border-b-2 border-[#4ECDC4]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>e("checklists"),type:"button",children:[r.jsx(I,{path:tu,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Cleaning Checklists"]}),r.jsxs("button",{className:`pb-2 px-1 font-medium flex items-center ${s==="sds"?"text-[#5b5b5b] border-b-2 border-[#4ECDC4]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>e("sds"),type:"button",children:[r.jsx(I,{path:Ue,size:1.1,color:"#4ECDC4",className:"mr-2"}),"SDS Sheets"]})]})}),fE=({categories:s,selectedCategory:e,onCategoryClick:t})=>r.jsx("div",{className:"p-6",children:r.jsx("div",{role:"tablist","aria-label":"Cleaning Category Tabs",className:"grid grid-cols-5 gap-4",children:s.map(n=>r.jsxs("button",{role:"tab","aria-selected":(e==null?void 0:e.id)===n.id,"aria-controls":`panel-${n.id}`,id:`tab-${n.id}`,onClick:()=>t(n),className:`flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors w-full ${(e==null?void 0:e.id)===n.id?"bg-brand-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(I,{path:n.icon,size:1.2,color:n.iconColor}),r.jsx("span",{children:n.title})]},n.id))})}),Hm=({item:s,bypassedItems:e,adjustedQuantities:t,onBypassItem:n,onAdjustQuantity:a,onViewSDS:i})=>r.jsx("div",{className:"border-b border-gray-200 py-3",children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex-1 px-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("h3",{className:"text-lg font-medium text-[#5b5b5b]",children:s.title}),r.jsx("button",{onClick:()=>n(s.id),className:`ml-4 px-3 py-1 text-sm rounded-full transition-colors ${e.has(s.id)?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"}`,type:"button",children:e.has(s.id)?"Not Needed":"Mark Not Needed"})]}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s.instructions}),s.inventoryItems&&r.jsxs("div",{className:"mt-2",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Required Items:"}),r.jsx("ul",{className:"mt-1 space-y-1",children:s.inventoryItems.map(c=>{const l=t[`${s.id}-${c.id}`]||0,o=c.requiredQuantity+l;return r.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[r.jsx("span",{className:"w-32",children:c.name}),r.jsx("span",{className:"mx-2",children:"•"}),r.jsxs("span",{children:["Required: ",o]}),r.jsx("span",{className:"mx-2",children:"•"}),r.jsxs("span",{children:["Available: ",c.currentStock]}),c.status&&r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"mx-2",children:"•"}),r.jsxs("span",{children:["Status: ",c.status]})]}),r.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[r.jsx("button",{onClick:()=>a(s.id,c.id,-1),className:"px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",type:"button",children:"-"}),r.jsx("button",{onClick:()=>a(s.id,c.id,1),className:"px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",type:"button",children:"+"})]})]},c.id)})})]}),s.sds&&r.jsx("div",{className:"mt-2",children:r.jsxs("button",{onClick:()=>i(s.sds),className:"inline-flex items-center text-sm text-[#4ECDC4] hover:text-[#3db8b0]",type:"button",children:[r.jsx(I,{path:Ue,size:1,className:"mr-1"}),"View SDS Sheet"]})})]})})}),gE=({selectedCategory:s,selectedChecklist:e,bypassedItems:t,adjustedQuantities:n,onCategoryClick:a,onChecklistSelect:i,onBypassItem:c,onAdjustQuantity:l,onViewSDS:o,onMarkComplete:d,getChecklistsForCategory:u})=>r.jsxs(r.Fragment,{children:[r.jsx(fE,{categories:mE,selectedCategory:s,onCategoryClick:a}),s&&r.jsxs("div",{role:"tabpanel",id:`panel-${s.id}`,"aria-labelledby":`tab-${s.id}`,className:"p-6 bg-white rounded-lg shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:`${s.iconColor}20`},children:r.jsx(I,{path:s.icon,size:1.5,color:s.iconColor})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title})]}),r.jsxs("div",{className:"space-y-4",children:[!e&&r.jsxs("div",{className:"space-y-4",children:[u(s.id).map(h=>r.jsxs("div",{onClick:()=>i(h),onKeyDown:p=>p.key==="Enter"&&i(h),className:"w-full text-left p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",role:"button",tabIndex:0,"aria-label":`Select ${h.title} checklist`,children:[r.jsx("h3",{className:"font-medium text-[#5b5b5b]",children:h.title}),h.description&&r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:h.description})]},h.id)),u(s.id).length===0&&r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{children:"No published checklists available for this category."}),r.jsx("p",{className:"text-sm mt-1",children:"Create and publish checklists in Settings to see them here."})]})]}),e&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-[#5b5b5b]",children:e.title}),r.jsx("div",{className:"space-y-2",children:e.items.map(h=>r.jsx(Hm,{item:h,bypassedItems:t,adjustedQuantities:n,onBypassItem:c,onAdjustQuantity:l,onViewSDS:o},h.id))}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx("button",{onClick:d,className:"bg-[#4ECDC4] text-white px-4 py-2 rounded-lg hover:bg-[#3db8b0] transition-colors",type:"button",children:"Mark All Complete"})})]})]})]})]}),yE=({searchQuery:s,sdsCategory:e,filteredSDSSheets:t,onTabChange:n,onSearchQueryChange:a,onSdsCategoryChange:i,onSDSSelect:c})=>r.jsx("button",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>n("checklists"),onKeyDown:l=>l.key==="Escape"&&n("checklists"),type:"button","aria-label":"Close SDS Sheets",children:r.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",role:"document",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(I,{path:Ue,size:1.2,color:"#4ECDC4",className:"mr-2"}),r.jsx("h2",{className:"text-xl font-semibold text-[#5b5b5b]",children:"SDS Sheets"})]}),r.jsx("button",{onClick:()=>n("checklists"),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close SDS Sheets",type:"button",children:r.jsx(I,{path:Pe,size:1.2,color:"#5b5b5b"})})]}),r.jsxs("div",{className:"flex gap-2 mb-4",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx("input",{type:"text",placeholder:"Search SDS sheets...",value:s,onChange:l=>a(l.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]"}),r.jsx(I,{path:Ni,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),r.jsxs("select",{value:e,onChange:l=>i(l.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4ECDC4]",children:[r.jsx("option",{value:"all",children:"All Categories"}),r.jsx("option",{value:"Cleaning",children:"Cleaning"}),r.jsx("option",{value:"Sanitization",children:"Sanitization"})]})]}),r.jsx("div",{className:"space-y-2",children:t.map(l=>r.jsxs("div",{onClick:()=>c(l),onKeyDown:o=>o.key==="Enter"&&c(l),className:"w-full flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",role:"button",tabIndex:0,"aria-label":`Select ${l.name} SDS sheet`,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"font-medium text-[#5b5b5b]",children:l.name}),r.jsx("span",{className:"text-sm text-gray-500",children:"•"}),r.jsx("p",{className:"text-sm text-gray-500",children:l.category})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-500",children:l.lastUpdated}),r.jsx(I,{path:Ue,size:1,color:"#4ECDC4"})]})]},l.id))})]})}),Vm=({show:s,onClose:e,title:t,children:n,footer:a,size:i="lg"})=>r.jsxs(Ee,{show:s,onHide:e,centered:!0,size:i,"aria-modal":"true",role:"dialog",children:[t&&r.jsx(Ee.Header,{closeButton:!0,className:"bg-gray-50 border-b border-gray-200",children:r.jsx(Ee.Title,{className:"text-xl font-semibold text-gray-800",children:t})}),r.jsx(Ee.Body,{className:"p-4",children:n}),a&&r.jsx(Ee.Footer,{className:"bg-gray-50 border-t border-gray-200 px-4 py-3",children:a})]}),vE=({stolenItems:s,onAddStolenItem:e,onUpdateStolenItem:t,onClearStolenItems:n})=>r.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Reported Stolen Items"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:n,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear All"}),r.jsx("button",{onClick:e,className:`px-3 py-1 ${Mm.error.light} text-red-600 rounded-md hover:bg-red-100 text-sm`,children:"+ Add Stolen Item"})]})]}),s.map((a,i)=>{var c;return r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"text",placeholder:"Item",value:a.item,onChange:l=>t(i,"item",l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),r.jsx("input",{type:"number",placeholder:"Qty",value:a.quantity,onChange:l=>t(i,"quantity",parseInt(l.target.value)||0),className:"w-20 px-3 py-2 border border-gray-300 rounded-md"}),r.jsx("input",{type:"text",placeholder:"Notes",value:(c=a.data)==null?void 0:c.notes,onChange:l=>t(i,"notes",l.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"})]},i)})]}),xE=({prnItems:s,onAddPrnItem:e,onUpdatePrnItem:t,onClearPrnItems:n})=>r.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"PRN Cleaning Items"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:n,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear All"}),r.jsx("button",{onClick:e,className:`px-3 py-1 ${Mm.info.light} text-blue-600 rounded-md hover:bg-blue-100 text-sm`,children:"+ Add PRN Item"})]})]}),s.map((a,i)=>r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"text",placeholder:"Item",value:a.item,onChange:c=>t(i,"item",c.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),r.jsx("input",{type:"number",placeholder:"Qty",value:a.quantity,onChange:c=>t(i,"quantity",parseInt(c.target.value)||0),className:"w-20 px-3 py-2 border border-gray-300 rounded-md"}),r.jsx("input",{type:"text",placeholder:"Reason",value:a.reason,onChange:c=>t(i,"reason",c.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"})]},i))]}),bE=({notes:s,isListening:e,transcript:t,onNotesChange:n,onClearNotes:a,onStartSpeechRecognition:i,onStopSpeechRecognition:c,onApplyTranscriptToNotes:l})=>r.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Notes"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:a,className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 text-sm",children:"Clear Notes"}),r.jsxs("button",{onClick:e?c:i,className:`px-3 py-1 rounded-md text-sm flex items-center gap-1 ${e?"bg-red-100 text-red-600 hover:bg-red-200":"bg-blue-100 text-blue-600 hover:bg-blue-200"}`,children:[r.jsx(I,{path:e?mu:si,size:.8}),e?"Stop Dictation":"Start Dictation"]})]})]}),e&&r.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("span",{className:"text-sm font-medium text-blue-800 flex items-center",children:[r.jsx(I,{path:si,size:.8,className:"mr-1 animate-pulse"}),"Listening... Speak now"]}),r.jsx("button",{onClick:()=>l(n),disabled:!t.trim(),className:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add to Notes"})]}),r.jsx("div",{className:"text-sm text-blue-700 min-h-[2rem]",children:t||"Waiting for speech..."})]}),r.jsx("textarea",{value:s,onChange:o=>n(o.target.value),placeholder:"Add any additional notes here... Use the dictation button to speak your notes!",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md"})]}),_E=({showModal:s,selectedCategory:e,selectedChecklist:t,bypassedItems:n,adjustedQuantities:a,stolenItems:i,prnItems:c,notes:l,isListening:o,transcript:d,onClose:u,onChecklistSelect:h,onSetSelectedChecklist:p,onBypassItem:f,onAdjustQuantity:y,onViewSDS:g,onAddStolenItem:x,onUpdateStolenItem:b,onClearStolenItems:v,onAddPrnItem:w,onUpdatePrnItem:S,onClearPrnItems:T,onNotesChange:C,onClearNotes:P,onStartSpeechRecognition:N,onStopSpeechRecognition:j,onApplyTranscriptToNotes:E,getChecklistsForCategory:D})=>r.jsx(Vm,{show:s,onClose:u,title:(e==null?void 0:e.title)||"Select Checklist",footer:r.jsx("div",{className:"flex justify-end w-full",children:r.jsx("button",{onClick:u,className:"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 font-medium py-2 px-4 rounded-md transition-colors",children:"Close"})}),children:t?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:t.title}),r.jsxs("button",{onClick:()=>p(null),className:"text-sm text-gray-600 hover:text-gray-800 flex items-center",children:[r.jsx(I,{path:bu,size:1,className:"mr-1"}),"Back to Lists"]})]}),r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 divide-y divide-gray-200",children:t.items.map(O=>r.jsx(Hm,{item:O,bypassedItems:n,adjustedQuantities:a,onBypassItem:f,onAdjustQuantity:y,onViewSDS:g},O.id))}),r.jsx(vE,{stolenItems:i,onAddStolenItem:x,onUpdateStolenItem:b,onClearStolenItems:v}),r.jsx(xE,{prnItems:c,onAddPrnItem:w,onUpdatePrnItem:S,onClearPrnItems:T}),r.jsx(bE,{notes:l,isListening:o,transcript:d,onNotesChange:C,onClearNotes:P,onStartSpeechRecognition:N,onStopSpeechRecognition:j,onApplyTranscriptToNotes:E})]}):r.jsxs("div",{className:"space-y-3",children:[e&&D(e.id).map(O=>r.jsxs("div",{onClick:()=>h(O),onKeyDown:k=>k.key==="Enter"&&h(O),className:"w-full p-3 text-left bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer",role:"button",tabIndex:0,"aria-label":`Select ${O.title} checklist`,children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-1",children:O.title}),r.jsx("p",{className:"text-sm text-gray-600",children:O.description})]},O.id)),e&&D(e.id).length===0&&r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{children:"No published checklists available for this category."}),r.jsx("p",{className:"text-sm mt-1",children:"Create and publish checklists in Settings to see them here."})]})]})}),wE=({selectedSDS:s,onClose:e})=>r.jsx(Vm,{show:!!s,onClose:e,title:"Safety Data Sheet",children:s&&r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:s.name}),r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:s.name}),r.jsx("div",{className:"flex flex-wrap gap-2",children:s.sections.map(t=>r.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm",children:t},t))})]})})}),SE=()=>{const{getPublishedChecklistsByCategory:s}=nE(),{selectedCategory:e,selectedChecklist:t,activeTab:n,searchQuery:a,selectedSDS:i,sdsCategory:c,bypassedItems:l,adjustedQuantities:o,showModal:d,notes:u,stolenItems:h,prnItems:p,setSelectedChecklist:f,setActiveTab:y,setSearchQuery:g,setSelectedSDS:x,setSdsCategory:b,setNotes:v,handleCategoryClick:w,handleChecklistSelect:S,handleCloseModal:T,handleMarkComplete:C,handleBypassItem:P,handleAdjustQuantity:N,handleAddStolenItem:j,handleAddPrnItem:E,handleUpdateStolenItem:D,handleUpdatePrnItem:O,clearStolenItems:k,clearPrnItems:$,clearNotes:U}=dE(),{isListening:H,transcript:A,startSpeechRecognition:z,stopSpeechRecognition:M,applyTranscriptToNotes:W}=uE(),L=V=>s(V).map(ne=>({id:ne.id,title:ne.title,description:`Published checklist with ${ne.items.length} items`,items:ne.items.map(Y=>{var he;return{id:Y.id,title:Y.title,instructions:Y.instructions,inventoryItems:(he=Y.requiredInventory)==null?void 0:he.map(B=>({id:B.id,name:B.name,currentStock:B.available,requiredQuantity:B.required,category:"Cleaning Supplies"})),completed:Y.completed||!1}})})),K=hE.filter(V=>{const Z=V.name.toLowerCase().includes(a.toLowerCase()),ne=c==="all"||V.category===c;return Z&&ne});return r.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsx(pE,{activeTab:n,onTabChange:y}),n==="checklists"&&r.jsx(gE,{selectedCategory:e,selectedChecklist:t,bypassedItems:l,adjustedQuantities:o,onCategoryClick:w,onChecklistSelect:S,onBypassItem:P,onAdjustQuantity:N,onViewSDS:x,onMarkComplete:C,getChecklistsForCategory:L}),n==="sds"&&r.jsx(yE,{searchQuery:a,sdsCategory:c,filteredSDSSheets:K,onTabChange:y,onSearchQueryChange:g,onSdsCategoryChange:b,onSDSSelect:x}),r.jsx(_E,{showModal:d,selectedCategory:e,selectedChecklist:t,bypassedItems:l,adjustedQuantities:o,stolenItems:h,prnItems:p,notes:u,isListening:H,transcript:A,onClose:T,onChecklistSelect:S,onSetSelectedChecklist:f,onBypassItem:P,onAdjustQuantity:N,onViewSDS:x,onAddStolenItem:j,onUpdateStolenItem:D,onClearStolenItems:k,onAddPrnItem:E,onUpdatePrnItem:O,onClearPrnItems:$,onNotesChange:v,onClearNotes:U,onStartSpeechRecognition:z,onStopSpeechRecognition:M,onApplyTranscriptToNotes:W,getChecklistsForCategory:L}),r.jsx(wE,{selectedSDS:i,onClose:()=>x(null)})]})},CE=()=>r.jsx("div",{children:r.jsx(SE,{})}),jE=X.memo(({clean:s})=>r.jsxs("div",{className:"p-4 border rounded-lg shadow-sm",children:[r.jsxs("h3",{className:"font-medium text-gray-900",children:["Room ",s.id]}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",s.status]})]}));jE.displayName="EnvironmentalCleanItem";const NE=()=>{const s=Ur(),[e]=m.useState(!1),t=mT(),n=m.useRef(t);n.current=t;const{rooms:a}=$m(),{searchTerm:i,status:c,onSearchChange:l,onStatusChange:o}=aT(a);m.useEffect(()=>{n.current.mutate({action:"view_page"})},[]),m.useEffect(()=>{c&&c!=="all"&&n.current.mutate({action:"filter_status",item:{status:c}})},[c]);const d=()=>{console.log("🔍 Navigating to scanner page..."),s("/environmental-clean/scanner")};return r.jsx(CT,{children:r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsx(hT,{isScanning:e,onScan:d,searchTerm:i,onSearchTermChange:l,selectedStatus:c,onStatusChange:o}),r.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[r.jsx(BT,{}),r.jsx(VT,{})]}),r.jsx(CE,{})]})})]})})},IE=()=>{const[s]=m.useState(null);return m.useEffect(()=>(console.log("ℹ️ Workflow session creation temporarily disabled to avoid RLS issues"),()=>{s&&AI.endSession(s).catch(e=>{console.error("❌ Failed to end environmental cleaning workflow session:",e)})}),[s]),r.jsx(qr,{FallbackComponent:DI,children:r.jsx(Hr,{children:r.jsx(qr,{FallbackComponent:PI,children:r.jsx(NE,{})})})})};var TE=Object.defineProperty,Ed=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,kd=(s,e,t)=>e in s?TE(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,DE=(s,e)=>{for(var t in e||(e={}))EE.call(e,t)&&kd(s,t,e[t]);if(Ed)for(var t of Ed(e))kE.call(e,t)&&kd(s,t,e[t]);return s},Qa=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class In{static scanRoomBarcode(e){return Qa(this,null,function*(){var t,n,a,i,c;try{if(!e||e.trim()==="")return{success:!1,message:"Please enter a valid barcode"};const{data:l,error:o}=yield _.from("rooms").select("*").eq("barcode",e.trim()).eq("is_active",!0).single();if(o){if(o.code==="PGRST116")return{success:!1,message:`Room with barcode "${e}" not found in system`};throw o}if(!l)return{success:!1,message:"Room not found in system"};const d=l,u={id:d.id,barcode:d.barcode,name:d.name,department:(t=d.department)!=null?t:void 0,floor:(n=d.floor)!=null?n:void 0,building:(a=d.building)!=null?a:void 0,roomType:(i=d.room_type)!=null?i:void 0,capacity:(c=d.capacity)!=null?c:void 0,isActive:d.is_active,createdAt:d.created_at,updatedAt:d.updated_at};return Xe.log("environmental_clean","room_scanned",{roomId:u.id,roomName:u.name,barcode:e,timestamp:new Date().toISOString()}),{success:!0,room:u,message:`Room "${u.name}" scanned successfully!`}}catch(l){return console.error("❌ Error scanning room barcode:",l),{success:!1,message:"An error occurred while scanning the barcode. Please try again."}}})}static updateRoomStatus(e,t){return Qa(this,null,function*(){try{if(!e)return{success:!1,message:"Room ID is required"};if(!gi.getState().getAllStatusTypes().map(p=>p.id).includes(t))return{success:!1,message:`Invalid status: ${t}`};const{data:c,error:l}=yield _.from("rooms").select("name").eq("id",e).single();if(l||!c)return{success:!1,message:"Room not found in system"};const o=c,d=this.mapStatusToDatabase(t),u={status:d,updated_at:new Date().toISOString()};t==="available"&&(u.completed_time=new Date().toISOString());const{data:h}=yield _.from("environmental_cleans_enhanced").select("id").eq("room_id",e).order("created_at",{ascending:!1}).limit(1).single();if(h){const p=h,{error:f}=yield _.from("environmental_cleans_enhanced").update(u).eq("id",p.id);if(f)throw f}else{const p=DE({room_id:e,room_name:o.name,status:d,cleaning_type:"routine",scheduled_time:new Date().toISOString()},u),{error:f}=yield _.from("environmental_cleans_enhanced").insert(p);if(f)throw f}return Xe.log("environmental_clean","room_status_updated",{roomId:e,roomName:o.name,status:t,timestamp:new Date().toISOString()}),{success:!0,message:`Room "${o.name}" status updated to ${t}`,roomId:e,status:t}}catch(n){return console.error("❌ Error updating room status:",n),{success:!1,message:"An error occurred while updating room status. Please try again."}}})}static completeRoomCleaning(e,t){return Qa(this,null,function*(){var n;try{const{data:a,error:i}=yield _.from("rooms").select("name").eq("id",e).single();if(i||!a)return{success:!1,message:"Room not found in system"};const c=a,{data:l,error:o}=yield _.from("environmental_cleans_enhanced").update({status:"completed",completed_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("room_id",e).order("created_at",{ascending:!1}).limit(1).select().single();if(o)throw o;if(t&&t.length>0&&l){const{data:d}=yield _.auth.getUser(),u=(n=d==null?void 0:d.user)==null?void 0:n.id,h=t.map(f=>({environmental_clean_id:l.id,inventory_item_id:f.itemId,quantity_used:f.quantity,usage_reason:f.usageReason,task_step:f.taskStep,used_by:u!=null?u:null})),{error:p}=yield _.from("environmental_cleaning_inventory_usage").insert(h);p&&console.error("❌ Error tracking inventory usage:",p)}return Xe.log("environmental_clean","room_cleaning_completed",{roomId:e,roomName:c.name,inventoryUsage:(t==null?void 0:t.length)||0,timestamp:new Date().toISOString()}),{success:!0,message:`Room "${c.name}" cleaning completed successfully`,roomId:e,status:"clean"}}catch(a){return console.error("❌ Error completing room cleaning:",a),{success:!1,message:"An error occurred while completing room cleaning. Please try again."}}})}static getAvailableStatuses(){const e=gi.getState(),t=e.getCoreStatusTypes(),n=e.getPublishedStatusTypes();return[...t,...n.filter(a=>!a.isCore)]}static mapStatusToDatabase(e){return{Clean:"clean",Dirty:"dirty","In Progress":"in_progress","Out of Service":"cancelled",Supervisor:"pending",Isolation:"failed",Quarantine:"failed",Maintenance:"pending","Equipment Failure":"failed","Patient Occupied":"pending","Discharge Cleaning":"pending",Unassigned:"pending","Audit Required":"pending"}[e]||"dirty"}static mapDatabaseToStatus(e){return{completed:"Clean",clean:"Clean",pending:"Dirty",dirty:"Dirty",in_progress:"In Progress",failed:"Supervisor",cancelled:"Out of Service"}[e]||"Dirty"}}var Ya=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const PE=()=>{var s;const e=Ur(),[t,n]=m.useState(!1),[a,i]=m.useState(null),[c,l]=m.useState(""),[o,d]=m.useState(""),[u,h]=m.useState(null),p=m.useMemo(()=>In.getAvailableStatuses().map(w=>({id:w.id,name:w.name,icon:w.icon||"default-icon",color:w.color||"#6b7280",description:w.description||"",isCore:w.isCore||!1})),[]),f=()=>Ya(null,null,function*(){n(!0),i(null),h(null);try{const v=["ROOM-001","ROOM-002","ROOM-003","ROOM-004","ROOM-005"],w=v[Math.floor(Math.random()*v.length)],S=yield In.scanRoomBarcode(w);S.success&&S.room?(i("success"),l(S.message),h(S.room)):(i("error"),l(S.message))}catch(v){console.error(v),i("error"),l("An error occurred during scanning. Please try again.")}finally{n(!1)}}),y=v=>{const S={clean:"clean",dirty:"dirty",in_progress:"in_progress",available:"available",biohazard:"biohazard",theft:"theft",low_inventory:"low_inventory",out_of_service:"out_of_service",public_areas:"public_areas"}[v]||"dirty";d(S)},g=()=>Ya(null,null,function*(){if(!u){l("No room selected for cleaning completion");return}try{const v=yield In.completeRoomCleaning(u.id);v.success?(l(v.message),setTimeout(()=>{e("/environmental-clean")},2e3)):l(v.message)}catch(v){console.error(v),l("An error occurred while completing cleaning. Please try again.")}}),x=()=>Ya(null,null,function*(){if(!u||!o){l("Please select a room and status");return}try{const v=yield In.updateRoomStatus(u.id,o);v.success?(l(v.message),setTimeout(()=>{e("/environmental-clean")},2e3)):l(v.message)}catch(v){console.error(v),l("An error occurred while updating status. Please try again.")}}),b=()=>{e("/environmental-clean")};return r.jsxs(Hr,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:b,onKeyDown:v=>v.key==="Escape"&&b(),role:"button",tabIndex:0}),r.jsx(se.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3,ease:"easeInOut"},className:"fixed inset-y-0 right-0 w-[40%] bg-white shadow-2xl z-50",children:r.jsx("div",{className:"h-full flex flex-col",children:r.jsxs("div",{className:"bg-white overflow-hidden h-full",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center gap-4",children:[r.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(I,{path:bu,size:1.2,className:"text-gray-600"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Environmental Clean Scanner"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Scan rooms for cleaning management"})]})]}),r.jsx("div",{className:"p-4 overflow-y-auto flex-1 hide-scrollbar",children:o?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[r.jsxs("h3",{className:"font-semibold text-blue-800 mb-1",children:[o.charAt(0).toUpperCase()+o.slice(1)," ","Status"]}),r.jsx("p",{className:"text-blue-600 text-sm",children:(s=p.find(v=>v.id===o))==null?void 0:s.description})]}),u&&r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[r.jsx("h3",{className:"font-semibold text-green-800 mb-1",children:"Scanned Room"}),r.jsxs("p",{className:"text-green-600 text-sm",children:[r.jsx("strong",{children:"Name:"})," ",u.name,r.jsx("br",{}),r.jsx("strong",{children:"Department:"})," ",u.department||"N/A",r.jsx("br",{}),r.jsx("strong",{children:"Floor:"})," ",u.floor||"N/A",r.jsx("br",{}),r.jsx("strong",{children:"Building:"})," ",u.building||"N/A"]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[r.jsxs("div",{className:"text-center space-y-4",children:[r.jsxs("div",{className:"relative bg-black h-64 rounded-lg overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 to-black"}),r.jsx(se.div,{className:"absolute left-0 right-0 h-1 bg-[#4ECDC4]",animate:{top:["10%","90%","10%"],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),r.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-2 border-[#4ECDC4] w-48 h-48 rounded-lg",children:[r.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#4ECDC4] rounded-tl"}),r.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#4ECDC4] rounded-tr"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#4ECDC4] rounded-bl"}),r.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#4ECDC4] rounded-br"})]}),r.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 mr-2 animate-pulse"}),r.jsx("span",{className:"text-white text-xs",children:"Camera active"})]}),r.jsx("button",{onClick:f,disabled:t,className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-4 rounded-full transition-all duration-200 ${t?"bg-gray-600 cursor-not-allowed":"bg-[#4ECDC4] hover:bg-[#3db8b0] shadow-lg hover:shadow-xl"}`,children:r.jsx(I,{path:qe,size:1.5,className:`${t?"text-gray-400":"text-white"}`})})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:t?"Scanning...":"Click to Scan"}),r.jsx("p",{className:"text-gray-600 text-sm",children:t?"Position room barcode in camera view":"Use camera to scan room barcode"})]})]}),a&&r.jsx(se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-lg ${a==="success"?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{path:qe,size:1,className:a==="success"?"text-green-600":"text-red-600"}),r.jsx("span",{className:`font-medium ${a==="success"?"text-green-800":"text-red-800"}`,children:c})]})})]}),r.jsxs("div",{className:"flex justify-center space-x-4",children:[r.jsx("button",{onClick:()=>d(""),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"← Back to Status Selection"}),a==="success"&&u&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Update Status"}),r.jsx("button",{onClick:g,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Complete Cleaning"})]})]})]}):r.jsxs("div",{className:"space-y-3",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-3",children:"Select Room Status"}),r.jsx("div",{className:"space-y-2",children:p.map(v=>r.jsx("button",{onClick:()=>y(v.id),className:`w-full p-3 rounded-lg border-2 transition-all duration-200 text-left ${v.color==="#16a34a"?"border-green-200 hover:border-green-300 bg-green-50 hover:bg-green-100":v.color==="#ca8a04"?"border-yellow-200 hover:border-yellow-300 bg-yellow-50 hover:bg-yellow-100":v.color==="#dc2626"?"border-red-200 hover:border-red-300 bg-red-50 hover:bg-red-100":v.color==="#9333ea"?"border-purple-200 hover:border-purple-300 bg-purple-50 hover:bg-purple-100":v.color==="#4b5563"?"border-gray-200 hover:border-gray-300 bg-gray-50 hover:bg-gray-100":v.color==="#b45309"?"border-amber-200 hover:border-amber-300 bg-amber-50 hover:bg-amber-100":v.color==="#047857"?"border-emerald-200 hover:border-emerald-300 bg-emerald-50 hover:bg-emerald-100":"border-gray-200 hover:border-gray-300 bg-gray-50 hover:bg-gray-100"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`p-1.5 rounded-lg ${v.color==="#16a34a"?"bg-green-100":v.color==="#ca8a04"?"bg-yellow-100":v.color==="#dc2626"?"bg-red-100":v.color==="#9333ea"?"bg-purple-100":v.color==="#4b5563"?"bg-gray-100":v.color==="#b45309"?"bg-amber-100":v.color==="#047857"?"bg-emerald-100":"bg-gray-100"}`,children:r.jsx(I,{path:v.icon,size:1,className:v.color==="#16a34a"?"text-green-600":v.color==="#ca8a04"?"text-yellow-600":v.color==="#dc2626"?"text-red-600":v.color==="#9333ea"?"text-purple-600":v.color==="#4b5563"?"text-gray-600":v.color==="#b45309"?"text-amber-600":v.color==="#047857"?"text-emerald-600":"text-gray-600"})}),r.jsxs("div",{children:[r.jsx("h4",{className:`font-semibold text-sm ${v.color==="#16a34a"?"text-green-800":v.color==="#ca8a04"?"text-yellow-800":v.color==="#dc2626"?"text-red-800":v.color==="#9333ea"?"text-purple-800":v.color==="#4b5563"?"text-gray-800":v.color==="#b45309"?"text-amber-800":v.color==="#047857"?"text-emerald-800":"text-gray-800"}`,children:v.name}),r.jsx("p",{className:`text-xs ${v.color==="#16a34a"?"text-green-600":v.color==="#ca8a04"?"text-yellow-600":v.color==="#dc2626"?"text-red-600":v.color==="#9333ea"?"text-purple-600":v.color==="#4b5563"?"text-gray-600":v.color==="#b45309"?"text-amber-600":v.color==="#047857"?"text-emerald-600":"text-gray-600"}`,children:v.description})]})]})},v.id))})]})})]})})})]})};var RE=Object.defineProperty,Dd=Object.getOwnPropertySymbols,AE=Object.prototype.hasOwnProperty,OE=Object.prototype.propertyIsEnumerable,Pd=(s,e,t)=>e in s?RE(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Rd=(s,e)=>{for(var t in e||(e={}))AE.call(e,t)&&Pd(s,t,e[t]);if(Dd)for(var t of Dd(e))OE.call(e,t)&&Pd(s,t,e[t]);return s},pe=(s=>(s.NETWORK_ERROR="NETWORK_ERROR",s.VALIDATION_ERROR="VALIDATION_ERROR",s.CONTENT_NOT_FOUND="CONTENT_NOT_FOUND",s.OPERATION_FAILED="OPERATION_FAILED",s.UNAUTHORIZED="UNAUTHORIZED",s.RATE_LIMIT_EXCEEDED="RATE_LIMIT_EXCEEDED",s.SERVER_ERROR="SERVER_ERROR",s.TIMEOUT_ERROR="TIMEOUT_ERROR",s))(pe||{}),Le=(s=>(s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH",s.CRITICAL="CRITICAL",s))(Le||{});class Os extends Error{constructor(e,t,n={}){var a,i;super(t),this.name="ApiError",this.type=e,this.code=n.code,this.retryable=(a=n.retryable)!=null?a:this.isRetryableByDefault(e),this.severity=(i=n.severity)!=null?i:this.getSeverityByType(e),this.context=n.context}isRetryableByDefault(e){switch(e){case"NETWORK_ERROR":case"TIMEOUT_ERROR":case"SERVER_ERROR":return!0;case"VALIDATION_ERROR":case"CONTENT_NOT_FOUND":case"UNAUTHORIZED":case"RATE_LIMIT_EXCEEDED":return!1;default:return!1}}getSeverityByType(e){switch(e){case"UNAUTHORIZED":return"CRITICAL";case"NETWORK_ERROR":case"SERVER_ERROR":return"HIGH";case"VALIDATION_ERROR":case"RATE_LIMIT_EXCEEDED":return"MEDIUM";case"CONTENT_NOT_FOUND":case"TIMEOUT_ERROR":return"LOW";default:return"MEDIUM"}}toKnowledgeHubError(e){return{type:this.type,message:this.message,code:this.code,details:this.context,retryable:this.retryable,severity:this.severity,timestamp:new Date,context:Rd(Rd({},this.context),e)}}}class Zt extends Os{constructor(e,t){super("VALIDATION_ERROR",e,{severity:"MEDIUM",context:{details:t}}),this.name="ValidationError"}}class Tn extends Os{constructor(e,t){super("NETWORK_ERROR",e,{severity:"HIGH",context:t}),this.name="NetworkError"}}class hs extends Os{constructor(e){super("CONTENT_NOT_FOUND",`Content with ID ${e} not found`,{severity:"LOW",context:{contentId:e}}),this.name="ContentNotFoundError"}}class $E extends m.Component{constructor(e){super(e),this.retryTimeouts=[],this.handleRetry=()=>{const{maxRetries:t=3,retryDelay:n=1e3}=this.props,{retryCount:a}=this.state;if(a>=t){console.warn("Max retry attempts reached");return}this.setState(c=>({hasError:!1,error:null,retryCount:c.retryCount+1}));const i=setTimeout(()=>{this.forceUpdate()},n);this.addTimeout(i)},this.state={hasError:!1,error:null,retryCount:0}}static getDerivedStateFromError(e){let t,n=!1,a;if(e instanceof Os)t=e.type,n=e.retryable,a=e.severity;else{const c=e.message.toLowerCase();c.includes("network")||c.includes("fetch")||c.includes("connection")?(t=pe.NETWORK_ERROR,n=!0,a=Le.HIGH):c.includes("timeout")?(t=pe.TIMEOUT_ERROR,n=!0,a=Le.MEDIUM):c.includes("auth")||c.includes("unauthorized")?(t=pe.UNAUTHORIZED,n=!1,a=Le.CRITICAL):c.includes("validation")||c.includes("invalid")?(t=pe.VALIDATION_ERROR,n=!1,a=Le.MEDIUM):c.includes("not found")||c.includes("404")?(t=pe.CONTENT_NOT_FOUND,n=!1,a=Le.LOW):(t=pe.OPERATION_FAILED,n=!0,a=Le.MEDIUM)}return{hasError:!0,error:{type:t,message:e.message,timestamp:new Date,retryable:n,severity:a,context:{component:"BaseErrorBoundary",operation:e.name}},retryCount:0}}componentDidCatch(e,t){const{onError:n,componentName:a}=this.props,{error:i}=this.state;console.error(`ErrorBoundary caught an error${a?` in ${a}`:""}:`,e,t),i&&n&&n(i),console.error("Production error logging:",{error:i,errorInfo:t,timestamp:new Date().toISOString()})}componentWillUnmount(){this.retryTimeouts.forEach(e=>clearTimeout(e)),this.retryTimeouts=[]}clearAllTimeouts(){this.retryTimeouts.forEach(e=>clearTimeout(e)),this.retryTimeouts=[]}addTimeout(e){this.retryTimeouts.push(e)}getErrorSeverity(e){return e.severity}getSeverityStyles(e){switch(e){case Le.CRITICAL:return"bg-red-50 border-red-200 text-red-800";case Le.HIGH:return"bg-orange-50 border-orange-200 text-orange-800";case Le.MEDIUM:return"bg-yellow-50 border-yellow-200 text-yellow-800";case Le.LOW:return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}}getErrorMessage(e){switch(e.type){case pe.NETWORK_ERROR:return"Connection issue detected. Please check your internet connection and try again.";case pe.TIMEOUT_ERROR:return"The request took too long to complete. Please try again.";case pe.UNAUTHORIZED:return"Your session has expired. Please log in again to continue.";case pe.VALIDATION_ERROR:return"The data provided is invalid. Please check your input and try again.";case pe.CONTENT_NOT_FOUND:return"The requested content could not be found.";case pe.OPERATION_FAILED:return"The operation failed. Please try again.";case pe.RATE_LIMIT_EXCEEDED:return"Too many requests. Please wait a moment and try again.";case pe.SERVER_ERROR:return"Server error occurred. Please try again later.";default:return"An unexpected error occurred. Please try again or contact support."}}renderErrorDetails(e){return null}render(){const{hasError:e,error:t}=this.state,{fallback:n,children:a}=this.props;return e&&t?n||this.renderErrorContent(t):a}}var ME=Object.defineProperty,FE=Object.defineProperties,zE=Object.getOwnPropertyDescriptors,Ad=Object.getOwnPropertySymbols,LE=Object.prototype.hasOwnProperty,BE=Object.prototype.propertyIsEnumerable,Od=(s,e,t)=>e in s?ME(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,qE=(s,e)=>{for(var t in e||(e={}))LE.call(e,t)&&Od(s,t,e[t]);if(Ad)for(var t of Ad(e))BE.call(e,t)&&Od(s,t,e[t]);return s},UE=(s,e)=>FE(s,zE(e));class HE extends $E{constructor(e){super(e),this.retryCount=0,this.handleRetry=()=>{const{maxRetries:t=3,retryDelay:n=1e3}=this.props,{error:a}=this.state;if(!(a!=null&&a.retryable)||this.retryCount>=t)return;this.retryCount++,this.setState({hasError:!1,error:null});const i=n*Math.pow(2,this.retryCount-1),c=setTimeout(()=>{this.forceUpdate()},i);this.addTimeout(c)},this.handleReset=()=>{this.clearAllTimeouts(),this.retryCount=0,this.setState({hasError:!1,error:null,errorCount:0,lastErrorTime:null},()=>{this.forceUpdate()})},this.handleNavigateHome=()=>{window.location.href="/"},this.renderErrorContent=t=>{const n=this.getErrorSeverity(t),{retryable:a}=t,i=()=>this.getSeverityStyles(n),c=()=>{switch(t.type){case pe.NETWORK_ERROR:case pe.TIMEOUT_ERROR:return it;case pe.UNAUTHORIZED:return de;default:return de}},l=()=>this.getErrorMessage(t),o=()=>{const d=[];return a&&this.retryCount<(this.props.maxRetries||3)&&d.push(r.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#3db8b0] transition-colors",children:[r.jsx(ue,{path:mp,size:.8}),"Retry"]},"retry")),d.push(r.jsxs("button",{onClick:this.handleReset,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors",children:[r.jsx(ue,{path:it,size:.8}),"Reset"]},"reset")),t.type===pe.UNAUTHORIZED&&d.push(r.jsxs("button",{onClick:this.handleNavigateHome,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:[r.jsx(ue,{path:gu,size:.8}),"Go Home"]},"home")),d};return r.jsx("div",{className:`min-h-screen flex items-center justify-center p-6 ${i()}`,children:r.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 border",children:r.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[r.jsx(ue,{path:c(),size:3,color:n===Le.CRITICAL?"#ef4444":"#f59e0b"}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:t.type?t.type.replace("_"," "):"UNKNOWN ERROR"}),r.jsx("p",{className:"text-gray-600 mb-4",children:l()}),t.message&&r.jsx("p",{className:"text-sm text-gray-500 mb-4",children:t.message})]}),r.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:o()}),this.renderErrorDetails(t),this.retryCount>0&&r.jsxs("p",{className:"text-xs text-gray-500",children:["Retry attempt ",this.retryCount," of ",this.props.maxRetries||3]})]})})})},this.state={hasError:!1,error:null,retryCount:0,errorCount:0,lastErrorTime:null}}static getDerivedStateFromError(e){const t=super.getDerivedStateFromError(e);return UE(qE({},t),{errorCount:1,lastErrorTime:new Date})}render(){const{hasError:e,error:t}=this.state,{fallback:n,children:a}=this.props;return e&&t?n||this.renderErrorContent(t):a}}var VE=Object.defineProperty,$d=Object.getOwnPropertySymbols,WE=Object.prototype.hasOwnProperty,GE=Object.prototype.propertyIsEnumerable,Md=(s,e,t)=>e in s?VE(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Fd=(s,e)=>{for(var t in e||(e={}))WE.call(e,t)&&Md(s,t,e[t]);if($d)for(var t of $d(e))GE.call(e,t)&&Md(s,t,e[t]);return s},Je=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const zd={MAX_REQUESTS_PER_WINDOW:100,WINDOW_MS:60*1e3,BURST_LIMIT:10,RETRY_DELAY:1e3,MAX_RETRIES:3};class Ld{constructor(e){this.requests=[],this.burstRequests=[],this.maxRequests=e.MAX_REQUESTS_PER_WINDOW,this.windowMs=e.WINDOW_MS,this.burstLimit=e.BURST_LIMIT,this.retryDelay=e.RETRY_DELAY,this.maxRetries=e.MAX_RETRIES}cleanup(){const e=Date.now();this.requests=this.requests.filter(t=>e-t<this.windowMs),this.burstRequests=this.burstRequests.filter(t=>e-t<1e3)}canMakeRequest(){return this.cleanup(),this.requests.length<this.maxRequests}canMakeBurstRequest(){return this.cleanup(),this.burstRequests.length<this.burstLimit}acquireToken(){return Je(this,null,function*(){let e=0;for(;!this.canMakeRequest();){if(e>=this.maxRetries)throw new Error("Rate limit exceeded. Please try again later.");yield new Promise(t=>setTimeout(t,this.retryDelay)),e++}this.requests.push(Date.now())})}acquireBurstToken(){return Je(this,null,function*(){let e=0;for(;!this.canMakeBurstRequest();){if(e>=this.maxRetries)throw new Error("Burst rate limit exceeded. Please try again later.");yield new Promise(t=>setTimeout(t,this.retryDelay/2)),e++}this.burstRequests.push(Date.now())})}getStats(){return this.cleanup(),{currentRequests:this.requests.length,currentBurstRequests:this.burstRequests.length,maxRequests:this.maxRequests,maxBurstRequests:this.burstLimit,windowMs:this.windowMs}}reset(){this.requests=[],this.burstRequests=[]}}const Ja=(s,e,t=!1)=>Je(null,null,function*(){if(e)try{t?yield e.acquireBurstToken():yield e.acquireToken()}catch(n){throw new Tn(n instanceof Error?n.message:"Rate limit exceeded",{endpoint:s,rateLimited:!0})}try{const{data:n,error:a}=yield _.from("knowledge_articles").select("*");if(a)throw new Tn(a.message,{endpoint:s,originalError:a});return n}catch(n){throw n instanceof Os?n:n instanceof Error?new Tn(n.message,{endpoint:s,originalError:n}):new Tn("Unknown error occurred",{endpoint:s})}}),Bd=s=>{if(!s||typeof s!="object")throw new Zt("Invalid content item data");const e=s;if(!e.id||typeof e.id!="string")throw new Zt("Content item must have a valid ID");if(!e.title||typeof e.title!="string")throw new Zt("Content item must have a valid title");if(!e.category||!["Courses","Procedures","Policies","Learning Pathways","Advanced"].includes(e.category))throw new Zt("Content item must have a valid category");if(!e.status||!["Not Started","In Progress","Completed"].includes(e.status))throw new Zt("Content item must have a valid status");if(typeof e.progress!="number"||e.progress<0||e.progress>100)throw new Zt("Content item must have a valid progress value (0-100)");return e};class KE{constructor(){this.requestCache=new Map,this.CACHE_DURATION=300*1e3,this.rateLimiter=new Ld(zd)}getCachedData(e){const t=this.requestCache.get(e);return t&&Date.now()-t.timestamp<this.CACHE_DURATION?t.data:(this.requestCache.delete(e),null)}setCachedData(e,t){this.requestCache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.requestCache.clear()}invalidateRelatedCaches(e){const t=[];for(const n of this.requestCache.keys())(n.includes("fetchContent")||n.includes("contentStats"))&&t.push(n),e&&n.includes(e)&&t.push(n);t.forEach(n=>this.requestCache.delete(n))}fetchContent(){return Je(this,null,function*(){const e="fetchContent",t=this.getCachedData(e);if(t)return t;const n=[{id:"1",title:"Basic Sterilization Training",description:"Learn the fundamentals of sterilization procedures",category:"Courses",status:"draft",progress:0,dueDate:"2024-12-31",lastUpdated:"2024-12-01",department:"Sterilization",tags:["beginner","required"],estimatedDuration:30,difficultyLevel:"Beginner"},{id:"2",title:"Advanced Autoclave Procedures",description:"Master advanced autoclave operation techniques",category:"Procedures",status:"draft",progress:45,dueDate:"2024-12-15",lastUpdated:"2024-12-05",department:"Sterilization",tags:["advanced","hands-on"],estimatedDuration:60,difficultyLevel:"Advanced"},{id:"3",title:"Safety Protocols",description:"Essential safety protocols for medical facilities",category:"Policies",status:"draft",progress:100,dueDate:"2024-11-30",lastUpdated:"2024-11-25",department:"General",tags:["safety","mandatory"],estimatedDuration:45,difficultyLevel:"Intermediate"}];return this.setCachedData(e,n),n})}fetchContentByCategory(e){return Je(this,null,function*(){const t=`fetchContentByCategory:${e}`,n=this.getCachedData(t);if(n)return n;const i=(yield this.fetchContent()).filter(c=>c.category===e);return this.setCachedData(t,i),i})}updateContent(e,t){return Je(this,null,function*(){try{let n;t?n=t:n=yield Ja(`/content/${e}`,this.rateLimiter,!0);const a=Bd(n);return this.invalidateRelatedCaches(e),a}catch(n){throw n instanceof hs?new hs(e):n}})}updateContentStatus(e,t){return Je(this,null,function*(){if(!["Not Started","In Progress","Completed"].includes(t))throw new Zt(`Invalid status: ${t}`);return this.updateContent(e,{status:t})})}deleteContent(e){return Je(this,null,function*(){try{yield Ja(`/content/${e}`,this.rateLimiter,!0),this.invalidateRelatedCaches(e)}catch(t){throw t instanceof hs?new hs(e):t}})}searchContent(e,t){return Je(this,null,function*(){const n=new URLSearchParams;n.append("q",e),t!=null&&t.category&&n.append("category",t.category),t!=null&&t.status&&n.append("status",t.status),t!=null&&t.department&&n.append("department",t.department);try{return(yield Ja(`/content/search?${n.toString()}`,this.rateLimiter)).map(i=>Bd(i))}catch(a){if(a instanceof hs)return[];throw a}})}getContentStats(){return Je(this,null,function*(){const e="contentStats",t=this.getCachedData(e);if(t)return t;const n=yield this.fetchContent(),a={total:n.length,byCategory:{},byStatus:{}};return n.forEach(i=>{a.byCategory[i.category]=(a.byCategory[i.category]||0)+1,a.byStatus[i.status]=(a.byStatus[i.status]||0)+1}),this.setCachedData(e,a),a})}healthCheck(){return Je(this,null,function*(){return!0})}getRateLimitStats(){return this.rateLimiter.getStats()}resetRateLimiter(){this.rateLimiter.reset()}updateRateLimitConfig(e){this.rateLimiter=new Ld(Fd(Fd({},zd),e))}}const vs=new KE;vs.clearCache=()=>{console.log("Cache cleared")};var QE=Object.defineProperty,qd=Object.getOwnPropertySymbols,YE=Object.prototype.hasOwnProperty,JE=Object.prototype.propertyIsEnumerable,Ud=(s,e,t)=>e in s?QE(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Xa=(s,e)=>{for(var t in e||(e={}))YE.call(e,t)&&Ud(s,t,e[t]);if(qd)for(var t of qd(e))JE.call(e,t)&&Ud(s,t,e[t]);return s},En=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});class Te{static getCategoryCount(e,t){return e.filter(n=>n.category===t).length}static updateContentInList(e,t,n){return e.map(a=>a.id===t?Xa(Xa({},a),n):a)}static removeContentFromList(e,t){return e.filter(n=>n.id!==t)}static performContentUpdate(e,t){return En(this,null,function*(){try{return yield vs.updateContent(e,t)}catch(n){return console.error(n),Xa({id:e},t)}})}static performContentDeletion(e){return En(this,null,function*(){try{return yield vs.deleteContent(e)}catch(t){console.error(t);return}})}static performContentStatusUpdate(e,t){return En(this,null,function*(){try{return yield vs.updateContentStatus(e,t)}catch(n){return console.error(n),{id:e,status:t}}})}static performContentFetch(){return En(this,null,function*(){try{return yield vs.fetchContent()}catch(e){return console.error(e),[]}})}static createError(e){return new Error(e)}static getErrorMessage(e){return e instanceof Error?e.message:"An unknown error occurred"}}var xs=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const XE=()=>xs(null,null,function*(){try{return[{id:"course-1",title:"Sterilization Fundamentals",description:"Learn the basics of sterilization processes and best practices",category:"Courses",status:"draft",dueDate:new Date().toISOString().split("T")[0],progress:0,department:"central_sterile",lastUpdated:void 0,difficultyLevel:"Beginner",estimatedDuration:30},{id:"course-2",title:"Advanced Sterilization Techniques",description:"Master advanced sterilization methods and troubleshooting",category:"Courses",status:"review",dueDate:new Date().toISOString().split("T")[0],progress:45,department:"central_sterile",lastUpdated:"2025-01-15T10:00:00Z",difficultyLevel:"Advanced",estimatedDuration:60},{id:"policy-1",title:"Infection Control Policy",description:"Comprehensive infection prevention and control guidelines",category:"Policies",status:"draft",dueDate:new Date().toISOString().split("T")[0],progress:0,department:"clinical",lastUpdated:void 0,difficultyLevel:"Beginner",estimatedDuration:20},{id:"procedure-1",title:"Steam Sterilization Procedure",description:"Step-by-step steam sterilization process",category:"Procedures",status:"published",dueDate:new Date().toISOString().split("T")[0],progress:100,department:"central_sterile",lastUpdated:"2025-01-10T14:30:00Z",difficultyLevel:"Beginner",estimatedDuration:15}]}catch(s){return console.error("❌ getAllContentItems: Error:",s),[{id:"fallback-1",title:"Sample Course",description:"This is a sample course for demonstration",category:"Courses",status:"draft",dueDate:new Date().toISOString().split("T")[0],progress:0,department:"general",lastUpdated:new Date().toISOString(),difficultyLevel:"Beginner",estimatedDuration:15}]}}),Wm=m.createContext(void 0),ZE=({children:s})=>{const[e,t]=m.useState([]),[n,a]=m.useState(null),[i,c]=m.useState(!1),[l,o]=m.useState(null),[d,u]=m.useState(null),[h,p]=m.useState(null),f=m.useCallback(()=>xs(null,null,function*(){try{c(!0),o(null);const T=yield XE();if(t(T),a(T),!d&&T.length>0){const C=T[0].category;u(C)}_.auth.getUser().then(C=>{var P;(P=C==null?void 0:C.data)!=null&&P.user}).catch(C=>{console.warn("Supabase auth not available:",C)})}catch(T){const C=Te.getErrorMessage(T);o(Te.createError(C)),console.error("❌ KnowledgeHub: Error fetching content:",T)}finally{c(!1)}}),[]);m.useEffect(()=>{const T=setTimeout(()=>{f()},0);return()=>clearTimeout(T)},[f]);const y=m.useCallback((T,C)=>xs(null,null,function*(){try{c(!0),o(null);const P=yield Te.performContentUpdate(T,C);return t(N=>Te.updateContentInList(N,T,P)),!0}catch(P){const N=Te.getErrorMessage(P);return o(Te.createError(N)),!1}finally{c(!1)}}),[]),g=m.useCallback(T=>xs(null,null,function*(){try{return c(!0),o(null),yield Te.performContentDeletion(T),t(C=>Te.removeContentFromList(C,T)),!0}catch(C){const P=Te.getErrorMessage(C);return o(Te.createError(P)),!1}finally{c(!1)}}),[]),x=m.useCallback(T=>Te.getCategoryCount(e,T),[e]),b=m.useCallback((T,C)=>xs(null,null,function*(){try{c(!0),o(null);const P=yield Te.performContentStatusUpdate(T,C);return t(N=>Te.updateContentInList(N,T,P)),!0}catch(P){const N=Te.getErrorMessage(P);return o(Te.createError(N)),!1}finally{c(!1)}}),[]),v=m.useCallback(()=>{p(null)},[]),w=m.useCallback(T=>{u(T);const C=e.filter(P=>P.category===T);a(C)},[e]),S={content:e,selectedContent:n,selectedCategory:d,isLoading:i,error:l,validationError:h,setSelectedCategory:w,getCategoryCount:x,refetchContent:f,deleteContent:g,updateContentStatus:b,updateContent:y,clearValidationError:v};return r.jsx(Wm.Provider,{value:S,children:s})},Wr=()=>{const s=m.useContext(Wm);if(s===void 0)throw new Error("useSimplifiedKnowledgeHub must be used within a SimplifiedKnowledgeHubProvider");return s};var ek=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const tk=()=>{const[s,e]=m.useState([]),[t,n]=m.useState(!0),[a,i]=m.useState(null);m.useEffect(()=>{ek(null,null,function*(){try{n(!0),i(null);const{data:{user:o}}=yield _.auth.getUser();if(!o){e([]);return}const d=yield pp.getRecentUserActivity(o.id,10);e(d)}catch(o){console.error("❌ RecentUpdatesPanel: Error fetching recent updates:",o),i("Failed to load recent updates"),e([])}finally{n(!1)}})},[]);const c=l=>{const o=new Date(l),u=Math.floor((new Date().getTime()-o.getTime())/(1e3*60*60));return u<1?"Just now":u<24?`${u}h ago`:`${Math.floor(u/24)}d ago`};return r.jsxs("div",{className:"bg-white rounded-lg shadow p-4",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center mb-2",children:[r.jsx(I,{path:hp,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Recent Updates"]}),r.jsx("div",{className:"overflow-y-auto scrollbar-hide",style:{maxHeight:"175px"},children:t?r.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"Loading updates..."}):a?r.jsx("div",{className:"text-center py-4 text-red-500 text-sm",children:a}):s.length>0?s.map(l=>r.jsxs("div",{className:"flex items-center py-1.5 hover:bg-gray-50 rounded-lg transition-colors",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-[#5b5b5b]",children:l.title}),r.jsx("p",{className:"text-xs text-gray-500",children:c(l.time)})]}),r.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${l.type==="new"?"bg-blue-100 text-blue-700":l.type==="completed"?"bg-green-100 text-green-700":l.type==="assigned"?"bg-purple-100 text-purple-700":l.type==="viewed"?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"}`,children:l.type?l.type.charAt(0).toUpperCase()+l.type.slice(1):"Unknown"})]},l.id)):r.jsxs("div",{className:"text-center py-6 text-gray-500",children:[r.jsx("div",{className:"text-sm mb-2",children:"No recent updates yet"}),r.jsx("div",{className:"text-xs text-gray-400",children:"Start learning to see your progress here"})]})})]})};class ps{static filterByCategory(e,t){return!e||!Array.isArray(e)?[]:e.filter(n=>n.category===t)}static filterContent(e,t){let n=[...e];if(t.searchQuery.trim()){const a=t.searchQuery.toLowerCase();n=n.filter(i=>{var c,l,o,d;return i.title.toLowerCase().includes(a)||((l=(c=i.data)==null?void 0:c.description)==null?void 0:l.toLowerCase().includes(a))||((d=(o=i.data)==null?void 0:o.tags)==null?void 0:d.some(u=>u.toLowerCase().includes(a)))})}return t.selectedDomain&&t.selectedDomain!=="All"&&(n=n.filter(a=>a.domain===t.selectedDomain)),t.selectedContentType&&t.selectedContentType!=="All"&&(n=n.filter(a=>a.contentType===t.selectedContentType)),n}static getCategoryCount(e,t){return!e||!Array.isArray(e)?0:e.filter(n=>n.category===t).length}static getUniqueDomains(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(n=>n.domain).filter(n=>!!n));return Array.from(t).sort()}static getUniqueContentTypes(e){if(!e||!Array.isArray(e))return[];const t=new Set(e.map(n=>n.contentType).filter(n=>!!n));return Array.from(t).sort()}}const Gm=({content:s,selectedCategory:e,filterOptions:t})=>{const n=m.useMemo(()=>!s||!Array.isArray(s)?[]:ps.filterByCategory(s,e||""),[s,e]),a=m.useMemo(()=>ps.filterContent(n,t),[n,t]),i=m.useMemo(()=>s?ps.getUniqueDomains(s):[],[s]),c=m.useMemo(()=>s?ps.getUniqueContentTypes(s):[],[s]);return{categoryItems:n,filteredItems:a,uniqueDomains:i,uniqueContentTypes:c,getCategoryCount:o=>s?ps.getCategoryCount(s,o):0}},rk={Courses:{icon:"#9333ea",bgColor:"bg-purple-100",textColor:"text-purple-600",selectedBgColor:"bg-purple-50"},"Learning Pathways":{icon:"#16a34a",bgColor:"bg-green-100",textColor:"text-green-600",selectedBgColor:"bg-green-50"},Procedures:{icon:"#ea580c",bgColor:"bg-orange-100",textColor:"text-orange-600",selectedBgColor:"bg-orange-50"},Policies:{icon:"#3b82f6",bgColor:"bg-blue-100",textColor:"text-blue-600",selectedBgColor:"bg-blue-50"}},sk=()=>{const{selectedCategory:s,setSelectedCategory:e,content:t}=Wr(),{getCategoryCount:n}=Gm({content:t,selectedCategory:s,filterOptions:{searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""}}),a=[{id:"Courses",icon:Ns},{id:"Learning Pathways",icon:_u},{id:"Procedures",icon:Ue},{id:"Policies",icon:Cs}];return r.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center mb-4",children:[r.jsx(I,{path:fp,size:1.1,color:"#4ECDC4",className:"mr-2"}),"Categories"]}),r.jsx("div",{className:"space-y-2",children:a.map(i=>{const c=rk[i.id];return r.jsxs("button",{onClick:()=>e(i.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors flex items-center justify-between ${s===i.id?`${c.selectedBgColor} ${c.textColor}`:"text-[#5b5b5b] hover:bg-gray-100"}`,children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`${c.bgColor} rounded-full p-1 mr-2`,children:r.jsx(I,{path:i.icon,size:.9,color:c.icon,"aria-hidden":"true"})}),i.id]}),r.jsx("span",{className:"text-sm text-gray-500",children:n(i.id)})]},i.id)})})]})};class nk{static determineRenderState(e,t,n){const{isLoading:a,error:i}=e;return{shouldShowLoading:a,shouldShowError:!!i,shouldShowEmpty:!a&&!i&&(!t||n.length===0),shouldShowContent:!a&&!i&&!!t&&n.length>0}}static getTagColor(e){switch(e){case"Required":return"bg-red-100 text-red-800";case"Optional":return"bg-blue-100 text-blue-800";case"New":return"bg-green-100 text-green-800";case"Updated":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}}static getStatusColor(e){switch(e){case"Not Started":return"bg-gray-100 text-gray-700";case"In Progress":return"bg-blue-100 text-blue-700";case"Completed":return"bg-green-100 text-green-700";default:return"bg-gray-100 text-gray-700"}}static formatTimeAgo(e){const t=new Date,n=new Date(e),a=Math.floor((t.getTime()-n.getTime())/(1e3*60*60));if(a<1)return"Just now";if(a<24)return`${a} hours ago`;const i=Math.floor(a/24);if(i<7)return`${i} days ago`;const c=Math.floor(i/7);return c<4?`${c} weeks ago`:`${Math.floor(i/30)} months ago`}}const ak=({uiState:s,selectedCategory:e,categoryItems:t})=>m.useMemo(()=>nk.determineRenderState(s,e,t),[s,e,t]),Km=({selectedCategory:s})=>r.jsx("div",{className:"mt-4",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-50",children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s==="Courses"?"Course Name":s==="Learning Pathways"?"Pathway Name":s==="Procedures"?"Procedure Name":s==="Policies"?"Policy Name":"Content Name"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s==="Courses"?"Status":s==="Learning Pathways"?"Courses":s==="Procedures"?"Department":"Category"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s==="Courses"?"Due Date":s==="Learning Pathways"?"Status":"Last Updated"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s==="Courses"||s==="Learning Pathways"?"Progress":"Status"}),r.jsx("th",{className:"w-10 px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:s?"No content available in this category.":"Select a category to view content."})})})]})})}),bs=()=>r.jsx(fu,{rows:5,columns:4}),ik=({error:s,onRetry:e})=>r.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[r.jsx(I,{path:de,size:2,color:"#ef4444",className:"mb-2"}),r.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Failed to load content"}),r.jsx("p",{className:"text-gray-500 text-sm mb-4",children:s.message}),r.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-4 py-2 bg-[#4ECDC4] text-white rounded-md hover:bg-[#3db8b0] transition",children:[r.jsx(I,{path:it,size:.8}),"Retry"]})]}),ok=({category:s})=>{const e=m.useMemo(()=>{switch(s){case"Courses":return Ns;case"Learning Pathways":return _u;case"Procedures":return Ue;case"Policies":return Cs;default:return Ns}},[s]);return r.jsx(I,{path:e,size:1.1,color:"#4ECDC4",className:"mr-2"})},lk=({category:s,isLoading:e})=>r.jsxs("h2",{className:"text-lg font-semibold text-[#5b5b5b] flex items-center",children:[r.jsx(ok,{category:s}),s||"All Categories",e&&r.jsx("div",{className:"ml-2 animate-spin rounded-full h-4 w-4 border-b-2 border-[#4ECDC4]"})]}),ck=({category:s,items:e,CoursesTable:t,LearningPathwaysTable:n,ProceduresTable:a,PoliciesTable:i})=>m.useMemo(()=>{switch(s){case"Courses":return r.jsx(m.Suspense,{fallback:r.jsx(bs,{}),children:r.jsx(t,{items:e})});case"Learning Pathways":return r.jsx(m.Suspense,{fallback:r.jsx(bs,{}),children:r.jsx(n,{items:e})});case"Procedures":return r.jsx(m.Suspense,{fallback:r.jsx(bs,{}),children:r.jsx(a,{items:e})});case"Policies":return r.jsx(m.Suspense,{fallback:r.jsx(bs,{}),children:r.jsx(i,{items:e})});default:return r.jsx(Km,{selectedCategory:s})}},[s,e,t,n,a,i]),dk=({pagination:s,onPageChange:e,onPageSizeChange:t})=>{const{totalItems:n,totalPages:a,startIndex:i,endIndex:c,currentPage:l,pageSize:o}=s,d=()=>{const g=[];if(a<=5)for(let b=1;b<=a;b++)g.push(b);else{let b=Math.max(1,l-Math.floor(2.5));const v=Math.min(a,b+5-1);v-b+1<5&&(b=Math.max(1,v-5+1));for(let w=b;w<=v;w++)g.push(w)}return g},u=g=>{const x=parseInt(g.target.value);t(x)},h=()=>{l>1&&e(1)},p=()=>{l>1&&e(l-1)},f=()=>{l<a&&e(l+1)},y=()=>{l<a&&e(a)};return n===0?null:r.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 px-4 py-3 bg-white border-t border-gray-200",children:[r.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",i+1," to ",Math.min(c,n)," of"," ",n," items"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-700",children:"Show:"}),r.jsxs("select",{value:o,onChange:u,className:"px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[r.jsx("option",{value:5,children:"5"}),r.jsx("option",{value:10,children:"10"}),r.jsx("option",{value:25,children:"25"}),r.jsx("option",{value:50,children:"50"})]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:h,disabled:l===1,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"First page",children:r.jsx(I,{path:gp,size:.8})}),r.jsx("button",{onClick:p,disabled:l===1,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous page",children:r.jsx(I,{path:nu,size:.8})}),r.jsx("div",{className:"flex items-center gap-1",children:d().map(g=>r.jsx("button",{onClick:()=>e(g),className:`px-2 py-1 text-sm rounded ${g===l?"bg-blue-500 text-white":"hover:bg-gray-100 text-gray-700"}`,children:g},g))}),r.jsx("button",{onClick:f,disabled:l===a,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next page",children:r.jsx(I,{path:ks,size:.8})}),r.jsx("button",{onClick:y,disabled:l===a,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Last page",children:r.jsx(I,{path:yp,size:.8})})]})]})]})},uk=({item:s,isExpanded:e,onToggleExpansion:t,onDelete:n,onStartContent:a,progressDisplay:i,dueDateDisplay:c,actionButton:l,columnWidths:o})=>{var d,u;if(!s)return console.warn("TableRow: item prop is undefined or null"),null;const h=()=>{s!=null&&s.id&&t(s.id)},p=()=>{s!=null&&s.id&&n(s.id)},f=()=>{a&&(s!=null&&s.id)&&a(s.id)};try{return r.jsxs(r.Fragment,{children:[r.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.content)||"auto"},children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:h,className:"p-1 hover:bg-gray-200 rounded",children:r.jsx(I,{path:e?Ds:ks,size:.8,className:"text-gray-500"})}),r.jsx("div",{className:"flex-1 min-w-0",children:r.jsx("div",{className:"font-medium text-gray-900 leading-tight",children:s!=null&&s.title&&s.title.length>40?r.jsxs(r.Fragment,{children:[r.jsx("div",{children:s.title.substring(0,40)}),r.jsx("div",{className:"text-sm text-gray-600",children:s.title.substring(40)})]}):(s==null?void 0:s.title)||"Untitled"})})]})}),r.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.progress)||"auto"},children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"flex-1",children:r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:`h-2 rounded-full ${((i==null?void 0:i.percentage)||0)===0?"bg-gray-400":((i==null?void 0:i.percentage)||0)===100?"bg-[#10B981]":"bg-[#4ECDC4]"}`,style:{width:`${(i==null?void 0:i.percentage)||0}%`}})})}),r.jsx("span",{className:"text-sm text-gray-600 min-w-[3rem]",children:(i==null?void 0:i.text)||"0%"})]})}),r.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.startDate)||"auto"},children:((i==null?void 0:i.percentage)||0)>0&&(s!=null&&s.lastUpdated)?r.jsx("span",{className:"text-sm text-gray-700",children:(()=>{try{return new Date(s.lastUpdated).toLocaleDateString()}catch(y){return console.error(y),"Invalid date"}})()}):r.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),r.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.assigned)||"auto"},children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("span",{className:`text-lg font-medium ${((i==null?void 0:i.percentage)||0)>0?"text-[#10B981]":"text-gray-400"}`,children:((i==null?void 0:i.percentage)||0)>0?"✓":"✗"})})}),r.jsx("td",{className:"px-4 py-3",style:{width:(o==null?void 0:o.actions)||"auto"},children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:f,disabled:(l==null?void 0:l.disabled)||!1,className:`w-8 h-8 rounded flex items-center justify-center transition-colors ${(l==null?void 0:l.variant)==="primary"?"bg-[#4ECDC4] text-white hover:bg-[#3DB8B0] disabled:bg-gray-300":(l==null?void 0:l.variant)==="secondary"?"bg-[#5B5B5B] text-white hover:bg-[#4A4A4A] disabled:bg-gray-300":"bg-[#EF4444] text-white hover:bg-[#DC2626] disabled:bg-gray-300"} disabled:cursor-not-allowed`,title:((i==null?void 0:i.percentage)||0)===100?"View":((i==null?void 0:i.percentage)||0)>0?"Resume":"Start",children:r.jsx(I,{path:((i==null?void 0:i.percentage)||0)===100?vp:((i==null?void 0:i.percentage)||0)>0?$n:Br,size:.8})}),r.jsx("button",{onClick:p,className:"w-8 h-8 text-[#EF4444] hover:bg-red-50 rounded flex items-center justify-center transition-colors",title:"Delete",children:r.jsx(I,{path:ji,size:.8})})]})})]}),e&&r.jsx("tr",{className:"bg-gray-50",children:r.jsx("td",{colSpan:5,className:"px-4 py-3",children:r.jsxs("div",{className:"space-y-3",children:[(s==null?void 0:s.description)&&r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Description"}),r.jsx("p",{className:"text-sm text-gray-600",children:(d=s.data)==null?void 0:d.description})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Category"}),r.jsx("p",{className:"text-sm text-gray-600",children:(s==null?void 0:s.category)||"No category"})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Due Date"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(I,{path:Rn,size:.6,className:"text-gray-400"}),r.jsx("span",{className:`text-sm ${(c==null?void 0:c.color)||"text-gray-600"}`,children:(c==null?void 0:c.text)||"No due date"})]})]}),((u=s==null?void 0:s.data)==null?void 0:u.tags)&&s.data.tags.length>0&&r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Tags"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:s.data.tags.map((y,g)=>r.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:y},g))})]})]})]})})})]})}catch(y){return console.error("Error rendering TableRow:",y),r.jsx("tr",{className:"border-b border-gray-200",children:r.jsxs("td",{colSpan:5,className:"px-4 py-3 text-center text-red-600",children:["Error loading row data. Please refresh the page."," ",y instanceof Error?y.message:"Unknown error"]})})}},mk=s=>{const e=Qm(s),t=hk(e),n=`${e}%`;return{percentage:e,color:t,text:n}},Qm=s=>{if(s.progress!==void 0)return Math.round(s.progress);switch(s.status){case"draft":return 0;case"published":return 25;case"review":return 75;case"archived":return 100;default:return 0}},hk=s=>s>=100?"bg-green-500":s>=75?"bg-blue-500":s>=50?"bg-yellow-500":s>=25?"bg-orange-500":"bg-red-500",pk=(s,e)=>{const t=e[s];if(!t)return{text:"Not started",color:"text-gray-500",isOverdue:!1};const a=t<new Date;return{text:Ym(t),color:a?"text-red-600":"text-gray-700",isOverdue:a}},fk=(s,e)=>{const t=e[s];if(!t)return{text:"No due date",color:"text-gray-500",isOverdue:!1};const a=t<new Date;return{text:Ym(t),color:a?"text-red-600":"text-gray-700",isOverdue:a}},gk=(s,e)=>{const t=Qm(s);return t===100?{text:"Completed",icon:$n,onClick:()=>{},disabled:!0,variant:"secondary"}:t>0?{text:"Resume",icon:Br,onClick:()=>e==null?void 0:e(s.id),disabled:!1,variant:"primary"}:{text:"Start",icon:Br,onClick:()=>e==null?void 0:e(s.id),disabled:!1,variant:"primary"}},Ym=s=>{const e=new Date,t=Math.abs(e.getTime()-s.getTime()),n=Math.ceil(t/(1e3*60*60*24));return n===0?"Today":n===1?s<e?"Yesterday":"Tomorrow":n<7?`${n} days ${s<e?"ago":"from now"}`:s.toLocaleDateString()},yk=(s,e,t)=>{const n=Math.ceil(s/t),a=(e-1)*t,i=a+t;return{totalItems:s,totalPages:n,startIndex:a,endIndex:i,currentPage:e,pageSize:t}},Zn=({items:s,onDelete:e,onStartContent:t})=>{const[n,a]=m.useState(new Set),[i]=m.useState({}),[c]=m.useState({}),[l,o]=m.useState(1),[d,u]=m.useState(10),[h]=m.useState({content:500,progress:150,startDate:140,assigned:120,actions:120}),p=s,f=m.useMemo(()=>yk(p.length,l,d),[p.length,l,d]),y=m.useMemo(()=>{const S=f.startIndex,T=f.endIndex;return p.slice(S,T)},[p,f.startIndex,f.endIndex]),g=S=>{o(S)},x=S=>{u(S),o(1)},b=S=>{const T=new Set(n);T.has(S)?T.delete(S):T.add(S),a(T)},v=S=>{e(S)},w=S=>{t&&t(S)};return r.jsxs("div",{className:"overflow-hidden",children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Content"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(S=>{const T=mk(S),C=pk(S.id,i),P=fk(S.id,c),N=gk(S,w);return r.jsx(uk,{item:S,isExpanded:n.has(S.id),onToggleExpansion:b,onDelete:v,onStartContent:w,progressDisplay:T,startDateDisplay:C,dueDateDisplay:P,actionButton:N,columnWidths:h},S.id)})})]})}),r.jsx(dk,{pagination:f,onPageChange:g,onPageSizeChange:x})]})},Jm=X.memo(({items:s,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Wr(),a=s&&s.length>0?s:[];return r.jsx(Zn,{items:a,type:"courses",onDelete:t,onStatusUpdate:n,onStartContent:e})});Jm.displayName="CoursesTable";const Xm=X.memo(({items:s,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Wr(),a=s.length>0?s:[];return r.jsx(Zn,{items:a,type:"learning-pathways",onDelete:t,onStatusUpdate:n,onStartContent:e})});Xm.displayName="LearningPathwaysTable";const Zm=X.memo(({items:s,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Wr(),a=s&&s.length>0?s:[];return r.jsx(Zn,{items:a,type:"procedures",onDelete:t,onStatusUpdate:n,onStartContent:e})});Zm.displayName="ProceduresTable";const eh=X.memo(({items:s,onStartContent:e})=>{const{deleteContent:t,updateContentStatus:n}=Wr(),a=s&&s.length>0?s:[];return r.jsx(Zn,{items:a,type:"policies",onDelete:t,onStatusUpdate:n,onStartContent:e})});eh.displayName="PoliciesTable";var vk=Object.defineProperty,xk=Object.defineProperties,bk=Object.getOwnPropertyDescriptors,Hd=Object.getOwnPropertySymbols,_k=Object.prototype.hasOwnProperty,wk=Object.prototype.propertyIsEnumerable,Vd=(s,e,t)=>e in s?vk(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Wd=(s,e)=>{for(var t in e||(e={}))_k.call(e,t)&&Vd(s,t,e[t]);if(Hd)for(var t of Hd(e))wk.call(e,t)&&Vd(s,t,e[t]);return s},Gd=(s,e)=>xk(s,bk(e));const Sk=({onFiltersChange:s,selectedCategory:e,onCategoryChange:t,statusOptions:n,departmentOptions:a,difficultyOptions:i,durationOptions:c})=>{const[l,o]=m.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),[d,u]=m.useState(!1),h=m.useCallback((v,w)=>{const S=Gd(Wd({},l),{[v]:w});o(S),s(S)},[l,s]),p=m.useCallback(v=>{const w=v.target.value,S=Gd(Wd({},l),{searchQuery:w});o(S),s(S)},[l,s]),f=m.useCallback(v=>{t(v.target.value)},[t]),y=m.useCallback(()=>{u(!d)},[d]),g=m.useCallback(()=>{const v={searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"};o(v),s(v)},[s]),x=[{value:"all",label:"All Categories"},{value:"Courses",label:"Courses"},{value:"Policies",label:"Policies"},{value:"Procedures",label:"Procedures"},{value:"Learning Pathways",label:"Learning Pathways"}],b=[{value:"title",label:"Title"},{value:"date",label:"Date"},{value:"progress",label:"Progress"},{value:"difficulty",label:"Difficulty"},{value:"duration",label:"Duration"}];return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-6",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-4",children:[r.jsxs("div",{className:"flex-1 relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(I,{path:Ni,size:1,className:"text-gray-400"})}),r.jsx("input",{type:"text",placeholder:"Search all content...",value:l.searchQuery,onChange:p,className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-[#4ECDC4] focus:border-[#4ECDC4] sm:text-sm"})]}),r.jsx("div",{className:"lg:w-48",children:r.jsx("select",{value:e,onChange:f,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#4ECDC4] focus:border-[#4ECDC4] sm:text-sm",children:x.map(v=>r.jsx("option",{value:v.value,children:v.label},v.value))})}),r.jsxs("button",{onClick:y,className:`inline-flex items-center px-3 py-2 border rounded-md text-sm font-medium transition-colors ${d?"bg-[#4ECDC4] text-white border-[#4ECDC4]":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[r.jsx(I,{path:xp,size:1,className:"mr-2"}),"Filters"]}),r.jsxs("button",{onClick:()=>h("sortOrder",l.sortOrder==="asc"?"desc":"asc"),className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx(I,{path:bp,size:1,className:"mr-2"}),l.sortOrder==="asc"?"↑":"↓"]})]}),d&&r.jsxs("div",{className:"border-t pt-4 space-y-4",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[r.jsxs("div",{className:"sm:w-32",children:[r.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),r.jsxs("select",{id:"status-filter",value:l.statusFilter,onChange:v=>h("statusFilter",v.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[r.jsx("option",{value:"all",children:"All Statuses"}),n.map(v=>r.jsx("option",{value:v,children:v},v))]})]}),r.jsxs("div",{className:"sm:w-32",children:[r.jsx("label",{htmlFor:"department-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Department"}),r.jsxs("select",{id:"department-filter",value:l.departmentFilter,onChange:v=>h("departmentFilter",v.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[r.jsx("option",{value:"all",children:"All Departments"}),a.map(v=>r.jsx("option",{value:v,children:v},v))]})]}),r.jsxs("div",{className:"sm:w-32",children:[r.jsx("label",{htmlFor:"difficulty-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Difficulty"}),r.jsxs("select",{id:"difficulty-filter",value:l.difficultyFilter,onChange:v=>h("difficultyFilter",v.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[r.jsx("option",{value:"all",children:"All Levels"}),i.map(v=>r.jsx("option",{value:v,children:v},v))]})]}),r.jsxs("div",{className:"sm:w-32",children:[r.jsx("label",{htmlFor:"duration-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Duration"}),r.jsxs("select",{id:"duration-filter",value:l.durationFilter,onChange:v=>h("durationFilter",v.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:[r.jsx("option",{value:"all",children:"Any Duration"}),c.map(v=>r.jsx("option",{value:v,children:v},v))]})]}),r.jsxs("div",{className:"sm:w-32",children:[r.jsx("label",{htmlFor:"sort-by-filter",className:"block text-xs font-medium text-gray-700 mb-1",children:"Sort By"}),r.jsx("select",{id:"sort-by-filter",value:l.sortBy,onChange:v=>h("sortBy",v.target.value),className:"block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-[#4ECDC4] focus:border-[#4ECDC4]",children:b.map(v=>r.jsx("option",{value:v.value,children:v.label},v.value))})]})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx("button",{onClick:g,className:"inline-flex items-center px-3 py-1 border border-gray-300 rounded text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Clear All Filters"})})]})]})},th=X.memo(()=>{const[s,e]=m.useState(null),t=m.useCallback(E=>{console.error("ContentTable error:",E),e(E)},[]),n=m.useCallback(()=>{e(null)},[]),{selectedCategory:a,selectedContent:i,isLoading:c,error:l,refetchContent:o,deleteContent:d,updateContentStatus:u,setSelectedCategory:h}=Wr(),[p,f]=m.useState({searchQuery:"",statusFilter:"all",departmentFilter:"all",difficultyFilter:"all",durationFilter:"all",sortBy:"title",sortOrder:"asc"}),y=["Not Started","In Progress","Completed"],g=["central_sterile","clinical","biomedical","supply_chain","general"],x=["Beginner","Intermediate","Advanced"],b=["15 min","30 min","45 min","60 min","90 min+"],v=m.useCallback(E=>{f(E)},[]),w=m.useCallback(E=>{h(E==="all"?"all":E)},[h]),S={isLoading:c,error:l,validationError:null},T={searchQuery:"",selectedDomain:"",selectedContentType:"",activeTab:""},C=m.useMemo(()=>{if(!i)return[];let E=i;if(p.searchQuery){const D=p.searchQuery.toLowerCase();E=E.filter(O=>{var k;return O.title.toLowerCase().includes(D)||((k=O.data)==null?void 0:k.description)&&O.data.description.toLowerCase().includes(D)||O.department&&O.department.toLowerCase().includes(D)})}return p.statusFilter!=="all"&&(E=E.filter(D=>D.status===p.statusFilter)),p.departmentFilter!=="all"&&(E=E.filter(D=>D.department===p.departmentFilter)),p.difficultyFilter!=="all"&&(E=E.filter(D=>D.difficultyLevel===p.difficultyFilter)),p.durationFilter!=="all"&&(E=E.filter(D=>{if(!D.estimatedDuration)return!1;const O=D.estimatedDuration;switch(p.durationFilter){case"15 min":return O<=15;case"30 min":return O<=30;case"45 min":return O<=45;case"60 min":return O<=60;case"90 min+":return O>90;default:return!0}})),E.sort((D,O)=>{let k,$;switch(p.sortBy){case"title":k=(D.title||"").toLowerCase(),$=(O.title||"").toLowerCase();break;case"date":k=D.lastUpdated?new Date(D.lastUpdated):new Date(0),$=O.lastUpdated?new Date(O.lastUpdated):new Date(0);break;case"progress":k=D.progress,$=O.progress;break;case"difficulty":k=D.difficultyLevel||"",$=O.difficultyLevel||"";break;case"duration":k=D.estimatedDuration||0,$=O.estimatedDuration||0;break;default:k=D.title.toLowerCase(),$=O.title.toLowerCase()}return p.sortOrder==="asc"?k<$?-1:k>$?1:0:k>$?-1:k<$?1:0}),E},[i,p]),{categoryItems:P}=Gm({content:C,selectedCategory:a==="all"?null:a,filterOptions:T}),N=ak({uiState:S,selectedCategory:a,categoryItems:P}),j=()=>N.shouldShowLoading?r.jsx(bs,{}):N.shouldShowError?r.jsx(ik,{error:l,onRetry:o}):N.shouldShowEmpty?r.jsx(Km,{selectedCategory:a}):N.shouldShowContent?r.jsx(ck,{category:a,items:P,onStatusUpdate:u,CoursesTable:Jm,LearningPathwaysTable:Xm,ProceduresTable:Zm,PoliciesTable:eh}):null;return s?r.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"text-red-600 text-lg font-medium mb-2",children:"Something went wrong"}),r.jsx("div",{className:"text-gray-600 mb-4",children:s.message}),r.jsx("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Again"})]})}):r.jsxs("div",{className:"bg-white rounded-lg shadow p-6",style:{borderLeft:"4px solid rgba(78, 205, 196, 0.5)"},children:[r.jsx(Sk,{onFiltersChange:v,selectedCategory:a||"all",onCategoryChange:w,statusOptions:y,departmentOptions:g,difficultyOptions:x,durationOptions:b}),r.jsx(lk,{category:a==="all"?"All Categories":a||"",isLoading:c}),(()=>{try{return j()}catch(E){return console.error("Error rendering content:",E),t(E instanceof Error?E:new Error("Unknown error")),null}})()]})});th.displayName="ContentTable";var fs=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function Ck(){const[s,e]=m.useState(null),[t,n]=m.useState([]),[a,i]=m.useState(!1),[c,l]=m.useState(null),o=m.useMemo(()=>new _p,[]),d=m.useCallback(()=>fs(null,null,function*(){try{i(!0),l(null);const y=yield o.getLearningInsights();if(e(y),!y){const g=yield o.generateLearningInsights();g&&e(g)}}catch(y){l(y instanceof Error?y.message:"Failed to load learning insights")}finally{i(!1)}}),[o]),u=m.useCallback((y=5)=>fs(null,null,function*(){try{i(!0),l(null);const g=yield o.getContentRecommendations(y);n(g)}catch(g){l(g instanceof Error?g.message:"Failed to load content recommendations")}finally{i(!1)}}),[o]),h=m.useCallback((y,g)=>fs(null,null,function*(){try{yield o.trackRecommendationInteraction(y,g)}catch(x){console.error("Failed to track recommendation interaction:",x)}}),[o]),p=m.useCallback(y=>fs(null,null,function*(){try{yield o.storeSessionAnalytics(y)}catch(g){console.error("Failed to store session analytics:",g)}}),[o]),f=m.useCallback(()=>fs(null,null,function*(){try{i(!0),l(null);const y=yield o.generateLearningInsights();y&&e(y)}catch(y){l(y instanceof Error?y.message:"Failed to generate new insights")}finally{i(!1)}}),[o]);return m.useEffect(()=>{const y=setTimeout(()=>{d(),u()},200);return()=>clearTimeout(y)},[d,u]),{learningInsights:s,contentRecommendations:t,isLoading:a,error:c,loadLearningInsights:d,loadContentRecommendations:u,trackRecommendationInteraction:h,storeSessionAnalytics:p,generateNewInsights:f,refreshData:()=>{d(),u()}}}const rh=X.memo(()=>{var s;const e=Ur(),{learningInsights:t,storeSessionAnalytics:n,isLoading:a}=Ck(),i=m.useCallback(()=>{e("/library")},[e]),c=m.useCallback(l=>{console.error("Knowledge Hub error:",l)},[]);return X.useEffect(()=>{const l=setTimeout(()=>{!a&&t&&n({session_start:new Date().toISOString(),content_items_accessed:["knowledge_hub_main"],learning_path_progress:{current_page:"knowledge_hub"}})},100);return()=>clearTimeout(l)},[a,t,n]),r.jsx(HE,{onError:c,maxRetries:3,retryDelay:1e3,children:r.jsx(Hr,{children:r.jsx(ZE,{children:r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-[#5b5b5b] mb-1",children:"Knowledge Hub"}),r.jsxs("p",{className:"text-gray-500 text-sm",children:["Access training materials and educational resources",!a&&t&&r.jsxs("span",{className:"ml-2 text-[#4ECDC4]",children:["• AI Learning Score:"," ",t==null?void 0:t.learning_efficiency_score,"%"]})]})]}),r.jsx("button",{onClick:i,className:"rounded-md bg-[#4ECDC4] px-4 py-2 text-white hover:bg-[#3db8b0] transition",children:"+ Library"})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[r.jsxs("div",{className:"lg:w-1/4 space-y-6",children:[r.jsx(tk,{}),r.jsx(sk,{}),!a&&t&&r.jsx("div",{className:"hidden",children:r.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[r.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"AI Learning Insights"}),r.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[r.jsxs("p",{children:["Efficiency:"," ",t==null?void 0:t.learning_efficiency_score,"%"]}),r.jsxs("p",{children:["Next Milestone:"," ",t==null?void 0:t.next_learning_milestone]}),r.jsxs("p",{children:["Optimal Study Time:"," ",t==null?void 0:t.optimal_study_duration," min"]}),((s=t==null?void 0:t.skill_gaps)==null?void 0:s.length)>0&&r.jsxs("p",{children:["Skill Gaps: ",t.skill_gaps.join(", ")]})]})]})})]}),r.jsx("div",{className:"lg:w-3/4",children:r.jsx(th,{})})]})]})})})})});rh.displayName="KnowledgeHub";const yi=({item:s,onActionClick:e,status:t,className:n="",isFavorite:a=!1,onToggleFavorite:i,isAiSuggestion:c=!1,aiGlowIntensity:l=0,index:o=0})=>{var d;const u=y=>{switch(y){case"Favorites":return Zi;case"Courses":return Ns;case"Learning Pathways":return Si;case"Procedures":return wp;case"Policies":return eo;case"SDS Sheets":return eo;default:return Ns}},h=y=>{switch(y){case"Favorites":return"bg-yellow-100 text-yellow-800 border border-yellow-200";case"Courses":return"bg-blue-100 text-blue-800 border border-blue-200";case"Learning Pathways":return"bg-purple-100 text-purple-800 border border-purple-200";case"Procedures":return"bg-red-100 text-red-800 border border-red-200";case"Policies":return"bg-green-100 text-green-800 border border-green-200";case"SDS Sheets":return"bg-orange-100 text-orange-800 border border-orange-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},p=()=>{switch(t){case"In Progress":return"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200";case"Completed":return"bg-blue-100 text-blue-700 border border-blue-300 hover:bg-blue-200";default:return c?"bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700 shadow-lg hover:shadow-xl":"border-2 border-[#4ECDC4] text-[#4ECDC4] hover:bg-teal-50"}},f=()=>{switch(t){case"In Progress":return"Added";case"Completed":return"Completed";default:return"+Add"}};return r.jsxs(se.div,{role:"article","aria-labelledby":`content-card-title-${s.id}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:c?o*.1:0},className:`relative group h-80 flex flex-col ${c?"bg-gradient-to-br from-white via-purple-50 to-pink-50 border-2 border-purple-200 shadow-xl hover:shadow-2xl ai-card":"bg-white border border-gray-100 shadow-lg hover:shadow-xl"} rounded-xl p-6 transition-all duration-300 transform hover:scale-105 ${n}`,style:{boxShadow:c?`0 10px 25px rgba(147, 51, 234, 0.15), 0 0 20px rgba(236, 72, 153, ${.1+Math.sin(l*.1+o)*.05})`:void 0},children:[c&&r.jsx(se.div,{animate:{opacity:[.3,.8,.3],scale:[1,1.02,1]},transition:{duration:3,repeat:1/0,ease:"easeInOut",delay:o*.2},className:"absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-orange-400 rounded-xl blur-sm -z-10"}),i&&r.jsx("button",{onClick:i,className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-full transition-colors duration-200",children:r.jsx(I,{path:Zi,size:1.2,color:a?"#FFD700":"#9CA3AF"})}),r.jsx("div",{className:"flex items-start justify-between mb-4 flex-1",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(I,{path:u(s.category),size:1,className:`${c?"text-purple-600":"text-[#4ECDC4]"}`}),r.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${h(s.category)}`,children:s.category})]}),r.jsx("h4",{id:`content-card-title-${s.id}`,className:`text-lg font-semibold mb-2 transition-colors duration-200 h-12 flex items-start ${c?"text-gray-900 group-hover:text-purple-600":"text-gray-900 group-hover:text-[#4ECDC4]"}`,children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"line-clamp-2 leading-tight",children:s.title}),s.source==="Cliniio"&&r.jsx("div",{className:"flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-500 rounded-full text-xs font-medium border border-blue-200 flex-shrink-0",children:r.jsx(I,{path:Cs,size:.6})})]})}),r.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2 h-10 leading-tight",children:String(((d=s.data)==null?void 0:d.description)||"")}),r.jsx("div",{className:`flex items-center gap-2 text-sm font-medium ${c?"text-purple-600":"text-violet-600"}`,children:r.jsxs("span",{children:["+",s.points," points"]})})]})}),r.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full border ${c?"bg-purple-100 text-purple-800 border-purple-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:s.level}),r.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[r.jsx(I,{path:An,size:.7}),r.jsx("span",{children:s.duration})]})]}),r.jsx("button",{onClick:e,"aria-label":`Add ${s.title} to Knowledge Hub`,className:`px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${p()}`,children:f()})]})]})},jk=Object.freeze(Object.defineProperty({__proto__:null,default:yi},Symbol.toStringTag,{value:"Module"})),Nk=X.lazy(()=>q(()=>Promise.resolve().then(()=>jk),void 0)),Ik=({filteredContent:s,handleAddToList:e,getItemStatus:t,favorites:n,handleToggleFavorite:a})=>r.jsx("section",{role:"list","aria-label":"Library content list",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.jsx(m.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:s.map((i,c)=>r.jsx(se.div,{role:"listitem",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:c*.1},children:r.jsx(Nk,{item:i,status:t(i.id),onActionClick:()=>e(i),isFavorite:n.has(i.id),onToggleFavorite:()=>a(i.id),isAiSuggestion:!1,index:c})},i.id))})});class Tk extends m.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){console.error("Library Error:",e,t)}render(){return this.state.hasError?r.jsxs("div",{className:"p-6 bg-red-50 text-red-800 rounded-lg",children:[r.jsx("h2",{className:"text-lg font-bold",children:"Oops! Something went wrong in the Library."}),r.jsx("p",{children:"Please refresh the page or try again later."})]}):this.props.children}}var Ek=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});function kk(){return Ek(this,null,function*(){try{const{data:s,error:e}=yield _.from("knowledge_hub_content").select("*").eq("is_active",!0).eq("status","published").order("created_at",{ascending:!1});return e?(console.error("Error fetching content:",e),Kd()):(s||[]).map(n=>Rk(n,"knowledge_hub_content"))}catch(s){return console.error("Error in fetchLibraryContent:",s),Kd()}})}function Kd(){return console.log("Using fallback content"),[{id:"handwashing-policy-1",title:"Handwashing Policies for Staff",category:"Policies",status:"Not Started",dueDate:void 0,progress:0,department:"infection_control",lastUpdated:new Date().toISOString(),source:"Cliniio",description:"Comprehensive handwashing protocols and procedures for healthcare staff to maintain infection control standards",level:"Beginner",duration:"20 min",points:7,publishedDate:new Date().toISOString()},{id:"test-item-2",title:"TEST ITEM - This Should Show",category:"Courses",status:"Not Started",dueDate:void 0,progress:0,department:"general",lastUpdated:new Date().toISOString(),source:"Cliniio",description:"This is a test item to verify the library is working",level:"Beginner",duration:"15 min",points:5,publishedDate:new Date().toISOString()}]}function Dk(s){return{course:"Courses",procedure:"Procedures",policy:"Policies",learning_pathway:"Learning Pathways"}[s]||"Courses"}function Pk(s){if(!s)return"15 min";if(s<60)return`${s} min`;const e=Math.floor(s/60),t=s%60;return t===0?`${e} hr`:`${e} hr ${t} min`}const Rk=(s,e)=>{var t;return{id:s.id,title:s.title,description:(t=s.data)==null?void 0:t.description,category:Dk(s.content_type||e),level:s.difficulty_level||"Beginner",duration:Pk(s.estimated_duration_minutes||s.estimated_read_time_minutes||0),points:s.points||0,status:"Not Started",dueDate:void 0,progress:0,department:s.department||"general",lastUpdated:s.updated_at||s.created_at||new Date().toISOString(),source:"Cliniio",publishedDate:s.published_at||s.created_at||new Date().toISOString()}};var Ak=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Ok=()=>{const[s,e]=m.useState([]),[t,n]=m.useState(!0),[a,i]=m.useState(null);return m.useEffect(()=>{Ak(null,null,function*(){try{n(!0);const l=yield kk();e(l)}catch(l){console.error("useLibraryContent: Error loading content:",l),i(l instanceof Error?l:new Error("Failed to load content")),e([])}finally{n(!1)}})},[]),{content:s,loading:t,error:a}};var $k=Object.defineProperty,Mk=Object.defineProperties,Fk=Object.getOwnPropertyDescriptors,Qd=Object.getOwnPropertySymbols,zk=Object.prototype.hasOwnProperty,Lk=Object.prototype.propertyIsEnumerable,Yd=(s,e,t)=>e in s?$k(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Bk=(s,e)=>{for(var t in e||(e={}))zk.call(e,t)&&Yd(s,t,e[t]);if(Qd)for(var t of Qd(e))Lk.call(e,t)&&Yd(s,t,e[t]);return s},qk=(s,e)=>Mk(s,Fk(e));class nr{constructor(){this.progressItems=new Map;try{this.loadFromStorage()}catch(e){console.error("[LearningProgressService] Failed to initialize:",e)}}static getInstance(){try{return nr.instance||(nr.instance=new nr),nr.instance}catch(e){return console.error("[LearningProgressService] Failed to get instance:",e),null}}loadFromStorage(){try{if(typeof window=="undefined"||!window.localStorage){console.warn("[LearningProgressService] localStorage not available");return}const e=localStorage.getItem("learningProgress");if(e){const t=JSON.parse(e);this.progressItems.clear(),t.forEach(n=>{this.progressItems.set(n.id,n)})}}catch(e){console.error("[LearningProgressService] Failed to load from storage:",e)}}saveToStorage(){try{if(typeof window=="undefined"||!window.localStorage){console.warn("[LearningProgressService] localStorage not available for saving");return}const e=Array.from(this.progressItems.values());localStorage.setItem("learningProgress",JSON.stringify(e))}catch(e){console.error("[LearningProgressService] Failed to save to storage:",e)}}addToMyList(e){const t=qk(Bk({},e),{status:"In Progress",updated_at:new Date().toISOString()});this.progressItems.set(e.id,t),this.saveToStorage()}markInProgress(e){const t=this.progressItems.get(e);t&&(t.status="In Progress",t.updated_at=new Date().toISOString(),this.saveToStorage())}getItemStatus(e){const t=this.progressItems.get(e);return t?t.status:"Not Started"}updateItemStatus(e,t){const n=this.progressItems.get(e);n&&(n.status=t,n.updated_at=new Date().toISOString(),this.saveToStorage())}getItemsByCategory(e){return Array.from(this.progressItems.values()).filter(t=>t.category===e)}getAllProgressItems(){return Array.from(this.progressItems.values())}removeItem(e){this.progressItems.delete(e),this.saveToStorage()}isInitialized(){return this.progressItems!==void 0}}const Uk=Object.freeze(Object.defineProperty({__proto__:null,default:nr},Symbol.toStringTag,{value:"Module"}));function Hk(){const[s,e]=m.useState(""),[t,n]=m.useState(!1),[a,i]=m.useState(new Set),[c,l]=m.useState({category:"",skillLevel:"",timeline:"",status:"",source:"",showNewOnly:!1}),[o,d]=m.useState("All"),[u,h]=m.useState("All"),[p]=m.useState(()=>nr.getInstance()),[f,y]=m.useState(!1),[g,x]=m.useState(0),[b,v]=m.useState(!1),w=m.useMemo(()=>["All","Beginner","Intermediate","Advanced"],[]),S=m.useMemo(()=>["< 1 hour","1-3 hours","3-5 hours","5+ hours"],[]),T=m.useMemo(()=>["Not Started","In Progress","Completed"],[]),C=m.useMemo(()=>["All Sources","Cliniio","Admin"],[]),P=m.useMemo(()=>["All","Favorites","Courses","Learning Pathways","Procedures","Policies","SDS Sheets"],[]);return{searchQuery:s,setSearchQuery:e,showFilters:t,setShowFilters:n,favorites:a,setFavorites:i,filters:c,setFilters:l,selectedCategory:o,setSelectedCategory:d,selectedLevel:u,setSelectedLevel:h,progressService:p,aiSuggestionsActive:f,setAiSuggestionsActive:y,aiGlowIntensity:g,setAiGlowIntensity:x,showAiTooltip:b,setShowAiTooltip:v,skillLevels:w,timelines:S,statuses:T,sources:C,categories:P}}var Vk=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Wk=X.lazy(()=>q(()=>import("./LibraryFilters-Bs_G3a4n.js"),__vite__mapDeps([22,2,3,1,4,5]))),Gk=X.lazy(()=>q(()=>import("./LibraryHeader-D6u4VL6S.js"),__vite__mapDeps([23,2,3,1,4,5]))),Kk=()=>{const s=Ur(),{searchQuery:e,setSearchQuery:t,showFilters:n,setShowFilters:a,favorites:i,setFavorites:c,filters:l,setFilters:o,selectedCategory:d,setSelectedCategory:u,selectedLevel:h,setSelectedLevel:p,progressService:f,aiSuggestionsActive:y,setAiSuggestionsActive:g,aiGlowIntensity:x,setAiGlowIntensity:b,showAiTooltip:v,setShowAiTooltip:w,skillLevels:S,timelines:T,statuses:C,sources:P,categories:N}=Hk(),{content:j}=Ok();m.useEffect(()=>{const A=setInterval(()=>{b(z=>z+1)},100);return()=>clearInterval(A)},[y,b]);const E=j.filter(A=>{var z;const M=e===""||A.title.toLowerCase().includes(e.toLowerCase())||String(((z=A.data)==null?void 0:z.description)||"").toLowerCase().includes(e.toLowerCase())||A.category.toLowerCase().includes(e.toLowerCase()),W=!l.category||A.category===l.category,L=!l.skillLevel||A.level===l.skillLevel,K=!l.status||A.status===l.status,V=!l.source||A.source===l.source;return M&&W&&L&&K&&V}),D=m.useCallback(()=>{g(A=>{const z=!A;if(z){const M={session_start:new Date().toISOString(),content_items_accessed:j.map(W=>W.id),learning_path_progress:{ai_suggestions_enabled:!0},learning_patterns:{ai_interaction:"enabled"}};q(()=>Fs(null,null,function*(){const{AISuggestionsService:W}=yield import("./aiSuggestionsService-CrJvp41A.js");return{AISuggestionsService:W}}),__vite__mapDeps([24,1,2,3,4,5])).then(({AISuggestionsService:W})=>{new W().storeLearningSessionAnalytics(M)})}return z})},[j,g]),O=m.useCallback(A=>{c(z=>{const M=new Set(z);M.has(A)?M.delete(A):M.add(A);const W=z.has(A)?"removed":"added",L={session_start:new Date().toISOString(),content_items_accessed:[A],learning_path_progress:{favorites_updated:!0},learning_patterns:{favorite_action:W}};return q(()=>Fs(null,null,function*(){const{AISuggestionsService:K}=yield import("./aiSuggestionsService-CrJvp41A.js");return{AISuggestionsService:K}}),__vite__mapDeps([24,1,2,3,4,5])).then(({AISuggestionsService:K})=>{new K().storeLearningSessionAnalytics(L)}),M})},[c]),k=m.useCallback(A=>(f==null?void 0:f.getItemStatus(A))||"Not Started",[f]),$=m.useCallback(A=>j.filter(z=>z.category===A).length,[j]),U=m.useCallback(()=>{o({category:"",skillLevel:"",status:"",source:"",timeline:"",showNewOnly:!1}),u(""),p("")},[o,u,p]),H=m.useCallback(A=>Vk(null,null,function*(){try{const{data:{user:z}}=yield _.auth.getUser();if(!z){console.error("No authenticated user");return}let M="courses";A.category==="Policies"?M="policies":A.category==="Procedures"&&(M="procedures");const W={user_id:z.id,content_id:A.id,content_type:M,status:"not_started",progress_percentage:0,assigned_at:new Date().toISOString(),is_repeat:A.isRepeat||!1},{error:L}=yield _.from("knowledge_hub_user_progress").insert([W]);if(L){console.error("Error adding to knowledge hub:",L);return}console.log("Successfully added to knowledge hub:",A.title);const K=document.querySelector(`[data-item-id="${A.id}"]`);if(K){const V=K.querySelector("button[onclick]")||K.querySelector("button:last-child");if(V){const Z=V.textContent;V.textContent="Added!",V.classList.add("bg-green-500","text-white"),setTimeout(()=>{V.textContent=Z,V.classList.remove("bg-green-500","text-white")},2e3)}else console.log("Button not found in card, item ID:",A.id)}else console.log("Card not found for visual feedback, item ID:",A.id)}catch(z){console.error("Error adding to knowledge hub:",z)}}),[]);return r.jsx(Tk,{children:r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white",children:[r.jsx("div",{className:"p-6",children:r.jsxs("button",{onClick:()=>s("/knowledge-hub"),className:"inline-flex items-center gap-2 text-sm text-gray-600 hover:text-[#4ECDC4] transition-colors duration-200",children:[r.jsx(I,{path:ks,size:.8,className:"rotate-180"}),"Back to Knowledge Hub"]})}),r.jsx(m.Suspense,{fallback:r.jsx(js,{}),children:r.jsx(Gk,{})}),r.jsx("div",{className:"px-6 pb-8",children:r.jsxs("div",{className:"max-w-7xl mx-auto",children:[r.jsx("div",{className:"max-w-2xl mx-auto mb-8",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:r.jsx(I,{path:Ni,size:1.2,className:"text-gray-400"})}),r.jsx("input",{type:"text",placeholder:"Search courses, procedures, policies...",value:e,onChange:A=>t(A.target.value),className:"w-full pl-12 pr-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-[#4ECDC4]/20 focus:border-[#4ECDC4] transition-all duration-200 shadow-sm","aria-label":"Search content"}),r.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center gap-2",children:r.jsx("button",{onClick:()=>a(!n),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors duration-200 shadow-md ${n?"bg-[#4ECDC4] text-white hover:bg-[#3db8b0]":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"}`,children:r.jsx(I,{path:iu,size:1})})})]})}),r.jsx(m.Suspense,{fallback:r.jsx(Sp,{}),children:r.jsx(Wk,{showFilters:n,filters:l,setFilters:o,selectedCategory:d,setSelectedCategory:u,selectedLevel:h,setSelectedLevel:p,handleResetFilters:U,handleToggleAiSuggestions:D,aiSuggestionsActive:y,aiGlowIntensity:x,showAiTooltip:v,setShowAiTooltip:w,skillLevels:S,timelines:T,statuses:C,sources:P,categories:N,getCategoryCount:$})})]})}),r.jsx("div",{className:"px-6 pb-12",children:r.jsxs("div",{className:"max-w-7xl mx-auto",children:[y&&r.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-[#4ECDC4]/10 to-[#3db8b0]/10 rounded-2xl p-8 mb-8 border border-[#4ECDC4]/20",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx("div",{className:"w-10 h-10 bg-[#4ECDC4] rounded-full flex items-center justify-center",children:r.jsx(I,{path:Cp,size:1.2,color:"white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"AI-Powered Recommendations"}),r.jsx("p",{className:"text-gray-600",children:"Personalized content suggestions based on your role and learning history"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsx(yi,{item:{id:"ai-1",title:"Infection Control Mastery",category:"Procedures",description:"Advanced techniques for maintaining sterile environments",level:"Advanced",duration:"75 min",points:65,status:"Not Started",source:"Cliniio",publishedDate:"2025-01-15"},status:(f==null?void 0:f.getItemStatus("ai-1"))||"Not Started",onActionClick:()=>{f==null||f.markInProgress("ai-1")},isFavorite:i.has("ai-1"),onToggleFavorite:()=>O("ai-1"),isAiSuggestion:!0,aiGlowIntensity:x,index:0}),r.jsx(yi,{item:{id:"ai-2",title:"Patient Safety Leadership",category:"Learning Pathways",description:"Develop leadership skills in patient safety protocols",level:"Advanced",duration:"120 min",points:85,status:"Not Started",source:"Cliniio",publishedDate:"2025-01-10"},status:(f==null?void 0:f.getItemStatus("ai-2"))||"Not Started",onActionClick:()=>{f==null||f.markInProgress("ai-2")},isFavorite:i.has("ai-2"),onToggleFavorite:()=>O("ai-2"),isAiSuggestion:!0,aiGlowIntensity:x,index:1})]})]}),r.jsx(Ik,{filteredContent:E,handleAddToList:H,getItemStatus:k,favorites:i,handleToggleFavorite:O})]})})]})})},Qk=m.createContext(void 0),Yk=({children:s})=>{const[e,t]=m.useState("favourites");return r.jsx(Qk.Provider,{value:{activeTab:e,setActiveTab:t},children:s})},Jk=()=>r.jsx(Yk,{children:r.jsx(Kk,{})});var sh=(s,e,t)=>new Promise((n,a)=>{var i=o=>{try{l(t.next(o))}catch(d){a(d)}},c=o=>{try{l(t.throw(o))}catch(d){a(d)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,c);l((t=t.apply(s,e)).next())});const Xk=m.lazy(()=>q(()=>import("./index-DOKVnp66.js"),__vite__mapDeps([25,2,3,1,4,5,26]))),Zk=m.lazy(()=>q(()=>import("./index-CseH7xNd.js").then(s=>s.i),__vite__mapDeps([27,2,3,1,4,5]))),eD=m.lazy(()=>q(()=>import("./login-CtXU169Q.js").then(s=>s.cp),__vite__mapDeps([1,2,3,4,5]))),tD=m.lazy(()=>q(()=>import("./index-CBzgsefj.js"),__vite__mapDeps([28,2,3,1,4,5]))),rD=m.lazy(()=>q(()=>import("./AuthCallback-0dK93gDT.js"),__vite__mapDeps([29,2,3,1,4,5]))),sD=m.lazy(()=>q(()=>import("./HelpArticlePage-xw8GXEzZ.js"),__vite__mapDeps([30,2,3,1,4,5,31])));let ft=null;const nD=300*1e3;function nh(){return sh(this,null,function*(){try{const{FacilityService:s}=yield q(()=>Promise.resolve().then(()=>ge),void 0);ft={id:yield s.getCurrentFacilityId(),timestamp:Date.now()}}catch(s){console.warn("Failed to update facility ID cache:",s),ft||(ft={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()})}})}function Jd(){const s=Date.now();if(ft&&s-ft.timestamp<nD)return ft.id;if(ft)return nh(),ft.id;throw ft?new Error("Unexpected state in getCurrentFacilityId"):new Error("Facility ID lookup failed — no fallback allowed in production.")}function aD(){const s=window;if(typeof window=="undefined"||s.__postgrestGuardInstalled||typeof window.fetch=="undefined")return;s.__postgrestGuardInstalled=!0;const e=".supabase.co/rest/v1/",t=window.fetch.bind(window);window.fetch=(n,a)=>sh(null,null,function*(){try{let i=typeof n=="string"?n:n.toString();if(i.includes(e)){const c=new URL(i),l=p=>p.endsWith(":1")?p.slice(0,-2):p,o=[],d=[];for(const[p,f]of c.searchParams.entries()){const y=f.trim();if(y==="eq."||y==="eq"||y==="eq:"||y==="eq:."||y==="."){o.push(p);continue}if(p==="facility_id"&&(y==="eq.:1"||y==="eq:1"||y===":1"||y==="eq.:")){const x=Jd();d.push(["facility_id",`eq.${x}`]);continue}const g=l(y);if(g!==y){d.push([p,g]);continue}if(p==="quantity"&&y==="lt.reorder_point"){o.push(p);continue}}if(o.forEach(p=>c.searchParams.delete(p)),d.forEach(([p,f])=>{c.searchParams.set(p,f)}),c.search.includes("facility_id=eq.:1")){const p=Jd();c.search=c.search.replace("facility_id=eq.:1",`facility_id=eq.${p}`)}c.search=c.search.replace(/(^|&)([^=&]+)=eq\.(?=(&|$))/g,(p,f)=>f?f.slice(0,-1):""),c.search=c.search.replace(/(:1)(?=(&|$))/g,""),c.search=c.search.replace(/(^|&)quantity=lt\.reorder_point(?=(&|$))/g,(p,f)=>f?f.slice(0,-1):"");const u=new URL(c.toString()),h=new Map;for(const[p,f]of u.searchParams.entries())h.set(p,f);u.search="";for(const[p,f]of h.entries())u.searchParams.append(p,f);u.toString()!==i&&(s.__postgrestGuardLogged||(s.__postgrestGuardLogged=!0,console.info("🛡️ PostgREST guard rewrote URL:",{from:i,to:u.toString()})),i=u.toString(),n=i)}}catch(i){console.error(i)}return t(n,a)})}const iD=new Ip;function oD(){return X.useEffect(()=>{q(()=>Fs(null,null,function*(){const{inventoryServiceFacade:s}=yield import("./login-CtXU169Q.js").then(e=>e.cn);return{inventoryServiceFacade:s}}),__vite__mapDeps([1,2,3,4,5])).then(({inventoryServiceFacade:s})=>{s.initialize().catch(e=>{console.error("Failed to initialize inventory service facade:",e)})}),nh(),aD()},[]),r.jsx(Tp,{client:iD,children:r.jsx(Es,{children:r.jsx(jp,{children:r.jsx(zp,{children:r.jsx(vh,{children:r.jsxs(Ap,{children:[r.jsxs(xh,{children:[r.jsx(xe,{path:"/login",element:r.jsx(eD,{})}),r.jsx(xe,{path:"/auth/callback",element:r.jsx(rD,{})}),r.jsx(xe,{path:"/home",element:r.jsx($e,{children:r.jsx(Z_,{})})}),r.jsx(xe,{path:"/sterilization",element:r.jsx($e,{children:r.jsx(dm,{})})}),r.jsx(xe,{path:"/sterilization/scanner",element:r.jsx($e,{children:r.jsx(hm,{})})}),r.jsx(xe,{path:"/inventory",element:r.jsx($e,{children:r.jsx(EI,{})})}),r.jsx(xe,{path:"/inventory/scanner",element:r.jsx($e,{children:r.jsx(kI,{})})}),r.jsx(xe,{path:"/environmental-clean",element:r.jsx($e,{children:r.jsx(IE,{})})}),r.jsx(xe,{path:"/environmental-clean/scanner",element:r.jsx($e,{children:r.jsx(PE,{})})}),r.jsx(xe,{path:"/knowledge-hub",element:r.jsx($e,{children:r.jsx(rh,{})})}),r.jsx(xe,{path:"/library",element:r.jsx($e,{children:r.jsx(Jk,{})})}),r.jsx(xe,{path:"/intelligence",element:r.jsx($e,{children:r.jsx(tD,{})})}),r.jsx(xe,{path:"/settings",element:r.jsx($e,{children:r.jsx(Xk,{})})}),r.jsx(xe,{path:"/content-builder",element:r.jsx($e,{children:r.jsx(Zk,{})})}),r.jsx(xe,{path:"/help/article/:slug",element:r.jsx(sD,{})}),r.jsx(xe,{path:"/",element:r.jsx(xi,{to:"/home",replace:!0})})]}),r.jsx(uy,{})]})})})})})})}"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistrations().then(function(s){for(const e of s)e.unregister(),console.log("Service worker unregistered")}),navigator.serviceWorker.ready.then(s=>{s.unregister(),console.log("Main service worker unregistered")}));Rp.createRoot(document.getElementById("root")).render(r.jsx(X.StrictMode,{children:r.jsx(oD,{})}));export{zi as B,_v as E,Mt as F,Y0 as I,m0 as L,Xl as R,vv as S,As as U,jC as _,Q as a,Hi as b,gi as c,nE as d,Hr as e,Su as f,pD as g,Wn as h,ot as i,Oc as j,F as k,lt as l,ge as m,Nu as u};
