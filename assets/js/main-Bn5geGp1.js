const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/services-JA4N6ZXe.js","assets/js/components-BtXJbSH9.js","assets/js/react-vendor-DBfrHuQ-.js","assets/js/data-vendor-4okv28M8.js","assets/js/vendor-BY7xYAL4.js","assets/js/ui-vendor-BmV1twT8.js","assets/css/ui-vendor-DJSy8M6b.css","assets/js/utils-vendor-BtegoRPv.js","assets/css/components-B4OH_j2L.css","assets/js/inventory-pages-yK5D55FD.js","assets/js/knowledgehub-pages-DX_b2YG9.js","assets/js/sterilization-pages-55q58lSr.js","assets/js/page-BAJssmbq.js","assets/js/statusMappingUtils-DJVvdJ_o.js","assets/js/page-CjAWSueG.js","assets/js/ScannerPage-ChlGlHqM.js","assets/js/settings-pages-CyhDoqVN.js","assets/js/index-_IL51nB_.js","assets/js/index-cQ-d7A3a.js","assets/js/login-page-QYUu-Fmi.js","assets/js/index-CA73boru.js","assets/js/HelpArticlePage-jCFdk-Hg.js","assets/css/HelpArticlePage-04dAlKem.css"])))=>i.map(i=>d[i]);
var W=(e,t,s)=>new Promise((d,o)=>{var n=r=>{try{u(s.next(r))}catch(c){o(c)}},i=r=>{try{u(s.throw(r))}catch(c){o(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(n,i);u((s=s.apply(e,t)).next())});import{c as Ce,r as l,j as a,R as E,N as de,a3 as Ee,a4 as Me,a5 as Oe,a6 as S,a7 as Le}from"./react-vendor-DBfrHuQ-.js";import{k as Ne,a1 as Te,a2 as De,E as z,a3 as Ie,a4 as Re,a5 as Ae,C as ze,a6 as Fe,a7 as $e,a8 as L,a9 as Ue,aa as Ve,ab as Ge,_ as x,ac as He,S as qe,ad as Be,ae as Ke,x as We,g as Qe,h as Q,af as X,ag as Xe,ah as Ye,ai as Je,aj as w,ak as Ze,al as et,am as tt,an as at,q as st}from"./components-BtXJbSH9.js";import{Q as rt}from"./data-vendor-4okv28M8.js";import{l as ot,aD as H,aE as ue,s as nt}from"./services-JA4N6ZXe.js";import{c as q}from"./utils-vendor-BtegoRPv.js";import"./ui-vendor-BmV1twT8.js";import"./vendor-BY7xYAL4.js";import"./inventory-pages-yK5D55FD.js";import"./knowledgehub-pages-DX_b2YG9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();var it=Object.defineProperty,Y=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable,J=(e,t,s)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Z=(e,t)=>{for(var s in t||(t={}))lt.call(t,s)&&J(e,s,t[s]);if(Y)for(var s of Y(t))ct.call(t,s)&&J(e,s,t[s]);return e};const B=Ce(e=>({totalScore:0,availablePoints:0,showFilters:!1,showLeaderboardModal:!1,showStatsModal:!1,showChallengeModal:!1,leaderboardUsers:[],tasks:[],gamificationData:{totalScore:0,level:1,totalPoints:0,streak:0,rank:100,stats:{toolsSterilized:0,inventoryChecks:0,perfectDays:0,totalTasks:0,completedTasks:0,currentStreak:0,bestStreak:0}},drawerOpen:!0,loading:!1,taskError:null,setTotalScore:t=>e({totalScore:t}),setAvailablePoints:t=>e({availablePoints:t}),setShowFilters:t=>e({showFilters:t}),setShowLeaderboardModal:t=>e({showLeaderboardModal:t}),setShowStatsModal:t=>e({showStatsModal:t}),setShowChallengeModal:t=>e({showChallengeModal:t}),setLeaderboardUsers:t=>e({leaderboardUsers:t}),setTasks:t=>e({tasks:t}),setGamificationData:t=>e({gamificationData:t}),updateGamificationData:t=>{Ne()&&(typeof t!="object"||t===null)&&ot.warn("[DEV] updateGamificationData called with invalid input:",t),e(s=>({gamificationData:Z(Z({},s.gamificationData),t)}))},setDrawerOpen:t=>e({drawerOpen:t}),setLoading:t=>e({loading:t}),setTaskError:t=>e({taskError:t})}));function dt({leaderboardData:e}){const{showStatsModal:t,setShowStatsModal:s,showLeaderboardModal:d,setShowLeaderboardModal:o,showChallengeModal:n,setShowChallengeModal:i,gamificationData:u}=B(),r=l.useMemo(()=>e.users||[],[e.users]),c=l.useMemo(()=>!r||r.length===0?[]:r.slice().sort((m,_)=>_.score-m.score).slice(0,3),[r]),g=l.useMemo(()=>e.userRank||1,[e.userRank]),p=l.useMemo(()=>!e.users||e.users.length===0?[]:c.map(m=>({id:m.id,name:m.full_name||"Anonymous",score:m.score||0,rank:m.rank,avatar:m.avatar||"ðŸ‘¤"})),[c,e.users]);return a.jsx(Te,{isStatsOpen:t,onStatsClose:()=>s(!1),isLeaderboardOpen:d,onLeaderboardClose:()=>o(!1),isChallengeOpen:n,onChallengeClose:()=>i(!1),gamificationData:u,leaderboardRank:g,leaderboardTopUsers:p,leaderboardLoading:!1,leaderboardError:null})}function ut({loading:e,tasks:t,taskError:s}){return e?null:s?a.jsx(De,{message:"Some tasks may not be available due to a loading error."}):(!t||t.length===0,null)}const me=E.memo(({tasks:e,loading:t,taskError:s,storeAvailablePoints:d,storeShowFilters:o,setStoreShowFilters:n,selectedCategory:i,selectedType:u,onCategoryChange:r,onTypeChange:c,onTaskToggle:g,onTaskUpdate:p})=>a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx(ut,{loading:t,tasks:e,taskError:s}),a.jsx(z,{children:a.jsx("div",{className:"flex-1",children:a.jsx(Ie,{tasks:e,onTaskComplete:g,onTaskUpdate:p,availablePoints:d,showFilters:o,onToggleFilters:()=>n(!o),selectedCategory:i,selectedType:u,onCategoryChange:r,onTypeChange:c})})})]}));me.displayName="HomeTasksSection";var mt=(e,t,s)=>new Promise((d,o)=>{var n=r=>{try{u(s.next(r))}catch(c){o(c)}},i=r=>{try{u(s.throw(r))}catch(c){o(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(n,i);u((s=s.apply(e,t)).next())});const ft=E.memo(function({loading:t=!1,aiMetrics:s,sterilizationMetrics:d,integrationMetrics:o,aiImpactMetrics:n}){const i=()=>mt(null,null,function*(){try{H.clearCache(),yield H.fetchAndCacheMetricsOnLogin(),window.location.reload()}catch(c){throw console.error("Failed to refresh metrics:",c),c}}),u=l.useMemo(()=>{var c,g,p;return{timeSaved:(s==null?void 0:s.timeSaved)||{daily:0,monthly:0},aiTimeSaved:(s==null?void 0:s.aiTimeSaved)||{daily:0,monthly:0},costSavings:(s==null?void 0:s.costSavings)||{monthly:0,annual:0},aiEfficiency:(s==null?void 0:s.aiEfficiency)||{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:((c=s==null?void 0:s.teamPerformance)==null?void 0:c.skills)||0,inventory:((g=s==null?void 0:s.teamPerformance)==null?void 0:g.inventory)||0,sterilization:((p=s==null?void 0:s.teamPerformance)==null?void 0:p.sterilization)||0}}},[s]);return t&&!(s||d||o)?a.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 h-full",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})}):a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute top-4 right-4 z-10",children:a.jsx(Re,{onRefresh:i,size:"sm",className:"shadow-md"})}),a.jsx(l.Suspense,{fallback:a.jsx(ze,{}),children:a.jsx(z,{children:a.jsx(Ae,{biData:void 0,ciData:void 0,performanceMetrics:u,aiImpactMetrics:n})})})]})}),U={DEFAULT_RANK:100,DEFAULT_LEVEL:1,DEFAULT_SCORE:0},fe=E.memo(({gamificationData:e})=>{const{stats:t,loading:s}=Fe(),{updateGamificationData:d}=B(),n=!(e&&typeof e.streak=="number"&&typeof e.level=="number"&&typeof e.rank=="number"&&typeof e.totalScore=="number"&&e.streak>=0&&e.level>=1&&e.rank>=1&&e.totalScore>=0)||s,i=l.useMemo(()=>{const u=Math.max(0,(e==null?void 0:e.streak)||0),r=Math.max(1,(e==null?void 0:e.level)||U.DEFAULT_LEVEL),c=Math.max(1,(e==null?void 0:e.rank)||U.DEFAULT_RANK),g=Math.max(0,(e==null?void 0:e.totalScore)||U.DEFAULT_SCORE);return{streak:u,level:r,rank:c,totalScore:g,stats:{toolsSterilized:t.toolsSterilized||0,inventoryChecks:t.inventoryChecks||0,perfectDays:t.perfectDays||0,totalTasks:t.totalTasks||0,completedTasks:t.completedTasks||0,currentStreak:t.currentStreak||u,bestStreak:t.bestStreak||0}}},[e==null?void 0:e.streak,e==null?void 0:e.level,e==null?void 0:e.rank,e==null?void 0:e.totalScore,t]);return l.useEffect(()=>{!n&&i&&d(i)},[i,n,d]),n?a.jsx("div",{className:"bg-white rounded-xl shadow-lg p-2 mb-4 border-l-4 border-[#4ECDC4] border-opacity-50 mt-2",children:a.jsx("div",{className:"animate-pulse",children:a.jsxs("div",{className:"flex items-center justify-between p-1",children:[a.jsxs("div",{className:"flex items-center p-1",children:[a.jsx("div",{className:"p-2 bg-orange-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 mb-1"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]}),a.jsxs("div",{className:"flex items-center p-1",children:[a.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-8 mr-2"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]})]}),a.jsxs("div",{className:"flex items-center p-1 pl-8",children:[a.jsx("div",{className:"p-2 bg-teal-100 rounded-full",children:a.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})}),a.jsxs("div",{className:"ml-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),a.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]})]})]})})}):a.jsx($e,{gamificationData:i})});fe.displayName="HomeGamificationSection";const pe=E.memo(({gamificationData:e,tasks:t,loading:s,taskError:d,storeAvailablePoints:o,storeShowFilters:n,setStoreShowFilters:i,selectedCategory:u,selectedType:r,onCategoryChange:c,onTypeChange:g,onTaskToggle:p,onTaskUpdate:m,aiMetrics:_,sterilizationMetrics:y,integrationMetrics:j,aiImpactMetrics:C})=>{const O=l.useMemo(()=>q("flex flex-col lg:flex-row gap-6",`mt-${L.SPACING.MARGIN_TOP}`),[]),h=l.useMemo(()=>q(`p-${L.SPACING.PADDING}`),[]);return a.jsx("div",{className:h,children:a.jsxs("div",{className:"space-y-6",children:[a.jsx(fe,{gamificationData:e}),a.jsxs("div",{className:O,children:[a.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:a.jsx(me,{tasks:t,loading:s,taskError:d,storeAvailablePoints:o,storeShowFilters:n,setStoreShowFilters:i,selectedCategory:u,selectedType:r,onCategoryChange:c,onTypeChange:g,onTaskToggle:p,onTaskUpdate:m})}),a.jsx("div",{className:"flex-1 h-[515px] flex flex-col",children:a.jsx(ft,{loading:s,aiMetrics:_,sterilizationMetrics:y,integrationMetrics:j,aiImpactMetrics:C})})]}),a.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:a.jsx(Ue,{})})]})})});pe.displayName="HomeContentLayout";var A=(e,t,s)=>new Promise((d,o)=>{var n=r=>{try{u(s.next(r))}catch(c){o(c)}},i=r=>{try{u(s.throw(r))}catch(c){o(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(n,i);u((s=s.apply(e,t)).next())});const he=E.memo(({homeData:e})=>{const[t,s]=l.useState(!1),[d,o]=l.useState(!1),[n,i]=l.useState(""),[u,r]=l.useState(""),c=l.useMemo(()=>e.tasks||[],[e.tasks]),g=c.length,[p,m]=l.useState(1),y=Math.ceil(g/10),j=p<y,C=l.useCallback(()=>{j&&m(f=>f+1)},[j]),O=l.useCallback(()=>{p>1&&m(f=>f-1)},[p]),h=l.useCallback(f=>{f>=1&&f<=y&&m(f)},[y]),N=l.useCallback(f=>A(null,null,function*(){console.log("Completing task:",f)}),[]),I=l.useCallback(()=>A(null,null,function*(){console.log("Refreshing tasks...")}),[]),T=!1,R=null,{aiMetrics:F={timeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:k={},integrationMetrics:M={},aiImpactMetrics:_e=null}=e||{},xe=l.useMemo(()=>c.map(f=>({id:f.id,title:f.title,description:f.description||"",completed:f.isCompleted,points:f.points,type:f.category,category:f.category,priority:"medium",dueDate:f.createdAt,status:f.isCompleted?"completed":"pending"})),[c]),$=l.useMemo(()=>c.reduce((f,b)=>f+(b.points||0),0),[c]),Se=l.useMemo(()=>(v=>v&&typeof v=="object"&&v!==null&&"streak"in v&&typeof v.streak=="number"&&Number(v.streak)>=0&&"level"in v&&typeof v.level=="number"&&Number(v.level)>=1&&"rank"in v&&typeof v.rank=="number"&&Number(v.rank)>=1&&"totalScore"in v&&typeof v.totalScore=="number"&&Number(v.totalScore)>=0)(e.gamificationData)?e.gamificationData:{streak:0,level:5,rank:1,totalScore:Math.max(0,$||0)},[e.gamificationData,$]),K=l.useCallback(f=>{s(f)},[]);l.useCallback(()=>{},[]);const we=l.useCallback(f=>{i(f)},[]),be=l.useCallback(f=>{r(f)},[]),je=l.useCallback((f,b)=>A(null,null,function*(){try{const{FacilityService:v}=yield x(()=>import("./services-JA4N6ZXe.js").then(ke=>ke.aU),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));if(!(yield v.getCurrentFacilityId()))throw new Error("No authenticated facility for task toggle");yield N(f),b&&b>0&&console.log(`Task completed! Awarded ${b} points.`)}catch(v){console.error("Error toggling task:",v)}}),[N]),Pe=l.useCallback((f,b)=>A(null,null,function*(){try{const v={title:b.title,description:b.description,category:b.category,points:b.points||0,isCompleted:b.status==="completed"};yield ue.updateDailyTask(f,v),yield I(),console.log("Task updated successfully:",f)}catch(v){throw console.error("Failed to update task:",v),v}}),[I]);return a.jsxs("div",{className:"home-content","data-testid":"home-content",children:[a.jsx(pe,{gamificationData:Se,tasks:xe,loading:T,taskError:R,storeAvailablePoints:$,storeShowFilters:d,setStoreShowFilters:o,selectedCategory:n,selectedType:u,onCategoryChange:we,onTypeChange:be,onTaskToggle:je,onTaskUpdate:Pe,aiMetrics:F||void 0,sterilizationMetrics:k||void 0,integrationMetrics:M||void 0,aiImpactMetrics:_e||void 0}),y>1&&a.jsxs("div",{className:"mt-8 mb-4",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"paginationStyle",checked:!t,onChange:()=>K(!1),className:"mr-2"}),"Pagination"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"paginationStyle",checked:t,onChange:()=>K(!0),className:"mr-2"}),"Load More"]})]})}),t?a.jsx(Ve,{onLoadMore:C,hasMore:j,isLoading:T,className:"mb-4"}):a.jsx(Ge,{currentPage:p,totalPages:y,onPageChange:h,onNextPage:C,onPreviousPage:O,hasNextPage:j,hasPreviousPage:p>1,isLoading:T,className:"mb-4"})]})]})});he.displayName="HomeContent";var pt=Object.defineProperty,ht=Object.defineProperties,gt=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,te=(e,t,s)=>t in e?pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,_t=(e,t)=>{for(var s in t||(t={}))vt.call(t,s)&&te(e,s,t[s]);if(ee)for(var s of ee(t))yt.call(t,s)&&te(e,s,t[s]);return e},xt=(e,t)=>ht(e,gt(t));function St({homeData:e}){const{setShowStatsModal:t,setShowLeaderboardModal:s,setShowChallengeModal:d}=B(),{isDrawerOpen:o}=He(),n=l.useRef(null),{navBarMarginLeft:i,navBarMarginTop:u}=Be(o),r=l.useCallback(()=>t(!0),[t]),c=l.useCallback(()=>s(!0),[s]),g=l.useCallback(()=>d(!0),[d]);return a.jsx(z,{children:a.jsxs(qe,{children:[a.jsxs("div",{className:q("min-h-[100dvh] md:h-screen bg-gradient-to-br hide-scrollbar overflow-hidden",`from-${L.COLORS.BG_GRADIENT.FROM}`,`to-${L.COLORS.BG_GRADIENT.TO}`),"aria-label":"Cliniio Home Dashboard","data-testid":"home-layout",children:[a.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white text-black p-2 z-50 rounded shadow-lg","aria-label":"Skip to main content",children:"Skip to main content"}),a.jsxs("main",{className:`flex-1 border-l-${L.BORDER.LEFT_WIDTH} border-${L.COLORS.BORDER} pt-6 overflow-hidden`,role:"main",id:"main-content",ref:n,tabIndex:-1,"aria-label":"Main content area",children:[a.jsx("div",{className:"flex-shrink-0",style:{marginLeft:i,marginTop:u},"aria-label":"Dashboard header container",children:a.jsx(Ke,{onStatsClick:r,onLeaderboardClick:c,onChallengeClick:g})}),a.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar",style:{marginLeft:i},role:"region","aria-label":"Dashboard content",children:a.jsx(he,{homeData:e})})]})]}),a.jsx(dt,{leaderboardData:xt(_t({},e.leaderboardData),{users:[],userRank:1})})]})})}var wt=Object.defineProperty,bt=Object.defineProperties,jt=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertySymbols,Pt=Object.prototype.hasOwnProperty,kt=Object.prototype.propertyIsEnumerable,se=(e,t,s)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,re=(e,t)=>{for(var s in t||(t={}))Pt.call(t,s)&&se(e,s,t[s]);if(ae)for(var s of ae(t))kt.call(t,s)&&se(e,s,t[s]);return e},oe=(e,t)=>bt(e,jt(t)),Ct=(e,t,s)=>new Promise((d,o)=>{var n=r=>{try{u(s.next(r))}catch(c){o(c)}},i=r=>{try{u(s.throw(r))}catch(c){o(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(n,i);u((s=s.apply(e,t)).next())});const V=[{id:"demo-1",title:"Complete Daily Safety Checklist",description:"Review and complete the facility safety checklist",category:"Safety",difficulty:"Easy",points:50,timeEstimate:"15 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-2",title:"Update Inventory Records",description:"Verify and update current inventory levels",category:"Inventory",difficulty:"Medium",points:75,timeEstimate:"30 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"demo-3",title:"Review Sterilization Protocols",description:"Ensure all sterilization equipment is properly maintained",category:"Sterilization",difficulty:"Hard",points:100,timeEstimate:"45 min",isCompleted:!1,completedAt:null,pointsEarned:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],D={aiMetrics:{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},sterilizationMetrics:{cyclesCompleted:0,successRate:"0%",equipmentStatus:"No Data"},integrationMetrics:{systemHealth:"No Data",uptime:"0%",lastSync:"Never"}},Et=()=>{const{currentFacility:e,isLoading:t}=We(),[s,d]=l.useState({tasks:[],aiMetrics:null,aiImpactMetrics:null,sterilizationMetrics:null,integrationMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",total_points:0,completed_tasks:0,current_streak:0,best_streak:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!0,error:null}),o=l.useCallback(()=>Ct(null,null,function*(){try{d(h=>oe(re({},h),{loading:!0,error:null}));let n;if(e!=null&&e.id)n=e.id;else{if(t)return;n="550e8400-e29b-41d4-a716-446655440000"}const[i,u,r]=yield Promise.allSettled([ue.getFacilityDailyTasks(n),H.fetchAndCacheMetricsOnLogin(),nt.fetchCumulativeStats()]),c=yield Promise.resolve([]);console.log("ðŸ” useHomeDataLoader: Promise.allSettled results:",{allDailyTasks:i.status,freshMetrics:u.status,gamificationStats:r.status,leaderboardData:"skipped"});const g=i.status==="fulfilled"?i.value:V,p=u.status==="fulfilled"&&u.value?u.value:null,m=(p==null?void 0:p.aiMetrics)||{timeSaved:{daily:0,monthly:0},aiTimeSaved:{daily:0,monthly:0},costSavings:{monthly:0,annual:0},aiEfficiency:{timeSavings:0,proactiveMgmt:0},teamPerformance:{skills:0,inventory:0,sterilization:0},gamificationStats:{totalTasks:0,completedTasks:0,perfectDays:0,currentStreak:0,bestStreak:0}},_=(p==null?void 0:p.sterilizationMetrics)||D.sterilizationMetrics,y=(p==null?void 0:p.integrationMetrics)||D.integrationMetrics,j={id:"",user_id:"",facility_id:"",total_points:0,completed_tasks:0,current_streak:0,best_streak:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},C=r.status==="fulfilled"&&r.value?(()=>{const h=r.value,N=c.status==="fulfilled"&&c.values?c.values:{userRank:1,totalUsers:1},I=Math.max(0,h.currentStreak||0),T=Math.max(0,h.totalPoints||0),R=Math.max(1,N.userRank||1),F=Math.max(1,N.totalUsers||1),k=R/F;let M;return k<=.1?M=Math.max(10,Math.floor(10+(.1-k)*50)):k<=.25?M=Math.max(7,Math.floor(7+(.25-k)*20)):k<=.5?M=Math.max(5,Math.floor(5+(.5-k)*8)):M=Math.max(1,Math.floor(1+(1-k)*4)),{streak:I,level:M,rank:R,totalScore:T}})():null,O=g.length>0?g.map(h=>"difficulty"in h&&"timeEstimate"in h?h:{id:h.id,title:h.title,description:h.description||"",category:h.category,difficulty:h.priority||"medium",points:h.points,timeEstimate:`${h.estimated_duration||30} min`,isCompleted:h.completed||!1,completedAt:h.completed_at||null,pointsEarned:h.completed?h.points:0,createdAt:h.created_at||h.due_date||new Date().toISOString(),updatedAt:h.updated_at||new Date().toISOString()}):V;d({tasks:O,aiMetrics:m,sterilizationMetrics:_,integrationMetrics:y,aiImpactMetrics:(p==null?void 0:p.aiImpactMetrics)||null,leaderboardData:j,gamificationData:C,loading:!1,error:null}),console.log("ðŸš€ Home data loaded (with fallbacks if needed):",{tasks:O.length,aiMetrics:!!m,sterilizationMetrics:!!_,integrationMetrics:!!y})}catch(n){console.error("Critical error loading home data, using all fallbacks:",n),d({tasks:V,aiMetrics:oe(re({},D.aiMetrics),{costSavings:{monthly:0,annual:0},teamPerformance:{skills:0,inventory:0,sterilization:0}}),sterilizationMetrics:D.sterilizationMetrics,integrationMetrics:D.integrationMetrics,aiImpactMetrics:null,leaderboardData:{id:"",user_id:"",facility_id:"",total_points:0,completed_tasks:0,current_streak:0,best_streak:0,rank:1,user_name:"",department:"",created_at:"",updated_at:""},gamificationData:null,loading:!1,error:null})}}),[e,t]);return l.useEffect(()=>{if(!t){const n=setTimeout(()=>{o()},0);return()=>clearTimeout(n)}},[t,o]),s};function Mt(){const{currentUser:e,isLoading:t}=Qe(),s=Q(i=>i.authToken),d=Q(i=>i.isTokenExpired),o=Et();return!!!(e&&s&&!d)&&!t?a.jsx(de,{to:"/login",replace:!0}):t||!e?a.jsx(X,{size:"lg",message:"Verifying Authentication..."}):o.loading?a.jsx(X,{size:"lg",message:"Data Compilation In Progress..."}):a.jsx(St,{homeData:o})}var ge=(e,t,s)=>new Promise((d,o)=>{var n=r=>{try{u(s.next(r))}catch(c){o(c)}},i=r=>{try{u(s.throw(r))}catch(c){o(c)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(n,i);u((s=s.apply(e,t)).next())});const Ot=l.lazy(()=>x(()=>import("./sterilization-pages-55q58lSr.js").then(e=>e.S),__vite__mapDeps([11,2,3,1,0,9,5,6,7,4,10,8]))),Lt=l.lazy(()=>x(()=>import("./inventory-pages-yK5D55FD.js").then(e=>e.i),__vite__mapDeps([9,1,2,3,4,0,10,5,6,7,8]))),Nt=l.lazy(()=>x(()=>import("./page-BAJssmbq.js"),__vite__mapDeps([12,2,3,1,0,9,5,6,7,4,10,8,13]))),Tt=l.lazy(()=>x(()=>import("./knowledgehub-pages-DX_b2YG9.js").then(e=>e.i),__vite__mapDeps([10,2,3,1,0,9,5,6,7,4,8]))),Dt=l.lazy(()=>x(()=>import("./page-CjAWSueG.js"),__vite__mapDeps([14,2,3,1,0,9,5,6,7,4,10,8]))),It=l.lazy(()=>x(()=>import("./sterilization-pages-55q58lSr.js").then(e=>e.a),__vite__mapDeps([11,2,3,1,0,9,5,6,7,4,10,8]))),Rt=l.lazy(()=>x(()=>import("./inventory-pages-yK5D55FD.js").then(e=>e.S),__vite__mapDeps([9,1,2,3,4,0,10,5,6,7,8]))),At=l.lazy(()=>x(()=>import("./ScannerPage-ChlGlHqM.js"),__vite__mapDeps([15,2,3,1,0,9,5,6,7,4,10,8,13]))),zt=l.lazy(()=>x(()=>import("./settings-pages-CyhDoqVN.js").then(e=>e.i),__vite__mapDeps([16,2,3,1,0,9,5,6,7,4,10,8]))),Ft=l.lazy(()=>x(()=>import("./index-_IL51nB_.js").then(e=>e.i),__vite__mapDeps([17,2,3,1,0,9,5,6,7,4,10,8,16]))),$t=l.lazy(()=>x(()=>import("./index-cQ-d7A3a.js"),__vite__mapDeps([18,2,3,1,0,9,5,6,7,4,10,8]))),Ut=l.lazy(()=>x(()=>import("./login-page-QYUu-Fmi.js"),__vite__mapDeps([19,2,3,1,0,9,5,6,7,4,10,8]))),Vt=l.lazy(()=>x(()=>import("./index-CA73boru.js"),__vite__mapDeps([20,2,3,1,0,9,5,6,7,4,10,8]))),Gt=l.lazy(()=>x(()=>import("./components-BtXJbSH9.js").then(e=>e.ay),__vite__mapDeps([1,2,3,4,0,9,5,6,7,10,8]))),Ht=l.lazy(()=>x(()=>import("./HelpArticlePage-jCFdk-Hg.js"),__vite__mapDeps([21,2,3,1,0,9,5,6,7,4,10,8,22])));let P=null;const qt=300*1e3;function ve(){return ge(this,null,function*(){if(!(typeof window!="undefined"&&window.location.pathname==="/login"))try{const{FacilityService:e}=yield x(()=>import("./services-JA4N6ZXe.js").then(s=>s.aU),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),t=yield e.getCurrentFacilityId();if(!t){console.warn("No facility ID available - using development fallback"),P={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()};return}P={id:t,timestamp:Date.now()}}catch(e){console.warn("Failed to update facility ID cache:",e),P||(P={id:"550e8400-e29b-41d4-a716-446655440000",timestamp:Date.now()})}})}function ne(){const e=Date.now();if(P&&e-P.timestamp<qt)return P.id;if(P)return ve(),P.id;throw P?new Error("Unexpected state in getCurrentFacilityId"):new Error("Facility ID lookup failed â€” no fallback allowed in production.")}function Bt(){const e=window;if(typeof window=="undefined"||e.__postgrestGuardInstalled||typeof window.fetch=="undefined")return;e.__postgrestGuardInstalled=!0;const t=".supabase.co/rest/v1/",s=window.fetch.bind(window);window.fetch=(d,o)=>ge(null,null,function*(){try{let n=typeof d=="string"?d:d.toString();if(n.includes(t)){const i=new URL(n),u=m=>m.endsWith(":1")?m.slice(0,-2):m,r=[],c=[];for(const[m,_]of i.searchParams.entries()){const y=_.trim();if(y==="eq."||y==="eq"||y==="eq:"||y==="eq:."||y==="."){r.push(m);continue}if(m==="facility_id"&&(y==="eq.:1"||y==="eq:1"||y===":1"||y==="eq.:")){const C=ne();c.push(["facility_id",`eq.${C}`]);continue}const j=u(y);if(j!==y){c.push([m,j]);continue}if(m==="quantity"&&y==="lt.reorder_point"){r.push(m);continue}}if(r.forEach(m=>i.searchParams.delete(m)),c.forEach(([m,_])=>{i.searchParams.set(m,_)}),i.search.includes("facility_id=eq.:1")){const m=ne();i.search=i.search.replace("facility_id=eq.:1",`facility_id=eq.${m}`)}i.search=i.search.replace(/(^|&)([^=&]+)=eq\.(?=(&|$))/g,(m,_)=>_?_.slice(0,-1):""),i.search=i.search.replace(/(:1)(?=(&|$))/g,""),i.search=i.search.replace(/(^|&)quantity=lt\.reorder_point(?=(&|$))/g,(m,_)=>_?_.slice(0,-1):"");const g=new URL(i.toString()),p=new Map;for(const[m,_]of g.searchParams.entries())p.set(m,_);g.search="";for(const[m,_]of p.entries())g.searchParams.append(m,_);g.toString()!==n&&(e.__postgrestGuardLogged||(e.__postgrestGuardLogged=!0,console.info("ðŸ›¡ï¸ PostgREST guard rewrote URL:",{from:n,to:g.toString()})),n=g.toString(),d=n)}}catch(n){throw console.error(n),n}return s(d,o)})}const Kt=new rt({defaultOptions:{queries:{refetchOnWindowFocus:!0,retry:1,staleTime:1e3*60*2,refetchOnMount:e=>e.queryKey.includes("live")},mutations:{retry:1}}});function Wt(){const[e,t]=E.useState(!1);return E.useEffect(()=>{ve(),Bt(),x(()=>W(null,null,function*(){const{realTimeStatusMonitor:d}=yield import("./services-JA4N6ZXe.js").then(o=>o.aX);return{realTimeStatusMonitor:d}}),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(({realTimeStatusMonitor:d})=>{d.startMonitoring()});const s=d=>{d.ctrlKey&&d.shiftKey&&d.key==="P"&&(d.preventDefault(),t(o=>!o))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),a.jsxs(Ee,{client:Kt,children:[a.jsx(z,{children:a.jsx(Xe,{children:a.jsx(Ye,{children:a.jsxs(Me,{children:[a.jsxs(Je,{children:[a.jsx(l.Suspense,{fallback:a.jsx(Ze,{}),children:a.jsxs(Oe,{children:[a.jsx(S,{path:"/login",element:a.jsx(Ut,{})}),a.jsx(S,{path:"/auth/callback",element:a.jsx(Gt,{})}),a.jsx(S,{path:"/home",element:a.jsx(w,{children:a.jsx(Mt,{})})}),a.jsx(S,{path:"/sterilization",element:a.jsx(w,{children:a.jsx(Ot,{})})}),a.jsx(S,{path:"/sterilization/scanner",element:a.jsx(w,{children:a.jsx(It,{})})}),a.jsx(S,{path:"/inventory",element:a.jsx(w,{children:a.jsx(Lt,{})})}),a.jsx(S,{path:"/inventory/scanner",element:a.jsx(w,{children:a.jsx(Rt,{})})}),a.jsx(S,{path:"/environmental-clean",element:a.jsx(w,{children:a.jsx(Nt,{})})}),a.jsx(S,{path:"/environmental-clean/scanner",element:a.jsx(w,{children:a.jsx(At,{})})}),a.jsx(S,{path:"/knowledge-hub",element:a.jsx(w,{children:a.jsx(Tt,{})})}),a.jsx(S,{path:"/library",element:a.jsx(w,{children:a.jsx(Dt,{})})}),a.jsx(S,{path:"/intelligence",element:a.jsx(w,{children:a.jsx(Vt,{})})}),a.jsx(S,{path:"/settings",element:a.jsx(w,{children:a.jsx(zt,{})})}),a.jsx(S,{path:"/content-builder",element:a.jsx(w,{children:a.jsx(Ft,{})})}),a.jsx(S,{path:"/course/:courseId",element:a.jsx(w,{children:a.jsx($t,{})})}),a.jsx(S,{path:"/help/article/:slug",element:a.jsx(Ht,{})}),a.jsx(S,{path:"/",element:a.jsx(de,{to:"/home",replace:!0})})]})}),a.jsx(et,{})]}),a.jsx(tt,{})]})})})}),a.jsx(at,{isVisible:e,onClose:()=>t(!1)})]})}var Qt=Object.defineProperty,ie=Object.getOwnPropertySymbols,Xt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable,le=(e,t,s)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Jt=(e,t)=>{for(var s in t||(t={}))Xt.call(t,s)&&le(e,s,t[s]);if(ie)for(var s of ie(t))Yt.call(t,s)&&le(e,s,t[s]);return e};const Zt={ERROR:0,WARN:1,INFO:2,DEBUG:3,VERBOSE:4},G=e=>{typeof window!="undefined"&&(localStorage.setItem("cliniio_log_level",e),window.cliniioLogger&&window.cliniioLogger.setLevel(e),console.log(`ðŸ”§ Console log level set to: ${e}`))},ea=()=>{if(typeof window!="undefined"){const e=localStorage.getItem("cliniio_log_level");if(e&&Zt[e]!==void 0)return e}return"WARN"},ce={quiet:()=>G("WARN"),normal:()=>G("INFO"),verbose:()=>G("DEBUG"),silent:()=>{const e=Jt({},console);return Object.keys(console).forEach(t=>{typeof console[t]=="function"&&(console[t]=()=>{})}),console.log("ðŸ”‡ Console logging disabled. Use consoleControl.restore() to re-enable."),e},restore:e=>{e&&(Object.assign(console,e),console.log("ðŸ”Š Console logging restored."))},status:()=>{const e=ea();return console.log(`ðŸ“Š Current log level: ${e}`),e}},ye=()=>{typeof window!="undefined"&&(window.consoleControl=ce,console.log("ðŸŽ›ï¸ Console control initialized. Use consoleControl.quiet(), consoleControl.normal(), or consoleControl.verbose() to adjust logging."),ce.status())};typeof window!="undefined"&&ye();ye();typeof window!="undefined"&&(window.cliniioLogger=st);"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistrations().then(function(e){for(const t of e)t.unregister(),console.log("Service worker unregistered")}),navigator.serviceWorker.ready.then(e=>{e.unregister(),console.log("Main service worker unregistered")}));Le.createRoot(document.getElementById("root")).render(a.jsx(E.StrictMode,{children:a.jsx(Wt,{})}));
