import{j as e}from"./utils-5cl0BHpv.js";import{a as b}from"./vendor-DVtBqAv5.js";import{I as C,o as te,i as se,au as J,r as ae,c as ne}from"./errors-BMV5cHgT.js";import{G as re,M as w,N as oe}from"./main-Ccza29P3.js";import"./login-CgiYf71G.js";import"./data-Djiu4445.js";import"./ui-C2vLYFVP.js";var ie=(D,v,l)=>new Promise((I,g)=>{var j=m=>{try{h(l.next(m))}catch(u){g(u)}},N=m=>{try{h(l.throw(m))}catch(u){g(u)}},h=m=>m.done?I(m.value):Promise.resolve(m.value).then(j,N);h((l=l.apply(D,v)).next())});const he=({show:D,onClose:v})=>{const[l,I]=b.useState(null),[g,j]=b.useState(!1),[N,h]=b.useState(null),[m,u]=b.useState(!1),[o,S]=b.useState(null),[U,E]=b.useState(0),{activeTab:i}=re(),K=()=>{const r=`${(()=>{const p="barcode,name,category,location,quantity,status,purchaseDate,vendor,cost,notes";switch(i){case"tools":return`${p},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,assignedTo`;case"supplies":return`${p},expirationDate,reorderPoint,minimumStock`;case"equipment":return`${p},warranty,maintenanceSchedule,lastServiced,nextDue,serviceProvider,serialNumber`;case"officeHardware":return`${p},warranty,serialNumber,assignedTo`;default:return p}})()}
123456789,${i.slice(0,-1)} Name,${i},Location,1,Available,2024-01-01,Vendor Name,100.00,Notes`,s=new Blob([r],{type:"text/csv"}),d=window.URL.createObjectURL(s),x=document.createElement("a");x.href=d,x.download=`${i}_template.csv`,document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(d)},W=a=>{var r;const s=(r=a.target.files)==null?void 0:r[0];s&&s.type==="text/csv"&&(I(s),h(null),u(!1))},X=(a,r)=>{var s;const d=[];return(!((s=a.data)!=null&&s.barcode)||String(a.data.barcode).trim()==="")&&d.push(`Row ${r}: Barcode is required`),(!a.name||String(a.name).trim()==="")&&d.push(`Row ${r}: Name is required`),a.quantity&&(isNaN(Number(a.quantity))||Number(a.quantity)<0)&&d.push(`Row ${r}: Quantity must be a positive number`),a.unit_cost&&(isNaN(parseFloat(String(a.unit_cost)))||parseFloat(String(a.unit_cost))<0)&&d.push(`Row ${r}: Cost must be a positive number`),d},Y=()=>ie(null,null,function*(){if(l){j(!0),h(null),u(!1),S(null),E(0);try{const r=(yield l.text()).split(`
`),s=r[0].split(",").map(t=>t.trim()),d=s.findIndex(t=>t.toLowerCase().includes("barcode")),x=s.findIndex(t=>t.toLowerCase().includes("name")),p=s.findIndex(t=>t.toLowerCase().includes("category")),F=s.findIndex(t=>t.toLowerCase().includes("location")),T=s.findIndex(t=>t.toLowerCase().includes("quantity")),R=s.findIndex(t=>t.toLowerCase().includes("status")),q=s.findIndex(t=>t.toLowerCase().includes("purchasedate")),k=s.findIndex(t=>t.toLowerCase().includes("vendor")),V=s.findIndex(t=>t.toLowerCase().includes("cost")),_=s.findIndex(t=>t.toLowerCase().includes("warranty")),P=s.findIndex(t=>t.toLowerCase().includes("maintenanceschedule")),z=s.findIndex(t=>t.toLowerCase().includes("lastserviced")),A=s.findIndex(t=>t.toLowerCase().includes("nextdue")),B=s.findIndex(t=>t.toLowerCase().includes("serviceprovider")),M=s.findIndex(t=>t.toLowerCase().includes("assignedto")),O=s.findIndex(t=>t.toLowerCase().includes("notes"));if(d===-1||x===-1)throw new Error("CSV must contain barcode and name columns");const $=[],y=[];for(let t=1;t<r.length;t++){const c=r[t].trim();if(!c)continue;const n=c.split(",").map(ee=>ee.trim());if(n.length<s.length)continue;const G={id:`csv-${Date.now()}-${t}`,name:n[x],category:p!==-1?n[p]:i,location:F!==-1?n[F]:"Unknown",quantity:T!==-1&&parseInt(n[T])||1,status:R!==-1?n[R]:"Available",unit_cost:V!==-1&&parseFloat(n[V])||0,updated_at:new Date().toISOString(),data:{barcode:n[d],purchaseDate:q!==-1?n[q]:new Date().toISOString().split("T")[0],vendor:k!==-1?n[k]:"",warranty:_!==-1?n[_]:"",maintenanceSchedule:P!==-1?n[P]:"",lastServiced:z!==-1?n[z]:"",nextDue:A!==-1?n[A]:"",serviceProvider:B!==-1?n[B]:"",assignedTo:M!==-1?n[M]:"",notes:O!==-1?n[O]:"Imported via CSV upload"}},Q=X(G,t+1);y.push(...Q),Q.length===0&&$.push(G)}if(y.length>0){S({success:!1,message:`Validation failed for ${y.length} items`,importedCount:0,failedCount:y.length,errors:y});return}let L=0,f=0;const H=[];for(let t=0;t<$.length;t++){try{const c=$[t];if(c&&c.id&&c.name)yield oe.addInventoryItem(c),L++;else throw new Error("Invalid item data")}catch(c){f++,H.push(`Row ${t+2}: ${c instanceof Error?c.message:"Import failed"}`)}E((t+1)/$.length*100)}const Z={success:f===0,message:f===0?`Successfully imported ${L} items`:`Imported ${L} items, ${f} failed`,importedCount:L,failedCount:f,errors:H};S(Z),u(f===0),f===0&&setTimeout(()=>{I(null),u(!1),S(null),E(0),v()},3e3)}catch(a){h(a instanceof Error?a.message:"Failed to upload CSV")}finally{j(!1)}}});return e.jsxs(w,{show:D,onHide:v,centered:!0,backdrop:"static",size:"lg",children:[e.jsx(w.Header,{closeButton:!0,className:"pb-2",children:e.jsxs(w.Title,{className:"text-lg",children:["Import ",i.charAt(0).toUpperCase()+i.slice(1)," CSV"]})}),e.jsxs(w.Body,{className:"py-3 pb-6",children:[e.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[e.jsx(C,{path:te,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 1: Download Template"]})}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Get the CSV template with all required columns for ",i," ","data."]}),e.jsxs("button",{onClick:K,className:"bg-[#4ECDC4] hover:bg-[#3db8b0] text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center",children:[e.jsx(C,{path:se,size:.8,className:"mr-2"}),"Download Template"]})]})]}),e.jsxs("div",{className:"mb-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-base font-semibold text-gray-800 flex items-center",children:[e.jsx(C,{path:J,size:1,className:"mr-2 text-[#4ECDC4]"}),"Step 2: Upload CSV"]})}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Upload your filled CSV file to import ",i," into the database."]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"csv-file-input",className:"block text-xs font-medium text-gray-700 mb-1",children:"Select CSV File"}),e.jsx("input",{id:"csv-file-input",type:"file",accept:".csv",onChange:W,className:"form-control py-1 px-2 text-sm"})]}),l&&e.jsxs("p",{className:"text-sm text-green-600 mb-2",children:["✓ Selected: ",l.name]}),N&&e.jsxs("p",{className:"text-sm text-red-600 mb-2",children:["✗ ",N]}),m&&e.jsx("p",{className:"text-sm text-green-600 mb-2",children:"✓ Items uploaded successfully!"}),g&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[Math.round(U),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-[#4ECDC4] h-2 rounded-full transition-all duration-300",style:{width:`${U}%`}})})]}),o&&e.jsxs("div",{className:`p-3 rounded-lg border ${o.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(C,{path:o.success?ae:ne,size:1,className:`mr-2 ${o.success?"text-green-600":"text-red-600"}`}),e.jsx("span",{className:`font-medium ${o.success?"text-green-800":"text-red-800"}`,children:o.message})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Imported: ",o.importedCount," items"]}),e.jsxs("p",{children:["Failed: ",o.failedCount," items"]})]}),o.errors.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Errors:"}),e.jsxs("div",{className:"max-h-20 overflow-y-auto text-xs text-red-600",children:[o.errors.slice(0,5).map((a,r)=>e.jsxs("div",{children:["• ",a]},r)),o.errors.length>5&&e.jsxs("div",{children:["... and ",o.errors.length-5," more errors"]})]})]})]})]})]})]}),e.jsxs(w.Footer,{className:"pt-2",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors duration-200",children:"Cancel"}),e.jsxs("button",{onClick:Y,disabled:!l||g,className:"px-4 py-2 bg-[#4ECDC4] hover:bg-[#3db8b0] text-white rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[e.jsx(C,{path:J,size:.8,className:"mr-2"}),g?"Importing...":`Import ${i.charAt(0).toUpperCase()+i.slice(1)}`]})]})]})};export{he as default};
