import{s as c}from"./login-CScPvZaJ.js";import"./utils-5cl0BHpv.js";import"./vendor-DVtBqAv5.js";import"./data-Djiu4445.js";import"./ui-C2vLYFVP.js";var m=(u,n,o)=>new Promise((a,t)=>{var l=i=>{try{r(o.next(i))}catch(s){t(s)}},e=i=>{try{r(o.throw(i))}catch(s){t(s)}},r=i=>i.done?a(i.value):Promise.resolve(i.value).then(l,e);r((o=o.apply(u,n)).next())});class y{getInventoryMetrics(){return m(this,null,function*(){try{const{data:{user:n}}=yield c.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:o}=yield c.from("users").select("facility_id").eq("id",n.id).single(),a=(o==null?void 0:o.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:t,error:l}=yield c.from("inventory_items").select("status").eq("facility_id",a);if(l)return console.warn("Failed to fetch aggregated inventory metrics, using fallback:",l),{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0};const e=(t==null?void 0:t.length)||0,r=(t==null?void 0:t.filter(d=>d.status==="low_stock").length)||0,i=(t==null?void 0:t.filter(d=>d.status==="expiring").length)||0,s=e>0?(e-r)/e*100:0;return{lowStockItems:r,totalItems:e,expiringItems:i,inventoryAccuracy:s}}catch(n){return console.error("Error fetching inventory metrics:",n),{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0}}})}getEnvironmentalCleanMetrics(){return m(this,null,function*(){try{const{data:{user:n}}=yield c.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:o}=yield c.from("users").select("facility_id").eq("id",n.id).single(),a=(o==null?void 0:o.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:t,error:l}=yield c.from("environmental_clean_logs").select("status, area").eq("facility_id",a);if(l)return console.warn("Failed to fetch aggregated environmental clean metrics, using fallback:",l),{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98};const e=(t==null?void 0:t.length)||0,r=(t==null?void 0:t.filter(d=>d.status==="completed").length)||0,i=e>0?r/e*100:0,s=i>90?98:Math.max(70,i);return{cleaningEfficiency:i,totalRooms:e,cleanRooms:r,complianceScore:s}}catch(n){return console.error("Error fetching environmental clean metrics:",n),{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98}}})}getAllMetrics(){return m(this,null,function*(){try{const{data:{user:n}}=yield c.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:o}=yield c.from("users").select("facility_id").eq("id",n.id).single(),a=(o==null?void 0:o.facility_id)||"550e8400-e29b-41d4-a716-446655440000",{data:t,error:l}=yield c.from("sterilization_cycles").select("status, created_at, end_time").eq("facility_id",a).order("created_at",{ascending:!1}).limit(10);if(l){console.warn("Failed to fetch combined metrics, falling back to individual calls:",l);const[r,i]=yield Promise.all([this.getInventoryMetrics(),this.getEnvironmentalCleanMetrics()]);return{inventory:r,environmentalClean:i}}const e=(t==null?void 0:t[0])||{};return{inventory:{lowStockItems:(e==null?void 0:e.inventory_low_stock_items)||0,totalItems:(e==null?void 0:e.inventory_total_items)||0,expiringItems:(e==null?void 0:e.inventory_expiring_items)||0,inventoryAccuracy:(e==null?void 0:e.inventory_accuracy)||0},environmentalClean:{cleaningEfficiency:(e==null?void 0:e.cleaning_efficiency)||0,totalRooms:(e==null?void 0:e.cleaning_total_rooms)||0,cleanRooms:(e==null?void 0:e.cleaning_clean_rooms)||0,complianceScore:(e==null?void 0:e.cleaning_compliance_score)||98}}}catch(n){return console.error("Error fetching all home integration metrics:",n),{inventory:{lowStockItems:0,totalItems:0,expiringItems:0,inventoryAccuracy:0},environmentalClean:{cleaningEfficiency:0,totalRooms:0,cleanRooms:0,complianceScore:98}}}})}}const p=new y;export{p as homeIntegrationService};
